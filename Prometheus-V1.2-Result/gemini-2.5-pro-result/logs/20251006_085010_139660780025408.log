2025-10-06 08:50:10,191 - thread-139660780025408.app.docker.base_container - INFO - Created temporary project directory: /tmp/tmpggok22gm/sympy
2025-10-06 08:50:10,191 - thread-139660780025408.app.docker.base_container - DEBUG - Using workdir: /testbed
2025-10-06 08:50:10,191 - thread-139660780025408.app.docker.base_container - INFO - Pulling docker image: swebench/sweb.eval.x86_64.sympy_1776_sympy-18763:v1
2025-10-06 08:50:28,392 - thread-139660780025408.app.docker.base_container - INFO - Tagging pulled image as: prometheus_user_defined_container_df8d19e169
2025-10-06 08:50:28,397 - thread-139660780025408.app.docker.base_container - INFO - Starting container from image prometheus_user_defined_container_df8d19e169
2025-10-06 08:50:29,919 - thread-139660780025408.app.docker.base_container - INFO - Starting persistent shell for interactive mode...
2025-10-06 08:50:33,066 - thread-139660780025408.app.docker.base_container - INFO - Persistent shell is ready
2025-10-06 08:50:33,066 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: . /opt/miniconda3/bin/activate
2025-10-06 08:50:33,191 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 0
2025-10-06 08:50:33,191 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:


2025-10-06 08:50:33,191 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: conda activate testbed
2025-10-06 08:50:33,315 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 0
2025-10-06 08:50:33,315 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:


2025-10-06 08:50:33,315 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: python -m pip install -e .
2025-10-06 08:50:34,034 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 0
2025-10-06 08:50:34,034 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:

Obtaining file:///testbed
  Preparing metadata (setup.py) ... [?25l- done
[?25hRequirement already satisfied: mpmath>=0.19 in /opt/miniconda3/envs/testbed/lib/python3.9/site-packages (from sympy==1.5.1) (1.3.0)
Installing collected packages: sympy
  Attempting uninstall: sympy
    Found existing installation: sympy 1.5.1
    Uninstalling sympy-1.5.1:
      Successfully uninstalled sympy-1.5.1
[33m  DEPRECATION: Legacy editable install of sympy==1.5.1 from file:///testbed (setup.py develop) is deprecated. pip 25.0 will enforce this behaviour change. A possible replacement is to add a pyproject.toml or enable --use-pep517, and use setuptools >= 64. If the resulting installation is not behaving as expected, try using --config-settings editable_mode=compat. Please consult the setuptools documentation for more information. Discussion can be found at https://github.com/pypa/pip/issues/11457[0m[33m
[0m  Running setup.py develop for sympy
Successfully installed sympy
[33mWARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager, possibly rendering your system unusable.It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv. Use the --root-user-action option if you know what you are doing and want to suppress this warning.[0m[33m

2025-10-06 08:50:34,082 - thread-139660780025408.app.lang_graph.nodes.issue_bug_reproduction_context_message_node - DEBUG - Sending query to context provider subgraph:
Issue title:
Incorrect parenthesizing of Subs

Issue description: 
Here is an example.
```python
>>> from sympy import Subs
>>> from sympy.abc import x,y
>>> 3*Subs(-x+y, (x,),(1,))
```
LaTeX printing of this gives:  
```python
'3 \\left. - x + y \\right|_{\\substack{ x=1 }}'
```

![image](https://quicklatex.com/cache3/76/ql_9672fd7e62c909ff3d9ac8543c2e2576_l3.png)


It would be better to be parenthesized to:  
```python
'3 \\left. \\left(- x + y\\right) \\right|_{\\substack{ x=1 }}'
```

![image](https://quicklatex.com/cache3/bf/ql_936ffdb876e784206d4c54bb93d28dbf_l3.png)


Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-10-06 08:50:34,082 - thread-139660780025408.app.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Enter context retrieval subgraph
2025-10-06 08:50:34,083 - thread-139660780025408.app.lang_graph.nodes.context_query_message_node - DEBUG - Sending query to ContextProviderNode:
content='Issue title:\nIncorrect parenthesizing of Subs\n\nIssue description: \nHere is an example.\n```python\n>>> from sympy import Subs\n>>> from sympy.abc import x,y\n>>> 3*Subs(-x+y, (x,),(1,))\n```\nLaTeX printing of this gives:  \n```python\n\'3 \\\\left. - x + y \\\\right|_{\\\\substack{ x=1 }}\'\n```\n\n![image](https://quicklatex.com/cache3/76/ql_9672fd7e62c909ff3d9ac8543c2e2576_l3.png)\n\n\nIt would be better to be parenthesized to:  \n```python\n\'3 \\\\left. \\\\left(- x + y\\\\right) \\\\right|_{\\\\substack{ x=1 }}\'\n```\n\n![image](https://quicklatex.com/cache3/bf/ql_936ffdb876e784206d4c54bb93d28dbf_l3.png)\n\n\nIssue comments:\n\n\nOBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,\nincluding ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.\n\n<reasoning>\n1. Analyze bug characteristics:\n   - Core functionality being tested\n   - Input parameters and configurations\n   - Expected error conditions\n   - Environmental dependencies\n\n2. Search requirements:\n   - Required imports and dependencies\n   - Test files exercising similar functionality\n   - Mock/fixture setup patterns\n   - Assertion styles\n   - Error handling tests\n\n3. Focus areas:\n   - All necessary imports (standard library, testing frameworks, mocking utilities)\n   - Dependencies and third-party packages\n   - Test setup and teardown\n   - Mock object configuration\n   - Network/external service simulation\n   - Error condition verification\n</reasoning>\n\nREQUIREMENTS:\n- Return 5 complete, self-contained test cases most similar to bug scenario\n- Must include ALL necessary imports at the start of each test file\n- Must include full test method implementation\n- Must include ALL mock/fixture setup\n- Must include helper functions used by test\n- Must preserve exact file paths and line numbers\n\n<examples>\n<example id="database-timeout">\n<bug>\ndb.execute("SELECT * FROM users").fetchall() \nraises ConnectionTimeout when load is high\n</bug>\n\n<ideal_test_match>\n# File: tests/test_database.py\nimport pytest\nfrom unittest.mock import Mock, patch\nfrom database.exceptions import ConnectionTimeout\nfrom database.models import QueryResult\nfrom database.client import DatabaseClient\n\nclass TestDatabaseTimeout:\n    @pytest.fixture\n    def mock_db_connection(self):\n        conn = Mock()\n        conn.execute.side_effect = [\n            ConnectionTimeout("Connection timed out"),\n            QueryResult(["user1", "user2"])  # Second try succeeds\n        ]\n        return conn\n        \n    def test_handle_timeout_during_query(self, mock_db_connection):\n        # Complete test showing timeout scenario\n        # Including retry logic verification\n        # With all necessary assertions\n</ideal_test_match>\n</example>\n\n<example id="file-permission">\n<bug>\nFileProcessor(\'/root/data.txt\').process() \nfails with PermissionError\n</bug>\n\n<ideal_test_match>\n# File: tests/test_file_processor.py\nimport os\nimport pytest\nfrom unittest.mock import patch, mock_open\nfrom file_processor import FileProcessor\nfrom file_processor.exceptions import ProcessingError\n\nclass TestFilePermissions:\n    @patch(\'os.access\')\n    @patch(\'builtins.open\')\n    def test_file_permission_denied(self, mock_open, mock_access):\n        # Full test setup with mocked file system\n        # Permission denial simulation\n        # Error handling verification\n</ideal_test_match>\n</example>\n\nSearch priority:\n1. Tests of exact same functionality (including import patterns)\n2. Tests with similar error conditions\n3. Tests with comparable mocking patterns\n4. Tests demonstrating similar assertions\n\nFind the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.\n' additional_kwargs={} response_metadata={}
2025-10-06 08:50:40,077 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I have identified that the issue is related to the LaTeX printing of `Subs` objects in SymPy. I will focus my search on the test file `sympy/printing/tests/test_latex.py`, as it is the most relevant location for tests related to LaTeX printing. My plan is to look for existing tests that handle `Subs` and other symbolic expressions to find examples of how parenthesizing is handled in similar situations. This will help in understanding the current testing practices and identifying relevant test cases.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"text": "Subs", "relative_path": "sympy/printing/tests/test_latex.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 20632, 'candidates_token_count': 140, 'total_token_count': 21106, 'prompt_tokens_details': [{'modality': 1, 'token_count': 20632}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 140}], 'thoughts_token_count': 334, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.29856316702706476, 'model_name': 'gemini-2.5-pro'} id='run--d20d6b56-b3ff-4737-97ad-3cb46dec8ca9-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'Subs', 'relative_path': 'sympy/printing/tests/test_latex.py'}, 'id': 'e0e8ec8d-c9ad-430c-b9ed-300b8b3cb510', 'type': 'tool_call'}] usage_metadata={'input_tokens': 20632, 'output_tokens': 140, 'total_tokens': 21106, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 334}}
2025-10-06 08:50:45,095 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content="I've identified a promising test file, `sympy/printing/tests/test_latex.py`, which appears to contain test cases relevant to the issue of LaTeX printing of `Subs` objects. My initial search confirmed the presence of a `test_latex_subs` function within this file, indicating it's a strong candidate for containing the types of tests needed. To gather more comprehensive context, I will now read the entire file to analyze all the existing tests and select the five most relevant examples that demonstrate how SymPy handles LaTeX printing of symbolic expressions, particularly those involving substitutions and parenthesizing. This will help in understanding the current testing practices and provide a solid foundation for addressing the reported bug." additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "sympy/printing/tests/test_latex.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 21479, 'candidates_token_count': 170, 'total_token_count': 21796, 'cached_content_token_count': 19606, 'prompt_tokens_details': [{'modality': 1, 'token_count': 21479}], 'cache_tokens_details': [{'modality': 1, 'token_count': 19606}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 170}], 'thoughts_token_count': 147}, 'finish_reason': 'STOP', 'avg_logprobs': -0.24288711547851563, 'model_name': 'gemini-2.5-pro'} id='run--540ce05c-3e46-4c82-8d61-bdfb13b3484a-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'sympy/printing/tests/test_latex.py'}, 'id': 'a5a56fde-8101-4291-82ee-a0ab1f54faa2', 'type': 'tool_call'}] usage_metadata={'input_tokens': 21479, 'output_tokens': 170, 'total_tokens': 21796, 'input_token_details': {'cache_read': 19606}, 'output_token_details': {'reasoning': 147}}
2025-10-06 08:52:18,649 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I have analyzed the issue concerning the incorrect parenthesizing of `Subs` objects in LaTeX printing and have identified five relevant test cases from `sympy/printing/tests/test_latex.py`. These test cases demonstrate how SymPy handles similar situations involving multiplication and composite expressions, which is central to the reported bug. By examining these tests, I can better understand the expected behavior and existing testing practices for parenthesizing in LaTeX output. The selected tests cover matrix expressions, multiplication with negative terms, powers of sums, and vector expressions, all of which provide valuable context for addressing the `Subs` printing issue.\n\n<execute_bash>\necho "I have identified that the issue is related to the LaTeX printing of \\`Subs\\` objects in SymPy. I will focus my search on the test file \\`sympy/printing/tests/test_latex.py\\`, as it is the most relevant location for tests related to LaTeX printing. My plan is to look for existing tests that handle \\`Subs\\` and other symbolic expressions to find examples of how parenthesizing is handled in similar situations. This will help in understanding the current testing practices and identifying relevant test cases."\n</execute_bash>\n### Function Call\n```\ndefault_api.find_ast_node_with_text_in_file_with_relative_path(relative_path=\'sympy/printing/tests/test_latex.py\', text=\'Subs\')\n```\n<execute_bash>\necho "I\'ve identified a promising test file, \\`sympy/printing/tests/test_latex.py\\`, which appears to contain test cases relevant to the issue of LaTeX printing of \\`Subs\\` objects. My initial search confirmed the presence of a \\`test_latex_subs\\` function within this file, indicating it\'s a strong candidate for containing the types of tests needed. To gather more comprehensive context, I will now read the entire file to analyze all the existing tests and select the five most relevant examples that demonstrate how SymPy handles LaTeX printing of symbolic expressions, particularly those involving substitutions and parenthesizing. This will help in understanding the current testing practices and provide a solid foundation for addressing the reported bug."\n</execute_bash>\n### Function Call\n```\ndefault_api.read_file_with_knowledge_graph_data(relative_path=\'sympy/printing/tests/test_latex.py\')\n```\n# File: sympy/printing/tests/test_latex.py\n```python\nfrom sympy import (\n    Add, Abs, Chi, Ci, CosineTransform, Dict, Ei, Eq, FallingFactorial,\n    FiniteSet, Float, FourierTransform, Function, Indexed, IndexedBase, Integral,\n    Interval, InverseCosineTransform, InverseFourierTransform, Derivative,\n    InverseLaplaceTransform, InverseMellinTransform, InverseSineTransform,\n    Lambda, LaplaceTransform, Limit, Matrix, Max, MellinTransform, Min, Mul,\n    Order, Piecewise, Poly, ring, field, ZZ, Pow, Product, Range, Rational,\n    RisingFactorial, rootof, RootSum, S, Shi, Si, SineTransform, Subs,\n    Sum, Symbol, ImageSet, Tuple, Ynm, Znm, arg, asin, acsc, Mod,\n    assoc_laguerre, assoc_legendre, beta, binomial, catalan, ceiling, Complement,\n    chebyshevt, chebyshevu, conjugate, cot, coth, diff, dirichlet_eta, euler,\n    exp, expint, factorial, factorial2, floor, gamma, gegenbauer, hermite,\n    hyper, im, jacobi, laguerre, legendre, lerchphi, log, frac,\n    meijerg, oo, polar_lift, polylog, re, root, sin, sqrt, symbols,\n    uppergamma, zeta, subfactorial, totient, elliptic_k, elliptic_f,\n    elliptic_e, elliptic_pi, cos, tan, Wild, true, false, Equivalent, Not,\n    Contains, divisor_sigma, SeqPer, SeqFormula,\n    SeqAdd, SeqMul, fourier_series, pi, ConditionSet, ComplexRegion, fps,\n    AccumBounds, reduced_totient, primenu, primeomega, SingularityFunction,\n    stieltjes, mathieuc, mathieus, mathieucprime, mathieusprime,\n    UnevaluatedExpr, Quaternion, I, KroneckerProduct, LambertW)\n\nfrom sympy.ntheory.factor_ import udivisor_sigma\n\nfrom sympy.abc import mu, tau\nfrom sympy.printing.latex import (latex, translate, greek_letters_set,\n                                  tex_greek_dictionary, multiline_latex)\nfrom sympy.tensor.array import (ImmutableDenseNDimArray,\n                                ImmutableSparseNDimArray,\n                                MutableSparseNDimArray,\n                                MutableDenseNDimArray,\n                                tensorproduct)\nfrom sympy.utilities.pytest import XFAIL, raises\nfrom sympy.functions import DiracDelta, Heaviside, KroneckerDelta, LeviCivita\nfrom sympy.functions.combinatorial.numbers import bernoulli, bell, lucas, \\\n    fibonacci, tribonacci\nfrom sympy.logic import Implies\nfrom sympy.logic.boolalg import And, Or, Xor\nfrom sympy.physics.quantum import Commutator, Operator\nfrom sympy.physics.units import degree, radian, kg, meter, gibibyte, microgram, second\nfrom sympy.core.trace import Tr\nfrom sympy.core.compatibility import range\nfrom sympy.combinatorics.permutations import Cycle, Permutation\nfrom sympy import MatrixSymbol, ln\nfrom sympy.vector import CoordSys3D, Cross, Curl, Dot, Divergence, Gradient, Laplacian\nfrom sympy.sets.setexpr import SetExpr\nfrom sympy.sets.sets import \\\n    Union, Intersection, Complement, SymmetricDifference, ProductSet\n\nimport sympy as sym\n\n\nclass lowergamma(sym.lowergamma):\n    pass   # testing notation inheritance by a subclass with same name\n\n\nx, y, z, t, a, b, c = symbols(\'x y z t a b c\')\nk, m, n = symbols(\'k m n\', integer=True)\n\n\ndef test_latex_subs():\n    assert latex(Subs(x*y, (\n        x, y), (1, 2))) == r\'\\left. x y \\right|_{\\substack{ x=1\\\\ y=2 }}\'\n\n```\n\n# File: sympy/printing/tests/test_latex.py\n```python\nfrom sympy import (\n    Add, Abs, Chi, Ci, CosineTransform, Dict, Ei, Eq, FallingFactorial,\n    FiniteSet, Float, FourierTransform, Function, Indexed, IndexedBase, Integral,\n    Interval, InverseCosineTransform, InverseFourierTransform, Derivative,\n    InverseLaplaceTransform, InverseMellinTransform, InverseSineTransform,\n    Lambda, LaplaceTransform, Limit, Matrix, Max, MellinTransform, Min, Mul,\n    Order, Piecewise, Poly, ring, field, ZZ, Pow, Product, Range, Rational,\n    RisingFactorial, rootof, RootSum, S, Shi, Si, SineTransform, Subs,\n    Sum, Symbol, ImageSet, Tuple, Ynm, Znm, arg, asin, acsc, Mod,\n    assoc_laguerre, assoc_legendre, beta, binomial, catalan, ceiling, Complement,\n    chebyshevt, chebyshevu, conjugate, cot, coth, diff, dirichlet_eta, euler,\n    exp, expint, factorial, factorial2, floor, gamma, gegenbauer, hermite,\n    hyper, im, jacobi, laguerre, legendre, lerchphi, log, frac,\n    meijerg, oo, polar_lift, polylog, re, root, sin, sqrt, symbols,\n    uppergamma, zeta, subfactorial, totient, elliptic_k, elliptic_f,\n    elliptic_e, elliptic_pi, cos, tan, Wild, true, false, Equivalent, Not,\n    Contains, divisor_sigma, SeqPer, SeqFormula,\n    SeqAdd, SeqMul, fourier_series, pi, ConditionSet, ComplexRegion, fps,\n    AccumBounds, reduced_totient, primenu, primeomega, SingularityFunction,\n    stieltjes, mathieuc, mathieus, mathieucprime, mathieusprime,\n    UnevaluatedExpr, Quaternion, I, KroneckerProduct, LambertW)\n\nfrom sympy.ntheory.factor_ import udivisor_sigma\n\nfrom sympy.abc import mu, tau\nfrom sympy.printing.latex import (latex, translate, greek_letters_set,\n                                  tex_greek_dictionary, multiline_latex)\nfrom sympy.tensor.array import (ImmutableDenseNDimArray,\n                                ImmutableSparseNDimArray,\n                                MutableSparseNDimArray,\n                                MutableDenseNDimArray,\n                                tensorproduct)\nfrom sympy.utilities.pytest import XFAIL, raises\nfrom sympy.functions import DiracDelta, Heaviside, KroneckerDelta, LeviCivita\nfrom sympy.functions.combinatorial.numbers import bernoulli, bell, lucas, \\\n    fibonacci, tribonacci\nfrom sympy.logic import Implies\nfrom sympy.logic.boolalg import And, Or, Xor\nfrom sympy.physics.quantum import Commutator, Operator\nfrom sympy.physics.units import degree, radian, kg, meter, gibibyte, microgram, second\nfrom sympy.core.trace import Tr\nfrom sympy.core.compatibility import range\nfrom sympy.combinatorics.permutations import Cycle, Permutation\nfrom sympy import MatrixSymbol, ln\nfrom sympy.vector import CoordSys3D, Cross, Curl, Dot, Divergence, Gradient, Laplacian\nfrom sympy.sets.setexpr import SetExpr\nfrom sympy.sets.sets import \\\n    Union, Intersection, Complement, SymmetricDifference, ProductSet\n\nimport sympy as sym\n\n\nclass lowergamma(sym.lowergamma):\n    pass   # testing notation inheritance by a subclass with same name\n\n\nx, y, z, t, a, b, c = symbols(\'x y z t a b c\')\nk, m, n = symbols(\'k m n\', integer=True)\n\n\ndef test_latex_Matrix_expressions():\n    A = MatrixSymbol("A", n, m)\n    B = MatrixSymbol("B", m, k)\n    C = MatrixSymbol("C", n, m)\n    D = MatrixSymbol("D", n, m)\n\n    assert latex(A*B) == "A B"\n    assert latex(A*(C.T + C)) == "A \\\\left(C^{T} + C\\\\right)"\n    assert latex(A*C.T*D) == "A C^{T} D"\n    assert latex(C + D) == "C + D"\n    assert latex(A*(C+D)) == "A \\\\left(C + D\\\\right)"\n    assert latex((C+D)*A.T) == "\\\\left(C + D\\\\right) A^{T}"\n\n```\n\n# File: sympy/printing/tests/test_latex.py\n```python\nfrom sympy import (\n    Add, Abs, Chi, Ci, CosineTransform, Dict, Ei, Eq, FallingFactorial,\n    FiniteSet, Float, FourierTransform, Function, Indexed, IndexedBase, Integral,\n    Interval, InverseCosineTransform, InverseFourierTransform, Derivative,\n    InverseLaplaceTransform, InverseMellinTransform, InverseSineTransform,\n    Lambda, LaplaceTransform, Limit, Matrix, Max, MellinTransform, Min, Mul,\n    Order, Piecewise, Poly, ring, field, ZZ, Pow, Product, Range, Rational,\n    RisingFactorial, rootof, RootSum, S, Shi, Si, SineTransform, Subs,\n    Sum, Symbol, ImageSet, Tuple, Ynm, Znm, arg, asin, acsc, Mod,\n    assoc_laguerre, assoc_legendre, beta, binomial, catalan, ceiling, Complement,\n    chebyshevt, chebyshevu, conjugate, cot, coth, diff, dirichlet_eta, euler,\n    exp, expint, factorial, factorial2, floor, gamma, gegenbauer, hermite,\n    hyper, im, jacobi, laguerre, legendre, lerchphi, log, frac,\n    meijerg, oo, polar_lift, polylog, re, root, sin, sqrt, symbols,\n    uppergamma, zeta, subfactorial, totient, elliptic_k, elliptic_f,\n    elliptic_e, elliptic_pi, cos, tan, Wild, true, false, Equivalent, Not,\n    Contains, divisor_sigma, SeqPer, SeqFormula,\n    SeqAdd, SeqMul, fourier_series, pi, ConditionSet, ComplexRegion, fps,\n    AccumBounds, reduced_totient, primenu, primeomega, SingularityFunction,\n    stieltjes, mathieuc, mathieus, mathieucprime, mathieusprime,\n    UnevaluatedExpr, Quaternion, I, KroneckerProduct, LambertW)\n\nfrom sympy.ntheory.factor_ import udivisor_sigma\n\nfrom sympy.abc import mu, tau\nfrom sympy.printing.latex import (latex, translate, greek_letters_set,\n                                  tex_greek_dictionary, multiline_latex)\nfrom sympy.tensor.array import (ImmutableDenseNDimArray,\n                                ImmutableSparseNDimArray,\n                                MutableSparseNDimArray,\n                                MutableDenseNDimArray,\n                                tensorproduct)\nfrom sympy.utilities.pytest import XFAIL, raises\nfrom sympy.functions import DiracDelta, Heaviside, KroneckerDelta, LeviCivita\nfrom sympy.functions.combinatorial.numbers import bernoulli, bell, lucas, \\\n    fibonacci, tribonacci\nfrom sympy.logic import Implies\nfrom sympy.logic.boolalg import And, Or, Xor\nfrom sympy.physics.quantum import Commutator, Operator\nfrom sympy.physics.units import degree, radian, kg, meter, gibibyte, microgram, second\nfrom sympy.core.trace import Tr\nfrom sympy.core.compatibility import range\nfrom sympy.combinatorics.permutations import Cycle, Permutation\nfrom sympy import MatrixSymbol, ln\nfrom sympy.vector import CoordSys3D, Cross, Curl, Dot, Divergence, Gradient, Laplacian\nfrom sympy.sets.setexpr import SetExpr\nfrom sympy.sets.sets import \\\n    Union, Intersection, Complement, SymmetricDifference, ProductSet\n\nimport sympy as sym\n\n\nclass lowergamma(sym.lowergamma):\n    pass   # testing notation inheritance by a subclass with same name\n\n\nx, y, z, t, a, b, c = symbols(\'x y z t a b c\')\nk, m, n = symbols(\'k m n\', integer=True)\n\n\ndef test_latex_vector_expressions():\n    A = CoordSys3D(\'A\')\n\n    assert latex(Cross(A.i, A.j*A.x*3+A.k)) == \\\n        r"\\mathbf{\\hat{i}_{A}} \\times \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}} + \\mathbf{\\hat{k}_{A}}\\right)"\n    assert latex(Cross(A.i, A.j)) == \\\n        r"\\mathbf{\\hat{i}_{A}} \\times \\mathbf{\\hat{j}_{A}}"\n    assert latex(x*Cross(A.i, A.j)) == \\\n        r"x \\left(\\mathbf{\\hat{i}_{A}} \\times \\mathbf{\\hat{j}_{A}}\\right)"\n    assert latex(Cross(x*A.i, A.j)) == \\\n        r\'- \\mathbf{\\hat{j}_{A}} \\times \\left((x)\\mathbf{\\hat{i}_{A}}\\right)\\\'\n\n    assert latex(Curl(3*A.x*A.j)) == \\\n        r"\\nabla\\times \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)"\n    assert latex(Curl(3*A.x*A.j+A.i)) == \\\n        r"\\nabla\\times \\left(\\mathbf{\\hat{i}_{A}} + (3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)"\n    assert latex(Curl(3*x*A.x*A.j)) == \\\n        r"\\nabla\\times \\left((3 \\mathbf{{x}_{A}} x)\\mathbf{\\hat{j}_{A}}\\right)"\n    assert latex(x*Curl(3*A.x*A.j)) == \\\n        r"x \\left(\\nabla\\times \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)\\right)"\n\n    assert latex(Divergence(3*A.x*A.j+A.i)) == \\\n        r"\\nabla\\cdot \\left(\\mathbf{\\hat{i}_{A}} + (3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)"\n    assert latex(Divergence(3*A.x*A.j)) == \\\n        r"\\nabla\\cdot \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)"\n    assert latex(x*Divergence(3*A.x*A.j)) == \\\n        r"x \\left(\\nabla\\cdot \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)\\right)"\n\n    assert latex(Dot(A.i, A.j*A.x*3+A.k)) == \\\n        r"\\mathbf{\\hat{i}_{A}} \\cdot \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}} + \\mathbf{\\hat{k}_{A}}\\right)"\n    assert latex(Dot(A.i, A.j)) == \\\n        r"\\mathbf{\\hat{i}_{A}} \\cdot \\mathbf{\\hat{j}_{A}}"\n    assert latex(Dot(x*A.i, A.j)) == \\\n        r"\\mathbf{\\hat{j}_{A}} \\cdot \\left((x)\\mathbf{\\hat{i}_{A}}\\right)"\n    assert latex(x*Dot(A.i, A.j)) == \\\n        r"x \\left(\\mathbf{\\hat{i}_{A}} \\cdot \\mathbf{\\hat{j}_{A}}\\right)"\n\n    assert latex(Gradient(A.x)) == r"\\nabla \\mathbf{{x}_{A}}"\n    assert latex(Gradient(A.x + 3*A.y)) == \\\n        r"\\nabla \\left(\\mathbf{{x}_{A}} + 3 \\mathbf{{y}_{A}}\\right)"\n    assert latex(x*Gradient(A.x)) == r"x \\left(\\nabla \\mathbf{{x}_{A}}\\right)"\n    assert latex(Gradient(x*A.x)) == r"\\nabla \\left(\\mathbf{{x}_{A}} x\\right)"\n\n    assert latex(Laplacian(A.x)) == r"\\triangle \\mathbf{{x}_{A}}"\n    assert latex(Laplacian(A.x + 3*A.y)) == \\\n        r"\\triangle \\left(\\mathbf{{x}_{A}} + 3 \\mathbf{{y}_{A}}\\right)"\n    assert latex(x*Laplacian(A.x)) == r"x \\left(\\triangle \\mathbf{{x}_{A}}\\right)"\n    assert latex(Laplacian(x*A.x)) == r"\\triangle \\left(\\mathbf{{x}_{A}} x\\right)"\n\n```\n\n# File: sympy/printing/tests/test_latex.py\n```python\nfrom sympy import (\n    Add, Abs, Chi, Ci, CosineTransform, Dict, Ei, Eq, FallingFactorial,\n    FiniteSet, Float, FourierTransform, Function, Indexed, IndexedBase, Integral,\n    Interval, InverseCosineTransform, InverseFourierTransform, Derivative,\n    InverseLaplaceTransform, InverseMellinTransform, InverseSineTransform,\n    Lambda, LaplaceTransform, Limit, Matrix, Max, MellinTransform, Min, Mul,\n    Order, Piecewise, Poly, ring, field, ZZ, Pow, Product, Range, Rational,\n    RisingFactorial, rootof, RootSum, S, Shi, Si, SineTransform, Subs,\n    Sum, Symbol, ImageSet, Tuple, Ynm, Znm, arg, asin, acsc, Mod,\n    assoc_laguerre, assoc_legendre, beta, binomial, catalan, ceiling, Complement,\n    chebyshevt, chebyshevu, conjugate, cot, coth, diff, dirichlet_eta, euler,\n    exp, expint, factorial, factorial2, floor, gamma, gegenbauer, hermite,\n    hyper, im, jacobi, laguerre, legendre, lerchphi, log, frac,\n    meijerg, oo, polar_lift, polylog, re, root, sin, sqrt, symbols,\n    uppergamma, zeta, subfactorial, totient, elliptic_k, elliptic_f,\n    elliptic_e, elliptic_pi, cos, tan, Wild, true, false, Equivalent, Not,\n    Contains, divisor_sigma, SeqPer, SeqFormula,\n    SeqAdd, SeqMul, fourier_series, pi, ConditionSet, ComplexRegion, fps,\n    AccumBounds, reduced_totient, primenu, primeomega, SingularityFunction,\n    stieltjes, mathieuc, mathieus, mathieucprime, mathieusprime,\n    UnevaluatedExpr, Quaternion, I, KroneckerProduct, LambertW)\n\nfrom sympy.ntheory.factor_ import udivisor_sigma\n\nfrom sympy.abc import mu, tau\nfrom sympy.printing.latex import (latex, translate, greek_letters_set,\n                                  tex_greek_dictionary, multiline_latex)\nfrom sympy.tensor.array import (ImmutableDenseNDimArray,\n                                ImmutableSparseNDimArray,\n                                MutableSparseNDimArray,\n                                MutableDenseNDimArray,\n                                tensorproduct)\nfrom sympy.utilities.pytest import XFAIL, raises\nfrom sympy.functions import DiracDelta, Heaviside, KroneckerDelta, LeviCivita\nfrom sympy.functions.combinatorial.numbers import bernoulli, bell, lucas, \\\n    fibonacci, tribonacci\nfrom sympy.logic import Implies\nfrom sympy.logic.boolalg import And, Or, Xor\nfrom sympy.physics.quantum import Commutator, Operator\nfrom sympy.physics.units import degree, radian, kg, meter, gibibyte, microgram, second\nfrom sympy.core.trace import Tr\nfrom sympy.core.compatibility import range\nfrom sympy.combinatorics.permutations import Cycle, Permutation\nfrom sympy import MatrixSymbol, ln\nfrom sympy.vector import CoordSys3D, Cross, Curl, Dot, Divergence, Gradient, Laplacian\nfrom sympy.sets.setexpr import SetExpr\nfrom sympy.sets.sets import \\\n    Union, Intersection, Complement, SymmetricDifference, ProductSet\n\nimport sympy as sym\n\n\nclass lowergamma(sym.lowergamma):\n    pass   # testing notation inheritance by a subclass with same name\n\n\nx, y, z, t, a, b, c = symbols(\'x y z t a b c\')\nk, m, n = symbols(\'k m n\', integer=True)\n\n\ndef test_latex_Mul():\n    assert latex(-x) == "-x"\n    assert latex(-2*x) == "- 2 x"\n    assert latex(-x*y) == "- x y"\n    assert latex(-x*y, mul_symbol=\'dot\') == r"- x \\cdot y"\n    assert latex(x*(-y)) == "- x y"\n    assert latex(x/(-y)) == r"- \\frac{x}{y}"\n    assert latex(x/(-y-z)) == r"\\frac{x}{- y - z}"\n    assert latex(Mul(2, 3, evaluate=False)) == r"2 \\cdot 3"\n    assert latex(Mul(x, y, z, evaluate=False)) == r"x y z"\n    assert latex(Mul(x, -y, evaluate=False)) == r"x \\left(- y\\right)"\n    assert latex(Mul(2, -3, evaluate=False)) == r"2 \\left(-3\\right)"\n    assert latex(Mul(Rational(1, 2), Rational(1, 3), evaluate=False)) == \\\n        r"\\frac{1}{2} \\cdot \\frac{1}{3}"\n    assert latex(Mul(Rational(1, 2), -Rational(1, 3), evaluate=False)) == \\\n        r"\\frac{1}{2} \\left(- \\frac{1}{3}\\right)"\n\n```\n\n# File: sympy/printing/tests/test_latex.py\n```python\nfrom sympy import (\n    Add, Abs, Chi, Ci, CosineTransform, Dict, Ei, Eq, FallingFactorial,\n    FiniteSet, Float, FourierTransform, Function, Indexed, IndexedBase, Integral,\n    Interval, InverseCosineTransform, InverseFourierTransform, Derivative,\n    InverseLaplaceTransform, InverseMellinTransform, InverseSineTransform,\n    Lambda, LaplaceTransform, Limit, Matrix, Max, MellinTransform, Min, Mul,\n    Order, Piecewise, Poly, ring, field, ZZ, Pow, Product, Range, Rational,\n    RisingFactorial, rootof, RootSum, S, Shi, Si, SineTransform, Subs,\n    Sum, Symbol, ImageSet, Tuple, Ynm, Znm, arg, asin, acsc, Mod,\n    assoc_laguerre, assoc_legendre, beta, binomial, catalan, ceiling, Complement,\n    chebyshevt, chebyshevu, conjugate, cot, coth, diff, dirichlet_eta, euler,\n    exp, expint, factorial, factorial2, floor, gamma, gegenbauer, hermite,\n    hyper, im, jacobi, laguerre, legendre, lerchphi, log, frac,\n    meijerg, oo, polar_lift, polylog, re, root, sin, sqrt, symbols,\n    uppergamma, zeta, subfactorial, totient, elliptic_k, elliptic_f,\n    elliptic_e, elliptic_pi, cos, tan, Wild, true, false, Equivalent, Not,\n    Contains, divisor_sigma, SeqPer, SeqFormula,\n    SeqAdd, SeqMul, fourier_series, pi, ConditionSet, ComplexRegion, fps,\n    AccumBounds, reduced_totient, primenu, primeomega, SingularityFunction,\n    stieltjes, mathieuc, mathieus, mathieucprime, mathieusprime,\n    UnevaluatedExpr, Quaternion, I, KroneckerProduct, LambertW)\n\nfrom sympy.ntheory.factor_ import udivisor_sigma\n\nfrom sympy.abc import mu, tau\nfrom sympy.printing.latex import (latex, translate, greek_letters_set,\n                                  tex_greek_dictionary, multiline_latex)\nfrom sympy.tensor.array import (ImmutableDenseNDimArray,\n                                ImmutableSparseNDimArray,\n                                MutableSparseNDimArray,\n                                MutableDenseNDimArray,\n                                tensorproduct)\nfrom sympy.utilities.pytest import XFAIL, raises\nfrom sympy.functions import DiracDelta, Heaviside, KroneckerDelta, LeviCivita\nfrom sympy.functions.combinatorial.numbers import bernoulli, bell, lucas, \\\n    fibonacci, tribonacci\nfrom sympy.logic import Implies\nfrom sympy.logic.boolalg import And, Or, Xor\nfrom sympy.physics.quantum import Commutator, Operator\nfrom sympy.physics.units import degree, radian, kg, meter, gibibyte, microgram, second\nfrom sympy.core.trace import Tr\nfrom sympy.core.compatibility import range\nfrom sympy.combinatorics.permutations import Cycle, Permutation\nfrom sympy import MatrixSymbol, ln\nfrom sympy.vector import CoordSys3D, Cross, Curl, Dot, Divergence, Gradient, Laplacian\nfrom sympy.sets.setexpr import SetExpr\nfrom sympy.sets.sets import \\\n    Union, Intersection, Complement, SymmetricDifference, ProductSet\n\nimport sympy as sym\n\n\nclass lowergamma(sym.lowergamma):\n    pass   # testing notation inheritance by a subclass with same name\n\n\nx, y, z, t, a, b, c = symbols(\'x y z t a b c\')\nk, m, n = symbols(\'k m n\', integer=True)\n\n\ndef test_latex_Pow():\n    assert latex(x**-1) == r"\\frac{1}{x}"\n    assert latex(x**-2) == r"\\frac{1}{x^{2}}"\n    assert latex(x**Rational(1, 2)) == r"\\sqrt{x}"\n    assert latex(x**-Rational(1, 2)) == r"\\frac{1}{\\sqrt{x}}"\n    assert latex(x**-y) == "x^{- y}"\n    assert latex(x**(-y+1)) == "x^{- y + 1}"\n    assert latex(x**(-y*z)) == "x^{- y z}"\n    assert latex((x+y)**-1) == r"\\frac{1}{x + y}"\n    assert latex((x+y)**-2) == r"\\frac{1}{\\left(x + y\\right)^{2}}"\n    assert latex((x+y)**(-k)) == r"\\left(x + y\\right)^{- k}"\n    assert latex(x**y**z) == "x^{y^{z}}"\n    assert latex((x**y)**z) == r"\\left(x^{y}\\right)^{z}"\n    # This is a formatting test, that bases with Add are parenthesized\n    assert latex((x+1)**2) == r"\\left(x + 1\\right)^{2}"\n\n```' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'citation_metadata': {'citations': [{'start_index': 8782, 'end_index': 9141, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 9024, 'end_index': 9347, 'uri': 'https://git.bluedynamics.net/kivy/mathqube/blob/2576c816880ef8a20e03d142a0a38f4ae64029cf/sympy/printing/tests/test_latex.py', 'title': '', 'license_': ''}, {'start_index': 9209, 'end_index': 9822, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 9784, 'end_index': 10336, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 10232, 'end_index': 10827, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 10739, 'end_index': 11058, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 10971, 'end_index': 11279, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 11188, 'end_index': 11583, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 14742, 'end_index': 17401, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 21466, 'end_index': 21829, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 21708, 'end_index': 22035, 'uri': 'https://git.bluedynamics.net/kivy/mathqube/blob/2576c816880ef8a20e03d142a0a38f4ae64029cf/sympy/printing/tests/test_latex.py', 'title': '', 'license_': ''}, {'start_index': 21897, 'end_index': 22510, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 22472, 'end_index': 23024, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 22920, 'end_index': 23515, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 23427, 'end_index': 23746, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 23659, 'end_index': 23967, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 23876, 'end_index': 24474, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 24669, 'end_index': 25032, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 24911, 'end_index': 25238, 'uri': 'https://git.bluedynamics.net/kivy/mathqube/blob/2576c816880ef8a20e03d142a0a38f4ae64029cf/sympy/printing/tests/test_latex.py', 'title': '', 'license_': ''}, {'start_index': 25100, 'end_index': 25713, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 25675, 'end_index': 26227, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 26123, 'end_index': 26718, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 26630, 'end_index': 26949, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 26862, 'end_index': 27170, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 27079, 'end_index': 27677, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 28195, 'end_index': 28558, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 28437, 'end_index': 28764, 'uri': 'https://git.bluedynamics.net/kivy/mathqube/blob/2576c816880ef8a20e03d142a0a38f4ae64029cf/sympy/printing/tests/test_latex.py', 'title': '', 'license_': ''}, {'start_index': 28626, 'end_index': 29239, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 29201, 'end_index': 29753, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 29649, 'end_index': 30244, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 30156, 'end_index': 30475, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 30388, 'end_index': 30696, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 30605, 'end_index': 31203, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 31202, 'end_index': 33861, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 33934, 'end_index': 34297, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 34176, 'end_index': 34503, 'uri': 'https://git.bluedynamics.net/kivy/mathqube/blob/2576c816880ef8a20e03d142a0a38f4ae64029cf/sympy/printing/tests/test_latex.py', 'title': '', 'license_': ''}, {'start_index': 34365, 'end_index': 34978, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 34940, 'end_index': 35492, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 35388, 'end_index': 35983, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 35895, 'end_index': 36214, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 36127, 'end_index': 36435, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 36344, 'end_index': 36942, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 37821, 'end_index': 38184, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 38063, 'end_index': 38390, 'uri': 'https://git.bluedynamics.net/kivy/mathqube/blob/2576c816880ef8a20e03d142a0a38f4ae64029cf/sympy/printing/tests/test_latex.py', 'title': '', 'license_': ''}, {'start_index': 38252, 'end_index': 38865, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 38827, 'end_index': 39379, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 39275, 'end_index': 39870, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 39782, 'end_index': 40101, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 40014, 'end_index': 40322, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}, {'start_index': 40231, 'end_index': 40829, 'uri': 'https://github.com/MaeZhao/GBS-Subgraph-Simulation', 'title': '', 'license_': ''}]}, 'usage_metadata': {'prompt_token_count': 33310, 'candidates_token_count': 6708, 'total_token_count': 46484, 'cached_content_token_count': 19439, 'prompt_tokens_details': [{'modality': 1, 'token_count': 33310}], 'cache_tokens_details': [{'modality': 1, 'token_count': 19439}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 6708}], 'thoughts_token_count': 6466}, 'finish_reason': 'STOP', 'avg_logprobs': -0.09547519854441525, 'model_name': 'gemini-2.5-pro'} id='run--46cdab46-fe92-4751-b9d1-1c0a49f55d57-0' usage_metadata={'input_tokens': 33310, 'output_tokens': 6708, 'total_tokens': 46484, 'input_token_details': {'cache_read': 19439}, 'output_token_details': {'reasoning': 6466}}
2025-10-06 08:52:18,650 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - INFO - Starting context extraction process
2025-10-06 08:52:18,650 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - DEBUG - This is the original user query:

--- BEGIN ORIGINAL QUERY ---
Issue title:
Incorrect parenthesizing of Subs

Issue description: 
Here is an example.
```python
>>> from sympy import Subs
>>> from sympy.abc import x,y
>>> 3*Subs(-x+y, (x,),(1,))
```
LaTeX printing of this gives:  
```python
'3 \\left. - x + y \\right|_{\\substack{ x=1 }}'
```

![image](https://quicklatex.com/cache3/76/ql_9672fd7e62c909ff3d9ac8543c2e2576_l3.png)


It would be better to be parenthesized to:  
```python
'3 \\left. \\left(- x + y\\right) \\right|_{\\substack{ x=1 }}'
```

![image](https://quicklatex.com/cache3/bf/ql_936ffdb876e784206d4c54bb93d28dbf_l3.png)


Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: sympy/printing/tests/test_latex.py
Line number range: 675 - 677
Content:
def test_latex_subs():
    assert latex(Subs(x*y, (
        x, y), (1, 2))) == r'\left. x y \right|_{\substack{ x=1\\ y=2 }}'

File: sympy/printing/tests/test_latex.py
Line number range: 1 - 500
Content:
1. from sympy import (
2.     Add, Abs, Chi, Ci, CosineTransform, Dict, Ei, Eq, FallingFactorial,
3.     FiniteSet, Float, FourierTransform, Function, Indexed, IndexedBase, Integral,
4.     Interval, InverseCosineTransform, InverseFourierTransform, Derivative,
5.     InverseLaplaceTransform, InverseMellinTransform, InverseSineTransform,
6.     Lambda, LaplaceTransform, Limit, Matrix, Max, MellinTransform, Min, Mul,
7.     Order, Piecewise, Poly, ring, field, ZZ, Pow, Product, Range, Rational,
8.     RisingFactorial, rootof, RootSum, S, Shi, Si, SineTransform, Subs,
9.     Sum, Symbol, ImageSet, Tuple, Ynm, Znm, arg, asin, acsc, Mod,
10.     assoc_laguerre, assoc_legendre, beta, binomial, catalan, ceiling, Complement,
11.     chebyshevt, chebyshevu, conjugate, cot, coth, diff, dirichlet_eta, euler,
12.     exp, expint, factorial, factorial2, floor, gamma, gegenbauer, hermite,
13.     hyper, im, jacobi, laguerre, legendre, lerchphi, log, frac,
14.     meijerg, oo, polar_lift, polylog, re, root, sin, sqrt, symbols,
15.     uppergamma, zeta, subfactorial, totient, elliptic_k, elliptic_f,
16.     elliptic_e, elliptic_pi, cos, tan, Wild, true, false, Equivalent, Not,
17.     Contains, divisor_sigma, SeqPer, SeqFormula,
18.     SeqAdd, SeqMul, fourier_series, pi, ConditionSet, ComplexRegion, fps,
19.     AccumBounds, reduced_totient, primenu, primeomega, SingularityFunction,
20.     stieltjes, mathieuc, mathieus, mathieucprime, mathieusprime,
21.     UnevaluatedExpr, Quaternion, I, KroneckerProduct, LambertW)
22. 
23. from sympy.ntheory.factor_ import udivisor_sigma
24. 
25. from sympy.abc import mu, tau
26. from sympy.printing.latex import (latex, translate, greek_letters_set,
27.                                   tex_greek_dictionary, multiline_latex)
28. from sympy.tensor.array import (ImmutableDenseNDimArray,
29.                                 ImmutableSparseNDimArray,
30.                                 MutableSparseNDimArray,
31.                                 MutableDenseNDimArray,
32.                                 tensorproduct)
33. from sympy.utilities.pytest import XFAIL, raises
34. from sympy.functions import DiracDelta, Heaviside, KroneckerDelta, LeviCivita
35. from sympy.functions.combinatorial.numbers import bernoulli, bell, lucas, \
36.     fibonacci, tribonacci
37. from sympy.logic import Implies
38. from sympy.logic.boolalg import And, Or, Xor
39. from sympy.physics.quantum import Commutator, Operator
40. from sympy.physics.units import degree, radian, kg, meter, gibibyte, microgram, second
41. from sympy.core.trace import Tr
42. from sympy.core.compatibility import range
43. from sympy.combinatorics.permutations import Cycle, Permutation
44. from sympy import MatrixSymbol, ln
45. from sympy.vector import CoordSys3D, Cross, Curl, Dot, Divergence, Gradient, Laplacian
46. from sympy.sets.setexpr import SetExpr
47. from sympy.sets.sets import \
48.     Union, Intersection, Complement, SymmetricDifference, ProductSet
49. 
50. import sympy as sym
51. 
52. 
53. class lowergamma(sym.lowergamma):
54.     pass   # testing notation inheritance by a subclass with same name
55. 
56. 
57. x, y, z, t, a, b, c = symbols('x y z t a b c')
58. k, m, n = symbols('k m n', integer=True)
59. 
60. 
61. def test_printmethod():
62.     class R(Abs):
63.         def _latex(self, printer):
64.             return "foo(%s)" % printer._print(self.args[0])
65.     assert latex(R(x)) == "foo(x)"
66. 
67.     class R(Abs):
68.         def _latex(self, printer):
69.             return "foo"
70.     assert latex(R(x)) == "foo"
71. 
72. 
73. def test_latex_basic():
74.     assert latex(1 + x) == "x + 1"
75.     assert latex(x**2) == "x^{2}"
76.     assert latex(x**(1 + x)) == "x^{x + 1}"
77.     assert latex(x**3 + x + 1 + x**2) == "x^{3} + x^{2} + x + 1"
78. 
79.     assert latex(2*x*y) == "2 x y"
80.     assert latex(2*x*y, mul_symbol='dot') == r"2 \cdot x \cdot y"
81.     assert latex(3*x**2*y, mul_symbol='\\,') == r"3\,x^{2}\,y"
82.     assert latex(1.5*3**x, mul_symbol='\\,') == r"1.5 \cdot 3^{x}"
83. 
84.     assert latex(1/x) == r"\frac{1}{x}"
85.     assert latex(1/x, fold_short_frac=True) == "1 / x"
86.     assert latex(-S(3)/2) == r"- \frac{3}{2}"
87.     assert latex(-S(3)/2, fold_short_frac=True) == r"- 3 / 2"
88.     assert latex(1/x**2) == r"\frac{1}{x^{2}}"
89.     assert latex(1/(x + y)/2) == r"\frac{1}{2 \left(x + y\right)}"
90.     assert latex(x/2) == r"\frac{x}{2}"
91.     assert latex(x/2, fold_short_frac=True) == "x / 2"
92.     assert latex((x + y)/(2*x)) == r"\frac{x + y}{2 x}"
93.     assert latex((x + y)/(2*x), fold_short_frac=True) == \
94.         r"\left(x + y\right) / 2 x"
95.     assert latex((x + y)/(2*x), long_frac_ratio=0) == \
96.         r"\frac{1}{2 x} \left(x + y\right)"
97.     assert latex((x + y)/x) == r"\frac{x + y}{x}"
98.     assert latex((x + y)/x, long_frac_ratio=3) == r"\frac{x + y}{x}"
99.     assert latex((2*sqrt(2)*x)/3) == r"\frac{2 \sqrt{2} x}{3}"
100.     assert latex((2*sqrt(2)*x)/3, long_frac_ratio=2) == \
101.         r"\frac{2 x}{3} \sqrt{2}"
102. 
103.     assert latex(2*Integral(x, x)/3) == r"\frac{2 \int x\, dx}{3}"
104.     assert latex(2*Integral(x, x)/3, fold_short_frac=True) == \
105.         r"\left(2 \int x\, dx\right) / 3"
106. 
107.     assert latex(sqrt(x)) == r"\sqrt{x}"
108.     assert latex(x**Rational(1, 3)) == r"\sqrt[3]{x}"
109.     assert latex(x**Rational(1, 3), root_notation=False) == r"x^{\frac{1}{3}}"
110.     assert latex(sqrt(x)**3) == r"x^{\frac{3}{2}}"
111.     assert latex(sqrt(x), itex=True) == r"\sqrt{x}"
112.     assert latex(x**Rational(1, 3), itex=True) == r"\root{3}{x}"
113.     assert latex(sqrt(x)**3, itex=True) == r"x^{\frac{3}{2}}"
114.     assert latex(x**Rational(3, 4)) == r"x^{\frac{3}{4}}"
115.     assert latex(x**Rational(3, 4), fold_frac_powers=True) == "x^{3/4}"
116.     assert latex((x + 1)**Rational(3, 4)) == \
117.         r"\left(x + 1\right)^{\frac{3}{4}}"
118.     assert latex((x + 1)**Rational(3, 4), fold_frac_powers=True) == \
119.         r"\left(x + 1\right)^{3/4}"
120. 
121.     assert latex(1.5e20*x) == r"1.5 \cdot 10^{20} x"
122.     assert latex(1.5e20*x, mul_symbol='dot') == r"1.5 \cdot 10^{20} \cdot x"
123.     assert latex(1.5e20*x, mul_symbol='times') == \
124.         r"1.5 \times 10^{20} \times x"
125. 
126.     assert latex(1/sin(x)) == r"\frac{1}{\sin{\left(x \right)}}"
127.     assert latex(sin(x)**-1) == r"\frac{1}{\sin{\left(x \right)}}"
128.     assert latex(sin(x)**Rational(3, 2)) == \
129.         r"\sin^{\frac{3}{2}}{\left(x \right)}"
130.     assert latex(sin(x)**Rational(3, 2), fold_frac_powers=True) == \
131.         r"\sin^{3/2}{\left(x \right)}"
132. 
133.     assert latex(~x) == r"\neg x"
134.     assert latex(x & y) == r"x \wedge y"
135.     assert latex(x & y & z) == r"x \wedge y \wedge z"
136.     assert latex(x | y) == r"x \vee y"
137.     assert latex(x | y | z) == r"x \vee y \vee z"
138.     assert latex((x & y) | z) == r"z \vee \left(x \wedge y\right)"
139.     assert latex(Implies(x, y)) == r"x \Rightarrow y"
140.     assert latex(~(x >> ~y)) == r"x \not\Rightarrow \neg y"
141.     assert latex(Implies(Or(x,y), z)) == r"\left(x \vee y\right) \Rightarrow z"
142.     assert latex(Implies(z, Or(x,y))) == r"z \Rightarrow \left(x \vee y\right)"
143.     assert latex(~(x & y)) == r"\neg \left(x \wedge y\right)"
144. 
145.     assert latex(~x, symbol_names={x: "x_i"}) == r"\neg x_i"
146.     assert latex(x & y, symbol_names={x: "x_i", y: "y_i"}) == \
147.         r"x_i \wedge y_i"
148.     assert latex(x & y & z, symbol_names={x: "x_i", y: "y_i", z: "z_i"}) == \
149.         r"x_i \wedge y_i \wedge z_i"
150.     assert latex(x | y, symbol_names={x: "x_i", y: "y_i"}) == r"x_i \vee y_i"
151.     assert latex(x | y | z, symbol_names={x: "x_i", y: "y_i", z: "z_i"}) == \
152.         r"x_i \vee y_i \vee z_i"
153.     assert latex((x & y) | z, symbol_names={x: "x_i", y: "y_i", z: "z_i"}) == \
154.         r"z_i \vee \left(x_i \wedge y_i\right)"
155.     assert latex(Implies(x, y), symbol_names={x: "x_i", y: "y_i"}) == \
156.         r"x_i \Rightarrow y_i"
157. 
158.     p = Symbol('p', positive=True)
159.     assert latex(exp(-p)*log(p)) == r"e^{- p} \log{\left(p \right)}"
160. 
161. 
162. def test_latex_builtins():
163.     assert latex(True) == r"\text{True}"
164.     assert latex(False) == r"\text{False}"
165.     assert latex(None) == r"\text{None}"
166.     assert latex(true) == r"\text{True}"
167.     assert latex(false) == r'\text{False}'
168. 
169. 
170. def test_latex_SingularityFunction():
171.     assert latex(SingularityFunction(x, 4, 5)) == \
172.         r"{\left\langle x - 4 \right\rangle}^{5}"
173.     assert latex(SingularityFunction(x, -3, 4)) == \
174.         r"{\left\langle x + 3 \right\rangle}^{4}"
175.     assert latex(SingularityFunction(x, 0, 4)) == \
176.         r"{\left\langle x \right\rangle}^{4}"
177.     assert latex(SingularityFunction(x, a, n)) == \
178.         r"{\left\langle - a + x \right\rangle}^{n}"
179.     assert latex(SingularityFunction(x, 4, -2)) == \
180.         r"{\left\langle x - 4 \right\rangle}^{-2}"
181.     assert latex(SingularityFunction(x, 4, -1)) == \
182.         r"{\left\langle x - 4 \right\rangle}^{-1}"
183. 
184. 
185. def test_latex_cycle():
186.     assert latex(Cycle(1, 2, 4)) == r"\left( 1\; 2\; 4\right)"
187.     assert latex(Cycle(1, 2)(4, 5, 6)) == \
188.         r"\left( 1\; 2\right)\left( 4\; 5\; 6\right)"
189.     assert latex(Cycle()) == r"\left( \right)"
190. 
191. 
192. def test_latex_permutation():
193.     assert latex(Permutation(1, 2, 4)) == r"\left( 1\; 2\; 4\right)"
194.     assert latex(Permutation(1, 2)(4, 5, 6)) == \
195.         r"\left( 1\; 2\right)\left( 4\; 5\; 6\right)"
196.     assert latex(Permutation()) == r"\left( \right)"
197.     assert latex(Permutation(2, 4)*Permutation(5)) == \
198.         r"\left( 2\; 4\right)\left( 5\right)"
199.     assert latex(Permutation(5)) == r"\left( 5\right)"
200. 
201. 
202. def test_latex_Float():
203.     assert latex(Float(1.0e100)) == r"1.0 \cdot 10^{100}"
204.     assert latex(Float(1.0e-100)) == r"1.0 \cdot 10^{-100}"
205.     assert latex(Float(1.0e-100), mul_symbol="times") == \
206.         r"1.0 \times 10^{-100}"
207. 
208. 
209. def test_latex_vector_expressions():
210.     A = CoordSys3D('A')
211. 
212.     assert latex(Cross(A.i, A.j*A.x*3+A.k)) == \
213.         r"\mathbf{\hat{i}_{A}} \times \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}} + \mathbf{\hat{k}_{A}}\right)"
214.     assert latex(Cross(A.i, A.j)) == \
215.         r"\mathbf{\hat{i}_{A}} \times \mathbf{\hat{j}_{A}}"
216.     assert latex(x*Cross(A.i, A.j)) == \
217.         r"x \left(\mathbf{\hat{i}_{A}} \times \mathbf{\hat{j}_{A}}\right)"
218.     assert latex(Cross(x*A.i, A.j)) == \
219.         r'- \mathbf{\hat{j}_{A}} \times \left((x)\mathbf{\hat{i}_{A}}\right)'
220. 
221.     assert latex(Curl(3*A.x*A.j)) == \
222.         r"\nabla\times \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)"
223.     assert latex(Curl(3*A.x*A.j+A.i)) == \
224.         r"\nabla\times \left(\mathbf{\hat{i}_{A}} + (3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)"
225.     assert latex(Curl(3*x*A.x*A.j)) == \
226.         r"\nabla\times \left((3 \mathbf{{x}_{A}} x)\mathbf{\hat{j}_{A}}\right)"
227.     assert latex(x*Curl(3*A.x*A.j)) == \
228.         r"x \left(\nabla\times \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)\right)"
229. 
230.     assert latex(Divergence(3*A.x*A.j+A.i)) == \
231.         r"\nabla\cdot \left(\mathbf{\hat{i}_{A}} + (3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)"
232.     assert latex(Divergence(3*A.x*A.j)) == \
233.         r"\nabla\cdot \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)"
234.     assert latex(x*Divergence(3*A.x*A.j)) == \
235.         r"x \left(\nabla\cdot \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)\right)"
236. 
237.     assert latex(Dot(A.i, A.j*A.x*3+A.k)) == \
238.         r"\mathbf{\hat{i}_{A}} \cdot \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}} + \mathbf{\hat{k}_{A}}\right)"
239.     assert latex(Dot(A.i, A.j)) == \
240.         r"\mathbf{\hat{i}_{A}} \cdot \mathbf{\hat{j}_{A}}"
241.     assert latex(Dot(x*A.i, A.j)) == \
242.         r"\mathbf{\hat{j}_{A}} \cdot \left((x)\mathbf{\hat{i}_{A}}\right)"
243.     assert latex(x*Dot(A.i, A.j)) == \
244.         r"x \left(\mathbf{\hat{i}_{A}} \cdot \mathbf{\hat{j}_{A}}\right)"
245. 
246.     assert latex(Gradient(A.x)) == r"\nabla \mathbf{{x}_{A}}"
247.     assert latex(Gradient(A.x + 3*A.y)) == \
248.         r"\nabla \left(\mathbf{{x}_{A}} + 3 \mathbf{{y}_{A}}\right)"
249.     assert latex(x*Gradient(A.x)) == r"x \left(\nabla \mathbf{{x}_{A}}\right)"
250.     assert latex(Gradient(x*A.x)) == r"\nabla \left(\mathbf{{x}_{A}} x\right)"
251. 
252.     assert latex(Laplacian(A.x)) == r"\triangle \mathbf{{x}_{A}}"
253.     assert latex(Laplacian(A.x + 3*A.y)) == \
254.         r"\triangle \left(\mathbf{{x}_{A}} + 3 \mathbf{{y}_{A}}\right)"
255.     assert latex(x*Laplacian(A.x)) == r"x \left(\triangle \mathbf{{x}_{A}}\right)"
256.     assert latex(Laplacian(x*A.x)) == r"\triangle \left(\mathbf{{x}_{A}} x\right)"
257. 
258. def test_latex_symbols():
259.     Gamma, lmbda, rho = symbols('Gamma, lambda, rho')
260.     tau, Tau, TAU, taU = symbols('tau, Tau, TAU, taU')
261.     assert latex(tau) == r"\tau"
262.     assert latex(Tau) == "T"
263.     assert latex(TAU) == r"\tau"
264.     assert latex(taU) == r"\tau"
265.     # Check that all capitalized greek letters are handled explicitly
266.     capitalized_letters = set(l.capitalize() for l in greek_letters_set)
267.     assert len(capitalized_letters - set(tex_greek_dictionary.keys())) == 0
268.     assert latex(Gamma + lmbda) == r"\Gamma + \lambda"
269.     assert latex(Gamma * lmbda) == r"\Gamma \lambda"
270.     assert latex(Symbol('q1')) == r"q_{1}"
271.     assert latex(Symbol('q21')) == r"q_{21}"
272.     assert latex(Symbol('epsilon0')) == r"\epsilon_{0}"
273.     assert latex(Symbol('omega1')) == r"\omega_{1}"
274.     assert latex(Symbol('91')) == r"91"
275.     assert latex(Symbol('alpha_new')) == r"\alpha_{new}"
276.     assert latex(Symbol('C^orig')) == r"C^{orig}"
277.     assert latex(Symbol('x^alpha')) == r"x^{\alpha}"
278.     assert latex(Symbol('beta^alpha')) == r"\beta^{\alpha}"
279.     assert latex(Symbol('e^Alpha')) == r"e^{A}"
280.     assert latex(Symbol('omega_alpha^beta')) == r"\omega^{\beta}_{\alpha}"
281.     assert latex(Symbol('omega') ** Symbol('beta')) == r"\omega^{\beta}"
282. 
283. 
284. @XFAIL
285. def test_latex_symbols_failing():
286.     rho, mass, volume = symbols('rho, mass, volume')
287.     assert latex(
288.         volume * rho == mass) == r"\rho \mathrm{volume} = \mathrm{mass}"
289.     assert latex(volume / mass * rho == 1) == \
290.         r"\rho \mathrm{volume} {\mathrm{mass}}^{(-1)} = 1"
291.     assert latex(mass**3 * volume**3) == \
292.         r"{\mathrm{mass}}^{3} \cdot {\mathrm{volume}}^{3}"
293. 
294. 
295. def test_latex_functions():
296.     assert latex(exp(x)) == "e^{x}"
297.     assert latex(exp(1) + exp(2)) == "e + e^{2}"
298. 
299.     f = Function('f')
300.     assert latex(f(x)) == r'f{\left(x \right)}'
301.     assert latex(f) == r'f'
302. 
303.     g = Function('g')
304.     assert latex(g(x, y)) == r'g{\left(x,y \right)}'
305.     assert latex(g) == r'g'
306. 
307.     h = Function('h')
308.     assert latex(h(x, y, z)) == r'h{\left(x,y,z \right)}'
309.     assert latex(h) == r'h'
310. 
311.     Li = Function('Li')
312.     assert latex(Li) == r'\operatorname{Li}'
313.     assert latex(Li(x)) == r'\operatorname{Li}{\left(x \right)}'
314. 
315.     mybeta = Function('beta')
316.     # not to be confused with the beta function
317.     assert latex(mybeta(x, y, z)) == r"\beta{\left(x,y,z \right)}"
318.     assert latex(beta(x, y)) == r'\operatorname{B}\left(x, y\right)'
319.     assert latex(beta(x, y)**2) == r'\operatorname{B}^{2}\left(x, y\right)'
320.     assert latex(mybeta(x)) == r"\beta{\left(x \right)}"
321.     assert latex(mybeta) == r"\beta"
322. 
323.     g = Function('gamma')
324.     # not to be confused with the gamma function
325.     assert latex(g(x, y, z)) == r"\gamma{\left(x,y,z \right)}"
326.     assert latex(g(x)) == r"\gamma{\left(x \right)}"
327.     assert latex(g) == r"\gamma"
328. 
329.     a1 = Function('a_1')
330. 
331.     assert latex(a1) == r"\operatorname{a_{1}}"
332.     assert latex(a1(x)) == r"\operatorname{a_{1}}{\left(x \right)}"
333. 
334.     # issue 5868
335.     omega1 = Function('omega1')
336.     assert latex(omega1) == r"\omega_{1}"
337.     assert latex(omega1(x)) == r"\omega_{1}{\left(x \right)}"
338. 
339.     assert latex(sin(x)) == r"\sin{\left(x \right)}"
340.     assert latex(sin(x), fold_func_brackets=True) == r"\sin {x}"
341.     assert latex(sin(2*x**2), fold_func_brackets=True) == \
342.         r"\sin {2 x^{2}}"
343.     assert latex(sin(x**2), fold_func_brackets=True) == \
344.         r"\sin {x^{2}}"
345. 
346.     assert latex(asin(x)**2) == r"\operatorname{asin}^{2}{\left(x \right)}"
347.     assert latex(asin(x)**2, inv_trig_style="full") == \
348.         r"\arcsin^{2}{\left(x \right)}"
349.     assert latex(asin(x)**2, inv_trig_style="power") == \
350.         r"\sin^{-1}{\left(x \right)}^{2}"
351.     assert latex(asin(x**2), inv_trig_style="power",
352.                  fold_func_brackets=True) == \
353.         r"\sin^{-1} {x^{2}}"
354.     assert latex(acsc(x), inv_trig_style="full") == \
355.         r"\operatorname{arccsc}{\left(x \right)}"
356. 
357.     assert latex(factorial(k)) == r"k!"
358.     assert latex(factorial(-k)) == r"\left(- k\right)!"
359.     assert latex(factorial(k)**2) == r"k!^{2}"
360. 
361.     assert latex(subfactorial(k)) == r"!k"
362.     assert latex(subfactorial(-k)) == r"!\left(- k\right)"
363.     assert latex(subfactorial(k)**2) == r"\left(!k\right)^{2}"
364. 
365.     assert latex(factorial2(k)) == r"k!!"
366.     assert latex(factorial2(-k)) == r"\left(- k\right)!!"
367.     assert latex(factorial2(k)**2) == r"k!!^{2}"
368. 
369.     assert latex(binomial(2, k)) == r"{\binom{2}{k}}"
370.     assert latex(binomial(2, k)**2) == r"{\binom{2}{k}}^{2}"
371. 
372.     assert latex(FallingFactorial(3, k)) == r"{\left(3\right)}_{k}"
373.     assert latex(RisingFactorial(3, k)) == r"{3}^{\left(k\right)}"
374. 
375.     assert latex(floor(x)) == r"\left\lfloor{x}\right\rfloor"
376.     assert latex(ceiling(x)) == r"\left\lceil{x}\right\rceil"
377.     assert latex(frac(x)) == r"\operatorname{frac}{\left(x\right)}"
378.     assert latex(floor(x)**2) == r"\left\lfloor{x}\right\rfloor^{2}"
379.     assert latex(ceiling(x)**2) == r"\left\lceil{x}\right\rceil^{2}"
380.     assert latex(frac(x)**2) == r"\operatorname{frac}{\left(x\right)}^{2}"
381. 
382.     assert latex(Min(x, 2, x**3)) == r"\min\left(2, x, x^{3}\right)"
383.     assert latex(Min(x, y)**2) == r"\min\left(x, y\right)^{2}"
384.     assert latex(Max(x, 2, x**3)) == r"\max\left(2, x, x^{3}\right)"
385.     assert latex(Max(x, y)**2) == r"\max\left(x, y\right)^{2}"
386.     assert latex(Abs(x)) == r"\left|{x}\right|"
387.     assert latex(Abs(x)**2) == r"\left|{x}\right|^{2}"
388.     assert latex(re(x)) == r"\operatorname{re}{\left(x\right)}"
389.     assert latex(re(x + y)) == \
390.         r"\operatorname{re}{\left(x\right)} + \operatorname{re}{\left(y\right)}"
391.     assert latex(im(x)) == r"\operatorname{im}{\left(x\right)}"
392.     assert latex(conjugate(x)) == r"\overline{x}"
393.     assert latex(conjugate(x)**2) == r"\overline{x}^{2}"
394.     assert latex(conjugate(x**2)) == r"\overline{x}^{2}"
395.     assert latex(gamma(x)) == r"\Gamma\left(x\right)"
396.     w = Wild('w')
397.     assert latex(gamma(w)) == r"\Gamma\left(w\right)"
398.     assert latex(Order(x)) == r"O\left(x\right)"
399.     assert latex(Order(x, x)) == r"O\left(x\right)"
400.     assert latex(Order(x, (x, 0))) == r"O\left(x\right)"
401.     assert latex(Order(x, (x, oo))) == r"O\left(x; x\rightarrow \infty\right)"
402.     assert latex(Order(x - y, (x, y))) == \
403.         r"O\left(x - y; x\rightarrow y\right)"
404.     assert latex(Order(x, x, y)) == \
405.         r"O\left(x; \left( x, \  y\right)\rightarrow \left( 0, \  0\right)\right)"
406.     assert latex(Order(x, x, y)) == \
407.         r"O\left(x; \left( x, \  y\right)\rightarrow \left( 0, \  0\right)\right)"
408.     assert latex(Order(x, (x, oo), (y, oo))) == \
409.         r"O\left(x; \left( x, \  y\right)\rightarrow \left( \infty, \  \infty\right)\right)"
410.     assert latex(lowergamma(x, y)) == r'\gamma\left(x, y\right)'
411.     assert latex(lowergamma(x, y)**2) == r'\gamma^{2}\left(x, y\right)'
412.     assert latex(uppergamma(x, y)) == r'\Gamma\left(x, y\right)'
413.     assert latex(uppergamma(x, y)**2) == r'\Gamma^{2}\left(x, y\right)'
414. 
415.     assert latex(cot(x)) == r'\cot{\left(x \right)}'
416.     assert latex(coth(x)) == r'\coth{\left(x \right)}'
417.     assert latex(re(x)) == r'\operatorname{re}{\left(x\right)}'
418.     assert latex(im(x)) == r'\operatorname{im}{\left(x\right)}'
419.     assert latex(root(x, y)) == r'x^{\frac{1}{y}}'
420.     assert latex(arg(x)) == r'\arg{\left(x \right)}'
421. 
422.     assert latex(zeta(x)) == r"\zeta\left(x\right)"
423.     assert latex(zeta(x)**2) == r"\zeta^{2}\left(x\right)"
424.     assert latex(zeta(x, y)) == r"\zeta\left(x, y\right)"
425.     assert latex(zeta(x, y)**2) == r"\zeta^{2}\left(x, y\right)"
426.     assert latex(dirichlet_eta(x)) == r"\eta\left(x\right)"
427.     assert latex(dirichlet_eta(x)**2) == r"\eta^{2}\left(x\right)"
428.     assert latex(polylog(x, y)) == r"\operatorname{Li}_{x}\left(y\right)"
429.     assert latex(
430.         polylog(x, y)**2) == r"\operatorname{Li}_{x}^{2}\left(y\right)"
431.     assert latex(lerchphi(x, y, n)) == r"\Phi\left(x, y, n\right)"
432.     assert latex(lerchphi(x, y, n)**2) == r"\Phi^{2}\left(x, y, n\right)"
433.     assert latex(stieltjes(x)) == r"\gamma_{x}"
434.     assert latex(stieltjes(x)**2) == r"\gamma_{x}^{2}"
435.     assert latex(stieltjes(x, y)) == r"\gamma_{x}\left(y\right)"
436.     assert latex(stieltjes(x, y)**2) == r"\gamma_{x}\left(y\right)^{2}"
437. 
438.     assert latex(elliptic_k(z)) == r"K\left(z\right)"
439.     assert latex(elliptic_k(z)**2) == r"K^{2}\left(z\right)"
440.     assert latex(elliptic_f(x, y)) == r"F\left(x\middle| y\right)"
441.     assert latex(elliptic_f(x, y)**2) == r"F^{2}\left(x\middle| y\right)"
442.     assert latex(elliptic_e(x, y)) == r"E\left(x\middle| y\right)"
443.     assert latex(elliptic_e(x, y)**2) == r"E^{2}\left(x\middle| y\right)"
444.     assert latex(elliptic_e(z)) == r"E\left(z\right)"
445.     assert latex(elliptic_e(z)**2) == r"E^{2}\left(z\right)"
446.     assert latex(elliptic_pi(x, y, z)) == r"\Pi\left(x; y\middle| z\right)"
447.     assert latex(elliptic_pi(x, y, z)**2) == \
448.         r"\Pi^{2}\left(x; y\middle| z\right)"
449.     assert latex(elliptic_pi(x, y)) == r"\Pi\left(x\middle| y\right)"
450.     assert latex(elliptic_pi(x, y)**2) == r"\Pi^{2}\left(x\middle| y\right)"
451. 
452.     assert latex(Ei(x)) == r'\operatorname{Ei}{\left(x \right)}'
453.     assert latex(Ei(x)**2) == r'\operatorname{Ei}^{2}{\left(x \right)}'
454.     assert latex(expint(x, y)) == r'\operatorname{E}_{x}\left(y\right)'
455.     assert latex(expint(x, y)**2) == r'\operatorname{E}_{x}^{2}\left(y\right)'
456.     assert latex(Shi(x)**2) == r'\operatorname{Shi}^{2}{\left(x \right)}'
457.     assert latex(Si(x)**2) == r'\operatorname{Si}^{2}{\left(x \right)}'
458.     assert latex(Ci(x)**2) == r'\operatorname{Ci}^{2}{\left(x \right)}'
459.     assert latex(Chi(x)**2) == r'\operatorname{Chi}^{2}\left(x\right)'
460.     assert latex(Chi(x)) == r'\operatorname{Chi}\left(x\right)'
461.     assert latex(jacobi(n, a, b, x)) == \
462.         r'P_{n}^{\left(a,b\right)}\left(x\right)'
463.     assert latex(jacobi(n, a, b, x)**2) == \
464.         r'\left(P_{n}^{\left(a,b\right)}\left(x\right)\right)^{2}'
465.     assert latex(gegenbauer(n, a, x)) == \
466.         r'C_{n}^{\left(a\right)}\left(x\right)'
467.     assert latex(gegenbauer(n, a, x)**2) == \
468.         r'\left(C_{n}^{\left(a\right)}\left(x\right)\right)^{2}'
469.     assert latex(chebyshevt(n, x)) == r'T_{n}\left(x\right)'
470.     assert latex(chebyshevt(n, x)**2) == \
471.         r'\left(T_{n}\left(x\right)\right)^{2}'
472.     assert latex(chebyshevu(n, x)) == r'U_{n}\left(x\right)'
473.     assert latex(chebyshevu(n, x)**2) == \
474.         r'\left(U_{n}\left(x\right)\right)^{2}'
475.     assert latex(legendre(n, x)) == r'P_{n}\left(x\right)'
476.     assert latex(legendre(n, x)**2) == r'\left(P_{n}\left(x\right)\right)^{2}'
477.     assert latex(assoc_legendre(n, a, x)) == \
478.         r'P_{n}^{\left(a\right)}\left(x\right)'
479.     assert latex(assoc_legendre(n, a, x)**2) == \
480.         r'\left(P_{n}^{\left(a\right)}\left(x\right)\right)^{2}'
481.     assert latex(laguerre(n, x)) == r'L_{n}\left(x\right)'
482.     assert latex(laguerre(n, x)**2) == r'\left(L_{n}\left(x\right)\right)^{2}'
483.     assert latex(assoc_laguerre(n, a, x)) == \
484.         r'L_{n}^{\left(a\right)}\left(x\right)'
485.     assert latex(assoc_laguerre(n, a, x)**2) == \
486.         r'\left(L_{n}^{\left(a\right)}\left(x\right)\right)^{2}'
487.     assert latex(hermite(n, x)) == r'H_{n}\left(x\right)'
488.     assert latex(hermite(n, x)**2) == r'\left(H_{n}\left(x\right)\right)^{2}'
489. 
490.     theta = Symbol("theta", real=True)
491.     phi = Symbol("phi", real=True)
492.     assert latex(Ynm(n, m, theta, phi)) == r'Y_{n}^{m}\left(\theta,\phi\right)'
493.     assert latex(Ynm(n, m, theta, phi)**3) == \
494.         r'\left(Y_{n}^{m}\left(\theta,\phi\right)\right)^{3}'
495.     assert latex(Znm(n, m, theta, phi)) == r'Z_{n}^{m}\left(\theta,\phi\right)'
496.     assert latex(Znm(n, m, theta, phi)**3) == \
497.         r'\left(Z_{n}^{m}\left(\theta,\phi\right)\right)^{3}'
498. 
499.     # Test latex printing of function names with "_"
500.     assert latex(polar_lift(0)) == \


--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to a given query and return it in the specified format!
EVERY context object MUST include: reasoning, relative_path, start_line, and end_line.

2025-10-06 08:54:43,045 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="This test case is the most relevant as it directly tests the LaTeX printing of the `Subs` object, which is the object exhibiting the incorrect parenthesizing behavior described in the bug report. Although this test doesn't cover the specific case of a `Subs` object being multiplied, it verifies the fundamental printing behavior of `Subs`, which is the foundation for the required fix.", relative_path='sympy/printing/tests/test_latex.py', start_line=675, end_line=677), ContextOutput(reasoning='This test case is highly relevant because it demonstrates the correct parenthesizing of expressions within a multiplication, which is the core of the issue. Specifically, assertions like `latex(x*Cross(A.i, A.j)) == r"x \\left(\\mathbf{\\hat{i}_{A}} \\times \\mathbf{\\hat{j}_{A}}\\right)"` show how a complex object (`Cross`) is parenthesized when it is a factor in a `Mul` expression. This is analogous to how `Subs` should be parenthesized in `3*Subs(...)`. It also shows how `Add` arguments to functions like `Curl` are parenthesized, which is relevant to the `-x+y` expression inside `Subs`.', relative_path='sympy/printing/tests/test_latex.py', start_line=209, end_line=257), ContextOutput(reasoning='This test case demonstrates how multiplication (`Mul`) is handled for `Permutation` objects. The assertion `latex(Permutation(1, 2)(4, 5, 6)) == r"\\left( 1\\; 2\\right)\\left( 4\\; 5\\; 6\\right)"` shows that for some object types, the factors are simply printed next to each other. This provides a useful contrast to the bug scenario, where this default behavior is not sufficient and parentheses are required, highlighting that the printing logic needs to be context-aware.', relative_path='sympy/printing/tests/test_latex.py', start_line=192, end_line=200), ContextOutput(reasoning='This test case is relevant because it shows the LaTeX printing of `SingularityFunction`, which contains an `Add` expression (`x - a` or `x + 3`) within a special bracket notation. The output `r"{\\left\\langle x - 4 \\right\\rangle}^{5}"` shows the internal expression being enclosed. This is analogous to the bug where the `Add` expression `-x+y` inside `Subs` needs to be enclosed in parentheses for correct rendering.', relative_path='sympy/printing/tests/test_latex.py', start_line=170, end_line=183), ContextOutput(reasoning='This test case is relevant because it demonstrates the parenthesizing of a function\'s argument. The assertion `latex(factorial(-k)) == r"\\left(- k\\right)!"` shows that the printer correctly adds parentheses around the negative argument `-k` before appending the factorial symbol. This is analogous to the situation in the bug report, where the expression `-x+y` inside `Subs` is an `Add` expression that requires parentheses when printed in the context of a multiplication.', relative_path='sympy/printing/tests/test_latex.py', start_line=357, end_line=359)]
2025-10-06 08:54:43,046 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - INFO - Context extraction complete, returning context [Context(relative_path='sympy/printing/tests/test_latex.py', content="675. def test_latex_subs():\n676.     assert latex(Subs(x*y, (\n677.         x, y), (1, 2))) == r'\\left. x y \\right|_{\\substack{ x=1\\\\ y=2 }}'", start_line_number=675, end_line_number=677), Context(relative_path='sympy/printing/tests/test_latex.py', content='209. def test_latex_vector_expressions():\n210.     A = CoordSys3D(\'A\')\n211. \n212.     assert latex(Cross(A.i, A.j*A.x*3+A.k)) == \\\n213.         r"\\mathbf{\\hat{i}_{A}} \\times \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}} + \\mathbf{\\hat{k}_{A}}\\right)"\n214.     assert latex(Cross(A.i, A.j)) == \\\n215.         r"\\mathbf{\\hat{i}_{A}} \\times \\mathbf{\\hat{j}_{A}}"\n216.     assert latex(x*Cross(A.i, A.j)) == \\\n217.         r"x \\left(\\mathbf{\\hat{i}_{A}} \\times \\mathbf{\\hat{j}_{A}}\\right)"\n218.     assert latex(Cross(x*A.i, A.j)) == \\\n219.         r\'- \\mathbf{\\hat{j}_{A}} \\times \\left((x)\\mathbf{\\hat{i}_{A}}\\right)\'\n220. \n221.     assert latex(Curl(3*A.x*A.j)) == \\\n222.         r"\\nabla\\times \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)"\n223.     assert latex(Curl(3*A.x*A.j+A.i)) == \\\n224.         r"\\nabla\\times \\left(\\mathbf{\\hat{i}_{A}} + (3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)"\n225.     assert latex(Curl(3*x*A.x*A.j)) == \\\n226.         r"\\nabla\\times \\left((3 \\mathbf{{x}_{A}} x)\\mathbf{\\hat{j}_{A}}\\right)"\n227.     assert latex(x*Curl(3*A.x*A.j)) == \\\n228.         r"x \\left(\\nabla\\times \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)\\right)"\n229. \n230.     assert latex(Divergence(3*A.x*A.j+A.i)) == \\\n231.         r"\\nabla\\cdot \\left(\\mathbf{\\hat{i}_{A}} + (3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)"\n232.     assert latex(Divergence(3*A.x*A.j)) == \\\n233.         r"\\nabla\\cdot \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)"\n234.     assert latex(x*Divergence(3*A.x*A.j)) == \\\n235.         r"x \\left(\\nabla\\cdot \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)\\right)"\n236. \n237.     assert latex(Dot(A.i, A.j*A.x*3+A.k)) == \\\n238.         r"\\mathbf{\\hat{i}_{A}} \\cdot \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}} + \\mathbf{\\hat{k}_{A}}\\right)"\n239.     assert latex(Dot(A.i, A.j)) == \\\n240.         r"\\mathbf{\\hat{i}_{A}} \\cdot \\mathbf{\\hat{j}_{A}}"\n241.     assert latex(Dot(x*A.i, A.j)) == \\\n242.         r"\\mathbf{\\hat{j}_{A}} \\cdot \\left((x)\\mathbf{\\hat{i}_{A}}\\right)"\n243.     assert latex(x*Dot(A.i, A.j)) == \\\n244.         r"x \\left(\\mathbf{\\hat{i}_{A}} \\cdot \\mathbf{\\hat{j}_{A}}\\right)"\n245. \n246.     assert latex(Gradient(A.x)) == r"\\nabla \\mathbf{{x}_{A}}"\n247.     assert latex(Gradient(A.x + 3*A.y)) == \\\n248.         r"\\nabla \\left(\\mathbf{{x}_{A}} + 3 \\mathbf{{y}_{A}}\\right)"\n249.     assert latex(x*Gradient(A.x)) == r"x \\left(\\nabla \\mathbf{{x}_{A}}\\right)"\n250.     assert latex(Gradient(x*A.x)) == r"\\nabla \\left(\\mathbf{{x}_{A}} x\\right)"\n251. \n252.     assert latex(Laplacian(A.x)) == r"\\triangle \\mathbf{{x}_{A}}"\n253.     assert latex(Laplacian(A.x + 3*A.y)) == \\\n254.         r"\\triangle \\left(\\mathbf{{x}_{A}} + 3 \\mathbf{{y}_{A}}\\right)"\n255.     assert latex(x*Laplacian(A.x)) == r"x \\left(\\triangle \\mathbf{{x}_{A}}\\right)"\n256.     assert latex(Laplacian(x*A.x)) == r"\\triangle \\left(\\mathbf{{x}_{A}} x\\right)"\n257. ', start_line_number=209, end_line_number=257), Context(relative_path='sympy/printing/tests/test_latex.py', content='192. def test_latex_permutation():\n193.     assert latex(Permutation(1, 2, 4)) == r"\\left( 1\\; 2\\; 4\\right)"\n194.     assert latex(Permutation(1, 2)(4, 5, 6)) == \\\n195.         r"\\left( 1\\; 2\\right)\\left( 4\\; 5\\; 6\\right)"\n196.     assert latex(Permutation()) == r"\\left( \\right)"\n197.     assert latex(Permutation(2, 4)*Permutation(5)) == \\\n198.         r"\\left( 2\\; 4\\right)\\left( 5\\right)"\n199.     assert latex(Permutation(5)) == r"\\left( 5\\right)"\n200. ', start_line_number=192, end_line_number=200), Context(relative_path='sympy/printing/tests/test_latex.py', content='170. def test_latex_SingularityFunction():\n171.     assert latex(SingularityFunction(x, 4, 5)) == \\\n172.         r"{\\left\\langle x - 4 \\right\\rangle}^{5}"\n173.     assert latex(SingularityFunction(x, -3, 4)) == \\\n174.         r"{\\left\\langle x + 3 \\right\\rangle}^{4}"\n175.     assert latex(SingularityFunction(x, 0, 4)) == \\\n176.         r"{\\left\\langle x \\right\\rangle}^{4}"\n177.     assert latex(SingularityFunction(x, a, n)) == \\\n178.         r"{\\left\\langle - a + x \\right\\rangle}^{n}"\n179.     assert latex(SingularityFunction(x, 4, -2)) == \\\n180.         r"{\\left\\langle x - 4 \\right\\rangle}^{-2}"\n181.     assert latex(SingularityFunction(x, 4, -1)) == \\\n182.         r"{\\left\\langle x - 4 \\right\\rangle}^{-1}"\n183. ', start_line_number=170, end_line_number=183), Context(relative_path='sympy/printing/tests/test_latex.py', content='357.     assert latex(factorial(k)) == r"k!"\n358.     assert latex(factorial(-k)) == r"\\left(- k\\right)!"\n359.     assert latex(factorial(k)**2) == r"k!^{2}"', start_line_number=357, end_line_number=359)]
2025-10-06 08:54:43,047 - thread-139660780025408.app.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-10-06 08:54:43,047 - thread-139660780025408.app.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sympy
├── .ci
|   ├── README.rst
|   ├── generate_durations_log.sh
|   └── parse_durations_log.py
├── .github
|   └── FUNDING.yml
├── .travis.yml
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── PULL_REQUEST_TEMPLATE.md
├── README.rst
├── bin
|   ├── ask_update.py
|   ├── authors_update.py
|   ├── coverage_doctest.py
|   ├── coverage_report.py
|   ├── generate_module_list.py
|   ├── generate_test_list.py
|   ├── get_sympy.py
|   ├── mailmap_update.py
|   ├── sympy_time.py
|   ├── sympy_time_cache.py
|   ├── test_executable.py
|   ├── test_external_imports.py
|   ├── test_import.py
|   ├── test_setup.py
|   └── test_travis.sh
├── codecov.yml
├── conftest.py
├── data
|   └── TeXmacs
|       ├── bin
|       └── progs
├── doc
|   ├── README.rst
|   ├── api
|   |   ├── conf.py
|   |   └── index.rst
|   ├── cheatsheet
|   ├── ext
|   |   ├── docscrape.py
|   |   ├── docscrape_sphinx.py
|   |   ├── numpydoc.py
|   |   └── sympylive.py
|   ├── generate_logos.py
|   ├── man
|   └── src
|       ├── _static
|       ├── _templates
|       ├── aboutus.rst
|       ├── citing.rst
|       ├── conf.py
|       ├── documentation-style-guide.rst
|       ├── gotchas.rst
|       ├── guide.rst
|       ├── index.rst
|       ├── install.rst
|       ├── logo
|       |   └── info.txt
|       ├── modules
|       |   ├── abc.rst
|       |   ├── algebras.rst
|       |   ├── assumptions
|       |   |   ├── ask.rst
|       |   |   ├── assume.rst
|       |   |   ├── handlers
|       |   |   ├── index.rst
|       |   |   └── refine.rst
|       |   ├── calculus
|       |   |   └── index.rst
|       |   ├── categories.rst
|       |   ├── codegen.rst
|       |   ├── combinatorics
|       |   |   ├── fp_groups.rst
|       |   |   ├── graycode.rst
|       |   |   ├── group_constructs.rst
|       |   |   ├── index.rst
|       |   |   ├── named_groups.rst
|       |   |   ├── partitions.rst
|       |   |   ├── pc_groups.rst
|       |   |   ├── perm_groups.rst
|       |   |   ├── permutations.rst
|       |   |   ├── polyhedron.rst
|       |   |   ├── prufer.rst
|       |   |   ├── subsets.rst
|       |   |   ├── tensor_can.rst
|       |   |   ├── testutil.rst
|       |   |   └── util.rst
|       |   ├── concrete.rst
|       |   ├── core.rst
|       |   ├── crypto.rst
|       |   ├── diffgeom.rst
|       |   ├── discrete.rst
|       |   ├── evalf.rst
|       |   ├── functions
|       |   |   ├── combinatorial.rst
|       |   |   ├── elementary.rst
|       |   |   ├── index.rst
|       |   |   └── special.rst
|       |   ├── geometry
|       |   |   ├── curves.rst
|       |   |   ├── ellipses.rst
|       |   |   ├── entities.rst
|       |   |   ├── index.rst
|       |   |   ├── lines.rst
|       |   |   ├── plane.rst
|       |   |   ├── points.rst
|       |   |   ├── polygons.rst
|       |   |   └── utils.rst
|       |   ├── holonomic
|       |   |   ├── about.rst
|       |   |   ├── convert.rst
|       |   |   ├── index.rst
|       |   |   ├── internal.rst
|       |   |   ├── operations.rst
|       |   |   ├── represent.rst
|       |   |   └── uses.rst
|       |   ├── index.rst
|       |   ├── integrals
|       |   |   ├── g-functions.rst
|       |   |   └── integrals.rst
|       |   ├── interactive.rst
|       |   ├── liealgebras
|       |   |   └── index.rst
|       |   ├── logic.rst
|       |   ├── matrices
|       |   |   ├── common.rst
|       |   |   ├── dense.rst
|       |   |   ├── expressions.rst
|       |   |   ├── immutablematrices.rst
|       |   |   ├── index.rst
|       |   |   ├── matrices.rst
|       |   |   └── sparse.rst
|       |   ├── ntheory.rst
|       |   ├── numeric-computation.rst
|       |   ├── parsing.rst
|       |   ├── physics
|       |   |   ├── continuum_mechanics
|       |   |   ├── hep
|       |   |   ├── hydrogen.rst
|       |   |   ├── index.rst
|       |   |   ├── matrices.rst
|       |   |   ├── mechanics
|       |   |   ├── optics
|       |   |   ├── paulialgebra.rst
|       |   |   ├── qho_1d.rst
|       |   |   ├── quantum
|       |   |   ├── secondquant.rst
|       |   |   ├── sho.rst
|       |   |   ├── units
|       |   |   ├── vector
|       |   |   └── wigner.rst
|       |   ├── plotting.rst
|       |   ├── polys
|       |   |   ├── agca.rst
|       |   |   ├── basics.rst
|       |   |   ├── index.rst
|       |   |   ├── internals.rst
|       |   |   ├── literature.rst
|       |   |   ├── reference.rst
|       |   |   ├── ringseries.rst
|       |   |   └── wester.rst
|       |   ├── printing.rst
|       |   ├── rewriting.rst
|       |   ├── series
|       |   |   ├── formal.rst
|       |   |   ├── fourier.rst
|       |   |   ├── index.rst
|       |   |   ├── limitseq.rst
|       |   |   ├── sequences.rst
|       |   |   └── series.rst
|       |   ├── sets.rst
|       |   ├── simplify
|       |   |   ├── hyperexpand.rst
|       |   |   └── simplify.rst
|       |   ├── solvers
|       |   |   ├── diophantine.rst
|       |   |   ├── inequalities.rst
|       |   |   ├── ode.rst
|       |   |   ├── pde.rst
|       |   |   ├── solvers.rst
|       |   |   └── solveset.rst
|       |   ├── stats.rst
|       |   ├── tensor
|       |   |   ├── array.rst
|       |   |   ├── index.rst
|       |   |   ├── index_methods.rst
|       |   |   ├── indexed.rst
|       |   |   └── tensor.rst
|       |   ├── utilities
|       |   |   ├── autowrap.rst
|       |   |   ├── codegen.rst
|       |   |   ├── decorator.rst
|       |   |   ├── enumerative.rst
|       |   |   ├── index.rst
|       |   |   ├── iterables.rst
|       |   |   ├── lambdify.rst
|       |   |   ├── memoization.rst
|       |   |   ├── misc.rst
|       |   |   ├── pkgdata.rst
|       |   |   ├── pytest.rst
|       |   |   ├── randtest.rst
|       |   |   ├── runtests.rst
|       |   |   ├── source.rst
|       |   |   └── timeutils.rst
|       |   └── vector
|       |       ├── api
|       |       ├── basics.rst
|       |       ├── coordsys.rst
|       |       ├── examples.rst
|       |       ├── fields.rst
|       |       ├── index.rst
|       |       └── intro.rst
|       ├── outreach.rst
|       ├── pics
|       ├── special_topics
|       |   ├── finite_diff_derivatives.rst
|       |   ├── index.rst
|       |   └── intro.rst
|       ├── tutorial
|       |   ├── basic_operations.rst
|       |   ├── calculus.rst
|       |   ├── gotchas.rst
|       |   ├── index.rst
|       |   ├── intro.rst
|       |   ├── manipulation.rst
|       |   ├── matrices.rst
|       |   ├── preliminaries.rst
|       |   ├── printing.rst
|       |   ├── simplification.rst
|       |   └── solvers.rst
|       └── wiki.rst
├── examples
|   ├── advanced
|   |   ├── autowrap_integrators.py
|   |   ├── autowrap_ufuncify.py
|   |   ├── curvilinear_coordinates.py
|   |   ├── dense_coding_example.py
|   |   ├── fem.py
|   |   ├── gibbs_phenomenon.py
|   |   ├── grover_example.py
|   |   ├── hydrogen.py
|   |   ├── pidigits.py
|   |   ├── pyglet_plotting.py
|   |   ├── qft.py
|   |   └── relativity.py
|   ├── all.py
|   ├── beginner
|   |   ├── basic.py
|   |   ├── differentiation.py
|   |   ├── expansion.py
|   |   ├── functions.py
|   |   ├── limits_examples.py
|   |   ├── plot_examples.py
|   |   ├── plotting_nice_plot.py
|   |   ├── precision.py
|   |   ├── print_pretty.py
|   |   ├── series.py
|   |   └── substitution.py
|   ├── intermediate
|   |   ├── coupled_cluster.py
|   |   ├── differential_equations.py
|   |   ├── infinite_1d_box.py
|   |   ├── mplot2d.py
|   |   ├── mplot3d.py
|   |   ├── partial_differential_eqs.py
|   |   ├── print_gtk.py
|   |   ├── sample.py
|   |   ├── trees.py
|   |   └── vandermonde.py
|   └── notebooks
|       └── README.txt
├── isympy.py
├── release
|   ├── README.md
|   ├── fabfile.py
|   ├── pull_and_run_rever.sh
|   └── release.sh
├── setup.py
├── setupegg.py
└── sympy
    ├── __init__.py
    ├── abc.py
    ├── algebras
    |   ├── __init__.py
    |   ├── quaternion.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_quaternion.py
    ├── assumptions
    |   ├── __init__.py
    |   ├── ask.py
    |   ├── ask_generated.py
    |   ├── assume.py
    |   ├── cnf.py
    |   ├── handlers
    |   |   ├── __init__.py
    |   |   ├── calculus.py
    |   |   ├── common.py
    |   |   ├── matrices.py
    |   |   ├── ntheory.py
    |   |   ├── order.py
    |   |   └── sets.py
    |   ├── refine.py
    |   ├── satask.py
    |   ├── sathandlers.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_assumptions_2.py
    |       ├── test_context.py
    |       ├── test_matrices.py
    |       ├── test_query.py
    |       ├── test_refine.py
    |       ├── test_satask.py
    |       └── test_sathandlers.py
    ├── benchmarks
    |   ├── __init__.py
    |   ├── bench_discrete_log.py
    |   ├── bench_meijerint.py
    |   └── bench_symbench.py
    ├── calculus
    |   ├── __init__.py
    |   ├── euler.py
    |   ├── finite_diff.py
    |   ├── singularities.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_euler.py
    |   |   ├── test_finite_diff.py
    |   |   ├── test_singularities.py
    |   |   └── test_util.py
    |   └── util.py
    ├── categories
    |   ├── __init__.py
    |   ├── baseclasses.py
    |   ├── diagram_drawing.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_baseclasses.py
    |       └── test_drawing.py
    ├── codegen
    |   ├── __init__.py
    |   ├── algorithms.py
    |   ├── approximations.py
    |   ├── array_utils.py
    |   ├── ast.py
    |   ├── cfunctions.py
    |   ├── cnodes.py
    |   ├── cutils.py
    |   ├── cxxnodes.py
    |   ├── fnodes.py
    |   ├── futils.py
    |   ├── matrix_nodes.py
    |   ├── pyutils.py
    |   ├── rewriting.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_algorithms.py
    |       ├── test_applications.py
    |       ├── test_approximations.py
    |       ├── test_array_utils.py
    |       ├── test_ast.py
    |       ├── test_cfunctions.py
    |       ├── test_cnodes.py
    |       ├── test_cxxnodes.py
    |       ├── test_fnodes.py
    |       ├── test_pyutils.py
    |       └── test_rewriting.py
    ├── combinatorics
    |   ├── __init__.py
    |   ├── coset_table.py
    |   ├── fp_groups.py
    |   ├── free_groups.py
    |   ├── generators.py
    |   ├── graycode.py
    |   ├── group_constructs.py
    |   ├── homomorphisms.py
    |   ├── named_groups.py
    |   ├── partitions.py
    |   ├── pc_groups.py
    |   ├── perm_groups.py
    |   ├── permutations.py
    |   ├── polyhedron.py
    |   ├── prufer.py
    |   ├── rewritingsystem.py
    |   ├── rewritingsystem_fsm.py
    |   ├── subsets.py
    |   ├── tensor_can.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_coset_table.py
    |   |   ├── test_fp_groups.py
    |   |   ├── test_free_groups.py
    |   |   ├── test_generators.py
    |   |   ├── test_graycode.py
    |   |   ├── test_group_constructs.py
    |   |   ├── test_homomorphisms.py
    |   |   ├── test_named_groups.py
    |   |   ├── test_partitions.py
    |   |   ├── test_pc_groups.py
    |   |   ├── test_perm_groups.py
    |   |   ├── test_permutations.py
    |   |   ├── test_polyhedron.py
    |   |   ├── test_prufer.py
    |   |   ├── test_rewriting.py
    |   |   ├── test_subsets.py
    |   |   ├── test_tensor_can.py
    |   |   ├── test_testutil.py
    |   |   └── test_util.py
    |   ├── testutil.py
    |   └── util.py
    ├── concrete
    |   ├── __init__.py
    |   ├── delta.py
    |   ├── expr_with_intlimits.py
    |   ├── expr_with_limits.py
    |   ├── gosper.py
    |   ├── guess.py
    |   ├── products.py
    |   ├── summations.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_delta.py
    |       ├── test_gosper.py
    |       ├── test_guess.py
    |       ├── test_products.py
    |       └── test_sums_products.py
    ├── conftest.py
    ├── core
    |   ├── __init__.py
    |   ├── add.py
    |   ├── alphabets.py
    |   ├── assumptions.py
    |   ├── backend.py
    |   ├── basic.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_arit.py
    |   |   ├── bench_assumptions.py
    |   |   ├── bench_basic.py
    |   |   ├── bench_expand.py
    |   |   ├── bench_numbers.py
    |   |   └── bench_sympify.py
    |   ├── cache.py
    |   ├── compatibility.py
    |   ├── containers.py
    |   ├── core.py
    |   ├── coreerrors.py
    |   ├── decorators.py
    |   ├── evalf.py
    |   ├── evaluate.py
    |   ├── expr.py
    |   ├── exprtools.py
    |   ├── facts.py
    |   ├── function.py
    |   ├── logic.py
    |   ├── mod.py
    |   ├── mul.py
    |   ├── multidimensional.py
    |   ├── numbers.py
    |   ├── operations.py
    |   ├── power.py
    |   ├── relational.py
    |   ├── rules.py
    |   ├── singleton.py
    |   ├── symbol.py
    |   ├── sympify.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_args.py
    |   |   ├── test_arit.py
    |   |   ├── test_assumptions.py
    |   |   ├── test_basic.py
    |   |   ├── test_cache.py
    |   |   ├── test_compatibility.py
    |   |   ├── test_complex.py
    |   |   ├── test_constructor_postprocessor.py
    |   |   ├── test_containers.py
    |   |   ├── test_count_ops.py
    |   |   ├── test_diff.py
    |   |   ├── test_equal.py
    |   |   ├── test_eval.py
    |   |   ├── test_evalf.py
    |   |   ├── test_evaluate.py
    |   |   ├── test_expand.py
    |   |   ├── test_expr.py
    |   |   ├── test_exprtools.py
    |   |   ├── test_facts.py
    |   |   ├── test_function.py
    |   |   ├── test_logic.py
    |   |   ├── test_match.py
    |   |   ├── test_multidimensional.py
    |   |   ├── test_noncommutative.py
    |   |   ├── test_numbers.py
    |   |   ├── test_operations.py
    |   |   ├── test_power.py
    |   |   ├── test_priority.py
    |   |   ├── test_relational.py
    |   |   ├── test_rules.py
    |   |   ├── test_singleton.py
    |   |   ├── test_subs.py
    |   |   ├── test_symbol.py
    |   |   ├── test_sympify.py
    |   |   ├── test_trace.py
    |   |   ├── test_truediv.py
    |   |   └── test_var.py
    |   └── trace.py
    ├── crypto
    |   ├── __init__.py
    |   ├── crypto.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_crypto.py
    ├── deprecated
    |   ├── __init__.py
    |   ├── class_registry.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_class_registry.py
    ├── diffgeom
    |   ├── __init__.py
    |   ├── diffgeom.py
    |   ├── rn.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_class_structure.py
    |       ├── test_diffgeom.py
    |       ├── test_function_diffgeom_book.py
    |       └── test_hyperbolic_space.py
    ├── discrete
    |   ├── __init__.py
    |   ├── convolutions.py
    |   ├── recurrences.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_convolutions.py
    |   |   ├── test_recurrences.py
    |   |   └── test_transforms.py
    |   └── transforms.py
    ├── external
    |   ├── __init__.py
    |   ├── importtools.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_autowrap.py
    |       ├── test_codegen.py
    |       ├── test_importtools.py
    |       ├── test_numpy.py
    |       ├── test_sage.py
    |       └── test_scipy.py
    ├── functions
    |   ├── __init__.py
    |   ├── combinatorial
    |   |   ├── __init__.py
    |   |   ├── factorials.py
    |   |   ├── numbers.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_comb_factorials.py
    |   |       └── test_comb_numbers.py
    |   ├── elementary
    |   |   ├── __init__.py
    |   |   ├── benchmarks
    |   |   |   ├── __init__.py
    |   |   |   └── bench_exp.py
    |   |   ├── complexes.py
    |   |   ├── exponential.py
    |   |   ├── hyperbolic.py
    |   |   ├── integers.py
    |   |   ├── miscellaneous.py
    |   |   ├── piecewise.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_complexes.py
    |   |   |   ├── test_exponential.py
    |   |   |   ├── test_hyperbolic.py
    |   |   |   ├── test_integers.py
    |   |   |   ├── test_interface.py
    |   |   |   ├── test_miscellaneous.py
    |   |   |   ├── test_piecewise.py
    |   |   |   └── test_trigonometric.py
    |   |   └── trigonometric.py
    |   └── special
    |       ├── __init__.py
    |       ├── benchmarks
    |       |   ├── __init__.py
    |       |   └── bench_special.py
    |       ├── bessel.py
    |       ├── beta_functions.py
    |       ├── bsplines.py
    |       ├── delta_functions.py
    |       ├── elliptic_integrals.py
    |       ├── error_functions.py
    |       ├── gamma_functions.py
    |       ├── hyper.py
    |       ├── mathieu_functions.py
    |       ├── polynomials.py
    |       ├── singularity_functions.py
    |       ├── spherical_harmonics.py
    |       ├── tensor_functions.py
    |       ├── tests
    |       |   ├── __init__.py
    |       |   ├── test_bessel.py
    |       |   ├── test_beta_functions.py
    |       |   ├── test_bsplines.py
    |       |   ├── test_delta_functions.py
    |       |   ├── test_elliptic_integrals.py
    |       |   ├── test_error_functions.py
    |       |   ├── test_gamma_functions.py
    |       |   ├── test_hyper.py
    |       |   ├── test_mathieu.py
    |       |   ├── test_singularity_functions.py
    |       |   ├── test_spec_polynomials.py
    |       |   ├── test_spherical_harmonics.py
    |       |   ├── test_tensor_functions.py
    |       |   └── test_zeta_functions.py
    |       └── zeta_functions.py
    ├── galgebra.py
    ├── geometry
    |   ├── __init__.py
    |   ├── curve.py
    |   ├── ellipse.py
    |   ├── entity.py
    |   ├── exceptions.py
    |   ├── line.py
    |   ├── parabola.py
    |   ├── plane.py
    |   ├── point.py
    |   ├── polygon.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_curve.py
    |   |   ├── test_ellipse.py
    |   |   ├── test_entity.py
    |   |   ├── test_geometrysets.py
    |   |   ├── test_line.py
    |   |   ├── test_parabola.py
    |   |   ├── test_plane.py
    |   |   ├── test_point.py
    |   |   ├── test_polygon.py
    |   |   └── test_util.py
    |   └── util.py
    ├── holonomic
    |   ├── __init__.py
    |   ├── holonomic.py
    |   ├── holonomicerrors.py
    |   ├── linearsolver.py
    |   ├── numerical.py
    |   ├── recurrence.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_holonomic.py
    |       └── test_recurrence.py
    ├── integrals
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_integrate.py
    |   |   └── bench_trigintegrate.py
    |   ├── deltafunctions.py
    |   ├── heurisch.py
    |   ├── integrals.py
    |   ├── intpoly.py
    |   ├── manualintegrate.py
    |   ├── meijerint.py
    |   ├── meijerint_doc.py
    |   ├── prde.py
    |   ├── quadrature.py
    |   ├── rationaltools.py
    |   ├── rde.py
    |   ├── risch.py
    |   ├── rubi
    |   |   ├── __init__.py
    |   |   ├── constraints.py
    |   |   ├── parsetools
    |   |   |   ├── __init__.py
    |   |   |   ├── generate_rules.py
    |   |   |   ├── generate_tests.py
    |   |   |   ├── header.py.txt
    |   |   |   ├── parse.py
    |   |   |   └── tests
    |   |   ├── rubi_tests
    |   |   |   ├── __init__.py
    |   |   |   └── tests
    |   |   ├── rubimain.py
    |   |   ├── rules
    |   |   |   ├── __init__.py
    |   |   |   ├── binomial_products.py
    |   |   |   ├── exponential.py
    |   |   |   ├── hyperbolic.py
    |   |   |   ├── integrand_simplification.py
    |   |   |   ├── inverse_hyperbolic.py
    |   |   |   ├── inverse_trig.py
    |   |   |   ├── linear_products.py
    |   |   |   ├── logarithms.py
    |   |   |   ├── miscellaneous_algebraic.py
    |   |   |   ├── miscellaneous_integration.py
    |   |   |   ├── miscellaneous_trig.py
    |   |   |   ├── piecewise_linear.py
    |   |   |   ├── quadratic_products.py
    |   |   |   ├── secant.py
    |   |   |   ├── sine.py
    |   |   |   ├── special_functions.py
    |   |   |   ├── tangent.py
    |   |   |   └── trinomial_products.py
    |   |   ├── symbol.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_rubi_integrate.py
    |   |   |   └── test_utility_function.py
    |   |   └── utility_function.py
    |   ├── singularityfunctions.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_deltafunctions.py
    |   |   ├── test_failing_integrals.py
    |   |   ├── test_heurisch.py
    |   |   ├── test_integrals.py
    |   |   ├── test_intpoly.py
    |   |   ├── test_lineintegrals.py
    |   |   ├── test_manual.py
    |   |   ├── test_meijerint.py
    |   |   ├── test_prde.py
    |   |   ├── test_quadrature.py
    |   |   ├── test_rationaltools.py
    |   |   ├── test_rde.py
    |   |   ├── test_risch.py
    |   |   ├── test_singularityfunctions.py
    |   |   ├── test_transforms.py
    |   |   └── test_trigonometry.py
    |   ├── transforms.py
    |   └── trigonometry.py
    ├── interactive
    |   ├── __init__.py
    |   ├── ipythonprinting.py
    |   ├── printing.py
    |   ├── session.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_interactive.py
    |       ├── test_ipython.py
    |       └── test_ipythonprinting.py
    ├── liealgebras
    |   ├── __init__.py
    |   ├── cartan_matrix.py
    |   ├── cartan_type.py
    |   ├── dynkin_diagram.py
    |   ├── root_system.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_cartan_matrix.py
    |   |   ├── test_cartan_type.py
    |   |   ├── test_dynkin_diagram.py
    |   |   ├── test_root_system.py
    |   |   ├── test_type_A.py
    |   |   ├── test_type_B.py
    |   |   ├── test_type_C.py
    |   |   ├── test_type_D.py
    |   |   ├── test_type_E.py
    |   |   ├── test_type_F.py
    |   |   ├── test_type_G.py
    |   |   └── test_weyl_group.py
    |   ├── type_a.py
    |   ├── type_b.py
    |   ├── type_c.py
    |   ├── type_d.py
    |   ├── type_e.py
    |   ├── type_f.py
    |   ├── type_g.py
    |   └── weyl_group.py
    ├── logic
    |   ├── __init__.py
    |   ├── algorithms
    |   |   ├── __init__.py
    |   |   ├── dpll.py
    |   |   ├── dpll2.py
    |   |   └── pycosat_wrapper.py
    |   ├── boolalg.py
    |   ├── inference.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_boolalg.py
    |   |   ├── test_dimacs.py
    |   |   └── test_inference.py
    |   └── utilities
    |       ├── __init__.py
    |       └── dimacs.py
    ├── matrices
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_matrix.py
    |   ├── common.py
    |   ├── dense.py
    |   ├── densearith.py
    |   ├── densesolve.py
    |   ├── densetools.py
    |   ├── expressions
    |   |   ├── __init__.py
    |   |   ├── adjoint.py
    |   |   ├── applyfunc.py
    |   |   ├── blockmatrix.py
    |   |   ├── determinant.py
    |   |   ├── diagonal.py
    |   |   ├── dotproduct.py
    |   |   ├── factorizations.py
    |   |   ├── fourier.py
    |   |   ├── funcmatrix.py
    |   |   ├── hadamard.py
    |   |   ├── inverse.py
    |   |   ├── kronecker.py
    |   |   ├── matadd.py
    |   |   ├── matexpr.py
    |   |   ├── matmul.py
    |   |   ├── matpow.py
    |   |   ├── slice.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_adjoint.py
    |   |   |   ├── test_applyfunc.py
    |   |   |   ├── test_blockmatrix.py
    |   |   |   ├── test_derivatives.py
    |   |   |   ├── test_determinant.py
    |   |   |   ├── test_diagonal.py
    |   |   |   ├── test_dotproduct.py
    |   |   |   ├── test_factorizations.py
    |   |   |   ├── test_fourier.py
    |   |   |   ├── test_funcmatrix.py
    |   |   |   ├── test_hadamard.py
    |   |   |   ├── test_indexing.py
    |   |   |   ├── test_inverse.py
    |   |   |   ├── test_kronecker.py
    |   |   |   ├── test_matadd.py
    |   |   |   ├── test_matexpr.py
    |   |   |   ├── test_matmul.py
    |   |   |   ├── test_matpow.py
    |   |   |   ├── test_slice.py
    |   |   |   ├── test_trace.py
    |   |   |   └── test_transpose.py
    |   |   ├── trace.py
    |   |   └── transpose.py
    |   ├── immutable.py
    |   ├── matrices.py
    |   ├── normalforms.py
    |   ├── sparse.py
    |   ├── sparsetools.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_commonmatrix.py
    |       ├── test_densearith.py
    |       ├── test_densesolve.py
    |       ├── test_densetools.py
    |       ├── test_immutable.py
    |       ├── test_interactions.py
    |       ├── test_matrices.py
    |       ├── test_normalforms.py
    |       ├── test_sparse.py
    |       └── test_sparsetools.py
    ├── multipledispatch
    |   ├── __init__.py
    |   ├── conflict.py
    |   ├── core.py
    |   ├── dispatcher.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_conflict.py
    |   |   ├── test_core.py
    |   |   └── test_dispatcher.py
    |   └── utils.py
    ├── ntheory
    |   ├── __init__.py
    |   ├── bbp_pi.py
    |   ├── continued_fraction.py
    |   ├── egyptian_fraction.py
    |   ├── factor_.py
    |   ├── generate.py
    |   ├── modular.py
    |   ├── multinomial.py
    |   ├── partitions_.py
    |   ├── primetest.py
    |   ├── residue_ntheory.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_bbp_pi.py
    |       ├── test_continued_fraction.py
    |       ├── test_egyptian_fraction.py
    |       ├── test_factor_.py
    |       ├── test_generate.py
    |       ├── test_modular.py
    |       ├── test_multinomial.py
    |       ├── test_partitions.py
    |       ├── test_primetest.py
    |       └── test_residue.py
    ├── parsing
    |   ├── __init__.py
    |   ├── ast_parser.py
    |   ├── autolev
    |   |   ├── __init__.py
    |   |   ├── _antlr
    |   |   |   ├── __init__.py
    |   |   |   ├── autolevlexer.py
    |   |   |   ├── autolevlistener.py
    |   |   |   └── autolevparser.py
    |   |   ├── _listener_autolev_antlr.py
    |   |   ├── _parse_autolev_antlr.py
    |   |   └── test-examples
    |   |       ├── __init__.py
    |   |       ├── pydy-example-repo
    |   |       ├── ruletest1.py
    |   |       ├── ruletest10.py
    |   |       ├── ruletest11.py
    |   |       ├── ruletest12.py
    |   |       ├── ruletest2.py
    |   |       ├── ruletest3.py
    |   |       ├── ruletest4.py
    |   |       ├── ruletest5.py
    |   |       ├── ruletest6.py
    |   |       ├── ruletest7.py
    |   |       ├── ruletest8.py
    |   |       └── ruletest9.py
    |   ├── c
    |   |   ├── __init__.py
    |   |   └── c_parser.py
    |   ├── fortran
    |   |   ├── __init__.py
    |   |   └── fortran_parser.py
    |   ├── latex
    |   |   ├── LICENSE.txt
    |   |   ├── __init__.py
    |   |   ├── _antlr
    |   |   |   ├── __init__.py
    |   |   |   ├── latexlexer.py
    |   |   |   └── latexparser.py
    |   |   ├── _build_latex_antlr.py
    |   |   ├── _parse_latex_antlr.py
    |   |   └── errors.py
    |   ├── mathematica.py
    |   ├── maxima.py
    |   ├── sym_expr.py
    |   ├── sympy_parser.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_autolev.py
    |       ├── test_c_parser.py
    |       ├── test_fortran_parser.py
    |       ├── test_implicit_multiplication_application.py
    |       ├── test_latex.py
    |       ├── test_latex_deps.py
    |       ├── test_mathematica.py
    |       ├── test_maxima.py
    |       ├── test_sym_expr.py
    |       └── test_sympy_parser.py
    ├── physics
    |   ├── __init__.py
    |   ├── continuum_mechanics
    |   |   ├── __init__.py
    |   |   ├── beam.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_beam.py
    |   ├── gaussopt.py
    |   ├── hep
    |   |   ├── __init__.py
    |   |   ├── gamma_matrices.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_gamma_matrices.py
    |   ├── hydrogen.py
    |   ├── matrices.py
    |   ├── mechanics
    |   |   ├── __init__.py
    |   |   ├── body.py
    |   |   ├── functions.py
    |   |   ├── kane.py
    |   |   ├── lagrange.py
    |   |   ├── linearize.py
    |   |   ├── models.py
    |   |   ├── particle.py
    |   |   ├── rigidbody.py
    |   |   ├── system.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_body.py
    |   |       ├── test_functions.py
    |   |       ├── test_kane.py
    |   |       ├── test_kane2.py
    |   |       ├── test_kane3.py
    |   |       ├── test_kane4.py
    |   |       ├── test_lagrange.py
    |   |       ├── test_lagrange2.py
    |   |       ├── test_linearize.py
    |   |       ├── test_models.py
    |   |       ├── test_particle.py
    |   |       ├── test_rigidbody.py
    |   |       └── test_system.py
    |   ├── optics
    |   |   ├── __init__.py
    |   |   ├── gaussopt.py
    |   |   ├── medium.py
    |   |   ├── polarization.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_gaussopt.py
    |   |   |   ├── test_medium.py
    |   |   |   ├── test_polarization.py
    |   |   |   ├── test_utils.py
    |   |   |   └── test_waves.py
    |   |   ├── utils.py
    |   |   └── waves.py
    |   ├── paulialgebra.py
    |   ├── pring.py
    |   ├── qho_1d.py
    |   ├── quantum
    |   |   ├── __init__.py
    |   |   ├── anticommutator.py
    |   |   ├── boson.py
    |   |   ├── cartesian.py
    |   |   ├── cg.py
    |   |   ├── circuitplot.py
    |   |   ├── circuitutils.py
    |   |   ├── commutator.py
    |   |   ├── constants.py
    |   |   ├── dagger.py
    |   |   ├── density.py
    |   |   ├── fermion.py
    |   |   ├── gate.py
    |   |   ├── grover.py
    |   |   ├── hilbert.py
    |   |   ├── identitysearch.py
    |   |   ├── innerproduct.py
    |   |   ├── matrixcache.py
    |   |   ├── matrixutils.py
    |   |   ├── operator.py
    |   |   ├── operatorordering.py
    |   |   ├── operatorset.py
    |   |   ├── pauli.py
    |   |   ├── piab.py
    |   |   ├── qapply.py
    |   |   ├── qasm.py
    |   |   ├── qexpr.py
    |   |   ├── qft.py
    |   |   ├── qubit.py
    |   |   ├── represent.py
    |   |   ├── sho1d.py
    |   |   ├── shor.py
    |   |   ├── spin.py
    |   |   ├── state.py
    |   |   ├── tensorproduct.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_anticommutator.py
    |   |       ├── test_boson.py
    |   |       ├── test_cartesian.py
    |   |       ├── test_cg.py
    |   |       ├── test_circuitplot.py
    |   |       ├── test_circuitutils.py
    |   |       ├── test_commutator.py
    |   |       ├── test_constants.py
    |   |       ├── test_dagger.py
    |   |       ├── test_density.py
    |   |       ├── test_fermion.py
    |   |       ├── test_gate.py
    |   |       ├── test_grover.py
    |   |       ├── test_hilbert.py
    |   |       ├── test_identitysearch.py
    |   |       ├── test_innerproduct.py
    |   |       ├── test_matrixutils.py
    |   |       ├── test_operator.py
    |   |       ├── test_operatorordering.py
    |   |       ├── test_operatorset.py
    |   |       ├── test_pauli.py
    |   |       ├── test_piab.py
    |   |       ├── test_printing.py
    |   |       ├── test_qapply.py
    |   |       ├── test_qasm.py
    |   |       ├── test_qexpr.py
    |   |       ├── test_qft.py
    |   |       ├── test_qubit.py
    |   |       ├── test_represent.py
    |   |       ├── test_sho1d.py
    |   |       ├── test_shor.py
    |   |       ├── test_spin.py
    |   |       ├── test_state.py
    |   |       └── test_tensorproduct.py
    |   ├── secondquant.py
    |   ├── sho.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_clebsch_gordan.py
    |   |   ├── test_hydrogen.py
    |   |   ├── test_paulialgebra.py
    |   |   ├── test_physics_matrices.py
    |   |   ├── test_pring.py
    |   |   ├── test_qho_1d.py
    |   |   ├── test_secondquant.py
    |   |   └── test_sho.py
    |   ├── units
    |   |   ├── __init__.py
    |   |   ├── definitions
    |   |   |   ├── __init__.py
    |   |   |   ├── dimension_definitions.py
    |   |   |   └── unit_definitions.py
    |   |   ├── dimensions.py
    |   |   ├── prefixes.py
    |   |   ├── quantities.py
    |   |   ├── systems
    |   |   |   ├── __init__.py
    |   |   |   ├── cgs.py
    |   |   |   ├── length_weight_time.py
    |   |   |   ├── mks.py
    |   |   |   ├── mksa.py
    |   |   |   ├── natural.py
    |   |   |   └── si.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dimensions.py
    |   |   |   ├── test_dimensionsystem.py
    |   |   |   ├── test_prefixes.py
    |   |   |   ├── test_quantities.py
    |   |   |   ├── test_unit_system_cgs_gauss.py
    |   |   |   ├── test_unitsystem.py
    |   |   |   └── test_util.py
    |   |   ├── unitsystem.py
    |   |   └── util.py
    |   ├── vector
    |   |   ├── __init__.py
    |   |   ├── dyadic.py
    |   |   ├── fieldfunctions.py
    |   |   ├── frame.py
    |   |   ├── functions.py
    |   |   ├── point.py
    |   |   ├── printing.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dyadic.py
    |   |   |   ├── test_fieldfunctions.py
    |   |   |   ├── test_frame.py
    |   |   |   ├── test_functions.py
    |   |   |   ├── test_output.py
    |   |   |   ├── test_point.py
    |   |   |   ├── test_printing.py
    |   |   |   └── test_vector.py
    |   |   └── vector.py
    |   └── wigner.py
    ├── plotting
    |   ├── __init__.py
    |   ├── experimental_lambdify.py
    |   ├── intervalmath
    |   |   ├── __init__.py
    |   |   ├── interval_arithmetic.py
    |   |   ├── interval_membership.py
    |   |   ├── lib_interval.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_interval_functions.py
    |   |       ├── test_interval_membership.py
    |   |       └── test_intervalmath.py
    |   ├── plot.py
    |   ├── plot_implicit.py
    |   ├── pygletplot
    |   |   ├── __init__.py
    |   |   ├── color_scheme.py
    |   |   ├── managed_window.py
    |   |   ├── plot.py
    |   |   ├── plot_axes.py
    |   |   ├── plot_camera.py
    |   |   ├── plot_controller.py
    |   |   ├── plot_curve.py
    |   |   ├── plot_interval.py
    |   |   ├── plot_mode.py
    |   |   ├── plot_mode_base.py
    |   |   ├── plot_modes.py
    |   |   ├── plot_object.py
    |   |   ├── plot_rotation.py
    |   |   ├── plot_surface.py
    |   |   ├── plot_window.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── test_plotting.py
    |   |   └── util.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_experimental_lambdify.py
    |   |   ├── test_plot.py
    |   |   ├── test_plot_implicit.py
    |   |   └── test_textplot.py
    |   └── textplot.py
    ├── polys
    |   ├── __init__.py
    |   ├── agca
    |   |   ├── __init__.py
    |   |   ├── extensions.py
    |   |   ├── homomorphisms.py
    |   |   ├── ideals.py
    |   |   ├── modules.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_extensions.py
    |   |       ├── test_homomorphisms.py
    |   |       ├── test_ideals.py
    |   |       └── test_modules.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_galoispolys.py
    |   |   ├── bench_groebnertools.py
    |   |   └── bench_solvers.py
    |   ├── compatibility.py
    |   ├── constructor.py
    |   ├── densearith.py
    |   ├── densebasic.py
    |   ├── densetools.py
    |   ├── dispersion.py
    |   ├── distributedmodules.py
    |   ├── domains
    |   |   ├── __init__.py
    |   |   ├── algebraicfield.py
    |   |   ├── characteristiczero.py
    |   |   ├── complexfield.py
    |   |   ├── compositedomain.py
    |   |   ├── domain.py
    |   |   ├── domainelement.py
    |   |   ├── expressiondomain.py
    |   |   ├── field.py
    |   |   ├── finitefield.py
    |   |   ├── fractionfield.py
    |   |   ├── gmpyfinitefield.py
    |   |   ├── gmpyintegerring.py
    |   |   ├── gmpyrationalfield.py
    |   |   ├── groundtypes.py
    |   |   ├── integerring.py
    |   |   ├── modularinteger.py
    |   |   ├── mpelements.py
    |   |   ├── old_fractionfield.py
    |   |   ├── old_polynomialring.py
    |   |   ├── polynomialring.py
    |   |   ├── pythonfinitefield.py
    |   |   ├── pythonintegerring.py
    |   |   ├── pythonrational.py
    |   |   ├── pythonrationalfield.py
    |   |   ├── quotientring.py
    |   |   ├── rationalfield.py
    |   |   ├── realfield.py
    |   |   ├── ring.py
    |   |   ├── simpledomain.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_domains.py
    |   |       ├── test_polynomialring.py
    |   |       └── test_quotientring.py
    |   ├── euclidtools.py
    |   ├── factortools.py
    |   ├── fglmtools.py
    |   ├── fields.py
    |   ├── galoistools.py
    |   ├── groebnertools.py
    |   ├── heuristicgcd.py
    |   ├── modulargcd.py
    |   ├── monomials.py
    |   ├── multivariate_resultants.py
    |   ├── numberfields.py
    |   ├── orderings.py
    |   ├── orthopolys.py
    |   ├── partfrac.py
    |   ├── polyclasses.py
    |   ├── polyconfig.py
    |   ├── polyerrors.py
    |   ├── polyfuncs.py
    |   ├── polymatrix.py
    |   ├── polyoptions.py
    |   ├── polyquinticconst.py
    |   ├── polyroots.py
    |   ├── polytools.py
    |   ├── polyutils.py
    |   ├── rationaltools.py
    |   ├── ring_series.py
    |   ├── rings.py
    |   ├── rootisolation.py
    |   ├── rootoftools.py
    |   ├── solvers.py
    |   ├── specialpolys.py
    |   ├── sqfreetools.py
    |   ├── subresultants_qq_zz.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_constructor.py
    |       ├── test_densearith.py
    |       ├── test_densebasic.py
    |       ├── test_densetools.py
    |       ├── test_dispersion.py
    |       ├── test_distributedmodules.py
    |       ├── test_euclidtools.py
    |       ├── test_factortools.py
    |       ├── test_fields.py
    |       ├── test_galoistools.py
    |       ├── test_groebnertools.py
    |       ├── test_heuristicgcd.py
    |       ├── test_injections.py
    |       ├── test_modulargcd.py
    |       ├── test_monomials.py
    |       ├── test_multivariate_resultants.py
    |       ├── test_numberfields.py
    |       ├── test_orderings.py
    |       ├── test_orthopolys.py
    |       ├── test_partfrac.py
    |       ├── test_polyclasses.py
    |       ├── test_polyfuncs.py
    |       ├── test_polymatrix.py
    |       ├── test_polyoptions.py
    |       ├── test_polyroots.py
    |       ├── test_polytools.py
    |       ├── test_polyutils.py
    |       ├── test_pythonrational.py
    |       ├── test_rationaltools.py
    |       ├── test_ring_series.py
    |       ├── test_rings.py
    |       ├── test_rootisolation.py
    |       ├── test_rootoftools.py
    |       ├── test_solvers.py
    |       ├── test_specialpolys.py
    |       ├── test_sqfreetools.py
    |       └── test_subresultants_qq_zz.py
    ├── printing
    |   ├── __init__.py
    |   ├── ccode.py
    |   ├── codeprinter.py
    |   ├── conventions.py
    |   ├── cxxcode.py
    |   ├── defaults.py
    |   ├── dot.py
    |   ├── fcode.py
    |   ├── glsl.py
    |   ├── gtk.py
    |   ├── jscode.py
    |   ├── julia.py
    |   ├── lambdarepr.py
    |   ├── latex.py
    |   ├── llvmjitcode.py
    |   ├── maple.py
    |   ├── mathematica.py
    |   ├── mathml.py
    |   ├── octave.py
    |   ├── precedence.py
    |   ├── pretty
    |   |   ├── __init__.py
    |   |   ├── pretty.py
    |   |   ├── pretty_symbology.py
    |   |   ├── stringpict.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_pretty.py
    |   ├── preview.py
    |   ├── printer.py
    |   ├── pycode.py
    |   ├── python.py
    |   ├── rcode.py
    |   ├── repr.py
    |   ├── rust.py
    |   ├── str.py
    |   ├── tableform.py
    |   ├── tensorflow.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_ccode.py
    |   |   ├── test_codeprinter.py
    |   |   ├── test_conventions.py
    |   |   ├── test_cxxcode.py
    |   |   ├── test_dot.py
    |   |   ├── test_fcode.py
    |   |   ├── test_glsl.py
    |   |   ├── test_gtk.py
    |   |   ├── test_jscode.py
    |   |   ├── test_julia.py
    |   |   ├── test_lambdarepr.py
    |   |   ├── test_latex.py
    |   |   ├── test_llvmjit.py
    |   |   ├── test_maple.py
    |   |   ├── test_mathematica.py
    |   |   ├── test_mathml.py
    |   |   ├── test_numpy.py
    |   |   ├── test_octave.py
    |   |   ├── test_precedence.py
    |   |   ├── test_preview.py
    |   |   ├── test_pycode.py
    |   |   ├── test_python.py
    |   |   ├── test_rcode.py
    |   |   ├── test_repr.py
    |   |   ├── test_rust.py
    |   |   ├── test_str.py
    |   |   ├── test_tableform.py
    |   |   ├── test_tensorflow.py
    |   |   ├── test_theanocode.py
    |   |   └── test_tree.py
    |   ├── theanocode.py
    |   └── tree.py
    ├── release.py
    ├── sandbox
    |   ├── __init__.py
    |   ├── indexed_integrals.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_indexed_integrals.py
    ├── series
    |   ├── __init__.py
    |   ├── acceleration.py
    |   ├── approximants.py
    |   ├── aseries.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_limit.py
    |   |   └── bench_order.py
    |   ├── formal.py
    |   ├── fourier.py
    |   ├── gruntz.py
    |   ├── kauers.py
    |   ├── limits.py
    |   ├── limitseq.py
    |   ├── order.py
    |   ├── residues.py
    |   ├── sequences.py
    |   ├── series.py
    |   ├── series_class.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_approximants.py
    |       ├── test_aseries.py
    |       ├── test_demidovich.py
    |       ├── test_formal.py
    |       ├── test_fourier.py
    |       ├── test_gruntz.py
    |       ├── test_kauers.py
    |       ├── test_limits.py
    |       ├── test_limitseq.py
    |       ├── test_lseries.py
    |       ├── test_nseries.py
    |       ├── test_order.py
    |       ├── test_residues.py
    |       ├── test_sequences.py
    |       └── test_series.py
    ├── sets
    |   ├── __init__.py
    |   ├── conditionset.py
    |   ├── contains.py
    |   ├── fancysets.py
    |   ├── handlers
    |   |   ├── __init__.py
    |   |   ├── add.py
    |   |   ├── functions.py
    |   |   ├── intersection.py
    |   |   ├── mul.py
    |   |   ├── power.py
    |   |   └── union.py
    |   ├── ordinals.py
    |   ├── powerset.py
    |   ├── setexpr.py
    |   ├── sets.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_conditionset.py
    |       ├── test_contains.py
    |       ├── test_fancysets.py
    |       ├── test_ordinals.py
    |       ├── test_powerset.py
    |       ├── test_setexpr.py
    |       └── test_sets.py
    ├── simplify
    |   ├── __init__.py
    |   ├── combsimp.py
    |   ├── cse_main.py
    |   ├── cse_opts.py
    |   ├── epathtools.py
    |   ├── fu.py
    |   ├── gammasimp.py
    |   ├── hyperexpand.py
    |   ├── hyperexpand_doc.py
    |   ├── powsimp.py
    |   ├── radsimp.py
    |   ├── ratsimp.py
    |   ├── simplify.py
    |   ├── sqrtdenest.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_combsimp.py
    |   |   ├── test_cse.py
    |   |   ├── test_epathtools.py
    |   |   ├── test_fu.py
    |   |   ├── test_function.py
    |   |   ├── test_gammasimp.py
    |   |   ├── test_hyperexpand.py
    |   |   ├── test_powsimp.py
    |   |   ├── test_radsimp.py
    |   |   ├── test_ratsimp.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_simplify.py
    |   |   ├── test_sqrtdenest.py
    |   |   ├── test_traversaltools.py
    |   |   └── test_trigsimp.py
    |   ├── traversaltools.py
    |   └── trigsimp.py
    ├── solvers
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_solvers.py
    |   ├── bivariate.py
    |   ├── decompogen.py
    |   ├── deutils.py
    |   ├── diophantine.py
    |   ├── inequalities.py
    |   ├── ode.py
    |   ├── pde.py
    |   ├── polysys.py
    |   ├── recurr.py
    |   ├── solvers.py
    |   ├── solveset.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_constantsimp.py
    |       ├── test_decompogen.py
    |       ├── test_diophantine.py
    |       ├── test_inequalities.py
    |       ├── test_numeric.py
    |       ├── test_ode.py
    |       ├── test_pde.py
    |       ├── test_polysys.py
    |       ├── test_recurr.py
    |       ├── test_solvers.py
    |       └── test_solveset.py
    ├── stats
    |   ├── __init__.py
    |   ├── crv.py
    |   ├── crv_types.py
    |   ├── drv.py
    |   ├── drv_types.py
    |   ├── error_prop.py
    |   ├── frv.py
    |   ├── frv_types.py
    |   ├── joint_rv.py
    |   ├── joint_rv_types.py
    |   ├── random_matrix.py
    |   ├── random_matrix_models.py
    |   ├── rv.py
    |   ├── rv_interface.py
    |   ├── stochastic_process.py
    |   ├── stochastic_process_types.py
    |   ├── symbolic_probability.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_continuous_rv.py
    |       ├── test_discrete_rv.py
    |       ├── test_error_prop.py
    |       ├── test_finite_rv.py
    |       ├── test_joint_rv.py
    |       ├── test_mix.py
    |       ├── test_random_matrix.py
    |       ├── test_rv.py
    |       ├── test_stochastic_process.py
    |       └── test_symbolic_probability.py
    ├── strategies
    |   ├── __init__.py
    |   ├── branch
    |   |   ├── __init__.py
    |   |   ├── core.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_core.py
    |   |   |   ├── test_tools.py
    |   |   |   └── test_traverse.py
    |   |   ├── tools.py
    |   |   └── traverse.py
    |   ├── core.py
    |   ├── rl.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_core.py
    |   |   ├── test_rl.py
    |   |   ├── test_strat.py
    |   |   ├── test_tools.py
    |   |   ├── test_traverse.py
    |   |   └── test_tree.py
    |   ├── tools.py
    |   ├── traverse.py
    |   ├── tree.py
    |   └── util.py
    ├── tensor
    |   ├── __init__.py
    |   ├── array
    |   |   ├── __init__.py
    |   |   ├── array_comprehension.py
    |   |   ├── arrayop.py
    |   |   ├── dense_ndim_array.py
    |   |   ├── mutable_ndim_array.py
    |   |   ├── ndim_array.py
    |   |   ├── sparse_ndim_array.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_array_comprehension.py
    |   |       ├── test_arrayop.py
    |   |       ├── test_immutable_ndim_array.py
    |   |       ├── test_mutable_ndim_array.py
    |   |       ├── test_ndim_array.py
    |   |       └── test_ndim_array_conversions.py
    |   ├── functions.py
    |   ├── index_methods.py
    |   ├── indexed.py
    |   ├── tensor.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_functions.py
    |   |   ├── test_index_methods.py
    |   |   ├── test_indexed.py
    |   |   ├── test_tensor.py
    |   |   ├── test_tensor_element.py
    |   |   └── test_tensor_operators.py
    |   └── toperators.py
    ├── this.py
    ├── unify
    |   ├── __init__.py
    |   ├── core.py
    |   ├── rewrite.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_sympy.py
    |   |   └── test_unify.py
    |   └── usympy.py
    ├── utilities
    |   ├── __init__.py
    |   ├── _compilation
    |   |   ├── __init__.py
    |   |   ├── availability.py
    |   |   ├── compilation.py
    |   |   ├── runners.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── test_compilation.py
    |   |   └── util.py
    |   ├── autowrap.py
    |   ├── benchmarking.py
    |   ├── codegen.py
    |   ├── decorator.py
    |   ├── enumerative.py
    |   ├── exceptions.py
    |   ├── iterables.py
    |   ├── lambdify.py
    |   ├── magic.py
    |   ├── matchpy_connector.py
    |   ├── mathml
    |   |   ├── __init__.py
    |   |   └── data
    |   ├── memoization.py
    |   ├── misc.py
    |   ├── pkgdata.py
    |   ├── pytest.py
    |   ├── quality_unicode.py
    |   ├── randtest.py
    |   ├── runtests.py
    |   ├── source.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── diagnose_imports.py
    |   |   ├── test_autowrap.py
    |   |   ├── test_code_quality.py
    |   |   ├── test_codegen.py
    |   |   ├── test_codegen_julia.py
    |   |   ├── test_codegen_octave.py
    |   |   ├── test_codegen_rust.py
    |   |   ├── test_decorator.py
    |   |   ├── test_enumerative.py
    |   |   ├── test_iterables.py
    |   |   ├── test_lambdify.py
    |   |   ├── test_misc.py
    |   |   ├── test_module_imports.py
    |   |   ├── test_pickling.py
    |   |   ├── test_pytest.py
    |   |   ├── test_source.py
    |   |   ├── test_timeutils.py
    |   |   └── test_wester.py
    |   ├── timeutils.py
    |   └── tmpfiles.py
    └── vector
        ├── __init__.py
        ├── basisdependent.py
        ├── coordsysrect.py
        ├── deloperator.py
        ├── dyadic.py
        ├── functions.py
        ├── operators.py
        ├── orienters.py
        ├── point.py
        ├── scalar.py
        ├── tests
        |   ├── __init__.py
        |   ├── test_coordsysrect.py
        |   ├── test_dyadic.py
        |   ├── test_field_functions.py
        |   ├── test_functions.py
        |   ├── test_operators.py
        |   ├── test_printing.py
        |   └── test_vector.py
        └── vector.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
Incorrect parenthesizing of Subs

Issue description: 
Here is an example.
```python
>>> from sympy import Subs
>>> from sympy.abc import x,y
>>> 3*Subs(-x+y, (x,),(1,))
```
LaTeX printing of this gives:  
```python
'3 \\left. - x + y \\right|_{\\substack{ x=1 }}'
```

![image](https://quicklatex.com/cache3/76/ql_9672fd7e62c909ff3d9ac8543c2e2576_l3.png)


It would be better to be parenthesized to:  
```python
'3 \\left. \\left(- x + y\\right) \\right|_{\\substack{ x=1 }}'
```

![image](https://quicklatex.com/cache3/bf/ql_936ffdb876e784206d4c54bb93d28dbf_l3.png)


Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: sympy/printing/tests/test_latex.py
Line number range: 675 - 677
Content:
675. def test_latex_subs():
676.     assert latex(Subs(x*y, (
677.         x, y), (1, 2))) == r'\left. x y \right|_{\substack{ x=1\\ y=2 }}'


File: sympy/printing/tests/test_latex.py
Line number range: 209 - 257
Content:
209. def test_latex_vector_expressions():
210.     A = CoordSys3D('A')
211. 
212.     assert latex(Cross(A.i, A.j*A.x*3+A.k)) == \
213.         r"\mathbf{\hat{i}_{A}} \times \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}} + \mathbf{\hat{k}_{A}}\right)"
214.     assert latex(Cross(A.i, A.j)) == \
215.         r"\mathbf{\hat{i}_{A}} \times \mathbf{\hat{j}_{A}}"
216.     assert latex(x*Cross(A.i, A.j)) == \
217.         r"x \left(\mathbf{\hat{i}_{A}} \times \mathbf{\hat{j}_{A}}\right)"
218.     assert latex(Cross(x*A.i, A.j)) == \
219.         r'- \mathbf{\hat{j}_{A}} \times \left((x)\mathbf{\hat{i}_{A}}\right)'
220. 
221.     assert latex(Curl(3*A.x*A.j)) == \
222.         r"\nabla\times \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)"
223.     assert latex(Curl(3*A.x*A.j+A.i)) == \
224.         r"\nabla\times \left(\mathbf{\hat{i}_{A}} + (3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)"
225.     assert latex(Curl(3*x*A.x*A.j)) == \
226.         r"\nabla\times \left((3 \mathbf{{x}_{A}} x)\mathbf{\hat{j}_{A}}\right)"
227.     assert latex(x*Curl(3*A.x*A.j)) == \
228.         r"x \left(\nabla\times \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)\right)"
229. 
230.     assert latex(Divergence(3*A.x*A.j+A.i)) == \
231.         r"\nabla\cdot \left(\mathbf{\hat{i}_{A}} + (3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)"
232.     assert latex(Divergence(3*A.x*A.j)) == \
233.         r"\nabla\cdot \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)"
234.     assert latex(x*Divergence(3*A.x*A.j)) == \
235.         r"x \left(\nabla\cdot \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)\right)"
236. 
237.     assert latex(Dot(A.i, A.j*A.x*3+A.k)) == \
238.         r"\mathbf{\hat{i}_{A}} \cdot \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}} + \mathbf{\hat{k}_{A}}\right)"
239.     assert latex(Dot(A.i, A.j)) == \
240.         r"\mathbf{\hat{i}_{A}} \cdot \mathbf{\hat{j}_{A}}"
241.     assert latex(Dot(x*A.i, A.j)) == \
242.         r"\mathbf{\hat{j}_{A}} \cdot \left((x)\mathbf{\hat{i}_{A}}\right)"
243.     assert latex(x*Dot(A.i, A.j)) == \
244.         r"x \left(\mathbf{\hat{i}_{A}} \cdot \mathbf{\hat{j}_{A}}\right)"
245. 
246.     assert latex(Gradient(A.x)) == r"\nabla \mathbf{{x}_{A}}"
247.     assert latex(Gradient(A.x + 3*A.y)) == \
248.         r"\nabla \left(\mathbf{{x}_{A}} + 3 \mathbf{{y}_{A}}\right)"
249.     assert latex(x*Gradient(A.x)) == r"x \left(\nabla \mathbf{{x}_{A}}\right)"
250.     assert latex(Gradient(x*A.x)) == r"\nabla \left(\mathbf{{x}_{A}} x\right)"
251. 
252.     assert latex(Laplacian(A.x)) == r"\triangle \mathbf{{x}_{A}}"
253.     assert latex(Laplacian(A.x + 3*A.y)) == \
254.         r"\triangle \left(\mathbf{{x}_{A}} + 3 \mathbf{{y}_{A}}\right)"
255.     assert latex(x*Laplacian(A.x)) == r"x \left(\triangle \mathbf{{x}_{A}}\right)"
256.     assert latex(Laplacian(x*A.x)) == r"\triangle \left(\mathbf{{x}_{A}} x\right)"
257. 


File: sympy/printing/tests/test_latex.py
Line number range: 192 - 200
Content:
192. def test_latex_permutation():
193.     assert latex(Permutation(1, 2, 4)) == r"\left( 1\; 2\; 4\right)"
194.     assert latex(Permutation(1, 2)(4, 5, 6)) == \
195.         r"\left( 1\; 2\right)\left( 4\; 5\; 6\right)"
196.     assert latex(Permutation()) == r"\left( \right)"
197.     assert latex(Permutation(2, 4)*Permutation(5)) == \
198.         r"\left( 2\; 4\right)\left( 5\right)"
199.     assert latex(Permutation(5)) == r"\left( 5\right)"
200. 


File: sympy/printing/tests/test_latex.py
Line number range: 170 - 183
Content:
170. def test_latex_SingularityFunction():
171.     assert latex(SingularityFunction(x, 4, 5)) == \
172.         r"{\left\langle x - 4 \right\rangle}^{5}"
173.     assert latex(SingularityFunction(x, -3, 4)) == \
174.         r"{\left\langle x + 3 \right\rangle}^{4}"
175.     assert latex(SingularityFunction(x, 0, 4)) == \
176.         r"{\left\langle x \right\rangle}^{4}"
177.     assert latex(SingularityFunction(x, a, n)) == \
178.         r"{\left\langle - a + x \right\rangle}^{n}"
179.     assert latex(SingularityFunction(x, 4, -2)) == \
180.         r"{\left\langle x - 4 \right\rangle}^{-2}"
181.     assert latex(SingularityFunction(x, 4, -1)) == \
182.         r"{\left\langle x - 4 \right\rangle}^{-1}"
183. 


File: sympy/printing/tests/test_latex.py
Line number range: 357 - 359
Content:
357.     assert latex(factorial(k)) == r"k!"
358.     assert latex(factorial(-k)) == r"\left(- k\right)!"
359.     assert latex(factorial(k)**2) == r"k!^{2}"

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

2025-10-06 08:55:04,163 - thread-139660780025408.app.lang_graph.nodes.context_refine_node - DEBUG - reasoning="1. The user wants 5 complete and self-contained test cases, which means they must include all necessary imports, setup, and the full test method body.\n2. The provided context contains only snippets of test methods from `sympy/printing/tests/test_latex.py`.\n3. The imports for symbols like `Subs`, `x`, `y`, `CoordSys3D`, `Cross`, `Curl`, etc., are missing.\n4. Without the full file, I cannot construct the complete, self-contained test cases that the user has requested.\n5. Therefore, I need the full content of `sympy/printing/tests/test_latex.py` to satisfy the user's requirements." refined_query='Please provide the full content of the file `sympy/printing/tests/test_latex.py`.'
2025-10-06 08:55:06,676 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "sympy/printing/tests/test_latex.py"}'}, '__gemini_function_call_thought_signatures__': {'356e2319-43bb-4e63-9dba-179fec23b350': 'CsEFAR/MhbZ+Q0bRBPsyu3QdrExpt3r1GQ9iiWGXAr2SZDmcqtBOdGv3N8cKPcxkCSoddv+SxRonpbZRgwsJuOg28i/g0622Zyar++UmuvsdtWLHeNNf2l1fnjHB+JCmwY1UaoroMfDjbYjmxpzhcvv+MwLRpV8zrl4E2llDzEafYfJJeR1xTVVBh+Wo8YYfXIwjHVvfJDF7CxnhoDT8Qj9h0d9sao7e73kCiEPCuWQkTfwj3aFmo8iHCUuAsZj3fWhklm8PApJDKpIS+yJD6klYFyzcHpWU2/PXoNN0yIRZQhXnbN70I8LjbUU3/gkEWSbiDR0BZdhlmjiZt83firN75ryjF7eUlPogtC2OVStOlEwl7hsyIhntwl4zbjlPQXXatldcxSWyOUeSgNNtcwe2kVa2VUmq0Q2shwsFCmlneovui8lEHbK6Zjx5/vE8tyBHEz+49VAuDOYLw9ONe61rJh8qT/3zgzmylmy6BtZ7Nv4/b0TxufcVkQeQJFDkwrkekqQU5Q7b/XUD93DqRCY85GWlAlWioKFGxR/g9nwLJJOSz0zl+wsWJWM9DfM9deoEYmT5Syk/1/gDr+Ye6b/BCKz4xO7jONf287TSUbdA7VN8CB6XNyxkf9y8sBkg6cHbXuGN6EpVoWJnRZN/VSfukRrWZJZGZFjuFGkyX+vD22bH0mECzP5rxUjJuvhX8ySDQj0HRT2S56w0bcl6k0k/r9IsKKsALlnR7ayyhyiEZqeubWEvCJEtnT9VFONf6IGfrMn5dYzsJOqDQJXybTHtzLCYQC6lcxFz+g0ynKjpv3UIJIDjfRIIJK1KL6c2pyzyaiunAb229t2+mkRrFC6emHVM9agUBOCkkgdzqbbiu24MEN75m9shOnexbiOfdheH26MrN69oEeDV+YYvjgxLDqQSzpNMe552s8Cy6Ek4+7LE'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 19691, 'candidates_token_count': 26, 'total_token_count': 19894, 'prompt_tokens_details': [{'modality': 1, 'token_count': 19691}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 26}], 'thoughts_token_count': 177, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.2089866308065561, 'model_name': 'gemini-2.5-pro'} id='run--6dbe7e1e-594e-45cc-88a6-7ca341d46d82-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'sympy/printing/tests/test_latex.py'}, 'id': '356e2319-43bb-4e63-9dba-179fec23b350', 'type': 'tool_call'}] usage_metadata={'input_tokens': 19691, 'output_tokens': 26, 'total_tokens': 19894, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 177}}
2025-10-06 08:55:09,828 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "sympy/printing/tests/test_latex.py", "start_line": 501.0, "end_line": 1001.0}'}, '__gemini_function_call_thought_signatures__': {'914007e4-d7c2-4919-8286-d6a798dac502': 'CtIEAR/MhbanLkgpRcGJMJtH8MVaSiETMc0yW9yjqyDHgmjoabcQ8O0CaT7DmuGjSpH4mjiee0W/v/pWudC3j9r/H0OdjRvDusy0vCFpCc+ux+yP2W6MoOJCkYvknKjUSlYecYOhwMFvGAk1cS5GQzjMHkEGys7tDxryQiZdDSTslSzAGUaM7w4pbiVgOncaKjy7nn4humSdcxSbeBXutR7G53i9mE42n5Lews3mieAOhLaA9Y/NYka6EO+OTNXE8xh2xgAQK7dHqYWWUua+O5Z4+43JOuhc8GwaHzYO8HK4DzhQIc4nZHAft69Wn0xaAY7iEjOHcR+pEzA9Bd+5XCjjhp+J6YAbACqbIFpmx0qJA40nPscCccSGD2+KMkqdsPZDjEl+GaZnmIm5NXtOmW1CCT93YUccaVr3I5a9gCdxID7G2ZvQaTVDcePnYC92bToKeClZSznb8JdSL79kaxqv9O9sFfoB/B1CG6EZZ/gHiGv8JKsdihSAEFt6h2voY3ocEbmjLSHU7TL0lfvWBuHzw36UQSfe1225mUI/+gSavVi9zV7BUoFqtNME97V4yEDaFaZztQRYX+mGZj8obOYxE6TzwUdFONbQ2MTFArV0Gdxva3OG220EOTe8cle+9V18+rc9m7vAO9RdAeNtoIl0lLorodFsE+XIPhT0ptBjQ2DCPv0CjsQIm/r6AqluiItq4U7oR/PdSpys+yOTiW5Kca7aizV492H6aN3O1oykTRbXiG8DndW6SdHQv3qrZ/+TdnLBzHJJwMI1YmNYhuKOIpll'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 31378, 'candidates_token_count': 32, 'total_token_count': 31574, 'cached_content_token_count': 19424, 'prompt_tokens_details': [{'modality': 1, 'token_count': 31553}], 'cache_tokens_details': [{'modality': 1, 'token_count': 19424}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 32}], 'thoughts_token_count': 164}, 'finish_reason': 'STOP', 'avg_logprobs': -0.4162672162055969, 'model_name': 'gemini-2.5-pro'} id='run--6a00f554-7923-4db6-9c16-b7c7f08c3472-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'sympy/printing/tests/test_latex.py', 'start_line': 501.0, 'end_line': 1001.0}, 'id': '914007e4-d7c2-4919-8286-d6a798dac502', 'type': 'tool_call'}] usage_metadata={'input_tokens': 31378, 'output_tokens': 32, 'total_tokens': 31574, 'input_token_details': {'cache_read': 19424}, 'output_token_details': {'reasoning': 164}}
2025-10-06 08:55:12,165 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 1001.0, "relative_path": "sympy/printing/tests/test_latex.py", "end_line": 1501.0}'}, '__gemini_function_call_thought_signatures__': {'fcffe9d1-e981-40c9-b7f1-fc869b3b16dd': 'CrsCAR/MhbaDR0k7+Sd4DVAW4uqzmzfqL4Gc7+CGLIIszChVwW4e1H9H4fR5FcfzsJ0sWN4qhxqpL37ZAZoNNoWpfMufvZWDKhcXsYGFXjvZ6wI/klrPyDupMCWHMuWDm+iRlTcazgz5YTAPdvM7TZNRIBGWQ0u7kllBskS2AjXaSOd5q5BHEfKI+VClr3XZZvxZn/geqGdYSRVbJFdSAX7aVQ6oNudoEOevu9LMu4TWoTJ57PeXBxgCKLk79WvA07TTPYrTbSsQRi2lMYO03DzvkVBNy9qpE2HDwVHots3Cv0YI7Rdz+0OemTvfdlyU01N/durdiOaOXsy9lAWHr1/nK5EfqiHRrDL1iea0pr2/u0tFIBs7mF2b7hd6zusBT/5VzE4ha3Eot0UCMwyXfF6W6LLZsiavYz4RJL8K'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 42433, 'candidates_token_count': 32, 'total_token_count': 42549, 'cached_content_token_count': 30604, 'prompt_tokens_details': [{'modality': 1, 'token_count': 42770}], 'cache_tokens_details': [{'modality': 1, 'token_count': 30604}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 32}], 'thoughts_token_count': 84}, 'finish_reason': 'STOP', 'avg_logprobs': -0.15399478375911713, 'model_name': 'gemini-2.5-pro'} id='run--adfc7c6e-b9d6-4e76-97f6-f53b9f0e5a69-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 1001.0, 'relative_path': 'sympy/printing/tests/test_latex.py', 'end_line': 1501.0}, 'id': 'fcffe9d1-e981-40c9-b7f1-fc869b3b16dd', 'type': 'tool_call'}] usage_metadata={'input_tokens': 42433, 'output_tokens': 32, 'total_tokens': 42549, 'input_token_details': {'cache_read': 30604}, 'output_token_details': {'reasoning': 84}}
2025-10-06 08:55:14,354 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 1502.0, "relative_path": "sympy/printing/tests/test_latex.py", "end_line": 2002.0}'}, '__gemini_function_call_thought_signatures__': {'49b8388d-66d5-43af-b075-bd60b93aef3d': 'Cr0CAR/MhbYrnBjKsBFP5Wq6BzwxedoMJ9xdSQJPirm3ArUXHn05nI4zHWWwPuRqvEhUaON7W5kLsOQ51XzUl5OiF5BzKP+EC/3vI2hBzpm42vCyv4Sb/WPRRPFJGUPl+wINQwKaGfy/8k95dtPWVRSgKtTW0qsYVm2fClSaBrPp/g7hCTBYBAY42fdE4ZjNSrGxFTuHzmwaZub7LDcItIIw/97JvaEqbzwomzijeZ4KFAqUZZHLxbkqnBiSyxFMsQzpD+YhF9XFBLgsE5APN8iLsnuRWiWzmX31Jllk3K48Dx6zivcd8sxK0uDgTHWFQPvIbZwTwHHdejFfKiaI7lQlEOP0rPvBF+Yg0v44BZyV5nZcsHtX5KwIiWhEcj1ytF5aqTO00cFAdbsRvVD3BF/Iodi8vojWXMjeWp6665E='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 54099, 'candidates_token_count': 32, 'total_token_count': 54215, 'cached_content_token_count': 42052, 'prompt_tokens_details': [{'modality': 1, 'token_count': 54518}], 'cache_tokens_details': [{'modality': 1, 'token_count': 42052}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 32}], 'thoughts_token_count': 84}, 'finish_reason': 'STOP', 'avg_logprobs': -0.05575620383024216, 'model_name': 'gemini-2.5-pro'} id='run--fc1be2c7-22ea-467c-8819-c75aae497b53-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 1502.0, 'relative_path': 'sympy/printing/tests/test_latex.py', 'end_line': 2002.0}, 'id': '49b8388d-66d5-43af-b075-bd60b93aef3d', 'type': 'tool_call'}] usage_metadata={'input_tokens': 54099, 'output_tokens': 32, 'total_tokens': 54215, 'input_token_details': {'cache_read': 42052}, 'output_token_details': {'reasoning': 84}}
2025-10-06 08:55:16,953 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 2003.0, "relative_path": "sympy/printing/tests/test_latex.py", "end_line": 2503.0}'}, '__gemini_function_call_thought_signatures__': {'70558ea5-c0c4-4035-9880-6d9c0605b624': 'CqQBAR/MhbZlAQvca4bwcX8QCSgMtBrzctCpgJk56OeQNvq6G6R0XPsk/psa+XQdhCniHtEtTCLXjQ/LwjRg5jzubPV4h+Airq5pKAs9Y/0lc5GqL83VALzXsWBa0lHw5gAJyDzQbVczaRDqPrrJt667D8wGyU+E5H1e5HsRHqLQgaBu6eYLvZ7v04FVjSo6rKXW7TWBeZMMlmiHBetXx9OFR3MfxBs='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 64421, 'candidates_token_count': 32, 'total_token_count': 64502, 'prompt_tokens_details': [{'modality': 1, 'token_count': 64922}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 32}], 'thoughts_token_count': 49, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.07240744680166245, 'model_name': 'gemini-2.5-pro'} id='run--0025784c-3244-41bb-a1e6-f2cdbc4bfe2b-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 2003.0, 'relative_path': 'sympy/printing/tests/test_latex.py', 'end_line': 2503.0}, 'id': '70558ea5-c0c4-4035-9880-6d9c0605b624', 'type': 'tool_call'}] usage_metadata={'input_tokens': 64421, 'output_tokens': 32, 'total_tokens': 64502, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 49}}
2025-10-06 08:55:23,339 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 2504.0, "relative_path": "sympy/printing/tests/test_latex.py", "end_line": 9999.0}'}, '__gemini_function_call_thought_signatures__': {'783d2cd1-39af-4870-bb1c-7be5050ea209': 'CvwBAR/MhbYYDBlxtrNTIr9v4VA1myEe+szPxSYk8NRmCwYGcqFq/dRYSOpJv//8FcGN2dZAEL0eT44ViVVhl+KHcGbktfj96XuNg/iEwlTKOLYTDPgYtYXUSYuCmlflxjS7Eqi9cvbJl6e3HBKyVpZBHiqNJzj0ggdUtzqLjdLxSmhHA+zhdT0tMA3ho8IFck7zO3XuvGCTYpajp1BF6qWmlaCeN151Z+4ZWA7mkajW8KnKwJ3Ke12yx1uif1/0wHtk8penO46WtTbUebLa3h6sU8pt3GGUpBvA+vLvQS9DIvd2auVml+DPW1RH5gdm9kdCo+GBJJXgsxRzT55j'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 74420, 'candidates_token_count': 32, 'total_token_count': 74842, 'cached_content_token_count': 65036, 'prompt_tokens_details': [{'modality': 1, 'token_count': 74968}], 'cache_tokens_details': [{'modality': 1, 'token_count': 65036}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 32}], 'thoughts_token_count': 390}, 'finish_reason': 'STOP', 'avg_logprobs': -1.5398966073989868, 'model_name': 'gemini-2.5-pro'} id='run--a0b5a1d9-acaa-4f29-acf2-a6fda40cd343-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 2504.0, 'relative_path': 'sympy/printing/tests/test_latex.py', 'end_line': 9999.0}, 'id': '783d2cd1-39af-4870-bb1c-7be5050ea209', 'type': 'tool_call'}] usage_metadata={'input_tokens': 74420, 'output_tokens': 32, 'total_tokens': 74842, 'input_token_details': {'cache_read': 65036}, 'output_token_details': {'reasoning': 390}}
2025-10-06 08:55:28,912 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content="I have successfully retrieved the entire content of the file `sympy/printing/tests/test_latex.py`. The file's content was fetched in multiple parts and has now been combined to provide the complete file. This was done to handle the large size of the file efficiently." additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 75098, 'candidates_token_count': 58, 'total_token_count': 75562, 'cached_content_token_count': 72659, 'prompt_tokens_details': [{'modality': 1, 'token_count': 75713}], 'cache_tokens_details': [{'modality': 1, 'token_count': 72659}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 58}], 'thoughts_token_count': 406}, 'finish_reason': 'STOP', 'avg_logprobs': -0.9458114360940868, 'model_name': 'gemini-2.5-pro'} id='run--e9d8df13-484a-477f-9a56-1a386c29e485-0' usage_metadata={'input_tokens': 75098, 'output_tokens': 58, 'total_tokens': 75562, 'input_token_details': {'cache_read': 72659}, 'output_token_details': {'reasoning': 406}}
2025-10-06 08:55:28,913 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - INFO - Starting context extraction process
2025-10-06 08:55:28,914 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - DEBUG - This is the original user query:

--- BEGIN ORIGINAL QUERY ---
Issue title:
Incorrect parenthesizing of Subs

Issue description: 
Here is an example.
```python
>>> from sympy import Subs
>>> from sympy.abc import x,y
>>> 3*Subs(-x+y, (x,),(1,))
```
LaTeX printing of this gives:  
```python
'3 \\left. - x + y \\right|_{\\substack{ x=1 }}'
```

![image](https://quicklatex.com/cache3/76/ql_9672fd7e62c909ff3d9ac8543c2e2576_l3.png)


It would be better to be parenthesized to:  
```python
'3 \\left. \\left(- x + y\\right) \\right|_{\\substack{ x=1 }}'
```

![image](https://quicklatex.com/cache3/bf/ql_936ffdb876e784206d4c54bb93d28dbf_l3.png)


Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

This is the refinement query. Please consider it together with the original query. It's really IMPORTANT!!!

--- BEGIN REFINEMENT QUERY ---
Please provide the full content of the file `sympy/printing/tests/test_latex.py`.
--- END REFINEMENT QUERY ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: sympy/printing/tests/test_latex.py
Line number range: 1 - 500
Content:
1. from sympy import (
2.     Add, Abs, Chi, Ci, CosineTransform, Dict, Ei, Eq, FallingFactorial,
3.     FiniteSet, Float, FourierTransform, Function, Indexed, IndexedBase, Integral,
4.     Interval, InverseCosineTransform, InverseFourierTransform, Derivative,
5.     InverseLaplaceTransform, InverseMellinTransform, InverseSineTransform,
6.     Lambda, LaplaceTransform, Limit, Matrix, Max, MellinTransform, Min, Mul,
7.     Order, Piecewise, Poly, ring, field, ZZ, Pow, Product, Range, Rational,
8.     RisingFactorial, rootof, RootSum, S, Shi, Si, SineTransform, Subs,
9.     Sum, Symbol, ImageSet, Tuple, Ynm, Znm, arg, asin, acsc, Mod,
10.     assoc_laguerre, assoc_legendre, beta, binomial, catalan, ceiling, Complement,
11.     chebyshevt, chebyshevu, conjugate, cot, coth, diff, dirichlet_eta, euler,
12.     exp, expint, factorial, factorial2, floor, gamma, gegenbauer, hermite,
13.     hyper, im, jacobi, laguerre, legendre, lerchphi, log, frac,
14.     meijerg, oo, polar_lift, polylog, re, root, sin, sqrt, symbols,
15.     uppergamma, zeta, subfactorial, totient, elliptic_k, elliptic_f,
16.     elliptic_e, elliptic_pi, cos, tan, Wild, true, false, Equivalent, Not,
17.     Contains, divisor_sigma, SeqPer, SeqFormula,
18.     SeqAdd, SeqMul, fourier_series, pi, ConditionSet, ComplexRegion, fps,
19.     AccumBounds, reduced_totient, primenu, primeomega, SingularityFunction,
20.     stieltjes, mathieuc, mathieus, mathieucprime, mathieusprime,
21.     UnevaluatedExpr, Quaternion, I, KroneckerProduct, LambertW)
22. 
23. from sympy.ntheory.factor_ import udivisor_sigma
24. 
25. from sympy.abc import mu, tau
26. from sympy.printing.latex import (latex, translate, greek_letters_set,
27.                                   tex_greek_dictionary, multiline_latex)
28. from sympy.tensor.array import (ImmutableDenseNDimArray,
29.                                 ImmutableSparseNDimArray,
30.                                 MutableSparseNDimArray,
31.                                 MutableDenseNDimArray,
32.                                 tensorproduct)
33. from sympy.utilities.pytest import XFAIL, raises
34. from sympy.functions import DiracDelta, Heaviside, KroneckerDelta, LeviCivita
35. from sympy.functions.combinatorial.numbers import bernoulli, bell, lucas, \
36.     fibonacci, tribonacci
37. from sympy.logic import Implies
38. from sympy.logic.boolalg import And, Or, Xor
39. from sympy.physics.quantum import Commutator, Operator
40. from sympy.physics.units import degree, radian, kg, meter, gibibyte, microgram, second
41. from sympy.core.trace import Tr
42. from sympy.core.compatibility import range
43. from sympy.combinatorics.permutations import Cycle, Permutation
44. from sympy import MatrixSymbol, ln
45. from sympy.vector import CoordSys3D, Cross, Curl, Dot, Divergence, Gradient, Laplacian
46. from sympy.sets.setexpr import SetExpr
47. from sympy.sets.sets import \
48.     Union, Intersection, Complement, SymmetricDifference, ProductSet
49. 
50. import sympy as sym
51. 
52. 
53. class lowergamma(sym.lowergamma):
54.     pass   # testing notation inheritance by a subclass with same name
55. 
56. 
57. x, y, z, t, a, b, c = symbols('x y z t a b c')
58. k, m, n = symbols('k m n', integer=True)
59. 
60. 
61. def test_printmethod():
62.     class R(Abs):
63.         def _latex(self, printer):
64.             return "foo(%s)" % printer._print(self.args[0])
65.     assert latex(R(x)) == "foo(x)"
66. 
67.     class R(Abs):
68.         def _latex(self, printer):
69.             return "foo"
70.     assert latex(R(x)) == "foo"
71. 
72. 
73. def test_latex_basic():
74.     assert latex(1 + x) == "x + 1"
75.     assert latex(x**2) == "x^{2}"
76.     assert latex(x**(1 + x)) == "x^{x + 1}"
77.     assert latex(x**3 + x + 1 + x**2) == "x^{3} + x^{2} + x + 1"
78. 
79.     assert latex(2*x*y) == "2 x y"
80.     assert latex(2*x*y, mul_symbol='dot') == r"2 \cdot x \cdot y"
81.     assert latex(3*x**2*y, mul_symbol='\\,') == r"3\,x^{2}\,y"
82.     assert latex(1.5*3**x, mul_symbol='\\,') == r"1.5 \cdot 3^{x}"
83. 
84.     assert latex(1/x) == r"\frac{1}{x}"
85.     assert latex(1/x, fold_short_frac=True) == "1 / x"
86.     assert latex(-S(3)/2) == r"- \frac{3}{2}"
87.     assert latex(-S(3)/2, fold_short_frac=True) == r"- 3 / 2"
88.     assert latex(1/x**2) == r"\frac{1}{x^{2}}"
89.     assert latex(1/(x + y)/2) == r"\frac{1}{2 \left(x + y\right)}"
90.     assert latex(x/2) == r"\frac{x}{2}"
91.     assert latex(x/2, fold_short_frac=True) == "x / 2"
92.     assert latex((x + y)/(2*x)) == r"\frac{x + y}{2 x}"
93.     assert latex((x + y)/(2*x), fold_short_frac=True) == \
94.         r"\left(x + y\right) / 2 x"
95.     assert latex((x + y)/(2*x), long_frac_ratio=0) == \
96.         r"\frac{1}{2 x} \left(x + y\right)"
97.     assert latex((x + y)/x) == r"\frac{x + y}{x}"
98.     assert latex((x + y)/x, long_frac_ratio=3) == r"\frac{x + y}{x}"
99.     assert latex((2*sqrt(2)*x)/3) == r"\frac{2 \sqrt{2} x}{3}"
100.     assert latex((2*sqrt(2)*x)/3, long_frac_ratio=2) == \
101.         r"\frac{2 x}{3} \sqrt{2}"
102. 
103.     assert latex(2*Integral(x, x)/3) == r"\frac{2 \int x\, dx}{3}"
104.     assert latex(2*Integral(x, x)/3, fold_short_frac=True) == \
105.         r"\left(2 \int x\, dx\right) / 3"
106. 
107.     assert latex(sqrt(x)) == r"\sqrt{x}"
108.     assert latex(x**Rational(1, 3)) == r"\sqrt[3]{x}"
109.     assert latex(x**Rational(1, 3), root_notation=False) == r"x^{\frac{1}{3}}"
110.     assert latex(sqrt(x)**3) == r"x^{\frac{3}{2}}"
111.     assert latex(sqrt(x), itex=True) == r"\sqrt{x}"
112.     assert latex(x**Rational(1, 3), itex=True) == r"\root{3}{x}"
113.     assert latex(sqrt(x)**3, itex=True) == r"x^{\frac{3}{2}}"
114.     assert latex(x**Rational(3, 4)) == r"x^{\frac{3}{4}}"
115.     assert latex(x**Rational(3, 4), fold_frac_powers=True) == "x^{3/4}"
116.     assert latex((x + 1)**Rational(3, 4)) == \
117.         r"\left(x + 1\right)^{\frac{3}{4}}"
118.     assert latex((x + 1)**Rational(3, 4), fold_frac_powers=True) == \
119.         r"\left(x + 1\right)^{3/4}"
120. 
121.     assert latex(1.5e20*x) == r"1.5 \cdot 10^{20} x"
122.     assert latex(1.5e20*x, mul_symbol='dot') == r"1.5 \cdot 10^{20} \cdot x"
123.     assert latex(1.5e20*x, mul_symbol='times') == \
124.         r"1.5 \times 10^{20} \times x"
125. 
126.     assert latex(1/sin(x)) == r"\frac{1}{\sin{\left(x \right)}}"
127.     assert latex(sin(x)**-1) == r"\frac{1}{\sin{\left(x \right)}}"
128.     assert latex(sin(x)**Rational(3, 2)) == \
129.         r"\sin^{\frac{3}{2}}{\left(x \right)}"
130.     assert latex(sin(x)**Rational(3, 2), fold_frac_powers=True) == \
131.         r"\sin^{3/2}{\left(x \right)}"
132. 
133.     assert latex(~x) == r"\neg x"
134.     assert latex(x & y) == r"x \wedge y"
135.     assert latex(x & y & z) == r"x \wedge y \wedge z"
136.     assert latex(x | y) == r"x \vee y"
137.     assert latex(x | y | z) == r"x \vee y \vee z"
138.     assert latex((x & y) | z) == r"z \vee \left(x \wedge y\right)"
139.     assert latex(Implies(x, y)) == r"x \Rightarrow y"
140.     assert latex(~(x >> ~y)) == r"x \not\Rightarrow \neg y"
141.     assert latex(Implies(Or(x,y), z)) == r"\left(x \vee y\right) \Rightarrow z"
142.     assert latex(Implies(z, Or(x,y))) == r"z \Rightarrow \left(x \vee y\right)"
143.     assert latex(~(x & y)) == r"\neg \left(x \wedge y\right)"
144. 
145.     assert latex(~x, symbol_names={x: "x_i"}) == r"\neg x_i"
146.     assert latex(x & y, symbol_names={x: "x_i", y: "y_i"}) == \
147.         r"x_i \wedge y_i"
148.     assert latex(x & y & z, symbol_names={x: "x_i", y: "y_i", z: "z_i"}) == \
149.         r"x_i \wedge y_i \wedge z_i"
150.     assert latex(x | y, symbol_names={x: "x_i", y: "y_i"}) == r"x_i \vee y_i"
151.     assert latex(x | y | z, symbol_names={x: "x_i", y: "y_i", z: "z_i"}) == \
152.         r"x_i \vee y_i \vee z_i"
153.     assert latex((x & y) | z, symbol_names={x: "x_i", y: "y_i", z: "z_i"}) == \
154.         r"z_i \vee \left(x_i \wedge y_i\right)"
155.     assert latex(Implies(x, y), symbol_names={x: "x_i", y: "y_i"}) == \
156.         r"x_i \Rightarrow y_i"
157. 
158.     p = Symbol('p', positive=True)
159.     assert latex(exp(-p)*log(p)) == r"e^{- p} \log{\left(p \right)}"
160. 
161. 
162. def test_latex_builtins():
163.     assert latex(True) == r"\text{True}"
164.     assert latex(False) == r"\text{False}"
165.     assert latex(None) == r"\text{None}"
166.     assert latex(true) == r"\text{True}"
167.     assert latex(false) == r'\text{False}'
168. 
169. 
170. def test_latex_SingularityFunction():
171.     assert latex(SingularityFunction(x, 4, 5)) == \
172.         r"{\left\langle x - 4 \right\rangle}^{5}"
173.     assert latex(SingularityFunction(x, -3, 4)) == \
174.         r"{\left\langle x + 3 \right\rangle}^{4}"
175.     assert latex(SingularityFunction(x, 0, 4)) == \
176.         r"{\left\langle x \right\rangle}^{4}"
177.     assert latex(SingularityFunction(x, a, n)) == \
178.         r"{\left\langle - a + x \right\rangle}^{n}"
179.     assert latex(SingularityFunction(x, 4, -2)) == \
180.         r"{\left\langle x - 4 \right\rangle}^{-2}"
181.     assert latex(SingularityFunction(x, 4, -1)) == \
182.         r"{\left\langle x - 4 \right\rangle}^{-1}"
183. 
184. 
185. def test_latex_cycle():
186.     assert latex(Cycle(1, 2, 4)) == r"\left( 1\; 2\; 4\right)"
187.     assert latex(Cycle(1, 2)(4, 5, 6)) == \
188.         r"\left( 1\; 2\right)\left( 4\; 5\; 6\right)"
189.     assert latex(Cycle()) == r"\left( \right)"
190. 
191. 
192. def test_latex_permutation():
193.     assert latex(Permutation(1, 2, 4)) == r"\left( 1\; 2\; 4\right)"
194.     assert latex(Permutation(1, 2)(4, 5, 6)) == \
195.         r"\left( 1\; 2\right)\left( 4\; 5\; 6\right)"
196.     assert latex(Permutation()) == r"\left( \right)"
197.     assert latex(Permutation(2, 4)*Permutation(5)) == \
198.         r"\left( 2\; 4\right)\left( 5\right)"
199.     assert latex(Permutation(5)) == r"\left( 5\right)"
200. 
201. 
202. def test_latex_Float():
203.     assert latex(Float(1.0e100)) == r"1.0 \cdot 10^{100}"
204.     assert latex(Float(1.0e-100)) == r"1.0 \cdot 10^{-100}"
205.     assert latex(Float(1.0e-100), mul_symbol="times") == \
206.         r"1.0 \times 10^{-100}"
207. 
208. 
209. def test_latex_vector_expressions():
210.     A = CoordSys3D('A')
211. 
212.     assert latex(Cross(A.i, A.j*A.x*3+A.k)) == \
213.         r"\mathbf{\hat{i}_{A}} \times \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}} + \mathbf{\hat{k}_{A}}\right)"
214.     assert latex(Cross(A.i, A.j)) == \
215.         r"\mathbf{\hat{i}_{A}} \times \mathbf{\hat{j}_{A}}"
216.     assert latex(x*Cross(A.i, A.j)) == \
217.         r"x \left(\mathbf{\hat{i}_{A}} \times \mathbf{\hat{j}_{A}}\right)"
218.     assert latex(Cross(x*A.i, A.j)) == \
219.         r'- \mathbf{\hat{j}_{A}} \times \left((x)\mathbf{\hat{i}_{A}}\right)'
220. 
221.     assert latex(Curl(3*A.x*A.j)) == \
222.         r"\nabla\times \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)"
223.     assert latex(Curl(3*A.x*A.j+A.i)) == \
224.         r"\nabla\times \left(\mathbf{\hat{i}_{A}} + (3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)"
225.     assert latex(Curl(3*x*A.x*A.j)) == \
226.         r"\nabla\times \left((3 \mathbf{{x}_{A}} x)\mathbf{\hat{j}_{A}}\right)"
227.     assert latex(x*Curl(3*A.x*A.j)) == \
228.         r"x \left(\nabla\times \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)\right)"
229. 
230.     assert latex(Divergence(3*A.x*A.j+A.i)) == \
231.         r"\nabla\cdot \left(\mathbf{\hat{i}_{A}} + (3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)"
232.     assert latex(Divergence(3*A.x*A.j)) == \
233.         r"\nabla\cdot \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)"
234.     assert latex(x*Divergence(3*A.x*A.j)) == \
235.         r"x \left(\nabla\cdot \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)\right)"
236. 
237.     assert latex(Dot(A.i, A.j*A.x*3+A.k)) == \
238.         r"\mathbf{\hat{i}_{A}} \cdot \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}} + \mathbf{\hat{k}_{A}}\right)"
239.     assert latex(Dot(A.i, A.j)) == \
240.         r"\mathbf{\hat{i}_{A}} \cdot \mathbf{\hat{j}_{A}}"
241.     assert latex(Dot(x*A.i, A.j)) == \
242.         r"\mathbf{\hat{j}_{A}} \cdot \left((x)\mathbf{\hat{i}_{A}}\right)"
243.     assert latex(x*Dot(A.i, A.j)) == \
244.         r"x \left(\mathbf{\hat{i}_{A}} \cdot \mathbf{\hat{j}_{A}}\right)"
245. 
246.     assert latex(Gradient(A.x)) == r"\nabla \mathbf{{x}_{A}}"
247.     assert latex(Gradient(A.x + 3*A.y)) == \
248.         r"\nabla \left(\mathbf{{x}_{A}} + 3 \mathbf{{y}_{A}}\right)"
249.     assert latex(x*Gradient(A.x)) == r"x \left(\nabla \mathbf{{x}_{A}}\right)"
250.     assert latex(Gradient(x*A.x)) == r"\nabla \left(\mathbf{{x}_{A}} x\right)"
251. 
252.     assert latex(Laplacian(A.x)) == r"\triangle \mathbf{{x}_{A}}"
253.     assert latex(Laplacian(A.x + 3*A.y)) == \
254.         r"\triangle \left(\mathbf{{x}_{A}} + 3 \mathbf{{y}_{A}}\right)"
255.     assert latex(x*Laplacian(A.x)) == r"x \left(\triangle \mathbf{{x}_{A}}\right)"
256.     assert latex(Laplacian(x*A.x)) == r"\triangle \left(\mathbf{{x}_{A}} x\right)"
257. 
258. def test_latex_symbols():
259.     Gamma, lmbda, rho = symbols('Gamma, lambda, rho')
260.     tau, Tau, TAU, taU = symbols('tau, Tau, TAU, taU')
261.     assert latex(tau) == r"\tau"
262.     assert latex(Tau) == "T"
263.     assert latex(TAU) == r"\tau"
264.     assert latex(taU) == r"\tau"
265.     # Check that all capitalized greek letters are handled explicitly
266.     capitalized_letters = set(l.capitalize() for l in greek_letters_set)
267.     assert len(capitalized_letters - set(tex_greek_dictionary.keys())) == 0
268.     assert latex(Gamma + lmbda) == r"\Gamma + \lambda"
269.     assert latex(Gamma * lmbda) == r"\Gamma \lambda"
270.     assert latex(Symbol('q1')) == r"q_{1}"
271.     assert latex(Symbol('q21')) == r"q_{21}"
272.     assert latex(Symbol('epsilon0')) == r"\epsilon_{0}"
273.     assert latex(Symbol('omega1')) == r"\omega_{1}"
274.     assert latex(Symbol('91')) == r"91"
275.     assert latex(Symbol('alpha_new')) == r"\alpha_{new}"
276.     assert latex(Symbol('C^orig')) == r"C^{orig}"
277.     assert latex(Symbol('x^alpha')) == r"x^{\alpha}"
278.     assert latex(Symbol('beta^alpha')) == r"\beta^{\alpha}"
279.     assert latex(Symbol('e^Alpha')) == r"e^{A}"
280.     assert latex(Symbol('omega_alpha^beta')) == r"\omega^{\beta}_{\alpha}"
281.     assert latex(Symbol('omega') ** Symbol('beta')) == r"\omega^{\beta}"
282. 
283. 
284. @XFAIL
285. def test_latex_symbols_failing():
286.     rho, mass, volume = symbols('rho, mass, volume')
287.     assert latex(
288.         volume * rho == mass) == r"\rho \mathrm{volume} = \mathrm{mass}"
289.     assert latex(volume / mass * rho == 1) == \
290.         r"\rho \mathrm{volume} {\mathrm{mass}}^{(-1)} = 1"
291.     assert latex(mass**3 * volume**3) == \
292.         r"{\mathrm{mass}}^{3} \cdot {\mathrm{volume}}^{3}"
293. 
294. 
295. def test_latex_functions():
296.     assert latex(exp(x)) == "e^{x}"
297.     assert latex(exp(1) + exp(2)) == "e + e^{2}"
298. 
299.     f = Function('f')
300.     assert latex(f(x)) == r'f{\left(x \right)}'
301.     assert latex(f) == r'f'
302. 
303.     g = Function('g')
304.     assert latex(g(x, y)) == r'g{\left(x,y \right)}'
305.     assert latex(g) == r'g'
306. 
307.     h = Function('h')
308.     assert latex(h(x, y, z)) == r'h{\left(x,y,z \right)}'
309.     assert latex(h) == r'h'
310. 
311.     Li = Function('Li')
312.     assert latex(Li) == r'\operatorname{Li}'
313.     assert latex(Li(x)) == r'\operatorname{Li}{\left(x \right)}'
314. 
315.     mybeta = Function('beta')
316.     # not to be confused with the beta function
317.     assert latex(mybeta(x, y, z)) == r"\beta{\left(x,y,z \right)}"
318.     assert latex(beta(x, y)) == r'\operatorname{B}\left(x, y\right)'
319.     assert latex(beta(x, y)**2) == r'\operatorname{B}^{2}\left(x, y\right)'
320.     assert latex(mybeta(x)) == r"\beta{\left(x \right)}"
321.     assert latex(mybeta) == r"\beta"
322. 
323.     g = Function('gamma')
324.     # not to be confused with the gamma function
325.     assert latex(g(x, y, z)) == r"\gamma{\left(x,y,z \right)}"
326.     assert latex(g(x)) == r"\gamma{\left(x \right)}"
327.     assert latex(g) == r"\gamma"
328. 
329.     a1 = Function('a_1')
330. 
331.     assert latex(a1) == r"\operatorname{a_{1}}"
332.     assert latex(a1(x)) == r"\operatorname{a_{1}}{\left(x \right)}"
333. 
334.     # issue 5868
335.     omega1 = Function('omega1')
336.     assert latex(omega1) == r"\omega_{1}"
337.     assert latex(omega1(x)) == r"\omega_{1}{\left(x \right)}"
338. 
339.     assert latex(sin(x)) == r"\sin{\left(x \right)}"
340.     assert latex(sin(x), fold_func_brackets=True) == r"\sin {x}"
341.     assert latex(sin(2*x**2), fold_func_brackets=True) == \
342.         r"\sin {2 x^{2}}"
343.     assert latex(sin(x**2), fold_func_brackets=True) == \
344.         r"\sin {x^{2}}"
345. 
346.     assert latex(asin(x)**2) == r"\operatorname{asin}^{2}{\left(x \right)}"
347.     assert latex(asin(x)**2, inv_trig_style="full") == \
348.         r"\arcsin^{2}{\left(x \right)}"
349.     assert latex(asin(x)**2, inv_trig_style="power") == \
350.         r"\sin^{-1}{\left(x \right)}^{2}"
351.     assert latex(asin(x**2), inv_trig_style="power",
352.                  fold_func_brackets=True) == \
353.         r"\sin^{-1} {x^{2}}"
354.     assert latex(acsc(x), inv_trig_style="full") == \
355.         r"\operatorname{arccsc}{\left(x \right)}"
356. 
357.     assert latex(factorial(k)) == r"k!"
358.     assert latex(factorial(-k)) == r"\left(- k\right)!"
359.     assert latex(factorial(k)**2) == r"k!^{2}"
360. 
361.     assert latex(subfactorial(k)) == r"!k"
362.     assert latex(subfactorial(-k)) == r"!\left(- k\right)"
363.     assert latex(subfactorial(k)**2) == r"\left(!k\right)^{2}"
364. 
365.     assert latex(factorial2(k)) == r"k!!"
366.     assert latex(factorial2(-k)) == r"\left(- k\right)!!"
367.     assert latex(factorial2(k)**2) == r"k!!^{2}"
368. 
369.     assert latex(binomial(2, k)) == r"{\binom{2}{k}}"
370.     assert latex(binomial(2, k)**2) == r"{\binom{2}{k}}^{2}"
371. 
372.     assert latex(FallingFactorial(3, k)) == r"{\left(3\right)}_{k}"
373.     assert latex(RisingFactorial(3, k)) == r"{3}^{\left(k\right)}"
374. 
375.     assert latex(floor(x)) == r"\left\lfloor{x}\right\rfloor"
376.     assert latex(ceiling(x)) == r"\left\lceil{x}\right\rceil"
377.     assert latex(frac(x)) == r"\operatorname{frac}{\left(x\right)}"
378.     assert latex(floor(x)**2) == r"\left\lfloor{x}\right\rfloor^{2}"
379.     assert latex(ceiling(x)**2) == r"\left\lceil{x}\right\rceil^{2}"
380.     assert latex(frac(x)**2) == r"\operatorname{frac}{\left(x\right)}^{2}"
381. 
382.     assert latex(Min(x, 2, x**3)) == r"\min\left(2, x, x^{3}\right)"
383.     assert latex(Min(x, y)**2) == r"\min\left(x, y\right)^{2}"
384.     assert latex(Max(x, 2, x**3)) == r"\max\left(2, x, x^{3}\right)"
385.     assert latex(Max(x, y)**2) == r"\max\left(x, y\right)^{2}"
386.     assert latex(Abs(x)) == r"\left|{x}\right|"
387.     assert latex(Abs(x)**2) == r"\left|{x}\right|^{2}"
388.     assert latex(re(x)) == r"\operatorname{re}{\left(x\right)}"
389.     assert latex(re(x + y)) == \
390.         r"\operatorname{re}{\left(x\right)} + \operatorname{re}{\left(y\right)}"
391.     assert latex(im(x)) == r"\operatorname{im}{\left(x\right)}"
392.     assert latex(conjugate(x)) == r"\overline{x}"
393.     assert latex(conjugate(x)**2) == r"\overline{x}^{2}"
394.     assert latex(conjugate(x**2)) == r"\overline{x}^{2}"
395.     assert latex(gamma(x)) == r"\Gamma\left(x\right)"
396.     w = Wild('w')
397.     assert latex(gamma(w)) == r"\Gamma\left(w\right)"
398.     assert latex(Order(x)) == r"O\left(x\right)"
399.     assert latex(Order(x, x)) == r"O\left(x\right)"
400.     assert latex(Order(x, (x, 0))) == r"O\left(x\right)"
401.     assert latex(Order(x, (x, oo))) == r"O\left(x; x\rightarrow \infty\right)"
402.     assert latex(Order(x - y, (x, y))) == \
403.         r"O\left(x - y; x\rightarrow y\right)"
404.     assert latex(Order(x, x, y)) == \
405.         r"O\left(x; \left( x, \  y\right)\rightarrow \left( 0, \  0\right)\right)"
406.     assert latex(Order(x, x, y)) == \
407.         r"O\left(x; \left( x, \  y\right)\rightarrow \left( 0, \  0\right)\right)"
408.     assert latex(Order(x, (x, oo), (y, oo))) == \
409.         r"O\left(x; \left( x, \  y\right)\rightarrow \left( \infty, \  \infty\right)\right)"
410.     assert latex(lowergamma(x, y)) == r'\gamma\left(x, y\right)'
411.     assert latex(lowergamma(x, y)**2) == r'\gamma^{2}\left(x, y\right)'
412.     assert latex(uppergamma(x, y)) == r'\Gamma\left(x, y\right)'
413.     assert latex(uppergamma(x, y)**2) == r'\Gamma^{2}\left(x, y\right)'
414. 
415.     assert latex(cot(x)) == r'\cot{\left(x \right)}'
416.     assert latex(coth(x)) == r'\coth{\left(x \right)}'
417.     assert latex(re(x)) == r'\operatorname{re}{\left(x\right)}'
418.     assert latex(im(x)) == r'\operatorname{im}{\left(x\right)}'
419.     assert latex(root(x, y)) == r'x^{\frac{1}{y}}'
420.     assert latex(arg(x)) == r'\arg{\left(x \right)}'
421. 
422.     assert latex(zeta(x)) == r"\zeta\left(x\right)"
423.     assert latex(zeta(x)**2) == r"\zeta^{2}\left(x\right)"
424.     assert latex(zeta(x, y)) == r"\zeta\left(x, y\right)"
425.     assert latex(zeta(x, y)**2) == r"\zeta^{2}\left(x, y\right)"
426.     assert latex(dirichlet_eta(x)) == r"\eta\left(x\right)"
427.     assert latex(dirichlet_eta(x)**2) == r"\eta^{2}\left(x\right)"
428.     assert latex(polylog(x, y)) == r"\operatorname{Li}_{x}\left(y\right)"
429.     assert latex(
430.         polylog(x, y)**2) == r"\operatorname{Li}_{x}^{2}\left(y\right)"
431.     assert latex(lerchphi(x, y, n)) == r"\Phi\left(x, y, n\right)"
432.     assert latex(lerchphi(x, y, n)**2) == r"\Phi^{2}\left(x, y, n\right)"
433.     assert latex(stieltjes(x)) == r"\gamma_{x}"
434.     assert latex(stieltjes(x)**2) == r"\gamma_{x}^{2}"
435.     assert latex(stieltjes(x, y)) == r"\gamma_{x}\left(y\right)"
436.     assert latex(stieltjes(x, y)**2) == r"\gamma_{x}\left(y\right)^{2}"
437. 
438.     assert latex(elliptic_k(z)) == r"K\left(z\right)"
439.     assert latex(elliptic_k(z)**2) == r"K^{2}\left(z\right)"
440.     assert latex(elliptic_f(x, y)) == r"F\left(x\middle| y\right)"
441.     assert latex(elliptic_f(x, y)**2) == r"F^{2}\left(x\middle| y\right)"
442.     assert latex(elliptic_e(x, y)) == r"E\left(x\middle| y\right)"
443.     assert latex(elliptic_e(x, y)**2) == r"E^{2}\left(x\middle| y\right)"
444.     assert latex(elliptic_e(z)) == r"E\left(z\right)"
445.     assert latex(elliptic_e(z)**2) == r"E^{2}\left(z\right)"
446.     assert latex(elliptic_pi(x, y, z)) == r"\Pi\left(x; y\middle| z\right)"
447.     assert latex(elliptic_pi(x, y, z)**2) == \
448.         r"\Pi^{2}\left(x; y\middle| z\right)"
449.     assert latex(elliptic_pi(x, y)) == r"\Pi\left(x\middle| y\right)"
450.     assert latex(elliptic_pi(x, y)**2) == r"\Pi^{2}\left(x\middle| y\right)"
451. 
452.     assert latex(Ei(x)) == r'\operatorname{Ei}{\left(x \right)}'
453.     assert latex(Ei(x)**2) == r'\operatorname{Ei}^{2}{\left(x \right)}'
454.     assert latex(expint(x, y)) == r'\operatorname{E}_{x}\left(y\right)'
455.     assert latex(expint(x, y)**2) == r'\operatorname{E}_{x}^{2}\left(y\right)'
456.     assert latex(Shi(x)**2) == r'\operatorname{Shi}^{2}{\left(x \right)}'
457.     assert latex(Si(x)**2) == r'\operatorname{Si}^{2}{\left(x \right)}'
458.     assert latex(Ci(x)**2) == r'\operatorname{Ci}^{2}{\left(x \right)}'
459.     assert latex(Chi(x)**2) == r'\operatorname{Chi}^{2}\left(x\right)'
460.     assert latex(Chi(x)) == r'\operatorname{Chi}\left(x\right)'
461.     assert latex(jacobi(n, a, b, x)) == \
462.         r'P_{n}^{\left(a,b\right)}\left(x\right)'
463.     assert latex(jacobi(n, a, b, x)**2) == \
464.         r'\left(P_{n}^{\left(a,b\right)}\left(x\right)\right)^{2}'
465.     assert latex(gegenbauer(n, a, x)) == \
466.         r'C_{n}^{\left(a\right)}\left(x\right)'
467.     assert latex(gegenbauer(n, a, x)**2) == \
468.         r'\left(C_{n}^{\left(a\right)}\left(x\right)\right)^{2}'
469.     assert latex(chebyshevt(n, x)) == r'T_{n}\left(x\right)'
470.     assert latex(chebyshevt(n, x)**2) == \
471.         r'\left(T_{n}\left(x\right)\right)^{2}'
472.     assert latex(chebyshevu(n, x)) == r'U_{n}\left(x\right)'
473.     assert latex(chebyshevu(n, x)**2) == \
474.         r'\left(U_{n}\left(x\right)\right)^{2}'
475.     assert latex(legendre(n, x)) == r'P_{n}\left(x\right)'
476.     assert latex(legendre(n, x)**2) == r'\left(P_{n}\left(x\right)\right)^{2}'
477.     assert latex(assoc_legendre(n, a, x)) == \
478.         r'P_{n}^{\left(a\right)}\left(x\right)'
479.     assert latex(assoc_legendre(n, a, x)**2) == \
480.         r'\left(P_{n}^{\left(a\right)}\left(x\right)\right)^{2}'
481.     assert latex(laguerre(n, x)) == r'L_{n}\left(x\right)'
482.     assert latex(laguerre(n, x)**2) == r'\left(L_{n}\left(x\right)\right)^{2}'
483.     assert latex(assoc_laguerre(n, a, x)) == \
484.         r'L_{n}^{\left(a\right)}\left(x\right)'
485.     assert latex(assoc_laguerre(n, a, x)**2) == \
486.         r'\left(L_{n}^{\left(a\right)}\left(x\right)\right)^{2}'
487.     assert latex(hermite(n, x)) == r'H_{n}\left(x\right)'
488.     assert latex(hermite(n, x)**2) == r'\left(H_{n}\left(x\right)\right)^{2}'
489. 
490.     theta = Symbol("theta", real=True)
491.     phi = Symbol("phi", real=True)
492.     assert latex(Ynm(n, m, theta, phi)) == r'Y_{n}^{m}\left(\theta,\phi\right)'
493.     assert latex(Ynm(n, m, theta, phi)**3) == \
494.         r'\left(Y_{n}^{m}\left(\theta,\phi\right)\right)^{3}'
495.     assert latex(Znm(n, m, theta, phi)) == r'Z_{n}^{m}\left(\theta,\phi\right)'
496.     assert latex(Znm(n, m, theta, phi)**3) == \
497.         r'\left(Z_{n}^{m}\left(\theta,\phi\right)\right)^{3}'
498. 
499.     # Test latex printing of function names with "_"
500.     assert latex(polar_lift(0)) == \

File: sympy/printing/tests/test_latex.py
Line number range: 501 - 1001
Content:
501.         r"\operatorname{polar\_lift}{\left(0 \right)}"
502.     assert latex(polar_lift(0)**3) == \
503.         r"\operatorname{polar\_lift}^{3}{\left(0 \right)}"
504. 
505.     assert latex(totient(n)) == r'\phi\left(n\right)'
506.     assert latex(totient(n) ** 2) == r'\left(\phi\left(n\right)\right)^{2}'
507. 
508.     assert latex(reduced_totient(n)) == r'\lambda\left(n\right)'
509.     assert latex(reduced_totient(n) ** 2) == \
510.         r'\left(\lambda\left(n\right)\right)^{2}'
511. 
512.     assert latex(divisor_sigma(x)) == r"\sigma\left(x\right)"
513.     assert latex(divisor_sigma(x)**2) == r"\sigma^{2}\left(x\right)"
514.     assert latex(divisor_sigma(x, y)) == r"\sigma_y\left(x\right)"
515.     assert latex(divisor_sigma(x, y)**2) == r"\sigma^{2}_y\left(x\right)"
516. 
517.     assert latex(udivisor_sigma(x)) == r"\sigma^*\left(x\right)"
518.     assert latex(udivisor_sigma(x)**2) == r"\sigma^*^{2}\left(x\right)"
519.     assert latex(udivisor_sigma(x, y)) == r"\sigma^*_y\left(x\right)"
520.     assert latex(udivisor_sigma(x, y)**2) == r"\sigma^*^{2}_y\left(x\right)"
521. 
522.     assert latex(primenu(n)) == r'\nu\left(n\right)'
523.     assert latex(primenu(n) ** 2) == r'\left(\nu\left(n\right)\right)^{2}'
524. 
525.     assert latex(primeomega(n)) == r'\Omega\left(n\right)'
526.     assert latex(primeomega(n) ** 2) == \
527.         r'\left(\Omega\left(n\right)\right)^{2}'
528. 
529.     assert latex(LambertW(n)) == r'W\left(n\right)'
530.     assert latex(LambertW(n, -1)) == r'W_{-1}\left(n\right)'
531.     assert latex(LambertW(n, k)) == r'W_{k}\left(n\right)'
532. 
533.     assert latex(Mod(x, 7)) == r'x\bmod{7}'
534.     assert latex(Mod(x + 1, 7)) == r'\left(x + 1\right)\bmod{7}'
535.     assert latex(Mod(2 * x, 7)) == r'2 x\bmod{7}'
536.     assert latex(Mod(x, 7) + 1) == r'\left(x\bmod{7}\right) + 1'
537.     assert latex(2 * Mod(x, 7)) == r'2 \left(x\bmod{7}\right)'
538. 
539.     # some unknown function name should get rendered with \operatorname
540.     fjlkd = Function('fjlkd')
541.     assert latex(fjlkd(x)) == r'\operatorname{fjlkd}{\left(x \right)}'
542.     # even when it is referred to without an argument
543.     assert latex(fjlkd) == r'\operatorname{fjlkd}'
544. 
545. 
546. # test that notation passes to subclasses of the same name only
547. def test_function_subclass_different_name():
548.     class mygamma(gamma):
549.         pass
550.     assert latex(mygamma) == r"\operatorname{mygamma}"
551.     assert latex(mygamma(x)) == r"\operatorname{mygamma}{\left(x \right)}"
552. 
553. 
554. def test_hyper_printing():
555.     from sympy import pi
556.     from sympy.abc import x, z
557. 
558.     assert latex(meijerg(Tuple(pi, pi, x), Tuple(1),
559.                          (0, 1), Tuple(1, 2, 3/pi), z)) == \
560.         r'{G_{4, 5}^{2, 3}\left(\begin{matrix} \pi, \pi, x & 1 \\0, 1 & 1, 2, '\
561.         r'\frac{3}{\pi} \end{matrix} \middle| {z} \right)}'
562.     assert latex(meijerg(Tuple(), Tuple(1), (0,), Tuple(), z)) == \
563.         r'{G_{1, 1}^{1, 0}\left(\begin{matrix}  & 1 \\0 &  \end{matrix} \middle| {z} \right)}'
564.     assert latex(hyper((x, 2), (3,), z)) == \
565.         r'{{}_{2}F_{1}\left(\begin{matrix} x, 2 ' \
566.         r'\\ 3 \end{matrix}\middle| {z} \right)}'
567.     assert latex(hyper(Tuple(), Tuple(1), z)) == \
568.         r'{{}_{0}F_{1}\left(\begin{matrix}  ' \
569.         r'\\ 1 \end{matrix}\middle| {z} \right)}'
570. 
571. 
572. def test_latex_bessel():
573.     from sympy.functions.special.bessel import (besselj, bessely, besseli,
574.                                                 besselk, hankel1, hankel2,
575.                                                 jn, yn, hn1, hn2)
576.     from sympy.abc import z
577.     assert latex(besselj(n, z**2)**k) == r'J^{k}_{n}\left(z^{2}\right)'
578.     assert latex(bessely(n, z)) == r'Y_{n}\left(z\right)'
579.     assert latex(besseli(n, z)) == r'I_{n}\left(z\right)'
580.     assert latex(besselk(n, z)) == r'K_{n}\left(z\right)'
581.     assert latex(hankel1(n, z**2)**2) == \
582.         r'\left(H^{(1)}_{n}\left(z^{2}\right)\right)^{2}'
583.     assert latex(hankel2(n, z)) == r'H^{(2)}_{n}\left(z\right)'
584.     assert latex(jn(n, z)) == r'j_{n}\left(z\right)'
585.     assert latex(yn(n, z)) == r'y_{n}\left(z\right)'
586.     assert latex(hn1(n, z)) == r'h^{(1)}_{n}\left(z\right)'
587.     assert latex(hn2(n, z)) == r'h^{(2)}_{n}\left(z\right)'
588. 
589. 
590. def test_latex_fresnel():
591.     from sympy.functions.special.error_functions import (fresnels, fresnelc)
592.     from sympy.abc import z
593.     assert latex(fresnels(z)) == r'S\left(z\right)'
594.     assert latex(fresnelc(z)) == r'C\left(z\right)'
595.     assert latex(fresnels(z)**2) == r'S^{2}\left(z\right)'
596.     assert latex(fresnelc(z)**2) == r'C^{2}\left(z\right)'
597. 
598. 
599. def test_latex_brackets():
600.     assert latex((-1)**x) == r"\left(-1\right)^{x}"
601. 
602. 
603. def test_latex_indexed():
604.     Psi_symbol = Symbol('Psi_0', complex=True, real=False)
605.     Psi_indexed = IndexedBase(Symbol('Psi', complex=True, real=False))
606.     symbol_latex = latex(Psi_symbol * conjugate(Psi_symbol))
607.     indexed_latex = latex(Psi_indexed[0] * conjugate(Psi_indexed[0]))
608.     # \\overline{{\\Psi}_{0}} {\\Psi}_{0}  vs.  \\Psi_{0} \\overline{\\Psi_{0}}
609.     assert symbol_latex == '\\Psi_{0} \\overline{\\Psi_{0}}'
610.     assert indexed_latex == '\\overline{{\\Psi}_{0}} {\\Psi}_{0}'
611. 
612.     # Symbol('gamma') gives r'\gamma'
613.     assert latex(Indexed('x1', Symbol('i'))) == '{x_{1}}_{i}'
614.     assert latex(IndexedBase('gamma')) == r'\gamma'
615.     assert latex(IndexedBase('a b')) == 'a b'
616.     assert latex(IndexedBase('a_b')) == 'a_{b}'
617. 
618. 
619. def test_latex_derivatives():
620.     # regular "d" for ordinary derivatives
621.     assert latex(diff(x**3, x, evaluate=False)) == \
622.         r"\frac{d}{d x} x^{3}"
623.     assert latex(diff(sin(x) + x**2, x, evaluate=False)) == \
624.         r"\frac{d}{d x} \left(x^{2} + \sin{\left(x \right)}\right)"
625.     assert latex(diff(diff(sin(x) + x**2, x, evaluate=False), evaluate=False))\
626.         == \
627.         r"\frac{d^{2}}{d x^{2}} \left(x^{2} + \sin{\left(x \right)}\right)"
628.     assert latex(diff(diff(diff(sin(x) + x**2, x, evaluate=False), evaluate=False), evaluate=False)) == \
629.         r"\frac{d^{3}}{d x^{3}} \left(x^{2} + \sin{\left(x \right)}\right)"
630. 
631.     # \partial for partial derivatives
632.     assert latex(diff(sin(x * y), x, evaluate=False)) == \
633.         r"\frac{\partial}{\partial x} \sin{\left(x y \right)}"
634.     assert latex(diff(sin(x * y) + x**2, x, evaluate=False)) == \
635.         r"\frac{\partial}{\partial x} \left(x^{2} + \sin{\left(x y \right)}\right)"
636.     assert latex(diff(diff(sin(x*y) + x**2, x, evaluate=False), x, evaluate=False)) == \
637.         r"\frac{\partial^{2}}{\partial x^{2}} \left(x^{2} + \sin{\left(x y \right)}\right)"
638.     assert latex(diff(diff(diff(sin(x*y) + x**2, x, evaluate=False), x, evaluate=False), x, evaluate=False)) == \
639.         r"\frac{\partial^{3}}{\partial x^{3}} \left(x^{2} + \sin{\left(x y \right)}\right)"
640. 
641.     # mixed partial derivatives
642.     f = Function("f")
643.     assert latex(diff(diff(f(x, y), x, evaluate=False), y, evaluate=False)) == \
644.         r"\frac{\partial^{2}}{\partial y\partial x} " + latex(f(x, y))
645. 
646.     assert latex(diff(diff(diff(f(x, y), x, evaluate=False), x, evaluate=False), y, evaluate=False)) == \
647.         r"\frac{\partial^{3}}{\partial y\partial x^{2}} " + latex(f(x, y))
648. 
649.     # use ordinary d when one of the variables has been integrated out
650.     assert latex(diff(Integral(exp(-x*y), (x, 0, oo)), y, evaluate=False)) == \
651.         r"\frac{d}{d y} \int\limits_{0}^{\infty} e^{- x y}\, dx"
652. 
653.     # Derivative wrapped in power:
654.     assert latex(diff(x, x, evaluate=False)**2) == \
655.         r"\left(\frac{d}{d x} x\right)^{2}"
656. 
657.     assert latex(diff(f(x), x)**2) == \
658.         r"\left(\frac{d}{d x} f{\left(x \right)}\right)^{2}"
659. 
660.     assert latex(diff(f(x), (x, n))) == \
661.         r"\frac{d^{n}}{d x^{n}} f{\left(x \right)}"
662. 
663.     x1 = Symbol('x1')
664.     x2 = Symbol('x2')
665.     assert latex(diff(f(x1, x2), x1)) == r'\frac{\partial}{\partial x_{1}} f{\left(x_{1},x_{2} \right)}'
666. 
667.     n1 = Symbol('n1')
668.     assert latex(diff(f(x), (x, n1))) ==  r'\frac{d^{n_{1}}}{d x^{n_{1}}} f{\left(x \right)}'
669. 
670.     n2 = Symbol('n2')
671.     assert latex(diff(f(x), (x, Max(n1, n2)))) == \
672.         r'\frac{d^{\max\left(n_{1}, n_{2}\right)}}{d x^{\max\left(n_{1}, n_{2}\right)}} f{\left(x \right)}'
673. 
674. 
675. def test_latex_subs():
676.     assert latex(Subs(x*y, (
677.         x, y), (1, 2))) == r'\left. x y \right|_{\substack{ x=1\\ y=2 }}'
678. 
679. 
680. def test_latex_integrals():
681.     assert latex(Integral(log(x), x)) == r"\int \log{\left(x \right)}\, dx"
682.     assert latex(Integral(x**2, (x, 0, 1))) == \
683.         r"\int\limits_{0}^{1} x^{2}\, dx"
684.     assert latex(Integral(x**2, (x, 10, 20))) == \
685.         r"\int\limits_{10}^{20} x^{2}\, dx"
686.     assert latex(Integral(y*x**2, (x, 0, 1), y)) == \
687.         r"\int\int\limits_{0}^{1} x^{2} y\, dx\, dy"
688.     assert latex(Integral(y*x**2, (x, 0, 1), y), mode='equation*') == \
689.         r"\begin{equation*}\int\int\limits_{0}^{1} x^{2} y\, dx\, dy\end{equation*}"
690.     assert latex(Integral(y*x**2, (x, 0, 1), y), mode='equation*', itex=True) \
691.         == r"$$\int\int_{0}^{1} x^{2} y\, dx\, dy$$"
692.     assert latex(Integral(x, (x, 0))) == r"\int\limits^{0} x\, dx"
693.     assert latex(Integral(x*y, x, y)) == r"\iint x y\, dx\, dy"
694.     assert latex(Integral(x*y*z, x, y, z)) == r"\iiint x y z\, dx\, dy\, dz"
695.     assert latex(Integral(x*y*z*t, x, y, z, t)) == \
696.         r"\iiiint t x y z\, dx\, dy\, dz\, dt"
697.     assert latex(Integral(x, x, x, x, x, x, x)) == \
698.         r"\int\int\int\int\int\int x\, dx\, dx\, dx\, dx\, dx\, dx"
699.     assert latex(Integral(x, x, y, (z, 0, 1))) == \
700.         r"\int\limits_{0}^{1}\int\int x\, dx\, dy\, dz"
701. 
702.     # fix issue #10806
703.     assert latex(Integral(z, z)**2) == r"\left(\int z\, dz\right)^{2}"
704.     assert latex(Integral(x + z, z)) == r"\int \left(x + z\right)\, dz"
705.     assert latex(Integral(x+z/2, z)) == \
706.         r"\int \left(x + \frac{z}{2}\right)\, dz"
707.     assert latex(Integral(x**y, z)) == r"\int x^{y}\, dz"
708. 
709. 
710. def test_latex_sets():
711.     for s in (frozenset, set):
712.         assert latex(s([x*y, x**2])) == r"\left\{x^{2}, x y\right\}"
713.         assert latex(s(range(1, 6))) == r"\left\{1, 2, 3, 4, 5\right\}"
714.         assert latex(s(range(1, 13))) == \
715.             r"\left\{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12\right\}"
716. 
717.     s = FiniteSet
718.     assert latex(s(*[x*y, x**2])) == r"\left\{x^{2}, x y\right\}"
719.     assert latex(s(*range(1, 6))) == r"\left\{1, 2, 3, 4, 5\right\}"
720.     assert latex(s(*range(1, 13))) == \
721.         r"\left\{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12\right\}"
722. 
723. 
724. def test_latex_SetExpr():
725.     iv = Interval(1, 3)
726.     se = SetExpr(iv)
727.     assert latex(se) == r"SetExpr\left(\left[1, 3\right]\right)"
728. 
729. 
730. def test_latex_Range():
731.     assert latex(Range(1, 51)) == \
732.         r'\left\{1, 2, \ldots, 50\right\}'
733.     assert latex(Range(1, 4)) == r'\left\{1, 2, 3\right\}'
734. 
735.     assert latex(Range(0, 3, 1)) == r'\left\{0, 1, 2\right\}'
736. 
737.     assert latex(Range(0, 30, 1)) == r'\left\{0, 1, \ldots, 29\right\}'
738. 
739.     assert latex(Range(30, 1, -1)) == r'\left\{30, 29, \ldots, 2\right\}'
740. 
741.     assert latex(Range(0, oo, 2)) == r'\left\{0, 2, \ldots\right\}'
742. 
743.     assert latex(Range(oo, -2, -2)) == r'\left\{\ldots, 2, 0\right\}'
744. 
745.     assert latex(Range(-2, -oo, -1)) == \
746.         r'\left\{-2, -3, \ldots\right\}'
747. 
748. 
749. def test_latex_sequences():
750.     s1 = SeqFormula(a**2, (0, oo))
751.     s2 = SeqPer((1, 2))
752. 
753.     latex_str = r'\left[0, 1, 4, 9, \ldots\right]'
754.     assert latex(s1) == latex_str
755. 
756.     latex_str = r'\left[1, 2, 1, 2, \ldots\right]'
757.     assert latex(s2) == latex_str
758. 
759.     s3 = SeqFormula(a**2, (0, 2))
760.     s4 = SeqPer((1, 2), (0, 2))
761. 
762.     latex_str = r'\left[0, 1, 4\right]'
763.     assert latex(s3) == latex_str
764. 
765.     latex_str = r'\left[1, 2, 1\right]'
766.     assert latex(s4) == latex_str
767. 
768.     s5 = SeqFormula(a**2, (-oo, 0))
769.     s6 = SeqPer((1, 2), (-oo, 0))
770. 
771.     latex_str = r'\left[\ldots, 9, 4, 1, 0\right]'
772.     assert latex(s5) == latex_str
773. 
774.     latex_str = r'\left[\ldots, 2, 1, 2, 1\right]'
775.     assert latex(s6) == latex_str
776. 
777.     latex_str = r'\left[1, 3, 5, 11, \ldots\right]'
778.     assert latex(SeqAdd(s1, s2)) == latex_str
779. 
780.     latex_str = r'\left[1, 3, 5\right]'
781.     assert latex(SeqAdd(s3, s4)) == latex_str
782. 
783.     latex_str = r'\left[\ldots, 11, 5, 3, 1\right]'
784.     assert latex(SeqAdd(s5, s6)) == latex_str
785. 
786.     latex_str = r'\left[0, 2, 4, 18, \ldots\right]'
787.     assert latex(SeqMul(s1, s2)) == latex_str
788. 
789.     latex_str = r'\left[0, 2, 4\right]'
790.     assert latex(SeqMul(s3, s4)) == latex_str
791. 
792.     latex_str = r'\left[\ldots, 18, 4, 2, 0\right]'
793.     assert latex(SeqMul(s5, s6)) == latex_str
794. 
795.     # Sequences with symbolic limits, issue 12629
796.     s7 = SeqFormula(a**2, (a, 0, x))
797.     latex_str = r'\left\{a^{2}\right\}_{a=0}^{x}'
798.     assert latex(s7) == latex_str
799. 
800.     b = Symbol('b')
801.     s8 = SeqFormula(b*a**2, (a, 0, 2))
802.     latex_str = r'\left[0, b, 4 b\right]'
803.     assert latex(s8) == latex_str
804. 
805. 
806. def test_latex_FourierSeries():
807.     latex_str = \
808.         r'2 \sin{\left(x \right)} - \sin{\left(2 x \right)} + \frac{2 \sin{\left(3 x \right)}}{3} + \ldots'
809.     assert latex(fourier_series(x, (x, -pi, pi))) == latex_str
810. 
811. 
812. def test_latex_FormalPowerSeries():
813.     latex_str = r'\sum_{k=1}^{\infty} - \frac{\left(-1\right)^{- k} x^{k}}{k}'
814.     assert latex(fps(log(1 + x))) == latex_str
815. 
816. 
817. def test_latex_intervals():
818.     a = Symbol('a', real=True)
819.     assert latex(Interval(0, 0)) == r"\left\{0\right\}"
820.     assert latex(Interval(0, a)) == r"\left[0, a\right]"
821.     assert latex(Interval(0, a, False, False)) == r"\left[0, a\right]"
822.     assert latex(Interval(0, a, True, False)) == r"\left(0, a\right]"
823.     assert latex(Interval(0, a, False, True)) == r"\left[0, a\right)"
824.     assert latex(Interval(0, a, True, True)) == r"\left(0, a\right)"
825. 
826. 
827. def test_latex_AccumuBounds():
828.     a = Symbol('a', real=True)
829.     assert latex(AccumBounds(0, 1)) == r"\left\langle 0, 1\right\rangle"
830.     assert latex(AccumBounds(0, a)) == r"\left\langle 0, a\right\rangle"
831.     assert latex(AccumBounds(a + 1, a + 2)) == \
832.         r"\left\langle a + 1, a + 2\right\rangle"
833. 
834. 
835. def test_latex_emptyset():
836.     assert latex(S.EmptySet) == r"\emptyset"
837. 
838. 
839. def test_latex_universalset():
840.     assert latex(S.UniversalSet) == r"\mathbb{U}"
841. 
842. 
843. def test_latex_commutator():
844.     A = Operator('A')
845.     B = Operator('B')
846.     comm = Commutator(B, A)
847.     assert latex(comm.doit()) == r"- (A B - B A)"
848. 
849. 
850. def test_latex_union():
851.     assert latex(Union(Interval(0, 1), Interval(2, 3))) == \
852.         r"\left[0, 1\right] \cup \left[2, 3\right]"
853.     assert latex(Union(Interval(1, 1), Interval(2, 2), Interval(3, 4))) == \
854.         r"\left\{1, 2\right\} \cup \left[3, 4\right]"
855. 
856. 
857. def test_latex_intersection():
858.     assert latex(Intersection(Interval(0, 1), Interval(x, y))) == \
859.         r"\left[0, 1\right] \cap \left[x, y\right]"
860. 
861. 
862. def test_latex_symmetric_difference():
863.     assert latex(SymmetricDifference(Interval(2, 5), Interval(4, 7),
864.                                      evaluate=False)) == \
865.         r'\left[2, 5\right] \triangle \left[4, 7\right]'
866. 
867. 
868. def test_latex_Complement():
869.     assert latex(Complement(S.Reals, S.Naturals)) == \
870.         r"\mathbb{R} \setminus \mathbb{N}"
871. 
872. 
873. def test_latex_productset():
874.     line = Interval(0, 1)
875.     bigline = Interval(0, 10)
876.     fset = FiniteSet(1, 2, 3)
877.     assert latex(line**2) == r"%s^{2}" % latex(line)
878.     assert latex(line**10) == r"%s^{10}" % latex(line)
879.     assert latex((line * bigline * fset).flatten()) == r"%s \times %s \times %s" % (
880.         latex(line), latex(bigline), latex(fset))
881. 
882. 
883. def test_set_operators_parenthesis():
884.     a, b, c, d = symbols('a:d')
885.     A = FiniteSet(a)
886.     B = FiniteSet(b)
887.     C = FiniteSet(c)
888.     D = FiniteSet(d)
889. 
890.     U1 = Union(A, B, evaluate=False)
891.     U2 = Union(C, D, evaluate=False)
892.     I1 = Intersection(A, B, evaluate=False)
893.     I2 = Intersection(C, D, evaluate=False)
894.     C1 = Complement(A, B, evaluate=False)
895.     C2 = Complement(C, D, evaluate=False)
896.     D1 = SymmetricDifference(A, B, evaluate=False)
897.     D2 = SymmetricDifference(C, D, evaluate=False)
898.     # XXX ProductSet does not support evaluate keyword
899.     P1 = ProductSet(A, B)
900.     P2 = ProductSet(C, D)
901. 
902.     assert latex(Intersection(A, U2, evaluate=False)) == \
903.         '\\left\\{a\\right\\} \\cap ' \
904.         '\\left(\\left\\{c\\right\\} \\cup \\left\\{d\\right\\}\\right)'
905.     assert latex(Intersection(U1, U2, evaluate=False)) == \
906.         '\\left(\\left\\{a\\right\\} \\cup \\left\\{b\\right\\}\\right) ' \
907.         '\\cap \\left(\\left\\{c\\right\\} \\cup \\left\\{d\\right\\}\\right)'
908.     assert latex(Intersection(C1, C2, evaluate=False)) == \
909.         '\\left(\\left\\{a\\right\\} \\setminus ' \
910.         '\\left\\{b\\right\\}\\right) \\cap \\left(\\left\\{c\\right\\} ' \
911.         '\\setminus \\left\\{d\\right\\}\\right)'
912.     assert latex(Intersection(D1, D2, evaluate=False)) == \
913.         '\\left(\\left\\{a\\right\\} \\triangle ' \
914.         '\\left\\{b\\right\\}\\right) \\cap \\left(\\left\\{c\\right\\} ' \
915.         '\\triangle \\left\\{d\\right\\}\\right)'
916.     assert latex(Intersection(P1, P2, evaluate=False)) == \
917.         '\\left(\\left\\{a\\right\\} \\times \\left\\{b\\right\\}\\right) ' \
918.         '\\cap \\left(\\left\\{c\\right\\} \\times ' \
919.         '\\left\\{d\\right\\}\\right)'
920. 
921.     assert latex(Union(A, I2, evaluate=False)) == \
922.         '\\left\\{a\\right\\} \\cup ' \
923.         '\\left(\\left\\{c\\right\\} \\cap \\left\\{d\\right\\}\\right)'
924.     assert latex(Union(I1, I2, evaluate=False)) == \
925.         '\\left(\\left\\{a\\right\\} \\cap ''\\left\\{b\\right\\}\\right) ' \
926.         '\\cup \\left(\\left\\{c\\right\\} \\cap \\left\\{d\\right\\}\\right)'
927.     assert latex(Union(C1, C2, evaluate=False)) == \
928.         '\\left(\\left\\{a\\right\\} \\setminus ' \
929.         '\\left\\{b\\right\\}\\right) \\cup \\left(\\left\\{c\\right\\} ' \
930.         '\\setminus \\left\\{d\\right\\}\\right)'
931.     assert latex(Union(D1, D2, evaluate=False)) == \
932.         '\\left(\\left\\{a\\right\\} \\triangle ' \
933.         '\\left\\{b\\right\\}\\right) \\cup \\left(\\left\\{c\\right\\} ' \
934.         '\\triangle \\left\\{d\\right\\}\\right)'
935.     assert latex(Union(P1, P2, evaluate=False)) == \
936.         '\\left(\\left\\{a\\right\\} \\times \\left\\{b\\right\\}\\right) ' \
937.         '\\cup \\left(\\left\\{c\\right\\} \\times ' \
938.         '\\left\\{d\\right\\}\\right)'
939. 
940.     assert latex(Complement(A, C2, evaluate=False)) == \
941.         '\\left\\{a\\right\\} \\setminus \\left(\\left\\{c\\right\\} ' \
942.         '\\setminus \\left\\{d\\right\\}\\right)'
943.     assert latex(Complement(U1, U2, evaluate=False)) == \
944.         '\\left(\\left\\{a\\right\\} \\cup \\left\\{b\\right\\}\\right) ' \
945.         '\\setminus \\left(\\left\\{c\\right\\} \\cup ' \
946.         '\\left\\{d\\right\\}\\right)'
947.     assert latex(Complement(I1, I2, evaluate=False)) == \
948.         '\\left(\\left\\{a\\right\\} \\cap \\left\\{b\\right\\}\\right) ' \
949.         '\\setminus \\left(\\left\\{c\\right\\} \\cap ' \
950.         '\\left\\{d\\right\\}\\right)'
951.     assert latex(Complement(D1, D2, evaluate=False)) == \
952.         '\\left(\\left\\{a\\right\\} \\triangle ' \
953.         '\\left\\{b\\right\\}\\right) \\setminus ' \
954.         '\\left(\\left\\{c\\right\\} \\triangle \\left\\{d\\right\\}\\right)'
955.     assert latex(Complement(P1, P2, evaluate=False)) == \
956.         '\\left(\\left\\{a\\right\\} \\times \\left\\{b\\right\\}\\right) '\
957.         '\\setminus \\left(\\left\\{c\\right\\} \\times '\
958.         '\\left\\{d\\right\\}\\right)'
959. 
960.     assert latex(SymmetricDifference(A, D2, evaluate=False)) == \
961.         '\\left\\{a\\right\\} \\triangle \\left(\\left\\{c\\right\\} ' \
962.         '\\triangle \\left\\{d\\right\\}\\right)'
963.     assert latex(SymmetricDifference(U1, U2, evaluate=False)) == \
964.         '\\left(\\left\\{a\\right\\} \\cup \\left\\{b\\right\\}\\right) ' \
965.         '\\triangle \\left(\\left\\{c\\right\\} \\cup ' \
966.         '\\left\\{d\\right\\}\\right)'
967.     assert latex(SymmetricDifference(I1, I2, evaluate=False)) == \
968.         '\\left(\\left\\{a\\right\\} \\cap \\left\\{b\\right\\}\\right) ' \
969.         '\\triangle \\left(\\left\\{c\\right\\} \\cap ' \
970.         '\\left\\{d\\right\\}\\right)'
971.     assert latex(SymmetricDifference(C1, C2, evaluate=False)) == \
972.         '\\left(\\left\\{a\\right\\} \\setminus ' \
973.         '\\left\\{b\\right\\}\\right) \\triangle ' \
974.         '\\left(\\left\\{c\\right\\} \\setminus \\left\\{d\\right\\}\\right)'
975.     assert latex(SymmetricDifference(P1, P2, evaluate=False)) == \
976.         '\\left(\\left\\{a\\right\\} \\times \\left\\{b\\right\\}\\right) ' \
977.         '\\triangle \\left(\\left\\{c\\right\\} \\times ' \
978.         '\\left\\{d\\right\\}\\right)'
979. 
980.     # XXX This can be incorrect since cartesian product is not associative
981.     assert latex(ProductSet(A, P2).flatten()) == \
982.         '\\left\\{a\\right\\} \\times \\left\\{c\\right\\} \\times ' \
983.         '\\left\\{d\\right\\}'
984.     assert latex(ProductSet(U1, U2)) == \
985.         '\\left(\\left\\{a\\right\\} \\cup \\left\\{b\\right\\}\\right) ' \
986.         '\\times \\left(\\left\\{c\\right\\} \\cup ' \
987.         '\\left\\{d\\right\\}\\right)'
988.     assert latex(ProductSet(I1, I2)) == \
989.         '\\left(\\left\\{a\\right\\} \\cap \\left\\{b\\right\\}\\right) ' \
990.         '\\times \\left(\\left\\{c\\right\\} \\cap ' \
991.         '\\left\\{d\\right\\}\\right)'
992.     assert latex(ProductSet(C1, C2)) == \
993.         '\\left(\\left\\{a\\right\\} \\setminus ' \
994.         '\\left\\{b\\right\\}\\right) \\times \\left(\\left\\{c\\right\\} ' \
995.         '\\setminus \\left\\{d\\right\\}\\right)'
996.     assert latex(ProductSet(D1, D2)) == \
997.         '\\left(\\left\\{a\\right\\} \\triangle ' \
998.         '\\left\\{b\\right\\}\\right) \\times \\left(\\left\\{c\\right\\} ' \
999.         '\\triangle \\left\\{d\\right\\}\\right)'
1000.

File: sympy/printing/tests/test_latex.py
Line number range: 1001 - 1501
Content:
1001. 
1002. def test_latex_Complexes():
1003.     assert latex(S.Complexes) == r"\mathbb{C}"
1004. 
1005. 
1006. def test_latex_Naturals():
1007.     assert latex(S.Naturals) == r"\mathbb{N}"
1008. 
1009. 
1010. def test_latex_Naturals0():
1011.     assert latex(S.Naturals0) == r"\mathbb{N}_0"
1012. 
1013. 
1014. def test_latex_Integers():
1015.     assert latex(S.Integers) == r"\mathbb{Z}"
1016. 
1017. 
1018. def test_latex_ImageSet():
1019.     x = Symbol('x')
1020.     assert latex(ImageSet(Lambda(x, x**2), S.Naturals)) == \
1021.         r"\left\{x^{2}\; |\; x \in \mathbb{N}\right\}"
1022.     y = Symbol('y')
1023. 
1024.     imgset = ImageSet(Lambda((x, y), x + y), {1, 2, 3}, {3, 4})
1025.     assert latex(imgset) == \
1026.         r"\left\{x + y\; |\; x \in \left\{1, 2, 3\right\} , y \in \left\{3, 4\right\}\right\}"
1027. 
1028.     imgset = ImageSet(Lambda(((x, y),), x + y), ProductSet({1, 2, 3}, {3, 4}))
1029.     assert latex(imgset) == \
1030.         r"\left\{x + y\; |\; \left( x, \  y\right) \in \left\{1, 2, 3\right\} \times \left\{3, 4\right\}\right\}"
1031. 
1032. 
1033. def test_latex_ConditionSet():
1034.     x = Symbol('x')
1035.     assert latex(ConditionSet(x, Eq(x**2, 1), S.Reals)) == \
1036.         r"\left\{x \mid x \in \mathbb{R} \wedge x^{2} = 1 \right\}"
1037.     assert latex(ConditionSet(x, Eq(x**2, 1), S.UniversalSet)) == \
1038.         r"\left\{x \mid x^{2} = 1 \right\}"
1039. 
1040. 
1041. def test_latex_ComplexRegion():
1042.     assert latex(ComplexRegion(Interval(3, 5)*Interval(4, 6))) == \
1043.         r"\left\{x + y i\; |\; x, y \in \left[3, 5\right] \times \left[4, 6\right] \right\}"
1044.     assert latex(ComplexRegion(Interval(0, 1)*Interval(0, 2*pi), polar=True)) == \
1045.         r"\left\{r \left(i \sin{\left(\theta \right)} + \cos{\left(\theta "\
1046.         r"\right)}\right)\; |\; r, \theta \in \left[0, 1\right] \times \left[0, 2 \pi\right) \right\}"
1047. 
1048. 
1049. def test_latex_Contains():
1050.     x = Symbol('x')
1051.     assert latex(Contains(x, S.Naturals)) == r"x \in \mathbb{N}"
1052. 
1053. 
1054. def test_latex_sum():
1055.     assert latex(Sum(x*y**2, (x, -2, 2), (y, -5, 5))) == \
1056.         r"\sum_{\substack{-2 \leq x \leq 2\\-5 \leq y \leq 5}} x y^{2}"
1057.     assert latex(Sum(x**2, (x, -2, 2))) == \
1058.         r"\sum_{x=-2}^{2} x^{2}"
1059.     assert latex(Sum(x**2 + y, (x, -2, 2))) == \
1060.         r"\sum_{x=-2}^{2} \left(x^{2} + y\right)"
1061. 
1062.     assert latex(Sum(x**2 + y, (x, -2, 2))**2) == \
1063.         r"\left(\sum_{x=-2}^{2} \left(x^{2} + y\right)\right)^{2}"
1064. 
1065. 
1066. def test_latex_product():
1067.     assert latex(Product(x*y**2, (x, -2, 2), (y, -5, 5))) == \
1068.         r"\prod_{\substack{-2 \leq x \leq 2\\-5 \leq y \leq 5}} x y^{2}"
1069.     assert latex(Product(x**2, (x, -2, 2))) == \
1070.         r"\prod_{x=-2}^{2} x^{2}"
1071.     assert latex(Product(x**2 + y, (x, -2, 2))) == \
1072.         r"\prod_{x=-2}^{2} \left(x^{2} + y\right)"
1073. 
1074.     assert latex(Product(x, (x, -2, 2))**2) == \
1075.         r"\left(\prod_{x=-2}^{2} x\right)^{2}"
1076. 
1077. 
1078. def test_latex_limits():
1079.     assert latex(Limit(x, x, oo)) == r"\lim_{x \to \infty} x"
1080. 
1081.     # issue 8175
1082.     f = Function('f')
1083.     assert latex(Limit(f(x), x, 0)) == r"\lim_{x \to 0^+} f{\left(x \right)}"
1084.     assert latex(Limit(f(x), x, 0, "-")) == \
1085.         r"\lim_{x \to 0^-} f{\left(x \right)}"
1086. 
1087.     # issue #10806
1088.     assert latex(Limit(f(x), x, 0)**2) == \
1089.         r"\left(\lim_{x \to 0^+} f{\left(x \right)}\right)^{2}"
1090.     # bi-directional limit
1091.     assert latex(Limit(f(x), x, 0, dir='+-')) == \
1092.         r"\lim_{x \to 0} f{\left(x \right)}"
1093. 
1094. 
1095. def test_latex_log():
1096.     assert latex(log(x)) == r"\log{\left(x \right)}"
1097.     assert latex(ln(x)) == r"\log{\left(x \right)}"
1098.     assert latex(log(x), ln_notation=True) == r"\ln{\left(x \right)}"
1099.     assert latex(log(x)+log(y)) == \
1100.         r"\log{\left(x \right)} + \log{\left(y \right)}"
1101.     assert latex(log(x)+log(y), ln_notation=True) == \
1102.         r"\ln{\left(x \right)} + \ln{\left(y \right)}"
1103.     assert latex(pow(log(x), x)) == r"\log{\left(x \right)}^{x}"
1104.     assert latex(pow(log(x), x), ln_notation=True) == \
1105.         r"\ln{\left(x \right)}^{x}"
1106. 
1107. 
1108. def test_issue_3568():
1109.     beta = Symbol(r'\beta')
1110.     y = beta + x
1111.     assert latex(y) in [r'\beta + x', r'x + \beta']
1112. 
1113.     beta = Symbol(r'beta')
1114.     y = beta + x
1115.     assert latex(y) in [r'\beta + x', r'x + \beta']
1116. 
1117. 
1118. def test_latex():
1119.     assert latex((2*tau)**Rational(7, 2)) == "8 \\sqrt{2} \\tau^{\\frac{7}{2}}"
1120.     assert latex((2*mu)**Rational(7, 2), mode='equation*') == \
1121.         "\\begin{equation*}8 \\sqrt{2} \\mu^{\\frac{7}{2}}\\end{equation*}"
1122.     assert latex((2*mu)**Rational(7, 2), mode='equation', itex=True) == \
1123.         "$$8 \\sqrt{2} \\mu^{\\frac{7}{2}}$$"
1124.     assert latex([2/x, y]) == r"\left[ \frac{2}{x}, \  y\right]"
1125. 
1126. 
1127. def test_latex_dict():
1128.     d = {Rational(1): 1, x**2: 2, x: 3, x**3: 4}
1129.     assert latex(d) == \
1130.         r'\left\{ 1 : 1, \  x : 3, \  x^{2} : 2, \  x^{3} : 4\right\}'
1131.     D = Dict(d)
1132.     assert latex(D) == \
1133.         r'\left\{ 1 : 1, \  x : 3, \  x^{2} : 2, \  x^{3} : 4\right\}'
1134. 
1135. 
1136. def test_latex_list():
1137.     ll = [Symbol('omega1'), Symbol('a'), Symbol('alpha')]
1138.     assert latex(ll) == r'\left[ \omega_{1}, \  a, \  \alpha\right]'
1139. 
1140. 
1141. def test_latex_rational():
1142.     # tests issue 3973
1143.     assert latex(-Rational(1, 2)) == "- \\frac{1}{2}"
1144.     assert latex(Rational(-1, 2)) == "- \\frac{1}{2}"
1145.     assert latex(Rational(1, -2)) == "- \\frac{1}{2}"
1146.     assert latex(-Rational(-1, 2)) == "\\frac{1}{2}"
1147.     assert latex(-Rational(1, 2)*x) == "- \\frac{x}{2}"
1148.     assert latex(-Rational(1, 2)*x + Rational(-2, 3)*y) == \
1149.         "- \\frac{x}{2} - \\frac{2 y}{3}"
1150. 
1151. 
1152. def test_latex_inverse():
1153.     # tests issue 4129
1154.     assert latex(1/x) == "\\frac{1}{x}"
1155.     assert latex(1/(x + y)) == "\\frac{1}{x + y}"
1156. 
1157. 
1158. def test_latex_DiracDelta():
1159.     assert latex(DiracDelta(x)) == r"\delta\left(x\right)"
1160.     assert latex(DiracDelta(x)**2) == r"\left(\delta\left(x\right)\right)^{2}"
1161.     assert latex(DiracDelta(x, 0)) == r"\delta\left(x\right)"
1162.     assert latex(DiracDelta(x, 5)) == \
1163.         r"\delta^{\left( 5 \right)}\left( x \right)"
1164.     assert latex(DiracDelta(x, 5)**2) == \
1165.         r"\left(\delta^{\left( 5 \right)}\left( x \right)\right)^{2}"
1166. 
1167. 
1168. def test_latex_Heaviside():
1169.     assert latex(Heaviside(x)) == r"\theta\left(x\right)"
1170.     assert latex(Heaviside(x)**2) == r"\left(\theta\left(x\right)\right)^{2}"
1171. 
1172. 
1173. def test_latex_KroneckerDelta():
1174.     assert latex(KroneckerDelta(x, y)) == r"\delta_{x y}"
1175.     assert latex(KroneckerDelta(x, y + 1)) == r"\delta_{x, y + 1}"
1176.     # issue 6578
1177.     assert latex(KroneckerDelta(x + 1, y)) == r"\delta_{y, x + 1}"
1178.     assert latex(Pow(KroneckerDelta(x, y), 2, evaluate=False)) == \
1179.         r"\left(\delta_{x y}\right)^{2}"
1180. 
1181. 
1182. def test_latex_LeviCivita():
1183.     assert latex(LeviCivita(x, y, z)) == r"\varepsilon_{x y z}"
1184.     assert latex(LeviCivita(x, y, z)**2) == \
1185.         r"\left(\varepsilon_{x y z}\right)^{2}"
1186.     assert latex(LeviCivita(x, y, z + 1)) == r"\varepsilon_{x, y, z + 1}"
1187.     assert latex(LeviCivita(x, y + 1, z)) == r"\varepsilon_{x, y + 1, z}"
1188.     assert latex(LeviCivita(x + 1, y, z)) == r"\varepsilon_{x + 1, y, z}"
1189. 
1190. 
1191. def test_mode():
1192.     expr = x + y
1193.     assert latex(expr) == 'x + y'
1194.     assert latex(expr, mode='plain') == 'x + y'
1195.     assert latex(expr, mode='inline') == '$x + y$'
1196.     assert latex(
1197.         expr, mode='equation*') == '\\begin{equation*}x + y\\end{equation*}'
1198.     assert latex(
1199.         expr, mode='equation') == '\\begin{equation}x + y\\end{equation}'
1200.     raises(ValueError, lambda: latex(expr, mode='foo'))
1201. 
1202. 
1203. def test_latex_mathieu():
1204.     assert latex(mathieuc(x, y, z)) == r"C\left(x, y, z\right)"
1205.     assert latex(mathieus(x, y, z)) == r"S\left(x, y, z\right)"
1206.     assert latex(mathieuc(x, y, z)**2) == r"C\left(x, y, z\right)^{2}"
1207.     assert latex(mathieus(x, y, z)**2) == r"S\left(x, y, z\right)^{2}"
1208.     assert latex(mathieucprime(x, y, z)) == r"C^{\prime}\left(x, y, z\right)"
1209.     assert latex(mathieusprime(x, y, z)) == r"S^{\prime}\left(x, y, z\right)"
1210.     assert latex(mathieucprime(x, y, z)**2) == r"C^{\prime}\left(x, y, z\right)^{2}"
1211.     assert latex(mathieusprime(x, y, z)**2) == r"S^{\prime}\left(x, y, z\right)^{2}"
1212. 
1213. def test_latex_Piecewise():
1214.     p = Piecewise((x, x < 1), (x**2, True))
1215.     assert latex(p) == "\\begin{cases} x & \\text{for}\\: x < 1 \\\\x^{2} &" \
1216.                        " \\text{otherwise} \\end{cases}"
1217.     assert latex(p, itex=True) == \
1218.         "\\begin{cases} x & \\text{for}\\: x \\lt 1 \\\\x^{2} &" \
1219.         " \\text{otherwise} \\end{cases}"
1220.     p = Piecewise((x, x < 0), (0, x >= 0))
1221.     assert latex(p) == '\\begin{cases} x & \\text{for}\\: x < 0 \\\\0 &' \
1222.                        ' \\text{otherwise} \\end{cases}'
1223.     A, B = symbols("A B", commutative=False)
1224.     p = Piecewise((A**2, Eq(A, B)), (A*B, True))
1225.     s = r"\begin{cases} A^{2} & \text{for}\: A = B \\A B & \text{otherwise} \end{cases}"
1226.     assert latex(p) == s
1227.     assert latex(A*p) == r"A \left(%s\right)" % s
1228.     assert latex(p*A) == r"\left(%s\right) A" % s
1229.     assert latex(Piecewise((x, x < 1), (x**2, x < 2))) == \
1230.         '\\begin{cases} x & ' \
1231.         '\\text{for}\\: x < 1 \\\\x^{2} & \\text{for}\\: x < 2 \\end{cases}'
1232. 
1233. 
1234. def test_latex_Matrix():
1235.     M = Matrix([[1 + x, y], [y, x - 1]])
1236.     assert latex(M) == \
1237.         r'\left[\begin{matrix}x + 1 & y\\y & x - 1\end{matrix}\right]'
1238.     assert latex(M, mode='inline') == \
1239.         r'$\left[\begin{smallmatrix}x + 1 & y\\' \
1240.         r'y & x - 1\end{smallmatrix}\right]$'
1241.     assert latex(M, mat_str='array') == \
1242.         r'\left[\begin{array}{cc}x + 1 & y\\y & x - 1\end{array}\right]'
1243.     assert latex(M, mat_str='bmatrix') == \
1244.         r'\left[\begin{bmatrix}x + 1 & y\\y & x - 1\end{bmatrix}\right]'
1245.     assert latex(M, mat_delim=None, mat_str='bmatrix') == \
1246.         r'\begin{bmatrix}x + 1 & y\\y & x - 1\end{bmatrix}'
1247.     M2 = Matrix(1, 11, range(11))
1248.     assert latex(M2) == \
1249.         r'\left[\begin{array}{ccccccccccc}' \
1250.         r'0 & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 & 10\end{array}\right]'
1251. 
1252. 
1253. def test_latex_matrix_with_functions():
1254.     t = symbols('t')
1255.     theta1 = symbols('theta1', cls=Function)
1256. 
1257.     M = Matrix([[sin(theta1(t)), cos(theta1(t))],
1258.                 [cos(theta1(t).diff(t)), sin(theta1(t).diff(t))]])
1259. 
1260.     expected = (r'\left[\begin{matrix}\sin{\left('
1261.                 r'\theta_{1}{\left(t \right)} \right)} & '
1262.                 r'\cos{\left(\theta_{1}{\left(t \right)} \right)'
1263.                 r'}\\\cos{\left(\frac{d}{d t} \theta_{1}{\left(t '
1264.                 r'\right)} \right)} & \sin{\left(\frac{d}{d t} '
1265.                 r'\theta_{1}{\left(t \right)} \right'
1266.                 r')}\end{matrix}\right]')
1267. 
1268.     assert latex(M) == expected
1269. 
1270. 
1271. def test_latex_NDimArray():
1272.     x, y, z, w = symbols("x y z w")
1273. 
1274.     for ArrayType in (ImmutableDenseNDimArray, ImmutableSparseNDimArray,
1275.                       MutableDenseNDimArray, MutableSparseNDimArray):
1276.         # Basic: scalar array
1277.         M = ArrayType(x)
1278. 
1279.         assert latex(M) == "x"
1280. 
1281.         M = ArrayType([[1 / x, y], [z, w]])
1282.         M1 = ArrayType([1 / x, y, z])
1283. 
1284.         M2 = tensorproduct(M1, M)
1285.         M3 = tensorproduct(M, M)
1286. 
1287.         assert latex(M) == \
1288.             '\\left[\\begin{matrix}\\frac{1}{x} & y\\\\z & w\\end{matrix}\\right]'
1289.         assert latex(M1) == \
1290.             "\\left[\\begin{matrix}\\frac{1}{x} & y & z\\end{matrix}\\right]"
1291.         assert latex(M2) == \
1292.             r"\left[\begin{matrix}" \
1293.             r"\left[\begin{matrix}\frac{1}{x^{2}} & \frac{y}{x}\\\frac{z}{x} & \frac{w}{x}\end{matrix}\right] & " \
1294.             r"\left[\begin{matrix}\frac{y}{x} & y^{2}\\y z & w y\end{matrix}\right] & " \
1295.             r"\left[\begin{matrix}\frac{z}{x} & y z\\z^{2} & w z\end{matrix}\right]" \
1296.             r"\end{matrix}\right]"
1297.         assert latex(M3) == \
1298.             r"""\left[\begin{matrix}"""\
1299.             r"""\left[\begin{matrix}\frac{1}{x^{2}} & \frac{y}{x}\\\frac{z}{x} & \frac{w}{x}\end{matrix}\right] & """\
1300.             r"""\left[\begin{matrix}\frac{y}{x} & y^{2}\\y z & w y\end{matrix}\right]\\"""\
1301.             r"""\left[\begin{matrix}\frac{z}{x} & y z\\z^{2} & w z\end{matrix}\right] & """\
1302.             r"""\left[\begin{matrix}\frac{w}{x} & w y\\w z & w^{2}\end{matrix}\right]"""\
1303.             r"""\end{matrix}\right]"""
1304. 
1305.         Mrow = ArrayType([[x, y, 1/z]])
1306.         Mcolumn = ArrayType([[x], [y], [1/z]])
1307.         Mcol2 = ArrayType([Mcolumn.tolist()])
1308. 
1309.         assert latex(Mrow) == \
1310.             r"\left[\left[\begin{matrix}x & y & \frac{1}{z}\end{matrix}\right]\right]"
1311.         assert latex(Mcolumn) == \
1312.             r"\left[\begin{matrix}x\\y\\\frac{1}{z}\end{matrix}\right]"
1313.         assert latex(Mcol2) == \
1314.             r'\left[\begin{matrix}\left[\begin{matrix}x\\y\\\frac{1}{z}\end{matrix}\right]\end{matrix}\right]'
1315. 
1316. 
1317. def test_latex_mul_symbol():
1318.     assert latex(4*4**x, mul_symbol='times') == "4 \\times 4^{x}"
1319.     assert latex(4*4**x, mul_symbol='dot') == "4 \\cdot 4^{x}"
1320.     assert latex(4*4**x, mul_symbol='ldot') == r"4 \,.\, 4^{x}"
1321. 
1322.     assert latex(4*x, mul_symbol='times') == "4 \\times x"
1323.     assert latex(4*x, mul_symbol='dot') == "4 \\cdot x"
1324.     assert latex(4*x, mul_symbol='ldot') == r"4 \,.\, x"
1325. 
1326. 
1327. def test_latex_issue_4381():
1328.     y = 4*4**log(2)
1329.     assert latex(y) == r'4 \cdot 4^{\log{\left(2 \right)}}'
1330.     assert latex(1/y) == r'\frac{1}{4 \cdot 4^{\log{\left(2 \right)}}}'
1331. 
1332. 
1333. def test_latex_issue_4576():
1334.     assert latex(Symbol("beta_13_2")) == r"\beta_{13 2}"
1335.     assert latex(Symbol("beta_132_20")) == r"\beta_{132 20}"
1336.     assert latex(Symbol("beta_13")) == r"\beta_{13}"
1337.     assert latex(Symbol("x_a_b")) == r"x_{a b}"
1338.     assert latex(Symbol("x_1_2_3")) == r"x_{1 2 3}"
1339.     assert latex(Symbol("x_a_b1")) == r"x_{a b1}"
1340.     assert latex(Symbol("x_a_1")) == r"x_{a 1}"
1341.     assert latex(Symbol("x_1_a")) == r"x_{1 a}"
1342.     assert latex(Symbol("x_1^aa")) == r"x^{aa}_{1}"
1343.     assert latex(Symbol("x_1__aa")) == r"x^{aa}_{1}"
1344.     assert latex(Symbol("x_11^a")) == r"x^{a}_{11}"
1345.     assert latex(Symbol("x_11__a")) == r"x^{a}_{11}"
1346.     assert latex(Symbol("x_a_a_a_a")) == r"x_{a a a a}"
1347.     assert latex(Symbol("x_a_a^a^a")) == r"x^{a a}_{a a}"
1348.     assert latex(Symbol("x_a_a__a__a")) == r"x^{a a}_{a a}"
1349.     assert latex(Symbol("alpha_11")) == r"\alpha_{11}"
1350.     assert latex(Symbol("alpha_11_11")) == r"\alpha_{11 11}"
1351.     assert latex(Symbol("alpha_alpha")) == r"\alpha_{\alpha}"
1352.     assert latex(Symbol("alpha^aleph")) == r"\alpha^{\aleph}"
1353.     assert latex(Symbol("alpha__aleph")) == r"\alpha^{\aleph}"
1354. 
1355. 
1356. def test_latex_pow_fraction():
1357.     x = Symbol('x')
1358.     # Testing exp
1359.     assert 'e^{-x}' in latex(exp(-x)/2).replace(' ', '')  # Remove Whitespace
1360. 
1361.     # Testing e^{-x} in case future changes alter behavior of muls or fracs
1362.     # In particular current output is \frac{1}{2}e^{- x} but perhaps this will
1363.     # change to \frac{e^{-x}}{2}
1364. 
1365.     # Testing general, non-exp, power
1366.     assert '3^{-x}' in latex(3**-x/2).replace(' ', '')
1367. 
1368. 
1369. def test_noncommutative():
1370.     A, B, C = symbols('A,B,C', commutative=False)
1371. 
1372.     assert latex(A*B*C**-1) == "A B C^{-1}"
1373.     assert latex(C**-1*A*B) == "C^{-1} A B"
1374.     assert latex(A*C**-1*B) == "A C^{-1} B"
1375. 
1376. 
1377. def test_latex_order():
1378.     expr = x**3 + x**2*y + y**4 + 3*x*y**3
1379. 
1380.     assert latex(expr, order='lex') == "x^{3} + x^{2} y + 3 x y^{3} + y^{4}"
1381.     assert latex(
1382.         expr, order='rev-lex') == "y^{4} + 3 x y^{3} + x^{2} y + x^{3}"
1383.     assert latex(expr, order='none') == "x^{3} + y^{4} + y x^{2} + 3 x y^{3}"
1384. 
1385. 
1386. def test_latex_Lambda():
1387.     assert latex(Lambda(x, x + 1)) == \
1388.         r"\left( x \mapsto x + 1 \right)"
1389.     assert latex(Lambda((x, y), x + 1)) == \
1390.         r"\left( \left( x, \  y\right) \mapsto x + 1 \right)"
1391. 
1392. 
1393. def test_latex_PolyElement():
1394.     Ruv, u, v = ring("u,v", ZZ)
1395.     Rxyz, x, y, z = ring("x,y,z", Ruv)
1396. 
1397.     assert latex(x - x) == r"0"
1398.     assert latex(x - 1) == r"x - 1"
1399.     assert latex(x + 1) == r"x + 1"
1400. 
1401.     assert latex((u**2 + 3*u*v + 1)*x**2*y + u + 1) == \
1402.         r"\left({u}^{2} + 3 u v + 1\right) {x}^{2} y + u + 1"
1403.     assert latex((u**2 + 3*u*v + 1)*x**2*y + (u + 1)*x) == \
1404.         r"\left({u}^{2} + 3 u v + 1\right) {x}^{2} y + \left(u + 1\right) x"
1405.     assert latex((u**2 + 3*u*v + 1)*x**2*y + (u + 1)*x + 1) == \
1406.         r"\left({u}^{2} + 3 u v + 1\right) {x}^{2} y + \left(u + 1\right) x + 1"
1407.     assert latex((-u**2 + 3*u*v - 1)*x**2*y - (u + 1)*x - 1) == \
1408.         r"-\left({u}^{2} - 3 u v + 1\right) {x}^{2} y - \left(u + 1\right) x - 1"
1409. 
1410.     assert latex(-(v**2 + v + 1)*x + 3*u*v + 1) == \
1411.         r"-\left({v}^{2} + v + 1\right) x + 3 u v + 1"
1412.     assert latex(-(v**2 + v + 1)*x - 3*u*v + 1) == \
1413.         r"-\left({v}^{2} + v + 1\right) x - 3 u v + 1"
1414. 
1415. 
1416. def test_latex_FracElement():
1417.     Fuv, u, v = field("u,v", ZZ)
1418.     Fxyzt, x, y, z, t = field("x,y,z,t", Fuv)
1419. 
1420.     assert latex(x - x) == r"0"
1421.     assert latex(x - 1) == r"x - 1"
1422.     assert latex(x + 1) == r"x + 1"
1423. 
1424.     assert latex(x/3) == r"\frac{x}{3}"
1425.     assert latex(x/z) == r"\frac{x}{z}"
1426.     assert latex(x*y/z) == r"\frac{x y}{z}"
1427.     assert latex(x/(z*t)) == r"\frac{x}{z t}"
1428.     assert latex(x*y/(z*t)) == r"\frac{x y}{z t}"
1429. 
1430.     assert latex((x - 1)/y) == r"\frac{x - 1}{y}"
1431.     assert latex((x + 1)/y) == r"\frac{x + 1}{y}"
1432.     assert latex((-x - 1)/y) == r"\frac{-x - 1}{y}"
1433.     assert latex((x + 1)/(y*z)) == r"\frac{x + 1}{y z}"
1434.     assert latex(-y/(x + 1)) == r"\frac{-y}{x + 1}"
1435.     assert latex(y*z/(x + 1)) == r"\frac{y z}{x + 1}"
1436. 
1437.     assert latex(((u + 1)*x*y + 1)/((v - 1)*z - 1)) == \
1438.         r"\frac{\left(u + 1\right) x y + 1}{\left(v - 1\right) z - 1}"
1439.     assert latex(((u + 1)*x*y + 1)/((v - 1)*z - t*u*v - 1)) == \
1440.         r"\frac{\left(u + 1\right) x y + 1}{\left(v - 1\right) z - u v t - 1}"
1441. 
1442. 
1443. def test_latex_Poly():
1444.     assert latex(Poly(x**2 + 2 * x, x)) == \
1445.         r"\operatorname{Poly}{\left( x^{2} + 2 x, x, domain=\mathbb{Z} \right)}"
1446.     assert latex(Poly(x/y, x)) == \
1447.         r"\operatorname{Poly}{\left( \frac{1}{y} x, x, domain=\mathbb{Z}\left(y\right) \right)}"
1448.     assert latex(Poly(2.0*x + y)) == \
1449.         r"\operatorname{Poly}{\left( 2.0 x + 1.0 y, x, y, domain=\mathbb{R} \right)}"
1450. 
1451. 
1452. def test_latex_Poly_order():
1453.     assert latex(Poly([a, 1, b, 2, c, 3], x)) == \
1454.         '\\operatorname{Poly}{\\left( a x^{5} + x^{4} + b x^{3} + 2 x^{2} + c'\
1455.         ' x + 3, x, domain=\\mathbb{Z}\\left[a, b, c\\right] \\right)}'
1456.     assert latex(Poly([a, 1, b+c, 2, 3], x)) == \
1457.         '\\operatorname{Poly}{\\left( a x^{4} + x^{3} + \\left(b + c\\right) '\
1458.         'x^{2} + 2 x + 3, x, domain=\\mathbb{Z}\\left[a, b, c\\right] \\right)}'
1459.     assert latex(Poly(a*x**3 + x**2*y - x*y - c*y**3 - b*x*y**2 + y - a*x + b,
1460.                       (x, y))) == \
1461.         '\\operatorname{Poly}{\\left( a x^{3} + x^{2}y -  b xy^{2} - xy -  '\
1462.         'a x -  c y^{3} + y + b, x, y, domain=\\mathbb{Z}\\left[a, b, c\\right] \\right)}'
1463. 
1464. 
1465. def test_latex_ComplexRootOf():
1466.     assert latex(rootof(x**5 + x + 3, 0)) == \
1467.         r"\operatorname{CRootOf} {\left(x^{5} + x + 3, 0\right)}"
1468. 
1469. 
1470. def test_latex_RootSum():
1471.     assert latex(RootSum(x**5 + x + 3, sin)) == \
1472.         r"\operatorname{RootSum} {\left(x^{5} + x + 3, \left( x \mapsto \sin{\left(x \right)} \right)\right)}"
1473. 
1474. 
1475. def test_settings():
1476.     raises(TypeError, lambda: latex(x*y, method="garbage"))
1477. 
1478. 
1479. def test_latex_numbers():
1480.     assert latex(catalan(n)) == r"C_{n}"
1481.     assert latex(catalan(n)**2) == r"C_{n}^{2}"
1482.     assert latex(bernoulli(n)) == r"B_{n}"
1483.     assert latex(bernoulli(n, x)) == r"B_{n}\left(x\right)"
1484.     assert latex(bernoulli(n)**2) == r"B_{n}^{2}"
1485.     assert latex(bernoulli(n, x)**2) == r"B_{n}^{2}\left(x\right)"
1486.     assert latex(bell(n)) == r"B_{n}"
1487.     assert latex(bell(n, x)) == r"B_{n}\left(x\right)"
1488.     assert latex(bell(n, m, (x, y))) == r"B_{n, m}\left(x, y\right)"
1489.     assert latex(bell(n)**2) == r"B_{n}^{2}"
1490.     assert latex(bell(n, x)**2) == r"B_{n}^{2}\left(x\right)"
1491.     assert latex(bell(n, m, (x, y))**2) == r"B_{n, m}^{2}\left(x, y\right)"
1492.     assert latex(fibonacci(n)) == r"F_{n}"
1493.     assert latex(fibonacci(n, x)) == r"F_{n}\left(x\right)"
1494.     assert latex(fibonacci(n)**2) == r"F_{n}^{2}"
1495.     assert latex(fibonacci(n, x)**2) == r"F_{n}^{2}\left(x\right)"
1496.     assert latex(lucas(n)) == r"L_{n}"
1497.     assert latex(lucas(n)**2) == r"L_{n}^{2}"
1498.     assert latex(tribonacci(n)) == r"T_{n}"
1499.     assert latex(tribonacci(n, x)) == r"T_{n}\left(x\right)"
1500.     assert latex(tribonacci(n)**2) == r"T_{n}^{2}"
1501.     assert latex(tribonacci(n, x)**2) == r"T_{n}^{2}\left(x\right)"

File: sympy/printing/tests/test_latex.py
Line number range: 1502 - 2002
Content:
1502. 
1503. 
1504. def test_latex_euler():
1505.     assert latex(euler(n)) == r"E_{n}"
1506.     assert latex(euler(n, x)) == r"E_{n}\left(x\right)"
1507.     assert latex(euler(n, x)**2) == r"E_{n}^{2}\left(x\right)"
1508. 
1509. 
1510. def test_lamda():
1511.     assert latex(Symbol('lamda')) == r"\lambda"
1512.     assert latex(Symbol('Lamda')) == r"\Lambda"
1513. 
1514. 
1515. def test_custom_symbol_names():
1516.     x = Symbol('x')
1517.     y = Symbol('y')
1518.     assert latex(x) == "x"
1519.     assert latex(x, symbol_names={x: "x_i"}) == "x_i"
1520.     assert latex(x + y, symbol_names={x: "x_i"}) == "x_i + y"
1521.     assert latex(x**2, symbol_names={x: "x_i"}) == "x_i^{2}"
1522.     assert latex(x + y, symbol_names={x: "x_i", y: "y_j"}) == "x_i + y_j"
1523. 
1524. 
1525. def test_matAdd():
1526.     from sympy import MatrixSymbol
1527.     from sympy.printing.latex import LatexPrinter
1528.     C = MatrixSymbol('C', 5, 5)
1529.     B = MatrixSymbol('B', 5, 5)
1530.     l = LatexPrinter()
1531.     assert l._print(C - 2*B) in ['- 2 B + C', 'C -2 B']
1532.     assert l._print(C + 2*B) in ['2 B + C', 'C + 2 B']
1533.     assert l._print(B - 2*C) in ['B - 2 C', '- 2 C + B']
1534.     assert l._print(B + 2*C) in ['B + 2 C', '2 C + B']
1535. 
1536. 
1537. def test_matMul():
1538.     from sympy import MatrixSymbol
1539.     from sympy.printing.latex import LatexPrinter
1540.     A = MatrixSymbol('A', 5, 5)
1541.     B = MatrixSymbol('B', 5, 5)
1542.     x = Symbol('x')
1543.     lp = LatexPrinter()
1544.     assert lp._print_MatMul(2*A) == '2 A'
1545.     assert lp._print_MatMul(2*x*A) == '2 x A'
1546.     assert lp._print_MatMul(-2*A) == '- 2 A'
1547.     assert lp._print_MatMul(1.5*A) == '1.5 A'
1548.     assert lp._print_MatMul(sqrt(2)*A) == r'\sqrt{2} A'
1549.     assert lp._print_MatMul(-sqrt(2)*A) == r'- \sqrt{2} A'
1550.     assert lp._print_MatMul(2*sqrt(2)*x*A) == r'2 \sqrt{2} x A'
1551.     assert lp._print_MatMul(-2*A*(A + 2*B)) in [r'- 2 A \left(A + 2 B\right)',
1552.                                                 r'- 2 A \left(2 B + A\right)']
1553. 
1554. 
1555. def test_latex_MatrixSlice():
1556.     from sympy.matrices.expressions import MatrixSymbol
1557.     assert latex(MatrixSymbol('X', 10, 10)[:5, 1:9:2]) == \
1558.         r'X\left[:5, 1:9:2\right]'
1559.     assert latex(MatrixSymbol('X', 10, 10)[5, :5:2]) == \
1560.         r'X\left[5, :5:2\right]'
1561. 
1562. 
1563. def test_latex_RandomDomain():
1564.     from sympy.stats import Normal, Die, Exponential, pspace, where
1565.     from sympy.stats.rv import RandomDomain
1566. 
1567.     X = Normal('x1', 0, 1)
1568.     assert latex(where(X > 0)) == r"\text{Domain: }0 < x_{1} \wedge x_{1} < \infty"
1569. 
1570.     D = Die('d1', 6)
1571.     assert latex(where(D > 4)) == r"\text{Domain: }d_{1} = 5 \vee d_{1} = 6"
1572. 
1573.     A = Exponential('a', 1)
1574.     B = Exponential('b', 1)
1575.     assert latex(
1576.         pspace(Tuple(A, B)).domain) == \
1577.         r"\text{Domain: }0 \leq a \wedge 0 \leq b \wedge a < \infty \wedge b < \infty"
1578. 
1579.     assert latex(RandomDomain(FiniteSet(x), FiniteSet(1, 2))) == \
1580.         r'\text{Domain: }\left\{x\right\}\text{ in }\left\{1, 2\right\}'
1581. 
1582. def test_PrettyPoly():
1583.     from sympy.polys.domains import QQ
1584.     F = QQ.frac_field(x, y)
1585.     R = QQ[x, y]
1586. 
1587.     assert latex(F.convert(x/(x + y))) == latex(x/(x + y))
1588.     assert latex(R.convert(x + y)) == latex(x + y)
1589. 
1590. 
1591. def test_integral_transforms():
1592.     x = Symbol("x")
1593.     k = Symbol("k")
1594.     f = Function("f")
1595.     a = Symbol("a")
1596.     b = Symbol("b")
1597. 
1598.     assert latex(MellinTransform(f(x), x, k)) == \
1599.         r"\mathcal{M}_{x}\left[f{\left(x \right)}\right]\left(k\right)"
1600.     assert latex(InverseMellinTransform(f(k), k, x, a, b)) == \
1601.         r"\mathcal{M}^{-1}_{k}\left[f{\left(k \right)}\right]\left(x\right)"
1602. 
1603.     assert latex(LaplaceTransform(f(x), x, k)) == \
1604.         r"\mathcal{L}_{x}\left[f{\left(x \right)}\right]\left(k\right)"
1605.     assert latex(InverseLaplaceTransform(f(k), k, x, (a, b))) == \
1606.         r"\mathcal{L}^{-1}_{k}\left[f{\left(k \right)}\right]\left(x\right)"
1607. 
1608.     assert latex(FourierTransform(f(x), x, k)) == \
1609.         r"\mathcal{F}_{x}\left[f{\left(x \right)}\right]\left(k\right)"
1610.     assert latex(InverseFourierTransform(f(k), k, x)) == \
1611.         r"\mathcal{F}^{-1}_{k}\left[f{\left(k \right)}\right]\left(x\right)"
1612. 
1613.     assert latex(CosineTransform(f(x), x, k)) == \
1614.         r"\mathcal{COS}_{x}\left[f{\left(x \right)}\right]\left(k\right)"
1615.     assert latex(InverseCosineTransform(f(k), k, x)) == \
1616.         r"\mathcal{COS}^{-1}_{k}\left[f{\left(k \right)}\right]\left(x\right)"
1617. 
1618.     assert latex(SineTransform(f(x), x, k)) == \
1619.         r"\mathcal{SIN}_{x}\left[f{\left(x \right)}\right]\left(k\right)"
1620.     assert latex(InverseSineTransform(f(k), k, x)) == \
1621.         r"\mathcal{SIN}^{-1}_{k}\left[f{\left(k \right)}\right]\left(x\right)"
1622. 
1623. 
1624. def test_PolynomialRingBase():
1625.     from sympy.polys.domains import QQ
1626.     assert latex(QQ.old_poly_ring(x, y)) == r"\mathbb{Q}\left[x, y\right]"
1627.     assert latex(QQ.old_poly_ring(x, y, order="ilex")) == \
1628.         r"S_<^{-1}\mathbb{Q}\left[x, y\right]"
1629. 
1630. 
1631. def test_categories():
1632.     from sympy.categories import (Object, IdentityMorphism,
1633.                                   NamedMorphism, Category, Diagram,
1634.                                   DiagramGrid)
1635. 
1636.     A1 = Object("A1")
1637.     A2 = Object("A2")
1638.     A3 = Object("A3")
1639. 
1640.     f1 = NamedMorphism(A1, A2, "f1")
1641.     f2 = NamedMorphism(A2, A3, "f2")
1642.     id_A1 = IdentityMorphism(A1)
1643. 
1644.     K1 = Category("K1")
1645. 
1646.     assert latex(A1) == "A_{1}"
1647.     assert latex(f1) == "f_{1}:A_{1}\\rightarrow A_{2}"
1648.     assert latex(id_A1) == "id:A_{1}\\rightarrow A_{1}"
1649.     assert latex(f2*f1) == "f_{2}\\circ f_{1}:A_{1}\\rightarrow A_{3}"
1650. 
1651.     assert latex(K1) == r"\mathbf{K_{1}}"
1652. 
1653.     d = Diagram()
1654.     assert latex(d) == r"\emptyset"
1655. 
1656.     d = Diagram({f1: "unique", f2: S.EmptySet})
1657.     assert latex(d) == r"\left\{ f_{2}\circ f_{1}:A_{1}" \
1658.         r"\rightarrow A_{3} : \emptyset, \  id:A_{1}\rightarrow " \
1659.         r"A_{1} : \emptyset, \  id:A_{2}\rightarrow A_{2} : " \
1660.         r"\emptyset, \  id:A_{3}\rightarrow A_{3} : \emptyset, " \
1661.         r"\  f_{1}:A_{1}\rightarrow A_{2} : \left\{unique\right\}, " \
1662.         r"\  f_{2}:A_{2}\rightarrow A_{3} : \emptyset\right\}"
1663. 
1664.     d = Diagram({f1: "unique", f2: S.EmptySet}, {f2 * f1: "unique"})
1665.     assert latex(d) == r"\left\{ f_{2}\circ f_{1}:A_{1}" \
1666.         r"\rightarrow A_{3} : \emptyset, \  id:A_{1}\rightarrow " \
1667.         r"A_{1} : \emptyset, \  id:A_{2}\rightarrow A_{2} : " \
1668.         r"\emptyset, \  id:A_{3}\rightarrow A_{3} : \emptyset, " \
1669.         r"\  f_{1}:A_{1}\rightarrow A_{2} : \left\{unique\right\}," \
1670.         r" \  f_{2}:A_{2}\rightarrow A_{3} : \emptyset\right\}" \
1671.         r"\Longrightarrow \left\{ f_{2}\circ f_{1}:A_{1}" \
1672.         r"\rightarrow A_{3} : \left\{unique\right\}\right\}"
1673. 
1674.     # A linear diagram.
1675.     A = Object("A")
1676.     B = Object("B")
1677.     C = Object("C")
1678.     f = NamedMorphism(A, B, "f")
1679.     g = NamedMorphism(B, C, "g")
1680.     d = Diagram([f, g])
1681.     grid = DiagramGrid(d)
1682. 
1683.     assert latex(grid) == "\\begin{array}{cc}\n" \
1684.         "A & B \\\\\n" \
1685.         " & C \n" \
1686.         "\\end{array}\n"
1687. 
1688. 
1689. def test_Modules():
1690.     from sympy.polys.domains import QQ
1691.     from sympy.polys.agca import homomorphism
1692. 
1693.     R = QQ.old_poly_ring(x, y)
1694.     F = R.free_module(2)
1695.     M = F.submodule([x, y], [1, x**2])
1696. 
1697.     assert latex(F) == r"{\mathbb{Q}\left[x, y\right]}^{2}"
1698.     assert latex(M) == \
1699.         r"\left\langle {\left[ {x},{y} \right]},{\left[ {1},{x^{2}} \right]} \right\rangle"
1700. 
1701.     I = R.ideal(x**2, y)
1702.     assert latex(I) == r"\left\langle {x^{2}},{y} \right\rangle"
1703. 
1704.     Q = F / M
1705.     assert latex(Q) == \
1706.         r"\frac{{\mathbb{Q}\left[x, y\right]}^{2}}{\left\langle {\left[ {x},"\
1707.         r"{y} \right]},{\left[ {1},{x^{2}} \right]} \right\rangle}"
1708.     assert latex(Q.submodule([1, x**3/2], [2, y])) == \
1709.         r"\left\langle {{\left[ {1},{\frac{x^{3}}{2}} \right]} + {\left"\
1710.         r"\langle {\left[ {x},{y} \right]},{\left[ {1},{x^{2}} \right]} "\
1711.         r"\right\rangle}},{{\left[ {2},{y} \right]} + {\left\langle {\left[ "\
1712.         r"{x},{y} \right]},{\left[ {1},{x^{2}} \right]} \right\rangle}} \right\rangle"
1713. 
1714.     h = homomorphism(QQ.old_poly_ring(x).free_module(2),
1715.                      QQ.old_poly_ring(x).free_module(2), [0, 0])
1716. 
1717.     assert latex(h) == \
1718.         r"{\left[\begin{matrix}0 & 0\\0 & 0\end{matrix}\right]} : "\
1719.         r"{{\mathbb{Q}\left[x\right]}^{2}} \to {{\mathbb{Q}\left[x\right]}^{2}}"
1720. 
1721. 
1722. def test_QuotientRing():
1723.     from sympy.polys.domains import QQ
1724.     R = QQ.old_poly_ring(x)/[x**2 + 1]
1725. 
1726.     assert latex(R) == \
1727.         r"\frac{\mathbb{Q}\left[x\right]}{\left\langle {x^{2} + 1} \right\rangle}"
1728.     assert latex(R.one) == r"{1} + {\left\langle {x^{2} + 1} \right\rangle}"
1729. 
1730. 
1731. def test_Tr():
1732.     #TODO: Handle indices
1733.     A, B = symbols('A B', commutative=False)
1734.     t = Tr(A*B)
1735.     assert latex(t) == r'\operatorname{tr}\left(A B\right)'
1736. 
1737. 
1738. def test_Adjoint():
1739.     from sympy.matrices import MatrixSymbol, Adjoint, Inverse, Transpose
1740.     X = MatrixSymbol('X', 2, 2)
1741.     Y = MatrixSymbol('Y', 2, 2)
1742.     assert latex(Adjoint(X)) == r'X^{\dagger}'
1743.     assert latex(Adjoint(X + Y)) == r'\left(X + Y\right)^{\dagger}'
1744.     assert latex(Adjoint(X) + Adjoint(Y)) == r'X^{\dagger} + Y^{\dagger}'
1745.     assert latex(Adjoint(X*Y)) == r'\left(X Y\right)^{\dagger}'
1746.     assert latex(Adjoint(Y)*Adjoint(X)) == r'Y^{\dagger} X^{\dagger}'
1747.     assert latex(Adjoint(X**2)) == r'\left(X^{2}\right)^{\dagger}'
1748.     assert latex(Adjoint(X)**2) == r'\left(X^{\dagger}\right)^{2}'
1749.     assert latex(Adjoint(Inverse(X))) == r'\left(X^{-1}\right)^{\dagger}'
1750.     assert latex(Inverse(Adjoint(X))) == r'\left(X^{\dagger}\right)^{-1}'
1751.     assert latex(Adjoint(Transpose(X))) == r'\left(X^{T}\right)^{\dagger}'
1752.     assert latex(Transpose(Adjoint(X))) == r'\left(X^{\dagger}\right)^{T}'
1753.     assert latex(Transpose(Adjoint(X) + Y)) == r'\left(X^{\dagger} + Y\right)^{T}'
1754. 
1755. 
1756. def test_Transpose():
1757.     from sympy.matrices import Transpose, MatPow, HadamardPower
1758.     X = MatrixSymbol('X', 2, 2)
1759.     Y = MatrixSymbol('Y', 2, 2)
1760.     assert latex(Transpose(X)) == r'X^{T}'
1761.     assert latex(Transpose(X + Y)) == r'\left(X + Y\right)^{T}'
1762. 
1763.     assert latex(Transpose(HadamardPower(X, 2))) == \
1764.         r'\left(X^{\circ {2}}\right)^{T}'
1765.     assert latex(HadamardPower(Transpose(X), 2)) == \
1766.         r'\left(X^{T}\right)^{\circ {2}}'
1767.     assert latex(Transpose(MatPow(X, 2))) == \
1768.         r'\left(X^{2}\right)^{T}'
1769.     assert latex(MatPow(Transpose(X), 2)) == \
1770.         r'\left(X^{T}\right)^{2}'
1771. 
1772. 
1773. def test_Hadamard():
1774.     from sympy.matrices import MatrixSymbol, HadamardProduct, HadamardPower
1775.     from sympy.matrices.expressions import MatAdd, MatMul, MatPow
1776.     X = MatrixSymbol('X', 2, 2)
1777.     Y = MatrixSymbol('Y', 2, 2)
1778.     assert latex(HadamardProduct(X, Y*Y)) == r'X \circ Y^{2}'
1779.     assert latex(HadamardProduct(X, Y)*Y) == r'\left(X \circ Y\right) Y'
1780. 
1781.     assert latex(HadamardPower(X, 2)) == r'X^{\circ {2}}'
1782.     assert latex(HadamardPower(X, -1)) == r'X^{\circ \left({-1}\right)}'
1783.     assert latex(HadamardPower(MatAdd(X, Y), 2)) == \
1784.         r'\left(X + Y\right)^{\circ {2}}'
1785.     assert latex(HadamardPower(MatMul(X, Y), 2)) == \
1786.         r'\left(X Y\right)^{\circ {2}}'
1787. 
1788.     assert latex(HadamardPower(MatPow(X, -1), -1)) == \
1789.         r'\left(X^{-1}\right)^{\circ \left({-1}\right)}'
1790.     assert latex(MatPow(HadamardPower(X, -1), -1)) == \
1791.         r'\left(X^{\circ \left({-1}\right)}\right)^{-1}'
1792. 
1793.     assert latex(HadamardPower(X, n+1)) == \
1794.         r'X^{\circ \left({n + 1}\right)}'
1795. 
1796. 
1797. def test_ElementwiseApplyFunction():
1798.     from sympy.matrices import MatrixSymbol
1799.     X = MatrixSymbol('X', 2, 2)
1800.     expr = (X.T*X).applyfunc(sin)
1801.     assert latex(expr) == r"{\sin}_{\circ}\left({X^{T} X}\right)"
1802.     expr = X.applyfunc(Lambda(x, 1/x))
1803.     assert latex(expr) == r'{\left( d \mapsto \frac{1}{d} \right)}_{\circ}\left({X}\right)'
1804. 
1805. 
1806. def test_ZeroMatrix():
1807.     from sympy import ZeroMatrix
1808.     assert latex(ZeroMatrix(1, 1), mat_symbol_style='plain') == r"\mathbb{0}"
1809.     assert latex(ZeroMatrix(1, 1), mat_symbol_style='bold') == r"\mathbf{0}"
1810. 
1811. 
1812. def test_OneMatrix():
1813.     from sympy import OneMatrix
1814.     assert latex(OneMatrix(3, 4), mat_symbol_style='plain') == r"\mathbb{1}"
1815.     assert latex(OneMatrix(3, 4), mat_symbol_style='bold') == r"\mathbf{1}"
1816. 
1817. 
1818. def test_Identity():
1819.     from sympy import Identity
1820.     assert latex(Identity(1), mat_symbol_style='plain') == r"\mathbb{I}"
1821.     assert latex(Identity(1), mat_symbol_style='bold') == r"\mathbf{I}"
1822. 
1823. 
1824. def test_boolean_args_order():
1825.     syms = symbols('a:f')
1826. 
1827.     expr = And(*syms)
1828.     assert latex(expr) == 'a \\wedge b \\wedge c \\wedge d \\wedge e \\wedge f'
1829. 
1830.     expr = Or(*syms)
1831.     assert latex(expr) == 'a \\vee b \\vee c \\vee d \\vee e \\vee f'
1832. 
1833.     expr = Equivalent(*syms)
1834.     assert latex(expr) == \
1835.         'a \\Leftrightarrow b \\Leftrightarrow c \\Leftrightarrow d \\Leftrightarrow e \\Leftrightarrow f'
1836. 
1837.     expr = Xor(*syms)
1838.     assert latex(expr) == \
1839.         'a \\veebar b \\veebar c \\veebar d \\veebar e \\veebar f'
1840. 
1841. 
1842. def test_imaginary():
1843.     i = sqrt(-1)
1844.     assert latex(i) == r'i'
1845. 
1846. 
1847. def test_builtins_without_args():
1848.     assert latex(sin) == r'\sin'
1849.     assert latex(cos) == r'\cos'
1850.     assert latex(tan) == r'\tan'
1851.     assert latex(log) == r'\log'
1852.     assert latex(Ei) == r'\operatorname{Ei}'
1853.     assert latex(zeta) == r'\zeta'
1854. 
1855. 
1856. def test_latex_greek_functions():
1857.     # bug because capital greeks that have roman equivalents should not use
1858.     # \Alpha, \Beta, \Eta, etc.
1859.     s = Function('Alpha')
1860.     assert latex(s) == r'A'
1861.     assert latex(s(x)) == r'A{\left(x \right)}'
1862.     s = Function('Beta')
1863.     assert latex(s) == r'B'
1864.     s = Function('Eta')
1865.     assert latex(s) == r'H'
1866.     assert latex(s(x)) == r'H{\left(x \right)}'
1867. 
1868.     # bug because sympy.core.numbers.Pi is special
1869.     p = Function('Pi')
1870.     # assert latex(p(x)) == r'\Pi{\left(x \right)}'
1871.     assert latex(p) == r'\Pi'
1872. 
1873.     # bug because not all greeks are included
1874.     c = Function('chi')
1875.     assert latex(c(x)) == r'\chi{\left(x \right)}'
1876.     assert latex(c) == r'\chi'
1877. 
1878. 
1879. def test_translate():
1880.     s = 'Alpha'
1881.     assert translate(s) == 'A'
1882.     s = 'Beta'
1883.     assert translate(s) == 'B'
1884.     s = 'Eta'
1885.     assert translate(s) == 'H'
1886.     s = 'omicron'
1887.     assert translate(s) == 'o'
1888.     s = 'Pi'
1889.     assert translate(s) == r'\Pi'
1890.     s = 'pi'
1891.     assert translate(s) == r'\pi'
1892.     s = 'LamdaHatDOT'
1893.     assert translate(s) == r'\dot{\hat{\Lambda}}'
1894. 
1895. 
1896. def test_other_symbols():
1897.     from sympy.printing.latex import other_symbols
1898.     for s in other_symbols:
1899.         assert latex(symbols(s)) == "\\"+s
1900. 
1901. 
1902. def test_modifiers():
1903.     # Test each modifier individually in the simplest case
1904.     # (with funny capitalizations)
1905.     assert latex(symbols("xMathring")) == r"\mathring{x}"
1906.     assert latex(symbols("xCheck")) == r"\check{x}"
1907.     assert latex(symbols("xBreve")) == r"\breve{x}"
1908.     assert latex(symbols("xAcute")) == r"\acute{x}"
1909.     assert latex(symbols("xGrave")) == r"\grave{x}"
1910.     assert latex(symbols("xTilde")) == r"\tilde{x}"
1911.     assert latex(symbols("xPrime")) == r"{x}'"
1912.     assert latex(symbols("xddDDot")) == r"\ddddot{x}"
1913.     assert latex(symbols("xDdDot")) == r"\dddot{x}"
1914.     assert latex(symbols("xDDot")) == r"\ddot{x}"
1915.     assert latex(symbols("xBold")) == r"\boldsymbol{x}"
1916.     assert latex(symbols("xnOrM")) == r"\left\|{x}\right\|"
1917.     assert latex(symbols("xAVG")) == r"\left\langle{x}\right\rangle"
1918.     assert latex(symbols("xHat")) == r"\hat{x}"
1919.     assert latex(symbols("xDot")) == r"\dot{x}"
1920.     assert latex(symbols("xBar")) == r"\bar{x}"
1921.     assert latex(symbols("xVec")) == r"\vec{x}"
1922.     assert latex(symbols("xAbs")) == r"\left|{x}\right|"
1923.     assert latex(symbols("xMag")) == r"\left|{x}\right|"
1924.     assert latex(symbols("xPrM")) == r"{x}'"
1925.     assert latex(symbols("xBM")) == r"\boldsymbol{x}"
1926.     # Test strings that are *only* the names of modifiers
1927.     assert latex(symbols("Mathring")) == r"Mathring"
1928.     assert latex(symbols("Check")) == r"Check"
1929.     assert latex(symbols("Breve")) == r"Breve"
1930.     assert latex(symbols("Acute")) == r"Acute"
1931.     assert latex(symbols("Grave")) == r"Grave"
1932.     assert latex(symbols("Tilde")) == r"Tilde"
1933.     assert latex(symbols("Prime")) == r"Prime"
1934.     assert latex(symbols("DDot")) == r"\dot{D}"
1935.     assert latex(symbols("Bold")) == r"Bold"
1936.     assert latex(symbols("NORm")) == r"NORm"
1937.     assert latex(symbols("AVG")) == r"AVG"
1938.     assert latex(symbols("Hat")) == r"Hat"
1939.     assert latex(symbols("Dot")) == r"Dot"
1940.     assert latex(symbols("Bar")) == r"Bar"
1941.     assert latex(symbols("Vec")) == r"Vec"
1942.     assert latex(symbols("Abs")) == r"Abs"
1943.     assert latex(symbols("Mag")) == r"Mag"
1944.     assert latex(symbols("PrM")) == r"PrM"
1945.     assert latex(symbols("BM")) == r"BM"
1946.     assert latex(symbols("hbar")) == r"\hbar"
1947.     # Check a few combinations
1948.     assert latex(symbols("xvecdot")) == r"\dot{\vec{x}}"
1949.     assert latex(symbols("xDotVec")) == r"\vec{\dot{x}}"
1950.     assert latex(symbols("xHATNorm")) == r"\left\|{\hat{x}}\right\|"
1951.     # Check a couple big, ugly combinations
1952.     assert latex(symbols('xMathringBm_yCheckPRM__zbreveAbs')) == \
1953.         r"\boldsymbol{\mathring{x}}^{\left|{\breve{z}}\right|}_{{\check{y}}'}"
1954.     assert latex(symbols('alphadothat_nVECDOT__tTildePrime')) == \
1955.         r"\hat{\dot{\alpha}}^{{\tilde{t}}'}_{\dot{\vec{n}}}"
1956. 
1957. 
1958. def test_greek_symbols():
1959.     assert latex(Symbol('alpha'))   == r'\alpha'
1960.     assert latex(Symbol('beta'))    == r'\beta'
1961.     assert latex(Symbol('gamma'))   == r'\gamma'
1962.     assert latex(Symbol('delta'))   == r'\delta'
1963.     assert latex(Symbol('epsilon')) == r'\epsilon'
1964.     assert latex(Symbol('zeta'))    == r'\zeta'
1965.     assert latex(Symbol('eta'))     == r'\eta'
1966.     assert latex(Symbol('theta'))   == r'\theta'
1967.     assert latex(Symbol('iota'))    == r'\iota'
1968.     assert latex(Symbol('kappa'))   == r'\kappa'
1969.     assert latex(Symbol('lambda'))  == r'\lambda'
1970.     assert latex(Symbol('mu'))      == r'\mu'
1971.     assert latex(Symbol('nu'))      == r'\nu'
1972.     assert latex(Symbol('xi'))      == r'\xi'
1973.     assert latex(Symbol('omicron')) == r'o'
1974.     assert latex(Symbol('pi'))      == r'\pi'
1975.     assert latex(Symbol('rho'))     == r'\rho'
1976.     assert latex(Symbol('sigma'))   == r'\sigma'
1977.     assert latex(Symbol('tau'))     == r'\tau'
1978.     assert latex(Symbol('upsilon')) == r'\upsilon'
1979.     assert latex(Symbol('phi'))     == r'\phi'
1980.     assert latex(Symbol('chi'))     == r'\chi'
1981.     assert latex(Symbol('psi'))     == r'\psi'
1982.     assert latex(Symbol('omega'))   == r'\omega'
1983. 
1984.     assert latex(Symbol('Alpha'))   == r'A'
1985.     assert latex(Symbol('Beta'))    == r'B'
1986.     assert latex(Symbol('Gamma'))   == r'\Gamma'
1987.     assert latex(Symbol('Delta'))   == r'\Delta'
1988.     assert latex(Symbol('Epsilon')) == r'E'
1989.     assert latex(Symbol('Zeta'))    == r'Z'
1990.     assert latex(Symbol('Eta'))     == r'H'
1991.     assert latex(Symbol('Theta'))   == r'\Theta'
1992.     assert latex(Symbol('Iota'))    == r'I'
1993.     assert latex(Symbol('Kappa'))   == r'K'
1994.     assert latex(Symbol('Lambda'))  == r'\Lambda'
1995.     assert latex(Symbol('Mu'))      == r'M'
1996.     assert latex(Symbol('Nu'))      == r'N'
1997.     assert latex(Symbol('Xi'))      == r'\Xi'
1998.     assert latex(Symbol('Omicron')) == r'O'
1999.     assert latex(Symbol('Pi'))      == r'\Pi'
2000.     assert latex(Symbol('Rho'))     == r'P'
2001.     assert latex(Symbol('Sigma'))   == r'\Sigma'
2002.     assert latex(Symbol('Tau'))     == r'T'

File: sympy/printing/tests/test_latex.py
Line number range: 2003 - 2503
Content:
2003.     assert latex(Symbol('Upsilon')) == r'\Upsilon'
2004.     assert latex(Symbol('Phi'))     == r'\Phi'
2005.     assert latex(Symbol('Chi'))     == r'X'
2006.     assert latex(Symbol('Psi'))     == r'\Psi'
2007.     assert latex(Symbol('Omega'))   == r'\Omega'
2008. 
2009.     assert latex(Symbol('varepsilon')) == r'\varepsilon'
2010.     assert latex(Symbol('varkappa')) == r'\varkappa'
2011.     assert latex(Symbol('varphi')) == r'\varphi'
2012.     assert latex(Symbol('varpi')) == r'\varpi'
2013.     assert latex(Symbol('varrho')) == r'\varrho'
2014.     assert latex(Symbol('varsigma')) == r'\varsigma'
2015.     assert latex(Symbol('vartheta')) == r'\vartheta'
2016. 
2017. 
2018. def test_fancyset_symbols():
2019.     assert latex(S.Rationals) == '\\mathbb{Q}'
2020.     assert latex(S.Naturals) == '\\mathbb{N}'
2021.     assert latex(S.Naturals0) == '\\mathbb{N}_0'
2022.     assert latex(S.Integers) == '\\mathbb{Z}'
2023.     assert latex(S.Reals) == '\\mathbb{R}'
2024.     assert latex(S.Complexes) == '\\mathbb{C}'
2025. 
2026. 
2027. @XFAIL
2028. def test_builtin_without_args_mismatched_names():
2029.     assert latex(CosineTransform) == r'\mathcal{COS}'
2030. 
2031. 
2032. def test_builtin_no_args():
2033.     assert latex(Chi) == r'\operatorname{Chi}'
2034.     assert latex(beta) == r'\operatorname{B}'
2035.     assert latex(gamma) == r'\Gamma'
2036.     assert latex(KroneckerDelta) == r'\delta'
2037.     assert latex(DiracDelta) == r'\delta'
2038.     assert latex(lowergamma) == r'\gamma'
2039. 
2040. 
2041. def test_issue_6853():
2042.     p = Function('Pi')
2043.     assert latex(p(x)) == r"\Pi{\left(x \right)}"
2044. 
2045. 
2046. def test_Mul():
2047.     e = Mul(-2, x + 1, evaluate=False)
2048.     assert latex(e) == r'- 2 \left(x + 1\right)'
2049.     e = Mul(2, x + 1, evaluate=False)
2050.     assert latex(e) == r'2 \left(x + 1\right)'
2051.     e = Mul(S.Half, x + 1, evaluate=False)
2052.     assert latex(e) == r'\frac{x + 1}{2}'
2053.     e = Mul(y, x + 1, evaluate=False)
2054.     assert latex(e) == r'y \left(x + 1\right)'
2055.     e = Mul(-y, x + 1, evaluate=False)
2056.     assert latex(e) == r'- y \left(x + 1\right)'
2057.     e = Mul(-2, x + 1)
2058.     assert latex(e) == r'- 2 x - 2'
2059.     e = Mul(2, x + 1)
2060.     assert latex(e) == r'2 x + 2'
2061. 
2062. 
2063. def test_Pow():
2064.     e = Pow(2, 2, evaluate=False)
2065.     assert latex(e) == r'2^{2}'
2066.     assert latex(x**(Rational(-1, 3))) == r'\frac{1}{\sqrt[3]{x}}'
2067.     x2 = Symbol(r'x^2')
2068.     assert latex(x2**2) == r'\left(x^{2}\right)^{2}'
2069. 
2070. 
2071. def test_issue_7180():
2072.     assert latex(Equivalent(x, y)) == r"x \Leftrightarrow y"
2073.     assert latex(Not(Equivalent(x, y))) == r"x \not\Leftrightarrow y"
2074. 
2075. 
2076. def test_issue_8409():
2077.     assert latex(S.Half**n) == r"\left(\frac{1}{2}\right)^{n}"
2078. 
2079. 
2080. def test_issue_8470():
2081.     from sympy.parsing.sympy_parser import parse_expr
2082.     e = parse_expr("-B*A", evaluate=False)
2083.     assert latex(e) == r"A \left(- B\right)"
2084. 
2085. 
2086. def test_issue_7117():
2087.     # See also issue #5031 (hence the evaluate=False in these).
2088.     e = Eq(x + 1, 2*x)
2089.     q = Mul(2, e, evaluate=False)
2090.     assert latex(q) == r"2 \left(x + 1 = 2 x\right)"
2091.     q = Add(6, e, evaluate=False)
2092.     assert latex(q) == r"6 + \left(x + 1 = 2 x\right)"
2093.     q = Pow(e, 2, evaluate=False)
2094.     assert latex(q) == r"\left(x + 1 = 2 x\right)^{2}"
2095. 
2096. 
2097. def test_issue_15439():
2098.     x = MatrixSymbol('x', 2, 2)
2099.     y = MatrixSymbol('y', 2, 2)
2100.     assert latex((x * y).subs(y, -y)) == r"x \left(- y\right)"
2101.     assert latex((x * y).subs(y, -2*y)) == r"x \left(- 2 y\right)"
2102.     assert latex((x * y).subs(x, -x)) == r"- x y"
2103. 
2104. 
2105. def test_issue_2934():
2106.     assert latex(Symbol(r'\frac{a_1}{b_1}')) == '\\frac{a_1}{b_1}'
2107. 
2108. 
2109. def test_issue_10489():
2110.     latexSymbolWithBrace = 'C_{x_{0}}'
2111.     s = Symbol(latexSymbolWithBrace)
2112.     assert latex(s) == latexSymbolWithBrace
2113.     assert latex(cos(s)) == r'\cos{\left(C_{x_{0}} \right)}'
2114. 
2115. 
2116. def test_issue_12886():
2117.     m__1, l__1 = symbols('m__1, l__1')
2118.     assert latex(m__1**2 + l__1**2) == \
2119.         r'\left(l^{1}\right)^{2} + \left(m^{1}\right)^{2}'
2120. 
2121. 
2122. def test_issue_13559():
2123.     from sympy.parsing.sympy_parser import parse_expr
2124.     expr = parse_expr('5/1', evaluate=False)
2125.     assert latex(expr) == r"\frac{5}{1}"
2126. 
2127. 
2128. def test_issue_13651():
2129.     expr = c + Mul(-1, a + b, evaluate=False)
2130.     assert latex(expr) == r"c - \left(a + b\right)"
2131. 
2132. 
2133. def test_latex_UnevaluatedExpr():
2134.     x = symbols("x")
2135.     he = UnevaluatedExpr(1/x)
2136.     assert latex(he) == latex(1/x) == r"\frac{1}{x}"
2137.     assert latex(he**2) == r"\left(\frac{1}{x}\right)^{2}"
2138.     assert latex(he + 1) == r"1 + \frac{1}{x}"
2139.     assert latex(x*he) == r"x \frac{1}{x}"
2140. 
2141. 
2142. def test_MatrixElement_printing():
2143.     # test cases for issue #11821
2144.     A = MatrixSymbol("A", 1, 3)
2145.     B = MatrixSymbol("B", 1, 3)
2146.     C = MatrixSymbol("C", 1, 3)
2147. 
2148.     assert latex(A[0, 0]) == r"A_{0, 0}"
2149.     assert latex(3 * A[0, 0]) == r"3 A_{0, 0}"
2150. 
2151.     F = C[0, 0].subs(C, A - B)
2152.     assert latex(F) == r"\left(A - B\right)_{0, 0}"
2153. 
2154.     i, j, k = symbols("i j k")
2155.     M = MatrixSymbol("M", k, k)
2156.     N = MatrixSymbol("N", k, k)
2157.     assert latex((M*N)[i, j]) == \
2158.         r'\sum_{i_{1}=0}^{k - 1} M_{i, i_{1}} N_{i_{1}, j}'
2159. 
2160. 
2161. def test_MatrixSymbol_printing():
2162.     # test cases for issue #14237
2163.     A = MatrixSymbol("A", 3, 3)
2164.     B = MatrixSymbol("B", 3, 3)
2165.     C = MatrixSymbol("C", 3, 3)
2166. 
2167.     assert latex(-A) == r"- A"
2168.     assert latex(A - A*B - B) == r"A - A B - B"
2169.     assert latex(-A*B - A*B*C - B) == r"- A B - A B C - B"
2170. 
2171. 
2172. def test_KroneckerProduct_printing():
2173.     A = MatrixSymbol('A', 3, 3)
2174.     B = MatrixSymbol('B', 2, 2)
2175.     assert latex(KroneckerProduct(A, B)) == r'A \otimes B'
2176. 
2177. 
2178. def test_Quaternion_latex_printing():
2179.     q = Quaternion(x, y, z, t)
2180.     assert latex(q) == "x + y i + z j + t k"
2181.     q = Quaternion(x, y, z, x*t)
2182.     assert latex(q) == "x + y i + z j + t x k"
2183.     q = Quaternion(x, y, z, x + t)
2184.     assert latex(q) == r"x + y i + z j + \left(t + x\right) k"
2185. 
2186. 
2187. def test_TensorProduct_printing():
2188.     from sympy.tensor.functions import TensorProduct
2189.     A = MatrixSymbol("A", 3, 3)
2190.     B = MatrixSymbol("B", 3, 3)
2191.     assert latex(TensorProduct(A, B)) == r"A \otimes B"
2192. 
2193. 
2194. def test_WedgeProduct_printing():
2195.     from sympy.diffgeom.rn import R2
2196.     from sympy.diffgeom import WedgeProduct
2197.     wp = WedgeProduct(R2.dx, R2.dy)
2198.     assert latex(wp) == r"\operatorname{d}x \wedge \operatorname{d}y"
2199. 
2200. 
2201. def test_issue_14041():
2202.     import sympy.physics.mechanics as me
2203. 
2204.     A_frame = me.ReferenceFrame('A')
2205.     thetad, phid = me.dynamicsymbols('theta, phi', 1)
2206.     L = Symbol('L')
2207. 
2208.     assert latex(L*(phid + thetad)**2*A_frame.x) == \
2209.         r"L \left(\dot{\phi} + \dot{\theta}\right)^{2}\mathbf{\hat{a}_x}"
2210.     assert latex((phid + thetad)**2*A_frame.x) == \
2211.         r"\left(\dot{\phi} + \dot{\theta}\right)^{2}\mathbf{\hat{a}_x}"
2212.     assert latex((phid*thetad)**a*A_frame.x) == \
2213.         r"\left(\dot{\phi} \dot{\theta}\right)^{a}\mathbf{\hat{a}_x}"
2214. 
2215. 
2216. def test_issue_9216():
2217.     expr_1 = Pow(1, -1, evaluate=False)
2218.     assert latex(expr_1) == r"1^{-1}"
2219. 
2220.     expr_2 = Pow(1, Pow(1, -1, evaluate=False), evaluate=False)
2221.     assert latex(expr_2) == r"1^{1^{-1}}"
2222. 
2223.     expr_3 = Pow(3, -2, evaluate=False)
2224.     assert latex(expr_3) == r"\frac{1}{9}"
2225. 
2226.     expr_4 = Pow(1, -2, evaluate=False)
2227.     assert latex(expr_4) == r"1^{-2}"
2228. 
2229. 
2230. def test_latex_printer_tensor():
2231.     from sympy.tensor.tensor import TensorIndexType, tensor_indices, TensorHead, tensor_heads
2232.     L = TensorIndexType("L")
2233.     i, j, k, l = tensor_indices("i j k l", L)
2234.     i0 = tensor_indices("i_0", L)
2235.     A, B, C, D = tensor_heads("A B C D", [L])
2236.     H = TensorHead("H", [L, L])
2237.     K = TensorHead("K", [L, L, L, L])
2238. 
2239.     assert latex(i) == "{}^{i}"
2240.     assert latex(-i) == "{}_{i}"
2241. 
2242.     expr = A(i)
2243.     assert latex(expr) == "A{}^{i}"
2244. 
2245.     expr = A(i0)
2246.     assert latex(expr) == "A{}^{i_{0}}"
2247. 
2248.     expr = A(-i)
2249.     assert latex(expr) == "A{}_{i}"
2250. 
2251.     expr = -3*A(i)
2252.     assert latex(expr) == r"-3A{}^{i}"
2253. 
2254.     expr = K(i, j, -k, -i0)
2255.     assert latex(expr) == "K{}^{ij}{}_{ki_{0}}"
2256. 
2257.     expr = K(i, -j, -k, i0)
2258.     assert latex(expr) == "K{}^{i}{}_{jk}{}^{i_{0}}"
2259. 
2260.     expr = K(i, -j, k, -i0)
2261.     assert latex(expr) == "K{}^{i}{}_{j}{}^{k}{}_{i_{0}}"
2262. 
2263.     expr = H(i, -j)
2264.     assert latex(expr) == "H{}^{i}{}_{j}"
2265. 
2266.     expr = H(i, j)
2267.     assert latex(expr) == "H{}^{ij}"
2268. 
2269.     expr = H(-i, -j)
2270.     assert latex(expr) == "H{}_{ij}"
2271. 
2272.     expr = (1+x)*A(i)
2273.     assert latex(expr) == r"\left(x + 1\right)A{}^{i}"
2274. 
2275.     expr = H(i, -i)
2276.     assert latex(expr) == "H{}^{L_{0}}{}_{L_{0}}"
2277. 
2278.     expr = H(i, -j)*A(j)*B(k)
2279.     assert latex(expr) == "H{}^{i}{}_{L_{0}}A{}^{L_{0}}B{}^{k}"
2280. 
2281.     expr = A(i) + 3*B(i)
2282.     assert latex(expr) == "3B{}^{i} + A{}^{i}"
2283. 
2284.     # Test ``TensorElement``:
2285.     from sympy.tensor.tensor import TensorElement
2286. 
2287.     expr = TensorElement(K(i, j, k, l), {i: 3, k: 2})
2288.     assert latex(expr) == 'K{}^{i=3,j,k=2,l}'
2289. 
2290.     expr = TensorElement(K(i, j, k, l), {i: 3})
2291.     assert latex(expr) == 'K{}^{i=3,jkl}'
2292. 
2293.     expr = TensorElement(K(i, -j, k, l), {i: 3, k: 2})
2294.     assert latex(expr) == 'K{}^{i=3}{}_{j}{}^{k=2,l}'
2295. 
2296.     expr = TensorElement(K(i, -j, k, -l), {i: 3, k: 2})
2297.     assert latex(expr) == 'K{}^{i=3}{}_{j}{}^{k=2}{}_{l}'
2298. 
2299.     expr = TensorElement(K(i, j, -k, -l), {i: 3, -k: 2})
2300.     assert latex(expr) == 'K{}^{i=3,j}{}_{k=2,l}'
2301. 
2302.     expr = TensorElement(K(i, j, -k, -l), {i: 3})
2303.     assert latex(expr) == 'K{}^{i=3,j}{}_{kl}'
2304. 
2305. 
2306. def test_multiline_latex():
2307.     a, b, c, d, e, f = symbols('a b c d e f')
2308.     expr = -a + 2*b -3*c +4*d -5*e
2309.     expected = r"\begin{eqnarray}" + "\n"\
2310.     r"f & = &- a \nonumber\\" + "\n"\
2311.     r"& & + 2 b \nonumber\\" + "\n"\
2312.     r"& & - 3 c \nonumber\\" + "\n"\
2313.     r"& & + 4 d \nonumber\\" + "\n"\
2314.     r"& & - 5 e " + "\n"\
2315.     r"\end{eqnarray}"
2316.     assert multiline_latex(f, expr, environment="eqnarray") == expected
2317. 
2318.     expected2 = r'\begin{eqnarray}' + '\n'\
2319.     r'f & = &- a + 2 b \nonumber\\' + '\n'\
2320.     r'& & - 3 c + 4 d \nonumber\\' + '\n'\
2321.     r'& & - 5 e ' + '\n'\
2322.     r'\end{eqnarray}'
2323. 
2324.     assert multiline_latex(f, expr, 2, environment="eqnarray") == expected2
2325. 
2326.     expected3 = r'\begin{eqnarray}' + '\n'\
2327.     r'f & = &- a + 2 b - 3 c \nonumber\\'+ '\n'\
2328.     r'& & + 4 d - 5 e ' + '\n'\
2329.     r'\end{eqnarray}'
2330. 
2331.     assert multiline_latex(f, expr, 3, environment="eqnarray") == expected3
2332. 
2333.     expected3dots = r'\begin{eqnarray}' + '\n'\
2334.     r'f & = &- a + 2 b - 3 c \dots\nonumber\\'+ '\n'\
2335.     r'& & + 4 d - 5 e ' + '\n'\
2336.     r'\end{eqnarray}'
2337. 
2338.     assert multiline_latex(f, expr, 3, environment="eqnarray", use_dots=True) == expected3dots
2339. 
2340.     expected3align = r'\begin{align*}' + '\n'\
2341.     r'f = &- a + 2 b - 3 c \\'+ '\n'\
2342.     r'& + 4 d - 5 e ' + '\n'\
2343.     r'\end{align*}'
2344. 
2345.     assert multiline_latex(f, expr, 3) == expected3align
2346.     assert multiline_latex(f, expr, 3, environment='align*') == expected3align
2347. 
2348.     expected2ieee = r'\begin{IEEEeqnarray}{rCl}' + '\n'\
2349.     r'f & = &- a + 2 b \nonumber\\' + '\n'\
2350.     r'& & - 3 c + 4 d \nonumber\\' + '\n'\
2351.     r'& & - 5 e ' + '\n'\
2352.     r'\end{IEEEeqnarray}'
2353. 
2354.     assert multiline_latex(f, expr, 2, environment="IEEEeqnarray") == expected2ieee
2355. 
2356.     raises(ValueError, lambda: multiline_latex(f, expr, environment="foo"))
2357. 
2358. def test_issue_15353():
2359.     from sympy import ConditionSet, Tuple, FiniteSet, S, sin, cos
2360.     a, x = symbols('a x')
2361.     # Obtained from nonlinsolve([(sin(a*x)),cos(a*x)],[x,a])
2362.     sol = ConditionSet(
2363.         Tuple(x, a), Eq(sin(a*x), 0) & Eq(cos(a*x), 0), S.Complexes**2)
2364.     assert latex(sol) == \
2365.         r'\left\{\left( x, \  a\right) \mid \left( x, \  a\right) \in ' \
2366.         r'\mathbb{C}^{2} \wedge \sin{\left(a x \right)} = 0 \wedge ' \
2367.         r'\cos{\left(a x \right)} = 0 \right\}'
2368. 
2369. 
2370. def test_trace():
2371.     # Issue 15303
2372.     from sympy import trace
2373.     A = MatrixSymbol("A", 2, 2)
2374.     assert latex(trace(A)) == r"\operatorname{tr}\left(A \right)"
2375.     assert latex(trace(A**2)) == r"\operatorname{tr}\left(A^{2} \right)"
2376. 
2377. 
2378. def test_print_basic():
2379.     # Issue 15303
2380.     from sympy import Basic, Expr
2381. 
2382.     # dummy class for testing printing where the function is not
2383.     # implemented in latex.py
2384.     class UnimplementedExpr(Expr):
2385.         def __new__(cls, e):
2386.             return Basic.__new__(cls, e)
2387. 
2388.     # dummy function for testing
2389.     def unimplemented_expr(expr):
2390.         return UnimplementedExpr(expr).doit()
2391. 
2392.     # override class name to use superscript / subscript
2393.     def unimplemented_expr_sup_sub(expr):
2394.         result = UnimplementedExpr(expr)
2395.         result.__class__.__name__ = 'UnimplementedExpr_x^1'
2396.         return result
2397. 
2398.     assert latex(unimplemented_expr(x)) == r'UnimplementedExpr\left(x\right)'
2399.     assert latex(unimplemented_expr(x**2)) == \
2400.         r'UnimplementedExpr\left(x^{2}\right)'
2401.     assert latex(unimplemented_expr_sup_sub(x)) == \
2402.         r'UnimplementedExpr^{1}_{x}\left(x\right)'
2403. 
2404. 
2405. def test_MatrixSymbol_bold():
2406.     # Issue #15871
2407.     from sympy import trace
2408.     A = MatrixSymbol("A", 2, 2)
2409.     assert latex(trace(A), mat_symbol_style='bold') == \
2410.         r"\operatorname{tr}\left(\mathbf{A} \right)"
2411.     assert latex(trace(A), mat_symbol_style='plain') == \
2412.         r"\operatorname{tr}\left(A \right)"
2413. 
2414.     A = MatrixSymbol("A", 3, 3)
2415.     B = MatrixSymbol("B", 3, 3)
2416.     C = MatrixSymbol("C", 3, 3)
2417. 
2418.     assert latex(-A, mat_symbol_style='bold') == r"- \mathbf{A}"
2419.     assert latex(A - A*B - B, mat_symbol_style='bold') == \
2420.         r"\mathbf{A} - \mathbf{A} \mathbf{B} - \mathbf{B}"
2421.     assert latex(-A*B - A*B*C - B, mat_symbol_style='bold') == \
2422.         r"- \mathbf{A} \mathbf{B} - \mathbf{A} \mathbf{B} \mathbf{C} - \mathbf{B}"
2423. 
2424.     A = MatrixSymbol("A_k", 3, 3)
2425.     assert latex(A, mat_symbol_style='bold') == r"\mathbf{A_{k}}"
2426. 
2427. 
2428. def test_imaginary_unit():
2429.     assert latex(1 + I) == '1 + i'
2430.     assert latex(1 + I, imaginary_unit='i') == '1 + i'
2431.     assert latex(1 + I, imaginary_unit='j') == '1 + j'
2432.     assert latex(1 + I, imaginary_unit='foo') == '1 + foo'
2433.     assert latex(I, imaginary_unit="ti") == '\\text{i}'
2434.     assert latex(I, imaginary_unit="tj") == '\\text{j}'
2435. 
2436. 
2437. def test_text_re_im():
2438.     assert latex(im(x), gothic_re_im=True) ==  r'\Im{\left(x\right)}'
2439.     assert latex(im(x), gothic_re_im=False) ==  r'\operatorname{im}{\left(x\right)}'
2440.     assert latex(re(x), gothic_re_im=True) ==  r'\Re{\left(x\right)}'
2441.     assert latex(re(x), gothic_re_im=False) ==  r'\operatorname{re}{\left(x\right)}'
2442. 
2443. 
2444. def test_DiffGeomMethods():
2445.     from sympy.diffgeom import Manifold, Patch, CoordSystem, BaseScalarField, Differential
2446.     from sympy.diffgeom.rn import R2
2447.     m = Manifold('M', 2)
2448.     assert latex(m) == r'\text{M}'
2449.     p = Patch('P', m)
2450.     assert latex(p) == r'\text{P}_{\text{M}}'
2451.     rect = CoordSystem('rect', p)
2452.     assert latex(rect) == r'\text{rect}^{\text{P}}_{\text{M}}'
2453.     b = BaseScalarField(rect, 0)
2454.     assert latex(b) ==  r'\mathbf{rect_{0}}'
2455. 
2456.     g = Function('g')
2457.     s_field = g(R2.x, R2.y)
2458.     assert latex(Differential(s_field)) == \
2459.         r'\operatorname{d}\left(g{\left(\mathbf{x},\mathbf{y} \right)}\right)'
2460. 
2461. 
2462. def test_unit_printing():
2463.     assert latex(5*meter) == r'5 \text{m}'
2464.     assert latex(3*gibibyte) == r'3 \text{gibibyte}'
2465.     assert latex(4*microgram/second) == r'\frac{4 \mu\text{g}}{\text{s}}'
2466. 
2467. 
2468. def test_issue_17092():
2469.     x_star = Symbol('x^*')
2470.     assert latex(Derivative(x_star, x_star,2)) == r'\frac{d^{2}}{d \left(x^{*}\right)^{2}} x^{*}'
2471. 
2472. 
2473. def test_latex_decimal_separator():
2474. 
2475.     x, y, z, t = symbols('x y z t')
2476.     k, m, n = symbols('k m n', integer=True)
2477.     f, g, h = symbols('f g h', cls=Function)
2478. 
2479.     # comma decimal_separator
2480.     assert(latex([1, 2.3, 4.5], decimal_separator='comma') == r'\left[ 1; \  2{,}3; \  4{,}5\right]')
2481.     assert(latex(FiniteSet(1, 2.3, 4.5), decimal_separator='comma') == r'\left\{1; 2{,}3; 4{,}5\right\}')
2482.     assert(latex((1, 2.3, 4.6), decimal_separator = 'comma') == r'\left( 1; \  2{,}3; \  4{,}6\right)')
2483. 
2484.     # period decimal_separator
2485.     assert(latex([1, 2.3, 4.5], decimal_separator='period') == r'\left[ 1, \  2.3, \  4.5\right]' )
2486.     assert(latex(FiniteSet(1, 2.3, 4.5), decimal_separator='period') == r'\left\{1, 2.3, 4.5\right\}')
2487.     assert(latex((1, 2.3, 4.6), decimal_separator = 'period') == r'\left( 1, \  2.3, \  4.6\right)')
2488. 
2489.     # default decimal_separator
2490.     assert(latex([1, 2.3, 4.5]) == r'\left[ 1, \  2.3, \  4.5\right]')
2491.     assert(latex(FiniteSet(1, 2.3, 4.5)) == r'\left\{1, 2.3, 4.5\right\}')
2492.     assert(latex((1, 2.3, 4.6)) == r'\left( 1, \  2.3, \  4.6\right)')
2493. 
2494.     assert(latex(Mul(3.4,5.3), decimal_separator = 'comma') ==r'18{,}02')
2495.     assert(latex(3.4*5.3, decimal_separator = 'comma')==r'18{,}02')
2496.     x = symbols('x')
2497.     y = symbols('y')
2498.     z = symbols('z')
2499.     assert(latex(x*5.3 + 2**y**3.4 + 4.5 + z, decimal_separator = 'comma')== r'2^{y^{3{,}4}} + 5{,}3 x + z + 4{,}5')
2500. 
2501.     assert(latex(0.987, decimal_separator='comma') == r'0{,}987')
2502.     assert(latex(S(0.987), decimal_separator='comma')== r'0{,}987')
2503.     assert(latex(.3, decimal_separator='comma')== r'0{,}3')

File: sympy/printing/tests/test_latex.py
Line number range: 2504 - 9999
Content:
2504.     assert(latex(S(.3), decimal_separator='comma')== r'0{,}3')
2505. 
2506. 
2507.     assert(latex(5.8*10**(-7), decimal_separator='comma') ==r'5{,}8e-07')
2508.     assert(latex(S(5.7)*10**(-7), decimal_separator='comma')==r'5{,}7 \cdot 10^{-7}')
2509.     assert(latex(S(5.7*10**(-7)), decimal_separator='comma')==r'5{,}7 \cdot 10^{-7}')
2510. 
2511.     x = symbols('x')
2512.     assert(latex(1.2*x+3.4, decimal_separator='comma')==r'1{,}2 x + 3{,}4')
2513.     assert(latex(FiniteSet(1, 2.3, 4.5), decimal_separator='period')==r'\left\{1, 2.3, 4.5\right\}')
2514. 
2515.     # Error Handling tests
2516.     raises(ValueError, lambda: latex([1,2.3,4.5], decimal_separator='non_existing_decimal_separator_in_list'))
2517.     raises(ValueError, lambda: latex(FiniteSet(1,2.3,4.5), decimal_separator='non_existing_decimal_separator_in_set'))
2518.     raises(ValueError, lambda: latex((1,2.3,4.5), decimal_separator='non_existing_decimal_separator_in_tuple'))
2519. 
2520. 
2521. def test_issue_17857():
2522.     assert latex(Range(-oo, oo)) == r'\left\{\ldots, -1, 0, 1, \ldots\right\}'
2523.     assert latex(Range(oo, -oo, -1)) == r'\left\{\ldots, 1, 0, -1, \ldots\right\}'


--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to a given query and the refinement query, and return your response in the specified format!
EVERY context object MUST include: reasoning, relative_path, start_line, and end_line.

2025-10-06 08:57:17,752 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="1. Query requirement analysis:\n   - The user query is about an issue with the LaTeX printing of a `Subs` object, specifically when it is multiplied by a scalar and contains an addition expression.\n   - This test case directly tests the LaTeX rendering of the `Subs` object.\n2. Extended relevance:\n   - This is the primary test for the `Subs` object in the provided file. It's essential for understanding the existing test coverage and expected output for the `Subs` class, which is at the core of the bug.", relative_path='sympy/printing/tests/test_latex.py', start_line=675, end_line=678), ContextOutput(reasoning='1. Query requirement analysis:\n   - The bug report shows `3*Subs(-x+y, ...)` which is a `Mul` operation. The issue is the lack of parentheses around the `Subs` output.\n   - This test, `test_Mul`, specifically checks for the correct parenthesizing of an `Add` expression (`x + 1`) when it is multiplied by a scalar or a symbol, e.g., `Mul(-2, x + 1, evaluate=False)`.\n2. Extended relevance:\n   - This test is functionally very similar to the bug report. It demonstrates the expected behavior for parenthesizing an addition within a multiplication, which is what is failing for the `Subs` object containing an addition.', relative_path='sympy/printing/tests/test_latex.py', start_line=2046, end_line=2061), ContextOutput(reasoning='1. Query requirement analysis:\n   - The issue is about parenthesizing a complex object (`Subs`) when it\'s a factor in a multiplication.\n   - This test case checks the exact same scenario for a different complex object, `Piecewise`. The assertions `latex(A*p) == r"A \\left(%s\\right)" % s` and `latex(p*A) == r"\\left(%s\\right) A" % s` directly test that the `Piecewise` object `p` is parenthesized when multiplied.\n2. Extended relevance:\n   - This provides a template for how parenthesizing of complex objects in multiplication is tested in the suite. A similar test could be written for `Subs` to replicate the bug.', relative_path='sympy/printing/tests/test_latex.py', start_line=1213, end_line=1232), ContextOutput(reasoning='1. Query requirement analysis:\n   - The bug involves a `Mul` operation not parenthesizing one of its arguments correctly.\n   - This test case, `test_issue_7117`, demonstrates the correct parenthesizing for an `Eq` object inside a `Mul` expression: `Mul(2, e, evaluate=False)` results in `2 \\left(x + 1 = 2 x\\right)`.\n2. Extended relevance:\n   - This provides another strong analogy for the bug. It shows that the printing system has logic to parenthesize certain objects in a multiplication context, and that this logic is not being correctly applied to `Subs`.', relative_path='sympy/printing/tests/test_latex.py', start_line=2086, end_line=2095), ContextOutput(reasoning="1. Query requirement analysis:\n   - The bug report example is `3*Subs(...)`, which involves a scalar multiplying a SymPy object that contains an expression.\n   - The assertion `latex(2 * Mod(x, 7)) == r'2 \\left(x\\bmod{7}\\right)'` is a perfect and concise analogy. It verifies that a `Mod` object is correctly parenthesized when multiplied by a scalar.\n2. Extended relevance:\n   - This test demonstrates the expected printing behavior for other function-like objects when they are part of a multiplication, highlighting the inconsistent behavior of the `Subs` object and providing a clear example of the correct output format.", relative_path='sympy/printing/tests/test_latex.py', start_line=533, end_line=538)]
2025-10-06 08:57:17,753 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - INFO - Context extraction complete, returning context [Context(relative_path='sympy/printing/tests/test_latex.py', content='209. def test_latex_vector_expressions():\n210.     A = CoordSys3D(\'A\')\n211. \n212.     assert latex(Cross(A.i, A.j*A.x*3+A.k)) == \\\n213.         r"\\mathbf{\\hat{i}_{A}} \\times \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}} + \\mathbf{\\hat{k}_{A}}\\right)"\n214.     assert latex(Cross(A.i, A.j)) == \\\n215.         r"\\mathbf{\\hat{i}_{A}} \\times \\mathbf{\\hat{j}_{A}}"\n216.     assert latex(x*Cross(A.i, A.j)) == \\\n217.         r"x \\left(\\mathbf{\\hat{i}_{A}} \\times \\mathbf{\\hat{j}_{A}}\\right)"\n218.     assert latex(Cross(x*A.i, A.j)) == \\\n219.         r\'- \\mathbf{\\hat{j}_{A}} \\times \\left((x)\\mathbf{\\hat{i}_{A}}\\right)\'\n220. \n221.     assert latex(Curl(3*A.x*A.j)) == \\\n222.         r"\\nabla\\times \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)"\n223.     assert latex(Curl(3*A.x*A.j+A.i)) == \\\n224.         r"\\nabla\\times \\left(\\mathbf{\\hat{i}_{A}} + (3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)"\n225.     assert latex(Curl(3*x*A.x*A.j)) == \\\n226.         r"\\nabla\\times \\left((3 \\mathbf{{x}_{A}} x)\\mathbf{\\hat{j}_{A}}\\right)"\n227.     assert latex(x*Curl(3*A.x*A.j)) == \\\n228.         r"x \\left(\\nabla\\times \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)\\right)"\n229. \n230.     assert latex(Divergence(3*A.x*A.j+A.i)) == \\\n231.         r"\\nabla\\cdot \\left(\\mathbf{\\hat{i}_{A}} + (3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)"\n232.     assert latex(Divergence(3*A.x*A.j)) == \\\n233.         r"\\nabla\\cdot \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)"\n234.     assert latex(x*Divergence(3*A.x*A.j)) == \\\n235.         r"x \\left(\\nabla\\cdot \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)\\right)"\n236. \n237.     assert latex(Dot(A.i, A.j*A.x*3+A.k)) == \\\n238.         r"\\mathbf{\\hat{i}_{A}} \\cdot \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}} + \\mathbf{\\hat{k}_{A}}\\right)"\n239.     assert latex(Dot(A.i, A.j)) == \\\n240.         r"\\mathbf{\\hat{i}_{A}} \\cdot \\mathbf{\\hat{j}_{A}}"\n241.     assert latex(Dot(x*A.i, A.j)) == \\\n242.         r"\\mathbf{\\hat{j}_{A}} \\cdot \\left((x)\\mathbf{\\hat{i}_{A}}\\right)"\n243.     assert latex(x*Dot(A.i, A.j)) == \\\n244.         r"x \\left(\\mathbf{\\hat{i}_{A}} \\cdot \\mathbf{\\hat{j}_{A}}\\right)"\n245. \n246.     assert latex(Gradient(A.x)) == r"\\nabla \\mathbf{{x}_{A}}"\n247.     assert latex(Gradient(A.x + 3*A.y)) == \\\n248.         r"\\nabla \\left(\\mathbf{{x}_{A}} + 3 \\mathbf{{y}_{A}}\\right)"\n249.     assert latex(x*Gradient(A.x)) == r"x \\left(\\nabla \\mathbf{{x}_{A}}\\right)"\n250.     assert latex(Gradient(x*A.x)) == r"\\nabla \\left(\\mathbf{{x}_{A}} x\\right)"\n251. \n252.     assert latex(Laplacian(A.x)) == r"\\triangle \\mathbf{{x}_{A}}"\n253.     assert latex(Laplacian(A.x + 3*A.y)) == \\\n254.         r"\\triangle \\left(\\mathbf{{x}_{A}} + 3 \\mathbf{{y}_{A}}\\right)"\n255.     assert latex(x*Laplacian(A.x)) == r"x \\left(\\triangle \\mathbf{{x}_{A}}\\right)"\n256.     assert latex(Laplacian(x*A.x)) == r"\\triangle \\left(\\mathbf{{x}_{A}} x\\right)"\n257. ', start_line_number=209, end_line_number=257), Context(relative_path='sympy/printing/tests/test_latex.py', content='192. def test_latex_permutation():\n193.     assert latex(Permutation(1, 2, 4)) == r"\\left( 1\\; 2\\; 4\\right)"\n194.     assert latex(Permutation(1, 2)(4, 5, 6)) == \\\n195.         r"\\left( 1\\; 2\\right)\\left( 4\\; 5\\; 6\\right)"\n196.     assert latex(Permutation()) == r"\\left( \\right)"\n197.     assert latex(Permutation(2, 4)*Permutation(5)) == \\\n198.         r"\\left( 2\\; 4\\right)\\left( 5\\right)"\n199.     assert latex(Permutation(5)) == r"\\left( 5\\right)"\n200. ', start_line_number=192, end_line_number=200), Context(relative_path='sympy/printing/tests/test_latex.py', content='170. def test_latex_SingularityFunction():\n171.     assert latex(SingularityFunction(x, 4, 5)) == \\\n172.         r"{\\left\\langle x - 4 \\right\\rangle}^{5}"\n173.     assert latex(SingularityFunction(x, -3, 4)) == \\\n174.         r"{\\left\\langle x + 3 \\right\\rangle}^{4}"\n175.     assert latex(SingularityFunction(x, 0, 4)) == \\\n176.         r"{\\left\\langle x \\right\\rangle}^{4}"\n177.     assert latex(SingularityFunction(x, a, n)) == \\\n178.         r"{\\left\\langle - a + x \\right\\rangle}^{n}"\n179.     assert latex(SingularityFunction(x, 4, -2)) == \\\n180.         r"{\\left\\langle x - 4 \\right\\rangle}^{-2}"\n181.     assert latex(SingularityFunction(x, 4, -1)) == \\\n182.         r"{\\left\\langle x - 4 \\right\\rangle}^{-1}"\n183. ', start_line_number=170, end_line_number=183), Context(relative_path='sympy/printing/tests/test_latex.py', content='357.     assert latex(factorial(k)) == r"k!"\n358.     assert latex(factorial(-k)) == r"\\left(- k\\right)!"\n359.     assert latex(factorial(k)**2) == r"k!^{2}"', start_line_number=357, end_line_number=359), Context(relative_path='sympy/printing/tests/test_latex.py', content="675. def test_latex_subs():\n676.     assert latex(Subs(x*y, (\n677.         x, y), (1, 2))) == r'\\left. x y \\right|_{\\substack{ x=1\\\\ y=2 }}'\n678. ", start_line_number=675, end_line_number=678), Context(relative_path='sympy/printing/tests/test_latex.py', content="2046. def test_Mul():\n2047.     e = Mul(-2, x + 1, evaluate=False)\n2048.     assert latex(e) == r'- 2 \\left(x + 1\\right)'\n2049.     e = Mul(2, x + 1, evaluate=False)\n2050.     assert latex(e) == r'2 \\left(x + 1\\right)'\n2051.     e = Mul(S.Half, x + 1, evaluate=False)\n2052.     assert latex(e) == r'\\frac{x + 1}{2}'\n2053.     e = Mul(y, x + 1, evaluate=False)\n2054.     assert latex(e) == r'y \\left(x + 1\\right)'\n2055.     e = Mul(-y, x + 1, evaluate=False)\n2056.     assert latex(e) == r'- y \\left(x + 1\\right)'\n2057.     e = Mul(-2, x + 1)\n2058.     assert latex(e) == r'- 2 x - 2'\n2059.     e = Mul(2, x + 1)\n2060.     assert latex(e) == r'2 x + 2'\n2061. ", start_line_number=2046, end_line_number=2061), Context(relative_path='sympy/printing/tests/test_latex.py', content='1213. def test_latex_Piecewise():\n1214.     p = Piecewise((x, x < 1), (x**2, True))\n1215.     assert latex(p) == "\\\\begin{cases} x & \\\\text{for}\\\\: x < 1 \\\\\\\\x^{2} &" \\\n1216.                        " \\\\text{otherwise} \\\\end{cases}"\n1217.     assert latex(p, itex=True) == \\\n1218.         "\\\\begin{cases} x & \\\\text{for}\\\\: x \\\\lt 1 \\\\\\\\x^{2} &" \\\n1219.         " \\\\text{otherwise} \\\\end{cases}"\n1220.     p = Piecewise((x, x < 0), (0, x >= 0))\n1221.     assert latex(p) == \'\\\\begin{cases} x & \\\\text{for}\\\\: x < 0 \\\\\\\\0 &\' \\\n1222.                        \' \\\\text{otherwise} \\\\end{cases}\'\n1223.     A, B = symbols("A B", commutative=False)\n1224.     p = Piecewise((A**2, Eq(A, B)), (A*B, True))\n1225.     s = r"\\begin{cases} A^{2} & \\text{for}\\: A = B \\\\A B & \\text{otherwise} \\end{cases}"\n1226.     assert latex(p) == s\n1227.     assert latex(A*p) == r"A \\left(%s\\right)" % s\n1228.     assert latex(p*A) == r"\\left(%s\\right) A" % s\n1229.     assert latex(Piecewise((x, x < 1), (x**2, x < 2))) == \\\n1230.         \'\\\\begin{cases} x & \' \\\n1231.         \'\\\\text{for}\\\\: x < 1 \\\\\\\\x^{2} & \\\\text{for}\\\\: x < 2 \\\\end{cases}\'\n1232. ', start_line_number=1213, end_line_number=1232), Context(relative_path='sympy/printing/tests/test_latex.py', content='2086. def test_issue_7117():\n2087.     # See also issue #5031 (hence the evaluate=False in these).\n2088.     e = Eq(x + 1, 2*x)\n2089.     q = Mul(2, e, evaluate=False)\n2090.     assert latex(q) == r"2 \\left(x + 1 = 2 x\\right)"\n2091.     q = Add(6, e, evaluate=False)\n2092.     assert latex(q) == r"6 + \\left(x + 1 = 2 x\\right)"\n2093.     q = Pow(e, 2, evaluate=False)\n2094.     assert latex(q) == r"\\left(x + 1 = 2 x\\right)^{2}"\n2095. ', start_line_number=2086, end_line_number=2095), Context(relative_path='sympy/printing/tests/test_latex.py', content="533.     assert latex(Mod(x, 7)) == r'x\\bmod{7}'\n534.     assert latex(Mod(x + 1, 7)) == r'\\left(x + 1\\right)\\bmod{7}'\n535.     assert latex(Mod(2 * x, 7)) == r'2 x\\bmod{7}'\n536.     assert latex(Mod(x, 7) + 1) == r'\\left(x\\bmod{7}\\right) + 1'\n537.     assert latex(2 * Mod(x, 7)) == r'2 \\left(x\\bmod{7}\\right)'\n538. ", start_line_number=533, end_line_number=538)]
2025-10-06 08:57:17,753 - thread-139660780025408.app.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-10-06 08:57:17,754 - thread-139660780025408.app.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sympy
├── .ci
|   ├── README.rst
|   ├── generate_durations_log.sh
|   └── parse_durations_log.py
├── .github
|   └── FUNDING.yml
├── .travis.yml
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── PULL_REQUEST_TEMPLATE.md
├── README.rst
├── bin
|   ├── ask_update.py
|   ├── authors_update.py
|   ├── coverage_doctest.py
|   ├── coverage_report.py
|   ├── generate_module_list.py
|   ├── generate_test_list.py
|   ├── get_sympy.py
|   ├── mailmap_update.py
|   ├── sympy_time.py
|   ├── sympy_time_cache.py
|   ├── test_executable.py
|   ├── test_external_imports.py
|   ├── test_import.py
|   ├── test_setup.py
|   └── test_travis.sh
├── codecov.yml
├── conftest.py
├── data
|   └── TeXmacs
|       ├── bin
|       └── progs
├── doc
|   ├── README.rst
|   ├── api
|   |   ├── conf.py
|   |   └── index.rst
|   ├── cheatsheet
|   ├── ext
|   |   ├── docscrape.py
|   |   ├── docscrape_sphinx.py
|   |   ├── numpydoc.py
|   |   └── sympylive.py
|   ├── generate_logos.py
|   ├── man
|   └── src
|       ├── _static
|       ├── _templates
|       ├── aboutus.rst
|       ├── citing.rst
|       ├── conf.py
|       ├── documentation-style-guide.rst
|       ├── gotchas.rst
|       ├── guide.rst
|       ├── index.rst
|       ├── install.rst
|       ├── logo
|       |   └── info.txt
|       ├── modules
|       |   ├── abc.rst
|       |   ├── algebras.rst
|       |   ├── assumptions
|       |   |   ├── ask.rst
|       |   |   ├── assume.rst
|       |   |   ├── handlers
|       |   |   ├── index.rst
|       |   |   └── refine.rst
|       |   ├── calculus
|       |   |   └── index.rst
|       |   ├── categories.rst
|       |   ├── codegen.rst
|       |   ├── combinatorics
|       |   |   ├── fp_groups.rst
|       |   |   ├── graycode.rst
|       |   |   ├── group_constructs.rst
|       |   |   ├── index.rst
|       |   |   ├── named_groups.rst
|       |   |   ├── partitions.rst
|       |   |   ├── pc_groups.rst
|       |   |   ├── perm_groups.rst
|       |   |   ├── permutations.rst
|       |   |   ├── polyhedron.rst
|       |   |   ├── prufer.rst
|       |   |   ├── subsets.rst
|       |   |   ├── tensor_can.rst
|       |   |   ├── testutil.rst
|       |   |   └── util.rst
|       |   ├── concrete.rst
|       |   ├── core.rst
|       |   ├── crypto.rst
|       |   ├── diffgeom.rst
|       |   ├── discrete.rst
|       |   ├── evalf.rst
|       |   ├── functions
|       |   |   ├── combinatorial.rst
|       |   |   ├── elementary.rst
|       |   |   ├── index.rst
|       |   |   └── special.rst
|       |   ├── geometry
|       |   |   ├── curves.rst
|       |   |   ├── ellipses.rst
|       |   |   ├── entities.rst
|       |   |   ├── index.rst
|       |   |   ├── lines.rst
|       |   |   ├── plane.rst
|       |   |   ├── points.rst
|       |   |   ├── polygons.rst
|       |   |   └── utils.rst
|       |   ├── holonomic
|       |   |   ├── about.rst
|       |   |   ├── convert.rst
|       |   |   ├── index.rst
|       |   |   ├── internal.rst
|       |   |   ├── operations.rst
|       |   |   ├── represent.rst
|       |   |   └── uses.rst
|       |   ├── index.rst
|       |   ├── integrals
|       |   |   ├── g-functions.rst
|       |   |   └── integrals.rst
|       |   ├── interactive.rst
|       |   ├── liealgebras
|       |   |   └── index.rst
|       |   ├── logic.rst
|       |   ├── matrices
|       |   |   ├── common.rst
|       |   |   ├── dense.rst
|       |   |   ├── expressions.rst
|       |   |   ├── immutablematrices.rst
|       |   |   ├── index.rst
|       |   |   ├── matrices.rst
|       |   |   └── sparse.rst
|       |   ├── ntheory.rst
|       |   ├── numeric-computation.rst
|       |   ├── parsing.rst
|       |   ├── physics
|       |   |   ├── continuum_mechanics
|       |   |   ├── hep
|       |   |   ├── hydrogen.rst
|       |   |   ├── index.rst
|       |   |   ├── matrices.rst
|       |   |   ├── mechanics
|       |   |   ├── optics
|       |   |   ├── paulialgebra.rst
|       |   |   ├── qho_1d.rst
|       |   |   ├── quantum
|       |   |   ├── secondquant.rst
|       |   |   ├── sho.rst
|       |   |   ├── units
|       |   |   ├── vector
|       |   |   └── wigner.rst
|       |   ├── plotting.rst
|       |   ├── polys
|       |   |   ├── agca.rst
|       |   |   ├── basics.rst
|       |   |   ├── index.rst
|       |   |   ├── internals.rst
|       |   |   ├── literature.rst
|       |   |   ├── reference.rst
|       |   |   ├── ringseries.rst
|       |   |   └── wester.rst
|       |   ├── printing.rst
|       |   ├── rewriting.rst
|       |   ├── series
|       |   |   ├── formal.rst
|       |   |   ├── fourier.rst
|       |   |   ├── index.rst
|       |   |   ├── limitseq.rst
|       |   |   ├── sequences.rst
|       |   |   └── series.rst
|       |   ├── sets.rst
|       |   ├── simplify
|       |   |   ├── hyperexpand.rst
|       |   |   └── simplify.rst
|       |   ├── solvers
|       |   |   ├── diophantine.rst
|       |   |   ├── inequalities.rst
|       |   |   ├── ode.rst
|       |   |   ├── pde.rst
|       |   |   ├── solvers.rst
|       |   |   └── solveset.rst
|       |   ├── stats.rst
|       |   ├── tensor
|       |   |   ├── array.rst
|       |   |   ├── index.rst
|       |   |   ├── index_methods.rst
|       |   |   ├── indexed.rst
|       |   |   └── tensor.rst
|       |   ├── utilities
|       |   |   ├── autowrap.rst
|       |   |   ├── codegen.rst
|       |   |   ├── decorator.rst
|       |   |   ├── enumerative.rst
|       |   |   ├── index.rst
|       |   |   ├── iterables.rst
|       |   |   ├── lambdify.rst
|       |   |   ├── memoization.rst
|       |   |   ├── misc.rst
|       |   |   ├── pkgdata.rst
|       |   |   ├── pytest.rst
|       |   |   ├── randtest.rst
|       |   |   ├── runtests.rst
|       |   |   ├── source.rst
|       |   |   └── timeutils.rst
|       |   └── vector
|       |       ├── api
|       |       ├── basics.rst
|       |       ├── coordsys.rst
|       |       ├── examples.rst
|       |       ├── fields.rst
|       |       ├── index.rst
|       |       └── intro.rst
|       ├── outreach.rst
|       ├── pics
|       ├── special_topics
|       |   ├── finite_diff_derivatives.rst
|       |   ├── index.rst
|       |   └── intro.rst
|       ├── tutorial
|       |   ├── basic_operations.rst
|       |   ├── calculus.rst
|       |   ├── gotchas.rst
|       |   ├── index.rst
|       |   ├── intro.rst
|       |   ├── manipulation.rst
|       |   ├── matrices.rst
|       |   ├── preliminaries.rst
|       |   ├── printing.rst
|       |   ├── simplification.rst
|       |   └── solvers.rst
|       └── wiki.rst
├── examples
|   ├── advanced
|   |   ├── autowrap_integrators.py
|   |   ├── autowrap_ufuncify.py
|   |   ├── curvilinear_coordinates.py
|   |   ├── dense_coding_example.py
|   |   ├── fem.py
|   |   ├── gibbs_phenomenon.py
|   |   ├── grover_example.py
|   |   ├── hydrogen.py
|   |   ├── pidigits.py
|   |   ├── pyglet_plotting.py
|   |   ├── qft.py
|   |   └── relativity.py
|   ├── all.py
|   ├── beginner
|   |   ├── basic.py
|   |   ├── differentiation.py
|   |   ├── expansion.py
|   |   ├── functions.py
|   |   ├── limits_examples.py
|   |   ├── plot_examples.py
|   |   ├── plotting_nice_plot.py
|   |   ├── precision.py
|   |   ├── print_pretty.py
|   |   ├── series.py
|   |   └── substitution.py
|   ├── intermediate
|   |   ├── coupled_cluster.py
|   |   ├── differential_equations.py
|   |   ├── infinite_1d_box.py
|   |   ├── mplot2d.py
|   |   ├── mplot3d.py
|   |   ├── partial_differential_eqs.py
|   |   ├── print_gtk.py
|   |   ├── sample.py
|   |   ├── trees.py
|   |   └── vandermonde.py
|   └── notebooks
|       └── README.txt
├── isympy.py
├── release
|   ├── README.md
|   ├── fabfile.py
|   ├── pull_and_run_rever.sh
|   └── release.sh
├── setup.py
├── setupegg.py
└── sympy
    ├── __init__.py
    ├── abc.py
    ├── algebras
    |   ├── __init__.py
    |   ├── quaternion.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_quaternion.py
    ├── assumptions
    |   ├── __init__.py
    |   ├── ask.py
    |   ├── ask_generated.py
    |   ├── assume.py
    |   ├── cnf.py
    |   ├── handlers
    |   |   ├── __init__.py
    |   |   ├── calculus.py
    |   |   ├── common.py
    |   |   ├── matrices.py
    |   |   ├── ntheory.py
    |   |   ├── order.py
    |   |   └── sets.py
    |   ├── refine.py
    |   ├── satask.py
    |   ├── sathandlers.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_assumptions_2.py
    |       ├── test_context.py
    |       ├── test_matrices.py
    |       ├── test_query.py
    |       ├── test_refine.py
    |       ├── test_satask.py
    |       └── test_sathandlers.py
    ├── benchmarks
    |   ├── __init__.py
    |   ├── bench_discrete_log.py
    |   ├── bench_meijerint.py
    |   └── bench_symbench.py
    ├── calculus
    |   ├── __init__.py
    |   ├── euler.py
    |   ├── finite_diff.py
    |   ├── singularities.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_euler.py
    |   |   ├── test_finite_diff.py
    |   |   ├── test_singularities.py
    |   |   └── test_util.py
    |   └── util.py
    ├── categories
    |   ├── __init__.py
    |   ├── baseclasses.py
    |   ├── diagram_drawing.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_baseclasses.py
    |       └── test_drawing.py
    ├── codegen
    |   ├── __init__.py
    |   ├── algorithms.py
    |   ├── approximations.py
    |   ├── array_utils.py
    |   ├── ast.py
    |   ├── cfunctions.py
    |   ├── cnodes.py
    |   ├── cutils.py
    |   ├── cxxnodes.py
    |   ├── fnodes.py
    |   ├── futils.py
    |   ├── matrix_nodes.py
    |   ├── pyutils.py
    |   ├── rewriting.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_algorithms.py
    |       ├── test_applications.py
    |       ├── test_approximations.py
    |       ├── test_array_utils.py
    |       ├── test_ast.py
    |       ├── test_cfunctions.py
    |       ├── test_cnodes.py
    |       ├── test_cxxnodes.py
    |       ├── test_fnodes.py
    |       ├── test_pyutils.py
    |       └── test_rewriting.py
    ├── combinatorics
    |   ├── __init__.py
    |   ├── coset_table.py
    |   ├── fp_groups.py
    |   ├── free_groups.py
    |   ├── generators.py
    |   ├── graycode.py
    |   ├── group_constructs.py
    |   ├── homomorphisms.py
    |   ├── named_groups.py
    |   ├── partitions.py
    |   ├── pc_groups.py
    |   ├── perm_groups.py
    |   ├── permutations.py
    |   ├── polyhedron.py
    |   ├── prufer.py
    |   ├── rewritingsystem.py
    |   ├── rewritingsystem_fsm.py
    |   ├── subsets.py
    |   ├── tensor_can.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_coset_table.py
    |   |   ├── test_fp_groups.py
    |   |   ├── test_free_groups.py
    |   |   ├── test_generators.py
    |   |   ├── test_graycode.py
    |   |   ├── test_group_constructs.py
    |   |   ├── test_homomorphisms.py
    |   |   ├── test_named_groups.py
    |   |   ├── test_partitions.py
    |   |   ├── test_pc_groups.py
    |   |   ├── test_perm_groups.py
    |   |   ├── test_permutations.py
    |   |   ├── test_polyhedron.py
    |   |   ├── test_prufer.py
    |   |   ├── test_rewriting.py
    |   |   ├── test_subsets.py
    |   |   ├── test_tensor_can.py
    |   |   ├── test_testutil.py
    |   |   └── test_util.py
    |   ├── testutil.py
    |   └── util.py
    ├── concrete
    |   ├── __init__.py
    |   ├── delta.py
    |   ├── expr_with_intlimits.py
    |   ├── expr_with_limits.py
    |   ├── gosper.py
    |   ├── guess.py
    |   ├── products.py
    |   ├── summations.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_delta.py
    |       ├── test_gosper.py
    |       ├── test_guess.py
    |       ├── test_products.py
    |       └── test_sums_products.py
    ├── conftest.py
    ├── core
    |   ├── __init__.py
    |   ├── add.py
    |   ├── alphabets.py
    |   ├── assumptions.py
    |   ├── backend.py
    |   ├── basic.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_arit.py
    |   |   ├── bench_assumptions.py
    |   |   ├── bench_basic.py
    |   |   ├── bench_expand.py
    |   |   ├── bench_numbers.py
    |   |   └── bench_sympify.py
    |   ├── cache.py
    |   ├── compatibility.py
    |   ├── containers.py
    |   ├── core.py
    |   ├── coreerrors.py
    |   ├── decorators.py
    |   ├── evalf.py
    |   ├── evaluate.py
    |   ├── expr.py
    |   ├── exprtools.py
    |   ├── facts.py
    |   ├── function.py
    |   ├── logic.py
    |   ├── mod.py
    |   ├── mul.py
    |   ├── multidimensional.py
    |   ├── numbers.py
    |   ├── operations.py
    |   ├── power.py
    |   ├── relational.py
    |   ├── rules.py
    |   ├── singleton.py
    |   ├── symbol.py
    |   ├── sympify.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_args.py
    |   |   ├── test_arit.py
    |   |   ├── test_assumptions.py
    |   |   ├── test_basic.py
    |   |   ├── test_cache.py
    |   |   ├── test_compatibility.py
    |   |   ├── test_complex.py
    |   |   ├── test_constructor_postprocessor.py
    |   |   ├── test_containers.py
    |   |   ├── test_count_ops.py
    |   |   ├── test_diff.py
    |   |   ├── test_equal.py
    |   |   ├── test_eval.py
    |   |   ├── test_evalf.py
    |   |   ├── test_evaluate.py
    |   |   ├── test_expand.py
    |   |   ├── test_expr.py
    |   |   ├── test_exprtools.py
    |   |   ├── test_facts.py
    |   |   ├── test_function.py
    |   |   ├── test_logic.py
    |   |   ├── test_match.py
    |   |   ├── test_multidimensional.py
    |   |   ├── test_noncommutative.py
    |   |   ├── test_numbers.py
    |   |   ├── test_operations.py
    |   |   ├── test_power.py
    |   |   ├── test_priority.py
    |   |   ├── test_relational.py
    |   |   ├── test_rules.py
    |   |   ├── test_singleton.py
    |   |   ├── test_subs.py
    |   |   ├── test_symbol.py
    |   |   ├── test_sympify.py
    |   |   ├── test_trace.py
    |   |   ├── test_truediv.py
    |   |   └── test_var.py
    |   └── trace.py
    ├── crypto
    |   ├── __init__.py
    |   ├── crypto.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_crypto.py
    ├── deprecated
    |   ├── __init__.py
    |   ├── class_registry.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_class_registry.py
    ├── diffgeom
    |   ├── __init__.py
    |   ├── diffgeom.py
    |   ├── rn.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_class_structure.py
    |       ├── test_diffgeom.py
    |       ├── test_function_diffgeom_book.py
    |       └── test_hyperbolic_space.py
    ├── discrete
    |   ├── __init__.py
    |   ├── convolutions.py
    |   ├── recurrences.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_convolutions.py
    |   |   ├── test_recurrences.py
    |   |   └── test_transforms.py
    |   └── transforms.py
    ├── external
    |   ├── __init__.py
    |   ├── importtools.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_autowrap.py
    |       ├── test_codegen.py
    |       ├── test_importtools.py
    |       ├── test_numpy.py
    |       ├── test_sage.py
    |       └── test_scipy.py
    ├── functions
    |   ├── __init__.py
    |   ├── combinatorial
    |   |   ├── __init__.py
    |   |   ├── factorials.py
    |   |   ├── numbers.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_comb_factorials.py
    |   |       └── test_comb_numbers.py
    |   ├── elementary
    |   |   ├── __init__.py
    |   |   ├── benchmarks
    |   |   |   ├── __init__.py
    |   |   |   └── bench_exp.py
    |   |   ├── complexes.py
    |   |   ├── exponential.py
    |   |   ├── hyperbolic.py
    |   |   ├── integers.py
    |   |   ├── miscellaneous.py
    |   |   ├── piecewise.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_complexes.py
    |   |   |   ├── test_exponential.py
    |   |   |   ├── test_hyperbolic.py
    |   |   |   ├── test_integers.py
    |   |   |   ├── test_interface.py
    |   |   |   ├── test_miscellaneous.py
    |   |   |   ├── test_piecewise.py
    |   |   |   └── test_trigonometric.py
    |   |   └── trigonometric.py
    |   └── special
    |       ├── __init__.py
    |       ├── benchmarks
    |       |   ├── __init__.py
    |       |   └── bench_special.py
    |       ├── bessel.py
    |       ├── beta_functions.py
    |       ├── bsplines.py
    |       ├── delta_functions.py
    |       ├── elliptic_integrals.py
    |       ├── error_functions.py
    |       ├── gamma_functions.py
    |       ├── hyper.py
    |       ├── mathieu_functions.py
    |       ├── polynomials.py
    |       ├── singularity_functions.py
    |       ├── spherical_harmonics.py
    |       ├── tensor_functions.py
    |       ├── tests
    |       |   ├── __init__.py
    |       |   ├── test_bessel.py
    |       |   ├── test_beta_functions.py
    |       |   ├── test_bsplines.py
    |       |   ├── test_delta_functions.py
    |       |   ├── test_elliptic_integrals.py
    |       |   ├── test_error_functions.py
    |       |   ├── test_gamma_functions.py
    |       |   ├── test_hyper.py
    |       |   ├── test_mathieu.py
    |       |   ├── test_singularity_functions.py
    |       |   ├── test_spec_polynomials.py
    |       |   ├── test_spherical_harmonics.py
    |       |   ├── test_tensor_functions.py
    |       |   └── test_zeta_functions.py
    |       └── zeta_functions.py
    ├── galgebra.py
    ├── geometry
    |   ├── __init__.py
    |   ├── curve.py
    |   ├── ellipse.py
    |   ├── entity.py
    |   ├── exceptions.py
    |   ├── line.py
    |   ├── parabola.py
    |   ├── plane.py
    |   ├── point.py
    |   ├── polygon.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_curve.py
    |   |   ├── test_ellipse.py
    |   |   ├── test_entity.py
    |   |   ├── test_geometrysets.py
    |   |   ├── test_line.py
    |   |   ├── test_parabola.py
    |   |   ├── test_plane.py
    |   |   ├── test_point.py
    |   |   ├── test_polygon.py
    |   |   └── test_util.py
    |   └── util.py
    ├── holonomic
    |   ├── __init__.py
    |   ├── holonomic.py
    |   ├── holonomicerrors.py
    |   ├── linearsolver.py
    |   ├── numerical.py
    |   ├── recurrence.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_holonomic.py
    |       └── test_recurrence.py
    ├── integrals
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_integrate.py
    |   |   └── bench_trigintegrate.py
    |   ├── deltafunctions.py
    |   ├── heurisch.py
    |   ├── integrals.py
    |   ├── intpoly.py
    |   ├── manualintegrate.py
    |   ├── meijerint.py
    |   ├── meijerint_doc.py
    |   ├── prde.py
    |   ├── quadrature.py
    |   ├── rationaltools.py
    |   ├── rde.py
    |   ├── risch.py
    |   ├── rubi
    |   |   ├── __init__.py
    |   |   ├── constraints.py
    |   |   ├── parsetools
    |   |   |   ├── __init__.py
    |   |   |   ├── generate_rules.py
    |   |   |   ├── generate_tests.py
    |   |   |   ├── header.py.txt
    |   |   |   ├── parse.py
    |   |   |   └── tests
    |   |   ├── rubi_tests
    |   |   |   ├── __init__.py
    |   |   |   └── tests
    |   |   ├── rubimain.py
    |   |   ├── rules
    |   |   |   ├── __init__.py
    |   |   |   ├── binomial_products.py
    |   |   |   ├── exponential.py
    |   |   |   ├── hyperbolic.py
    |   |   |   ├── integrand_simplification.py
    |   |   |   ├── inverse_hyperbolic.py
    |   |   |   ├── inverse_trig.py
    |   |   |   ├── linear_products.py
    |   |   |   ├── logarithms.py
    |   |   |   ├── miscellaneous_algebraic.py
    |   |   |   ├── miscellaneous_integration.py
    |   |   |   ├── miscellaneous_trig.py
    |   |   |   ├── piecewise_linear.py
    |   |   |   ├── quadratic_products.py
    |   |   |   ├── secant.py
    |   |   |   ├── sine.py
    |   |   |   ├── special_functions.py
    |   |   |   ├── tangent.py
    |   |   |   └── trinomial_products.py
    |   |   ├── symbol.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_rubi_integrate.py
    |   |   |   └── test_utility_function.py
    |   |   └── utility_function.py
    |   ├── singularityfunctions.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_deltafunctions.py
    |   |   ├── test_failing_integrals.py
    |   |   ├── test_heurisch.py
    |   |   ├── test_integrals.py
    |   |   ├── test_intpoly.py
    |   |   ├── test_lineintegrals.py
    |   |   ├── test_manual.py
    |   |   ├── test_meijerint.py
    |   |   ├── test_prde.py
    |   |   ├── test_quadrature.py
    |   |   ├── test_rationaltools.py
    |   |   ├── test_rde.py
    |   |   ├── test_risch.py
    |   |   ├── test_singularityfunctions.py
    |   |   ├── test_transforms.py
    |   |   └── test_trigonometry.py
    |   ├── transforms.py
    |   └── trigonometry.py
    ├── interactive
    |   ├── __init__.py
    |   ├── ipythonprinting.py
    |   ├── printing.py
    |   ├── session.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_interactive.py
    |       ├── test_ipython.py
    |       └── test_ipythonprinting.py
    ├── liealgebras
    |   ├── __init__.py
    |   ├── cartan_matrix.py
    |   ├── cartan_type.py
    |   ├── dynkin_diagram.py
    |   ├── root_system.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_cartan_matrix.py
    |   |   ├── test_cartan_type.py
    |   |   ├── test_dynkin_diagram.py
    |   |   ├── test_root_system.py
    |   |   ├── test_type_A.py
    |   |   ├── test_type_B.py
    |   |   ├── test_type_C.py
    |   |   ├── test_type_D.py
    |   |   ├── test_type_E.py
    |   |   ├── test_type_F.py
    |   |   ├── test_type_G.py
    |   |   └── test_weyl_group.py
    |   ├── type_a.py
    |   ├── type_b.py
    |   ├── type_c.py
    |   ├── type_d.py
    |   ├── type_e.py
    |   ├── type_f.py
    |   ├── type_g.py
    |   └── weyl_group.py
    ├── logic
    |   ├── __init__.py
    |   ├── algorithms
    |   |   ├── __init__.py
    |   |   ├── dpll.py
    |   |   ├── dpll2.py
    |   |   └── pycosat_wrapper.py
    |   ├── boolalg.py
    |   ├── inference.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_boolalg.py
    |   |   ├── test_dimacs.py
    |   |   └── test_inference.py
    |   └── utilities
    |       ├── __init__.py
    |       └── dimacs.py
    ├── matrices
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_matrix.py
    |   ├── common.py
    |   ├── dense.py
    |   ├── densearith.py
    |   ├── densesolve.py
    |   ├── densetools.py
    |   ├── expressions
    |   |   ├── __init__.py
    |   |   ├── adjoint.py
    |   |   ├── applyfunc.py
    |   |   ├── blockmatrix.py
    |   |   ├── determinant.py
    |   |   ├── diagonal.py
    |   |   ├── dotproduct.py
    |   |   ├── factorizations.py
    |   |   ├── fourier.py
    |   |   ├── funcmatrix.py
    |   |   ├── hadamard.py
    |   |   ├── inverse.py
    |   |   ├── kronecker.py
    |   |   ├── matadd.py
    |   |   ├── matexpr.py
    |   |   ├── matmul.py
    |   |   ├── matpow.py
    |   |   ├── slice.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_adjoint.py
    |   |   |   ├── test_applyfunc.py
    |   |   |   ├── test_blockmatrix.py
    |   |   |   ├── test_derivatives.py
    |   |   |   ├── test_determinant.py
    |   |   |   ├── test_diagonal.py
    |   |   |   ├── test_dotproduct.py
    |   |   |   ├── test_factorizations.py
    |   |   |   ├── test_fourier.py
    |   |   |   ├── test_funcmatrix.py
    |   |   |   ├── test_hadamard.py
    |   |   |   ├── test_indexing.py
    |   |   |   ├── test_inverse.py
    |   |   |   ├── test_kronecker.py
    |   |   |   ├── test_matadd.py
    |   |   |   ├── test_matexpr.py
    |   |   |   ├── test_matmul.py
    |   |   |   ├── test_matpow.py
    |   |   |   ├── test_slice.py
    |   |   |   ├── test_trace.py
    |   |   |   └── test_transpose.py
    |   |   ├── trace.py
    |   |   └── transpose.py
    |   ├── immutable.py
    |   ├── matrices.py
    |   ├── normalforms.py
    |   ├── sparse.py
    |   ├── sparsetools.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_commonmatrix.py
    |       ├── test_densearith.py
    |       ├── test_densesolve.py
    |       ├── test_densetools.py
    |       ├── test_immutable.py
    |       ├── test_interactions.py
    |       ├── test_matrices.py
    |       ├── test_normalforms.py
    |       ├── test_sparse.py
    |       └── test_sparsetools.py
    ├── multipledispatch
    |   ├── __init__.py
    |   ├── conflict.py
    |   ├── core.py
    |   ├── dispatcher.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_conflict.py
    |   |   ├── test_core.py
    |   |   └── test_dispatcher.py
    |   └── utils.py
    ├── ntheory
    |   ├── __init__.py
    |   ├── bbp_pi.py
    |   ├── continued_fraction.py
    |   ├── egyptian_fraction.py
    |   ├── factor_.py
    |   ├── generate.py
    |   ├── modular.py
    |   ├── multinomial.py
    |   ├── partitions_.py
    |   ├── primetest.py
    |   ├── residue_ntheory.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_bbp_pi.py
    |       ├── test_continued_fraction.py
    |       ├── test_egyptian_fraction.py
    |       ├── test_factor_.py
    |       ├── test_generate.py
    |       ├── test_modular.py
    |       ├── test_multinomial.py
    |       ├── test_partitions.py
    |       ├── test_primetest.py
    |       └── test_residue.py
    ├── parsing
    |   ├── __init__.py
    |   ├── ast_parser.py
    |   ├── autolev
    |   |   ├── __init__.py
    |   |   ├── _antlr
    |   |   |   ├── __init__.py
    |   |   |   ├── autolevlexer.py
    |   |   |   ├── autolevlistener.py
    |   |   |   └── autolevparser.py
    |   |   ├── _listener_autolev_antlr.py
    |   |   ├── _parse_autolev_antlr.py
    |   |   └── test-examples
    |   |       ├── __init__.py
    |   |       ├── pydy-example-repo
    |   |       ├── ruletest1.py
    |   |       ├── ruletest10.py
    |   |       ├── ruletest11.py
    |   |       ├── ruletest12.py
    |   |       ├── ruletest2.py
    |   |       ├── ruletest3.py
    |   |       ├── ruletest4.py
    |   |       ├── ruletest5.py
    |   |       ├── ruletest6.py
    |   |       ├── ruletest7.py
    |   |       ├── ruletest8.py
    |   |       └── ruletest9.py
    |   ├── c
    |   |   ├── __init__.py
    |   |   └── c_parser.py
    |   ├── fortran
    |   |   ├── __init__.py
    |   |   └── fortran_parser.py
    |   ├── latex
    |   |   ├── LICENSE.txt
    |   |   ├── __init__.py
    |   |   ├── _antlr
    |   |   |   ├── __init__.py
    |   |   |   ├── latexlexer.py
    |   |   |   └── latexparser.py
    |   |   ├── _build_latex_antlr.py
    |   |   ├── _parse_latex_antlr.py
    |   |   └── errors.py
    |   ├── mathematica.py
    |   ├── maxima.py
    |   ├── sym_expr.py
    |   ├── sympy_parser.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_autolev.py
    |       ├── test_c_parser.py
    |       ├── test_fortran_parser.py
    |       ├── test_implicit_multiplication_application.py
    |       ├── test_latex.py
    |       ├── test_latex_deps.py
    |       ├── test_mathematica.py
    |       ├── test_maxima.py
    |       ├── test_sym_expr.py
    |       └── test_sympy_parser.py
    ├── physics
    |   ├── __init__.py
    |   ├── continuum_mechanics
    |   |   ├── __init__.py
    |   |   ├── beam.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_beam.py
    |   ├── gaussopt.py
    |   ├── hep
    |   |   ├── __init__.py
    |   |   ├── gamma_matrices.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_gamma_matrices.py
    |   ├── hydrogen.py
    |   ├── matrices.py
    |   ├── mechanics
    |   |   ├── __init__.py
    |   |   ├── body.py
    |   |   ├── functions.py
    |   |   ├── kane.py
    |   |   ├── lagrange.py
    |   |   ├── linearize.py
    |   |   ├── models.py
    |   |   ├── particle.py
    |   |   ├── rigidbody.py
    |   |   ├── system.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_body.py
    |   |       ├── test_functions.py
    |   |       ├── test_kane.py
    |   |       ├── test_kane2.py
    |   |       ├── test_kane3.py
    |   |       ├── test_kane4.py
    |   |       ├── test_lagrange.py
    |   |       ├── test_lagrange2.py
    |   |       ├── test_linearize.py
    |   |       ├── test_models.py
    |   |       ├── test_particle.py
    |   |       ├── test_rigidbody.py
    |   |       └── test_system.py
    |   ├── optics
    |   |   ├── __init__.py
    |   |   ├── gaussopt.py
    |   |   ├── medium.py
    |   |   ├── polarization.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_gaussopt.py
    |   |   |   ├── test_medium.py
    |   |   |   ├── test_polarization.py
    |   |   |   ├── test_utils.py
    |   |   |   └── test_waves.py
    |   |   ├── utils.py
    |   |   └── waves.py
    |   ├── paulialgebra.py
    |   ├── pring.py
    |   ├── qho_1d.py
    |   ├── quantum
    |   |   ├── __init__.py
    |   |   ├── anticommutator.py
    |   |   ├── boson.py
    |   |   ├── cartesian.py
    |   |   ├── cg.py
    |   |   ├── circuitplot.py
    |   |   ├── circuitutils.py
    |   |   ├── commutator.py
    |   |   ├── constants.py
    |   |   ├── dagger.py
    |   |   ├── density.py
    |   |   ├── fermion.py
    |   |   ├── gate.py
    |   |   ├── grover.py
    |   |   ├── hilbert.py
    |   |   ├── identitysearch.py
    |   |   ├── innerproduct.py
    |   |   ├── matrixcache.py
    |   |   ├── matrixutils.py
    |   |   ├── operator.py
    |   |   ├── operatorordering.py
    |   |   ├── operatorset.py
    |   |   ├── pauli.py
    |   |   ├── piab.py
    |   |   ├── qapply.py
    |   |   ├── qasm.py
    |   |   ├── qexpr.py
    |   |   ├── qft.py
    |   |   ├── qubit.py
    |   |   ├── represent.py
    |   |   ├── sho1d.py
    |   |   ├── shor.py
    |   |   ├── spin.py
    |   |   ├── state.py
    |   |   ├── tensorproduct.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_anticommutator.py
    |   |       ├── test_boson.py
    |   |       ├── test_cartesian.py
    |   |       ├── test_cg.py
    |   |       ├── test_circuitplot.py
    |   |       ├── test_circuitutils.py
    |   |       ├── test_commutator.py
    |   |       ├── test_constants.py
    |   |       ├── test_dagger.py
    |   |       ├── test_density.py
    |   |       ├── test_fermion.py
    |   |       ├── test_gate.py
    |   |       ├── test_grover.py
    |   |       ├── test_hilbert.py
    |   |       ├── test_identitysearch.py
    |   |       ├── test_innerproduct.py
    |   |       ├── test_matrixutils.py
    |   |       ├── test_operator.py
    |   |       ├── test_operatorordering.py
    |   |       ├── test_operatorset.py
    |   |       ├── test_pauli.py
    |   |       ├── test_piab.py
    |   |       ├── test_printing.py
    |   |       ├── test_qapply.py
    |   |       ├── test_qasm.py
    |   |       ├── test_qexpr.py
    |   |       ├── test_qft.py
    |   |       ├── test_qubit.py
    |   |       ├── test_represent.py
    |   |       ├── test_sho1d.py
    |   |       ├── test_shor.py
    |   |       ├── test_spin.py
    |   |       ├── test_state.py
    |   |       └── test_tensorproduct.py
    |   ├── secondquant.py
    |   ├── sho.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_clebsch_gordan.py
    |   |   ├── test_hydrogen.py
    |   |   ├── test_paulialgebra.py
    |   |   ├── test_physics_matrices.py
    |   |   ├── test_pring.py
    |   |   ├── test_qho_1d.py
    |   |   ├── test_secondquant.py
    |   |   └── test_sho.py
    |   ├── units
    |   |   ├── __init__.py
    |   |   ├── definitions
    |   |   |   ├── __init__.py
    |   |   |   ├── dimension_definitions.py
    |   |   |   └── unit_definitions.py
    |   |   ├── dimensions.py
    |   |   ├── prefixes.py
    |   |   ├── quantities.py
    |   |   ├── systems
    |   |   |   ├── __init__.py
    |   |   |   ├── cgs.py
    |   |   |   ├── length_weight_time.py
    |   |   |   ├── mks.py
    |   |   |   ├── mksa.py
    |   |   |   ├── natural.py
    |   |   |   └── si.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dimensions.py
    |   |   |   ├── test_dimensionsystem.py
    |   |   |   ├── test_prefixes.py
    |   |   |   ├── test_quantities.py
    |   |   |   ├── test_unit_system_cgs_gauss.py
    |   |   |   ├── test_unitsystem.py
    |   |   |   └── test_util.py
    |   |   ├── unitsystem.py
    |   |   └── util.py
    |   ├── vector
    |   |   ├── __init__.py
    |   |   ├── dyadic.py
    |   |   ├── fieldfunctions.py
    |   |   ├── frame.py
    |   |   ├── functions.py
    |   |   ├── point.py
    |   |   ├── printing.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dyadic.py
    |   |   |   ├── test_fieldfunctions.py
    |   |   |   ├── test_frame.py
    |   |   |   ├── test_functions.py
    |   |   |   ├── test_output.py
    |   |   |   ├── test_point.py
    |   |   |   ├── test_printing.py
    |   |   |   └── test_vector.py
    |   |   └── vector.py
    |   └── wigner.py
    ├── plotting
    |   ├── __init__.py
    |   ├── experimental_lambdify.py
    |   ├── intervalmath
    |   |   ├── __init__.py
    |   |   ├── interval_arithmetic.py
    |   |   ├── interval_membership.py
    |   |   ├── lib_interval.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_interval_functions.py
    |   |       ├── test_interval_membership.py
    |   |       └── test_intervalmath.py
    |   ├── plot.py
    |   ├── plot_implicit.py
    |   ├── pygletplot
    |   |   ├── __init__.py
    |   |   ├── color_scheme.py
    |   |   ├── managed_window.py
    |   |   ├── plot.py
    |   |   ├── plot_axes.py
    |   |   ├── plot_camera.py
    |   |   ├── plot_controller.py
    |   |   ├── plot_curve.py
    |   |   ├── plot_interval.py
    |   |   ├── plot_mode.py
    |   |   ├── plot_mode_base.py
    |   |   ├── plot_modes.py
    |   |   ├── plot_object.py
    |   |   ├── plot_rotation.py
    |   |   ├── plot_surface.py
    |   |   ├── plot_window.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── test_plotting.py
    |   |   └── util.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_experimental_lambdify.py
    |   |   ├── test_plot.py
    |   |   ├── test_plot_implicit.py
    |   |   └── test_textplot.py
    |   └── textplot.py
    ├── polys
    |   ├── __init__.py
    |   ├── agca
    |   |   ├── __init__.py
    |   |   ├── extensions.py
    |   |   ├── homomorphisms.py
    |   |   ├── ideals.py
    |   |   ├── modules.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_extensions.py
    |   |       ├── test_homomorphisms.py
    |   |       ├── test_ideals.py
    |   |       └── test_modules.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_galoispolys.py
    |   |   ├── bench_groebnertools.py
    |   |   └── bench_solvers.py
    |   ├── compatibility.py
    |   ├── constructor.py
    |   ├── densearith.py
    |   ├── densebasic.py
    |   ├── densetools.py
    |   ├── dispersion.py
    |   ├── distributedmodules.py
    |   ├── domains
    |   |   ├── __init__.py
    |   |   ├── algebraicfield.py
    |   |   ├── characteristiczero.py
    |   |   ├── complexfield.py
    |   |   ├── compositedomain.py
    |   |   ├── domain.py
    |   |   ├── domainelement.py
    |   |   ├── expressiondomain.py
    |   |   ├── field.py
    |   |   ├── finitefield.py
    |   |   ├── fractionfield.py
    |   |   ├── gmpyfinitefield.py
    |   |   ├── gmpyintegerring.py
    |   |   ├── gmpyrationalfield.py
    |   |   ├── groundtypes.py
    |   |   ├── integerring.py
    |   |   ├── modularinteger.py
    |   |   ├── mpelements.py
    |   |   ├── old_fractionfield.py
    |   |   ├── old_polynomialring.py
    |   |   ├── polynomialring.py
    |   |   ├── pythonfinitefield.py
    |   |   ├── pythonintegerring.py
    |   |   ├── pythonrational.py
    |   |   ├── pythonrationalfield.py
    |   |   ├── quotientring.py
    |   |   ├── rationalfield.py
    |   |   ├── realfield.py
    |   |   ├── ring.py
    |   |   ├── simpledomain.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_domains.py
    |   |       ├── test_polynomialring.py
    |   |       └── test_quotientring.py
    |   ├── euclidtools.py
    |   ├── factortools.py
    |   ├── fglmtools.py
    |   ├── fields.py
    |   ├── galoistools.py
    |   ├── groebnertools.py
    |   ├── heuristicgcd.py
    |   ├── modulargcd.py
    |   ├── monomials.py
    |   ├── multivariate_resultants.py
    |   ├── numberfields.py
    |   ├── orderings.py
    |   ├── orthopolys.py
    |   ├── partfrac.py
    |   ├── polyclasses.py
    |   ├── polyconfig.py
    |   ├── polyerrors.py
    |   ├── polyfuncs.py
    |   ├── polymatrix.py
    |   ├── polyoptions.py
    |   ├── polyquinticconst.py
    |   ├── polyroots.py
    |   ├── polytools.py
    |   ├── polyutils.py
    |   ├── rationaltools.py
    |   ├── ring_series.py
    |   ├── rings.py
    |   ├── rootisolation.py
    |   ├── rootoftools.py
    |   ├── solvers.py
    |   ├── specialpolys.py
    |   ├── sqfreetools.py
    |   ├── subresultants_qq_zz.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_constructor.py
    |       ├── test_densearith.py
    |       ├── test_densebasic.py
    |       ├── test_densetools.py
    |       ├── test_dispersion.py
    |       ├── test_distributedmodules.py
    |       ├── test_euclidtools.py
    |       ├── test_factortools.py
    |       ├── test_fields.py
    |       ├── test_galoistools.py
    |       ├── test_groebnertools.py
    |       ├── test_heuristicgcd.py
    |       ├── test_injections.py
    |       ├── test_modulargcd.py
    |       ├── test_monomials.py
    |       ├── test_multivariate_resultants.py
    |       ├── test_numberfields.py
    |       ├── test_orderings.py
    |       ├── test_orthopolys.py
    |       ├── test_partfrac.py
    |       ├── test_polyclasses.py
    |       ├── test_polyfuncs.py
    |       ├── test_polymatrix.py
    |       ├── test_polyoptions.py
    |       ├── test_polyroots.py
    |       ├── test_polytools.py
    |       ├── test_polyutils.py
    |       ├── test_pythonrational.py
    |       ├── test_rationaltools.py
    |       ├── test_ring_series.py
    |       ├── test_rings.py
    |       ├── test_rootisolation.py
    |       ├── test_rootoftools.py
    |       ├── test_solvers.py
    |       ├── test_specialpolys.py
    |       ├── test_sqfreetools.py
    |       └── test_subresultants_qq_zz.py
    ├── printing
    |   ├── __init__.py
    |   ├── ccode.py
    |   ├── codeprinter.py
    |   ├── conventions.py
    |   ├── cxxcode.py
    |   ├── defaults.py
    |   ├── dot.py
    |   ├── fcode.py
    |   ├── glsl.py
    |   ├── gtk.py
    |   ├── jscode.py
    |   ├── julia.py
    |   ├── lambdarepr.py
    |   ├── latex.py
    |   ├── llvmjitcode.py
    |   ├── maple.py
    |   ├── mathematica.py
    |   ├── mathml.py
    |   ├── octave.py
    |   ├── precedence.py
    |   ├── pretty
    |   |   ├── __init__.py
    |   |   ├── pretty.py
    |   |   ├── pretty_symbology.py
    |   |   ├── stringpict.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_pretty.py
    |   ├── preview.py
    |   ├── printer.py
    |   ├── pycode.py
    |   ├── python.py
    |   ├── rcode.py
    |   ├── repr.py
    |   ├── rust.py
    |   ├── str.py
    |   ├── tableform.py
    |   ├── tensorflow.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_ccode.py
    |   |   ├── test_codeprinter.py
    |   |   ├── test_conventions.py
    |   |   ├── test_cxxcode.py
    |   |   ├── test_dot.py
    |   |   ├── test_fcode.py
    |   |   ├── test_glsl.py
    |   |   ├── test_gtk.py
    |   |   ├── test_jscode.py
    |   |   ├── test_julia.py
    |   |   ├── test_lambdarepr.py
    |   |   ├── test_latex.py
    |   |   ├── test_llvmjit.py
    |   |   ├── test_maple.py
    |   |   ├── test_mathematica.py
    |   |   ├── test_mathml.py
    |   |   ├── test_numpy.py
    |   |   ├── test_octave.py
    |   |   ├── test_precedence.py
    |   |   ├── test_preview.py
    |   |   ├── test_pycode.py
    |   |   ├── test_python.py
    |   |   ├── test_rcode.py
    |   |   ├── test_repr.py
    |   |   ├── test_rust.py
    |   |   ├── test_str.py
    |   |   ├── test_tableform.py
    |   |   ├── test_tensorflow.py
    |   |   ├── test_theanocode.py
    |   |   └── test_tree.py
    |   ├── theanocode.py
    |   └── tree.py
    ├── release.py
    ├── sandbox
    |   ├── __init__.py
    |   ├── indexed_integrals.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_indexed_integrals.py
    ├── series
    |   ├── __init__.py
    |   ├── acceleration.py
    |   ├── approximants.py
    |   ├── aseries.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_limit.py
    |   |   └── bench_order.py
    |   ├── formal.py
    |   ├── fourier.py
    |   ├── gruntz.py
    |   ├── kauers.py
    |   ├── limits.py
    |   ├── limitseq.py
    |   ├── order.py
    |   ├── residues.py
    |   ├── sequences.py
    |   ├── series.py
    |   ├── series_class.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_approximants.py
    |       ├── test_aseries.py
    |       ├── test_demidovich.py
    |       ├── test_formal.py
    |       ├── test_fourier.py
    |       ├── test_gruntz.py
    |       ├── test_kauers.py
    |       ├── test_limits.py
    |       ├── test_limitseq.py
    |       ├── test_lseries.py
    |       ├── test_nseries.py
    |       ├── test_order.py
    |       ├── test_residues.py
    |       ├── test_sequences.py
    |       └── test_series.py
    ├── sets
    |   ├── __init__.py
    |   ├── conditionset.py
    |   ├── contains.py
    |   ├── fancysets.py
    |   ├── handlers
    |   |   ├── __init__.py
    |   |   ├── add.py
    |   |   ├── functions.py
    |   |   ├── intersection.py
    |   |   ├── mul.py
    |   |   ├── power.py
    |   |   └── union.py
    |   ├── ordinals.py
    |   ├── powerset.py
    |   ├── setexpr.py
    |   ├── sets.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_conditionset.py
    |       ├── test_contains.py
    |       ├── test_fancysets.py
    |       ├── test_ordinals.py
    |       ├── test_powerset.py
    |       ├── test_setexpr.py
    |       └── test_sets.py
    ├── simplify
    |   ├── __init__.py
    |   ├── combsimp.py
    |   ├── cse_main.py
    |   ├── cse_opts.py
    |   ├── epathtools.py
    |   ├── fu.py
    |   ├── gammasimp.py
    |   ├── hyperexpand.py
    |   ├── hyperexpand_doc.py
    |   ├── powsimp.py
    |   ├── radsimp.py
    |   ├── ratsimp.py
    |   ├── simplify.py
    |   ├── sqrtdenest.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_combsimp.py
    |   |   ├── test_cse.py
    |   |   ├── test_epathtools.py
    |   |   ├── test_fu.py
    |   |   ├── test_function.py
    |   |   ├── test_gammasimp.py
    |   |   ├── test_hyperexpand.py
    |   |   ├── test_powsimp.py
    |   |   ├── test_radsimp.py
    |   |   ├── test_ratsimp.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_simplify.py
    |   |   ├── test_sqrtdenest.py
    |   |   ├── test_traversaltools.py
    |   |   └── test_trigsimp.py
    |   ├── traversaltools.py
    |   └── trigsimp.py
    ├── solvers
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_solvers.py
    |   ├── bivariate.py
    |   ├── decompogen.py
    |   ├── deutils.py
    |   ├── diophantine.py
    |   ├── inequalities.py
    |   ├── ode.py
    |   ├── pde.py
    |   ├── polysys.py
    |   ├── recurr.py
    |   ├── solvers.py
    |   ├── solveset.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_constantsimp.py
    |       ├── test_decompogen.py
    |       ├── test_diophantine.py
    |       ├── test_inequalities.py
    |       ├── test_numeric.py
    |       ├── test_ode.py
    |       ├── test_pde.py
    |       ├── test_polysys.py
    |       ├── test_recurr.py
    |       ├── test_solvers.py
    |       └── test_solveset.py
    ├── stats
    |   ├── __init__.py
    |   ├── crv.py
    |   ├── crv_types.py
    |   ├── drv.py
    |   ├── drv_types.py
    |   ├── error_prop.py
    |   ├── frv.py
    |   ├── frv_types.py
    |   ├── joint_rv.py
    |   ├── joint_rv_types.py
    |   ├── random_matrix.py
    |   ├── random_matrix_models.py
    |   ├── rv.py
    |   ├── rv_interface.py
    |   ├── stochastic_process.py
    |   ├── stochastic_process_types.py
    |   ├── symbolic_probability.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_continuous_rv.py
    |       ├── test_discrete_rv.py
    |       ├── test_error_prop.py
    |       ├── test_finite_rv.py
    |       ├── test_joint_rv.py
    |       ├── test_mix.py
    |       ├── test_random_matrix.py
    |       ├── test_rv.py
    |       ├── test_stochastic_process.py
    |       └── test_symbolic_probability.py
    ├── strategies
    |   ├── __init__.py
    |   ├── branch
    |   |   ├── __init__.py
    |   |   ├── core.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_core.py
    |   |   |   ├── test_tools.py
    |   |   |   └── test_traverse.py
    |   |   ├── tools.py
    |   |   └── traverse.py
    |   ├── core.py
    |   ├── rl.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_core.py
    |   |   ├── test_rl.py
    |   |   ├── test_strat.py
    |   |   ├── test_tools.py
    |   |   ├── test_traverse.py
    |   |   └── test_tree.py
    |   ├── tools.py
    |   ├── traverse.py
    |   ├── tree.py
    |   └── util.py
    ├── tensor
    |   ├── __init__.py
    |   ├── array
    |   |   ├── __init__.py
    |   |   ├── array_comprehension.py
    |   |   ├── arrayop.py
    |   |   ├── dense_ndim_array.py
    |   |   ├── mutable_ndim_array.py
    |   |   ├── ndim_array.py
    |   |   ├── sparse_ndim_array.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_array_comprehension.py
    |   |       ├── test_arrayop.py
    |   |       ├── test_immutable_ndim_array.py
    |   |       ├── test_mutable_ndim_array.py
    |   |       ├── test_ndim_array.py
    |   |       └── test_ndim_array_conversions.py
    |   ├── functions.py
    |   ├── index_methods.py
    |   ├── indexed.py
    |   ├── tensor.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_functions.py
    |   |   ├── test_index_methods.py
    |   |   ├── test_indexed.py
    |   |   ├── test_tensor.py
    |   |   ├── test_tensor_element.py
    |   |   └── test_tensor_operators.py
    |   └── toperators.py
    ├── this.py
    ├── unify
    |   ├── __init__.py
    |   ├── core.py
    |   ├── rewrite.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_sympy.py
    |   |   └── test_unify.py
    |   └── usympy.py
    ├── utilities
    |   ├── __init__.py
    |   ├── _compilation
    |   |   ├── __init__.py
    |   |   ├── availability.py
    |   |   ├── compilation.py
    |   |   ├── runners.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── test_compilation.py
    |   |   └── util.py
    |   ├── autowrap.py
    |   ├── benchmarking.py
    |   ├── codegen.py
    |   ├── decorator.py
    |   ├── enumerative.py
    |   ├── exceptions.py
    |   ├── iterables.py
    |   ├── lambdify.py
    |   ├── magic.py
    |   ├── matchpy_connector.py
    |   ├── mathml
    |   |   ├── __init__.py
    |   |   └── data
    |   ├── memoization.py
    |   ├── misc.py
    |   ├── pkgdata.py
    |   ├── pytest.py
    |   ├── quality_unicode.py
    |   ├── randtest.py
    |   ├── runtests.py
    |   ├── source.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── diagnose_imports.py
    |   |   ├── test_autowrap.py
    |   |   ├── test_code_quality.py
    |   |   ├── test_codegen.py
    |   |   ├── test_codegen_julia.py
    |   |   ├── test_codegen_octave.py
    |   |   ├── test_codegen_rust.py
    |   |   ├── test_decorator.py
    |   |   ├── test_enumerative.py
    |   |   ├── test_iterables.py
    |   |   ├── test_lambdify.py
    |   |   ├── test_misc.py
    |   |   ├── test_module_imports.py
    |   |   ├── test_pickling.py
    |   |   ├── test_pytest.py
    |   |   ├── test_source.py
    |   |   ├── test_timeutils.py
    |   |   └── test_wester.py
    |   ├── timeutils.py
    |   └── tmpfiles.py
    └── vector
        ├── __init__.py
        ├── basisdependent.py
        ├── coordsysrect.py
        ├── deloperator.py
        ├── dyadic.py
        ├── functions.py
        ├── operators.py
        ├── orienters.py
        ├── point.py
        ├── scalar.py
        ├── tests
        |   ├── __init__.py
        |   ├── test_coordsysrect.py
        |   ├── test_dyadic.py
        |   ├── test_field_functions.py
        |   ├── test_functions.py
        |   ├── test_operators.py
        |   ├── test_printing.py
        |   └── test_vector.py
        └── vector.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
Incorrect parenthesizing of Subs

Issue description: 
Here is an example.
```python
>>> from sympy import Subs
>>> from sympy.abc import x,y
>>> 3*Subs(-x+y, (x,),(1,))
```
LaTeX printing of this gives:  
```python
'3 \\left. - x + y \\right|_{\\substack{ x=1 }}'
```

![image](https://quicklatex.com/cache3/76/ql_9672fd7e62c909ff3d9ac8543c2e2576_l3.png)


It would be better to be parenthesized to:  
```python
'3 \\left. \\left(- x + y\\right) \\right|_{\\substack{ x=1 }}'
```

![image](https://quicklatex.com/cache3/bf/ql_936ffdb876e784206d4c54bb93d28dbf_l3.png)


Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: sympy/printing/tests/test_latex.py
Line number range: 209 - 257
Content:
209. def test_latex_vector_expressions():
210.     A = CoordSys3D('A')
211. 
212.     assert latex(Cross(A.i, A.j*A.x*3+A.k)) == \
213.         r"\mathbf{\hat{i}_{A}} \times \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}} + \mathbf{\hat{k}_{A}}\right)"
214.     assert latex(Cross(A.i, A.j)) == \
215.         r"\mathbf{\hat{i}_{A}} \times \mathbf{\hat{j}_{A}}"
216.     assert latex(x*Cross(A.i, A.j)) == \
217.         r"x \left(\mathbf{\hat{i}_{A}} \times \mathbf{\hat{j}_{A}}\right)"
218.     assert latex(Cross(x*A.i, A.j)) == \
219.         r'- \mathbf{\hat{j}_{A}} \times \left((x)\mathbf{\hat{i}_{A}}\right)'
220. 
221.     assert latex(Curl(3*A.x*A.j)) == \
222.         r"\nabla\times \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)"
223.     assert latex(Curl(3*A.x*A.j+A.i)) == \
224.         r"\nabla\times \left(\mathbf{\hat{i}_{A}} + (3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)"
225.     assert latex(Curl(3*x*A.x*A.j)) == \
226.         r"\nabla\times \left((3 \mathbf{{x}_{A}} x)\mathbf{\hat{j}_{A}}\right)"
227.     assert latex(x*Curl(3*A.x*A.j)) == \
228.         r"x \left(\nabla\times \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)\right)"
229. 
230.     assert latex(Divergence(3*A.x*A.j+A.i)) == \
231.         r"\nabla\cdot \left(\mathbf{\hat{i}_{A}} + (3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)"
232.     assert latex(Divergence(3*A.x*A.j)) == \
233.         r"\nabla\cdot \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)"
234.     assert latex(x*Divergence(3*A.x*A.j)) == \
235.         r"x \left(\nabla\cdot \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)\right)"
236. 
237.     assert latex(Dot(A.i, A.j*A.x*3+A.k)) == \
238.         r"\mathbf{\hat{i}_{A}} \cdot \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}} + \mathbf{\hat{k}_{A}}\right)"
239.     assert latex(Dot(A.i, A.j)) == \
240.         r"\mathbf{\hat{i}_{A}} \cdot \mathbf{\hat{j}_{A}}"
241.     assert latex(Dot(x*A.i, A.j)) == \
242.         r"\mathbf{\hat{j}_{A}} \cdot \left((x)\mathbf{\hat{i}_{A}}\right)"
243.     assert latex(x*Dot(A.i, A.j)) == \
244.         r"x \left(\mathbf{\hat{i}_{A}} \cdot \mathbf{\hat{j}_{A}}\right)"
245. 
246.     assert latex(Gradient(A.x)) == r"\nabla \mathbf{{x}_{A}}"
247.     assert latex(Gradient(A.x + 3*A.y)) == \
248.         r"\nabla \left(\mathbf{{x}_{A}} + 3 \mathbf{{y}_{A}}\right)"
249.     assert latex(x*Gradient(A.x)) == r"x \left(\nabla \mathbf{{x}_{A}}\right)"
250.     assert latex(Gradient(x*A.x)) == r"\nabla \left(\mathbf{{x}_{A}} x\right)"
251. 
252.     assert latex(Laplacian(A.x)) == r"\triangle \mathbf{{x}_{A}}"
253.     assert latex(Laplacian(A.x + 3*A.y)) == \
254.         r"\triangle \left(\mathbf{{x}_{A}} + 3 \mathbf{{y}_{A}}\right)"
255.     assert latex(x*Laplacian(A.x)) == r"x \left(\triangle \mathbf{{x}_{A}}\right)"
256.     assert latex(Laplacian(x*A.x)) == r"\triangle \left(\mathbf{{x}_{A}} x\right)"
257. 


File: sympy/printing/tests/test_latex.py
Line number range: 192 - 200
Content:
192. def test_latex_permutation():
193.     assert latex(Permutation(1, 2, 4)) == r"\left( 1\; 2\; 4\right)"
194.     assert latex(Permutation(1, 2)(4, 5, 6)) == \
195.         r"\left( 1\; 2\right)\left( 4\; 5\; 6\right)"
196.     assert latex(Permutation()) == r"\left( \right)"
197.     assert latex(Permutation(2, 4)*Permutation(5)) == \
198.         r"\left( 2\; 4\right)\left( 5\right)"
199.     assert latex(Permutation(5)) == r"\left( 5\right)"
200. 


File: sympy/printing/tests/test_latex.py
Line number range: 170 - 183
Content:
170. def test_latex_SingularityFunction():
171.     assert latex(SingularityFunction(x, 4, 5)) == \
172.         r"{\left\langle x - 4 \right\rangle}^{5}"
173.     assert latex(SingularityFunction(x, -3, 4)) == \
174.         r"{\left\langle x + 3 \right\rangle}^{4}"
175.     assert latex(SingularityFunction(x, 0, 4)) == \
176.         r"{\left\langle x \right\rangle}^{4}"
177.     assert latex(SingularityFunction(x, a, n)) == \
178.         r"{\left\langle - a + x \right\rangle}^{n}"
179.     assert latex(SingularityFunction(x, 4, -2)) == \
180.         r"{\left\langle x - 4 \right\rangle}^{-2}"
181.     assert latex(SingularityFunction(x, 4, -1)) == \
182.         r"{\left\langle x - 4 \right\rangle}^{-1}"
183. 


File: sympy/printing/tests/test_latex.py
Line number range: 357 - 359
Content:
357.     assert latex(factorial(k)) == r"k!"
358.     assert latex(factorial(-k)) == r"\left(- k\right)!"
359.     assert latex(factorial(k)**2) == r"k!^{2}"


File: sympy/printing/tests/test_latex.py
Line number range: 675 - 678
Content:
675. def test_latex_subs():
676.     assert latex(Subs(x*y, (
677.         x, y), (1, 2))) == r'\left. x y \right|_{\substack{ x=1\\ y=2 }}'
678. 


File: sympy/printing/tests/test_latex.py
Line number range: 2046 - 2061
Content:
2046. def test_Mul():
2047.     e = Mul(-2, x + 1, evaluate=False)
2048.     assert latex(e) == r'- 2 \left(x + 1\right)'
2049.     e = Mul(2, x + 1, evaluate=False)
2050.     assert latex(e) == r'2 \left(x + 1\right)'
2051.     e = Mul(S.Half, x + 1, evaluate=False)
2052.     assert latex(e) == r'\frac{x + 1}{2}'
2053.     e = Mul(y, x + 1, evaluate=False)
2054.     assert latex(e) == r'y \left(x + 1\right)'
2055.     e = Mul(-y, x + 1, evaluate=False)
2056.     assert latex(e) == r'- y \left(x + 1\right)'
2057.     e = Mul(-2, x + 1)
2058.     assert latex(e) == r'- 2 x - 2'
2059.     e = Mul(2, x + 1)
2060.     assert latex(e) == r'2 x + 2'
2061. 


File: sympy/printing/tests/test_latex.py
Line number range: 1213 - 1232
Content:
1213. def test_latex_Piecewise():
1214.     p = Piecewise((x, x < 1), (x**2, True))
1215.     assert latex(p) == "\\begin{cases} x & \\text{for}\\: x < 1 \\\\x^{2} &" \
1216.                        " \\text{otherwise} \\end{cases}"
1217.     assert latex(p, itex=True) == \
1218.         "\\begin{cases} x & \\text{for}\\: x \\lt 1 \\\\x^{2} &" \
1219.         " \\text{otherwise} \\end{cases}"
1220.     p = Piecewise((x, x < 0), (0, x >= 0))
1221.     assert latex(p) == '\\begin{cases} x & \\text{for}\\: x < 0 \\\\0 &' \
1222.                        ' \\text{otherwise} \\end{cases}'
1223.     A, B = symbols("A B", commutative=False)
1224.     p = Piecewise((A**2, Eq(A, B)), (A*B, True))
1225.     s = r"\begin{cases} A^{2} & \text{for}\: A = B \\A B & \text{otherwise} \end{cases}"
1226.     assert latex(p) == s
1227.     assert latex(A*p) == r"A \left(%s\right)" % s
1228.     assert latex(p*A) == r"\left(%s\right) A" % s
1229.     assert latex(Piecewise((x, x < 1), (x**2, x < 2))) == \
1230.         '\\begin{cases} x & ' \
1231.         '\\text{for}\\: x < 1 \\\\x^{2} & \\text{for}\\: x < 2 \\end{cases}'
1232. 


File: sympy/printing/tests/test_latex.py
Line number range: 2086 - 2095
Content:
2086. def test_issue_7117():
2087.     # See also issue #5031 (hence the evaluate=False in these).
2088.     e = Eq(x + 1, 2*x)
2089.     q = Mul(2, e, evaluate=False)
2090.     assert latex(q) == r"2 \left(x + 1 = 2 x\right)"
2091.     q = Add(6, e, evaluate=False)
2092.     assert latex(q) == r"6 + \left(x + 1 = 2 x\right)"
2093.     q = Pow(e, 2, evaluate=False)
2094.     assert latex(q) == r"\left(x + 1 = 2 x\right)^{2}"
2095. 


File: sympy/printing/tests/test_latex.py
Line number range: 533 - 538
Content:
533.     assert latex(Mod(x, 7)) == r'x\bmod{7}'
534.     assert latex(Mod(x + 1, 7)) == r'\left(x + 1\right)\bmod{7}'
535.     assert latex(Mod(2 * x, 7)) == r'2 x\bmod{7}'
536.     assert latex(Mod(x, 7) + 1) == r'\left(x\bmod{7}\right) + 1'
537.     assert latex(2 * Mod(x, 7)) == r'2 \left(x\bmod{7}\right)'
538. 

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

2025-10-06 08:57:50,640 - thread-139660780025408.app.lang_graph.nodes.context_refine_node - DEBUG - reasoning="1. The user wants 5 complete, self-contained test cases related to LaTeX printing and parenthesizing.\n2. The provided context contains snippets of several relevant test functions from `sympy/printing/tests/test_latex.py`.\n3. However, to be 'self-contained', these test cases require the import statements from the beginning of the file, which are not included in the context.\n4. Therefore, I need to retrieve the full content of `sympy/printing/tests/test_latex.py` to access the imports and construct the complete test cases as requested." refined_query='Please provide the full content of the file `sympy/printing/tests/test_latex.py`.'
2025-10-06 08:57:52,513 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "sympy/printing/tests/test_latex.py"}'}, '__gemini_function_call_thought_signatures__': {'02d938d4-5ca3-48fb-af09-511c3e498442': 'CtQDAR/MhbYmcJnyg4EPrF57QvOhfPWtUog3zPdDvn4vt7apn2NADTvFPSMLr8NAFLGEOlQRS3aCntQm78Gs66WT5rS4j6l7+jmPHUnpBdVpxkghkNLe0QL46yZMAZirvd63zyCirvzT7+CoiRJdkfPQRMTRNVAI+YvCVGSeBqNoFKycjSLAaHfUAqnFqEzLqDcY+sYr8qSA+5G62cgKFfMuIW0W5+O+v0bYxsvmBBquS5D8YXkZcEYhAQFb8jc1v1bmRq8c4nwXJl916G/NlR7Kp9lWDrmSPfbokS4mhizqFIj0yAL5CHUKJ2jGquaFQtLTqA4F1nc6nh3CPT0tMUK/HfWJd+0zzmOozSNpufr3TPiAiGVhJR6ltVEo183tDJ2dcchQkPv3A2QjRdvTb9yQ27Q7HrwtvGmmhYvwdcGaJRQV+1+IVk+tulIe4NB0vopDk1tuAI64V5qA2UCExJ0FKc3llHzvsaBMQ++RXn9sSrJBcdOjUqZrE8VdySVo9VfYJeRYiUYuKm7k69ulwf9G1lp2Uy0oy143xl2Si9b/F/WWvQ5fnnIak8NnAUIC7Ynh1sXc8l7akhQoh+sjO1NNFDCJ8wRBskTNQopWUjBTVjCQXHwn'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 19691, 'candidates_token_count': 26, 'total_token_count': 19839, 'cached_content_token_count': 19601, 'prompt_tokens_details': [{'modality': 1, 'token_count': 19691}], 'cache_tokens_details': [{'modality': 1, 'token_count': 19601}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 26}], 'thoughts_token_count': 122}, 'finish_reason': 'STOP', 'avg_logprobs': -0.04412063727012047, 'model_name': 'gemini-2.5-pro'} id='run--7219f2fa-ac86-4a2d-8544-47c356718aaa-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'sympy/printing/tests/test_latex.py'}, 'id': '02d938d4-5ca3-48fb-af09-511c3e498442', 'type': 'tool_call'}] usage_metadata={'input_tokens': 19691, 'output_tokens': 26, 'total_tokens': 19839, 'input_token_details': {'cache_read': 19601}, 'output_token_details': {'reasoning': 122}}
2025-10-06 08:57:55,665 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "sympy/printing/tests/test_latex.py", "start_line": 500.0, "end_line": 1000.0}'}, '__gemini_function_call_thought_signatures__': {'32c983b3-18d8-4359-a433-0314cd49b0a3': 'CqAFAR/MhbZLvFzPu1uWEHsw1H+9Vfnc2ChiMvRtZNjBZRxzSyKQbkeRon1MLLj3tblfAqRBcXDyHdF1YjM8MxQ6qF1K25QLEWwD2TIj8XLdSP/QnqRVJX3JQmkgwLmitggUpR9eQCmJPotiTDbq505VIs5KsE7WNlUgaadh5g/grsjDEHt5dnhsnHc3dTuRkBgBqE0qJUixPlN/dlhBjuw1lQHBI55Hmz3Q+Q+yB4/V3rnF67qbLRM70lxTlCbLt1up7z7PK8Oal681YQ10VbvRRGR5rM5fs77Suv1M5OT/Qxg7EVXsAs5w9bXNR4cuppE3pJPTsQM0TJ+o0jpFN6s5pH1LitBchk96MZGxM/RjyrQgLS/COe80j54u3j9ihZlUtcnIwwBin0Q2hc0rSFwYX2sqRVy0L61KmQVpS1sgMXmKUzAWuV/PSOb9/NNcyIlGX46pVJDwaFABfNW+hF8yX9pZwj3UbhWnzdPTFx5YRGLj4E68b5qoBUNaIKZaigm/2GaRP8YwCU7o7tcr5xPmqYiauRyUB69g+BlQTdwhB4ux2xRMUClCn9qP3noPN8bWe19Vfgmcv/1SRWoyLqqP8uy36/V7VZRNpqzZRlktaHwW7W2C/bxWKlz+tIWN9MHStS3DmbrBuIRUOmnqKG8pIkYKPcznvFFh20YLaWHxlYz9h+tGMhjIl0eWgsJ2mSzfz29u1LG5OP2w+EVXSgX/+YdreZEnQBsW6A5yUvuBPUuzr8yPNiExSWIIXk8D1wHbHhY7y+lAeO7JRwAiikFd/UlCluLaoaPIbPtaQv+DDt6Rmc+Aiw2cwIz6oq39oqOO4iCcTtdJguVKetbbjmBPvHxmKaFhIIDNBlZwMAXebHm2ejOMzhaXAcF5uAxzLYpr'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 31378, 'candidates_token_count': 32, 'total_token_count': 31594, 'cached_content_token_count': 19423, 'prompt_tokens_details': [{'modality': 1, 'token_count': 31498}], 'cache_tokens_details': [{'modality': 1, 'token_count': 19423}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 32}], 'thoughts_token_count': 184}, 'finish_reason': 'STOP', 'avg_logprobs': -0.7780274748802185, 'model_name': 'gemini-2.5-pro'} id='run--4c4fe4e8-b344-457f-add4-e481462fc003-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'sympy/printing/tests/test_latex.py', 'start_line': 500.0, 'end_line': 1000.0}, 'id': '32c983b3-18d8-4359-a433-0314cd49b0a3', 'type': 'tool_call'}] usage_metadata={'input_tokens': 31378, 'output_tokens': 32, 'total_tokens': 31594, 'input_token_details': {'cache_read': 19423}, 'output_token_details': {'reasoning': 184}}
2025-10-06 08:57:58,123 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 1000.0, "relative_path": "sympy/printing/tests/test_latex.py", "end_line": 2000.0}'}, '__gemini_function_call_thought_signatures__': {'bf7d6256-240c-4ae0-a0d2-a1224ee9b718': 'CvwEAR/MhbZvSRT0fzqO+Us27xpnibXPewZtQg88FWCJkzi2SBf1cnNsGGeGK93c5UqvUx3Y8D/iqaXGdpC0z5rY/qeqixvm8egNRvVfCRMid7FlJ9SdmkUBsY+q4rBRVG6v+DvdS0WqNEhxWGwMfUr9extm+Z0O4FIwYBH2pS99fSZJOBJzfO3L8X8Eb2VMVGaOJ6/o0SYDKJP4W594hoyVP7aNm8Y12d2prsmEqz7mg5TRiCW2g5H8Av+/cFillqDOH1MCzipuk2amC/oNlFb3cp0MISMvAzdbxebw31SEaXQYgpTRdU60COml2DSQitOa5G1CgZbb61FI/rNivG3VhMR6isVMd9K+wNAWMyS0TM3ON8p6a27V2w0sPMr5HsXKnfyCzinBBKZ7N2XYhi/P+p+wl0ebD8G9bEzl811OqCOx6JqBdATqtAm2GqJUf2iWl9N0bz8I4oLCCB8bM/NzLGSGBNozKPtZ6NDIPOEnMtleX1mwCvJ1xoHaMOJ96ePZs4Okc63I/xLfi3VMezKFwvqDQVRTbESndVj7fNuDRpxZr5eUsx1K//yaJvzAH9iVyQFZovPha8O0ZY47DO3+SjXbv/K2il1OGZkLF6plG6Y71baI8rGmcadO3w0YI9ymQqIxpuX0zqWkQ6dOl1RIS/zhlfj8EIIdR9MMIir3cGJ+gCIpjkcYR2QixaLWyBXwJeywaSM/ptsRxlCX14IpsafsQPau4Tlq4OWBSjwKOHp7XjpO7AKpz06MZjfOfW2/jtZkgN/KW/85rcuBR43sxgfGITofptHowdF6zysGfP7cwQPi4ZSqP5YZ1qmjZg9EySJkTku8RQW6lsxB'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 42443, 'candidates_token_count': 32, 'total_token_count': 42651, 'cached_content_token_count': 30602, 'prompt_tokens_details': [{'modality': 1, 'token_count': 42745}], 'cache_tokens_details': [{'modality': 1, 'token_count': 30602}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 32}], 'thoughts_token_count': 176}, 'finish_reason': 'STOP', 'avg_logprobs': -0.13759848475456238, 'model_name': 'gemini-2.5-pro'} id='run--1a6285be-b3bf-4637-8430-40adae394c18-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 1000.0, 'relative_path': 'sympy/printing/tests/test_latex.py', 'end_line': 2000.0}, 'id': 'bf7d6256-240c-4ae0-a0d2-a1224ee9b718', 'type': 'tool_call'}] usage_metadata={'input_tokens': 42443, 'output_tokens': 32, 'total_tokens': 42651, 'input_token_details': {'cache_read': 30602}, 'output_token_details': {'reasoning': 176}}
2025-10-06 08:58:01,041 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "sympy/printing/tests/test_latex.py", "start_line": 2000.0, "end_line": 3000.0}'}, '__gemini_function_call_thought_signatures__': {'183a6c1c-5658-479b-b6e7-9708fd85a834': 'Cv4EAR/MhbbLNzf5S21QRvO/Pxxk8tzNrJVmVIuLR6tPgPZjOjLC5OvuxSmahovGCCjNyEA/OOQuk1QX1lLULepr82xSp2/bjXrW3K6cqez6meZB/iMPpzHhBMAoa3sG0SePZ+eQkF3InPqeRNBWMrGbhSproaBYvJpL/zhUrWDJS8qZVKdSpIeK9hUZSv5q3Am7zgVepwz5wMFwmqlbwJ6VXX4uR0uNxeQboHjyGoL6GyqU17cgAKgYPNz6DoBtBHUta5mGpWhXmpOdr06aAEP3OCW4it3+KOECzvGcRi2n8J9iXtlXMINTyoz3g+hwemWGqp38yK+LAwncS6acJL8qqma7hiZLkxgok+lHM4f8lJMq1c6P4nIuS5XIhThA1rHA81xBx3inq6pbBDL4RwpPFuY+oidAqgxI4Ep1DKqlY04A4ooMdRuwjxAE1ZRIfsnaG/V/bhSa7mu1p431Rw3xJZCIB0Coy/3lyxvFJrPXZypgcIhfxIISMr9/tR36xIPGlrjumJwQz2H+kyJJL+i5sNyOt+XqNyy/PfhtP8LHONJavMqHl/xO941M7pz7hj3D24BpvUuKOEjbxFUtihtSOa+oRfYDoGFTOL31Ol+U//kn9yIJIBY6hSODl5EvPaOQZ+UaDtXloreIaRZc/RW1SBNrF4Ocxgnq/1ePPuoh8LtKGDVGhki2oSOolGjGwC0n3PqHRMu9Yt2jA17+vqZq5dhCcSWnOdM/45DNkERDn8effT4jGIqsigXyX4kW7qPIkcoRvQoGr+gAan3uhbnkKS5ZqznC7TZsNWANvXY54fpO3j1PIHb4HduYi+ZDsCyo/Q56LO40cJv9r+410+U='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 64271, 'candidates_token_count': 32, 'total_token_count': 64479, 'cached_content_token_count': 19105, 'prompt_tokens_details': [{'modality': 1, 'token_count': 64746}], 'cache_tokens_details': [{'modality': 1, 'token_count': 19105}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 32}], 'thoughts_token_count': 176}, 'finish_reason': 'STOP', 'avg_logprobs': -0.00472676195204258, 'model_name': 'gemini-2.5-pro'} id='run--330a62af-74d2-4338-b607-e639b0d124eb-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'sympy/printing/tests/test_latex.py', 'start_line': 2000.0, 'end_line': 3000.0}, 'id': '183a6c1c-5658-479b-b6e7-9708fd85a834', 'type': 'tool_call'}] usage_metadata={'input_tokens': 64271, 'output_tokens': 32, 'total_tokens': 64479, 'input_token_details': {'cache_read': 19105}, 'output_token_details': {'reasoning': 176}}
2025-10-06 08:58:04,631 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the complete content of the file `sympy/printing/tests/test_latex.py`. The file contains a comprehensive suite of tests for the LaTeX printing functionality in SymPy, covering a wide variety of mathematical expressions and structures. The tests verify the correct LaTeX output for basic arithmetic, functions, matrices, sets, integrals, and many other SymPy objects.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 74927, 'candidates_token_count': 76, 'total_token_count': 75107, 'cached_content_token_count': 61275, 'prompt_tokens_details': [{'modality': 1, 'token_count': 75575}], 'cache_tokens_details': [{'modality': 1, 'token_count': 61275}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 76}], 'thoughts_token_count': 104}, 'finish_reason': 'STOP', 'avg_logprobs': -0.25703269556949015, 'model_name': 'gemini-2.5-pro'} id='run--0b6aa343-ca34-425a-9293-229ac9b10d7a-0' usage_metadata={'input_tokens': 74927, 'output_tokens': 76, 'total_tokens': 75107, 'input_token_details': {'cache_read': 61275}, 'output_token_details': {'reasoning': 104}}
2025-10-06 08:58:04,632 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - INFO - Starting context extraction process
2025-10-06 08:58:04,633 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - DEBUG - This is the original user query:

--- BEGIN ORIGINAL QUERY ---
Issue title:
Incorrect parenthesizing of Subs

Issue description: 
Here is an example.
```python
>>> from sympy import Subs
>>> from sympy.abc import x,y
>>> 3*Subs(-x+y, (x,),(1,))
```
LaTeX printing of this gives:  
```python
'3 \\left. - x + y \\right|_{\\substack{ x=1 }}'
```

![image](https://quicklatex.com/cache3/76/ql_9672fd7e62c909ff3d9ac8543c2e2576_l3.png)


It would be better to be parenthesized to:  
```python
'3 \\left. \\left(- x + y\\right) \\right|_{\\substack{ x=1 }}'
```

![image](https://quicklatex.com/cache3/bf/ql_936ffdb876e784206d4c54bb93d28dbf_l3.png)


Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

This is the refinement query. Please consider it together with the original query. It's really IMPORTANT!!!

--- BEGIN REFINEMENT QUERY ---
Please provide the full content of the file `sympy/printing/tests/test_latex.py`.
--- END REFINEMENT QUERY ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: sympy/printing/tests/test_latex.py
Line number range: 1 - 500
Content:
1. from sympy import (
2.     Add, Abs, Chi, Ci, CosineTransform, Dict, Ei, Eq, FallingFactorial,
3.     FiniteSet, Float, FourierTransform, Function, Indexed, IndexedBase, Integral,
4.     Interval, InverseCosineTransform, InverseFourierTransform, Derivative,
5.     InverseLaplaceTransform, InverseMellinTransform, InverseSineTransform,
6.     Lambda, LaplaceTransform, Limit, Matrix, Max, MellinTransform, Min, Mul,
7.     Order, Piecewise, Poly, ring, field, ZZ, Pow, Product, Range, Rational,
8.     RisingFactorial, rootof, RootSum, S, Shi, Si, SineTransform, Subs,
9.     Sum, Symbol, ImageSet, Tuple, Ynm, Znm, arg, asin, acsc, Mod,
10.     assoc_laguerre, assoc_legendre, beta, binomial, catalan, ceiling, Complement,
11.     chebyshevt, chebyshevu, conjugate, cot, coth, diff, dirichlet_eta, euler,
12.     exp, expint, factorial, factorial2, floor, gamma, gegenbauer, hermite,
13.     hyper, im, jacobi, laguerre, legendre, lerchphi, log, frac,
14.     meijerg, oo, polar_lift, polylog, re, root, sin, sqrt, symbols,
15.     uppergamma, zeta, subfactorial, totient, elliptic_k, elliptic_f,
16.     elliptic_e, elliptic_pi, cos, tan, Wild, true, false, Equivalent, Not,
17.     Contains, divisor_sigma, SeqPer, SeqFormula,
18.     SeqAdd, SeqMul, fourier_series, pi, ConditionSet, ComplexRegion, fps,
19.     AccumBounds, reduced_totient, primenu, primeomega, SingularityFunction,
20.     stieltjes, mathieuc, mathieus, mathieucprime, mathieusprime,
21.     UnevaluatedExpr, Quaternion, I, KroneckerProduct, LambertW)
22. 
23. from sympy.ntheory.factor_ import udivisor_sigma
24. 
25. from sympy.abc import mu, tau
26. from sympy.printing.latex import (latex, translate, greek_letters_set,
27.                                   tex_greek_dictionary, multiline_latex)
28. from sympy.tensor.array import (ImmutableDenseNDimArray,
29.                                 ImmutableSparseNDimArray,
30.                                 MutableSparseNDimArray,
31.                                 MutableDenseNDimArray,
32.                                 tensorproduct)
33. from sympy.utilities.pytest import XFAIL, raises
34. from sympy.functions import DiracDelta, Heaviside, KroneckerDelta, LeviCivita
35. from sympy.functions.combinatorial.numbers import bernoulli, bell, lucas, \
36.     fibonacci, tribonacci
37. from sympy.logic import Implies
38. from sympy.logic.boolalg import And, Or, Xor
39. from sympy.physics.quantum import Commutator, Operator
40. from sympy.physics.units import degree, radian, kg, meter, gibibyte, microgram, second
41. from sympy.core.trace import Tr
42. from sympy.core.compatibility import range
43. from sympy.combinatorics.permutations import Cycle, Permutation
44. from sympy import MatrixSymbol, ln
45. from sympy.vector import CoordSys3D, Cross, Curl, Dot, Divergence, Gradient, Laplacian
46. from sympy.sets.setexpr import SetExpr
47. from sympy.sets.sets import \
48.     Union, Intersection, Complement, SymmetricDifference, ProductSet
49. 
50. import sympy as sym
51. 
52. 
53. class lowergamma(sym.lowergamma):
54.     pass   # testing notation inheritance by a subclass with same name
55. 
56. 
57. x, y, z, t, a, b, c = symbols('x y z t a b c')
58. k, m, n = symbols('k m n', integer=True)
59. 
60. 
61. def test_printmethod():
62.     class R(Abs):
63.         def _latex(self, printer):
64.             return "foo(%s)" % printer._print(self.args[0])
65.     assert latex(R(x)) == "foo(x)"
66. 
67.     class R(Abs):
68.         def _latex(self, printer):
69.             return "foo"
70.     assert latex(R(x)) == "foo"
71. 
72. 
73. def test_latex_basic():
74.     assert latex(1 + x) == "x + 1"
75.     assert latex(x**2) == "x^{2}"
76.     assert latex(x**(1 + x)) == "x^{x + 1}"
77.     assert latex(x**3 + x + 1 + x**2) == "x^{3} + x^{2} + x + 1"
78. 
79.     assert latex(2*x*y) == "2 x y"
80.     assert latex(2*x*y, mul_symbol='dot') == r"2 \cdot x \cdot y"
81.     assert latex(3*x**2*y, mul_symbol='\\,') == r"3\,x^{2}\,y"
82.     assert latex(1.5*3**x, mul_symbol='\\,') == r"1.5 \cdot 3^{x}"
83. 
84.     assert latex(1/x) == r"\frac{1}{x}"
85.     assert latex(1/x, fold_short_frac=True) == "1 / x"
86.     assert latex(-S(3)/2) == r"- \frac{3}{2}"
87.     assert latex(-S(3)/2, fold_short_frac=True) == r"- 3 / 2"
88.     assert latex(1/x**2) == r"\frac{1}{x^{2}}"
89.     assert latex(1/(x + y)/2) == r"\frac{1}{2 \left(x + y\right)}"
90.     assert latex(x/2) == r"\frac{x}{2}"
91.     assert latex(x/2, fold_short_frac=True) == "x / 2"
92.     assert latex((x + y)/(2*x)) == r"\frac{x + y}{2 x}"
93.     assert latex((x + y)/(2*x), fold_short_frac=True) == \
94.         r"\left(x + y\right) / 2 x"
95.     assert latex((x + y)/(2*x), long_frac_ratio=0) == \
96.         r"\frac{1}{2 x} \left(x + y\right)"
97.     assert latex((x + y)/x) == r"\frac{x + y}{x}"
98.     assert latex((x + y)/x, long_frac_ratio=3) == r"\frac{x + y}{x}"
99.     assert latex((2*sqrt(2)*x)/3) == r"\frac{2 \sqrt{2} x}{3}"
100.     assert latex((2*sqrt(2)*x)/3, long_frac_ratio=2) == \
101.         r"\frac{2 x}{3} \sqrt{2}"
102. 
103.     assert latex(2*Integral(x, x)/3) == r"\frac{2 \int x\, dx}{3}"
104.     assert latex(2*Integral(x, x)/3, fold_short_frac=True) == \
105.         r"\left(2 \int x\, dx\right) / 3"
106. 
107.     assert latex(sqrt(x)) == r"\sqrt{x}"
108.     assert latex(x**Rational(1, 3)) == r"\sqrt[3]{x}"
109.     assert latex(x**Rational(1, 3), root_notation=False) == r"x^{\frac{1}{3}}"
110.     assert latex(sqrt(x)**3) == r"x^{\frac{3}{2}}"
111.     assert latex(sqrt(x), itex=True) == r"\sqrt{x}"
112.     assert latex(x**Rational(1, 3), itex=True) == r"\root{3}{x}"
113.     assert latex(sqrt(x)**3, itex=True) == r"x^{\frac{3}{2}}"
114.     assert latex(x**Rational(3, 4)) == r"x^{\frac{3}{4}}"
115.     assert latex(x**Rational(3, 4), fold_frac_powers=True) == "x^{3/4}"
116.     assert latex((x + 1)**Rational(3, 4)) == \
117.         r"\left(x + 1\right)^{\frac{3}{4}}"
118.     assert latex((x + 1)**Rational(3, 4), fold_frac_powers=True) == \
119.         r"\left(x + 1\right)^{3/4}"
120. 
121.     assert latex(1.5e20*x) == r"1.5 \cdot 10^{20} x"
122.     assert latex(1.5e20*x, mul_symbol='dot') == r"1.5 \cdot 10^{20} \cdot x"
123.     assert latex(1.5e20*x, mul_symbol='times') == \
124.         r"1.5 \times 10^{20} \times x"
125. 
126.     assert latex(1/sin(x)) == r"\frac{1}{\sin{\left(x \right)}}"
127.     assert latex(sin(x)**-1) == r"\frac{1}{\sin{\left(x \right)}}"
128.     assert latex(sin(x)**Rational(3, 2)) == \
129.         r"\sin^{\frac{3}{2}}{\left(x \right)}"
130.     assert latex(sin(x)**Rational(3, 2), fold_frac_powers=True) == \
131.         r"\sin^{3/2}{\left(x \right)}"
132. 
133.     assert latex(~x) == r"\neg x"
134.     assert latex(x & y) == r"x \wedge y"
135.     assert latex(x & y & z) == r"x \wedge y \wedge z"
136.     assert latex(x | y) == r"x \vee y"
137.     assert latex(x | y | z) == r"x \vee y \vee z"
138.     assert latex((x & y) | z) == r"z \vee \left(x \wedge y\right)"
139.     assert latex(Implies(x, y)) == r"x \Rightarrow y"
140.     assert latex(~(x >> ~y)) == r"x \not\Rightarrow \neg y"
141.     assert latex(Implies(Or(x,y), z)) == r"\left(x \vee y\right) \Rightarrow z"
142.     assert latex(Implies(z, Or(x,y))) == r"z \Rightarrow \left(x \vee y\right)"
143.     assert latex(~(x & y)) == r"\neg \left(x \wedge y\right)"
144. 
145.     assert latex(~x, symbol_names={x: "x_i"}) == r"\neg x_i"
146.     assert latex(x & y, symbol_names={x: "x_i", y: "y_i"}) == \
147.         r"x_i \wedge y_i"
148.     assert latex(x & y & z, symbol_names={x: "x_i", y: "y_i", z: "z_i"}) == \
149.         r"x_i \wedge y_i \wedge z_i"
150.     assert latex(x | y, symbol_names={x: "x_i", y: "y_i"}) == r"x_i \vee y_i"
151.     assert latex(x | y | z, symbol_names={x: "x_i", y: "y_i", z: "z_i"}) == \
152.         r"x_i \vee y_i \vee z_i"
153.     assert latex((x & y) | z, symbol_names={x: "x_i", y: "y_i", z: "z_i"}) == \
154.         r"z_i \vee \left(x_i \wedge y_i\right)"
155.     assert latex(Implies(x, y), symbol_names={x: "x_i", y: "y_i"}) == \
156.         r"x_i \Rightarrow y_i"
157. 
158.     p = Symbol('p', positive=True)
159.     assert latex(exp(-p)*log(p)) == r"e^{- p} \log{\left(p \right)}"
160. 
161. 
162. def test_latex_builtins():
163.     assert latex(True) == r"\text{True}"
164.     assert latex(False) == r"\text{False}"
165.     assert latex(None) == r"\text{None}"
166.     assert latex(true) == r"\text{True}"
167.     assert latex(false) == r'\text{False}'
168. 
169. 
170. def test_latex_SingularityFunction():
171.     assert latex(SingularityFunction(x, 4, 5)) == \
172.         r"{\left\langle x - 4 \right\rangle}^{5}"
173.     assert latex(SingularityFunction(x, -3, 4)) == \
174.         r"{\left\langle x + 3 \right\rangle}^{4}"
175.     assert latex(SingularityFunction(x, 0, 4)) == \
176.         r"{\left\langle x \right\rangle}^{4}"
177.     assert latex(SingularityFunction(x, a, n)) == \
178.         r"{\left\langle - a + x \right\rangle}^{n}"
179.     assert latex(SingularityFunction(x, 4, -2)) == \
180.         r"{\left\langle x - 4 \right\rangle}^{-2}"
181.     assert latex(SingularityFunction(x, 4, -1)) == \
182.         r"{\left\langle x - 4 \right\rangle}^{-1}"
183. 
184. 
185. def test_latex_cycle():
186.     assert latex(Cycle(1, 2, 4)) == r"\left( 1\; 2\; 4\right)"
187.     assert latex(Cycle(1, 2)(4, 5, 6)) == \
188.         r"\left( 1\; 2\right)\left( 4\; 5\; 6\right)"
189.     assert latex(Cycle()) == r"\left( \right)"
190. 
191. 
192. def test_latex_permutation():
193.     assert latex(Permutation(1, 2, 4)) == r"\left( 1\; 2\; 4\right)"
194.     assert latex(Permutation(1, 2)(4, 5, 6)) == \
195.         r"\left( 1\; 2\right)\left( 4\; 5\; 6\right)"
196.     assert latex(Permutation()) == r"\left( \right)"
197.     assert latex(Permutation(2, 4)*Permutation(5)) == \
198.         r"\left( 2\; 4\right)\left( 5\right)"
199.     assert latex(Permutation(5)) == r"\left( 5\right)"
200. 
201. 
202. def test_latex_Float():
203.     assert latex(Float(1.0e100)) == r"1.0 \cdot 10^{100}"
204.     assert latex(Float(1.0e-100)) == r"1.0 \cdot 10^{-100}"
205.     assert latex(Float(1.0e-100), mul_symbol="times") == \
206.         r"1.0 \times 10^{-100}"
207. 
208. 
209. def test_latex_vector_expressions():
210.     A = CoordSys3D('A')
211. 
212.     assert latex(Cross(A.i, A.j*A.x*3+A.k)) == \
213.         r"\mathbf{\hat{i}_{A}} \times \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}} + \mathbf{\hat{k}_{A}}\right)"
214.     assert latex(Cross(A.i, A.j)) == \
215.         r"\mathbf{\hat{i}_{A}} \times \mathbf{\hat{j}_{A}}"
216.     assert latex(x*Cross(A.i, A.j)) == \
217.         r"x \left(\mathbf{\hat{i}_{A}} \times \mathbf{\hat{j}_{A}}\right)"
218.     assert latex(Cross(x*A.i, A.j)) == \
219.         r'- \mathbf{\hat{j}_{A}} \times \left((x)\mathbf{\hat{i}_{A}}\right)'
220. 
221.     assert latex(Curl(3*A.x*A.j)) == \
222.         r"\nabla\times \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)"
223.     assert latex(Curl(3*A.x*A.j+A.i)) == \
224.         r"\nabla\times \left(\mathbf{\hat{i}_{A}} + (3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)"
225.     assert latex(Curl(3*x*A.x*A.j)) == \
226.         r"\nabla\times \left((3 \mathbf{{x}_{A}} x)\mathbf{\hat{j}_{A}}\right)"
227.     assert latex(x*Curl(3*A.x*A.j)) == \
228.         r"x \left(\nabla\times \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)\right)"
229. 
230.     assert latex(Divergence(3*A.x*A.j+A.i)) == \
231.         r"\nabla\cdot \left(\mathbf{\hat{i}_{A}} + (3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)"
232.     assert latex(Divergence(3*A.x*A.j)) == \
233.         r"\nabla\cdot \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)"
234.     assert latex(x*Divergence(3*A.x*A.j)) == \
235.         r"x \left(\nabla\cdot \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}}\right)\right)"
236. 
237.     assert latex(Dot(A.i, A.j*A.x*3+A.k)) == \
238.         r"\mathbf{\hat{i}_{A}} \cdot \left((3 \mathbf{{x}_{A}})\mathbf{\hat{j}_{A}} + \mathbf{\hat{k}_{A}}\right)"
239.     assert latex(Dot(A.i, A.j)) == \
240.         r"\mathbf{\hat{i}_{A}} \cdot \mathbf{\hat{j}_{A}}"
241.     assert latex(Dot(x*A.i, A.j)) == \
242.         r"\mathbf{\hat{j}_{A}} \cdot \left((x)\mathbf{\hat{i}_{A}}\right)"
243.     assert latex(x*Dot(A.i, A.j)) == \
244.         r"x \left(\mathbf{\hat{i}_{A}} \cdot \mathbf{\hat{j}_{A}}\right)"
245. 
246.     assert latex(Gradient(A.x)) == r"\nabla \mathbf{{x}_{A}}"
247.     assert latex(Gradient(A.x + 3*A.y)) == \
248.         r"\nabla \left(\mathbf{{x}_{A}} + 3 \mathbf{{y}_{A}}\right)"
249.     assert latex(x*Gradient(A.x)) == r"x \left(\nabla \mathbf{{x}_{A}}\right)"
250.     assert latex(Gradient(x*A.x)) == r"\nabla \left(\mathbf{{x}_{A}} x\right)"
251. 
252.     assert latex(Laplacian(A.x)) == r"\triangle \mathbf{{x}_{A}}"
253.     assert latex(Laplacian(A.x + 3*A.y)) == \
254.         r"\triangle \left(\mathbf{{x}_{A}} + 3 \mathbf{{y}_{A}}\right)"
255.     assert latex(x*Laplacian(A.x)) == r"x \left(\triangle \mathbf{{x}_{A}}\right)"
256.     assert latex(Laplacian(x*A.x)) == r"\triangle \left(\mathbf{{x}_{A}} x\right)"
257. 
258. def test_latex_symbols():
259.     Gamma, lmbda, rho = symbols('Gamma, lambda, rho')
260.     tau, Tau, TAU, taU = symbols('tau, Tau, TAU, taU')
261.     assert latex(tau) == r"\tau"
262.     assert latex(Tau) == "T"
263.     assert latex(TAU) == r"\tau"
264.     assert latex(taU) == r"\tau"
265.     # Check that all capitalized greek letters are handled explicitly
266.     capitalized_letters = set(l.capitalize() for l in greek_letters_set)
267.     assert len(capitalized_letters - set(tex_greek_dictionary.keys())) == 0
268.     assert latex(Gamma + lmbda) == r"\Gamma + \lambda"
269.     assert latex(Gamma * lmbda) == r"\Gamma \lambda"
270.     assert latex(Symbol('q1')) == r"q_{1}"
271.     assert latex(Symbol('q21')) == r"q_{21}"
272.     assert latex(Symbol('epsilon0')) == r"\epsilon_{0}"
273.     assert latex(Symbol('omega1')) == r"\omega_{1}"
274.     assert latex(Symbol('91')) == r"91"
275.     assert latex(Symbol('alpha_new')) == r"\alpha_{new}"
276.     assert latex(Symbol('C^orig')) == r"C^{orig}"
277.     assert latex(Symbol('x^alpha')) == r"x^{\alpha}"
278.     assert latex(Symbol('beta^alpha')) == r"\beta^{\alpha}"
279.     assert latex(Symbol('e^Alpha')) == r"e^{A}"
280.     assert latex(Symbol('omega_alpha^beta')) == r"\omega^{\beta}_{\alpha}"
281.     assert latex(Symbol('omega') ** Symbol('beta')) == r"\omega^{\beta}"
282. 
283. 
284. @XFAIL
285. def test_latex_symbols_failing():
286.     rho, mass, volume = symbols('rho, mass, volume')
287.     assert latex(
288.         volume * rho == mass) == r"\rho \mathrm{volume} = \mathrm{mass}"
289.     assert latex(volume / mass * rho == 1) == \
290.         r"\rho \mathrm{volume} {\mathrm{mass}}^{(-1)} = 1"
291.     assert latex(mass**3 * volume**3) == \
292.         r"{\mathrm{mass}}^{3} \cdot {\mathrm{volume}}^{3}"
293. 
294. 
295. def test_latex_functions():
296.     assert latex(exp(x)) == "e^{x}"
297.     assert latex(exp(1) + exp(2)) == "e + e^{2}"
298. 
299.     f = Function('f')
300.     assert latex(f(x)) == r'f{\left(x \right)}'
301.     assert latex(f) == r'f'
302. 
303.     g = Function('g')
304.     assert latex(g(x, y)) == r'g{\left(x,y \right)}'
305.     assert latex(g) == r'g'
306. 
307.     h = Function('h')
308.     assert latex(h(x, y, z)) == r'h{\left(x,y,z \right)}'
309.     assert latex(h) == r'h'
310. 
311.     Li = Function('Li')
312.     assert latex(Li) == r'\operatorname{Li}'
313.     assert latex(Li(x)) == r'\operatorname{Li}{\left(x \right)}'
314. 
315.     mybeta = Function('beta')
316.     # not to be confused with the beta function
317.     assert latex(mybeta(x, y, z)) == r"\beta{\left(x,y,z \right)}"
318.     assert latex(beta(x, y)) == r'\operatorname{B}\left(x, y\right)'
319.     assert latex(beta(x, y)**2) == r'\operatorname{B}^{2}\left(x, y\right)'
320.     assert latex(mybeta(x)) == r"\beta{\left(x \right)}"
321.     assert latex(mybeta) == r"\beta"
322. 
323.     g = Function('gamma')
324.     # not to be confused with the gamma function
325.     assert latex(g(x, y, z)) == r"\gamma{\left(x,y,z \right)}"
326.     assert latex(g(x)) == r"\gamma{\left(x \right)}"
327.     assert latex(g) == r"\gamma"
328. 
329.     a1 = Function('a_1')
330. 
331.     assert latex(a1) == r"\operatorname{a_{1}}"
332.     assert latex(a1(x)) == r"\operatorname{a_{1}}{\left(x \right)}"
333. 
334.     # issue 5868
335.     omega1 = Function('omega1')
336.     assert latex(omega1) == r"\omega_{1}"
337.     assert latex(omega1(x)) == r"\omega_{1}{\left(x \right)}"
338. 
339.     assert latex(sin(x)) == r"\sin{\left(x \right)}"
340.     assert latex(sin(x), fold_func_brackets=True) == r"\sin {x}"
341.     assert latex(sin(2*x**2), fold_func_brackets=True) == \
342.         r"\sin {2 x^{2}}"
343.     assert latex(sin(x**2), fold_func_brackets=True) == \
344.         r"\sin {x^{2}}"
345. 
346.     assert latex(asin(x)**2) == r"\operatorname{asin}^{2}{\left(x \right)}"
347.     assert latex(asin(x)**2, inv_trig_style="full") == \
348.         r"\arcsin^{2}{\left(x \right)}"
349.     assert latex(asin(x)**2, inv_trig_style="power") == \
350.         r"\sin^{-1}{\left(x \right)}^{2}"
351.     assert latex(asin(x**2), inv_trig_style="power",
352.                  fold_func_brackets=True) == \
353.         r"\sin^{-1} {x^{2}}"
354.     assert latex(acsc(x), inv_trig_style="full") == \
355.         r"\operatorname{arccsc}{\left(x \right)}"
356. 
357.     assert latex(factorial(k)) == r"k!"
358.     assert latex(factorial(-k)) == r"\left(- k\right)!"
359.     assert latex(factorial(k)**2) == r"k!^{2}"
360. 
361.     assert latex(subfactorial(k)) == r"!k"
362.     assert latex(subfactorial(-k)) == r"!\left(- k\right)"
363.     assert latex(subfactorial(k)**2) == r"\left(!k\right)^{2}"
364. 
365.     assert latex(factorial2(k)) == r"k!!"
366.     assert latex(factorial2(-k)) == r"\left(- k\right)!!"
367.     assert latex(factorial2(k)**2) == r"k!!^{2}"
368. 
369.     assert latex(binomial(2, k)) == r"{\binom{2}{k}}"
370.     assert latex(binomial(2, k)**2) == r"{\binom{2}{k}}^{2}"
371. 
372.     assert latex(FallingFactorial(3, k)) == r"{\left(3\right)}_{k}"
373.     assert latex(RisingFactorial(3, k)) == r"{3}^{\left(k\right)}"
374. 
375.     assert latex(floor(x)) == r"\left\lfloor{x}\right\rfloor"
376.     assert latex(ceiling(x)) == r"\left\lceil{x}\right\rceil"
377.     assert latex(frac(x)) == r"\operatorname{frac}{\left(x\right)}"
378.     assert latex(floor(x)**2) == r"\left\lfloor{x}\right\rfloor^{2}"
379.     assert latex(ceiling(x)**2) == r"\left\lceil{x}\right\rceil^{2}"
380.     assert latex(frac(x)**2) == r"\operatorname{frac}{\left(x\right)}^{2}"
381. 
382.     assert latex(Min(x, 2, x**3)) == r"\min\left(2, x, x^{3}\right)"
383.     assert latex(Min(x, y)**2) == r"\min\left(x, y\right)^{2}"
384.     assert latex(Max(x, 2, x**3)) == r"\max\left(2, x, x^{3}\right)"
385.     assert latex(Max(x, y)**2) == r"\max\left(x, y\right)^{2}"
386.     assert latex(Abs(x)) == r"\left|{x}\right|"
387.     assert latex(Abs(x)**2) == r"\left|{x}\right|^{2}"
388.     assert latex(re(x)) == r"\operatorname{re}{\left(x\right)}"
389.     assert latex(re(x + y)) == \
390.         r"\operatorname{re}{\left(x\right)} + \operatorname{re}{\left(y\right)}"
391.     assert latex(im(x)) == r"\operatorname{im}{\left(x\right)}"
392.     assert latex(conjugate(x)) == r"\overline{x}"
393.     assert latex(conjugate(x)**2) == r"\overline{x}^{2}"
394.     assert latex(conjugate(x**2)) == r"\overline{x}^{2}"
395.     assert latex(gamma(x)) == r"\Gamma\left(x\right)"
396.     w = Wild('w')
397.     assert latex(gamma(w)) == r"\Gamma\left(w\right)"
398.     assert latex(Order(x)) == r"O\left(x\right)"
399.     assert latex(Order(x, x)) == r"O\left(x\right)"
400.     assert latex(Order(x, (x, 0))) == r"O\left(x\right)"
401.     assert latex(Order(x, (x, oo))) == r"O\left(x; x\rightarrow \infty\right)"
402.     assert latex(Order(x - y, (x, y))) == \
403.         r"O\left(x - y; x\rightarrow y\right)"
404.     assert latex(Order(x, x, y)) == \
405.         r"O\left(x; \left( x, \  y\right)\rightarrow \left( 0, \  0\right)\right)"
406.     assert latex(Order(x, x, y)) == \
407.         r"O\left(x; \left( x, \  y\right)\rightarrow \left( 0, \  0\right)\right)"
408.     assert latex(Order(x, (x, oo), (y, oo))) == \
409.         r"O\left(x; \left( x, \  y\right)\rightarrow \left( \infty, \  \infty\right)\right)"
410.     assert latex(lowergamma(x, y)) == r'\gamma\left(x, y\right)'
411.     assert latex(lowergamma(x, y)**2) == r'\gamma^{2}\left(x, y\right)'
412.     assert latex(uppergamma(x, y)) == r'\Gamma\left(x, y\right)'
413.     assert latex(uppergamma(x, y)**2) == r'\Gamma^{2}\left(x, y\right)'
414. 
415.     assert latex(cot(x)) == r'\cot{\left(x \right)}'
416.     assert latex(coth(x)) == r'\coth{\left(x \right)}'
417.     assert latex(re(x)) == r'\operatorname{re}{\left(x\right)}'
418.     assert latex(im(x)) == r'\operatorname{im}{\left(x\right)}'
419.     assert latex(root(x, y)) == r'x^{\frac{1}{y}}'
420.     assert latex(arg(x)) == r'\arg{\left(x \right)}'
421. 
422.     assert latex(zeta(x)) == r"\zeta\left(x\right)"
423.     assert latex(zeta(x)**2) == r"\zeta^{2}\left(x\right)"
424.     assert latex(zeta(x, y)) == r"\zeta\left(x, y\right)"
425.     assert latex(zeta(x, y)**2) == r"\zeta^{2}\left(x, y\right)"
426.     assert latex(dirichlet_eta(x)) == r"\eta\left(x\right)"
427.     assert latex(dirichlet_eta(x)**2) == r"\eta^{2}\left(x\right)"
428.     assert latex(polylog(x, y)) == r"\operatorname{Li}_{x}\left(y\right)"
429.     assert latex(
430.         polylog(x, y)**2) == r"\operatorname{Li}_{x}^{2}\left(y\right)"
431.     assert latex(lerchphi(x, y, n)) == r"\Phi\left(x, y, n\right)"
432.     assert latex(lerchphi(x, y, n)**2) == r"\Phi^{2}\left(x, y, n\right)"
433.     assert latex(stieltjes(x)) == r"\gamma_{x}"
434.     assert latex(stieltjes(x)**2) == r"\gamma_{x}^{2}"
435.     assert latex(stieltjes(x, y)) == r"\gamma_{x}\left(y\right)"
436.     assert latex(stieltjes(x, y)**2) == r"\gamma_{x}\left(y\right)^{2}"
437. 
438.     assert latex(elliptic_k(z)) == r"K\left(z\right)"
439.     assert latex(elliptic_k(z)**2) == r"K^{2}\left(z\right)"
440.     assert latex(elliptic_f(x, y)) == r"F\left(x\middle| y\right)"
441.     assert latex(elliptic_f(x, y)**2) == r"F^{2}\left(x\middle| y\right)"
442.     assert latex(elliptic_e(x, y)) == r"E\left(x\middle| y\right)"
443.     assert latex(elliptic_e(x, y)**2) == r"E^{2}\left(x\middle| y\right)"
444.     assert latex(elliptic_e(z)) == r"E\left(z\right)"
445.     assert latex(elliptic_e(z)**2) == r"E^{2}\left(z\right)"
446.     assert latex(elliptic_pi(x, y, z)) == r"\Pi\left(x; y\middle| z\right)"
447.     assert latex(elliptic_pi(x, y, z)**2) == \
448.         r"\Pi^{2}\left(x; y\middle| z\right)"
449.     assert latex(elliptic_pi(x, y)) == r"\Pi\left(x\middle| y\right)"
450.     assert latex(elliptic_pi(x, y)**2) == r"\Pi^{2}\left(x\middle| y\right)"
451. 
452.     assert latex(Ei(x)) == r'\operatorname{Ei}{\left(x \right)}'
453.     assert latex(Ei(x)**2) == r'\operatorname{Ei}^{2}{\left(x \right)}'
454.     assert latex(expint(x, y)) == r'\operatorname{E}_{x}\left(y\right)'
455.     assert latex(expint(x, y)**2) == r'\operatorname{E}_{x}^{2}\left(y\right)'
456.     assert latex(Shi(x)**2) == r'\operatorname{Shi}^{2}{\left(x \right)}'
457.     assert latex(Si(x)**2) == r'\operatorname{Si}^{2}{\left(x \right)}'
458.     assert latex(Ci(x)**2) == r'\operatorname{Ci}^{2}{\left(x \right)}'
459.     assert latex(Chi(x)**2) == r'\operatorname{Chi}^{2}\left(x\right)'
460.     assert latex(Chi(x)) == r'\operatorname{Chi}\left(x\right)'
461.     assert latex(jacobi(n, a, b, x)) == \
462.         r'P_{n}^{\left(a,b\right)}\left(x\right)'
463.     assert latex(jacobi(n, a, b, x)**2) == \
464.         r'\left(P_{n}^{\left(a,b\right)}\left(x\right)\right)^{2}'
465.     assert latex(gegenbauer(n, a, x)) == \
466.         r'C_{n}^{\left(a\right)}\left(x\right)'
467.     assert latex(gegenbauer(n, a, x)**2) == \
468.         r'\left(C_{n}^{\left(a\right)}\left(x\right)\right)^{2}'
469.     assert latex(chebyshevt(n, x)) == r'T_{n}\left(x\right)'
470.     assert latex(chebyshevt(n, x)**2) == \
471.         r'\left(T_{n}\left(x\right)\right)^{2}'
472.     assert latex(chebyshevu(n, x)) == r'U_{n}\left(x\right)'
473.     assert latex(chebyshevu(n, x)**2) == \
474.         r'\left(U_{n}\left(x\right)\right)^{2}'
475.     assert latex(legendre(n, x)) == r'P_{n}\left(x\right)'
476.     assert latex(legendre(n, x)**2) == r'\left(P_{n}\left(x\right)\right)^{2}'
477.     assert latex(assoc_legendre(n, a, x)) == \
478.         r'P_{n}^{\left(a\right)}\left(x\right)'
479.     assert latex(assoc_legendre(n, a, x)**2) == \
480.         r'\left(P_{n}^{\left(a\right)}\left(x\right)\right)^{2}'
481.     assert latex(laguerre(n, x)) == r'L_{n}\left(x\right)'
482.     assert latex(laguerre(n, x)**2) == r'\left(L_{n}\left(x\right)\right)^{2}'
483.     assert latex(assoc_laguerre(n, a, x)) == \
484.         r'L_{n}^{\left(a\right)}\left(x\right)'
485.     assert latex(assoc_laguerre(n, a, x)**2) == \
486.         r'\left(L_{n}^{\left(a\right)}\left(x\right)\right)^{2}'
487.     assert latex(hermite(n, x)) == r'H_{n}\left(x\right)'
488.     assert latex(hermite(n, x)**2) == r'\left(H_{n}\left(x\right)\right)^{2}'
489. 
490.     theta = Symbol("theta", real=True)
491.     phi = Symbol("phi", real=True)
492.     assert latex(Ynm(n, m, theta, phi)) == r'Y_{n}^{m}\left(\theta,\phi\right)'
493.     assert latex(Ynm(n, m, theta, phi)**3) == \
494.         r'\left(Y_{n}^{m}\left(\theta,\phi\right)\right)^{3}'
495.     assert latex(Znm(n, m, theta, phi)) == r'Z_{n}^{m}\left(\theta,\phi\right)'
496.     assert latex(Znm(n, m, theta, phi)**3) == \
497.         r'\left(Z_{n}^{m}\left(\theta,\phi\right)\right)^{3}'
498. 
499.     # Test latex printing of function names with "_"
500.     assert latex(polar_lift(0)) == \

File: sympy/printing/tests/test_latex.py
Line number range: 500 - 1000
Content:
500.     assert latex(polar_lift(0)) == \
501.         r"\operatorname{polar\_lift}{\left(0 \right)}"
502.     assert latex(polar_lift(0)**3) == \
503.         r"\operatorname{polar\_lift}^{3}{\left(0 \right)}"
504. 
505.     assert latex(totient(n)) == r'\phi\left(n\right)'
506.     assert latex(totient(n) ** 2) == r'\left(\phi\left(n\right)\right)^{2}'
507. 
508.     assert latex(reduced_totient(n)) == r'\lambda\left(n\right)'
509.     assert latex(reduced_totient(n) ** 2) == \
510.         r'\left(\lambda\left(n\right)\right)^{2}'
511. 
512.     assert latex(divisor_sigma(x)) == r"\sigma\left(x\right)"
513.     assert latex(divisor_sigma(x)**2) == r"\sigma^{2}\left(x\right)"
514.     assert latex(divisor_sigma(x, y)) == r"\sigma_y\left(x\right)"
515.     assert latex(divisor_sigma(x, y)**2) == r"\sigma^{2}_y\left(x\right)"
516. 
517.     assert latex(udivisor_sigma(x)) == r"\sigma^*\left(x\right)"
518.     assert latex(udivisor_sigma(x)**2) == r"\sigma^*^{2}\left(x\right)"
519.     assert latex(udivisor_sigma(x, y)) == r"\sigma^*_y\left(x\right)"
520.     assert latex(udivisor_sigma(x, y)**2) == r"\sigma^*^{2}_y\left(x\right)"
521. 
522.     assert latex(primenu(n)) == r'\nu\left(n\right)'
523.     assert latex(primenu(n) ** 2) == r'\left(\nu\left(n\right)\right)^{2}'
524. 
525.     assert latex(primeomega(n)) == r'\Omega\left(n\right)'
526.     assert latex(primeomega(n) ** 2) == \
527.         r'\left(\Omega\left(n\right)\right)^{2}'
528. 
529.     assert latex(LambertW(n)) == r'W\left(n\right)'
530.     assert latex(LambertW(n, -1)) == r'W_{-1}\left(n\right)'
531.     assert latex(LambertW(n, k)) == r'W_{k}\left(n\right)'
532. 
533.     assert latex(Mod(x, 7)) == r'x\bmod{7}'
534.     assert latex(Mod(x + 1, 7)) == r'\left(x + 1\right)\bmod{7}'
535.     assert latex(Mod(2 * x, 7)) == r'2 x\bmod{7}'
536.     assert latex(Mod(x, 7) + 1) == r'\left(x\bmod{7}\right) + 1'
537.     assert latex(2 * Mod(x, 7)) == r'2 \left(x\bmod{7}\right)'
538. 
539.     # some unknown function name should get rendered with \operatorname
540.     fjlkd = Function('fjlkd')
541.     assert latex(fjlkd(x)) == r'\operatorname{fjlkd}{\left(x \right)}'
542.     # even when it is referred to without an argument
543.     assert latex(fjlkd) == r'\operatorname{fjlkd}'
544. 
545. 
546. # test that notation passes to subclasses of the same name only
547. def test_function_subclass_different_name():
548.     class mygamma(gamma):
549.         pass
550.     assert latex(mygamma) == r"\operatorname{mygamma}"
551.     assert latex(mygamma(x)) == r"\operatorname{mygamma}{\left(x \right)}"
552. 
553. 
554. def test_hyper_printing():
555.     from sympy import pi
556.     from sympy.abc import x, z
557. 
558.     assert latex(meijerg(Tuple(pi, pi, x), Tuple(1),
559.                          (0, 1), Tuple(1, 2, 3/pi), z)) == \
560.         r'{G_{4, 5}^{2, 3}\left(\begin{matrix} \pi, \pi, x & 1 \\0, 1 & 1, 2, '\
561.         r'\frac{3}{\pi} \end{matrix} \middle| {z} \right)}'
562.     assert latex(meijerg(Tuple(), Tuple(1), (0,), Tuple(), z)) == \
563.         r'{G_{1, 1}^{1, 0}\left(\begin{matrix}  & 1 \\0 &  \end{matrix} \middle| {z} \right)}'
564.     assert latex(hyper((x, 2), (3,), z)) == \
565.         r'{{}_{2}F_{1}\left(\begin{matrix} x, 2 ' \
566.         r'\\ 3 \end{matrix}\middle| {z} \right)}'
567.     assert latex(hyper(Tuple(), Tuple(1), z)) == \
568.         r'{{}_{0}F_{1}\left(\begin{matrix}  ' \
569.         r'\\ 1 \end{matrix}\middle| {z} \right)}'
570. 
571. 
572. def test_latex_bessel():
573.     from sympy.functions.special.bessel import (besselj, bessely, besseli,
574.                                                 besselk, hankel1, hankel2,
575.                                                 jn, yn, hn1, hn2)
576.     from sympy.abc import z
577.     assert latex(besselj(n, z**2)**k) == r'J^{k}_{n}\left(z^{2}\right)'
578.     assert latex(bessely(n, z)) == r'Y_{n}\left(z\right)'
579.     assert latex(besseli(n, z)) == r'I_{n}\left(z\right)'
580.     assert latex(besselk(n, z)) == r'K_{n}\left(z\right)'
581.     assert latex(hankel1(n, z**2)**2) == \
582.         r'\left(H^{(1)}_{n}\left(z^{2}\right)\right)^{2}'
583.     assert latex(hankel2(n, z)) == r'H^{(2)}_{n}\left(z\right)'
584.     assert latex(jn(n, z)) == r'j_{n}\left(z\right)'
585.     assert latex(yn(n, z)) == r'y_{n}\left(z\right)'
586.     assert latex(hn1(n, z)) == r'h^{(1)}_{n}\left(z\right)'
587.     assert latex(hn2(n, z)) == r'h^{(2)}_{n}\left(z\right)'
588. 
589. 
590. def test_latex_fresnel():
591.     from sympy.functions.special.error_functions import (fresnels, fresnelc)
592.     from sympy.abc import z
593.     assert latex(fresnels(z)) == r'S\left(z\right)'
594.     assert latex(fresnelc(z)) == r'C\left(z\right)'
595.     assert latex(fresnels(z)**2) == r'S^{2}\left(z\right)'
596.     assert latex(fresnelc(z)**2) == r'C^{2}\left(z\right)'
597. 
598. 
599. def test_latex_brackets():
600.     assert latex((-1)**x) == r"\left(-1\right)^{x}"
601. 
602. 
603. def test_latex_indexed():
604.     Psi_symbol = Symbol('Psi_0', complex=True, real=False)
605.     Psi_indexed = IndexedBase(Symbol('Psi', complex=True, real=False))
606.     symbol_latex = latex(Psi_symbol * conjugate(Psi_symbol))
607.     indexed_latex = latex(Psi_indexed[0] * conjugate(Psi_indexed[0]))
608.     # \\overline{{\\Psi}_{0}} {\\Psi}_{0}  vs.  \\Psi_{0} \\overline{\\Psi_{0}}
609.     assert symbol_latex == '\\Psi_{0} \\overline{\\Psi_{0}}'
610.     assert indexed_latex == '\\overline{{\\Psi}_{0}} {\\Psi}_{0}'
611. 
612.     # Symbol('gamma') gives r'\gamma'
613.     assert latex(Indexed('x1', Symbol('i'))) == '{x_{1}}_{i}'
614.     assert latex(IndexedBase('gamma')) == r'\gamma'
615.     assert latex(IndexedBase('a b')) == 'a b'
616.     assert latex(IndexedBase('a_b')) == 'a_{b}'
617. 
618. 
619. def test_latex_derivatives():
620.     # regular "d" for ordinary derivatives
621.     assert latex(diff(x**3, x, evaluate=False)) == \
622.         r"\frac{d}{d x} x^{3}"
623.     assert latex(diff(sin(x) + x**2, x, evaluate=False)) == \
624.         r"\frac{d}{d x} \left(x^{2} + \sin{\left(x \right)}\right)"
625.     assert latex(diff(diff(sin(x) + x**2, x, evaluate=False), evaluate=False))\
626.         == \
627.         r"\frac{d^{2}}{d x^{2}} \left(x^{2} + \sin{\left(x \right)}\right)"
628.     assert latex(diff(diff(diff(sin(x) + x**2, x, evaluate=False), evaluate=False), evaluate=False)) == \
629.         r"\frac{d^{3}}{d x^{3}} \left(x^{2} + \sin{\left(x \right)}\right)"
630. 
631.     # \partial for partial derivatives
632.     assert latex(diff(sin(x * y), x, evaluate=False)) == \
633.         r"\frac{\partial}{\partial x} \sin{\left(x y \right)}"
634.     assert latex(diff(sin(x * y) + x**2, x, evaluate=False)) == \
635.         r"\frac{\partial}{\partial x} \left(x^{2} + \sin{\left(x y \right)}\right)"
636.     assert latex(diff(diff(sin(x*y) + x**2, x, evaluate=False), x, evaluate=False)) == \
637.         r"\frac{\partial^{2}}{\partial x^{2}} \left(x^{2} + \sin{\left(x y \right)}\right)"
638.     assert latex(diff(diff(diff(sin(x*y) + x**2, x, evaluate=False), x, evaluate=False), x, evaluate=False)) == \
639.         r"\frac{\partial^{3}}{\partial x^{3}} \left(x^{2} + \sin{\left(x y \right)}\right)"
640. 
641.     # mixed partial derivatives
642.     f = Function("f")
643.     assert latex(diff(diff(f(x, y), x, evaluate=False), y, evaluate=False)) == \
644.         r"\frac{\partial^{2}}{\partial y\partial x} " + latex(f(x, y))
645. 
646.     assert latex(diff(diff(diff(f(x, y), x, evaluate=False), x, evaluate=False), y, evaluate=False)) == \
647.         r"\frac{\partial^{3}}{\partial y\partial x^{2}} " + latex(f(x, y))
648. 
649.     # use ordinary d when one of the variables has been integrated out
650.     assert latex(diff(Integral(exp(-x*y), (x, 0, oo)), y, evaluate=False)) == \
651.         r"\frac{d}{d y} \int\limits_{0}^{\infty} e^{- x y}\, dx"
652. 
653.     # Derivative wrapped in power:
654.     assert latex(diff(x, x, evaluate=False)**2) == \
655.         r"\left(\frac{d}{d x} x\right)^{2}"
656. 
657.     assert latex(diff(f(x), x)**2) == \
658.         r"\left(\frac{d}{d x} f{\left(x \right)}\right)^{2}"
659. 
660.     assert latex(diff(f(x), (x, n))) == \
661.         r"\frac{d^{n}}{d x^{n}} f{\left(x \right)}"
662. 
663.     x1 = Symbol('x1')
664.     x2 = Symbol('x2')
665.     assert latex(diff(f(x1, x2), x1)) == r'\frac{\partial}{\partial x_{1}} f{\left(x_{1},x_{2} \right)}'
666. 
667.     n1 = Symbol('n1')
668.     assert latex(diff(f(x), (x, n1))) ==  r'\frac{d^{n_{1}}}{d x^{n_{1}}} f{\left(x \right)}'
669. 
670.     n2 = Symbol('n2')
671.     assert latex(diff(f(x), (x, Max(n1, n2)))) == \
672.         r'\frac{d^{\max\left(n_{1}, n_{2}\right)}}{d x^{\max\left(n_{1}, n_{2}\right)}} f{\left(x \right)}'
673. 
674. 
675. def test_latex_subs():
676.     assert latex(Subs(x*y, (
677.         x, y), (1, 2))) == r'\left. x y \right|_{\substack{ x=1\\ y=2 }}'
678. 
679. 
680. def test_latex_integrals():
681.     assert latex(Integral(log(x), x)) == r"\int \log{\left(x \right)}\, dx"
682.     assert latex(Integral(x**2, (x, 0, 1))) == \
683.         r"\int\limits_{0}^{1} x^{2}\, dx"
684.     assert latex(Integral(x**2, (x, 10, 20))) == \
685.         r"\int\limits_{10}^{20} x^{2}\, dx"
686.     assert latex(Integral(y*x**2, (x, 0, 1), y)) == \
687.         r"\int\int\limits_{0}^{1} x^{2} y\, dx\, dy"
688.     assert latex(Integral(y*x**2, (x, 0, 1), y), mode='equation*') == \
689.         r"\begin{equation*}\int\int\limits_{0}^{1} x^{2} y\, dx\, dy\end{equation*}"
690.     assert latex(Integral(y*x**2, (x, 0, 1), y), mode='equation*', itex=True) \
691.         == r"$$\int\int_{0}^{1} x^{2} y\, dx\, dy$$"
692.     assert latex(Integral(x, (x, 0))) == r"\int\limits^{0} x\, dx"
693.     assert latex(Integral(x*y, x, y)) == r"\iint x y\, dx\, dy"
694.     assert latex(Integral(x*y*z, x, y, z)) == r"\iiint x y z\, dx\, dy\, dz"
695.     assert latex(Integral(x*y*z*t, x, y, z, t)) == \
696.         r"\iiiint t x y z\, dx\, dy\, dz\, dt"
697.     assert latex(Integral(x, x, x, x, x, x, x)) == \
698.         r"\int\int\int\int\int\int x\, dx\, dx\, dx\, dx\, dx\, dx"
699.     assert latex(Integral(x, x, y, (z, 0, 1))) == \
700.         r"\int\limits_{0}^{1}\int\int x\, dx\, dy\, dz"
701. 
702.     # fix issue #10806
703.     assert latex(Integral(z, z)**2) == r"\left(\int z\, dz\right)^{2}"
704.     assert latex(Integral(x + z, z)) == r"\int \left(x + z\right)\, dz"
705.     assert latex(Integral(x+z/2, z)) == \
706.         r"\int \left(x + \frac{z}{2}\right)\, dz"
707.     assert latex(Integral(x**y, z)) == r"\int x^{y}\, dz"
708. 
709. 
710. def test_latex_sets():
711.     for s in (frozenset, set):
712.         assert latex(s([x*y, x**2])) == r"\left\{x^{2}, x y\right\}"
713.         assert latex(s(range(1, 6))) == r"\left\{1, 2, 3, 4, 5\right\}"
714.         assert latex(s(range(1, 13))) == \
715.             r"\left\{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12\right\}"
716. 
717.     s = FiniteSet
718.     assert latex(s(*[x*y, x**2])) == r"\left\{x^{2}, x y\right\}"
719.     assert latex(s(*range(1, 6))) == r"\left\{1, 2, 3, 4, 5\right\}"
720.     assert latex(s(*range(1, 13))) == \
721.         r"\left\{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12\right\}"
722. 
723. 
724. def test_latex_SetExpr():
725.     iv = Interval(1, 3)
726.     se = SetExpr(iv)
727.     assert latex(se) == r"SetExpr\left(\left[1, 3\right]\right)"
728. 
729. 
730. def test_latex_Range():
731.     assert latex(Range(1, 51)) == \
732.         r'\left\{1, 2, \ldots, 50\right\}'
733.     assert latex(Range(1, 4)) == r'\left\{1, 2, 3\right\}'
734. 
735.     assert latex(Range(0, 3, 1)) == r'\left\{0, 1, 2\right\}'
736. 
737.     assert latex(Range(0, 30, 1)) == r'\left\{0, 1, \ldots, 29\right\}'
738. 
739.     assert latex(Range(30, 1, -1)) == r'\left\{30, 29, \ldots, 2\right\}'
740. 
741.     assert latex(Range(0, oo, 2)) == r'\left\{0, 2, \ldots\right\}'
742. 
743.     assert latex(Range(oo, -2, -2)) == r'\left\{\ldots, 2, 0\right\}'
744. 
745.     assert latex(Range(-2, -oo, -1)) == \
746.         r'\left\{-2, -3, \ldots\right\}'
747. 
748. 
749. def test_latex_sequences():
750.     s1 = SeqFormula(a**2, (0, oo))
751.     s2 = SeqPer((1, 2))
752. 
753.     latex_str = r'\left[0, 1, 4, 9, \ldots\right]'
754.     assert latex(s1) == latex_str
755. 
756.     latex_str = r'\left[1, 2, 1, 2, \ldots\right]'
757.     assert latex(s2) == latex_str
758. 
759.     s3 = SeqFormula(a**2, (0, 2))
760.     s4 = SeqPer((1, 2), (0, 2))
761. 
762.     latex_str = r'\left[0, 1, 4\right]'
763.     assert latex(s3) == latex_str
764. 
765.     latex_str = r'\left[1, 2, 1\right]'
766.     assert latex(s4) == latex_str
767. 
768.     s5 = SeqFormula(a**2, (-oo, 0))
769.     s6 = SeqPer((1, 2), (-oo, 0))
770. 
771.     latex_str = r'\left[\ldots, 9, 4, 1, 0\right]'
772.     assert latex(s5) == latex_str
773. 
774.     latex_str = r'\left[\ldots, 2, 1, 2, 1\right]'
775.     assert latex(s6) == latex_str
776. 
777.     latex_str = r'\left[1, 3, 5, 11, \ldots\right]'
778.     assert latex(SeqAdd(s1, s2)) == latex_str
779. 
780.     latex_str = r'\left[1, 3, 5\right]'
781.     assert latex(SeqAdd(s3, s4)) == latex_str
782. 
783.     latex_str = r'\left[\ldots, 11, 5, 3, 1\right]'
784.     assert latex(SeqAdd(s5, s6)) == latex_str
785. 
786.     latex_str = r'\left[0, 2, 4, 18, \ldots\right]'
787.     assert latex(SeqMul(s1, s2)) == latex_str
788. 
789.     latex_str = r'\left[0, 2, 4\right]'
790.     assert latex(SeqMul(s3, s4)) == latex_str
791. 
792.     latex_str = r'\left[\ldots, 18, 4, 2, 0\right]'
793.     assert latex(SeqMul(s5, s6)) == latex_str
794. 
795.     # Sequences with symbolic limits, issue 12629
796.     s7 = SeqFormula(a**2, (a, 0, x))
797.     latex_str = r'\left\{a^{2}\right\}_{a=0}^{x}'
798.     assert latex(s7) == latex_str
799. 
800.     b = Symbol('b')
801.     s8 = SeqFormula(b*a**2, (a, 0, 2))
802.     latex_str = r'\left[0, b, 4 b\right]'
803.     assert latex(s8) == latex_str
804. 
805. 
806. def test_latex_FourierSeries():
807.     latex_str = \
808.         r'2 \sin{\left(x \right)} - \sin{\left(2 x \right)} + \frac{2 \sin{\left(3 x \right)}}{3} + \ldots'
809.     assert latex(fourier_series(x, (x, -pi, pi))) == latex_str
810. 
811. 
812. def test_latex_FormalPowerSeries():
813.     latex_str = r'\sum_{k=1}^{\infty} - \frac{\left(-1\right)^{- k} x^{k}}{k}'
814.     assert latex(fps(log(1 + x))) == latex_str
815. 
816. 
817. def test_latex_intervals():
818.     a = Symbol('a', real=True)
819.     assert latex(Interval(0, 0)) == r"\left\{0\right\}"
820.     assert latex(Interval(0, a)) == r"\left[0, a\right]"
821.     assert latex(Interval(0, a, False, False)) == r"\left[0, a\right]"
822.     assert latex(Interval(0, a, True, False)) == r"\left(0, a\right]"
823.     assert latex(Interval(0, a, False, True)) == r"\left[0, a\right)"
824.     assert latex(Interval(0, a, True, True)) == r"\left(0, a\right)"
825. 
826. 
827. def test_latex_AccumuBounds():
828.     a = Symbol('a', real=True)
829.     assert latex(AccumBounds(0, 1)) == r"\left\langle 0, 1\right\rangle"
830.     assert latex(AccumBounds(0, a)) == r"\left\langle 0, a\right\rangle"
831.     assert latex(AccumBounds(a + 1, a + 2)) == \
832.         r"\left\langle a + 1, a + 2\right\rangle"
833. 
834. 
835. def test_latex_emptyset():
836.     assert latex(S.EmptySet) == r"\emptyset"
837. 
838. 
839. def test_latex_universalset():
840.     assert latex(S.UniversalSet) == r"\mathbb{U}"
841. 
842. 
843. def test_latex_commutator():
844.     A = Operator('A')
845.     B = Operator('B')
846.     comm = Commutator(B, A)
847.     assert latex(comm.doit()) == r"- (A B - B A)"
848. 
849. 
850. def test_latex_union():
851.     assert latex(Union(Interval(0, 1), Interval(2, 3))) == \
852.         r"\left[0, 1\right] \cup \left[2, 3\right]"
853.     assert latex(Union(Interval(1, 1), Interval(2, 2), Interval(3, 4))) == \
854.         r"\left\{1, 2\right\} \cup \left[3, 4\right]"
855. 
856. 
857. def test_latex_intersection():
858.     assert latex(Intersection(Interval(0, 1), Interval(x, y))) == \
859.         r"\left[0, 1\right] \cap \left[x, y\right]"
860. 
861. 
862. def test_latex_symmetric_difference():
863.     assert latex(SymmetricDifference(Interval(2, 5), Interval(4, 7),
864.                                      evaluate=False)) == \
865.         r'\left[2, 5\right] \triangle \left[4, 7\right]'
866. 
867. 
868. def test_latex_Complement():
869.     assert latex(Complement(S.Reals, S.Naturals)) == \
870.         r"\mathbb{R} \setminus \mathbb{N}"
871. 
872. 
873. def test_latex_productset():
874.     line = Interval(0, 1)
875.     bigline = Interval(0, 10)
876.     fset = FiniteSet(1, 2, 3)
877.     assert latex(line**2) == r"%s^{2}" % latex(line)
878.     assert latex(line**10) == r"%s^{10}" % latex(line)
879.     assert latex((line * bigline * fset).flatten()) == r"%s \times %s \times %s" % (
880.         latex(line), latex(bigline), latex(fset))
881. 
882. 
883. def test_set_operators_parenthesis():
884.     a, b, c, d = symbols('a:d')
885.     A = FiniteSet(a)
886.     B = FiniteSet(b)
887.     C = FiniteSet(c)
888.     D = FiniteSet(d)
889. 
890.     U1 = Union(A, B, evaluate=False)
891.     U2 = Union(C, D, evaluate=False)
892.     I1 = Intersection(A, B, evaluate=False)
893.     I2 = Intersection(C, D, evaluate=False)
894.     C1 = Complement(A, B, evaluate=False)
895.     C2 = Complement(C, D, evaluate=False)
896.     D1 = SymmetricDifference(A, B, evaluate=False)
897.     D2 = SymmetricDifference(C, D, evaluate=False)
898.     # XXX ProductSet does not support evaluate keyword
899.     P1 = ProductSet(A, B)
900.     P2 = ProductSet(C, D)
901. 
902.     assert latex(Intersection(A, U2, evaluate=False)) == \
903.         '\\left\\{a\\right\\} \\cap ' \
904.         '\\left(\\left\\{c\\right\\} \\cup \\left\\{d\\right\\}\\right)'
905.     assert latex(Intersection(U1, U2, evaluate=False)) == \
906.         '\\left(\\left\\{a\\right\\} \\cup \\left\\{b\\right\\}\\right) ' \
907.         '\\cap \\left(\\left\\{c\\right\\} \\cup \\left\\{d\\right\\}\\right)'
908.     assert latex(Intersection(C1, C2, evaluate=False)) == \
909.         '\\left(\\left\\{a\\right\\} \\setminus ' \
910.         '\\left\\{b\\right\\}\\right) \\cap \\left(\\left\\{c\\right\\} ' \
911.         '\\setminus \\left\\{d\\right\\}\\right)'
912.     assert latex(Intersection(D1, D2, evaluate=False)) == \
913.         '\\left(\\left\\{a\\right\\} \\triangle ' \
914.         '\\left\\{b\\right\\}\\right) \\cap \\left(\\left\\{c\\right\\} ' \
915.         '\\triangle \\left\\{d\\right\\}\\right)'
916.     assert latex(Intersection(P1, P2, evaluate=False)) == \
917.         '\\left(\\left\\{a\\right\\} \\times \\left\\{b\\right\\}\\right) ' \
918.         '\\cap \\left(\\left\\{c\\right\\} \\times ' \
919.         '\\left\\{d\\right\\}\\right)'
920. 
921.     assert latex(Union(A, I2, evaluate=False)) == \
922.         '\\left\\{a\\right\\} \\cup ' \
923.         '\\left(\\left\\{c\\right\\} \\cap \\left\\{d\\right\\}\\right)'
924.     assert latex(Union(I1, I2, evaluate=False)) == \
925.         '\\left(\\left\\{a\\right\\} \\cap ''\\left\\{b\\right\\}\\right) ' \
926.         '\\cup \\left(\\left\\{c\\right\\} \\cap \\left\\{d\\right\\}\\right)'
927.     assert latex(Union(C1, C2, evaluate=False)) == \
928.         '\\left(\\left\\{a\\right\\} \\setminus ' \
929.         '\\left\\{b\\right\\}\\right) \\cup \\left(\\left\\{c\\right\\} ' \
930.         '\\setminus \\left\\{d\\right\\}\\right)'
931.     assert latex(Union(D1, D2, evaluate=False)) == \
932.         '\\left(\\left\\{a\\right\\} \\triangle ' \
933.         '\\left\\{b\\right\\}\\right) \\cup \\left(\\left\\{c\\right\\} ' \
934.         '\\triangle \\left\\{d\\right\\}\\right)'
935.     assert latex(Union(P1, P2, evaluate=False)) == \
936.         '\\left(\\left\\{a\\right\\} \\times \\left\\{b\\right\\}\\right) ' \
937.         '\\cup \\left(\\left\\{c\\right\\} \\times ' \
938.         '\\left\\{d\\right\\}\\right)'
939. 
940.     assert latex(Complement(A, C2, evaluate=False)) == \
941.         '\\left\\{a\\right\\} \\setminus \\left(\\left\\{c\\right\\} ' \
942.         '\\setminus \\left\\{d\\right\\}\\right)'
943.     assert latex(Complement(U1, U2, evaluate=False)) == \
944.         '\\left(\\left\\{a\\right\\} \\cup \\left\\{b\\right\\}\\right) ' \
945.         '\\setminus \\left(\\left\\{c\\right\\} \\cup ' \
946.         '\\left\\{d\\right\\}\\right)'
947.     assert latex(Complement(I1, I2, evaluate=False)) == \
948.         '\\left(\\left\\{a\\right\\} \\cap \\left\\{b\\right\\}\\right) ' \
949.         '\\setminus \\left(\\left\\{c\\right\\} \\cap ' \
950.         '\\left\\{d\\right\\}\\right)'
951.     assert latex(Complement(D1, D2, evaluate=False)) == \
952.         '\\left(\\left\\{a\\right\\} \\triangle ' \
953.         '\\left\\{b\\right\\}\\right) \\setminus ' \
954.         '\\left(\\left\\{c\\right\\} \\triangle \\left\\{d\\right\\}\\right)'
955.     assert latex(Complement(P1, P2, evaluate=False)) == \
956.         '\\left(\\left\\{a\\right\\} \\times \\left\\{b\\right\\}\\right) '\
957.         '\\setminus \\left(\\left\\{c\\right\\} \\times '\
958.         '\\left\\{d\\right\\}\\right)'
959. 
960.     assert latex(SymmetricDifference(A, D2, evaluate=False)) == \
961.         '\\left\\{a\\right\\} \\triangle \\left(\\left\\{c\\right\\} ' \
962.         '\\triangle \\left\\{d\\right\\}\\right)'
963.     assert latex(SymmetricDifference(U1, U2, evaluate=False)) == \
964.         '\\left(\\left\\{a\\right\\} \\cup \\left\\{b\\right\\}\\right) ' \
965.         '\\triangle \\left(\\left\\{c\\right\\} \\cup ' \
966.         '\\left\\{d\\right\\}\\right)'
967.     assert latex(SymmetricDifference(I1, I2, evaluate=False)) == \
968.         '\\left(\\left\\{a\\right\\} \\cap \\left\\{b\\right\\}\\right) ' \
969.         '\\triangle \\left(\\left\\{c\\right\\} \\cap ' \
970.         '\\left\\{d\\right\\}\\right)'
971.     assert latex(SymmetricDifference(C1, C2, evaluate=False)) == \
972.         '\\left(\\left\\{a\\right\\} \\setminus ' \
973.         '\\left\\{b\\right\\}\\right) \\triangle ' \
974.         '\\left(\\left\\{c\\right\\} \\setminus \\left\\{d\\right\\}\\right)'
975.     assert latex(SymmetricDifference(P1, P2, evaluate=False)) == \
976.         '\\left(\\left\\{a\\right\\} \\times \\left\\{b\\right\\}\\right) ' \
977.         '\\triangle \\left(\\left\\{c\\right\\} \\times ' \
978.         '\\left\\{d\\right\\}\\right)'
979. 
980.     # XXX This can be incorrect since cartesian product is not associative
981.     assert latex(ProductSet(A, P2).flatten()) == \
982.         '\\left\\{a\\right\\} \\times \\left\\{c\\right\\} \\times ' \
983.         '\\left\\{d\\right\\}'
984.     assert latex(ProductSet(U1, U2)) == \
985.         '\\left(\\left\\{a\\right\\} \\cup \\left\\{b\\right\\}\\right) ' \
986.         '\\times \\left(\\left\\{c\\right\\} \\cup ' \
987.         '\\left\\{d\\right\\}\\right)'
988.     assert latex(ProductSet(I1, I2)) == \
989.         '\\left(\\left\\{a\\right\\} \\cap \\left\\{b\\right\\}\\right) ' \
990.         '\\times \\left(\\left\\{c\\right\\} \\cap ' \
991.         '\\left\\{d\\right\\}\\right)'
992.     assert latex(ProductSet(C1, C2)) == \
993.         '\\left(\\left\\{a\\right\\} \\setminus ' \
994.         '\\left\\{b\\right\\}\\right) \\times \\left(\\left\\{c\\right\\} ' \
995.         '\\setminus \\left\\{d\\right\\}\\right)'
996.     assert latex(ProductSet(D1, D2)) == \
997.         '\\left(\\left\\{a\\right\\} \\triangle ' \
998.         '\\left\\{b\\right\\}\\right) \\times \\left(\\left\\{c\\right\\} ' \
999.         '\\triangle \\left\\{d\\right\\}\\right)'

File: sympy/printing/tests/test_latex.py
Line number range: 1000 - 2000
Content:
1000. 
1001. 
1002. def test_latex_Complexes():
1003.     assert latex(S.Complexes) == r"\mathbb{C}"
1004. 
1005. 
1006. def test_latex_Naturals():
1007.     assert latex(S.Naturals) == r"\mathbb{N}"
1008. 
1009. 
1010. def test_latex_Naturals0():
1011.     assert latex(S.Naturals0) == r"\mathbb{N}_0"
1012. 
1013. 
1014. def test_latex_Integers():
1015.     assert latex(S.Integers) == r"\mathbb{Z}"
1016. 
1017. 
1018. def test_latex_ImageSet():
1019.     x = Symbol('x')
1020.     assert latex(ImageSet(Lambda(x, x**2), S.Naturals)) == \
1021.         r"\left\{x^{2}\; |\; x \in \mathbb{N}\right\}"
1022.     y = Symbol('y')
1023. 
1024.     imgset = ImageSet(Lambda((x, y), x + y), {1, 2, 3}, {3, 4})
1025.     assert latex(imgset) == \
1026.         r"\left\{x + y\; |\; x \in \left\{1, 2, 3\right\} , y \in \left\{3, 4\right\}\right\}"
1027. 
1028.     imgset = ImageSet(Lambda(((x, y),), x + y), ProductSet({1, 2, 3}, {3, 4}))
1029.     assert latex(imgset) == \
1030.         r"\left\{x + y\; |\; \left( x, \  y\right) \in \left\{1, 2, 3\right\} \times \left\{3, 4\right\}\right\}"
1031. 
1032. 
1033. def test_latex_ConditionSet():
1034.     x = Symbol('x')
1035.     assert latex(ConditionSet(x, Eq(x**2, 1), S.Reals)) == \
1036.         r"\left\{x \mid x \in \mathbb{R} \wedge x^{2} = 1 \right\}"
1037.     assert latex(ConditionSet(x, Eq(x**2, 1), S.UniversalSet)) == \
1038.         r"\left\{x \mid x^{2} = 1 \right\}"
1039. 
1040. 
1041. def test_latex_ComplexRegion():
1042.     assert latex(ComplexRegion(Interval(3, 5)*Interval(4, 6))) == \
1043.         r"\left\{x + y i\; |\; x, y \in \left[3, 5\right] \times \left[4, 6\right] \right\}"
1044.     assert latex(ComplexRegion(Interval(0, 1)*Interval(0, 2*pi), polar=True)) == \
1045.         r"\left\{r \left(i \sin{\left(\theta \right)} + \cos{\left(\theta "\
1046.         r"\right)}\right)\; |\; r, \theta \in \left[0, 1\right] \times \left[0, 2 \pi\right) \right\}"
1047. 
1048. 
1049. def test_latex_Contains():
1050.     x = Symbol('x')
1051.     assert latex(Contains(x, S.Naturals)) == r"x \in \mathbb{N}"
1052. 
1053. 
1054. def test_latex_sum():
1055.     assert latex(Sum(x*y**2, (x, -2, 2), (y, -5, 5))) == \
1056.         r"\sum_{\substack{-2 \leq x \leq 2\\-5 \leq y \leq 5}} x y^{2}"
1057.     assert latex(Sum(x**2, (x, -2, 2))) == \
1058.         r"\sum_{x=-2}^{2} x^{2}"
1059.     assert latex(Sum(x**2 + y, (x, -2, 2))) == \
1060.         r"\sum_{x=-2}^{2} \left(x^{2} + y\right)"
1061. 
1062.     assert latex(Sum(x**2 + y, (x, -2, 2))**2) == \
1063.         r"\left(\sum_{x=-2}^{2} \left(x^{2} + y\right)\right)^{2}"
1064. 
1065. 
1066. def test_latex_product():
1067.     assert latex(Product(x*y**2, (x, -2, 2), (y, -5, 5))) == \
1068.         r"\prod_{\substack{-2 \leq x \leq 2\\-5 \leq y \leq 5}} x y^{2}"
1069.     assert latex(Product(x**2, (x, -2, 2))) == \
1070.         r"\prod_{x=-2}^{2} x^{2}"
1071.     assert latex(Product(x**2 + y, (x, -2, 2))) == \
1072.         r"\prod_{x=-2}^{2} \left(x^{2} + y\right)"
1073. 
1074.     assert latex(Product(x, (x, -2, 2))**2) == \
1075.         r"\left(\prod_{x=-2}^{2} x\right)^{2}"
1076. 
1077. 
1078. def test_latex_limits():
1079.     assert latex(Limit(x, x, oo)) == r"\lim_{x \to \infty} x"
1080. 
1081.     # issue 8175
1082.     f = Function('f')
1083.     assert latex(Limit(f(x), x, 0)) == r"\lim_{x \to 0^+} f{\left(x \right)}"
1084.     assert latex(Limit(f(x), x, 0, "-")) == \
1085.         r"\lim_{x \to 0^-} f{\left(x \right)}"
1086. 
1087.     # issue #10806
1088.     assert latex(Limit(f(x), x, 0)**2) == \
1089.         r"\left(\lim_{x \to 0^+} f{\left(x \right)}\right)^{2}"
1090.     # bi-directional limit
1091.     assert latex(Limit(f(x), x, 0, dir='+-')) == \
1092.         r"\lim_{x \to 0} f{\left(x \right)}"
1093. 
1094. 
1095. def test_latex_log():
1096.     assert latex(log(x)) == r"\log{\left(x \right)}"
1097.     assert latex(ln(x)) == r"\log{\left(x \right)}"
1098.     assert latex(log(x), ln_notation=True) == r"\ln{\left(x \right)}"
1099.     assert latex(log(x)+log(y)) == \
1100.         r"\log{\left(x \right)} + \log{\left(y \right)}"
1101.     assert latex(log(x)+log(y), ln_notation=True) == \
1102.         r"\ln{\left(x \right)} + \ln{\left(y \right)}"
1103.     assert latex(pow(log(x), x)) == r"\log{\left(x \right)}^{x}"
1104.     assert latex(pow(log(x), x), ln_notation=True) == \
1105.         r"\ln{\left(x \right)}^{x}"
1106. 
1107. 
1108. def test_issue_3568():
1109.     beta = Symbol(r'\beta')
1110.     y = beta + x
1111.     assert latex(y) in [r'\beta + x', r'x + \beta']
1112. 
1113.     beta = Symbol(r'beta')
1114.     y = beta + x
1115.     assert latex(y) in [r'\beta + x', r'x + \beta']
1116. 
1117. 
1118. def test_latex():
1119.     assert latex((2*tau)**Rational(7, 2)) == "8 \\sqrt{2} \\tau^{\\frac{7}{2}}"
1120.     assert latex((2*mu)**Rational(7, 2), mode='equation*') == \
1121.         "\\begin{equation*}8 \\sqrt{2} \\mu^{\\frac{7}{2}}\\end{equation*}"
1122.     assert latex((2*mu)**Rational(7, 2), mode='equation', itex=True) == \
1123.         "$$8 \\sqrt{2} \\mu^{\\frac{7}{2}}$$"
1124.     assert latex([2/x, y]) == r"\left[ \frac{2}{x}, \  y\right]"
1125. 
1126. 
1127. def test_latex_dict():
1128.     d = {Rational(1): 1, x**2: 2, x: 3, x**3: 4}
1129.     assert latex(d) == \
1130.         r'\left\{ 1 : 1, \  x : 3, \  x^{2} : 2, \  x^{3} : 4\right\}'
1131.     D = Dict(d)
1132.     assert latex(D) == \
1133.         r'\left\{ 1 : 1, \  x : 3, \  x^{2} : 2, \  x^{3} : 4\right\}'
1134. 
1135. 
1136. def test_latex_list():
1137.     ll = [Symbol('omega1'), Symbol('a'), Symbol('alpha')]
1138.     assert latex(ll) == r'\left[ \omega_{1}, \  a, \  \alpha\right]'
1139. 
1140. 
1141. def test_latex_rational():
1142.     # tests issue 3973
1143.     assert latex(-Rational(1, 2)) == "- \\frac{1}{2}"
1144.     assert latex(Rational(-1, 2)) == "- \\frac{1}{2}"
1145.     assert latex(Rational(1, -2)) == "- \\frac{1}{2}"
1146.     assert latex(-Rational(-1, 2)) == "\\frac{1}{2}"
1147.     assert latex(-Rational(1, 2)*x) == "- \\frac{x}{2}"
1148.     assert latex(-Rational(1, 2)*x + Rational(-2, 3)*y) == \
1149.         "- \\frac{x}{2} - \\frac{2 y}{3}"
1150. 
1151. 
1152. def test_latex_inverse():
1153.     # tests issue 4129
1154.     assert latex(1/x) == "\\frac{1}{x}"
1155.     assert latex(1/(x + y)) == "\\frac{1}{x + y}"
1156. 
1157. 
1158. def test_latex_DiracDelta():
1159.     assert latex(DiracDelta(x)) == r"\delta\left(x\right)"
1160.     assert latex(DiracDelta(x)**2) == r"\left(\delta\left(x\right)\right)^{2}"
1161.     assert latex(DiracDelta(x, 0)) == r"\delta\left(x\right)"
1162.     assert latex(DiracDelta(x, 5)) == \
1163.         r"\delta^{\left( 5 \right)}\left( x \right)"
1164.     assert latex(DiracDelta(x, 5)**2) == \
1165.         r"\left(\delta^{\left( 5 \right)}\left( x \right)\right)^{2}"
1166. 
1167. 
1168. def test_latex_Heaviside():
1169.     assert latex(Heaviside(x)) == r"\theta\left(x\right)"
1170.     assert latex(Heaviside(x)**2) == r"\left(\theta\left(x\right)\right)^{2}"
1171. 
1172. 
1173. def test_latex_KroneckerDelta():
1174.     assert latex(KroneckerDelta(x, y)) == r"\delta_{x y}"
1175.     assert latex(KroneckerDelta(x, y + 1)) == r"\delta_{x, y + 1}"
1176.     # issue 6578
1177.     assert latex(KroneckerDelta(x + 1, y)) == r"\delta_{y, x + 1}"
1178.     assert latex(Pow(KroneckerDelta(x, y), 2, evaluate=False)) == \
1179.         r"\left(\delta_{x y}\right)^{2}"
1180. 
1181. 
1182. def test_latex_LeviCivita():
1183.     assert latex(LeviCivita(x, y, z)) == r"\varepsilon_{x y z}"
1184.     assert latex(LeviCivita(x, y, z)**2) == \
1185.         r"\left(\varepsilon_{x y z}\right)^{2}"
1186.     assert latex(LeviCivita(x, y, z + 1)) == r"\varepsilon_{x, y, z + 1}"
1187.     assert latex(LeviCivita(x, y + 1, z)) == r"\varepsilon_{x, y + 1, z}"
1188.     assert latex(LeviCivita(x + 1, y, z)) == r"\varepsilon_{x + 1, y, z}"
1189. 
1190. 
1191. def test_mode():
1192.     expr = x + y
1193.     assert latex(expr) == 'x + y'
1194.     assert latex(expr, mode='plain') == 'x + y'
1195.     assert latex(expr, mode='inline') == '$x + y$'
1196.     assert latex(
1197.         expr, mode='equation*') == '\\begin{equation*}x + y\\end{equation*}'
1198.     assert latex(
1199.         expr, mode='equation') == '\\begin{equation}x + y\\end{equation}'
1200.     raises(ValueError, lambda: latex(expr, mode='foo'))
1201. 
1202. 
1203. def test_latex_mathieu():
1204.     assert latex(mathieuc(x, y, z)) == r"C\left(x, y, z\right)"
1205.     assert latex(mathieus(x, y, z)) == r"S\left(x, y, z\right)"
1206.     assert latex(mathieuc(x, y, z)**2) == r"C\left(x, y, z\right)^{2}"
1207.     assert latex(mathieus(x, y, z)**2) == r"S\left(x, y, z\right)^{2}"
1208.     assert latex(mathieucprime(x, y, z)) == r"C^{\prime}\left(x, y, z\right)"
1209.     assert latex(mathieusprime(x, y, z)) == r"S^{\prime}\left(x, y, z\right)"
1210.     assert latex(mathieucprime(x, y, z)**2) == r"C^{\prime}\left(x, y, z\right)^{2}"
1211.     assert latex(mathieusprime(x, y, z)**2) == r"S^{\prime}\left(x, y, z\right)^{2}"
1212. 
1213. def test_latex_Piecewise():
1214.     p = Piecewise((x, x < 1), (x**2, True))
1215.     assert latex(p) == "\\begin{cases} x & \\text{for}\\: x < 1 \\\\x^{2} &" \
1216.                        " \\text{otherwise} \\end{cases}"
1217.     assert latex(p, itex=True) == \
1218.         "\\begin{cases} x & \\text{for}\\: x \\lt 1 \\\\x^{2} &" \
1219.         " \\text{otherwise} \\end{cases}"
1220.     p = Piecewise((x, x < 0), (0, x >= 0))
1221.     assert latex(p) == '\\begin{cases} x & \\text{for}\\: x < 0 \\\\0 &' \
1222.                        ' \\text{otherwise} \\end{cases}'
1223.     A, B = symbols("A B", commutative=False)
1224.     p = Piecewise((A**2, Eq(A, B)), (A*B, True))
1225.     s = r"\begin{cases} A^{2} & \text{for}\: A = B \\A B & \text{otherwise} \end{cases}"
1226.     assert latex(p) == s
1227.     assert latex(A*p) == r"A \left(%s\right)" % s
1228.     assert latex(p*A) == r"\left(%s\right) A" % s
1229.     assert latex(Piecewise((x, x < 1), (x**2, x < 2))) == \
1230.         '\\begin{cases} x & ' \
1231.         '\\text{for}\\: x < 1 \\\\x^{2} & \\text{for}\\: x < 2 \\end{cases}'
1232. 
1233. 
1234. def test_latex_Matrix():
1235.     M = Matrix([[1 + x, y], [y, x - 1]])
1236.     assert latex(M) == \
1237.         r'\left[\begin{matrix}x + 1 & y\\y & x - 1\end{matrix}\right]'
1238.     assert latex(M, mode='inline') == \
1239.         r'$\left[\begin{smallmatrix}x + 1 & y\\' \
1240.         r'y & x - 1\end{smallmatrix}\right]$'
1241.     assert latex(M, mat_str='array') == \
1242.         r'\left[\begin{array}{cc}x + 1 & y\\y & x - 1\end{array}\right]'
1243.     assert latex(M, mat_str='bmatrix') == \
1244.         r'\left[\begin{bmatrix}x + 1 & y\\y & x - 1\end{bmatrix}\right]'
1245.     assert latex(M, mat_delim=None, mat_str='bmatrix') == \
1246.         r'\begin{bmatrix}x + 1 & y\\y & x - 1\end{bmatrix}'
1247.     M2 = Matrix(1, 11, range(11))
1248.     assert latex(M2) == \
1249.         r'\left[\begin{array}{ccccccccccc}' \
1250.         r'0 & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 & 10\end{array}\right]'
1251. 
1252. 
1253. def test_latex_matrix_with_functions():
1254.     t = symbols('t')
1255.     theta1 = symbols('theta1', cls=Function)
1256. 
1257.     M = Matrix([[sin(theta1(t)), cos(theta1(t))],
1258.                 [cos(theta1(t).diff(t)), sin(theta1(t).diff(t))]])
1259. 
1260.     expected = (r'\left[\begin{matrix}\sin{\left('
1261.                 r'\theta_{1}{\left(t \right)} \right)} & '
1262.                 r'\cos{\left(\theta_{1}{\left(t \right)} \right)'
1263.                 r'}\\\cos{\left(\frac{d}{d t} \theta_{1}{\left(t '
1264.                 r'\right)} \right)} & \sin{\left(\frac{d}{d t} '
1265.                 r'\theta_{1}{\left(t \right)} \right'
1266.                 r')}\end{matrix}\right]')
1267. 
1268.     assert latex(M) == expected
1269. 
1270. 
1271. def test_latex_NDimArray():
1272.     x, y, z, w = symbols("x y z w")
1273. 
1274.     for ArrayType in (ImmutableDenseNDimArray, ImmutableSparseNDimArray,
1275.                       MutableDenseNDimArray, MutableSparseNDimArray):
1276.         # Basic: scalar array
1277.         M = ArrayType(x)
1278. 
1279.         assert latex(M) == "x"
1280. 
1281.         M = ArrayType([[1 / x, y], [z, w]])
1282.         M1 = ArrayType([1 / x, y, z])
1283. 
1284.         M2 = tensorproduct(M1, M)
1285.         M3 = tensorproduct(M, M)
1286. 
1287.         assert latex(M) == \
1288.             '\\left[\\begin{matrix}\\frac{1}{x} & y\\\\z & w\\end{matrix}\\right]'
1289.         assert latex(M1) == \
1290.             "\\left[\\begin{matrix}\\frac{1}{x} & y & z\\end{matrix}\\right]"
1291.         assert latex(M2) == \
1292.             r"\left[\begin{matrix}" \
1293.             r"\left[\begin{matrix}\frac{1}{x^{2}} & \frac{y}{x}\\\frac{z}{x} & \frac{w}{x}\end{matrix}\right] & " \
1294.             r"\left[\begin{matrix}\frac{y}{x} & y^{2}\\y z & w y\end{matrix}\right] & " \
1295.             r"\left[\begin{matrix}\frac{z}{x} & y z\\z^{2} & w z\end{matrix}\right]" \
1296.             r"\end{matrix}\right]"
1297.         assert latex(M3) == \
1298.             r"""\left[\begin{matrix}"""\
1299.             r"""\left[\begin{matrix}\frac{1}{x^{2}} & \frac{y}{x}\\\frac{z}{x} & \frac{w}{x}\end{matrix}\right] & """\
1300.             r"""\left[\begin{matrix}\frac{y}{x} & y^{2}\\y z & w y\end{matrix}\right]\\"""\
1301.             r"""\left[\begin{matrix}\frac{z}{x} & y z\\z^{2} & w z\end{matrix}\right] & """\
1302.             r"""\left[\begin{matrix}\frac{w}{x} & w y\\w z & w^{2}\end{matrix}\right]"""\
1303.             r"""\end{matrix}\right]"""
1304. 
1305.         Mrow = ArrayType([[x, y, 1/z]])
1306.         Mcolumn = ArrayType([[x], [y], [1/z]])
1307.         Mcol2 = ArrayType([Mcolumn.tolist()])
1308. 
1309.         assert latex(Mrow) == \
1310.             r"\left[\left[\begin{matrix}x & y & \frac{1}{z}\end{matrix}\right]\right]"
1311.         assert latex(Mcolumn) == \
1312.             r"\left[\begin{matrix}x\\y\\\frac{1}{z}\end{matrix}\right]"
1313.         assert latex(Mcol2) == \
1314.             r'\left[\begin{matrix}\left[\begin{matrix}x\\y\\\frac{1}{z}\end{matrix}\right]\end{matrix}\right]'
1315. 
1316. 
1317. def test_latex_mul_symbol():
1318.     assert latex(4*4**x, mul_symbol='times') == "4 \\times 4^{x}"
1319.     assert latex(4*4**x, mul_symbol='dot') == "4 \\cdot 4^{x}"
1320.     assert latex(4*4**x, mul_symbol='ldot') == r"4 \,.\, 4^{x}"
1321. 
1322.     assert latex(4*x, mul_symbol='times') == "4 \\times x"
1323.     assert latex(4*x, mul_symbol='dot') == "4 \\cdot x"
1324.     assert latex(4*x, mul_symbol='ldot') == r"4 \,.\, x"
1325. 
1326. 
1327. def test_latex_issue_4381():
1328.     y = 4*4**log(2)
1329.     assert latex(y) == r'4 \cdot 4^{\log{\left(2 \right)}}'
1330.     assert latex(1/y) == r'\frac{1}{4 \cdot 4^{\log{\left(2 \right)}}}'
1331. 
1332. 
1333. def test_latex_issue_4576():
1334.     assert latex(Symbol("beta_13_2")) == r"\beta_{13 2}"
1335.     assert latex(Symbol("beta_132_20")) == r"\beta_{132 20}"
1336.     assert latex(Symbol("beta_13")) == r"\beta_{13}"
1337.     assert latex(Symbol("x_a_b")) == r"x_{a b}"
1338.     assert latex(Symbol("x_1_2_3")) == r"x_{1 2 3}"
1339.     assert latex(Symbol("x_a_b1")) == r"x_{a b1}"
1340.     assert latex(Symbol("x_a_1")) == r"x_{a 1}"
1341.     assert latex(Symbol("x_1_a")) == r"x_{1 a}"
1342.     assert latex(Symbol("x_1^aa")) == r"x^{aa}_{1}"
1343.     assert latex(Symbol("x_1__aa")) == r"x^{aa}_{1}"
1344.     assert latex(Symbol("x_11^a")) == r"x^{a}_{11}"
1345.     assert latex(Symbol("x_11__a")) == r"x^{a}_{11}"
1346.     assert latex(Symbol("x_a_a_a_a")) == r"x_{a a a a}"
1347.     assert latex(Symbol("x_a_a^a^a")) == r"x^{a a}_{a a}"
1348.     assert latex(Symbol("x_a_a__a__a")) == r"x^{a a}_{a a}"
1349.     assert latex(Symbol("alpha_11")) == r"\alpha_{11}"
1350.     assert latex(Symbol("alpha_11_11")) == r"\alpha_{11 11}"
1351.     assert latex(Symbol("alpha_alpha")) == r"\alpha_{\alpha}"
1352.     assert latex(Symbol("alpha^aleph")) == r"\alpha^{\aleph}"
1353.     assert latex(Symbol("alpha__aleph")) == r"\alpha^{\aleph}"
1354. 
1355. 
1356. def test_latex_pow_fraction():
1357.     x = Symbol('x')
1358.     # Testing exp
1359.     assert 'e^{-x}' in latex(exp(-x)/2).replace(' ', '')  # Remove Whitespace
1360. 
1361.     # Testing e^{-x} in case future changes alter behavior of muls or fracs
1362.     # In particular current output is \frac{1}{2}e^{- x} but perhaps this will
1363.     # change to \frac{e^{-x}}{2}
1364. 
1365.     # Testing general, non-exp, power
1366.     assert '3^{-x}' in latex(3**-x/2).replace(' ', '')
1367. 
1368. 
1369. def test_noncommutative():
1370.     A, B, C = symbols('A,B,C', commutative=False)
1371. 
1372.     assert latex(A*B*C**-1) == "A B C^{-1}"
1373.     assert latex(C**-1*A*B) == "C^{-1} A B"
1374.     assert latex(A*C**-1*B) == "A C^{-1} B"
1375. 
1376. 
1377. def test_latex_order():
1378.     expr = x**3 + x**2*y + y**4 + 3*x*y**3
1379. 
1380.     assert latex(expr, order='lex') == "x^{3} + x^{2} y + 3 x y^{3} + y^{4}"
1381.     assert latex(
1382.         expr, order='rev-lex') == "y^{4} + 3 x y^{3} + x^{2} y + x^{3}"
1383.     assert latex(expr, order='none') == "x^{3} + y^{4} + y x^{2} + 3 x y^{3}"
1384. 
1385. 
1386. def test_latex_Lambda():
1387.     assert latex(Lambda(x, x + 1)) == \
1388.         r"\left( x \mapsto x + 1 \right)"
1389.     assert latex(Lambda((x, y), x + 1)) == \
1390.         r"\left( \left( x, \  y\right) \mapsto x + 1 \right)"
1391. 
1392. 
1393. def test_latex_PolyElement():
1394.     Ruv, u, v = ring("u,v", ZZ)
1395.     Rxyz, x, y, z = ring("x,y,z", Ruv)
1396. 
1397.     assert latex(x - x) == r"0"
1398.     assert latex(x - 1) == r"x - 1"
1399.     assert latex(x + 1) == r"x + 1"
1400. 
1401.     assert latex((u**2 + 3*u*v + 1)*x**2*y + u + 1) == \
1402.         r"\left({u}^{2} + 3 u v + 1\right) {x}^{2} y + u + 1"
1403.     assert latex((u**2 + 3*u*v + 1)*x**2*y + (u + 1)*x) == \
1404.         r"\left({u}^{2} + 3 u v + 1\right) {x}^{2} y + \left(u + 1\right) x"
1405.     assert latex((u**2 + 3*u*v + 1)*x**2*y + (u + 1)*x + 1) == \
1406.         r"\left({u}^{2} + 3 u v + 1\right) {x}^{2} y + \left(u + 1\right) x + 1"
1407.     assert latex((-u**2 + 3*u*v - 1)*x**2*y - (u + 1)*x - 1) == \
1408.         r"-\left({u}^{2} - 3 u v + 1\right) {x}^{2} y - \left(u + 1\right) x - 1"
1409. 
1410.     assert latex(-(v**2 + v + 1)*x + 3*u*v + 1) == \
1411.         r"-\left({v}^{2} + v + 1\right) x + 3 u v + 1"
1412.     assert latex(-(v**2 + v + 1)*x - 3*u*v + 1) == \
1413.         r"-\left({v}^{2} + v + 1\right) x - 3 u v + 1"
1414. 
1415. 
1416. def test_latex_FracElement():
1417.     Fuv, u, v = field("u,v", ZZ)
1418.     Fxyzt, x, y, z, t = field("x,y,z,t", Fuv)
1419. 
1420.     assert latex(x - x) == r"0"
1421.     assert latex(x - 1) == r"x - 1"
1422.     assert latex(x + 1) == r"x + 1"
1423. 
1424.     assert latex(x/3) == r"\frac{x}{3}"
1425.     assert latex(x/z) == r"\frac{x}{z}"
1426.     assert latex(x*y/z) == r"\frac{x y}{z}"
1427.     assert latex(x/(z*t)) == r"\frac{x}{z t}"
1428.     assert latex(x*y/(z*t)) == r"\frac{x y}{z t}"
1429. 
1430.     assert latex((x - 1)/y) == r"\frac{x - 1}{y}"
1431.     assert latex((x + 1)/y) == r"\frac{x + 1}{y}"
1432.     assert latex((-x - 1)/y) == r"\frac{-x - 1}{y}"
1433.     assert latex((x + 1)/(y*z)) == r"\frac{x + 1}{y z}"
1434.     assert latex(-y/(x + 1)) == r"\frac{-y}{x + 1}"
1435.     assert latex(y*z/(x + 1)) == r"\frac{y z}{x + 1}"
1436. 
1437.     assert latex(((u + 1)*x*y + 1)/((v - 1)*z - 1)) == \
1438.         r"\frac{\left(u + 1\right) x y + 1}{\left(v - 1\right) z - 1}"
1439.     assert latex(((u + 1)*x*y + 1)/((v - 1)*z - t*u*v - 1)) == \
1440.         r"\frac{\left(u + 1\right) x y + 1}{\left(v - 1\right) z - u v t - 1}"
1441. 
1442. 
1443. def test_latex_Poly():
1444.     assert latex(Poly(x**2 + 2 * x, x)) == \
1445.         r"\operatorname{Poly}{\left( x^{2} + 2 x, x, domain=\mathbb{Z} \right)}"
1446.     assert latex(Poly(x/y, x)) == \
1447.         r"\operatorname{Poly}{\left( \frac{1}{y} x, x, domain=\mathbb{Z}\left(y\right) \right)}"
1448.     assert latex(Poly(2.0*x + y)) == \
1449.         r"\operatorname{Poly}{\left( 2.0 x + 1.0 y, x, y, domain=\mathbb{R} \right)}"
1450. 
1451. 
1452. def test_latex_Poly_order():
1453.     assert latex(Poly([a, 1, b, 2, c, 3], x)) == \
1454.         '\\operatorname{Poly}{\\left( a x^{5} + x^{4} + b x^{3} + 2 x^{2} + c'\
1455.         ' x + 3, x, domain=\\mathbb{Z}\\left[a, b, c\\right] \\right)}'
1456.     assert latex(Poly([a, 1, b+c, 2, 3], x)) == \
1457.         '\\operatorname{Poly}{\\left( a x^{4} + x^{3} + \\left(b + c\\right) '\
1458.         'x^{2} + 2 x + 3, x, domain=\\mathbb{Z}\\left[a, b, c\\right] \\right)}'
1459.     assert latex(Poly(a*x**3 + x**2*y - x*y - c*y**3 - b*x*y**2 + y - a*x + b,
1460.                       (x, y))) == \
1461.         '\\operatorname{Poly}{\\left( a x^{3} + x^{2}y -  b xy^{2} - xy -  '\
1462.         'a x -  c y^{3} + y + b, x, y, domain=\\mathbb{Z}\\left[a, b, c\\right] \\right)}'
1463. 
1464. 
1465. def test_latex_ComplexRootOf():
1466.     assert latex(rootof(x**5 + x + 3, 0)) == \
1467.         r"\operatorname{CRootOf} {\left(x^{5} + x + 3, 0\right)}"
1468. 
1469. 
1470. def test_latex_RootSum():
1471.     assert latex(RootSum(x**5 + x + 3, sin)) == \
1472.         r"\operatorname{RootSum} {\left(x^{5} + x + 3, \left( x \mapsto \sin{\left(x \right)} \right)\right)}"
1473. 
1474. 
1475. def test_settings():
1476.     raises(TypeError, lambda: latex(x*y, method="garbage"))
1477. 
1478. 
1479. def test_latex_numbers():
1480.     assert latex(catalan(n)) == r"C_{n}"
1481.     assert latex(catalan(n)**2) == r"C_{n}^{2}"
1482.     assert latex(bernoulli(n)) == r"B_{n}"
1483.     assert latex(bernoulli(n, x)) == r"B_{n}\left(x\right)"
1484.     assert latex(bernoulli(n)**2) == r"B_{n}^{2}"
1485.     assert latex(bernoulli(n, x)**2) == r"B_{n}^{2}\left(x\right)"
1486.     assert latex(bell(n)) == r"B_{n}"
1487.     assert latex(bell(n, x)) == r"B_{n}\left(x\right)"
1488.     assert latex(bell(n, m, (x, y))) == r"B_{n, m}\left(x, y\right)"
1489.     assert latex(bell(n)**2) == r"B_{n}^{2}"
1490.     assert latex(bell(n, x)**2) == r"B_{n}^{2}\left(x\right)"
1491.     assert latex(bell(n, m, (x, y))**2) == r"B_{n, m}^{2}\left(x, y\right)"
1492.     assert latex(fibonacci(n)) == r"F_{n}"
1493.     assert latex(fibonacci(n, x)) == r"F_{n}\left(x\right)"
1494.     assert latex(fibonacci(n)**2) == r"F_{n}^{2}"
1495.     assert latex(fibonacci(n, x)**2) == r"F_{n}^{2}\left(x\right)"
1496.     assert latex(lucas(n)) == r"L_{n}"
1497.     assert latex(lucas(n)**2) == r"L_{n}^{2}"
1498.     assert latex(tribonacci(n)) == r"T_{n}"
1499.     assert latex(tribonacci(n, x)) == r"T_{n}\left(x\right)"
1500.     assert latex(tribonacci(n)**2) == r"T_{n}^{2}"
1501.     assert latex(tribonacci(n, x)**2) == r"T_{n}^{2}\left(x\right)"
1502. 
1503. 
1504. def test_latex_euler():
1505.     assert latex(euler(n)) == r"E_{n}"
1506.     assert latex(euler(n, x)) == r"E_{n}\left(x\right)"
1507.     assert latex(euler(n, x)**2) == r"E_{n}^{2}\left(x\right)"
1508. 
1509. 
1510. def test_lamda():
1511.     assert latex(Symbol('lamda')) == r"\lambda"
1512.     assert latex(Symbol('Lamda')) == r"\Lambda"
1513. 
1514. 
1515. def test_custom_symbol_names():
1516.     x = Symbol('x')
1517.     y = Symbol('y')
1518.     assert latex(x) == "x"
1519.     assert latex(x, symbol_names={x: "x_i"}) == "x_i"
1520.     assert latex(x + y, symbol_names={x: "x_i"}) == "x_i + y"
1521.     assert latex(x**2, symbol_names={x: "x_i"}) == "x_i^{2}"
1522.     assert latex(x + y, symbol_names={x: "x_i", y: "y_j"}) == "x_i + y_j"
1523. 
1524. 
1525. def test_matAdd():
1526.     from sympy import MatrixSymbol
1527.     from sympy.printing.latex import LatexPrinter
1528.     C = MatrixSymbol('C', 5, 5)
1529.     B = MatrixSymbol('B', 5, 5)
1530.     l = LatexPrinter()
1531.     assert l._print(C - 2*B) in ['- 2 B + C', 'C -2 B']
1532.     assert l._print(C + 2*B) in ['2 B + C', 'C + 2 B']
1533.     assert l._print(B - 2*C) in ['B - 2 C', '- 2 C + B']
1534.     assert l._print(B + 2*C) in ['B + 2 C', '2 C + B']
1535. 
1536. 
1537. def test_matMul():
1538.     from sympy import MatrixSymbol
1539.     from sympy.printing.latex import LatexPrinter
1540.     A = MatrixSymbol('A', 5, 5)
1541.     B = MatrixSymbol('B', 5, 5)
1542.     x = Symbol('x')
1543.     lp = LatexPrinter()
1544.     assert lp._print_MatMul(2*A) == '2 A'
1545.     assert lp._print_MatMul(2*x*A) == '2 x A'
1546.     assert lp._print_MatMul(-2*A) == '- 2 A'
1547.     assert lp._print_MatMul(1.5*A) == '1.5 A'
1548.     assert lp._print_MatMul(sqrt(2)*A) == r'\sqrt{2} A'
1549.     assert lp._print_MatMul(-sqrt(2)*A) == r'- \sqrt{2} A'
1550.     assert lp._print_MatMul(2*sqrt(2)*x*A) == r'2 \sqrt{2} x A'
1551.     assert lp._print_MatMul(-2*A*(A + 2*B)) in [r'- 2 A \left(A + 2 B\right)',
1552.                                                 r'- 2 A \left(2 B + A\right)']
1553. 
1554. 
1555. def test_latex_MatrixSlice():
1556.     from sympy.matrices.expressions import MatrixSymbol
1557.     assert latex(MatrixSymbol('X', 10, 10)[:5, 1:9:2]) == \
1558.         r'X\left[:5, 1:9:2\right]'
1559.     assert latex(MatrixSymbol('X', 10, 10)[5, :5:2]) == \
1560.         r'X\left[5, :5:2\right]'
1561. 
1562. 
1563. def test_latex_RandomDomain():
1564.     from sympy.stats import Normal, Die, Exponential, pspace, where
1565.     from sympy.stats.rv import RandomDomain
1566. 
1567.     X = Normal('x1', 0, 1)
1568.     assert latex(where(X > 0)) == r"\text{Domain: }0 < x_{1} \wedge x_{1} < \infty"
1569. 
1570.     D = Die('d1', 6)
1571.     assert latex(where(D > 4)) == r"\text{Domain: }d_{1} = 5 \vee d_{1} = 6"
1572. 
1573.     A = Exponential('a', 1)
1574.     B = Exponential('b', 1)
1575.     assert latex(
1576.         pspace(Tuple(A, B)).domain) == \
1577.         r"\text{Domain: }0 \leq a \wedge 0 \leq b \wedge a < \infty \wedge b < \infty"
1578. 
1579.     assert latex(RandomDomain(FiniteSet(x), FiniteSet(1, 2))) == \
1580.         r'\text{Domain: }\left\{x\right\}\text{ in }\left\{1, 2\right\}'
1581. 
1582. def test_PrettyPoly():
1583.     from sympy.polys.domains import QQ
1584.     F = QQ.frac_field(x, y)
1585.     R = QQ[x, y]
1586. 
1587.     assert latex(F.convert(x/(x + y))) == latex(x/(x + y))
1588.     assert latex(R.convert(x + y)) == latex(x + y)
1589. 
1590. 
1591. def test_integral_transforms():
1592.     x = Symbol("x")
1593.     k = Symbol("k")
1594.     f = Function("f")
1595.     a = Symbol("a")
1596.     b = Symbol("b")
1597. 
1598.     assert latex(MellinTransform(f(x), x, k)) == \
1599.         r"\mathcal{M}_{x}\left[f{\left(x \right)}\right]\left(k\right)"
1600.     assert latex(InverseMellinTransform(f(k), k, x, a, b)) == \
1601.         r"\mathcal{M}^{-1}_{k}\left[f{\left(k \right)}\right]\left(x\right)"
1602. 
1603.     assert latex(LaplaceTransform(f(x), x, k)) == \
1604.         r"\mathcal{L}_{x}\left[f{\left(x \right)}\right]\left(k\right)"
1605.     assert latex(InverseLaplaceTransform(f(k), k, x, (a, b))) == \
1606.         r"\mathcal{L}^{-1}_{k}\left[f{\left(k \right)}\right]\left(x\right)"
1607. 
1608.     assert latex(FourierTransform(f(x), x, k)) == \
1609.         r"\mathcal{F}_{x}\left[f{\left(x \right)}\right]\left(k\right)"
1610.     assert latex(InverseFourierTransform(f(k), k, x)) == \
1611.         r"\mathcal{F}^{-1}_{k}\left[f{\left(k \right)}\right]\left(x\right)"
1612. 
1613.     assert latex(CosineTransform(f(x), x, k)) == \
1614.         r"\mathcal{COS}_{x}\left[f{\left(x \right)}\right]\left(k\right)"
1615.     assert latex(InverseCosineTransform(f(k), k, x)) == \
1616.         r"\mathcal{COS}^{-1}_{k}\left[f{\left(k \right)}\right]\left(x\right)"
1617. 
1618.     assert latex(SineTransform(f(x), x, k)) == \
1619.         r"\mathcal{SIN}_{x}\left[f{\left(x \right)}\right]\left(k\right)"
1620.     assert latex(InverseSineTransform(f(k), k, x)) == \
1621.         r"\mathcal{SIN}^{-1}_{k}\left[f{\left(k \right)}\right]\left(x\right)"
1622. 
1623. 
1624. def test_PolynomialRingBase():
1625.     from sympy.polys.domains import QQ
1626.     assert latex(QQ.old_poly_ring(x, y)) == r"\mathbb{Q}\left[x, y\right]"
1627.     assert latex(QQ.old_poly_ring(x, y, order="ilex")) == \
1628.         r"S_<^{-1}\mathbb{Q}\left[x, y\right]"
1629. 
1630. 
1631. def test_categories():
1632.     from sympy.categories import (Object, IdentityMorphism,
1633.                                   NamedMorphism, Category, Diagram,
1634.                                   DiagramGrid)
1635. 
1636.     A1 = Object("A1")
1637.     A2 = Object("A2")
1638.     A3 = Object("A3")
1639. 
1640.     f1 = NamedMorphism(A1, A2, "f1")
1641.     f2 = NamedMorphism(A2, A3, "f2")
1642.     id_A1 = IdentityMorphism(A1)
1643. 
1644.     K1 = Category("K1")
1645. 
1646.     assert latex(A1) == "A_{1}"
1647.     assert latex(f1) == "f_{1}:A_{1}\\rightarrow A_{2}"
1648.     assert latex(id_A1) == "id:A_{1}\\rightarrow A_{1}"
1649.     assert latex(f2*f1) == "f_{2}\\circ f_{1}:A_{1}\\rightarrow A_{3}"
1650. 
1651.     assert latex(K1) == r"\mathbf{K_{1}}"
1652. 
1653.     d = Diagram()
1654.     assert latex(d) == r"\emptyset"
1655. 
1656.     d = Diagram({f1: "unique", f2: S.EmptySet})
1657.     assert latex(d) == r"\left\{ f_{2}\circ f_{1}:A_{1}" \
1658.         r"\rightarrow A_{3} : \emptyset, \  id:A_{1}\rightarrow " \
1659.         r"A_{1} : \emptyset, \  id:A_{2}\rightarrow A_{2} : " \
1660.         r"\emptyset, \  id:A_{3}\rightarrow A_{3} : \emptyset, " \
1661.         r"\  f_{1}:A_{1}\rightarrow A_{2} : \left\{unique\right\}, " \
1662.         r"\  f_{2}:A_{2}\rightarrow A_{3} : \emptyset\right\}"
1663. 
1664.     d = Diagram({f1: "unique", f2: S.EmptySet}, {f2 * f1: "unique"})
1665.     assert latex(d) == r"\left\{ f_{2}\circ f_{1}:A_{1}" \
1666.         r"\rightarrow A_{3} : \emptyset, \  id:A_{1}\rightarrow " \
1667.         r"A_{1} : \emptyset, \  id:A_{2}\rightarrow A_{2} : " \
1668.         r"\emptyset, \  id:A_{3}\rightarrow A_{3} : \emptyset, " \
1669.         r"\  f_{1}:A_{1}\rightarrow A_{2} : \left\{unique\right\}," \
1670.         r" \  f_{2}:A_{2}\rightarrow A_{3} : \emptyset\right\}" \
1671.         r"\Longrightarrow \left\{ f_{2}\circ f_{1}:A_{1}" \
1672.         r"\rightarrow A_{3} : \left\{unique\right\}\right\}"
1673. 
1674.     # A linear diagram.
1675.     A = Object("A")
1676.     B = Object("B")
1677.     C = Object("C")
1678.     f = NamedMorphism(A, B, "f")
1679.     g = NamedMorphism(B, C, "g")
1680.     d = Diagram([f, g])
1681.     grid = DiagramGrid(d)
1682. 
1683.     assert latex(grid) == "\\begin{array}{cc}\n" \
1684.         "A & B \\\\\n" \
1685.         " & C \n" \
1686.         "\\end{array}\n"
1687. 
1688. 
1689. def test_Modules():
1690.     from sympy.polys.domains import QQ
1691.     from sympy.polys.agca import homomorphism
1692. 
1693.     R = QQ.old_poly_ring(x, y)
1694.     F = R.free_module(2)
1695.     M = F.submodule([x, y], [1, x**2])
1696. 
1697.     assert latex(F) == r"{\mathbb{Q}\left[x, y\right]}^{2}"
1698.     assert latex(M) == \
1699.         r"\left\langle {\left[ {x},{y} \right]},{\left[ {1},{x^{2}} \right]} \right\rangle"
1700. 
1701.     I = R.ideal(x**2, y)
1702.     assert latex(I) == r"\left\langle {x^{2}},{y} \right\rangle"
1703. 
1704.     Q = F / M
1705.     assert latex(Q) == \
1706.         r"\frac{{\mathbb{Q}\left[x, y\right]}^{2}}{\left\langle {\left[ {x},"\
1707.         r"{y} \right]},{\left[ {1},{x^{2}} \right]} \right\rangle}"
1708.     assert latex(Q.submodule([1, x**3/2], [2, y])) == \
1709.         r"\left\langle {{\left[ {1},{\frac{x^{3}}{2}} \right]} + {\left"\
1710.         r"\langle {\left[ {x},{y} \right]},{\left[ {1},{x^{2}} \right]} "\
1711.         r"\right\rangle}},{{\left[ {2},{y} \right]} + {\left\langle {\left[ "\
1712.         r"{x},{y} \right]},{\left[ {1},{x^{2}} \right]} \right\rangle}} \right\rangle"
1713. 
1714.     h = homomorphism(QQ.old_poly_ring(x).free_module(2),
1715.                      QQ.old_poly_ring(x).free_module(2), [0, 0])
1716. 
1717.     assert latex(h) == \
1718.         r"{\left[\begin{matrix}0 & 0\\0 & 0\end{matrix}\right]} : "\
1719.         r"{{\mathbb{Q}\left[x\right]}^{2}} \to {{\mathbb{Q}\left[x\right]}^{2}}"
1720. 
1721. 
1722. def test_QuotientRing():
1723.     from sympy.polys.domains import QQ
1724.     R = QQ.old_poly_ring(x)/[x**2 + 1]
1725. 
1726.     assert latex(R) == \
1727.         r"\frac{\mathbb{Q}\left[x\right]}{\left\langle {x^{2} + 1} \right\rangle}"
1728.     assert latex(R.one) == r"{1} + {\left\langle {x^{2} + 1} \right\rangle}"
1729. 
1730. 
1731. def test_Tr():
1732.     #TODO: Handle indices
1733.     A, B = symbols('A B', commutative=False)
1734.     t = Tr(A*B)
1735.     assert latex(t) == r'\operatorname{tr}\left(A B\right)'
1736. 
1737. 
1738. def test_Adjoint():
1739.     from sympy.matrices import MatrixSymbol, Adjoint, Inverse, Transpose
1740.     X = MatrixSymbol('X', 2, 2)
1741.     Y = MatrixSymbol('Y', 2, 2)
1742.     assert latex(Adjoint(X)) == r'X^{\dagger}'
1743.     assert latex(Adjoint(X + Y)) == r'\left(X + Y\right)^{\dagger}'
1744.     assert latex(Adjoint(X) + Adjoint(Y)) == r'X^{\dagger} + Y^{\dagger}'
1745.     assert latex(Adjoint(X*Y)) == r'\left(X Y\right)^{\dagger}'
1746.     assert latex(Adjoint(Y)*Adjoint(X)) == r'Y^{\dagger} X^{\dagger}'
1747.     assert latex(Adjoint(X**2)) == r'\left(X^{2}\right)^{\dagger}'
1748.     assert latex(Adjoint(X)**2) == r'\left(X^{\dagger}\right)^{2}'
1749.     assert latex(Adjoint(Inverse(X))) == r'\left(X^{-1}\right)^{\dagger}'
1750.     assert latex(Inverse(Adjoint(X))) == r'\left(X^{\dagger}\right)^{-1}'
1751.     assert latex(Adjoint(Transpose(X))) == r'\left(X^{T}\right)^{\dagger}'
1752.     assert latex(Transpose(Adjoint(X))) == r'\left(X^{\dagger}\right)^{T}'
1753.     assert latex(Transpose(Adjoint(X) + Y)) == r'\left(X^{\dagger} + Y\right)^{T}'
1754. 
1755. 
1756. def test_Transpose():
1757.     from sympy.matrices import Transpose, MatPow, HadamardPower
1758.     X = MatrixSymbol('X', 2, 2)
1759.     Y = MatrixSymbol('Y', 2, 2)
1760.     assert latex(Transpose(X)) == r'X^{T}'
1761.     assert latex(Transpose(X + Y)) == r'\left(X + Y\right)^{T}'
1762. 
1763.     assert latex(Transpose(HadamardPower(X, 2))) == \
1764.         r'\left(X^{\circ {2}}\right)^{T}'
1765.     assert latex(HadamardPower(Transpose(X), 2)) == \
1766.         r'\left(X^{T}\right)^{\circ {2}}'
1767.     assert latex(Transpose(MatPow(X, 2))) == \
1768.         r'\left(X^{2}\right)^{T}'
1769.     assert latex(MatPow(Transpose(X), 2)) == \
1770.         r'\left(X^{T}\right)^{2}'
1771. 
1772. 
1773. def test_Hadamard():
1774.     from sympy.matrices import MatrixSymbol, HadamardProduct, HadamardPower
1775.     from sympy.matrices.expressions import MatAdd, MatMul, MatPow
1776.     X = MatrixSymbol('X', 2, 2)
1777.     Y = MatrixSymbol('Y', 2, 2)
1778.     assert latex(HadamardProduct(X, Y*Y)) == r'X \circ Y^{2}'
1779.     assert latex(HadamardProduct(X, Y)*Y) == r'\left(X \circ Y\right) Y'
1780. 
1781.     assert latex(HadamardPower(X, 2)) == r'X^{\circ {2}}'
1782.     assert latex(HadamardPower(X, -1)) == r'X^{\circ \left({-1}\right)}'
1783.     assert latex(HadamardPower(MatAdd(X, Y), 2)) == \
1784.         r'\left(X + Y\right)^{\circ {2}}'
1785.     assert latex(HadamardPower(MatMul(X, Y), 2)) == \
1786.         r'\left(X Y\right)^{\circ {2}}'
1787. 
1788.     assert latex(HadamardPower(MatPow(X, -1), -1)) == \
1789.         r'\left(X^{-1}\right)^{\circ \left({-1}\right)}'
1790.     assert latex(MatPow(HadamardPower(X, -1), -1)) == \
1791.         r'\left(X^{\circ \left({-1}\right)}\right)^{-1}'
1792. 
1793.     assert latex(HadamardPower(X, n+1)) == \
1794.         r'X^{\circ \left({n + 1}\right)}'
1795. 
1796. 
1797. def test_ElementwiseApplyFunction():
1798.     from sympy.matrices import MatrixSymbol
1799.     X = MatrixSymbol('X', 2, 2)
1800.     expr = (X.T*X).applyfunc(sin)
1801.     assert latex(expr) == r"{\sin}_{\circ}\left({X^{T} X}\right)"
1802.     expr = X.applyfunc(Lambda(x, 1/x))
1803.     assert latex(expr) == r'{\left( d \mapsto \frac{1}{d} \right)}_{\circ}\left({X}\right)'
1804. 
1805. 
1806. def test_ZeroMatrix():
1807.     from sympy import ZeroMatrix
1808.     assert latex(ZeroMatrix(1, 1), mat_symbol_style='plain') == r"\mathbb{0}"
1809.     assert latex(ZeroMatrix(1, 1), mat_symbol_style='bold') == r"\mathbf{0}"
1810. 
1811. 
1812. def test_OneMatrix():
1813.     from sympy import OneMatrix
1814.     assert latex(OneMatrix(3, 4), mat_symbol_style='plain') == r"\mathbb{1}"
1815.     assert latex(OneMatrix(3, 4), mat_symbol_style='bold') == r"\mathbf{1}"
1816. 
1817. 
1818. def test_Identity():
1819.     from sympy import Identity
1820.     assert latex(Identity(1), mat_symbol_style='plain') == r"\mathbb{I}"
1821.     assert latex(Identity(1), mat_symbol_style='bold') == r"\mathbf{I}"
1822. 
1823. 
1824. def test_boolean_args_order():
1825.     syms = symbols('a:f')
1826. 
1827.     expr = And(*syms)
1828.     assert latex(expr) == 'a \\wedge b \\wedge c \\wedge d \\wedge e \\wedge f'
1829. 
1830.     expr = Or(*syms)
1831.     assert latex(expr) == 'a \\vee b \\vee c \\vee d \\vee e \\vee f'
1832. 
1833.     expr = Equivalent(*syms)
1834.     assert latex(expr) == \
1835.         'a \\Leftrightarrow b \\Leftrightarrow c \\Leftrightarrow d \\Leftrightarrow e \\Leftrightarrow f'
1836. 
1837.     expr = Xor(*syms)
1838.     assert latex(expr) == \
1839.         'a \\veebar b \\veebar c \\veebar d \\veebar e \\veebar f'
1840. 
1841. 
1842. def test_imaginary():
1843.     i = sqrt(-1)
1844.     assert latex(i) == r'i'
1845. 
1846. 
1847. def test_builtins_without_args():
1848.     assert latex(sin) == r'\sin'
1849.     assert latex(cos) == r'\cos'
1850.     assert latex(tan) == r'\tan'
1851.     assert latex(log) == r'\log'
1852.     assert latex(Ei) == r'\operatorname{Ei}'
1853.     assert latex(zeta) == r'\zeta'
1854. 
1855. 
1856. def test_latex_greek_functions():
1857.     # bug because capital greeks that have roman equivalents should not use
1858.     # \Alpha, \Beta, \Eta, etc.
1859.     s = Function('Alpha')
1860.     assert latex(s) == r'A'
1861.     assert latex(s(x)) == r'A{\left(x \right)}'
1862.     s = Function('Beta')
1863.     assert latex(s) == r'B'
1864.     s = Function('Eta')
1865.     assert latex(s) == r'H'
1866.     assert latex(s(x)) == r'H{\left(x \right)}'
1867. 
1868.     # bug because sympy.core.numbers.Pi is special
1869.     p = Function('Pi')
1870.     # assert latex(p(x)) == r'\Pi{\left(x \right)}'
1871.     assert latex(p) == r'\Pi'
1872. 
1873.     # bug because not all greeks are included
1874.     c = Function('chi')
1875.     assert latex(c(x)) == r'\chi{\left(x \right)}'
1876.     assert latex(c) == r'\chi'
1877. 
1878. 
1879. def test_translate():
1880.     s = 'Alpha'
1881.     assert translate(s) == 'A'
1882.     s = 'Beta'
1883.     assert translate(s) == 'B'
1884.     s = 'Eta'
1885.     assert translate(s) == 'H'
1886.     s = 'omicron'
1887.     assert translate(s) == 'o'
1888.     s = 'Pi'
1889.     assert translate(s) == r'\Pi'
1890.     s = 'pi'
1891.     assert translate(s) == r'\pi'
1892.     s = 'LamdaHatDOT'
1893.     assert translate(s) == r'\dot{\hat{\Lambda}}'
1894. 
1895. 
1896. def test_other_symbols():
1897.     from sympy.printing.latex import other_symbols
1898.     for s in other_symbols:
1899.         assert latex(symbols(s)) == "\\"+s
1900. 
1901. 
1902. def test_modifiers():
1903.     # Test each modifier individually in the simplest case
1904.     # (with funny capitalizations)
1905.     assert latex(symbols("xMathring")) == r"\mathring{x}"
1906.     assert latex(symbols("xCheck")) == r"\check{x}"
1907.     assert latex(symbols("xBreve")) == r"\breve{x}"
1908.     assert latex(symbols("xAcute")) == r"\acute{x}"
1909.     assert latex(symbols("xGrave")) == r"\grave{x}"
1910.     assert latex(symbols("xTilde")) == r"\tilde{x}"
1911.     assert latex(symbols("xPrime")) == r"{x}'"
1912.     assert latex(symbols("xddDDot")) == r"\ddddot{x}"
1913.     assert latex(symbols("xDdDot")) == r"\dddot{x}"
1914.     assert latex(symbols("xDDot")) == r"\ddot{x}"
1915.     assert latex(symbols("xBold")) == r"\boldsymbol{x}"
1916.     assert latex(symbols("xnOrM")) == r"\left\|{x}\right\|"
1917.     assert latex(symbols("xAVG")) == r"\left\langle{x}\right\rangle"
1918.     assert latex(symbols("xHat")) == r"\hat{x}"
1919.     assert latex(symbols("xDot")) == r"\dot{x}"
1920.     assert latex(symbols("xBar")) == r"\bar{x}"
1921.     assert latex(symbols("xVec")) == r"\vec{x}"
1922.     assert latex(symbols("xAbs")) == r"\left|{x}\right|"
1923.     assert latex(symbols("xMag")) == r"\left|{x}\right|"
1924.     assert latex(symbols("xPrM")) == r"{x}'"
1925.     assert latex(symbols("xBM")) == r"\boldsymbol{x}"
1926.     # Test strings that are *only* the names of modifiers
1927.     assert latex(symbols("Mathring")) == r"Mathring"
1928.     assert latex(symbols("Check")) == r"Check"
1929.     assert latex(symbols("Breve")) == r"Breve"
1930.     assert latex(symbols("Acute")) == r"Acute"
1931.     assert latex(symbols("Grave")) == r"Grave"
1932.     assert latex(symbols("Tilde")) == r"Tilde"
1933.     assert latex(symbols("Prime")) == r"Prime"
1934.     assert latex(symbols("DDot")) == r"\dot{D}"
1935.     assert latex(symbols("Bold")) == r"Bold"
1936.     assert latex(symbols("NORm")) == r"NORm"
1937.     assert latex(symbols("AVG")) == r"AVG"
1938.     assert latex(symbols("Hat")) == r"Hat"
1939.     assert latex(symbols("Dot")) == r"Dot"
1940.     assert latex(symbols("Bar")) == r"Bar"
1941.     assert latex(symbols("Vec")) == r"Vec"
1942.     assert latex(symbols("Abs")) == r"Abs"
1943.     assert latex(symbols("Mag")) == r"Mag"
1944.     assert latex(symbols("PrM")) == r"PrM"
1945.     assert latex(symbols("BM")) == r"BM"
1946.     assert latex(symbols("hbar")) == r"\hbar"
1947.     # Check a few combinations
1948.     assert latex(symbols("xvecdot")) == r"\dot{\vec{x}}"
1949.     assert latex(symbols("xDotVec")) == r"\vec{\dot{x}}"
1950.     assert latex(symbols("xHATNorm")) == r"\left\|{\hat{x}}\right\|"
1951.     # Check a couple big, ugly combinations
1952.     assert latex(symbols('xMathringBm_yCheckPRM__zbreveAbs')) == \
1953.         r"\boldsymbol{\mathring{x}}^{\left|{\breve{z}}\right|}_{{\check{y}}'}"
1954.     assert latex(symbols('alphadothat_nVECDOT__tTildePrime')) == \
1955.         r"\hat{\dot{\alpha}}^{{\tilde{t}}'}_{\dot{\vec{n}}}"
1956. 
1957. 
1958. def test_greek_symbols():
1959.     assert latex(Symbol('alpha'))   == r'\alpha'
1960.     assert latex(Symbol('beta'))    == r'\beta'
1961.     assert latex(Symbol('gamma'))   == r'\gamma'
1962.     assert latex(Symbol('delta'))   == r'\delta'
1963.     assert latex(Symbol('epsilon')) == r'\epsilon'
1964.     assert latex(Symbol('zeta'))    == r'\zeta'
1965.     assert latex(Symbol('eta'))     == r'\eta'
1966.     assert latex(Symbol('theta'))   == r'\theta'
1967.     assert latex(Symbol('iota'))    == r'\iota'
1968.     assert latex(Symbol('kappa'))   == r'\kappa'
1969.     assert latex(Symbol('lambda'))  == r'\lambda'
1970.     assert latex(Symbol('mu'))      == r'\mu'
1971.     assert latex(Symbol('nu'))      == r'\nu'
1972.     assert latex(Symbol('xi'))      == r'\xi'
1973.     assert latex(Symbol('omicron')) == r'o'
1974.     assert latex(Symbol('pi'))      == r'\pi'
1975.     assert latex(Symbol('rho'))     == r'\rho'
1976.     assert latex(Symbol('sigma'))   == r'\sigma'
1977.     assert latex(Symbol('tau'))     == r'\tau'
1978.     assert latex(Symbol('upsilon')) == r'\upsilon'
1979.     assert latex(Symbol('phi'))     == r'\phi'
1980.     assert latex(Symbol('chi'))     == r'\chi'
1981.     assert latex(Symbol('psi'))     == r'\psi'
1982.     assert latex(Symbol('omega'))   == r'\omega'
1983. 
1984.     assert latex(Symbol('Alpha'))   == r'A'
1985.     assert latex(Symbol('Beta'))    == r'B'
1986.     assert latex(Symbol('Gamma'))   == r'\Gamma'
1987.     assert latex(Symbol('Delta'))   == r'\Delta'
1988.     assert latex(Symbol('Epsilon')) == r'E'
1989.     assert latex(Symbol('Zeta'))    == r'Z'
1990.     assert latex(Symbol('Eta'))     == r'H'
1991.     assert latex(Symbol('Theta'))   == r'\Theta'
1992.     assert latex(Symbol('Iota'))    == r'I'
1993.     assert latex(Symbol('Kappa'))   == r'K'
1994.     assert latex(Symbol('Lambda'))  == r'\Lambda'
1995.     assert latex(Symbol('Mu'))      == r'M'
1996.     assert latex(Symbol('Nu'))      == r'N'
1997.     assert latex(Symbol('Xi'))      == r'\Xi'
1998.     assert latex(Symbol('Omicron')) == r'O'
1999.     assert latex(Symbol('Pi'))      == r'\Pi'
2000.     assert latex(Symbol('Rho'))     == r'P'

File: sympy/printing/tests/test_latex.py
Line number range: 2000 - 3000
Content:
2000.     assert latex(Symbol('Rho'))     == r'P'
2001.     assert latex(Symbol('Sigma'))   == r'\Sigma'
2002.     assert latex(Symbol('Tau'))     == r'T'
2003.     assert latex(Symbol('Upsilon')) == r'\Upsilon'
2004.     assert latex(Symbol('Phi'))     == r'\Phi'
2005.     assert latex(Symbol('Chi'))     == r'X'
2006.     assert latex(Symbol('Psi'))     == r'\Psi'
2007.     assert latex(Symbol('Omega'))   == r'\Omega'
2008. 
2009.     assert latex(Symbol('varepsilon')) == r'\varepsilon'
2010.     assert latex(Symbol('varkappa')) == r'\varkappa'
2011.     assert latex(Symbol('varphi')) == r'\varphi'
2012.     assert latex(Symbol('varpi')) == r'\varpi'
2013.     assert latex(Symbol('varrho')) == r'\varrho'
2014.     assert latex(Symbol('varsigma')) == r'\varsigma'
2015.     assert latex(Symbol('vartheta')) == r'\vartheta'
2016. 
2017. 
2018. def test_fancyset_symbols():
2019.     assert latex(S.Rationals) == '\\mathbb{Q}'
2020.     assert latex(S.Naturals) == '\\mathbb{N}'
2021.     assert latex(S.Naturals0) == '\\mathbb{N}_0'
2022.     assert latex(S.Integers) == '\\mathbb{Z}'
2023.     assert latex(S.Reals) == '\\mathbb{R}'
2024.     assert latex(S.Complexes) == '\\mathbb{C}'
2025. 
2026. 
2027. @XFAIL
2028. def test_builtin_without_args_mismatched_names():
2029.     assert latex(CosineTransform) == r'\mathcal{COS}'
2030. 
2031. 
2032. def test_builtin_no_args():
2033.     assert latex(Chi) == r'\operatorname{Chi}'
2034.     assert latex(beta) == r'\operatorname{B}'
2035.     assert latex(gamma) == r'\Gamma'
2036.     assert latex(KroneckerDelta) == r'\delta'
2037.     assert latex(DiracDelta) == r'\delta'
2038.     assert latex(lowergamma) == r'\gamma'
2039. 
2040. 
2041. def test_issue_6853():
2042.     p = Function('Pi')
2043.     assert latex(p(x)) == r"\Pi{\left(x \right)}"
2044. 
2045. 
2046. def test_Mul():
2047.     e = Mul(-2, x + 1, evaluate=False)
2048.     assert latex(e) == r'- 2 \left(x + 1\right)'
2049.     e = Mul(2, x + 1, evaluate=False)
2050.     assert latex(e) == r'2 \left(x + 1\right)'
2051.     e = Mul(S.Half, x + 1, evaluate=False)
2052.     assert latex(e) == r'\frac{x + 1}{2}'
2053.     e = Mul(y, x + 1, evaluate=False)
2054.     assert latex(e) == r'y \left(x + 1\right)'
2055.     e = Mul(-y, x + 1, evaluate=False)
2056.     assert latex(e) == r'- y \left(x + 1\right)'
2057.     e = Mul(-2, x + 1)
2058.     assert latex(e) == r'- 2 x - 2'
2059.     e = Mul(2, x + 1)
2060.     assert latex(e) == r'2 x + 2'
2061. 
2062. 
2063. def test_Pow():
2064.     e = Pow(2, 2, evaluate=False)
2065.     assert latex(e) == r'2^{2}'
2066.     assert latex(x**(Rational(-1, 3))) == r'\frac{1}{\sqrt[3]{x}}'
2067.     x2 = Symbol(r'x^2')
2068.     assert latex(x2**2) == r'\left(x^{2}\right)^{2}'
2069. 
2070. 
2071. def test_issue_7180():
2072.     assert latex(Equivalent(x, y)) == r"x \Leftrightarrow y"
2073.     assert latex(Not(Equivalent(x, y))) == r"x \not\Leftrightarrow y"
2074. 
2075. 
2076. def test_issue_8409():
2077.     assert latex(S.Half**n) == r"\left(\frac{1}{2}\right)^{n}"
2078. 
2079. 
2080. def test_issue_8470():
2081.     from sympy.parsing.sympy_parser import parse_expr
2082.     e = parse_expr("-B*A", evaluate=False)
2083.     assert latex(e) == r"A \left(- B\right)"
2084. 
2085. 
2086. def test_issue_7117():
2087.     # See also issue #5031 (hence the evaluate=False in these).
2088.     e = Eq(x + 1, 2*x)
2089.     q = Mul(2, e, evaluate=False)
2090.     assert latex(q) == r"2 \left(x + 1 = 2 x\right)"
2091.     q = Add(6, e, evaluate=False)
2092.     assert latex(q) == r"6 + \left(x + 1 = 2 x\right)"
2093.     q = Pow(e, 2, evaluate=False)
2094.     assert latex(q) == r"\left(x + 1 = 2 x\right)^{2}"
2095. 
2096. 
2097. def test_issue_15439():
2098.     x = MatrixSymbol('x', 2, 2)
2099.     y = MatrixSymbol('y', 2, 2)
2100.     assert latex((x * y).subs(y, -y)) == r"x \left(- y\right)"
2101.     assert latex((x * y).subs(y, -2*y)) == r"x \left(- 2 y\right)"
2102.     assert latex((x * y).subs(x, -x)) == r"- x y"
2103. 
2104. 
2105. def test_issue_2934():
2106.     assert latex(Symbol(r'\frac{a_1}{b_1}')) == '\\frac{a_1}{b_1}'
2107. 
2108. 
2109. def test_issue_10489():
2110.     latexSymbolWithBrace = 'C_{x_{0}}'
2111.     s = Symbol(latexSymbolWithBrace)
2112.     assert latex(s) == latexSymbolWithBrace
2113.     assert latex(cos(s)) == r'\cos{\left(C_{x_{0}} \right)}'
2114. 
2115. 
2116. def test_issue_12886():
2117.     m__1, l__1 = symbols('m__1, l__1')
2118.     assert latex(m__1**2 + l__1**2) == \
2119.         r'\left(l^{1}\right)^{2} + \left(m^{1}\right)^{2}'
2120. 
2121. 
2122. def test_issue_13559():
2123.     from sympy.parsing.sympy_parser import parse_expr
2124.     expr = parse_expr('5/1', evaluate=False)
2125.     assert latex(expr) == r"\frac{5}{1}"
2126. 
2127. 
2128. def test_issue_13651():
2129.     expr = c + Mul(-1, a + b, evaluate=False)
2130.     assert latex(expr) == r"c - \left(a + b\right)"
2131. 
2132. 
2133. def test_latex_UnevaluatedExpr():
2134.     x = symbols("x")
2135.     he = UnevaluatedExpr(1/x)
2136.     assert latex(he) == latex(1/x) == r"\frac{1}{x}"
2137.     assert latex(he**2) == r"\left(\frac{1}{x}\right)^{2}"
2138.     assert latex(he + 1) == r"1 + \frac{1}{x}"
2139.     assert latex(x*he) == r"x \frac{1}{x}"
2140. 
2141. 
2142. def test_MatrixElement_printing():
2143.     # test cases for issue #11821
2144.     A = MatrixSymbol("A", 1, 3)
2145.     B = MatrixSymbol("B", 1, 3)
2146.     C = MatrixSymbol("C", 1, 3)
2147. 
2148.     assert latex(A[0, 0]) == r"A_{0, 0}"
2149.     assert latex(3 * A[0, 0]) == r"3 A_{0, 0}"
2150. 
2151.     F = C[0, 0].subs(C, A - B)
2152.     assert latex(F) == r"\left(A - B\right)_{0, 0}"
2153. 
2154.     i, j, k = symbols("i j k")
2155.     M = MatrixSymbol("M", k, k)
2156.     N = MatrixSymbol("N", k, k)
2157.     assert latex((M*N)[i, j]) == \
2158.         r'\sum_{i_{1}=0}^{k - 1} M_{i, i_{1}} N_{i_{1}, j}'
2159. 
2160. 
2161. def test_MatrixSymbol_printing():
2162.     # test cases for issue #14237
2163.     A = MatrixSymbol("A", 3, 3)
2164.     B = MatrixSymbol("B", 3, 3)
2165.     C = MatrixSymbol("C", 3, 3)
2166. 
2167.     assert latex(-A) == r"- A"
2168.     assert latex(A - A*B - B) == r"A - A B - B"
2169.     assert latex(-A*B - A*B*C - B) == r"- A B - A B C - B"
2170. 
2171. 
2172. def test_KroneckerProduct_printing():
2173.     A = MatrixSymbol('A', 3, 3)
2174.     B = MatrixSymbol('B', 2, 2)
2175.     assert latex(KroneckerProduct(A, B)) == r'A \otimes B'
2176. 
2177. 
2178. def test_Quaternion_latex_printing():
2179.     q = Quaternion(x, y, z, t)
2180.     assert latex(q) == "x + y i + z j + t k"
2181.     q = Quaternion(x, y, z, x*t)
2182.     assert latex(q) == "x + y i + z j + t x k"
2183.     q = Quaternion(x, y, z, x + t)
2184.     assert latex(q) == r"x + y i + z j + \left(t + x\right) k"
2185. 
2186. 
2187. def test_TensorProduct_printing():
2188.     from sympy.tensor.functions import TensorProduct
2189.     A = MatrixSymbol("A", 3, 3)
2190.     B = MatrixSymbol("B", 3, 3)
2191.     assert latex(TensorProduct(A, B)) == r"A \otimes B"
2192. 
2193. 
2194. def test_WedgeProduct_printing():
2195.     from sympy.diffgeom.rn import R2
2196.     from sympy.diffgeom import WedgeProduct
2197.     wp = WedgeProduct(R2.dx, R2.dy)
2198.     assert latex(wp) == r"\operatorname{d}x \wedge \operatorname{d}y"
2199. 
2200. 
2201. def test_issue_14041():
2202.     import sympy.physics.mechanics as me
2203. 
2204.     A_frame = me.ReferenceFrame('A')
2205.     thetad, phid = me.dynamicsymbols('theta, phi', 1)
2206.     L = Symbol('L')
2207. 
2208.     assert latex(L*(phid + thetad)**2*A_frame.x) == \
2209.         r"L \left(\dot{\phi} + \dot{\theta}\right)^{2}\mathbf{\hat{a}_x}"
2210.     assert latex((phid + thetad)**2*A_frame.x) == \
2211.         r"\left(\dot{\phi} + \dot{\theta}\right)^{2}\mathbf{\hat{a}_x}"
2212.     assert latex((phid*thetad)**a*A_frame.x) == \
2213.         r"\left(\dot{\phi} \dot{\theta}\right)^{a}\mathbf{\hat{a}_x}"
2214. 
2215. 
2216. def test_issue_9216():
2217.     expr_1 = Pow(1, -1, evaluate=False)
2218.     assert latex(expr_1) == r"1^{-1}"
2219. 
2220.     expr_2 = Pow(1, Pow(1, -1, evaluate=False), evaluate=False)
2221.     assert latex(expr_2) == r"1^{1^{-1}}"
2222. 
2223.     expr_3 = Pow(3, -2, evaluate=False)
2224.     assert latex(expr_3) == r"\frac{1}{9}"
2225. 
2226.     expr_4 = Pow(1, -2, evaluate=False)
2227.     assert latex(expr_4) == r"1^{-2}"
2228. 
2229. 
2230. def test_latex_printer_tensor():
2231.     from sympy.tensor.tensor import TensorIndexType, tensor_indices, TensorHead, tensor_heads
2232.     L = TensorIndexType("L")
2233.     i, j, k, l = tensor_indices("i j k l", L)
2234.     i0 = tensor_indices("i_0", L)
2235.     A, B, C, D = tensor_heads("A B C D", [L])
2236.     H = TensorHead("H", [L, L])
2237.     K = TensorHead("K", [L, L, L, L])
2238. 
2239.     assert latex(i) == "{}^{i}"
2240.     assert latex(-i) == "{}_{i}"
2241. 
2242.     expr = A(i)
2243.     assert latex(expr) == "A{}^{i}"
2244. 
2245.     expr = A(i0)
2246.     assert latex(expr) == "A{}^{i_{0}}"
2247. 
2248.     expr = A(-i)
2249.     assert latex(expr) == "A{}_{i}"
2250. 
2251.     expr = -3*A(i)
2252.     assert latex(expr) == r"-3A{}^{i}"
2253. 
2254.     expr = K(i, j, -k, -i0)
2255.     assert latex(expr) == "K{}^{ij}{}_{ki_{0}}"
2256. 
2257.     expr = K(i, -j, -k, i0)
2258.     assert latex(expr) == "K{}^{i}{}_{jk}{}^{i_{0}}"
2259. 
2260.     expr = K(i, -j, k, -i0)
2261.     assert latex(expr) == "K{}^{i}{}_{j}{}^{k}{}_{i_{0}}"
2262. 
2263.     expr = H(i, -j)
2264.     assert latex(expr) == "H{}^{i}{}_{j}"
2265. 
2266.     expr = H(i, j)
2267.     assert latex(expr) == "H{}^{ij}"
2268. 
2269.     expr = H(-i, -j)
2270.     assert latex(expr) == "H{}_{ij}"
2271. 
2272.     expr = (1+x)*A(i)
2273.     assert latex(expr) == r"\left(x + 1\right)A{}^{i}"
2274. 
2275.     expr = H(i, -i)
2276.     assert latex(expr) == "H{}^{L_{0}}{}_{L_{0}}"
2277. 
2278.     expr = H(i, -j)*A(j)*B(k)
2279.     assert latex(expr) == "H{}^{i}{}_{L_{0}}A{}^{L_{0}}B{}^{k}"
2280. 
2281.     expr = A(i) + 3*B(i)
2282.     assert latex(expr) == "3B{}^{i} + A{}^{i}"
2283. 
2284.     # Test ``TensorElement``:
2285.     from sympy.tensor.tensor import TensorElement
2286. 
2287.     expr = TensorElement(K(i, j, k, l), {i: 3, k: 2})
2288.     assert latex(expr) == 'K{}^{i=3,j,k=2,l}'
2289. 
2290.     expr = TensorElement(K(i, j, k, l), {i: 3})
2291.     assert latex(expr) == 'K{}^{i=3,jkl}'
2292. 
2293.     expr = TensorElement(K(i, -j, k, l), {i: 3, k: 2})
2294.     assert latex(expr) == 'K{}^{i=3}{}_{j}{}^{k=2,l}'
2295. 
2296.     expr = TensorElement(K(i, -j, k, -l), {i: 3, k: 2})
2297.     assert latex(expr) == 'K{}^{i=3}{}_{j}{}^{k=2}{}_{l}'
2298. 
2299.     expr = TensorElement(K(i, j, -k, -l), {i: 3, -k: 2})
2300.     assert latex(expr) == 'K{}^{i=3,j}{}_{k=2,l}'
2301. 
2302.     expr = TensorElement(K(i, j, -k, -l), {i: 3})
2303.     assert latex(expr) == 'K{}^{i=3,j}{}_{kl}'
2304. 
2305. 
2306. def test_multiline_latex():
2307.     a, b, c, d, e, f = symbols('a b c d e f')
2308.     expr = -a + 2*b -3*c +4*d -5*e
2309.     expected = r"\begin{eqnarray}" + "\n"\
2310.     r"f & = &- a \nonumber\\" + "\n"\
2311.     r"& & + 2 b \nonumber\\" + "\n"\
2312.     r"& & - 3 c \nonumber\\" + "\n"\
2313.     r"& & + 4 d \nonumber\\" + "\n"\
2314.     r"& & - 5 e " + "\n"\
2315.     r"\end{eqnarray}"
2316.     assert multiline_latex(f, expr, environment="eqnarray") == expected
2317. 
2318.     expected2 = r'\begin{eqnarray}' + '\n'\
2319.     r'f & = &- a + 2 b \nonumber\\' + '\n'\
2320.     r'& & - 3 c + 4 d \nonumber\\' + '\n'\
2321.     r'& & - 5 e ' + '\n'\
2322.     r'\end{eqnarray}'
2323. 
2324.     assert multiline_latex(f, expr, 2, environment="eqnarray") == expected2
2325. 
2326.     expected3 = r'\begin{eqnarray}' + '\n'\
2327.     r'f & = &- a + 2 b - 3 c \nonumber\\'+ '\n'\
2328.     r'& & + 4 d - 5 e ' + '\n'\
2329.     r'\end{eqnarray}'
2330. 
2331.     assert multiline_latex(f, expr, 3, environment="eqnarray") == expected3
2332. 
2333.     expected3dots = r'\begin{eqnarray}' + '\n'\
2334.     r'f & = &- a + 2 b - 3 c \dots\nonumber\\'+ '\n'\
2335.     r'& & + 4 d - 5 e ' + '\n'\
2336.     r'\end{eqnarray}'
2337. 
2338.     assert multiline_latex(f, expr, 3, environment="eqnarray", use_dots=True) == expected3dots
2339. 
2340.     expected3align = r'\begin{align*}' + '\n'\
2341.     r'f = &- a + 2 b - 3 c \\'+ '\n'\
2342.     r'& + 4 d - 5 e ' + '\n'\
2343.     r'\end{align*}'
2344. 
2345.     assert multiline_latex(f, expr, 3) == expected3align
2346.     assert multiline_latex(f, expr, 3, environment='align*') == expected3align
2347. 
2348.     expected2ieee = r'\begin{IEEEeqnarray}{rCl}' + '\n'\
2349.     r'f & = &- a + 2 b \nonumber\\' + '\n'\
2350.     r'& & - 3 c + 4 d \nonumber\\' + '\n'\
2351.     r'& & - 5 e ' + '\n'\
2352.     r'\end{IEEEeqnarray}'
2353. 
2354.     assert multiline_latex(f, expr, 2, environment="IEEEeqnarray") == expected2ieee
2355. 
2356.     raises(ValueError, lambda: multiline_latex(f, expr, environment="foo"))
2357. 
2358. def test_issue_15353():
2359.     from sympy import ConditionSet, Tuple, FiniteSet, S, sin, cos
2360.     a, x = symbols('a x')
2361.     # Obtained from nonlinsolve([(sin(a*x)),cos(a*x)],[x,a])
2362.     sol = ConditionSet(
2363.         Tuple(x, a), Eq(sin(a*x), 0) & Eq(cos(a*x), 0), S.Complexes**2)
2364.     assert latex(sol) == \
2365.         r'\left\{\left( x, \  a\right) \mid \left( x, \  a\right) \in ' \
2366.         r'\mathbb{C}^{2} \wedge \sin{\left(a x \right)} = 0 \wedge ' \
2367.         r'\cos{\left(a x \right)} = 0 \right\}'
2368. 
2369. 
2370. def test_trace():
2371.     # Issue 15303
2372.     from sympy import trace
2373.     A = MatrixSymbol("A", 2, 2)
2374.     assert latex(trace(A)) == r"\operatorname{tr}\left(A \right)"
2375.     assert latex(trace(A**2)) == r"\operatorname{tr}\left(A^{2} \right)"
2376. 
2377. 
2378. def test_print_basic():
2379.     # Issue 15303
2380.     from sympy import Basic, Expr
2381. 
2382.     # dummy class for testing printing where the function is not
2383.     # implemented in latex.py
2384.     class UnimplementedExpr(Expr):
2385.         def __new__(cls, e):
2386.             return Basic.__new__(cls, e)
2387. 
2388.     # dummy function for testing
2389.     def unimplemented_expr(expr):
2390.         return UnimplementedExpr(expr).doit()
2391. 
2392.     # override class name to use superscript / subscript
2393.     def unimplemented_expr_sup_sub(expr):
2394.         result = UnimplementedExpr(expr)
2395.         result.__class__.__name__ = 'UnimplementedExpr_x^1'
2396.         return result
2397. 
2398.     assert latex(unimplemented_expr(x)) == r'UnimplementedExpr\left(x\right)'
2399.     assert latex(unimplemented_expr(x**2)) == \
2400.         r'UnimplementedExpr\left(x^{2}\right)'
2401.     assert latex(unimplemented_expr_sup_sub(x)) == \
2402.         r'UnimplementedExpr^{1}_{x}\left(x\right)'
2403. 
2404. 
2405. def test_MatrixSymbol_bold():
2406.     # Issue #15871
2407.     from sympy import trace
2408.     A = MatrixSymbol("A", 2, 2)
2409.     assert latex(trace(A), mat_symbol_style='bold') == \
2410.         r"\operatorname{tr}\left(\mathbf{A} \right)"
2411.     assert latex(trace(A), mat_symbol_style='plain') == \
2412.         r"\operatorname{tr}\left(A \right)"
2413. 
2414.     A = MatrixSymbol("A", 3, 3)
2415.     B = MatrixSymbol("B", 3, 3)
2416.     C = MatrixSymbol("C", 3, 3)
2417. 
2418.     assert latex(-A, mat_symbol_style='bold') == r"- \mathbf{A}"
2419.     assert latex(A - A*B - B, mat_symbol_style='bold') == \
2420.         r"\mathbf{A} - \mathbf{A} \mathbf{B} - \mathbf{B}"
2421.     assert latex(-A*B - A*B*C - B, mat_symbol_style='bold') == \
2422.         r"- \mathbf{A} \mathbf{B} - \mathbf{A} \mathbf{B} \mathbf{C} - \mathbf{B}"
2423. 
2424.     A = MatrixSymbol("A_k", 3, 3)
2425.     assert latex(A, mat_symbol_style='bold') == r"\mathbf{A_{k}}"
2426. 
2427. 
2428. def test_imaginary_unit():
2429.     assert latex(1 + I) == '1 + i'
2430.     assert latex(1 + I, imaginary_unit='i') == '1 + i'
2431.     assert latex(1 + I, imaginary_unit='j') == '1 + j'
2432.     assert latex(1 + I, imaginary_unit='foo') == '1 + foo'
2433.     assert latex(I, imaginary_unit="ti") == '\\text{i}'
2434.     assert latex(I, imaginary_unit="tj") == '\\text{j}'
2435. 
2436. 
2437. def test_text_re_im():
2438.     assert latex(im(x), gothic_re_im=True) ==  r'\Im{\left(x\right)}'
2439.     assert latex(im(x), gothic_re_im=False) ==  r'\operatorname{im}{\left(x\right)}'
2440.     assert latex(re(x), gothic_re_im=True) ==  r'\Re{\left(x\right)}'
2441.     assert latex(re(x), gothic_re_im=False) ==  r'\operatorname{re}{\left(x\right)}'
2442. 
2443. 
2444. def test_DiffGeomMethods():
2445.     from sympy.diffgeom import Manifold, Patch, CoordSystem, BaseScalarField, Differential
2446.     from sympy.diffgeom.rn import R2
2447.     m = Manifold('M', 2)
2448.     assert latex(m) == r'\text{M}'
2449.     p = Patch('P', m)
2450.     assert latex(p) == r'\text{P}_{\text{M}}'
2451.     rect = CoordSystem('rect', p)
2452.     assert latex(rect) == r'\text{rect}^{\text{P}}_{\text{M}}'
2453.     b = BaseScalarField(rect, 0)
2454.     assert latex(b) ==  r'\mathbf{rect_{0}}'
2455. 
2456.     g = Function('g')
2457.     s_field = g(R2.x, R2.y)
2458.     assert latex(Differential(s_field)) == \
2459.         r'\operatorname{d}\left(g{\left(\mathbf{x},\mathbf{y} \right)}\right)'
2460. 
2461. 
2462. def test_unit_printing():
2463.     assert latex(5*meter) == r'5 \text{m}'
2464.     assert latex(3*gibibyte) == r'3 \text{gibibyte}'
2465.     assert latex(4*microgram/second) == r'\frac{4 \mu\text{g}}{\text{s}}'
2466. 
2467. 
2468. def test_issue_17092():
2469.     x_star = Symbol('x^*')
2470.     assert latex(Derivative(x_star, x_star,2)) == r'\frac{d^{2}}{d \left(x^{*}\right)^{2}} x^{*}'
2471. 
2472. 
2473. def test_latex_decimal_separator():
2474. 
2475.     x, y, z, t = symbols('x y z t')
2476.     k, m, n = symbols('k m n', integer=True)
2477.     f, g, h = symbols('f g h', cls=Function)
2478. 
2479.     # comma decimal_separator
2480.     assert(latex([1, 2.3, 4.5], decimal_separator='comma') == r'\left[ 1; \  2{,}3; \  4{,}5\right]')
2481.     assert(latex(FiniteSet(1, 2.3, 4.5), decimal_separator='comma') == r'\left\{1; 2{,}3; 4{,}5\right\}')
2482.     assert(latex((1, 2.3, 4.6), decimal_separator = 'comma') == r'\left( 1; \  2{,}3; \  4{,}6\right)')
2483. 
2484.     # period decimal_separator
2485.     assert(latex([1, 2.3, 4.5], decimal_separator='period') == r'\left[ 1, \  2.3, \  4.5\right]' )
2486.     assert(latex(FiniteSet(1, 2.3, 4.5), decimal_separator='period') == r'\left\{1, 2.3, 4.5\right\}')
2487.     assert(latex((1, 2.3, 4.6), decimal_separator = 'period') == r'\left( 1, \  2.3, \  4.6\right)')
2488. 
2489.     # default decimal_separator
2490.     assert(latex([1, 2.3, 4.5]) == r'\left[ 1, \  2.3, \  4.5\right]')
2491.     assert(latex(FiniteSet(1, 2.3, 4.5)) == r'\left\{1, 2.3, 4.5\right\}')
2492.     assert(latex((1, 2.3, 4.6)) == r'\left( 1, \  2.3, \  4.6\right)')
2493. 
2494.     assert(latex(Mul(3.4,5.3), decimal_separator = 'comma') ==r'18{,}02')
2495.     assert(latex(3.4*5.3, decimal_separator = 'comma')==r'18{,}02')
2496.     x = symbols('x')
2497.     y = symbols('y')
2498.     z = symbols('z')
2499.     assert(latex(x*5.3 + 2**y**3.4 + 4.5 + z, decimal_separator = 'comma')== r'2^{y^{3{,}4}} + 5{,}3 x + z + 4{,}5')
2500. 
2501.     assert(latex(0.987, decimal_separator='comma') == r'0{,}987')
2502.     assert(latex(S(0.987), decimal_separator='comma')== r'0{,}987')
2503.     assert(latex(.3, decimal_separator='comma')== r'0{,}3')
2504.     assert(latex(S(.3), decimal_separator='comma')== r'0{,}3')
2505. 
2506. 
2507.     assert(latex(5.8*10**(-7), decimal_separator='comma') ==r'5{,}8e-07')
2508.     assert(latex(S(5.7)*10**(-7), decimal_separator='comma')==r'5{,}7 \cdot 10^{-7}')
2509.     assert(latex(S(5.7*10**(-7)), decimal_separator='comma')==r'5{,}7 \cdot 10^{-7}')
2510. 
2511.     x = symbols('x')
2512.     assert(latex(1.2*x+3.4, decimal_separator='comma')==r'1{,}2 x + 3{,}4')
2513.     assert(latex(FiniteSet(1, 2.3, 4.5), decimal_separator='period')==r'\left\{1, 2.3, 4.5\right\}')
2514. 
2515.     # Error Handling tests
2516.     raises(ValueError, lambda: latex([1,2.3,4.5], decimal_separator='non_existing_decimal_separator_in_list'))
2517.     raises(ValueError, lambda: latex(FiniteSet(1,2.3,4.5), decimal_separator='non_existing_decimal_separator_in_set'))
2518.     raises(ValueError, lambda: latex((1,2.3,4.5), decimal_separator='non_existing_decimal_separator_in_tuple'))
2519. 
2520. 
2521. def test_issue_17857():
2522.     assert latex(Range(-oo, oo)) == r'\left\{\ldots, -1, 0, 1, \ldots\right\}'
2523.     assert latex(Range(oo, -oo, -1)) == r'\left\{\ldots, 1, 0, -1, \ldots\right\}'


--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to a given query and the refinement query, and return your response in the specified format!
EVERY context object MUST include: reasoning, relative_path, start_line, and end_line.

2025-10-06 08:59:36,457 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='This block contains all the necessary imports from the `sympy` library and other utilities required to run the test cases in this file. Including this is essential for making the test cases self-contained and executable as requested.', relative_path='sympy/printing/tests/test_latex.py', start_line=1, end_line=51), ContextOutput(reasoning='This context defines the global symbolic variables `x, y, z, t, a, b, c, k, m, n` that are used throughout the test file. These definitions are crucial for the execution of the selected test cases.', relative_path='sympy/printing/tests/test_latex.py', start_line=57, end_line=58), ContextOutput(reasoning='This is the most direct test case as it deals with the `Subs` class, which is at the core of the reported issue. It shows the default LaTeX printing for a `Subs` object, which is the functionality that needs to be modified.', relative_path='sympy/printing/tests/test_latex.py', start_line=675, end_line=678), ContextOutput(reasoning="The bug is about a `Subs` object inside a `Mul` expression. This test case is highly relevant because it thoroughly tests how `Mul` expressions handle parenthesizing for other expression types like `Add`. The assertion `latex(Mul(-2, x + 1, evaluate=False)) == r'- 2 \\left(x + 1\\right)'` is a key example of the expected behavior for parenthesizing.", relative_path='sympy/printing/tests/test_latex.py', start_line=2046, end_line=2061), ContextOutput(reasoning='This test case is structurally very similar to the reported bug. It checks the parenthesizing of an `Eq` object inside a `Mul` expression (`2 * Eq(...)`). This is a perfect analogy for the bug (`3 * Subs(...)`) and demonstrates how multiplication with other complex objects is handled, highlighting the inconsistency with `Subs`.', relative_path='sympy/printing/tests/test_latex.py', start_line=2086, end_line=2095), ContextOutput(reasoning='This test case shows how a `Piecewise` object is parenthesized when it is part of a multiplication (`A*p`). This provides another example of the expected parenthesizing logic for complex expressions within a `Mul` operation, which is directly related to the problem with `Subs`.', relative_path='sympy/printing/tests/test_latex.py', start_line=1213, end_line=1232), ContextOutput(reasoning='This test involves the `.subs()` method and matrix expressions, but it is relevant because it deals with substitution and the automatic parenthesizing of a resulting negative term within a multiplication (`x * (-y)`). The original bug involves `Subs(-x+y, ...)` which also contains a negative term, so this test provides insight into how related scenarios are handled.', relative_path='sympy/printing/tests/test_latex.py', start_line=2097, end_line=2103)]
2025-10-06 08:59:36,458 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - INFO - Context extraction complete, returning context [Context(relative_path='sympy/printing/tests/test_latex.py', content='209. def test_latex_vector_expressions():\n210.     A = CoordSys3D(\'A\')\n211. \n212.     assert latex(Cross(A.i, A.j*A.x*3+A.k)) == \\\n213.         r"\\mathbf{\\hat{i}_{A}} \\times \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}} + \\mathbf{\\hat{k}_{A}}\\right)"\n214.     assert latex(Cross(A.i, A.j)) == \\\n215.         r"\\mathbf{\\hat{i}_{A}} \\times \\mathbf{\\hat{j}_{A}}"\n216.     assert latex(x*Cross(A.i, A.j)) == \\\n217.         r"x \\left(\\mathbf{\\hat{i}_{A}} \\times \\mathbf{\\hat{j}_{A}}\\right)"\n218.     assert latex(Cross(x*A.i, A.j)) == \\\n219.         r\'- \\mathbf{\\hat{j}_{A}} \\times \\left((x)\\mathbf{\\hat{i}_{A}}\\right)\'\n220. \n221.     assert latex(Curl(3*A.x*A.j)) == \\\n222.         r"\\nabla\\times \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)"\n223.     assert latex(Curl(3*A.x*A.j+A.i)) == \\\n224.         r"\\nabla\\times \\left(\\mathbf{\\hat{i}_{A}} + (3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)"\n225.     assert latex(Curl(3*x*A.x*A.j)) == \\\n226.         r"\\nabla\\times \\left((3 \\mathbf{{x}_{A}} x)\\mathbf{\\hat{j}_{A}}\\right)"\n227.     assert latex(x*Curl(3*A.x*A.j)) == \\\n228.         r"x \\left(\\nabla\\times \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)\\right)"\n229. \n230.     assert latex(Divergence(3*A.x*A.j+A.i)) == \\\n231.         r"\\nabla\\cdot \\left(\\mathbf{\\hat{i}_{A}} + (3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)"\n232.     assert latex(Divergence(3*A.x*A.j)) == \\\n233.         r"\\nabla\\cdot \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)"\n234.     assert latex(x*Divergence(3*A.x*A.j)) == \\\n235.         r"x \\left(\\nabla\\cdot \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)\\right)"\n236. \n237.     assert latex(Dot(A.i, A.j*A.x*3+A.k)) == \\\n238.         r"\\mathbf{\\hat{i}_{A}} \\cdot \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}} + \\mathbf{\\hat{k}_{A}}\\right)"\n239.     assert latex(Dot(A.i, A.j)) == \\\n240.         r"\\mathbf{\\hat{i}_{A}} \\cdot \\mathbf{\\hat{j}_{A}}"\n241.     assert latex(Dot(x*A.i, A.j)) == \\\n242.         r"\\mathbf{\\hat{j}_{A}} \\cdot \\left((x)\\mathbf{\\hat{i}_{A}}\\right)"\n243.     assert latex(x*Dot(A.i, A.j)) == \\\n244.         r"x \\left(\\mathbf{\\hat{i}_{A}} \\cdot \\mathbf{\\hat{j}_{A}}\\right)"\n245. \n246.     assert latex(Gradient(A.x)) == r"\\nabla \\mathbf{{x}_{A}}"\n247.     assert latex(Gradient(A.x + 3*A.y)) == \\\n248.         r"\\nabla \\left(\\mathbf{{x}_{A}} + 3 \\mathbf{{y}_{A}}\\right)"\n249.     assert latex(x*Gradient(A.x)) == r"x \\left(\\nabla \\mathbf{{x}_{A}}\\right)"\n250.     assert latex(Gradient(x*A.x)) == r"\\nabla \\left(\\mathbf{{x}_{A}} x\\right)"\n251. \n252.     assert latex(Laplacian(A.x)) == r"\\triangle \\mathbf{{x}_{A}}"\n253.     assert latex(Laplacian(A.x + 3*A.y)) == \\\n254.         r"\\triangle \\left(\\mathbf{{x}_{A}} + 3 \\mathbf{{y}_{A}}\\right)"\n255.     assert latex(x*Laplacian(A.x)) == r"x \\left(\\triangle \\mathbf{{x}_{A}}\\right)"\n256.     assert latex(Laplacian(x*A.x)) == r"\\triangle \\left(\\mathbf{{x}_{A}} x\\right)"\n257. ', start_line_number=209, end_line_number=257), Context(relative_path='sympy/printing/tests/test_latex.py', content='192. def test_latex_permutation():\n193.     assert latex(Permutation(1, 2, 4)) == r"\\left( 1\\; 2\\; 4\\right)"\n194.     assert latex(Permutation(1, 2)(4, 5, 6)) == \\\n195.         r"\\left( 1\\; 2\\right)\\left( 4\\; 5\\; 6\\right)"\n196.     assert latex(Permutation()) == r"\\left( \\right)"\n197.     assert latex(Permutation(2, 4)*Permutation(5)) == \\\n198.         r"\\left( 2\\; 4\\right)\\left( 5\\right)"\n199.     assert latex(Permutation(5)) == r"\\left( 5\\right)"\n200. ', start_line_number=192, end_line_number=200), Context(relative_path='sympy/printing/tests/test_latex.py', content='170. def test_latex_SingularityFunction():\n171.     assert latex(SingularityFunction(x, 4, 5)) == \\\n172.         r"{\\left\\langle x - 4 \\right\\rangle}^{5}"\n173.     assert latex(SingularityFunction(x, -3, 4)) == \\\n174.         r"{\\left\\langle x + 3 \\right\\rangle}^{4}"\n175.     assert latex(SingularityFunction(x, 0, 4)) == \\\n176.         r"{\\left\\langle x \\right\\rangle}^{4}"\n177.     assert latex(SingularityFunction(x, a, n)) == \\\n178.         r"{\\left\\langle - a + x \\right\\rangle}^{n}"\n179.     assert latex(SingularityFunction(x, 4, -2)) == \\\n180.         r"{\\left\\langle x - 4 \\right\\rangle}^{-2}"\n181.     assert latex(SingularityFunction(x, 4, -1)) == \\\n182.         r"{\\left\\langle x - 4 \\right\\rangle}^{-1}"\n183. ', start_line_number=170, end_line_number=183), Context(relative_path='sympy/printing/tests/test_latex.py', content='357.     assert latex(factorial(k)) == r"k!"\n358.     assert latex(factorial(-k)) == r"\\left(- k\\right)!"\n359.     assert latex(factorial(k)**2) == r"k!^{2}"', start_line_number=357, end_line_number=359), Context(relative_path='sympy/printing/tests/test_latex.py', content="675. def test_latex_subs():\n676.     assert latex(Subs(x*y, (\n677.         x, y), (1, 2))) == r'\\left. x y \\right|_{\\substack{ x=1\\\\ y=2 }}'\n678. ", start_line_number=675, end_line_number=678), Context(relative_path='sympy/printing/tests/test_latex.py', content="2046. def test_Mul():\n2047.     e = Mul(-2, x + 1, evaluate=False)\n2048.     assert latex(e) == r'- 2 \\left(x + 1\\right)'\n2049.     e = Mul(2, x + 1, evaluate=False)\n2050.     assert latex(e) == r'2 \\left(x + 1\\right)'\n2051.     e = Mul(S.Half, x + 1, evaluate=False)\n2052.     assert latex(e) == r'\\frac{x + 1}{2}'\n2053.     e = Mul(y, x + 1, evaluate=False)\n2054.     assert latex(e) == r'y \\left(x + 1\\right)'\n2055.     e = Mul(-y, x + 1, evaluate=False)\n2056.     assert latex(e) == r'- y \\left(x + 1\\right)'\n2057.     e = Mul(-2, x + 1)\n2058.     assert latex(e) == r'- 2 x - 2'\n2059.     e = Mul(2, x + 1)\n2060.     assert latex(e) == r'2 x + 2'\n2061. ", start_line_number=2046, end_line_number=2061), Context(relative_path='sympy/printing/tests/test_latex.py', content='1213. def test_latex_Piecewise():\n1214.     p = Piecewise((x, x < 1), (x**2, True))\n1215.     assert latex(p) == "\\\\begin{cases} x & \\\\text{for}\\\\: x < 1 \\\\\\\\x^{2} &" \\\n1216.                        " \\\\text{otherwise} \\\\end{cases}"\n1217.     assert latex(p, itex=True) == \\\n1218.         "\\\\begin{cases} x & \\\\text{for}\\\\: x \\\\lt 1 \\\\\\\\x^{2} &" \\\n1219.         " \\\\text{otherwise} \\\\end{cases}"\n1220.     p = Piecewise((x, x < 0), (0, x >= 0))\n1221.     assert latex(p) == \'\\\\begin{cases} x & \\\\text{for}\\\\: x < 0 \\\\\\\\0 &\' \\\n1222.                        \' \\\\text{otherwise} \\\\end{cases}\'\n1223.     A, B = symbols("A B", commutative=False)\n1224.     p = Piecewise((A**2, Eq(A, B)), (A*B, True))\n1225.     s = r"\\begin{cases} A^{2} & \\text{for}\\: A = B \\\\A B & \\text{otherwise} \\end{cases}"\n1226.     assert latex(p) == s\n1227.     assert latex(A*p) == r"A \\left(%s\\right)" % s\n1228.     assert latex(p*A) == r"\\left(%s\\right) A" % s\n1229.     assert latex(Piecewise((x, x < 1), (x**2, x < 2))) == \\\n1230.         \'\\\\begin{cases} x & \' \\\n1231.         \'\\\\text{for}\\\\: x < 1 \\\\\\\\x^{2} & \\\\text{for}\\\\: x < 2 \\\\end{cases}\'\n1232. ', start_line_number=1213, end_line_number=1232), Context(relative_path='sympy/printing/tests/test_latex.py', content='2086. def test_issue_7117():\n2087.     # See also issue #5031 (hence the evaluate=False in these).\n2088.     e = Eq(x + 1, 2*x)\n2089.     q = Mul(2, e, evaluate=False)\n2090.     assert latex(q) == r"2 \\left(x + 1 = 2 x\\right)"\n2091.     q = Add(6, e, evaluate=False)\n2092.     assert latex(q) == r"6 + \\left(x + 1 = 2 x\\right)"\n2093.     q = Pow(e, 2, evaluate=False)\n2094.     assert latex(q) == r"\\left(x + 1 = 2 x\\right)^{2}"\n2095. ', start_line_number=2086, end_line_number=2095), Context(relative_path='sympy/printing/tests/test_latex.py', content="533.     assert latex(Mod(x, 7)) == r'x\\bmod{7}'\n534.     assert latex(Mod(x + 1, 7)) == r'\\left(x + 1\\right)\\bmod{7}'\n535.     assert latex(Mod(2 * x, 7)) == r'2 x\\bmod{7}'\n536.     assert latex(Mod(x, 7) + 1) == r'\\left(x\\bmod{7}\\right) + 1'\n537.     assert latex(2 * Mod(x, 7)) == r'2 \\left(x\\bmod{7}\\right)'\n538. ", start_line_number=533, end_line_number=538), Context(relative_path='sympy/printing/tests/test_latex.py', content='1. from sympy import (\n2.     Add, Abs, Chi, Ci, CosineTransform, Dict, Ei, Eq, FallingFactorial,\n3.     FiniteSet, Float, FourierTransform, Function, Indexed, IndexedBase, Integral,\n4.     Interval, InverseCosineTransform, InverseFourierTransform, Derivative,\n5.     InverseLaplaceTransform, InverseMellinTransform, InverseSineTransform,\n6.     Lambda, LaplaceTransform, Limit, Matrix, Max, MellinTransform, Min, Mul,\n7.     Order, Piecewise, Poly, ring, field, ZZ, Pow, Product, Range, Rational,\n8.     RisingFactorial, rootof, RootSum, S, Shi, Si, SineTransform, Subs,\n9.     Sum, Symbol, ImageSet, Tuple, Ynm, Znm, arg, asin, acsc, Mod,\n10.     assoc_laguerre, assoc_legendre, beta, binomial, catalan, ceiling, Complement,\n11.     chebyshevt, chebyshevu, conjugate, cot, coth, diff, dirichlet_eta, euler,\n12.     exp, expint, factorial, factorial2, floor, gamma, gegenbauer, hermite,\n13.     hyper, im, jacobi, laguerre, legendre, lerchphi, log, frac,\n14.     meijerg, oo, polar_lift, polylog, re, root, sin, sqrt, symbols,\n15.     uppergamma, zeta, subfactorial, totient, elliptic_k, elliptic_f,\n16.     elliptic_e, elliptic_pi, cos, tan, Wild, true, false, Equivalent, Not,\n17.     Contains, divisor_sigma, SeqPer, SeqFormula,\n18.     SeqAdd, SeqMul, fourier_series, pi, ConditionSet, ComplexRegion, fps,\n19.     AccumBounds, reduced_totient, primenu, primeomega, SingularityFunction,\n20.     stieltjes, mathieuc, mathieus, mathieucprime, mathieusprime,\n21.     UnevaluatedExpr, Quaternion, I, KroneckerProduct, LambertW)\n22. \n23. from sympy.ntheory.factor_ import udivisor_sigma\n24. \n25. from sympy.abc import mu, tau\n26. from sympy.printing.latex import (latex, translate, greek_letters_set,\n27.                                   tex_greek_dictionary, multiline_latex)\n28. from sympy.tensor.array import (ImmutableDenseNDimArray,\n29.                                 ImmutableSparseNDimArray,\n30.                                 MutableSparseNDimArray,\n31.                                 MutableDenseNDimArray,\n32.                                 tensorproduct)\n33. from sympy.utilities.pytest import XFAIL, raises\n34. from sympy.functions import DiracDelta, Heaviside, KroneckerDelta, LeviCivita\n35. from sympy.functions.combinatorial.numbers import bernoulli, bell, lucas, \\\n36.     fibonacci, tribonacci\n37. from sympy.logic import Implies\n38. from sympy.logic.boolalg import And, Or, Xor\n39. from sympy.physics.quantum import Commutator, Operator\n40. from sympy.physics.units import degree, radian, kg, meter, gibibyte, microgram, second\n41. from sympy.core.trace import Tr\n42. from sympy.core.compatibility import range\n43. from sympy.combinatorics.permutations import Cycle, Permutation\n44. from sympy import MatrixSymbol, ln\n45. from sympy.vector import CoordSys3D, Cross, Curl, Dot, Divergence, Gradient, Laplacian\n46. from sympy.sets.setexpr import SetExpr\n47. from sympy.sets.sets import \\\n48.     Union, Intersection, Complement, SymmetricDifference, ProductSet\n49. \n50. import sympy as sym\n51. ', start_line_number=1, end_line_number=51), Context(relative_path='sympy/printing/tests/test_latex.py', content="57. x, y, z, t, a, b, c = symbols('x y z t a b c')\n58. k, m, n = symbols('k m n', integer=True)", start_line_number=57, end_line_number=58), Context(relative_path='sympy/printing/tests/test_latex.py', content='2097. def test_issue_15439():\n2098.     x = MatrixSymbol(\'x\', 2, 2)\n2099.     y = MatrixSymbol(\'y\', 2, 2)\n2100.     assert latex((x * y).subs(y, -y)) == r"x \\left(- y\\right)"\n2101.     assert latex((x * y).subs(y, -2*y)) == r"x \\left(- 2 y\\right)"\n2102.     assert latex((x * y).subs(x, -x)) == r"- x y"\n2103. ', start_line_number=2097, end_line_number=2103)]
2025-10-06 08:59:36,459 - thread-139660780025408.app.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-10-06 08:59:36,459 - thread-139660780025408.app.lang_graph.nodes.context_refine_node - INFO - Reached max_refined_query_loop, not asking for more context
2025-10-06 08:59:36,459 - thread-139660780025408.app.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Context retrieved: [Context(relative_path='sympy/printing/tests/test_latex.py', content='209. def test_latex_vector_expressions():\n210.     A = CoordSys3D(\'A\')\n211. \n212.     assert latex(Cross(A.i, A.j*A.x*3+A.k)) == \\\n213.         r"\\mathbf{\\hat{i}_{A}} \\times \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}} + \\mathbf{\\hat{k}_{A}}\\right)"\n214.     assert latex(Cross(A.i, A.j)) == \\\n215.         r"\\mathbf{\\hat{i}_{A}} \\times \\mathbf{\\hat{j}_{A}}"\n216.     assert latex(x*Cross(A.i, A.j)) == \\\n217.         r"x \\left(\\mathbf{\\hat{i}_{A}} \\times \\mathbf{\\hat{j}_{A}}\\right)"\n218.     assert latex(Cross(x*A.i, A.j)) == \\\n219.         r\'- \\mathbf{\\hat{j}_{A}} \\times \\left((x)\\mathbf{\\hat{i}_{A}}\\right)\'\n220. \n221.     assert latex(Curl(3*A.x*A.j)) == \\\n222.         r"\\nabla\\times \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)"\n223.     assert latex(Curl(3*A.x*A.j+A.i)) == \\\n224.         r"\\nabla\\times \\left(\\mathbf{\\hat{i}_{A}} + (3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)"\n225.     assert latex(Curl(3*x*A.x*A.j)) == \\\n226.         r"\\nabla\\times \\left((3 \\mathbf{{x}_{A}} x)\\mathbf{\\hat{j}_{A}}\\right)"\n227.     assert latex(x*Curl(3*A.x*A.j)) == \\\n228.         r"x \\left(\\nabla\\times \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)\\right)"\n229. \n230.     assert latex(Divergence(3*A.x*A.j+A.i)) == \\\n231.         r"\\nabla\\cdot \\left(\\mathbf{\\hat{i}_{A}} + (3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)"\n232.     assert latex(Divergence(3*A.x*A.j)) == \\\n233.         r"\\nabla\\cdot \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)"\n234.     assert latex(x*Divergence(3*A.x*A.j)) == \\\n235.         r"x \\left(\\nabla\\cdot \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)\\right)"\n236. \n237.     assert latex(Dot(A.i, A.j*A.x*3+A.k)) == \\\n238.         r"\\mathbf{\\hat{i}_{A}} \\cdot \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}} + \\mathbf{\\hat{k}_{A}}\\right)"\n239.     assert latex(Dot(A.i, A.j)) == \\\n240.         r"\\mathbf{\\hat{i}_{A}} \\cdot \\mathbf{\\hat{j}_{A}}"\n241.     assert latex(Dot(x*A.i, A.j)) == \\\n242.         r"\\mathbf{\\hat{j}_{A}} \\cdot \\left((x)\\mathbf{\\hat{i}_{A}}\\right)"\n243.     assert latex(x*Dot(A.i, A.j)) == \\\n244.         r"x \\left(\\mathbf{\\hat{i}_{A}} \\cdot \\mathbf{\\hat{j}_{A}}\\right)"\n245. \n246.     assert latex(Gradient(A.x)) == r"\\nabla \\mathbf{{x}_{A}}"\n247.     assert latex(Gradient(A.x + 3*A.y)) == \\\n248.         r"\\nabla \\left(\\mathbf{{x}_{A}} + 3 \\mathbf{{y}_{A}}\\right)"\n249.     assert latex(x*Gradient(A.x)) == r"x \\left(\\nabla \\mathbf{{x}_{A}}\\right)"\n250.     assert latex(Gradient(x*A.x)) == r"\\nabla \\left(\\mathbf{{x}_{A}} x\\right)"\n251. \n252.     assert latex(Laplacian(A.x)) == r"\\triangle \\mathbf{{x}_{A}}"\n253.     assert latex(Laplacian(A.x + 3*A.y)) == \\\n254.         r"\\triangle \\left(\\mathbf{{x}_{A}} + 3 \\mathbf{{y}_{A}}\\right)"\n255.     assert latex(x*Laplacian(A.x)) == r"x \\left(\\triangle \\mathbf{{x}_{A}}\\right)"\n256.     assert latex(Laplacian(x*A.x)) == r"\\triangle \\left(\\mathbf{{x}_{A}} x\\right)"\n257. ', start_line_number=209, end_line_number=257), Context(relative_path='sympy/printing/tests/test_latex.py', content='192. def test_latex_permutation():\n193.     assert latex(Permutation(1, 2, 4)) == r"\\left( 1\\; 2\\; 4\\right)"\n194.     assert latex(Permutation(1, 2)(4, 5, 6)) == \\\n195.         r"\\left( 1\\; 2\\right)\\left( 4\\; 5\\; 6\\right)"\n196.     assert latex(Permutation()) == r"\\left( \\right)"\n197.     assert latex(Permutation(2, 4)*Permutation(5)) == \\\n198.         r"\\left( 2\\; 4\\right)\\left( 5\\right)"\n199.     assert latex(Permutation(5)) == r"\\left( 5\\right)"\n200. ', start_line_number=192, end_line_number=200), Context(relative_path='sympy/printing/tests/test_latex.py', content='170. def test_latex_SingularityFunction():\n171.     assert latex(SingularityFunction(x, 4, 5)) == \\\n172.         r"{\\left\\langle x - 4 \\right\\rangle}^{5}"\n173.     assert latex(SingularityFunction(x, -3, 4)) == \\\n174.         r"{\\left\\langle x + 3 \\right\\rangle}^{4}"\n175.     assert latex(SingularityFunction(x, 0, 4)) == \\\n176.         r"{\\left\\langle x \\right\\rangle}^{4}"\n177.     assert latex(SingularityFunction(x, a, n)) == \\\n178.         r"{\\left\\langle - a + x \\right\\rangle}^{n}"\n179.     assert latex(SingularityFunction(x, 4, -2)) == \\\n180.         r"{\\left\\langle x - 4 \\right\\rangle}^{-2}"\n181.     assert latex(SingularityFunction(x, 4, -1)) == \\\n182.         r"{\\left\\langle x - 4 \\right\\rangle}^{-1}"\n183. ', start_line_number=170, end_line_number=183), Context(relative_path='sympy/printing/tests/test_latex.py', content='357.     assert latex(factorial(k)) == r"k!"\n358.     assert latex(factorial(-k)) == r"\\left(- k\\right)!"\n359.     assert latex(factorial(k)**2) == r"k!^{2}"', start_line_number=357, end_line_number=359), Context(relative_path='sympy/printing/tests/test_latex.py', content="675. def test_latex_subs():\n676.     assert latex(Subs(x*y, (\n677.         x, y), (1, 2))) == r'\\left. x y \\right|_{\\substack{ x=1\\\\ y=2 }}'\n678. ", start_line_number=675, end_line_number=678), Context(relative_path='sympy/printing/tests/test_latex.py', content="2046. def test_Mul():\n2047.     e = Mul(-2, x + 1, evaluate=False)\n2048.     assert latex(e) == r'- 2 \\left(x + 1\\right)'\n2049.     e = Mul(2, x + 1, evaluate=False)\n2050.     assert latex(e) == r'2 \\left(x + 1\\right)'\n2051.     e = Mul(S.Half, x + 1, evaluate=False)\n2052.     assert latex(e) == r'\\frac{x + 1}{2}'\n2053.     e = Mul(y, x + 1, evaluate=False)\n2054.     assert latex(e) == r'y \\left(x + 1\\right)'\n2055.     e = Mul(-y, x + 1, evaluate=False)\n2056.     assert latex(e) == r'- y \\left(x + 1\\right)'\n2057.     e = Mul(-2, x + 1)\n2058.     assert latex(e) == r'- 2 x - 2'\n2059.     e = Mul(2, x + 1)\n2060.     assert latex(e) == r'2 x + 2'\n2061. ", start_line_number=2046, end_line_number=2061), Context(relative_path='sympy/printing/tests/test_latex.py', content='1213. def test_latex_Piecewise():\n1214.     p = Piecewise((x, x < 1), (x**2, True))\n1215.     assert latex(p) == "\\\\begin{cases} x & \\\\text{for}\\\\: x < 1 \\\\\\\\x^{2} &" \\\n1216.                        " \\\\text{otherwise} \\\\end{cases}"\n1217.     assert latex(p, itex=True) == \\\n1218.         "\\\\begin{cases} x & \\\\text{for}\\\\: x \\\\lt 1 \\\\\\\\x^{2} &" \\\n1219.         " \\\\text{otherwise} \\\\end{cases}"\n1220.     p = Piecewise((x, x < 0), (0, x >= 0))\n1221.     assert latex(p) == \'\\\\begin{cases} x & \\\\text{for}\\\\: x < 0 \\\\\\\\0 &\' \\\n1222.                        \' \\\\text{otherwise} \\\\end{cases}\'\n1223.     A, B = symbols("A B", commutative=False)\n1224.     p = Piecewise((A**2, Eq(A, B)), (A*B, True))\n1225.     s = r"\\begin{cases} A^{2} & \\text{for}\\: A = B \\\\A B & \\text{otherwise} \\end{cases}"\n1226.     assert latex(p) == s\n1227.     assert latex(A*p) == r"A \\left(%s\\right)" % s\n1228.     assert latex(p*A) == r"\\left(%s\\right) A" % s\n1229.     assert latex(Piecewise((x, x < 1), (x**2, x < 2))) == \\\n1230.         \'\\\\begin{cases} x & \' \\\n1231.         \'\\\\text{for}\\\\: x < 1 \\\\\\\\x^{2} & \\\\text{for}\\\\: x < 2 \\\\end{cases}\'\n1232. ', start_line_number=1213, end_line_number=1232), Context(relative_path='sympy/printing/tests/test_latex.py', content='2086. def test_issue_7117():\n2087.     # See also issue #5031 (hence the evaluate=False in these).\n2088.     e = Eq(x + 1, 2*x)\n2089.     q = Mul(2, e, evaluate=False)\n2090.     assert latex(q) == r"2 \\left(x + 1 = 2 x\\right)"\n2091.     q = Add(6, e, evaluate=False)\n2092.     assert latex(q) == r"6 + \\left(x + 1 = 2 x\\right)"\n2093.     q = Pow(e, 2, evaluate=False)\n2094.     assert latex(q) == r"\\left(x + 1 = 2 x\\right)^{2}"\n2095. ', start_line_number=2086, end_line_number=2095), Context(relative_path='sympy/printing/tests/test_latex.py', content="533.     assert latex(Mod(x, 7)) == r'x\\bmod{7}'\n534.     assert latex(Mod(x + 1, 7)) == r'\\left(x + 1\\right)\\bmod{7}'\n535.     assert latex(Mod(2 * x, 7)) == r'2 x\\bmod{7}'\n536.     assert latex(Mod(x, 7) + 1) == r'\\left(x\\bmod{7}\\right) + 1'\n537.     assert latex(2 * Mod(x, 7)) == r'2 \\left(x\\bmod{7}\\right)'\n538. ", start_line_number=533, end_line_number=538), Context(relative_path='sympy/printing/tests/test_latex.py', content='1. from sympy import (\n2.     Add, Abs, Chi, Ci, CosineTransform, Dict, Ei, Eq, FallingFactorial,\n3.     FiniteSet, Float, FourierTransform, Function, Indexed, IndexedBase, Integral,\n4.     Interval, InverseCosineTransform, InverseFourierTransform, Derivative,\n5.     InverseLaplaceTransform, InverseMellinTransform, InverseSineTransform,\n6.     Lambda, LaplaceTransform, Limit, Matrix, Max, MellinTransform, Min, Mul,\n7.     Order, Piecewise, Poly, ring, field, ZZ, Pow, Product, Range, Rational,\n8.     RisingFactorial, rootof, RootSum, S, Shi, Si, SineTransform, Subs,\n9.     Sum, Symbol, ImageSet, Tuple, Ynm, Znm, arg, asin, acsc, Mod,\n10.     assoc_laguerre, assoc_legendre, beta, binomial, catalan, ceiling, Complement,\n11.     chebyshevt, chebyshevu, conjugate, cot, coth, diff, dirichlet_eta, euler,\n12.     exp, expint, factorial, factorial2, floor, gamma, gegenbauer, hermite,\n13.     hyper, im, jacobi, laguerre, legendre, lerchphi, log, frac,\n14.     meijerg, oo, polar_lift, polylog, re, root, sin, sqrt, symbols,\n15.     uppergamma, zeta, subfactorial, totient, elliptic_k, elliptic_f,\n16.     elliptic_e, elliptic_pi, cos, tan, Wild, true, false, Equivalent, Not,\n17.     Contains, divisor_sigma, SeqPer, SeqFormula,\n18.     SeqAdd, SeqMul, fourier_series, pi, ConditionSet, ComplexRegion, fps,\n19.     AccumBounds, reduced_totient, primenu, primeomega, SingularityFunction,\n20.     stieltjes, mathieuc, mathieus, mathieucprime, mathieusprime,\n21.     UnevaluatedExpr, Quaternion, I, KroneckerProduct, LambertW)\n22. \n23. from sympy.ntheory.factor_ import udivisor_sigma\n24. \n25. from sympy.abc import mu, tau\n26. from sympy.printing.latex import (latex, translate, greek_letters_set,\n27.                                   tex_greek_dictionary, multiline_latex)\n28. from sympy.tensor.array import (ImmutableDenseNDimArray,\n29.                                 ImmutableSparseNDimArray,\n30.                                 MutableSparseNDimArray,\n31.                                 MutableDenseNDimArray,\n32.                                 tensorproduct)\n33. from sympy.utilities.pytest import XFAIL, raises\n34. from sympy.functions import DiracDelta, Heaviside, KroneckerDelta, LeviCivita\n35. from sympy.functions.combinatorial.numbers import bernoulli, bell, lucas, \\\n36.     fibonacci, tribonacci\n37. from sympy.logic import Implies\n38. from sympy.logic.boolalg import And, Or, Xor\n39. from sympy.physics.quantum import Commutator, Operator\n40. from sympy.physics.units import degree, radian, kg, meter, gibibyte, microgram, second\n41. from sympy.core.trace import Tr\n42. from sympy.core.compatibility import range\n43. from sympy.combinatorics.permutations import Cycle, Permutation\n44. from sympy import MatrixSymbol, ln\n45. from sympy.vector import CoordSys3D, Cross, Curl, Dot, Divergence, Gradient, Laplacian\n46. from sympy.sets.setexpr import SetExpr\n47. from sympy.sets.sets import \\\n48.     Union, Intersection, Complement, SymmetricDifference, ProductSet\n49. \n50. import sympy as sym\n51. ', start_line_number=1, end_line_number=51), Context(relative_path='sympy/printing/tests/test_latex.py', content="57. x, y, z, t, a, b, c = symbols('x y z t a b c')\n58. k, m, n = symbols('k m n', integer=True)", start_line_number=57, end_line_number=58), Context(relative_path='sympy/printing/tests/test_latex.py', content='2097. def test_issue_15439():\n2098.     x = MatrixSymbol(\'x\', 2, 2)\n2099.     y = MatrixSymbol(\'y\', 2, 2)\n2100.     assert latex((x * y).subs(y, -y)) == r"x \\left(- y\\right)"\n2101.     assert latex((x * y).subs(y, -2*y)) == r"x \\left(- 2 y\\right)"\n2102.     assert latex((x * y).subs(x, -x)) == r"- x y"\n2103. ', start_line_number=2097, end_line_number=2103)]
2025-10-06 08:59:36,460 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_write_message_node - DEBUG - Sending message to BugReproducingWriteNode:
content='Issue title:\nIncorrect parenthesizing of Subs\n\nIssue description: \nHere is an example.\n```python\n>>> from sympy import Subs\n>>> from sympy.abc import x,y\n>>> 3*Subs(-x+y, (x,),(1,))\n```\nLaTeX printing of this gives:  \n```python\n\'3 \\\\left. - x + y \\\\right|_{\\\\substack{ x=1 }}\'\n```\n\n![image](https://quicklatex.com/cache3/76/ql_9672fd7e62c909ff3d9ac8543c2e2576_l3.png)\n\n\nIt would be better to be parenthesized to:  \n```python\n\'3 \\\\left. \\\\left(- x + y\\\\right) \\\\right|_{\\\\substack{ x=1 }}\'\n```\n\n![image](https://quicklatex.com/cache3/bf/ql_936ffdb876e784206d4c54bb93d28dbf_l3.png)\n\n\nIssue comments:\n\n\nBug reproducing context:\nFile: sympy/printing/tests/test_latex.py\nLine number range: 209 - 257\nContent:\n209. def test_latex_vector_expressions():\n210.     A = CoordSys3D(\'A\')\n211. \n212.     assert latex(Cross(A.i, A.j*A.x*3+A.k)) == \\\n213.         r"\\mathbf{\\hat{i}_{A}} \\times \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}} + \\mathbf{\\hat{k}_{A}}\\right)"\n214.     assert latex(Cross(A.i, A.j)) == \\\n215.         r"\\mathbf{\\hat{i}_{A}} \\times \\mathbf{\\hat{j}_{A}}"\n216.     assert latex(x*Cross(A.i, A.j)) == \\\n217.         r"x \\left(\\mathbf{\\hat{i}_{A}} \\times \\mathbf{\\hat{j}_{A}}\\right)"\n218.     assert latex(Cross(x*A.i, A.j)) == \\\n219.         r\'- \\mathbf{\\hat{j}_{A}} \\times \\left((x)\\mathbf{\\hat{i}_{A}}\\right)\'\n220. \n221.     assert latex(Curl(3*A.x*A.j)) == \\\n222.         r"\\nabla\\times \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)"\n223.     assert latex(Curl(3*A.x*A.j+A.i)) == \\\n224.         r"\\nabla\\times \\left(\\mathbf{\\hat{i}_{A}} + (3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)"\n225.     assert latex(Curl(3*x*A.x*A.j)) == \\\n226.         r"\\nabla\\times \\left((3 \\mathbf{{x}_{A}} x)\\mathbf{\\hat{j}_{A}}\\right)"\n227.     assert latex(x*Curl(3*A.x*A.j)) == \\\n228.         r"x \\left(\\nabla\\times \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)\\right)"\n229. \n230.     assert latex(Divergence(3*A.x*A.j+A.i)) == \\\n231.         r"\\nabla\\cdot \\left(\\mathbf{\\hat{i}_{A}} + (3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)"\n232.     assert latex(Divergence(3*A.x*A.j)) == \\\n233.         r"\\nabla\\cdot \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)"\n234.     assert latex(x*Divergence(3*A.x*A.j)) == \\\n235.         r"x \\left(\\nabla\\cdot \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}}\\right)\\right)"\n236. \n237.     assert latex(Dot(A.i, A.j*A.x*3+A.k)) == \\\n238.         r"\\mathbf{\\hat{i}_{A}} \\cdot \\left((3 \\mathbf{{x}_{A}})\\mathbf{\\hat{j}_{A}} + \\mathbf{\\hat{k}_{A}}\\right)"\n239.     assert latex(Dot(A.i, A.j)) == \\\n240.         r"\\mathbf{\\hat{i}_{A}} \\cdot \\mathbf{\\hat{j}_{A}}"\n241.     assert latex(Dot(x*A.i, A.j)) == \\\n242.         r"\\mathbf{\\hat{j}_{A}} \\cdot \\left((x)\\mathbf{\\hat{i}_{A}}\\right)"\n243.     assert latex(x*Dot(A.i, A.j)) == \\\n244.         r"x \\left(\\mathbf{\\hat{i}_{A}} \\cdot \\mathbf{\\hat{j}_{A}}\\right)"\n245. \n246.     assert latex(Gradient(A.x)) == r"\\nabla \\mathbf{{x}_{A}}"\n247.     assert latex(Gradient(A.x + 3*A.y)) == \\\n248.         r"\\nabla \\left(\\mathbf{{x}_{A}} + 3 \\mathbf{{y}_{A}}\\right)"\n249.     assert latex(x*Gradient(A.x)) == r"x \\left(\\nabla \\mathbf{{x}_{A}}\\right)"\n250.     assert latex(Gradient(x*A.x)) == r"\\nabla \\left(\\mathbf{{x}_{A}} x\\right)"\n251. \n252.     assert latex(Laplacian(A.x)) == r"\\triangle \\mathbf{{x}_{A}}"\n253.     assert latex(Laplacian(A.x + 3*A.y)) == \\\n254.         r"\\triangle \\left(\\mathbf{{x}_{A}} + 3 \\mathbf{{y}_{A}}\\right)"\n255.     assert latex(x*Laplacian(A.x)) == r"x \\left(\\triangle \\mathbf{{x}_{A}}\\right)"\n256.     assert latex(Laplacian(x*A.x)) == r"\\triangle \\left(\\mathbf{{x}_{A}} x\\right)"\n257. \n\n\nFile: sympy/printing/tests/test_latex.py\nLine number range: 192 - 200\nContent:\n192. def test_latex_permutation():\n193.     assert latex(Permutation(1, 2, 4)) == r"\\left( 1\\; 2\\; 4\\right)"\n194.     assert latex(Permutation(1, 2)(4, 5, 6)) == \\\n195.         r"\\left( 1\\; 2\\right)\\left( 4\\; 5\\; 6\\right)"\n196.     assert latex(Permutation()) == r"\\left( \\right)"\n197.     assert latex(Permutation(2, 4)*Permutation(5)) == \\\n198.         r"\\left( 2\\; 4\\right)\\left( 5\\right)"\n199.     assert latex(Permutation(5)) == r"\\left( 5\\right)"\n200. \n\n\nFile: sympy/printing/tests/test_latex.py\nLine number range: 170 - 183\nContent:\n170. def test_latex_SingularityFunction():\n171.     assert latex(SingularityFunction(x, 4, 5)) == \\\n172.         r"{\\left\\langle x - 4 \\right\\rangle}^{5}"\n173.     assert latex(SingularityFunction(x, -3, 4)) == \\\n174.         r"{\\left\\langle x + 3 \\right\\rangle}^{4}"\n175.     assert latex(SingularityFunction(x, 0, 4)) == \\\n176.         r"{\\left\\langle x \\right\\rangle}^{4}"\n177.     assert latex(SingularityFunction(x, a, n)) == \\\n178.         r"{\\left\\langle - a + x \\right\\rangle}^{n}"\n179.     assert latex(SingularityFunction(x, 4, -2)) == \\\n180.         r"{\\left\\langle x - 4 \\right\\rangle}^{-2}"\n181.     assert latex(SingularityFunction(x, 4, -1)) == \\\n182.         r"{\\left\\langle x - 4 \\right\\rangle}^{-1}"\n183. \n\n\nFile: sympy/printing/tests/test_latex.py\nLine number range: 357 - 359\nContent:\n357.     assert latex(factorial(k)) == r"k!"\n358.     assert latex(factorial(-k)) == r"\\left(- k\\right)!"\n359.     assert latex(factorial(k)**2) == r"k!^{2}"\n\n\nFile: sympy/printing/tests/test_latex.py\nLine number range: 675 - 678\nContent:\n675. def test_latex_subs():\n676.     assert latex(Subs(x*y, (\n677.         x, y), (1, 2))) == r\'\\left. x y \\right|_{\\substack{ x=1\\\\ y=2 }}\'\n678. \n\n\nFile: sympy/printing/tests/test_latex.py\nLine number range: 2046 - 2061\nContent:\n2046. def test_Mul():\n2047.     e = Mul(-2, x + 1, evaluate=False)\n2048.     assert latex(e) == r\'- 2 \\left(x + 1\\right)\'\n2049.     e = Mul(2, x + 1, evaluate=False)\n2050.     assert latex(e) == r\'2 \\left(x + 1\\right)\'\n2051.     e = Mul(S.Half, x + 1, evaluate=False)\n2052.     assert latex(e) == r\'\\frac{x + 1}{2}\'\n2053.     e = Mul(y, x + 1, evaluate=False)\n2054.     assert latex(e) == r\'y \\left(x + 1\\right)\'\n2055.     e = Mul(-y, x + 1, evaluate=False)\n2056.     assert latex(e) == r\'- y \\left(x + 1\\right)\'\n2057.     e = Mul(-2, x + 1)\n2058.     assert latex(e) == r\'- 2 x - 2\'\n2059.     e = Mul(2, x + 1)\n2060.     assert latex(e) == r\'2 x + 2\'\n2061. \n\n\nFile: sympy/printing/tests/test_latex.py\nLine number range: 1213 - 1232\nContent:\n1213. def test_latex_Piecewise():\n1214.     p = Piecewise((x, x < 1), (x**2, True))\n1215.     assert latex(p) == "\\\\begin{cases} x & \\\\text{for}\\\\: x < 1 \\\\\\\\x^{2} &" \\\n1216.                        " \\\\text{otherwise} \\\\end{cases}"\n1217.     assert latex(p, itex=True) == \\\n1218.         "\\\\begin{cases} x & \\\\text{for}\\\\: x \\\\lt 1 \\\\\\\\x^{2} &" \\\n1219.         " \\\\text{otherwise} \\\\end{cases}"\n1220.     p = Piecewise((x, x < 0), (0, x >= 0))\n1221.     assert latex(p) == \'\\\\begin{cases} x & \\\\text{for}\\\\: x < 0 \\\\\\\\0 &\' \\\n1222.                        \' \\\\text{otherwise} \\\\end{cases}\'\n1223.     A, B = symbols("A B", commutative=False)\n1224.     p = Piecewise((A**2, Eq(A, B)), (A*B, True))\n1225.     s = r"\\begin{cases} A^{2} & \\text{for}\\: A = B \\\\A B & \\text{otherwise} \\end{cases}"\n1226.     assert latex(p) == s\n1227.     assert latex(A*p) == r"A \\left(%s\\right)" % s\n1228.     assert latex(p*A) == r"\\left(%s\\right) A" % s\n1229.     assert latex(Piecewise((x, x < 1), (x**2, x < 2))) == \\\n1230.         \'\\\\begin{cases} x & \' \\\n1231.         \'\\\\text{for}\\\\: x < 1 \\\\\\\\x^{2} & \\\\text{for}\\\\: x < 2 \\\\end{cases}\'\n1232. \n\n\nFile: sympy/printing/tests/test_latex.py\nLine number range: 2086 - 2095\nContent:\n2086. def test_issue_7117():\n2087.     # See also issue #5031 (hence the evaluate=False in these).\n2088.     e = Eq(x + 1, 2*x)\n2089.     q = Mul(2, e, evaluate=False)\n2090.     assert latex(q) == r"2 \\left(x + 1 = 2 x\\right)"\n2091.     q = Add(6, e, evaluate=False)\n2092.     assert latex(q) == r"6 + \\left(x + 1 = 2 x\\right)"\n2093.     q = Pow(e, 2, evaluate=False)\n2094.     assert latex(q) == r"\\left(x + 1 = 2 x\\right)^{2}"\n2095. \n\n\nFile: sympy/printing/tests/test_latex.py\nLine number range: 533 - 538\nContent:\n533.     assert latex(Mod(x, 7)) == r\'x\\bmod{7}\'\n534.     assert latex(Mod(x + 1, 7)) == r\'\\left(x + 1\\right)\\bmod{7}\'\n535.     assert latex(Mod(2 * x, 7)) == r\'2 x\\bmod{7}\'\n536.     assert latex(Mod(x, 7) + 1) == r\'\\left(x\\bmod{7}\\right) + 1\'\n537.     assert latex(2 * Mod(x, 7)) == r\'2 \\left(x\\bmod{7}\\right)\'\n538. \n\n\nFile: sympy/printing/tests/test_latex.py\nLine number range: 1 - 51\nContent:\n1. from sympy import (\n2.     Add, Abs, Chi, Ci, CosineTransform, Dict, Ei, Eq, FallingFactorial,\n3.     FiniteSet, Float, FourierTransform, Function, Indexed, IndexedBase, Integral,\n4.     Interval, InverseCosineTransform, InverseFourierTransform, Derivative,\n5.     InverseLaplaceTransform, InverseMellinTransform, InverseSineTransform,\n6.     Lambda, LaplaceTransform, Limit, Matrix, Max, MellinTransform, Min, Mul,\n7.     Order, Piecewise, Poly, ring, field, ZZ, Pow, Product, Range, Rational,\n8.     RisingFactorial, rootof, RootSum, S, Shi, Si, SineTransform, Subs,\n9.     Sum, Symbol, ImageSet, Tuple, Ynm, Znm, arg, asin, acsc, Mod,\n10.     assoc_laguerre, assoc_legendre, beta, binomial, catalan, ceiling, Complement,\n11.     chebyshevt, chebyshevu, conjugate, cot, coth, diff, dirichlet_eta, euler,\n12.     exp, expint, factorial, factorial2, floor, gamma, gegenbauer, hermite,\n13.     hyper, im, jacobi, laguerre, legendre, lerchphi, log, frac,\n14.     meijerg, oo, polar_lift, polylog, re, root, sin, sqrt, symbols,\n15.     uppergamma, zeta, subfactorial, totient, elliptic_k, elliptic_f,\n16.     elliptic_e, elliptic_pi, cos, tan, Wild, true, false, Equivalent, Not,\n17.     Contains, divisor_sigma, SeqPer, SeqFormula,\n18.     SeqAdd, SeqMul, fourier_series, pi, ConditionSet, ComplexRegion, fps,\n19.     AccumBounds, reduced_totient, primenu, primeomega, SingularityFunction,\n20.     stieltjes, mathieuc, mathieus, mathieucprime, mathieusprime,\n21.     UnevaluatedExpr, Quaternion, I, KroneckerProduct, LambertW)\n22. \n23. from sympy.ntheory.factor_ import udivisor_sigma\n24. \n25. from sympy.abc import mu, tau\n26. from sympy.printing.latex import (latex, translate, greek_letters_set,\n27.                                   tex_greek_dictionary, multiline_latex)\n28. from sympy.tensor.array import (ImmutableDenseNDimArray,\n29.                                 ImmutableSparseNDimArray,\n30.                                 MutableSparseNDimArray,\n31.                                 MutableDenseNDimArray,\n32.                                 tensorproduct)\n33. from sympy.utilities.pytest import XFAIL, raises\n34. from sympy.functions import DiracDelta, Heaviside, KroneckerDelta, LeviCivita\n35. from sympy.functions.combinatorial.numbers import bernoulli, bell, lucas, \\\n36.     fibonacci, tribonacci\n37. from sympy.logic import Implies\n38. from sympy.logic.boolalg import And, Or, Xor\n39. from sympy.physics.quantum import Commutator, Operator\n40. from sympy.physics.units import degree, radian, kg, meter, gibibyte, microgram, second\n41. from sympy.core.trace import Tr\n42. from sympy.core.compatibility import range\n43. from sympy.combinatorics.permutations import Cycle, Permutation\n44. from sympy import MatrixSymbol, ln\n45. from sympy.vector import CoordSys3D, Cross, Curl, Dot, Divergence, Gradient, Laplacian\n46. from sympy.sets.setexpr import SetExpr\n47. from sympy.sets.sets import \\\n48.     Union, Intersection, Complement, SymmetricDifference, ProductSet\n49. \n50. import sympy as sym\n51. \n\n\nFile: sympy/printing/tests/test_latex.py\nLine number range: 57 - 58\nContent:\n57. x, y, z, t, a, b, c = symbols(\'x y z t a b c\')\n58. k, m, n = symbols(\'k m n\', integer=True)\n\n\nFile: sympy/printing/tests/test_latex.py\nLine number range: 2097 - 2103\nContent:\n2097. def test_issue_15439():\n2098.     x = MatrixSymbol(\'x\', 2, 2)\n2099.     y = MatrixSymbol(\'y\', 2, 2)\n2100.     assert latex((x * y).subs(y, -y)) == r"x \\left(- y\\right)"\n2101.     assert latex((x * y).subs(y, -2*y)) == r"x \\left(- 2 y\\right)"\n2102.     assert latex((x * y).subs(x, -x)) == r"- x y"\n2103. \n\n\nNow generate the complete self-contained test case that reproduces the bug with the same error/exception.\n' additional_kwargs={} response_metadata={}
2025-10-06 09:00:05,120 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_write_node - DEBUG - content='```python\nfrom sympy import Subs\nfrom sympy.abc import x, y\nfrom sympy.printing.latex import latex\n\n\ndef test_latex_subs_parenthesizing():\n    """\n    Test for incorrect parenthesizing of Subs.\n    """\n    expr = 3*Subs(-x + y, (x,), (1,))\n    assert latex(expr) == r\'3 \\left. \\left(- x + y\\right) \\right|_{\\substack{ x=1 }}\'\n\n```' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 5755, 'candidates_token_count': 108, 'total_token_count': 9076, 'prompt_tokens_details': [{'modality': 1, 'token_count': 5755}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 108}], 'thoughts_token_count': 3213, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -4.999094645182292, 'model_name': 'gemini-2.5-pro'} id='run--cdb75190-a863-4f4a-8d85-077b3585814d-0' usage_metadata={'input_tokens': 5755, 'output_tokens': 108, 'total_tokens': 9076, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 3213}}
2025-10-06 09:00:22,406 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'create_file', 'arguments': '{"content": "from sympy import Subs\\nfrom sympy.abc import x, y\\nfrom sympy.printing.latex import latex\\n\\n\\ndef test_latex_subs_parenthesizing():\\n    \\"\\"\\"\\n    Test for incorrect parenthesizing of Subs.\\n    \\"\\"\\"\\n    expr = 3*Subs(-x + y, (x,), (1,))\\n    assert latex(expr) == r\'3 \\\\left. \\\\left(- x + y\\\\right) \\\\right|_{\\\\substack{ x=1 }}\'\\n", "relative_path": "sympy/printing/tests/test_latex_subs.py"}'}, '__gemini_function_call_thought_signatures__': {'94cd2336-d2e1-4528-8d11-10038581e118': 'CtsrAR/Mhbad0lPvYjfgu0mSSdy/GaMgP3LfWm2IhZ86Ozz8bMeRgmaJnBkzCEFMtm6ZmWmtno1DAIo2r1ICN4a8qMAT93HrexLz0a/JNMccagG5WH/txuVSyE40ItKeFDK/D2F9P9NTn3XVJ1E5JcJCZNHqERmdDwYVlujPAWw8Jiow7c/2TLWzCCmUzEnCPtDzBv2HSpSmvKqwGH0MlKITlq4tbIxnJzz0FpvndnY9YtiJyycWw3jPcpLBtU9o8ZxHLASwdvHwZt5ghEUy94YWxRo2nxVlAW6rSIgVUO7ZGnro6phrxhpKZNm01JeEHxR3+lNTz1wyMULjnEObbPiF6roOTzjl47RLUiAVjWuwKtPzz3IGUluT/UEZL/uDX/AuNSmS3zprlbmC+jRdRZEc2T+tyB9Bk87XGLseDRd9+l+CNkD/s3kqbOi02O68FsjkCAw3CKKjqSIrBzzrOL0wKp0P3ZddImEXpKJ9KvPEQ9HNZXjCCmhKzsgRZxM9ISiS1SsCk/At5qN8jJ+tBYxX0A8fRpCAZErjCKGBSo28Lon0kjKzvlPea6C3R/hksgaKCcAz1txLiMKfIw/Ex5Wg2oLSpqU97rq8RtZFmMhCbz+JhLnP/+4Jo8S/1EbeaTs263qbQT9fZczqQOntr8m3G3NYyvK2j288bIp9JnfXakJLXmhvpuAp/9F5XIS8rbCgQ8LYHLyI8R0/6ShyqiZ11ZqenXTbmwMEhHc7v8KeO2zSuZgqRlk9jqMKnUgGHQAxxup0ix8Yc08iEvzk4xJGW1GMc5tzGbcniV1GXPD6gr42iTyjlUVwVWEkKe1Tg5wAe5iRpQZwc16+rWG2hjwNc5xFnvTqa2Et8yl3VFpoGk5hSsm9/STUD75NVFuZAXjJKwL8A1dOKpR1uZFZDqoKOCLNXjfP5Lm2/6584AtCWb7XV4uqptBBDCbOvfeyTdwK2OVfYsJ2hXcsnyDuP4NEaS3svZX7DwAQHHaUQ6DphECTLNnFjNgARG3JkaMAcsulU1JA78RNgnUkP7rapPMzqKTS84PsBHUrafCk+LzwkaI800x0MRQjnOdioCGeB1M6LNln0MfEjCVk3eUQqdQnOWxaRxdNe2Wg0Qo5O6dbuY7WsrG8ykMuhybdxDgq7T94/eVCfCvliqEP8GlLEto46XU4gpcPi6JTfNUIrVNNo5jMYo8JemmpqcF4LXCvDO9KOCKdBZzIBAOpbKBJe0PNq2VasYKqpS7LTwi5pj7YXNScGUjbjhli7/s1x655xrvhdv40EmXGT/ZyesEaQtM1OjTONGgCBKNvut3LYR22WtDhsM3IBgRTIHvWmFWPY3Jaqm3ZECW4OADdLo3OdSIgyuOrFyFIQ4f4UglPJMvv4Bpeqe2GHZmOnJXxKzm1H21Z+wH+G8hITCYi/qlKnUqcoJ6UHQ3BvtKWUVBIAXdAEYJtZaEKrkD0nCe2wY/gLoY0V4Eb93maT8+UksPlhu70DTj8jay3saYporBBuu7uQY8/bqhXT0Ce9ANf9z1UzAOFptFr7rP/Sll4zk3YRrj/X8G9DHpSv/oo777Uac7oe7tKu+Z/hGQTMde8B/dqJKsLp7DmUb/pCYBMT6lYxL5JGu4wPZHqpONI3K3f3ndAxnw0yTWrJnAyDsg8qf3B0maccnLhugNb8xU84FGKL/XGJKcdaQFN0hH46bQ6bME1SaXLaU2i/XgIRLu7IH7zb81vbF6nX/9Akyf3wBchsrSrZEeEFah6/AmKl2/Ylmv00bBD/esETkJEFgWPfVQt8OEMsMFsSmv+chEjd8H/yfc7IXSsxHjDTTVWwB56VUPmC8o+AVJ9l05kg4yeZDbNYKos3TK5RonIYGaOEMfrlk9suakfO2vWmMJr1DAJ2FlkIYWg1SEDkgVR+MQqaBwLae8fMgkG/fdv0kkg3S2IuTydu9+i19zH3KwjD9MWRtFOUXquqOESf1cOREThlOutcxKyLrKuLb76QQEcpIJUWDiysrGL0eOVX1Gw686xkA/hpwjw4AdPXDXKiaA8HNRZn5FsK0UT/AS+v2XLuvDTc8VISGl+jTmsO8PjngYsyGOAnyrSYN4zZrHEjqjybEhmCGZJFzqYmpcj6qIEp5FIRFTgBWXu7DiD67/EayPMTT7J0ZeGXp6apqWhtzo03ex4G3yX9bip7UkZmJP96Qw9tYzNDyezTyPuLDcqwOUC4+wJgLIdXhCeIPMZCIZM8VNhw/A1wzOw7NMBAYfNebTUa0l5U8KPYihXIZw5aVg11MmRvk7F4mhxxLXRS+TkejnHqNjUgv3yKWZb6PjPNwIXP8Kw1O/xcCLcPSzfWSDwZQMJpaUQ40NlReYK0f6QnL+RqmJ89eleafoPh+8K4ZDYfLuYMCazmi9LrRCfUu31UezEDyKwnChwmJkPJSzhsXX3sU8Ijm7bxkaGV+DeP3AzN3vAgmdAwvk6qmBYoZ/pnV5dKNMjFPSX1EMZ0RGJoGkFLejAXkNAQD8ko3v7YzltYnPE2yp6s2mQCtdS/nfoTsk1qpyBdBYExmB34hKv7R/CQphAIPJbX3CR9W5NLIORRz6A1HA9ADyUyF/HQ675m6Oo3y2wukFIBUYXNLVHyH45la3/aNgZBqISCjFOxv5hHbP0EDkkQf87dUo+Jef+Hia2Z6gLwzG/UhrsT3nr5FNetpwiKz5Qv6OEbHAcdy/j/64LJFmAVZBQ9dP0DdvTpwnd/IBv1MGLhRbO2YIuFx1M8F9vqn4b8eNAg9/ig3y2LaeDxoPH3Gp6kYu13K6SSBQPK0/7UKh4WBWFW46VG0W5LSQ6DhYYX44F/Dlrx4/Qsk4s6Ehj3vaTWp39wMBZakrZsvlB4AHRx8+3WKnideT09PpzWXAxbJ5xrL9WyLBLPQz9UEyHgpZwaVDMt5SU5+YBP875kTyAj7B0i9ITMIocmetADvq9/lIFMItVdOyfauVEqsifccNXnc2KEu6cMggpxoyc3uLMYZUxSe334XHHqNDXMKAWjJHrZ+R77H+/o46BHDRPUHwq5RXX7ivSPBsVP434u0WNiI1vRb1pAJjW+CCHzgXxo+ZZ67gR5e4hFkQHzmToq3neueZ7MHLSg8F/LWKkVFaHH++H95iPCMiGxDQQ2IyMbQ5zhmFtCrbu4cFkDAh2RomASXNaXScl3tOCL4RjlmPtDlEPOx4E00Z5S8H0cPEH6Ix3YgT87buJhx0T2So2fczlaNbdEEfhzlRxb+Bj3b1etM4vZ38V7acAICsXFzu9FMMFa2BwxWFM+arLGfun2HnH4lv1FWffs+UkpA+xP63w3EEKYOQwlWaWg+c8RFMJCgL4qOOqUxcDQ+5b4UZsjely3NNLbdn8kZSG4cfQFL7zbEDHIXSLF/dUmAtYa/HNnLtaFEkq+GSh00kTHqjpu5/F01O5KAH+O7nJRIbpUwiXYF/x0ICRt6zSR5NLylTcjGv5gBEgKe3OZjoMG6nvuFdo76DbvMu37zavtqB8orFohpwNWgwq6P8NOVgBEEaHoNRIM3aSYHz5TSGAgbV7VaDqkfzf6BeSaamz1xKGnoFMjYOBHpVmn0nCUs53Sq8ut20B+2T0r6nkq/ss3EZ5vdFKWBTiudYLeHeKmJrJmHy2AF5fBiCWZ2lKj4xY52y85kPzu6LB6/LQFaXCTFq37hNMlp0TDwoRhaGfZ8CWMf/wimHCVyUT1A7dYjrv9bhR0NOm908qUiiled6KfomGPbeVxCLGc/sdCHn5i5VjxRDfRUO4NkYOBYJZIkcTF/5MuSUF9xgT80ygf1w26DAH9cRthz4NBcqQCQXQ5MqeEMhHPCh9RcDJxVZhe6k6mKT/zlrl1rSIj18tlRnbMgFAqxfqBA7PlpT0ETMcJXfqHfsyOEqbI2guAkeGEU27C7bTX/SO0bNE8JIjAvcy+wCnJGMS7aPQgqv7Zl+xc+Uvl7VtzEaIF0ew+A5Xtk1p2unlqc6or7gitkig4DzGHGyQXAtDbk6CNA8Mq1SSU5SZvfTq3qTOF+Iy+Bd7bisrVrMZJX/zp3dFUZm3l80TtMtfSzuSQ9ccIxbQ+fLHIwjwj8l5cePdMPYj57HFv5LM8OaPUAg9N7ZfM/QEv8X1/+k4AytZFCKAae9V/nAo28y0RI8fNEzBHRi8ix0wkwGbuS4fcVwcYkyrrh4L7uownh2nZGexyowaizNc9oWHbtfTbGrBZJvJAfMADLVZfVn9Kpn+HGvkDFHmxmfxpCKHep+7p912bBxqUlhxLKofmjd0Z19mUZyIePWYJYD5xAG2NqtHDxowTfBoE6X8kipjtcVQ+/3A+7IBQBO6IS3Ml2MF42+CG4FnHR3IkHZy6aG/szpyAjkUt/Bi8WsYSu2yVA7e6CsgwdflbYAEJzEXgJ5RLBkUsOHgGDP1cancP1Cis3ZpojE8yHUXlr8eE/HAQl6ngFJtO/VCXvcXgP/7to4Qh4cmcTqAi1X/+FauKjtqQz/oFhLDL9JLnOaSLs3+s5U84bQ98jLCuyQS69RP/bKAw7bSZDIFeNPChVKnmJZsIR9CaGNt7bX7aQspaWnGHBISUbo5u73NEXP5I3nREypTDOWArmntlG9DvfNEAui1iKPHblE5e3j4DbhwSSmuJ0VMqppnoPJbVg+2ESPYQqA0irD6G/pbUobg2hlMpqNsr2Pm8Skx8XTtPudZPSMeL41kOGVPqx1aNS6MSn657w3tfYc7qYSe6zBSzlGPXLbU7RdmpVOeNzUzHcpIJNDyCyeVWrmVcgqPMXKRVoGE9lcU55Vlv614CKduBBYd91mLYjfTeMkJ8L19qGNbjaTqDdhWzOsBpLZWwW25lVU1BhScn19ivWKwrnbk0ZgWK4EVvjEay9nB4LKSXbubj6mUPMuq4RYgQ4f/ULC0H6A74KpIN6Uq9l7HJxP09SOzaDdh7rm8pFiQoarGeJgtvr2Lm+ywTKxAB+/v3yH7L0gdgOlzyofBIzL+2oneN+gj4Df3xeX3Mkh9ULUnKYl2pkllxupPTc3yFySezBji857ft7KiuT3z5oU1yKf2DJebHuHXGVWQOKN05sssKanhlqw529T9ZfW/VGI5P+vgLf0S3DfbapeObeasOJC4I9xp2xZWPdjfIJoYnA3+XdwRTTlom4RFxMQpNyfJUt0NAaowuGaCTTG3lblVrXzE0eGp0Wml9+m4q3gz6TOeoUQNY3WdawDZRHPtlsOn8iLH/7GLToQ9z6JOH84F3t01AH6jKwf4CBDmB5xdR7k9zClgWcV2EJCCFPc9bftTrRqTntTgEqjWjjIuoAIMN3JVBHzA5dFOx7eKMLYVinaSTPb3dMveR/4pS6+z93u+wQ347XSKU55PI0uI/psFd/MLtLATaJACHOlCcXojBluiQb1hncDQbzwec0Oj1oGn+fb696x6NE1HRQarHa1mBqHjBVHgF+SSn47lY7TXmNKtx2rhQOQR7D6w/WcLaWmBRzBUkexUOwVCuBF2zpyLf309XbpscR/6rwIqrsm0Y61tF/Vbr/nZkB+vZ1az17MQnPvhJs30ohjXgACoewuV6+FeDavcb7EBhU/DCHaj9AliTEBspBfaX8l6ODreCFfnRP2ky6cGPq+ubdnb8019PO9CZa05qFCWozJ2pJmAEsVDzPnd3CyXvVfWCHFPeXI2Ed0v2D3Vvtfy+w10mlHSoqmyBoDm7yil7RxTN1LVa5Il9N2rTnkKKJcr6u6qe+53SRm1vwYkZWOav3wQ0Wv/sJQDry1+o1aKch2oWYWnXHpNT/jo4+wKNRIbn6ysBDOJK/YSTnthrZTrzmOYSbAHYWM1p9vZ+CdHorBh6Z+wk6dPeu1yT44qtMfKUnj6EoXuzf6IOzSzAnHtzhSDxER99PVZ+CVWJTrurtbQjK51/ieCY5kO41LgGIMhgbboQGNjC8gfdpXtsSlF0RjBVtb7ZoIG/GNWEEDiLIQvjiXSBQygNBXxbFh7oUrgG0L+yZg2fAqLzFBK1Qf2vnuy/pDf72Rp63Ia8N+sZF39ku0g9TcsHYJXLLB7NWnQ3PR7RyYan5UidIezTne6p2IWXpIzpafdBQ4MuPzZhr9zurmGDLU0a0Pwx9aoWPiHrEkDA05aQ1rtiCER6hu0a76tUCFSJqQE4vMzLc9BnWpt9ftTqiQRvrynb5nQpmhHJE7UKIc16+yUJL3fkTiEzgq+fCHCQrygYtLigsv2mIzvo6/KmTQNLZMWF8OcCWAQVVsa/tNOXCkZ+/ZMIfkiFf/lnjGa05W6cLVDzQQ9WxJkTYU55elQjQMD3PTvEkms7hrOO2ngYzrLuYpii81x7n78HunFkQeapVj925KYxvne6w+naPF1gPdCNMnq+MmdRRA44giMLtJtTiIoViJZ0x80qGZy/PsWNxjyPf654VJgw7vQun8/DjezRIZ4f0cUcdy9t6xqiuMoDiivyOvqO5L3Y9UDHL+f/Z8awb8m3qYn3hs4TIXDdtmmudefeYAjdOY/e5ns6jKzzBvMYXKHJLcuFA39nrN4W5DWs3AOz+v0IQPKp0TgdG3m6nWjHpAB4jukiaupUkfklkOIv59eEy1zc+nY3v8KJNkp3f7aRRcqcm4nbqTHfVSKpNs3LMlxojPXZofziASXZ3eVoLtk7pdtedS0M3TApvQhPLiJrCBftRe847YpU0P8zOPQLoIQTdnSqp9Vow5Ltur+aklRgTlxaZYWFL7+i3NYGt9J7jQdJNL3xmimLM2olGsdur/Ra6AsgOd1q9J9khNZ2oI5EWiD5m0ehhPMVZsO5gK6xYwCsd0ks10HmI60b7iQzBtL9i0lt6IFl7IgrDfWtOjMDN/EpGPhxGVNqitwdUgCK98vGQ+cK7DW/2AH2nFQqDfNU9JDyrVxw7AGsTjS0f3k2+zOUHzxodoMZ6nuuS9O2JvYqkP+cpzGjLRCZpR32+OUmKaNDkglNBMK0252E1GgTCV3rKtXfbyHMVhlgLhBXZsRkBHel1KZWGHuT67rILmbt0eIeU/ldhMfNrSqZKYUs4QmgTJYPc8a0Jw3jjEbqaq8LcGUjCwcbWsYsxDAnmciz/BI7uo/ExHvG64LajYIBcd4Qi2nkiZW79IqWZWxinwqjrSgmppx0iSiyrClA5cfBemKRdIg6K0nHlSZFYOd787kh9+TrGTBDXOfIrRyvLRRjwC9IV8O7uwKs240zh+LgVXFZUIQCb56Bt5l+E9qrX1iVP2Yhbeyw2l7JCDThtLcDOHoQdw28ZhdvTON0CJySj1vjOTu9/TBaMggM5OixjM+Pu+Mw5wQopc8PB6HSmBHNQiymQeId1CsvytiEtN20si5g7xGkBPjBmBHCLY9KYWd8ZEXbJdEoJsxvWdmEZEcjOsc8h9orMGlagQjQt3zvgdXWVEoDVjcUrOEgY7VOBlP4nLrub1S85JHLKiKx0x8PV/7qKQS+0E9EkjLqYfevNqXQ9XjUYuC'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 18084, 'candidates_token_count': 125, 'total_token_count': 19892, 'prompt_tokens_details': [{'modality': 1, 'token_count': 18084}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 125}], 'thoughts_token_count': 1683, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -1.420991455078125, 'model_name': 'gemini-2.5-pro'} id='run--fd480fb9-f5b8-4e55-a51e-c8ec2a9389bb-0' tool_calls=[{'name': 'create_file', 'args': {'content': 'from sympy import Subs\nfrom sympy.abc import x, y\nfrom sympy.printing.latex import latex\n\n\ndef test_latex_subs_parenthesizing():\n    """\n    Test for incorrect parenthesizing of Subs.\n    """\n    expr = 3*Subs(-x + y, (x,), (1,))\n    assert latex(expr) == r\'3 \\left. \\left(- x + y\\right) \\right|_{\\substack{ x=1 }}\'\n', 'relative_path': 'sympy/printing/tests/test_latex_subs.py'}, 'id': '94cd2336-d2e1-4528-8d11-10038581e118', 'type': 'tool_call'}] usage_metadata={'input_tokens': 18084, 'output_tokens': 125, 'total_tokens': 19892, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 1683}}
2025-10-06 09:00:23,690 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='sympy/printing/tests/test_latex_subs.py' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 18232, 'candidates_token_count': 14, 'total_token_count': 18246, 'cached_content_token_count': 17907, 'prompt_tokens_details': [{'modality': 1, 'token_count': 19913}], 'cache_tokens_details': [{'modality': 1, 'token_count': 17907}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 14}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -4.535996621208531e-05, 'model_name': 'gemini-2.5-pro'} id='run--c050b94b-3d56-4f0b-b59f-6d048df2bf5c-0' usage_metadata={'input_tokens': 18232, 'output_tokens': 14, 'total_tokens': 18246, 'input_token_details': {'cache_read': 17907}}
2025-10-06 09:00:23,784 - thread-139660780025408.app.lang_graph.nodes.git_diff_node - INFO - Generated patch:
diff --git a/sympy/printing/tests/test_latex_subs.py b/sympy/printing/tests/test_latex_subs.py
new file mode 100644
index 0000000000..3f091a53f7
--- /dev/null
+++ b/sympy/printing/tests/test_latex_subs.py
@@ -0,0 +1,11 @@
+from sympy import Subs
+from sympy.abc import x, y
+from sympy.printing.latex import latex
+
+
+def test_latex_subs_parenthesizing():
+    """
+    Test for incorrect parenthesizing of Subs.
+    """
+    expr = 3*Subs(-x + y, (x,), (1,))
+    assert latex(expr) == r'3 \left. \left(- x + y\right) \right|_{\substack{ x=1 }}'

2025-10-06 09:00:23,785 - thread-139660780025408.app.lang_graph.nodes.update_container_node - INFO - Copy over all updated files to the container
2025-10-06 09:00:23,797 - thread-139660780025408.app.docker.base_container - INFO - Resetting git repository in the container
2025-10-06 09:00:23,797 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: git reset --hard
2025-10-06 09:00:24,064 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 0
2025-10-06 09:00:24,064 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:

HEAD is now at 70381f282f Merge pull request #18084 from oscarbenjamin/pr_lambdify_fix

2025-10-06 09:00:24,064 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: git clean -fd
2025-10-06 09:00:24,165 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 0
2025-10-06 09:00:24,165 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:


2025-10-06 09:00:24,165 - thread-139660780025408.app.docker.base_container - INFO - Updating files in the container after edits.
2025-10-06 09:00:24,165 - thread-139660780025408.app.docker.base_container - INFO - Creating directory sympy/printing/tests in the container
2025-10-06 09:00:24,165 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: mkdir -p sympy/printing/tests
2025-10-06 09:00:24,265 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 0
2025-10-06 09:00:24,265 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:


2025-10-06 09:00:24,266 - thread-139660780025408.app.docker.base_container - INFO - Updating sympy/printing/tests/test_latex_subs.py in the container
2025-10-06 09:00:24,268 - thread-139660780025408.app.docker.base_container - INFO - Files updated successfully
2025-10-06 09:00:27,228 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'run_command', 'arguments': '{"command": "pytest sympy/printing/tests/test_latex_subs.py"}'}, '__gemini_function_call_thought_signatures__': {'64f56b1b-a4ec-49ed-8700-37d559fdee8e': 'CrYHAR/MhbbC3xLxH9mDejigmw0WRgp/yvedQFqTKWnBL5Mym/fpxqMB9y/tRMMhs2fv/KT3Dg17mi3VsQZaHMH6yDICVvjQ13cbpvXQOvQrBlwsFc7JFVLFE4OhxAanlJvPhxTvCq83xmpv0aApN44T+dxmu9xgDjNpgA/z9IMA2fAb4qzMHZyMcgtPb4B6hoGUHcOs6vNryAd1wCrU6HN8v+sp5FdfAwqKSCvX8dGWuS+7COfflSypY1J8eV3KjvALpJgK6/rLZv7jfGj/iYyxLFFnwCMaFH7RGSS3LjJ/5kZgmzK/V40DkkOkoB4KiQi+KzyQQANtDWLA+xMA1KBEqNd8Y+yV4JvQQ0Q5i85KizvOIsP16QDFTuKFjWlzcunDbYViFUJhYJeIqG7Qfzhi8oprJrxvIE4lLGHMXiMmi2Qnvi+TbomSRcBlDqVXuUhcu5EHp5jO9qjP0dfuP4sW/1Li2UdfUs9cic2w0V6S/ruUQ2QnhHSmGXkziEZsqQSJx6AoNCQUPUPDXjiz3NKFEFNkAMeFJfx2YU3cwXPSZLHU5qVxMMbJ/HlbOxuXhN0QlDTM/H/tYPFhVWFDWQPeAhwfSMjOoWmgnQCO+CNEupxmhKBLW5WzMAKHpZhmXbj4JY6wNQBx3aFYZHVzs7t0EAQFI4lUhL9wS+VkY5SPDxXmpAsv4YU1WxOVbLuJFKsRX2C22j7L36irdpMxpQT57TsMgWk/DKWPlOVpP6B6JlUx0elQywv+O+Q5YFmZb9tO2XhxyCAPV3v9xNpw3kFUxUIAd28MkYhpwilieToVC/U8sPHz/FGo6ksU5oh87njiTpr/8nHPwPIQ5TYEkBjseeT4lVUPtGNaeOOZjAlLFvOCj+ZeFauAdmkajpt9fUBcs/Ep1Et3Nk4rhx1H5Iekk1nmqofbQkEUjsD+Q7Ma0GYrdsP8K1baD5kmEoTJSoITtQFPLTNZYcI2JMudRGfoUl/4UU2hHdwlnJ5L18P4evR3tZt6T7KHGaJmruD826s/Rm4Mx/gb7o75AnZPQCFYCs4YxdeSidps1Zgp4d0VmuRMAVSCpwu0lDtYz+yFoolisjdekTpxbipDGl/9NKQbg7IR7c20V+vjvVWTqU0JbGjNgfOV271LSrxzevs2OxSto/ofDBeR8niyUSnRtN/QPq1kYmR+QKsqU0X8rydCUTiuBpkLAu14n+hwfoHCWnNpk7xXGHiLKOa4D9So944ThFBRWNaTD+SMuZl0sxAbHUDm1q1+sbI='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 459, 'candidates_token_count': 18, 'total_token_count': 707, 'prompt_tokens_details': [{'modality': 1, 'token_count': 459}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 18}], 'thoughts_token_count': 230, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -1.3939988878038194, 'model_name': 'gemini-2.5-pro'} id='run--824d313a-612b-46a4-818e-b124d949e9c7-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'pytest sympy/printing/tests/test_latex_subs.py'}, 'id': '64f56b1b-a4ec-49ed-8700-37d559fdee8e', 'type': 'tool_call'}] usage_metadata={'input_tokens': 459, 'output_tokens': 18, 'total_tokens': 707, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 230}}
2025-10-06 09:00:27,230 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: pytest sympy/printing/tests/test_latex_subs.py
2025-10-06 09:00:27,330 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 127
2025-10-06 09:00:27,331 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:
pytest sympy/printing/tests/test
t_latex_subs.py

bash: pytest: command not found

2025-10-06 09:00:28,864 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'run_command', 'arguments': '{"command": "pip install pytest"}'}, '__gemini_function_call_thought_signatures__': {'f4169730-d3c5-4dc1-a99b-8edd403e63e8': 'CtICAR/MhbYPtolxp5UPX1r/3R4XzO894OgwQdpDJmq4OZU2hzRivuscYKaTL8ygEmYH4e2iRvxCeRxgqiaKZ6xXnqHDnzFR/YZTg3pz6Xm7H6k6/41cMy5963oGFVsd37sfd4r57AXNLkdRCE2LnWBRTK/gdJlZ7geHomI6T9Xzf+UliPZcJf78jACNtIMNtyUsnC5tw6uJcSeoWCWaDf5zbXb7BtOu4u9eusYAPqBgnQMlzpq+0zSCnwWifqsDt03mIiOtlipNmLmaRa65aqhoo2zhVUUIL0CN+b25iIXYhdGOXPigtSa31bNKcgjIG12SldHdXM0mU2e1YCg3Oi8lKa6L/71EriDhs95YInCV3q0RWPS04Cb1BZwqGjdCGCUrH09Crkj0tUOllkRKw71sBYe85JHrXot9ikMdnlrqiQdoHbjm7ZPfIn2kEEiXbMIjbh0='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 506, 'candidates_token_count': 7, 'total_token_count': 597, 'prompt_tokens_details': [{'modality': 1, 'token_count': 734}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 7}], 'thoughts_token_count': 84, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.8655982698713031, 'model_name': 'gemini-2.5-pro'} id='run--a56b8acf-7df6-4221-b3a5-0626165c5a53-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'pip install pytest'}, 'id': 'f4169730-d3c5-4dc1-a99b-8edd403e63e8', 'type': 'tool_call'}] usage_metadata={'input_tokens': 506, 'output_tokens': 7, 'total_tokens': 597, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 84}}
2025-10-06 09:00:28,865 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: pip install pytest
2025-10-06 09:00:30,207 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 0
2025-10-06 09:00:30,207 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:

Collecting pytest
  Downloading pytest-8.4.2-py3-none-any.whl.metadata (7.7 kB)
Collecting exceptiongroup>=1 (from pytest)
  Downloading exceptiongroup-1.3.0-py3-none-any.whl.metadata (6.7 kB)
Collecting iniconfig>=1 (from pytest)
  Downloading iniconfig-2.1.0-py3-none-any.whl.metadata (2.7 kB)
Collecting packaging>=20 (from pytest)
  Downloading packaging-25.0-py3-none-any.whl.metadata (3.3 kB)
Collecting pluggy<2,>=1.5 (from pytest)
  Downloading pluggy-1.6.0-py3-none-any.whl.metadata (4.8 kB)
Collecting pygments>=2.7.2 (from pytest)
  Downloading pygments-2.19.2-py3-none-any.whl.metadata (2.5 kB)
Collecting tomli>=1 (from pytest)
  Downloading tomli-2.2.1-py3-none-any.whl.metadata (10 kB)
Collecting typing-extensions>=4.6.0 (from exceptiongroup>=1->pytest)
  Downloading typing_extensions-4.15.0-py3-none-any.whl.metadata (3.3 kB)
Downloading pytest-8.4.2-py3-none-any.whl (365 kB)
Downloading exceptiongroup-1.3.0-py3-none-any.whl (16 kB)
Downloading iniconfig-2.1.0-py3-none-any.whl (6.0 kB)
Downloading packaging-25.0-py3-none-any.whl (66 kB)
Downloading pluggy-1.6.0-py3-none-any.whl (20 kB)
Downloading pygments-2.19.2-py3-none-any.whl (1.2 MB)
[?25l   [90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m [32m0.0/1.2 MB[0m [31m?[0m eta [36m-:--:--[0m
[2K   [90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m [32m1.2/1.2 MB[0m [31m76.4 MB/s[0m eta [36m0:00:00[0m
[?25hDownloading tomli-2.2.1-py3-none-any.whl (14 kB)
Downloading typing_extensions-4.15.0-py3-none-any.whl (44 kB)
Installing collected packages: typing-extensions, tomli, pygments, pluggy, packaging, iniconfig, exceptiongroup, pytest
Successfully installed exceptiongroup-1.3.0 iniconfig-2.1.0 packaging-25.0 pluggy-1.6.0 pygments-2.19.2 pytest-8.4.2 tomli-2.2.1 typing-extensions-4.15.0
[33mWARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager, possibly rendering your system unusable.It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv. Use the --root-user-action option if you know what you are doing and want to suppress this warning.[0m[33m

2025-10-06 09:00:31,207 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'run_command', 'arguments': '{"command": "pytest sympy/printing/tests/test_latex_subs.py"}'}, '__gemini_function_call_thought_signatures__': {'e1551433-a898-41e5-9dac-302b16ecff09': 'CpIBAR/MhbYn8gqXED5K9y7sTWb10GfbgqLhhxqCbmTT3XiLq+53JjAnbnp5MD1GTXzfnavJ+EK/Um0Tc+HVuOf6LlS1FNs20OolVSvAgTKVf3ZO38VbzgkJk/Av4SSXuxNPUbSkzn2rwLrW8CVoP2nYfYJIr/juW+ZJve7OmqsO7VLVqU5FG9WtvRJB31DGYsVLgwoKIgEfzIW2JG9galieCruoGGJesjU0GGqe9CA1sQoXl80f6bU='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 1379, 'candidates_token_count': 18, 'total_token_count': 1433, 'prompt_tokens_details': [{'modality': 1, 'token_count': 1689}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 18}], 'thoughts_token_count': 36, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.12187018659379747, 'model_name': 'gemini-2.5-pro'} id='run--07ff35c7-c61a-4374-aebd-45da74701e19-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'pytest sympy/printing/tests/test_latex_subs.py'}, 'id': 'e1551433-a898-41e5-9dac-302b16ecff09', 'type': 'tool_call'}] usage_metadata={'input_tokens': 1379, 'output_tokens': 18, 'total_tokens': 1433, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 36}}
2025-10-06 09:00:31,208 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: pytest sympy/printing/tests/test_latex_subs.py
2025-10-06 09:00:32,567 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 1
2025-10-06 09:00:32,567 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:
pytest sympy/printing/tests/test
t_latex_subs.py

[1m============================= test session starts ==============================[0m
platform linux -- Python 3.9.20, pytest-8.4.2, pluggy-1.6.0
architecture: 64-bit
cache:        yes
ground types: python 

rootdir: /testbed
configfile: pytest.ini
[1mcollecting ... [0m[1m
collected 1 item                                                               [0m

sympy/printing/tests/test_latex_subs.py [31mF[0m[31m                                [100%][0m

=================================== FAILURES ===================================
[31m[1m________________________ test_latex_subs_parenthesizing ________________________[0m

    [0m[94mdef[39;49;00m[90m [39;49;00m[92mtest_latex_subs_parenthesizing[39;49;00m():[90m[39;49;00m
    [90m    [39;49;00m[33m"""[39;49;00m
    [33m    Test for incorrect parenthesizing of Subs.[39;49;00m
    [33m    """[39;49;00m[90m[39;49;00m
        expr = [94m3[39;49;00m*Subs(-x + y, (x,), ([94m1[39;49;00m,))[90m[39;49;00m
>       [94massert[39;49;00m latex(expr) == [33mr[39;49;00m[33m'[39;49;00m[33m3 [39;49;00m[33m\[39;49;00m[33mleft. [39;49;00m[33m\[39;49;00m[33mleft(- x + y[39;49;00m[33m\[39;49;00m[33mright) [39;49;00m[33m\[39;49;00m[33mright|_[39;49;00m[33m{[39;49;00m[33m\[39;49;00m[33msubstack[39;49;00m[33m{[39;49;00m[33m x=1 }}[39;49;00m[33m'[39;49;00m[90m[39;49;00m
[1m[31mE       AssertionError: assert '3 \\left. - ...stack{ x=1 }}' == '3 \\left. \\...stack{ x=1 }}'[0m
[1m[31mE         [0m
[1m[31mE         [0m[91m- 3 \left. \left(- x + y\right) \right|_{\substack{ x=1 }}[39;49;00m[90m[39;49;00m[0m
[1m[31mE         ?          ------       -------[90m[39;49;00m[0m
[1m[31mE         [92m+ 3 \left. - x + y \right|_{\substack{ x=1 }}[39;49;00m[90m[39;49;00m[0m

[1m[31msympy/printing/tests/test_latex_subs.py[0m:11: AssertionError
[33m=============================== warnings summary ===============================[0m
../opt/miniconda3/envs/testbed/lib/python3.9/site-packages/_pytest/config/__init__.py:1474
  /opt/miniconda3/envs/testbed/lib/python3.9/site-packages/_pytest/config/__init__.py:1474: PytestConfigWarning: Unknown config option: doctestplus
  
    self._warn_or_fail_if_strict(f"Unknown config option: {key}\n")

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
[31m[1m                                DO *NOT* COMMIT!                                [0m
[36m[1m=========================== short test summary info ============================[0m
[31mFAILED[0m sympy/printing/tests/test_latex_subs.py::[1mtest_latex_subs_parenthesizing[0m - AssertionError: assert '3 \\left. - ...stack{ x=1 }}' == '3 \\left. \\...st...
[31m========================= [31m[1m1 failed[0m, [33m1 warning[0m[31m in 0.30s[0m[31m =========================[0m

2025-10-06 09:00:37,651 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='I have successfully executed the test file `sympy/printing/tests/test_latex_subs.py` as you requested. Here is the output:\nBASH_OUTPUT\npytest sympy/printing/tests/test_latex_subs.py\n============================= test session starts ==============================\nplatform linux -- Python 3.9.20, pytest-8.4.2, pluggy-1.6.0\narchitecture: 64-bit\ncache: yes\nground types: python\nrootdir: /testbed\nconfigfile: pytest.ini\ncollecting ... \ncollected 1 item\nsympy/printing/tests/test_latex_subs.py F [100%]\n=================================== FAILURES ===================================\n________________________ test_latex_subs_parenthesizing ________________________\ndef test_latex_subs_parenthesizing():\n    """\n    Test for incorrect parenthesizing of Subs.\n    """\n    expr = 3*Subs(-x + y, (x,), (1,))\n> assert latex(expr) == r\'3 \\left. \\left(- x + y\\right) \\right|_{\\substack{ x=1 }}\'\nE AssertionError: assert \'3 \\\\left. - ...stack{ x=1 }}\' == \'3 \\\\left. \\\\...stack{ x=1 }}\'\nE \nE - 3 \\left. \\left(- x + y\\right) \\right|_{\\substack{ x=1 }}\nE ?          ------       -------\nE + 3 \\left. - x + y \\right|_{\\substack{ x=1 }}\n\nsympy/printing/tests/test_latex_subs.py:11: AssertionError\n=============================== warnings summary ===============================\n../opt/miniconda3/envs/testbed/lib/python3.9/site-packages/_pytest/config/__init__.py:1474\n  /opt/miniconda3/envs/testbed/lib/python3.9/site-packages/_pytest/config/__init__.py:1474: PytestConfigWarning: Unknown config option: doctestplus\n    self._warn_or_fail_if_strict(f"Unknown config option: {key}\\n")\n-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html\n                                DO *NOT* COMMIT!                                \n=========================== short test summary info ============================\nFAILED sympy/printing/tests/test_latex_subs.py::test_latex_subs_parenthesizing - AssertionError: assert \'3 \\\\left. - ...stack{ x=1 }}\' == \'3 \\\\left. \\\\...st...\n========================= 1 failed, 1 warning in 0.30s =========================' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2812, 'candidates_token_count': 607, 'total_token_count': 3454, 'cached_content_token_count': 1539, 'prompt_tokens_details': [{'modality': 1, 'token_count': 3156}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1539}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 607}], 'thoughts_token_count': 35}, 'finish_reason': 'STOP', 'avg_logprobs': -0.008550674557882243, 'model_name': 'gemini-2.5-pro'} id='run--5a59ae00-9a96-49e1-827a-3f724590280e-0' usage_metadata={'input_tokens': 2812, 'output_tokens': 607, 'total_tokens': 3454, 'input_token_details': {'cache_read': 1539}, 'output_token_details': {'reasoning': 35}}
2025-10-06 09:00:44,588 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_structured_node - DEBUG - reproduced_bug=True reproduced_bug_failure_log="FAILED sympy/printing/tests/test_latex_subs.py::test_latex_subs_parenthesizing - AssertionError: assert '3 \\left. - ...stack{ x=1 }}' == '3 \\left. \\...stack{ x=1 }}'\n\n- 3 \\left. \\left(- x + y\\right) \\right|_{\\substack{ x=1 }}\n?          ------       -------\n+ 3 \\left. - x + y \\right|_{\\substack{ x=1 }}" reproduced_bug_commands=['pytest sympy/printing/tests/test_latex_subs.py']
2025-10-06 09:00:44,588 - thread-139660780025408.app.docker.base_container - INFO - Cleaning up container and temporary files
2025-10-06 09:00:44,589 - thread-139660780025408.app.docker.base_container - INFO - Closing persistent shell...
2025-10-06 09:00:44,689 - thread-139660780025408.app.docker.base_container - INFO - Cleaning up container and temporary files
