2025-10-06 20:58:34,614 - thread-139660780025408.app.docker.base_container - INFO - Created temporary project directory: /tmp/tmpmlji6_gc/django
2025-10-06 20:58:34,614 - thread-139660780025408.app.docker.base_container - DEBUG - Using workdir: /testbed
2025-10-06 20:58:34,615 - thread-139660780025408.app.docker.base_container - INFO - Pulling docker image: swebench/sweb.eval.x86_64.django_1776_django-11095:v1
2025-10-06 20:59:00,339 - thread-139660780025408.app.docker.base_container - INFO - Tagging pulled image as: prometheus_user_defined_container_46cf9df7d8
2025-10-06 20:59:00,344 - thread-139660780025408.app.docker.base_container - INFO - Starting container from image prometheus_user_defined_container_46cf9df7d8
2025-10-06 20:59:03,245 - thread-139660780025408.app.docker.base_container - INFO - Starting persistent shell for interactive mode...
2025-10-06 20:59:03,385 - thread-139660780025408.app.docker.base_container - INFO - Persistent shell is ready
2025-10-06 20:59:03,385 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: . /opt/miniconda3/bin/activate
2025-10-06 20:59:03,507 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 0
2025-10-06 20:59:03,508 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:


2025-10-06 20:59:03,508 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: conda activate testbed
2025-10-06 20:59:03,637 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 0
2025-10-06 20:59:03,637 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:


2025-10-06 20:59:03,637 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: sed -i '/en_US.UTF-8/s/^# //g' /etc/locale.gen && locale-gen
2025-10-06 20:59:05,033 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 0
2025-10-06 20:59:05,033 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:
sed -i '/en_US.UTF-8/s/^# //g' /
/etc/locale.gen && locale-gen

Generating locales (this might take a while)...
  en_US.UTF-8... done
Generation complete.

2025-10-06 20:59:05,033 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: export LANG=en_US.UTF-8
2025-10-06 20:59:05,133 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 0
2025-10-06 20:59:05,134 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:


2025-10-06 20:59:05,134 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: export LANGUAGE=en_US:en
2025-10-06 20:59:05,234 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 0
2025-10-06 20:59:05,234 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:


2025-10-06 20:59:05,234 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: export LC_ALL=en_US.UTF-8
2025-10-06 20:59:05,335 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 0
2025-10-06 20:59:05,335 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:


2025-10-06 20:59:05,335 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: python -m pip install -e .
2025-10-06 20:59:06,503 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 0
2025-10-06 20:59:06,503 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:

Obtaining file:///testbed
Requirement already satisfied: pytz in /opt/miniconda3/envs/testbed/lib/python3.6/site-packages (from Django==3.0.dev20190416084545) (2024.2)
Requirement already satisfied: sqlparse in /opt/miniconda3/envs/testbed/lib/python3.6/site-packages (from Django==3.0.dev20190416084545) (0.4.4)
Installing collected packages: Django
  Attempting uninstall: Django
    Found existing installation: Django 3.0.dev20190416084545
    Uninstalling Django-3.0.dev20190416084545:
      Successfully uninstalled Django-3.0.dev20190416084545
  Running setup.py develop for Django
Successfully installed Django-3.0.dev20190416084545
[33mWARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv[0m

2025-10-06 20:59:06,561 - thread-139660780025408.app.lang_graph.nodes.issue_bug_reproduction_context_message_node - DEBUG - Sending query to context provider subgraph:
Issue title:
add ModelAdmin.get_inlines() hook to allow set inlines based on the request or model instance.

Issue description: 
Description
	
add ModelAdmin.get_inlines() hook to allow set inlines based on the request or model instance.
Currently, We can override the method get_inline_instances to do such a thing, but a for loop should be copied to my code. So I wished add a hook get_inlines(request, obj=None)

Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-10-06 20:59:06,562 - thread-139660780025408.app.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Enter context retrieval subgraph
2025-10-06 20:59:06,562 - thread-139660780025408.app.lang_graph.nodes.context_query_message_node - DEBUG - Sending query to ContextProviderNode:
content='Issue title:\nadd ModelAdmin.get_inlines() hook to allow set inlines based on the request or model instance.\n\nIssue description: \nDescription\n\t\nadd ModelAdmin.get_inlines() hook to allow set inlines based on the request or model instance.\nCurrently, We can override the method get_inline_instances to do such a thing, but a for loop should be copied to my code. So I wished add a hook get_inlines(request, obj=None)\n\nIssue comments:\n\n\nOBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,\nincluding ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.\n\n<reasoning>\n1. Analyze bug characteristics:\n   - Core functionality being tested\n   - Input parameters and configurations\n   - Expected error conditions\n   - Environmental dependencies\n\n2. Search requirements:\n   - Required imports and dependencies\n   - Test files exercising similar functionality\n   - Mock/fixture setup patterns\n   - Assertion styles\n   - Error handling tests\n\n3. Focus areas:\n   - All necessary imports (standard library, testing frameworks, mocking utilities)\n   - Dependencies and third-party packages\n   - Test setup and teardown\n   - Mock object configuration\n   - Network/external service simulation\n   - Error condition verification\n</reasoning>\n\nREQUIREMENTS:\n- Return 5 complete, self-contained test cases most similar to bug scenario\n- Must include ALL necessary imports at the start of each test file\n- Must include full test method implementation\n- Must include ALL mock/fixture setup\n- Must include helper functions used by test\n- Must preserve exact file paths and line numbers\n\n<examples>\n<example id="database-timeout">\n<bug>\ndb.execute("SELECT * FROM users").fetchall() \nraises ConnectionTimeout when load is high\n</bug>\n\n<ideal_test_match>\n# File: tests/test_database.py\nimport pytest\nfrom unittest.mock import Mock, patch\nfrom database.exceptions import ConnectionTimeout\nfrom database.models import QueryResult\nfrom database.client import DatabaseClient\n\nclass TestDatabaseTimeout:\n    @pytest.fixture\n    def mock_db_connection(self):\n        conn = Mock()\n        conn.execute.side_effect = [\n            ConnectionTimeout("Connection timed out"),\n            QueryResult(["user1", "user2"])  # Second try succeeds\n        ]\n        return conn\n        \n    def test_handle_timeout_during_query(self, mock_db_connection):\n        # Complete test showing timeout scenario\n        # Including retry logic verification\n        # With all necessary assertions\n</ideal_test_match>\n</example>\n\n<example id="file-permission">\n<bug>\nFileProcessor(\'/root/data.txt\').process() \nfails with PermissionError\n</bug>\n\n<ideal_test_match>\n# File: tests/test_file_processor.py\nimport os\nimport pytest\nfrom unittest.mock import patch, mock_open\nfrom file_processor import FileProcessor\nfrom file_processor.exceptions import ProcessingError\n\nclass TestFilePermissions:\n    @patch(\'os.access\')\n    @patch(\'builtins.open\')\n    def test_file_permission_denied(self, mock_open, mock_access):\n        # Full test setup with mocked file system\n        # Permission denial simulation\n        # Error handling verification\n</ideal_test_match>\n</example>\n\nSearch priority:\n1. Tests of exact same functionality (including import patterns)\n2. Tests with similar error conditions\n3. Tests with comparable mocking patterns\n4. Tests demonstrating similar assertions\n\nFind the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.\n' additional_kwargs={} response_metadata={}
2025-10-06 20:59:23,534 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"text": "get_inline_instances", "relative_path": "tests/admin_inlines/tests.py"}'}, '__gemini_function_call_thought_signatures__': {'b0114d7e-931d-4427-9d11-8238f4efc3a0': 'CtcQAR/MhbZr2FqOH6FRBSA2iP1nB+SeO4Fbyy/HBPJz0PWAbvizMAQcP01hZ1Ke0sZIRzWxoGQE/2o3wAX8INEVwe90sPDOsqNDz25DJETjUxasPSSUK1Swxp3ZbOpRrZNi9lYrvpeJ+XoMl7bobk4AD8nc1jTWYEiicSxaazojiMEMUXt2Jed98oTC38MmCXUuawCv741ovt4Hr7zG4nj2gfTuAD3xe/PzyHlY7MGes85mZT8WujXq6/1SUHBHKT0vs4xelnCXnTEvQ9z3M45XJ92Qg0BZZCPwVIYCJVBjsMtGFneUQ9de/IDigt4v/4owY6+7R+bPJU80j0Z9BuuhF08vf5+gAAwB3aVjNbK+/1tZ5AQoxO8CDVD+VZqQZJX/VR2xHLAWH0aR9YbY1J01VjOg/x+KiWDYE4WW/pRB+07B8FCDm+67FeNvwJkpesINHC6PFopXlKMaNTOEmAt++TFTme7lT12hGfsAaqjDkRAE+nyhmJ95y1w5N4V7vf+AN4hpydbgQWWAGWS8UWnlv0ZRcE1XT3r55kC2JBYGeuJU4AyznQYvepn8P6tb/1ixmDmIauHg8JnujhLHAeQ1DW/rX27B16+Z8acSRHABZSE9Q3FTuei5yJToxZvLdzq+i/vQxUWZKQ51C9bOzIA55c4MtaR4H9j36Dc+9H4wu6zSw0fn/v+/4HvueOYMkfoCfJY8j22kYzTEhTltU/MAqdjQSc2J+d5HvWlHjsMYVXMFnyR2xqpAd7QDNyw+TDz1v2etCQe2HE8VA8lKV7l8KaK2xRsHsxzVOcWYcjjZk1Ln18CeXcQYlULtEyAvkgKm4XvmyzGpW5fWdjt4hjXZfukfYFULH6435vf9+r1WqWHk/lZY+sWIrvzk2KeUtCUoeDL5C/gqcgyTsc0h0Qs3vyCHnQo9WwRZn7Gd8xdtqa82Ah+8dYBEtMTw+kUf4iqKA8dHF2QZXLvpa2VCkD3/ytXKYBKXMkR+potdxMFvOmKQKnum75Ho5+k6ySMllEHlI++mtsvZZejQABjJzokJkjaoJ7dldrfzoGNHRcgy24Y4jREuMXDv5VBTE6uU45voEFPywEEJfBpLFglh8pMohLhvIptw8ne39IBZ4eX9om8Vww3CX02fpSTqu5L3DqvhjYbCe44Om9j7NipuyOJGgTR63LDniBsbaHx+8Vz7S7YIXo5lOsAme8StukNp2AjuPpfEiaOueNRhMWU5WzSqTYHxY45HKywtWeVrf+ZvJIMmBDp+q6fsH/M1BGXudEbRE5YvoUSshvBsMZNK/lktJGopfT5hMysutVZkWpipIEHHpuplqQiThKNBgJBubxYnbEkURBSZdgUO3ChWvz+jIdggwGuMRuOlQu8jOjbi1xlmdyTbhkcWm56F570br5YgT4ckTJQsm/B80jcKwQtoUj+UH6s80hYTjm6ATmVQnPOILFxxTqGs+mT7D/zPKRyzA9DGBi7waFMxXVUwcFHZCkFPA3zMQ81/UQzfMqyGLT1/NbxRlNG51jOeVd7D2cNdqsivICv99XCx/4QLY0R7W2MDBmRoMTkHKy3zHioSQcFyyHQDFefifOpS/XVkY79Q+ID73XqR5qfwu49PI5SiwGThudSt5Tgs8aVnT/vUvWtFBK7uuh5KmPpKQd083nEiCeVGklP/8tv33Hv0YuhSrfZnndkY4glaXT9UCDslD1/Hau3vJxY2o5FXoQm3mWsW8NwVjBoZsCrwrm6BFDVFqoNN14yt85L+NjBYmIq7Hoop7DqDrrK+4khfKoO8RyqidDa2cOJtsMDfwXfiXGgDcR5sWzsxr36aoFPYCYzB5rmG4ZQjkfZ3TSijMzrQ4WiOf+DITVN/3WKnGUdlWBIJ4QflQV6im7jiv6eFywDUzBsDIhdVaTyfVvJFbBYDdgNpiGlMpOAV+Iyl93SM9jyB8zNr9WVZzitKOrvIaAPuvF81mrw/jBV3omCGvF1XjsC4tmcl5XzRFr0XGIgOZPdoemCxyr8FUJ8cfpjXiukOuVJ16xRTzMt9xt7Z6gc3G8aJa4j3gINIBF4eA6qe3GBidSClwR5JdFWDbN7PbXWFNbXv5bArBSaeseOanTHJU4unXxfYjCtfCaNKZyVHHnEHbvmXGcY7eqSZ1wG8LN+P8PZG87pl1YdWoY7FZZUza1gpiuLHsub1fgTJfk5BKP8hpVJ2pw/LRByuXGGZQLBJ9Uw5Ot5iGps0z1d5M7JpPlqncngXjqBgUemq3kvNtt4EETiqiFGO7VaY08pFtz9G0MOrw6fUpyYVno7X1iTjpmWHTEvNrnn4PsDWtF2ZCXmxvt5VYiyJdQwo+LSE1dphHycR9DyromLp4jDnnb0OKXmuLfnlWCXqEQsz2iMyE7iKCoLwPq2q+GvXrisZitR6jvaYC7dql8vib/ZFCKaYp9Wf/LM1pwf//+shnzYB6DZsKEdCeQ5C3J+0TecjDqK/OEbv1tq1EOcnVxN1orriZblze0WQLsAOh+HJRuNo7cScCm1M9tJUg3b+tMZYFiOyLxRsB+5QVmSCxrz2R7OWiewRQV0+UixTAuuayNEBtYJm/iE5+7QBD/yd/JrEFhOVYKKBv6IKxb3h8OLi+9HK2QIuu8Q+fMr16lGRknets+E4HQ+WrWsX99gYQXUPsMXNh13KNf6AoO26WDN7lYNWdZoL3hA8GYA+m/ATbkNEQBDW+wfBiscIIE6HtHlJHU0JbsaPqGATgW8koWlqFCHNrUTDWZdTrwGzDJSWgA1qooICnozYKSYzFPwmyR7pzAPnfhI7wihpDrYAFd/ijT7pWBT/NzFRFSP7kXIIS/i3uLNUxUExUiWIEYQKsQEBH8yFtlSNSde4ijOpxV96jpSfDfWBdml63qXriVCQ3eUJkiy+UPCxKBGBapp2igrs5nqO15UdgfSjSF2U0+FPr6xy1F/7pkGBgJ5AiTdaRYbk4iVYG4WOfxoaB6k9GMdw83XtJ0bkbNCCDym1h4sTgojRNPNpeMJFPHaGWrBIGy68TfEXeguziw5fTra9mZ5BScL8QaWo8UujKOlQ1UC4/yK2MOBVHnKPeohaliIFqwMKvg4BH8yFtk1YtB3b5/miHAQLII0CCllwPW5CENX89g31p+qhuFw9P7nbWXEvrAiuPCGjQjQ3WEXGXO/yK1h82b91fjBwH2FYfYobl+Ee0hEcqil1FQG/R8rApM9Ps+LqvXVRsjyZTa7Ohz5P6aH3Ybnuk8WGpW6iBp9lqV7qsZYMrOf8OqWX1ySQOy2FFszYLW/sO6GpnUo3pPH4hVxWWx+59rO3+4anF8/a6vWqYeZqujPR4ukMpnOVQXSw7YN8W1GlYdflfYXi6lKwV18x9Ly3c4ioKHOb6sgx1ViP5YYE03+74pN6mEX5TABx1W5h/xrKOu+R6RY6SYhtG0J7qhHx9aWmEdVvrFFKcaSdxprHNJIivK9c4JOIQu/vynJqWKgaswqWueDq/Y2czL4V6PpOB7uO2dQxXkntFE5l57tVtz8k+iJdksFY4kdgCOn1jSFgh1lPWk8L6gjfwSP7117MKFQXvvFNOZtxlSFHKLdChfxqQQSp4odOna/FPF/F7zvlJuiNv3xHOCQ36I93+qmfnXAJQsdJBKq590K1nYKxUEVtYEi3bDAjRNXtYRKU9UX681YOxrGjJgx7mZzRaaDFIq8reMZd17t59yZbh1Ca53Yp/17XtTfZ3GRJ0tDfxPPUfFlQMwPAHMRU/5b1mWXzjIoCbgh7BZ9gzcCv9egxge6a6lhD79EY6waKOVB0jKns3FnK9jrzrztsR2TcKCr/POYP5k4Gsa5VRcQ4URGOanwBSpSIFjoMdwdlchQA55LhX3foMyCKg+Ec2OXYOVQ8DUZBqpz1way3hDhbZY0+9J6LP0wH+VhDRgwom8yF/kJ0miIJ9ATjC5FKh61PT2Xn234SsjJFmkhXHja3bjtUPult2TiPpruhzoQqGu219JYmvLZ/sbF9OVFyhSwWBVdxy3TEMcbBIN2lCPPNbl3/uZ1eGXP+wZXcVXGKyVESiYyvzroJ3RaZd/ZJOsMkUm5KDZFOmOfz3ldhL2lMICZd/X/aNIo/M9PlGLfYGkhSecPyJXkyka1DZDH81i7kB0xRLy9NzRbk0gyg0csIz5pH9oS0NOp7g8viDEVvY2pTKCWB8loki5mJNzfhT0DdTtG7PQnkNEDlqbqtFDqBQr5rxWnThW2NVUy0TVvylKVBroOc24Xb9SGtxjnXt1+Fb6YS2s48Z7zo5TKWIRzdg/tgRIqrhWjKjEs/M+YTQJMRYmh/VV6kBZGms6EFTsUWuzcM/NhCLcaxZ4bYWQADIY3VS4Lws6/eBwiEdNn2Efsjv4EYa0fRdChOKsqh1bSxk18Tb18iHVJqppIQXjZNBNqtwbqP2PRxC9q/5GzoiE0Konkw/LjbE4Ug4KNk0tEfAGAjwM60fV5T40C4nxqswctKQs3K/OnrNgbZCFNaQwRtwZblxwkMuyvlrxVlUGbSFr37+ryfPmqJ7MbqPd0Ilf6xSUrmgA1R3woblmR0tPybvfqvE4Cj3YR/o/c0xpUKE2L2hcHlyIror9Ku+nE8OV+qzD51jADDvQ9yIIDeQRk7KJhKPiEs9zE5HJrcBAdLQAmGlUIuQyf1YabTyPUfiho49lnD3pIGSAd2Or39Eb+d8PnMT4uQ2Z05gOegxA+WuSgjM3AUbl0Q9s3TizEYcNYoBRHcPAuo2640sML/suoj1J3JLg/E8iE8voQ+Yf3UntuEqzNVt4PctTaV7XeAa+PZB4RFc7k8WM1OPqI4QYs4zFeUVWrcxTApC2IrWo5gqSi1H6C+vR/ei2lv8od0Wur1mFa+wUWijpAzayrTGXJf9tegDxv0NtH+0YQk8XUJuY1nWMmh6/PTVEgvSkMbhr9HMBPBKhISm7dJycNyHd0cgqnXEjRCCe1VFYFeSv/BIk4JKjYXm+U35yOVF2BWw9J6jdDKY9fEJMa0AMByloGA1KDR0Mt6NWYeLFNXsgY3Ab+9AIsf1JfJMmcCg8Z7WciSVZksJHVYFNbTT4MYM7KpnnNKMJTZpoNlII1jc6V80ksXqgSEBowni221Qmuworj4qxd9ahnSX0/dPMSXmZZesDvWAoot9C/SiK/QTbFJ+aAqDxHcVmTv4DoAbLj2ftdu8o2lM7yCBP0NXUcipGN98DoMxbMtomBJIFJUQh1jzZgx9AY8hoGp7XDCp3hicsNgCMeKUrLXhfQyxYuyjz9J8k9VTkd/7uxxx6BjJU5T+BJ+Z7X3fpuQjZITS5auF6t8OA5QXw8xHNvpcKFqDbx9vG7JTY7E4L/ul8l0LieOvHQfjDeov/RKRCyh+6M7stYeqt4IH+/16AJfZFK2lqVmIKOxpHwMKi1C9xMVULwqkwEMdLW3ZzhSDKfyvisWN/xbkKLjqdlA4+WDlxCUEyskM7k3RKxaGl1Sfuf2LSwjNF/FB1Uk8ItRKuVzLTnj45oubob3Uj4FPMWioq51PQL7uTdAPcfSncR83nbCivEjnWGu5jLVD0FqtKI2pjFgUgQKpwEBH8yFtkVeUqGdH91mJjTANDKpqMXHSTbJ31JFlE6ZjIP/6AAO94/qPoiNchuxqlD0Kp+OyjWsuAaTRCnyAAo+2ZGjQqvXa4SPOFFe3wLnInK6vkN3ibcfRtVOm+kBbNcKPBUjZF8aWeRGwQL23DaS9lHtfllRPsFOSGuCyMSfh4NxYsWs+hI7NS6m2ZyTRq+IdQThao1KeEL2aADOFtJqjztUxSwKtgqmBAEfzIW27dMX6HOxuP6LH80Xeh0gXGPRjw9s8Ok7S3mmJ0ML1X20MuPWrUxbpwyHYdDita6ez3ZSZZQ+YgsEfRqw40U9ydIszqWIGTfG1wCIL7VhS6AOEPgEHTBrR+Mdqr/aoGc473KvIEAB7IMy/2eQ6psWludj/sUnBjMb1V5iooCEyEo7d3BF8TUoSBYgS7SFx+8SQEbH2iHTpv97KV8oNaJ3Sha0aOc8jAyIDTewg2OTz8zgm9hnic0iTf/mqviFBT+FlGIuT3J5hIMe8IMZQiOd4evDiqAa35ZoRwbBvv88N1Q4+lajOr8KGUNEBjFK0izd5JQpV/m+Sh15fsBPIQ1FggkeW0weMF7xWuTsPGBFP1Jgpus39chgkQZrT6E4lRFeH/60rMpase61e94XzmKA4eqEv50SMn9GImDUil/BNGrPI8jph+WBL2yAeThQyhhYn5Q4qkyAV/DlLVE9PEYo84Fx0eCrYN6XvQBLkos43gs5BGm8UOn5DMGauRz8/0fnDGlPbQNPwD8Ovw1PXGSMVRD5ovyR83PN/Hrf3i1EAjfTVXMM77kNpjnQiTnW8ylpolWZ8iH1B5lNcgl+krvJ3F2bT+fW667Yny8NC2h/+HTxZXLWL70MGcxXRfS14YePt202tnLnP+ROAgMSABXWazrgMoiyI8JGV+UO1+ArMM0OrvXJ8iNHJNGtfeKVN7D16gXsLnR9VA3NS6JtTXsOTnM='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 54279, 'candidates_token_count': 38, 'total_token_count': 55638, 'prompt_tokens_details': [{'modality': 1, 'token_count': 54279}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 38}], 'thoughts_token_count': 1321, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -4.0842333341899675, 'model_name': 'gemini-2.5-pro'} id='run--5b9f8b5b-1ea3-46b8-8577-7f9131f2f8fc-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'get_inline_instances', 'relative_path': 'tests/admin_inlines/tests.py'}, 'id': 'b0114d7e-931d-4427-9d11-8238f4efc3a0', 'type': 'tool_call'}] usage_metadata={'input_tokens': 54279, 'output_tokens': 38, 'total_tokens': 55638, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 1321}}
2025-10-06 20:59:37,679 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"text": "get_ordering", "relative_path": "tests/admin_ordering/tests.py"}'}, '__gemini_function_call_thought_signatures__': {'ea835598-35a3-4d0a-b03d-d1ec36b42b8d': 'CsYeAR/Mhbb8ajslHf8wjYFO0kkGLYyg06dzqVBYpVAbBtUsFlDC5DRXbvgVkOabM1xzEpPkWMbw/tMC85cJp8fdkx8x7A3LdRkKKaOvV297qOSOkc20xCoDphVDZINNNLYugmWNt+z5LVe13MLpQdn52sIVhb365fn0GS44ifW0/qZr3E0AMbyy/mTzmB1MQFeRrIuLDI0OcO6Cu0QsfOCts9OWiRvjYO/jImAExxF4yXOj94HpA/1uyYtyZMo7KA2Zwz1UtSKod+wCVommdYDvDExhcoaBVCQnGWIZ0H2vh6EWp+dP8hb8YUmvP4SsHqpDKaGYoMY7WoGOpaTeTy+QVyP8RIHja/dEYcqIWs3R6ahjWOnGIDu4ENlgM2wqE13ST0851wmxVeq8+eOHBU2v4j56QTeQ4RsdJlKm3vqwp94DwyGse1swXwI8AeO11w/Cl4CAcNbRKhUP5XmA8+EU4HF2cBBNis1jbad+qeZ7OyOOZK12Cp6iaBmhV5L8OVe5delqpjxMYLKFnjqK/tVBUovwoXGioHfIeEEi9v9Z/yYMhMdva/lM5H1BHYHKexC6nwdPx9N9PyeCsqrnMA4VFT/z36FwqcMnP7zDIYbvcTw9sYpjiPIUU9NOFec2lN9DVsVqYXIioKnbVK1vImkhSgsX3hEWuD1PrXxiEqFgCSwSlXMVmfS5/4SxK8SqPwmRQZsr8Uzz0m7qZ06VrCNsfCOOOnBF074G6aaLJvRV52lGd+d93UyJqyzDBM+USDpO4O7Pw6vdUWH2dsl0XSaDxgZbrh5z5nNx37o01bfHlNZkSpAbUWKPwqRlXw1CVeQc+UWbIRUvo6shI5Y9LPYGEswgMgoQxvfk3YpLvXGnQYKUjpuTmIOJda6AgzxRC+sm8ixYM8lIi33hOKSKAhjQEQHPKquW3T40pIlGOh47VWc8OD/Ah2lNV+aj+EqS9Wg7mEQxIYKiTx9h0uhNdKn+2zslp6sexd0fr5DztcpWLYieg8zdNn34Rr/scfIYOC8Gdx2kNhT26h02ycpOWg3Ah9bQsNwSWHKYQE/1GKUwkqBXQ1m1n8VYDkljE5HMJLQc9OI8az6p4EKe4JQoggcEHF5vdqVEZetns1kxV+iz5C+C4eyPujHipGbqeB+PmoyoNEq3OgyigUskEMFJvlLjNqF6YLNXqzsTbiAWBlsYXJI70sIcV1FPu8RuF/1dTZXCLHZ69LnR3POWfeUL1SxCBkvCaUMk8SOpQ/dU0TNFGqXQZPlB09r3GdXBSlluTgEJEXA18OANgMjaOLZ/D7tSUDBBYL7F8Nh7rqJH3YtxIy0+Y25PpmaKfmKxEHb43n8rRrEhGjICKnX+4mcOxVb1eLyTUo3rpFzqHd6yTewlbEXSFrVjMW1uoa6jATUdcF7p8pHrY+L06ThHCIcc4lVDSQUkIbAhi8dDjhDheyYG6YvHzGcxfr5dulf5Vqz9vaK28cP7qzD0/NS4usAIzyD+PsH/obz3zCca+76yTNX+KsRLBgOcCmUKXGPDiu+/YAKFBAeFqWXKiSfOA6MTJp8CtKJT8pk/L+FQXOojfTB0ROQ/xGfcUqsD51RbGjo6deeutjAZQ8C2BO6R/3YHx6QM0sj1ccWmZuZnCGFddydjjT16BAxUzPLjTMUCfhEJ+R4m8QfgeioB2L6TvKcLf0wIRJBu/Q0jp/Tz7y6gnFtXmQxNuH+O/7hfnL6cuPIFz7O+Rs8oNUI0bqmS//PrIsH5Twxa3tTvbmKsfAPEX+K66U8UGvUuwsqmWZ/nZveRhYA0FOwKcaMrcoOsVuYAewBldjeSj0LiZKfRQ3sU1VJqMsb0pTFJWqeIYCEWRgp5dT5Io2ZU6uUvLPxc9S2NVDYFqkhqgof0clerlY+HrN7x57x5rtk4GwV38LXzldkltb8Ja+ON8+j5e2w2hize0vTMEE2Gmwca5iVjvPGbmVHl0VIgFxUiO8TTr0pKQvYiCtHc+9bpNkPL8monKz862HXNCCqQwX0IzXETo4y0uW/RRtr9qt+vB+LL61zxq2oA2kXYu0cydX3Ml05XmlR20q+/EoJv+ShDFfyYTosPAODEMTpFjlokrWGnO+Q3iWlno1NMf+WtVJZpKKO/zg56SO3t+pDVEZvd5DzoYl9WI632V2yF+8NEUnHq4C1Nk7Z0k2POu6m5NY+KFG5x+H7e5fwBqA9TdizyFtdOBwzKs4m9czu140vsQFgMym5iHR+Ce5RSeTOk/vJFGcIPLiyFLufvmaMZPX+Oeb5dY9E/kDNdopOfqR8Bnxyd+Kzn8iYX6Wzy8rePdhQWfHP0PQq0M3fDFigGi+2JoyU4fhp2hXg5qBc6WewRZmlqDIKL9sO1nRMIY6F/judVY0by4cG9iv17WeWVpDgUbXLKKC65DpYENKM2+O0EyB6GavZMc996gEXXhN6x3m6RoNzlFXL85T57W+ZKaDhIFEkL0e8uh4BwoLqBRI4eJNMNscFpt9YOffiUOG87l5PP3Q2juDosMEtCXDJvgMZmP9eIdBdFu/5VDJldKPzxCd3RgA1KHtTfJeQws9TtDS3INDHrobU7hAHZEIsTCWav+e0tt3SdBm/eu2zbkMw5y7GIPMmVCtL4yWUNHx9sVUGpJ0VROlqJKragYWVG4zllfr5IQiYynoeS+cIyJK7jIuTPO3CU3r3X5qRAIUTh9axO8DB5M5ce6TXuCLCoJuCF+vnH8Fn1vbBJVyep0SWxTdst6U5qGyGAQH9PUJHhzE/esb+SZkM/jNcksmFs6Ln7Sx9zhg8/uLLT+ZbqnUeUdLuNf1Z2/2hNj2ulZB+WoEwwMjH4EgvDKsdw2gFVnM1NDaEQP5Y2K8JBpgSNcl+Ku72k0A4ervQEHeZZjxA1Al7X9yP3W6BHtI+AqZbbRG0R5QzhIO0r0kv0p6o1N7DnGYNx7jdiLvtUKT1E7QwjXMZqvy51UCIJSkxsQaFavSUYZdSkd0eFS5FNyut/YMFHKfiLMW20FAi9zJ7t+rBKqz44LXXMlv1vkViplJcsbJ/hmHYCcsnA0lR6dshFtV6kPLOyeSbALa7DQBXXfMY6VxP5tvdGNBQzNmw/ePYwz6ER9rXy1tbGZZF0bd2wZ9zbHBxDkw8M7UtGUFCESEGW9TLRv5OPQkPxtDDBVbamYuVpRPNLRlWv5sMoQ+aA6rm/VY+ba/RJx2Rf4pTKC5vzbec+v1PszxNI2FLxgUEP8ma9mPn1CNDy92qhG2ALirjduqjJt9Jfd4ScQW33wqRBDIB/0eG4Frijo/PeP53KA/PUo0cBtYhBN1OZQ0LcT5bitAs7T3qK24ugrWitGGz+pvP1Venqjii3JSokJMMJpheE0ivJ/7tivGADVRdZE6FwOWvQW/sLM//Tga9GOHFDDE5f2AV3/l3Lk5B/wMSbRLUBtBKd2y2GndzOBSe73H0l6VYCtgJjJo/UP5l9wdb2JfqsTlMBzq126oYjG+yHrAQeZxCe2XCdy9WfitefaqrdiU+F6UFKVtDwI1WhMyCGGG1N3qswlF+iaSoaS4liVInGGp2EAOsInAb1J3L0lwoYzSWem1nGVXL8C/lDr74Thxthl659+qzfzZogoqJaUY5ifBA2Qfjf3tRhObBof+iUw+CblkAQLR711CetpfIclMs1y16SnHC4VVAtbr61CS8AoO2bJjMmpGhmRjuq7usUHisisYY5bTRsnpBcSc/8QVi7zuJerRZVV12XXJ3Z1xJ9kRwdn7W3jjq42nsRq4zp6DGqNz9zIwkyT1RPZlkxkewwbCmG8TtbNVIvSwu9uNHKyS0MF9RLJTMaF0Gq4dd5n1AOmcBJrcSFF7cT5ZG/fGU0Xkk0hmJJ34MWxc9IlrVkXleml1KYkzEFLoF1bsC9SCIftBjRcg7U132tJZTU/A4KTrrP0Aln+3XPAxrQoo7xjzzf7P4ZS6XbrAv3mEZqbPIGbDV3ysLllPB5icTndzBxF3KSVsioxSNKuy/vxryBKgE5doT//NyHfvUDL7VYtFJxl2z5mjwBOz44tDHJFbKSyMPYZtB5j/GXV47+e+ydLcglnFvEaER5GvBC6QJkDkx6bxf6OZQ+HKo6HC5HPtU9KSF/yi71vG7rQpTyzjthFQe+i25H/ifVAjbzVFmlP383mwkO8s7i7tEW8NT1ZYZnkXI1iNFGdV/je4mZsk5pC+Szdx/LGBF05PKEKSSc6SKlBD+2tTDlET8FIquKRf1Oi+P+jNzUnQ2GDXTaR3aIjxfyBwTSj9e1+zmu3XKFPLoZLxXs39O74Gdz0g8V+iz+NAVqGBr8R6JRqAHEOWyM95yjURiJqgRFQ6Dar4wktXAb8fGdAvVaKj0uxgKp5Vh2NlLtCjMw498c6/+qkv7f6GvgtWubRISAhlVPFwh1ySXDKhqlxBWpQN8UL2F95t5N8/NpKSUvIlizzTADDHxfZJYnTWSTiCGj2Hq20gUXFfNJgRy/hEXKV/rvH9CTiGuU3qJK7B4hacKfll6iOPEtLD4VdvkyVo9xHo641SYu/mhN6dh7QXbq1YAJq+k/Fr4chRtbj0hOn+CFtaEYLu2gsvgD+n5wL+C/0ng+6UfMqFTnXUzJgen3TUPUwOUC7iWTpxBne/oMDqAM4TQeUIXxktVANoGkFVAPAnoJ6EwYWF151XwEsmrzbf3NsGCSwop8yE54sUB3eUOmbwhMD40il2P4j0qfsvvQ2A/ieWj0PGMYJDxOZuyA5/w90BrZtZUayqYEFFcXxgAw7Xh49P6Vc4QzcFtJpOvIC/PmpQzMFjPlIqioquG/ScWOEvkEvJdkbi6Pb6WAJoPCqbd3C9fdr2ueKqcqBKoadUgXPzKGrCiHw9Jpb/1HqotSz1okSUsVhxvaGel3RdtMa2wB/qOgL7ArJZ0egq2IWYipEEJAJgTpT2XhWWZDUSZMOFLBjMD5wnxS/ukLOCwjYQ6spTHOEvnqU06re7qpH3qG2OWE5OxCYcNpVa9Y6jQx4O4lWVior3K+oz1VkmGFWtpbo+6la1NFBhjorLMQvNeEuEXQy3oiI/8EnRh0b5pmsSd7EXB4pplfMDZLCMBQvADCJTcG3FKa6MCYq7cDJGree6EBXGgz6ugBAJ3J8Regk9Srti5/ImPOWQo2BzfdgjOJGHG2dk+JDFgxqyjCYP/N4zQn0PM6qa8frrc5IDLXuhNMHroMc3el+gDwogIssCbMQLjf/A=='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 54349, 'candidates_token_count': 35, 'total_token_count': 55514, 'cached_content_token_count': 54205, 'prompt_tokens_details': [{'modality': 1, 'token_count': 55667}], 'cache_tokens_details': [{'modality': 1, 'token_count': 54205}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 35}], 'thoughts_token_count': 1130}, 'finish_reason': 'STOP', 'avg_logprobs': -5.371150425502232, 'model_name': 'gemini-2.5-pro'} id='run--ccde762c-db44-4ac4-86f0-96efebb3f807-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'get_ordering', 'relative_path': 'tests/admin_ordering/tests.py'}, 'id': 'ea835598-35a3-4d0a-b03d-d1ec36b42b8d', 'type': 'tool_call'}] usage_metadata={'input_tokens': 54349, 'output_tokens': 35, 'total_tokens': 55514, 'input_token_details': {'cache_read': 54205}, 'output_token_details': {'reasoning': 1130}}
2025-10-06 20:59:51,865 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"text": "has_add_permission", "relative_path": "tests/admin_views/tests.py"}'}, '__gemini_function_call_thought_signatures__': {'f54b622d-6f96-4f72-9fd7-b57e11fbbf0a': 'CrIfAR/MhbZW+OKAhLvzQpibgkEIngU1P2dN4DJLoMMXef2UopNIZvEICS9KdWfwcKaTSb5hOeIiMkiipmBMM5VeH6z23YNRfPCGvB8E8pCs90+hmjxXBCK4XER/zEnBoiEN/aXMYfc+MRDb6mJw2OD+aLii7vEq0ND1kwSxgwiAJMYFNt1O0wj47NfnQUMghJBOcTFTmiR0k6WFyaNAZNeynRIl2j82cTSvfJdpI6IZNSmmJNHoCK7TnZxQQCCMS09eztcQBtzeVCBzRhejeunhDKjzXuiok2td0gWFSzhNYQG+CZptGRtXtve2OaRmstl1mBBS8YL//Pph6zPcsEAMr8bD46yq1PBy9+NjGkeK2aQHCDF794C0ApgVuEfkWSLcDkKTjkbfNvKFxJ6GwhzSLKsACNdU3zF/JEGIrvhdJl/jYCXfxvDTJ2/f8jmzupahewlrFw8Qb7O0SOOH3iS1HC9xHMK9Y8PeuS54BVyL5pzg1T1xZmXceNJoKBGmNffezbl4FjYheTfHvO5oOIMoCN9V6U2SVEdq9tUGcRJGGKoqMJnOpwl7ncAxLtb7Ks8x7kjUcyMb98NYB7WOFXFQRRJIb/0jmCz5b9Pjw8TIzbl+s4A+H3KjHY1x8Sfq3Q2MIBh/dLN+UEVeREQd78Av99NNu3qv3/lFw/3oL9i/3lEpxyugyy6jYlJ07yyUgwqaG1/tnQZtuftKN37yIcWTA8cS1eq0Xvl0IHfx5/sBTS8dgHwfCg7aRuq12qtGMI0jc9bwAmy7NZVLW47ADaNEeEK2F1ld6yH8oZmBhsPZoUhmQB1x+lWFyt3jl9DCGyFQDVL3ubJM0zkRKuRHQTBmZ56lEtq2WaV6SEHBauqhEAATo73ghTx6dbmWixI8MbEkj+pMVopAX3GNgMbVb9/KJ7VJfgkybbsxi0Hucyc/8Q7b6SC/xHr5ywMY2TUxZmwcFWHkPTjwBwmPo8r++RCwjhrbVSq2z90B8pNyID2FldWTFfLVJmRjYjR0lpRhM+rxoHx8IVpOtnERPTSUYOk4z79DiarF9I+9Ommgff1ySAID1brG3kTpKcHpgA4PY3vFcCDrhBWPEd8TOA6qTSLGZygFmUs5p1LUs9cQ7jR5j6Slr40Zw6mwPy9HulCTtUk4e9uTFczZf0md/xwf/W+qgCfaqzmm7kEx73C737bgepgWt88uuHXmhrXVx9sBoS9mQLxjlSieKxgZYksyW+KwP6a32Cx23mmOlS7CJR/KiB1rjb3vOyugfQpNTcGdL0FHmX8MyjGimcEw6uM+c38d1iTM8y59Lq3GcVYkvymd48THc7xw1+25T6oRiFY4p2RyIRsgNDzzv1Tn6U12zGLIt+pN6kWmm9KYjQvzY7/1rTROzM7C0F0nTj4zOfrr8RMUk666xbae6wrYd9O2AvwIsZjOw/U8LG/4wpuATvr/Q9JC8WyYOGvWuF80VO7vsmhouf9LGxLqX6PTDNIWZ3AHKZCB5m5Mz25mVAfNfbO1O9OrHs3MjXtFj+VmCj+OHmqtZpFAIdS/0IowojmkmlbnON/bKuJ+aOySAzsnJi91Y0IOxoBX8CpECzOxXDd/s6eQB7R9eyXPv9UwAUQuDy80Q73MEUTnH6KqEqQoObN7NlFNQ72gavhMazB4umgSHORKIArQ/zGhd7/eqyGv1y1VqBllSuWzX2DheRpwNkf2pMCzjpZTrjc4hXw4aibSMEi5bAxfVzAaUFz+yAF91ZIHK7ZwCPOQEzOl1WFCC/Jz0G0a7NTUpBVNk2dYnhuFFMMbkHRKMAqgOFobBr67nVy9zFnAW8BlFmwGo0HwzbuGlrDia/wZGW+s0a9tjP8um8vlC9UBdMIjc+JQti98Xy31H/wZh9d+Dw0oHrNMYHO5Vs4jJp509AMBiSZyYhvHXk91ImJNn34bqiQt2VFT8q+ZmSo44q8hCq/nAjZrv1HTcAXEb7XzaOh/TRE9syVEI/nimsbgSmtP5X/fmZ++SqU/LJh1TpPseV9Gz0f/TLBeymcFs1PE8Zm2bbkTN05T3fINlcpLCyjrbJXSaRqDfMIWNu5TyaXL7laJkI/UDAH+sm999xa8y53LNVxL2iNmzaAUK2eZ7So8FcQZ8rqvRuT9tDstMvCh+Obs5e7AON0JZwZjDK6TPi+t1/NsznXzjggg0nN2fH9GydVDl/cl7VNkk0IYKGOjrre1iCMPGVCtk/fFV6fY1j41p40nYQkYdTV/fZSpmQfCFqjFqFxYN9v4JShXkdYXb4+iqTkornJHJbc3x4LSJz4okRY4yBUgIDCqsFk8ZdI96zC31hki/nWmGlxHH4cGVbDs7UKXRFmOScKpYR/tyz4mpyPoFBgTRfBoDkahRX6mYwU9CdXT2AfAjHsDONTQS9CEgtolX3OFtQP/CsPnKOPVC/jTun4DTgR5Oj+RZR5oIHCFXfUdIesU3xC7Ky3XdJDOkhlxHRRQD7OK4U4iRHWer15UWggH8RqTfizt9TdTsq57l94uwC/n8kEM0Nw+dUjGAjQQfNxHIkQJyU8304eR/4xKYMbNjQVhlZXC0LMTCf4ClSYjprlJKQJ07DMJQowx582PeKa+ZvHY/wdnJMZ/WOWPXlbcj57FLFX1RuKzn7nTnTiXz2D0ncbmcVhqVyMixXCF4IXn6f59tLaLJPHuQI2LgrZBynw0KgY6Pv2XPS4u+SkJHz77//5+YMjm6c7zGkxIBOjT30/mzz4eZNdmycEhnw8TEB+KMlRCN/hlPJ1u9fJeRylWsoj0asFtqyFmbPhVVpQqfySiRQOnM8QzMjxmSa7SJYZzWd0R+JMPPtHTcQRcOf1zqWVeENLhxjhF2loHkD412fTi7LScRil7mgGmzHEB7ZwQloJ1rOnFLoyfxYTbTuM4nc4h1Vt24+B+sh8d0KHR+uahVxxEATepia/r9KKDGt0z6GbgzFyQLTBYtif992AApyiA9j66vmz0Jf4aCfrQsg0IpX3k4sUYbwryhB3u928SPjkEE48t84zv9bq7mXHmH+8FT1yzn6Jya7BzCpSXPzDPaUFWZlMz0ZJ3XfOPMxwuJDqHbviH4beBcXFWJ0J0Xfw0AsqXGm86SMjDs5xSWNAHMlPJPxdtpyByJXX4IWxmDykwBlM9yirPZHZ6cxmjEu7euiEpED6CUls1yawbDBXcCKI83SJtYm1ngEMfS5my6ICu1FDHKjxk8YwPIvLAjc/vmb+FJy+Q6mY0JV8qSh5CSsf6qXEbYIKpwzBDKXNfcYkXECRiy1AhoUgWK7O22yePrrBSatVchWrzoTRUm9r6TKABIYgiq1QKmIJXlW0bX3aIERSow3X4uWkczYv2KyiBvArr0TXo1v6YLTdrJaxMAb4FptkSmH+U4VV0OExC0/UaGn30hLKaThV1DF0oVVYUMnSvlTzeGphzeir/J/6LVwVJX4cKdUy+na+FG8IaK8K2dGR+iLyozZGxNiDNhmFoq+4jxkgl0io3ZkXx2vvpJ3/NEOvNRO0WHS/YfbIqvTcdaN8IPB+OO9bhqRyWtbY1VFkwkQliiaAO+dGsQ6NYhZKPT2uZtkSRlE5GdC7Y0dJ3m7XW7j08DmCAKZp5SRNgZaJyQ36XyRk37zSNMIvqScpADaid85+jFoV7G8C3LWUQkOHMAiEBtRSyfJD6w2eQM/pQzo1pUGN1DBHGajaGaS4LUBG6h4Os3PmTwU73vSVI68gx5IsmOqqaa1DRORINZN1FbY0sc3NWcak0k3qztXogenDQ5nPk55eUK7f3eAwbalL80GL/LbDVS9RdsuggxCROT/JRQd0Gg03Zsshn8Fye85NeTu3JLWdHvplrr3avUHic4LAJYpgQ7+/80zUBG1KAdc2ouUFppr93/i94eqQK2Wz39uEYPk4bbREPAy4z9YyMhxcCQbL5zuSUzDyO+4yBS5DxFfu25mNKQq6q6qILlHlItras52FZfZlOna3h0Z4CYha6gjtgl9re7wQcxMjXDvZ0Q9RTuLE3WTq2ULQQ3JyvaCos/pWejJRq9vixYEUR5RTp8Anum/P+vZ1BV9Bv7HElttIOR0i7UbQMWXapvr81gmkEAK9dnd44959/EmFRKLMVL5qH2q+lAAKpG87J6kSw7pn022hwhWNGTZDQkvnsOLL8JvhSZwbaX8UNDzR6uOj2g2Wx7Yf/ET8zIZzJPA+MZTUcpb2kL6PDQBf4DQBl22ItPvB2iUfPDjOp+DIZGWTwmCW8at1Ir3Cm1/dXMRtbV7JugAFbZAtJ5bNkapE9tEIMGBc04CulP1dcwOqAfd2DWXjSE8xvU12IATsJea6cIB+7iucJV0wpfkbTtd60cJ1tUJZyvpliQA7qhyCOytB7W8OHbiO5KZW2X+zyO922+exEgDTKqwnXORiD7dKdstAoPGIQANCFqLhsh9Wma6GCW0O4P3NDbdNLUfAwRL2R86KCxD0zJmY+n27doPhHwb4tNA+XWDo7vPrqrmPCOYGayD+f848Ff8SdMbk980mDyoM7QS5hEGeZmSRgXUgMPCZm+/lnY22CUuDrx1bpunPEqr9zqJltIpWYmzJpL8dIvF2lVFA0VkbSQW/NeksWEJd+65cA58UVdcqAdnI2qKyWqLzBTiYBH7PYgQDUh03/iPfuFaf9ZbFVS4GzG7mCCkU5wXtpzbCU4w84u976zUSXEZAR/5+8mNDw5gRf1IFgJgvit/6Hy46rrkLUhb6/ytHLkNaqQ+/kWMQ+D45zD4ePMBmixDZJ/PADYu5eehM6327jZz5zrc0xH6WRtzHIdt/YW84l/vc6Pyd34v8wn5ujhQ6whbAV8T1UODy9bHHwhasoauBlFoXsIDYIOzEn3RR7xmyj0dQxQuZMfCy9l+aaZnSljcqTmX2gOzLmsKWbhOKI5Q1VWCobh5nLF2KpUcHTn9/nIxb0j3vvDswJIWxmHPI2avGGEMR73gQlOivg5+TXFvQxbldzRkSSyKEJQ+GNQ5VQ6WoaDRGke3Byc4O72sUbceAHw2gPEf4rE/McA6szPsLAB8SI17JAymGJk+GRXVuDJ+aUU33CWb7DEZ3H+xZ0oO5Wh9Ul1tgtFJ9a2D6nv1SiEmpdx+S+drd5uPzwa8BWJekPuF9cnEl79okrEecMyhNDjjmtd/tU/3KbicmL0QvbQDAAK806bWyqvKqmZzz80BxMwteo3ChewgcO+rUzP79BkNgJBmrzgzsZi0ixiNCmkKcscVQEm1N4FTDh6vdhQibvrGxJB29oLMc8cWb2Q9eXFq24/tu5G0oMR7xP4BtJkVF62k68nItOhfmDdhmYahiuO7iXpEd6UW2c+BVIziQvpNORxSoc7XoE09VN5AKoyO8bGg=='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 54416, 'candidates_token_count': 37, 'total_token_count': 55512, 'cached_content_token_count': 54191, 'prompt_tokens_details': [{'modality': 1, 'token_count': 56862}], 'cache_tokens_details': [{'modality': 1, 'token_count': 54191}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 37}], 'thoughts_token_count': 1059}, 'finish_reason': 'STOP', 'avg_logprobs': -5.187067392710093, 'model_name': 'gemini-2.5-pro'} id='run--f40f7bc4-57af-43e7-8464-c6f4f98a8618-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'has_add_permission', 'relative_path': 'tests/admin_views/tests.py'}, 'id': 'f54b622d-6f96-4f72-9fd7-b57e11fbbf0a', 'type': 'tool_call'}] usage_metadata={'input_tokens': 54416, 'output_tokens': 37, 'total_tokens': 55512, 'input_token_details': {'cache_read': 54191}, 'output_token_details': {'reasoning': 1059}}
2025-10-06 21:00:03,875 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"text": "RequestFactory", "relative_path": "tests/admin_inlines/tests.py"}'}, '__gemini_function_call_thought_signatures__': {'38173363-d415-4a5d-8176-1f49ed271f80': 'CsYbAR/MhbZJlF/K6GmhO5rAioGjicICjkXadXVF2UrdHk62ridUxbdMh43gIOlmCN4ZQhOhT6MH3IxD5b2x8igfERcfSi7RIUJfXBb9SJaqXNdSkKrXZuIE65LgzWsP5RuyAhD+9TeVDyNPjcndabNZ8g4+9WEd+TRChiUyJsp7d7uStuf289aYNiLDLjFuLmK1yBXYurgQjxAt21yZfrJiT6ipSr6acnsZfefDZs1OkRw3MqWMOOy5w/fhGXSyQks0voUigLw4uQtI40bGZB3VbnEIeRbfjWYHxEKT493yKdKgKwzKeAQL+YP8/6Q8jPZOb0A3dZ/W7yBmqy0ItvKCaRMZElB2juhJOQKx2nWG6AZ7UxunuYn3oxIKajIn/xRaJ8eSN6TP/6slt4qooeiR9svyHxlbVTi0hNMqRJ7/nQAtd+7/UAiEGnZaz9o/jmzvrVXJu1xmcdEnnCrCeTIifRx1cxiipr2bfUgWvwzYnMSX+5VD1gtwQgsJyJ/l0xah24RN93uocMOes1ilvmNPbM5Z+ggFUr8C1ratpl2pzpu+Xe4C7qLdsTBiNMkSJc1j9+aI+KMUObpJmNLj2B1snPQR80AvlR6UxayndNHKGRhv8P5aK05v7YhAXG1gW3W8dlDw7TvCUvMFiTU5tKN9xHKV7/028nVYa0Hii7uzENMCqeFoc/LWjhLT42wunQRV1CtUhGya12yLYNqBdtG/eqCgcGIHPp7OMv2MF97OWjRfj9WKltm2Yrvg/TweX97UryYWgQSacNa8e+2pIh5JsBy1uLJhRkJKAXszEa3ElzCa1nzzs6d3wPUK3oo/bTfzKYjWP2CAerVuWqCQ8wBA6qf5DSRag4n0O7rE39b5nts+aHZ9oHwOHbARn7GvwUdXreNGfmUILGguzOLRvqXhza5zuLP1k8qwQ1o8omd3khiZ6fhSoWcTf4vtNZ0v1hs3vZtqOHMj3fYTvNb8RhGqaIFoRA2dhAEi6llB3SqKLNu5FRU3vE/ptdIq3I3+DPNfIVNRxdAs5iqLjra7TxeBBAUMGDwG1dT+zhoOMi1gyg6VZ1ZriR6rdCyZza9QpchYEYT0sydi6I9SYMOarYc20vwSx7kPef5oI32GhBkmMYZdsqiWy4oU7ZfGgWmiQ/cRMe7h1JsX5WnhS9/uDA0uCxrkCeMa/h2myQNthW1rgdFCi9XA0nXTPpFbulTaQbo+TYmrpZNR2WVuV8GqO8akELIanXTbhjf1YGbYziWSC6+1nPGA97NPZ0RnRyAGmX6UEcQxgDTGcaFqTmzFAuylZJXlgxvF688XWNmKLQzR1vVZ3K+Z5rPNGLUAMOCz0piENeYHgh5c9UvWSmcaOglDEW/COzdPE+HDW0WsK4J467BFaRUQYmfAUJJenJDpUExq5CX1RWq17QCJ93cD8C+V6bxsPvcctUbfOlSHWcUGzePWLaKoeZW2fDqwsPCP8VdJqObQiIImabRM8CMHYO1NcRVDKkeb2MEaKBjKI/Qgty5HLB9kzzEFFA233eEH0qD97r6Ard43xcRyQGvqLuV7lHIns6ZB19G0y9La73rX+hOOIoFojVtqDah2I3dN/qytvff88V6oB45n2YEw2zgGGR2ru/gq/zxE4x79MAVHNmJKFj9jypUnk3yEyBBOrmeKdLvAQTmdgBphOOV4O2Wm3radByX1akPQOFxSheXzkJ2jKZqsfCy5uxsIYJ/xNI9ITG7XZLaNYOuRXRb0Rp1Mk/0kRfRRdT/SdZg2NeA2VV2gYLNWj1ENPnkEkEJ4zcL7b00hud7wtRNfTIWM0D/9CEsBqHWFSPlqbW5bxrK17+D21aOgsQ9kfVtP0sX8VCE+re1XTUjE9+U0lq2oHU8I1Bz3GPQyntDJjlqS8EvrdGPEUaUWKLUISYyczeWE/TsHGFl0iQd8spfXhR/iscTcX2cWY9GgVcoICdxF733B8sKp/9cM/iERcj+fA4fe1n5HLzNE5JWu0/nSjQCL5owqMoPXtzCoGYk+8GmRvLGzlw8IexGYhRNH7KgtxIASKIQZeYF16LIv+OCiQbZEYzgexsFcZ+7L2NXP6LUT+zWh3s8N2ZQFTSquoKf5xdUXBf/DbbCZkh+Fcs6s5ERujB3pwulDSfOBoVZOqPcp3s25SeIisp1T8mb3dRh1RW31Ds2joumiGjoDu3k4tKqZ/3VhPUsaAy/xleWdNbQ2ZIgQR6hxTykNby+pusfQK2ERFHnDe844eyN1W6CJlVPtCn3Cg0tHS8l7u4eHibkpqKxGOyI6XD6Q8YK4jOrQR4VhU6Yvg6s9UvFBu2/L57AUlAbxiWgNkA2y2jxY/ORYqyqAkUqEHxQ114wo55Zx5s61wHrg407QqxSQDOUkR+evw83yedoXiPs5TSNQc7QAOnS2RqD3dxoe3fjvdSewy64qL4UD7xzhIvRUbTT8ODZXCcuWepYXBLKjAZo/j9CISh8oSbLRLq4LdDr47u9WoWihXCcE1DfVudwrF7+0aACtzgoKlSC/jm7r+34fGey/NH7INEuhkBVV/p/pALdWXIrcxzA0WPTanm5GF9PLSKeOV+vDhkDB5dNgC3adt4yZljC12IIKPdILuHaFutaZ41WVRpHaLDrRNqwRWUYyLh+wFIoAMvQKWiknLP761a4fDleAf3dHcEumO/KqEqwmRX94eiU0lGAeGM6A63ti7X06E+IpsRXOphpTdfjgMAUwPA388Xq7MM8CsGzLq96gn0YExMk9oShaA2NR+RUs0TtK+070mwvs1luIU1+hgCprHt0IiovtHBeMtbI4iUvXDpD3l9WLQnn1jJ9j/O45cRZjj9QJ40Iu3Q34iZgn1EYPYL0qNqqMS6+Wh7v13mw/QbW/esAFaJNCpnmEvCeRdIDW+x3WbHSM67+1VIVqhWXdWZeuPLWvre/IkYSh+ksFEe/M73lhRlzDXVKVeXZfFAuwSUQ2pVSj6+oZoVUfZ92MVELio+U6ez4ApIBwSkQ8Wf3uL7GF8apAgHVVBF83qRhqmecXQe6CCDILn1jQyldgX/WWqJfLe4UvKT7q5Usxfs03fJnQ1zO+TtxtMnFEB1a5XANzKjgZ2/3IO8Ce3BMv56jNKrAVu2DPcI8256k9YcAxAA7WsTU53ueo2X2U7J8xRlNj80EYj0z1h2fQMtAeZ3/Ndd/aG9fjclyfII+0G2O217d4Y/kold1WQ6as+xE9Y3kPY9SA81tiw3NEw9XsvJHhBT6pHPHuo9AtHMz1Ie5UcqEHOIG93YOfLpq/qqSzDEDon/d0uoVgeI0AY9lnRXBtL3rO/BJslag1RiKkzMpXje/qWGv0s3IXMqwqIr7uHFrM4sHxl7iSTJ72mTN0G7orxmNcAGyiPFeSxTwx7M78sUubE/P/nruFTTc1NxjMC6kqDXGLu+FlsnA+IR4AwIcV2HSc7jZAh3mPS1Fz1ymtBzrFrRzys7hB0nSLCyCCpNlbWs2fBC3TGMHax02DRtM24o/I2KSsDMpSDLgPYo/+ScIuD2apWu+CF2XHqG1+MvbUpgL5X14NRBEbRqYNOgv470gGIKOg7E2JpaPrNKVVK9ttOaDtRR4iUhqBGY7rlljLNFI5KwITC2Vr2doh7+q2DUIRCjNfco9O+StNjzcmt04j9JGMKBzLO27KUzQ44ycuiyP9niMX8N56625nrw11u190PayCZNYD6awUdDskO156ZVp95lsotTrRJcTR80MW1MQ5wsEi4ftONWJO8P9x2suib5qoXv+aW+dTKKoxXroNYroS9dRreaSHpMx7VhCTZvZonLZAjnKDCUHxpWwsBQJFMBrnVK8/UaR821HWs4UPIkAuqETB7PLKi+fzEDLPl8G2gFbhOKX8I2T/po/tCtCnmfuUwm4g6Un9wTOEy0AF2lkanOPkEI/3fj1bpwtp7d9/o572PvEdA8NLR02KdCdvUpwHJBa+x0ydPrF6bBe4jRmqLG3xuawaPn9HhdIBNsj7uXVmATQGXXhdhBUA9Hfij32+QUedFHRP0mPC+e4D9EY1OtHZnVVBllGsdinnXq688iiWWS98+CS8ZNwChRZGSSOVNugB12YXukEmOSz+2I41hegBuvmt+7kC2WC8Ccz0UDft1vaSi1uo9ZpBqC1Qnne7i1sGst6Nwzh5lfMpC8w7/QaFUNn+HlvdsnAsOgzgXTUCp6W2/UjGU5sSn237X1pBFV5XE5nvbPkw40sFlw1zZzY9byCm4D04SHsvdzcKghE845Pogk4rNfOBoT5jZMikFKCV9J0qDKTadLdnyhG4U9zv3s+w+1YZuOAoXRwp9v5uUyf9nC2tlCdJSQrhxydp3V8RICVrAq8ejI8xDFr3mePGBmxSAqpy8oh/GKhTGpEAu6yP1P0goMV4ohxVglXRfeISmQ/pHpW/GDLtXeRQu1CnSBO5oL194xmHxJPO9+tXgWVnK8TlU8n++fY73spZNr2yII6ryhVdHTr8eL15wqcKd2ztXjcu7zGzlJrwo/FrfoeDVEFm2gO+prONT6Hr5HNk+ZwviV7ke49ctGLJTmHTjGUyYNG1QKnYl8f9eJhsY9j+rUcr2JSLvy6Z66vxLC1CSSJpBvmqx3blVmjv9tOvkAF59OCUCdceO/L2E+9czK6p/v1FewS0EuZVdR5as67I6LtO3YqomsNc8eeMJ4doaGn3eGSWRi1i3I0nDhVXFA=='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 54485, 'candidates_token_count': 35, 'total_token_count': 55413, 'cached_content_token_count': 56183, 'prompt_tokens_details': [{'modality': 1, 'token_count': 57988}], 'cache_tokens_details': [{'modality': 1, 'token_count': 56183}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 35}], 'thoughts_token_count': 893}, 'finish_reason': 'STOP', 'avg_logprobs': -4.2225180489676335, 'model_name': 'gemini-2.5-pro'} id='run--1df09739-1e20-4c1f-adde-608cefe5ea3b-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'RequestFactory', 'relative_path': 'tests/admin_inlines/tests.py'}, 'id': '38173363-d415-4a5d-8176-1f49ed271f80', 'type': 'tool_call'}] usage_metadata={'input_tokens': 54485, 'output_tokens': 35, 'total_tokens': 55413, 'input_token_details': {'cache_read': 56183}, 'output_token_details': {'reasoning': 893}}
2025-10-06 21:00:26,438 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"text": "lambda", "relative_path": "tests/admin_views/tests.py"}'}, '__gemini_function_call_thought_signatures__': {'e43f496f-b5f0-4efb-91f5-fde1477d449a': 'CusqAR/Mhbay9ahAUii5/ZGpIlwMlwxDkmxCD7q6dnmNgIrnzZ+dreL5CiBF3q7i61GzEzLSsGxNuGX19ge/UxiTYjbTB/cm2WQvV1DFDOQH1Xpm1SL5xo0nHC9DLR4E3kWumPamareWnIMdpY4Xhkv+rSMBusK5fLnwFYAK4dVEddMu1YyOrU1tGLSPiyiX1/ZpEN1G7mQPz2beS8pwFB6yz6f9xI4xfZnkuLdJo5rthRzjmNviCxKffc0Bq0mOLO5akYS0rk0YVwcEeSp7cINL6Gi4cJt0nCIYJfDNIAMXjPPKaEEgzE6554j25uvPxh1wa86Xf4Or5xC12tJqfDjRgU3LTvkeCfKi1lEQRONo+3CDSKvhZRdbHca5NN1hum+QWgSPf9b/Dxkao5dY7epjHVkZ6o5id8TTHTKiCzl4vhSZM7umORe1Aw68jDkxtxH0gNslvIYo7seL446jLProhoIctJAkU6Zk5X30XgbX41FxIIgOp9vopNCM+rqFLpy288XHqxHfbffQwQvXfaC77RnBEmQGh3/Q32Q0o6fP04hdx6mhn96tFUak72jFDVFRHGLNdLJcwUNTPi4tabI2oBh1VUs6iNSxYt7FMW088EISaDGjd0yKCgeNmGItexugZIA34/CUiOggQLOkemg/SKXEZyrSl4bnKG98ZGTP+836EK7VGZmekID+zpFXv6zg+VWhR8aV6ofUv4U9pecUUd3UiOQfvQxcuvhBDm7RhHLaCIfgEZWM8/7MM+5i2Gl3h5F+Q2ffnhrwr1AHFXXUtfy3WboosQ+byyqHpXE2q9d7Biijr9xy+93y7g0ZkOFodpXWIcfdIjUs3HFis2k9LgML7MT4YlzuPxhlloqzzBmEl23266eqk0U+wdbO9FcWWoHxoAoIeJCY0Ktyi21sgZWlLpDTE1lHze9PCcbT0aFP7/YgwUSlil2JepSqpjIaPE+XMHmG7dwLaSOA/F+X607KTTJWLgjUlJVvfDTKtz9xXWJ8FfXuSjz6pn4KbCL6h1iHLwMj820fhhnVnMgoTsSfZSpxhsD4L0uPDTv3zhqGZcIPc6fHum02b9KoXpXzmrv9Xu75oTP5uC3XEFnU572b1ps7KkPXFCyN6wNS75mf1oMHhxtWppepifQnLVO/JTbKUEEh8YBkfeahC5Hoz6T5cjS29m1v9FQB6h0i2vFECtvMNH2Q78+QTssk+77C2WxE/VI4QUj6LoA4L4gQGA1lGnf+0GBmsT1JM1nNLJzoUARr76ZhaQ1BCSve26WFpn9HOgoQmmZjc3sc1wt0Nz6XHd6tZaf1MWr6jW4RUFzwI/R9Cd0jjZjMWrv86rsok+p7PdNUD/GwCiG73D4w723daoOKrCJvA9epLnL/2eUNPXguXIPMspvz0WPiw5ZneyCrhQD/JEVGlheDj4T/hKyXnTcFPfofbp9yfh8bHvrozNtniwiIAc/G4pkkJlPjBMX1/EU5vi+b0QEMBVs5TFj+kkDv4h+IpanVd7w/7OeC9tvugyGyderfNUsOOsI0DfuMmmPvEbl0K1FE/ZAL1SM4g1FnWYT4o5qgKyUiSk0AkwW2oeKIHP9sBFNNSrHixOL7AswcUZr6ZFD2u5l3LmtHoIbEUqH0WM+Uf3viNjDTsucSTSQ6ezRbWe1Tk9rDYXWGmleLJvQlSHLtIDrytVymn4/GdxClszlMtl9n84eR3oQz/+HsDyNj1ljPBriH4syQAQ5Km2yvt6vzt+YPPJ8Nu/+RHAuLtvSV+PAFBREPVhe7ZybE8fcXGfCUm48h69h8+zl6R9+jBfNQMPWVr1l56QL5m5QZuFiv3SqIqfvxcZD26ZQk4hjKQdkKc2rfqlfUmUY3ky+BbbmFH6zzwqmhnYUljNRzBIE3QUjqLwgdmTqMayl47XSeUl0VfbTebcKEIt2Ac8cnBZrKdpvBK2JyCPZ7+j+EUAsfCH/Cu3L7ygBmIFl2OyWXLBs162hSV/YT49ssFfVFgWp/WJ5qIoSYcBNqN7Lrp3gn+TRNP7nufIxBovE/n4DPnLA6j364uiXaGHxkzgJFF7JcMP1H0neK5HfHdw6t6DlZHhpz8tSV19srhGTml5DJA9thFIYMMa0XT7C1Ig2bGpBw00xkkXSpzOUCYf+nFkfLhyw+Oo27hFJyuMbPLtNYQLjlRQ2NuppCoxOz+356XJtdqAhKj+ZznKOnjqsGxLzD0kLAOBx4Rsuy+w+Qle5CtNJ/j3Dcn2Nys10zYwlf/Me/Cw9tF46ylcuUOYdAYfU3AY6jJ/Aoi9fzrumZkv2DM8p7NJXlKhB5glkfo6rBCES8io4bfqstTWedr27K3Yvyut8f3ra4qMdGVzSO13jKH/xTyK0L979iCOMhI3jOQhdyk2vM4FAWoeUHWLWYZ4FQ5Sfo+LpxoUEh/8l8n3POaXqwWv3kpLdbEFottzjB/vIWhRDdxcemwPl4OycLrAYpqmvJExvAulSeYMV2E46FIJ4Ad0RHXjZLPrtF9+ZIovhq/O9FEZx1tFwZz288hOaJf+pUJlgtG99HoUSFWDOA9sc3sr9fiIFGjMWxN1bZ3KUTIZ/yZ8HaSBnsm2T+xHhVui7dwMjbNIwkXezXj12VG3oa0z10AQtXtJ5hsMAC+8LDHo+HqZZvN2rIibdxTc1AsOdMsH4uFk4vCa3r0rs8LloJg1kUb7BP3AB502oNZUM1ykEIPbsOXfayQS7BLOLrHnRNlni3u2rggzbyo73yaIbbKw+6fjhRz6Sze3WFWfFxuD2aYrUtoiEDNqV0Sp0MZrsP/pM/VS5xNWf79FCneGtdIhxwtFfT+6ZdJGl1XCXundurVF6QAdloQapQxzRjoDNVgchclzWl8HF9IzcxM98MVTsj/kSGExAhIsXGFrE2VkROd96Z/1OTsaIn/Ztyt6Xib5G3i5SyrMvAUwUl2hwfypox/HZcsLMBGa2mtN8UFrm6wW3k1GN+U6s3Qf6zLwTyIQvahWQNpv2ik2S5cfIGMAOUHmJ2yO185v4unMI40bc60kIZqTEXdBs7H9DNsbjYfRibwZE8CrTQd6eCgCCpWguj/56PfeJqIbuM1ngGpGVMWxles99mLfebysODUvwk0zcGq/g9hHEKt+J315/NIsQFhEQgxmUGNO72JYrhY0uamiPy+zLQkhQnaG3dYgdF/b6eo+MnKoqRLXCoO5cQcXV59pGvJpPyLaRq57ns1UcfzfDpXIc7cGWX9ralw0G32aQsFN8CJkXG1E7r6Q8GYK2LckyWSnxcm1m814ScaTFhiN/HvFknLmyDs6Zq66kGsJOlWt/e1BgXZvdkLMVLz7H6cp0IWU4XEtqKfyGz8Lta/maubkFnCS0I6XxmVoET1Rl8OCQDB1qntuhcrLeNXemLyvp4B8dYPimvZP6rUm2vVkkYUIio+r1p18gDr1zCWor3e8WyzMZs9d82h53Tsowa0mZxxKdlEgw0X4SYOLrL3lyJ90st8zxPifGV5PeriJeOBqUJEmmgxiGC0Di1nvrTkwX20Z8hTXVztxTZ61LpSql2pliTQRDtMjktJsyXsMMhtZehwv5CInG/NIOKPqWLt8jbv8jdOJowWHFLTNSJe3H8IhLFbEMXLnMLTeNFwZLZ5IRYJmoEY1Qgh5G4ieA3sv4IAR2I0VkTM2FyUw0ZfvaYEs4dNbGWLgHOVXVDcEfNZw7MvsQN62A0QPUYChAFAHvVNH5X0WvXMcOGTPOG+XAKHLv9nAj0tNt+8W6Y85f8c6VRjAU2zuf/snck4fsMxrtqh0IKVfwqA6Pwuy665q63v8hOrxSg6wgX8qrzwTdAmXJsve2hQ5gi+N+ApO5zN5J8QtAN0LdeMhg7dFMFWVdusAfPtQjw+Es8DvlwQyTWYFby7B10CtzS41WObzuH4XeKZDKS2WXlhJvLn78qZVD7LT6j0UNJ2gl34/NacrugbKxk2fMaMOk/Nn0QPdQ0wjtrKddf0BJfsoSYgQKa/kl504gFIWe/tIXFwv31GAQEcIcXts15upAGnY8pvqwXdxZDNbxdR+bjoigAqRTqZ7eo5WJpOZvZoNvQrDZpN4PoujKTSYLQLQweCQ+6499/4dEdpfsmdu1i/7uYP9WGxD/70zJK+QPAiO8f4ApLfoxx5xyp6Fd9JysJ9Hsj6GCKljA8MLa+HBcZwNY4UF/cwPRPzz3PIwImOaxNPu/JSjuXD54kYJkUzpPZnfQSKZOi6Yc3T0P6JnfIyDOfApKicNZASMhSfvqiDUOlyDZoUuWKHMJaoUnjcB8Ly6VMito4Lwrh701XyDwmujKlNoRo8YGopSlDZW+Qq30OfAmN30XRix/Lpbe9OKvrVk22th0S2mNpEAbWd8o+IBavvzmR3O/2CaNlb3x5d/WungjViSJmobJimmKKvT/pCrbyOGtr33xXVqL1Q6n8ATuvgH01rJsFOjIcEkYasZ4qWkwBvTz0GBoAizK2Rn+JkNVzC6xuWZ81l+8C9pSKwjo2vpUJF6QhPXKKZ+Hbd5omv1hatE96zX4K0gMaWb/Nsgy0xKt09LqWtaa8CVZG5/PoFr2p6c0rUpU85OEiPOOK6BliP6gKS7e0bUs6c0+Ez2ciqLKPzIodKcQTowtPmNoFkNBwZgRLLbrDCLPhJIH23tfC6EbtEXWZD+2gPyUOzfnvJrkq5VcIYc8Xa3lS7G6GWqgpCA0b8pN7U7NtZt97oCYNfT8b058kpcTUTpHl9Kb9pa8FwScqtGYC7ZSMsG7Lzr3ghD1SWW8wQ2jf+CoyI77DxfiavysfOqLjIL117/glSGJQ284XV9VUIEKEEO2gaME2Lqi6F8G+BMZ5HKeIsnkUM2HKn2Oyo7fv2SsqjextBc21v5/7q3ff+riH41mYKQ/dZpCHJi4bgrW0iTTZtWRerlIu/PHJUUQVIDRRlYJVU3mhn3aHjcUDk1bsV1UCv8hKx1TC2XKWFlLhdknz74eaxU4CZTr5KKiihYDgxg78Aw87yiUC41vPhOGKrg7DBt0VW28cUdOypss0s1T6LD8dZXXD/ymDtN8L5ha9eRmmUlVxFVRXWjdQgZ0LbqcLDiIEjpsiD8j7LJpROQBU2roHSGSsz4VTSby6bq6ZxUS/EDSi9UGaHliWtFs9KByB6eHBWaISWfzNaJCyVdrh6Ho4ODTWIROwJkgmkqvV9S4c9wRnHBlO1QGL/swMo6CavnYFWMR3LbhU1JVJ20PynzgarXJYlPmjamo+F0eHAA8GcDq8eIDwnWjWX2gGEwAEiVjCWR/Wc2z0zc+H2qBT5W+i5S2WJcM2NpFH58c9OFZ3KT2aQuAXeGix2Eka0Q4G87dLT1SuGIC9ga9EmYM2Sj8uPi0JWF13HJF3Ks6iQ/lGJjfADyYS5ggzOVa6oqpWmwgSUl/5KXM3SqKjNiWoG8+EHImpvyMSSOTrn+1/9HOuRjiqs6AlTj5kDThozjDIDgjHR18PB9wVan1XPjBuauRcv6amNxkfTuxlIXFQgKzs5HG5pPGCZQKCEby5mbYpRi2jG2mg9P2fSIYTdtM39H3n19/v/IBL2v4ooN8u+TgH//s8Ro7FDoXvout3IbwtM6pS33Jy27ipePxi1CX0yQrIb9qeTcTwN1A1Ow21dXSLu0qElnVlp3tkc0v4DdFixax6bKaydOs4EqlxMQKJEUWRCNVSK5dEk+XapTYzGgGbwVfCAwcQ5MpIuoWaQhqpdfJagy2UlMUkxIsQteBVdsIQfsS8FEtXK8/vhztXIzVRWksTvJ2/foqci5QXa+PHeFiW4nHi2bEgDG5eAPxBnZ8JMVAkPNNjak7nFP4yyzExRuMuU3Ql5vHuoQJzd7wtx8o3dGGNfti2DV+RaEFY7X70k+WsGo5UwQBHv3BKnMdPMLhscXKbpGmS39eFbxX+mr2pux9UE15UbdFohjhdK/1L6kEMI+hMdWrDhoOl8Nh+7oqbO3zMSUkXzpLp2DbyfqzAyH/83KH5VSaVhyph1zXs9gImfBnw9IJS3o3meXrPO/WIFz4bvV0Jm7773vi+btb/CfPc3u6mAN69JRWaXeCMhbaRPZFH79OQEkZgmtN1y5P/teCJzmUXXuCyvyDG5bqThDJUQ8SAIw8CO3NbcJjz8reiDWL4h9VuWq4aiRul8k7Gp6FYFahFhPudQ0g3jPx6rCGAGLOzxtJEzoiE6phQPeHkoIgR47OiZ/JbG5DKtJJ5Z6+X4UA+psAY5Fy+K72gTtnFLubtLkETHAKeRGq4DCtd+Lk9UTii3/Z7hGFFO/9yVz6No9TugSjJJ+n97nr68wEB2kEj2ujr4mOZoE5jVP3+b0XsttnahLtMSN6ZyFCBFVFxAgyAjq4BM/0RG+izGJm7u9y9ZDiThf2vJF2fJ1dsQN5ngadfhl22lZF9lmfyDOqYYBtVGX1EKpje/3/NPwGuX5wS7eOO4vOdZTYww/sKaSEL6k+69SSx5jq4VdixLTfx74jfcHbwYWZbjU0MI8KiwtJihI0YWmxdp/f8H0RUQVZfDenzCAcW4BjiGjFUM8Awqsiqqt4ZS8TRiS0RnYqu1NNvcSXamabqLltvpOqo7iT40F6tWr+NCY3t9X3QWVuAU6Q9LkjX4G3fLrh8xVqwfCuVyMvTSILUN7BumOU6epZeqaqHGabXg7X8nmrV9ac6vDC8QBpKZWopjXsjfdGl5VuuEBX7bwssidOsXkK/Ic5M7LtxpObIzSTmMANR61z7bcGpP0i2fKnmECKPwyk7c6xh5T+GxZKCM7m+LlR6w87UwnRN0+GYZJ8f41SM3hwjmddsP0f8uMUYW+QU9r89lQHBGShotek0VvfBqKS6JXwDs4id+VAneD6GPnFPHn6TTagAf2u8I0NwgLMm4aAedmOim4CLS4+ADJ5l4+VohlKKsqMeilduf9zu4PB3ZFF9hbdkyty6bnr8WHffhRc8eTxKAjDS93y41jJ1F2tHqQjwlZzT9Stmff/t1BZLwCOhBNoNSPZFxb6FuWu6pAzutCzAuaoXH4L5rrREqsHx334JhTtaP3fPk+kghWzK6hHnm8rbI40wNnwyi1O5uMtTqPJYNpOZwMqdMx/JcuP7hd12VvTm95LASjJmoTz+JuTcFIEm7AmPtCsDLIsotnMasUS9vHkBLiWqt/9bfnI2jRY9F3r1DdIimnGTowsH8SaCF0JBJmszsXE7Je958IasUB37CuUnBfi2fyi5TUFKAdpQRfUkjVhkEieDMQsoN1PIe6b0aEBArgXtMml2yaGksPl+D2xyjetU687pc1wedgILh/NsuCmq8wVjFILoNKoOsuPUDsI5/v4='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 61095, 'candidates_token_count': 33, 'total_token_count': 62730, 'prompt_tokens_details': [{'modality': 1, 'token_count': 65489}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 33}], 'thoughts_token_count': 1602, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -7.028286558209044, 'model_name': 'gemini-2.5-pro'} id='run--309bc9e0-0bbb-4369-a387-b5b1f13a390f-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'lambda', 'relative_path': 'tests/admin_views/tests.py'}, 'id': 'e43f496f-b5f0-4efb-91f5-fde1477d449a', 'type': 'tool_call'}] usage_metadata={'input_tokens': 61095, 'output_tokens': 33, 'total_tokens': 62730, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 1602}}
2025-10-06 21:00:36,281 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"text": "get_list_filter", "relative_path": "tests/admin_filters/tests.py"}'}, '__gemini_function_call_thought_signatures__': {'c1747219-5430-4401-a71f-a0f2572e139b': 'CocRAR/MhbY0fnvrSiTw2ffbYUuwnBKPnaCL+uBE3drjCYMfEWkwVk8BG08zUDAgTj54yuWNnyMD6+VEKdDFuCcU9CprtsFCA7q90Bl5lMVPwXX1yGd3GjC7uvJcuO4OKaZay5LYiblUTKhES8crQg/wqEDPSdI13erH9Io5PXD5/3xJCzYg+QbwFOK2/CLaLpDth0A2VIyqla4qXccskZCUtX70s3QeuWyPv4N1VaqNCJoRuVe6HWXnnDoO8oLekZjLWlYGYp6AJVvMlPDoG/lb0uPyTCOHOmUs8xb/Hahkijakz8mvEpjk8ifabJ5V8flk0HM8olpeNhAvte0H/OcosIGhKp4WJb/fgyxUfga/ouQGLqj992rqxNecN4aNUrtzu4nZs9+O0KB0ffBHtZAZ/t+FkaclBP6Rzt53gIGZj0yG9511fXt2L3e0tzKxTRHu3Gxp4EVXMU6IQLVdHxiYyHjOjkSFbfpyu7NdFUL57R1+y6+1gGeCmhYX7LcsIUtatLv1lMqOh9Kz96cGpwhEDy+GAtdFDOQRiAHEHxHQDz5m21xwmeEzREDsYCF7WQYrAm1QFAUovXIZjSbRR+/u/PSU2OqWXPYDqxJ0cU2ZNraY6xt7baeO8SolpOpCfhx46nV3IAJRQAJkw0RzhkVu3bImUm+2JQYwJYsqeBgRO1+v8AhwYeX0HsFB6dQueeR3QZiNgp4z/mxL49LrCm5O8s2TG3U+rkNdeKtfsgj1lySv3f0WtCtrVNvxgS1ujEpQfwmuuGyQHsVNkeKoHaXEt4F2+pr9VKSWYtfwyuHXEOBLo+OL7BbPIEajbURRWtMnGEF7GeAdpGBISulBK2PxCooKnoeaegFZ9uNy0+JfuhHP0nLrmO1v59Pa+1Tfj7WolhGa8eRWV7EHi1NNmDqwVzHFcTiaLNvRoFENtTUBNZ/Hj+oMd/58tkecm0jT5TOw1F/hJS50+JtCNVrfDU+DRbA9I2N5Lvb6RZ07M+L/JDb3MpywGdxmNIobeacwrH6RQRM3trfazW3Lp0AlG+OCkPwkrf3taY2BDiBabLOGvPpavt7H3Vrie2mqu1ZtGNpNB3hMle9/easvqtCljrMgYpEh/NbN0+nbZ8ftV18chPP3cF6ea0kGhdRWFujk1MGLMhHoJVuYLZGY9jAV+ufEp1PP3KL3JAanlJyR032/G/yXHiLom6fmz+bDRwgo/IhI/ZvopVTnjVUkw26krMaJyzfzrqgbUzSY6ZJ1EUgFCRZvjxLpzBfLSkoi64CeXmxNT+lPR4LZuTLHIxqVo/G7GDrpJVtoangyJWK1tLXk41M0/ey98vRQd8TI1HfCaptK4mLnc2euIRNxGFGl/0zUVwPqCKtvruF09+D5LTbsP6d3cxRPDrUH3ILGgtn390+QQ3V3F/FK8DnQH6MmCoaoFDJWrLTt796tM8EOJ9S84fMojevgv4EiHyQ0GN+NDXhciCah1Ryc5R1PYp5dsh5adjuFtXwJjSpodyziSPSXDxezQAOM3SfmoNvDS1ZlUu2Wca7ElVp/MgLOZS0+Y8+aei4yzIMEMGcMmHyW8K1klly34sXtvApOkzPNcCypUKcIRWtX/ti8CLwDJ+RlJ+5Tq2QtIl9aFDjh9TeRh+8ZAX7dgB7KLVdnCMXKzetlTzDxI8LIMbnwzU4M9TZEF+zCt5/n2iZKp+hnSLIjKtA9n/ZZ74bgbLaGgchwz+cjmgLkfHJi+kMJn7xJQAg2bkI10/kSmh3cj/HyQwyeX6GDbTScyoKrKbqx3vpDmLbZl0UoT0hmxgqJcUZuWX0B/TlcStT7mU/jvmlQ501R3Mou1mzvtGO89wxqDgY8scqVClK3HGnR8vBMW2yS/3VOWX5de8xO6BEWKRR+qSE7xcUYiosfLuppu0i7Pjr79swJT8+WF+GY7GcKdckJQ1b8qd03fNa4X0d3DPyfdffgcqdaXsSK34EWAlw3ukhw6laDLRbMmIzr5eCwmy39dPmod0xD27BM1HUbNj8IoFLKWpn++VaAu7U0Wx8Gx+r4zWE7WNapHjDNe/2kpRfW0vw3JsAffZpuKpjUtoQK2hhSNNplgxpOKjfmg+b7R0r57Lv5fdy7N3CASOadHB4BoM+WW8DcVo7ExwIJbqR2MI+pCUhbwMAfBKxc+9kIdOlRSJvXL81/Fqoo5ZQCalZMnV+Of4JgmtrgeEnW9XspQkLlsPa549Ag2OnlJmctR3V6qftLbUtDZyM1AhyFYE58IfvDgTFYwwLfqrI8A2qm4SYtmMTk43wNEmzaORVzxC4KhJzHiUlPT4Cv7jVatOZAnZ3o0t+CJZi/AHGEXAEsZzvTVWe+6SqrjAUxQGM/w7r632/rcm3cOH0LgPJBHXXYGQpemUW6q0m2HndVqJu9HtaRhQ8DyBg1NOMREMOVFZEehGH8jnGqFOlEKjp4eiExAF9Mav4+a75vRMEdniMYcacAC/CEZ0BdD/Jqj9lqqIllu775WdxX12YB/9hCtSkJscd3+4RkbcfBraslIfEJKPKVOMs2o2vtzNedBEjvbJGxFQrOHPGK2NFVp0WC6PEy/GsAlpvyiwjnOiGJtvg9WGYO5KGMjgKrXvcs2jTT5fgI7VDhFhxBVut8c/mn+uFpVN6O+BbjEKUVVTgAXGNlOU/bvho+PKSZilaB/bw9xfa5SFjfn9V/VXhN3keqFZvf8jSsu16VG+y2owtfe1mE0Bs8NdncqVU1dBtQIeWXrZsTB9Os2tepIWHbeuLKPcf2MqWlIjdx1MQcNnopXuas0O7Gqjv1kJyZ3WuQAQv2i6j9BdkDnnWbOgoquEQpenP0ARMjJT6WG9niJ61gqc/UiLkoYQRBoG4Lx5Bh8EmqVIh0t4YesJAIRolkeSItBb68KWIyJjEd+uN82oa+q2o='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 77544, 'candidates_token_count': 37, 'total_token_count': 78156, 'cached_content_token_count': 63557, 'prompt_tokens_details': [{'modality': 1, 'token_count': 83538}], 'cache_tokens_details': [{'modality': 1, 'token_count': 63557}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 37}], 'thoughts_token_count': 575}, 'finish_reason': 'STOP', 'avg_logprobs': -1.642840101912215, 'model_name': 'gemini-2.5-pro'} id='run--12975aa7-61b4-4ffc-8591-9aa94eff5939-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'get_list_filter', 'relative_path': 'tests/admin_filters/tests.py'}, 'id': 'c1747219-5430-4401-a71f-a0f2572e139b', 'type': 'tool_call'}] usage_metadata={'input_tokens': 77544, 'output_tokens': 37, 'total_tokens': 78156, 'input_token_details': {'cache_read': 63557}, 'output_token_details': {'reasoning': 575}}
2025-10-06 21:00:45,257 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"text": "ListFilter", "relative_path": "tests/admin_filters/tests.py"}'}, '__gemini_function_call_thought_signatures__': {'7e7acea3-9d30-49ce-8563-81a4f631a629': 'CuEKAR/Mhbae6tp6RV2u+lzWV6g3uSwnTIT863NGY1QToIC8DeUPCioqhyBSRZXt+Do04gKZR4o/AGEW4tikVQ1tJpyo2zmLrUU7yDVt/NAkhp09vk06Kh0a4qGSft6iOohSAhC3czReoLWDhkSCb9G8AbBlmh6SDVjQ6KllcO6k2WO3KmklQXh525SHUE7yHo0qiNMlS5+BZFHCyhwUJQv93Z/t2g0iP2xTsykAfnhTjD75Nx9NM3S3iZbPifKzB3jRQ67yXIIbIowNJHv2RfVOe0nY2/b0PjaIpMmHqP5PIEdGtK8bJ1KuO6H9jZbTRtU7AFa/mfT84M1wJkzNqAm0WBd1EL1NYirge6sZbjepTSKzqa6+KNh9K6s9RnseMbmBUWge8kX6+3h58i36KAicanjie7teu4jKiiKaJtF91IPrU9lR5zIdDZeqZcYO/RHElLXpexESSLu2qAEnz8AA197LSZJp6wZudYCcRdbpmWOtUOrWBuqTw0blHVryz1PdLp4H0NUqnt/nryaFJS6fpXLEs9tPeoyRQLN6MFRtq+ViTQAtURjlqYsVIECdm+uiEuxF0OCtX5s0Asglqk8jmE4Lh2LH3FMRE/PL2j3fcnZlr/A7gGPb/zjQO+DVVT2Tz3blZFJ1c1B2gImZXuwPVP43s8YMGugCa8Pm5egAZhZBRtc8CpjwZ6t7QCDKV/KC7M3pTJ6GGbTx3kVZK6K5WtbwkkCoZp1n5aQ0hv8sqtcp9zYa6wGFZfa4teoAc54rE5B+LkuzFLzkP1GBlhY3dJLU2EgjgCIrJH3e/mVDW1NHldw+ulJkXvdUYaO6Gm+e27NUPPh+N+EhvJK8gee1+qTPXLHmwtZghCJQQEpP56lv5QrDe1Bx7rgoJAztafMFuWWRKSxD3NF8XR/RiyHgKhqUlzWK/0ZGr+6mnGP8rMeilAgnNUyHj0hafptryrVM0EAcVVED5kkcYk8Wf4m0/Gg4usjrOzX8PaaWrvGsX5n/SdgpY/w0WFolbXzsZWjZu4hAFr3P67ympWCO0oxW4MTGnVyGhRLMcMwYYWagKVwiViypad3zloopq9EoQ2xNRBPW6yx+gKXG4LsfPiyPoMVpyO+YrHB6FNaX4ijzqmrKgjsUAFpX5AedkulrErH/yH1zSWD6KyqR1DheBEU3TDDyYZH2plCkm+xYs1GvxdfssbFWL0IuDSCeCtDMuLPa50KnaT4MTpNHGO+DavvjmpVEqeD8TqXpvIYbS6o64WzvlAQHqsLIxlJ9H78MXeeqPisPxlJA86pLrvbKHweo8AN+zsurykJXUihwNhDyRO3Dj95i/o/V9ULETuknR9uRGsta+5fGgElZkMqfc7Kf5A26kAcZNBx22bNvbr6owsOps4sMqF/UbZrC0Mh6sKj7B4J28XCw5N7SQ069XU0rJNID+lE9KpE7MxWsIHoK+52wL2nFnEGO/I2WGi4+TlmtlCQNqQxu9Xjkfb77mCf1zUCWZ9bi1CeN20QPBGmyha+klgBUhQVY4Ht/MhRRh5QS+20VizwEQ7Ri1HN933cO3nomH9KYRryX+/1Zkbj5uQLNz1NLjDfU1jvYbhFOaoR8WSgT5+rdY1cOa8J+CyZBwOOWjlIiQcTIACA4YnklaxrwQv1aPOTfNVpQfmxLBLb+QwXRQ+T98b7BTE+s19f/lZFGT6tdMi4860SvzpA6pSH67oDFYH4zuxctoS7zM09CVgA4NClHEx98wPR1KCnJ8pM8s4ttPfIWDxqXmGrtjczstGvDr7gyDtU0DFT7TtZwpmT+6xgjjEJg8THdLYkSJuk7UE/5B5NmX8KJK29tLYTP'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 77613, 'candidates_token_count': 34, 'total_token_count': 78041, 'prompt_tokens_details': [{'modality': 1, 'token_count': 84180}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 34}], 'thoughts_token_count': 394, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -1.8678547354305493, 'model_name': 'gemini-2.5-pro'} id='run--88578089-bb93-446b-8e92-4d70c2bbcdfe-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'ListFilter', 'relative_path': 'tests/admin_filters/tests.py'}, 'id': '7e7acea3-9d30-49ce-8563-81a4f631a629', 'type': 'tool_call'}] usage_metadata={'input_tokens': 77613, 'output_tokens': 34, 'total_tokens': 78041, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 394}}
2025-10-06 21:00:56,469 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"text": "cl.get_filters", "relative_path": "tests/admin_filters/tests.py"}'}, '__gemini_function_call_thought_signatures__': {'09f91033-114e-4f29-acdf-cb37ec1ecc3d': 'Ct0RAR/MhbbiaSbD7GNh0zvt3eQ23qj6d6KG4CO/9xkNUU8MqfFCAIyE0K2CYRbZWfxAZZUc8zrmn0Pqy4+gjDHyeegcTCK4gCNaxBpLgfvM/zv8WCLVlolNC4MjGy51foBunsvleJc9toAsu+cW+8/BmovlQ0G3Y1AdDZvDowEHwDcSmazlqj2hXEfWcDAnBmaMt273IymfvxjWdQtcP+yJ4qaSw2ZSvIQmS+4YX5VjDkTKN0iKrhBPiw69v2HcasUFx+53crOY0URgzFQvFovRsyU9iRL+h4PSZj5yx2bM25nqLYLgUsfy+XTDsgOrGHemfdg68DBXmBFBPoKlH/joD3X6uTzDX0HaB+fEPA/xZ88522HFvJGxIkJI/MKwP4D5tzjNNAmqy8aWubFuL1Bf/s/xMUHeDAbAhFWxPnCFvxKXAo1/Q3ORH/ZjibHZOeCCn87sDrI07Gz7DZ/+ibhXUvP+Sp81bvgFYqPOWlbB8foP+zjeBonavcwtvMB8xjczr/aR+Kh3qoRAk+CFY2DIW8ilS/XUNna6iZHBNZ3N/Ub5HhmmXJ/iSzxDH4xiDc8/x5+2q6Gcj5M9Uo3PF+Ia9Tw3gHKQefGlOfjEhTToV+ikr8hbZyw3uYqIqyoYMIN994j/mKnTvhk088LvMVZboath2RE/Ps8Q4TyChV5K1ZLGU4uBklTXZPqZl9ZVeoOEbHrYIYUcqCDNJw0kQu/G8LtEEUohn6mXtyfssqEjxX7S8BWr5viflKBXeL11JxRICYaMDsCBd0WPe1m5hN29ubfIk5aLm6NwdAlgifYD+jebvLGAQ9UOlGa6x9XA0B8A5CcXkoN8v4yrJ6UYQd5HRx9sGmFnh2uY8DVwYy0HZn6mnxNMCLB8fcwvqMd8t6GGBdiLc4tB/eVXHZksYyoxW4STdKhkWW9izyvtY9hsG8o7IVdbz7T9Jp4jchPsYQm0+q6BROm7hdWFc2l6/bZxR14NxrbNnCxYnmSDWoQ35kk5hO9Bkbp15DKq2QQedXL4DRZNtS8Cx0MiCAn3X6hOHmUIBNwTVUZD1jnwfyd4AIkHbIQO0eiTcH47lQrsBcGrkINan30q5BU3C/yc/89wmt8qFzJY3tdskDjao/lk5xyo91Jeo23KOseJ9SvD9FqU0oc2Wj/Dt3ATRhJoddlMor9MvXdzTtkxaFEo2FjZG+ebhabPMcbpF1AotEfYgAnoG+B3J7+dRhCOjXjgHTLWkLmIQvtLIj4YmkHG3aPaw4rZBEP7p4FLA3289D7x+48CaV/ogT3JY9nCn0HIazi7HCkrrFX1rlS9GfQsbPYFPjrpt1ByLNy2F8uSluy153g0Vk1bd3TBRGKi/9wVZYUwpRRCFC0d+pFQH1v+3jNVD6i/rbnMwAAp54cO2JDf2GkZZ24F1yEVK4TY1/Yz172h3Ux0K7lq9l9wPRsa9ewEJhQYIiL1Czxfu0gw+VOiFs70sQOULC+2FuEJilq80kHieQnZzwRPKU7XGzJZtpXhYmhQSh/eoCaHbb5CbxfvYjijABuY5S4xCIxCS8y0B+oH+fcJMOqGHzmyKC+Qu164YEFGS3HbJRY2FVIDF632oqs+cVkhQ3zBns+vwNCvI+0yiPM2C0fwccIaKvQKuCgelRxR2XezSxMiZ6UncXMjEyi7zxbcHiyXNt1FnXZLO7lGeohUuBvGrGPdvQScArTT1xyv1W/ITnivicJ8WgyKx+kK2IpiuC1A40/zp+dMpVvYVirSLmo5hFUIoEB4P+OC1lon0prkVmaZSDaInO2opNjLS8ZnE0xrKDMjdLrLd72Wn07sHJ5QkHVa6xYzleUW2EifpLY1o62hcB6hMCX2CTAH64Uwpf3S3bl0KpbdWeCCcSrS/6UdYD9DXAsju0mF0oZtD8KrSDboVxXh9loTqaYIWv6nYqlWIHSuupegqJY2zGUNetgUsSpoFUboFfGR7E7buoMaVQ9LsCg+0YA1FClhZOzGFk+cFA2VpBXkjvVEFUrnfB7uGHiki9rZukh9J+S0NjUua0Zc8qaB/26xUPKA2PJtJqfLVK0YLlsiC3O3PGdPp/CJHlK88HJnjUF1/dzfvtF/uOFoj68kreDeuufSfWHFeMtIssKVRxPppr7k0SUwOkhZKtsiIiaSWoEaYkmzCGqEfEPMRMb1BW6GFPoOtyT/8FBFCbluGT3OPPVTtbxxEKHiqNQRkWC78WZsQcYTsX5bMS+kB7oVubApp3z4Erl3kc87/A0zu79vVWFtlTwteYdoOvn179bz73iSUps2zB67yStBPi5PVAKerxCtl/T7aIGWQ2OZHYx4wBRIs9p7UcLgqCqhdjdeg4+bazTUxjby/8GyNTDjUVl3nUbqdD+4EFfSYfyQOvw9X+XAdic3GpV1KGTKpl09aCQ40SLdv34Cve/PxfRu8S94sl0IAc3cpef4H0ef+V2pMNNxnDVkIoSGCHM50ixnKrWjawX2L6QIn+Q1ohyUy6SDYZ1IimW5fNK8IJga3Q9I+2zZG+CaCkgMcP6Aat3uirQNNoSorj2rBlTs9Sy2RaqAadZn43o6ZGW3TNe7tR3nFsnmFGcCkldXJfBUAnea2tIf6QMQChd6OjfHXD7yuqqz4NBu/m863xP0WFutM5KBZt8e6/CxamYO1QggNZDYWdATGT7ProWkljXQrxDNdy2VEJiDvTxm79+UQ8PxTpz0WDN7tAwzh+katbHfvSU1HZvDQQwhdYQ8LNaAJd6kbTyAxaVXVXT8jwDhhRdS//1kEpT+wX+ZAsdA5kFx2PQuVuCJBbCXxEHzg/2/Ke9zNE6G5s7kIlW5fNnqAKe9rympavJd0KZlkxsL5V/ooBf43ZXg87+DW1MaLEyDoTtgzKHaCa0zyDIqCmEItUC5OgRNNJZWjZeUc5udF61vqWGMNNXxsm+ie4SxGpZWewhYu79jeXTeyb6EXd4yndSqc/EVUzcFcf4YchyKf6bBnERolv8GJcR7iSLz88vi6j+YLNKgRmL03iJGFqS/H8EiIMmhzA=='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 78246, 'candidates_token_count': 37, 'total_token_count': 78903, 'cached_content_token_count': 83304, 'prompt_tokens_details': [{'modality': 1, 'token_count': 85205}], 'cache_tokens_details': [{'modality': 1, 'token_count': 83304}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 37}], 'thoughts_token_count': 620}, 'finish_reason': 'STOP', 'avg_logprobs': -3.170998444428315, 'model_name': 'gemini-2.5-pro'} id='run--98fc923e-3cd3-4a80-bdf8-cb70b0356bcc-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'cl.get_filters', 'relative_path': 'tests/admin_filters/tests.py'}, 'id': '09f91033-114e-4f29-acdf-cb37ec1ecc3d', 'type': 'tool_call'}] usage_metadata={'input_tokens': 78246, 'output_tokens': 37, 'total_tokens': 78903, 'input_token_details': {'cache_read': 83304}, 'output_token_details': {'reasoning': 620}}
2025-10-06 21:01:14,811 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/admin_inlines/tests.py", "start_line": 1.0, "end_line": 521.0}'}, '__gemini_function_call_thought_signatures__': {'2df3aa6a-532f-44ca-aa8b-f564b2fb144d': 'CukgAR/MhbZy+kaEGltLxqHW71EQu3bMHtrOi/34d0i4aoXTLRfLoLqgYP/XXscas0xuQBy34wC+oIDk+UXRJeTvw1CLQxevltft9tXT6YQFixWJTWirk9Nz5D73SI8xHOF/VVEwnZCa5i9+LCbrBczhK6qVt50foqRZ6sbZC4VZ/BFlTyZsQGTYGn5JwRLarMYUAEuiMYXo9gVuee4G70oX9QWMpYYvZysokvNC+Yoa2hq9mVj14w8UwfpN+301UtzQ1752awo6i1sQOVDE+LCTAS90SSbcA2Vfp1VPs6PnPHf6S6vxZqRzLWxLagtDv9JnQWiRF78tCY79jOxxiOZjTDOcEHB/QirzKq7TC8glEoY4gY99y7CeN8Qpx6C3KdsHkrSPerJI8tX+m3xCyYetu09jp2A7q60e2F/nSrbRIxkliT9+mGvt+AbafIh42ziPq23GJ29m205/1DBFBt+MkXtLSW6flR1ZeGzCETrWSNkSjkyvMlyLKf6JHsy7ujY9woOMrOEKpWVaXROzg0D6LafJQsxSWLk1JjxHdFX8jFqqHiEOwhR3sj/iuSu4mFq/GOC1D0UugtT4L3CIQiMCmo6PqZUjb3UdIrWAz6+juafVYsL4I3OdGk6G8OBvhI+6O8ztkD0cPHHsnxAimCLtwiNQRAq1hdcTp/8ooBelWcB37eiBXGhaf5QuzM3afwvGcXyKjQ6k+VZz1DKP9lL6wd1L0bvKxUSXYbRuF6Jy4eOhIJJjWiPp70r9IMn7Duwm3hq10hoNfXlGxGe4SbxLZUoyS67vYxTzKlNE5c1yc/2Dt8cvIryGcXnXpCOl48VGk+z2hoaHElXGkx25bS/oxvPtfPAVUBf88VAuRjTPVrmPuUBkS6UY3XWpFq5X80ekX7FbmbsYedYp9rUdK9LWgSYx51R2KatnKE/8pAbXEDD4pm1WSrunsl5RFJzUYrBjQceEGDK7t8DCFH4fGAktJub/0XaaUXyAWVGtVcy/ZPoyrzPAfLToY9wqWvnk+c86On+nTD1AHlbSLoT3HCO1KZC4iXpus663YOTCvvy/kozeccnup0gZP6oU8JWtY144SvFkmjN6HB8pErmsv4RcEldZkTsoNoR1QQTcvmw2QW7kZSJcskCXf+vMofyB1FA35Ak/KA8Yw71sxWLz6cUFAbgpXRn/vwXVpf+RbbQ4/Q0gJkPC8a4zXCtCFfex5BWeKGzdVoEVFtEyTocvhWpDPbbpjQCWXHz3wOkdiERxSVS4Mu5Z8b20IhutLBi9cB9OtiZ5nZFwCA2IO1wLUSDhTNEbqRVinrYUmqevZnRvciOqqWvlGYGTEP9CjxobS4bFJ39AromVEt+77/JLMlqOZxrhBW8YR8cvYdcDCNldVrXmb03+wossr+zrv9IokWCe10cztd4YCUN0vJPrCsB3pSLSPyrM/AbL9jUs+g1yN0oMYIW65ozEv6OgAFbpdHIjlxIJZnix6e4WwWTt6JAWRjzcisG4wLBBfLgnJkvjrhIPrIXVTcqhqb/exkv72pTBkWT/zWHmrST6AAB7uO9eSSIymAl0XoITbwGz5UgPN6Kc1r3yQDa9cV2XZxID2yIDZy92dhiQhzXoZsO60qhP+9xMaYsYIi7gPI87sRGo1Q3vLuOII5DqVrMZhvU69f1ly/E0Vu0xTw+kOgLIkTsLaiI2J5iggtXpwv1xqRbwQ9uZWdFW6m8+nOLp3IKlbz5JENYgrAzIZeiCdezFYteDODovzYH6h+AI3gy1n6/MHsBS51GSaxDLY2PK+NexWknyNhvJPMiJoKFUSVqhX4rQ5sXnSXDS54JC/2MqNgHEos6u6KtE9O/oo/NdLyaKbiLsgvPefXeLH4JC7iRonUQRNRJEYgYxYL7nSnI6GA9NS3nMdzQgame4Lxvv7ItkOkCK/7sixTV+2lpw61Mywiamegd6Bg1vtdgspa/NVElxGLfGYqHk6lVFpfZFoMjw6Fz1vSGJiXn06LzgbSmBw3QE/yRkRKhmBSdtuVx/70XK6jyX+QIUVB2riPpGQ3Dr58mukb+hy3GTQVylOmp7KBNi3jdJsX6iFW+ZREwj9vpsf7+cgV1v7CseUJTTLzuVPAEh6D9jsEwLC8CFD2zNE9Bkxuw9gEWNcavLYPCRsCDdiS4uw7aVGkAAmFyjLgZzUYxLWfvwxW/Uz8yzcsJoif4pBSlGvwGKY/XJTX3FnT0LjvE0zp8UXpLh6xcVTTZEVIP+ntesZ1MNjVT08UVin7Yd0SxHGVwA9jivzVNOxgVoeNPBbmYjUj2Z0IogFbtw6z08CdmZNFUS44RHW8HgC1OtRW5f66keI9J2Mcz9JmR8qzYKzZmVpQsZMhqBySwuScNoGWAcc368oiRMKo+dAaASFGwoyfdayZuxlnOzXhR4HSS0M4HW3xLLbpuKx/GjqkfCkYdulOTFEx23ht69TieykEWFJd8NnrCNJuzAOnEUDEhpPThzrSNKwFuG9tSTc3di8/FRHTIMUggrCJzADq3wQxmrQFinJsyTzF/dIAd0B6ihiPGhvqqPZMSAn+GiX5YTRg81EX7R6ZcIYiyEBbtmF4A/02Rcu4UCgKF+SR2oS/lZMw2VCEfEJEuPCPQWTPdAHmPFbHeKnjGUyETDhSe8mqAZ+i6EGtV5jUZlEWMktPJLhSQpQ18iu1pdukb1P+na9PZ2CPvnQvqYTzSgTY1Nz0Y8b9j1BM/LOaeR+cVoNNR70bBoEBj/YEaBvyhsmfaD0DRxZt+VT4ufbIAEe+Lt9sE6h+FULK/GrKVv8o3tKNVsUV6rOWipWJE1Qu4Q4WGInNfdt/0JPdsoiBQEkeWTv8fkITTsAWfcIFmHPNoZgoXngFdmqrI2UhF1CJYIp0WCB2nCOEAJigTePR4z7JdsrRrl5NsfIYFH6oONItn6qXOxwIqUZPqgbMG6QppZjXlpDCQnDSfdwIrJmykuuNIV1F3zQLiTJGeWE9Nw4dkehlkxKhbdJg+LGNSBerdVGq/O9xx9zUhSyrFHJy42N0cAqXnk9YRyth5KaPxmmI3C8dN6jcMSlOSU5pQ0Fr3Y/RforSQitx6PzPXJNUmkvxNm03+JaIfrSxV/2kGfIaXG85gRQ+iRf0PKoqZEqbTSbWkcfS89e2jxoPjB65hz2lq/CUAIpQb5oJNt3NNukRc8gWo4xfj/2XK1Sk5kPojp3FyP2814WcPOlznF0nRJWsGv3PcNafj6MTBsy6e+JfzGtIYI2laM/0X3UrftL13FsO24EKaM2H7OcBuswkDixFeqv5R+O9dfWu+WZ7CJ//61jrZ8osFB3mW/f+CSIkGN20WgTAZOfmupRCiBRFfZHGSfqWN0WUxfqINJGmtQ+alih9QQwSrM6mRS+yY8SRC476M8j3A45R/zTGe0AAMuo4J2GgXot2y2KqptPqGQh3M3bMwa6x3lgXgC5S5PEC0qbwX7+T4QOqT0nF17yJJOdJFGqLw+Hz0qnOjssi2L1YbQj1ipRyV6zFkWAqKAJYqf8ODsSHwgnp1zMHF4cbq5RdFRdG+xYptQB+FmBCgMIug/Ho36COqH9mwkhkLy3GvF/ZYXleg/LdFR3hU9YpQ3PyfMTkD9c+EczuUdixOjr/4XEtSuYKUMYWpSq/6TAXBg9BsBdfGJKqxnaZQijSW965ljS8JDNDJdxz+IV4/XnJWMtwr96dvRb1XJ87Uq61fw5o/LYpDethg9mYQqHbZzypmAE4FIeXreBytNazXEWMVfbSCim13I+ET1ubsyi0KA3m57aSF+9Cq2ICjf/Wfj+yz6wNB9zyKi0aRnsuti8MeYH/aS1z3xl3V6PT7AZCUJDvC1TmLr+FZ65OrI9mCEfUvfYOuXV2SG6s9jvnpXI3bDDPs8F3YVOrc6oEsmmj9hug37ovC4/z+yYqUniSi4Q9yYV6/4yAOEarCrLPy4a3UMoqRFuaktufFV3ow/56eCPX0dv7dOehMbK1SFr//+aImyHr4NGADtUmz1l7JJWBzGd48nHleiqGW3bhKpGbaKTWufgRncdXfNZWlBof5QcmbULRz1A0HrI6zCG/pwAT2BJYmbPVS5P0Tt7xwi8luzZTCfrqEEdWwir/1FDZQVTLJvxTtUQiYwxsbdtOdjmLFcOB4VTpnznFdukkhzlEPQP4Snj9MEIW5fC78bsABdGSUx1hFZi0bnwphCn6sTJ0o++e1lez+bB33Qd9rl+3BACkXu63ukQWPmhZjWsaa4j68Hz4xhcTyJoxIIv+mrrwBj++FckGLc7L8Us5bIQxafCM1ctO7pBPnu4wR3WNVYRwIcGlct+iJhVnWkJzLqeKVG6FkZ2Bml6KYbFMP5YmoFQlPEDSZ90oap+Y7Rs3+1bVIwQrGSuFWhIXsoWq1v8dCD7JwPlKnZp9fqJONjjqnGxsQVEThTT7GMBo5a+gedtcLggGbG3npdM/ujs7K+BpveQ7Dh4TEQ2m1N9WY2JnEQ3UftDhNRjFul1mrBzUvqyEjHfBtjCvS0bW6Zh3L7D5GbJZicFyNspz65xKtVan6AQwscD3gDHrltihQU8BiuUV5WH21k8IuOAhfs3xt8Ch4I3N8yO4Q5xWF5tGc3gMk4wTnTsoOaBytXdCSbAO23OA0YoUd+6QOtdAxl4EoCFZWvCyYQGVRBntxzKSdNbw+AY7GbGlgHUx9VnRAJHMVL34cZbJHjJy+aeAY8fWs2oM+tWVYNNN5Wia3GffqDA+/1GRnsRVAkrDXFHqAmTSseR2u+kJDHGoi0ZXH6FbTEgwKFbuiGfkZ7F/KAKyMKIQCQlct1lBw3XCIH116q8wRvmXY/+JZ5RRNP2dXZnA6nmsLtQ6u3pfB4ICD2/Bga3Yn7PUT/wj4NK+2ZjLHt1uRi18ps+01WoJtWbvb45EJ61NL1twE7roCeslZyJzBImb/BIilW4XtXon8Si9mUMwqDHsvklSfCGNySFT4AGNaoV3Z0gtba3iMlYGBWMX7+Facd8q+5tqo3L4Y2sMDw3s+jxleNprBtCarS2Xa2sZrMGFTel764YPXGQ9rJIToQP2AyisFo39sz2W0H4jIyf9u7gsOO8V8sCQnA1Gb6nN9HhZI1hltp++a+QnKkRV9MlQ67YTQOjg4EclIZ+1iaw7XJp3kiKqAHr5lm/VdGErXzxjhAbQjZo+i6QVgwh9VSQ6N2xIVUsba9Lu40VMhJyAtftwZH32aFNMopKwxOe2p7+b1E/iTToTWOjUmtUnEc+8A63V5EWftxFOB57wK4oBJYYhVnH7FHj1DLZsAqCgi1g5pkg2/p33FX7o0WdSr5hAAs1Yk7aRgxITZXp1WFPDPvuAplFCN7rj4/3UfEKEwZNjoUC5z7fkkhwQ2q3yufVQbFIRXuyE2EZ0ZtYH0kInpC6ep1pAvQkanMGQ0gVZKBqaBlHtaQx5NM32i9SimTGAmDfb62xKClzgHwUUJhNj99FMGyRxzRDR47a0QYkvF+zsObLx4bt+3toS0anUqjjyLkECgkqN1xeox8yopuJJA5hOs/KDgr8ipsRNS8hgVjyFEIG913ZLDzgNglvvNv29KD36euaYUOT8A8hPQ3RZQP8Xh6/kMtGhEGdmasaQ=='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 78315, 'candidates_token_count': 30, 'total_token_count': 79613, 'cached_content_token_count': 83289, 'prompt_tokens_details': [{'modality': 1, 'token_count': 85892}], 'cache_tokens_details': [{'modality': 1, 'token_count': 83289}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 30}], 'thoughts_token_count': 1268}, 'finish_reason': 'STOP', 'avg_logprobs': -5.258732604980469, 'model_name': 'gemini-2.5-pro'} id='run--7ac81f07-018d-44b2-8e56-3aa36b1e62a1-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/admin_inlines/tests.py', 'start_line': 1.0, 'end_line': 521.0}, 'id': '2df3aa6a-532f-44ca-aa8b-f564b2fb144d', 'type': 'tool_call'}] usage_metadata={'input_tokens': 78315, 'output_tokens': 30, 'total_tokens': 79613, 'input_token_details': {'cache_read': 83289}, 'output_token_details': {'reasoning': 1268}}
2025-10-06 21:01:24,098 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 1.0, "relative_path": "tests/admin_views/tests.py", "end_line": 101.0}'}, '__gemini_function_call_thought_signatures__': {'299c6957-4ff7-42e3-ad47-7042d22a8f43': 'CoUKAR/MhbaXmzaYeNQ9B6aFe10UTTtTwzdiAU7BSPeEsb1pdtaG8mNYvntKh9aTygV6AO6D/JI7UTTzZrHoqPbBIeFV7t3imOK/hxM/Jdcom8VKrtwzqRmpl9cyGjRTr1loIu8HJtdZG/gG+pY6EAodNgVnZIVpbgqz+nXReWueQ4Aid1jQpXZ0Urb0W+DRWw9h3v9pj+whVtMwL/ZRaLzMweshzFJkmam2Hlbh+CMzy2ZK+i7cwDNUZwDGJxy3ca3geImlZOrJSY5i8CW5LGHOHrVAdfC/jp4Hwq/0dJ2IoBkM1WxBKUllg/qPgd+JzUYjOvjH2oDAUamiSytW/WucHC7vwn86mXP/iM5CnstJ7YX+yyC2pTuq2oY/ICgHukFtjsnatRFhW3Ghftsksft6oeO8fhsNGkVpIGUl7MxZQod2aH6HyMaZWh9IveonjkkpzS3uhiSgMTXPE5PP3/aWLIeD/DUmwIn5/oK6rfPx7tsVjrFbVIPb59Z4F6IH4Ig0jSI6tJejZ0ndTgFRnZleafzkDHVSvRIo+m5CuA8gGFAweoBfR8ZUKFDUrlcFRLYDtY4dxsb1uoeL/QUZic+e42sH4fdAMKujESn+2zLkwlJL09mxJ6AQ8KCS60zY/bx2GeT40tJfBHWh846YEoAyzujATEy18SfW/54d7uiouPGCDVx+K6A01xK3cJL5waFLoa8USUMJJu55Ls7JCz5Clu+/YEp8cPcvZSntZXvX0fd0OHYWbc45aeT7rChDiI1MFmkp9l2sgp2WmkbkTldl2kdBWlhzb9qPhavUh2nMHWQkZMx3aaEhDkQQGPN9ffdByx/jxXg0DP9FAr83mmsSTkLKlqW4aLMnE080nAJAmq60DjTG/WCCUZwGzVqoX5J9BgmmkTZQwwvVY6I9dzykNxkrtPSL5mUa6Sq2dy+Ov+MN+uHFZEJfB5qCGS3a8UC24NVEcjfdizLseUGRUwel5IDeH6i9M3nUvwNL+oXsmhzBcNslxGdGU9udQxXcBY3x+9QnTHKlHfMilH7QVOCL8Cjr5/uwMgvOWwl5TziFEBSmN5LsSHH3dh9X1bZw6LWeopdFI7IRR81TXQ+GbSpP0X2QoAgPqh5a2AYxkUeKt6KFYRnDRqsnTJ9Hj+NRjtOOvwFUuYAVfgCjzRNcKa1csCoegIVS6opB4SKKi4G+CPVn3BpRZ3FFYJQdflt4WlA6pD4h39k7LEEZOlIEsIs/sqKPMttISoFBe9z6vDLnPpqGih3jq9yhYrWqpMv5xSSZIqRlWgvhaS5t0FTfLcZ5BEMzxsVviEcO6cx3KgfDJflVMCfKY7gEOxkfdQeYyLTc/mARa9IvjWzr2TipcMHOPLI91DHYvpKha3MGqy8jObjVSyZHvW62PtsTpdnhT3San7jsq8sOcmgKlZG9KW6KJAY5yf+5dja45kpAfzUHZvy8EZzj0V62NiuIY4QVuiZs7Hh4F5X0IKydLLtC7cEad0R9AIkS7LzVNvoiUd6g9TNedgMDn69peCdrouxkMiL1WVEXCUOmvODqratGsgyayJqQ5jHo9BqvaAmYoB1ImXhmfIJicQObzVT7FwB42PkxP0ks7dB4tcXL1YJRiKZ4PxnlE2D1CQH67mwzNLyoo31Tz2LQBuXKs7PkdV9jRp3VvFaKUnwqLr0aNWzIdY1dGv377b4mAZ7d39Sq+iXnjzM9QcAHfQ=='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 87659, 'candidates_token_count': 29, 'total_token_count': 88069, 'cached_content_token_count': 83222, 'prompt_tokens_details': [{'modality': 1, 'token_count': 96502}], 'cache_tokens_details': [{'modality': 1, 'token_count': 83222}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 29}], 'thoughts_token_count': 381}, 'finish_reason': 'STOP', 'avg_logprobs': -1.183747127138335, 'model_name': 'gemini-2.5-pro'} id='run--9911d886-627b-45be-bc7f-f67d9132f077-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 1.0, 'relative_path': 'tests/admin_views/tests.py', 'end_line': 101.0}, 'id': '299c6957-4ff7-42e3-ad47-7042d22a8f43', 'type': 'tool_call'}] usage_metadata={'input_tokens': 87659, 'output_tokens': 29, 'total_tokens': 88069, 'input_token_details': {'cache_read': 83222}, 'output_token_details': {'reasoning': 381}}
2025-10-06 21:01:27,291 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 6094.0, "relative_path": "tests/admin_views/tests.py", "end_line": 6224.0}'}, '__gemini_function_call_thought_signatures__': {'58ae2ba3-be38-4837-bc93-b3958a8a86c1': 'CrYCAR/MhbbQV60R/7fTCTfjmzLZXwydKoqvC+GFrYLS1S75El/rVSPZg9XlF1+4+S6vwl9E1sSYKpIM/bJRKg9YP1jQjWICa8Y+l+uuFzyd4I7NGCkCFMIG3TjPZYGoBnTlIkQJODyFZTVzpnS64GyWvkJHneQw0JY9pkWKttIgHGIt4Yz3PQoKL9r/Rx9jXY8/oFAT98gVdC15O/jbgTFh17j07qLDhmzTFYM6aF2qiKxWkIi7ORsJ4GBbGnXWveff3GudqVNdZ5bbATNNMAamQWNAfYAuzgdsJDuC4lz8yeyrbe+0GQOdyvTjxvmdy+cVYf+2WCEc2vk0gyG05KvZhnCnUpnKndZpN6QB2LyxSJjvz6gkGT01h80vEILhnYpcAgbJj6nEKEs/dChlr2g7LvcWem7gGA=='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 89261, 'candidates_token_count': 29, 'total_token_count': 89388, 'cached_content_token_count': 95086, 'prompt_tokens_details': [{'modality': 1, 'token_count': 98483}], 'cache_tokens_details': [{'modality': 1, 'token_count': 95086}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 29}], 'thoughts_token_count': 98}, 'finish_reason': 'STOP', 'avg_logprobs': -0.1389989030772242, 'model_name': 'gemini-2.5-pro'} id='run--75cee006-7108-440a-8864-c27d53fe92fd-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 6094.0, 'relative_path': 'tests/admin_views/tests.py', 'end_line': 6224.0}, 'id': '58ae2ba3-be38-4837-bc93-b3958a8a86c1', 'type': 'tool_call'}] usage_metadata={'input_tokens': 89261, 'output_tokens': 29, 'total_tokens': 89388, 'input_token_details': {'cache_read': 95086}, 'output_token_details': {'reasoning': 98}}
2025-10-06 21:01:30,995 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/admin_views/tests.py", "start_line": 188.0, "end_line": 995.0}'}, '__gemini_function_call_thought_signatures__': {'653f4ca4-4ec3-4f0b-88a5-b2e3ad0a63f6': 'Cs0BAR/MhbYdQWNSoa/ZFmGyLxazEBgsptuz8oAJanbve5dDrTUKznLUn1UJ1CXFUEerDz7hmz18/fzAuTM4kZA+T/JfgMDl27N5i3ahd1nXwfzrSkOgvoPYzvYqGcUD89mDO8gJR2hYPWZnG27sUiXSRU0j2gdKB5N5qPA6Q1fLVpnOpUgseeBhHpzKpevqEMo5Q6uUvvS1w5u0j+IUkEMzxVJTmPXWDxuCaXRZvjCJvh80QONe8zLzZWT3RJ4m2f7MJS5IVKw57eaHMemUag=='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 92148, 'candidates_token_count': 29, 'total_token_count': 92235, 'cached_content_token_count': 95029, 'prompt_tokens_details': [{'modality': 1, 'token_count': 101466}], 'cache_tokens_details': [{'modality': 1, 'token_count': 95029}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 29}], 'thoughts_token_count': 58}, 'finish_reason': 'STOP', 'avg_logprobs': -0.1751660314099542, 'model_name': 'gemini-2.5-pro'} id='run--2ffb2551-b8ab-4ec6-b226-7df9b579d824-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/admin_views/tests.py', 'start_line': 188.0, 'end_line': 995.0}, 'id': '653f4ca4-4ec3-4f0b-88a5-b2e3ad0a63f6', 'type': 'tool_call'}] usage_metadata={'input_tokens': 92148, 'output_tokens': 29, 'total_tokens': 92235, 'input_token_details': {'cache_read': 95029}, 'output_token_details': {'reasoning': 58}}
2025-10-06 21:02:27,027 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I have gathered five relevant test cases that demonstrate how to test dynamic, request-based customizations in `ModelAdmin` and `InlineModelAdmin`. The selected tests showcase how to use callable methods and override `ModelAdmin` hooks to alter behavior, which is directly applicable to the user\'s goal of implementing a `get_inlines` hook. The tests cover dynamic control of the number of inline forms, usage of callables in `readonly_fields` and `view_on_site`, and sorting on callable fields in the changelist.\n\n# Test Case 1\n```python\n# File: tests/admin_inlines/tests.py\nfrom django.contrib.admin import ModelAdmin, TabularInline\nfrom django.contrib.admin.helpers import InlineAdminForm\nfrom django.contrib.admin.tests import AdminSeleniumTestCase\nfrom django.contrib.auth.models import Permission, User\nfrom django.contrib.contenttypes.models import ContentType\nfrom django.test import RequestFactory, TestCase, override_settings\nfrom django.urls import reverse\n\nfrom .admin import InnerInline, site as admin_site\nfrom .models import (\n    Author, BinaryTree, Book, Chapter, Child, ChildModel1, ChildModel2,\n    Fashionista, FootNote, Holder, Holder2, Holder3, Holder4, Inner, Inner2,\n    Inner3, Inner4Stacked, Inner4Tabular, Novel, OutfitItem, Parent,\n    ParentModelWithCustomPk, Person, Poll, Profile, ProfileCollection,\n    Question, Sighting, SomeChildModel, SomeParentModel, Teacher,\n)\n\nINLINE_CHANGELINK_HTML = \'class="inlinechangelink">Change</a>\'\n\n\nclass TestDataMixin:\n\n    @classmethod\n    def setUpTestData(cls):\n        cls.superuser = User.objects.create_superuser(username=\'super\', email=\'super@example.com\', password=\'secret\')\n\n\n@override_settings(ROOT_URLCONF=\'admin_inlines.urls\')\nclass TestInline(TestDataMixin, TestCase):\n    factory = RequestFactory()\n\n    @classmethod\n    def setUpTestData(cls):\n        super().setUpTestData()\n        cls.holder = Holder.objects.create(dummy=13)\n        Inner.objects.create(dummy=42, holder=cls.holder)\n\n    def setUp(self):\n        self.client.force_login(self.superuser)\n\n    def test_custom_min_num(self):\n        bt_head = BinaryTree.objects.create(name="Tree Head")\n        BinaryTree.objects.create(name="First Child", parent=bt_head)\n\n        class MinNumInline(TabularInline):\n            model = BinaryTree\n            extra = 3\n\n            def get_min_num(self, request, obj=None, **kwargs):\n                if obj:\n                    return 5\n                return 2\n\n        modeladmin = ModelAdmin(BinaryTree, admin_site)\n        modeladmin.inlines = [MinNumInline]\n        min_forms = (\n            \'<input id="id_binarytree_set-MIN_NUM_FORMS" \'\n            \'name="binarytree_set-MIN_NUM_FORMS" type="hidden" value="%d">\'\n        )\n        total_forms = (\n            \'<input id="id_binarytree_set-TOTAL_FORMS" \'\n            \'name="binarytree_set-TOTAL_FORMS" type="hidden" value="%d">\'\n        )\n        request = self.factory.get(reverse(\'admin:admin_inlines_binarytree_add\'))\n        request.user = User(username=\'super\', is_superuser=True)\n        response = modeladmin.changeform_view(request)\n        self.assertInHTML(min_forms % 2, response.rendered_content)\n        self.assertInHTML(total_forms % 5, response.rendered_content)\n\n        request = self.factory.get(reverse(\'admin:admin_inlines_binarytree_change\', args=(bt_head.id,)))\n        request.user = User(username=\'super\', is_superuser=True)\n        response = modeladmin.changeform_view(request, object_id=str(bt_head.id))\n        self.assertInHTML(min_forms % 5, response.rendered_content)\n        self.assertInHTML(total_forms % 8, response.rendered_content)\n```\n\n# Test Case 2\n```python\n# File: tests/admin_inlines/tests.py\nfrom django.contrib.admin import ModelAdmin, TabularInline\nfrom django.contrib.admin.helpers import InlineAdminForm\nfrom django.contrib.admin.tests import AdminSeleniumTestCase\nfrom django.contrib.auth.models import Permission, User\nfrom django.contrib.contenttypes.models import ContentType\nfrom django.test import RequestFactory, TestCase, override_settings\nfrom django.urls import reverse\n\nfrom .admin import InnerInline, site as admin_site\nfrom .models import (\n    Author, BinaryTree, Book, Chapter, Child, ChildModel1, ChildModel2,\n    Fashionista, FootNote, Holder, Holder2, Holder3, Holder4, Inner, Inner2,\n    Inner3, Inner4Stacked, Inner4Tabular, Novel, OutfitItem, Parent,\n    ParentModelWithCustomPk, Person, Poll, Profile, ProfileCollection,\n    Question, Sighting, SomeChildModel, SomeParentModel, Teacher,\n)\n\nINLINE_CHANGELINK_HTML = \'class="inlinechangelink">Change</a>\'\n\n\nclass TestDataMixin:\n\n    @classmethod\n    def setUpTestData(cls):\n        cls.superuser = User.objects.create_superuser(username=\'super\', email=\'super@example.com\', password=\'secret\')\n\n\n@override_settings(ROOT_URLCONF=\'admin_inlines.urls\')\nclass TestInline(TestDataMixin, TestCase):\n    factory = RequestFactory()\n\n    @classmethod\n    def setUpTestData(cls):\n        super().setUpTestData()\n        cls.holder = Holder.objects.create(dummy=13)\n        Inner.objects.create(dummy=42, holder=cls.holder)\n\n    def setUp(self):\n        self.client.force_login(self.superuser)\n\n    def test_custom_get_extra_form(self):\n        bt_head = BinaryTree.objects.create(name="Tree Head")\n        BinaryTree.objects.create(name="First Child", parent=bt_head)\n        # The maximum number of forms should respect \'get_max_num\' on the\n        # ModelAdmin\n        max_forms_input = (\n            \'<input id="id_binarytree_set-MAX_NUM_FORMS" \'\n            \'name="binarytree_set-MAX_NUM_FORMS" type="hidden" value="%d">\'\n        )\n        # The total number of forms will remain the same in either case\n        total_forms_hidden = (\n            \'<input id="id_binarytree_set-TOTAL_FORMS" \'\n            \'name="binarytree_set-TOTAL_FORMS" type="hidden" value="2">\'\n        )\n        response = self.client.get(reverse(\'admin:admin_inlines_binarytree_add\'))\n        self.assertInHTML(max_forms_input % 3, response.rendered_content)\n        self.assertInHTML(total_forms_hidden, response.rendered_content)\n\n        response = self.client.get(reverse(\'admin:admin_inlines_binarytree_change\', args=(bt_head.id,)))\n        self.assertInHTML(max_forms_input % 2, response.rendered_content)\n        self.assertInHTML(total_forms_hidden, response.rendered_content)\n```\n\n# Test Case 3\n```python\n# File: tests/admin_inlines/tests.py\nfrom django.contrib.admin import ModelAdmin, TabularInline\nfrom django.contrib.admin.helpers import InlineAdminForm\nfrom django.contrib.admin.tests import AdminSeleniumTestCase\nfrom django.contrib.auth.models import Permission, User\nfrom django.contrib.contenttypes.models import ContentType\nfrom django.test import RequestFactory, TestCase, override_settings\nfrom django.urls import reverse\n\nfrom .admin import InnerInline, site as admin_site\nfrom .models import (\n    Author, BinaryTree, Book, Chapter, Child, ChildModel1, ChildModel2,\n    Fashionista, FootNote, Holder, Holder2, Holder3, Holder4, Inner, Inner2,\n    Inner3, Inner4Stacked, Inner4Tabular, Novel, OutfitItem, Parent,\n    ParentModelWithCustomPk, Person, Poll, Profile, ProfileCollection,\n    Question, Sighting, SomeChildModel, SomeParentModel, Teacher,\n)\n\nINLINE_CHANGELINK_HTML = \'class="inlinechangelink">Change</a>\'\n\n\nclass TestDataMixin:\n\n    @classmethod\n    def setUpTestData(cls):\n        cls.superuser = User.objects.create_superuser(username=\'super\', email=\'super@example.com\', password=\'secret\')\n\n\n@override_settings(ROOT_URLCONF=\'admin_inlines.urls\')\nclass TestInline(TestDataMixin, TestCase):\n    factory = RequestFactory()\n\n    @classmethod\n    def setUpTestData(cls):\n        super().setUpTestData()\n        cls.holder = Holder.objects.create(dummy=13)\n        Inner.objects.create(dummy=42, holder=cls.holder)\n\n    def setUp(self):\n        self.client.force_login(self.superuser)\n\n    def test_callable_lookup(self):\n        """Admin inline should invoke local callable when its name is listed in readonly_fields"""\n        response = self.client.get(reverse(\'admin:admin_inlines_poll_add\'))\n        self.assertEqual(response.status_code, 200)\n        # Add parent object view should have the child inlines section\n        self.assertContains(\n            response,\n            \'<div class="js-inline-admin-formset inline-group" id="question_set-group"\'\n        )\n        # The right callable should be used for the inline readonly_fields\n        # column cells\n        self.assertContains(response, \'<p>Callable in QuestionInline</p>\')\n```\n\n# Test Case 4\n```python\n# File: tests/admin_views/tests.py\nimport datetime\nimport os\nimport re\nimport unittest\nfrom unittest import mock\nfrom urllib.parse import parse_qsl, urljoin, urlparse\n\nimport pytz\n\nfrom django.contrib.admin import AdminSite, ModelAdmin\nfrom django.contrib.admin.helpers import ACTION_CHECKBOX_NAME\nfrom django.contrib.admin.models import ADDITION, DELETION, LogEntry\nfrom django.contrib.admin.options import TO_FIELD_VAR\nfrom django.contrib.admin.templatetags.admin_urls import add_preserved_filters\nfrom django.contrib.admin.tests import AdminSeleniumTestCase\nfrom django.contrib.admin.utils import quote\nfrom django.contrib.admin.views.main import IS_POPUP_VAR\nfrom django.contrib.auth import REDIRECT_FIELD_NAME, get_permission_codename\nfrom django.contrib.auth.models import Group, Permission, User\nfrom django.contrib.contenttypes.models import ContentType\nfrom django.core import mail\nfrom django.core.checks import Error\nfrom django.core.files import temp as tempfile\nfrom django.forms.utils import ErrorList\nfrom django.template.response import TemplateResponse\nfrom django.test import (\n    TestCase, modify_settings, override_settings, skipUnlessDBFeature,\n)\nfrom django.test.utils import override_script_prefix\nfrom django.urls import NoReverseMatch, resolve, reverse\nfrom django.utils import formats, translation\nfrom django.utils.cache import get_max_age\nfrom django.utils.encoding import iri_to_uri\nfrom django.utils.html import escape\nfrom django.utils.http import urlencode\n\nfrom . import customadmin\nfrom .admin import CityAdmin, site, site2\nfrom .models import (\n    Actor, AdminOrderedAdminMethod, AdminOrderedCallable, AdminOrderedField,\n    AdminOrderedModelMethod, Answer, Answer2, Article, BarAccount, Book,\n    Bookmark, Category, Chapter, ChapterXtra1, ChapterXtra2, Character, Child,\n    Choice, City, Collector, Color, ComplexSortedPerson, CoverLetter,\n    CustomArticle, CyclicOne, CyclicTwo, DooHickey, Employee, EmptyModel,\n    Fabric, FancyDoodad, FieldOverridePost, FilteredManager, FooAccount,\n    FoodDelivery, FunkyTag, Gallery, Grommet, Inquisition, Language, Link,\n    MainPrepopulated, Media, ModelWithStringPrimaryKey, OtherStory, Paper,\n    Parent, ParentWithDependentChildren, ParentWithUUIDPK, Person, Persona,\n    Picture, Pizza, Plot, PlotDetails, PluggableSearchPerson, Podcast, Post,\n    PrePopulatedPost, Promo, Question, ReadablePizza, ReadOnlyPizza,\n    Recommendation, Recommender, RelatedPrepopulated, RelatedWithUUIDPKModel,\n    Report, Restaurant, RowLevelChangePermissionModel, SecretHideout, Section,\n    ShortMessage, Simple, State, Story, SuperSecretHideout, SuperVillain,\n    Telegram, TitleTranslation, Topping, UnchangeableObject, UndeletableObject,\n    UnorderedObject, UserProxy, Villain, Vodcast, Whatsit, Widget, Worker,\n    WorkHour,\n)\n\nERROR_MESSAGE = "Please enter the correct username and password \\\\\nfor a staff account. Note that both fields may be case-sensitive."\n\nMULTIPART_ENCTYPE = \'enctype="multipart/form-data"\'\n\n\n@override_settings(ROOT_URLCONF=\'admin_views.urls\')\nclass AdminViewOnSiteTests(TestCase):\n\n    @classmethod\n    def setUpTestData(cls):\n        cls.superuser = User.objects.create_superuser(username=\'super\', password=\'secret\', email=\'super@example.com\')\n\n        cls.s1 = State.objects.create(name=\'New York\')\n        cls.s2 = State.objects.create(name=\'Illinois\')\n        cls.s3 = State.objects.create(name=\'California\')\n        cls.c1 = City.objects.create(state=cls.s1, name=\'New York\')\n        cls.c2 = City.objects.create(state=cls.s2, name=\'Chicago\')\n        cls.c3 = City.objects.create(state=cls.s3, name=\'San Francisco\')\n        cls.r1 = Restaurant.objects.create(city=cls.c1, name=\'Italian Pizza\')\n        cls.r2 = Restaurant.objects.create(city=cls.c1, name=\'Boulevard\')\n        cls.r3 = Restaurant.objects.create(city=cls.c2, name=\'Chinese Dinner\')\n        cls.r4 = Restaurant.objects.create(city=cls.c2, name=\'Angels\')\n        cls.r5 = Restaurant.objects.create(city=cls.c2, name=\'Take Away\')\n        cls.r6 = Restaurant.objects.create(city=cls.c3, name=\'The Unknown Restaurant\')\n        cls.w1 = Worker.objects.create(work_at=cls.r1, name=\'Mario\', surname=\'Rossi\')\n        cls.w2 = Worker.objects.create(work_at=cls.r1, name=\'Antonio\', surname=\'Bianchi\')\n        cls.w3 = Worker.objects.create(work_at=cls.r1, name=\'John\', surname=\'Doe\')\n\n    def setUp(self):\n        self.client.force_login(self.superuser)\n\n    def test_callable(self):\n        "The right link is displayed if view_on_site is a callable"\n        response = self.client.get(reverse(\'admin:admin_views_worker_change\', args=(self.w1.pk,)))\n        self.assertContains(response, \'"/worker/%s/%s/"\' % (self.w1.surname, self.w1.name))\n```\n\n# Test Case 5\n```python\n# File: tests/admin_views/tests.py\nimport datetime\nimport os\nimport re\nimport unittest\nfrom unittest import mock\nfrom urllib.parse import parse_qsl, urljoin, urlparse\n\nimport pytz\n\nfrom django.contrib.admin import AdminSite, ModelAdmin\nfrom django.contrib.admin.helpers import ACTION_CHECKBOX_NAME\nfrom django.contrib.admin.models import ADDITION, DELETION, LogEntry\nfrom django.contrib.admin.options import TO_FIELD_VAR\nfrom django.contrib.admin.templatetags.admin_urls import add_preserved_filters\nfrom django.contrib.admin.tests import AdminSeleniumTestCase\nfrom django.contrib.admin.utils import quote\nfrom django.contrib.admin.views.main import IS_POPUP_VAR\nfrom django.contrib.auth import REDIRECT_FIELD_NAME, get_permission_codename\nfrom django.contrib.auth.models import Group, Permission, User\nfrom django.contrib.contenttypes.models import ContentType\nfrom django.core import mail\nfrom django.core.checks import Error\nfrom django.core.files import temp as tempfile\nfrom django.forms.utils import ErrorList\nfrom django.template.response import TemplateResponse\nfrom django.test import (\n    TestCase, modify_settings, override_settings, skipUnlessDBFeature,\n)\nfrom django.test.utils import override_script_prefix\nfrom django.urls import NoReverseMatch, resolve, reverse\nfrom django.utils import formats, translation\nfrom django.utils.cache import get_max_age\nfrom django.utils.encoding import iri_to_uri\nfrom django.utils.html import escape\nfrom django.utils.http import urlencode\n\nfrom . import customadmin\nfrom .admin import CityAdmin, site, site2\nfrom .models import (\n    Actor, AdminOrderedAdminMethod, AdminOrderedCallable, AdminOrderedField,\n    AdminOrderedModelMethod, Answer, Answer2, Article, BarAccount, Book,\n    Bookmark, Category, Chapter, ChapterXtra1, ChapterXtra2, Character, Child,\n    Choice, City, Collector, Color, ComplexSortedPerson, CoverLetter,\n    CustomArticle, CyclicOne, CyclicTwo, DooHickey, Employee, EmptyModel,\n    Fabric, FancyDoodad, FieldOverridePost, FilteredManager, FooAccount,\n    FoodDelivery, FunkyTag, Gallery, Grommet, Inquisition, Language, Link,\n    MainPrepopulated, Media, ModelWithStringPrimaryKey, OtherStory, Paper,\n    Parent, ParentWithDependentChildren, ParentWithUUIDPK, Person, Persona,\n    Picture, Pizza, Plot, PlotDetails, PluggableSearchPerson, Podcast, Post,\n    PrePopulatedPost, Promo, Question, ReadablePizza, ReadOnlyPizza,\n    Recommendation, Recommender, RelatedPrepopulated, RelatedWithUUIDPKModel,\n    Report, Restaurant, RowLevelChangePermissionModel, SecretHideout, Section,\n    ShortMessage, Simple, State, Story, SuperSecretHideout, SuperVillain,\n    Telegram, TitleTranslation, Topping, UnchangeableObject, UndeletableObject,\n    UnorderedObject, UserProxy, Villain, Vodcast, Whatsit, Widget, Worker,\n    WorkHour,\n)\n\nERROR_MESSAGE = "Please enter the correct username and password \\\\\nfor a staff account. Note that both fields may be case-sensitive."\n\nMULTIPART_ENCTYPE = \'enctype="multipart/form-data"\'\n\n\n@override_settings(ROOT_URLCONF=\'admin_views.urls\', USE_I18N=True, USE_L10N=False, LANGUAGE_CODE=\'en\')\nclass AdminViewBasicTestCase(TestCase):\n\n    @classmethod\n    def setUpTestData(cls):\n        cls.superuser = User.objects.create_superuser(username=\'super\', password=\'secret\', email=\'super@example.com\')\n        cls.s1 = Section.objects.create(name=\'Test section\')\n        # We need a model with a callable list_display field.\n        cls.a1 = Article.objects.create(\n            content=\'<p>Middle content</p>\', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1\n        )\n        cls.a2 = Article.objects.create(\n            content=\'<p>Oldest content</p>\', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1\n        )\n        cls.a3 = Article.objects.create(\n            content=\'<p>Newest content</p>\', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1\n        )\n        cls.p1 = PrePopulatedPost.objects.create(title=\'A Long Title\', published=True, slug=\'a-long-title\')\n\n    def setUp(self):\n        super().setUp()\n        self.client.force_login(self.superuser)\n        # Data for posting a valid form - used in multiple tests.\n        self.inline_post_data = {\n            "name": "A new section",\n            # inline data\n            "article_set-TOTAL_FORMS": "5",\n            "article_set-INITIAL_FORMS": "3",\n            "article_set-MAX_NUM_FORMS": "0",\n            "article_set-0-id": self.a1.pk,\n            "article_set-0-content": "Pangram",\n            "article_set-0-date_0": "2012-02-28",\n            "article_set-0-date_1": "12:30:00",\n            "article_set-1-id": self.a2.pk,\n            "article_set-1-content": "Stale",\n            "article_set-1-date_0": "2003-10-15",\n            "article_set-1-date_1": "06:00:00",\n            "article_set-2-id": self.a3.pk,\n            "article_set-2-content": "Fresh",\n            "article_set-2-date_0": "2009-03-21",\n            "article_set-2-date_1": "18:00:00",\n            "article_set-3-content": "New",\n            "article_set-3-date_0": "2012-02-29",\n            "article_set-3-date_1": "12:35:00",\n            "article_set-4-content": "",\n            "article_set-4-date_0": "",\n            "article_set-4-date_1": "",\n        }\n        self.fab1 = Fabric.objects.create(surface=\'x\')\n        self.fab2 = Fabric.objects.create(surface=\'y\')\n\n\nclass AdminViewBasicTest(AdminViewBasicTestCase):\n    def test_change_list_sorting_callable(self):\n        """\n        Ensure we can sort on a list_display field that is a callable\n        (column 2 is callable_year in ArticleAdmin)\n        """\n        response = self.client.get(reverse(\'admin:admin_views_article_changelist\'), {\'o\': 2})\n        self.assertContentBefore(\n            response, \'Oldest content\', \'Middle content\',\n            "Results of sorting on callable are out of order."\n        )\n        self.assertContentBefore(\n            response, \'Middle content\', \'Newest content\',\n            "Results of sorting on callable are out of order."\n        )\n```' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'citation_metadata': {'citations': [{'start_index': 2036, 'end_index': 2338, 'uri': 'https://github.com/carlosejimenez/experiments', 'title': '', 'license_': ''}, {'start_index': 5137, 'end_index': 5439, 'uri': 'https://github.com/carlosejimenez/experiments', 'title': '', 'license_': ''}, {'start_index': 7834, 'end_index': 8136, 'uri': 'https://github.com/carlosejimenez/experiments', 'title': '', 'license_': ''}, {'start_index': 11652, 'end_index': 12038, 'uri': 'https://github.com/carlosejimenez/experiments', 'title': '', 'license_': ''}, {'start_index': 12053, 'end_index': 12323, 'uri': 'https://github.com/carlosejimenez/experiments', 'title': '', 'license_': ''}, {'start_index': 16383, 'end_index': 16769, 'uri': 'https://github.com/carlosejimenez/experiments', 'title': '', 'license_': ''}, {'start_index': 16784, 'end_index': 17054, 'uri': 'https://github.com/carlosejimenez/experiments', 'title': '', 'license_': ''}]}, 'usage_metadata': {'prompt_token_count': 107872, 'candidates_token_count': 5392, 'total_token_count': 113532, 'cached_content_token_count': 98822, 'prompt_tokens_details': [{'modality': 1, 'token_count': 117246}], 'cache_tokens_details': [{'modality': 1, 'token_count': 98822}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 5392}], 'thoughts_token_count': 268}, 'finish_reason': 'STOP', 'avg_logprobs': -0.015357396722901115, 'model_name': 'gemini-2.5-pro'} id='run--f9fd7388-19d6-42ac-9a8d-344a38b4f56f-0' usage_metadata={'input_tokens': 107872, 'output_tokens': 5392, 'total_tokens': 113532, 'input_token_details': {'cache_read': 98822}, 'output_token_details': {'reasoning': 268}}
2025-10-06 21:02:27,028 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - INFO - Starting context extraction process
2025-10-06 21:02:27,029 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - DEBUG - This is the original user query:

--- BEGIN ORIGINAL QUERY ---
Issue title:
add ModelAdmin.get_inlines() hook to allow set inlines based on the request or model instance.

Issue description: 
Description
	
add ModelAdmin.get_inlines() hook to allow set inlines based on the request or model instance.
Currently, We can override the method get_inline_instances to do such a thing, but a for loop should be copied to my code. So I wished add a hook get_inlines(request, obj=None)

Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/admin_views/tests.py
Line number range: 5303 - 5411
Content:
@override_settings(ROOT_URLCONF='admin_views.urls')
class CSSTest(TestCase):

    @classmethod
    def setUpTestData(cls):
        cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
        cls.s1 = Section.objects.create(name='Test section')
        cls.a1 = Article.objects.create(
            content='<p>Middle content</p>', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1
        )
        cls.a2 = Article.objects.create(
            content='<p>Oldest content</p>', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1
        )
        cls.a3 = Article.objects.create(
            content='<p>Newest content</p>', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1
        )
        cls.p1 = PrePopulatedPost.objects.create(title='A Long Title', published=True, slug='a-long-title')

    def setUp(self):
        self.client.force_login(self.superuser)

    def test_field_prefix_css_classes(self):
        """
        Fields have a CSS class name with a 'field-' prefix.
        """
        response = self.client.get(reverse('admin:admin_views_post_add'))

        # The main form
        self.assertContains(response, 'class="form-row field-title"')
        self.assertContains(response, 'class="form-row field-content"')
        self.assertContains(response, 'class="form-row field-public"')
        self.assertContains(response, 'class="form-row field-awesomeness_level"')
        self.assertContains(response, 'class="form-row field-coolness"')
        self.assertContains(response, 'class="form-row field-value"')
        self.assertContains(response, 'class="form-row"')  # The lambda function

        # The tabular inline
        self.assertContains(response, '<td class="field-url">')
        self.assertContains(response, '<td class="field-posted">')

    def test_index_css_classes(self):
        """
        CSS class names are used for each app and model on the admin index
        pages (#17050).
        """
        # General index page
        response = self.client.get(reverse('admin:index'))
        self.assertContains(response, '<div class="app-admin_views module">')
        self.assertContains(response, '<tr class="model-actor">')
        self.assertContains(response, '<tr class="model-album">')

        # App index page
        response = self.client.get(reverse('admin:app_list', args=('admin_views',)))
        self.assertContains(response, '<div class="app-admin_views module">')
        self.assertContains(response, '<tr class="model-actor">')
        self.assertContains(response, '<tr class="model-album">')

    def test_app_model_in_form_body_class(self):
        """
        Ensure app and model tag are correctly read by change_form template
        """
        response = self.client.get(reverse('admin:admin_views_section_add'))
        self.assertContains(response, '<body class=" app-admin_views model-section ')

    def test_app_model_in_list_body_class(self):
        """
        Ensure app and model tag are correctly read by change_list template
        """
        response = self.client.get(reverse('admin:admin_views_section_changelist'))
        self.assertContains(response, '<body class=" app-admin_views model-section ')

    def test_app_model_in_delete_confirmation_body_class(self):
        """
        Ensure app and model tag are correctly read by delete_confirmation
        template
        """
        response = self.client.get(reverse('admin:admin_views_section_delete', args=(self.s1.pk,)))
        self.assertContains(response, '<body class=" app-admin_views model-section ')

    def test_app_model_in_app_index_body_class(self):
        """
        Ensure app and model tag are correctly read by app_index template
        """
        response = self.client.get(reverse('admin:app_list', args=('admin_views',)))
        self.assertContains(response, '<body class=" dashboard app-admin_views')

    def test_app_model_in_delete_selected_confirmation_body_class(self):
        """
        Ensure app and model tag are correctly read by
        delete_selected_confirmation template
        """
        action_data = {
            ACTION_CHECKBOX_NAME: [self.s1.pk],
            'action': 'delete_selected',
            'index': 0,
        }
        response = self.client.post(reverse('admin:admin_views_section_changelist'), action_data)
        self.assertContains(response, '<body class=" app-admin_views model-section ')

    def test_changelist_field_classes(self):
        """
        Cells of the change list table should contain the field name in their class attribute
        Refs #11195.
        """
        Podcast.objects.create(name="Django Dose", release_date=datetime.date.today())
        response = self.client.get(reverse('admin:admin_views_podcast_changelist'))
        self.assertContains(response, '<th class="field-name">')
        self.assertContains(response, '<td class="field-release_date nowrap">')
        self.assertContains(response, '<td class="action-checkbox">')

File: tests/admin_filters/tests.py
Line number range: 198 - 199
Content:
class NotNinetiesListFilterAdmin(ModelAdmin):
    list_filter = (NotNinetiesListFilter,)

File: tests/admin_filters/tests.py
Line number range: 67 - 68
Content:
class DecadeListFilterWithoutParameter(DecadeListFilter):
    title = 'publication decade'

File: tests/admin_filters/tests.py
Line number range: 63 - 64
Content:
class DecadeListFilterWithoutTitle(DecadeListFilter):
    parameter_name = 'publication-decade'

File: tests/admin_filters/tests.py
Line number range: 202 - 203
Content:
class DecadeFilterBookAdminWithoutTitle(ModelAdmin):
    list_filter = (DecadeListFilterWithoutTitle,)

File: tests/admin_filters/tests.py
Line number range: 206 - 207
Content:
class DecadeFilterBookAdminWithoutParameter(ModelAdmin):
    list_filter = (DecadeListFilterWithoutParameter,)

File: tests/admin_inlines/tests.py
Line number range: 1 - 521
Content:
1. from django.contrib.admin import ModelAdmin, TabularInline
2. from django.contrib.admin.helpers import InlineAdminForm
3. from django.contrib.admin.tests import AdminSeleniumTestCase
4. from django.contrib.auth.models import Permission, User
5. from django.contrib.contenttypes.models import ContentType
6. from django.test import RequestFactory, TestCase, override_settings
7. from django.urls import reverse
8. 
9. from .admin import InnerInline, site as admin_site
10. from .models import (
11.     Author, BinaryTree, Book, Chapter, Child, ChildModel1, ChildModel2,
12.     Fashionista, FootNote, Holder, Holder2, Holder3, Holder4, Inner, Inner2,
13.     Inner3, Inner4Stacked, Inner4Tabular, Novel, OutfitItem, Parent,
14.     ParentModelWithCustomPk, Person, Poll, Profile, ProfileCollection,
15.     Question, Sighting, SomeChildModel, SomeParentModel, Teacher,
16. )
17. 
18. INLINE_CHANGELINK_HTML = 'class="inlinechangelink">Change</a>'
19. 
20. 
21. class TestDataMixin:
22. 
23.     @classmethod
24.     def setUpTestData(cls):
25.         cls.superuser = User.objects.create_superuser(username='super', email='super@example.com', password='secret')
26. 
27. 
28. @override_settings(ROOT_URLCONF='admin_inlines.urls')
29. class TestInline(TestDataMixin, TestCase):
30.     factory = RequestFactory()
31. 
32.     @classmethod
33.     def setUpTestData(cls):
34.         super().setUpTestData()
35.         cls.holder = Holder.objects.create(dummy=13)
36.         Inner.objects.create(dummy=42, holder=cls.holder)
37. 
38.     def setUp(self):
39.         self.client.force_login(self.superuser)
40. 
41.     def test_can_delete(self):
42.         """
43.         can_delete should be passed to inlineformset factory.
44.         """
45.         response = self.client.get(
46.             reverse('admin:admin_inlines_holder_change', args=(self.holder.id,))
47.         )
48.         inner_formset = response.context['inline_admin_formsets'][0].formset
49.         expected = InnerInline.can_delete
50.         actual = inner_formset.can_delete
51.         self.assertEqual(expected, actual, 'can_delete must be equal')
52. 
53.     def test_readonly_stacked_inline_label(self):
54.         """Bug #13174."""
55.         holder = Holder.objects.create(dummy=42)
56.         Inner.objects.create(holder=holder, dummy=42, readonly='')
57.         response = self.client.get(
58.             reverse('admin:admin_inlines_holder_change', args=(holder.id,))
59.         )
60.         self.assertContains(response, '<label>Inner readonly label:</label>')
61. 
62.     def test_many_to_many_inlines(self):
63.         "Autogenerated many-to-many inlines are displayed correctly (#13407)"
64.         response = self.client.get(reverse('admin:admin_inlines_author_add'))
65.         # The heading for the m2m inline block uses the right text
66.         self.assertContains(response, '<h2>Author-book relationships</h2>')
67.         # The "add another" label is correct
68.         self.assertContains(response, 'Add another Author-book relationship')
69.         # The '+' is dropped from the autogenerated form prefix (Author_books+)
70.         self.assertContains(response, 'id="id_Author_books-TOTAL_FORMS"')
71. 
72.     def test_inline_primary(self):
73.         person = Person.objects.create(firstname='Imelda')
74.         item = OutfitItem.objects.create(name='Shoes')
75.         # Imelda likes shoes, but can't carry her own bags.
76.         data = {
77.             'shoppingweakness_set-TOTAL_FORMS': 1,
78.             'shoppingweakness_set-INITIAL_FORMS': 0,
79.             'shoppingweakness_set-MAX_NUM_FORMS': 0,
80.             '_save': 'Save',
81.             'person': person.id,
82.             'max_weight': 0,
83.             'shoppingweakness_set-0-item': item.id,
84.         }
85.         response = self.client.post(reverse('admin:admin_inlines_fashionista_add'), data)
86.         self.assertEqual(response.status_code, 302)
87.         self.assertEqual(len(Fashionista.objects.filter(person__firstname='Imelda')), 1)
88. 
89.     def test_tabular_inline_column_css_class(self):
90.         """
91.         Field names are included in the context to output a field-specific
92.         CSS class name in the column headers.
93.         """
94.         response = self.client.get(reverse('admin:admin_inlines_poll_add'))
95.         text_field, call_me_field = list(response.context['inline_admin_formset'].fields())
96.         # Editable field.
97.         self.assertEqual(text_field['name'], 'text')
98.         self.assertContains(response, '<th class="column-text required">')
99.         # Read-only field.
100.         self.assertEqual(call_me_field['name'], 'call_me')
101.         self.assertContains(response, '<th class="column-call_me">')
102. 
103.     def test_custom_form_tabular_inline_label(self):
104.         """
105.         A model form with a form field specified (TitleForm.title1) should have
106.         its label rendered in the tabular inline.
107.         """
108.         response = self.client.get(reverse('admin:admin_inlines_titlecollection_add'))
109.         self.assertContains(response, '<th class="column-title1 required">Title1</th>', html=True)
110. 
111.     def test_custom_form_tabular_inline_overridden_label(self):
112.         """
113.         SomeChildModelForm.__init__() overrides the label of a form field.
114.         That label is displayed in the TabularInline.
115.         """
116.         response = self.client.get(reverse('admin:admin_inlines_someparentmodel_add'))
117.         field = list(response.context['inline_admin_formset'].fields())[0]
118.         self.assertEqual(field['label'], 'new label')
119.         self.assertContains(response, '<th class="column-name required">New label</th>', html=True)
120. 
121.     def test_tabular_non_field_errors(self):
122.         """
123.         non_field_errors are displayed correctly, including the correct value
124.         for colspan.
125.         """
126.         data = {
127.             'title_set-TOTAL_FORMS': 1,
128.             'title_set-INITIAL_FORMS': 0,
129.             'title_set-MAX_NUM_FORMS': 0,
130.             '_save': 'Save',
131.             'title_set-0-title1': 'a title',
132.             'title_set-0-title2': 'a different title',
133.         }
134.         response = self.client.post(reverse('admin:admin_inlines_titlecollection_add'), data)
135.         # Here colspan is "4": two fields (title1 and title2), one hidden field and the delete checkbox.
136.         self.assertContains(
137.             response,
138.             '<tr><td colspan="4"><ul class="errorlist nonfield">'
139.             '<li>The two titles must be the same</li></ul></td></tr>'
140.         )
141. 
142.     def test_no_parent_callable_lookup(self):
143.         """Admin inline `readonly_field` shouldn't invoke parent ModelAdmin callable"""
144.         # Identically named callable isn't present in the parent ModelAdmin,
145.         # rendering of the add view shouldn't explode
146.         response = self.client.get(reverse('admin:admin_inlines_novel_add'))
147.         self.assertEqual(response.status_code, 200)
148.         # View should have the child inlines section
149.         self.assertContains(
150.             response,
151.             '<div class="js-inline-admin-formset inline-group" id="chapter_set-group"'
152.         )
153. 
154.     def test_callable_lookup(self):
155.         """Admin inline should invoke local callable when its name is listed in readonly_fields"""
156.         response = self.client.get(reverse('admin:admin_inlines_poll_add'))
157.         self.assertEqual(response.status_code, 200)
158.         # Add parent object view should have the child inlines section
159.         self.assertContains(
160.             response,
161.             '<div class="js-inline-admin-formset inline-group" id="question_set-group"'
162.         )
163.         # The right callable should be used for the inline readonly_fields
164.         # column cells
165.         self.assertContains(response, '<p>Callable in QuestionInline</p>')
166. 
167.     def test_help_text(self):
168.         """
169.         The inlines' model field help texts are displayed when using both the
170.         stacked and tabular layouts.
171.         """
172.         response = self.client.get(reverse('admin:admin_inlines_holder4_add'))
173.         self.assertContains(response, '<div class="help">Awesome stacked help text is awesome.</div>', 4)
174.         self.assertContains(
175.             response,
176.             '<img src="/static/admin/img/icon-unknown.svg" '
177.             'class="help help-tooltip" width="10" height="10" '
178.             'alt="(Awesome tabular help text is awesome.)" '
179.             'title="Awesome tabular help text is awesome.">',
180.             1
181.         )
182.         # ReadOnly fields
183.         response = self.client.get(reverse('admin:admin_inlines_capofamiglia_add'))
184.         self.assertContains(
185.             response,
186.             '<img src="/static/admin/img/icon-unknown.svg" '
187.             'class="help help-tooltip" width="10" height="10" '
188.             'alt="(Help text for ReadOnlyInline)" '
189.             'title="Help text for ReadOnlyInline">',
190.             1
191.         )
192. 
193.     def test_tabular_model_form_meta_readonly_field(self):
194.         """
195.         Tabular inlines use ModelForm.Meta.help_texts and labels for read-only
196.         fields.
197.         """
198.         response = self.client.get(reverse('admin:admin_inlines_someparentmodel_add'))
199.         self.assertContains(
200.             response,
201.             '<img src="/static/admin/img/icon-unknown.svg" '
202.             'class="help help-tooltip" width="10" height="10" '
203.             'alt="(Help text from ModelForm.Meta)" '
204.             'title="Help text from ModelForm.Meta">'
205.         )
206.         self.assertContains(response, 'Label from ModelForm.Meta')
207. 
208.     def test_inline_hidden_field_no_column(self):
209.         """#18263 -- Make sure hidden fields don't get a column in tabular inlines"""
210.         parent = SomeParentModel.objects.create(name='a')
211.         SomeChildModel.objects.create(name='b', position='0', parent=parent)
212.         SomeChildModel.objects.create(name='c', position='1', parent=parent)
213.         response = self.client.get(reverse('admin:admin_inlines_someparentmodel_change', args=(parent.pk,)))
214.         self.assertNotContains(response, '<td class="field-position">')
215.         self.assertInHTML(
216.             '<input id="id_somechildmodel_set-1-position" '
217.             'name="somechildmodel_set-1-position" type="hidden" value="1">',
218.             response.rendered_content,
219.         )
220. 
221.     def test_non_related_name_inline(self):
222.         """
223.         Multiple inlines with related_name='+' have correct form prefixes.
224.         """
225.         response = self.client.get(reverse('admin:admin_inlines_capofamiglia_add'))
226.         self.assertContains(response, '<input type="hidden" name="-1-0-id" id="id_-1-0-id">', html=True)
227.         self.assertContains(
228.             response,
229.             '<input type="hidden" name="-1-0-capo_famiglia" id="id_-1-0-capo_famiglia">',
230.             html=True
231.         )
232.         self.assertContains(
233.             response,
234.             '<input id="id_-1-0-name" type="text" class="vTextField" name="-1-0-name" maxlength="100">',
235.             html=True
236.         )
237.         self.assertContains(response, '<input type="hidden" name="-2-0-id" id="id_-2-0-id">', html=True)
238.         self.assertContains(
239.             response,
240.             '<input type="hidden" name="-2-0-capo_famiglia" id="id_-2-0-capo_famiglia">',
241.             html=True
242.         )
243.         self.assertContains(
244.             response,
245.             '<input id="id_-2-0-name" type="text" class="vTextField" name="-2-0-name" maxlength="100">',
246.             html=True
247.         )
248. 
249.     @override_settings(USE_L10N=True, USE_THOUSAND_SEPARATOR=True)
250.     def test_localize_pk_shortcut(self):
251.         """
252.         The "View on Site" link is correct for locales that use thousand
253.         separators.
254.         """
255.         holder = Holder.objects.create(pk=123456789, dummy=42)
256.         inner = Inner.objects.create(pk=987654321, holder=holder, dummy=42, readonly='')
257.         response = self.client.get(reverse('admin:admin_inlines_holder_change', args=(holder.id,)))
258.         inner_shortcut = 'r/%s/%s/' % (ContentType.objects.get_for_model(inner).pk, inner.pk)
259.         self.assertContains(response, inner_shortcut)
260. 
261.     def test_custom_pk_shortcut(self):
262.         """
263.         The "View on Site" link is correct for models with a custom primary key
264.         field.
265.         """
266.         parent = ParentModelWithCustomPk.objects.create(my_own_pk="foo", name="Foo")
267.         child1 = ChildModel1.objects.create(my_own_pk="bar", name="Bar", parent=parent)
268.         child2 = ChildModel2.objects.create(my_own_pk="baz", name="Baz", parent=parent)
269.         response = self.client.get(reverse('admin:admin_inlines_parentmodelwithcustompk_change', args=('foo',)))
270.         child1_shortcut = 'r/%s/%s/' % (ContentType.objects.get_for_model(child1).pk, child1.pk)
271.         child2_shortcut = 'r/%s/%s/' % (ContentType.objects.get_for_model(child2).pk, child2.pk)
272.         self.assertContains(response, child1_shortcut)
273.         self.assertContains(response, child2_shortcut)
274. 
275.     def test_create_inlines_on_inherited_model(self):
276.         """
277.         An object can be created with inlines when it inherits another class.
278.         """
279.         data = {
280.             'name': 'Martian',
281.             'sighting_set-TOTAL_FORMS': 1,
282.             'sighting_set-INITIAL_FORMS': 0,
283.             'sighting_set-MAX_NUM_FORMS': 0,
284.             'sighting_set-0-place': 'Zone 51',
285.             '_save': 'Save',
286.         }
287.         response = self.client.post(reverse('admin:admin_inlines_extraterrestrial_add'), data)
288.         self.assertEqual(response.status_code, 302)
289.         self.assertEqual(Sighting.objects.filter(et__name='Martian').count(), 1)
290. 
291.     def test_custom_get_extra_form(self):
292.         bt_head = BinaryTree.objects.create(name="Tree Head")
293.         BinaryTree.objects.create(name="First Child", parent=bt_head)
294.         # The maximum number of forms should respect 'get_max_num' on the
295.         # ModelAdmin
296.         max_forms_input = (
297.             '<input id="id_binarytree_set-MAX_NUM_FORMS" '
298.             'name="binarytree_set-MAX_NUM_FORMS" type="hidden" value="%d">'
299.         )
300.         # The total number of forms will remain the same in either case
301.         total_forms_hidden = (
302.             '<input id="id_binarytree_set-TOTAL_FORMS" '
303.             'name="binarytree_set-TOTAL_FORMS" type="hidden" value="2">'
304.         )
305.         response = self.client.get(reverse('admin:admin_inlines_binarytree_add'))
306.         self.assertInHTML(max_forms_input % 3, response.rendered_content)
307.         self.assertInHTML(total_forms_hidden, response.rendered_content)
308. 
309.         response = self.client.get(reverse('admin:admin_inlines_binarytree_change', args=(bt_head.id,)))
310.         self.assertInHTML(max_forms_input % 2, response.rendered_content)
311.         self.assertInHTML(total_forms_hidden, response.rendered_content)
312. 
313.     def test_min_num(self):
314.         """
315.         min_num and extra determine number of forms.
316.         """
317.         class MinNumInline(TabularInline):
318.             model = BinaryTree
319.             min_num = 2
320.             extra = 3
321. 
322.         modeladmin = ModelAdmin(BinaryTree, admin_site)
323.         modeladmin.inlines = [MinNumInline]
324.         min_forms = (
325.             '<input id="id_binarytree_set-MIN_NUM_FORMS" '
326.             'name="binarytree_set-MIN_NUM_FORMS" type="hidden" value="2">'
327.         )
328.         total_forms = (
329.             '<input id="id_binarytree_set-TOTAL_FORMS" '
330.             'name="binarytree_set-TOTAL_FORMS" type="hidden" value="5">'
331.         )
332.         request = self.factory.get(reverse('admin:admin_inlines_binarytree_add'))
333.         request.user = User(username='super', is_superuser=True)
334.         response = modeladmin.changeform_view(request)
335.         self.assertInHTML(min_forms, response.rendered_content)
336.         self.assertInHTML(total_forms, response.rendered_content)
337. 
338.     def test_custom_min_num(self):
339.         bt_head = BinaryTree.objects.create(name="Tree Head")
340.         BinaryTree.objects.create(name="First Child", parent=bt_head)
341. 
342.         class MinNumInline(TabularInline):
343.             model = BinaryTree
344.             extra = 3
345. 
346.             def get_min_num(self, request, obj=None, **kwargs):
347.                 if obj:
348.                     return 5
349.                 return 2
350. 
351.         modeladmin = ModelAdmin(BinaryTree, admin_site)
352.         modeladmin.inlines = [MinNumInline]
353.         min_forms = (
354.             '<input id="id_binarytree_set-MIN_NUM_FORMS" '
355.             'name="binarytree_set-MIN_NUM_FORMS" type="hidden" value="%d">'
356.         )
357.         total_forms = (
358.             '<input id="id_binarytree_set-TOTAL_FORMS" '
359.             'name="binarytree_set-TOTAL_FORMS" type="hidden" value="%d">'
360.         )
361.         request = self.factory.get(reverse('admin:admin_inlines_binarytree_add'))
362.         request.user = User(username='super', is_superuser=True)
363.         response = modeladmin.changeform_view(request)
364.         self.assertInHTML(min_forms % 2, response.rendered_content)
365.         self.assertInHTML(total_forms % 5, response.rendered_content)
366. 
367.         request = self.factory.get(reverse('admin:admin_inlines_binarytree_change', args=(bt_head.id,)))
368.         request.user = User(username='super', is_superuser=True)
369.         response = modeladmin.changeform_view(request, object_id=str(bt_head.id))
370.         self.assertInHTML(min_forms % 5, response.rendered_content)
371.         self.assertInHTML(total_forms % 8, response.rendered_content)
372. 
373.     def test_inline_nonauto_noneditable_pk(self):
374.         response = self.client.get(reverse('admin:admin_inlines_author_add'))
375.         self.assertContains(
376.             response,
377.             '<input id="id_nonautopkbook_set-0-rand_pk" '
378.             'name="nonautopkbook_set-0-rand_pk" type="hidden">',
379.             html=True
380.         )
381.         self.assertContains(
382.             response,
383.             '<input id="id_nonautopkbook_set-2-0-rand_pk" '
384.             'name="nonautopkbook_set-2-0-rand_pk" type="hidden">',
385.             html=True
386.         )
387. 
388.     def test_inline_nonauto_noneditable_inherited_pk(self):
389.         response = self.client.get(reverse('admin:admin_inlines_author_add'))
390.         self.assertContains(
391.             response,
392.             '<input id="id_nonautopkbookchild_set-0-nonautopkbook_ptr" '
393.             'name="nonautopkbookchild_set-0-nonautopkbook_ptr" type="hidden">',
394.             html=True
395.         )
396.         self.assertContains(
397.             response,
398.             '<input id="id_nonautopkbookchild_set-2-nonautopkbook_ptr" '
399.             'name="nonautopkbookchild_set-2-nonautopkbook_ptr" type="hidden">',
400.             html=True
401.         )
402. 
403.     def test_inline_editable_pk(self):
404.         response = self.client.get(reverse('admin:admin_inlines_author_add'))
405.         self.assertContains(
406.             response,
407.             '<input class="vIntegerField" id="id_editablepkbook_set-0-manual_pk" '
408.             'name="editablepkbook_set-0-manual_pk" type="number">',
409.             html=True, count=1
410.         )
411.         self.assertContains(
412.             response,
413.             '<input class="vIntegerField" id="id_editablepkbook_set-2-0-manual_pk" '
414.             'name="editablepkbook_set-2-0-manual_pk" type="number">',
415.             html=True, count=1
416.         )
417. 
418.     def test_stacked_inline_edit_form_contains_has_original_class(self):
419.         holder = Holder.objects.create(dummy=1)
420.         holder.inner_set.create(dummy=1)
421.         response = self.client.get(reverse('admin:admin_inlines_holder_change', args=(holder.pk,)))
422.         self.assertContains(
423.             response,
424.             '<div class="inline-related has_original" id="inner_set-0">',
425.             count=1
426.         )
427.         self.assertContains(
428.             response,
429.             '<div class="inline-related" id="inner_set-1">',
430.             count=1
431.         )
432. 
433.     def test_inlines_show_change_link_registered(self):
434.         "Inlines `show_change_link` for registered models when enabled."
435.         holder = Holder4.objects.create(dummy=1)
436.         item1 = Inner4Stacked.objects.create(dummy=1, holder=holder)
437.         item2 = Inner4Tabular.objects.create(dummy=1, holder=holder)
438.         items = (
439.             ('inner4stacked', item1.pk),
440.             ('inner4tabular', item2.pk),
441.         )
442.         response = self.client.get(reverse('admin:admin_inlines_holder4_change', args=(holder.pk,)))
443.         self.assertTrue(response.context['inline_admin_formset'].opts.has_registered_model)
444.         for model, pk in items:
445.             url = reverse('admin:admin_inlines_%s_change' % model, args=(pk,))
446.             self.assertContains(response, '<a href="%s" %s' % (url, INLINE_CHANGELINK_HTML))
447. 
448.     def test_inlines_show_change_link_unregistered(self):
449.         "Inlines `show_change_link` disabled for unregistered models."
450.         parent = ParentModelWithCustomPk.objects.create(my_own_pk="foo", name="Foo")
451.         ChildModel1.objects.create(my_own_pk="bar", name="Bar", parent=parent)
452.         ChildModel2.objects.create(my_own_pk="baz", name="Baz", parent=parent)
453.         response = self.client.get(reverse('admin:admin_inlines_parentmodelwithcustompk_change', args=('foo',)))
454.         self.assertFalse(response.context['inline_admin_formset'].opts.has_registered_model)
455.         self.assertNotContains(response, INLINE_CHANGELINK_HTML)
456. 
457.     def test_tabular_inline_show_change_link_false_registered(self):
458.         "Inlines `show_change_link` disabled by default."
459.         poll = Poll.objects.create(name="New poll")
460.         Question.objects.create(poll=poll)
461.         response = self.client.get(reverse('admin:admin_inlines_poll_change', args=(poll.pk,)))
462.         self.assertTrue(response.context['inline_admin_formset'].opts.has_registered_model)
463.         self.assertNotContains(response, INLINE_CHANGELINK_HTML)
464. 
465.     def test_noneditable_inline_has_field_inputs(self):
466.         """Inlines without change permission shows field inputs on add form."""
467.         response = self.client.get(reverse('admin:admin_inlines_novelreadonlychapter_add'))
468.         self.assertContains(
469.             response,
470.             '<input type="text" name="chapter_set-0-name" '
471.             'class="vTextField" maxlength="40" id="id_chapter_set-0-name">',
472.             html=True
473.         )
474. 
475. 
476. @override_settings(ROOT_URLCONF='admin_inlines.urls')
477. class TestInlineMedia(TestDataMixin, TestCase):
478. 
479.     def setUp(self):
480.         self.client.force_login(self.superuser)
481. 
482.     def test_inline_media_only_base(self):
483.         holder = Holder(dummy=13)
484.         holder.save()
485.         Inner(dummy=42, holder=holder).save()
486.         change_url = reverse('admin:admin_inlines_holder_change', args=(holder.id,))
487.         response = self.client.get(change_url)
488.         self.assertContains(response, 'my_awesome_admin_scripts.js')
489. 
490.     def test_inline_media_only_inline(self):
491.         holder = Holder3(dummy=13)
492.         holder.save()
493.         Inner3(dummy=42, holder=holder).save()
494.         change_url = reverse('admin:admin_inlines_holder3_change', args=(holder.id,))
495.         response = self.client.get(change_url)
496.         self.assertEqual(
497.             response.context['inline_admin_formsets'][0].media._js,
498.             [
499.                 'admin/js/vendor/jquery/jquery.min.js',
500.                 'my_awesome_inline_scripts.js',
501.                 'custom_number.js',
502.                 'admin/js/jquery.init.js',
503.                 'admin/js/inlines.min.js',
504.             ]
505.         )
506.         self.assertContains(response, 'my_awesome_inline_scripts.js')
507. 
508.     def test_all_inline_media(self):
509.         holder = Holder2(dummy=13)
510.         holder.save()
511.         Inner2(dummy=42, holder=holder).save()
512.         change_url = reverse('admin:admin_inlines_holder2_change', args=(holder.id,))
513.         response = self.client.get(change_url)
514.         self.assertContains(response, 'my_awesome_admin_scripts.js')
515.         self.assertContains(response, 'my_awesome_inline_scripts.js')
516. 
517. 
518. @override_settings(ROOT_URLCONF='admin_inlines.urls')
519. class TestInlineAdminForm(TestCase):
520. 
521.     def test_immutable_content_type(self):

File: tests/admin_views/tests.py
Line number range: 1 - 101
Content:
1. import datetime
2. import os
3. import re
4. import unittest
5. from unittest import mock
6. from urllib.parse import parse_qsl, urljoin, urlparse
7. 
8. import pytz
9. 
10. from django.contrib.admin import AdminSite, ModelAdmin
11. from django.contrib.admin.helpers import ACTION_CHECKBOX_NAME
12. from django.contrib.admin.models import ADDITION, DELETION, LogEntry
13. from django.contrib.admin.options import TO_FIELD_VAR
14. from django.contrib.admin.templatetags.admin_urls import add_preserved_filters
15. from django.contrib.admin.tests import AdminSeleniumTestCase
16. from django.contrib.admin.utils import quote
17. from django.contrib.admin.views.main import IS_POPUP_VAR
18. from django.contrib.auth import REDIRECT_FIELD_NAME, get_permission_codename
19. from django.contrib.auth.models import Group, Permission, User
20. from django.contrib.contenttypes.models import ContentType
21. from django.core import mail
22. from django.core.checks import Error
23. from django.core.files import temp as tempfile
24. from django.forms.utils import ErrorList
25. from django.template.response import TemplateResponse
26. from django.test import (
27.     TestCase, modify_settings, override_settings, skipUnlessDBFeature,
28. )
29. from django.test.utils import override_script_prefix
30. from django.urls import NoReverseMatch, resolve, reverse
31. from django.utils import formats, translation
32. from django.utils.cache import get_max_age
33. from django.utils.encoding import iri_to_uri
34. from django.utils.html import escape
35. from django.utils.http import urlencode
36. 
37. from . import customadmin
38. from .admin import CityAdmin, site, site2
39. from .models import (
40.     Actor, AdminOrderedAdminMethod, AdminOrderedCallable, AdminOrderedField,
41.     AdminOrderedModelMethod, Answer, Answer2, Article, BarAccount, Book,
42.     Bookmark, Category, Chapter, ChapterXtra1, ChapterXtra2, Character, Child,
43.     Choice, City, Collector, Color, ComplexSortedPerson, CoverLetter,
44.     CustomArticle, CyclicOne, CyclicTwo, DooHickey, Employee, EmptyModel,
45.     Fabric, FancyDoodad, FieldOverridePost, FilteredManager, FooAccount,
46.     FoodDelivery, FunkyTag, Gallery, Grommet, Inquisition, Language, Link,
47.     MainPrepopulated, Media, ModelWithStringPrimaryKey, OtherStory, Paper,
48.     Parent, ParentWithDependentChildren, ParentWithUUIDPK, Person, Persona,
49.     Picture, Pizza, Plot, PlotDetails, PluggableSearchPerson, Podcast, Post,
50.     PrePopulatedPost, Promo, Question, ReadablePizza, ReadOnlyPizza,
51.     Recommendation, Recommender, RelatedPrepopulated, RelatedWithUUIDPKModel,
52.     Report, Restaurant, RowLevelChangePermissionModel, SecretHideout, Section,
53.     ShortMessage, Simple, State, Story, SuperSecretHideout, SuperVillain,
54.     Telegram, TitleTranslation, Topping, UnchangeableObject, UndeletableObject,
55.     UnorderedObject, UserProxy, Villain, Vodcast, Whatsit, Widget, Worker,
56.     WorkHour,
57. )
58. 
59. ERROR_MESSAGE = "Please enter the correct username and password \
60. for a staff account. Note that both fields may be case-sensitive."
61. 
62. MULTIPART_ENCTYPE = 'enctype="multipart/form-data"'
63. 
64. 
65. class AdminFieldExtractionMixin:
66.     """
67.     Helper methods for extracting data from AdminForm.
68.     """
69.     def get_admin_form_fields(self, response):
70.         """
71.         Return a list of AdminFields for the AdminForm in the response.
72.         """
73.         fields = []
74.         for fieldset in response.context['adminform']:
75.             for field_line in fieldset:
76.                 fields.extend(field_line)
77.         return fields
78. 
79.     def get_admin_readonly_fields(self, response):
80.         """
81.         Return the readonly fields for the response's AdminForm.
82.         """
83.         return [f for f in self.get_admin_form_fields(response) if f.is_readonly]
84. 
85.     def get_admin_readonly_field(self, response, field_name):
86.         """
87.         Return the readonly field for the given field_name.
88.         """
89.         admin_readonly_fields = self.get_admin_readonly_fields(response)
90.         for field in admin_readonly_fields:
91.             if field.field['name'] == field_name:
92.                 return field
93. 
94. 
95. @override_settings(ROOT_URLCONF='admin_views.urls', USE_I18N=True, USE_L10N=False, LANGUAGE_CODE='en')
96. class AdminViewBasicTestCase(TestCase):
97. 
98.     @classmethod
99.     def setUpTestData(cls):
100.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
101.         cls.s1 = Section.objects.create(name='Test section')

File: tests/admin_views/tests.py
Line number range: 6094 - 6224
Content:
6094. @override_settings(ROOT_URLCONF='admin_views.urls')
6095. class AdminViewOnSiteTests(TestCase):
6096. 
6097.     @classmethod
6098.     def setUpTestData(cls):
6099.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
6100. 
6101.         cls.s1 = State.objects.create(name='New York')
6102.         cls.s2 = State.objects.create(name='Illinois')
6103.         cls.s3 = State.objects.create(name='California')
6104.         cls.c1 = City.objects.create(state=cls.s1, name='New York')
6105.         cls.c2 = City.objects.create(state=cls.s2, name='Chicago')
6106.         cls.c3 = City.objects.create(state=cls.s3, name='San Francisco')
6107.         cls.r1 = Restaurant.objects.create(city=cls.c1, name='Italian Pizza')
6108.         cls.r2 = Restaurant.objects.create(city=cls.c1, name='Boulevard')
6109.         cls.r3 = Restaurant.objects.create(city=cls.c2, name='Chinese Dinner')
6110.         cls.r4 = Restaurant.objects.create(city=cls.c2, name='Angels')
6111.         cls.r5 = Restaurant.objects.create(city=cls.c2, name='Take Away')
6112.         cls.r6 = Restaurant.objects.create(city=cls.c3, name='The Unknown Restaurant')
6113.         cls.w1 = Worker.objects.create(work_at=cls.r1, name='Mario', surname='Rossi')
6114.         cls.w2 = Worker.objects.create(work_at=cls.r1, name='Antonio', surname='Bianchi')
6115.         cls.w3 = Worker.objects.create(work_at=cls.r1, name='John', surname='Doe')
6116. 
6117.     def setUp(self):
6118.         self.client.force_login(self.superuser)
6119. 
6120.     def test_add_view_form_and_formsets_run_validation(self):
6121.         """
6122.         Issue #20522
6123.         Verifying that if the parent form fails validation, the inlines also
6124.         run validation even if validation is contingent on parent form data.
6125.         Also, assertFormError() and assertFormsetError() is usable for admin
6126.         forms and formsets.
6127.         """
6128.         # The form validation should fail because 'some_required_info' is
6129.         # not included on the parent form, and the family_name of the parent
6130.         # does not match that of the child
6131.         post_data = {
6132.             'family_name': 'Test1',
6133.             'dependentchild_set-TOTAL_FORMS': '1',
6134.             'dependentchild_set-INITIAL_FORMS': '0',
6135.             'dependentchild_set-MAX_NUM_FORMS': '1',
6136.             'dependentchild_set-0-id': '',
6137.             'dependentchild_set-0-parent': '',
6138.             'dependentchild_set-0-family_name': 'Test2',
6139.         }
6140.         response = self.client.post(reverse('admin:admin_views_parentwithdependentchildren_add'), post_data)
6141.         self.assertFormError(response, 'adminform', 'some_required_info', ['This field is required.'])
6142.         msg = "The form 'adminform' in context 0 does not contain the non-field error 'Error'"
6143.         with self.assertRaisesMessage(AssertionError, msg):
6144.             self.assertFormError(response, 'adminform', None, ['Error'])
6145.         self.assertFormsetError(
6146.             response, 'inline_admin_formset', 0, None,
6147.             ['Children must share a family name with their parents in this contrived test case']
6148.         )
6149.         msg = "The formset 'inline_admin_formset' in context 10 does not contain any non-form errors."
6150.         with self.assertRaisesMessage(AssertionError, msg):
6151.             self.assertFormsetError(response, 'inline_admin_formset', None, None, ['Error'])
6152. 
6153.     def test_change_view_form_and_formsets_run_validation(self):
6154.         """
6155.         Issue #20522
6156.         Verifying that if the parent form fails validation, the inlines also
6157.         run validation even if validation is contingent on parent form data
6158.         """
6159.         pwdc = ParentWithDependentChildren.objects.create(some_required_info=6, family_name='Test1')
6160.         # The form validation should fail because 'some_required_info' is
6161.         # not included on the parent form, and the family_name of the parent
6162.         # does not match that of the child
6163.         post_data = {
6164.             'family_name': 'Test2',
6165.             'dependentchild_set-TOTAL_FORMS': '1',
6166.             'dependentchild_set-INITIAL_FORMS': '0',
6167.             'dependentchild_set-MAX_NUM_FORMS': '1',
6168.             'dependentchild_set-0-id': '',
6169.             'dependentchild_set-0-parent': str(pwdc.id),
6170.             'dependentchild_set-0-family_name': 'Test1',
6171.         }
6172.         response = self.client.post(
6173.             reverse('admin:admin_views_parentwithdependentchildren_change', args=(pwdc.id,)), post_data
6174.         )
6175.         self.assertFormError(response, 'adminform', 'some_required_info', ['This field is required.'])
6176.         self.assertFormsetError(
6177.             response, 'inline_admin_formset', 0, None,
6178.             ['Children must share a family name with their parents in this contrived test case']
6179.         )
6180. 
6181.     def test_check(self):
6182.         "The view_on_site value is either a boolean or a callable"
6183.         try:
6184.             admin = CityAdmin(City, AdminSite())
6185.             CityAdmin.view_on_site = True
6186.             self.assertEqual(admin.check(), [])
6187.             CityAdmin.view_on_site = False
6188.             self.assertEqual(admin.check(), [])
6189.             CityAdmin.view_on_site = lambda obj: obj.get_absolute_url()
6190.             self.assertEqual(admin.check(), [])
6191.             CityAdmin.view_on_site = []
6192.             self.assertEqual(admin.check(), [
6193.                 Error(
6194.                     "The value of 'view_on_site' must be a callable or a boolean value.",
6195.                     obj=CityAdmin,
6196.                     id='admin.E025',
6197.                 ),
6198.             ])
6199.         finally:
6200.             # Restore the original values for the benefit of other tests.
6201.             CityAdmin.view_on_site = True
6202. 
6203.     def test_false(self):
6204.         "The 'View on site' button is not displayed if view_on_site is False"
6205.         response = self.client.get(reverse('admin:admin_views_restaurant_change', args=(self.r1.pk,)))
6206.         content_type_pk = ContentType.objects.get_for_model(Restaurant).pk
6207.         self.assertNotContains(response, reverse('admin:view_on_site', args=(content_type_pk, 1)))
6208. 
6209.     def test_true(self):
6210.         "The default behavior is followed if view_on_site is True"
6211.         response = self.client.get(reverse('admin:admin_views_city_change', args=(self.c1.pk,)))
6212.         content_type_pk = ContentType.objects.get_for_model(City).pk
6213.         self.assertContains(response, reverse('admin:view_on_site', args=(content_type_pk, self.c1.pk)))
6214. 
6215.     def test_callable(self):
6216.         "The right link is displayed if view_on_site is a callable"
6217.         response = self.client.get(reverse('admin:admin_views_worker_change', args=(self.w1.pk,)))
6218.         self.assertContains(response, '"/worker/%s/%s/"' % (self.w1.surname, self.w1.name))
6219. 
6220.     def test_missing_get_absolute_url(self):
6221.         "None is returned if model doesn't have get_absolute_url"
6222.         model_admin = ModelAdmin(Worker, None)
6223.         self.assertIsNone(model_admin.get_view_on_site_url(Worker()))

File: tests/admin_views/tests.py
Line number range: 188 - 995
Content:
188. class AdminViewBasicTest(AdminViewBasicTestCase):
189.     def test_trailing_slash_required(self):
190.         """
191.         If you leave off the trailing slash, app should redirect and add it.
192.         """
193.         add_url = reverse('admin:admin_views_article_add')
194.         response = self.client.get(add_url[:-1])
195.         self.assertRedirects(response, add_url, status_code=301)
196. 
197.     def test_basic_add_GET(self):
198.         """
199.         A smoke test to ensure GET on the add_view works.
200.         """
201.         response = self.client.get(reverse('admin:admin_views_section_add'))
202.         self.assertIsInstance(response, TemplateResponse)
203.         self.assertEqual(response.status_code, 200)
204. 
205.     def test_add_with_GET_args(self):
206.         response = self.client.get(reverse('admin:admin_views_section_add'), {'name': 'My Section'})
207.         self.assertContains(
208.             response, 'value="My Section"',
209.             msg_prefix="Couldn't find an input with the right value in the response"
210.         )
211. 
212.     def test_basic_edit_GET(self):
213.         """
214.         A smoke test to ensure GET on the change_view works.
215.         """
216.         response = self.client.get(reverse('admin:admin_views_section_change', args=(self.s1.pk,)))
217.         self.assertIsInstance(response, TemplateResponse)
218.         self.assertEqual(response.status_code, 200)
219. 
220.     def test_basic_edit_GET_string_PK(self):
221.         """
222.         GET on the change_view (when passing a string as the PK argument for a
223.         model with an integer PK field) redirects to the index page with a
224.         message saying the object doesn't exist.
225.         """
226.         response = self.client.get(reverse('admin:admin_views_section_change', args=(quote("abc/<b>"),)), follow=True)
227.         self.assertRedirects(response, reverse('admin:index'))
228.         self.assertEqual(
229.             [m.message for m in response.context['messages']],
230.             ["""section with ID "abc/<b>" doesn't exist. Perhaps it was deleted?"""]
231.         )
232. 
233.     def test_basic_edit_GET_old_url_redirect(self):
234.         """
235.         The change URL changed in Django 1.9, but the old one still redirects.
236.         """
237.         response = self.client.get(
238.             reverse('admin:admin_views_section_change', args=(self.s1.pk,)).replace('change/', '')
239.         )
240.         self.assertRedirects(response, reverse('admin:admin_views_section_change', args=(self.s1.pk,)))
241. 
242.     def test_basic_inheritance_GET_string_PK(self):
243.         """
244.         GET on the change_view (for inherited models) redirects to the index
245.         page with a message saying the object doesn't exist.
246.         """
247.         response = self.client.get(reverse('admin:admin_views_supervillain_change', args=('abc',)), follow=True)
248.         self.assertRedirects(response, reverse('admin:index'))
249.         self.assertEqual(
250.             [m.message for m in response.context['messages']],
251.             ["""super villain with ID "abc" doesn't exist. Perhaps it was deleted?"""]
252.         )
253. 
254.     def test_basic_add_POST(self):
255.         """
256.         A smoke test to ensure POST on add_view works.
257.         """
258.         post_data = {
259.             "name": "Another Section",
260.             # inline data
261.             "article_set-TOTAL_FORMS": "3",
262.             "article_set-INITIAL_FORMS": "0",
263.             "article_set-MAX_NUM_FORMS": "0",
264.         }
265.         response = self.client.post(reverse('admin:admin_views_section_add'), post_data)
266.         self.assertEqual(response.status_code, 302)  # redirect somewhere
267. 
268.     def test_popup_add_POST(self):
269.         """
270.         Ensure http response from a popup is properly escaped.
271.         """
272.         post_data = {
273.             '_popup': '1',
274.             'title': 'title with a new\nline',
275.             'content': 'some content',
276.             'date_0': '2010-09-10',
277.             'date_1': '14:55:39',
278.         }
279.         response = self.client.post(reverse('admin:admin_views_article_add'), post_data)
280.         self.assertContains(response, 'title with a new\\nline')
281. 
282.     def test_basic_edit_POST(self):
283.         """
284.         A smoke test to ensure POST on edit_view works.
285.         """
286.         url = reverse('admin:admin_views_section_change', args=(self.s1.pk,))
287.         response = self.client.post(url, self.inline_post_data)
288.         self.assertEqual(response.status_code, 302)  # redirect somewhere
289. 
290.     def test_edit_save_as(self):
291.         """
292.         Test "save as".
293.         """
294.         post_data = self.inline_post_data.copy()
295.         post_data.update({
296.             '_saveasnew': 'Save+as+new',
297.             "article_set-1-section": "1",
298.             "article_set-2-section": "1",
299.             "article_set-3-section": "1",
300.             "article_set-4-section": "1",
301.             "article_set-5-section": "1",
302.         })
303.         response = self.client.post(reverse('admin:admin_views_section_change', args=(self.s1.pk,)), post_data)
304.         self.assertEqual(response.status_code, 302)  # redirect somewhere
305. 
306.     def test_edit_save_as_delete_inline(self):
307.         """
308.         Should be able to "Save as new" while also deleting an inline.
309.         """
310.         post_data = self.inline_post_data.copy()
311.         post_data.update({
312.             '_saveasnew': 'Save+as+new',
313.             "article_set-1-section": "1",
314.             "article_set-2-section": "1",
315.             "article_set-2-DELETE": "1",
316.             "article_set-3-section": "1",
317.         })
318.         response = self.client.post(reverse('admin:admin_views_section_change', args=(self.s1.pk,)), post_data)
319.         self.assertEqual(response.status_code, 302)
320.         # started with 3 articles, one was deleted.
321.         self.assertEqual(Section.objects.latest('id').article_set.count(), 2)
322. 
323.     def test_change_list_column_field_classes(self):
324.         response = self.client.get(reverse('admin:admin_views_article_changelist'))
325.         # callables display the callable name.
326.         self.assertContains(response, 'column-callable_year')
327.         self.assertContains(response, 'field-callable_year')
328.         # lambdas display as "lambda" + index that they appear in list_display.
329.         self.assertContains(response, 'column-lambda8')
330.         self.assertContains(response, 'field-lambda8')
331. 
332.     def test_change_list_sorting_callable(self):
333.         """
334.         Ensure we can sort on a list_display field that is a callable
335.         (column 2 is callable_year in ArticleAdmin)
336.         """
337.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': 2})
338.         self.assertContentBefore(
339.             response, 'Oldest content', 'Middle content',
340.             "Results of sorting on callable are out of order."
341.         )
342.         self.assertContentBefore(
343.             response, 'Middle content', 'Newest content',
344.             "Results of sorting on callable are out of order."
345.         )
346. 
347.     def test_change_list_sorting_property(self):
348.         """
349.         Sort on a list_display field that is a property (column 10 is
350.         a property in Article model).
351.         """
352.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': 10})
353.         self.assertContentBefore(
354.             response,
355.             'Oldest content',
356.             'Middle content',
357.             'Results of sorting on property are out of order.',
358.         )
359.         self.assertContentBefore(
360.             response,
361.             'Middle content',
362.             'Newest content',
363.             'Results of sorting on property are out of order.',
364.         )
365. 
366.     def test_change_list_sorting_callable_query_expression(self):
367.         """
368.         Query expressions may be used for admin_order_field. (column 9 is
369.         order_by_expression in ArticleAdmin).
370.         """
371.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': '9'})
372.         self.assertContentBefore(
373.             response, 'Oldest content', 'Middle content',
374.             'Results of sorting on callable are out of order.'
375.         )
376.         self.assertContentBefore(
377.             response, 'Middle content', 'Newest content',
378.             'Results of sorting on callable are out of order.'
379.         )
380. 
381.     def test_change_list_sorting_callable_query_expression_reverse(self):
382.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': '-9'})
383.         self.assertContentBefore(
384.             response, 'Middle content', 'Oldest content',
385.             'Results of sorting on callable are out of order.'
386.         )
387.         self.assertContentBefore(
388.             response, 'Newest content', 'Middle content',
389.             'Results of sorting on callable are out of order.'
390.         )
391. 
392.     def test_change_list_sorting_model(self):
393.         """
394.         Ensure we can sort on a list_display field that is a Model method
395.         (column 3 is 'model_year' in ArticleAdmin)
396.         """
397.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': '-3'})
398.         self.assertContentBefore(
399.             response, 'Newest content', 'Middle content',
400.             "Results of sorting on Model method are out of order."
401.         )
402.         self.assertContentBefore(
403.             response, 'Middle content', 'Oldest content',
404.             "Results of sorting on Model method are out of order."
405.         )
406. 
407.     def test_change_list_sorting_model_admin(self):
408.         """
409.         Ensure we can sort on a list_display field that is a ModelAdmin method
410.         (column 4 is 'modeladmin_year' in ArticleAdmin)
411.         """
412.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': '4'})
413.         self.assertContentBefore(
414.             response, 'Oldest content', 'Middle content',
415.             "Results of sorting on ModelAdmin method are out of order."
416.         )
417.         self.assertContentBefore(
418.             response, 'Middle content', 'Newest content',
419.             "Results of sorting on ModelAdmin method are out of order."
420.         )
421. 
422.     def test_change_list_sorting_model_admin_reverse(self):
423.         """
424.         Ensure we can sort on a list_display field that is a ModelAdmin
425.         method in reverse order (i.e. admin_order_field uses the '-' prefix)
426.         (column 6 is 'model_year_reverse' in ArticleAdmin)
427.         """
428.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': '6'})
429.         self.assertContentBefore(
430.             response, '2009', '2008',
431.             "Results of sorting on ModelAdmin method are out of order."
432.         )
433.         self.assertContentBefore(
434.             response, '2008', '2000',
435.             "Results of sorting on ModelAdmin method are out of order."
436.         )
437.         # Let's make sure the ordering is right and that we don't get a
438.         # FieldError when we change to descending order
439.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': '-6'})
440.         self.assertContentBefore(
441.             response, '2000', '2008',
442.             "Results of sorting on ModelAdmin method are out of order."
443.         )
444.         self.assertContentBefore(
445.             response, '2008', '2009',
446.             "Results of sorting on ModelAdmin method are out of order."
447.         )
448. 
449.     def test_change_list_sorting_multiple(self):
450.         p1 = Person.objects.create(name="Chris", gender=1, alive=True)
451.         p2 = Person.objects.create(name="Chris", gender=2, alive=True)
452.         p3 = Person.objects.create(name="Bob", gender=1, alive=True)
453.         link1 = reverse('admin:admin_views_person_change', args=(p1.pk,))
454.         link2 = reverse('admin:admin_views_person_change', args=(p2.pk,))
455.         link3 = reverse('admin:admin_views_person_change', args=(p3.pk,))
456. 
457.         # Sort by name, gender
458.         response = self.client.get(reverse('admin:admin_views_person_changelist'), {'o': '1.2'})
459.         self.assertContentBefore(response, link3, link1)
460.         self.assertContentBefore(response, link1, link2)
461. 
462.         # Sort by gender descending, name
463.         response = self.client.get(reverse('admin:admin_views_person_changelist'), {'o': '-2.1'})
464.         self.assertContentBefore(response, link2, link3)
465.         self.assertContentBefore(response, link3, link1)
466. 
467.     def test_change_list_sorting_preserve_queryset_ordering(self):
468.         """
469.         If no ordering is defined in `ModelAdmin.ordering` or in the query
470.         string, then the underlying order of the queryset should not be
471.         changed, even if it is defined in `Modeladmin.get_queryset()`.
472.         Refs #11868, #7309.
473.         """
474.         p1 = Person.objects.create(name="Amy", gender=1, alive=True, age=80)
475.         p2 = Person.objects.create(name="Bob", gender=1, alive=True, age=70)
476.         p3 = Person.objects.create(name="Chris", gender=2, alive=False, age=60)
477.         link1 = reverse('admin:admin_views_person_change', args=(p1.pk,))
478.         link2 = reverse('admin:admin_views_person_change', args=(p2.pk,))
479.         link3 = reverse('admin:admin_views_person_change', args=(p3.pk,))
480. 
481.         response = self.client.get(reverse('admin:admin_views_person_changelist'), {})
482.         self.assertContentBefore(response, link3, link2)
483.         self.assertContentBefore(response, link2, link1)
484. 
485.     def test_change_list_sorting_model_meta(self):
486.         # Test ordering on Model Meta is respected
487. 
488.         l1 = Language.objects.create(iso='ur', name='Urdu')
489.         l2 = Language.objects.create(iso='ar', name='Arabic')
490.         link1 = reverse('admin:admin_views_language_change', args=(quote(l1.pk),))
491.         link2 = reverse('admin:admin_views_language_change', args=(quote(l2.pk),))
492. 
493.         response = self.client.get(reverse('admin:admin_views_language_changelist'), {})
494.         self.assertContentBefore(response, link2, link1)
495. 
496.         # Test we can override with query string
497.         response = self.client.get(reverse('admin:admin_views_language_changelist'), {'o': '-1'})
498.         self.assertContentBefore(response, link1, link2)
499. 
500.     def test_change_list_sorting_override_model_admin(self):
501.         # Test ordering on Model Admin is respected, and overrides Model Meta
502.         dt = datetime.datetime.now()
503.         p1 = Podcast.objects.create(name="A", release_date=dt)
504.         p2 = Podcast.objects.create(name="B", release_date=dt - datetime.timedelta(10))
505.         link1 = reverse('admin:admin_views_podcast_change', args=(p1.pk,))
506.         link2 = reverse('admin:admin_views_podcast_change', args=(p2.pk,))
507. 
508.         response = self.client.get(reverse('admin:admin_views_podcast_changelist'), {})
509.         self.assertContentBefore(response, link1, link2)
510. 
511.     def test_multiple_sort_same_field(self):
512.         # The changelist displays the correct columns if two columns correspond
513.         # to the same ordering field.
514.         dt = datetime.datetime.now()
515.         p1 = Podcast.objects.create(name="A", release_date=dt)
516.         p2 = Podcast.objects.create(name="B", release_date=dt - datetime.timedelta(10))
517.         link1 = reverse('admin:admin_views_podcast_change', args=(quote(p1.pk),))
518.         link2 = reverse('admin:admin_views_podcast_change', args=(quote(p2.pk),))
519. 
520.         response = self.client.get(reverse('admin:admin_views_podcast_changelist'), {})
521.         self.assertContentBefore(response, link1, link2)
522. 
523.         p1 = ComplexSortedPerson.objects.create(name="Bob", age=10)
524.         p2 = ComplexSortedPerson.objects.create(name="Amy", age=20)
525.         link1 = reverse('admin:admin_views_complexsortedperson_change', args=(p1.pk,))
526.         link2 = reverse('admin:admin_views_complexsortedperson_change', args=(p2.pk,))
527. 
528.         response = self.client.get(reverse('admin:admin_views_complexsortedperson_changelist'), {})
529.         # Should have 5 columns (including action checkbox col)
530.         self.assertContains(response, '<th scope="col"', count=5)
531. 
532.         self.assertContains(response, 'Name')
533.         self.assertContains(response, 'Colored name')
534. 
535.         # Check order
536.         self.assertContentBefore(response, 'Name', 'Colored name')
537. 
538.         # Check sorting - should be by name
539.         self.assertContentBefore(response, link2, link1)
540. 
541.     def test_sort_indicators_admin_order(self):
542.         """
543.         The admin shows default sort indicators for all kinds of 'ordering'
544.         fields: field names, method on the model admin and model itself, and
545.         other callables. See #17252.
546.         """
547.         models = [(AdminOrderedField, 'adminorderedfield'),
548.                   (AdminOrderedModelMethod, 'adminorderedmodelmethod'),
549.                   (AdminOrderedAdminMethod, 'adminorderedadminmethod'),
550.                   (AdminOrderedCallable, 'adminorderedcallable')]
551.         for model, url in models:
552.             model.objects.create(stuff='The Last Item', order=3)
553.             model.objects.create(stuff='The First Item', order=1)
554.             model.objects.create(stuff='The Middle Item', order=2)
555.             response = self.client.get(reverse('admin:admin_views_%s_changelist' % url), {})
556.             self.assertEqual(response.status_code, 200)
557.             # Should have 3 columns including action checkbox col.
558.             self.assertContains(response, '<th scope="col"', count=3, msg_prefix=url)
559.             # Check if the correct column was selected. 2 is the index of the
560.             # 'order' column in the model admin's 'list_display' with 0 being
561.             # the implicit 'action_checkbox' and 1 being the column 'stuff'.
562.             self.assertEqual(response.context['cl'].get_ordering_field_columns(), {2: 'asc'})
563.             # Check order of records.
564.             self.assertContentBefore(response, 'The First Item', 'The Middle Item')
565.             self.assertContentBefore(response, 'The Middle Item', 'The Last Item')
566. 
567.     def test_has_related_field_in_list_display_fk(self):
568.         """Joins shouldn't be performed for <FK>_id fields in list display."""
569.         state = State.objects.create(name='Karnataka')
570.         City.objects.create(state=state, name='Bangalore')
571.         response = self.client.get(reverse('admin:admin_views_city_changelist'), {})
572. 
573.         response.context['cl'].list_display = ['id', 'name', 'state']
574.         self.assertIs(response.context['cl'].has_related_field_in_list_display(), True)
575. 
576.         response.context['cl'].list_display = ['id', 'name', 'state_id']
577.         self.assertIs(response.context['cl'].has_related_field_in_list_display(), False)
578. 
579.     def test_has_related_field_in_list_display_o2o(self):
580.         """Joins shouldn't be performed for <O2O>_id fields in list display."""
581.         media = Media.objects.create(name='Foo')
582.         Vodcast.objects.create(media=media)
583.         response = self.client.get(reverse('admin:admin_views_vodcast_changelist'), {})
584. 
585.         response.context['cl'].list_display = ['media']
586.         self.assertIs(response.context['cl'].has_related_field_in_list_display(), True)
587. 
588.         response.context['cl'].list_display = ['media_id']
589.         self.assertIs(response.context['cl'].has_related_field_in_list_display(), False)
590. 
591.     def test_limited_filter(self):
592.         """Ensure admin changelist filters do not contain objects excluded via limit_choices_to.
593.         This also tests relation-spanning filters (e.g. 'color__value').
594.         """
595.         response = self.client.get(reverse('admin:admin_views_thing_changelist'))
596.         self.assertContains(
597.             response, '<div id="changelist-filter">',
598.             msg_prefix="Expected filter not found in changelist view"
599.         )
600.         self.assertNotContains(
601.             response, '<a href="?color__id__exact=3">Blue</a>',
602.             msg_prefix="Changelist filter not correctly limited by limit_choices_to"
603.         )
604. 
605.     def test_relation_spanning_filters(self):
606.         changelist_url = reverse('admin:admin_views_chapterxtra1_changelist')
607.         response = self.client.get(changelist_url)
608.         self.assertContains(response, '<div id="changelist-filter">')
609.         filters = {
610.             'chap__id__exact': {
611.                 'values': [c.id for c in Chapter.objects.all()],
612.                 'test': lambda obj, value: obj.chap.id == value,
613.             },
614.             'chap__title': {
615.                 'values': [c.title for c in Chapter.objects.all()],
616.                 'test': lambda obj, value: obj.chap.title == value,
617.             },
618.             'chap__book__id__exact': {
619.                 'values': [b.id for b in Book.objects.all()],
620.                 'test': lambda obj, value: obj.chap.book.id == value,
621.             },
622.             'chap__book__name': {
623.                 'values': [b.name for b in Book.objects.all()],
624.                 'test': lambda obj, value: obj.chap.book.name == value,
625.             },
626.             'chap__book__promo__id__exact': {
627.                 'values': [p.id for p in Promo.objects.all()],
628.                 'test': lambda obj, value: obj.chap.book.promo_set.filter(id=value).exists(),
629.             },
630.             'chap__book__promo__name': {
631.                 'values': [p.name for p in Promo.objects.all()],
632.                 'test': lambda obj, value: obj.chap.book.promo_set.filter(name=value).exists(),
633.             },
634.             # A forward relation (book) after a reverse relation (promo).
635.             'guest_author__promo__book__id__exact': {
636.                 'values': [p.id for p in Book.objects.all()],
637.                 'test': lambda obj, value: obj.guest_author.promo_set.filter(book=value).exists(),
638.             },
639.         }
640.         for filter_path, params in filters.items():
641.             for value in params['values']:
642.                 query_string = urlencode({filter_path: value})
643.                 # ensure filter link exists
644.                 self.assertContains(response, '<a href="?%s"' % query_string)
645.                 # ensure link works
646.                 filtered_response = self.client.get('%s?%s' % (changelist_url, query_string))
647.                 self.assertEqual(filtered_response.status_code, 200)
648.                 # ensure changelist contains only valid objects
649.                 for obj in filtered_response.context['cl'].queryset.all():
650.                     self.assertTrue(params['test'](obj, value))
651. 
652.     def test_incorrect_lookup_parameters(self):
653.         """Ensure incorrect lookup parameters are handled gracefully."""
654.         changelist_url = reverse('admin:admin_views_thing_changelist')
655.         response = self.client.get(changelist_url, {'notarealfield': '5'})
656.         self.assertRedirects(response, '%s?e=1' % changelist_url)
657. 
658.         # Spanning relationships through a nonexistent related object (Refs #16716)
659.         response = self.client.get(changelist_url, {'notarealfield__whatever': '5'})
660.         self.assertRedirects(response, '%s?e=1' % changelist_url)
661. 
662.         response = self.client.get(changelist_url, {'color__id__exact': 'StringNotInteger!'})
663.         self.assertRedirects(response, '%s?e=1' % changelist_url)
664. 
665.         # Regression test for #18530
666.         response = self.client.get(changelist_url, {'pub_date__gte': 'foo'})
667.         self.assertRedirects(response, '%s?e=1' % changelist_url)
668. 
669.     def test_isnull_lookups(self):
670.         """Ensure is_null is handled correctly."""
671.         Article.objects.create(title="I Could Go Anywhere", content="Versatile", date=datetime.datetime.now())
672.         changelist_url = reverse('admin:admin_views_article_changelist')
673.         response = self.client.get(changelist_url)
674.         self.assertContains(response, '4 articles')
675.         response = self.client.get(changelist_url, {'section__isnull': 'false'})
676.         self.assertContains(response, '3 articles')
677.         response = self.client.get(changelist_url, {'section__isnull': '0'})
678.         self.assertContains(response, '3 articles')
679.         response = self.client.get(changelist_url, {'section__isnull': 'true'})
680.         self.assertContains(response, '1 article')
681.         response = self.client.get(changelist_url, {'section__isnull': '1'})
682.         self.assertContains(response, '1 article')
683. 
684.     def test_logout_and_password_change_URLs(self):
685.         response = self.client.get(reverse('admin:admin_views_article_changelist'))
686.         self.assertContains(response, '<a href="%s">' % reverse('admin:logout'))
687.         self.assertContains(response, '<a href="%s">' % reverse('admin:password_change'))
688. 
689.     def test_named_group_field_choices_change_list(self):
690.         """
691.         Ensures the admin changelist shows correct values in the relevant column
692.         for rows corresponding to instances of a model in which a named group
693.         has been used in the choices option of a field.
694.         """
695.         link1 = reverse('admin:admin_views_fabric_change', args=(self.fab1.pk,))
696.         link2 = reverse('admin:admin_views_fabric_change', args=(self.fab2.pk,))
697.         response = self.client.get(reverse('admin:admin_views_fabric_changelist'))
698.         fail_msg = (
699.             "Changelist table isn't showing the right human-readable values "
700.             "set by a model field 'choices' option named group."
701.         )
702.         self.assertContains(response, '<a href="%s">Horizontal</a>' % link1, msg_prefix=fail_msg, html=True)
703.         self.assertContains(response, '<a href="%s">Vertical</a>' % link2, msg_prefix=fail_msg, html=True)
704. 
705.     def test_named_group_field_choices_filter(self):
706.         """
707.         Ensures the filter UI shows correctly when at least one named group has
708.         been used in the choices option of a model field.
709.         """
710.         response = self.client.get(reverse('admin:admin_views_fabric_changelist'))
711.         fail_msg = (
712.             "Changelist filter isn't showing options contained inside a model "
713.             "field 'choices' option named group."
714.         )
715.         self.assertContains(response, '<div id="changelist-filter">')
716.         self.assertContains(
717.             response, '<a href="?surface__exact=x" title="Horizontal">Horizontal</a>',
718.             msg_prefix=fail_msg, html=True
719.         )
720.         self.assertContains(
721.             response, '<a href="?surface__exact=y" title="Vertical">Vertical</a>',
722.             msg_prefix=fail_msg, html=True
723.         )
724. 
725.     def test_change_list_null_boolean_display(self):
726.         Post.objects.create(public=None)
727.         response = self.client.get(reverse('admin:admin_views_post_changelist'))
728.         self.assertContains(response, 'icon-unknown.svg')
729. 
730.     def test_i18n_language_non_english_default(self):
731.         """
732.         Check if the JavaScript i18n view returns an empty language catalog
733.         if the default language is non-English but the selected language
734.         is English. See #13388 and #3594 for more details.
735.         """
736.         with self.settings(LANGUAGE_CODE='fr'), translation.override('en-us'):
737.             response = self.client.get(reverse('admin:jsi18n'))
738.             self.assertNotContains(response, 'Choisir une heure')
739. 
740.     def test_i18n_language_non_english_fallback(self):
741.         """
742.         Makes sure that the fallback language is still working properly
743.         in cases where the selected language cannot be found.
744.         """
745.         with self.settings(LANGUAGE_CODE='fr'), translation.override('none'):
746.             response = self.client.get(reverse('admin:jsi18n'))
747.             self.assertContains(response, 'Choisir une heure')
748. 
749.     def test_jsi18n_with_context(self):
750.         response = self.client.get(reverse('admin-extra-context:jsi18n'))
751.         self.assertEqual(response.status_code, 200)
752. 
753.     def test_L10N_deactivated(self):
754.         """
755.         Check if L10N is deactivated, the JavaScript i18n view doesn't
756.         return localized date/time formats. Refs #14824.
757.         """
758.         with self.settings(LANGUAGE_CODE='ru', USE_L10N=False), translation.override('none'):
759.             response = self.client.get(reverse('admin:jsi18n'))
760.             self.assertNotContains(response, '%d.%m.%Y %H:%M:%S')
761.             self.assertContains(response, '%Y-%m-%d %H:%M:%S')
762. 
763.     def test_disallowed_filtering(self):
764.         with self.assertLogs('django.security.DisallowedModelAdminLookup', 'ERROR'):
765.             response = self.client.get(
766.                 "%s?owner__email__startswith=fuzzy" % reverse('admin:admin_views_album_changelist')
767.             )
768.         self.assertEqual(response.status_code, 400)
769. 
770.         # Filters are allowed if explicitly included in list_filter
771.         response = self.client.get("%s?color__value__startswith=red" % reverse('admin:admin_views_thing_changelist'))
772.         self.assertEqual(response.status_code, 200)
773.         response = self.client.get("%s?color__value=red" % reverse('admin:admin_views_thing_changelist'))
774.         self.assertEqual(response.status_code, 200)
775. 
776.         # Filters should be allowed if they involve a local field without the
777.         # need to whitelist them in list_filter or date_hierarchy.
778.         response = self.client.get("%s?age__gt=30" % reverse('admin:admin_views_person_changelist'))
779.         self.assertEqual(response.status_code, 200)
780. 
781.         e1 = Employee.objects.create(name='Anonymous', gender=1, age=22, alive=True, code='123')
782.         e2 = Employee.objects.create(name='Visitor', gender=2, age=19, alive=True, code='124')
783.         WorkHour.objects.create(datum=datetime.datetime.now(), employee=e1)
784.         WorkHour.objects.create(datum=datetime.datetime.now(), employee=e2)
785.         response = self.client.get(reverse('admin:admin_views_workhour_changelist'))
786.         self.assertContains(response, 'employee__person_ptr__exact')
787.         response = self.client.get("%s?employee__person_ptr__exact=%d" % (
788.             reverse('admin:admin_views_workhour_changelist'), e1.pk)
789.         )
790.         self.assertEqual(response.status_code, 200)
791. 
792.     def test_disallowed_to_field(self):
793.         url = reverse('admin:admin_views_section_changelist')
794.         with self.assertLogs('django.security.DisallowedModelAdminToField', 'ERROR'):
795.             response = self.client.get(url, {TO_FIELD_VAR: 'missing_field'})
796.         self.assertEqual(response.status_code, 400)
797. 
798.         # Specifying a field that is not referred by any other model registered
799.         # to this admin site should raise an exception.
800.         with self.assertLogs('django.security.DisallowedModelAdminToField', 'ERROR'):
801.             response = self.client.get(reverse('admin:admin_views_section_changelist'), {TO_FIELD_VAR: 'name'})
802.         self.assertEqual(response.status_code, 400)
803. 
804.         # #23839 - Primary key should always be allowed, even if the referenced model isn't registered.
805.         response = self.client.get(reverse('admin:admin_views_notreferenced_changelist'), {TO_FIELD_VAR: 'id'})
806.         self.assertEqual(response.status_code, 200)
807. 
808.         # #23915 - Specifying a field referenced by another model though a m2m should be allowed.
809.         response = self.client.get(reverse('admin:admin_views_recipe_changelist'), {TO_FIELD_VAR: 'rname'})
810.         self.assertEqual(response.status_code, 200)
811. 
812.         # #23604, #23915 - Specifying a field referenced through a reverse m2m relationship should be allowed.
813.         response = self.client.get(reverse('admin:admin_views_ingredient_changelist'), {TO_FIELD_VAR: 'iname'})
814.         self.assertEqual(response.status_code, 200)
815. 
816.         # #23329 - Specifying a field that is not referred by any other model directly registered
817.         # to this admin site but registered through inheritance should be allowed.
818.         response = self.client.get(reverse('admin:admin_views_referencedbyparent_changelist'), {TO_FIELD_VAR: 'name'})
819.         self.assertEqual(response.status_code, 200)
820. 
821.         # #23431 - Specifying a field that is only referred to by a inline of a registered
822.         # model should be allowed.
823.         response = self.client.get(reverse('admin:admin_views_referencedbyinline_changelist'), {TO_FIELD_VAR: 'name'})
824.         self.assertEqual(response.status_code, 200)
825. 
826.         # #25622 - Specifying a field of a model only referred by a generic
827.         # relation should raise DisallowedModelAdminToField.
828.         url = reverse('admin:admin_views_referencedbygenrel_changelist')
829.         with self.assertLogs('django.security.DisallowedModelAdminToField', 'ERROR'):
830.             response = self.client.get(url, {TO_FIELD_VAR: 'object_id'})
831.         self.assertEqual(response.status_code, 400)
832. 
833.         # We also want to prevent the add, change, and delete views from
834.         # leaking a disallowed field value.
835.         with self.assertLogs('django.security.DisallowedModelAdminToField', 'ERROR'):
836.             response = self.client.post(reverse('admin:admin_views_section_add'), {TO_FIELD_VAR: 'name'})
837.         self.assertEqual(response.status_code, 400)
838. 
839.         section = Section.objects.create()
840.         url = reverse('admin:admin_views_section_change', args=(section.pk,))
841.         with self.assertLogs('django.security.DisallowedModelAdminToField', 'ERROR'):
842.             response = self.client.post(url, {TO_FIELD_VAR: 'name'})
843.         self.assertEqual(response.status_code, 400)
844. 
845.         url = reverse('admin:admin_views_section_delete', args=(section.pk,))
846.         with self.assertLogs('django.security.DisallowedModelAdminToField', 'ERROR'):
847.             response = self.client.post(url, {TO_FIELD_VAR: 'name'})
848.         self.assertEqual(response.status_code, 400)
849. 
850.     def test_allowed_filtering_15103(self):
851.         """
852.         Regressions test for ticket 15103 - filtering on fields defined in a
853.         ForeignKey 'limit_choices_to' should be allowed, otherwise raw_id_fields
854.         can break.
855.         """
856.         # Filters should be allowed if they are defined on a ForeignKey pointing to this model
857.         url = "%s?leader__name=Palin&leader__age=27" % reverse('admin:admin_views_inquisition_changelist')
858.         response = self.client.get(url)
859.         self.assertEqual(response.status_code, 200)
860. 
861.     def test_popup_dismiss_related(self):
862.         """
863.         Regression test for ticket 20664 - ensure the pk is properly quoted.
864.         """
865.         actor = Actor.objects.create(name="Palin", age=27)
866.         response = self.client.get("%s?%s" % (reverse('admin:admin_views_actor_changelist'), IS_POPUP_VAR))
867.         self.assertContains(response, 'data-popup-opener="%s"' % actor.pk)
868. 
869.     def test_hide_change_password(self):
870.         """
871.         Tests if the "change password" link in the admin is hidden if the User
872.         does not have a usable password set.
873.         (against 9bea85795705d015cdadc82c68b99196a8554f5c)
874.         """
875.         user = User.objects.get(username='super')
876.         user.set_unusable_password()
877.         user.save()
878.         self.client.force_login(user)
879.         response = self.client.get(reverse('admin:index'))
880.         self.assertNotContains(
881.             response, reverse('admin:password_change'),
882.             msg_prefix='The "change password" link should not be displayed if a user does not have a usable password.'
883.         )
884. 
885.     def test_change_view_with_show_delete_extra_context(self):
886.         """
887.         The 'show_delete' context variable in the admin's change view controls
888.         the display of the delete button.
889.         """
890.         instance = UndeletableObject.objects.create(name='foo')
891.         response = self.client.get(reverse('admin:admin_views_undeletableobject_change', args=(instance.pk,)))
892.         self.assertNotContains(response, 'deletelink')
893. 
894.     def test_change_view_logs_m2m_field_changes(self):
895.         """Changes to ManyToManyFields are included in the object's history."""
896.         pizza = ReadablePizza.objects.create(name='Cheese')
897.         cheese = Topping.objects.create(name='cheese')
898.         post_data = {'name': pizza.name, 'toppings': [cheese.pk]}
899.         response = self.client.post(reverse('admin:admin_views_readablepizza_change', args=(pizza.pk,)), post_data)
900.         self.assertRedirects(response, reverse('admin:admin_views_readablepizza_changelist'))
901.         pizza_ctype = ContentType.objects.get_for_model(ReadablePizza, for_concrete_model=False)
902.         log = LogEntry.objects.filter(content_type=pizza_ctype, object_id=pizza.pk).first()
903.         self.assertEqual(log.get_change_message(), 'Changed toppings.')
904. 
905.     def test_allows_attributeerror_to_bubble_up(self):
906.         """
907.         AttributeErrors are allowed to bubble when raised inside a change list
908.         view. Requires a model to be created so there's something to display.
909.         Refs: #16655, #18593, and #18747
910.         """
911.         Simple.objects.create()
912.         with self.assertRaises(AttributeError):
913.             self.client.get(reverse('admin:admin_views_simple_changelist'))
914. 
915.     def test_changelist_with_no_change_url(self):
916.         """
917.         ModelAdmin.changelist_view shouldn't result in a NoReverseMatch if url
918.         for change_view is removed from get_urls (#20934).
919.         """
920.         o = UnchangeableObject.objects.create()
921.         response = self.client.get(reverse('admin:admin_views_unchangeableobject_changelist'))
922.         self.assertEqual(response.status_code, 200)
923.         # Check the format of the shown object -- shouldn't contain a change link
924.         self.assertContains(response, '<th class="field-__str__">%s</th>' % o, html=True)
925. 
926.     def test_invalid_appindex_url(self):
927.         """
928.         #21056 -- URL reversing shouldn't work for nonexistent apps.
929.         """
930.         good_url = '/test_admin/admin/admin_views/'
931.         confirm_good_url = reverse('admin:app_list',
932.                                    kwargs={'app_label': 'admin_views'})
933.         self.assertEqual(good_url, confirm_good_url)
934. 
935.         with self.assertRaises(NoReverseMatch):
936.             reverse('admin:app_list', kwargs={'app_label': 'this_should_fail'})
937.         with self.assertRaises(NoReverseMatch):
938.             reverse('admin:app_list', args=('admin_views2',))
939. 
940.     def test_resolve_admin_views(self):
941.         index_match = resolve('/test_admin/admin4/')
942.         list_match = resolve('/test_admin/admin4/auth/user/')
943.         self.assertIs(index_match.func.admin_site, customadmin.simple_site)
944.         self.assertIsInstance(list_match.func.model_admin, customadmin.CustomPwdTemplateUserAdmin)
945. 
946.     def test_adminsite_display_site_url(self):
947.         """
948.         #13749 - Admin should display link to front-end site 'View site'
949.         """
950.         url = reverse('admin:index')
951.         response = self.client.get(url)
952.         self.assertEqual(response.context['site_url'], '/my-site-url/')
953.         self.assertContains(response, '<a href="/my-site-url/">View site</a>')
954. 
955.     @override_settings(TIME_ZONE='America/Sao_Paulo', USE_TZ=True)
956.     def test_date_hierarchy_timezone_dst(self):
957.         # This datetime doesn't exist in this timezone due to DST.
958.         date = pytz.timezone('America/Sao_Paulo').localize(datetime.datetime(2016, 10, 16, 15), is_dst=None)
959.         q = Question.objects.create(question='Why?', expires=date)
960.         Answer2.objects.create(question=q, answer='Because.')
961.         response = self.client.get(reverse('admin:admin_views_answer2_changelist'))
962.         self.assertEqual(response.status_code, 200)
963.         self.assertContains(response, 'question__expires__day=16')
964.         self.assertContains(response, 'question__expires__month=10')
965.         self.assertContains(response, 'question__expires__year=2016')
966. 
967.     def test_sortable_by_columns_subset(self):
968.         expected_sortable_fields = ('date', 'callable_year')
969.         expected_not_sortable_fields = (
970.             'content', 'model_year', 'modeladmin_year', 'model_year_reversed',
971.             'section',
972.         )
973.         response = self.client.get(reverse('admin6:admin_views_article_changelist'))
974.         for field_name in expected_sortable_fields:
975.             self.assertContains(response, '<th scope="col"  class="sortable column-%s">' % field_name)
976.         for field_name in expected_not_sortable_fields:
977.             self.assertContains(response, '<th scope="col"  class="column-%s">' % field_name)
978. 
979.     def test_get_sortable_by_columns_subset(self):
980.         response = self.client.get(reverse('admin6:admin_views_actor_changelist'))
981.         self.assertContains(response, '<th scope="col"  class="sortable column-age">')
982.         self.assertContains(response, '<th scope="col"  class="column-name">')
983. 
984.     def test_sortable_by_no_column(self):
985.         expected_not_sortable_fields = ('title', 'book')
986.         response = self.client.get(reverse('admin6:admin_views_chapter_changelist'))
987.         for field_name in expected_not_sortable_fields:
988.             self.assertContains(response, '<th scope="col"  class="column-%s">' % field_name)
989.         self.assertNotContains(response, '<th scope="col"  class="sortable column')
990. 
991.     def test_get_sortable_by_no_column(self):
992.         response = self.client.get(reverse('admin6:admin_views_color_changelist'))
993.         self.assertContains(response, '<th scope="col"  class="column-value">')
994.         self.assertNotContains(response, '<th scope="col"  class="sortable column')


--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to a given query and return it in the specified format!
EVERY context object MUST include: reasoning, relative_path, start_line, and end_line.

2025-10-06 21:04:44,412 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="This test case demonstrates how to dynamically configure an inline's property (`min_num`) based on the request context (add vs. change view) by overriding the `get_min_num(request, obj=None)` method. This is directly analogous to the proposed `ModelAdmin.get_inlines(request, obj=None)` hook.", relative_path='tests/admin_inlines/tests.py', start_line=338, end_line=372), ContextOutput(reasoning="This test case is relevant because it tests the `get_max_num` hook on a `ModelAdmin`. This hook allows for dynamically setting the number of extra inline forms based on the request and object, which is very similar to the proposed `get_inlines` hook's purpose of dynamically configuring inlines.", relative_path='tests/admin_inlines/tests.py', start_line=291, end_line=312), ContextOutput(reasoning="This test case demonstrates using a callable for a `readonly_field` within an inline. This is a form of dynamic customization of inlines, which is conceptually similar to the user's request to have a `get_inlines` hook for more dynamic control.", relative_path='tests/admin_inlines/tests.py', start_line=154, end_line=166), ContextOutput(reasoning="This test case is relevant as it tests the `show_change_link` property of inlines. This feature allows for conditional display of a link, which is a form of dynamic inline customization. The user's request for a `get_inlines` hook is also about dynamic customization, making this test of a similar feature relevant.", relative_path='tests/admin_inlines/tests.py', start_line=433, end_line=447), ContextOutput(reasoning="This test checks the `view_on_site` attribute of a ModelAdmin, which can be a callable. This is a good example of a generic pattern in Django's admin where a hook can be a callable to allow for dynamic behavior based on the object instance. This pattern is what the user wants to apply to inlines.", relative_path='tests/admin_views/tests.py', start_line=6181, end_line=6202)]
2025-10-06 21:04:44,413 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - INFO - Context extraction complete, returning context [Context(relative_path='tests/admin_inlines/tests.py', content='338.     def test_custom_min_num(self):\n339.         bt_head = BinaryTree.objects.create(name="Tree Head")\n340.         BinaryTree.objects.create(name="First Child", parent=bt_head)\n341. \n342.         class MinNumInline(TabularInline):\n343.             model = BinaryTree\n344.             extra = 3\n345. \n346.             def get_min_num(self, request, obj=None, **kwargs):\n347.                 if obj:\n348.                     return 5\n349.                 return 2\n350. \n351.         modeladmin = ModelAdmin(BinaryTree, admin_site)\n352.         modeladmin.inlines = [MinNumInline]\n353.         min_forms = (\n354.             \'<input id="id_binarytree_set-MIN_NUM_FORMS" \'\n355.             \'name="binarytree_set-MIN_NUM_FORMS" type="hidden" value="%d">\'\n356.         )\n357.         total_forms = (\n358.             \'<input id="id_binarytree_set-TOTAL_FORMS" \'\n359.             \'name="binarytree_set-TOTAL_FORMS" type="hidden" value="%d">\'\n360.         )\n361.         request = self.factory.get(reverse(\'admin:admin_inlines_binarytree_add\'))\n362.         request.user = User(username=\'super\', is_superuser=True)\n363.         response = modeladmin.changeform_view(request)\n364.         self.assertInHTML(min_forms % 2, response.rendered_content)\n365.         self.assertInHTML(total_forms % 5, response.rendered_content)\n366. \n367.         request = self.factory.get(reverse(\'admin:admin_inlines_binarytree_change\', args=(bt_head.id,)))\n368.         request.user = User(username=\'super\', is_superuser=True)\n369.         response = modeladmin.changeform_view(request, object_id=str(bt_head.id))\n370.         self.assertInHTML(min_forms % 5, response.rendered_content)\n371.         self.assertInHTML(total_forms % 8, response.rendered_content)\n372. ', start_line_number=338, end_line_number=372), Context(relative_path='tests/admin_inlines/tests.py', content='291.     def test_custom_get_extra_form(self):\n292.         bt_head = BinaryTree.objects.create(name="Tree Head")\n293.         BinaryTree.objects.create(name="First Child", parent=bt_head)\n294.         # The maximum number of forms should respect \'get_max_num\' on the\n295.         # ModelAdmin\n296.         max_forms_input = (\n297.             \'<input id="id_binarytree_set-MAX_NUM_FORMS" \'\n298.             \'name="binarytree_set-MAX_NUM_FORMS" type="hidden" value="%d">\'\n299.         )\n300.         # The total number of forms will remain the same in either case\n301.         total_forms_hidden = (\n302.             \'<input id="id_binarytree_set-TOTAL_FORMS" \'\n303.             \'name="binarytree_set-TOTAL_FORMS" type="hidden" value="2">\'\n304.         )\n305.         response = self.client.get(reverse(\'admin:admin_inlines_binarytree_add\'))\n306.         self.assertInHTML(max_forms_input % 3, response.rendered_content)\n307.         self.assertInHTML(total_forms_hidden, response.rendered_content)\n308. \n309.         response = self.client.get(reverse(\'admin:admin_inlines_binarytree_change\', args=(bt_head.id,)))\n310.         self.assertInHTML(max_forms_input % 2, response.rendered_content)\n311.         self.assertInHTML(total_forms_hidden, response.rendered_content)\n312. ', start_line_number=291, end_line_number=312), Context(relative_path='tests/admin_inlines/tests.py', content='154.     def test_callable_lookup(self):\n155.         """Admin inline should invoke local callable when its name is listed in readonly_fields"""\n156.         response = self.client.get(reverse(\'admin:admin_inlines_poll_add\'))\n157.         self.assertEqual(response.status_code, 200)\n158.         # Add parent object view should have the child inlines section\n159.         self.assertContains(\n160.             response,\n161.             \'<div class="js-inline-admin-formset inline-group" id="question_set-group"\'\n162.         )\n163.         # The right callable should be used for the inline readonly_fields\n164.         # column cells\n165.         self.assertContains(response, \'<p>Callable in QuestionInline</p>\')\n166. ', start_line_number=154, end_line_number=166), Context(relative_path='tests/admin_inlines/tests.py', content='433.     def test_inlines_show_change_link_registered(self):\n434.         "Inlines `show_change_link` for registered models when enabled."\n435.         holder = Holder4.objects.create(dummy=1)\n436.         item1 = Inner4Stacked.objects.create(dummy=1, holder=holder)\n437.         item2 = Inner4Tabular.objects.create(dummy=1, holder=holder)\n438.         items = (\n439.             (\'inner4stacked\', item1.pk),\n440.             (\'inner4tabular\', item2.pk),\n441.         )\n442.         response = self.client.get(reverse(\'admin:admin_inlines_holder4_change\', args=(holder.pk,)))\n443.         self.assertTrue(response.context[\'inline_admin_formset\'].opts.has_registered_model)\n444.         for model, pk in items:\n445.             url = reverse(\'admin:admin_inlines_%s_change\' % model, args=(pk,))\n446.             self.assertContains(response, \'<a href="%s" %s\' % (url, INLINE_CHANGELINK_HTML))\n447. ', start_line_number=433, end_line_number=447), Context(relative_path='tests/admin_views/tests.py', content='6181.     def test_check(self):\n6182.         "The view_on_site value is either a boolean or a callable"\n6183.         try:\n6184.             admin = CityAdmin(City, AdminSite())\n6185.             CityAdmin.view_on_site = True\n6186.             self.assertEqual(admin.check(), [])\n6187.             CityAdmin.view_on_site = False\n6188.             self.assertEqual(admin.check(), [])\n6189.             CityAdmin.view_on_site = lambda obj: obj.get_absolute_url()\n6190.             self.assertEqual(admin.check(), [])\n6191.             CityAdmin.view_on_site = []\n6192.             self.assertEqual(admin.check(), [\n6193.                 Error(\n6194.                     "The value of \'view_on_site\' must be a callable or a boolean value.",\n6195.                     obj=CityAdmin,\n6196.                     id=\'admin.E025\',\n6197.                 ),\n6198.             ])\n6199.         finally:\n6200.             # Restore the original values for the benefit of other tests.\n6201.             CityAdmin.view_on_site = True\n6202. ', start_line_number=6181, end_line_number=6202)]
2025-10-06 21:04:44,414 - thread-139660780025408.app.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-10-06 21:04:44,414 - thread-139660780025408.app.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── bin
|   |   └── django-admin.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── bin
|   |   |   |   └── compress.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   ├── options.py
|   |   |   |   └── widgets.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── mn
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sv
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── templates
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── memcached.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   └── __init__.py
|   |   |   ├── database.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── utils.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   ├── special.py
|   |   |   |   └── utils.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── autoreload.py
|   |   ├── baseconv.py
|   |   ├── cache.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── datetime_safe.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── topological_sort.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           └── technical_500.txt
├── docs
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   └── static
|   |   |       └── fontawesome
|   |   └── djangodocs-epub
|   |       └── static
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── auth-remote-user.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-tags.txt
|   |   ├── deployment
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── jython.txt
|   |   ├── legacy-databases.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.19.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.20.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.11.txt
|   |   ├── 2.0.12.txt
|   |   ├── 2.0.13.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.7.txt
|   |   ├── 2.1.8.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.1.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.txt
|   |   ├── index.txt
|   |   └── security.txt
|   └── topics
|       ├── _images
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── RelatedObjectLookups.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   └── jsi18n-mocks.test.js
|   ├── gis
|   |   └── mapwidget.test.js
|   └── qunit
|       └── qunit.js
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_dynamic_settings_manage.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   └── commands
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       └── noargs_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   └── admin
    |   |       └── admin_views
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_forms.py
    |   ├── test_multidb.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── default_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   └── with_last_login_attr.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   └── registration
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_remote_user.py
    |   ├── test_remote_user_deprecation.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── test_base.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_introspection.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   └── commands
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   └── tests.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   └── tests.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_error_handlers.py
    |       ├── beginning_with_slash.py
    |       ├── contains_tuple.py
    |       ├── good_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   └── ending_with_dollar.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_greatest.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_round.py
    |   |   ├── test_sign.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_md5.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_sha1.py
    |   |   ├── test_sha224.py
    |   |   ├── test_sha256.py
    |   |   ├── test_sha384.py
    |   |   ├── test_sha512.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   └── test_postgresql.py
    ├── decorators
    |   ├── __init__.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_deprecation.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   └── registration
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   └── robots.txt
    |   |   └── registration
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── has_nulls
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   └── test_srs.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── admin.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── maps
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   └── javascript_ignored.js
    |   |   └── templates
    |   |       └── subdir
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── models.py
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── integration_settings.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_constraints.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_integration.py
    |   ├── test_introspection.py
    |   ├── test_json.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests
    |   ├── __init__.py
    |   ├── test_data_upload_settings.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   ├── test_file_charset.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   ├── templates
    |   |   └── shortcuts
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   ├── test_management.py
    |   ├── test_utils.py
    |   └── urls
    |       ├── __init__.py
    |       ├── empty.py
    |       ├── http.py
    |       ├── https.py
    |       └── index_only.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── cached
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   ├── loop
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   ├── jinja2
    |   |   └── template_backends
    |   ├── template_strings
    |   |   └── template_backends
    |   ├── templates
    |   |   └── template_backends
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   ├── templates
    |   |   └── template_loader
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   ├── other_templates
    |   |   └── priority
    |   ├── recursive_templates
    |   |   ├── fs
    |   |   ├── fs2
    |   |   └── fs3
    |   ├── relative_templates
    |   |   └── dir1
    |   |       └── dir2
    |   ├── syntax_tests
    |   |   ├── __init__.py
    |   |   ├── i18n
    |   |   |   ├── __init__.py
    |   |   |   ├── base.py
    |   |   |   ├── test_blocktrans.py
    |   |   |   ├── test_filters.py
    |   |   |   ├── test_get_available_languages.py
    |   |   |   ├── test_get_current_language.py
    |   |   |   ├── test_get_current_language_bidi.py
    |   |   |   ├── test_get_language_info.py
    |   |   |   ├── test_get_language_info_list.py
    |   |   |   ├── test_language.py
    |   |   |   ├── test_trans.py
    |   |   |   └── test_underscore_syntax.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_basic.py
    |   |   ├── test_builtins.py
    |   |   ├── test_cache.py
    |   |   ├── test_comment.py
    |   |   ├── test_cycle.py
    |   |   ├── test_exceptions.py
    |   |   ├── test_extends.py
    |   |   ├── test_filter_syntax.py
    |   |   ├── test_filter_tag.py
    |   |   ├── test_firstof.py
    |   |   ├── test_for.py
    |   |   ├── test_if.py
    |   |   ├── test_if_changed.py
    |   |   ├── test_if_equal.py
    |   |   ├── test_include.py
    |   |   ├── test_invalid_string.py
    |   |   ├── test_list_index.py
    |   |   ├── test_load.py
    |   |   ├── test_lorem.py
    |   |   ├── test_multiline.py
    |   |   ├── test_named_endblock.py
    |   |   ├── test_now.py
    |   |   ├── test_numpy.py
    |   |   ├── test_regroup.py
    |   |   ├── test_resetcycle.py
    |   |   ├── test_setup.py
    |   |   ├── test_simple_tag.py
    |   |   ├── test_spaceless.py
    |   |   ├── test_static.py
    |   |   ├── test_template_tag.py
    |   |   ├── test_url.py
    |   |   ├── test_verbatim.py
    |   |   ├── test_width_ratio.py
    |   |   └── test_with.py
    |   ├── templates
    |   |   ├── first
    |   |   ├── priority
    |   |   ├── second
    |   |   └── template_tests
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   ├── bad_tag.py
    |   |   ├── custom.py
    |   |   ├── inclusion.py
    |   |   ├── subpackage
    |   |   |   ├── __init__.py
    |   |   |   └── echo.py
    |   |   ├── tag_27584.py
    |   |   └── testtags.py
    |   ├── test_base.py
    |   ├── test_callables.py
    |   ├── test_context.py
    |   ├── test_custom.py
    |   ├── test_engine.py
    |   ├── test_extends.py
    |   ├── test_extends_relative.py
    |   ├── test_library.py
    |   ├── test_loaders.py
    |   ├── test_logging.py
    |   ├── test_nodelist.py
    |   ├── test_origin.py
    |   ├── test_parser.py
    |   ├── test_response.py
    |   ├── test_smartif.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── utils.py
    |   └── views.py
    ├── templates
    |   ├── comments
    |   |   └── comment_notification_email.txt
    |   ├── custom_admin
    |   └── views
    ├── test_client
    |   ├── __init__.py
    |   ├── auth_backends.py
    |   ├── test_conditional_content_removal.py
    |   ├── test_fakepayload.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── test_client_regress
    |   ├── __init__.py
    |   ├── auth_backends.py
    |   ├── bad_templates
    |   ├── context_processors.py
    |   ├── models.py
    |   ├── session.py
    |   ├── templates
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── test_exceptions
    |   ├── __init__.py
    |   └── test_validation_error.py
    ├── test_runner
    |   ├── __init__.py
    |   ├── models.py
    |   ├── runner.py
    |   ├── test_debug_sql.py
    |   ├── test_discover_runner.py
    |   ├── test_parallel.py
    |   └── tests.py
    ├── test_runner_apps
    |   ├── __init__.py
    |   ├── databases
    |   |   ├── __init__.py
    |   |   └── tests.py
    |   ├── sample
    |   |   ├── __init__.py
    |   |   ├── doctests.py
    |   |   ├── empty.py
    |   |   ├── pattern_tests.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── tests.py
    |   |   └── tests_sample.py
    |   ├── simple
    |   |   ├── __init__.py
    |   |   └── tests.py
    |   └── tagged
    |       ├── __init__.py
    |       ├── tests.py
    |       └── tests_inheritance.py
    ├── test_sqlite.py
    ├── test_utils
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── templates
    |   |   └── template_used
    |   ├── test_deprecated_features.py
    |   ├── test_testcase.py
    |   ├── test_transactiontestcase.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── timezones
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── transaction_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── transactions
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── unmanaged_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── update_only_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── urlpatterns
    |   ├── __init__.py
    |   ├── converter_urls.py
    |   ├── converters.py
    |   ├── included_urls.py
    |   ├── more_urls.py
    |   ├── path_base64_urls.py
    |   ├── path_dynamic_urls.py
    |   ├── path_urls.py
    |   ├── test_resolvers.py
    |   ├── tests.py
    |   └── views.py
    ├── urlpatterns_reverse
    |   ├── __init__.py
    |   ├── erroneous_urls.py
    |   ├── extra_urls.py
    |   ├── included_app_urls.py
    |   ├── included_named_urls.py
    |   ├── included_named_urls2.py
    |   ├── included_namespace_urls.py
    |   ├── included_no_kwargs_urls.py
    |   ├── included_urls.py
    |   ├── included_urls2.py
    |   ├── method_view_urls.py
    |   ├── middleware.py
    |   ├── named_urls.py
    |   ├── named_urls_conflict.py
    |   ├── namespace_urls.py
    |   ├── nested_urls.py
    |   ├── no_urls.py
    |   ├── nonimported_module.py
    |   ├── reverse_lazy_urls.py
    |   ├── test_localeregexdescriptor.py
    |   ├── tests.py
    |   ├── translations
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── urlconf_inner.py
    |   ├── urlconf_outer.py
    |   ├── urls.py
    |   ├── urls_error_handlers.py
    |   ├── urls_error_handlers_callables.py
    |   ├── urls_without_handlers.py
    |   ├── utils.py
    |   ├── views.py
    |   └── views_broken.py
    ├── urls.py
    ├── user_commands
    |   ├── __init__.py
    |   ├── eggs
    |   ├── management
    |   |   └── commands
    |   |       ├── common_args.py
    |   |       ├── dance.py
    |   |       ├── hal.py
    |   |       ├── no_translations.py
    |   |       ├── required_option.py
    |   |       ├── reverse_url.py
    |   |       ├── set_option.py
    |   |       ├── subparser.py
    |   |       └── transaction.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── utils_tests
    |   ├── __init__.py
    |   ├── archives
    |   ├── eggs
    |   ├── files
    |   |   └── strip_tags2.txt
    |   ├── models.py
    |   ├── test_archive.py
    |   ├── test_autoreload.py
    |   ├── test_baseconv.py
    |   ├── test_crypto.py
    |   ├── test_datastructures.py
    |   ├── test_dateformat.py
    |   ├── test_dateparse.py
    |   ├── test_datetime_safe.py
    |   ├── test_decorators.py
    |   ├── test_duration.py
    |   ├── test_encoding.py
    |   ├── test_encoding_deprecations.py
    |   ├── test_feedgenerator.py
    |   ├── test_functional.py
    |   ├── test_hashable.py
    |   ├── test_html.py
    |   ├── test_http.py
    |   ├── test_inspect.py
    |   ├── test_ipv6.py
    |   ├── test_jslex.py
    |   ├── test_lazyobject.py
    |   ├── test_lorem_ipsum.py
    |   ├── test_module
    |   |   ├── __init__.py
    |   |   ├── another_bad_module.py
    |   |   ├── another_good_module.py
    |   |   ├── bad_module.py
    |   |   ├── child_module
    |   |   |   ├── __init__.py
    |   |   |   └── grandchild_module.py
    |   |   └── good_module.py
    |   ├── test_module_loading.py
    |   ├── test_no_submodule.py
    |   ├── test_numberformat.py
    |   ├── test_os_utils.py
    |   ├── test_regex_helper.py
    |   ├── test_safestring.py
    |   ├── test_simplelazyobject.py
    |   ├── test_termcolors.py
    |   ├── test_text.py
    |   ├── test_timesince.py
    |   ├── test_timezone.py
    |   ├── test_topological_sort.py
    |   └── test_tree.py
    ├── validation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_custom_messages.py
    |   ├── test_error_messages.py
    |   ├── test_picklable.py
    |   ├── test_unique.py
    |   ├── test_validators.py
    |   └── tests.py
    ├── validators
    |   ├── __init__.py
    |   ├── invalid_urls.txt
    |   ├── tests.py
    |   └── valid_urls.txt
    ├── version
    |   ├── __init__.py
    |   └── tests.py
    ├── view_tests
    |   ├── __init__.py
    |   ├── app0
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── en
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── fr
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── fr
    |   ├── app3
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── es_AR
    |   ├── app4
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── es_AR
    |   ├── app5
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── fr
    |   ├── default_urls.py
    |   ├── generic_urls.py
    |   ├── locale
    |   |   ├── de
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_GB
    |   |   |   └── LC_MESSAGES
    |   |   ├── es
    |   |   |   └── LC_MESSAGES
    |   |   ├── fr
    |   |   |   └── LC_MESSAGES
    |   |   ├── nl
    |   |   |   └── LC_MESSAGES
    |   |   ├── pt
    |   |   |   └── LC_MESSAGES
    |   |   └── ru
    |   |       └── LC_MESSAGES
    |   ├── media
    |   |   ├── %2F.txt
    |   |   ├── file.txt
    |   |   ├── long-line.txt
    |   |   └── subdir
    |   ├── models.py
    |   ├── regression_21530_urls.py
    |   ├── templates
    |   |   └── debug
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   └── debugtags.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_csrf.py
    |   |   ├── test_debug.py
    |   |   ├── test_defaults.py
    |   |   ├── test_i18n.py
    |   |   ├── test_json.py
    |   |   ├── test_specials.py
    |   |   └── test_static.py
    |   ├── urls.py
    |   └── views.py
    └── wsgi
        ├── __init__.py
        ├── tests.py
        ├── urls.py
        └── wsgi.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
add ModelAdmin.get_inlines() hook to allow set inlines based on the request or model instance.

Issue description: 
Description
	
add ModelAdmin.get_inlines() hook to allow set inlines based on the request or model instance.
Currently, We can override the method get_inline_instances to do such a thing, but a for loop should be copied to my code. So I wished add a hook get_inlines(request, obj=None)

Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: tests/admin_inlines/tests.py
Line number range: 338 - 372
Content:
338.     def test_custom_min_num(self):
339.         bt_head = BinaryTree.objects.create(name="Tree Head")
340.         BinaryTree.objects.create(name="First Child", parent=bt_head)
341. 
342.         class MinNumInline(TabularInline):
343.             model = BinaryTree
344.             extra = 3
345. 
346.             def get_min_num(self, request, obj=None, **kwargs):
347.                 if obj:
348.                     return 5
349.                 return 2
350. 
351.         modeladmin = ModelAdmin(BinaryTree, admin_site)
352.         modeladmin.inlines = [MinNumInline]
353.         min_forms = (
354.             '<input id="id_binarytree_set-MIN_NUM_FORMS" '
355.             'name="binarytree_set-MIN_NUM_FORMS" type="hidden" value="%d">'
356.         )
357.         total_forms = (
358.             '<input id="id_binarytree_set-TOTAL_FORMS" '
359.             'name="binarytree_set-TOTAL_FORMS" type="hidden" value="%d">'
360.         )
361.         request = self.factory.get(reverse('admin:admin_inlines_binarytree_add'))
362.         request.user = User(username='super', is_superuser=True)
363.         response = modeladmin.changeform_view(request)
364.         self.assertInHTML(min_forms % 2, response.rendered_content)
365.         self.assertInHTML(total_forms % 5, response.rendered_content)
366. 
367.         request = self.factory.get(reverse('admin:admin_inlines_binarytree_change', args=(bt_head.id,)))
368.         request.user = User(username='super', is_superuser=True)
369.         response = modeladmin.changeform_view(request, object_id=str(bt_head.id))
370.         self.assertInHTML(min_forms % 5, response.rendered_content)
371.         self.assertInHTML(total_forms % 8, response.rendered_content)
372. 


File: tests/admin_inlines/tests.py
Line number range: 291 - 312
Content:
291.     def test_custom_get_extra_form(self):
292.         bt_head = BinaryTree.objects.create(name="Tree Head")
293.         BinaryTree.objects.create(name="First Child", parent=bt_head)
294.         # The maximum number of forms should respect 'get_max_num' on the
295.         # ModelAdmin
296.         max_forms_input = (
297.             '<input id="id_binarytree_set-MAX_NUM_FORMS" '
298.             'name="binarytree_set-MAX_NUM_FORMS" type="hidden" value="%d">'
299.         )
300.         # The total number of forms will remain the same in either case
301.         total_forms_hidden = (
302.             '<input id="id_binarytree_set-TOTAL_FORMS" '
303.             'name="binarytree_set-TOTAL_FORMS" type="hidden" value="2">'
304.         )
305.         response = self.client.get(reverse('admin:admin_inlines_binarytree_add'))
306.         self.assertInHTML(max_forms_input % 3, response.rendered_content)
307.         self.assertInHTML(total_forms_hidden, response.rendered_content)
308. 
309.         response = self.client.get(reverse('admin:admin_inlines_binarytree_change', args=(bt_head.id,)))
310.         self.assertInHTML(max_forms_input % 2, response.rendered_content)
311.         self.assertInHTML(total_forms_hidden, response.rendered_content)
312. 


File: tests/admin_inlines/tests.py
Line number range: 154 - 166
Content:
154.     def test_callable_lookup(self):
155.         """Admin inline should invoke local callable when its name is listed in readonly_fields"""
156.         response = self.client.get(reverse('admin:admin_inlines_poll_add'))
157.         self.assertEqual(response.status_code, 200)
158.         # Add parent object view should have the child inlines section
159.         self.assertContains(
160.             response,
161.             '<div class="js-inline-admin-formset inline-group" id="question_set-group"'
162.         )
163.         # The right callable should be used for the inline readonly_fields
164.         # column cells
165.         self.assertContains(response, '<p>Callable in QuestionInline</p>')
166. 


File: tests/admin_inlines/tests.py
Line number range: 433 - 447
Content:
433.     def test_inlines_show_change_link_registered(self):
434.         "Inlines `show_change_link` for registered models when enabled."
435.         holder = Holder4.objects.create(dummy=1)
436.         item1 = Inner4Stacked.objects.create(dummy=1, holder=holder)
437.         item2 = Inner4Tabular.objects.create(dummy=1, holder=holder)
438.         items = (
439.             ('inner4stacked', item1.pk),
440.             ('inner4tabular', item2.pk),
441.         )
442.         response = self.client.get(reverse('admin:admin_inlines_holder4_change', args=(holder.pk,)))
443.         self.assertTrue(response.context['inline_admin_formset'].opts.has_registered_model)
444.         for model, pk in items:
445.             url = reverse('admin:admin_inlines_%s_change' % model, args=(pk,))
446.             self.assertContains(response, '<a href="%s" %s' % (url, INLINE_CHANGELINK_HTML))
447. 


File: tests/admin_views/tests.py
Line number range: 6181 - 6202
Content:
6181.     def test_check(self):
6182.         "The view_on_site value is either a boolean or a callable"
6183.         try:
6184.             admin = CityAdmin(City, AdminSite())
6185.             CityAdmin.view_on_site = True
6186.             self.assertEqual(admin.check(), [])
6187.             CityAdmin.view_on_site = False
6188.             self.assertEqual(admin.check(), [])
6189.             CityAdmin.view_on_site = lambda obj: obj.get_absolute_url()
6190.             self.assertEqual(admin.check(), [])
6191.             CityAdmin.view_on_site = []
6192.             self.assertEqual(admin.check(), [
6193.                 Error(
6194.                     "The value of 'view_on_site' must be a callable or a boolean value.",
6195.                     obj=CityAdmin,
6196.                     id='admin.E025',
6197.                 ),
6198.             ])
6199.         finally:
6200.             # Restore the original values for the benefit of other tests.
6201.             CityAdmin.view_on_site = True
6202. 

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

2025-10-06 21:05:20,267 - thread-139660780025408.app.lang_graph.nodes.context_refine_node - DEBUG - reasoning="1. The user's request is to find test cases for a new `ModelAdmin.get_inlines()` hook. This hook should dynamically determine the inlines based on the request or model instance.\n2. This functionality is very similar to existing dynamic hooks on `ModelAdmin`, such as `get_fieldsets()`, `get_readonly_fields()`, and `get_list_display()`.\n3. The current context provides tests for customizing properties *within* an inline (e.g., `get_min_num`) and for callables in `ModelAdmin` attributes (e.g., `view_on_site`).\n4. However, the context lacks a direct example of a test for a `ModelAdmin` method that dynamically returns a list of components, such as a list of inlines or fieldsets, based on the request or object.\n5. To provide the most relevant examples, it's necessary to look at tests for analogous features. Tests for `get_fieldsets` or `get_readonly_fields` in `tests/admin_views/tests.py` would serve as a perfect template for testing the proposed `get_inlines` hook." refined_query='Please provide test cases from `tests/admin_views/tests.py` for `ModelAdmin` methods that dynamically alter configuration based on the request or object. Specifically, I am interested in tests for `get_fieldsets()`, `get_readonly_fields()`, and other similar `get_*` methods.'
2025-10-06 21:05:26,761 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I have located the test file at `tests/admin_views/tests.py` and am reviewing its contents to find test cases for `ModelAdmin` methods that dynamically alter configuration. I will focus on tests for methods such as `get_fieldsets()` and `get_readonly_fields()` to identify the most relevant examples for your query. I will then extract and present the pertinent test cases.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/admin_views/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 53516, 'candidates_token_count': 104, 'total_token_count': 53977, 'prompt_tokens_details': [{'modality': 1, 'token_count': 53516}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 104}], 'thoughts_token_count': 357, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.5093009288494403, 'model_name': 'gemini-2.5-pro'} id='run--90f0af2d-99bc-4c1d-be11-5875a9ac1f18-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/admin_views/tests.py'}, 'id': '72336f80-53b6-4258-9c6a-f7f7a7e716ba', 'type': 'tool_call'}] usage_metadata={'input_tokens': 53516, 'output_tokens': 104, 'total_tokens': 53977, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 357}}
2025-10-06 21:05:30,313 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I have begun reviewing the test file `tests/admin_views/tests.py` to find test cases related to the dynamic alteration of `ModelAdmin` configuration. So far, I have examined the initial section of the file and will continue to search for tests covering methods like `get_fieldsets()` and `get_readonly_fields()`. I will keep you updated on my progress.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/admin_views/tests.py", "start_line": 501.0, "end_line": 1001.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 62583, 'candidates_token_count': 108, 'total_token_count': 62773, 'cached_content_token_count': 52024, 'prompt_tokens_details': [{'modality': 1, 'token_count': 62583}], 'cache_tokens_details': [{'modality': 1, 'token_count': 52024}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 108}], 'thoughts_token_count': 82}, 'finish_reason': 'STOP', 'avg_logprobs': -0.16444479977643048, 'model_name': 'gemini-2.5-pro'} id='run--8257a633-02a5-405e-8ea1-26ca908c8a2f-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/admin_views/tests.py', 'start_line': 501.0, 'end_line': 1001.0}, 'id': '9bd99a73-b1ca-42c7-98dd-be89ee261efb', 'type': 'tool_call'}] usage_metadata={'input_tokens': 62583, 'output_tokens': 108, 'total_tokens': 62773, 'input_token_details': {'cache_read': 52024}, 'output_token_details': {'reasoning': 82}}
2025-10-06 21:05:34,079 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I am continuing to review the test file `tests/admin_views/tests.py` for relevant test cases. I have now analyzed the file up to line 1001 and will proceed to the next section to ensure I cover all pertinent tests for methods like `get_fieldsets()` and `get_readonly_fields()`. I will provide an update once I have completed this next step.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/admin_views/tests.py", "start_line": 1001.0, "end_line": 1501.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 73016, 'candidates_token_count': 112, 'total_token_count': 73128, 'cached_content_token_count': 51855, 'prompt_tokens_details': [{'modality': 1, 'token_count': 73016}], 'cache_tokens_details': [{'modality': 1, 'token_count': 51855}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 112}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.11756608315876552, 'model_name': 'gemini-2.5-pro'} id='run--12f7e7c7-94c3-428d-b0bb-5a77d157d76d-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/admin_views/tests.py', 'start_line': 1001.0, 'end_line': 1501.0}, 'id': '15ce71cd-5d70-4bba-9349-6a3a34bb1939', 'type': 'tool_call'}] usage_metadata={'input_tokens': 73016, 'output_tokens': 112, 'total_tokens': 73128, 'input_token_details': {'cache_read': 51855}}
2025-10-06 21:05:37,826 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I am continuing my search for relevant test cases in `tests/admin_views/tests.py`. I have now examined the file up to line 1501 and will proceed to the next section to ensure I cover all pertinent tests for methods like `get_fieldsets()` and `get_readonly_fields()`. I will provide an update once I have completed this next step.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 1501.0, "relative_path": "tests/admin_views/tests.py", "end_line": 2001.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 83095, 'candidates_token_count': 109, 'total_token_count': 83204, 'cached_content_token_count': 71632, 'prompt_tokens_details': [{'modality': 1, 'token_count': 83095}], 'cache_tokens_details': [{'modality': 1, 'token_count': 71632}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 109}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.052728184866249014, 'model_name': 'gemini-2.5-pro'} id='run--c8daa046-9cba-47d9-9157-2f2a10350e0e-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 1501.0, 'relative_path': 'tests/admin_views/tests.py', 'end_line': 2001.0}, 'id': 'c196ec04-ae36-4598-a6c4-fde4a8e9ba9a', 'type': 'tool_call'}] usage_metadata={'input_tokens': 83095, 'output_tokens': 109, 'total_tokens': 83204, 'input_token_details': {'cache_read': 71632}}
2025-10-06 21:05:41,145 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I am continuing to search for relevant test cases in `tests/admin_views/tests.py`. I have now examined the file up to line 2001 and will proceed to the next section to ensure I cover all pertinent tests for methods like `get_fieldsets()` and `get_readonly_fields()`. I will provide an update once I have completed this next step.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/admin_views/tests.py", "start_line": 2001.0, "end_line": 2501.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 93915, 'candidates_token_count': 109, 'total_token_count': 94024, 'cached_content_token_count': 79578, 'prompt_tokens_details': [{'modality': 1, 'token_count': 93915}], 'cache_tokens_details': [{'modality': 1, 'token_count': 79578}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 109}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.045648675446116595, 'model_name': 'gemini-2.5-pro'} id='run--ce6830fa-7f44-42bc-9966-8a89d9c060a0-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/admin_views/tests.py', 'start_line': 2001.0, 'end_line': 2501.0}, 'id': 'ea221d66-eb95-44a1-8e95-91c59ba813a3', 'type': 'tool_call'}] usage_metadata={'input_tokens': 93915, 'output_tokens': 109, 'total_tokens': 94024, 'input_token_details': {'cache_read': 79578}}
2025-10-06 21:05:44,114 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I am continuing my search for relevant test cases in `tests/admin_views/tests.py`. I have now examined the file up to line 2501 and will proceed to the next section to ensure I cover all pertinent tests for methods like `get_fieldsets()` and `get_readonly_fields()`. I will provide an update once I have completed this next step.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/admin_views/tests.py", "start_line": 2501.0, "end_line": 3001.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 103962, 'candidates_token_count': 109, 'total_token_count': 104071, 'cached_content_token_count': 91511, 'prompt_tokens_details': [{'modality': 1, 'token_count': 103962}], 'cache_tokens_details': [{'modality': 1, 'token_count': 91511}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 109}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.014541181949300503, 'model_name': 'gemini-2.5-pro'} id='run--67ad9638-031e-49d4-9511-244891460cee-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/admin_views/tests.py', 'start_line': 2501.0, 'end_line': 3001.0}, 'id': 'cb122c1e-2e72-45ce-b2fb-044836dd0f63', 'type': 'tool_call'}] usage_metadata={'input_tokens': 103962, 'output_tokens': 109, 'total_tokens': 104071, 'input_token_details': {'cache_read': 91511}}
2025-10-06 21:05:46,807 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I am continuing my search for relevant test cases in `tests/admin_views/tests.py`. I have now examined the file up to line 3001 and will proceed to the next section to ensure I cover all pertinent tests for methods like `get_fieldsets()` and `get_readonly_fields()`. I will provide an update once I have completed this next step.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/admin_views/tests.py", "start_line": 3001.0, "end_line": 3501.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 114715, 'candidates_token_count': 109, 'total_token_count': 114824, 'cached_content_token_count': 103430, 'prompt_tokens_details': [{'modality': 1, 'token_count': 114715}], 'cache_tokens_details': [{'modality': 1, 'token_count': 103430}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 109}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.01061909789339118, 'model_name': 'gemini-2.5-pro'} id='run--d9ec511c-c99d-4ddb-9480-8f7cba87c5cf-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/admin_views/tests.py', 'start_line': 3001.0, 'end_line': 3501.0}, 'id': '6584b4b5-4638-4ecd-b128-cdf1cd7c6583', 'type': 'tool_call'}] usage_metadata={'input_tokens': 114715, 'output_tokens': 109, 'total_tokens': 114824, 'input_token_details': {'cache_read': 103430}}
2025-10-06 21:05:50,439 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I am continuing my search for relevant test cases in `tests/admin_views/tests.py`. I have now examined the file up to line 3501 and will proceed to the next section to ensure I cover all pertinent tests for methods like `get_fieldsets()` and `get_readonly_fields()`. I will provide an update once I have completed this next step.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 3501.0, "relative_path": "tests/admin_views/tests.py", "end_line": 4001.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 124142, 'candidates_token_count': 109, 'total_token_count': 124251, 'cached_content_token_count': 111370, 'prompt_tokens_details': [{'modality': 1, 'token_count': 124142}], 'cache_tokens_details': [{'modality': 1, 'token_count': 111370}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 109}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.00702517021686659, 'model_name': 'gemini-2.5-pro'} id='run--bf726415-e084-4628-a00c-e9dcf076a0f5-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 3501.0, 'relative_path': 'tests/admin_views/tests.py', 'end_line': 4001.0}, 'id': '0d678a32-9729-4648-8350-729d262d7cd4', 'type': 'tool_call'}] usage_metadata={'input_tokens': 124142, 'output_tokens': 109, 'total_tokens': 124251, 'input_token_details': {'cache_read': 111370}}
2025-10-06 21:05:53,098 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I am continuing my search for relevant test cases in `tests/admin_views/tests.py`. I have now examined the file up to line 4001 and will proceed to the next section to ensure I cover all pertinent tests for methods like `get_fieldsets()` and `get_readonly_fields()`. I will provide an update once I have completed this next step.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/admin_views/tests.py", "start_line": 4001.0, "end_line": 4501.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 133462, 'candidates_token_count': 109, 'total_token_count': 133571, 'cached_content_token_count': 123308, 'prompt_tokens_details': [{'modality': 1, 'token_count': 133462}], 'cache_tokens_details': [{'modality': 1, 'token_count': 123308}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 109}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.006560856596045538, 'model_name': 'gemini-2.5-pro'} id='run--7803cb63-c064-400c-96f4-4d0b788543b4-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/admin_views/tests.py', 'start_line': 4001.0, 'end_line': 4501.0}, 'id': '3f8b0ec2-a85d-4429-8f7a-ede77183c182', 'type': 'tool_call'}] usage_metadata={'input_tokens': 133462, 'output_tokens': 109, 'total_tokens': 133571, 'input_token_details': {'cache_read': 123308}}
2025-10-06 21:05:55,920 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I am continuing my search for relevant test cases in `tests/admin_views/tests.py`. I have now examined the file up to line 4501 and will proceed to the next section to ensure I cover all pertinent tests for methods like `get_fieldsets()` and `get_readonly_fields()`. I will provide an update once I have completed this next step.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/admin_views/tests.py", "start_line": 4501.0, "end_line": 5001.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 144509, 'candidates_token_count': 109, 'total_token_count': 144618, 'cached_content_token_count': 131223, 'prompt_tokens_details': [{'modality': 1, 'token_count': 144509}], 'cache_tokens_details': [{'modality': 1, 'token_count': 131223}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 109}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.00958186223966266, 'model_name': 'gemini-2.5-pro'} id='run--8e0e0a7a-0cf7-434f-9e64-3263a13b8bb9-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/admin_views/tests.py', 'start_line': 4501.0, 'end_line': 5001.0}, 'id': '5e7ece51-b416-49d4-b281-8d746aaa6f06', 'type': 'tool_call'}] usage_metadata={'input_tokens': 144509, 'output_tokens': 109, 'total_tokens': 144618, 'input_token_details': {'cache_read': 131223}}
2025-10-06 21:05:59,227 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I am continuing my search for relevant test cases in `tests/admin_views/tests.py`. I have now examined the file up to line 5001 and will proceed to the next section to ensure I cover all pertinent tests for methods like `get_fieldsets()` and `get_readonly_fields()`. I will provide an update once I have completed this next step.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/admin_views/tests.py", "start_line": 5001.0, "end_line": 5501.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 155798, 'candidates_token_count': 109, 'total_token_count': 155907, 'cached_content_token_count': 143189, 'prompt_tokens_details': [{'modality': 1, 'token_count': 155798}], 'cache_tokens_details': [{'modality': 1, 'token_count': 143189}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 109}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.014052309027505577, 'model_name': 'gemini-2.5-pro'} id='run--74086bc7-3b15-4ef3-933c-4aa1817d939d-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/admin_views/tests.py', 'start_line': 5001.0, 'end_line': 5501.0}, 'id': '044e0758-9f7d-49d6-ae92-21ea246225d9', 'type': 'tool_call'}] usage_metadata={'input_tokens': 155798, 'output_tokens': 109, 'total_tokens': 155907, 'input_token_details': {'cache_read': 143189}}
2025-10-06 21:06:03,001 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I am continuing my search for relevant test cases in `tests/admin_views/tests.py`. I have now examined the file up to line 5501 and will proceed to the next section to ensure I cover all pertinent tests for methods like `get_fieldsets()` and `get_readonly_fields()`. I will provide an update once I have completed this next step.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 5501.0, "relative_path": "tests/admin_views/tests.py", "end_line": 5567.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 165724, 'candidates_token_count': 109, 'total_token_count': 165833, 'cached_content_token_count': 155006, 'prompt_tokens_details': [{'modality': 1, 'token_count': 165724}], 'cache_tokens_details': [{'modality': 1, 'token_count': 155006}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 109}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.06049549032788758, 'model_name': 'gemini-2.5-pro'} id='run--80fbfb5e-e154-45ab-a24d-2ca9aead132a-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 5501.0, 'relative_path': 'tests/admin_views/tests.py', 'end_line': 5567.0}, 'id': 'a18a0847-15ec-4fff-9b47-85f271da339d', 'type': 'tool_call'}] usage_metadata={'input_tokens': 165724, 'output_tokens': 109, 'total_tokens': 165833, 'input_token_details': {'cache_read': 155006}}
2025-10-06 21:06:08,745 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I have completed my review of `tests/admin_views/tests.py` and found several relevant test cases. The `ReadonlyTest` class (lines 4815-4990) contains tests for `readonly_fields`, including `test_readonly_get`, `test_readonly_post`, and `test_readonly_manytomany`. The `AdminViewPermissionsTest` class (lines 1405-2406) includes tests for `get_fieldsets` in the `test_add_view` and `test_change_view` methods, which dynamically alter the available fields based on user permissions. Additionally, `AdminViewBasicTest` (lines 188-995) contains tests for `get_readonly_fields` in the `test_change_view_without_object_change_permission` method. These should provide a comprehensive overview of how to test dynamic `ModelAdmin` configurations.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/admin_views/tests.py", "start_line": 188.0, "end_line": 995.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 167065, 'candidates_token_count': 288, 'total_token_count': 167353, 'cached_content_token_count': 162896, 'prompt_tokens_details': [{'modality': 1, 'token_count': 167065}], 'cache_tokens_details': [{'modality': 1, 'token_count': 162896}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 288}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.12040491898854573, 'model_name': 'gemini-2.5-pro'} id='run--628b72fe-0bdc-4216-955e-4c1409f17c00-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 4815.0, 'relative_path': 'tests/admin_views/tests.py', 'end_line': 4990.0}, 'id': '918e8b9a-a9be-4c73-ab1c-e1af24518c56', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'start_line': 1405.0, 'relative_path': 'tests/admin_views/tests.py', 'end_line': 2406.0}, 'id': '87ef2972-550c-4439-a8f9-93d28a237fae', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/admin_views/tests.py', 'start_line': 188.0, 'end_line': 995.0}, 'id': '164dd4a0-e269-4183-b04f-97ebff60b812', 'type': 'tool_call'}] usage_metadata={'input_tokens': 167065, 'output_tokens': 288, 'total_tokens': 167353, 'input_token_details': {'cache_read': 162896}}
2025-10-06 21:06:22,900 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I have found several relevant test cases in `tests/admin_views/tests.py` that demonstrate how to test `ModelAdmin` methods that dynamically alter configuration based on the request or object.\n\nThe `ReadonlyTest` class (lines 4815-4990) provides comprehensive coverage for `readonly_fields`. Key tests in this class include `test_readonly_get`, `test_readonly_post`, `test_readonly_manytomany`, and `test_readonly_onetoone_backwards_ref`. These tests verify that readonly fields are correctly displayed and that their values cannot be modified.\n\nThe `AdminViewPermissionsTest` class (lines 1405-2406) contains tests that show how user permissions can dynamically alter the available fields. The `test_add_view` and `test_change_view` methods demonstrate how `get_fieldsets` can be used to control which fields are displayed based on the user’s permissions. Additionally, `test_change_view_without_object_change_permission` in the same class and `test_change_view_with_show_delete_extra_context` in the `AdminViewBasicTest` class (lines 188-995) are relevant to `get_readonly_fields`.\n\nThese examples should provide a solid foundation for understanding how to test dynamic `ModelAdmin` configurations in your own projects.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 207062, 'candidates_token_count': 300, 'total_token_count': 207795, 'cached_content_token_count': 166706, 'prompt_tokens_details': [{'modality': 1, 'token_count': 207062}], 'cache_tokens_details': [{'modality': 1, 'token_count': 166706}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 300}], 'thoughts_token_count': 433}, 'finish_reason': 'STOP', 'avg_logprobs': -0.21217539469401042, 'model_name': 'gemini-2.5-pro'} id='run--9aca6361-521e-45bf-b2ed-2560ff164e14-0' usage_metadata={'input_tokens': 207062, 'output_tokens': 300, 'total_tokens': 207795, 'input_token_details': {'cache_read': 166706}, 'output_token_details': {'reasoning': 433}}
2025-10-06 21:06:22,901 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - INFO - Starting context extraction process
2025-10-06 21:06:22,906 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - DEBUG - This is the original user query:

--- BEGIN ORIGINAL QUERY ---
Issue title:
add ModelAdmin.get_inlines() hook to allow set inlines based on the request or model instance.

Issue description: 
Description
	
add ModelAdmin.get_inlines() hook to allow set inlines based on the request or model instance.
Currently, We can override the method get_inline_instances to do such a thing, but a for loop should be copied to my code. So I wished add a hook get_inlines(request, obj=None)

Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

This is the refinement query. Please consider it together with the original query. It's really IMPORTANT!!!

--- BEGIN REFINEMENT QUERY ---
Please provide test cases from `tests/admin_views/tests.py` for `ModelAdmin` methods that dynamically alter configuration based on the request or object. Specifically, I am interested in tests for `get_fieldsets()`, `get_readonly_fields()`, and other similar `get_*` methods.
--- END REFINEMENT QUERY ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/admin_views/tests.py
Line number range: 1 - 500
Content:
1. import datetime
2. import os
3. import re
4. import unittest
5. from unittest import mock
6. from urllib.parse import parse_qsl, urljoin, urlparse
7. 
8. import pytz
9. 
10. from django.contrib.admin import AdminSite, ModelAdmin
11. from django.contrib.admin.helpers import ACTION_CHECKBOX_NAME
12. from django.contrib.admin.models import ADDITION, DELETION, LogEntry
13. from django.contrib.admin.options import TO_FIELD_VAR
14. from django.contrib.admin.templatetags.admin_urls import add_preserved_filters
15. from django.contrib.admin.tests import AdminSeleniumTestCase
16. from django.contrib.admin.utils import quote
17. from django.contrib.admin.views.main import IS_POPUP_VAR
18. from django.contrib.auth import REDIRECT_FIELD_NAME, get_permission_codename
19. from django.contrib.auth.models import Group, Permission, User
20. from django.contrib.contenttypes.models import ContentType
21. from django.core import mail
22. from django.core.checks import Error
23. from django.core.files import temp as tempfile
24. from django.forms.utils import ErrorList
25. from django.template.response import TemplateResponse
26. from django.test import (
27.     TestCase, modify_settings, override_settings, skipUnlessDBFeature,
28. )
29. from django.test.utils import override_script_prefix
30. from django.urls import NoReverseMatch, resolve, reverse
31. from django.utils import formats, translation
32. from django.utils.cache import get_max_age
33. from django.utils.encoding import iri_to_uri
34. from django.utils.html import escape
35. from django.utils.http import urlencode
36. 
37. from . import customadmin
38. from .admin import CityAdmin, site, site2
39. from .models import (
40.     Actor, AdminOrderedAdminMethod, AdminOrderedCallable, AdminOrderedField,
41.     AdminOrderedModelMethod, Answer, Answer2, Article, BarAccount, Book,
42.     Bookmark, Category, Chapter, ChapterXtra1, ChapterXtra2, Character, Child,
43.     Choice, City, Collector, Color, ComplexSortedPerson, CoverLetter,
44.     CustomArticle, CyclicOne, CyclicTwo, DooHickey, Employee, EmptyModel,
45.     Fabric, FancyDoodad, FieldOverridePost, FilteredManager, FooAccount,
46.     FoodDelivery, FunkyTag, Gallery, Grommet, Inquisition, Language, Link,
47.     MainPrepopulated, Media, ModelWithStringPrimaryKey, OtherStory, Paper,
48.     Parent, ParentWithDependentChildren, ParentWithUUIDPK, Person, Persona,
49.     Picture, Pizza, Plot, PlotDetails, PluggableSearchPerson, Podcast, Post,
50.     PrePopulatedPost, Promo, Question, ReadablePizza, ReadOnlyPizza,
51.     Recommendation, Recommender, RelatedPrepopulated, RelatedWithUUIDPKModel,
52.     Report, Restaurant, RowLevelChangePermissionModel, SecretHideout, Section,
53.     ShortMessage, Simple, State, Story, SuperSecretHideout, SuperVillain,
54.     Telegram, TitleTranslation, Topping, UnchangeableObject, UndeletableObject,
55.     UnorderedObject, UserProxy, Villain, Vodcast, Whatsit, Widget, Worker,
56.     WorkHour,
57. )
58. 
59. ERROR_MESSAGE = "Please enter the correct username and password \
60. for a staff account. Note that both fields may be case-sensitive."
61. 
62. MULTIPART_ENCTYPE = 'enctype="multipart/form-data"'
63. 
64. 
65. class AdminFieldExtractionMixin:
66.     """
67.     Helper methods for extracting data from AdminForm.
68.     """
69.     def get_admin_form_fields(self, response):
70.         """
71.         Return a list of AdminFields for the AdminForm in the response.
72.         """
73.         fields = []
74.         for fieldset in response.context['adminform']:
75.             for field_line in fieldset:
76.                 fields.extend(field_line)
77.         return fields
78. 
79.     def get_admin_readonly_fields(self, response):
80.         """
81.         Return the readonly fields for the response's AdminForm.
82.         """
83.         return [f for f in self.get_admin_form_fields(response) if f.is_readonly]
84. 
85.     def get_admin_readonly_field(self, response, field_name):
86.         """
87.         Return the readonly field for the given field_name.
88.         """
89.         admin_readonly_fields = self.get_admin_readonly_fields(response)
90.         for field in admin_readonly_fields:
91.             if field.field['name'] == field_name:
92.                 return field
93. 
94. 
95. @override_settings(ROOT_URLCONF='admin_views.urls', USE_I18N=True, USE_L10N=False, LANGUAGE_CODE='en')
96. class AdminViewBasicTestCase(TestCase):
97. 
98.     @classmethod
99.     def setUpTestData(cls):
100.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
101.         cls.s1 = Section.objects.create(name='Test section')
102.         cls.a1 = Article.objects.create(
103.             content='<p>Middle content</p>', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1
104.         )
105.         cls.a2 = Article.objects.create(
106.             content='<p>Oldest content</p>', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1
107.         )
108.         cls.a3 = Article.objects.create(
109.             content='<p>Newest content</p>', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1
110.         )
111.         cls.p1 = PrePopulatedPost.objects.create(title='A Long Title', published=True, slug='a-long-title')
112.         cls.color1 = Color.objects.create(value='Red', warm=True)
113.         cls.color2 = Color.objects.create(value='Orange', warm=True)
114.         cls.color3 = Color.objects.create(value='Blue', warm=False)
115.         cls.color4 = Color.objects.create(value='Green', warm=False)
116.         cls.fab1 = Fabric.objects.create(surface='x')
117.         cls.fab2 = Fabric.objects.create(surface='y')
118.         cls.fab3 = Fabric.objects.create(surface='plain')
119.         cls.b1 = Book.objects.create(name='Book 1')
120.         cls.b2 = Book.objects.create(name='Book 2')
121.         cls.pro1 = Promo.objects.create(name='Promo 1', book=cls.b1)
122.         cls.pro1 = Promo.objects.create(name='Promo 2', book=cls.b2)
123.         cls.chap1 = Chapter.objects.create(title='Chapter 1', content='[ insert contents here ]', book=cls.b1)
124.         cls.chap2 = Chapter.objects.create(title='Chapter 2', content='[ insert contents here ]', book=cls.b1)
125.         cls.chap3 = Chapter.objects.create(title='Chapter 1', content='[ insert contents here ]', book=cls.b2)
126.         cls.chap4 = Chapter.objects.create(title='Chapter 2', content='[ insert contents here ]', book=cls.b2)
127.         cls.cx1 = ChapterXtra1.objects.create(chap=cls.chap1, xtra='ChapterXtra1 1')
128.         cls.cx2 = ChapterXtra1.objects.create(chap=cls.chap3, xtra='ChapterXtra1 2')
129.         Actor.objects.create(name='Palin', age=27)
130. 
131.         # Post data for edit inline
132.         cls.inline_post_data = {
133.             "name": "Test section",
134.             # inline data
135.             "article_set-TOTAL_FORMS": "6",
136.             "article_set-INITIAL_FORMS": "3",
137.             "article_set-MAX_NUM_FORMS": "0",
138.             "article_set-0-id": cls.a1.pk,
139.             # there is no title in database, give one here or formset will fail.
140.             "article_set-0-title": "Norske bostaver æøå skaper problemer",
141.             "article_set-0-content": "&lt;p&gt;Middle content&lt;/p&gt;",
142.             "article_set-0-date_0": "2008-03-18",
143.             "article_set-0-date_1": "11:54:58",
144.             "article_set-0-section": cls.s1.pk,
145.             "article_set-1-id": cls.a2.pk,
146.             "article_set-1-title": "Need a title.",
147.             "article_set-1-content": "&lt;p&gt;Oldest content&lt;/p&gt;",
148.             "article_set-1-date_0": "2000-03-18",
149.             "article_set-1-date_1": "11:54:58",
150.             "article_set-2-id": cls.a3.pk,
151.             "article_set-2-title": "Need a title.",
152.             "article_set-2-content": "&lt;p&gt;Newest content&lt;/p&gt;",
153.             "article_set-2-date_0": "2009-03-18",
154.             "article_set-2-date_1": "11:54:58",
155.             "article_set-3-id": "",
156.             "article_set-3-title": "",
157.             "article_set-3-content": "",
158.             "article_set-3-date_0": "",
159.             "article_set-3-date_1": "",
160.             "article_set-4-id": "",
161.             "article_set-4-title": "",
162.             "article_set-4-content": "",
163.             "article_set-4-date_0": "",
164.             "article_set-4-date_1": "",
165.             "article_set-5-id": "",
166.             "article_set-5-title": "",
167.             "article_set-5-content": "",
168.             "article_set-5-date_0": "",
169.             "article_set-5-date_1": "",
170.         }
171. 
172.     def setUp(self):
173.         self.client.force_login(self.superuser)
174. 
175.     def assertContentBefore(self, response, text1, text2, failing_msg=None):
176.         """
177.         Testing utility asserting that text1 appears before text2 in response
178.         content.
179.         """
180.         self.assertEqual(response.status_code, 200)
181.         self.assertLess(
182.             response.content.index(text1.encode()),
183.             response.content.index(text2.encode()),
184.             (failing_msg or '') + '\nResponse:\n' + response.content.decode(response.charset)
185.         )
186. 
187. 
188. class AdminViewBasicTest(AdminViewBasicTestCase):
189.     def test_trailing_slash_required(self):
190.         """
191.         If you leave off the trailing slash, app should redirect and add it.
192.         """
193.         add_url = reverse('admin:admin_views_article_add')
194.         response = self.client.get(add_url[:-1])
195.         self.assertRedirects(response, add_url, status_code=301)
196. 
197.     def test_basic_add_GET(self):
198.         """
199.         A smoke test to ensure GET on the add_view works.
200.         """
201.         response = self.client.get(reverse('admin:admin_views_section_add'))
202.         self.assertIsInstance(response, TemplateResponse)
203.         self.assertEqual(response.status_code, 200)
204. 
205.     def test_add_with_GET_args(self):
206.         response = self.client.get(reverse('admin:admin_views_section_add'), {'name': 'My Section'})
207.         self.assertContains(
208.             response, 'value="My Section"',
209.             msg_prefix="Couldn't find an input with the right value in the response"
210.         )
211. 
212.     def test_basic_edit_GET(self):
213.         """
214.         A smoke test to ensure GET on the change_view works.
215.         """
216.         response = self.client.get(reverse('admin:admin_views_section_change', args=(self.s1.pk,)))
217.         self.assertIsInstance(response, TemplateResponse)
218.         self.assertEqual(response.status_code, 200)
219. 
220.     def test_basic_edit_GET_string_PK(self):
221.         """
222.         GET on the change_view (when passing a string as the PK argument for a
223.         model with an integer PK field) redirects to the index page with a
224.         message saying the object doesn't exist.
225.         """
226.         response = self.client.get(reverse('admin:admin_views_section_change', args=(quote("abc/<b>"),)), follow=True)
227.         self.assertRedirects(response, reverse('admin:index'))
228.         self.assertEqual(
229.             [m.message for m in response.context['messages']],
230.             ["""section with ID "abc/<b>" doesn't exist. Perhaps it was deleted?"""]
231.         )
232. 
233.     def test_basic_edit_GET_old_url_redirect(self):
234.         """
235.         The change URL changed in Django 1.9, but the old one still redirects.
236.         """
237.         response = self.client.get(
238.             reverse('admin:admin_views_section_change', args=(self.s1.pk,)).replace('change/', '')
239.         )
240.         self.assertRedirects(response, reverse('admin:admin_views_section_change', args=(self.s1.pk,)))
241. 
242.     def test_basic_inheritance_GET_string_PK(self):
243.         """
244.         GET on the change_view (for inherited models) redirects to the index
245.         page with a message saying the object doesn't exist.
246.         """
247.         response = self.client.get(reverse('admin:admin_views_supervillain_change', args=('abc',)), follow=True)
248.         self.assertRedirects(response, reverse('admin:index'))
249.         self.assertEqual(
250.             [m.message for m in response.context['messages']],
251.             ["""super villain with ID "abc" doesn't exist. Perhaps it was deleted?"""]
252.         )
253. 
254.     def test_basic_add_POST(self):
255.         """
256.         A smoke test to ensure POST on add_view works.
257.         """
258.         post_data = {
259.             "name": "Another Section",
260.             # inline data
261.             "article_set-TOTAL_FORMS": "3",
262.             "article_set-INITIAL_FORMS": "0",
263.             "article_set-MAX_NUM_FORMS": "0",
264.         }
265.         response = self.client.post(reverse('admin:admin_views_section_add'), post_data)
266.         self.assertEqual(response.status_code, 302)  # redirect somewhere
267. 
268.     def test_popup_add_POST(self):
269.         """
270.         Ensure http response from a popup is properly escaped.
271.         """
272.         post_data = {
273.             '_popup': '1',
274.             'title': 'title with a new\nline',
275.             'content': 'some content',
276.             'date_0': '2010-09-10',
277.             'date_1': '14:55:39',
278.         }
279.         response = self.client.post(reverse('admin:admin_views_article_add'), post_data)
280.         self.assertContains(response, 'title with a new\\nline')
281. 
282.     def test_basic_edit_POST(self):
283.         """
284.         A smoke test to ensure POST on edit_view works.
285.         """
286.         url = reverse('admin:admin_views_section_change', args=(self.s1.pk,))
287.         response = self.client.post(url, self.inline_post_data)
288.         self.assertEqual(response.status_code, 302)  # redirect somewhere
289. 
290.     def test_edit_save_as(self):
291.         """
292.         Test "save as".
293.         """
294.         post_data = self.inline_post_data.copy()
295.         post_data.update({
296.             '_saveasnew': 'Save+as+new',
297.             "article_set-1-section": "1",
298.             "article_set-2-section": "1",
299.             "article_set-3-section": "1",
300.             "article_set-4-section": "1",
301.             "article_set-5-section": "1",
302.         })
303.         response = self.client.post(reverse('admin:admin_views_section_change', args=(self.s1.pk,)), post_data)
304.         self.assertEqual(response.status_code, 302)  # redirect somewhere
305. 
306.     def test_edit_save_as_delete_inline(self):
307.         """
308.         Should be able to "Save as new" while also deleting an inline.
309.         """
310.         post_data = self.inline_post_data.copy()
311.         post_data.update({
312.             '_saveasnew': 'Save+as+new',
313.             "article_set-1-section": "1",
314.             "article_set-2-section": "1",
315.             "article_set-2-DELETE": "1",
316.             "article_set-3-section": "1",
317.         })
318.         response = self.client.post(reverse('admin:admin_views_section_change', args=(self.s1.pk,)), post_data)
319.         self.assertEqual(response.status_code, 302)
320.         # started with 3 articles, one was deleted.
321.         self.assertEqual(Section.objects.latest('id').article_set.count(), 2)
322. 
323.     def test_change_list_column_field_classes(self):
324.         response = self.client.get(reverse('admin:admin_views_article_changelist'))
325.         # callables display the callable name.
326.         self.assertContains(response, 'column-callable_year')
327.         self.assertContains(response, 'field-callable_year')
328.         # lambdas display as "lambda" + index that they appear in list_display.
329.         self.assertContains(response, 'column-lambda8')
330.         self.assertContains(response, 'field-lambda8')
331. 
332.     def test_change_list_sorting_callable(self):
333.         """
334.         Ensure we can sort on a list_display field that is a callable
335.         (column 2 is callable_year in ArticleAdmin)
336.         """
337.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': 2})
338.         self.assertContentBefore(
339.             response, 'Oldest content', 'Middle content',
340.             "Results of sorting on callable are out of order."
341.         )
342.         self.assertContentBefore(
343.             response, 'Middle content', 'Newest content',
344.             "Results of sorting on callable are out of order."
345.         )
346. 
347.     def test_change_list_sorting_property(self):
348.         """
349.         Sort on a list_display field that is a property (column 10 is
350.         a property in Article model).
351.         """
352.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': 10})
353.         self.assertContentBefore(
354.             response,
355.             'Oldest content',
356.             'Middle content',
357.             'Results of sorting on property are out of order.',
358.         )
359.         self.assertContentBefore(
360.             response,
361.             'Middle content',
362.             'Newest content',
363.             'Results of sorting on property are out of order.',
364.         )
365. 
366.     def test_change_list_sorting_callable_query_expression(self):
367.         """
368.         Query expressions may be used for admin_order_field. (column 9 is
369.         order_by_expression in ArticleAdmin).
370.         """
371.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': '9'})
372.         self.assertContentBefore(
373.             response, 'Oldest content', 'Middle content',
374.             'Results of sorting on callable are out of order.'
375.         )
376.         self.assertContentBefore(
377.             response, 'Middle content', 'Newest content',
378.             'Results of sorting on callable are out of order.'
379.         )
380. 
381.     def test_change_list_sorting_callable_query_expression_reverse(self):
382.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': '-9'})
383.         self.assertContentBefore(
384.             response, 'Middle content', 'Oldest content',
385.             'Results of sorting on callable are out of order.'
386.         )
387.         self.assertContentBefore(
388.             response, 'Newest content', 'Middle content',
389.             'Results of sorting on callable are out of order.'
390.         )
391. 
392.     def test_change_list_sorting_model(self):
393.         """
394.         Ensure we can sort on a list_display field that is a Model method
395.         (column 3 is 'model_year' in ArticleAdmin)
396.         """
397.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': '-3'})
398.         self.assertContentBefore(
399.             response, 'Newest content', 'Middle content',
400.             "Results of sorting on Model method are out of order."
401.         )
402.         self.assertContentBefore(
403.             response, 'Middle content', 'Oldest content',
404.             "Results of sorting on Model method are out of order."
405.         )
406. 
407.     def test_change_list_sorting_model_admin(self):
408.         """
409.         Ensure we can sort on a list_display field that is a ModelAdmin method
410.         (column 4 is 'modeladmin_year' in ArticleAdmin)
411.         """
412.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': '4'})
413.         self.assertContentBefore(
414.             response, 'Oldest content', 'Middle content',
415.             "Results of sorting on ModelAdmin method are out of order."
416.         )
417.         self.assertContentBefore(
418.             response, 'Middle content', 'Newest content',
419.             "Results of sorting on ModelAdmin method are out of order."
420.         )
421. 
422.     def test_change_list_sorting_model_admin_reverse(self):
423.         """
424.         Ensure we can sort on a list_display field that is a ModelAdmin
425.         method in reverse order (i.e. admin_order_field uses the '-' prefix)
426.         (column 6 is 'model_year_reverse' in ArticleAdmin)
427.         """
428.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': '6'})
429.         self.assertContentBefore(
430.             response, '2009', '2008',
431.             "Results of sorting on ModelAdmin method are out of order."
432.         )
433.         self.assertContentBefore(
434.             response, '2008', '2000',
435.             "Results of sorting on ModelAdmin method are out of order."
436.         )
437.         # Let's make sure the ordering is right and that we don't get a
438.         # FieldError when we change to descending order
439.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': '-6'})
440.         self.assertContentBefore(
441.             response, '2000', '2008',
442.             "Results of sorting on ModelAdmin method are out of order."
443.         )
444.         self.assertContentBefore(
445.             response, '2008', '2009',
446.             "Results of sorting on ModelAdmin method are out of order."
447.         )
448. 
449.     def test_change_list_sorting_multiple(self):
450.         p1 = Person.objects.create(name="Chris", gender=1, alive=True)
451.         p2 = Person.objects.create(name="Chris", gender=2, alive=True)
452.         p3 = Person.objects.create(name="Bob", gender=1, alive=True)
453.         link1 = reverse('admin:admin_views_person_change', args=(p1.pk,))
454.         link2 = reverse('admin:admin_views_person_change', args=(p2.pk,))
455.         link3 = reverse('admin:admin_views_person_change', args=(p3.pk,))
456. 
457.         # Sort by name, gender
458.         response = self.client.get(reverse('admin:admin_views_person_changelist'), {'o': '1.2'})
459.         self.assertContentBefore(response, link3, link1)
460.         self.assertContentBefore(response, link1, link2)
461. 
462.         # Sort by gender descending, name
463.         response = self.client.get(reverse('admin:admin_views_person_changelist'), {'o': '-2.1'})
464.         self.assertContentBefore(response, link2, link3)
465.         self.assertContentBefore(response, link3, link1)
466. 
467.     def test_change_list_sorting_preserve_queryset_ordering(self):
468.         """
469.         If no ordering is defined in `ModelAdmin.ordering` or in the query
470.         string, then the underlying order of the queryset should not be
471.         changed, even if it is defined in `Modeladmin.get_queryset()`.
472.         Refs #11868, #7309.
473.         """
474.         p1 = Person.objects.create(name="Amy", gender=1, alive=True, age=80)
475.         p2 = Person.objects.create(name="Bob", gender=1, alive=True, age=70)
476.         p3 = Person.objects.create(name="Chris", gender=2, alive=False, age=60)
477.         link1 = reverse('admin:admin_views_person_change', args=(p1.pk,))
478.         link2 = reverse('admin:admin_views_person_change', args=(p2.pk,))
479.         link3 = reverse('admin:admin_views_person_change', args=(p3.pk,))
480. 
481.         response = self.client.get(reverse('admin:admin_views_person_changelist'), {})
482.         self.assertContentBefore(response, link3, link2)
483.         self.assertContentBefore(response, link2, link1)
484. 
485.     def test_change_list_sorting_model_meta(self):
486.         # Test ordering on Model Meta is respected
487. 
488.         l1 = Language.objects.create(iso='ur', name='Urdu')
489.         l2 = Language.objects.create(iso='ar', name='Arabic')
490.         link1 = reverse('admin:admin_views_language_change', args=(quote(l1.pk),))
491.         link2 = reverse('admin:admin_views_language_change', args=(quote(l2.pk),))
492. 
493.         response = self.client.get(reverse('admin:admin_views_language_changelist'), {})
494.         self.assertContentBefore(response, link2, link1)
495. 
496.         # Test we can override with query string
497.         response = self.client.get(reverse('admin:admin_views_language_changelist'), {'o': '-1'})
498.         self.assertContentBefore(response, link1, link2)
499. 
500.     def test_change_list_sorting_override_model_admin(self):

File: tests/admin_views/tests.py
Line number range: 501 - 1001
Content:
501.         # Test ordering on Model Admin is respected, and overrides Model Meta
502.         dt = datetime.datetime.now()
503.         p1 = Podcast.objects.create(name="A", release_date=dt)
504.         p2 = Podcast.objects.create(name="B", release_date=dt - datetime.timedelta(10))
505.         link1 = reverse('admin:admin_views_podcast_change', args=(p1.pk,))
506.         link2 = reverse('admin:admin_views_podcast_change', args=(p2.pk,))
507. 
508.         response = self.client.get(reverse('admin:admin_views_podcast_changelist'), {})
509.         self.assertContentBefore(response, link1, link2)
510. 
511.     def test_multiple_sort_same_field(self):
512.         # The changelist displays the correct columns if two columns correspond
513.         # to the same ordering field.
514.         dt = datetime.datetime.now()
515.         p1 = Podcast.objects.create(name="A", release_date=dt)
516.         p2 = Podcast.objects.create(name="B", release_date=dt - datetime.timedelta(10))
517.         link1 = reverse('admin:admin_views_podcast_change', args=(quote(p1.pk),))
518.         link2 = reverse('admin:admin_views_podcast_change', args=(quote(p2.pk),))
519. 
520.         response = self.client.get(reverse('admin:admin_views_podcast_changelist'), {})
521.         self.assertContentBefore(response, link1, link2)
522. 
523.         p1 = ComplexSortedPerson.objects.create(name="Bob", age=10)
524.         p2 = ComplexSortedPerson.objects.create(name="Amy", age=20)
525.         link1 = reverse('admin:admin_views_complexsortedperson_change', args=(p1.pk,))
526.         link2 = reverse('admin:admin_views_complexsortedperson_change', args=(p2.pk,))
527. 
528.         response = self.client.get(reverse('admin:admin_views_complexsortedperson_changelist'), {})
529.         # Should have 5 columns (including action checkbox col)
530.         self.assertContains(response, '<th scope="col"', count=5)
531. 
532.         self.assertContains(response, 'Name')
533.         self.assertContains(response, 'Colored name')
534. 
535.         # Check order
536.         self.assertContentBefore(response, 'Name', 'Colored name')
537. 
538.         # Check sorting - should be by name
539.         self.assertContentBefore(response, link2, link1)
540. 
541.     def test_sort_indicators_admin_order(self):
542.         """
543.         The admin shows default sort indicators for all kinds of 'ordering'
544.         fields: field names, method on the model admin and model itself, and
545.         other callables. See #17252.
546.         """
547.         models = [(AdminOrderedField, 'adminorderedfield'),
548.                   (AdminOrderedModelMethod, 'adminorderedmodelmethod'),
549.                   (AdminOrderedAdminMethod, 'adminorderedadminmethod'),
550.                   (AdminOrderedCallable, 'adminorderedcallable')]
551.         for model, url in models:
552.             model.objects.create(stuff='The Last Item', order=3)
553.             model.objects.create(stuff='The First Item', order=1)
554.             model.objects.create(stuff='The Middle Item', order=2)
555.             response = self.client.get(reverse('admin:admin_views_%s_changelist' % url), {})
556.             self.assertEqual(response.status_code, 200)
557.             # Should have 3 columns including action checkbox col.
558.             self.assertContains(response, '<th scope="col"', count=3, msg_prefix=url)
559.             # Check if the correct column was selected. 2 is the index of the
560.             # 'order' column in the model admin's 'list_display' with 0 being
561.             # the implicit 'action_checkbox' and 1 being the column 'stuff'.
562.             self.assertEqual(response.context['cl'].get_ordering_field_columns(), {2: 'asc'})
563.             # Check order of records.
564.             self.assertContentBefore(response, 'The First Item', 'The Middle Item')
565.             self.assertContentBefore(response, 'The Middle Item', 'The Last Item')
566. 
567.     def test_has_related_field_in_list_display_fk(self):
568.         """Joins shouldn't be performed for <FK>_id fields in list display."""
569.         state = State.objects.create(name='Karnataka')
570.         City.objects.create(state=state, name='Bangalore')
571.         response = self.client.get(reverse('admin:admin_views_city_changelist'), {})
572. 
573.         response.context['cl'].list_display = ['id', 'name', 'state']
574.         self.assertIs(response.context['cl'].has_related_field_in_list_display(), True)
575. 
576.         response.context['cl'].list_display = ['id', 'name', 'state_id']
577.         self.assertIs(response.context['cl'].has_related_field_in_list_display(), False)
578. 
579.     def test_has_related_field_in_list_display_o2o(self):
580.         """Joins shouldn't be performed for <O2O>_id fields in list display."""
581.         media = Media.objects.create(name='Foo')
582.         Vodcast.objects.create(media=media)
583.         response = self.client.get(reverse('admin:admin_views_vodcast_changelist'), {})
584. 
585.         response.context['cl'].list_display = ['media']
586.         self.assertIs(response.context['cl'].has_related_field_in_list_display(), True)
587. 
588.         response.context['cl'].list_display = ['media_id']
589.         self.assertIs(response.context['cl'].has_related_field_in_list_display(), False)
590. 
591.     def test_limited_filter(self):
592.         """Ensure admin changelist filters do not contain objects excluded via limit_choices_to.
593.         This also tests relation-spanning filters (e.g. 'color__value').
594.         """
595.         response = self.client.get(reverse('admin:admin_views_thing_changelist'))
596.         self.assertContains(
597.             response, '<div id="changelist-filter">',
598.             msg_prefix="Expected filter not found in changelist view"
599.         )
600.         self.assertNotContains(
601.             response, '<a href="?color__id__exact=3">Blue</a>',
602.             msg_prefix="Changelist filter not correctly limited by limit_choices_to"
603.         )
604. 
605.     def test_relation_spanning_filters(self):
606.         changelist_url = reverse('admin:admin_views_chapterxtra1_changelist')
607.         response = self.client.get(changelist_url)
608.         self.assertContains(response, '<div id="changelist-filter">')
609.         filters = {
610.             'chap__id__exact': {
611.                 'values': [c.id for c in Chapter.objects.all()],
612.                 'test': lambda obj, value: obj.chap.id == value,
613.             },
614.             'chap__title': {
615.                 'values': [c.title for c in Chapter.objects.all()],
616.                 'test': lambda obj, value: obj.chap.title == value,
617.             },
618.             'chap__book__id__exact': {
619.                 'values': [b.id for b in Book.objects.all()],
620.                 'test': lambda obj, value: obj.chap.book.id == value,
621.             },
622.             'chap__book__name': {
623.                 'values': [b.name for b in Book.objects.all()],
624.                 'test': lambda obj, value: obj.chap.book.name == value,
625.             },
626.             'chap__book__promo__id__exact': {
627.                 'values': [p.id for p in Promo.objects.all()],
628.                 'test': lambda obj, value: obj.chap.book.promo_set.filter(id=value).exists(),
629.             },
630.             'chap__book__promo__name': {
631.                 'values': [p.name for p in Promo.objects.all()],
632.                 'test': lambda obj, value: obj.chap.book.promo_set.filter(name=value).exists(),
633.             },
634.             # A forward relation (book) after a reverse relation (promo).
635.             'guest_author__promo__book__id__exact': {
636.                 'values': [p.id for p in Book.objects.all()],
637.                 'test': lambda obj, value: obj.guest_author.promo_set.filter(book=value).exists(),
638.             },
639.         }
640.         for filter_path, params in filters.items():
641.             for value in params['values']:
642.                 query_string = urlencode({filter_path: value})
643.                 # ensure filter link exists
644.                 self.assertContains(response, '<a href="?%s"' % query_string)
645.                 # ensure link works
646.                 filtered_response = self.client.get('%s?%s' % (changelist_url, query_string))
647.                 self.assertEqual(filtered_response.status_code, 200)
648.                 # ensure changelist contains only valid objects
649.                 for obj in filtered_response.context['cl'].queryset.all():
650.                     self.assertTrue(params['test'](obj, value))
651. 
652.     def test_incorrect_lookup_parameters(self):
653.         """Ensure incorrect lookup parameters are handled gracefully."""
654.         changelist_url = reverse('admin:admin_views_thing_changelist')
655.         response = self.client.get(changelist_url, {'notarealfield': '5'})
656.         self.assertRedirects(response, '%s?e=1' % changelist_url)
657. 
658.         # Spanning relationships through a nonexistent related object (Refs #16716)
659.         response = self.client.get(changelist_url, {'notarealfield__whatever': '5'})
660.         self.assertRedirects(response, '%s?e=1' % changelist_url)
661. 
662.         response = self.client.get(changelist_url, {'color__id__exact': 'StringNotInteger!'})
663.         self.assertRedirects(response, '%s?e=1' % changelist_url)
664. 
665.         # Regression test for #18530
666.         response = self.client.get(changelist_url, {'pub_date__gte': 'foo'})
667.         self.assertRedirects(response, '%s?e=1' % changelist_url)
668. 
669.     def test_isnull_lookups(self):
670.         """Ensure is_null is handled correctly."""
671.         Article.objects.create(title="I Could Go Anywhere", content="Versatile", date=datetime.datetime.now())
672.         changelist_url = reverse('admin:admin_views_article_changelist')
673.         response = self.client.get(changelist_url)
674.         self.assertContains(response, '4 articles')
675.         response = self.client.get(changelist_url, {'section__isnull': 'false'})
676.         self.assertContains(response, '3 articles')
677.         response = self.client.get(changelist_url, {'section__isnull': '0'})
678.         self.assertContains(response, '3 articles')
679.         response = self.client.get(changelist_url, {'section__isnull': 'true'})
680.         self.assertContains(response, '1 article')
681.         response = self.client.get(changelist_url, {'section__isnull': '1'})
682.         self.assertContains(response, '1 article')
683. 
684.     def test_logout_and_password_change_URLs(self):
685.         response = self.client.get(reverse('admin:admin_views_article_changelist'))
686.         self.assertContains(response, '<a href="%s">' % reverse('admin:logout'))
687.         self.assertContains(response, '<a href="%s">' % reverse('admin:password_change'))
688. 
689.     def test_named_group_field_choices_change_list(self):
690.         """
691.         Ensures the admin changelist shows correct values in the relevant column
692.         for rows corresponding to instances of a model in which a named group
693.         has been used in the choices option of a field.
694.         """
695.         link1 = reverse('admin:admin_views_fabric_change', args=(self.fab1.pk,))
696.         link2 = reverse('admin:admin_views_fabric_change', args=(self.fab2.pk,))
697.         response = self.client.get(reverse('admin:admin_views_fabric_changelist'))
698.         fail_msg = (
699.             "Changelist table isn't showing the right human-readable values "
700.             "set by a model field 'choices' option named group."
701.         )
702.         self.assertContains(response, '<a href="%s">Horizontal</a>' % link1, msg_prefix=fail_msg, html=True)
703.         self.assertContains(response, '<a href="%s">Vertical</a>' % link2, msg_prefix=fail_msg, html=True)
704. 
705.     def test_named_group_field_choices_filter(self):
706.         """
707.         Ensures the filter UI shows correctly when at least one named group has
708.         been used in the choices option of a model field.
709.         """
710.         response = self.client.get(reverse('admin:admin_views_fabric_changelist'))
711.         fail_msg = (
712.             "Changelist filter isn't showing options contained inside a model "
713.             "field 'choices' option named group."
714.         )
715.         self.assertContains(response, '<div id="changelist-filter">')
716.         self.assertContains(
717.             response, '<a href="?surface__exact=x" title="Horizontal">Horizontal</a>',
718.             msg_prefix=fail_msg, html=True
719.         )
720.         self.assertContains(
721.             response, '<a href="?surface__exact=y" title="Vertical">Vertical</a>',
722.             msg_prefix=fail_msg, html=True
723.         )
724. 
725.     def test_change_list_null_boolean_display(self):
726.         Post.objects.create(public=None)
727.         response = self.client.get(reverse('admin:admin_views_post_changelist'))
728.         self.assertContains(response, 'icon-unknown.svg')
729. 
730.     def test_i18n_language_non_english_default(self):
731.         """
732.         Check if the JavaScript i18n view returns an empty language catalog
733.         if the default language is non-English but the selected language
734.         is English. See #13388 and #3594 for more details.
735.         """
736.         with self.settings(LANGUAGE_CODE='fr'), translation.override('en-us'):
737.             response = self.client.get(reverse('admin:jsi18n'))
738.             self.assertNotContains(response, 'Choisir une heure')
739. 
740.     def test_i18n_language_non_english_fallback(self):
741.         """
742.         Makes sure that the fallback language is still working properly
743.         in cases where the selected language cannot be found.
744.         """
745.         with self.settings(LANGUAGE_CODE='fr'), translation.override('none'):
746.             response = self.client.get(reverse('admin:jsi18n'))
747.             self.assertContains(response, 'Choisir une heure')
748. 
749.     def test_jsi18n_with_context(self):
750.         response = self.client.get(reverse('admin-extra-context:jsi18n'))
751.         self.assertEqual(response.status_code, 200)
752. 
753.     def test_L10N_deactivated(self):
754.         """
755.         Check if L10N is deactivated, the JavaScript i18n view doesn't
756.         return localized date/time formats. Refs #14824.
757.         """
758.         with self.settings(LANGUAGE_CODE='ru', USE_L10N=False), translation.override('none'):
759.             response = self.client.get(reverse('admin:jsi18n'))
760.             self.assertNotContains(response, '%d.%m.%Y %H:%M:%S')
761.             self.assertContains(response, '%Y-%m-%d %H:%M:%S')
762. 
763.     def test_disallowed_filtering(self):
764.         with self.assertLogs('django.security.DisallowedModelAdminLookup', 'ERROR'):
765.             response = self.client.get(
766.                 "%s?owner__email__startswith=fuzzy" % reverse('admin:admin_views_album_changelist')
767.             )
768.         self.assertEqual(response.status_code, 400)
769. 
770.         # Filters are allowed if explicitly included in list_filter
771.         response = self.client.get("%s?color__value__startswith=red" % reverse('admin:admin_views_thing_changelist'))
772.         self.assertEqual(response.status_code, 200)
773.         response = self.client.get("%s?color__value=red" % reverse('admin:admin_views_thing_changelist'))
774.         self.assertEqual(response.status_code, 200)
775. 
776.         # Filters should be allowed if they involve a local field without the
777.         # need to whitelist them in list_filter or date_hierarchy.
778.         response = self.client.get("%s?age__gt=30" % reverse('admin:admin_views_person_changelist'))
779.         self.assertEqual(response.status_code, 200)
780. 
781.         e1 = Employee.objects.create(name='Anonymous', gender=1, age=22, alive=True, code='123')
782.         e2 = Employee.objects.create(name='Visitor', gender=2, age=19, alive=True, code='124')
783.         WorkHour.objects.create(datum=datetime.datetime.now(), employee=e1)
784.         WorkHour.objects.create(datum=datetime.datetime.now(), employee=e2)
785.         response = self.client.get(reverse('admin:admin_views_workhour_changelist'))
786.         self.assertContains(response, 'employee__person_ptr__exact')
787.         response = self.client.get("%s?employee__person_ptr__exact=%d" % (
788.             reverse('admin:admin_views_workhour_changelist'), e1.pk)
789.         )
790.         self.assertEqual(response.status_code, 200)
791. 
792.     def test_disallowed_to_field(self):
793.         url = reverse('admin:admin_views_section_changelist')
794.         with self.assertLogs('django.security.DisallowedModelAdminToField', 'ERROR'):
795.             response = self.client.get(url, {TO_FIELD_VAR: 'missing_field'})
796.         self.assertEqual(response.status_code, 400)
797. 
798.         # Specifying a field that is not referred by any other model registered
799.         # to this admin site should raise an exception.
800.         with self.assertLogs('django.security.DisallowedModelAdminToField', 'ERROR'):
801.             response = self.client.get(reverse('admin:admin_views_section_changelist'), {TO_FIELD_VAR: 'name'})
802.         self.assertEqual(response.status_code, 400)
803. 
804.         # #23839 - Primary key should always be allowed, even if the referenced model isn't registered.
805.         response = self.client.get(reverse('admin:admin_views_notreferenced_changelist'), {TO_FIELD_VAR: 'id'})
806.         self.assertEqual(response.status_code, 200)
807. 
808.         # #23915 - Specifying a field referenced by another model though a m2m should be allowed.
809.         response = self.client.get(reverse('admin:admin_views_recipe_changelist'), {TO_FIELD_VAR: 'rname'})
810.         self.assertEqual(response.status_code, 200)
811. 
812.         # #23604, #23915 - Specifying a field referenced through a reverse m2m relationship should be allowed.
813.         response = self.client.get(reverse('admin:admin_views_ingredient_changelist'), {TO_FIELD_VAR: 'iname'})
814.         self.assertEqual(response.status_code, 200)
815. 
816.         # #23329 - Specifying a field that is not referred by any other model directly registered
817.         # to this admin site but registered through inheritance should be allowed.
818.         response = self.client.get(reverse('admin:admin_views_referencedbyparent_changelist'), {TO_FIELD_VAR: 'name'})
819.         self.assertEqual(response.status_code, 200)
820. 
821.         # #23431 - Specifying a field that is only referred to by a inline of a registered
822.         # model should be allowed.
823.         response = self.client.get(reverse('admin:admin_views_referencedbyinline_changelist'), {TO_FIELD_VAR: 'name'})
824.         self.assertEqual(response.status_code, 200)
825. 
826.         # #25622 - Specifying a field of a model only referred by a generic
827.         # relation should raise DisallowedModelAdminToField.
828.         url = reverse('admin:admin_views_referencedbygenrel_changelist')
829.         with self.assertLogs('django.security.DisallowedModelAdminToField', 'ERROR'):
830.             response = self.client.get(url, {TO_FIELD_VAR: 'object_id'})
831.         self.assertEqual(response.status_code, 400)
832. 
833.         # We also want to prevent the add, change, and delete views from
834.         # leaking a disallowed field value.
835.         with self.assertLogs('django.security.DisallowedModelAdminToField', 'ERROR'):
836.             response = self.client.post(reverse('admin:admin_views_section_add'), {TO_FIELD_VAR: 'name'})
837.         self.assertEqual(response.status_code, 400)
838. 
839.         section = Section.objects.create()
840.         url = reverse('admin:admin_views_section_change', args=(section.pk,))
841.         with self.assertLogs('django.security.DisallowedModelAdminToField', 'ERROR'):
842.             response = self.client.post(url, {TO_FIELD_VAR: 'name'})
843.         self.assertEqual(response.status_code, 400)
844. 
845.         url = reverse('admin:admin_views_section_delete', args=(section.pk,))
846.         with self.assertLogs('django.security.DisallowedModelAdminToField', 'ERROR'):
847.             response = self.client.post(url, {TO_FIELD_VAR: 'name'})
848.         self.assertEqual(response.status_code, 400)
849. 
850.     def test_allowed_filtering_15103(self):
851.         """
852.         Regressions test for ticket 15103 - filtering on fields defined in a
853.         ForeignKey 'limit_choices_to' should be allowed, otherwise raw_id_fields
854.         can break.
855.         """
856.         # Filters should be allowed if they are defined on a ForeignKey pointing to this model
857.         url = "%s?leader__name=Palin&leader__age=27" % reverse('admin:admin_views_inquisition_changelist')
858.         response = self.client.get(url)
859.         self.assertEqual(response.status_code, 200)
860. 
861.     def test_popup_dismiss_related(self):
862.         """
863.         Regression test for ticket 20664 - ensure the pk is properly quoted.
864.         """
865.         actor = Actor.objects.create(name="Palin", age=27)
866.         response = self.client.get("%s?%s" % (reverse('admin:admin_views_actor_changelist'), IS_POPUP_VAR))
867.         self.assertContains(response, 'data-popup-opener="%s"' % actor.pk)
868. 
869.     def test_hide_change_password(self):
870.         """
871.         Tests if the "change password" link in the admin is hidden if the User
872.         does not have a usable password set.
873.         (against 9bea85795705d015cdadc82c68b99196a8554f5c)
874.         """
875.         user = User.objects.get(username='super')
876.         user.set_unusable_password()
877.         user.save()
878.         self.client.force_login(user)
879.         response = self.client.get(reverse('admin:index'))
880.         self.assertNotContains(
881.             response, reverse('admin:password_change'),
882.             msg_prefix='The "change password" link should not be displayed if a user does not have a usable password.'
883.         )
884. 
885.     def test_change_view_with_show_delete_extra_context(self):
886.         """
887.         The 'show_delete' context variable in the admin's change view controls
888.         the display of the delete button.
889.         """
890.         instance = UndeletableObject.objects.create(name='foo')
891.         response = self.client.get(reverse('admin:admin_views_undeletableobject_change', args=(instance.pk,)))
892.         self.assertNotContains(response, 'deletelink')
893. 
894.     def test_change_view_logs_m2m_field_changes(self):
895.         """Changes to ManyToManyFields are included in the object's history."""
896.         pizza = ReadablePizza.objects.create(name='Cheese')
897.         cheese = Topping.objects.create(name='cheese')
898.         post_data = {'name': pizza.name, 'toppings': [cheese.pk]}
899.         response = self.client.post(reverse('admin:admin_views_readablepizza_change', args=(pizza.pk,)), post_data)
900.         self.assertRedirects(response, reverse('admin:admin_views_readablepizza_changelist'))
901.         pizza_ctype = ContentType.objects.get_for_model(ReadablePizza, for_concrete_model=False)
902.         log = LogEntry.objects.filter(content_type=pizza_ctype, object_id=pizza.pk).first()
903.         self.assertEqual(log.get_change_message(), 'Changed toppings.')
904. 
905.     def test_allows_attributeerror_to_bubble_up(self):
906.         """
907.         AttributeErrors are allowed to bubble when raised inside a change list
908.         view. Requires a model to be created so there's something to display.
909.         Refs: #16655, #18593, and #18747
910.         """
911.         Simple.objects.create()
912.         with self.assertRaises(AttributeError):
913.             self.client.get(reverse('admin:admin_views_simple_changelist'))
914. 
915.     def test_changelist_with_no_change_url(self):
916.         """
917.         ModelAdmin.changelist_view shouldn't result in a NoReverseMatch if url
918.         for change_view is removed from get_urls (#20934).
919.         """
920.         o = UnchangeableObject.objects.create()
921.         response = self.client.get(reverse('admin:admin_views_unchangeableobject_changelist'))
922.         self.assertEqual(response.status_code, 200)
923.         # Check the format of the shown object -- shouldn't contain a change link
924.         self.assertContains(response, '<th class="field-__str__">%s</th>' % o, html=True)
925. 
926.     def test_invalid_appindex_url(self):
927.         """
928.         #21056 -- URL reversing shouldn't work for nonexistent apps.
929.         """
930.         good_url = '/test_admin/admin/admin_views/'
931.         confirm_good_url = reverse('admin:app_list',
932.                                    kwargs={'app_label': 'admin_views'})
933.         self.assertEqual(good_url, confirm_good_url)
934. 
935.         with self.assertRaises(NoReverseMatch):
936.             reverse('admin:app_list', kwargs={'app_label': 'this_should_fail'})
937.         with self.assertRaises(NoReverseMatch):
938.             reverse('admin:app_list', args=('admin_views2',))
939. 
940.     def test_resolve_admin_views(self):
941.         index_match = resolve('/test_admin/admin4/')
942.         list_match = resolve('/test_admin/admin4/auth/user/')
943.         self.assertIs(index_match.func.admin_site, customadmin.simple_site)
944.         self.assertIsInstance(list_match.func.model_admin, customadmin.CustomPwdTemplateUserAdmin)
945. 
946.     def test_adminsite_display_site_url(self):
947.         """
948.         #13749 - Admin should display link to front-end site 'View site'
949.         """
950.         url = reverse('admin:index')
951.         response = self.client.get(url)
952.         self.assertEqual(response.context['site_url'], '/my-site-url/')
953.         self.assertContains(response, '<a href="/my-site-url/">View site</a>')
954. 
955.     @override_settings(TIME_ZONE='America/Sao_Paulo', USE_TZ=True)
956.     def test_date_hierarchy_timezone_dst(self):
957.         # This datetime doesn't exist in this timezone due to DST.
958.         date = pytz.timezone('America/Sao_Paulo').localize(datetime.datetime(2016, 10, 16, 15), is_dst=None)
959.         q = Question.objects.create(question='Why?', expires=date)
960.         Answer2.objects.create(question=q, answer='Because.')
961.         response = self.client.get(reverse('admin:admin_views_answer2_changelist'))
962.         self.assertEqual(response.status_code, 200)
963.         self.assertContains(response, 'question__expires__day=16')
964.         self.assertContains(response, 'question__expires__month=10')
965.         self.assertContains(response, 'question__expires__year=2016')
966. 
967.     def test_sortable_by_columns_subset(self):
968.         expected_sortable_fields = ('date', 'callable_year')
969.         expected_not_sortable_fields = (
970.             'content', 'model_year', 'modeladmin_year', 'model_year_reversed',
971.             'section',
972.         )
973.         response = self.client.get(reverse('admin6:admin_views_article_changelist'))
974.         for field_name in expected_sortable_fields:
975.             self.assertContains(response, '<th scope="col"  class="sortable column-%s">' % field_name)
976.         for field_name in expected_not_sortable_fields:
977.             self.assertContains(response, '<th scope="col"  class="column-%s">' % field_name)
978. 
979.     def test_get_sortable_by_columns_subset(self):
980.         response = self.client.get(reverse('admin6:admin_views_actor_changelist'))
981.         self.assertContains(response, '<th scope="col"  class="sortable column-age">')
982.         self.assertContains(response, '<th scope="col"  class="column-name">')
983. 
984.     def test_sortable_by_no_column(self):
985.         expected_not_sortable_fields = ('title', 'book')
986.         response = self.client.get(reverse('admin6:admin_views_chapter_changelist'))
987.         for field_name in expected_not_sortable_fields:
988.             self.assertContains(response, '<th scope="col"  class="column-%s">' % field_name)
989.         self.assertNotContains(response, '<th scope="col"  class="sortable column')
990. 
991.     def test_get_sortable_by_no_column(self):
992.         response = self.client.get(reverse('admin6:admin_views_color_changelist'))
993.         self.assertContains(response, '<th scope="col"  class="column-value">')
994.         self.assertNotContains(response, '<th scope="col"  class="sortable column')
995. 
996. 
997. @override_settings(TEMPLATES=[{
998.     'BACKEND': 'django.template.backends.django.DjangoTemplates',
999.     # Put this app's and the shared tests templates dirs in DIRS to take precedence
1000.     # over the admin's templates dir.
1001.     'DIRS': [

File: tests/admin_views/tests.py
Line number range: 1001 - 1501
Content:
1001.     'DIRS': [
1002.         os.path.join(os.path.dirname(__file__), 'templates'),
1003.         os.path.join(os.path.dirname(os.path.dirname(__file__)), 'templates'),
1004.     ],
1005.     'APP_DIRS': True,
1006.     'OPTIONS': {
1007.         'context_processors': [
1008.             'django.template.context_processors.debug',
1009.             'django.template.context_processors.request',
1010.             'django.contrib.auth.context_processors.auth',
1011.             'django.contrib.messages.context_processors.messages',
1012.         ],
1013.     },
1014. }])
1015. class AdminCustomTemplateTests(AdminViewBasicTestCase):
1016.     def test_custom_model_admin_templates(self):
1017.         # Test custom change list template with custom extra context
1018.         response = self.client.get(reverse('admin:admin_views_customarticle_changelist'))
1019.         self.assertContains(response, "var hello = 'Hello!';")
1020.         self.assertTemplateUsed(response, 'custom_admin/change_list.html')
1021. 
1022.         # Test custom add form template
1023.         response = self.client.get(reverse('admin:admin_views_customarticle_add'))
1024.         self.assertTemplateUsed(response, 'custom_admin/add_form.html')
1025. 
1026.         # Add an article so we can test delete, change, and history views
1027.         post = self.client.post(reverse('admin:admin_views_customarticle_add'), {
1028.             'content': '<p>great article</p>',
1029.             'date_0': '2008-03-18',
1030.             'date_1': '10:54:39'
1031.         })
1032.         self.assertRedirects(post, reverse('admin:admin_views_customarticle_changelist'))
1033.         self.assertEqual(CustomArticle.objects.all().count(), 1)
1034.         article_pk = CustomArticle.objects.all()[0].pk
1035. 
1036.         # Test custom delete, change, and object history templates
1037.         # Test custom change form template
1038.         response = self.client.get(reverse('admin:admin_views_customarticle_change', args=(article_pk,)))
1039.         self.assertTemplateUsed(response, 'custom_admin/change_form.html')
1040.         response = self.client.get(reverse('admin:admin_views_customarticle_delete', args=(article_pk,)))
1041.         self.assertTemplateUsed(response, 'custom_admin/delete_confirmation.html')
1042.         response = self.client.post(reverse('admin:admin_views_customarticle_changelist'), data={
1043.             'index': 0,
1044.             'action': ['delete_selected'],
1045.             '_selected_action': ['1'],
1046.         })
1047.         self.assertTemplateUsed(response, 'custom_admin/delete_selected_confirmation.html')
1048.         response = self.client.get(reverse('admin:admin_views_customarticle_history', args=(article_pk,)))
1049.         self.assertTemplateUsed(response, 'custom_admin/object_history.html')
1050. 
1051.         # A custom popup response template may be specified by
1052.         # ModelAdmin.popup_response_template.
1053.         response = self.client.post(reverse('admin:admin_views_customarticle_add') + '?%s=1' % IS_POPUP_VAR, {
1054.             'content': '<p>great article</p>',
1055.             'date_0': '2008-03-18',
1056.             'date_1': '10:54:39',
1057.             IS_POPUP_VAR: '1'
1058.         })
1059.         self.assertEqual(response.template_name, 'custom_admin/popup_response.html')
1060. 
1061.     def test_extended_bodyclass_template_change_form(self):
1062.         """
1063.         The admin/change_form.html template uses block.super in the
1064.         bodyclass block.
1065.         """
1066.         response = self.client.get(reverse('admin:admin_views_section_add'))
1067.         self.assertContains(response, 'bodyclass_consistency_check ')
1068. 
1069.     def test_change_password_template(self):
1070.         user = User.objects.get(username='super')
1071.         response = self.client.get(reverse('admin:auth_user_password_change', args=(user.id,)))
1072.         # The auth/user/change_password.html template uses super in the
1073.         # bodyclass block.
1074.         self.assertContains(response, 'bodyclass_consistency_check ')
1075. 
1076.         # When a site has multiple passwords in the browser's password manager,
1077.         # a browser pop up asks which user the new password is for. To prevent
1078.         # this, the username is added to the change password form.
1079.         self.assertContains(response, '<input type="text" name="username" value="super" style="display: none">')
1080. 
1081.     def test_extended_bodyclass_template_index(self):
1082.         """
1083.         The admin/index.html template uses block.super in the bodyclass block.
1084.         """
1085.         response = self.client.get(reverse('admin:index'))
1086.         self.assertContains(response, 'bodyclass_consistency_check ')
1087. 
1088.     def test_extended_bodyclass_change_list(self):
1089.         """
1090.         The admin/change_list.html' template uses block.super
1091.         in the bodyclass block.
1092.         """
1093.         response = self.client.get(reverse('admin:admin_views_article_changelist'))
1094.         self.assertContains(response, 'bodyclass_consistency_check ')
1095. 
1096.     def test_extended_bodyclass_template_login(self):
1097.         """
1098.         The admin/login.html template uses block.super in the
1099.         bodyclass block.
1100.         """
1101.         self.client.logout()
1102.         response = self.client.get(reverse('admin:login'))
1103.         self.assertContains(response, 'bodyclass_consistency_check ')
1104. 
1105.     def test_extended_bodyclass_template_delete_confirmation(self):
1106.         """
1107.         The admin/delete_confirmation.html template uses
1108.         block.super in the bodyclass block.
1109.         """
1110.         group = Group.objects.create(name="foogroup")
1111.         response = self.client.get(reverse('admin:auth_group_delete', args=(group.id,)))
1112.         self.assertContains(response, 'bodyclass_consistency_check ')
1113. 
1114.     def test_extended_bodyclass_template_delete_selected_confirmation(self):
1115.         """
1116.         The admin/delete_selected_confirmation.html template uses
1117.         block.super in bodyclass block.
1118.         """
1119.         group = Group.objects.create(name="foogroup")
1120.         post_data = {
1121.             'action': 'delete_selected',
1122.             'selected_across': '0',
1123.             'index': '0',
1124.             '_selected_action': group.id
1125.         }
1126.         response = self.client.post(reverse('admin:auth_group_changelist'), post_data)
1127.         self.assertEqual(response.context['site_header'], 'Django administration')
1128.         self.assertContains(response, 'bodyclass_consistency_check ')
1129. 
1130.     def test_filter_with_custom_template(self):
1131.         """
1132.         A custom template can be used to render an admin filter.
1133.         """
1134.         response = self.client.get(reverse('admin:admin_views_color2_changelist'))
1135.         self.assertTemplateUsed(response, 'custom_filter_template.html')
1136. 
1137. 
1138. @override_settings(ROOT_URLCONF='admin_views.urls')
1139. class AdminViewFormUrlTest(TestCase):
1140.     current_app = "admin3"
1141. 
1142.     @classmethod
1143.     def setUpTestData(cls):
1144.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
1145.         cls.s1 = Section.objects.create(name='Test section')
1146.         cls.a1 = Article.objects.create(
1147.             content='<p>Middle content</p>', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1
1148.         )
1149.         cls.a2 = Article.objects.create(
1150.             content='<p>Oldest content</p>', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1
1151.         )
1152.         cls.a3 = Article.objects.create(
1153.             content='<p>Newest content</p>', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1
1154.         )
1155.         cls.p1 = PrePopulatedPost.objects.create(title='A Long Title', published=True, slug='a-long-title')
1156. 
1157.     def setUp(self):
1158.         self.client.force_login(self.superuser)
1159. 
1160.     def test_change_form_URL_has_correct_value(self):
1161.         """
1162.         change_view has form_url in response.context
1163.         """
1164.         response = self.client.get(
1165.             reverse('admin:admin_views_section_change', args=(self.s1.pk,), current_app=self.current_app)
1166.         )
1167.         self.assertIn('form_url', response.context, msg='form_url not present in response.context')
1168.         self.assertEqual(response.context['form_url'], 'pony')
1169. 
1170.     def test_initial_data_can_be_overridden(self):
1171.         """
1172.         The behavior for setting initial form data can be overridden in the
1173.         ModelAdmin class. Usually, the initial value is set via the GET params.
1174.         """
1175.         response = self.client.get(
1176.             reverse('admin:admin_views_restaurant_add', current_app=self.current_app),
1177.             {'name': 'test_value'}
1178.         )
1179.         # this would be the usual behaviour
1180.         self.assertNotContains(response, 'value="test_value"')
1181.         # this is the overridden behaviour
1182.         self.assertContains(response, 'value="overridden_value"')
1183. 
1184. 
1185. @override_settings(ROOT_URLCONF='admin_views.urls')
1186. class AdminJavaScriptTest(TestCase):
1187. 
1188.     @classmethod
1189.     def setUpTestData(cls):
1190.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
1191. 
1192.     def setUp(self):
1193.         self.client.force_login(self.superuser)
1194. 
1195.     def test_js_minified_only_if_debug_is_false(self):
1196.         """
1197.         The minified versions of the JS files are only used when DEBUG is False.
1198.         """
1199.         with override_settings(DEBUG=False):
1200.             response = self.client.get(reverse('admin:admin_views_section_add'))
1201.             self.assertNotContains(response, 'vendor/jquery/jquery.js')
1202.             self.assertContains(response, 'vendor/jquery/jquery.min.js')
1203.             self.assertNotContains(response, 'prepopulate.js')
1204.             self.assertContains(response, 'prepopulate.min.js')
1205.             self.assertNotContains(response, 'actions.js')
1206.             self.assertContains(response, 'actions.min.js')
1207.             self.assertNotContains(response, 'collapse.js')
1208.             self.assertContains(response, 'collapse.min.js')
1209.             self.assertNotContains(response, 'inlines.js')
1210.             self.assertContains(response, 'inlines.min.js')
1211.         with override_settings(DEBUG=True):
1212.             response = self.client.get(reverse('admin:admin_views_section_add'))
1213.             self.assertContains(response, 'vendor/jquery/jquery.js')
1214.             self.assertNotContains(response, 'vendor/jquery/jquery.min.js')
1215.             self.assertContains(response, 'prepopulate.js')
1216.             self.assertNotContains(response, 'prepopulate.min.js')
1217.             self.assertContains(response, 'actions.js')
1218.             self.assertNotContains(response, 'actions.min.js')
1219.             self.assertContains(response, 'collapse.js')
1220.             self.assertNotContains(response, 'collapse.min.js')
1221.             self.assertContains(response, 'inlines.js')
1222.             self.assertNotContains(response, 'inlines.min.js')
1223. 
1224. 
1225. @override_settings(ROOT_URLCONF='admin_views.urls')
1226. class SaveAsTests(TestCase):
1227. 
1228.     @classmethod
1229.     def setUpTestData(cls):
1230.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
1231.         cls.per1 = Person.objects.create(name='John Mauchly', gender=1, alive=True)
1232. 
1233.     def setUp(self):
1234.         self.client.force_login(self.superuser)
1235. 
1236.     def test_save_as_duplication(self):
1237.         """'save as' creates a new person"""
1238.         post_data = {'_saveasnew': '', 'name': 'John M', 'gender': 1, 'age': 42}
1239.         response = self.client.post(reverse('admin:admin_views_person_change', args=(self.per1.pk,)), post_data)
1240.         self.assertEqual(len(Person.objects.filter(name='John M')), 1)
1241.         self.assertEqual(len(Person.objects.filter(id=self.per1.pk)), 1)
1242.         new_person = Person.objects.latest('id')
1243.         self.assertRedirects(response, reverse('admin:admin_views_person_change', args=(new_person.pk,)))
1244. 
1245.     def test_save_as_continue_false(self):
1246.         """
1247.         Saving a new object using "Save as new" redirects to the changelist
1248.         instead of the change view when ModelAdmin.save_as_continue=False.
1249.         """
1250.         post_data = {'_saveasnew': '', 'name': 'John M', 'gender': 1, 'age': 42}
1251.         url = reverse('admin:admin_views_person_change', args=(self.per1.pk,), current_app=site2.name)
1252.         response = self.client.post(url, post_data)
1253.         self.assertEqual(len(Person.objects.filter(name='John M')), 1)
1254.         self.assertEqual(len(Person.objects.filter(id=self.per1.pk)), 1)
1255.         self.assertRedirects(response, reverse('admin:admin_views_person_changelist', current_app=site2.name))
1256. 
1257.     def test_save_as_new_with_validation_errors(self):
1258.         """
1259.         When you click "Save as new" and have a validation error,
1260.         you only see the "Save as new" button and not the other save buttons,
1261.         and that only the "Save as" button is visible.
1262.         """
1263.         response = self.client.post(reverse('admin:admin_views_person_change', args=(self.per1.pk,)), {
1264.             '_saveasnew': '',
1265.             'gender': 'invalid',
1266.             '_addanother': 'fail',
1267.         })
1268.         self.assertContains(response, 'Please correct the errors below.')
1269.         self.assertFalse(response.context['show_save_and_add_another'])
1270.         self.assertFalse(response.context['show_save_and_continue'])
1271.         self.assertTrue(response.context['show_save_as_new'])
1272. 
1273.     def test_save_as_new_with_validation_errors_with_inlines(self):
1274.         parent = Parent.objects.create(name='Father')
1275.         child = Child.objects.create(parent=parent, name='Child')
1276.         response = self.client.post(reverse('admin:admin_views_parent_change', args=(parent.pk,)), {
1277.             '_saveasnew': 'Save as new',
1278.             'child_set-0-parent': parent.pk,
1279.             'child_set-0-id': child.pk,
1280.             'child_set-0-name': 'Child',
1281.             'child_set-INITIAL_FORMS': 1,
1282.             'child_set-MAX_NUM_FORMS': 1000,
1283.             'child_set-MIN_NUM_FORMS': 0,
1284.             'child_set-TOTAL_FORMS': 4,
1285.             'name': '_invalid',
1286.         })
1287.         self.assertContains(response, 'Please correct the error below.')
1288.         self.assertFalse(response.context['show_save_and_add_another'])
1289.         self.assertFalse(response.context['show_save_and_continue'])
1290.         self.assertTrue(response.context['show_save_as_new'])
1291. 
1292.     def test_save_as_new_with_inlines_with_validation_errors(self):
1293.         parent = Parent.objects.create(name='Father')
1294.         child = Child.objects.create(parent=parent, name='Child')
1295.         response = self.client.post(reverse('admin:admin_views_parent_change', args=(parent.pk,)), {
1296.             '_saveasnew': 'Save as new',
1297.             'child_set-0-parent': parent.pk,
1298.             'child_set-0-id': child.pk,
1299.             'child_set-0-name': '_invalid',
1300.             'child_set-INITIAL_FORMS': 1,
1301.             'child_set-MAX_NUM_FORMS': 1000,
1302.             'child_set-MIN_NUM_FORMS': 0,
1303.             'child_set-TOTAL_FORMS': 4,
1304.             'name': 'Father',
1305.         })
1306.         self.assertContains(response, 'Please correct the error below.')
1307.         self.assertFalse(response.context['show_save_and_add_another'])
1308.         self.assertFalse(response.context['show_save_and_continue'])
1309.         self.assertTrue(response.context['show_save_as_new'])
1310. 
1311. 
1312. @override_settings(ROOT_URLCONF='admin_views.urls')
1313. class CustomModelAdminTest(AdminViewBasicTestCase):
1314. 
1315.     def test_custom_admin_site_login_form(self):
1316.         self.client.logout()
1317.         response = self.client.get(reverse('admin2:index'), follow=True)
1318.         self.assertIsInstance(response, TemplateResponse)
1319.         self.assertEqual(response.status_code, 200)
1320.         login = self.client.post(reverse('admin2:login'), {
1321.             REDIRECT_FIELD_NAME: reverse('admin2:index'),
1322.             'username': 'customform',
1323.             'password': 'secret',
1324.         }, follow=True)
1325.         self.assertIsInstance(login, TemplateResponse)
1326.         self.assertEqual(login.status_code, 200)
1327.         self.assertContains(login, 'custom form error')
1328.         self.assertContains(login, 'path/to/media.css')
1329. 
1330.     def test_custom_admin_site_login_template(self):
1331.         self.client.logout()
1332.         response = self.client.get(reverse('admin2:index'), follow=True)
1333.         self.assertIsInstance(response, TemplateResponse)
1334.         self.assertTemplateUsed(response, 'custom_admin/login.html')
1335.         self.assertContains(response, 'Hello from a custom login template')
1336. 
1337.     def test_custom_admin_site_logout_template(self):
1338.         response = self.client.get(reverse('admin2:logout'))
1339.         self.assertIsInstance(response, TemplateResponse)
1340.         self.assertTemplateUsed(response, 'custom_admin/logout.html')
1341.         self.assertContains(response, 'Hello from a custom logout template')
1342. 
1343.     def test_custom_admin_site_index_view_and_template(self):
1344.         response = self.client.get(reverse('admin2:index'))
1345.         self.assertIsInstance(response, TemplateResponse)
1346.         self.assertTemplateUsed(response, 'custom_admin/index.html')
1347.         self.assertContains(response, 'Hello from a custom index template *bar*')
1348. 
1349.     def test_custom_admin_site_app_index_view_and_template(self):
1350.         response = self.client.get(reverse('admin2:app_list', args=('admin_views',)))
1351.         self.assertIsInstance(response, TemplateResponse)
1352.         self.assertTemplateUsed(response, 'custom_admin/app_index.html')
1353.         self.assertContains(response, 'Hello from a custom app_index template')
1354. 
1355.     def test_custom_admin_site_password_change_template(self):
1356.         response = self.client.get(reverse('admin2:password_change'))
1357.         self.assertIsInstance(response, TemplateResponse)
1358.         self.assertTemplateUsed(response, 'custom_admin/password_change_form.html')
1359.         self.assertContains(response, 'Hello from a custom password change form template')
1360. 
1361.     def test_custom_admin_site_password_change_with_extra_context(self):
1362.         response = self.client.get(reverse('admin2:password_change'))
1363.         self.assertIsInstance(response, TemplateResponse)
1364.         self.assertTemplateUsed(response, 'custom_admin/password_change_form.html')
1365.         self.assertContains(response, 'eggs')
1366. 
1367.     def test_custom_admin_site_password_change_done_template(self):
1368.         response = self.client.get(reverse('admin2:password_change_done'))
1369.         self.assertIsInstance(response, TemplateResponse)
1370.         self.assertTemplateUsed(response, 'custom_admin/password_change_done.html')
1371.         self.assertContains(response, 'Hello from a custom password change done template')
1372. 
1373.     def test_custom_admin_site_view(self):
1374.         self.client.force_login(self.superuser)
1375.         response = self.client.get(reverse('admin2:my_view'))
1376.         self.assertEqual(response.content, b"Django is a magical pony!")
1377. 
1378.     def test_pwd_change_custom_template(self):
1379.         self.client.force_login(self.superuser)
1380.         su = User.objects.get(username='super')
1381.         response = self.client.get(reverse('admin4:auth_user_password_change', args=(su.pk,)))
1382.         self.assertEqual(response.status_code, 200)
1383. 
1384. 
1385. def get_perm(Model, codename):
1386.     """Return the permission object, for the Model"""
1387.     ct = ContentType.objects.get_for_model(Model, for_concrete_model=False)
1388.     return Permission.objects.get(content_type=ct, codename=codename)
1389. 
1390. 
1391. @override_settings(
1392.     ROOT_URLCONF='admin_views.urls',
1393.     # Test with the admin's documented list of required context processors.
1394.     TEMPLATES=[{
1395.         'BACKEND': 'django.template.backends.django.DjangoTemplates',
1396.         'APP_DIRS': True,
1397.         'OPTIONS': {
1398.             'context_processors': [
1399.                 'django.contrib.auth.context_processors.auth',
1400.                 'django.contrib.messages.context_processors.messages',
1401.             ],
1402.         },
1403.     }],
1404. )
1405. class AdminViewPermissionsTest(TestCase):
1406.     """Tests for Admin Views Permissions."""
1407. 
1408.     @classmethod
1409.     def setUpTestData(cls):
1410.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
1411.         cls.viewuser = User.objects.create_user(username='viewuser', password='secret', is_staff=True)
1412.         cls.adduser = User.objects.create_user(username='adduser', password='secret', is_staff=True)
1413.         cls.changeuser = User.objects.create_user(username='changeuser', password='secret', is_staff=True)
1414.         cls.deleteuser = User.objects.create_user(username='deleteuser', password='secret', is_staff=True)
1415.         cls.joepublicuser = User.objects.create_user(username='joepublic', password='secret')
1416.         cls.nostaffuser = User.objects.create_user(username='nostaff', password='secret')
1417.         cls.s1 = Section.objects.create(name='Test section')
1418.         cls.a1 = Article.objects.create(
1419.             content='<p>Middle content</p>', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1,
1420.             another_section=cls.s1,
1421.         )
1422.         cls.a2 = Article.objects.create(
1423.             content='<p>Oldest content</p>', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1
1424.         )
1425.         cls.a3 = Article.objects.create(
1426.             content='<p>Newest content</p>', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1
1427.         )
1428.         cls.p1 = PrePopulatedPost.objects.create(title='A Long Title', published=True, slug='a-long-title')
1429. 
1430.         # Setup permissions, for our users who can add, change, and delete.
1431.         opts = Article._meta
1432. 
1433.         # User who can view Articles
1434.         cls.viewuser.user_permissions.add(get_perm(Article, get_permission_codename('view', opts)))
1435.         # User who can add Articles
1436.         cls.adduser.user_permissions.add(get_perm(Article, get_permission_codename('add', opts)))
1437.         # User who can change Articles
1438.         cls.changeuser.user_permissions.add(get_perm(Article, get_permission_codename('change', opts)))
1439.         cls.nostaffuser.user_permissions.add(get_perm(Article, get_permission_codename('change', opts)))
1440. 
1441.         # User who can delete Articles
1442.         cls.deleteuser.user_permissions.add(get_perm(Article, get_permission_codename('delete', opts)))
1443.         cls.deleteuser.user_permissions.add(get_perm(Section, get_permission_codename('delete', Section._meta)))
1444. 
1445.         # login POST dicts
1446.         cls.index_url = reverse('admin:index')
1447.         cls.super_login = {
1448.             REDIRECT_FIELD_NAME: cls.index_url,
1449.             'username': 'super',
1450.             'password': 'secret',
1451.         }
1452.         cls.super_email_login = {
1453.             REDIRECT_FIELD_NAME: cls.index_url,
1454.             'username': 'super@example.com',
1455.             'password': 'secret',
1456.         }
1457.         cls.super_email_bad_login = {
1458.             REDIRECT_FIELD_NAME: cls.index_url,
1459.             'username': 'super@example.com',
1460.             'password': 'notsecret',
1461.         }
1462.         cls.adduser_login = {
1463.             REDIRECT_FIELD_NAME: cls.index_url,
1464.             'username': 'adduser',
1465.             'password': 'secret',
1466.         }
1467.         cls.changeuser_login = {
1468.             REDIRECT_FIELD_NAME: cls.index_url,
1469.             'username': 'changeuser',
1470.             'password': 'secret',
1471.         }
1472.         cls.deleteuser_login = {
1473.             REDIRECT_FIELD_NAME: cls.index_url,
1474.             'username': 'deleteuser',
1475.             'password': 'secret',
1476.         }
1477.         cls.nostaff_login = {
1478.             REDIRECT_FIELD_NAME: reverse('has_permission_admin:index'),
1479.             'username': 'nostaff',
1480.             'password': 'secret',
1481.         }
1482.         cls.joepublic_login = {
1483.             REDIRECT_FIELD_NAME: cls.index_url,
1484.             'username': 'joepublic',
1485.             'password': 'secret',
1486.         }
1487.         cls.viewuser_login = {
1488.             REDIRECT_FIELD_NAME: cls.index_url,
1489.             'username': 'viewuser',
1490.             'password': 'secret',
1491.         }
1492.         cls.no_username_login = {
1493.             REDIRECT_FIELD_NAME: cls.index_url,
1494.             'password': 'secret',
1495.         }
1496. 
1497.     def test_login(self):
1498.         """
1499.         Make sure only staff members can log in.
1500. 
1501.         Successful posts to the login page will redirect to the original url.

File: tests/admin_views/tests.py
Line number range: 2001 - 2501
Content:
2001.             'article_set-3-title': ['A title'],
2002.             'article_set-3-content': ['Added content'],
2003.             'article_set-3-date_0': ['2008-3-18'],
2004.             'article_set-3-date_1': ['11:54:58'],
2005.             'article_set-3-section': [str(self.s1.pk)],
2006.         }
2007.         response = self.client.post(reverse('admin:admin_views_section_change', args=(self.s1.pk,)), data)
2008.         self.assertRedirects(response, reverse('admin:admin_views_section_changelist'))
2009.         self.assertEqual(Section.objects.get(pk=self.s1.pk).name, data['name'])
2010.         self.assertEqual(Article.objects.count(), 4)
2011.         # Invalid POST reshows inlines.
2012.         del data['name']
2013.         response = self.client.post(reverse('admin:admin_views_section_change', args=(self.s1.pk,)), data)
2014.         self.assertEqual(response.status_code, 200)
2015.         self.assertEqual(len(response.context['inline_admin_formsets']), 1)
2016.         formset = response.context['inline_admin_formsets'][0]
2017.         self.assertEqual(len(formset.forms), 6)
2018. 
2019.     def test_change_view_with_view_and_delete_inlines(self):
2020.         """User has view and delete permissions on the inline model."""
2021.         self.viewuser.user_permissions.add(get_perm(Section, get_permission_codename('change', Section._meta)))
2022.         self.client.force_login(self.viewuser)
2023.         data = {
2024.             'name': 'Name is required.',
2025.             'article_set-TOTAL_FORMS': 6,
2026.             'article_set-INITIAL_FORMS': 3,
2027.             'article_set-0-id': [str(self.a1.pk)],
2028.             'article_set-0-DELETE': ['on'],
2029.         }
2030.         # Inline POST details are ignored without delete permission.
2031.         response = self.client.post(reverse('admin:admin_views_section_change', args=(self.s1.pk,)), data)
2032.         self.assertRedirects(response, reverse('admin:admin_views_section_changelist'))
2033.         self.assertEqual(Article.objects.count(), 3)
2034.         # Deletion successful when delete permission is added.
2035.         self.viewuser.user_permissions.add(get_perm(Article, get_permission_codename('delete', Article._meta)))
2036.         data = {
2037.             'name': 'Name is required.',
2038.             'article_set-TOTAL_FORMS': 6,
2039.             'article_set-INITIAL_FORMS': 3,
2040.             'article_set-0-id': [str(self.a1.pk)],
2041.             'article_set-0-DELETE': ['on'],
2042.         }
2043.         response = self.client.post(reverse('admin:admin_views_section_change', args=(self.s1.pk,)), data)
2044.         self.assertRedirects(response, reverse('admin:admin_views_section_changelist'))
2045.         self.assertEqual(Article.objects.count(), 2)
2046. 
2047.     def test_delete_view(self):
2048.         """Delete view should restrict access and actually delete items."""
2049.         delete_dict = {'post': 'yes'}
2050.         delete_url = reverse('admin:admin_views_article_delete', args=(self.a1.pk,))
2051. 
2052.         # add user should not be able to delete articles
2053.         self.client.force_login(self.adduser)
2054.         response = self.client.get(delete_url)
2055.         self.assertEqual(response.status_code, 403)
2056.         post = self.client.post(delete_url, delete_dict)
2057.         self.assertEqual(post.status_code, 403)
2058.         self.assertEqual(Article.objects.count(), 3)
2059.         self.client.logout()
2060. 
2061.         # view user should not be able to delete articles
2062.         self.client.force_login(self.viewuser)
2063.         response = self.client.get(delete_url)
2064.         self.assertEqual(response.status_code, 403)
2065.         post = self.client.post(delete_url, delete_dict)
2066.         self.assertEqual(post.status_code, 403)
2067.         self.assertEqual(Article.objects.count(), 3)
2068.         self.client.logout()
2069. 
2070.         # Delete user can delete
2071.         self.client.force_login(self.deleteuser)
2072.         response = self.client.get(reverse('admin:admin_views_section_delete', args=(self.s1.pk,)))
2073.         self.assertContains(response, "<h2>Summary</h2>")
2074.         self.assertContains(response, "<li>Articles: 3</li>")
2075.         # test response contains link to related Article
2076.         self.assertContains(response, "admin_views/article/%s/" % self.a1.pk)
2077. 
2078.         response = self.client.get(delete_url)
2079.         self.assertContains(response, "admin_views/article/%s/" % self.a1.pk)
2080.         self.assertContains(response, "<h2>Summary</h2>")
2081.         self.assertContains(response, "<li>Articles: 1</li>")
2082.         self.assertEqual(response.status_code, 200)
2083.         post = self.client.post(delete_url, delete_dict)
2084.         self.assertRedirects(post, self.index_url)
2085.         self.assertEqual(Article.objects.count(), 2)
2086.         self.assertEqual(len(mail.outbox), 1)
2087.         self.assertEqual(mail.outbox[0].subject, 'Greetings from a deleted object')
2088.         article_ct = ContentType.objects.get_for_model(Article)
2089.         logged = LogEntry.objects.get(content_type=article_ct, action_flag=DELETION)
2090.         self.assertEqual(logged.object_id, str(self.a1.pk))
2091. 
2092.     def test_delete_view_with_no_default_permissions(self):
2093.         """
2094.         The delete view allows users to delete collected objects without a
2095.         'delete' permission (ReadOnlyPizza.Meta.default_permissions is empty).
2096.         """
2097.         pizza = ReadOnlyPizza.objects.create(name='Double Cheese')
2098.         delete_url = reverse('admin:admin_views_readonlypizza_delete', args=(pizza.pk,))
2099.         self.client.force_login(self.adduser)
2100.         response = self.client.get(delete_url)
2101.         self.assertContains(response, 'admin_views/readonlypizza/%s/' % pizza.pk)
2102.         self.assertContains(response, '<h2>Summary</h2>')
2103.         self.assertContains(response, '<li>Read only pizzas: 1</li>')
2104.         self.assertEqual(response.status_code, 200)
2105.         post = self.client.post(delete_url, {'post': 'yes'})
2106.         self.assertRedirects(post, reverse('admin:admin_views_readonlypizza_changelist'))
2107.         self.assertEqual(ReadOnlyPizza.objects.count(), 0)
2108. 
2109.     def test_delete_view_nonexistent_obj(self):
2110.         self.client.force_login(self.deleteuser)
2111.         url = reverse('admin:admin_views_article_delete', args=('nonexistent',))
2112.         response = self.client.get(url, follow=True)
2113.         self.assertRedirects(response, reverse('admin:index'))
2114.         self.assertEqual(
2115.             [m.message for m in response.context['messages']],
2116.             ["""article with ID "nonexistent" doesn't exist. Perhaps it was deleted?"""]
2117.         )
2118. 
2119.     def test_history_view(self):
2120.         """History view should restrict access."""
2121.         # add user should not be able to view the list of article or change any of them
2122.         self.client.force_login(self.adduser)
2123.         response = self.client.get(reverse('admin:admin_views_article_history', args=(self.a1.pk,)))
2124.         self.assertEqual(response.status_code, 403)
2125.         self.client.get(reverse('admin:logout'))
2126. 
2127.         # view user can view all items
2128.         self.client.force_login(self.viewuser)
2129.         response = self.client.get(reverse('admin:admin_views_article_history', args=(self.a1.pk,)))
2130.         self.assertEqual(response.status_code, 200)
2131.         self.client.get(reverse('admin:logout'))
2132. 
2133.         # change user can view all items and edit them
2134.         self.client.force_login(self.changeuser)
2135.         response = self.client.get(reverse('admin:admin_views_article_history', args=(self.a1.pk,)))
2136.         self.assertEqual(response.status_code, 200)
2137. 
2138.         # Test redirection when using row-level change permissions. Refs #11513.
2139.         rl1 = RowLevelChangePermissionModel.objects.create(name="odd id")
2140.         rl2 = RowLevelChangePermissionModel.objects.create(name="even id")
2141.         logins = [self.superuser, self.viewuser, self.adduser, self.changeuser, self.deleteuser]
2142.         for login_user in logins:
2143.             with self.subTest(login_user.username):
2144.                 self.client.force_login(login_user)
2145.                 url = reverse('admin:admin_views_rowlevelchangepermissionmodel_history', args=(rl1.pk,))
2146.                 response = self.client.get(url)
2147.                 self.assertEqual(response.status_code, 403)
2148. 
2149.                 url = reverse('admin:admin_views_rowlevelchangepermissionmodel_history', args=(rl2.pk,))
2150.                 response = self.client.get(url)
2151.                 self.assertEqual(response.status_code, 200)
2152. 
2153.                 self.client.get(reverse('admin:logout'))
2154. 
2155.         for login_user in [self.joepublicuser, self.nostaffuser]:
2156.             with self.subTest(login_user.username):
2157.                 self.client.force_login(login_user)
2158.                 url = reverse('admin:admin_views_rowlevelchangepermissionmodel_history', args=(rl1.pk,))
2159.                 response = self.client.get(url, follow=True)
2160.                 self.assertContains(response, 'login-form')
2161.                 url = reverse('admin:admin_views_rowlevelchangepermissionmodel_history', args=(rl2.pk,))
2162.                 response = self.client.get(url, follow=True)
2163.                 self.assertContains(response, 'login-form')
2164. 
2165.                 self.client.get(reverse('admin:logout'))
2166. 
2167.     def test_history_view_bad_url(self):
2168.         self.client.force_login(self.changeuser)
2169.         response = self.client.get(reverse('admin:admin_views_article_history', args=('foo',)), follow=True)
2170.         self.assertRedirects(response, reverse('admin:index'))
2171.         self.assertEqual(
2172.             [m.message for m in response.context['messages']],
2173.             ["""article with ID "foo" doesn't exist. Perhaps it was deleted?"""]
2174.         )
2175. 
2176.     def test_conditionally_show_add_section_link(self):
2177.         """
2178.         The foreign key widget should only show the "add related" button if the
2179.         user has permission to add that related item.
2180.         """
2181.         self.client.force_login(self.adduser)
2182.         # The user can't add sections yet, so they shouldn't see the "add section" link.
2183.         url = reverse('admin:admin_views_article_add')
2184.         add_link_text = 'add_id_section'
2185.         response = self.client.get(url)
2186.         self.assertNotContains(response, add_link_text)
2187.         # Allow the user to add sections too. Now they can see the "add section" link.
2188.         user = User.objects.get(username='adduser')
2189.         perm = get_perm(Section, get_permission_codename('add', Section._meta))
2190.         user.user_permissions.add(perm)
2191.         response = self.client.get(url)
2192.         self.assertContains(response, add_link_text)
2193. 
2194.     def test_conditionally_show_change_section_link(self):
2195.         """
2196.         The foreign key widget should only show the "change related" button if
2197.         the user has permission to change that related item.
2198.         """
2199.         def get_change_related(response):
2200.             return response.context['adminform'].form.fields['section'].widget.can_change_related
2201. 
2202.         self.client.force_login(self.adduser)
2203.         # The user can't change sections yet, so they shouldn't see the "change section" link.
2204.         url = reverse('admin:admin_views_article_add')
2205.         change_link_text = 'change_id_section'
2206.         response = self.client.get(url)
2207.         self.assertFalse(get_change_related(response))
2208.         self.assertNotContains(response, change_link_text)
2209.         # Allow the user to change sections too. Now they can see the "change section" link.
2210.         user = User.objects.get(username='adduser')
2211.         perm = get_perm(Section, get_permission_codename('change', Section._meta))
2212.         user.user_permissions.add(perm)
2213.         response = self.client.get(url)
2214.         self.assertTrue(get_change_related(response))
2215.         self.assertContains(response, change_link_text)
2216. 
2217.     def test_conditionally_show_delete_section_link(self):
2218.         """
2219.         The foreign key widget should only show the "delete related" button if
2220.         the user has permission to delete that related item.
2221.         """
2222.         def get_delete_related(response):
2223.             return response.context['adminform'].form.fields['sub_section'].widget.can_delete_related
2224. 
2225.         self.client.force_login(self.adduser)
2226.         # The user can't delete sections yet, so they shouldn't see the "delete section" link.
2227.         url = reverse('admin:admin_views_article_add')
2228.         delete_link_text = 'delete_id_sub_section'
2229.         response = self.client.get(url)
2230.         self.assertFalse(get_delete_related(response))
2231.         self.assertNotContains(response, delete_link_text)
2232.         # Allow the user to delete sections too. Now they can see the "delete section" link.
2233.         user = User.objects.get(username='adduser')
2234.         perm = get_perm(Section, get_permission_codename('delete', Section._meta))
2235.         user.user_permissions.add(perm)
2236.         response = self.client.get(url)
2237.         self.assertTrue(get_delete_related(response))
2238.         self.assertContains(response, delete_link_text)
2239. 
2240.     def test_disabled_permissions_when_logged_in(self):
2241.         self.client.force_login(self.superuser)
2242.         superuser = User.objects.get(username='super')
2243.         superuser.is_active = False
2244.         superuser.save()
2245. 
2246.         response = self.client.get(self.index_url, follow=True)
2247.         self.assertContains(response, 'id="login-form"')
2248.         self.assertNotContains(response, 'Log out')
2249. 
2250.         response = self.client.get(reverse('secure_view'), follow=True)
2251.         self.assertContains(response, 'id="login-form"')
2252. 
2253.     def test_disabled_staff_permissions_when_logged_in(self):
2254.         self.client.force_login(self.superuser)
2255.         superuser = User.objects.get(username='super')
2256.         superuser.is_staff = False
2257.         superuser.save()
2258. 
2259.         response = self.client.get(self.index_url, follow=True)
2260.         self.assertContains(response, 'id="login-form"')
2261.         self.assertNotContains(response, 'Log out')
2262. 
2263.         response = self.client.get(reverse('secure_view'), follow=True)
2264.         self.assertContains(response, 'id="login-form"')
2265. 
2266.     def test_app_list_permissions(self):
2267.         """
2268.         If a user has no module perms, the app list returns a 404.
2269.         """
2270.         opts = Article._meta
2271.         change_user = User.objects.get(username='changeuser')
2272.         permission = get_perm(Article, get_permission_codename('change', opts))
2273. 
2274.         self.client.force_login(self.changeuser)
2275. 
2276.         # the user has no module permissions
2277.         change_user.user_permissions.remove(permission)
2278.         response = self.client.get(reverse('admin:app_list', args=('admin_views',)))
2279.         self.assertEqual(response.status_code, 404)
2280. 
2281.         # the user now has module permissions
2282.         change_user.user_permissions.add(permission)
2283.         response = self.client.get(reverse('admin:app_list', args=('admin_views',)))
2284.         self.assertEqual(response.status_code, 200)
2285. 
2286.     def test_shortcut_view_only_available_to_staff(self):
2287.         """
2288.         Only admin users should be able to use the admin shortcut view.
2289.         """
2290.         model_ctype = ContentType.objects.get_for_model(ModelWithStringPrimaryKey)
2291.         obj = ModelWithStringPrimaryKey.objects.create(string_pk='foo')
2292.         shortcut_url = reverse('admin:view_on_site', args=(model_ctype.pk, obj.pk))
2293. 
2294.         # Not logged in: we should see the login page.
2295.         response = self.client.get(shortcut_url, follow=True)
2296.         self.assertTemplateUsed(response, 'admin/login.html')
2297. 
2298.         # Logged in? Redirect.
2299.         self.client.force_login(self.superuser)
2300.         response = self.client.get(shortcut_url, follow=False)
2301.         # Can't use self.assertRedirects() because User.get_absolute_url() is silly.
2302.         self.assertEqual(response.status_code, 302)
2303.         # Domain may depend on contrib.sites tests also run
2304.         self.assertRegex(response.url, 'http://(testserver|example.com)/dummy/foo/')
2305. 
2306.     def test_has_module_permission(self):
2307.         """
2308.         has_module_permission() returns True for all users who
2309.         have any permission for that module (add, change, or delete), so that
2310.         the module is displayed on the admin index page.
2311.         """
2312.         self.client.force_login(self.superuser)
2313.         response = self.client.get(self.index_url)
2314.         self.assertContains(response, 'admin_views')
2315.         self.assertContains(response, 'Articles')
2316.         self.client.logout()
2317. 
2318.         self.client.force_login(self.viewuser)
2319.         response = self.client.get(self.index_url)
2320.         self.assertContains(response, 'admin_views')
2321.         self.assertContains(response, 'Articles')
2322.         self.client.logout()
2323. 
2324.         self.client.force_login(self.adduser)
2325.         response = self.client.get(self.index_url)
2326.         self.assertContains(response, 'admin_views')
2327.         self.assertContains(response, 'Articles')
2328.         self.client.logout()
2329. 
2330.         self.client.force_login(self.changeuser)
2331.         response = self.client.get(self.index_url)
2332.         self.assertContains(response, 'admin_views')
2333.         self.assertContains(response, 'Articles')
2334.         self.client.logout()
2335. 
2336.         self.client.force_login(self.deleteuser)
2337.         response = self.client.get(self.index_url)
2338.         self.assertContains(response, 'admin_views')
2339.         self.assertContains(response, 'Articles')
2340. 
2341.     def test_overriding_has_module_permission(self):
2342.         """
2343.         If has_module_permission() always returns False, the module shouldn't
2344.         be displayed on the admin index page for any users.
2345.         """
2346.         articles = Article._meta.verbose_name_plural.title()
2347.         sections = Section._meta.verbose_name_plural.title()
2348.         index_url = reverse('admin7:index')
2349. 
2350.         self.client.force_login(self.superuser)
2351.         response = self.client.get(index_url)
2352.         self.assertContains(response, sections)
2353.         self.assertNotContains(response, articles)
2354.         self.client.logout()
2355. 
2356.         self.client.force_login(self.viewuser)
2357.         response = self.client.get(index_url)
2358.         self.assertNotContains(response, 'admin_views')
2359.         self.assertNotContains(response, articles)
2360.         self.client.logout()
2361. 
2362.         self.client.force_login(self.adduser)
2363.         response = self.client.get(index_url)
2364.         self.assertNotContains(response, 'admin_views')
2365.         self.assertNotContains(response, articles)
2366.         self.client.logout()
2367. 
2368.         self.client.force_login(self.changeuser)
2369.         response = self.client.get(index_url)
2370.         self.assertNotContains(response, 'admin_views')
2371.         self.assertNotContains(response, articles)
2372.         self.client.logout()
2373. 
2374.         self.client.force_login(self.deleteuser)
2375.         response = self.client.get(index_url)
2376.         self.assertNotContains(response, articles)
2377. 
2378.         # The app list displays Sections but not Articles as the latter has
2379.         # ModelAdmin.has_module_permission() = False.
2380.         self.client.force_login(self.superuser)
2381.         response = self.client.get(reverse('admin7:app_list', args=('admin_views',)))
2382.         self.assertContains(response, sections)
2383.         self.assertNotContains(response, articles)
2384. 
2385.     def test_post_save_message_no_forbidden_links_visible(self):
2386.         """
2387.         Post-save message shouldn't contain a link to the change form if the
2388.         user doesn't have the change permission.
2389.         """
2390.         self.client.force_login(self.adduser)
2391.         # Emulate Article creation for user with add-only permission.
2392.         post_data = {
2393.             "title": "Fun & games",
2394.             "content": "Some content",
2395.             "date_0": "2015-10-31",
2396.             "date_1": "16:35:00",
2397.             "_save": "Save",
2398.         }
2399.         response = self.client.post(reverse('admin:admin_views_article_add'), post_data, follow=True)
2400.         self.assertContains(
2401.             response,
2402.             '<li class="success">The article "Fun &amp; games" was added successfully.</li>',
2403.             html=True
2404.         )
2405. 
2406. 
2407. @override_settings(
2408.     ROOT_URLCONF='admin_views.urls',
2409.     TEMPLATES=[{
2410.         'BACKEND': 'django.template.backends.django.DjangoTemplates',
2411.         'APP_DIRS': True,
2412.         'OPTIONS': {
2413.             'context_processors': [
2414.                 'django.contrib.auth.context_processors.auth',
2415.                 'django.contrib.messages.context_processors.messages',
2416.             ],
2417.         },
2418.     }],
2419. )
2420. class AdminViewProxyModelPermissionsTests(TestCase):
2421.     """Tests for proxy models permissions in the admin."""
2422. 
2423.     @classmethod
2424.     def setUpTestData(cls):
2425.         cls.viewuser = User.objects.create_user(username='viewuser', password='secret', is_staff=True)
2426.         cls.adduser = User.objects.create_user(username='adduser', password='secret', is_staff=True)
2427.         cls.changeuser = User.objects.create_user(username='changeuser', password='secret', is_staff=True)
2428.         cls.deleteuser = User.objects.create_user(username='deleteuser', password='secret', is_staff=True)
2429.         # Setup permissions.
2430.         opts = UserProxy._meta
2431.         cls.viewuser.user_permissions.add(get_perm(UserProxy, get_permission_codename('view', opts)))
2432.         cls.adduser.user_permissions.add(get_perm(UserProxy, get_permission_codename('add', opts)))
2433.         cls.changeuser.user_permissions.add(get_perm(UserProxy, get_permission_codename('change', opts)))
2434.         cls.deleteuser.user_permissions.add(get_perm(UserProxy, get_permission_codename('delete', opts)))
2435.         # UserProxy instances.
2436.         cls.user_proxy = UserProxy.objects.create(username='user_proxy', password='secret')
2437. 
2438.     def test_add(self):
2439.         self.client.force_login(self.adduser)
2440.         url = reverse('admin:admin_views_userproxy_add')
2441.         data = {
2442.             'username': 'can_add',
2443.             'password': 'secret',
2444.             'date_joined_0': '2019-01-15',
2445.             'date_joined_1': '16:59:10',
2446.         }
2447.         response = self.client.post(url, data, follow=True)
2448.         self.assertEqual(response.status_code, 200)
2449.         self.assertTrue(UserProxy.objects.filter(username='can_add').exists())
2450. 
2451.     def test_view(self):
2452.         self.client.force_login(self.viewuser)
2453.         response = self.client.get(reverse('admin:admin_views_userproxy_changelist'))
2454.         self.assertContains(response, '<h1>Select user proxy to view</h1>')
2455.         self.assertEqual(response.status_code, 200)
2456.         response = self.client.get(reverse('admin:admin_views_userproxy_change', args=(self.user_proxy.pk,)))
2457.         self.assertContains(response, '<h1>View user proxy</h1>')
2458.         self.assertContains(response, '<div class="readonly">user_proxy</div>')
2459. 
2460.     def test_change(self):
2461.         self.client.force_login(self.changeuser)
2462.         data = {
2463.             'password': self.user_proxy.password,
2464.             'username': self.user_proxy.username,
2465.             'date_joined_0': self.user_proxy.date_joined.strftime('%Y-%m-%d'),
2466.             'date_joined_1': self.user_proxy.date_joined.strftime('%H:%M:%S'),
2467.             'first_name': 'first_name',
2468.         }
2469.         url = reverse('admin:admin_views_userproxy_change', args=(self.user_proxy.pk,))
2470.         response = self.client.post(url, data)
2471.         self.assertRedirects(response, reverse('admin:admin_views_userproxy_changelist'))
2472.         self.assertEqual(UserProxy.objects.get(pk=self.user_proxy.pk).first_name, 'first_name')
2473. 
2474.     def test_delete(self):
2475.         self.client.force_login(self.deleteuser)
2476.         url = reverse('admin:admin_views_userproxy_delete', args=(self.user_proxy.pk,))
2477.         response = self.client.post(url, {'post': 'yes'}, follow=True)
2478.         self.assertEqual(response.status_code, 200)
2479.         self.assertFalse(UserProxy.objects.filter(pk=self.user_proxy.pk).exists())
2480. 
2481. 
2482. @override_settings(ROOT_URLCONF='admin_views.urls')
2483. class AdminViewsNoUrlTest(TestCase):
2484.     """Regression test for #17333"""
2485. 
2486.     @classmethod
2487.     def setUpTestData(cls):
2488.         # User who can change Reports
2489.         cls.changeuser = User.objects.create_user(username='changeuser', password='secret', is_staff=True)
2490.         cls.changeuser.user_permissions.add(get_perm(Report, get_permission_codename('change', Report._meta)))
2491. 
2492.     def test_no_standard_modeladmin_urls(self):
2493.         """Admin index views don't break when user's ModelAdmin removes standard urls"""
2494.         self.client.force_login(self.changeuser)
2495.         r = self.client.get(reverse('admin:index'))
2496.         # we shouldn't get a 500 error caused by a NoReverseMatch
2497.         self.assertEqual(r.status_code, 200)
2498.         self.client.get(reverse('admin:logout'))
2499. 
2500. 
2501. @skipUnlessDBFeature('can_defer_constraint_checks')

File: tests/admin_views/tests.py
Line number range: 2501 - 3001
Content:
2501. @skipUnlessDBFeature('can_defer_constraint_checks')
2502. @override_settings(ROOT_URLCONF='admin_views.urls')
2503. class AdminViewDeletedObjectsTest(TestCase):
2504. 
2505.     @classmethod
2506.     def setUpTestData(cls):
2507.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
2508.         cls.deleteuser = User.objects.create_user(username='deleteuser', password='secret', is_staff=True)
2509.         cls.s1 = Section.objects.create(name='Test section')
2510.         cls.a1 = Article.objects.create(
2511.             content='<p>Middle content</p>', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1
2512.         )
2513.         cls.a2 = Article.objects.create(
2514.             content='<p>Oldest content</p>', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1
2515.         )
2516.         cls.a3 = Article.objects.create(
2517.             content='<p>Newest content</p>', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1
2518.         )
2519.         cls.p1 = PrePopulatedPost.objects.create(title='A Long Title', published=True, slug='a-long-title')
2520. 
2521.         cls.v1 = Villain.objects.create(name='Adam')
2522.         cls.v2 = Villain.objects.create(name='Sue')
2523.         cls.sv1 = SuperVillain.objects.create(name='Bob')
2524.         cls.pl1 = Plot.objects.create(name='World Domination', team_leader=cls.v1, contact=cls.v2)
2525.         cls.pl2 = Plot.objects.create(name='World Peace', team_leader=cls.v2, contact=cls.v2)
2526.         cls.pl3 = Plot.objects.create(name='Corn Conspiracy', team_leader=cls.v1, contact=cls.v1)
2527.         cls.pd1 = PlotDetails.objects.create(details='almost finished', plot=cls.pl1)
2528.         cls.sh1 = SecretHideout.objects.create(location='underground bunker', villain=cls.v1)
2529.         cls.sh2 = SecretHideout.objects.create(location='floating castle', villain=cls.sv1)
2530.         cls.ssh1 = SuperSecretHideout.objects.create(location='super floating castle!', supervillain=cls.sv1)
2531.         cls.cy1 = CyclicOne.objects.create(name='I am recursive', two_id=1)
2532.         cls.cy2 = CyclicTwo.objects.create(name='I am recursive too', one_id=1)
2533. 
2534.     def setUp(self):
2535.         self.client.force_login(self.superuser)
2536. 
2537.     def test_nesting(self):
2538.         """
2539.         Objects should be nested to display the relationships that
2540.         cause them to be scheduled for deletion.
2541.         """
2542.         pattern = re.compile(
2543.             r'<li>Plot: <a href="%s">World Domination</a>\s*<ul>\s*'
2544.             r'<li>Plot details: <a href="%s">almost finished</a>' % (
2545.                 reverse('admin:admin_views_plot_change', args=(self.pl1.pk,)),
2546.                 reverse('admin:admin_views_plotdetails_change', args=(self.pd1.pk,)),
2547.             )
2548.         )
2549.         response = self.client.get(reverse('admin:admin_views_villain_delete', args=(self.v1.pk,)))
2550.         self.assertRegex(response.content.decode(), pattern)
2551. 
2552.     def test_cyclic(self):
2553.         """
2554.         Cyclic relationships should still cause each object to only be
2555.         listed once.
2556.         """
2557.         one = '<li>Cyclic one: <a href="%s">I am recursive</a>' % (
2558.             reverse('admin:admin_views_cyclicone_change', args=(self.cy1.pk,)),
2559.         )
2560.         two = '<li>Cyclic two: <a href="%s">I am recursive too</a>' % (
2561.             reverse('admin:admin_views_cyclictwo_change', args=(self.cy2.pk,)),
2562.         )
2563.         response = self.client.get(reverse('admin:admin_views_cyclicone_delete', args=(self.cy1.pk,)))
2564. 
2565.         self.assertContains(response, one, 1)
2566.         self.assertContains(response, two, 1)
2567. 
2568.     def test_perms_needed(self):
2569.         self.client.logout()
2570.         delete_user = User.objects.get(username='deleteuser')
2571.         delete_user.user_permissions.add(get_perm(Plot, get_permission_codename('delete', Plot._meta)))
2572. 
2573.         self.client.force_login(self.deleteuser)
2574.         response = self.client.get(reverse('admin:admin_views_plot_delete', args=(self.pl1.pk,)))
2575.         self.assertContains(response, "your account doesn't have permission to delete the following types of objects")
2576.         self.assertContains(response, "<li>plot details</li>")
2577. 
2578.     def test_protected(self):
2579.         q = Question.objects.create(question="Why?")
2580.         a1 = Answer.objects.create(question=q, answer="Because.")
2581.         a2 = Answer.objects.create(question=q, answer="Yes.")
2582. 
2583.         response = self.client.get(reverse('admin:admin_views_question_delete', args=(q.pk,)))
2584.         self.assertContains(response, "would require deleting the following protected related objects")
2585.         self.assertContains(
2586.             response,
2587.             '<li>Answer: <a href="%s">Because.</a></li>' % reverse('admin:admin_views_answer_change', args=(a1.pk,))
2588.         )
2589.         self.assertContains(
2590.             response,
2591.             '<li>Answer: <a href="%s">Yes.</a></li>' % reverse('admin:admin_views_answer_change', args=(a2.pk,))
2592.         )
2593. 
2594.     def test_post_delete_protected(self):
2595.         """
2596.         A POST request to delete protected objects should display the page
2597.         which says the deletion is prohibited.
2598.         """
2599.         q = Question.objects.create(question='Why?')
2600.         Answer.objects.create(question=q, answer='Because.')
2601. 
2602.         response = self.client.post(reverse('admin:admin_views_question_delete', args=(q.pk,)), {'post': 'yes'})
2603.         self.assertEqual(Question.objects.count(), 1)
2604.         self.assertContains(response, "would require deleting the following protected related objects")
2605. 
2606.     def test_not_registered(self):
2607.         should_contain = """<li>Secret hideout: underground bunker"""
2608.         response = self.client.get(reverse('admin:admin_views_villain_delete', args=(self.v1.pk,)))
2609.         self.assertContains(response, should_contain, 1)
2610. 
2611.     def test_multiple_fkeys_to_same_model(self):
2612.         """
2613.         If a deleted object has two relationships from another model,
2614.         both of those should be followed in looking for related
2615.         objects to delete.
2616.         """
2617.         should_contain = '<li>Plot: <a href="%s">World Domination</a>' % reverse(
2618.             'admin:admin_views_plot_change', args=(self.pl1.pk,)
2619.         )
2620.         response = self.client.get(reverse('admin:admin_views_villain_delete', args=(self.v1.pk,)))
2621.         self.assertContains(response, should_contain)
2622.         response = self.client.get(reverse('admin:admin_views_villain_delete', args=(self.v2.pk,)))
2623.         self.assertContains(response, should_contain)
2624. 
2625.     def test_multiple_fkeys_to_same_instance(self):
2626.         """
2627.         If a deleted object has two relationships pointing to it from
2628.         another object, the other object should still only be listed
2629.         once.
2630.         """
2631.         should_contain = '<li>Plot: <a href="%s">World Peace</a></li>' % reverse(
2632.             'admin:admin_views_plot_change', args=(self.pl2.pk,)
2633.         )
2634.         response = self.client.get(reverse('admin:admin_views_villain_delete', args=(self.v2.pk,)))
2635.         self.assertContains(response, should_contain, 1)
2636. 
2637.     def test_inheritance(self):
2638.         """
2639.         In the case of an inherited model, if either the child or
2640.         parent-model instance is deleted, both instances are listed
2641.         for deletion, as well as any relationships they have.
2642.         """
2643.         should_contain = [
2644.             '<li>Villain: <a href="%s">Bob</a>' % reverse('admin:admin_views_villain_change', args=(self.sv1.pk,)),
2645.             '<li>Super villain: <a href="%s">Bob</a>' % reverse(
2646.                 'admin:admin_views_supervillain_change', args=(self.sv1.pk,)
2647.             ),
2648.             '<li>Secret hideout: floating castle',
2649.             '<li>Super secret hideout: super floating castle!',
2650.         ]
2651.         response = self.client.get(reverse('admin:admin_views_villain_delete', args=(self.sv1.pk,)))
2652.         for should in should_contain:
2653.             self.assertContains(response, should, 1)
2654.         response = self.client.get(reverse('admin:admin_views_supervillain_delete', args=(self.sv1.pk,)))
2655.         for should in should_contain:
2656.             self.assertContains(response, should, 1)
2657. 
2658.     def test_generic_relations(self):
2659.         """
2660.         If a deleted object has GenericForeignKeys pointing to it,
2661.         those objects should be listed for deletion.
2662.         """
2663.         plot = self.pl3
2664.         tag = FunkyTag.objects.create(content_object=plot, name='hott')
2665.         should_contain = '<li>Funky tag: <a href="%s">hott' % reverse(
2666.             'admin:admin_views_funkytag_change', args=(tag.id,))
2667.         response = self.client.get(reverse('admin:admin_views_plot_delete', args=(plot.pk,)))
2668.         self.assertContains(response, should_contain)
2669. 
2670.     def test_generic_relations_with_related_query_name(self):
2671.         """
2672.         If a deleted object has GenericForeignKey with
2673.         GenericRelation(related_query_name='...') pointing to it, those objects
2674.         should be listed for deletion.
2675.         """
2676.         bookmark = Bookmark.objects.create(name='djangoproject')
2677.         tag = FunkyTag.objects.create(content_object=bookmark, name='django')
2678.         tag_url = reverse('admin:admin_views_funkytag_change', args=(tag.id,))
2679.         should_contain = '<li>Funky tag: <a href="%s">django' % tag_url
2680.         response = self.client.get(reverse('admin:admin_views_bookmark_delete', args=(bookmark.pk,)))
2681.         self.assertContains(response, should_contain)
2682. 
2683.     def test_delete_view_uses_get_deleted_objects(self):
2684.         """The delete view uses ModelAdmin.get_deleted_objects()."""
2685.         book = Book.objects.create(name='Test Book')
2686.         response = self.client.get(reverse('admin2:admin_views_book_delete', args=(book.pk,)))
2687.         # BookAdmin.get_deleted_objects() returns custom text.
2688.         self.assertContains(response, 'a deletable object')
2689. 
2690. 
2691. @override_settings(ROOT_URLCONF='admin_views.urls')
2692. class TestGenericRelations(TestCase):
2693. 
2694.     @classmethod
2695.     def setUpTestData(cls):
2696.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
2697.         cls.v1 = Villain.objects.create(name='Adam')
2698.         cls.pl3 = Plot.objects.create(name='Corn Conspiracy', team_leader=cls.v1, contact=cls.v1)
2699. 
2700.     def setUp(self):
2701.         self.client.force_login(self.superuser)
2702. 
2703.     def test_generic_content_object_in_list_display(self):
2704.         FunkyTag.objects.create(content_object=self.pl3, name='hott')
2705.         response = self.client.get(reverse('admin:admin_views_funkytag_changelist'))
2706.         self.assertContains(response, "%s</td>" % self.pl3)
2707. 
2708. 
2709. @override_settings(ROOT_URLCONF='admin_views.urls')
2710. class AdminViewStringPrimaryKeyTest(TestCase):
2711. 
2712.     @classmethod
2713.     def setUpTestData(cls):
2714.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
2715.         cls.s1 = Section.objects.create(name='Test section')
2716.         cls.a1 = Article.objects.create(
2717.             content='<p>Middle content</p>', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1
2718.         )
2719.         cls.a2 = Article.objects.create(
2720.             content='<p>Oldest content</p>', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1
2721.         )
2722.         cls.a3 = Article.objects.create(
2723.             content='<p>Newest content</p>', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1
2724.         )
2725.         cls.p1 = PrePopulatedPost.objects.create(title='A Long Title', published=True, slug='a-long-title')
2726.         cls.pk = (
2727.             "abcdefghijklmnopqrstuvwxyz ABCDEFGHIJKLMNOPQRSTUVWXYZ 1234567890 "
2728.             r"""-_.!~*'() ;/?:@&=+$, <>#%" {}|\^[]`"""
2729.         )
2730.         cls.m1 = ModelWithStringPrimaryKey.objects.create(string_pk=cls.pk)
2731.         content_type_pk = ContentType.objects.get_for_model(ModelWithStringPrimaryKey).pk
2732.         user_pk = cls.superuser.pk
2733.         LogEntry.objects.log_action(user_pk, content_type_pk, cls.pk, cls.pk, 2, change_message='Changed something')
2734. 
2735.     def setUp(self):
2736.         self.client.force_login(self.superuser)
2737. 
2738.     def test_get_history_view(self):
2739.         """
2740.         Retrieving the history for an object using urlencoded form of primary
2741.         key should work.
2742.         Refs #12349, #18550.
2743.         """
2744.         response = self.client.get(reverse('admin:admin_views_modelwithstringprimarykey_history', args=(self.pk,)))
2745.         self.assertContains(response, escape(self.pk))
2746.         self.assertContains(response, 'Changed something')
2747.         self.assertEqual(response.status_code, 200)
2748. 
2749.     def test_get_change_view(self):
2750.         "Retrieving the object using urlencoded form of primary key should work"
2751.         response = self.client.get(reverse('admin:admin_views_modelwithstringprimarykey_change', args=(self.pk,)))
2752.         self.assertContains(response, escape(self.pk))
2753.         self.assertEqual(response.status_code, 200)
2754. 
2755.     def test_changelist_to_changeform_link(self):
2756.         "Link to the changeform of the object in changelist should use reverse() and be quoted -- #18072"
2757.         response = self.client.get(reverse('admin:admin_views_modelwithstringprimarykey_changelist'))
2758.         # this URL now comes through reverse(), thus url quoting and iri_to_uri encoding
2759.         pk_final_url = escape(iri_to_uri(quote(self.pk)))
2760.         change_url = reverse(
2761.             'admin:admin_views_modelwithstringprimarykey_change', args=('__fk__',)
2762.         ).replace('__fk__', pk_final_url)
2763.         should_contain = '<th class="field-__str__"><a href="%s">%s</a></th>' % (change_url, escape(self.pk))
2764.         self.assertContains(response, should_contain)
2765. 
2766.     def test_recentactions_link(self):
2767.         "The link from the recent actions list referring to the changeform of the object should be quoted"
2768.         response = self.client.get(reverse('admin:index'))
2769.         link = reverse('admin:admin_views_modelwithstringprimarykey_change', args=(quote(self.pk),))
2770.         should_contain = """<a href="%s">%s</a>""" % (escape(link), escape(self.pk))
2771.         self.assertContains(response, should_contain)
2772. 
2773.     def test_deleteconfirmation_link(self):
2774.         "The link from the delete confirmation page referring back to the changeform of the object should be quoted"
2775.         url = reverse('admin:admin_views_modelwithstringprimarykey_delete', args=(quote(self.pk),))
2776.         response = self.client.get(url)
2777.         # this URL now comes through reverse(), thus url quoting and iri_to_uri encoding
2778.         change_url = reverse(
2779.             'admin:admin_views_modelwithstringprimarykey_change', args=('__fk__',)
2780.         ).replace('__fk__', escape(iri_to_uri(quote(self.pk))))
2781.         should_contain = '<a href="%s">%s</a>' % (change_url, escape(self.pk))
2782.         self.assertContains(response, should_contain)
2783. 
2784.     def test_url_conflicts_with_add(self):
2785.         "A model with a primary key that ends with add or is `add` should be visible"
2786.         add_model = ModelWithStringPrimaryKey.objects.create(pk="i have something to add")
2787.         add_model.save()
2788.         response = self.client.get(
2789.             reverse('admin:admin_views_modelwithstringprimarykey_change', args=(quote(add_model.pk),))
2790.         )
2791.         should_contain = """<h1>Change model with string primary key</h1>"""
2792.         self.assertContains(response, should_contain)
2793. 
2794.         add_model2 = ModelWithStringPrimaryKey.objects.create(pk="add")
2795.         add_url = reverse('admin:admin_views_modelwithstringprimarykey_add')
2796.         change_url = reverse('admin:admin_views_modelwithstringprimarykey_change', args=(quote(add_model2.pk),))
2797.         self.assertNotEqual(add_url, change_url)
2798. 
2799.     def test_url_conflicts_with_delete(self):
2800.         "A model with a primary key that ends with delete should be visible"
2801.         delete_model = ModelWithStringPrimaryKey(pk="delete")
2802.         delete_model.save()
2803.         response = self.client.get(
2804.             reverse('admin:admin_views_modelwithstringprimarykey_change', args=(quote(delete_model.pk),))
2805.         )
2806.         should_contain = """<h1>Change model with string primary key</h1>"""
2807.         self.assertContains(response, should_contain)
2808. 
2809.     def test_url_conflicts_with_history(self):
2810.         "A model with a primary key that ends with history should be visible"
2811.         history_model = ModelWithStringPrimaryKey(pk="history")
2812.         history_model.save()
2813.         response = self.client.get(
2814.             reverse('admin:admin_views_modelwithstringprimarykey_change', args=(quote(history_model.pk),))
2815.         )
2816.         should_contain = """<h1>Change model with string primary key</h1>"""
2817.         self.assertContains(response, should_contain)
2818. 
2819.     def test_shortcut_view_with_escaping(self):
2820.         "'View on site should' work properly with char fields"
2821.         model = ModelWithStringPrimaryKey(pk='abc_123')
2822.         model.save()
2823.         response = self.client.get(
2824.             reverse('admin:admin_views_modelwithstringprimarykey_change', args=(quote(model.pk),))
2825.         )
2826.         should_contain = '/%s/" class="viewsitelink">' % model.pk
2827.         self.assertContains(response, should_contain)
2828. 
2829.     def test_change_view_history_link(self):
2830.         """Object history button link should work and contain the pk value quoted."""
2831.         url = reverse(
2832.             'admin:%s_modelwithstringprimarykey_change' % ModelWithStringPrimaryKey._meta.app_label,
2833.             args=(quote(self.pk),)
2834.         )
2835.         response = self.client.get(url)
2836.         self.assertEqual(response.status_code, 200)
2837.         expected_link = reverse(
2838.             'admin:%s_modelwithstringprimarykey_history' % ModelWithStringPrimaryKey._meta.app_label,
2839.             args=(quote(self.pk),)
2840.         )
2841.         self.assertContains(response, '<a href="%s" class="historylink"' % escape(expected_link))
2842. 
2843.     def test_redirect_on_add_view_continue_button(self):
2844.         """As soon as an object is added using "Save and continue editing"
2845.         button, the user should be redirected to the object's change_view.
2846. 
2847.         In case primary key is a string containing some special characters
2848.         like slash or underscore, these characters must be escaped (see #22266)
2849.         """
2850.         response = self.client.post(
2851.             reverse('admin:admin_views_modelwithstringprimarykey_add'),
2852.             {
2853.                 'string_pk': '123/history',
2854.                 "_continue": "1",  # Save and continue editing
2855.             }
2856.         )
2857. 
2858.         self.assertEqual(response.status_code, 302)  # temporary redirect
2859.         self.assertIn('/123_2Fhistory/', response['location'])  # PK is quoted
2860. 
2861. 
2862. @override_settings(ROOT_URLCONF='admin_views.urls')
2863. class SecureViewTests(TestCase):
2864.     """
2865.     Test behavior of a view protected by the staff_member_required decorator.
2866.     """
2867. 
2868.     def test_secure_view_shows_login_if_not_logged_in(self):
2869.         secure_url = reverse('secure_view')
2870.         response = self.client.get(secure_url)
2871.         self.assertRedirects(response, '%s?next=%s' % (reverse('admin:login'), secure_url))
2872.         response = self.client.get(secure_url, follow=True)
2873.         self.assertTemplateUsed(response, 'admin/login.html')
2874.         self.assertEqual(response.context[REDIRECT_FIELD_NAME], secure_url)
2875. 
2876.     def test_staff_member_required_decorator_works_with_argument(self):
2877.         """
2878.         Staff_member_required decorator works with an argument
2879.         (redirect_field_name).
2880.         """
2881.         secure_url = '/test_admin/admin/secure-view2/'
2882.         response = self.client.get(secure_url)
2883.         self.assertRedirects(response, '%s?myfield=%s' % (reverse('admin:login'), secure_url))
2884. 
2885. 
2886. @override_settings(ROOT_URLCONF='admin_views.urls')
2887. class AdminViewUnicodeTest(TestCase):
2888. 
2889.     @classmethod
2890.     def setUpTestData(cls):
2891.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
2892.         cls.b1 = Book.objects.create(name='Lærdommer')
2893.         cls.p1 = Promo.objects.create(name='<Promo for Lærdommer>', book=cls.b1)
2894.         cls.chap1 = Chapter.objects.create(
2895.             title='Norske bostaver æøå skaper problemer', content='<p>Svært frustrerende med UnicodeDecodeErro</p>',
2896.             book=cls.b1
2897.         )
2898.         cls.chap2 = Chapter.objects.create(
2899.             title='Kjærlighet', content='<p>La kjærligheten til de lidende seire.</p>', book=cls.b1)
2900.         cls.chap3 = Chapter.objects.create(title='Kjærlighet', content='<p>Noe innhold</p>', book=cls.b1)
2901.         cls.chap4 = ChapterXtra1.objects.create(chap=cls.chap1, xtra='<Xtra(1) Norske bostaver æøå skaper problemer>')
2902.         cls.chap5 = ChapterXtra1.objects.create(chap=cls.chap2, xtra='<Xtra(1) Kjærlighet>')
2903.         cls.chap6 = ChapterXtra1.objects.create(chap=cls.chap3, xtra='<Xtra(1) Kjærlighet>')
2904.         cls.chap7 = ChapterXtra2.objects.create(chap=cls.chap1, xtra='<Xtra(2) Norske bostaver æøå skaper problemer>')
2905.         cls.chap8 = ChapterXtra2.objects.create(chap=cls.chap2, xtra='<Xtra(2) Kjærlighet>')
2906.         cls.chap9 = ChapterXtra2.objects.create(chap=cls.chap3, xtra='<Xtra(2) Kjærlighet>')
2907. 
2908.     def setUp(self):
2909.         self.client.force_login(self.superuser)
2910. 
2911.     def test_unicode_edit(self):
2912.         """
2913.         A test to ensure that POST on edit_view handles non-ASCII characters.
2914.         """
2915.         post_data = {
2916.             "name": "Test lærdommer",
2917.             # inline data
2918.             "chapter_set-TOTAL_FORMS": "6",
2919.             "chapter_set-INITIAL_FORMS": "3",
2920.             "chapter_set-MAX_NUM_FORMS": "0",
2921.             "chapter_set-0-id": self.chap1.pk,
2922.             "chapter_set-0-title": "Norske bostaver æøå skaper problemer",
2923.             "chapter_set-0-content": "&lt;p&gt;Svært frustrerende med UnicodeDecodeError&lt;/p&gt;",
2924.             "chapter_set-1-id": self.chap2.id,
2925.             "chapter_set-1-title": "Kjærlighet.",
2926.             "chapter_set-1-content": "&lt;p&gt;La kjærligheten til de lidende seire.&lt;/p&gt;",
2927.             "chapter_set-2-id": self.chap3.id,
2928.             "chapter_set-2-title": "Need a title.",
2929.             "chapter_set-2-content": "&lt;p&gt;Newest content&lt;/p&gt;",
2930.             "chapter_set-3-id": "",
2931.             "chapter_set-3-title": "",
2932.             "chapter_set-3-content": "",
2933.             "chapter_set-4-id": "",
2934.             "chapter_set-4-title": "",
2935.             "chapter_set-4-content": "",
2936.             "chapter_set-5-id": "",
2937.             "chapter_set-5-title": "",
2938.             "chapter_set-5-content": "",
2939.         }
2940. 
2941.         response = self.client.post(reverse('admin:admin_views_book_change', args=(self.b1.pk,)), post_data)
2942.         self.assertEqual(response.status_code, 302)  # redirect somewhere
2943. 
2944.     def test_unicode_delete(self):
2945.         """
2946.         The delete_view handles non-ASCII characters
2947.         """
2948.         delete_dict = {'post': 'yes'}
2949.         delete_url = reverse('admin:admin_views_book_delete', args=(self.b1.pk,))
2950.         response = self.client.get(delete_url)
2951.         self.assertEqual(response.status_code, 200)
2952.         response = self.client.post(delete_url, delete_dict)
2953.         self.assertRedirects(response, reverse('admin:admin_views_book_changelist'))
2954. 
2955. 
2956. @override_settings(ROOT_URLCONF='admin_views.urls')
2957. class AdminViewListEditable(TestCase):
2958. 
2959.     @classmethod
2960.     def setUpTestData(cls):
2961.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
2962.         cls.s1 = Section.objects.create(name='Test section')
2963.         cls.a1 = Article.objects.create(
2964.             content='<p>Middle content</p>', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1
2965.         )
2966.         cls.a2 = Article.objects.create(
2967.             content='<p>Oldest content</p>', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1
2968.         )
2969.         cls.a3 = Article.objects.create(
2970.             content='<p>Newest content</p>', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1
2971.         )
2972.         cls.p1 = PrePopulatedPost.objects.create(title='A Long Title', published=True, slug='a-long-title')
2973.         cls.per1 = Person.objects.create(name='John Mauchly', gender=1, alive=True)
2974.         cls.per2 = Person.objects.create(name='Grace Hopper', gender=1, alive=False)
2975.         cls.per3 = Person.objects.create(name='Guido van Rossum', gender=1, alive=True)
2976. 
2977.     def setUp(self):
2978.         self.client.force_login(self.superuser)
2979. 
2980.     def test_inheritance(self):
2981.         Podcast.objects.create(name="This Week in Django", release_date=datetime.date.today())
2982.         response = self.client.get(reverse('admin:admin_views_podcast_changelist'))
2983.         self.assertEqual(response.status_code, 200)
2984. 
2985.     def test_inheritance_2(self):
2986.         Vodcast.objects.create(name="This Week in Django", released=True)
2987.         response = self.client.get(reverse('admin:admin_views_vodcast_changelist'))
2988.         self.assertEqual(response.status_code, 200)
2989. 
2990.     def test_custom_pk(self):
2991.         Language.objects.create(iso='en', name='English', english_name='English')
2992.         response = self.client.get(reverse('admin:admin_views_language_changelist'))
2993.         self.assertEqual(response.status_code, 200)
2994. 
2995.     def test_changelist_input_html(self):
2996.         response = self.client.get(reverse('admin:admin_views_person_changelist'))
2997.         # 2 inputs per object(the field and the hidden id field) = 6
2998.         # 4 management hidden fields = 4
2999.         # 4 action inputs (3 regular checkboxes, 1 checkbox to select all)
3000.         # main form submit button = 1
3001.         # search field and search submit button = 2

File: tests/admin_views/tests.py
Line number range: 3001 - 3501
Content:
3001.         # search field and search submit button = 2
3002.         # CSRF field = 1
3003.         # field to track 'select all' across paginated views = 1
3004.         # 6 + 4 + 4 + 1 + 2 + 1 + 1 = 19 inputs
3005.         self.assertContains(response, "<input", count=19)
3006.         # 1 select per object = 3 selects
3007.         self.assertContains(response, "<select", count=4)
3008. 
3009.     def test_post_messages(self):
3010.         # Ticket 12707: Saving inline editable should not show admin
3011.         # action warnings
3012.         data = {
3013.             "form-TOTAL_FORMS": "3",
3014.             "form-INITIAL_FORMS": "3",
3015.             "form-MAX_NUM_FORMS": "0",
3016. 
3017.             "form-0-gender": "1",
3018.             "form-0-id": "%s" % self.per1.pk,
3019. 
3020.             "form-1-gender": "2",
3021.             "form-1-id": "%s" % self.per2.pk,
3022. 
3023.             "form-2-alive": "checked",
3024.             "form-2-gender": "1",
3025.             "form-2-id": "%s" % self.per3.pk,
3026. 
3027.             "_save": "Save",
3028.         }
3029.         response = self.client.post(reverse('admin:admin_views_person_changelist'),
3030.                                     data, follow=True)
3031.         self.assertEqual(len(response.context['messages']), 1)
3032. 
3033.     def test_post_submission(self):
3034.         data = {
3035.             "form-TOTAL_FORMS": "3",
3036.             "form-INITIAL_FORMS": "3",
3037.             "form-MAX_NUM_FORMS": "0",
3038. 
3039.             "form-0-gender": "1",
3040.             "form-0-id": "%s" % self.per1.pk,
3041. 
3042.             "form-1-gender": "2",
3043.             "form-1-id": "%s" % self.per2.pk,
3044. 
3045.             "form-2-alive": "checked",
3046.             "form-2-gender": "1",
3047.             "form-2-id": "%s" % self.per3.pk,
3048. 
3049.             "_save": "Save",
3050.         }
3051.         self.client.post(reverse('admin:admin_views_person_changelist'), data)
3052. 
3053.         self.assertIs(Person.objects.get(name="John Mauchly").alive, False)
3054.         self.assertEqual(Person.objects.get(name="Grace Hopper").gender, 2)
3055. 
3056.         # test a filtered page
3057.         data = {
3058.             "form-TOTAL_FORMS": "2",
3059.             "form-INITIAL_FORMS": "2",
3060.             "form-MAX_NUM_FORMS": "0",
3061. 
3062.             "form-0-id": "%s" % self.per1.pk,
3063.             "form-0-gender": "1",
3064.             "form-0-alive": "checked",
3065. 
3066.             "form-1-id": "%s" % self.per3.pk,
3067.             "form-1-gender": "1",
3068.             "form-1-alive": "checked",
3069. 
3070.             "_save": "Save",
3071.         }
3072.         self.client.post(reverse('admin:admin_views_person_changelist') + '?gender__exact=1', data)
3073. 
3074.         self.assertIs(Person.objects.get(name="John Mauchly").alive, True)
3075. 
3076.         # test a searched page
3077.         data = {
3078.             "form-TOTAL_FORMS": "1",
3079.             "form-INITIAL_FORMS": "1",
3080.             "form-MAX_NUM_FORMS": "0",
3081. 
3082.             "form-0-id": "%s" % self.per1.pk,
3083.             "form-0-gender": "1",
3084. 
3085.             "_save": "Save",
3086.         }
3087.         self.client.post(reverse('admin:admin_views_person_changelist') + '?q=john', data)
3088. 
3089.         self.assertIs(Person.objects.get(name="John Mauchly").alive, False)
3090. 
3091.     def test_non_field_errors(self):
3092.         """
3093.         Non-field errors are displayed for each of the forms in the
3094.         changelist's formset.
3095.         """
3096.         fd1 = FoodDelivery.objects.create(reference='123', driver='bill', restaurant='thai')
3097.         fd2 = FoodDelivery.objects.create(reference='456', driver='bill', restaurant='india')
3098.         fd3 = FoodDelivery.objects.create(reference='789', driver='bill', restaurant='pizza')
3099. 
3100.         data = {
3101.             "form-TOTAL_FORMS": "3",
3102.             "form-INITIAL_FORMS": "3",
3103.             "form-MAX_NUM_FORMS": "0",
3104. 
3105.             "form-0-id": str(fd1.id),
3106.             "form-0-reference": "123",
3107.             "form-0-driver": "bill",
3108.             "form-0-restaurant": "thai",
3109. 
3110.             # Same data as above: Forbidden because of unique_together!
3111.             "form-1-id": str(fd2.id),
3112.             "form-1-reference": "456",
3113.             "form-1-driver": "bill",
3114.             "form-1-restaurant": "thai",
3115. 
3116.             "form-2-id": str(fd3.id),
3117.             "form-2-reference": "789",
3118.             "form-2-driver": "bill",
3119.             "form-2-restaurant": "pizza",
3120. 
3121.             "_save": "Save",
3122.         }
3123.         response = self.client.post(reverse('admin:admin_views_fooddelivery_changelist'), data)
3124.         self.assertContains(
3125.             response,
3126.             '<tr><td colspan="4"><ul class="errorlist nonfield"><li>Food delivery '
3127.             'with this Driver and Restaurant already exists.</li></ul></td></tr>',
3128.             1,
3129.             html=True
3130.         )
3131. 
3132.         data = {
3133.             "form-TOTAL_FORMS": "3",
3134.             "form-INITIAL_FORMS": "3",
3135.             "form-MAX_NUM_FORMS": "0",
3136. 
3137.             "form-0-id": str(fd1.id),
3138.             "form-0-reference": "123",
3139.             "form-0-driver": "bill",
3140.             "form-0-restaurant": "thai",
3141. 
3142.             # Same data as above: Forbidden because of unique_together!
3143.             "form-1-id": str(fd2.id),
3144.             "form-1-reference": "456",
3145.             "form-1-driver": "bill",
3146.             "form-1-restaurant": "thai",
3147. 
3148.             # Same data also.
3149.             "form-2-id": str(fd3.id),
3150.             "form-2-reference": "789",
3151.             "form-2-driver": "bill",
3152.             "form-2-restaurant": "thai",
3153. 
3154.             "_save": "Save",
3155.         }
3156.         response = self.client.post(reverse('admin:admin_views_fooddelivery_changelist'), data)
3157.         self.assertContains(
3158.             response,
3159.             '<tr><td colspan="4"><ul class="errorlist nonfield"><li>Food delivery '
3160.             'with this Driver and Restaurant already exists.</li></ul></td></tr>',
3161.             2,
3162.             html=True
3163.         )
3164. 
3165.     def test_non_form_errors(self):
3166.         # test if non-form errors are handled; ticket #12716
3167.         data = {
3168.             "form-TOTAL_FORMS": "1",
3169.             "form-INITIAL_FORMS": "1",
3170.             "form-MAX_NUM_FORMS": "0",
3171. 
3172.             "form-0-id": "%s" % self.per2.pk,
3173.             "form-0-alive": "1",
3174.             "form-0-gender": "2",
3175. 
3176.             # The form processing understands this as a list_editable "Save"
3177.             # and not an action "Go".
3178.             "_save": "Save",
3179.         }
3180.         response = self.client.post(reverse('admin:admin_views_person_changelist'), data)
3181.         self.assertContains(response, "Grace is not a Zombie")
3182. 
3183.     def test_non_form_errors_is_errorlist(self):
3184.         # test if non-form errors are correctly handled; ticket #12878
3185.         data = {
3186.             "form-TOTAL_FORMS": "1",
3187.             "form-INITIAL_FORMS": "1",
3188.             "form-MAX_NUM_FORMS": "0",
3189. 
3190.             "form-0-id": "%s" % self.per2.pk,
3191.             "form-0-alive": "1",
3192.             "form-0-gender": "2",
3193. 
3194.             "_save": "Save",
3195.         }
3196.         response = self.client.post(reverse('admin:admin_views_person_changelist'), data)
3197.         non_form_errors = response.context['cl'].formset.non_form_errors()
3198.         self.assertIsInstance(non_form_errors, ErrorList)
3199.         self.assertEqual(str(non_form_errors), str(ErrorList(["Grace is not a Zombie"])))
3200. 
3201.     def test_list_editable_ordering(self):
3202.         collector = Collector.objects.create(id=1, name="Frederick Clegg")
3203. 
3204.         Category.objects.create(id=1, order=1, collector=collector)
3205.         Category.objects.create(id=2, order=2, collector=collector)
3206.         Category.objects.create(id=3, order=0, collector=collector)
3207.         Category.objects.create(id=4, order=0, collector=collector)
3208. 
3209.         # NB: The order values must be changed so that the items are reordered.
3210.         data = {
3211.             "form-TOTAL_FORMS": "4",
3212.             "form-INITIAL_FORMS": "4",
3213.             "form-MAX_NUM_FORMS": "0",
3214. 
3215.             "form-0-order": "14",
3216.             "form-0-id": "1",
3217.             "form-0-collector": "1",
3218. 
3219.             "form-1-order": "13",
3220.             "form-1-id": "2",
3221.             "form-1-collector": "1",
3222. 
3223.             "form-2-order": "1",
3224.             "form-2-id": "3",
3225.             "form-2-collector": "1",
3226. 
3227.             "form-3-order": "0",
3228.             "form-3-id": "4",
3229.             "form-3-collector": "1",
3230. 
3231.             # The form processing understands this as a list_editable "Save"
3232.             # and not an action "Go".
3233.             "_save": "Save",
3234.         }
3235.         response = self.client.post(reverse('admin:admin_views_category_changelist'), data)
3236.         # Successful post will redirect
3237.         self.assertEqual(response.status_code, 302)
3238. 
3239.         # The order values have been applied to the right objects
3240.         self.assertEqual(Category.objects.get(id=1).order, 14)
3241.         self.assertEqual(Category.objects.get(id=2).order, 13)
3242.         self.assertEqual(Category.objects.get(id=3).order, 1)
3243.         self.assertEqual(Category.objects.get(id=4).order, 0)
3244. 
3245.     def test_list_editable_pagination(self):
3246.         """
3247.         Pagination works for list_editable items.
3248.         """
3249.         UnorderedObject.objects.create(id=1, name='Unordered object #1')
3250.         UnorderedObject.objects.create(id=2, name='Unordered object #2')
3251.         UnorderedObject.objects.create(id=3, name='Unordered object #3')
3252.         response = self.client.get(reverse('admin:admin_views_unorderedobject_changelist'))
3253.         self.assertContains(response, 'Unordered object #3')
3254.         self.assertContains(response, 'Unordered object #2')
3255.         self.assertNotContains(response, 'Unordered object #1')
3256.         response = self.client.get(reverse('admin:admin_views_unorderedobject_changelist') + '?p=1')
3257.         self.assertNotContains(response, 'Unordered object #3')
3258.         self.assertNotContains(response, 'Unordered object #2')
3259.         self.assertContains(response, 'Unordered object #1')
3260. 
3261.     def test_list_editable_action_submit(self):
3262.         # List editable changes should not be executed if the action "Go" button is
3263.         # used to submit the form.
3264.         data = {
3265.             "form-TOTAL_FORMS": "3",
3266.             "form-INITIAL_FORMS": "3",
3267.             "form-MAX_NUM_FORMS": "0",
3268. 
3269.             "form-0-gender": "1",
3270.             "form-0-id": "1",
3271. 
3272.             "form-1-gender": "2",
3273.             "form-1-id": "2",
3274. 
3275.             "form-2-alive": "checked",
3276.             "form-2-gender": "1",
3277.             "form-2-id": "3",
3278. 
3279.             "index": "0",
3280.             "_selected_action": ['3'],
3281.             "action": ['', 'delete_selected'],
3282.         }
3283.         self.client.post(reverse('admin:admin_views_person_changelist'), data)
3284. 
3285.         self.assertIs(Person.objects.get(name="John Mauchly").alive, True)
3286.         self.assertEqual(Person.objects.get(name="Grace Hopper").gender, 1)
3287. 
3288.     def test_list_editable_action_choices(self):
3289.         # List editable changes should be executed if the "Save" button is
3290.         # used to submit the form - any action choices should be ignored.
3291.         data = {
3292.             "form-TOTAL_FORMS": "3",
3293.             "form-INITIAL_FORMS": "3",
3294.             "form-MAX_NUM_FORMS": "0",
3295. 
3296.             "form-0-gender": "1",
3297.             "form-0-id": "%s" % self.per1.pk,
3298. 
3299.             "form-1-gender": "2",
3300.             "form-1-id": "%s" % self.per2.pk,
3301. 
3302.             "form-2-alive": "checked",
3303.             "form-2-gender": "1",
3304.             "form-2-id": "%s" % self.per3.pk,
3305. 
3306.             "_save": "Save",
3307.             "_selected_action": ['1'],
3308.             "action": ['', 'delete_selected'],
3309.         }
3310.         self.client.post(reverse('admin:admin_views_person_changelist'), data)
3311. 
3312.         self.assertIs(Person.objects.get(name="John Mauchly").alive, False)
3313.         self.assertEqual(Person.objects.get(name="Grace Hopper").gender, 2)
3314. 
3315.     def test_list_editable_popup(self):
3316.         """
3317.         Fields should not be list-editable in popups.
3318.         """
3319.         response = self.client.get(reverse('admin:admin_views_person_changelist'))
3320.         self.assertNotEqual(response.context['cl'].list_editable, ())
3321.         response = self.client.get(reverse('admin:admin_views_person_changelist') + '?%s' % IS_POPUP_VAR)
3322.         self.assertEqual(response.context['cl'].list_editable, ())
3323. 
3324.     def test_pk_hidden_fields(self):
3325.         """
3326.         hidden pk fields aren't displayed in the table body and their
3327.         corresponding human-readable value is displayed instead. The hidden pk
3328.         fields are displayed but separately (not in the table) and only once.
3329.         """
3330.         story1 = Story.objects.create(title='The adventures of Guido', content='Once upon a time in Djangoland...')
3331.         story2 = Story.objects.create(
3332.             title='Crouching Tiger, Hidden Python',
3333.             content='The Python was sneaking into...',
3334.         )
3335.         response = self.client.get(reverse('admin:admin_views_story_changelist'))
3336.         # Only one hidden field, in a separate place than the table.
3337.         self.assertContains(response, 'id="id_form-0-id"', 1)
3338.         self.assertContains(response, 'id="id_form-1-id"', 1)
3339.         self.assertContains(
3340.             response,
3341.             '<div class="hiddenfields">\n'
3342.             '<input type="hidden" name="form-0-id" value="%d" id="id_form-0-id">'
3343.             '<input type="hidden" name="form-1-id" value="%d" id="id_form-1-id">\n</div>'
3344.             % (story2.id, story1.id),
3345.             html=True
3346.         )
3347.         self.assertContains(response, '<td class="field-id">%d</td>' % story1.id, 1)
3348.         self.assertContains(response, '<td class="field-id">%d</td>' % story2.id, 1)
3349. 
3350.     def test_pk_hidden_fields_with_list_display_links(self):
3351.         """ Similarly as test_pk_hidden_fields, but when the hidden pk fields are
3352.             referenced in list_display_links.
3353.             Refs #12475.
3354.         """
3355.         story1 = OtherStory.objects.create(
3356.             title='The adventures of Guido',
3357.             content='Once upon a time in Djangoland...',
3358.         )
3359.         story2 = OtherStory.objects.create(
3360.             title='Crouching Tiger, Hidden Python',
3361.             content='The Python was sneaking into...',
3362.         )
3363.         link1 = reverse('admin:admin_views_otherstory_change', args=(story1.pk,))
3364.         link2 = reverse('admin:admin_views_otherstory_change', args=(story2.pk,))
3365.         response = self.client.get(reverse('admin:admin_views_otherstory_changelist'))
3366.         # Only one hidden field, in a separate place than the table.
3367.         self.assertContains(response, 'id="id_form-0-id"', 1)
3368.         self.assertContains(response, 'id="id_form-1-id"', 1)
3369.         self.assertContains(
3370.             response,
3371.             '<div class="hiddenfields">\n'
3372.             '<input type="hidden" name="form-0-id" value="%d" id="id_form-0-id">'
3373.             '<input type="hidden" name="form-1-id" value="%d" id="id_form-1-id">\n</div>'
3374.             % (story2.id, story1.id),
3375.             html=True
3376.         )
3377.         self.assertContains(response, '<th class="field-id"><a href="%s">%d</a></th>' % (link1, story1.id), 1)
3378.         self.assertContains(response, '<th class="field-id"><a href="%s">%d</a></th>' % (link2, story2.id), 1)
3379. 
3380. 
3381. @override_settings(ROOT_URLCONF='admin_views.urls')
3382. class AdminSearchTest(TestCase):
3383. 
3384.     @classmethod
3385.     def setUpTestData(cls):
3386.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
3387.         cls.joepublicuser = User.objects.create_user(username='joepublic', password='secret')
3388.         cls.s1 = Section.objects.create(name='Test section')
3389.         cls.a1 = Article.objects.create(
3390.             content='<p>Middle content</p>', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1
3391.         )
3392.         cls.a2 = Article.objects.create(
3393.             content='<p>Oldest content</p>', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1
3394.         )
3395.         cls.a3 = Article.objects.create(
3396.             content='<p>Newest content</p>', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1
3397.         )
3398.         cls.p1 = PrePopulatedPost.objects.create(title='A Long Title', published=True, slug='a-long-title')
3399. 
3400.         cls.per1 = Person.objects.create(name='John Mauchly', gender=1, alive=True)
3401.         cls.per2 = Person.objects.create(name='Grace Hopper', gender=1, alive=False)
3402.         cls.per3 = Person.objects.create(name='Guido van Rossum', gender=1, alive=True)
3403. 
3404.         cls.t1 = Recommender.objects.create()
3405.         cls.t2 = Recommendation.objects.create(the_recommender=cls.t1)
3406.         cls.t3 = Recommender.objects.create()
3407.         cls.t4 = Recommendation.objects.create(the_recommender=cls.t3)
3408. 
3409.         cls.tt1 = TitleTranslation.objects.create(title=cls.t1, text='Bar')
3410.         cls.tt2 = TitleTranslation.objects.create(title=cls.t2, text='Foo')
3411.         cls.tt3 = TitleTranslation.objects.create(title=cls.t3, text='Few')
3412.         cls.tt4 = TitleTranslation.objects.create(title=cls.t4, text='Bas')
3413. 
3414.     def setUp(self):
3415.         self.client.force_login(self.superuser)
3416. 
3417.     def test_search_on_sibling_models(self):
3418.         "A search that mentions sibling models"
3419.         response = self.client.get(reverse('admin:admin_views_recommendation_changelist') + '?q=bar')
3420.         # confirm the search returned 1 object
3421.         self.assertContains(response, "\n1 recommendation\n")
3422. 
3423.     def test_with_fk_to_field(self):
3424.         """
3425.         The to_field GET parameter is preserved when a search is performed.
3426.         Refs #10918.
3427.         """
3428.         response = self.client.get(reverse('admin:auth_user_changelist') + '?q=joe&%s=id' % TO_FIELD_VAR)
3429.         self.assertContains(response, "\n1 user\n")
3430.         self.assertContains(response, '<input type="hidden" name="%s" value="id">' % TO_FIELD_VAR, html=True)
3431. 
3432.     def test_exact_matches(self):
3433.         response = self.client.get(reverse('admin:admin_views_recommendation_changelist') + '?q=bar')
3434.         # confirm the search returned one object
3435.         self.assertContains(response, "\n1 recommendation\n")
3436. 
3437.         response = self.client.get(reverse('admin:admin_views_recommendation_changelist') + '?q=ba')
3438.         # confirm the search returned zero objects
3439.         self.assertContains(response, "\n0 recommendations\n")
3440. 
3441.     def test_beginning_matches(self):
3442.         response = self.client.get(reverse('admin:admin_views_person_changelist') + '?q=Gui')
3443.         # confirm the search returned one object
3444.         self.assertContains(response, "\n1 person\n")
3445.         self.assertContains(response, "Guido")
3446. 
3447.         response = self.client.get(reverse('admin:admin_views_person_changelist') + '?q=uido')
3448.         # confirm the search returned zero objects
3449.         self.assertContains(response, "\n0 persons\n")
3450.         self.assertNotContains(response, "Guido")
3451. 
3452.     def test_pluggable_search(self):
3453.         PluggableSearchPerson.objects.create(name="Bob", age=10)
3454.         PluggableSearchPerson.objects.create(name="Amy", age=20)
3455. 
3456.         response = self.client.get(reverse('admin:admin_views_pluggablesearchperson_changelist') + '?q=Bob')
3457.         # confirm the search returned one object
3458.         self.assertContains(response, "\n1 pluggable search person\n")
3459.         self.assertContains(response, "Bob")
3460. 
3461.         response = self.client.get(reverse('admin:admin_views_pluggablesearchperson_changelist') + '?q=20')
3462.         # confirm the search returned one object
3463.         self.assertContains(response, "\n1 pluggable search person\n")
3464.         self.assertContains(response, "Amy")
3465. 
3466.     def test_reset_link(self):
3467.         """
3468.         Test presence of reset link in search bar ("1 result (_x total_)").
3469.         """
3470.         #   1 query for session + 1 for fetching user
3471.         # + 1 for filtered result + 1 for filtered count
3472.         # + 1 for total count
3473.         with self.assertNumQueries(5):
3474.             response = self.client.get(reverse('admin:admin_views_person_changelist') + '?q=Gui')
3475.         self.assertContains(
3476.             response,
3477.             """<span class="small quiet">1 result (<a href="?">3 total</a>)</span>""",
3478.             html=True
3479.         )
3480. 
3481.     def test_no_total_count(self):
3482.         """
3483.         #8408 -- "Show all" should be displayed instead of the total count if
3484.         ModelAdmin.show_full_result_count is False.
3485.         """
3486.         #   1 query for session + 1 for fetching user
3487.         # + 1 for filtered result + 1 for filtered count
3488.         with self.assertNumQueries(4):
3489.             response = self.client.get(reverse('admin:admin_views_recommendation_changelist') + '?q=bar')
3490.         self.assertContains(
3491.             response,
3492.             """<span class="small quiet">1 result (<a href="?">Show all</a>)</span>""",
3493.             html=True
3494.         )
3495.         self.assertTrue(response.context['cl'].show_admin_actions)
3496. 
3497. 
3498. @override_settings(ROOT_URLCONF='admin_views.urls')
3499. class AdminInheritedInlinesTest(TestCase):
3500. 
3501.     @classmethod

File: tests/admin_views/tests.py
Line number range: 3501 - 4001
Content:
3501.     @classmethod
3502.     def setUpTestData(cls):
3503.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
3504. 
3505.     def setUp(self):
3506.         self.client.force_login(self.superuser)
3507. 
3508.     def test_inline(self):
3509.         """
3510.         Inline models which inherit from a common parent are correctly handled.
3511.         """
3512.         foo_user = "foo username"
3513.         bar_user = "bar username"
3514. 
3515.         name_re = re.compile(b'name="(.*?)"')
3516. 
3517.         # test the add case
3518.         response = self.client.get(reverse('admin:admin_views_persona_add'))
3519.         names = name_re.findall(response.content)
3520.         # make sure we have no duplicate HTML names
3521.         self.assertEqual(len(names), len(set(names)))
3522. 
3523.         # test the add case
3524.         post_data = {
3525.             "name": "Test Name",
3526.             # inline data
3527.             "accounts-TOTAL_FORMS": "1",
3528.             "accounts-INITIAL_FORMS": "0",
3529.             "accounts-MAX_NUM_FORMS": "0",
3530.             "accounts-0-username": foo_user,
3531.             "accounts-2-TOTAL_FORMS": "1",
3532.             "accounts-2-INITIAL_FORMS": "0",
3533.             "accounts-2-MAX_NUM_FORMS": "0",
3534.             "accounts-2-0-username": bar_user,
3535.         }
3536. 
3537.         response = self.client.post(reverse('admin:admin_views_persona_add'), post_data)
3538.         self.assertEqual(response.status_code, 302)  # redirect somewhere
3539.         self.assertEqual(Persona.objects.count(), 1)
3540.         self.assertEqual(FooAccount.objects.count(), 1)
3541.         self.assertEqual(BarAccount.objects.count(), 1)
3542.         self.assertEqual(FooAccount.objects.all()[0].username, foo_user)
3543.         self.assertEqual(BarAccount.objects.all()[0].username, bar_user)
3544.         self.assertEqual(Persona.objects.all()[0].accounts.count(), 2)
3545. 
3546.         persona_id = Persona.objects.all()[0].id
3547.         foo_id = FooAccount.objects.all()[0].id
3548.         bar_id = BarAccount.objects.all()[0].id
3549. 
3550.         # test the edit case
3551. 
3552.         response = self.client.get(reverse('admin:admin_views_persona_change', args=(persona_id,)))
3553.         names = name_re.findall(response.content)
3554.         # make sure we have no duplicate HTML names
3555.         self.assertEqual(len(names), len(set(names)))
3556. 
3557.         post_data = {
3558.             "name": "Test Name",
3559. 
3560.             "accounts-TOTAL_FORMS": "2",
3561.             "accounts-INITIAL_FORMS": "1",
3562.             "accounts-MAX_NUM_FORMS": "0",
3563. 
3564.             "accounts-0-username": "%s-1" % foo_user,
3565.             "accounts-0-account_ptr": str(foo_id),
3566.             "accounts-0-persona": str(persona_id),
3567. 
3568.             "accounts-2-TOTAL_FORMS": "2",
3569.             "accounts-2-INITIAL_FORMS": "1",
3570.             "accounts-2-MAX_NUM_FORMS": "0",
3571. 
3572.             "accounts-2-0-username": "%s-1" % bar_user,
3573.             "accounts-2-0-account_ptr": str(bar_id),
3574.             "accounts-2-0-persona": str(persona_id),
3575.         }
3576.         response = self.client.post(reverse('admin:admin_views_persona_change', args=(persona_id,)), post_data)
3577.         self.assertEqual(response.status_code, 302)
3578.         self.assertEqual(Persona.objects.count(), 1)
3579.         self.assertEqual(FooAccount.objects.count(), 1)
3580.         self.assertEqual(BarAccount.objects.count(), 1)
3581.         self.assertEqual(FooAccount.objects.all()[0].username, "%s-1" % foo_user)
3582.         self.assertEqual(BarAccount.objects.all()[0].username, "%s-1" % bar_user)
3583.         self.assertEqual(Persona.objects.all()[0].accounts.count(), 2)
3584. 
3585. 
3586. @override_settings(ROOT_URLCONF='admin_views.urls')
3587. class TestCustomChangeList(TestCase):
3588. 
3589.     @classmethod
3590.     def setUpTestData(cls):
3591.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
3592. 
3593.     def setUp(self):
3594.         self.client.force_login(self.superuser)
3595. 
3596.     def test_custom_changelist(self):
3597.         """
3598.         Validate that a custom ChangeList class can be used (#9749)
3599.         """
3600.         # Insert some data
3601.         post_data = {"name": "First Gadget"}
3602.         response = self.client.post(reverse('admin:admin_views_gadget_add'), post_data)
3603.         self.assertEqual(response.status_code, 302)  # redirect somewhere
3604.         # Hit the page once to get messages out of the queue message list
3605.         response = self.client.get(reverse('admin:admin_views_gadget_changelist'))
3606.         # Data is still not visible on the page
3607.         response = self.client.get(reverse('admin:admin_views_gadget_changelist'))
3608.         self.assertEqual(response.status_code, 200)
3609.         self.assertNotContains(response, 'First Gadget')
3610. 
3611. 
3612. @override_settings(ROOT_URLCONF='admin_views.urls')
3613. class TestInlineNotEditable(TestCase):
3614. 
3615.     @classmethod
3616.     def setUpTestData(cls):
3617.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
3618. 
3619.     def setUp(self):
3620.         self.client.force_login(self.superuser)
3621. 
3622.     def test_GET_parent_add(self):
3623.         """
3624.         InlineModelAdmin broken?
3625.         """
3626.         response = self.client.get(reverse('admin:admin_views_parent_add'))
3627.         self.assertEqual(response.status_code, 200)
3628. 
3629. 
3630. @override_settings(ROOT_URLCONF='admin_views.urls')
3631. class AdminCustomQuerysetTest(TestCase):
3632. 
3633.     @classmethod
3634.     def setUpTestData(cls):
3635.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
3636.         cls.pks = [EmptyModel.objects.create().id for i in range(3)]
3637. 
3638.     def setUp(self):
3639.         self.client.force_login(self.superuser)
3640.         self.super_login = {
3641.             REDIRECT_FIELD_NAME: reverse('admin:index'),
3642.             'username': 'super',
3643.             'password': 'secret',
3644.         }
3645. 
3646.     def test_changelist_view(self):
3647.         response = self.client.get(reverse('admin:admin_views_emptymodel_changelist'))
3648.         for i in self.pks:
3649.             if i > 1:
3650.                 self.assertContains(response, 'Primary key = %s' % i)
3651.             else:
3652.                 self.assertNotContains(response, 'Primary key = %s' % i)
3653. 
3654.     def test_changelist_view_count_queries(self):
3655.         # create 2 Person objects
3656.         Person.objects.create(name='person1', gender=1)
3657.         Person.objects.create(name='person2', gender=2)
3658.         changelist_url = reverse('admin:admin_views_person_changelist')
3659. 
3660.         # 5 queries are expected: 1 for the session, 1 for the user,
3661.         # 2 for the counts and 1 for the objects on the page
3662.         with self.assertNumQueries(5):
3663.             resp = self.client.get(changelist_url)
3664.             self.assertEqual(resp.context['selection_note'], '0 of 2 selected')
3665.             self.assertEqual(resp.context['selection_note_all'], 'All 2 selected')
3666.         with self.assertNumQueries(5):
3667.             extra = {'q': 'not_in_name'}
3668.             resp = self.client.get(changelist_url, extra)
3669.             self.assertEqual(resp.context['selection_note'], '0 of 0 selected')
3670.             self.assertEqual(resp.context['selection_note_all'], 'All 0 selected')
3671.         with self.assertNumQueries(5):
3672.             extra = {'q': 'person'}
3673.             resp = self.client.get(changelist_url, extra)
3674.             self.assertEqual(resp.context['selection_note'], '0 of 2 selected')
3675.             self.assertEqual(resp.context['selection_note_all'], 'All 2 selected')
3676.         with self.assertNumQueries(5):
3677.             extra = {'gender__exact': '1'}
3678.             resp = self.client.get(changelist_url, extra)
3679.             self.assertEqual(resp.context['selection_note'], '0 of 1 selected')
3680.             self.assertEqual(resp.context['selection_note_all'], '1 selected')
3681. 
3682.     def test_change_view(self):
3683.         for i in self.pks:
3684.             url = reverse('admin:admin_views_emptymodel_change', args=(i,))
3685.             response = self.client.get(url, follow=True)
3686.             if i > 1:
3687.                 self.assertEqual(response.status_code, 200)
3688.             else:
3689.                 self.assertRedirects(response, reverse('admin:index'))
3690.                 self.assertEqual(
3691.                     [m.message for m in response.context['messages']],
3692.                     ["""empty model with ID "1" doesn't exist. Perhaps it was deleted?"""]
3693.                 )
3694. 
3695.     def test_add_model_modeladmin_defer_qs(self):
3696.         # Test for #14529. defer() is used in ModelAdmin.get_queryset()
3697. 
3698.         # model has __str__ method
3699.         self.assertEqual(CoverLetter.objects.count(), 0)
3700.         # Emulate model instance creation via the admin
3701.         post_data = {
3702.             "author": "Candidate, Best",
3703.             "_save": "Save",
3704.         }
3705.         response = self.client.post(reverse('admin:admin_views_coverletter_add'), post_data, follow=True)
3706.         self.assertEqual(response.status_code, 200)
3707.         self.assertEqual(CoverLetter.objects.count(), 1)
3708.         # Message should contain non-ugly model verbose name
3709.         pk = CoverLetter.objects.all()[0].pk
3710.         self.assertContains(
3711.             response,
3712.             '<li class="success">The cover letter "<a href="%s">'
3713.             'Candidate, Best</a>" was added successfully.</li>' %
3714.             reverse('admin:admin_views_coverletter_change', args=(pk,)), html=True
3715.         )
3716. 
3717.         # model has no __str__ method
3718.         self.assertEqual(ShortMessage.objects.count(), 0)
3719.         # Emulate model instance creation via the admin
3720.         post_data = {
3721.             "content": "What's this SMS thing?",
3722.             "_save": "Save",
3723.         }
3724.         response = self.client.post(reverse('admin:admin_views_shortmessage_add'), post_data, follow=True)
3725.         self.assertEqual(response.status_code, 200)
3726.         self.assertEqual(ShortMessage.objects.count(), 1)
3727.         # Message should contain non-ugly model verbose name
3728.         sm = ShortMessage.objects.all()[0]
3729.         self.assertContains(
3730.             response,
3731.             '<li class="success">The short message "<a href="%s">'
3732.             '%s</a>" was added successfully.</li>' %
3733.             (reverse('admin:admin_views_shortmessage_change', args=(sm.pk,)), sm), html=True
3734.         )
3735. 
3736.     def test_add_model_modeladmin_only_qs(self):
3737.         # Test for #14529. only() is used in ModelAdmin.get_queryset()
3738. 
3739.         # model has __str__ method
3740.         self.assertEqual(Telegram.objects.count(), 0)
3741.         # Emulate model instance creation via the admin
3742.         post_data = {
3743.             "title": "Urgent telegram",
3744.             "_save": "Save",
3745.         }
3746.         response = self.client.post(reverse('admin:admin_views_telegram_add'), post_data, follow=True)
3747.         self.assertEqual(response.status_code, 200)
3748.         self.assertEqual(Telegram.objects.count(), 1)
3749.         # Message should contain non-ugly model verbose name
3750.         pk = Telegram.objects.all()[0].pk
3751.         self.assertContains(
3752.             response,
3753.             '<li class="success">The telegram "<a href="%s">'
3754.             'Urgent telegram</a>" was added successfully.</li>' %
3755.             reverse('admin:admin_views_telegram_change', args=(pk,)), html=True
3756.         )
3757. 
3758.         # model has no __str__ method
3759.         self.assertEqual(Paper.objects.count(), 0)
3760.         # Emulate model instance creation via the admin
3761.         post_data = {
3762.             "title": "My Modified Paper Title",
3763.             "_save": "Save",
3764.         }
3765.         response = self.client.post(reverse('admin:admin_views_paper_add'), post_data, follow=True)
3766.         self.assertEqual(response.status_code, 200)
3767.         self.assertEqual(Paper.objects.count(), 1)
3768.         # Message should contain non-ugly model verbose name
3769.         p = Paper.objects.all()[0]
3770.         self.assertContains(
3771.             response,
3772.             '<li class="success">The paper "<a href="%s">'
3773.             '%s</a>" was added successfully.</li>' %
3774.             (reverse('admin:admin_views_paper_change', args=(p.pk,)), p), html=True
3775.         )
3776. 
3777.     def test_edit_model_modeladmin_defer_qs(self):
3778.         # Test for #14529. defer() is used in ModelAdmin.get_queryset()
3779. 
3780.         # model has __str__ method
3781.         cl = CoverLetter.objects.create(author="John Doe")
3782.         self.assertEqual(CoverLetter.objects.count(), 1)
3783.         response = self.client.get(reverse('admin:admin_views_coverletter_change', args=(cl.pk,)))
3784.         self.assertEqual(response.status_code, 200)
3785.         # Emulate model instance edit via the admin
3786.         post_data = {
3787.             "author": "John Doe II",
3788.             "_save": "Save",
3789.         }
3790.         url = reverse('admin:admin_views_coverletter_change', args=(cl.pk,))
3791.         response = self.client.post(url, post_data, follow=True)
3792.         self.assertEqual(response.status_code, 200)
3793.         self.assertEqual(CoverLetter.objects.count(), 1)
3794.         # Message should contain non-ugly model verbose name. Instance
3795.         # representation is set by model's __str__()
3796.         self.assertContains(
3797.             response,
3798.             '<li class="success">The cover letter "<a href="%s">'
3799.             'John Doe II</a>" was changed successfully.</li>' %
3800.             reverse('admin:admin_views_coverletter_change', args=(cl.pk,)), html=True
3801.         )
3802. 
3803.         # model has no __str__ method
3804.         sm = ShortMessage.objects.create(content="This is expensive")
3805.         self.assertEqual(ShortMessage.objects.count(), 1)
3806.         response = self.client.get(reverse('admin:admin_views_shortmessage_change', args=(sm.pk,)))
3807.         self.assertEqual(response.status_code, 200)
3808.         # Emulate model instance edit via the admin
3809.         post_data = {
3810.             "content": "Too expensive",
3811.             "_save": "Save",
3812.         }
3813.         url = reverse('admin:admin_views_shortmessage_change', args=(sm.pk,))
3814.         response = self.client.post(url, post_data, follow=True)
3815.         self.assertEqual(response.status_code, 200)
3816.         self.assertEqual(ShortMessage.objects.count(), 1)
3817.         # Message should contain non-ugly model verbose name. The ugly(!)
3818.         # instance representation is set by __str__().
3819.         self.assertContains(
3820.             response,
3821.             '<li class="success">The short message "<a href="%s">'
3822.             '%s</a>" was changed successfully.</li>' %
3823.             (reverse('admin:admin_views_shortmessage_change', args=(sm.pk,)), sm), html=True
3824.         )
3825. 
3826.     def test_edit_model_modeladmin_only_qs(self):
3827.         # Test for #14529. only() is used in ModelAdmin.get_queryset()
3828. 
3829.         # model has __str__ method
3830.         t = Telegram.objects.create(title="First Telegram")
3831.         self.assertEqual(Telegram.objects.count(), 1)
3832.         response = self.client.get(reverse('admin:admin_views_telegram_change', args=(t.pk,)))
3833.         self.assertEqual(response.status_code, 200)
3834.         # Emulate model instance edit via the admin
3835.         post_data = {
3836.             "title": "Telegram without typo",
3837.             "_save": "Save",
3838.         }
3839.         response = self.client.post(reverse('admin:admin_views_telegram_change', args=(t.pk,)), post_data, follow=True)
3840.         self.assertEqual(response.status_code, 200)
3841.         self.assertEqual(Telegram.objects.count(), 1)
3842.         # Message should contain non-ugly model verbose name. The instance
3843.         # representation is set by model's __str__()
3844.         self.assertContains(
3845.             response,
3846.             '<li class="success">The telegram "<a href="%s">'
3847.             'Telegram without typo</a>" was changed successfully.</li>' %
3848.             reverse('admin:admin_views_telegram_change', args=(t.pk,)), html=True
3849.         )
3850. 
3851.         # model has no __str__ method
3852.         p = Paper.objects.create(title="My Paper Title")
3853.         self.assertEqual(Paper.objects.count(), 1)
3854.         response = self.client.get(reverse('admin:admin_views_paper_change', args=(p.pk,)))
3855.         self.assertEqual(response.status_code, 200)
3856.         # Emulate model instance edit via the admin
3857.         post_data = {
3858.             "title": "My Modified Paper Title",
3859.             "_save": "Save",
3860.         }
3861.         response = self.client.post(reverse('admin:admin_views_paper_change', args=(p.pk,)), post_data, follow=True)
3862.         self.assertEqual(response.status_code, 200)
3863.         self.assertEqual(Paper.objects.count(), 1)
3864.         # Message should contain non-ugly model verbose name. The ugly(!)
3865.         # instance representation is set by __str__().
3866.         self.assertContains(
3867.             response,
3868.             '<li class="success">The paper "<a href="%s">'
3869.             '%s</a>" was changed successfully.</li>' %
3870.             (reverse('admin:admin_views_paper_change', args=(p.pk,)), p), html=True
3871.         )
3872. 
3873.     def test_history_view_custom_qs(self):
3874.         """
3875.         Custom querysets are considered for the admin history view.
3876.         """
3877.         self.client.post(reverse('admin:login'), self.super_login)
3878.         FilteredManager.objects.create(pk=1)
3879.         FilteredManager.objects.create(pk=2)
3880.         response = self.client.get(reverse('admin:admin_views_filteredmanager_changelist'))
3881.         self.assertContains(response, "PK=1")
3882.         self.assertContains(response, "PK=2")
3883.         self.assertEqual(
3884.             self.client.get(reverse('admin:admin_views_filteredmanager_history', args=(1,))).status_code, 200
3885.         )
3886.         self.assertEqual(
3887.             self.client.get(reverse('admin:admin_views_filteredmanager_history', args=(2,))).status_code, 200
3888.         )
3889. 
3890. 
3891. @override_settings(ROOT_URLCONF='admin_views.urls')
3892. class AdminInlineFileUploadTest(TestCase):
3893. 
3894.     @classmethod
3895.     def setUpTestData(cls):
3896.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
3897.         file1 = tempfile.NamedTemporaryFile(suffix=".file1")
3898.         file1.write(b'a' * (2 ** 21))
3899.         filename = file1.name
3900.         file1.close()
3901.         cls.gallery = Gallery.objects.create(name='Test Gallery')
3902.         cls.picture = Picture.objects.create(
3903.             name='Test Picture',
3904.             image=filename,
3905.             gallery=cls.gallery,
3906.         )
3907. 
3908.     def setUp(self):
3909.         self.client.force_login(self.superuser)
3910. 
3911.     def test_form_has_multipart_enctype(self):
3912.         response = self.client.get(
3913.             reverse('admin:admin_views_gallery_change', args=(self.gallery.id,))
3914.         )
3915.         self.assertIs(response.context['has_file_field'], True)
3916.         self.assertContains(response, MULTIPART_ENCTYPE)
3917. 
3918.     def test_inline_file_upload_edit_validation_error_post(self):
3919.         """
3920.         Inline file uploads correctly display prior data (#10002).
3921.         """
3922.         post_data = {
3923.             "name": "Test Gallery",
3924.             "pictures-TOTAL_FORMS": "2",
3925.             "pictures-INITIAL_FORMS": "1",
3926.             "pictures-MAX_NUM_FORMS": "0",
3927.             "pictures-0-id": str(self.picture.id),
3928.             "pictures-0-gallery": str(self.gallery.id),
3929.             "pictures-0-name": "Test Picture",
3930.             "pictures-0-image": "",
3931.             "pictures-1-id": "",
3932.             "pictures-1-gallery": str(self.gallery.id),
3933.             "pictures-1-name": "Test Picture 2",
3934.             "pictures-1-image": "",
3935.         }
3936.         response = self.client.post(
3937.             reverse('admin:admin_views_gallery_change', args=(self.gallery.id,)), post_data
3938.         )
3939.         self.assertContains(response, b"Currently")
3940. 
3941. 
3942. @override_settings(ROOT_URLCONF='admin_views.urls')
3943. class AdminInlineTests(TestCase):
3944. 
3945.     @classmethod
3946.     def setUpTestData(cls):
3947.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
3948.         cls.collector = Collector.objects.create(pk=1, name='John Fowles')
3949. 
3950.     def setUp(self):
3951.         self.post_data = {
3952.             "name": "Test Name",
3953. 
3954.             "widget_set-TOTAL_FORMS": "3",
3955.             "widget_set-INITIAL_FORMS": "0",
3956.             "widget_set-MAX_NUM_FORMS": "0",
3957.             "widget_set-0-id": "",
3958.             "widget_set-0-owner": "1",
3959.             "widget_set-0-name": "",
3960.             "widget_set-1-id": "",
3961.             "widget_set-1-owner": "1",
3962.             "widget_set-1-name": "",
3963.             "widget_set-2-id": "",
3964.             "widget_set-2-owner": "1",
3965.             "widget_set-2-name": "",
3966. 
3967.             "doohickey_set-TOTAL_FORMS": "3",
3968.             "doohickey_set-INITIAL_FORMS": "0",
3969.             "doohickey_set-MAX_NUM_FORMS": "0",
3970.             "doohickey_set-0-owner": "1",
3971.             "doohickey_set-0-code": "",
3972.             "doohickey_set-0-name": "",
3973.             "doohickey_set-1-owner": "1",
3974.             "doohickey_set-1-code": "",
3975.             "doohickey_set-1-name": "",
3976.             "doohickey_set-2-owner": "1",
3977.             "doohickey_set-2-code": "",
3978.             "doohickey_set-2-name": "",
3979. 
3980.             "grommet_set-TOTAL_FORMS": "3",
3981.             "grommet_set-INITIAL_FORMS": "0",
3982.             "grommet_set-MAX_NUM_FORMS": "0",
3983.             "grommet_set-0-code": "",
3984.             "grommet_set-0-owner": "1",
3985.             "grommet_set-0-name": "",
3986.             "grommet_set-1-code": "",
3987.             "grommet_set-1-owner": "1",
3988.             "grommet_set-1-name": "",
3989.             "grommet_set-2-code": "",
3990.             "grommet_set-2-owner": "1",
3991.             "grommet_set-2-name": "",
3992. 
3993.             "whatsit_set-TOTAL_FORMS": "3",
3994.             "whatsit_set-INITIAL_FORMS": "0",
3995.             "whatsit_set-MAX_NUM_FORMS": "0",
3996.             "whatsit_set-0-owner": "1",
3997.             "whatsit_set-0-index": "",
3998.             "whatsit_set-0-name": "",
3999.             "whatsit_set-1-owner": "1",
4000.             "whatsit_set-1-index": "",
4001.             "whatsit_set-1-name": "",

File: tests/admin_views/tests.py
Line number range: 4001 - 4501
Content:
4001.             "whatsit_set-1-name": "",
4002.             "whatsit_set-2-owner": "1",
4003.             "whatsit_set-2-index": "",
4004.             "whatsit_set-2-name": "",
4005. 
4006.             "fancydoodad_set-TOTAL_FORMS": "3",
4007.             "fancydoodad_set-INITIAL_FORMS": "0",
4008.             "fancydoodad_set-MAX_NUM_FORMS": "0",
4009.             "fancydoodad_set-0-doodad_ptr": "",
4010.             "fancydoodad_set-0-owner": "1",
4011.             "fancydoodad_set-0-name": "",
4012.             "fancydoodad_set-0-expensive": "on",
4013.             "fancydoodad_set-1-doodad_ptr": "",
4014.             "fancydoodad_set-1-owner": "1",
4015.             "fancydoodad_set-1-name": "",
4016.             "fancydoodad_set-1-expensive": "on",
4017.             "fancydoodad_set-2-doodad_ptr": "",
4018.             "fancydoodad_set-2-owner": "1",
4019.             "fancydoodad_set-2-name": "",
4020.             "fancydoodad_set-2-expensive": "on",
4021. 
4022.             "category_set-TOTAL_FORMS": "3",
4023.             "category_set-INITIAL_FORMS": "0",
4024.             "category_set-MAX_NUM_FORMS": "0",
4025.             "category_set-0-order": "",
4026.             "category_set-0-id": "",
4027.             "category_set-0-collector": "1",
4028.             "category_set-1-order": "",
4029.             "category_set-1-id": "",
4030.             "category_set-1-collector": "1",
4031.             "category_set-2-order": "",
4032.             "category_set-2-id": "",
4033.             "category_set-2-collector": "1",
4034.         }
4035. 
4036.         self.client.force_login(self.superuser)
4037. 
4038.     def test_simple_inline(self):
4039.         "A simple model can be saved as inlines"
4040.         # First add a new inline
4041.         self.post_data['widget_set-0-name'] = "Widget 1"
4042.         collector_url = reverse('admin:admin_views_collector_change', args=(self.collector.pk,))
4043.         response = self.client.post(collector_url, self.post_data)
4044.         self.assertEqual(response.status_code, 302)
4045.         self.assertEqual(Widget.objects.count(), 1)
4046.         self.assertEqual(Widget.objects.all()[0].name, "Widget 1")
4047.         widget_id = Widget.objects.all()[0].id
4048. 
4049.         # The PK link exists on the rendered form
4050.         response = self.client.get(collector_url)
4051.         self.assertContains(response, 'name="widget_set-0-id"')
4052. 
4053.         # No file or image fields, no enctype on the forms
4054.         self.assertIs(response.context['has_file_field'], False)
4055.         self.assertNotContains(response, MULTIPART_ENCTYPE)
4056. 
4057.         # Now resave that inline
4058.         self.post_data['widget_set-INITIAL_FORMS'] = "1"
4059.         self.post_data['widget_set-0-id'] = str(widget_id)
4060.         self.post_data['widget_set-0-name'] = "Widget 1"
4061.         response = self.client.post(collector_url, self.post_data)
4062.         self.assertEqual(response.status_code, 302)
4063.         self.assertEqual(Widget.objects.count(), 1)
4064.         self.assertEqual(Widget.objects.all()[0].name, "Widget 1")
4065. 
4066.         # Now modify that inline
4067.         self.post_data['widget_set-INITIAL_FORMS'] = "1"
4068.         self.post_data['widget_set-0-id'] = str(widget_id)
4069.         self.post_data['widget_set-0-name'] = "Widget 1 Updated"
4070.         response = self.client.post(collector_url, self.post_data)
4071.         self.assertEqual(response.status_code, 302)
4072.         self.assertEqual(Widget.objects.count(), 1)
4073.         self.assertEqual(Widget.objects.all()[0].name, "Widget 1 Updated")
4074. 
4075.     def test_simple_inline_permissions(self):
4076.         """
4077.         Changes aren't allowed without change permissions for the inline object.
4078.         """
4079.         # User who can view Articles
4080.         permissionuser = User.objects.create_user(
4081.             username='permissionuser', password='secret',
4082.             email='vuser@example.com', is_staff=True,
4083.         )
4084.         permissionuser.user_permissions.add(get_perm(Collector, get_permission_codename('view', Collector._meta)))
4085.         permissionuser.user_permissions.add(get_perm(Widget, get_permission_codename('view', Widget._meta)))
4086.         self.client.force_login(permissionuser)
4087.         # Without add permission, a new inline can't be added.
4088.         self.post_data['widget_set-0-name'] = 'Widget 1'
4089.         collector_url = reverse('admin:admin_views_collector_change', args=(self.collector.pk,))
4090.         response = self.client.post(collector_url, self.post_data)
4091.         self.assertEqual(response.status_code, 302)
4092.         self.assertEqual(Widget.objects.count(), 0)
4093.         # But after adding the permisson it can.
4094.         permissionuser.user_permissions.add(get_perm(Widget, get_permission_codename('add', Widget._meta)))
4095.         self.post_data['widget_set-0-name'] = "Widget 1"
4096.         collector_url = reverse('admin:admin_views_collector_change', args=(self.collector.pk,))
4097.         response = self.client.post(collector_url, self.post_data)
4098.         self.assertEqual(response.status_code, 302)
4099.         self.assertEqual(Widget.objects.count(), 1)
4100.         self.assertEqual(Widget.objects.first().name, 'Widget 1')
4101.         widget_id = Widget.objects.first().id
4102.         # Without the change permission, a POST doesn't change the object.
4103.         self.post_data['widget_set-INITIAL_FORMS'] = '1'
4104.         self.post_data['widget_set-0-id'] = str(widget_id)
4105.         self.post_data['widget_set-0-name'] = 'Widget 1 Updated'
4106.         response = self.client.post(collector_url, self.post_data)
4107.         self.assertEqual(response.status_code, 302)
4108.         self.assertEqual(Widget.objects.count(), 1)
4109.         self.assertEqual(Widget.objects.first().name, 'Widget 1')
4110.         # Now adding the change permission and editing works.
4111.         permissionuser.user_permissions.remove(get_perm(Widget, get_permission_codename('add', Widget._meta)))
4112.         permissionuser.user_permissions.add(get_perm(Widget, get_permission_codename('change', Widget._meta)))
4113.         self.post_data['widget_set-INITIAL_FORMS'] = '1'
4114.         self.post_data['widget_set-0-id'] = str(widget_id)
4115.         self.post_data['widget_set-0-name'] = 'Widget 1 Updated'
4116.         response = self.client.post(collector_url, self.post_data)
4117.         self.assertEqual(response.status_code, 302)
4118.         self.assertEqual(Widget.objects.count(), 1)
4119.         self.assertEqual(Widget.objects.first().name, 'Widget 1 Updated')
4120. 
4121.     def test_explicit_autofield_inline(self):
4122.         "A model with an explicit autofield primary key can be saved as inlines. Regression for #8093"
4123.         # First add a new inline
4124.         self.post_data['grommet_set-0-name'] = "Grommet 1"
4125.         collector_url = reverse('admin:admin_views_collector_change', args=(self.collector.pk,))
4126.         response = self.client.post(collector_url, self.post_data)
4127.         self.assertEqual(response.status_code, 302)
4128.         self.assertEqual(Grommet.objects.count(), 1)
4129.         self.assertEqual(Grommet.objects.all()[0].name, "Grommet 1")
4130. 
4131.         # The PK link exists on the rendered form
4132.         response = self.client.get(collector_url)
4133.         self.assertContains(response, 'name="grommet_set-0-code"')
4134. 
4135.         # Now resave that inline
4136.         self.post_data['grommet_set-INITIAL_FORMS'] = "1"
4137.         self.post_data['grommet_set-0-code'] = str(Grommet.objects.all()[0].code)
4138.         self.post_data['grommet_set-0-name'] = "Grommet 1"
4139.         response = self.client.post(collector_url, self.post_data)
4140.         self.assertEqual(response.status_code, 302)
4141.         self.assertEqual(Grommet.objects.count(), 1)
4142.         self.assertEqual(Grommet.objects.all()[0].name, "Grommet 1")
4143. 
4144.         # Now modify that inline
4145.         self.post_data['grommet_set-INITIAL_FORMS'] = "1"
4146.         self.post_data['grommet_set-0-code'] = str(Grommet.objects.all()[0].code)
4147.         self.post_data['grommet_set-0-name'] = "Grommet 1 Updated"
4148.         response = self.client.post(collector_url, self.post_data)
4149.         self.assertEqual(response.status_code, 302)
4150.         self.assertEqual(Grommet.objects.count(), 1)
4151.         self.assertEqual(Grommet.objects.all()[0].name, "Grommet 1 Updated")
4152. 
4153.     def test_char_pk_inline(self):
4154.         "A model with a character PK can be saved as inlines. Regression for #10992"
4155.         # First add a new inline
4156.         self.post_data['doohickey_set-0-code'] = "DH1"
4157.         self.post_data['doohickey_set-0-name'] = "Doohickey 1"
4158.         collector_url = reverse('admin:admin_views_collector_change', args=(self.collector.pk,))
4159.         response = self.client.post(collector_url, self.post_data)
4160.         self.assertEqual(response.status_code, 302)
4161.         self.assertEqual(DooHickey.objects.count(), 1)
4162.         self.assertEqual(DooHickey.objects.all()[0].name, "Doohickey 1")
4163. 
4164.         # The PK link exists on the rendered form
4165.         response = self.client.get(collector_url)
4166.         self.assertContains(response, 'name="doohickey_set-0-code"')
4167. 
4168.         # Now resave that inline
4169.         self.post_data['doohickey_set-INITIAL_FORMS'] = "1"
4170.         self.post_data['doohickey_set-0-code'] = "DH1"
4171.         self.post_data['doohickey_set-0-name'] = "Doohickey 1"
4172.         response = self.client.post(collector_url, self.post_data)
4173.         self.assertEqual(response.status_code, 302)
4174.         self.assertEqual(DooHickey.objects.count(), 1)
4175.         self.assertEqual(DooHickey.objects.all()[0].name, "Doohickey 1")
4176. 
4177.         # Now modify that inline
4178.         self.post_data['doohickey_set-INITIAL_FORMS'] = "1"
4179.         self.post_data['doohickey_set-0-code'] = "DH1"
4180.         self.post_data['doohickey_set-0-name'] = "Doohickey 1 Updated"
4181.         response = self.client.post(collector_url, self.post_data)
4182.         self.assertEqual(response.status_code, 302)
4183.         self.assertEqual(DooHickey.objects.count(), 1)
4184.         self.assertEqual(DooHickey.objects.all()[0].name, "Doohickey 1 Updated")
4185. 
4186.     def test_integer_pk_inline(self):
4187.         "A model with an integer PK can be saved as inlines. Regression for #10992"
4188.         # First add a new inline
4189.         self.post_data['whatsit_set-0-index'] = "42"
4190.         self.post_data['whatsit_set-0-name'] = "Whatsit 1"
4191.         collector_url = reverse('admin:admin_views_collector_change', args=(self.collector.pk,))
4192.         response = self.client.post(collector_url, self.post_data)
4193.         self.assertEqual(response.status_code, 302)
4194.         self.assertEqual(Whatsit.objects.count(), 1)
4195.         self.assertEqual(Whatsit.objects.all()[0].name, "Whatsit 1")
4196. 
4197.         # The PK link exists on the rendered form
4198.         response = self.client.get(collector_url)
4199.         self.assertContains(response, 'name="whatsit_set-0-index"')
4200. 
4201.         # Now resave that inline
4202.         self.post_data['whatsit_set-INITIAL_FORMS'] = "1"
4203.         self.post_data['whatsit_set-0-index'] = "42"
4204.         self.post_data['whatsit_set-0-name'] = "Whatsit 1"
4205.         response = self.client.post(collector_url, self.post_data)
4206.         self.assertEqual(response.status_code, 302)
4207.         self.assertEqual(Whatsit.objects.count(), 1)
4208.         self.assertEqual(Whatsit.objects.all()[0].name, "Whatsit 1")
4209. 
4210.         # Now modify that inline
4211.         self.post_data['whatsit_set-INITIAL_FORMS'] = "1"
4212.         self.post_data['whatsit_set-0-index'] = "42"
4213.         self.post_data['whatsit_set-0-name'] = "Whatsit 1 Updated"
4214.         response = self.client.post(collector_url, self.post_data)
4215.         self.assertEqual(response.status_code, 302)
4216.         self.assertEqual(Whatsit.objects.count(), 1)
4217.         self.assertEqual(Whatsit.objects.all()[0].name, "Whatsit 1 Updated")
4218. 
4219.     def test_inherited_inline(self):
4220.         "An inherited model can be saved as inlines. Regression for #11042"
4221.         # First add a new inline
4222.         self.post_data['fancydoodad_set-0-name'] = "Fancy Doodad 1"
4223.         collector_url = reverse('admin:admin_views_collector_change', args=(self.collector.pk,))
4224.         response = self.client.post(collector_url, self.post_data)
4225.         self.assertEqual(response.status_code, 302)
4226.         self.assertEqual(FancyDoodad.objects.count(), 1)
4227.         self.assertEqual(FancyDoodad.objects.all()[0].name, "Fancy Doodad 1")
4228.         doodad_pk = FancyDoodad.objects.all()[0].pk
4229. 
4230.         # The PK link exists on the rendered form
4231.         response = self.client.get(collector_url)
4232.         self.assertContains(response, 'name="fancydoodad_set-0-doodad_ptr"')
4233. 
4234.         # Now resave that inline
4235.         self.post_data['fancydoodad_set-INITIAL_FORMS'] = "1"
4236.         self.post_data['fancydoodad_set-0-doodad_ptr'] = str(doodad_pk)
4237.         self.post_data['fancydoodad_set-0-name'] = "Fancy Doodad 1"
4238.         response = self.client.post(collector_url, self.post_data)
4239.         self.assertEqual(response.status_code, 302)
4240.         self.assertEqual(FancyDoodad.objects.count(), 1)
4241.         self.assertEqual(FancyDoodad.objects.all()[0].name, "Fancy Doodad 1")
4242. 
4243.         # Now modify that inline
4244.         self.post_data['fancydoodad_set-INITIAL_FORMS'] = "1"
4245.         self.post_data['fancydoodad_set-0-doodad_ptr'] = str(doodad_pk)
4246.         self.post_data['fancydoodad_set-0-name'] = "Fancy Doodad 1 Updated"
4247.         response = self.client.post(collector_url, self.post_data)
4248.         self.assertEqual(response.status_code, 302)
4249.         self.assertEqual(FancyDoodad.objects.count(), 1)
4250.         self.assertEqual(FancyDoodad.objects.all()[0].name, "Fancy Doodad 1 Updated")
4251. 
4252.     def test_ordered_inline(self):
4253.         """
4254.         An inline with an editable ordering fields is updated correctly.
4255.         """
4256.         # Create some objects with an initial ordering
4257.         Category.objects.create(id=1, order=1, collector=self.collector)
4258.         Category.objects.create(id=2, order=2, collector=self.collector)
4259.         Category.objects.create(id=3, order=0, collector=self.collector)
4260.         Category.objects.create(id=4, order=0, collector=self.collector)
4261. 
4262.         # NB: The order values must be changed so that the items are reordered.
4263.         self.post_data.update({
4264.             "name": "Frederick Clegg",
4265. 
4266.             "category_set-TOTAL_FORMS": "7",
4267.             "category_set-INITIAL_FORMS": "4",
4268.             "category_set-MAX_NUM_FORMS": "0",
4269. 
4270.             "category_set-0-order": "14",
4271.             "category_set-0-id": "1",
4272.             "category_set-0-collector": "1",
4273. 
4274.             "category_set-1-order": "13",
4275.             "category_set-1-id": "2",
4276.             "category_set-1-collector": "1",
4277. 
4278.             "category_set-2-order": "1",
4279.             "category_set-2-id": "3",
4280.             "category_set-2-collector": "1",
4281. 
4282.             "category_set-3-order": "0",
4283.             "category_set-3-id": "4",
4284.             "category_set-3-collector": "1",
4285. 
4286.             "category_set-4-order": "",
4287.             "category_set-4-id": "",
4288.             "category_set-4-collector": "1",
4289. 
4290.             "category_set-5-order": "",
4291.             "category_set-5-id": "",
4292.             "category_set-5-collector": "1",
4293. 
4294.             "category_set-6-order": "",
4295.             "category_set-6-id": "",
4296.             "category_set-6-collector": "1",
4297.         })
4298.         collector_url = reverse('admin:admin_views_collector_change', args=(self.collector.pk,))
4299.         response = self.client.post(collector_url, self.post_data)
4300.         # Successful post will redirect
4301.         self.assertEqual(response.status_code, 302)
4302. 
4303.         # The order values have been applied to the right objects
4304.         self.assertEqual(self.collector.category_set.count(), 4)
4305.         self.assertEqual(Category.objects.get(id=1).order, 14)
4306.         self.assertEqual(Category.objects.get(id=2).order, 13)
4307.         self.assertEqual(Category.objects.get(id=3).order, 1)
4308.         self.assertEqual(Category.objects.get(id=4).order, 0)
4309. 
4310. 
4311. @override_settings(ROOT_URLCONF='admin_views.urls')
4312. class NeverCacheTests(TestCase):
4313. 
4314.     @classmethod
4315.     def setUpTestData(cls):
4316.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
4317.         cls.s1 = Section.objects.create(name='Test section')
4318. 
4319.     def setUp(self):
4320.         self.client.force_login(self.superuser)
4321. 
4322.     def test_admin_index(self):
4323.         "Check the never-cache status of the main index"
4324.         response = self.client.get(reverse('admin:index'))
4325.         self.assertEqual(get_max_age(response), 0)
4326. 
4327.     def test_app_index(self):
4328.         "Check the never-cache status of an application index"
4329.         response = self.client.get(reverse('admin:app_list', args=('admin_views',)))
4330.         self.assertEqual(get_max_age(response), 0)
4331. 
4332.     def test_model_index(self):
4333.         "Check the never-cache status of a model index"
4334.         response = self.client.get(reverse('admin:admin_views_fabric_changelist'))
4335.         self.assertEqual(get_max_age(response), 0)
4336. 
4337.     def test_model_add(self):
4338.         "Check the never-cache status of a model add page"
4339.         response = self.client.get(reverse('admin:admin_views_fabric_add'))
4340.         self.assertEqual(get_max_age(response), 0)
4341. 
4342.     def test_model_view(self):
4343.         "Check the never-cache status of a model edit page"
4344.         response = self.client.get(reverse('admin:admin_views_section_change', args=(self.s1.pk,)))
4345.         self.assertEqual(get_max_age(response), 0)
4346. 
4347.     def test_model_history(self):
4348.         "Check the never-cache status of a model history page"
4349.         response = self.client.get(reverse('admin:admin_views_section_history', args=(self.s1.pk,)))
4350.         self.assertEqual(get_max_age(response), 0)
4351. 
4352.     def test_model_delete(self):
4353.         "Check the never-cache status of a model delete page"
4354.         response = self.client.get(reverse('admin:admin_views_section_delete', args=(self.s1.pk,)))
4355.         self.assertEqual(get_max_age(response), 0)
4356. 
4357.     def test_login(self):
4358.         "Check the never-cache status of login views"
4359.         self.client.logout()
4360.         response = self.client.get(reverse('admin:index'))
4361.         self.assertEqual(get_max_age(response), 0)
4362. 
4363.     def test_logout(self):
4364.         "Check the never-cache status of logout view"
4365.         response = self.client.get(reverse('admin:logout'))
4366.         self.assertEqual(get_max_age(response), 0)
4367. 
4368.     def test_password_change(self):
4369.         "Check the never-cache status of the password change view"
4370.         self.client.logout()
4371.         response = self.client.get(reverse('admin:password_change'))
4372.         self.assertIsNone(get_max_age(response))
4373. 
4374.     def test_password_change_done(self):
4375.         "Check the never-cache status of the password change done view"
4376.         response = self.client.get(reverse('admin:password_change_done'))
4377.         self.assertIsNone(get_max_age(response))
4378. 
4379.     def test_JS_i18n(self):
4380.         "Check the never-cache status of the JavaScript i18n view"
4381.         response = self.client.get(reverse('admin:jsi18n'))
4382.         self.assertIsNone(get_max_age(response))
4383. 
4384. 
4385. @override_settings(ROOT_URLCONF='admin_views.urls')
4386. class PrePopulatedTest(TestCase):
4387. 
4388.     @classmethod
4389.     def setUpTestData(cls):
4390.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
4391.         cls.p1 = PrePopulatedPost.objects.create(title='A Long Title', published=True, slug='a-long-title')
4392. 
4393.     def setUp(self):
4394.         self.client.force_login(self.superuser)
4395. 
4396.     def test_prepopulated_on(self):
4397.         response = self.client.get(reverse('admin:admin_views_prepopulatedpost_add'))
4398.         self.assertContains(response, "&quot;id&quot;: &quot;#id_slug&quot;")
4399.         self.assertContains(response, "&quot;dependency_ids&quot;: [&quot;#id_title&quot;]")
4400.         self.assertContains(response, "&quot;id&quot;: &quot;#id_prepopulatedsubpost_set-0-subslug&quot;")
4401. 
4402.     def test_prepopulated_off(self):
4403.         response = self.client.get(reverse('admin:admin_views_prepopulatedpost_change', args=(self.p1.pk,)))
4404.         self.assertContains(response, "A Long Title")
4405.         self.assertNotContains(response, "&quot;id&quot;: &quot;#id_slug&quot;")
4406.         self.assertNotContains(response, "&quot;dependency_ids&quot;: [&quot;#id_title&quot;]")
4407.         self.assertNotContains(
4408.             response,
4409.             "&quot;id&quot;: &quot;#id_prepopulatedsubpost_set-0-subslug&quot;"
4410.         )
4411. 
4412.     @override_settings(USE_THOUSAND_SEPARATOR=True, USE_L10N=True)
4413.     def test_prepopulated_maxlength_localized(self):
4414.         """
4415.         Regression test for #15938: if USE_THOUSAND_SEPARATOR is set, make sure
4416.         that maxLength (in the JavaScript) is rendered without separators.
4417.         """
4418.         response = self.client.get(reverse('admin:admin_views_prepopulatedpostlargeslug_add'))
4419.         self.assertContains(response, "&quot;maxLength&quot;: 1000")  # instead of 1,000
4420. 
4421.     def test_view_only_add_form(self):
4422.         """
4423.         PrePopulatedPostReadOnlyAdmin.prepopulated_fields includes 'slug'
4424.         which is present in the add view, even if the
4425.         ModelAdmin.has_change_permission() returns False.
4426.         """
4427.         response = self.client.get(reverse('admin7:admin_views_prepopulatedpost_add'))
4428.         self.assertContains(response, 'data-prepopulated-fields=')
4429.         self.assertContains(response, '&quot;id&quot;: &quot;#id_slug&quot;')
4430. 
4431.     def test_view_only_change_form(self):
4432.         """
4433.         PrePopulatedPostReadOnlyAdmin.prepopulated_fields includes 'slug'. That
4434.         doesn't break a view-only change view.
4435.         """
4436.         response = self.client.get(reverse('admin7:admin_views_prepopulatedpost_change', args=(self.p1.pk,)))
4437.         self.assertContains(response, 'data-prepopulated-fields="[]"')
4438.         self.assertContains(response, '<div class="readonly">%s</div>' % self.p1.slug)
4439. 
4440. 
4441. @override_settings(ROOT_URLCONF='admin_views.urls')
4442. class SeleniumTests(AdminSeleniumTestCase):
4443. 
4444.     available_apps = ['admin_views'] + AdminSeleniumTestCase.available_apps
4445. 
4446.     def setUp(self):
4447.         self.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
4448.         self.p1 = PrePopulatedPost.objects.create(title='A Long Title', published=True, slug='a-long-title')
4449. 
4450.     def test_prepopulated_fields(self):
4451.         """
4452.         The JavaScript-automated prepopulated fields work with the main form
4453.         and with stacked and tabular inlines.
4454.         Refs #13068, #9264, #9983, #9784.
4455.         """
4456.         self.admin_login(username='super', password='secret', login_url=reverse('admin:index'))
4457.         self.selenium.get(self.live_server_url + reverse('admin:admin_views_mainprepopulated_add'))
4458.         self.wait_for('.select2')
4459. 
4460.         # Main form ----------------------------------------------------------
4461.         self.selenium.find_element_by_id('id_pubdate').send_keys('2012-02-18')
4462.         self.get_select_option('#id_status', 'option two').click()
4463.         self.selenium.find_element_by_id('id_name').send_keys(' this is the mAin nÀMë and it\'s awεšomeııı')
4464.         slug1 = self.selenium.find_element_by_id('id_slug1').get_attribute('value')
4465.         slug2 = self.selenium.find_element_by_id('id_slug2').get_attribute('value')
4466.         slug3 = self.selenium.find_element_by_id('id_slug3').get_attribute('value')
4467.         self.assertEqual(slug1, 'main-name-and-its-awesomeiii-2012-02-18')
4468.         self.assertEqual(slug2, 'option-two-main-name-and-its-awesomeiii')
4469.         self.assertEqual(slug3, 'this-is-the-main-n\xe0m\xeb-and-its-aw\u03b5\u0161ome\u0131\u0131\u0131')
4470. 
4471.         # Stacked inlines ----------------------------------------------------
4472.         # Initial inline
4473.         self.selenium.find_element_by_id('id_relatedprepopulated_set-0-pubdate').send_keys('2011-12-17')
4474.         self.get_select_option('#id_relatedprepopulated_set-0-status', 'option one').click()
4475.         self.selenium.find_element_by_id('id_relatedprepopulated_set-0-name').send_keys(
4476.             ' here is a sŤāÇkeð   inline !  '
4477.         )
4478.         slug1 = self.selenium.find_element_by_id('id_relatedprepopulated_set-0-slug1').get_attribute('value')
4479.         slug2 = self.selenium.find_element_by_id('id_relatedprepopulated_set-0-slug2').get_attribute('value')
4480.         self.assertEqual(slug1, 'here-stacked-inline-2011-12-17')
4481.         self.assertEqual(slug2, 'option-one-here-stacked-inline')
4482.         initial_select2_inputs = self.selenium.find_elements_by_class_name('select2-selection')
4483.         # Inline formsets have empty/invisible forms.
4484.         # Only the 4 visible select2 inputs are initialized.
4485.         num_initial_select2_inputs = len(initial_select2_inputs)
4486.         self.assertEqual(num_initial_select2_inputs, 4)
4487. 
4488.         # Add an inline
4489.         self.selenium.find_elements_by_link_text('Add another Related prepopulated')[0].click()
4490.         self.assertEqual(
4491.             len(self.selenium.find_elements_by_class_name('select2-selection')),
4492.             num_initial_select2_inputs + 2
4493.         )
4494.         self.selenium.find_element_by_id('id_relatedprepopulated_set-1-pubdate').send_keys('1999-01-25')
4495.         self.get_select_option('#id_relatedprepopulated_set-1-status', 'option two').click()
4496.         self.selenium.find_element_by_id('id_relatedprepopulated_set-1-name').send_keys(
4497.             ' now you haVe anöther   sŤāÇkeð  inline with a very ... '
4498.             'loooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooog text... '
4499.         )
4500.         slug1 = self.selenium.find_element_by_id('id_relatedprepopulated_set-1-slug1').get_attribute('value')
4501.         slug2 = self.selenium.find_element_by_id('id_relatedprepopulated_set-1-slug2').get_attribute('value')

File: tests/admin_views/tests.py
Line number range: 4501 - 5001
Content:
4501.         slug2 = self.selenium.find_element_by_id('id_relatedprepopulated_set-1-slug2').get_attribute('value')
4502.         # 50 characters maximum for slug1 field
4503.         self.assertEqual(slug1, 'now-you-have-another-stacked-inline-very-loooooooo')
4504.         # 60 characters maximum for slug2 field
4505.         self.assertEqual(slug2, 'option-two-now-you-have-another-stacked-inline-very-looooooo')
4506. 
4507.         # Tabular inlines ----------------------------------------------------
4508.         # Initial inline
4509.         self.selenium.find_element_by_id('id_relatedprepopulated_set-2-0-pubdate').send_keys('1234-12-07')
4510.         self.get_select_option('#id_relatedprepopulated_set-2-0-status', 'option two').click()
4511.         self.selenium.find_element_by_id('id_relatedprepopulated_set-2-0-name').send_keys(
4512.             'And now, with a tÃbűlaŘ inline !!!'
4513.         )
4514.         slug1 = self.selenium.find_element_by_id('id_relatedprepopulated_set-2-0-slug1').get_attribute('value')
4515.         slug2 = self.selenium.find_element_by_id('id_relatedprepopulated_set-2-0-slug2').get_attribute('value')
4516.         self.assertEqual(slug1, 'and-now-tabular-inline-1234-12-07')
4517.         self.assertEqual(slug2, 'option-two-and-now-tabular-inline')
4518. 
4519.         # Add an inline
4520.         self.selenium.find_elements_by_link_text('Add another Related prepopulated')[1].click()
4521.         self.assertEqual(
4522.             len(self.selenium.find_elements_by_class_name('select2-selection')),
4523.             num_initial_select2_inputs + 4
4524.         )
4525.         self.selenium.find_element_by_id('id_relatedprepopulated_set-2-1-pubdate').send_keys('1981-08-22')
4526.         self.get_select_option('#id_relatedprepopulated_set-2-1-status', 'option one').click()
4527.         self.selenium.find_element_by_id('id_relatedprepopulated_set-2-1-name').send_keys(
4528.             r'a tÃbűlaŘ inline with ignored ;"&*^\%$#@-/`~ characters'
4529.         )
4530.         slug1 = self.selenium.find_element_by_id('id_relatedprepopulated_set-2-1-slug1').get_attribute('value')
4531.         slug2 = self.selenium.find_element_by_id('id_relatedprepopulated_set-2-1-slug2').get_attribute('value')
4532.         self.assertEqual(slug1, 'tabular-inline-ignored-characters-1981-08-22')
4533.         self.assertEqual(slug2, 'option-one-tabular-inline-ignored-characters')
4534.         # Add an inline without an initial inline.
4535.         # The button is outside of the browser frame.
4536.         self.selenium.execute_script("window.scrollTo(0, document.body.scrollHeight);")
4537.         self.selenium.find_elements_by_link_text('Add another Related prepopulated')[2].click()
4538.         self.assertEqual(
4539.             len(self.selenium.find_elements_by_class_name('select2-selection')),
4540.             num_initial_select2_inputs + 6
4541.         )
4542.         # Save and check that everything is properly stored in the database
4543.         self.selenium.find_element_by_xpath('//input[@value="Save"]').click()
4544.         self.wait_page_loaded()
4545.         self.assertEqual(MainPrepopulated.objects.all().count(), 1)
4546.         MainPrepopulated.objects.get(
4547.             name=' this is the mAin nÀMë and it\'s awεšomeııı',
4548.             pubdate='2012-02-18',
4549.             status='option two',
4550.             slug1='main-name-and-its-awesomeiii-2012-02-18',
4551.             slug2='option-two-main-name-and-its-awesomeiii',
4552.         )
4553.         self.assertEqual(RelatedPrepopulated.objects.all().count(), 4)
4554.         RelatedPrepopulated.objects.get(
4555.             name=' here is a sŤāÇkeð   inline !  ',
4556.             pubdate='2011-12-17',
4557.             status='option one',
4558.             slug1='here-stacked-inline-2011-12-17',
4559.             slug2='option-one-here-stacked-inline',
4560.         )
4561.         RelatedPrepopulated.objects.get(
4562.             # 75 characters in name field
4563.             name=' now you haVe anöther   sŤāÇkeð  inline with a very ... loooooooooooooooooo',
4564.             pubdate='1999-01-25',
4565.             status='option two',
4566.             slug1='now-you-have-another-stacked-inline-very-loooooooo',
4567.             slug2='option-two-now-you-have-another-stacked-inline-very-looooooo',
4568.         )
4569.         RelatedPrepopulated.objects.get(
4570.             name='And now, with a tÃbűlaŘ inline !!!',
4571.             pubdate='1234-12-07',
4572.             status='option two',
4573.             slug1='and-now-tabular-inline-1234-12-07',
4574.             slug2='option-two-and-now-tabular-inline',
4575.         )
4576.         RelatedPrepopulated.objects.get(
4577.             name=r'a tÃbűlaŘ inline with ignored ;"&*^\%$#@-/`~ characters',
4578.             pubdate='1981-08-22',
4579.             status='option one',
4580.             slug1='tabular-inline-ignored-characters-1981-08-22',
4581.             slug2='option-one-tabular-inline-ignored-characters',
4582.         )
4583. 
4584.     def test_populate_existing_object(self):
4585.         """
4586.         The prepopulation works for existing objects too, as long as
4587.         the original field is empty (#19082).
4588.         """
4589.         # Slugs are empty to start with.
4590.         item = MainPrepopulated.objects.create(
4591.             name=' this is the mAin nÀMë',
4592.             pubdate='2012-02-18',
4593.             status='option two',
4594.             slug1='',
4595.             slug2='',
4596.         )
4597.         self.admin_login(username='super', password='secret', login_url=reverse('admin:index'))
4598. 
4599.         object_url = self.live_server_url + reverse('admin:admin_views_mainprepopulated_change', args=(item.id,))
4600. 
4601.         self.selenium.get(object_url)
4602.         self.selenium.find_element_by_id('id_name').send_keys(' the best')
4603. 
4604.         # The slugs got prepopulated since they were originally empty
4605.         slug1 = self.selenium.find_element_by_id('id_slug1').get_attribute('value')
4606.         slug2 = self.selenium.find_element_by_id('id_slug2').get_attribute('value')
4607.         self.assertEqual(slug1, 'main-name-best-2012-02-18')
4608.         self.assertEqual(slug2, 'option-two-main-name-best')
4609. 
4610.         # Save the object
4611.         self.selenium.find_element_by_xpath('//input[@value="Save"]').click()
4612.         self.wait_page_loaded()
4613. 
4614.         self.selenium.get(object_url)
4615.         self.selenium.find_element_by_id('id_name').send_keys(' hello')
4616. 
4617.         # The slugs got prepopulated didn't change since they were originally not empty
4618.         slug1 = self.selenium.find_element_by_id('id_slug1').get_attribute('value')
4619.         slug2 = self.selenium.find_element_by_id('id_slug2').get_attribute('value')
4620.         self.assertEqual(slug1, 'main-name-best-2012-02-18')
4621.         self.assertEqual(slug2, 'option-two-main-name-best')
4622. 
4623.     def test_collapsible_fieldset(self):
4624.         """
4625.         The 'collapse' class in fieldsets definition allows to
4626.         show/hide the appropriate field section.
4627.         """
4628.         self.admin_login(username='super', password='secret', login_url=reverse('admin:index'))
4629.         self.selenium.get(self.live_server_url + reverse('admin:admin_views_article_add'))
4630.         self.assertFalse(self.selenium.find_element_by_id('id_title').is_displayed())
4631.         self.selenium.find_elements_by_link_text('Show')[0].click()
4632.         self.assertTrue(self.selenium.find_element_by_id('id_title').is_displayed())
4633.         self.assertEqual(self.selenium.find_element_by_id('fieldsetcollapser0').text, "Hide")
4634. 
4635.     def test_first_field_focus(self):
4636.         """JavaScript-assisted auto-focus on first usable form field."""
4637.         # First form field has a single widget
4638.         self.admin_login(username='super', password='secret', login_url=reverse('admin:index'))
4639.         self.selenium.get(self.live_server_url + reverse('admin:admin_views_picture_add'))
4640.         self.assertEqual(
4641.             self.selenium.switch_to.active_element,
4642.             self.selenium.find_element_by_id('id_name')
4643.         )
4644. 
4645.         # First form field has a MultiWidget
4646.         self.selenium.get(self.live_server_url + reverse('admin:admin_views_reservation_add'))
4647.         self.assertEqual(
4648.             self.selenium.switch_to.active_element,
4649.             self.selenium.find_element_by_id('id_start_date_0')
4650.         )
4651. 
4652.     def test_cancel_delete_confirmation(self):
4653.         "Cancelling the deletion of an object takes the user back one page."
4654.         pizza = Pizza.objects.create(name="Double Cheese")
4655.         url = reverse('admin:admin_views_pizza_change', args=(pizza.id,))
4656.         full_url = self.live_server_url + url
4657.         self.admin_login(username='super', password='secret', login_url=reverse('admin:index'))
4658.         self.selenium.get(full_url)
4659.         self.selenium.find_element_by_class_name('deletelink').click()
4660.         # Click 'cancel' on the delete page.
4661.         self.selenium.find_element_by_class_name('cancel-link').click()
4662.         # Wait until we're back on the change page.
4663.         self.wait_for_text('#content h1', 'Change pizza')
4664.         self.assertEqual(self.selenium.current_url, full_url)
4665.         self.assertEqual(Pizza.objects.count(), 1)
4666. 
4667.     def test_cancel_delete_related_confirmation(self):
4668.         """
4669.         Cancelling the deletion of an object with relations takes the user back
4670.         one page.
4671.         """
4672.         pizza = Pizza.objects.create(name="Double Cheese")
4673.         topping1 = Topping.objects.create(name="Cheddar")
4674.         topping2 = Topping.objects.create(name="Mozzarella")
4675.         pizza.toppings.add(topping1, topping2)
4676.         url = reverse('admin:admin_views_pizza_change', args=(pizza.id,))
4677.         full_url = self.live_server_url + url
4678.         self.admin_login(username='super', password='secret', login_url=reverse('admin:index'))
4679.         self.selenium.get(full_url)
4680.         self.selenium.find_element_by_class_name('deletelink').click()
4681.         # Click 'cancel' on the delete page.
4682.         self.selenium.find_element_by_class_name('cancel-link').click()
4683.         # Wait until we're back on the change page.
4684.         self.wait_for_text('#content h1', 'Change pizza')
4685.         self.assertEqual(self.selenium.current_url, full_url)
4686.         self.assertEqual(Pizza.objects.count(), 1)
4687.         self.assertEqual(Topping.objects.count(), 2)
4688. 
4689.     def test_list_editable_popups(self):
4690.         """
4691.         list_editable foreign keys have add/change popups.
4692.         """
4693.         from selenium.webdriver.support.ui import Select
4694.         s1 = Section.objects.create(name='Test section')
4695.         Article.objects.create(
4696.             title='foo',
4697.             content='<p>Middle content</p>',
4698.             date=datetime.datetime(2008, 3, 18, 11, 54, 58),
4699.             section=s1,
4700.         )
4701.         self.admin_login(username='super', password='secret', login_url=reverse('admin:index'))
4702.         self.selenium.get(self.live_server_url + reverse('admin:admin_views_article_changelist'))
4703.         # Change popup
4704.         self.selenium.find_element_by_id('change_id_form-0-section').click()
4705.         self.wait_for_popup()
4706.         self.selenium.switch_to.window(self.selenium.window_handles[-1])
4707.         self.wait_for_text('#content h1', 'Change section')
4708.         name_input = self.selenium.find_element_by_id('id_name')
4709.         name_input.clear()
4710.         name_input.send_keys('<i>edited section</i>')
4711.         self.selenium.find_element_by_xpath('//input[@value="Save"]').click()
4712.         self.selenium.switch_to.window(self.selenium.window_handles[0])
4713.         select = Select(self.selenium.find_element_by_id('id_form-0-section'))
4714.         self.assertEqual(select.first_selected_option.text, '<i>edited section</i>')
4715.         # Rendered select2 input.
4716.         select2_display = self.selenium.find_element_by_class_name('select2-selection__rendered')
4717.         # Clear button (×\n) is included in text.
4718.         self.assertEqual(select2_display.text, '×\n<i>edited section</i>')
4719. 
4720.         # Add popup
4721.         self.selenium.find_element_by_id('add_id_form-0-section').click()
4722.         self.wait_for_popup()
4723.         self.selenium.switch_to.window(self.selenium.window_handles[-1])
4724.         self.wait_for_text('#content h1', 'Add section')
4725.         self.selenium.find_element_by_id('id_name').send_keys('new section')
4726.         self.selenium.find_element_by_xpath('//input[@value="Save"]').click()
4727.         self.selenium.switch_to.window(self.selenium.window_handles[0])
4728.         select = Select(self.selenium.find_element_by_id('id_form-0-section'))
4729.         self.assertEqual(select.first_selected_option.text, 'new section')
4730.         select2_display = self.selenium.find_element_by_class_name('select2-selection__rendered')
4731.         # Clear button (×\n) is included in text.
4732.         self.assertEqual(select2_display.text, '×\nnew section')
4733. 
4734.     def test_inline_uuid_pk_edit_with_popup(self):
4735.         from selenium.webdriver.support.ui import Select
4736.         parent = ParentWithUUIDPK.objects.create(title='test')
4737.         related_with_parent = RelatedWithUUIDPKModel.objects.create(parent=parent)
4738.         self.admin_login(username='super', password='secret', login_url=reverse('admin:index'))
4739.         change_url = reverse('admin:admin_views_relatedwithuuidpkmodel_change', args=(related_with_parent.id,))
4740.         self.selenium.get(self.live_server_url + change_url)
4741.         self.selenium.find_element_by_id('change_id_parent').click()
4742.         self.wait_for_popup()
4743.         self.selenium.switch_to.window(self.selenium.window_handles[-1])
4744.         self.selenium.find_element_by_xpath('//input[@value="Save"]').click()
4745.         self.selenium.switch_to.window(self.selenium.window_handles[0])
4746.         select = Select(self.selenium.find_element_by_id('id_parent'))
4747.         self.assertEqual(select.first_selected_option.text, str(parent.id))
4748.         self.assertEqual(select.first_selected_option.get_attribute('value'), str(parent.id))
4749. 
4750.     def test_inline_uuid_pk_add_with_popup(self):
4751.         from selenium.webdriver.support.ui import Select
4752.         self.admin_login(username='super', password='secret', login_url=reverse('admin:index'))
4753.         self.selenium.get(self.live_server_url + reverse('admin:admin_views_relatedwithuuidpkmodel_add'))
4754.         self.selenium.find_element_by_id('add_id_parent').click()
4755.         self.wait_for_popup()
4756.         self.selenium.switch_to.window(self.selenium.window_handles[-1])
4757.         self.selenium.find_element_by_id('id_title').send_keys('test')
4758.         self.selenium.find_element_by_xpath('//input[@value="Save"]').click()
4759.         self.selenium.switch_to.window(self.selenium.window_handles[0])
4760.         select = Select(self.selenium.find_element_by_id('id_parent'))
4761.         uuid_id = str(ParentWithUUIDPK.objects.first().id)
4762.         self.assertEqual(select.first_selected_option.text, uuid_id)
4763.         self.assertEqual(select.first_selected_option.get_attribute('value'), uuid_id)
4764. 
4765.     def test_inline_uuid_pk_delete_with_popup(self):
4766.         from selenium.webdriver.support.ui import Select
4767.         parent = ParentWithUUIDPK.objects.create(title='test')
4768.         related_with_parent = RelatedWithUUIDPKModel.objects.create(parent=parent)
4769.         self.admin_login(username='super', password='secret', login_url=reverse('admin:index'))
4770.         change_url = reverse('admin:admin_views_relatedwithuuidpkmodel_change', args=(related_with_parent.id,))
4771.         self.selenium.get(self.live_server_url + change_url)
4772.         self.selenium.find_element_by_id('delete_id_parent').click()
4773.         self.wait_for_popup()
4774.         self.selenium.switch_to.window(self.selenium.window_handles[-1])
4775.         self.selenium.find_element_by_xpath('//input[@value="Yes, I\'m sure"]').click()
4776.         self.selenium.switch_to.window(self.selenium.window_handles[0])
4777.         select = Select(self.selenium.find_element_by_id('id_parent'))
4778.         self.assertEqual(ParentWithUUIDPK.objects.count(), 0)
4779.         self.assertEqual(select.first_selected_option.text, '---------')
4780.         self.assertEqual(select.first_selected_option.get_attribute('value'), '')
4781. 
4782.     def test_inline_with_popup_cancel_delete(self):
4783.         """Clicking ""No, take me back" on a delete popup closes the window."""
4784.         parent = ParentWithUUIDPK.objects.create(title='test')
4785.         related_with_parent = RelatedWithUUIDPKModel.objects.create(parent=parent)
4786.         self.admin_login(username='super', password='secret', login_url=reverse('admin:index'))
4787.         change_url = reverse('admin:admin_views_relatedwithuuidpkmodel_change', args=(related_with_parent.id,))
4788.         self.selenium.get(self.live_server_url + change_url)
4789.         self.selenium.find_element_by_id('delete_id_parent').click()
4790.         self.wait_for_popup()
4791.         self.selenium.switch_to.window(self.selenium.window_handles[-1])
4792.         self.selenium.find_element_by_xpath('//a[text()="No, take me back"]').click()
4793.         self.selenium.switch_to.window(self.selenium.window_handles[0])
4794.         self.assertEqual(len(self.selenium.window_handles), 1)
4795. 
4796.     def test_list_editable_raw_id_fields(self):
4797.         parent = ParentWithUUIDPK.objects.create(title='test')
4798.         parent2 = ParentWithUUIDPK.objects.create(title='test2')
4799.         RelatedWithUUIDPKModel.objects.create(parent=parent)
4800.         self.admin_login(username='super', password='secret', login_url=reverse('admin:index'))
4801.         change_url = reverse('admin:admin_views_relatedwithuuidpkmodel_changelist', current_app=site2.name)
4802.         self.selenium.get(self.live_server_url + change_url)
4803.         self.selenium.find_element_by_id('lookup_id_form-0-parent').click()
4804.         self.wait_for_popup()
4805.         self.selenium.switch_to.window(self.selenium.window_handles[-1])
4806.         # Select "parent2" in the popup.
4807.         self.selenium.find_element_by_link_text(str(parent2.pk)).click()
4808.         self.selenium.switch_to.window(self.selenium.window_handles[0])
4809.         # The newly selected pk should appear in the raw id input.
4810.         value = self.selenium.find_element_by_id('id_form-0-parent').get_attribute('value')
4811.         self.assertEqual(value, str(parent2.pk))
4812. 
4813. 
4814. @override_settings(ROOT_URLCONF='admin_views.urls')
4815. class ReadonlyTest(AdminFieldExtractionMixin, TestCase):
4816. 
4817.     @classmethod
4818.     def setUpTestData(cls):
4819.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
4820. 
4821.     def setUp(self):
4822.         self.client.force_login(self.superuser)
4823. 
4824.     def test_readonly_get(self):
4825.         response = self.client.get(reverse('admin:admin_views_post_add'))
4826.         self.assertEqual(response.status_code, 200)
4827.         self.assertNotContains(response, 'name="posted"')
4828.         # 3 fields + 2 submit buttons + 5 inline management form fields, + 2
4829.         # hidden fields for inlines + 1 field for the inline + 2 empty form
4830.         self.assertContains(response, "<input", count=15)
4831.         self.assertContains(response, formats.localize(datetime.date.today()))
4832.         self.assertContains(response, "<label>Awesomeness level:</label>")
4833.         self.assertContains(response, "Very awesome.")
4834.         self.assertContains(response, "Unknown coolness.")
4835.         self.assertContains(response, "foo")
4836. 
4837.         # Multiline text in a readonly field gets <br> tags
4838.         self.assertContains(response, 'Multiline<br>test<br>string')
4839.         self.assertContains(response, '<div class="readonly">Multiline<br>html<br>content</div>', html=True)
4840.         self.assertContains(response, 'InlineMultiline<br>test<br>string')
4841. 
4842.         self.assertContains(response, formats.localize(datetime.date.today() - datetime.timedelta(days=7)))
4843. 
4844.         self.assertContains(response, '<div class="form-row field-coolness">')
4845.         self.assertContains(response, '<div class="form-row field-awesomeness_level">')
4846.         self.assertContains(response, '<div class="form-row field-posted">')
4847.         self.assertContains(response, '<div class="form-row field-value">')
4848.         self.assertContains(response, '<div class="form-row">')
4849.         self.assertContains(response, '<div class="help">', 3)
4850.         self.assertContains(
4851.             response,
4852.             '<div class="help">Some help text for the title (with unicode ŠĐĆŽćžšđ)</div>',
4853.             html=True
4854.         )
4855.         self.assertContains(
4856.             response,
4857.             '<div class="help">Some help text for the content (with unicode ŠĐĆŽćžšđ)</div>',
4858.             html=True
4859.         )
4860.         self.assertContains(
4861.             response,
4862.             '<div class="help">Some help text for the date (with unicode ŠĐĆŽćžšđ)</div>',
4863.             html=True
4864.         )
4865. 
4866.         p = Post.objects.create(title="I worked on readonly_fields", content="Its good stuff")
4867.         response = self.client.get(reverse('admin:admin_views_post_change', args=(p.pk,)))
4868.         self.assertContains(response, "%d amount of cool" % p.pk)
4869. 
4870.     def test_readonly_text_field(self):
4871.         p = Post.objects.create(
4872.             title="Readonly test", content="test",
4873.             readonly_content='test\r\n\r\ntest\r\n\r\ntest\r\n\r\ntest',
4874.         )
4875.         Link.objects.create(
4876.             url="http://www.djangoproject.com", post=p,
4877.             readonly_link_content="test\r\nlink",
4878.         )
4879.         response = self.client.get(reverse('admin:admin_views_post_change', args=(p.pk,)))
4880.         # Checking readonly field.
4881.         self.assertContains(response, 'test<br><br>test<br><br>test<br><br>test')
4882.         # Checking readonly field in inline.
4883.         self.assertContains(response, 'test<br>link')
4884. 
4885.     def test_readonly_post(self):
4886.         data = {
4887.             "title": "Django Got Readonly Fields",
4888.             "content": "This is an incredible development.",
4889.             "link_set-TOTAL_FORMS": "1",
4890.             "link_set-INITIAL_FORMS": "0",
4891.             "link_set-MAX_NUM_FORMS": "0",
4892.         }
4893.         response = self.client.post(reverse('admin:admin_views_post_add'), data)
4894.         self.assertEqual(response.status_code, 302)
4895.         self.assertEqual(Post.objects.count(), 1)
4896.         p = Post.objects.get()
4897.         self.assertEqual(p.posted, datetime.date.today())
4898. 
4899.         data["posted"] = "10-8-1990"  # some date that's not today
4900.         response = self.client.post(reverse('admin:admin_views_post_add'), data)
4901.         self.assertEqual(response.status_code, 302)
4902.         self.assertEqual(Post.objects.count(), 2)
4903.         p = Post.objects.order_by('-id')[0]
4904.         self.assertEqual(p.posted, datetime.date.today())
4905. 
4906.     def test_readonly_manytomany(self):
4907.         "Regression test for #13004"
4908.         response = self.client.get(reverse('admin:admin_views_pizza_add'))
4909.         self.assertEqual(response.status_code, 200)
4910. 
4911.     def test_user_password_change_limited_queryset(self):
4912.         su = User.objects.filter(is_superuser=True)[0]
4913.         response = self.client.get(reverse('admin2:auth_user_password_change', args=(su.pk,)))
4914.         self.assertEqual(response.status_code, 404)
4915. 
4916.     def test_change_form_renders_correct_null_choice_value(self):
4917.         """
4918.         Regression test for #17911.
4919.         """
4920.         choice = Choice.objects.create(choice=None)
4921.         response = self.client.get(reverse('admin:admin_views_choice_change', args=(choice.pk,)))
4922.         self.assertContains(response, '<div class="readonly">No opinion</div>', html=True)
4923. 
4924.     def test_readonly_manytomany_backwards_ref(self):
4925.         """
4926.         Regression test for #16433 - backwards references for related objects
4927.         broke if the related field is read-only due to the help_text attribute
4928.         """
4929.         topping = Topping.objects.create(name='Salami')
4930.         pizza = Pizza.objects.create(name='Americano')
4931.         pizza.toppings.add(topping)
4932.         response = self.client.get(reverse('admin:admin_views_topping_add'))
4933.         self.assertEqual(response.status_code, 200)
4934. 
4935.     def test_readonly_manytomany_forwards_ref(self):
4936.         topping = Topping.objects.create(name='Salami')
4937.         pizza = Pizza.objects.create(name='Americano')
4938.         pizza.toppings.add(topping)
4939.         response = self.client.get(reverse('admin:admin_views_pizza_change', args=(pizza.pk,)))
4940.         self.assertContains(response, '<label>Toppings:</label>', html=True)
4941.         self.assertContains(response, '<div class="readonly">Salami</div>', html=True)
4942. 
4943.     def test_readonly_onetoone_backwards_ref(self):
4944.         """
4945.         Can reference a reverse OneToOneField in ModelAdmin.readonly_fields.
4946.         """
4947.         v1 = Villain.objects.create(name='Adam')
4948.         pl = Plot.objects.create(name='Test Plot', team_leader=v1, contact=v1)
4949.         pd = PlotDetails.objects.create(details='Brand New Plot', plot=pl)
4950. 
4951.         response = self.client.get(reverse('admin:admin_views_plotproxy_change', args=(pl.pk,)))
4952.         field = self.get_admin_readonly_field(response, 'plotdetails')
4953.         self.assertEqual(field.contents(), 'Brand New Plot')
4954. 
4955.         # The reverse relation also works if the OneToOneField is null.
4956.         pd.plot = None
4957.         pd.save()
4958. 
4959.         response = self.client.get(reverse('admin:admin_views_plotproxy_change', args=(pl.pk,)))
4960.         field = self.get_admin_readonly_field(response, 'plotdetails')
4961.         self.assertEqual(field.contents(), '-')  # default empty value
4962. 
4963.     def test_readonly_field_overrides(self):
4964.         """
4965.         Regression test for #22087 - ModelForm Meta overrides are ignored by
4966.         AdminReadonlyField
4967.         """
4968.         p = FieldOverridePost.objects.create(title="Test Post", content="Test Content")
4969.         response = self.client.get(reverse('admin:admin_views_fieldoverridepost_change', args=(p.pk,)))
4970.         self.assertContains(response, '<div class="help">Overridden help text for the date</div>')
4971.         self.assertContains(response, '<label for="id_public">Overridden public label:</label>', html=True)
4972.         self.assertNotContains(response, "Some help text for the date (with unicode ŠĐĆŽćžšđ)")
4973. 
4974.     def test_correct_autoescaping(self):
4975.         """
4976.         Make sure that non-field readonly elements are properly autoescaped (#24461)
4977.         """
4978.         section = Section.objects.create(name='<a>evil</a>')
4979.         response = self.client.get(reverse('admin:admin_views_section_change', args=(section.pk,)))
4980.         self.assertNotContains(response, "<a>evil</a>", status_code=200)
4981.         self.assertContains(response, "&lt;a&gt;evil&lt;/a&gt;", status_code=200)
4982. 
4983.     def test_label_suffix_translated(self):
4984.         pizza = Pizza.objects.create(name='Americano')
4985.         url = reverse('admin:admin_views_pizza_change', args=(pizza.pk,))
4986.         with self.settings(LANGUAGE_CODE='fr'):
4987.             response = self.client.get(url)
4988.         self.assertContains(response, '<label>Toppings\u00A0:</label>', html=True)
4989. 
4990. 
4991. @override_settings(ROOT_URLCONF='admin_views.urls')
4992. class LimitChoicesToInAdminTest(TestCase):
4993. 
4994.     @classmethod
4995.     def setUpTestData(cls):
4996.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
4997. 
4998.     def setUp(self):
4999.         self.client.force_login(self.superuser)
5000. 
5001.     def test_limit_choices_to_as_callable(self):

File: tests/admin_views/tests.py
Line number range: 5001 - 5501
Content:
5001.     def test_limit_choices_to_as_callable(self):
5002.         """Test for ticket 2445 changes to admin."""
5003.         threepwood = Character.objects.create(
5004.             username='threepwood',
5005.             last_action=datetime.datetime.today() + datetime.timedelta(days=1),
5006.         )
5007.         marley = Character.objects.create(
5008.             username='marley',
5009.             last_action=datetime.datetime.today() - datetime.timedelta(days=1),
5010.         )
5011.         response = self.client.get(reverse('admin:admin_views_stumpjoke_add'))
5012.         # The allowed option should appear twice; the limited option should not appear.
5013.         self.assertContains(response, threepwood.username, count=2)
5014.         self.assertNotContains(response, marley.username)
5015. 
5016. 
5017. @override_settings(ROOT_URLCONF='admin_views.urls')
5018. class RawIdFieldsTest(TestCase):
5019. 
5020.     @classmethod
5021.     def setUpTestData(cls):
5022.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
5023. 
5024.     def setUp(self):
5025.         self.client.force_login(self.superuser)
5026. 
5027.     def test_limit_choices_to(self):
5028.         """Regression test for 14880"""
5029.         actor = Actor.objects.create(name="Palin", age=27)
5030.         Inquisition.objects.create(expected=True,
5031.                                    leader=actor,
5032.                                    country="England")
5033.         Inquisition.objects.create(expected=False,
5034.                                    leader=actor,
5035.                                    country="Spain")
5036.         response = self.client.get(reverse('admin:admin_views_sketch_add'))
5037.         # Find the link
5038.         m = re.search(br'<a href="([^"]*)"[^>]* id="lookup_id_inquisition"', response.content)
5039.         self.assertTrue(m)  # Got a match
5040.         popup_url = m.groups()[0].decode().replace("&amp;", "&")
5041. 
5042.         # Handle relative links
5043.         popup_url = urljoin(response.request['PATH_INFO'], popup_url)
5044.         # Get the popup and verify the correct objects show up in the resulting
5045.         # page. This step also tests integers, strings and booleans in the
5046.         # lookup query string; in model we define inquisition field to have a
5047.         # limit_choices_to option that includes a filter on a string field
5048.         # (inquisition__actor__name), a filter on an integer field
5049.         # (inquisition__actor__age), and a filter on a boolean field
5050.         # (inquisition__expected).
5051.         response2 = self.client.get(popup_url)
5052.         self.assertContains(response2, "Spain")
5053.         self.assertNotContains(response2, "England")
5054. 
5055.     def test_limit_choices_to_isnull_false(self):
5056.         """Regression test for 20182"""
5057.         Actor.objects.create(name="Palin", age=27)
5058.         Actor.objects.create(name="Kilbraken", age=50, title="Judge")
5059.         response = self.client.get(reverse('admin:admin_views_sketch_add'))
5060.         # Find the link
5061.         m = re.search(br'<a href="([^"]*)"[^>]* id="lookup_id_defendant0"', response.content)
5062.         self.assertTrue(m)  # Got a match
5063.         popup_url = m.groups()[0].decode().replace("&amp;", "&")
5064. 
5065.         # Handle relative links
5066.         popup_url = urljoin(response.request['PATH_INFO'], popup_url)
5067.         # Get the popup and verify the correct objects show up in the resulting
5068.         # page. This step tests field__isnull=0 gets parsed correctly from the
5069.         # lookup query string; in model we define defendant0 field to have a
5070.         # limit_choices_to option that includes "actor__title__isnull=False".
5071.         response2 = self.client.get(popup_url)
5072.         self.assertContains(response2, "Kilbraken")
5073.         self.assertNotContains(response2, "Palin")
5074. 
5075.     def test_limit_choices_to_isnull_true(self):
5076.         """Regression test for 20182"""
5077.         Actor.objects.create(name="Palin", age=27)
5078.         Actor.objects.create(name="Kilbraken", age=50, title="Judge")
5079.         response = self.client.get(reverse('admin:admin_views_sketch_add'))
5080.         # Find the link
5081.         m = re.search(br'<a href="([^"]*)"[^>]* id="lookup_id_defendant1"', response.content)
5082.         self.assertTrue(m)  # Got a match
5083.         popup_url = m.groups()[0].decode().replace("&amp;", "&")
5084. 
5085.         # Handle relative links
5086.         popup_url = urljoin(response.request['PATH_INFO'], popup_url)
5087.         # Get the popup and verify the correct objects show up in the resulting
5088.         # page. This step tests field__isnull=1 gets parsed correctly from the
5089.         # lookup query string; in model we define defendant1 field to have a
5090.         # limit_choices_to option that includes "actor__title__isnull=True".
5091.         response2 = self.client.get(popup_url)
5092.         self.assertNotContains(response2, "Kilbraken")
5093.         self.assertContains(response2, "Palin")
5094. 
5095.     def test_list_display_method_same_name_as_reverse_accessor(self):
5096.         """
5097.         Should be able to use a ModelAdmin method in list_display that has the
5098.         same name as a reverse model field ("sketch" in this case).
5099.         """
5100.         actor = Actor.objects.create(name="Palin", age=27)
5101.         Inquisition.objects.create(expected=True, leader=actor, country="England")
5102.         response = self.client.get(reverse('admin:admin_views_inquisition_changelist'))
5103.         self.assertContains(response, 'list-display-sketch')
5104. 
5105. 
5106. @override_settings(ROOT_URLCONF='admin_views.urls')
5107. class UserAdminTest(TestCase):
5108.     """
5109.     Tests user CRUD functionality.
5110.     """
5111. 
5112.     @classmethod
5113.     def setUpTestData(cls):
5114.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
5115.         cls.adduser = User.objects.create_user(username='adduser', password='secret', is_staff=True)
5116.         cls.changeuser = User.objects.create_user(username='changeuser', password='secret', is_staff=True)
5117.         cls.s1 = Section.objects.create(name='Test section')
5118.         cls.a1 = Article.objects.create(
5119.             content='<p>Middle content</p>', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1
5120.         )
5121.         cls.a2 = Article.objects.create(
5122.             content='<p>Oldest content</p>', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1
5123.         )
5124.         cls.a3 = Article.objects.create(
5125.             content='<p>Newest content</p>', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1
5126.         )
5127.         cls.p1 = PrePopulatedPost.objects.create(title='A Long Title', published=True, slug='a-long-title')
5128. 
5129.         cls.per1 = Person.objects.create(name='John Mauchly', gender=1, alive=True)
5130.         cls.per2 = Person.objects.create(name='Grace Hopper', gender=1, alive=False)
5131.         cls.per3 = Person.objects.create(name='Guido van Rossum', gender=1, alive=True)
5132. 
5133.     def setUp(self):
5134.         self.client.force_login(self.superuser)
5135. 
5136.     def test_save_button(self):
5137.         user_count = User.objects.count()
5138.         response = self.client.post(reverse('admin:auth_user_add'), {
5139.             'username': 'newuser',
5140.             'password1': 'newpassword',
5141.             'password2': 'newpassword',
5142.         })
5143.         new_user = User.objects.get(username='newuser')
5144.         self.assertRedirects(response, reverse('admin:auth_user_change', args=(new_user.pk,)))
5145.         self.assertEqual(User.objects.count(), user_count + 1)
5146.         self.assertTrue(new_user.has_usable_password())
5147. 
5148.     def test_save_continue_editing_button(self):
5149.         user_count = User.objects.count()
5150.         response = self.client.post(reverse('admin:auth_user_add'), {
5151.             'username': 'newuser',
5152.             'password1': 'newpassword',
5153.             'password2': 'newpassword',
5154.             '_continue': '1',
5155.         })
5156.         new_user = User.objects.get(username='newuser')
5157.         new_user_url = reverse('admin:auth_user_change', args=(new_user.pk,))
5158.         self.assertRedirects(response, new_user_url, fetch_redirect_response=False)
5159.         self.assertEqual(User.objects.count(), user_count + 1)
5160.         self.assertTrue(new_user.has_usable_password())
5161.         response = self.client.get(new_user_url)
5162.         self.assertContains(
5163.             response,
5164.             '<li class="success">The user "<a href="%s">'
5165.             '%s</a>" was added successfully. You may edit it again below.</li>'
5166.             % (new_user_url, new_user),
5167.             html=True,
5168.         )
5169. 
5170.     def test_password_mismatch(self):
5171.         response = self.client.post(reverse('admin:auth_user_add'), {
5172.             'username': 'newuser',
5173.             'password1': 'newpassword',
5174.             'password2': 'mismatch',
5175.         })
5176.         self.assertEqual(response.status_code, 200)
5177.         self.assertFormError(response, 'adminform', 'password', [])
5178.         self.assertFormError(response, 'adminform', 'password2', ["The two password fields didn't match."])
5179. 
5180.     def test_user_fk_add_popup(self):
5181.         """User addition through a FK popup should return the appropriate JavaScript response."""
5182.         response = self.client.get(reverse('admin:admin_views_album_add'))
5183.         self.assertContains(response, reverse('admin:auth_user_add'))
5184.         self.assertContains(response, 'class="related-widget-wrapper-link add-related" id="add_id_owner"')
5185.         response = self.client.get(reverse('admin:auth_user_add') + '?_popup=1')
5186.         self.assertNotContains(response, 'name="_continue"')
5187.         self.assertNotContains(response, 'name="_addanother"')
5188.         data = {
5189.             'username': 'newuser',
5190.             'password1': 'newpassword',
5191.             'password2': 'newpassword',
5192.             '_popup': '1',
5193.             '_save': '1',
5194.         }
5195.         response = self.client.post(reverse('admin:auth_user_add') + '?_popup=1', data, follow=True)
5196.         self.assertContains(response, '&quot;obj&quot;: &quot;newuser&quot;')
5197. 
5198.     def test_user_fk_change_popup(self):
5199.         """User change through a FK popup should return the appropriate JavaScript response."""
5200.         response = self.client.get(reverse('admin:admin_views_album_add'))
5201.         self.assertContains(response, reverse('admin:auth_user_change', args=('__fk__',)))
5202.         self.assertContains(response, 'class="related-widget-wrapper-link change-related" id="change_id_owner"')
5203.         user = User.objects.get(username='changeuser')
5204.         url = reverse('admin:auth_user_change', args=(user.pk,)) + '?_popup=1'
5205.         response = self.client.get(url)
5206.         self.assertNotContains(response, 'name="_continue"')
5207.         self.assertNotContains(response, 'name="_addanother"')
5208.         data = {
5209.             'username': 'newuser',
5210.             'password1': 'newpassword',
5211.             'password2': 'newpassword',
5212.             'last_login_0': '2007-05-30',
5213.             'last_login_1': '13:20:10',
5214.             'date_joined_0': '2007-05-30',
5215.             'date_joined_1': '13:20:10',
5216.             '_popup': '1',
5217.             '_save': '1',
5218.         }
5219.         response = self.client.post(url, data, follow=True)
5220.         self.assertContains(response, '&quot;obj&quot;: &quot;newuser&quot;')
5221.         self.assertContains(response, '&quot;action&quot;: &quot;change&quot;')
5222. 
5223.     def test_user_fk_delete_popup(self):
5224.         """User deletion through a FK popup should return the appropriate JavaScript response."""
5225.         response = self.client.get(reverse('admin:admin_views_album_add'))
5226.         self.assertContains(response, reverse('admin:auth_user_delete', args=('__fk__',)))
5227.         self.assertContains(response, 'class="related-widget-wrapper-link change-related" id="change_id_owner"')
5228.         user = User.objects.get(username='changeuser')
5229.         url = reverse('admin:auth_user_delete', args=(user.pk,)) + '?_popup=1'
5230.         response = self.client.get(url)
5231.         self.assertEqual(response.status_code, 200)
5232.         data = {
5233.             'post': 'yes',
5234.             '_popup': '1',
5235.         }
5236.         response = self.client.post(url, data, follow=True)
5237.         self.assertContains(response, '&quot;action&quot;: &quot;delete&quot;')
5238. 
5239.     def test_save_add_another_button(self):
5240.         user_count = User.objects.count()
5241.         response = self.client.post(reverse('admin:auth_user_add'), {
5242.             'username': 'newuser',
5243.             'password1': 'newpassword',
5244.             'password2': 'newpassword',
5245.             '_addanother': '1',
5246.         })
5247.         new_user = User.objects.order_by('-id')[0]
5248.         self.assertRedirects(response, reverse('admin:auth_user_add'))
5249.         self.assertEqual(User.objects.count(), user_count + 1)
5250.         self.assertTrue(new_user.has_usable_password())
5251. 
5252.     def test_user_permission_performance(self):
5253.         u = User.objects.all()[0]
5254. 
5255.         # Don't depend on a warm cache, see #17377.
5256.         ContentType.objects.clear_cache()
5257. 
5258.         with self.assertNumQueries(10):
5259.             response = self.client.get(reverse('admin:auth_user_change', args=(u.pk,)))
5260.             self.assertEqual(response.status_code, 200)
5261. 
5262.     def test_form_url_present_in_context(self):
5263.         u = User.objects.all()[0]
5264.         response = self.client.get(reverse('admin3:auth_user_password_change', args=(u.pk,)))
5265.         self.assertEqual(response.status_code, 200)
5266.         self.assertEqual(response.context['form_url'], 'pony')
5267. 
5268. 
5269. @override_settings(ROOT_URLCONF='admin_views.urls')
5270. class GroupAdminTest(TestCase):
5271.     """
5272.     Tests group CRUD functionality.
5273.     """
5274. 
5275.     @classmethod
5276.     def setUpTestData(cls):
5277.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
5278. 
5279.     def setUp(self):
5280.         self.client.force_login(self.superuser)
5281. 
5282.     def test_save_button(self):
5283.         group_count = Group.objects.count()
5284.         response = self.client.post(reverse('admin:auth_group_add'), {
5285.             'name': 'newgroup',
5286.         })
5287. 
5288.         Group.objects.order_by('-id')[0]
5289.         self.assertRedirects(response, reverse('admin:auth_group_changelist'))
5290.         self.assertEqual(Group.objects.count(), group_count + 1)
5291. 
5292.     def test_group_permission_performance(self):
5293.         g = Group.objects.create(name="test_group")
5294. 
5295.         # Ensure no queries are skipped due to cached content type for Group.
5296.         ContentType.objects.clear_cache()
5297. 
5298.         with self.assertNumQueries(8):
5299.             response = self.client.get(reverse('admin:auth_group_change', args=(g.pk,)))
5300.             self.assertEqual(response.status_code, 200)
5301. 
5302. 
5303. @override_settings(ROOT_URLCONF='admin_views.urls')
5304. class CSSTest(TestCase):
5305. 
5306.     @classmethod
5307.     def setUpTestData(cls):
5308.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
5309.         cls.s1 = Section.objects.create(name='Test section')
5310.         cls.a1 = Article.objects.create(
5311.             content='<p>Middle content</p>', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1
5312.         )
5313.         cls.a2 = Article.objects.create(
5314.             content='<p>Oldest content</p>', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1
5315.         )
5316.         cls.a3 = Article.objects.create(
5317.             content='<p>Newest content</p>', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1
5318.         )
5319.         cls.p1 = PrePopulatedPost.objects.create(title='A Long Title', published=True, slug='a-long-title')
5320. 
5321.     def setUp(self):
5322.         self.client.force_login(self.superuser)
5323. 
5324.     def test_field_prefix_css_classes(self):
5325.         """
5326.         Fields have a CSS class name with a 'field-' prefix.
5327.         """
5328.         response = self.client.get(reverse('admin:admin_views_post_add'))
5329. 
5330.         # The main form
5331.         self.assertContains(response, 'class="form-row field-title"')
5332.         self.assertContains(response, 'class="form-row field-content"')
5333.         self.assertContains(response, 'class="form-row field-public"')
5334.         self.assertContains(response, 'class="form-row field-awesomeness_level"')
5335.         self.assertContains(response, 'class="form-row field-coolness"')
5336.         self.assertContains(response, 'class="form-row field-value"')
5337.         self.assertContains(response, 'class="form-row"')  # The lambda function
5338. 
5339.         # The tabular inline
5340.         self.assertContains(response, '<td class="field-url">')
5341.         self.assertContains(response, '<td class="field-posted">')
5342. 
5343.     def test_index_css_classes(self):
5344.         """
5345.         CSS class names are used for each app and model on the admin index
5346.         pages (#17050).
5347.         """
5348.         # General index page
5349.         response = self.client.get(reverse('admin:index'))
5350.         self.assertContains(response, '<div class="app-admin_views module">')
5351.         self.assertContains(response, '<tr class="model-actor">')
5352.         self.assertContains(response, '<tr class="model-album">')
5353. 
5354.         # App index page
5355.         response = self.client.get(reverse('admin:app_list', args=('admin_views',)))
5356.         self.assertContains(response, '<div class="app-admin_views module">')
5357.         self.assertContains(response, '<tr class="model-actor">')
5358.         self.assertContains(response, '<tr class="model-album">')
5359. 
5360.     def test_app_model_in_form_body_class(self):
5361.         """
5362.         Ensure app and model tag are correctly read by change_form template
5363.         """
5364.         response = self.client.get(reverse('admin:admin_views_section_add'))
5365.         self.assertContains(response, '<body class=" app-admin_views model-section ')
5366. 
5367.     def test_app_model_in_list_body_class(self):
5368.         """
5369.         Ensure app and model tag are correctly read by change_list template
5370.         """
5371.         response = self.client.get(reverse('admin:admin_views_section_changelist'))
5372.         self.assertContains(response, '<body class=" app-admin_views model-section ')
5373. 
5374.     def test_app_model_in_delete_confirmation_body_class(self):
5375.         """
5376.         Ensure app and model tag are correctly read by delete_confirmation
5377.         template
5378.         """
5379.         response = self.client.get(reverse('admin:admin_views_section_delete', args=(self.s1.pk,)))
5380.         self.assertContains(response, '<body class=" app-admin_views model-section ')
5381. 
5382.     def test_app_model_in_app_index_body_class(self):
5383.         """
5384.         Ensure app and model tag are correctly read by app_index template
5385.         """
5386.         response = self.client.get(reverse('admin:app_list', args=('admin_views',)))
5387.         self.assertContains(response, '<body class=" dashboard app-admin_views')
5388. 
5389.     def test_app_model_in_delete_selected_confirmation_body_class(self):
5390.         """
5391.         Ensure app and model tag are correctly read by
5392.         delete_selected_confirmation template
5393.         """
5394.         action_data = {
5395.             ACTION_CHECKBOX_NAME: [self.s1.pk],
5396.             'action': 'delete_selected',
5397.             'index': 0,
5398.         }
5399.         response = self.client.post(reverse('admin:admin_views_section_changelist'), action_data)
5400.         self.assertContains(response, '<body class=" app-admin_views model-section ')
5401. 
5402.     def test_changelist_field_classes(self):
5403.         """
5404.         Cells of the change list table should contain the field name in their class attribute
5405.         Refs #11195.
5406.         """
5407.         Podcast.objects.create(name="Django Dose", release_date=datetime.date.today())
5408.         response = self.client.get(reverse('admin:admin_views_podcast_changelist'))
5409.         self.assertContains(response, '<th class="field-name">')
5410.         self.assertContains(response, '<td class="field-release_date nowrap">')
5411.         self.assertContains(response, '<td class="action-checkbox">')
5412. 
5413. 
5414. try:
5415.     import docutils
5416. except ImportError:
5417.     docutils = None
5418. 
5419. 
5420. @unittest.skipUnless(docutils, "no docutils installed.")
5421. @override_settings(ROOT_URLCONF='admin_views.urls')
5422. @modify_settings(INSTALLED_APPS={'append': ['django.contrib.admindocs', 'django.contrib.flatpages']})
5423. class AdminDocsTest(TestCase):
5424. 
5425.     @classmethod
5426.     def setUpTestData(cls):
5427.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
5428. 
5429.     def setUp(self):
5430.         self.client.force_login(self.superuser)
5431. 
5432.     def test_tags(self):
5433.         response = self.client.get(reverse('django-admindocs-tags'))
5434. 
5435.         # The builtin tag group exists
5436.         self.assertContains(response, "<h2>Built-in tags</h2>", count=2, html=True)
5437. 
5438.         # A builtin tag exists in both the index and detail
5439.         self.assertContains(response, '<h3 id="built_in-autoescape">autoescape</h3>', html=True)
5440.         self.assertContains(response, '<li><a href="#built_in-autoescape">autoescape</a></li>', html=True)
5441. 
5442.         # An app tag exists in both the index and detail
5443.         self.assertContains(response, '<h3 id="flatpages-get_flatpages">get_flatpages</h3>', html=True)
5444.         self.assertContains(response, '<li><a href="#flatpages-get_flatpages">get_flatpages</a></li>', html=True)
5445. 
5446.         # The admin list tag group exists
5447.         self.assertContains(response, "<h2>admin_list</h2>", count=2, html=True)
5448. 
5449.         # An admin list tag exists in both the index and detail
5450.         self.assertContains(response, '<h3 id="admin_list-admin_actions">admin_actions</h3>', html=True)
5451.         self.assertContains(response, '<li><a href="#admin_list-admin_actions">admin_actions</a></li>', html=True)
5452. 
5453.     def test_filters(self):
5454.         response = self.client.get(reverse('django-admindocs-filters'))
5455. 
5456.         # The builtin filter group exists
5457.         self.assertContains(response, "<h2>Built-in filters</h2>", count=2, html=True)
5458. 
5459.         # A builtin filter exists in both the index and detail
5460.         self.assertContains(response, '<h3 id="built_in-add">add</h3>', html=True)
5461.         self.assertContains(response, '<li><a href="#built_in-add">add</a></li>', html=True)
5462. 
5463. 
5464. @override_settings(
5465.     ROOT_URLCONF='admin_views.urls',
5466.     TEMPLATES=[{
5467.         'BACKEND': 'django.template.backends.django.DjangoTemplates',
5468.         'APP_DIRS': True,
5469.         'OPTIONS': {
5470.             'context_processors': [
5471.                 'django.template.context_processors.debug',
5472.                 'django.template.context_processors.request',
5473.                 'django.contrib.auth.context_processors.auth',
5474.                 'django.contrib.messages.context_processors.messages',
5475.             ],
5476.         },
5477.     }],
5478.     USE_I18N=False,
5479. )
5480. class ValidXHTMLTests(TestCase):
5481. 
5482.     @classmethod
5483.     def setUpTestData(cls):
5484.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
5485. 
5486.     def setUp(self):
5487.         self.client.force_login(self.superuser)
5488. 
5489.     def test_lang_name_present(self):
5490.         response = self.client.get(reverse('admin:app_list', args=('admin_views',)))
5491.         self.assertNotContains(response, ' lang=""')
5492.         self.assertNotContains(response, ' xml:lang=""')
5493. 
5494. 
5495. @override_settings(ROOT_URLCONF='admin_views.urls', USE_THOUSAND_SEPARATOR=True, USE_L10N=True)
5496. class DateHierarchyTests(TestCase):
5497. 
5498.     @classmethod
5499.     def setUpTestData(cls):
5500.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')

File: tests/admin_views/tests.py
Line number range: 5501 - 5567
Content:
5501. 
5502.     def setUp(self):
5503.         self.client.force_login(self.superuser)
5504. 
5505.     def assert_non_localized_year(self, response, year):
5506.         """
5507.         The year is not localized with USE_THOUSAND_SEPARATOR (#15234).
5508.         """
5509.         self.assertNotContains(response, formats.number_format(year))
5510. 
5511.     def assert_contains_year_link(self, response, date):
5512.         self.assertContains(response, '?release_date__year=%d"' % (date.year,))
5513. 
5514.     def assert_contains_month_link(self, response, date):
5515.         self.assertContains(
5516.             response, '?release_date__month=%d&amp;release_date__year=%d"' % (
5517.                 date.month, date.year))
5518. 
5519.     def assert_contains_day_link(self, response, date):
5520.         self.assertContains(
5521.             response, '?release_date__day=%d&amp;'
5522.             'release_date__month=%d&amp;release_date__year=%d"' % (
5523.                 date.day, date.month, date.year))
5524. 
5525.     def test_empty(self):
5526.         """
5527.         No date hierarchy links display with empty changelist.
5528.         """
5529.         response = self.client.get(
5530.             reverse('admin:admin_views_podcast_changelist'))
5531.         self.assertNotContains(response, 'release_date__year=')
5532.         self.assertNotContains(response, 'release_date__month=')
5533.         self.assertNotContains(response, 'release_date__day=')
5534. 
5535.     def test_single(self):
5536.         """
5537.         Single day-level date hierarchy appears for single object.
5538.         """
5539.         DATE = datetime.date(2000, 6, 30)
5540.         Podcast.objects.create(release_date=DATE)
5541.         url = reverse('admin:admin_views_podcast_changelist')
5542.         response = self.client.get(url)
5543.         self.assert_contains_day_link(response, DATE)
5544.         self.assert_non_localized_year(response, 2000)
5545. 
5546.     def test_within_month(self):
5547.         """
5548.         day-level links appear for changelist within single month.
5549.         """
5550.         DATES = (datetime.date(2000, 6, 30),
5551.                  datetime.date(2000, 6, 15),
5552.                  datetime.date(2000, 6, 3))
5553.         for date in DATES:
5554.             Podcast.objects.create(release_date=date)
5555.         url = reverse('admin:admin_views_podcast_changelist')
5556.         response = self.client.get(url)
5557.         for date in DATES:
5558.             self.assert_contains_day_link(response, date)
5559.         self.assert_non_localized_year(response, 2000)
5560. 
5561.     def test_within_year(self):
5562.         """
5563.         month-level links appear for changelist within single year.
5564.         """
5565.         DATES = (datetime.date(2000, 1, 30),
5566.                  datetime.date(2000, 3, 15),
5567.                  datetime.date(2000, 5, 3))

File: tests/admin_views/tests.py
Line number range: 1405 - 2406
Content:
1405. class AdminViewPermissionsTest(TestCase):
1406.     """Tests for Admin Views Permissions."""
1407. 
1408.     @classmethod
1409.     def setUpTestData(cls):
1410.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
1411.         cls.viewuser = User.objects.create_user(username='viewuser', password='secret', is_staff=True)
1412.         cls.adduser = User.objects.create_user(username='adduser', password='secret', is_staff=True)
1413.         cls.changeuser = User.objects.create_user(username='changeuser', password='secret', is_staff=True)
1414.         cls.deleteuser = User.objects.create_user(username='deleteuser', password='secret', is_staff=True)
1415.         cls.joepublicuser = User.objects.create_user(username='joepublic', password='secret')
1416.         cls.nostaffuser = User.objects.create_user(username='nostaff', password='secret')
1417.         cls.s1 = Section.objects.create(name='Test section')
1418.         cls.a1 = Article.objects.create(
1419.             content='<p>Middle content</p>', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1,
1420.             another_section=cls.s1,
1421.         )
1422.         cls.a2 = Article.objects.create(
1423.             content='<p>Oldest content</p>', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1
1424.         )
1425.         cls.a3 = Article.objects.create(
1426.             content='<p>Newest content</p>', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1
1427.         )
1428.         cls.p1 = PrePopulatedPost.objects.create(title='A Long Title', published=True, slug='a-long-title')
1429. 
1430.         # Setup permissions, for our users who can add, change, and delete.
1431.         opts = Article._meta
1432. 
1433.         # User who can view Articles
1434.         cls.viewuser.user_permissions.add(get_perm(Article, get_permission_codename('view', opts)))
1435.         # User who can add Articles
1436.         cls.adduser.user_permissions.add(get_perm(Article, get_permission_codename('add', opts)))
1437.         # User who can change Articles
1438.         cls.changeuser.user_permissions.add(get_perm(Article, get_permission_codename('change', opts)))
1439.         cls.nostaffuser.user_permissions.add(get_perm(Article, get_permission_codename('change', opts)))
1440. 
1441.         # User who can delete Articles
1442.         cls.deleteuser.user_permissions.add(get_perm(Article, get_permission_codename('delete', opts)))
1443.         cls.deleteuser.user_permissions.add(get_perm(Section, get_permission_codename('delete', Section._meta)))
1444. 
1445.         # login POST dicts
1446.         cls.index_url = reverse('admin:index')
1447.         cls.super_login = {
1448.             REDIRECT_FIELD_NAME: cls.index_url,
1449.             'username': 'super',
1450.             'password': 'secret',
1451.         }
1452.         cls.super_email_login = {
1453.             REDIRECT_FIELD_NAME: cls.index_url,
1454.             'username': 'super@example.com',
1455.             'password': 'secret',
1456.         }
1457.         cls.super_email_bad_login = {
1458.             REDIRECT_FIELD_NAME: cls.index_url,
1459.             'username': 'super@example.com',
1460.             'password': 'notsecret',
1461.         }
1462.         cls.adduser_login = {
1463.             REDIRECT_FIELD_NAME: cls.index_url,
1464.             'username': 'adduser',
1465.             'password': 'secret',
1466.         }
1467.         cls.changeuser_login = {
1468.             REDIRECT_FIELD_NAME: cls.index_url,
1469.             'username': 'changeuser',
1470.             'password': 'secret',
1471.         }
1472.         cls.deleteuser_login = {
1473.             REDIRECT_FIELD_NAME: cls.index_url,
1474.             'username': 'deleteuser',
1475.             'password': 'secret',
1476.         }
1477.         cls.nostaff_login = {
1478.             REDIRECT_FIELD_NAME: reverse('has_permission_admin:index'),
1479.             'username': 'nostaff',
1480.             'password': 'secret',
1481.         }
1482.         cls.joepublic_login = {
1483.             REDIRECT_FIELD_NAME: cls.index_url,
1484.             'username': 'joepublic',
1485.             'password': 'secret',
1486.         }
1487.         cls.viewuser_login = {
1488.             REDIRECT_FIELD_NAME: cls.index_url,
1489.             'username': 'viewuser',
1490.             'password': 'secret',
1491.         }
1492.         cls.no_username_login = {
1493.             REDIRECT_FIELD_NAME: cls.index_url,
1494.             'password': 'secret',
1495.         }
1496. 
1497.     def test_login(self):
1498.         """
1499.         Make sure only staff members can log in.
1500. 
1501.         Successful posts to the login page will redirect to the original url.
1502.         Unsuccessful attempts will continue to render the login page with
1503.         a 200 status code.
1504.         """
1505.         login_url = '%s?next=%s' % (reverse('admin:login'), reverse('admin:index'))
1506.         # Super User
1507.         response = self.client.get(self.index_url)
1508.         self.assertRedirects(response, login_url)
1509.         login = self.client.post(login_url, self.super_login)
1510.         self.assertRedirects(login, self.index_url)
1511.         self.assertFalse(login.context)
1512.         self.client.get(reverse('admin:logout'))
1513. 
1514.         # Test if user enters email address
1515.         response = self.client.get(self.index_url)
1516.         self.assertEqual(response.status_code, 302)
1517.         login = self.client.post(login_url, self.super_email_login)
1518.         self.assertContains(login, ERROR_MESSAGE)
1519.         # only correct passwords get a username hint
1520.         login = self.client.post(login_url, self.super_email_bad_login)
1521.         self.assertContains(login, ERROR_MESSAGE)
1522.         new_user = User(username='jondoe', password='secret', email='super@example.com')
1523.         new_user.save()
1524.         # check to ensure if there are multiple email addresses a user doesn't get a 500
1525.         login = self.client.post(login_url, self.super_email_login)
1526.         self.assertContains(login, ERROR_MESSAGE)
1527. 
1528.         # View User
1529.         response = self.client.get(self.index_url)
1530.         self.assertEqual(response.status_code, 302)
1531.         login = self.client.post(login_url, self.viewuser_login)
1532.         self.assertRedirects(login, self.index_url)
1533.         self.assertFalse(login.context)
1534.         self.client.get(reverse('admin:logout'))
1535. 
1536.         # Add User
1537.         response = self.client.get(self.index_url)
1538.         self.assertEqual(response.status_code, 302)
1539.         login = self.client.post(login_url, self.adduser_login)
1540.         self.assertRedirects(login, self.index_url)
1541.         self.assertFalse(login.context)
1542.         self.client.get(reverse('admin:logout'))
1543. 
1544.         # Change User
1545.         response = self.client.get(self.index_url)
1546.         self.assertEqual(response.status_code, 302)
1547.         login = self.client.post(login_url, self.changeuser_login)
1548.         self.assertRedirects(login, self.index_url)
1549.         self.assertFalse(login.context)
1550.         self.client.get(reverse('admin:logout'))
1551. 
1552.         # Delete User
1553.         response = self.client.get(self.index_url)
1554.         self.assertEqual(response.status_code, 302)
1555.         login = self.client.post(login_url, self.deleteuser_login)
1556.         self.assertRedirects(login, self.index_url)
1557.         self.assertFalse(login.context)
1558.         self.client.get(reverse('admin:logout'))
1559. 
1560.         # Regular User should not be able to login.
1561.         response = self.client.get(self.index_url)
1562.         self.assertEqual(response.status_code, 302)
1563.         login = self.client.post(login_url, self.joepublic_login)
1564.         self.assertEqual(login.status_code, 200)
1565.         self.assertContains(login, ERROR_MESSAGE)
1566. 
1567.         # Requests without username should not return 500 errors.
1568.         response = self.client.get(self.index_url)
1569.         self.assertEqual(response.status_code, 302)
1570.         login = self.client.post(login_url, self.no_username_login)
1571.         self.assertEqual(login.status_code, 200)
1572.         self.assertFormError(login, 'form', 'username', ['This field is required.'])
1573. 
1574.     def test_login_redirect_for_direct_get(self):
1575.         """
1576.         Login redirect should be to the admin index page when going directly to
1577.         /admin/login/.
1578.         """
1579.         response = self.client.get(reverse('admin:login'))
1580.         self.assertEqual(response.status_code, 200)
1581.         self.assertEqual(response.context[REDIRECT_FIELD_NAME], reverse('admin:index'))
1582. 
1583.     def test_login_has_permission(self):
1584.         # Regular User should not be able to login.
1585.         response = self.client.get(reverse('has_permission_admin:index'))
1586.         self.assertEqual(response.status_code, 302)
1587.         login = self.client.post(reverse('has_permission_admin:login'), self.joepublic_login)
1588.         self.assertEqual(login.status_code, 200)
1589.         self.assertContains(login, 'permission denied')
1590. 
1591.         # User with permissions should be able to login.
1592.         response = self.client.get(reverse('has_permission_admin:index'))
1593.         self.assertEqual(response.status_code, 302)
1594.         login = self.client.post(reverse('has_permission_admin:login'), self.nostaff_login)
1595.         self.assertRedirects(login, reverse('has_permission_admin:index'))
1596.         self.assertFalse(login.context)
1597.         self.client.get(reverse('has_permission_admin:logout'))
1598. 
1599.         # Staff should be able to login.
1600.         response = self.client.get(reverse('has_permission_admin:index'))
1601.         self.assertEqual(response.status_code, 302)
1602.         login = self.client.post(reverse('has_permission_admin:login'), {
1603.             REDIRECT_FIELD_NAME: reverse('has_permission_admin:index'),
1604.             'username': 'deleteuser',
1605.             'password': 'secret',
1606.         })
1607.         self.assertRedirects(login, reverse('has_permission_admin:index'))
1608.         self.assertFalse(login.context)
1609.         self.client.get(reverse('has_permission_admin:logout'))
1610. 
1611.     def test_login_successfully_redirects_to_original_URL(self):
1612.         response = self.client.get(self.index_url)
1613.         self.assertEqual(response.status_code, 302)
1614.         query_string = 'the-answer=42'
1615.         redirect_url = '%s?%s' % (self.index_url, query_string)
1616.         new_next = {REDIRECT_FIELD_NAME: redirect_url}
1617.         post_data = self.super_login.copy()
1618.         post_data.pop(REDIRECT_FIELD_NAME)
1619.         login = self.client.post(
1620.             '%s?%s' % (reverse('admin:login'), urlencode(new_next)),
1621.             post_data)
1622.         self.assertRedirects(login, redirect_url)
1623. 
1624.     def test_double_login_is_not_allowed(self):
1625.         """Regression test for #19327"""
1626.         login_url = '%s?next=%s' % (reverse('admin:login'), reverse('admin:index'))
1627. 
1628.         response = self.client.get(self.index_url)
1629.         self.assertEqual(response.status_code, 302)
1630. 
1631.         # Establish a valid admin session
1632.         login = self.client.post(login_url, self.super_login)
1633.         self.assertRedirects(login, self.index_url)
1634.         self.assertFalse(login.context)
1635. 
1636.         # Logging in with non-admin user fails
1637.         login = self.client.post(login_url, self.joepublic_login)
1638.         self.assertEqual(login.status_code, 200)
1639.         self.assertContains(login, ERROR_MESSAGE)
1640. 
1641.         # Establish a valid admin session
1642.         login = self.client.post(login_url, self.super_login)
1643.         self.assertRedirects(login, self.index_url)
1644.         self.assertFalse(login.context)
1645. 
1646.         # Logging in with admin user while already logged in
1647.         login = self.client.post(login_url, self.super_login)
1648.         self.assertRedirects(login, self.index_url)
1649.         self.assertFalse(login.context)
1650.         self.client.get(reverse('admin:logout'))
1651. 
1652.     def test_login_page_notice_for_non_staff_users(self):
1653.         """
1654.         A logged-in non-staff user trying to access the admin index should be
1655.         presented with the login page and a hint indicating that the current
1656.         user doesn't have access to it.
1657.         """
1658.         hint_template = 'You are authenticated as {}'
1659. 
1660.         # Anonymous user should not be shown the hint
1661.         response = self.client.get(self.index_url, follow=True)
1662.         self.assertContains(response, 'login-form')
1663.         self.assertNotContains(response, hint_template.format(''), status_code=200)
1664. 
1665.         # Non-staff user should be shown the hint
1666.         self.client.force_login(self.nostaffuser)
1667.         response = self.client.get(self.index_url, follow=True)
1668.         self.assertContains(response, 'login-form')
1669.         self.assertContains(response, hint_template.format(self.nostaffuser.username), status_code=200)
1670. 
1671.     def test_add_view(self):
1672.         """Test add view restricts access and actually adds items."""
1673.         add_dict = {
1674.             'title': 'Døm ikke',
1675.             'content': '<p>great article</p>',
1676.             'date_0': '2008-03-18', 'date_1': '10:54:39',
1677.             'section': self.s1.pk,
1678.         }
1679.         # Change User should not have access to add articles
1680.         self.client.force_login(self.changeuser)
1681.         # make sure the view removes test cookie
1682.         self.assertIs(self.client.session.test_cookie_worked(), False)
1683.         response = self.client.get(reverse('admin:admin_views_article_add'))
1684.         self.assertEqual(response.status_code, 403)
1685.         # Try POST just to make sure
1686.         post = self.client.post(reverse('admin:admin_views_article_add'), add_dict)
1687.         self.assertEqual(post.status_code, 403)
1688.         self.assertEqual(Article.objects.count(), 3)
1689.         self.client.get(reverse('admin:logout'))
1690. 
1691.         # View User should not have access to add articles
1692.         self.client.force_login(self.viewuser)
1693.         response = self.client.get(reverse('admin:admin_views_article_add'))
1694.         self.assertEqual(response.status_code, 403)
1695.         # Try POST just to make sure
1696.         post = self.client.post(reverse('admin:admin_views_article_add'), add_dict)
1697.         self.assertEqual(post.status_code, 403)
1698.         self.assertEqual(Article.objects.count(), 3)
1699.         # Now give the user permission to add but not change.
1700.         self.viewuser.user_permissions.add(get_perm(Article, get_permission_codename('add', Article._meta)))
1701.         response = self.client.get(reverse('admin:admin_views_article_add'))
1702.         self.assertContains(response, '<input type="submit" value="Save and view" name="_continue">')
1703.         post = self.client.post(reverse('admin:admin_views_article_add'), add_dict, follow=False)
1704.         self.assertEqual(post.status_code, 302)
1705.         self.assertEqual(Article.objects.count(), 4)
1706.         article = Article.objects.latest('pk')
1707.         response = self.client.get(reverse('admin:admin_views_article_change', args=(article.pk,)))
1708.         self.assertContains(response, '<li class="success">The article "Døm ikke" was added successfully.</li>')
1709.         article.delete()
1710.         self.client.get(reverse('admin:logout'))
1711. 
1712.         # Add user may login and POST to add view, then redirect to admin root
1713.         self.client.force_login(self.adduser)
1714.         addpage = self.client.get(reverse('admin:admin_views_article_add'))
1715.         change_list_link = '&rsaquo; <a href="%s">Articles</a>' % reverse('admin:admin_views_article_changelist')
1716.         self.assertNotContains(
1717.             addpage, change_list_link,
1718.             msg_prefix='User restricted to add permission is given link to change list view in breadcrumbs.'
1719.         )
1720.         post = self.client.post(reverse('admin:admin_views_article_add'), add_dict)
1721.         self.assertRedirects(post, self.index_url)
1722.         self.assertEqual(Article.objects.count(), 4)
1723.         self.assertEqual(len(mail.outbox), 2)
1724.         self.assertEqual(mail.outbox[0].subject, 'Greetings from a created object')
1725.         self.client.get(reverse('admin:logout'))
1726. 
1727.         # The addition was logged correctly
1728.         addition_log = LogEntry.objects.all()[0]
1729.         new_article = Article.objects.last()
1730.         article_ct = ContentType.objects.get_for_model(Article)
1731.         self.assertEqual(addition_log.user_id, self.adduser.pk)
1732.         self.assertEqual(addition_log.content_type_id, article_ct.pk)
1733.         self.assertEqual(addition_log.object_id, str(new_article.pk))
1734.         self.assertEqual(addition_log.object_repr, "Døm ikke")
1735.         self.assertEqual(addition_log.action_flag, ADDITION)
1736.         self.assertEqual(addition_log.get_change_message(), "Added.")
1737. 
1738.         # Super can add too, but is redirected to the change list view
1739.         self.client.force_login(self.superuser)
1740.         addpage = self.client.get(reverse('admin:admin_views_article_add'))
1741.         self.assertContains(
1742.             addpage, change_list_link,
1743.             msg_prefix='Unrestricted user is not given link to change list view in breadcrumbs.'
1744.         )
1745.         post = self.client.post(reverse('admin:admin_views_article_add'), add_dict)
1746.         self.assertRedirects(post, reverse('admin:admin_views_article_changelist'))
1747.         self.assertEqual(Article.objects.count(), 5)
1748.         self.client.get(reverse('admin:logout'))
1749. 
1750.         # 8509 - if a normal user is already logged in, it is possible
1751.         # to change user into the superuser without error
1752.         self.client.force_login(self.joepublicuser)
1753.         # Check and make sure that if user expires, data still persists
1754.         self.client.force_login(self.superuser)
1755.         # make sure the view removes test cookie
1756.         self.assertIs(self.client.session.test_cookie_worked(), False)
1757. 
1758.     @mock.patch('django.contrib.admin.options.InlineModelAdmin.has_change_permission')
1759.     def test_add_view_with_view_only_inlines(self, has_change_permission):
1760.         """User with add permission to a section but view-only for inlines."""
1761.         self.viewuser.user_permissions.add(get_perm(Section, get_permission_codename('add', Section._meta)))
1762.         self.client.force_login(self.viewuser)
1763.         # Valid POST creates a new section.
1764.         data = {
1765.             'name': 'New obj',
1766.             'article_set-TOTAL_FORMS': 0,
1767.             'article_set-INITIAL_FORMS': 0,
1768.         }
1769.         response = self.client.post(reverse('admin:admin_views_section_add'), data)
1770.         self.assertRedirects(response, reverse('admin:index'))
1771.         self.assertEqual(Section.objects.latest('id').name, data['name'])
1772.         # InlineModelAdmin.has_change_permission()'s obj argument is always
1773.         # None during object add.
1774.         self.assertEqual([obj for (request, obj), _ in has_change_permission.call_args_list], [None, None])
1775. 
1776.     def test_change_view(self):
1777.         """Change view should restrict access and allow users to edit items."""
1778.         change_dict = {
1779.             'title': 'Ikke fordømt',
1780.             'content': '<p>edited article</p>',
1781.             'date_0': '2008-03-18', 'date_1': '10:54:39',
1782.             'section': self.s1.pk,
1783.         }
1784.         article_change_url = reverse('admin:admin_views_article_change', args=(self.a1.pk,))
1785.         article_changelist_url = reverse('admin:admin_views_article_changelist')
1786. 
1787.         # add user should not be able to view the list of article or change any of them
1788.         self.client.force_login(self.adduser)
1789.         response = self.client.get(article_changelist_url)
1790.         self.assertEqual(response.status_code, 403)
1791.         response = self.client.get(article_change_url)
1792.         self.assertEqual(response.status_code, 403)
1793.         post = self.client.post(article_change_url, change_dict)
1794.         self.assertEqual(post.status_code, 403)
1795.         self.client.get(reverse('admin:logout'))
1796. 
1797.         # view user should be able to view the article but not change any of them
1798.         # (the POST can be sent, but no modification occurs)
1799.         self.client.force_login(self.viewuser)
1800.         response = self.client.get(article_changelist_url)
1801.         self.assertEqual(response.status_code, 200)
1802.         self.assertEqual(response.context['title'], 'Select article to view')
1803.         response = self.client.get(article_change_url)
1804.         self.assertEqual(response.status_code, 200)
1805.         self.assertEqual(response.context['title'], 'View article')
1806.         self.assertContains(response, '<label>Extra form field:</label>')
1807.         self.assertContains(response, '<a href="/test_admin/admin/admin_views/article/" class="closelink">Close</a>')
1808.         post = self.client.post(article_change_url, change_dict)
1809.         self.assertEqual(post.status_code, 302)
1810.         self.assertEqual(Article.objects.get(pk=self.a1.pk).content, '<p>Middle content</p>')
1811.         self.client.get(reverse('admin:logout'))
1812. 
1813.         # change user can view all items and edit them
1814.         self.client.force_login(self.changeuser)
1815.         response = self.client.get(article_changelist_url)
1816.         self.assertEqual(response.status_code, 200)
1817.         self.assertEqual(response.context['title'], 'Select article to change')
1818.         response = self.client.get(article_change_url)
1819.         self.assertEqual(response.status_code, 200)
1820.         self.assertEqual(response.context['title'], 'Change article')
1821.         post = self.client.post(article_change_url, change_dict)
1822.         self.assertRedirects(post, article_changelist_url)
1823.         self.assertEqual(Article.objects.get(pk=self.a1.pk).content, '<p>edited article</p>')
1824. 
1825.         # one error in form should produce singular error message, multiple errors plural
1826.         change_dict['title'] = ''
1827.         post = self.client.post(article_change_url, change_dict)
1828.         self.assertContains(
1829.             post, 'Please correct the error below.',
1830.             msg_prefix='Singular error message not found in response to post with one error'
1831.         )
1832. 
1833.         change_dict['content'] = ''
1834.         post = self.client.post(article_change_url, change_dict)
1835.         self.assertContains(
1836.             post, 'Please correct the errors below.',
1837.             msg_prefix='Plural error message not found in response to post with multiple errors'
1838.         )
1839.         self.client.get(reverse('admin:logout'))
1840. 
1841.         # Test redirection when using row-level change permissions. Refs #11513.
1842.         r1 = RowLevelChangePermissionModel.objects.create(id=1, name="odd id")
1843.         r2 = RowLevelChangePermissionModel.objects.create(id=2, name="even id")
1844.         r3 = RowLevelChangePermissionModel.objects.create(id=3, name='odd id mult 3')
1845.         r6 = RowLevelChangePermissionModel.objects.create(id=6, name='even id mult 3')
1846.         change_url_1 = reverse('admin:admin_views_rowlevelchangepermissionmodel_change', args=(r1.pk,))
1847.         change_url_2 = reverse('admin:admin_views_rowlevelchangepermissionmodel_change', args=(r2.pk,))
1848.         change_url_3 = reverse('admin:admin_views_rowlevelchangepermissionmodel_change', args=(r3.pk,))
1849.         change_url_6 = reverse('admin:admin_views_rowlevelchangepermissionmodel_change', args=(r6.pk,))
1850.         logins = [self.superuser, self.viewuser, self.adduser, self.changeuser, self.deleteuser]
1851.         for login_user in logins:
1852.             with self.subTest(login_user.username):
1853.                 self.client.force_login(login_user)
1854.                 response = self.client.get(change_url_1)
1855.                 self.assertEqual(response.status_code, 403)
1856.                 response = self.client.post(change_url_1, {'name': 'changed'})
1857.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=1).name, 'odd id')
1858.                 self.assertEqual(response.status_code, 403)
1859.                 response = self.client.get(change_url_2)
1860.                 self.assertEqual(response.status_code, 200)
1861.                 response = self.client.post(change_url_2, {'name': 'changed'})
1862.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=2).name, 'changed')
1863.                 self.assertRedirects(response, self.index_url)
1864.                 response = self.client.get(change_url_3)
1865.                 self.assertEqual(response.status_code, 200)
1866.                 response = self.client.post(change_url_3, {'name': 'changed'})
1867.                 self.assertRedirects(response, self.index_url)
1868.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=3).name, 'odd id mult 3')
1869.                 response = self.client.get(change_url_6)
1870.                 self.assertEqual(response.status_code, 200)
1871.                 response = self.client.post(change_url_6, {'name': 'changed'})
1872.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=6).name, 'changed')
1873.                 self.assertRedirects(response, self.index_url)
1874. 
1875.                 self.client.get(reverse('admin:logout'))
1876. 
1877.         for login_user in [self.joepublicuser, self.nostaffuser]:
1878.             with self.subTest(login_user.username):
1879.                 self.client.force_login(login_user)
1880.                 response = self.client.get(change_url_1, follow=True)
1881.                 self.assertContains(response, 'login-form')
1882.                 response = self.client.post(change_url_1, {'name': 'changed'}, follow=True)
1883.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=1).name, 'odd id')
1884.                 self.assertContains(response, 'login-form')
1885.                 response = self.client.get(change_url_2, follow=True)
1886.                 self.assertContains(response, 'login-form')
1887.                 response = self.client.post(change_url_2, {'name': 'changed again'}, follow=True)
1888.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=2).name, 'changed')
1889.                 self.assertContains(response, 'login-form')
1890.                 self.client.get(reverse('admin:logout'))
1891. 
1892.     def test_change_view_without_object_change_permission(self):
1893.         """
1894.         The object should be read-only if the user has permission to view it
1895.         and change objects of that type but not to change the current object.
1896.         """
1897.         change_url = reverse('admin9:admin_views_article_change', args=(self.a1.pk,))
1898.         self.client.force_login(self.viewuser)
1899.         response = self.client.get(change_url)
1900.         self.assertEqual(response.status_code, 200)
1901.         self.assertEqual(response.context['title'], 'View article')
1902.         self.assertContains(response, '<a href="/test_admin/admin9/admin_views/article/" class="closelink">Close</a>')
1903. 
1904.     def test_change_view_post_without_object_change_permission(self):
1905.         """A POST redirects to changelist without modifications."""
1906.         change_dict = {
1907.             'title': 'Ikke fordømt',
1908.             'content': '<p>edited article</p>',
1909.             'date_0': '2008-03-18', 'date_1': '10:54:39',
1910.             'section': self.s1.pk,
1911.         }
1912.         change_url = reverse('admin10:admin_views_article_change', args=(self.a1.pk,))
1913.         changelist_url = reverse('admin10:admin_views_article_changelist')
1914.         self.client.force_login(self.viewuser)
1915.         response = self.client.post(change_url, change_dict)
1916.         self.assertRedirects(response, changelist_url)
1917.         self.assertEqual(Article.objects.get(pk=self.a1.pk).content, '<p>Middle content</p>')
1918. 
1919.     def test_change_view_save_as_new(self):
1920.         """
1921.         'Save as new' should raise PermissionDenied for users without the 'add'
1922.         permission.
1923.         """
1924.         change_dict_save_as_new = {
1925.             '_saveasnew': 'Save as new',
1926.             'title': 'Ikke fordømt',
1927.             'content': '<p>edited article</p>',
1928.             'date_0': '2008-03-18', 'date_1': '10:54:39',
1929.             'section': self.s1.pk,
1930.         }
1931.         article_change_url = reverse('admin:admin_views_article_change', args=(self.a1.pk,))
1932. 
1933.         # Add user can perform "Save as new".
1934.         article_count = Article.objects.count()
1935.         self.client.force_login(self.adduser)
1936.         post = self.client.post(article_change_url, change_dict_save_as_new)
1937.         self.assertRedirects(post, self.index_url)
1938.         self.assertEqual(Article.objects.count(), article_count + 1)
1939.         self.client.logout()
1940. 
1941.         # Change user cannot perform "Save as new" (no 'add' permission).
1942.         article_count = Article.objects.count()
1943.         self.client.force_login(self.changeuser)
1944.         post = self.client.post(article_change_url, change_dict_save_as_new)
1945.         self.assertEqual(post.status_code, 403)
1946.         self.assertEqual(Article.objects.count(), article_count)
1947. 
1948.         # User with both add and change permissions should be redirected to the
1949.         # change page for the newly created object.
1950.         article_count = Article.objects.count()
1951.         self.client.force_login(self.superuser)
1952.         post = self.client.post(article_change_url, change_dict_save_as_new)
1953.         self.assertEqual(Article.objects.count(), article_count + 1)
1954.         new_article = Article.objects.latest('id')
1955.         self.assertRedirects(post, reverse('admin:admin_views_article_change', args=(new_article.pk,)))
1956. 
1957.     def test_change_view_with_view_only_inlines(self):
1958.         """
1959.         User with change permission to a section but view-only for inlines.
1960.         """
1961.         self.viewuser.user_permissions.add(get_perm(Section, get_permission_codename('change', Section._meta)))
1962.         self.client.force_login(self.viewuser)
1963.         # GET shows inlines.
1964.         response = self.client.get(reverse('admin:admin_views_section_change', args=(self.s1.pk,)))
1965.         self.assertEqual(len(response.context['inline_admin_formsets']), 1)
1966.         formset = response.context['inline_admin_formsets'][0]
1967.         self.assertEqual(len(formset.forms), 3)
1968.         # Valid POST changes the name.
1969.         data = {
1970.             'name': 'Can edit name with view-only inlines',
1971.             'article_set-TOTAL_FORMS': 3,
1972.             'article_set-INITIAL_FORMS': 3
1973.         }
1974.         response = self.client.post(reverse('admin:admin_views_section_change', args=(self.s1.pk,)), data)
1975.         self.assertRedirects(response, reverse('admin:admin_views_section_changelist'))
1976.         self.assertEqual(Section.objects.get(pk=self.s1.pk).name, data['name'])
1977.         # Invalid POST reshows inlines.
1978.         del data['name']
1979.         response = self.client.post(reverse('admin:admin_views_section_change', args=(self.s1.pk,)), data)
1980.         self.assertEqual(response.status_code, 200)
1981.         self.assertEqual(len(response.context['inline_admin_formsets']), 1)
1982.         formset = response.context['inline_admin_formsets'][0]
1983.         self.assertEqual(len(formset.forms), 3)
1984. 
1985.     def test_change_view_with_view_and_add_inlines(self):
1986.         """User has view and add permissions on the inline model."""
1987.         self.viewuser.user_permissions.add(get_perm(Section, get_permission_codename('change', Section._meta)))
1988.         self.viewuser.user_permissions.add(get_perm(Article, get_permission_codename('add', Article._meta)))
1989.         self.client.force_login(self.viewuser)
1990.         # GET shows inlines.
1991.         response = self.client.get(reverse('admin:admin_views_section_change', args=(self.s1.pk,)))
1992.         self.assertEqual(len(response.context['inline_admin_formsets']), 1)
1993.         formset = response.context['inline_admin_formsets'][0]
1994.         self.assertEqual(len(formset.forms), 6)
1995.         # Valid POST creates a new article.
1996.         data = {
1997.             'name': 'Can edit name with view-only inlines',
1998.             'article_set-TOTAL_FORMS': 6,
1999.             'article_set-INITIAL_FORMS': 3,
2000.             'article_set-3-id': [''],
2001.             'article_set-3-title': ['A title'],
2002.             'article_set-3-content': ['Added content'],
2003.             'article_set-3-date_0': ['2008-3-18'],
2004.             'article_set-3-date_1': ['11:54:58'],
2005.             'article_set-3-section': [str(self.s1.pk)],
2006.         }
2007.         response = self.client.post(reverse('admin:admin_views_section_change', args=(self.s1.pk,)), data)
2008.         self.assertRedirects(response, reverse('admin:admin_views_section_changelist'))
2009.         self.assertEqual(Section.objects.get(pk=self.s1.pk).name, data['name'])
2010.         self.assertEqual(Article.objects.count(), 4)
2011.         # Invalid POST reshows inlines.
2012.         del data['name']
2013.         response = self.client.post(reverse('admin:admin_views_section_change', args=(self.s1.pk,)), data)
2014.         self.assertEqual(response.status_code, 200)
2015.         self.assertEqual(len(response.context['inline_admin_formsets']), 1)
2016.         formset = response.context['inline_admin_formsets'][0]
2017.         self.assertEqual(len(formset.forms), 6)
2018. 
2019.     def test_change_view_with_view_and_delete_inlines(self):
2020.         """User has view and delete permissions on the inline model."""
2021.         self.viewuser.user_permissions.add(get_perm(Section, get_permission_codename('change', Section._meta)))
2022.         self.client.force_login(self.viewuser)
2023.         data = {
2024.             'name': 'Name is required.',
2025.             'article_set-TOTAL_FORMS': 6,
2026.             'article_set-INITIAL_FORMS': 3,
2027.             'article_set-0-id': [str(self.a1.pk)],
2028.             'article_set-0-DELETE': ['on'],
2029.         }
2030.         # Inline POST details are ignored without delete permission.
2031.         response = self.client.post(reverse('admin:admin_views_section_change', args=(self.s1.pk,)), data)
2032.         self.assertRedirects(response, reverse('admin:admin_views_section_changelist'))
2033.         self.assertEqual(Article.objects.count(), 3)
2034.         # Deletion successful when delete permission is added.
2035.         self.viewuser.user_permissions.add(get_perm(Article, get_permission_codename('delete', Article._meta)))
2036.         data = {
2037.             'name': 'Name is required.',
2038.             'article_set-TOTAL_FORMS': 6,
2039.             'article_set-INITIAL_FORMS': 3,
2040.             'article_set-0-id': [str(self.a1.pk)],
2041.             'article_set-0-DELETE': ['on'],
2042.         }
2043.         response = self.client.post(reverse('admin:admin_views_section_change', args=(self.s1.pk,)), data)
2044.         self.assertRedirects(response, reverse('admin:admin_views_section_changelist'))
2045.         self.assertEqual(Article.objects.count(), 2)
2046. 
2047.     def test_delete_view(self):
2048.         """Delete view should restrict access and actually delete items."""
2049.         delete_dict = {'post': 'yes'}
2050.         delete_url = reverse('admin:admin_views_article_delete', args=(self.a1.pk,))
2051. 
2052.         # add user should not be able to delete articles
2053.         self.client.force_login(self.adduser)
2054.         response = self.client.get(delete_url)
2055.         self.assertEqual(response.status_code, 403)
2056.         post = self.client.post(delete_url, delete_dict)
2057.         self.assertEqual(post.status_code, 403)
2058.         self.assertEqual(Article.objects.count(), 3)
2059.         self.client.logout()
2060. 
2061.         # view user should not be able to delete articles
2062.         self.client.force_login(self.viewuser)
2063.         response = self.client.get(delete_url)
2064.         self.assertEqual(response.status_code, 403)
2065.         post = self.client.post(delete_url, delete_dict)
2066.         self.assertEqual(post.status_code, 403)
2067.         self.assertEqual(Article.objects.count(), 3)
2068.         self.client.logout()
2069. 
2070.         # Delete user can delete
2071.         self.client.force_login(self.deleteuser)
2072.         response = self.client.get(reverse('admin:admin_views_section_delete', args=(self.s1.pk,)))
2073.         self.assertContains(response, "<h2>Summary</h2>")
2074.         self.assertContains(response, "<li>Articles: 3</li>")
2075.         # test response contains link to related Article
2076.         self.assertContains(response, "admin_views/article/%s/" % self.a1.pk)
2077. 
2078.         response = self.client.get(delete_url)
2079.         self.assertContains(response, "admin_views/article/%s/" % self.a1.pk)
2080.         self.assertContains(response, "<h2>Summary</h2>")
2081.         self.assertContains(response, "<li>Articles: 1</li>")
2082.         self.assertEqual(response.status_code, 200)
2083.         post = self.client.post(delete_url, delete_dict)
2084.         self.assertRedirects(post, self.index_url)
2085.         self.assertEqual(Article.objects.count(), 2)
2086.         self.assertEqual(len(mail.outbox), 1)
2087.         self.assertEqual(mail.outbox[0].subject, 'Greetings from a deleted object')
2088.         article_ct = ContentType.objects.get_for_model(Article)
2089.         logged = LogEntry.objects.get(content_type=article_ct, action_flag=DELETION)
2090.         self.assertEqual(logged.object_id, str(self.a1.pk))
2091. 
2092.     def test_delete_view_with_no_default_permissions(self):
2093.         """
2094.         The delete view allows users to delete collected objects without a
2095.         'delete' permission (ReadOnlyPizza.Meta.default_permissions is empty).
2096.         """
2097.         pizza = ReadOnlyPizza.objects.create(name='Double Cheese')
2098.         delete_url = reverse('admin:admin_views_readonlypizza_delete', args=(pizza.pk,))
2099.         self.client.force_login(self.adduser)
2100.         response = self.client.get(delete_url)
2101.         self.assertContains(response, 'admin_views/readonlypizza/%s/' % pizza.pk)
2102.         self.assertContains(response, '<h2>Summary</h2>')
2103.         self.assertContains(response, '<li>Read only pizzas: 1</li>')
2104.         self.assertEqual(response.status_code, 200)
2105.         post = self.client.post(delete_url, {'post': 'yes'})
2106.         self.assertRedirects(post, reverse('admin:admin_views_readonlypizza_changelist'))
2107.         self.assertEqual(ReadOnlyPizza.objects.count(), 0)
2108. 
2109.     def test_delete_view_nonexistent_obj(self):
2110.         self.client.force_login(self.deleteuser)
2111.         url = reverse('admin:admin_views_article_delete', args=('nonexistent',))
2112.         response = self.client.get(url, follow=True)
2113.         self.assertRedirects(response, reverse('admin:index'))
2114.         self.assertEqual(
2115.             [m.message for m in response.context['messages']],
2116.             ["""article with ID "nonexistent" doesn't exist. Perhaps it was deleted?"""]
2117.         )
2118. 
2119.     def test_history_view(self):
2120.         """History view should restrict access."""
2121.         # add user should not be able to view the list of article or change any of them
2122.         self.client.force_login(self.adduser)
2123.         response = self.client.get(reverse('admin:admin_views_article_history', args=(self.a1.pk,)))
2124.         self.assertEqual(response.status_code, 403)
2125.         self.client.get(reverse('admin:logout'))
2126. 
2127.         # view user can view all items
2128.         self.client.force_login(self.viewuser)
2129.         response = self.client.get(reverse('admin:admin_views_article_history', args=(self.a1.pk,)))
2130.         self.assertEqual(response.status_code, 200)
2131.         self.client.get(reverse('admin:logout'))
2132. 
2133.         # change user can view all items and edit them
2134.         self.client.force_login(self.changeuser)
2135.         response = self.client.get(reverse('admin:admin_views_article_history', args=(self.a1.pk,)))
2136.         self.assertEqual(response.status_code, 200)
2137. 
2138.         # Test redirection when using row-level change permissions. Refs #11513.
2139.         rl1 = RowLevelChangePermissionModel.objects.create(name="odd id")
2140.         rl2 = RowLevelChangePermissionModel.objects.create(name="even id")
2141.         logins = [self.superuser, self.viewuser, self.adduser, self.changeuser, self.deleteuser]
2142.         for login_user in logins:
2143.             with self.subTest(login_user.username):
2144.                 self.client.force_login(login_user)
2145.                 url = reverse('admin:admin_views_rowlevelchangepermissionmodel_history', args=(rl1.pk,))
2146.                 response = self.client.get(url)
2147.                 self.assertEqual(response.status_code, 403)
2148. 
2149.                 url = reverse('admin:admin_views_rowlevelchangepermissionmodel_history', args=(rl2.pk,))
2150.                 response = self.client.get(url)
2151.                 self.assertEqual(response.status_code, 200)
2152. 
2153.                 self.client.get(reverse('admin:logout'))
2154. 
2155.         for login_user in [self.joepublicuser, self.nostaffuser]:
2156.             with self.subTest(login_user.username):
2157.                 self.client.force_login(login_user)
2158.                 url = reverse('admin:admin_views_rowlevelchangepermissionmodel_history', args=(rl1.pk,))
2159.                 response = self.client.get(url, follow=True)
2160.                 self.assertContains(response, 'login-form')
2161.                 url = reverse('admin:admin_views_rowlevelchangepermissionmodel_history', args=(rl2.pk,))
2162.                 response = self.client.get(url, follow=True)
2163.                 self.assertContains(response, 'login-form')
2164. 
2165.                 self.client.get(reverse('admin:logout'))
2166. 
2167.     def test_history_view_bad_url(self):
2168.         self.client.force_login(self.changeuser)
2169.         response = self.client.get(reverse('admin:admin_views_article_history', args=('foo',)), follow=True)
2170.         self.assertRedirects(response, reverse('admin:index'))
2171.         self.assertEqual(
2172.             [m.message for m in response.context['messages']],
2173.             ["""article with ID "foo" doesn't exist. Perhaps it was deleted?"""]
2174.         )
2175. 
2176.     def test_conditionally_show_add_section_link(self):
2177.         """
2178.         The foreign key widget should only show the "add related" button if the
2179.         user has permission to add that related item.
2180.         """
2181.         self.client.force_login(self.adduser)
2182.         # The user can't add sections yet, so they shouldn't see the "add section" link.
2183.         url = reverse('admin:admin_views_article_add')
2184.         add_link_text = 'add_id_section'
2185.         response = self.client.get(url)
2186.         self.assertNotContains(response, add_link_text)
2187.         # Allow the user to add sections too. Now they can see the "add section" link.
2188.         user = User.objects.get(username='adduser')
2189.         perm = get_perm(Section, get_permission_codename('add', Section._meta))
2190.         user.user_permissions.add(perm)
2191.         response = self.client.get(url)
2192.         self.assertContains(response, add_link_text)
2193. 
2194.     def test_conditionally_show_change_section_link(self):
2195.         """
2196.         The foreign key widget should only show the "change related" button if
2197.         the user has permission to change that related item.
2198.         """
2199.         def get_change_related(response):
2200.             return response.context['adminform'].form.fields['section'].widget.can_change_related
2201. 
2202.         self.client.force_login(self.adduser)
2203.         # The user can't change sections yet, so they shouldn't see the "change section" link.
2204.         url = reverse('admin:admin_views_article_add')
2205.         change_link_text = 'change_id_section'
2206.         response = self.client.get(url)
2207.         self.assertFalse(get_change_related(response))
2208.         self.assertNotContains(response, change_link_text)
2209.         # Allow the user to change sections too. Now they can see the "change section" link.
2210.         user = User.objects.get(username='adduser')
2211.         perm = get_perm(Section, get_permission_codename('change', Section._meta))
2212.         user.user_permissions.add(perm)
2213.         response = self.client.get(url)
2214.         self.assertTrue(get_change_related(response))
2215.         self.assertContains(response, change_link_text)
2216. 
2217.     def test_conditionally_show_delete_section_link(self):
2218.         """
2219.         The foreign key widget should only show the "delete related" button if
2220.         the user has permission to delete that related item.
2221.         """
2222.         def get_delete_related(response):
2223.             return response.context['adminform'].form.fields['sub_section'].widget.can_delete_related
2224. 
2225.         self.client.force_login(self.adduser)
2226.         # The user can't delete sections yet, so they shouldn't see the "delete section" link.
2227.         url = reverse('admin:admin_views_article_add')
2228.         delete_link_text = 'delete_id_sub_section'
2229.         response = self.client.get(url)
2230.         self.assertFalse(get_delete_related(response))
2231.         self.assertNotContains(response, delete_link_text)
2232.         # Allow the user to delete sections too. Now they can see the "delete section" link.
2233.         user = User.objects.get(username='adduser')
2234.         perm = get_perm(Section, get_permission_codename('delete', Section._meta))
2235.         user.user_permissions.add(perm)
2236.         response = self.client.get(url)
2237.         self.assertTrue(get_delete_related(response))
2238.         self.assertContains(response, delete_link_text)
2239. 
2240.     def test_disabled_permissions_when_logged_in(self):
2241.         self.client.force_login(self.superuser)
2242.         superuser = User.objects.get(username='super')
2243.         superuser.is_active = False
2244.         superuser.save()
2245. 
2246.         response = self.client.get(self.index_url, follow=True)
2247.         self.assertContains(response, 'id="login-form"')
2248.         self.assertNotContains(response, 'Log out')
2249. 
2250.         response = self.client.get(reverse('secure_view'), follow=True)
2251.         self.assertContains(response, 'id="login-form"')
2252. 
2253.     def test_disabled_staff_permissions_when_logged_in(self):
2254.         self.client.force_login(self.superuser)
2255.         superuser = User.objects.get(username='super')
2256.         superuser.is_staff = False
2257.         superuser.save()
2258. 
2259.         response = self.client.get(self.index_url, follow=True)
2260.         self.assertContains(response, 'id="login-form"')
2261.         self.assertNotContains(response, 'Log out')
2262. 
2263.         response = self.client.get(reverse('secure_view'), follow=True)
2264.         self.assertContains(response, 'id="login-form"')
2265. 
2266.     def test_app_list_permissions(self):
2267.         """
2268.         If a user has no module perms, the app list returns a 404.
2269.         """
2270.         opts = Article._meta
2271.         change_user = User.objects.get(username='changeuser')
2272.         permission = get_perm(Article, get_permission_codename('change', opts))
2273. 
2274.         self.client.force_login(self.changeuser)
2275. 
2276.         # the user has no module permissions
2277.         change_user.user_permissions.remove(permission)
2278.         response = self.client.get(reverse('admin:app_list', args=('admin_views',)))
2279.         self.assertEqual(response.status_code, 404)
2280. 
2281.         # the user now has module permissions
2282.         change_user.user_permissions.add(permission)
2283.         response = self.client.get(reverse('admin:app_list', args=('admin_views',)))
2284.         self.assertEqual(response.status_code, 200)
2285. 
2286.     def test_shortcut_view_only_available_to_staff(self):
2287.         """
2288.         Only admin users should be able to use the admin shortcut view.
2289.         """
2290.         model_ctype = ContentType.objects.get_for_model(ModelWithStringPrimaryKey)
2291.         obj = ModelWithStringPrimaryKey.objects.create(string_pk='foo')
2292.         shortcut_url = reverse('admin:view_on_site', args=(model_ctype.pk, obj.pk))
2293. 
2294.         # Not logged in: we should see the login page.
2295.         response = self.client.get(shortcut_url, follow=True)
2296.         self.assertTemplateUsed(response, 'admin/login.html')
2297. 
2298.         # Logged in? Redirect.
2299.         self.client.force_login(self.superuser)
2300.         response = self.client.get(shortcut_url, follow=False)
2301.         # Can't use self.assertRedirects() because User.get_absolute_url() is silly.
2302.         self.assertEqual(response.status_code, 302)
2303.         # Domain may depend on contrib.sites tests also run
2304.         self.assertRegex(response.url, 'http://(testserver|example.com)/dummy/foo/')
2305. 
2306.     def test_has_module_permission(self):
2307.         """
2308.         has_module_permission() returns True for all users who
2309.         have any permission for that module (add, change, or delete), so that
2310.         the module is displayed on the admin index page.
2311.         """
2312.         self.client.force_login(self.superuser)
2313.         response = self.client.get(self.index_url)
2314.         self.assertContains(response, 'admin_views')
2315.         self.assertContains(response, 'Articles')
2316.         self.client.logout()
2317. 
2318.         self.client.force_login(self.viewuser)
2319.         response = self.client.get(self.index_url)
2320.         self.assertContains(response, 'admin_views')
2321.         self.assertContains(response, 'Articles')
2322.         self.client.logout()
2323. 
2324.         self.client.force_login(self.adduser)
2325.         response = self.client.get(self.index_url)
2326.         self.assertContains(response, 'admin_views')
2327.         self.assertContains(response, 'Articles')
2328.         self.client.logout()
2329. 
2330.         self.client.force_login(self.changeuser)
2331.         response = self.client.get(self.index_url)
2332.         self.assertContains(response, 'admin_views')
2333.         self.assertContains(response, 'Articles')
2334.         self.client.logout()
2335. 
2336.         self.client.force_login(self.deleteuser)
2337.         response = self.client.get(self.index_url)
2338.         self.assertContains(response, 'admin_views')
2339.         self.assertContains(response, 'Articles')
2340. 
2341.     def test_overriding_has_module_permission(self):
2342.         """
2343.         If has_module_permission() always returns False, the module shouldn't
2344.         be displayed on the admin index page for any users.
2345.         """
2346.         articles = Article._meta.verbose_name_plural.title()
2347.         sections = Section._meta.verbose_name_plural.title()
2348.         index_url = reverse('admin7:index')
2349. 
2350.         self.client.force_login(self.superuser)
2351.         response = self.client.get(index_url)
2352.         self.assertContains(response, sections)
2353.         self.assertNotContains(response, articles)
2354.         self.client.logout()
2355. 
2356.         self.client.force_login(self.viewuser)
2357.         response = self.client.get(index_url)
2358.         self.assertNotContains(response, 'admin_views')
2359.         self.assertNotContains(response, articles)
2360.         self.client.logout()
2361. 
2362.         self.client.force_login(self.adduser)
2363.         response = self.client.get(index_url)
2364.         self.assertNotContains(response, 'admin_views')
2365.         self.assertNotContains(response, articles)
2366.         self.client.logout()
2367. 
2368.         self.client.force_login(self.changeuser)
2369.         response = self.client.get(index_url)
2370.         self.assertNotContains(response, 'admin_views')
2371.         self.assertNotContains(response, articles)
2372.         self.client.logout()
2373. 
2374.         self.client.force_login(self.deleteuser)
2375.         response = self.client.get(index_url)
2376.         self.assertNotContains(response, articles)
2377. 
2378.         # The app list displays Sections but not Articles as the latter has
2379.         # ModelAdmin.has_module_permission() = False.
2380.         self.client.force_login(self.superuser)
2381.         response = self.client.get(reverse('admin7:app_list', args=('admin_views',)))
2382.         self.assertContains(response, sections)
2383.         self.assertNotContains(response, articles)
2384. 
2385.     def test_post_save_message_no_forbidden_links_visible(self):
2386.         """
2387.         Post-save message shouldn't contain a link to the change form if the
2388.         user doesn't have the change permission.
2389.         """
2390.         self.client.force_login(self.adduser)
2391.         # Emulate Article creation for user with add-only permission.
2392.         post_data = {
2393.             "title": "Fun & games",
2394.             "content": "Some content",
2395.             "date_0": "2015-10-31",
2396.             "date_1": "16:35:00",
2397.             "_save": "Save",
2398.         }
2399.         response = self.client.post(reverse('admin:admin_views_article_add'), post_data, follow=True)
2400.         self.assertContains(
2401.             response,
2402.             '<li class="success">The article "Fun &amp; games" was added successfully.</li>',
2403.             html=True
2404.         )
2405.

File: tests/admin_views/tests.py
Line number range: 188 - 995
Content:
188. class AdminViewBasicTest(AdminViewBasicTestCase):
189.     def test_trailing_slash_required(self):
190.         """
191.         If you leave off the trailing slash, app should redirect and add it.
192.         """
193.         add_url = reverse('admin:admin_views_article_add')
194.         response = self.client.get(add_url[:-1])
195.         self.assertRedirects(response, add_url, status_code=301)
196. 
197.     def test_basic_add_GET(self):
198.         """
199.         A smoke test to ensure GET on the add_view works.
200.         """
201.         response = self.client.get(reverse('admin:admin_views_section_add'))
202.         self.assertIsInstance(response, TemplateResponse)
203.         self.assertEqual(response.status_code, 200)
204. 
205.     def test_add_with_GET_args(self):
206.         response = self.client.get(reverse('admin:admin_views_section_add'), {'name': 'My Section'})
207.         self.assertContains(
208.             response, 'value="My Section"',
209.             msg_prefix="Couldn't find an input with the right value in the response"
210.         )
211. 
212.     def test_basic_edit_GET(self):
213.         """
214.         A smoke test to ensure GET on the change_view works.
215.         """
216.         response = self.client.get(reverse('admin:admin_views_section_change', args=(self.s1.pk,)))
217.         self.assertIsInstance(response, TemplateResponse)
218.         self.assertEqual(response.status_code, 200)
219. 
220.     def test_basic_edit_GET_string_PK(self):
221.         """
222.         GET on the change_view (when passing a string as the PK argument for a
223.         model with an integer PK field) redirects to the index page with a
224.         message saying the object doesn't exist.
225.         """
226.         response = self.client.get(reverse('admin:admin_views_section_change', args=(quote("abc/<b>"),)), follow=True)
227.         self.assertRedirects(response, reverse('admin:index'))
228.         self.assertEqual(
229.             [m.message for m in response.context['messages']],
230.             ["""section with ID "abc/<b>" doesn't exist. Perhaps it was deleted?"""]
231.         )
232. 
233.     def test_basic_edit_GET_old_url_redirect(self):
234.         """
235.         The change URL changed in Django 1.9, but the old one still redirects.
236.         """
237.         response = self.client.get(
238.             reverse('admin:admin_views_section_change', args=(self.s1.pk,)).replace('change/', '')
239.         )
240.         self.assertRedirects(response, reverse('admin:admin_views_section_change', args=(self.s1.pk,)))
241. 
242.     def test_basic_inheritance_GET_string_PK(self):
243.         """
244.         GET on the change_view (for inherited models) redirects to the index
245.         page with a message saying the object doesn't exist.
246.         """
247.         response = self.client.get(reverse('admin:admin_views_supervillain_change', args=('abc',)), follow=True)
248.         self.assertRedirects(response, reverse('admin:index'))
249.         self.assertEqual(
250.             [m.message for m in response.context['messages']],
251.             ["""super villain with ID "abc" doesn't exist. Perhaps it was deleted?"""]
252.         )
253. 
254.     def test_basic_add_POST(self):
255.         """
256.         A smoke test to ensure POST on add_view works.
257.         """
258.         post_data = {
259.             "name": "Another Section",
260.             # inline data
261.             "article_set-TOTAL_FORMS": "3",
262.             "article_set-INITIAL_FORMS": "0",
263.             "article_set-MAX_NUM_FORMS": "0",
264.         }
265.         response = self.client.post(reverse('admin:admin_views_section_add'), post_data)
266.         self.assertEqual(response.status_code, 302)  # redirect somewhere
267. 
268.     def test_popup_add_POST(self):
269.         """
270.         Ensure http response from a popup is properly escaped.
271.         """
272.         post_data = {
273.             '_popup': '1',
274.             'title': 'title with a new\nline',
275.             'content': 'some content',
276.             'date_0': '2010-09-10',
277.             'date_1': '14:55:39',
278.         }
279.         response = self.client.post(reverse('admin:admin_views_article_add'), post_data)
280.         self.assertContains(response, 'title with a new\\nline')
281. 
282.     def test_basic_edit_POST(self):
283.         """
284.         A smoke test to ensure POST on edit_view works.
285.         """
286.         url = reverse('admin:admin_views_section_change', args=(self.s1.pk,))
287.         response = self.client.post(url, self.inline_post_data)
288.         self.assertEqual(response.status_code, 302)  # redirect somewhere
289. 
290.     def test_edit_save_as(self):
291.         """
292.         Test "save as".
293.         """
294.         post_data = self.inline_post_data.copy()
295.         post_data.update({
296.             '_saveasnew': 'Save+as+new',
297.             "article_set-1-section": "1",
298.             "article_set-2-section": "1",
299.             "article_set-3-section": "1",
300.             "article_set-4-section": "1",
301.             "article_set-5-section": "1",
302.         })
303.         response = self.client.post(reverse('admin:admin_views_section_change', args=(self.s1.pk,)), post_data)
304.         self.assertEqual(response.status_code, 302)  # redirect somewhere
305. 
306.     def test_edit_save_as_delete_inline(self):
307.         """
308.         Should be able to "Save as new" while also deleting an inline.
309.         """
310.         post_data = self.inline_post_data.copy()
311.         post_data.update({
312.             '_saveasnew': 'Save+as+new',
313.             "article_set-1-section": "1",
314.             "article_set-2-section": "1",
315.             "article_set-2-DELETE": "1",
316.             "article_set-3-section": "1",
317.         })
318.         response = self.client.post(reverse('admin:admin_views_section_change', args=(self.s1.pk,)), post_data)
319.         self.assertEqual(response.status_code, 302)
320.         # started with 3 articles, one was deleted.
321.         self.assertEqual(Section.objects.latest('id').article_set.count(), 2)
322. 
323.     def test_change_list_column_field_classes(self):
324.         response = self.client.get(reverse('admin:admin_views_article_changelist'))
325.         # callables display the callable name.
326.         self.assertContains(response, 'column-callable_year')
327.         self.assertContains(response, 'field-callable_year')
328.         # lambdas display as "lambda" + index that they appear in list_display.
329.         self.assertContains(response, 'column-lambda8')
330.         self.assertContains(response, 'field-lambda8')
331. 
332.     def test_change_list_sorting_callable(self):
333.         """
334.         Ensure we can sort on a list_display field that is a callable
335.         (column 2 is callable_year in ArticleAdmin)
336.         """
337.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': 2})
338.         self.assertContentBefore(
339.             response, 'Oldest content', 'Middle content',
340.             "Results of sorting on callable are out of order."
341.         )
342.         self.assertContentBefore(
343.             response, 'Middle content', 'Newest content',
344.             "Results of sorting on callable are out of order."
345.         )
346. 
347.     def test_change_list_sorting_property(self):
348.         """
349.         Sort on a list_display field that is a property (column 10 is
350.         a property in Article model).
351.         """
352.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': 10})
353.         self.assertContentBefore(
354.             response,
355.             'Oldest content',
356.             'Middle content',
357.             'Results of sorting on property are out of order.',
358.         )
359.         self.assertContentBefore(
360.             response,
361.             'Middle content',
362.             'Newest content',
363.             'Results of sorting on property are out of order.',
364.         )
365. 
366.     def test_change_list_sorting_callable_query_expression(self):
367.         """
368.         Query expressions may be used for admin_order_field. (column 9 is
369.         order_by_expression in ArticleAdmin).
370.         """
371.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': '9'})
372.         self.assertContentBefore(
373.             response, 'Oldest content', 'Middle content',
374.             'Results of sorting on callable are out of order.'
375.         )
376.         self.assertContentBefore(
377.             response, 'Middle content', 'Newest content',
378.             'Results of sorting on callable are out of order.'
379.         )
380. 
381.     def test_change_list_sorting_callable_query_expression_reverse(self):
382.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': '-9'})
383.         self.assertContentBefore(
384.             response, 'Middle content', 'Oldest content',
385.             'Results of sorting on callable are out of order.'
386.         )
387.         self.assertContentBefore(
388.             response, 'Newest content', 'Middle content',
389.             'Results of sorting on callable are out of order.'
390.         )
391. 
392.     def test_change_list_sorting_model(self):
393.         """
394.         Ensure we can sort on a list_display field that is a Model method
395.         (column 3 is 'model_year' in ArticleAdmin)
396.         """
397.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': '-3'})
398.         self.assertContentBefore(
399.             response, 'Newest content', 'Middle content',
400.             "Results of sorting on Model method are out of order."
401.         )
402.         self.assertContentBefore(
403.             response, 'Middle content', 'Oldest content',
404.             "Results of sorting on Model method are out of order."
405.         )
406. 
407.     def test_change_list_sorting_model_admin(self):
408.         """
409.         Ensure we can sort on a list_display field that is a ModelAdmin method
410.         (column 4 is 'modeladmin_year' in ArticleAdmin)
411.         """
412.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': '4'})
413.         self.assertContentBefore(
414.             response, 'Oldest content', 'Middle content',
415.             "Results of sorting on ModelAdmin method are out of order."
416.         )
417.         self.assertContentBefore(
418.             response, 'Middle content', 'Newest content',
419.             "Results of sorting on ModelAdmin method are out of order."
420.         )
421. 
422.     def test_change_list_sorting_model_admin_reverse(self):
423.         """
424.         Ensure we can sort on a list_display field that is a ModelAdmin
425.         method in reverse order (i.e. admin_order_field uses the '-' prefix)
426.         (column 6 is 'model_year_reverse' in ArticleAdmin)
427.         """
428.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': '6'})
429.         self.assertContentBefore(
430.             response, '2009', '2008',
431.             "Results of sorting on ModelAdmin method are out of order."
432.         )
433.         self.assertContentBefore(
434.             response, '2008', '2000',
435.             "Results of sorting on ModelAdmin method are out of order."
436.         )
437.         # Let's make sure the ordering is right and that we don't get a
438.         # FieldError when we change to descending order
439.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': '-6'})
440.         self.assertContentBefore(
441.             response, '2000', '2008',
442.             "Results of sorting on ModelAdmin method are out of order."
443.         )
444.         self.assertContentBefore(
445.             response, '2008', '2009',
446.             "Results of sorting on ModelAdmin method are out of order."
447.         )
448. 
449.     def test_change_list_sorting_multiple(self):
450.         p1 = Person.objects.create(name="Chris", gender=1, alive=True)
451.         p2 = Person.objects.create(name="Chris", gender=2, alive=True)
452.         p3 = Person.objects.create(name="Bob", gender=1, alive=True)
453.         link1 = reverse('admin:admin_views_person_change', args=(p1.pk,))
454.         link2 = reverse('admin:admin_views_person_change', args=(p2.pk,))
455.         link3 = reverse('admin:admin_views_person_change', args=(p3.pk,))
456. 
457.         # Sort by name, gender
458.         response = self.client.get(reverse('admin:admin_views_person_changelist'), {'o': '1.2'})
459.         self.assertContentBefore(response, link3, link1)
460.         self.assertContentBefore(response, link1, link2)
461. 
462.         # Sort by gender descending, name
463.         response = self.client.get(reverse('admin:admin_views_person_changelist'), {'o': '-2.1'})
464.         self.assertContentBefore(response, link2, link3)
465.         self.assertContentBefore(response, link3, link1)
466. 
467.     def test_change_list_sorting_preserve_queryset_ordering(self):
468.         """
469.         If no ordering is defined in `ModelAdmin.ordering` or in the query
470.         string, then the underlying order of the queryset should not be
471.         changed, even if it is defined in `Modeladmin.get_queryset()`.
472.         Refs #11868, #7309.
473.         """
474.         p1 = Person.objects.create(name="Amy", gender=1, alive=True, age=80)
475.         p2 = Person.objects.create(name="Bob", gender=1, alive=True, age=70)
476.         p3 = Person.objects.create(name="Chris", gender=2, alive=False, age=60)
477.         link1 = reverse('admin:admin_views_person_change', args=(p1.pk,))
478.         link2 = reverse('admin:admin_views_person_change', args=(p2.pk,))
479.         link3 = reverse('admin:admin_views_person_change', args=(p3.pk,))
480. 
481.         response = self.client.get(reverse('admin:admin_views_person_changelist'), {})
482.         self.assertContentBefore(response, link3, link2)
483.         self.assertContentBefore(response, link2, link1)
484. 
485.     def test_change_list_sorting_model_meta(self):
486.         # Test ordering on Model Meta is respected
487. 
488.         l1 = Language.objects.create(iso='ur', name='Urdu')
489.         l2 = Language.objects.create(iso='ar', name='Arabic')
490.         link1 = reverse('admin:admin_views_language_change', args=(quote(l1.pk),))
491.         link2 = reverse('admin:admin_views_language_change', args=(quote(l2.pk),))
492. 
493.         response = self.client.get(reverse('admin:admin_views_language_changelist'), {})
494.         self.assertContentBefore(response, link2, link1)
495. 
496.         # Test we can override with query string
497.         response = self.client.get(reverse('admin:admin_views_language_changelist'), {'o': '-1'})
498.         self.assertContentBefore(response, link1, link2)
499. 
500.     def test_change_list_sorting_override_model_admin(self):
501.         # Test ordering on Model Admin is respected, and overrides Model Meta
502.         dt = datetime.datetime.now()
503.         p1 = Podcast.objects.create(name="A", release_date=dt)
504.         p2 = Podcast.objects.create(name="B", release_date=dt - datetime.timedelta(10))
505.         link1 = reverse('admin:admin_views_podcast_change', args=(p1.pk,))
506.         link2 = reverse('admin:admin_views_podcast_change', args=(p2.pk,))
507. 
508.         response = self.client.get(reverse('admin:admin_views_podcast_changelist'), {})
509.         self.assertContentBefore(response, link1, link2)
510. 
511.     def test_multiple_sort_same_field(self):
512.         # The changelist displays the correct columns if two columns correspond
513.         # to the same ordering field.
514.         dt = datetime.datetime.now()
515.         p1 = Podcast.objects.create(name="A", release_date=dt)
516.         p2 = Podcast.objects.create(name="B", release_date=dt - datetime.timedelta(10))
517.         link1 = reverse('admin:admin_views_podcast_change', args=(quote(p1.pk),))
518.         link2 = reverse('admin:admin_views_podcast_change', args=(quote(p2.pk),))
519. 
520.         response = self.client.get(reverse('admin:admin_views_podcast_changelist'), {})
521.         self.assertContentBefore(response, link1, link2)
522. 
523.         p1 = ComplexSortedPerson.objects.create(name="Bob", age=10)
524.         p2 = ComplexSortedPerson.objects.create(name="Amy", age=20)
525.         link1 = reverse('admin:admin_views_complexsortedperson_change', args=(p1.pk,))
526.         link2 = reverse('admin:admin_views_complexsortedperson_change', args=(p2.pk,))
527. 
528.         response = self.client.get(reverse('admin:admin_views_complexsortedperson_changelist'), {})
529.         # Should have 5 columns (including action checkbox col)
530.         self.assertContains(response, '<th scope="col"', count=5)
531. 
532.         self.assertContains(response, 'Name')
533.         self.assertContains(response, 'Colored name')
534. 
535.         # Check order
536.         self.assertContentBefore(response, 'Name', 'Colored name')
537. 
538.         # Check sorting - should be by name
539.         self.assertContentBefore(response, link2, link1)
540. 
541.     def test_sort_indicators_admin_order(self):
542.         """
543.         The admin shows default sort indicators for all kinds of 'ordering'
544.         fields: field names, method on the model admin and model itself, and
545.         other callables. See #17252.
546.         """
547.         models = [(AdminOrderedField, 'adminorderedfield'),
548.                   (AdminOrderedModelMethod, 'adminorderedmodelmethod'),
549.                   (AdminOrderedAdminMethod, 'adminorderedadminmethod'),
550.                   (AdminOrderedCallable, 'adminorderedcallable')]
551.         for model, url in models:
552.             model.objects.create(stuff='The Last Item', order=3)
553.             model.objects.create(stuff='The First Item', order=1)
554.             model.objects.create(stuff='The Middle Item', order=2)
555.             response = self.client.get(reverse('admin:admin_views_%s_changelist' % url), {})
556.             self.assertEqual(response.status_code, 200)
557.             # Should have 3 columns including action checkbox col.
558.             self.assertContains(response, '<th scope="col"', count=3, msg_prefix=url)
559.             # Check if the correct column was selected. 2 is the index of the
560.             # 'order' column in the model admin's 'list_display' with 0 being
561.             # the implicit 'action_checkbox' and 1 being the column 'stuff'.
562.             self.assertEqual(response.context['cl'].get_ordering_field_columns(), {2: 'asc'})
563.             # Check order of records.
564.             self.assertContentBefore(response, 'The First Item', 'The Middle Item')
565.             self.assertContentBefore(response, 'The Middle Item', 'The Last Item')
566. 
567.     def test_has_related_field_in_list_display_fk(self):
568.         """Joins shouldn't be performed for <FK>_id fields in list display."""
569.         state = State.objects.create(name='Karnataka')
570.         City.objects.create(state=state, name='Bangalore')
571.         response = self.client.get(reverse('admin:admin_views_city_changelist'), {})
572. 
573.         response.context['cl'].list_display = ['id', 'name', 'state']
574.         self.assertIs(response.context['cl'].has_related_field_in_list_display(), True)
575. 
576.         response.context['cl'].list_display = ['id', 'name', 'state_id']
577.         self.assertIs(response.context['cl'].has_related_field_in_list_display(), False)
578. 
579.     def test_has_related_field_in_list_display_o2o(self):
580.         """Joins shouldn't be performed for <O2O>_id fields in list display."""
581.         media = Media.objects.create(name='Foo')
582.         Vodcast.objects.create(media=media)
583.         response = self.client.get(reverse('admin:admin_views_vodcast_changelist'), {})
584. 
585.         response.context['cl'].list_display = ['media']
586.         self.assertIs(response.context['cl'].has_related_field_in_list_display(), True)
587. 
588.         response.context['cl'].list_display = ['media_id']
589.         self.assertIs(response.context['cl'].has_related_field_in_list_display(), False)
590. 
591.     def test_limited_filter(self):
592.         """Ensure admin changelist filters do not contain objects excluded via limit_choices_to.
593.         This also tests relation-spanning filters (e.g. 'color__value').
594.         """
595.         response = self.client.get(reverse('admin:admin_views_thing_changelist'))
596.         self.assertContains(
597.             response, '<div id="changelist-filter">',
598.             msg_prefix="Expected filter not found in changelist view"
599.         )
600.         self.assertNotContains(
601.             response, '<a href="?color__id__exact=3">Blue</a>',
602.             msg_prefix="Changelist filter not correctly limited by limit_choices_to"
603.         )
604. 
605.     def test_relation_spanning_filters(self):
606.         changelist_url = reverse('admin:admin_views_chapterxtra1_changelist')
607.         response = self.client.get(changelist_url)
608.         self.assertContains(response, '<div id="changelist-filter">')
609.         filters = {
610.             'chap__id__exact': {
611.                 'values': [c.id for c in Chapter.objects.all()],
612.                 'test': lambda obj, value: obj.chap.id == value,
613.             },
614.             'chap__title': {
615.                 'values': [c.title for c in Chapter.objects.all()],
616.                 'test': lambda obj, value: obj.chap.title == value,
617.             },
618.             'chap__book__id__exact': {
619.                 'values': [b.id for b in Book.objects.all()],
620.                 'test': lambda obj, value: obj.chap.book.id == value,
621.             },
622.             'chap__book__name': {
623.                 'values': [b.name for b in Book.objects.all()],
624.                 'test': lambda obj, value: obj.chap.book.name == value,
625.             },
626.             'chap__book__promo__id__exact': {
627.                 'values': [p.id for p in Promo.objects.all()],
628.                 'test': lambda obj, value: obj.chap.book.promo_set.filter(id=value).exists(),
629.             },
630.             'chap__book__promo__name': {
631.                 'values': [p.name for p in Promo.objects.all()],
632.                 'test': lambda obj, value: obj.chap.book.promo_set.filter(name=value).exists(),
633.             },
634.             # A forward relation (book) after a reverse relation (promo).
635.             'guest_author__promo__book__id__exact': {
636.                 'values': [p.id for p in Book.objects.all()],
637.                 'test': lambda obj, value: obj.guest_author.promo_set.filter(book=value).exists(),
638.             },
639.         }
640.         for filter_path, params in filters.items():
641.             for value in params['values']:
642.                 query_string = urlencode({filter_path: value})
643.                 # ensure filter link exists
644.                 self.assertContains(response, '<a href="?%s"' % query_string)
645.                 # ensure link works
646.                 filtered_response = self.client.get('%s?%s' % (changelist_url, query_string))
647.                 self.assertEqual(filtered_response.status_code, 200)
648.                 # ensure changelist contains only valid objects
649.                 for obj in filtered_response.context['cl'].queryset.all():
650.                     self.assertTrue(params['test'](obj, value))
651. 
652.     def test_incorrect_lookup_parameters(self):
653.         """Ensure incorrect lookup parameters are handled gracefully."""
654.         changelist_url = reverse('admin:admin_views_thing_changelist')
655.         response = self.client.get(changelist_url, {'notarealfield': '5'})
656.         self.assertRedirects(response, '%s?e=1' % changelist_url)
657. 
658.         # Spanning relationships through a nonexistent related object (Refs #16716)
659.         response = self.client.get(changelist_url, {'notarealfield__whatever': '5'})
660.         self.assertRedirects(response, '%s?e=1' % changelist_url)
661. 
662.         response = self.client.get(changelist_url, {'color__id__exact': 'StringNotInteger!'})
663.         self.assertRedirects(response, '%s?e=1' % changelist_url)
664. 
665.         # Regression test for #18530
666.         response = self.client.get(changelist_url, {'pub_date__gte': 'foo'})
667.         self.assertRedirects(response, '%s?e=1' % changelist_url)
668. 
669.     def test_isnull_lookups(self):
670.         """Ensure is_null is handled correctly."""
671.         Article.objects.create(title="I Could Go Anywhere", content="Versatile", date=datetime.datetime.now())
672.         changelist_url = reverse('admin:admin_views_article_changelist')
673.         response = self.client.get(changelist_url)
674.         self.assertContains(response, '4 articles')
675.         response = self.client.get(changelist_url, {'section__isnull': 'false'})
676.         self.assertContains(response, '3 articles')
677.         response = self.client.get(changelist_url, {'section__isnull': '0'})
678.         self.assertContains(response, '3 articles')
679.         response = self.client.get(changelist_url, {'section__isnull': 'true'})
680.         self.assertContains(response, '1 article')
681.         response = self.client.get(changelist_url, {'section__isnull': '1'})
682.         self.assertContains(response, '1 article')
683. 
684.     def test_logout_and_password_change_URLs(self):
685.         response = self.client.get(reverse('admin:admin_views_article_changelist'))
686.         self.assertContains(response, '<a href="%s">' % reverse('admin:logout'))
687.         self.assertContains(response, '<a href="%s">' % reverse('admin:password_change'))
688. 
689.     def test_named_group_field_choices_change_list(self):
690.         """
691.         Ensures the admin changelist shows correct values in the relevant column
692.         for rows corresponding to instances of a model in which a named group
693.         has been used in the choices option of a field.
694.         """
695.         link1 = reverse('admin:admin_views_fabric_change', args=(self.fab1.pk,))
696.         link2 = reverse('admin:admin_views_fabric_change', args=(self.fab2.pk,))
697.         response = self.client.get(reverse('admin:admin_views_fabric_changelist'))
698.         fail_msg = (
699.             "Changelist table isn't showing the right human-readable values "
700.             "set by a model field 'choices' option named group."
701.         )
702.         self.assertContains(response, '<a href="%s">Horizontal</a>' % link1, msg_prefix=fail_msg, html=True)
703.         self.assertContains(response, '<a href="%s">Vertical</a>' % link2, msg_prefix=fail_msg, html=True)
704. 
705.     def test_named_group_field_choices_filter(self):
706.         """
707.         Ensures the filter UI shows correctly when at least one named group has
708.         been used in the choices option of a model field.
709.         """
710.         response = self.client.get(reverse('admin:admin_views_fabric_changelist'))
711.         fail_msg = (
712.             "Changelist filter isn't showing options contained inside a model "
713.             "field 'choices' option named group."
714.         )
715.         self.assertContains(response, '<div id="changelist-filter">')
716.         self.assertContains(
717.             response, '<a href="?surface__exact=x" title="Horizontal">Horizontal</a>',
718.             msg_prefix=fail_msg, html=True
719.         )
720.         self.assertContains(
721.             response, '<a href="?surface__exact=y" title="Vertical">Vertical</a>',
722.             msg_prefix=fail_msg, html=True
723.         )
724. 
725.     def test_change_list_null_boolean_display(self):
726.         Post.objects.create(public=None)
727.         response = self.client.get(reverse('admin:admin_views_post_changelist'))
728.         self.assertContains(response, 'icon-unknown.svg')
729. 
730.     def test_i18n_language_non_english_default(self):
731.         """
732.         Check if the JavaScript i18n view returns an empty language catalog
733.         if the default language is non-English but the selected language
734.         is English. See #13388 and #3594 for more details.
735.         """
736.         with self.settings(LANGUAGE_CODE='fr'), translation.override('en-us'):
737.             response = self.client.get(reverse('admin:jsi18n'))
738.             self.assertNotContains(response, 'Choisir une heure')
739. 
740.     def test_i18n_language_non_english_fallback(self):
741.         """
742.         Makes sure that the fallback language is still working properly
743.         in cases where the selected language cannot be found.
744.         """
745.         with self.settings(LANGUAGE_CODE='fr'), translation.override('none'):
746.             response = self.client.get(reverse('admin:jsi18n'))
747.             self.assertContains(response, 'Choisir une heure')
748. 
749.     def test_jsi18n_with_context(self):
750.         response = self.client.get(reverse('admin-extra-context:jsi18n'))
751.         self.assertEqual(response.status_code, 200)
752. 
753.     def test_L10N_deactivated(self):
754.         """
755.         Check if L10N is deactivated, the JavaScript i18n view doesn't
756.         return localized date/time formats. Refs #14824.
757.         """
758.         with self.settings(LANGUAGE_CODE='ru', USE_L10N=False), translation.override('none'):
759.             response = self.client.get(reverse('admin:jsi18n'))
760.             self.assertNotContains(response, '%d.%m.%Y %H:%M:%S')
761.             self.assertContains(response, '%Y-%m-%d %H:%M:%S')
762. 
763.     def test_disallowed_filtering(self):
764.         with self.assertLogs('django.security.DisallowedModelAdminLookup', 'ERROR'):
765.             response = self.client.get(
766.                 "%s?owner__email__startswith=fuzzy" % reverse('admin:admin_views_album_changelist')
767.             )
768.         self.assertEqual(response.status_code, 400)
769. 
770.         # Filters are allowed if explicitly included in list_filter
771.         response = self.client.get("%s?color__value__startswith=red" % reverse('admin:admin_views_thing_changelist'))
772.         self.assertEqual(response.status_code, 200)
773.         response = self.client.get("%s?color__value=red" % reverse('admin:admin_views_thing_changelist'))
774.         self.assertEqual(response.status_code, 200)
775. 
776.         # Filters should be allowed if they involve a local field without the
777.         # need to whitelist them in list_filter or date_hierarchy.
778.         response = self.client.get("%s?age__gt=30" % reverse('admin:admin_views_person_changelist'))
779.         self.assertEqual(response.status_code, 200)
780. 
781.         e1 = Employee.objects.create(name='Anonymous', gender=1, age=22, alive=True, code='123')
782.         e2 = Employee.objects.create(name='Visitor', gender=2, age=19, alive=True, code='124')
783.         WorkHour.objects.create(datum=datetime.datetime.now(), employee=e1)
784.         WorkHour.objects.create(datum=datetime.datetime.now(), employee=e2)
785.         response = self.client.get(reverse('admin:admin_views_workhour_changelist'))
786.         self.assertContains(response, 'employee__person_ptr__exact')
787.         response = self.client.get("%s?employee__person_ptr__exact=%d" % (
788.             reverse('admin:admin_views_workhour_changelist'), e1.pk)
789.         )
790.         self.assertEqual(response.status_code, 200)
791. 
792.     def test_disallowed_to_field(self):
793.         url = reverse('admin:admin_views_section_changelist')
794.         with self.assertLogs('django.security.DisallowedModelAdminToField', 'ERROR'):
795.             response = self.client.get(url, {TO_FIELD_VAR: 'missing_field'})
796.         self.assertEqual(response.status_code, 400)
797. 
798.         # Specifying a field that is not referred by any other model registered
799.         # to this admin site should raise an exception.
800.         with self.assertLogs('django.security.DisallowedModelAdminToField', 'ERROR'):
801.             response = self.client.get(reverse('admin:admin_views_section_changelist'), {TO_FIELD_VAR: 'name'})
802.         self.assertEqual(response.status_code, 400)
803. 
804.         # #23839 - Primary key should always be allowed, even if the referenced model isn't registered.
805.         response = self.client.get(reverse('admin:admin_views_notreferenced_changelist'), {TO_FIELD_VAR: 'id'})
806.         self.assertEqual(response.status_code, 200)
807. 
808.         # #23915 - Specifying a field referenced by another model though a m2m should be allowed.
809.         response = self.client.get(reverse('admin:admin_views_recipe_changelist'), {TO_FIELD_VAR: 'rname'})
810.         self.assertEqual(response.status_code, 200)
811. 
812.         # #23604, #23915 - Specifying a field referenced through a reverse m2m relationship should be allowed.
813.         response = self.client.get(reverse('admin:admin_views_ingredient_changelist'), {TO_FIELD_VAR: 'iname'})
814.         self.assertEqual(response.status_code, 200)
815. 
816.         # #23329 - Specifying a field that is not referred by any other model directly registered
817.         # to this admin site but registered through inheritance should be allowed.
818.         response = self.client.get(reverse('admin:admin_views_referencedbyparent_changelist'), {TO_FIELD_VAR: 'name'})
819.         self.assertEqual(response.status_code, 200)
820. 
821.         # #23431 - Specifying a field that is only referred to by a inline of a registered
822.         # model should be allowed.
823.         response = self.client.get(reverse('admin:admin_views_referencedbyinline_changelist'), {TO_FIELD_VAR: 'name'})
824.         self.assertEqual(response.status_code, 200)
825. 
826.         # #25622 - Specifying a field of a model only referred by a generic
827.         # relation should raise DisallowedModelAdminToField.
828.         url = reverse('admin:admin_views_referencedbygenrel_changelist')
829.         with self.assertLogs('django.security.DisallowedModelAdminToField', 'ERROR'):
830.             response = self.client.get(url, {TO_FIELD_VAR: 'object_id'})
831.         self.assertEqual(response.status_code, 400)
832. 
833.         # We also want to prevent the add, change, and delete views from
834.         # leaking a disallowed field value.
835.         with self.assertLogs('django.security.DisallowedModelAdminToField', 'ERROR'):
836.             response = self.client.post(reverse('admin:admin_views_section_add'), {TO_FIELD_VAR: 'name'})
837.         self.assertEqual(response.status_code, 400)
838. 
839.         section = Section.objects.create()
840.         url = reverse('admin:admin_views_section_change', args=(section.pk,))
841.         with self.assertLogs('django.security.DisallowedModelAdminToField', 'ERROR'):
842.             response = self.client.post(url, {TO_FIELD_VAR: 'name'})
843.         self.assertEqual(response.status_code, 400)
844. 
845.         url = reverse('admin:admin_views_section_delete', args=(section.pk,))
846.         with self.assertLogs('django.security.DisallowedModelAdminToField', 'ERROR'):
847.             response = self.client.post(url, {TO_FIELD_VAR: 'name'})
848.         self.assertEqual(response.status_code, 400)
849. 
850.     def test_allowed_filtering_15103(self):
851.         """
852.         Regressions test for ticket 15103 - filtering on fields defined in a
853.         ForeignKey 'limit_choices_to' should be allowed, otherwise raw_id_fields
854.         can break.
855.         """
856.         # Filters should be allowed if they are defined on a ForeignKey pointing to this model
857.         url = "%s?leader__name=Palin&leader__age=27" % reverse('admin:admin_views_inquisition_changelist')
858.         response = self.client.get(url)
859.         self.assertEqual(response.status_code, 200)
860. 
861.     def test_popup_dismiss_related(self):
862.         """
863.         Regression test for ticket 20664 - ensure the pk is properly quoted.
864.         """
865.         actor = Actor.objects.create(name="Palin", age=27)
866.         response = self.client.get("%s?%s" % (reverse('admin:admin_views_actor_changelist'), IS_POPUP_VAR))
867.         self.assertContains(response, 'data-popup-opener="%s"' % actor.pk)
868. 
869.     def test_hide_change_password(self):
870.         """
871.         Tests if the "change password" link in the admin is hidden if the User
872.         does not have a usable password set.
873.         (against 9bea85795705d015cdadc82c68b99196a8554f5c)
874.         """
875.         user = User.objects.get(username='super')
876.         user.set_unusable_password()
877.         user.save()
878.         self.client.force_login(user)
879.         response = self.client.get(reverse('admin:index'))
880.         self.assertNotContains(
881.             response, reverse('admin:password_change'),
882.             msg_prefix='The "change password" link should not be displayed if a user does not have a usable password.'
883.         )
884. 
885.     def test_change_view_with_show_delete_extra_context(self):
886.         """
887.         The 'show_delete' context variable in the admin's change view controls
888.         the display of the delete button.
889.         """
890.         instance = UndeletableObject.objects.create(name='foo')
891.         response = self.client.get(reverse('admin:admin_views_undeletableobject_change', args=(instance.pk,)))
892.         self.assertNotContains(response, 'deletelink')
893. 
894.     def test_change_view_logs_m2m_field_changes(self):
895.         """Changes to ManyToManyFields are included in the object's history."""
896.         pizza = ReadablePizza.objects.create(name='Cheese')
897.         cheese = Topping.objects.create(name='cheese')
898.         post_data = {'name': pizza.name, 'toppings': [cheese.pk]}
899.         response = self.client.post(reverse('admin:admin_views_readablepizza_change', args=(pizza.pk,)), post_data)
900.         self.assertRedirects(response, reverse('admin:admin_views_readablepizza_changelist'))
901.         pizza_ctype = ContentType.objects.get_for_model(ReadablePizza, for_concrete_model=False)
902.         log = LogEntry.objects.filter(content_type=pizza_ctype, object_id=pizza.pk).first()
903.         self.assertEqual(log.get_change_message(), 'Changed toppings.')
904. 
905.     def test_allows_attributeerror_to_bubble_up(self):
906.         """
907.         AttributeErrors are allowed to bubble when raised inside a change list
908.         view. Requires a model to be created so there's something to display.
909.         Refs: #16655, #18593, and #18747
910.         """
911.         Simple.objects.create()
912.         with self.assertRaises(AttributeError):
913.             self.client.get(reverse('admin:admin_views_simple_changelist'))
914. 
915.     def test_changelist_with_no_change_url(self):
916.         """
917.         ModelAdmin.changelist_view shouldn't result in a NoReverseMatch if url
918.         for change_view is removed from get_urls (#20934).
919.         """
920.         o = UnchangeableObject.objects.create()
921.         response = self.client.get(reverse('admin:admin_views_unchangeableobject_changelist'))
922.         self.assertEqual(response.status_code, 200)
923.         # Check the format of the shown object -- shouldn't contain a change link
924.         self.assertContains(response, '<th class="field-__str__">%s</th>' % o, html=True)
925. 
926.     def test_invalid_appindex_url(self):
927.         """
928.         #21056 -- URL reversing shouldn't work for nonexistent apps.
929.         """
930.         good_url = '/test_admin/admin/admin_views/'
931.         confirm_good_url = reverse('admin:app_list',
932.                                    kwargs={'app_label': 'admin_views'})
933.         self.assertEqual(good_url, confirm_good_url)
934. 
935.         with self.assertRaises(NoReverseMatch):
936.             reverse('admin:app_list', kwargs={'app_label': 'this_should_fail'})
937.         with self.assertRaises(NoReverseMatch):
938.             reverse('admin:app_list', args=('admin_views2',))
939. 
940.     def test_resolve_admin_views(self):
941.         index_match = resolve('/test_admin/admin4/')
942.         list_match = resolve('/test_admin/admin4/auth/user/')
943.         self.assertIs(index_match.func.admin_site, customadmin.simple_site)
944.         self.assertIsInstance(list_match.func.model_admin, customadmin.CustomPwdTemplateUserAdmin)
945. 
946.     def test_adminsite_display_site_url(self):
947.         """
948.         #13749 - Admin should display link to front-end site 'View site'
949.         """
950.         url = reverse('admin:index')
951.         response = self.client.get(url)
952.         self.assertEqual(response.context['site_url'], '/my-site-url/')
953.         self.assertContains(response, '<a href="/my-site-url/">View site</a>')
954. 
955.     @override_settings(TIME_ZONE='America/Sao_Paulo', USE_TZ=True)
956.     def test_date_hierarchy_timezone_dst(self):
957.         # This datetime doesn't exist in this timezone due to DST.
958.         date = pytz.timezone('America/Sao_Paulo').localize(datetime.datetime(2016, 10, 16, 15), is_dst=None)
959.         q = Question.objects.create(question='Why?', expires=date)
960.         Answer2.objects.create(question=q, answer='Because.')
961.         response = self.client.get(reverse('admin:admin_views_answer2_changelist'))
962.         self.assertEqual(response.status_code, 200)
963.         self.assertContains(response, 'question__expires__day=16')
964.         self.assertContains(response, 'question__expires__month=10')
965.         self.assertContains(response, 'question__expires__year=2016')
966. 
967.     def test_sortable_by_columns_subset(self):
968.         expected_sortable_fields = ('date', 'callable_year')
969.         expected_not_sortable_fields = (
970.             'content', 'model_year', 'modeladmin_year', 'model_year_reversed',
971.             'section',
972.         )
973.         response = self.client.get(reverse('admin6:admin_views_article_changelist'))
974.         for field_name in expected_sortable_fields:
975.             self.assertContains(response, '<th scope="col"  class="sortable column-%s">' % field_name)
976.         for field_name in expected_not_sortable_fields:
977.             self.assertContains(response, '<th scope="col"  class="column-%s">' % field_name)
978. 
979.     def test_get_sortable_by_columns_subset(self):
980.         response = self.client.get(reverse('admin6:admin_views_actor_changelist'))
981.         self.assertContains(response, '<th scope="col"  class="sortable column-age">')
982.         self.assertContains(response, '<th scope="col"  class="column-name">')
983. 
984.     def test_sortable_by_no_column(self):
985.         expected_not_sortable_fields = ('title', 'book')
986.         response = self.client.get(reverse('admin6:admin_views_chapter_changelist'))
987.         for field_name in expected_not_sortable_fields:
988.             self.assertContains(response, '<th scope="col"  class="column-%s">' % field_name)
989.         self.assertNotContains(response, '<th scope="col"  class="sortable column')
990. 
991.     def test_get_sortable_by_no_column(self):
992.         response = self.client.get(reverse('admin6:admin_views_color_changelist'))
993.         self.assertContains(response, '<th scope="col"  class="column-value">')
994.         self.assertNotContains(response, '<th scope="col"  class="sortable column')


--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to a given query and the refinement query, and return your response in the specified format!
EVERY context object MUST include: reasoning, relative_path, start_line, and end_line.

2025-10-06 21:08:43,116 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='This test class `ReadonlyTest` is highly relevant as it is entirely dedicated to testing `readonly_fields` in `ModelAdmin`, which the user specifically asked about. It includes multiple test methods like `test_readonly_get`, `test_readonly_manytomany`, and `test_readonly_onetoone_backwards_ref` that demonstrate how readonly fields, including dynamic callables and relationships, are handled. This provides a comprehensive set of examples for dynamic admin configuration.', relative_path='tests/admin_views/tests.py', start_line=4815, end_line=4990), ContextOutput(reasoning="This test class, `AdminCustomQuerysetTest`, is dedicated to testing the effects of a custom `get_queryset` method on a `ModelAdmin`. It includes tests for the changelist, change, add, and edit views (`test_changelist_view`, `test_change_view`, `test_add_model_modeladmin_defer_qs`, `test_edit_model_modeladmin_only_qs`). This demonstrates how a `get_*` method can dynamically control which objects are visible and how they are fetched, which is a core aspect of the user's query.", relative_path='tests/admin_views/tests.py', start_line=3631, end_line=3890), ContextOutput(reasoning='This test class `AdminViewFormUrlTest` contains `test_initial_data_can_be_overridden`, which demonstrates how to use a hook (likely `get_changeform_initial_data`) to dynamically provide initial data for an admin form. This is a direct example of a `get_*` method altering form configuration, as requested by the user.', relative_path='tests/admin_views/tests.py', start_line=1138, end_line=1183), ContextOutput(reasoning="This test class `TestCustomChangeList` validates the use of a custom `ChangeList` class, which is specified by overriding the `ModelAdmin.get_changelist` method. This is a `get_*` hook that allows for deep customization of the admin list view, which is relevant to the user's interest in dynamic admin configuration.", relative_path='tests/admin_views/tests.py', start_line=3587, end_line=3611), ContextOutput(reasoning="This test class `AdminViewDeletedObjectsTest`, and specifically `test_delete_view_uses_get_deleted_objects`, tests the `ModelAdmin.get_deleted_objects` method. This method allows for customization of how related objects for deletion are collected and displayed. This is another example of a `get_*` hook for dynamic behavior in the admin, which is relevant to the user's query.", relative_path='tests/admin_views/tests.py', start_line=2501, end_line=2690)]
2025-10-06 21:08:43,120 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - INFO - Context extraction complete, returning context [Context(relative_path='tests/admin_inlines/tests.py', content='338.     def test_custom_min_num(self):\n339.         bt_head = BinaryTree.objects.create(name="Tree Head")\n340.         BinaryTree.objects.create(name="First Child", parent=bt_head)\n341. \n342.         class MinNumInline(TabularInline):\n343.             model = BinaryTree\n344.             extra = 3\n345. \n346.             def get_min_num(self, request, obj=None, **kwargs):\n347.                 if obj:\n348.                     return 5\n349.                 return 2\n350. \n351.         modeladmin = ModelAdmin(BinaryTree, admin_site)\n352.         modeladmin.inlines = [MinNumInline]\n353.         min_forms = (\n354.             \'<input id="id_binarytree_set-MIN_NUM_FORMS" \'\n355.             \'name="binarytree_set-MIN_NUM_FORMS" type="hidden" value="%d">\'\n356.         )\n357.         total_forms = (\n358.             \'<input id="id_binarytree_set-TOTAL_FORMS" \'\n359.             \'name="binarytree_set-TOTAL_FORMS" type="hidden" value="%d">\'\n360.         )\n361.         request = self.factory.get(reverse(\'admin:admin_inlines_binarytree_add\'))\n362.         request.user = User(username=\'super\', is_superuser=True)\n363.         response = modeladmin.changeform_view(request)\n364.         self.assertInHTML(min_forms % 2, response.rendered_content)\n365.         self.assertInHTML(total_forms % 5, response.rendered_content)\n366. \n367.         request = self.factory.get(reverse(\'admin:admin_inlines_binarytree_change\', args=(bt_head.id,)))\n368.         request.user = User(username=\'super\', is_superuser=True)\n369.         response = modeladmin.changeform_view(request, object_id=str(bt_head.id))\n370.         self.assertInHTML(min_forms % 5, response.rendered_content)\n371.         self.assertInHTML(total_forms % 8, response.rendered_content)\n372. ', start_line_number=338, end_line_number=372), Context(relative_path='tests/admin_inlines/tests.py', content='291.     def test_custom_get_extra_form(self):\n292.         bt_head = BinaryTree.objects.create(name="Tree Head")\n293.         BinaryTree.objects.create(name="First Child", parent=bt_head)\n294.         # The maximum number of forms should respect \'get_max_num\' on the\n295.         # ModelAdmin\n296.         max_forms_input = (\n297.             \'<input id="id_binarytree_set-MAX_NUM_FORMS" \'\n298.             \'name="binarytree_set-MAX_NUM_FORMS" type="hidden" value="%d">\'\n299.         )\n300.         # The total number of forms will remain the same in either case\n301.         total_forms_hidden = (\n302.             \'<input id="id_binarytree_set-TOTAL_FORMS" \'\n303.             \'name="binarytree_set-TOTAL_FORMS" type="hidden" value="2">\'\n304.         )\n305.         response = self.client.get(reverse(\'admin:admin_inlines_binarytree_add\'))\n306.         self.assertInHTML(max_forms_input % 3, response.rendered_content)\n307.         self.assertInHTML(total_forms_hidden, response.rendered_content)\n308. \n309.         response = self.client.get(reverse(\'admin:admin_inlines_binarytree_change\', args=(bt_head.id,)))\n310.         self.assertInHTML(max_forms_input % 2, response.rendered_content)\n311.         self.assertInHTML(total_forms_hidden, response.rendered_content)\n312. ', start_line_number=291, end_line_number=312), Context(relative_path='tests/admin_inlines/tests.py', content='154.     def test_callable_lookup(self):\n155.         """Admin inline should invoke local callable when its name is listed in readonly_fields"""\n156.         response = self.client.get(reverse(\'admin:admin_inlines_poll_add\'))\n157.         self.assertEqual(response.status_code, 200)\n158.         # Add parent object view should have the child inlines section\n159.         self.assertContains(\n160.             response,\n161.             \'<div class="js-inline-admin-formset inline-group" id="question_set-group"\'\n162.         )\n163.         # The right callable should be used for the inline readonly_fields\n164.         # column cells\n165.         self.assertContains(response, \'<p>Callable in QuestionInline</p>\')\n166. ', start_line_number=154, end_line_number=166), Context(relative_path='tests/admin_inlines/tests.py', content='433.     def test_inlines_show_change_link_registered(self):\n434.         "Inlines `show_change_link` for registered models when enabled."\n435.         holder = Holder4.objects.create(dummy=1)\n436.         item1 = Inner4Stacked.objects.create(dummy=1, holder=holder)\n437.         item2 = Inner4Tabular.objects.create(dummy=1, holder=holder)\n438.         items = (\n439.             (\'inner4stacked\', item1.pk),\n440.             (\'inner4tabular\', item2.pk),\n441.         )\n442.         response = self.client.get(reverse(\'admin:admin_inlines_holder4_change\', args=(holder.pk,)))\n443.         self.assertTrue(response.context[\'inline_admin_formset\'].opts.has_registered_model)\n444.         for model, pk in items:\n445.             url = reverse(\'admin:admin_inlines_%s_change\' % model, args=(pk,))\n446.             self.assertContains(response, \'<a href="%s" %s\' % (url, INLINE_CHANGELINK_HTML))\n447. ', start_line_number=433, end_line_number=447), Context(relative_path='tests/admin_views/tests.py', content='6181.     def test_check(self):\n6182.         "The view_on_site value is either a boolean or a callable"\n6183.         try:\n6184.             admin = CityAdmin(City, AdminSite())\n6185.             CityAdmin.view_on_site = True\n6186.             self.assertEqual(admin.check(), [])\n6187.             CityAdmin.view_on_site = False\n6188.             self.assertEqual(admin.check(), [])\n6189.             CityAdmin.view_on_site = lambda obj: obj.get_absolute_url()\n6190.             self.assertEqual(admin.check(), [])\n6191.             CityAdmin.view_on_site = []\n6192.             self.assertEqual(admin.check(), [\n6193.                 Error(\n6194.                     "The value of \'view_on_site\' must be a callable or a boolean value.",\n6195.                     obj=CityAdmin,\n6196.                     id=\'admin.E025\',\n6197.                 ),\n6198.             ])\n6199.         finally:\n6200.             # Restore the original values for the benefit of other tests.\n6201.             CityAdmin.view_on_site = True\n6202. ', start_line_number=6181, end_line_number=6202), Context(relative_path='tests/admin_views/tests.py', content='4815. class ReadonlyTest(AdminFieldExtractionMixin, TestCase):\n4816. \n4817.     @classmethod\n4818.     def setUpTestData(cls):\n4819.         cls.superuser = User.objects.create_superuser(username=\'super\', password=\'secret\', email=\'super@example.com\')\n4820. \n4821.     def setUp(self):\n4822.         self.client.force_login(self.superuser)\n4823. \n4824.     def test_readonly_get(self):\n4825.         response = self.client.get(reverse(\'admin:admin_views_post_add\'))\n4826.         self.assertEqual(response.status_code, 200)\n4827.         self.assertNotContains(response, \'name="posted"\')\n4828.         # 3 fields + 2 submit buttons + 5 inline management form fields, + 2\n4829.         # hidden fields for inlines + 1 field for the inline + 2 empty form\n4830.         self.assertContains(response, "<input", count=15)\n4831.         self.assertContains(response, formats.localize(datetime.date.today()))\n4832.         self.assertContains(response, "<label>Awesomeness level:</label>")\n4833.         self.assertContains(response, "Very awesome.")\n4834.         self.assertContains(response, "Unknown coolness.")\n4835.         self.assertContains(response, "foo")\n4836. \n4837.         # Multiline text in a readonly field gets <br> tags\n4838.         self.assertContains(response, \'Multiline<br>test<br>string\')\n4839.         self.assertContains(response, \'<div class="readonly">Multiline<br>html<br>content</div>\', html=True)\n4840.         self.assertContains(response, \'InlineMultiline<br>test<br>string\')\n4841. \n4842.         self.assertContains(response, formats.localize(datetime.date.today() - datetime.timedelta(days=7)))\n4843. \n4844.         self.assertContains(response, \'<div class="form-row field-coolness">\')\n4845.         self.assertContains(response, \'<div class="form-row field-awesomeness_level">\')\n4846.         self.assertContains(response, \'<div class="form-row field-posted">\')\n4847.         self.assertContains(response, \'<div class="form-row field-value">\')\n4848.         self.assertContains(response, \'<div class="form-row">\')\n4849.         self.assertContains(response, \'<div class="help">\', 3)\n4850.         self.assertContains(\n4851.             response,\n4852.             \'<div class="help">Some help text for the title (with unicode ŠĐĆŽćžšđ)</div>\',\n4853.             html=True\n4854.         )\n4855.         self.assertContains(\n4856.             response,\n4857.             \'<div class="help">Some help text for the content (with unicode ŠĐĆŽćžšđ)</div>\',\n4858.             html=True\n4859.         )\n4860.         self.assertContains(\n4861.             response,\n4862.             \'<div class="help">Some help text for the date (with unicode ŠĐĆŽćžšđ)</div>\',\n4863.             html=True\n4864.         )\n4865. \n4866.         p = Post.objects.create(title="I worked on readonly_fields", content="Its good stuff")\n4867.         response = self.client.get(reverse(\'admin:admin_views_post_change\', args=(p.pk,)))\n4868.         self.assertContains(response, "%d amount of cool" % p.pk)\n4869. \n4870.     def test_readonly_text_field(self):\n4871.         p = Post.objects.create(\n4872.             title="Readonly test", content="test",\n4873.             readonly_content=\'test\\r\\n\\r\\ntest\\r\\n\\r\\ntest\\r\\n\\r\\ntest\',\n4874.         )\n4875.         Link.objects.create(\n4876.             url="http://www.djangoproject.com", post=p,\n4877.             readonly_link_content="test\\r\\nlink",\n4878.         )\n4879.         response = self.client.get(reverse(\'admin:admin_views_post_change\', args=(p.pk,)))\n4880.         # Checking readonly field.\n4881.         self.assertContains(response, \'test<br><br>test<br><br>test<br><br>test\')\n4882.         # Checking readonly field in inline.\n4883.         self.assertContains(response, \'test<br>link\')\n4884. \n4885.     def test_readonly_post(self):\n4886.         data = {\n4887.             "title": "Django Got Readonly Fields",\n4888.             "content": "This is an incredible development.",\n4889.             "link_set-TOTAL_FORMS": "1",\n4890.             "link_set-INITIAL_FORMS": "0",\n4891.             "link_set-MAX_NUM_FORMS": "0",\n4892.         }\n4893.         response = self.client.post(reverse(\'admin:admin_views_post_add\'), data)\n4894.         self.assertEqual(response.status_code, 302)\n4895.         self.assertEqual(Post.objects.count(), 1)\n4896.         p = Post.objects.get()\n4897.         self.assertEqual(p.posted, datetime.date.today())\n4898. \n4899.         data["posted"] = "10-8-1990"  # some date that\'s not today\n4900.         response = self.client.post(reverse(\'admin:admin_views_post_add\'), data)\n4901.         self.assertEqual(response.status_code, 302)\n4902.         self.assertEqual(Post.objects.count(), 2)\n4903.         p = Post.objects.order_by(\'-id\')[0]\n4904.         self.assertEqual(p.posted, datetime.date.today())\n4905. \n4906.     def test_readonly_manytomany(self):\n4907.         "Regression test for #13004"\n4908.         response = self.client.get(reverse(\'admin:admin_views_pizza_add\'))\n4909.         self.assertEqual(response.status_code, 200)\n4910. \n4911.     def test_user_password_change_limited_queryset(self):\n4912.         su = User.objects.filter(is_superuser=True)[0]\n4913.         response = self.client.get(reverse(\'admin2:auth_user_password_change\', args=(su.pk,)))\n4914.         self.assertEqual(response.status_code, 404)\n4915. \n4916.     def test_change_form_renders_correct_null_choice_value(self):\n4917.         """\n4918.         Regression test for #17911.\n4919.         """\n4920.         choice = Choice.objects.create(choice=None)\n4921.         response = self.client.get(reverse(\'admin:admin_views_choice_change\', args=(choice.pk,)))\n4922.         self.assertContains(response, \'<div class="readonly">No opinion</div>\', html=True)\n4923. \n4924.     def test_readonly_manytomany_backwards_ref(self):\n4925.         """\n4926.         Regression test for #16433 - backwards references for related objects\n4927.         broke if the related field is read-only due to the help_text attribute\n4928.         """\n4929.         topping = Topping.objects.create(name=\'Salami\')\n4930.         pizza = Pizza.objects.create(name=\'Americano\')\n4931.         pizza.toppings.add(topping)\n4932.         response = self.client.get(reverse(\'admin:admin_views_topping_add\'))\n4933.         self.assertEqual(response.status_code, 200)\n4934. \n4935.     def test_readonly_manytomany_forwards_ref(self):\n4936.         topping = Topping.objects.create(name=\'Salami\')\n4937.         pizza = Pizza.objects.create(name=\'Americano\')\n4938.         pizza.toppings.add(topping)\n4939.         response = self.client.get(reverse(\'admin:admin_views_pizza_change\', args=(pizza.pk,)))\n4940.         self.assertContains(response, \'<label>Toppings:</label>\', html=True)\n4941.         self.assertContains(response, \'<div class="readonly">Salami</div>\', html=True)\n4942. \n4943.     def test_readonly_onetoone_backwards_ref(self):\n4944.         """\n4945.         Can reference a reverse OneToOneField in ModelAdmin.readonly_fields.\n4946.         """\n4947.         v1 = Villain.objects.create(name=\'Adam\')\n4948.         pl = Plot.objects.create(name=\'Test Plot\', team_leader=v1, contact=v1)\n4949.         pd = PlotDetails.objects.create(details=\'Brand New Plot\', plot=pl)\n4950. \n4951.         response = self.client.get(reverse(\'admin:admin_views_plotproxy_change\', args=(pl.pk,)))\n4952.         field = self.get_admin_readonly_field(response, \'plotdetails\')\n4953.         self.assertEqual(field.contents(), \'Brand New Plot\')\n4954. \n4955.         # The reverse relation also works if the OneToOneField is null.\n4956.         pd.plot = None\n4957.         pd.save()\n4958. \n4959.         response = self.client.get(reverse(\'admin:admin_views_plotproxy_change\', args=(pl.pk,)))\n4960.         field = self.get_admin_readonly_field(response, \'plotdetails\')\n4961.         self.assertEqual(field.contents(), \'-\')  # default empty value\n4962. \n4963.     def test_readonly_field_overrides(self):\n4964.         """\n4965.         Regression test for #22087 - ModelForm Meta overrides are ignored by\n4966.         AdminReadonlyField\n4967.         """\n4968.         p = FieldOverridePost.objects.create(title="Test Post", content="Test Content")\n4969.         response = self.client.get(reverse(\'admin:admin_views_fieldoverridepost_change\', args=(p.pk,)))\n4970.         self.assertContains(response, \'<div class="help">Overridden help text for the date</div>\')\n4971.         self.assertContains(response, \'<label for="id_public">Overridden public label:</label>\', html=True)\n4972.         self.assertNotContains(response, "Some help text for the date (with unicode ŠĐĆŽćžšđ)")\n4973. \n4974.     def test_correct_autoescaping(self):\n4975.         """\n4976.         Make sure that non-field readonly elements are properly autoescaped (#24461)\n4977.         """\n4978.         section = Section.objects.create(name=\'<a>evil</a>\')\n4979.         response = self.client.get(reverse(\'admin:admin_views_section_change\', args=(section.pk,)))\n4980.         self.assertNotContains(response, "<a>evil</a>", status_code=200)\n4981.         self.assertContains(response, "&lt;a&gt;evil&lt;/a&gt;", status_code=200)\n4982. \n4983.     def test_label_suffix_translated(self):\n4984.         pizza = Pizza.objects.create(name=\'Americano\')\n4985.         url = reverse(\'admin:admin_views_pizza_change\', args=(pizza.pk,))\n4986.         with self.settings(LANGUAGE_CODE=\'fr\'):\n4987.             response = self.client.get(url)\n4988.         self.assertContains(response, \'<label>Toppings\\u00A0:</label>\', html=True)\n4989. \n4990. ', start_line_number=4815, end_line_number=4990), Context(relative_path='tests/admin_views/tests.py', content='3631. class AdminCustomQuerysetTest(TestCase):\n3632. \n3633.     @classmethod\n3634.     def setUpTestData(cls):\n3635.         cls.superuser = User.objects.create_superuser(username=\'super\', password=\'secret\', email=\'super@example.com\')\n3636.         cls.pks = [EmptyModel.objects.create().id for i in range(3)]\n3637. \n3638.     def setUp(self):\n3639.         self.client.force_login(self.superuser)\n3640.         self.super_login = {\n3641.             REDIRECT_FIELD_NAME: reverse(\'admin:index\'),\n3642.             \'username\': \'super\',\n3643.             \'password\': \'secret\',\n3644.         }\n3645. \n3646.     def test_changelist_view(self):\n3647.         response = self.client.get(reverse(\'admin:admin_views_emptymodel_changelist\'))\n3648.         for i in self.pks:\n3649.             if i > 1:\n3650.                 self.assertContains(response, \'Primary key = %s\' % i)\n3651.             else:\n3652.                 self.assertNotContains(response, \'Primary key = %s\' % i)\n3653. \n3654.     def test_changelist_view_count_queries(self):\n3655.         # create 2 Person objects\n3656.         Person.objects.create(name=\'person1\', gender=1)\n3657.         Person.objects.create(name=\'person2\', gender=2)\n3658.         changelist_url = reverse(\'admin:admin_views_person_changelist\')\n3659. \n3660.         # 5 queries are expected: 1 for the session, 1 for the user,\n3661.         # 2 for the counts and 1 for the objects on the page\n3662.         with self.assertNumQueries(5):\n3663.             resp = self.client.get(changelist_url)\n3664.             self.assertEqual(resp.context[\'selection_note\'], \'0 of 2 selected\')\n3665.             self.assertEqual(resp.context[\'selection_note_all\'], \'All 2 selected\')\n3666.         with self.assertNumQueries(5):\n3667.             extra = {\'q\': \'not_in_name\'}\n3668.             resp = self.client.get(changelist_url, extra)\n3669.             self.assertEqual(resp.context[\'selection_note\'], \'0 of 0 selected\')\n3670.             self.assertEqual(resp.context[\'selection_note_all\'], \'All 0 selected\')\n3671.         with self.assertNumQueries(5):\n3672.             extra = {\'q\': \'person\'}\n3673.             resp = self.client.get(changelist_url, extra)\n3674.             self.assertEqual(resp.context[\'selection_note\'], \'0 of 2 selected\')\n3675.             self.assertEqual(resp.context[\'selection_note_all\'], \'All 2 selected\')\n3676.         with self.assertNumQueries(5):\n3677.             extra = {\'gender__exact\': \'1\'}\n3678.             resp = self.client.get(changelist_url, extra)\n3679.             self.assertEqual(resp.context[\'selection_note\'], \'0 of 1 selected\')\n3680.             self.assertEqual(resp.context[\'selection_note_all\'], \'1 selected\')\n3681. \n3682.     def test_change_view(self):\n3683.         for i in self.pks:\n3684.             url = reverse(\'admin:admin_views_emptymodel_change\', args=(i,))\n3685.             response = self.client.get(url, follow=True)\n3686.             if i > 1:\n3687.                 self.assertEqual(response.status_code, 200)\n3688.             else:\n3689.                 self.assertRedirects(response, reverse(\'admin:index\'))\n3690.                 self.assertEqual(\n3691.                     [m.message for m in response.context[\'messages\']],\n3692.                     ["""empty model with ID "1" doesn\'t exist. Perhaps it was deleted?"""]\n3693.                 )\n3694. \n3695.     def test_add_model_modeladmin_defer_qs(self):\n3696.         # Test for #14529. defer() is used in ModelAdmin.get_queryset()\n3697. \n3698.         # model has __str__ method\n3699.         self.assertEqual(CoverLetter.objects.count(), 0)\n3700.         # Emulate model instance creation via the admin\n3701.         post_data = {\n3702.             "author": "Candidate, Best",\n3703.             "_save": "Save",\n3704.         }\n3705.         response = self.client.post(reverse(\'admin:admin_views_coverletter_add\'), post_data, follow=True)\n3706.         self.assertEqual(response.status_code, 200)\n3707.         self.assertEqual(CoverLetter.objects.count(), 1)\n3708.         # Message should contain non-ugly model verbose name\n3709.         pk = CoverLetter.objects.all()[0].pk\n3710.         self.assertContains(\n3711.             response,\n3712.             \'<li class="success">The cover letter "<a href="%s">\'\n3713.             \'Candidate, Best</a>" was added successfully.</li>\' %\n3714.             reverse(\'admin:admin_views_coverletter_change\', args=(pk,)), html=True\n3715.         )\n3716. \n3717.         # model has no __str__ method\n3718.         self.assertEqual(ShortMessage.objects.count(), 0)\n3719.         # Emulate model instance creation via the admin\n3720.         post_data = {\n3721.             "content": "What\'s this SMS thing?",\n3722.             "_save": "Save",\n3723.         }\n3724.         response = self.client.post(reverse(\'admin:admin_views_shortmessage_add\'), post_data, follow=True)\n3725.         self.assertEqual(response.status_code, 200)\n3726.         self.assertEqual(ShortMessage.objects.count(), 1)\n3727.         # Message should contain non-ugly model verbose name\n3728.         sm = ShortMessage.objects.all()[0]\n3729.         self.assertContains(\n3730.             response,\n3731.             \'<li class="success">The short message "<a href="%s">\'\n3732.             \'%s</a>" was added successfully.</li>\' %\n3733.             (reverse(\'admin:admin_views_shortmessage_change\', args=(sm.pk,)), sm), html=True\n3734.         )\n3735. \n3736.     def test_add_model_modeladmin_only_qs(self):\n3737.         # Test for #14529. only() is used in ModelAdmin.get_queryset()\n3738. \n3739.         # model has __str__ method\n3740.         self.assertEqual(Telegram.objects.count(), 0)\n3741.         # Emulate model instance creation via the admin\n3742.         post_data = {\n3743.             "title": "Urgent telegram",\n3744.             "_save": "Save",\n3745.         }\n3746.         response = self.client.post(reverse(\'admin:admin_views_telegram_add\'), post_data, follow=True)\n3747.         self.assertEqual(response.status_code, 200)\n3748.         self.assertEqual(Telegram.objects.count(), 1)\n3749.         # Message should contain non-ugly model verbose name\n3750.         pk = Telegram.objects.all()[0].pk\n3751.         self.assertContains(\n3752.             response,\n3753.             \'<li class="success">The telegram "<a href="%s">\'\n3754.             \'Urgent telegram</a>" was added successfully.</li>\' %\n3755.             reverse(\'admin:admin_views_telegram_change\', args=(pk,)), html=True\n3756.         )\n3757. \n3758.         # model has no __str__ method\n3759.         self.assertEqual(Paper.objects.count(), 0)\n3760.         # Emulate model instance creation via the admin\n3761.         post_data = {\n3762.             "title": "My Modified Paper Title",\n3763.             "_save": "Save",\n3764.         }\n3765.         response = self.client.post(reverse(\'admin:admin_views_paper_add\'), post_data, follow=True)\n3766.         self.assertEqual(response.status_code, 200)\n3767.         self.assertEqual(Paper.objects.count(), 1)\n3768.         # Message should contain non-ugly model verbose name\n3769.         p = Paper.objects.all()[0]\n3770.         self.assertContains(\n3771.             response,\n3772.             \'<li class="success">The paper "<a href="%s">\'\n3773.             \'%s</a>" was added successfully.</li>\' %\n3774.             (reverse(\'admin:admin_views_paper_change\', args=(p.pk,)), p), html=True\n3775.         )\n3776. \n3777.     def test_edit_model_modeladmin_defer_qs(self):\n3778.         # Test for #14529. defer() is used in ModelAdmin.get_queryset()\n3779. \n3780.         # model has __str__ method\n3781.         cl = CoverLetter.objects.create(author="John Doe")\n3782.         self.assertEqual(CoverLetter.objects.count(), 1)\n3783.         response = self.client.get(reverse(\'admin:admin_views_coverletter_change\', args=(cl.pk,)))\n3784.         self.assertEqual(response.status_code, 200)\n3785.         # Emulate model instance edit via the admin\n3786.         post_data = {\n3787.             "author": "John Doe II",\n3788.             "_save": "Save",\n3789.         }\n3790.         url = reverse(\'admin:admin_views_coverletter_change\', args=(cl.pk,))\n3791.         response = self.client.post(url, post_data, follow=True)\n3792.         self.assertEqual(response.status_code, 200)\n3793.         self.assertEqual(CoverLetter.objects.count(), 1)\n3794.         # Message should contain non-ugly model verbose name. Instance\n3795.         # representation is set by model\'s __str__()\n3796.         self.assertContains(\n3797.             response,\n3798.             \'<li class="success">The cover letter "<a href="%s">\'\n3799.             \'John Doe II</a>" was changed successfully.</li>\' %\n3800.             reverse(\'admin:admin_views_coverletter_change\', args=(cl.pk,)), html=True\n3801.         )\n3802. \n3803.         # model has no __str__ method\n3804.         sm = ShortMessage.objects.create(content="This is expensive")\n3805.         self.assertEqual(ShortMessage.objects.count(), 1)\n3806.         response = self.client.get(reverse(\'admin:admin_views_shortmessage_change\', args=(sm.pk,)))\n3807.         self.assertEqual(response.status_code, 200)\n3808.         # Emulate model instance edit via the admin\n3809.         post_data = {\n3810.             "content": "Too expensive",\n3811.             "_save": "Save",\n3812.         }\n3813.         url = reverse(\'admin:admin_views_shortmessage_change\', args=(sm.pk,))\n3814.         response = self.client.post(url, post_data, follow=True)\n3815.         self.assertEqual(response.status_code, 200)\n3816.         self.assertEqual(ShortMessage.objects.count(), 1)\n3817.         # Message should contain non-ugly model verbose name. The ugly(!)\n3818.         # instance representation is set by __str__().\n3819.         self.assertContains(\n3820.             response,\n3821.             \'<li class="success">The short message "<a href="%s">\'\n3822.             \'%s</a>" was changed successfully.</li>\' %\n3823.             (reverse(\'admin:admin_views_shortmessage_change\', args=(sm.pk,)), sm), html=True\n3824.         )\n3825. \n3826.     def test_edit_model_modeladmin_only_qs(self):\n3827.         # Test for #14529. only() is used in ModelAdmin.get_queryset()\n3828. \n3829.         # model has __str__ method\n3830.         t = Telegram.objects.create(title="First Telegram")\n3831.         self.assertEqual(Telegram.objects.count(), 1)\n3832.         response = self.client.get(reverse(\'admin:admin_views_telegram_change\', args=(t.pk,)))\n3833.         self.assertEqual(response.status_code, 200)\n3834.         # Emulate model instance edit via the admin\n3835.         post_data = {\n3836.             "title": "Telegram without typo",\n3837.             "_save": "Save",\n3838.         }\n3839.         response = self.client.post(reverse(\'admin:admin_views_telegram_change\', args=(t.pk,)), post_data, follow=True)\n3840.         self.assertEqual(response.status_code, 200)\n3841.         self.assertEqual(Telegram.objects.count(), 1)\n3842.         # Message should contain non-ugly model verbose name. The instance\n3843.         # representation is set by model\'s __str__()\n3844.         self.assertContains(\n3845.             response,\n3846.             \'<li class="success">The telegram "<a href="%s">\'\n3847.             \'Telegram without typo</a>" was changed successfully.</li>\' %\n3848.             reverse(\'admin:admin_views_telegram_change\', args=(t.pk,)), html=True\n3849.         )\n3850. \n3851.         # model has no __str__ method\n3852.         p = Paper.objects.create(title="My Paper Title")\n3853.         self.assertEqual(Paper.objects.count(), 1)\n3854.         response = self.client.get(reverse(\'admin:admin_views_paper_change\', args=(p.pk,)))\n3855.         self.assertEqual(response.status_code, 200)\n3856.         # Emulate model instance edit via the admin\n3857.         post_data = {\n3858.             "title": "My Modified Paper Title",\n3859.             "_save": "Save",\n3860.         }\n3861.         response = self.client.post(reverse(\'admin:admin_views_paper_change\', args=(p.pk,)), post_data, follow=True)\n3862.         self.assertEqual(response.status_code, 200)\n3863.         self.assertEqual(Paper.objects.count(), 1)\n3864.         # Message should contain non-ugly model verbose name. The ugly(!)\n3865.         # instance representation is set by __str__().\n3866.         self.assertContains(\n3867.             response,\n3868.             \'<li class="success">The paper "<a href="%s">\'\n3869.             \'%s</a>" was changed successfully.</li>\' %\n3870.             (reverse(\'admin:admin_views_paper_change\', args=(p.pk,)), p), html=True\n3871.         )\n3872. \n3873.     def test_history_view_custom_qs(self):\n3874.         """\n3875.         Custom querysets are considered for the admin history view.\n3876.         """\n3877.         self.client.post(reverse(\'admin:login\'), self.super_login)\n3878.         FilteredManager.objects.create(pk=1)\n3879.         FilteredManager.objects.create(pk=2)\n3880.         response = self.client.get(reverse(\'admin:admin_views_filteredmanager_changelist\'))\n3881.         self.assertContains(response, "PK=1")\n3882.         self.assertContains(response, "PK=2")\n3883.         self.assertEqual(\n3884.             self.client.get(reverse(\'admin:admin_views_filteredmanager_history\', args=(1,))).status_code, 200\n3885.         )\n3886.         self.assertEqual(\n3887.             self.client.get(reverse(\'admin:admin_views_filteredmanager_history\', args=(2,))).status_code, 200\n3888.         )\n3889. \n3890. ', start_line_number=3631, end_line_number=3890), Context(relative_path='tests/admin_views/tests.py', content='1138. @override_settings(ROOT_URLCONF=\'admin_views.urls\')\n1139. class AdminViewFormUrlTest(TestCase):\n1140.     current_app = "admin3"\n1141. \n1142.     @classmethod\n1143.     def setUpTestData(cls):\n1144.         cls.superuser = User.objects.create_superuser(username=\'super\', password=\'secret\', email=\'super@example.com\')\n1145.         cls.s1 = Section.objects.create(name=\'Test section\')\n1146.         cls.a1 = Article.objects.create(\n1147.             content=\'<p>Middle content</p>\', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1\n1148.         )\n1149.         cls.a2 = Article.objects.create(\n1150.             content=\'<p>Oldest content</p>\', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1\n1151.         )\n1152.         cls.a3 = Article.objects.create(\n1153.             content=\'<p>Newest content</p>\', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1\n1154.         )\n1155.         cls.p1 = PrePopulatedPost.objects.create(title=\'A Long Title\', published=True, slug=\'a-long-title\')\n1156. \n1157.     def setUp(self):\n1158.         self.client.force_login(self.superuser)\n1159. \n1160.     def test_change_form_URL_has_correct_value(self):\n1161.         """\n1162.         change_view has form_url in response.context\n1163.         """\n1164.         response = self.client.get(\n1165.             reverse(\'admin:admin_views_section_change\', args=(self.s1.pk,), current_app=self.current_app)\n1166.         )\n1167.         self.assertIn(\'form_url\', response.context, msg=\'form_url not present in response.context\')\n1168.         self.assertEqual(response.context[\'form_url\'], \'pony\')\n1169. \n1170.     def test_initial_data_can_be_overridden(self):\n1171.         """\n1172.         The behavior for setting initial form data can be overridden in the\n1173.         ModelAdmin class. Usually, the initial value is set via the GET params.\n1174.         """\n1175.         response = self.client.get(\n1176.             reverse(\'admin:admin_views_restaurant_add\', current_app=self.current_app),\n1177.             {\'name\': \'test_value\'}\n1178.         )\n1179.         # this would be the usual behaviour\n1180.         self.assertNotContains(response, \'value="test_value"\')\n1181.         # this is the overridden behaviour\n1182.         self.assertContains(response, \'value="overridden_value"\')\n1183. ', start_line_number=1138, end_line_number=1183), Context(relative_path='tests/admin_views/tests.py', content='3587. class TestCustomChangeList(TestCase):\n3588. \n3589.     @classmethod\n3590.     def setUpTestData(cls):\n3591.         cls.superuser = User.objects.create_superuser(username=\'super\', password=\'secret\', email=\'super@example.com\')\n3592. \n3593.     def setUp(self):\n3594.         self.client.force_login(self.superuser)\n3595. \n3596.     def test_custom_changelist(self):\n3597.         """\n3598.         Validate that a custom ChangeList class can be used (#9749)\n3599.         """\n3600.         # Insert some data\n3601.         post_data = {"name": "First Gadget"}\n3602.         response = self.client.post(reverse(\'admin:admin_views_gadget_add\'), post_data)\n3603.         self.assertEqual(response.status_code, 302)  # redirect somewhere\n3604.         # Hit the page once to get messages out of the queue message list\n3605.         response = self.client.get(reverse(\'admin:admin_views_gadget_changelist\'))\n3606.         # Data is still not visible on the page\n3607.         response = self.client.get(reverse(\'admin:admin_views_gadget_changelist\'))\n3608.         self.assertEqual(response.status_code, 200)\n3609.         self.assertNotContains(response, \'First Gadget\')\n3610. \n3611. ', start_line_number=3587, end_line_number=3611), Context(relative_path='tests/admin_views/tests.py', content='2501. @skipUnlessDBFeature(\'can_defer_constraint_checks\')\n2502. @override_settings(ROOT_URLCONF=\'admin_views.urls\')\n2503. class AdminViewDeletedObjectsTest(TestCase):\n2504. \n2505.     @classmethod\n2506.     def setUpTestData(cls):\n2507.         cls.superuser = User.objects.create_superuser(username=\'super\', password=\'secret\', email=\'super@example.com\')\n2508.         cls.deleteuser = User.objects.create_user(username=\'deleteuser\', password=\'secret\', is_staff=True)\n2509.         cls.s1 = Section.objects.create(name=\'Test section\')\n2510.         cls.a1 = Article.objects.create(\n2511.             content=\'<p>Middle content</p>\', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1\n2512.         )\n2513.         cls.a2 = Article.objects.create(\n2514.             content=\'<p>Oldest content</p>\', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1\n2515.         )\n2516.         cls.a3 = Article.objects.create(\n2517.             content=\'<p>Newest content</p>\', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1\n2518.         )\n2519.         cls.p1 = PrePopulatedPost.objects.create(title=\'A Long Title\', published=True, slug=\'a-long-title\')\n2520. \n2521.         cls.v1 = Villain.objects.create(name=\'Adam\')\n2522.         cls.v2 = Villain.objects.create(name=\'Sue\')\n2523.         cls.sv1 = SuperVillain.objects.create(name=\'Bob\')\n2524.         cls.pl1 = Plot.objects.create(name=\'World Domination\', team_leader=cls.v1, contact=cls.v2)\n2525.         cls.pl2 = Plot.objects.create(name=\'World Peace\', team_leader=cls.v2, contact=cls.v2)\n2526.         cls.pl3 = Plot.objects.create(name=\'Corn Conspiracy\', team_leader=cls.v1, contact=cls.v1)\n2527.         cls.pd1 = PlotDetails.objects.create(details=\'almost finished\', plot=cls.pl1)\n2528.         cls.sh1 = SecretHideout.objects.create(location=\'underground bunker\', villain=cls.v1)\n2529.         cls.sh2 = SecretHideout.objects.create(location=\'floating castle\', villain=cls.sv1)\n2530.         cls.ssh1 = SuperSecretHideout.objects.create(location=\'super floating castle!\', supervillain=cls.sv1)\n2531.         cls.cy1 = CyclicOne.objects.create(name=\'I am recursive\', two_id=1)\n2532.         cls.cy2 = CyclicTwo.objects.create(name=\'I am recursive too\', one_id=1)\n2533. \n2534.     def setUp(self):\n2535.         self.client.force_login(self.superuser)\n2536. \n2537.     def test_nesting(self):\n2538.         """\n2539.         Objects should be nested to display the relationships that\n2540.         cause them to be scheduled for deletion.\n2541.         """\n2542.         pattern = re.compile(\n2543.             r\'<li>Plot: <a href="%s">World Domination</a>\\s*<ul>\\s*\'\n2544.             r\'<li>Plot details: <a href="%s">almost finished</a>\' % (\n2545.                 reverse(\'admin:admin_views_plot_change\', args=(self.pl1.pk,)),\n2546.                 reverse(\'admin:admin_views_plotdetails_change\', args=(self.pd1.pk,)),\n2547.             )\n2548.         )\n2549.         response = self.client.get(reverse(\'admin:admin_views_villain_delete\', args=(self.v1.pk,)))\n2550.         self.assertRegex(response.content.decode(), pattern)\n2551. \n2552.     def test_cyclic(self):\n2553.         """\n2554.         Cyclic relationships should still cause each object to only be\n2555.         listed once.\n2556.         """\n2557.         one = \'<li>Cyclic one: <a href="%s">I am recursive</a>\' % (\n2558.             reverse(\'admin:admin_views_cyclicone_change\', args=(self.cy1.pk,)),\n2559.         )\n2560.         two = \'<li>Cyclic two: <a href="%s">I am recursive too</a>\' % (\n2561.             reverse(\'admin:admin_views_cyclictwo_change\', args=(self.cy2.pk,)),\n2562.         )\n2563.         response = self.client.get(reverse(\'admin:admin_views_cyclicone_delete\', args=(self.cy1.pk,)))\n2564. \n2565.         self.assertContains(response, one, 1)\n2566.         self.assertContains(response, two, 1)\n2567. \n2568.     def test_perms_needed(self):\n2569.         self.client.logout()\n2570.         delete_user = User.objects.get(username=\'deleteuser\')\n2571.         delete_user.user_permissions.add(get_perm(Plot, get_permission_codename(\'delete\', Plot._meta)))\n2572. \n2573.         self.client.force_login(self.deleteuser)\n2574.         response = self.client.get(reverse(\'admin:admin_views_plot_delete\', args=(self.pl1.pk,)))\n2575.         self.assertContains(response, "your account doesn\'t have permission to delete the following types of objects")\n2576.         self.assertContains(response, "<li>plot details</li>")\n2577. \n2578.     def test_protected(self):\n2579.         q = Question.objects.create(question="Why?")\n2580.         a1 = Answer.objects.create(question=q, answer="Because.")\n2581.         a2 = Answer.objects.create(question=q, answer="Yes.")\n2582. \n2583.         response = self.client.get(reverse(\'admin:admin_views_question_delete\', args=(q.pk,)))\n2584.         self.assertContains(response, "would require deleting the following protected related objects")\n2585.         self.assertContains(\n2586.             response,\n2587.             \'<li>Answer: <a href="%s">Because.</a></li>\' % reverse(\'admin:admin_views_answer_change\', args=(a1.pk,))\n2588.         )\n2589.         self.assertContains(\n2590.             response,\n2591.             \'<li>Answer: <a href="%s">Yes.</a></li>\' % reverse(\'admin:admin_views_answer_change\', args=(a2.pk,))\n2592.         )\n2593. \n2594.     def test_post_delete_protected(self):\n2595.         """\n2596.         A POST request to delete protected objects should display the page\n2597.         which says the deletion is prohibited.\n2598.         """\n2599.         q = Question.objects.create(question=\'Why?\')\n2600.         Answer.objects.create(question=q, answer=\'Because.\')\n2601. \n2602.         response = self.client.post(reverse(\'admin:admin_views_question_delete\', args=(q.pk,)), {\'post\': \'yes\'})\n2603.         self.assertEqual(Question.objects.count(), 1)\n2604.         self.assertContains(response, "would require deleting the following protected related objects")\n2605. \n2606.     def test_not_registered(self):\n2607.         should_contain = """<li>Secret hideout: underground bunker"""\n2608.         response = self.client.get(reverse(\'admin:admin_views_villain_delete\', args=(self.v1.pk,)))\n2609.         self.assertContains(response, should_contain, 1)\n2610. \n2611.     def test_multiple_fkeys_to_same_model(self):\n2612.         """\n2613.         If a deleted object has two relationships from another model,\n2614.         both of those should be followed in looking for related\n2615.         objects to delete.\n2616.         """\n2617.         should_contain = \'<li>Plot: <a href="%s">World Domination</a>\' % reverse(\n2618.             \'admin:admin_views_plot_change\', args=(self.pl1.pk,)\n2619.         )\n2620.         response = self.client.get(reverse(\'admin:admin_views_villain_delete\', args=(self.v1.pk,)))\n2621.         self.assertContains(response, should_contain)\n2622.         response = self.client.get(reverse(\'admin:admin_views_villain_delete\', args=(self.v2.pk,)))\n2623.         self.assertContains(response, should_contain)\n2624. \n2625.     def test_multiple_fkeys_to_same_instance(self):\n2626.         """\n2627.         If a deleted object has two relationships pointing to it from\n2628.         another object, the other object should still only be listed\n2629.         once.\n2630.         """\n2631.         should_contain = \'<li>Plot: <a href="%s">World Peace</a></li>\' % reverse(\n2632.             \'admin:admin_views_plot_change\', args=(self.pl2.pk,)\n2633.         )\n2634.         response = self.client.get(reverse(\'admin:admin_views_villain_delete\', args=(self.v2.pk,)))\n2635.         self.assertContains(response, should_contain, 1)\n2636. \n2637.     def test_inheritance(self):\n2638.         """\n2639.         In the case of an inherited model, if either the child or\n2640.         parent-model instance is deleted, both instances are listed\n2641.         for deletion, as well as any relationships they have.\n2642.         """\n2643.         should_contain = [\n2644.             \'<li>Villain: <a href="%s">Bob</a>\' % reverse(\'admin:admin_views_villain_change\', args=(self.sv1.pk,)),\n2645.             \'<li>Super villain: <a href="%s">Bob</a>\' % reverse(\n2646.                 \'admin:admin_views_supervillain_change\', args=(self.sv1.pk,)\n2647.             ),\n2648.             \'<li>Secret hideout: floating castle\',\n2649.             \'<li>Super secret hideout: super floating castle!\',\n2650.         ]\n2651.         response = self.client.get(reverse(\'admin:admin_views_villain_delete\', args=(self.sv1.pk,)))\n2652.         for should in should_contain:\n2653.             self.assertContains(response, should, 1)\n2654.         response = self.client.get(reverse(\'admin:admin_views_supervillain_delete\', args=(self.sv1.pk,)))\n2655.         for should in should_contain:\n2656.             self.assertContains(response, should, 1)\n2657. \n2658.     def test_generic_relations(self):\n2659.         """\n2660.         If a deleted object has GenericForeignKeys pointing to it,\n2661.         those objects should be listed for deletion.\n2662.         """\n2663.         plot = self.pl3\n2664.         tag = FunkyTag.objects.create(content_object=plot, name=\'hott\')\n2665.         should_contain = \'<li>Funky tag: <a href="%s">hott\' % reverse(\n2666.             \'admin:admin_views_funkytag_change\', args=(tag.id,))\n2667.         response = self.client.get(reverse(\'admin:admin_views_plot_delete\', args=(plot.pk,)))\n2668.         self.assertContains(response, should_contain)\n2669. \n2670.     def test_generic_relations_with_related_query_name(self):\n2671.         """\n2672.         If a deleted object has GenericForeignKey with\n2673.         GenericRelation(related_query_name=\'...\') pointing to it, those objects\n2674.         should be listed for deletion.\n2675.         """\n2676.         bookmark = Bookmark.objects.create(name=\'djangoproject\')\n2677.         tag = FunkyTag.objects.create(content_object=bookmark, name=\'django\')\n2678.         tag_url = reverse(\'admin:admin_views_funkytag_change\', args=(tag.id,))\n2679.         should_contain = \'<li>Funky tag: <a href="%s">django\' % tag_url\n2680.         response = self.client.get(reverse(\'admin:admin_views_bookmark_delete\', args=(bookmark.pk,)))\n2681.         self.assertContains(response, should_contain)\n2682. \n2683.     def test_delete_view_uses_get_deleted_objects(self):\n2684.         """The delete view uses ModelAdmin.get_deleted_objects()."""\n2685.         book = Book.objects.create(name=\'Test Book\')\n2686.         response = self.client.get(reverse(\'admin2:admin_views_book_delete\', args=(book.pk,)))\n2687.         # BookAdmin.get_deleted_objects() returns custom text.\n2688.         self.assertContains(response, \'a deletable object\')\n2689. \n2690. ', start_line_number=2501, end_line_number=2690)]
2025-10-06 21:08:43,120 - thread-139660780025408.app.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-10-06 21:08:43,121 - thread-139660780025408.app.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── bin
|   |   └── django-admin.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── bin
|   |   |   |   └── compress.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   ├── options.py
|   |   |   |   └── widgets.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── mn
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sv
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── templates
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── memcached.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   └── __init__.py
|   |   |   ├── database.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── utils.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   ├── special.py
|   |   |   |   └── utils.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── autoreload.py
|   |   ├── baseconv.py
|   |   ├── cache.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── datetime_safe.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── topological_sort.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           └── technical_500.txt
├── docs
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   └── static
|   |   |       └── fontawesome
|   |   └── djangodocs-epub
|   |       └── static
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── auth-remote-user.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-tags.txt
|   |   ├── deployment
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── jython.txt
|   |   ├── legacy-databases.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.19.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.20.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.11.txt
|   |   ├── 2.0.12.txt
|   |   ├── 2.0.13.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.7.txt
|   |   ├── 2.1.8.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.1.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.txt
|   |   ├── index.txt
|   |   └── security.txt
|   └── topics
|       ├── _images
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── RelatedObjectLookups.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   └── jsi18n-mocks.test.js
|   ├── gis
|   |   └── mapwidget.test.js
|   └── qunit
|       └── qunit.js
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_dynamic_settings_manage.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   └── commands
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       └── noargs_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   └── admin
    |   |       └── admin_views
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_forms.py
    |   ├── test_multidb.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── default_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   └── with_last_login_attr.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   └── registration
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_remote_user.py
    |   ├── test_remote_user_deprecation.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── test_base.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_introspection.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   └── commands
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   └── tests.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   └── tests.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_error_handlers.py
    |       ├── beginning_with_slash.py
    |       ├── contains_tuple.py
    |       ├── good_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   └── ending_with_dollar.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_greatest.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_round.py
    |   |   ├── test_sign.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_md5.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_sha1.py
    |   |   ├── test_sha224.py
    |   |   ├── test_sha256.py
    |   |   ├── test_sha384.py
    |   |   ├── test_sha512.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   └── test_postgresql.py
    ├── decorators
    |   ├── __init__.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_deprecation.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   └── registration
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   └── robots.txt
    |   |   └── registration
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── has_nulls
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   └── test_srs.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── admin.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── maps
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   └── javascript_ignored.js
    |   |   └── templates
    |   |       └── subdir
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── models.py
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── integration_settings.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_constraints.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_integration.py
    |   ├── test_introspection.py
    |   ├── test_json.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests
    |   ├── __init__.py
    |   ├── test_data_upload_settings.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   ├── test_file_charset.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   ├── templates
    |   |   └── shortcuts
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   ├── test_management.py
    |   ├── test_utils.py
    |   └── urls
    |       ├── __init__.py
    |       ├── empty.py
    |       ├── http.py
    |       ├── https.py
    |       └── index_only.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── cached
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   ├── loop
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   ├── jinja2
    |   |   └── template_backends
    |   ├── template_strings
    |   |   └── template_backends
    |   ├── templates
    |   |   └── template_backends
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   ├── templates
    |   |   └── template_loader
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   ├── other_templates
    |   |   └── priority
    |   ├── recursive_templates
    |   |   ├── fs
    |   |   ├── fs2
    |   |   └── fs3
    |   ├── relative_templates
    |   |   └── dir1
    |   |       └── dir2
    |   ├── syntax_tests
    |   |   ├── __init__.py
    |   |   ├── i18n
    |   |   |   ├── __init__.py
    |   |   |   ├── base.py
    |   |   |   ├── test_blocktrans.py
    |   |   |   ├── test_filters.py
    |   |   |   ├── test_get_available_languages.py
    |   |   |   ├── test_get_current_language.py
    |   |   |   ├── test_get_current_language_bidi.py
    |   |   |   ├── test_get_language_info.py
    |   |   |   ├── test_get_language_info_list.py
    |   |   |   ├── test_language.py
    |   |   |   ├── test_trans.py
    |   |   |   └── test_underscore_syntax.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_basic.py
    |   |   ├── test_builtins.py
    |   |   ├── test_cache.py
    |   |   ├── test_comment.py
    |   |   ├── test_cycle.py
    |   |   ├── test_exceptions.py
    |   |   ├── test_extends.py
    |   |   ├── test_filter_syntax.py
    |   |   ├── test_filter_tag.py
    |   |   ├── test_firstof.py
    |   |   ├── test_for.py
    |   |   ├── test_if.py
    |   |   ├── test_if_changed.py
    |   |   ├── test_if_equal.py
    |   |   ├── test_include.py
    |   |   ├── test_invalid_string.py
    |   |   ├── test_list_index.py
    |   |   ├── test_load.py
    |   |   ├── test_lorem.py
    |   |   ├── test_multiline.py
    |   |   ├── test_named_endblock.py
    |   |   ├── test_now.py
    |   |   ├── test_numpy.py
    |   |   ├── test_regroup.py
    |   |   ├── test_resetcycle.py
    |   |   ├── test_setup.py
    |   |   ├── test_simple_tag.py
    |   |   ├── test_spaceless.py
    |   |   ├── test_static.py
    |   |   ├── test_template_tag.py
    |   |   ├── test_url.py
    |   |   ├── test_verbatim.py
    |   |   ├── test_width_ratio.py
    |   |   └── test_with.py
    |   ├── templates
    |   |   ├── first
    |   |   ├── priority
    |   |   ├── second
    |   |   └── template_tests
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   ├── bad_tag.py
    |   |   ├── custom.py
    |   |   ├── inclusion.py
    |   |   ├── subpackage
    |   |   |   ├── __init__.py
    |   |   |   └── echo.py
    |   |   ├── tag_27584.py
    |   |   └── testtags.py
    |   ├── test_base.py
    |   ├── test_callables.py
    |   ├── test_context.py
    |   ├── test_custom.py
    |   ├── test_engine.py
    |   ├── test_extends.py
    |   ├── test_extends_relative.py
    |   ├── test_library.py
    |   ├── test_loaders.py
    |   ├── test_logging.py
    |   ├── test_nodelist.py
    |   ├── test_origin.py
    |   ├── test_parser.py
    |   ├── test_response.py
    |   ├── test_smartif.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── utils.py
    |   └── views.py
    ├── templates
    |   ├── comments
    |   |   └── comment_notification_email.txt
    |   ├── custom_admin
    |   └── views
    ├── test_client
    |   ├── __init__.py
    |   ├── auth_backends.py
    |   ├── test_conditional_content_removal.py
    |   ├── test_fakepayload.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── test_client_regress
    |   ├── __init__.py
    |   ├── auth_backends.py
    |   ├── bad_templates
    |   ├── context_processors.py
    |   ├── models.py
    |   ├── session.py
    |   ├── templates
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── test_exceptions
    |   ├── __init__.py
    |   └── test_validation_error.py
    ├── test_runner
    |   ├── __init__.py
    |   ├── models.py
    |   ├── runner.py
    |   ├── test_debug_sql.py
    |   ├── test_discover_runner.py
    |   ├── test_parallel.py
    |   └── tests.py
    ├── test_runner_apps
    |   ├── __init__.py
    |   ├── databases
    |   |   ├── __init__.py
    |   |   └── tests.py
    |   ├── sample
    |   |   ├── __init__.py
    |   |   ├── doctests.py
    |   |   ├── empty.py
    |   |   ├── pattern_tests.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── tests.py
    |   |   └── tests_sample.py
    |   ├── simple
    |   |   ├── __init__.py
    |   |   └── tests.py
    |   └── tagged
    |       ├── __init__.py
    |       ├── tests.py
    |       └── tests_inheritance.py
    ├── test_sqlite.py
    ├── test_utils
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── templates
    |   |   └── template_used
    |   ├── test_deprecated_features.py
    |   ├── test_testcase.py
    |   ├── test_transactiontestcase.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── timezones
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── transaction_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── transactions
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── unmanaged_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── update_only_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── urlpatterns
    |   ├── __init__.py
    |   ├── converter_urls.py
    |   ├── converters.py
    |   ├── included_urls.py
    |   ├── more_urls.py
    |   ├── path_base64_urls.py
    |   ├── path_dynamic_urls.py
    |   ├── path_urls.py
    |   ├── test_resolvers.py
    |   ├── tests.py
    |   └── views.py
    ├── urlpatterns_reverse
    |   ├── __init__.py
    |   ├── erroneous_urls.py
    |   ├── extra_urls.py
    |   ├── included_app_urls.py
    |   ├── included_named_urls.py
    |   ├── included_named_urls2.py
    |   ├── included_namespace_urls.py
    |   ├── included_no_kwargs_urls.py
    |   ├── included_urls.py
    |   ├── included_urls2.py
    |   ├── method_view_urls.py
    |   ├── middleware.py
    |   ├── named_urls.py
    |   ├── named_urls_conflict.py
    |   ├── namespace_urls.py
    |   ├── nested_urls.py
    |   ├── no_urls.py
    |   ├── nonimported_module.py
    |   ├── reverse_lazy_urls.py
    |   ├── test_localeregexdescriptor.py
    |   ├── tests.py
    |   ├── translations
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── urlconf_inner.py
    |   ├── urlconf_outer.py
    |   ├── urls.py
    |   ├── urls_error_handlers.py
    |   ├── urls_error_handlers_callables.py
    |   ├── urls_without_handlers.py
    |   ├── utils.py
    |   ├── views.py
    |   └── views_broken.py
    ├── urls.py
    ├── user_commands
    |   ├── __init__.py
    |   ├── eggs
    |   ├── management
    |   |   └── commands
    |   |       ├── common_args.py
    |   |       ├── dance.py
    |   |       ├── hal.py
    |   |       ├── no_translations.py
    |   |       ├── required_option.py
    |   |       ├── reverse_url.py
    |   |       ├── set_option.py
    |   |       ├── subparser.py
    |   |       └── transaction.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── utils_tests
    |   ├── __init__.py
    |   ├── archives
    |   ├── eggs
    |   ├── files
    |   |   └── strip_tags2.txt
    |   ├── models.py
    |   ├── test_archive.py
    |   ├── test_autoreload.py
    |   ├── test_baseconv.py
    |   ├── test_crypto.py
    |   ├── test_datastructures.py
    |   ├── test_dateformat.py
    |   ├── test_dateparse.py
    |   ├── test_datetime_safe.py
    |   ├── test_decorators.py
    |   ├── test_duration.py
    |   ├── test_encoding.py
    |   ├── test_encoding_deprecations.py
    |   ├── test_feedgenerator.py
    |   ├── test_functional.py
    |   ├── test_hashable.py
    |   ├── test_html.py
    |   ├── test_http.py
    |   ├── test_inspect.py
    |   ├── test_ipv6.py
    |   ├── test_jslex.py
    |   ├── test_lazyobject.py
    |   ├── test_lorem_ipsum.py
    |   ├── test_module
    |   |   ├── __init__.py
    |   |   ├── another_bad_module.py
    |   |   ├── another_good_module.py
    |   |   ├── bad_module.py
    |   |   ├── child_module
    |   |   |   ├── __init__.py
    |   |   |   └── grandchild_module.py
    |   |   └── good_module.py
    |   ├── test_module_loading.py
    |   ├── test_no_submodule.py
    |   ├── test_numberformat.py
    |   ├── test_os_utils.py
    |   ├── test_regex_helper.py
    |   ├── test_safestring.py
    |   ├── test_simplelazyobject.py
    |   ├── test_termcolors.py
    |   ├── test_text.py
    |   ├── test_timesince.py
    |   ├── test_timezone.py
    |   ├── test_topological_sort.py
    |   └── test_tree.py
    ├── validation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_custom_messages.py
    |   ├── test_error_messages.py
    |   ├── test_picklable.py
    |   ├── test_unique.py
    |   ├── test_validators.py
    |   └── tests.py
    ├── validators
    |   ├── __init__.py
    |   ├── invalid_urls.txt
    |   ├── tests.py
    |   └── valid_urls.txt
    ├── version
    |   ├── __init__.py
    |   └── tests.py
    ├── view_tests
    |   ├── __init__.py
    |   ├── app0
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── en
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── fr
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── fr
    |   ├── app3
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── es_AR
    |   ├── app4
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── es_AR
    |   ├── app5
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── fr
    |   ├── default_urls.py
    |   ├── generic_urls.py
    |   ├── locale
    |   |   ├── de
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_GB
    |   |   |   └── LC_MESSAGES
    |   |   ├── es
    |   |   |   └── LC_MESSAGES
    |   |   ├── fr
    |   |   |   └── LC_MESSAGES
    |   |   ├── nl
    |   |   |   └── LC_MESSAGES
    |   |   ├── pt
    |   |   |   └── LC_MESSAGES
    |   |   └── ru
    |   |       └── LC_MESSAGES
    |   ├── media
    |   |   ├── %2F.txt
    |   |   ├── file.txt
    |   |   ├── long-line.txt
    |   |   └── subdir
    |   ├── models.py
    |   ├── regression_21530_urls.py
    |   ├── templates
    |   |   └── debug
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   └── debugtags.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_csrf.py
    |   |   ├── test_debug.py
    |   |   ├── test_defaults.py
    |   |   ├── test_i18n.py
    |   |   ├── test_json.py
    |   |   ├── test_specials.py
    |   |   └── test_static.py
    |   ├── urls.py
    |   └── views.py
    └── wsgi
        ├── __init__.py
        ├── tests.py
        ├── urls.py
        └── wsgi.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
add ModelAdmin.get_inlines() hook to allow set inlines based on the request or model instance.

Issue description: 
Description
	
add ModelAdmin.get_inlines() hook to allow set inlines based on the request or model instance.
Currently, We can override the method get_inline_instances to do such a thing, but a for loop should be copied to my code. So I wished add a hook get_inlines(request, obj=None)

Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: tests/admin_inlines/tests.py
Line number range: 338 - 372
Content:
338.     def test_custom_min_num(self):
339.         bt_head = BinaryTree.objects.create(name="Tree Head")
340.         BinaryTree.objects.create(name="First Child", parent=bt_head)
341. 
342.         class MinNumInline(TabularInline):
343.             model = BinaryTree
344.             extra = 3
345. 
346.             def get_min_num(self, request, obj=None, **kwargs):
347.                 if obj:
348.                     return 5
349.                 return 2
350. 
351.         modeladmin = ModelAdmin(BinaryTree, admin_site)
352.         modeladmin.inlines = [MinNumInline]
353.         min_forms = (
354.             '<input id="id_binarytree_set-MIN_NUM_FORMS" '
355.             'name="binarytree_set-MIN_NUM_FORMS" type="hidden" value="%d">'
356.         )
357.         total_forms = (
358.             '<input id="id_binarytree_set-TOTAL_FORMS" '
359.             'name="binarytree_set-TOTAL_FORMS" type="hidden" value="%d">'
360.         )
361.         request = self.factory.get(reverse('admin:admin_inlines_binarytree_add'))
362.         request.user = User(username='super', is_superuser=True)
363.         response = modeladmin.changeform_view(request)
364.         self.assertInHTML(min_forms % 2, response.rendered_content)
365.         self.assertInHTML(total_forms % 5, response.rendered_content)
366. 
367.         request = self.factory.get(reverse('admin:admin_inlines_binarytree_change', args=(bt_head.id,)))
368.         request.user = User(username='super', is_superuser=True)
369.         response = modeladmin.changeform_view(request, object_id=str(bt_head.id))
370.         self.assertInHTML(min_forms % 5, response.rendered_content)
371.         self.assertInHTML(total_forms % 8, response.rendered_content)
372. 


File: tests/admin_inlines/tests.py
Line number range: 291 - 312
Content:
291.     def test_custom_get_extra_form(self):
292.         bt_head = BinaryTree.objects.create(name="Tree Head")
293.         BinaryTree.objects.create(name="First Child", parent=bt_head)
294.         # The maximum number of forms should respect 'get_max_num' on the
295.         # ModelAdmin
296.         max_forms_input = (
297.             '<input id="id_binarytree_set-MAX_NUM_FORMS" '
298.             'name="binarytree_set-MAX_NUM_FORMS" type="hidden" value="%d">'
299.         )
300.         # The total number of forms will remain the same in either case
301.         total_forms_hidden = (
302.             '<input id="id_binarytree_set-TOTAL_FORMS" '
303.             'name="binarytree_set-TOTAL_FORMS" type="hidden" value="2">'
304.         )
305.         response = self.client.get(reverse('admin:admin_inlines_binarytree_add'))
306.         self.assertInHTML(max_forms_input % 3, response.rendered_content)
307.         self.assertInHTML(total_forms_hidden, response.rendered_content)
308. 
309.         response = self.client.get(reverse('admin:admin_inlines_binarytree_change', args=(bt_head.id,)))
310.         self.assertInHTML(max_forms_input % 2, response.rendered_content)
311.         self.assertInHTML(total_forms_hidden, response.rendered_content)
312. 


File: tests/admin_inlines/tests.py
Line number range: 154 - 166
Content:
154.     def test_callable_lookup(self):
155.         """Admin inline should invoke local callable when its name is listed in readonly_fields"""
156.         response = self.client.get(reverse('admin:admin_inlines_poll_add'))
157.         self.assertEqual(response.status_code, 200)
158.         # Add parent object view should have the child inlines section
159.         self.assertContains(
160.             response,
161.             '<div class="js-inline-admin-formset inline-group" id="question_set-group"'
162.         )
163.         # The right callable should be used for the inline readonly_fields
164.         # column cells
165.         self.assertContains(response, '<p>Callable in QuestionInline</p>')
166. 


File: tests/admin_inlines/tests.py
Line number range: 433 - 447
Content:
433.     def test_inlines_show_change_link_registered(self):
434.         "Inlines `show_change_link` for registered models when enabled."
435.         holder = Holder4.objects.create(dummy=1)
436.         item1 = Inner4Stacked.objects.create(dummy=1, holder=holder)
437.         item2 = Inner4Tabular.objects.create(dummy=1, holder=holder)
438.         items = (
439.             ('inner4stacked', item1.pk),
440.             ('inner4tabular', item2.pk),
441.         )
442.         response = self.client.get(reverse('admin:admin_inlines_holder4_change', args=(holder.pk,)))
443.         self.assertTrue(response.context['inline_admin_formset'].opts.has_registered_model)
444.         for model, pk in items:
445.             url = reverse('admin:admin_inlines_%s_change' % model, args=(pk,))
446.             self.assertContains(response, '<a href="%s" %s' % (url, INLINE_CHANGELINK_HTML))
447. 


File: tests/admin_views/tests.py
Line number range: 6181 - 6202
Content:
6181.     def test_check(self):
6182.         "The view_on_site value is either a boolean or a callable"
6183.         try:
6184.             admin = CityAdmin(City, AdminSite())
6185.             CityAdmin.view_on_site = True
6186.             self.assertEqual(admin.check(), [])
6187.             CityAdmin.view_on_site = False
6188.             self.assertEqual(admin.check(), [])
6189.             CityAdmin.view_on_site = lambda obj: obj.get_absolute_url()
6190.             self.assertEqual(admin.check(), [])
6191.             CityAdmin.view_on_site = []
6192.             self.assertEqual(admin.check(), [
6193.                 Error(
6194.                     "The value of 'view_on_site' must be a callable or a boolean value.",
6195.                     obj=CityAdmin,
6196.                     id='admin.E025',
6197.                 ),
6198.             ])
6199.         finally:
6200.             # Restore the original values for the benefit of other tests.
6201.             CityAdmin.view_on_site = True
6202. 


File: tests/admin_views/tests.py
Line number range: 4815 - 4990
Content:
4815. class ReadonlyTest(AdminFieldExtractionMixin, TestCase):
4816. 
4817.     @classmethod
4818.     def setUpTestData(cls):
4819.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
4820. 
4821.     def setUp(self):
4822.         self.client.force_login(self.superuser)
4823. 
4824.     def test_readonly_get(self):
4825.         response = self.client.get(reverse('admin:admin_views_post_add'))
4826.         self.assertEqual(response.status_code, 200)
4827.         self.assertNotContains(response, 'name="posted"')
4828.         # 3 fields + 2 submit buttons + 5 inline management form fields, + 2
4829.         # hidden fields for inlines + 1 field for the inline + 2 empty form
4830.         self.assertContains(response, "<input", count=15)
4831.         self.assertContains(response, formats.localize(datetime.date.today()))
4832.         self.assertContains(response, "<label>Awesomeness level:</label>")
4833.         self.assertContains(response, "Very awesome.")
4834.         self.assertContains(response, "Unknown coolness.")
4835.         self.assertContains(response, "foo")
4836. 
4837.         # Multiline text in a readonly field gets <br> tags
4838.         self.assertContains(response, 'Multiline<br>test<br>string')
4839.         self.assertContains(response, '<div class="readonly">Multiline<br>html<br>content</div>', html=True)
4840.         self.assertContains(response, 'InlineMultiline<br>test<br>string')
4841. 
4842.         self.assertContains(response, formats.localize(datetime.date.today() - datetime.timedelta(days=7)))
4843. 
4844.         self.assertContains(response, '<div class="form-row field-coolness">')
4845.         self.assertContains(response, '<div class="form-row field-awesomeness_level">')
4846.         self.assertContains(response, '<div class="form-row field-posted">')
4847.         self.assertContains(response, '<div class="form-row field-value">')
4848.         self.assertContains(response, '<div class="form-row">')
4849.         self.assertContains(response, '<div class="help">', 3)
4850.         self.assertContains(
4851.             response,
4852.             '<div class="help">Some help text for the title (with unicode ŠĐĆŽćžšđ)</div>',
4853.             html=True
4854.         )
4855.         self.assertContains(
4856.             response,
4857.             '<div class="help">Some help text for the content (with unicode ŠĐĆŽćžšđ)</div>',
4858.             html=True
4859.         )
4860.         self.assertContains(
4861.             response,
4862.             '<div class="help">Some help text for the date (with unicode ŠĐĆŽćžšđ)</div>',
4863.             html=True
4864.         )
4865. 
4866.         p = Post.objects.create(title="I worked on readonly_fields", content="Its good stuff")
4867.         response = self.client.get(reverse('admin:admin_views_post_change', args=(p.pk,)))
4868.         self.assertContains(response, "%d amount of cool" % p.pk)
4869. 
4870.     def test_readonly_text_field(self):
4871.         p = Post.objects.create(
4872.             title="Readonly test", content="test",
4873.             readonly_content='test\r\n\r\ntest\r\n\r\ntest\r\n\r\ntest',
4874.         )
4875.         Link.objects.create(
4876.             url="http://www.djangoproject.com", post=p,
4877.             readonly_link_content="test\r\nlink",
4878.         )
4879.         response = self.client.get(reverse('admin:admin_views_post_change', args=(p.pk,)))
4880.         # Checking readonly field.
4881.         self.assertContains(response, 'test<br><br>test<br><br>test<br><br>test')
4882.         # Checking readonly field in inline.
4883.         self.assertContains(response, 'test<br>link')
4884. 
4885.     def test_readonly_post(self):
4886.         data = {
4887.             "title": "Django Got Readonly Fields",
4888.             "content": "This is an incredible development.",
4889.             "link_set-TOTAL_FORMS": "1",
4890.             "link_set-INITIAL_FORMS": "0",
4891.             "link_set-MAX_NUM_FORMS": "0",
4892.         }
4893.         response = self.client.post(reverse('admin:admin_views_post_add'), data)
4894.         self.assertEqual(response.status_code, 302)
4895.         self.assertEqual(Post.objects.count(), 1)
4896.         p = Post.objects.get()
4897.         self.assertEqual(p.posted, datetime.date.today())
4898. 
4899.         data["posted"] = "10-8-1990"  # some date that's not today
4900.         response = self.client.post(reverse('admin:admin_views_post_add'), data)
4901.         self.assertEqual(response.status_code, 302)
4902.         self.assertEqual(Post.objects.count(), 2)
4903.         p = Post.objects.order_by('-id')[0]
4904.         self.assertEqual(p.posted, datetime.date.today())
4905. 
4906.     def test_readonly_manytomany(self):
4907.         "Regression test for #13004"
4908.         response = self.client.get(reverse('admin:admin_views_pizza_add'))
4909.         self.assertEqual(response.status_code, 200)
4910. 
4911.     def test_user_password_change_limited_queryset(self):
4912.         su = User.objects.filter(is_superuser=True)[0]
4913.         response = self.client.get(reverse('admin2:auth_user_password_change', args=(su.pk,)))
4914.         self.assertEqual(response.status_code, 404)
4915. 
4916.     def test_change_form_renders_correct_null_choice_value(self):
4917.         """
4918.         Regression test for #17911.
4919.         """
4920.         choice = Choice.objects.create(choice=None)
4921.         response = self.client.get(reverse('admin:admin_views_choice_change', args=(choice.pk,)))
4922.         self.assertContains(response, '<div class="readonly">No opinion</div>', html=True)
4923. 
4924.     def test_readonly_manytomany_backwards_ref(self):
4925.         """
4926.         Regression test for #16433 - backwards references for related objects
4927.         broke if the related field is read-only due to the help_text attribute
4928.         """
4929.         topping = Topping.objects.create(name='Salami')
4930.         pizza = Pizza.objects.create(name='Americano')
4931.         pizza.toppings.add(topping)
4932.         response = self.client.get(reverse('admin:admin_views_topping_add'))
4933.         self.assertEqual(response.status_code, 200)
4934. 
4935.     def test_readonly_manytomany_forwards_ref(self):
4936.         topping = Topping.objects.create(name='Salami')
4937.         pizza = Pizza.objects.create(name='Americano')
4938.         pizza.toppings.add(topping)
4939.         response = self.client.get(reverse('admin:admin_views_pizza_change', args=(pizza.pk,)))
4940.         self.assertContains(response, '<label>Toppings:</label>', html=True)
4941.         self.assertContains(response, '<div class="readonly">Salami</div>', html=True)
4942. 
4943.     def test_readonly_onetoone_backwards_ref(self):
4944.         """
4945.         Can reference a reverse OneToOneField in ModelAdmin.readonly_fields.
4946.         """
4947.         v1 = Villain.objects.create(name='Adam')
4948.         pl = Plot.objects.create(name='Test Plot', team_leader=v1, contact=v1)
4949.         pd = PlotDetails.objects.create(details='Brand New Plot', plot=pl)
4950. 
4951.         response = self.client.get(reverse('admin:admin_views_plotproxy_change', args=(pl.pk,)))
4952.         field = self.get_admin_readonly_field(response, 'plotdetails')
4953.         self.assertEqual(field.contents(), 'Brand New Plot')
4954. 
4955.         # The reverse relation also works if the OneToOneField is null.
4956.         pd.plot = None
4957.         pd.save()
4958. 
4959.         response = self.client.get(reverse('admin:admin_views_plotproxy_change', args=(pl.pk,)))
4960.         field = self.get_admin_readonly_field(response, 'plotdetails')
4961.         self.assertEqual(field.contents(), '-')  # default empty value
4962. 
4963.     def test_readonly_field_overrides(self):
4964.         """
4965.         Regression test for #22087 - ModelForm Meta overrides are ignored by
4966.         AdminReadonlyField
4967.         """
4968.         p = FieldOverridePost.objects.create(title="Test Post", content="Test Content")
4969.         response = self.client.get(reverse('admin:admin_views_fieldoverridepost_change', args=(p.pk,)))
4970.         self.assertContains(response, '<div class="help">Overridden help text for the date</div>')
4971.         self.assertContains(response, '<label for="id_public">Overridden public label:</label>', html=True)
4972.         self.assertNotContains(response, "Some help text for the date (with unicode ŠĐĆŽćžšđ)")
4973. 
4974.     def test_correct_autoescaping(self):
4975.         """
4976.         Make sure that non-field readonly elements are properly autoescaped (#24461)
4977.         """
4978.         section = Section.objects.create(name='<a>evil</a>')
4979.         response = self.client.get(reverse('admin:admin_views_section_change', args=(section.pk,)))
4980.         self.assertNotContains(response, "<a>evil</a>", status_code=200)
4981.         self.assertContains(response, "&lt;a&gt;evil&lt;/a&gt;", status_code=200)
4982. 
4983.     def test_label_suffix_translated(self):
4984.         pizza = Pizza.objects.create(name='Americano')
4985.         url = reverse('admin:admin_views_pizza_change', args=(pizza.pk,))
4986.         with self.settings(LANGUAGE_CODE='fr'):
4987.             response = self.client.get(url)
4988.         self.assertContains(response, '<label>Toppings\u00A0:</label>', html=True)
4989. 
4990. 


File: tests/admin_views/tests.py
Line number range: 3631 - 3890
Content:
3631. class AdminCustomQuerysetTest(TestCase):
3632. 
3633.     @classmethod
3634.     def setUpTestData(cls):
3635.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
3636.         cls.pks = [EmptyModel.objects.create().id for i in range(3)]
3637. 
3638.     def setUp(self):
3639.         self.client.force_login(self.superuser)
3640.         self.super_login = {
3641.             REDIRECT_FIELD_NAME: reverse('admin:index'),
3642.             'username': 'super',
3643.             'password': 'secret',
3644.         }
3645. 
3646.     def test_changelist_view(self):
3647.         response = self.client.get(reverse('admin:admin_views_emptymodel_changelist'))
3648.         for i in self.pks:
3649.             if i > 1:
3650.                 self.assertContains(response, 'Primary key = %s' % i)
3651.             else:
3652.                 self.assertNotContains(response, 'Primary key = %s' % i)
3653. 
3654.     def test_changelist_view_count_queries(self):
3655.         # create 2 Person objects
3656.         Person.objects.create(name='person1', gender=1)
3657.         Person.objects.create(name='person2', gender=2)
3658.         changelist_url = reverse('admin:admin_views_person_changelist')
3659. 
3660.         # 5 queries are expected: 1 for the session, 1 for the user,
3661.         # 2 for the counts and 1 for the objects on the page
3662.         with self.assertNumQueries(5):
3663.             resp = self.client.get(changelist_url)
3664.             self.assertEqual(resp.context['selection_note'], '0 of 2 selected')
3665.             self.assertEqual(resp.context['selection_note_all'], 'All 2 selected')
3666.         with self.assertNumQueries(5):
3667.             extra = {'q': 'not_in_name'}
3668.             resp = self.client.get(changelist_url, extra)
3669.             self.assertEqual(resp.context['selection_note'], '0 of 0 selected')
3670.             self.assertEqual(resp.context['selection_note_all'], 'All 0 selected')
3671.         with self.assertNumQueries(5):
3672.             extra = {'q': 'person'}
3673.             resp = self.client.get(changelist_url, extra)
3674.             self.assertEqual(resp.context['selection_note'], '0 of 2 selected')
3675.             self.assertEqual(resp.context['selection_note_all'], 'All 2 selected')
3676.         with self.assertNumQueries(5):
3677.             extra = {'gender__exact': '1'}
3678.             resp = self.client.get(changelist_url, extra)
3679.             self.assertEqual(resp.context['selection_note'], '0 of 1 selected')
3680.             self.assertEqual(resp.context['selection_note_all'], '1 selected')
3681. 
3682.     def test_change_view(self):
3683.         for i in self.pks:
3684.             url = reverse('admin:admin_views_emptymodel_change', args=(i,))
3685.             response = self.client.get(url, follow=True)
3686.             if i > 1:
3687.                 self.assertEqual(response.status_code, 200)
3688.             else:
3689.                 self.assertRedirects(response, reverse('admin:index'))
3690.                 self.assertEqual(
3691.                     [m.message for m in response.context['messages']],
3692.                     ["""empty model with ID "1" doesn't exist. Perhaps it was deleted?"""]
3693.                 )
3694. 
3695.     def test_add_model_modeladmin_defer_qs(self):
3696.         # Test for #14529. defer() is used in ModelAdmin.get_queryset()
3697. 
3698.         # model has __str__ method
3699.         self.assertEqual(CoverLetter.objects.count(), 0)
3700.         # Emulate model instance creation via the admin
3701.         post_data = {
3702.             "author": "Candidate, Best",
3703.             "_save": "Save",
3704.         }
3705.         response = self.client.post(reverse('admin:admin_views_coverletter_add'), post_data, follow=True)
3706.         self.assertEqual(response.status_code, 200)
3707.         self.assertEqual(CoverLetter.objects.count(), 1)
3708.         # Message should contain non-ugly model verbose name
3709.         pk = CoverLetter.objects.all()[0].pk
3710.         self.assertContains(
3711.             response,
3712.             '<li class="success">The cover letter "<a href="%s">'
3713.             'Candidate, Best</a>" was added successfully.</li>' %
3714.             reverse('admin:admin_views_coverletter_change', args=(pk,)), html=True
3715.         )
3716. 
3717.         # model has no __str__ method
3718.         self.assertEqual(ShortMessage.objects.count(), 0)
3719.         # Emulate model instance creation via the admin
3720.         post_data = {
3721.             "content": "What's this SMS thing?",
3722.             "_save": "Save",
3723.         }
3724.         response = self.client.post(reverse('admin:admin_views_shortmessage_add'), post_data, follow=True)
3725.         self.assertEqual(response.status_code, 200)
3726.         self.assertEqual(ShortMessage.objects.count(), 1)
3727.         # Message should contain non-ugly model verbose name
3728.         sm = ShortMessage.objects.all()[0]
3729.         self.assertContains(
3730.             response,
3731.             '<li class="success">The short message "<a href="%s">'
3732.             '%s</a>" was added successfully.</li>' %
3733.             (reverse('admin:admin_views_shortmessage_change', args=(sm.pk,)), sm), html=True
3734.         )
3735. 
3736.     def test_add_model_modeladmin_only_qs(self):
3737.         # Test for #14529. only() is used in ModelAdmin.get_queryset()
3738. 
3739.         # model has __str__ method
3740.         self.assertEqual(Telegram.objects.count(), 0)
3741.         # Emulate model instance creation via the admin
3742.         post_data = {
3743.             "title": "Urgent telegram",
3744.             "_save": "Save",
3745.         }
3746.         response = self.client.post(reverse('admin:admin_views_telegram_add'), post_data, follow=True)
3747.         self.assertEqual(response.status_code, 200)
3748.         self.assertEqual(Telegram.objects.count(), 1)
3749.         # Message should contain non-ugly model verbose name
3750.         pk = Telegram.objects.all()[0].pk
3751.         self.assertContains(
3752.             response,
3753.             '<li class="success">The telegram "<a href="%s">'
3754.             'Urgent telegram</a>" was added successfully.</li>' %
3755.             reverse('admin:admin_views_telegram_change', args=(pk,)), html=True
3756.         )
3757. 
3758.         # model has no __str__ method
3759.         self.assertEqual(Paper.objects.count(), 0)
3760.         # Emulate model instance creation via the admin
3761.         post_data = {
3762.             "title": "My Modified Paper Title",
3763.             "_save": "Save",
3764.         }
3765.         response = self.client.post(reverse('admin:admin_views_paper_add'), post_data, follow=True)
3766.         self.assertEqual(response.status_code, 200)
3767.         self.assertEqual(Paper.objects.count(), 1)
3768.         # Message should contain non-ugly model verbose name
3769.         p = Paper.objects.all()[0]
3770.         self.assertContains(
3771.             response,
3772.             '<li class="success">The paper "<a href="%s">'
3773.             '%s</a>" was added successfully.</li>' %
3774.             (reverse('admin:admin_views_paper_change', args=(p.pk,)), p), html=True
3775.         )
3776. 
3777.     def test_edit_model_modeladmin_defer_qs(self):
3778.         # Test for #14529. defer() is used in ModelAdmin.get_queryset()
3779. 
3780.         # model has __str__ method
3781.         cl = CoverLetter.objects.create(author="John Doe")
3782.         self.assertEqual(CoverLetter.objects.count(), 1)
3783.         response = self.client.get(reverse('admin:admin_views_coverletter_change', args=(cl.pk,)))
3784.         self.assertEqual(response.status_code, 200)
3785.         # Emulate model instance edit via the admin
3786.         post_data = {
3787.             "author": "John Doe II",
3788.             "_save": "Save",
3789.         }
3790.         url = reverse('admin:admin_views_coverletter_change', args=(cl.pk,))
3791.         response = self.client.post(url, post_data, follow=True)
3792.         self.assertEqual(response.status_code, 200)
3793.         self.assertEqual(CoverLetter.objects.count(), 1)
3794.         # Message should contain non-ugly model verbose name. Instance
3795.         # representation is set by model's __str__()
3796.         self.assertContains(
3797.             response,
3798.             '<li class="success">The cover letter "<a href="%s">'
3799.             'John Doe II</a>" was changed successfully.</li>' %
3800.             reverse('admin:admin_views_coverletter_change', args=(cl.pk,)), html=True
3801.         )
3802. 
3803.         # model has no __str__ method
3804.         sm = ShortMessage.objects.create(content="This is expensive")
3805.         self.assertEqual(ShortMessage.objects.count(), 1)
3806.         response = self.client.get(reverse('admin:admin_views_shortmessage_change', args=(sm.pk,)))
3807.         self.assertEqual(response.status_code, 200)
3808.         # Emulate model instance edit via the admin
3809.         post_data = {
3810.             "content": "Too expensive",
3811.             "_save": "Save",
3812.         }
3813.         url = reverse('admin:admin_views_shortmessage_change', args=(sm.pk,))
3814.         response = self.client.post(url, post_data, follow=True)
3815.         self.assertEqual(response.status_code, 200)
3816.         self.assertEqual(ShortMessage.objects.count(), 1)
3817.         # Message should contain non-ugly model verbose name. The ugly(!)
3818.         # instance representation is set by __str__().
3819.         self.assertContains(
3820.             response,
3821.             '<li class="success">The short message "<a href="%s">'
3822.             '%s</a>" was changed successfully.</li>' %
3823.             (reverse('admin:admin_views_shortmessage_change', args=(sm.pk,)), sm), html=True
3824.         )
3825. 
3826.     def test_edit_model_modeladmin_only_qs(self):
3827.         # Test for #14529. only() is used in ModelAdmin.get_queryset()
3828. 
3829.         # model has __str__ method
3830.         t = Telegram.objects.create(title="First Telegram")
3831.         self.assertEqual(Telegram.objects.count(), 1)
3832.         response = self.client.get(reverse('admin:admin_views_telegram_change', args=(t.pk,)))
3833.         self.assertEqual(response.status_code, 200)
3834.         # Emulate model instance edit via the admin
3835.         post_data = {
3836.             "title": "Telegram without typo",
3837.             "_save": "Save",
3838.         }
3839.         response = self.client.post(reverse('admin:admin_views_telegram_change', args=(t.pk,)), post_data, follow=True)
3840.         self.assertEqual(response.status_code, 200)
3841.         self.assertEqual(Telegram.objects.count(), 1)
3842.         # Message should contain non-ugly model verbose name. The instance
3843.         # representation is set by model's __str__()
3844.         self.assertContains(
3845.             response,
3846.             '<li class="success">The telegram "<a href="%s">'
3847.             'Telegram without typo</a>" was changed successfully.</li>' %
3848.             reverse('admin:admin_views_telegram_change', args=(t.pk,)), html=True
3849.         )
3850. 
3851.         # model has no __str__ method
3852.         p = Paper.objects.create(title="My Paper Title")
3853.         self.assertEqual(Paper.objects.count(), 1)
3854.         response = self.client.get(reverse('admin:admin_views_paper_change', args=(p.pk,)))
3855.         self.assertEqual(response.status_code, 200)
3856.         # Emulate model instance edit via the admin
3857.         post_data = {
3858.             "title": "My Modified Paper Title",
3859.             "_save": "Save",
3860.         }
3861.         response = self.client.post(reverse('admin:admin_views_paper_change', args=(p.pk,)), post_data, follow=True)
3862.         self.assertEqual(response.status_code, 200)
3863.         self.assertEqual(Paper.objects.count(), 1)
3864.         # Message should contain non-ugly model verbose name. The ugly(!)
3865.         # instance representation is set by __str__().
3866.         self.assertContains(
3867.             response,
3868.             '<li class="success">The paper "<a href="%s">'
3869.             '%s</a>" was changed successfully.</li>' %
3870.             (reverse('admin:admin_views_paper_change', args=(p.pk,)), p), html=True
3871.         )
3872. 
3873.     def test_history_view_custom_qs(self):
3874.         """
3875.         Custom querysets are considered for the admin history view.
3876.         """
3877.         self.client.post(reverse('admin:login'), self.super_login)
3878.         FilteredManager.objects.create(pk=1)
3879.         FilteredManager.objects.create(pk=2)
3880.         response = self.client.get(reverse('admin:admin_views_filteredmanager_changelist'))
3881.         self.assertContains(response, "PK=1")
3882.         self.assertContains(response, "PK=2")
3883.         self.assertEqual(
3884.             self.client.get(reverse('admin:admin_views_filteredmanager_history', args=(1,))).status_code, 200
3885.         )
3886.         self.assertEqual(
3887.             self.client.get(reverse('admin:admin_views_filteredmanager_history', args=(2,))).status_code, 200
3888.         )
3889. 
3890. 


File: tests/admin_views/tests.py
Line number range: 1138 - 1183
Content:
1138. @override_settings(ROOT_URLCONF='admin_views.urls')
1139. class AdminViewFormUrlTest(TestCase):
1140.     current_app = "admin3"
1141. 
1142.     @classmethod
1143.     def setUpTestData(cls):
1144.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
1145.         cls.s1 = Section.objects.create(name='Test section')
1146.         cls.a1 = Article.objects.create(
1147.             content='<p>Middle content</p>', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1
1148.         )
1149.         cls.a2 = Article.objects.create(
1150.             content='<p>Oldest content</p>', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1
1151.         )
1152.         cls.a3 = Article.objects.create(
1153.             content='<p>Newest content</p>', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1
1154.         )
1155.         cls.p1 = PrePopulatedPost.objects.create(title='A Long Title', published=True, slug='a-long-title')
1156. 
1157.     def setUp(self):
1158.         self.client.force_login(self.superuser)
1159. 
1160.     def test_change_form_URL_has_correct_value(self):
1161.         """
1162.         change_view has form_url in response.context
1163.         """
1164.         response = self.client.get(
1165.             reverse('admin:admin_views_section_change', args=(self.s1.pk,), current_app=self.current_app)
1166.         )
1167.         self.assertIn('form_url', response.context, msg='form_url not present in response.context')
1168.         self.assertEqual(response.context['form_url'], 'pony')
1169. 
1170.     def test_initial_data_can_be_overridden(self):
1171.         """
1172.         The behavior for setting initial form data can be overridden in the
1173.         ModelAdmin class. Usually, the initial value is set via the GET params.
1174.         """
1175.         response = self.client.get(
1176.             reverse('admin:admin_views_restaurant_add', current_app=self.current_app),
1177.             {'name': 'test_value'}
1178.         )
1179.         # this would be the usual behaviour
1180.         self.assertNotContains(response, 'value="test_value"')
1181.         # this is the overridden behaviour
1182.         self.assertContains(response, 'value="overridden_value"')
1183. 


File: tests/admin_views/tests.py
Line number range: 3587 - 3611
Content:
3587. class TestCustomChangeList(TestCase):
3588. 
3589.     @classmethod
3590.     def setUpTestData(cls):
3591.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
3592. 
3593.     def setUp(self):
3594.         self.client.force_login(self.superuser)
3595. 
3596.     def test_custom_changelist(self):
3597.         """
3598.         Validate that a custom ChangeList class can be used (#9749)
3599.         """
3600.         # Insert some data
3601.         post_data = {"name": "First Gadget"}
3602.         response = self.client.post(reverse('admin:admin_views_gadget_add'), post_data)
3603.         self.assertEqual(response.status_code, 302)  # redirect somewhere
3604.         # Hit the page once to get messages out of the queue message list
3605.         response = self.client.get(reverse('admin:admin_views_gadget_changelist'))
3606.         # Data is still not visible on the page
3607.         response = self.client.get(reverse('admin:admin_views_gadget_changelist'))
3608.         self.assertEqual(response.status_code, 200)
3609.         self.assertNotContains(response, 'First Gadget')
3610. 
3611. 


File: tests/admin_views/tests.py
Line number range: 2501 - 2690
Content:
2501. @skipUnlessDBFeature('can_defer_constraint_checks')
2502. @override_settings(ROOT_URLCONF='admin_views.urls')
2503. class AdminViewDeletedObjectsTest(TestCase):
2504. 
2505.     @classmethod
2506.     def setUpTestData(cls):
2507.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
2508.         cls.deleteuser = User.objects.create_user(username='deleteuser', password='secret', is_staff=True)
2509.         cls.s1 = Section.objects.create(name='Test section')
2510.         cls.a1 = Article.objects.create(
2511.             content='<p>Middle content</p>', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1
2512.         )
2513.         cls.a2 = Article.objects.create(
2514.             content='<p>Oldest content</p>', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1
2515.         )
2516.         cls.a3 = Article.objects.create(
2517.             content='<p>Newest content</p>', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1
2518.         )
2519.         cls.p1 = PrePopulatedPost.objects.create(title='A Long Title', published=True, slug='a-long-title')
2520. 
2521.         cls.v1 = Villain.objects.create(name='Adam')
2522.         cls.v2 = Villain.objects.create(name='Sue')
2523.         cls.sv1 = SuperVillain.objects.create(name='Bob')
2524.         cls.pl1 = Plot.objects.create(name='World Domination', team_leader=cls.v1, contact=cls.v2)
2525.         cls.pl2 = Plot.objects.create(name='World Peace', team_leader=cls.v2, contact=cls.v2)
2526.         cls.pl3 = Plot.objects.create(name='Corn Conspiracy', team_leader=cls.v1, contact=cls.v1)
2527.         cls.pd1 = PlotDetails.objects.create(details='almost finished', plot=cls.pl1)
2528.         cls.sh1 = SecretHideout.objects.create(location='underground bunker', villain=cls.v1)
2529.         cls.sh2 = SecretHideout.objects.create(location='floating castle', villain=cls.sv1)
2530.         cls.ssh1 = SuperSecretHideout.objects.create(location='super floating castle!', supervillain=cls.sv1)
2531.         cls.cy1 = CyclicOne.objects.create(name='I am recursive', two_id=1)
2532.         cls.cy2 = CyclicTwo.objects.create(name='I am recursive too', one_id=1)
2533. 
2534.     def setUp(self):
2535.         self.client.force_login(self.superuser)
2536. 
2537.     def test_nesting(self):
2538.         """
2539.         Objects should be nested to display the relationships that
2540.         cause them to be scheduled for deletion.
2541.         """
2542.         pattern = re.compile(
2543.             r'<li>Plot: <a href="%s">World Domination</a>\s*<ul>\s*'
2544.             r'<li>Plot details: <a href="%s">almost finished</a>' % (
2545.                 reverse('admin:admin_views_plot_change', args=(self.pl1.pk,)),
2546.                 reverse('admin:admin_views_plotdetails_change', args=(self.pd1.pk,)),
2547.             )
2548.         )
2549.         response = self.client.get(reverse('admin:admin_views_villain_delete', args=(self.v1.pk,)))
2550.         self.assertRegex(response.content.decode(), pattern)
2551. 
2552.     def test_cyclic(self):
2553.         """
2554.         Cyclic relationships should still cause each object to only be
2555.         listed once.
2556.         """
2557.         one = '<li>Cyclic one: <a href="%s">I am recursive</a>' % (
2558.             reverse('admin:admin_views_cyclicone_change', args=(self.cy1.pk,)),
2559.         )
2560.         two = '<li>Cyclic two: <a href="%s">I am recursive too</a>' % (
2561.             reverse('admin:admin_views_cyclictwo_change', args=(self.cy2.pk,)),
2562.         )
2563.         response = self.client.get(reverse('admin:admin_views_cyclicone_delete', args=(self.cy1.pk,)))
2564. 
2565.         self.assertContains(response, one, 1)
2566.         self.assertContains(response, two, 1)
2567. 
2568.     def test_perms_needed(self):
2569.         self.client.logout()
2570.         delete_user = User.objects.get(username='deleteuser')
2571.         delete_user.user_permissions.add(get_perm(Plot, get_permission_codename('delete', Plot._meta)))
2572. 
2573.         self.client.force_login(self.deleteuser)
2574.         response = self.client.get(reverse('admin:admin_views_plot_delete', args=(self.pl1.pk,)))
2575.         self.assertContains(response, "your account doesn't have permission to delete the following types of objects")
2576.         self.assertContains(response, "<li>plot details</li>")
2577. 
2578.     def test_protected(self):
2579.         q = Question.objects.create(question="Why?")
2580.         a1 = Answer.objects.create(question=q, answer="Because.")
2581.         a2 = Answer.objects.create(question=q, answer="Yes.")
2582. 
2583.         response = self.client.get(reverse('admin:admin_views_question_delete', args=(q.pk,)))
2584.         self.assertContains(response, "would require deleting the following protected related objects")
2585.         self.assertContains(
2586.             response,
2587.             '<li>Answer: <a href="%s">Because.</a></li>' % reverse('admin:admin_views_answer_change', args=(a1.pk,))
2588.         )
2589.         self.assertContains(
2590.             response,
2591.             '<li>Answer: <a href="%s">Yes.</a></li>' % reverse('admin:admin_views_answer_change', args=(a2.pk,))
2592.         )
2593. 
2594.     def test_post_delete_protected(self):
2595.         """
2596.         A POST request to delete protected objects should display the page
2597.         which says the deletion is prohibited.
2598.         """
2599.         q = Question.objects.create(question='Why?')
2600.         Answer.objects.create(question=q, answer='Because.')
2601. 
2602.         response = self.client.post(reverse('admin:admin_views_question_delete', args=(q.pk,)), {'post': 'yes'})
2603.         self.assertEqual(Question.objects.count(), 1)
2604.         self.assertContains(response, "would require deleting the following protected related objects")
2605. 
2606.     def test_not_registered(self):
2607.         should_contain = """<li>Secret hideout: underground bunker"""
2608.         response = self.client.get(reverse('admin:admin_views_villain_delete', args=(self.v1.pk,)))
2609.         self.assertContains(response, should_contain, 1)
2610. 
2611.     def test_multiple_fkeys_to_same_model(self):
2612.         """
2613.         If a deleted object has two relationships from another model,
2614.         both of those should be followed in looking for related
2615.         objects to delete.
2616.         """
2617.         should_contain = '<li>Plot: <a href="%s">World Domination</a>' % reverse(
2618.             'admin:admin_views_plot_change', args=(self.pl1.pk,)
2619.         )
2620.         response = self.client.get(reverse('admin:admin_views_villain_delete', args=(self.v1.pk,)))
2621.         self.assertContains(response, should_contain)
2622.         response = self.client.get(reverse('admin:admin_views_villain_delete', args=(self.v2.pk,)))
2623.         self.assertContains(response, should_contain)
2624. 
2625.     def test_multiple_fkeys_to_same_instance(self):
2626.         """
2627.         If a deleted object has two relationships pointing to it from
2628.         another object, the other object should still only be listed
2629.         once.
2630.         """
2631.         should_contain = '<li>Plot: <a href="%s">World Peace</a></li>' % reverse(
2632.             'admin:admin_views_plot_change', args=(self.pl2.pk,)
2633.         )
2634.         response = self.client.get(reverse('admin:admin_views_villain_delete', args=(self.v2.pk,)))
2635.         self.assertContains(response, should_contain, 1)
2636. 
2637.     def test_inheritance(self):
2638.         """
2639.         In the case of an inherited model, if either the child or
2640.         parent-model instance is deleted, both instances are listed
2641.         for deletion, as well as any relationships they have.
2642.         """
2643.         should_contain = [
2644.             '<li>Villain: <a href="%s">Bob</a>' % reverse('admin:admin_views_villain_change', args=(self.sv1.pk,)),
2645.             '<li>Super villain: <a href="%s">Bob</a>' % reverse(
2646.                 'admin:admin_views_supervillain_change', args=(self.sv1.pk,)
2647.             ),
2648.             '<li>Secret hideout: floating castle',
2649.             '<li>Super secret hideout: super floating castle!',
2650.         ]
2651.         response = self.client.get(reverse('admin:admin_views_villain_delete', args=(self.sv1.pk,)))
2652.         for should in should_contain:
2653.             self.assertContains(response, should, 1)
2654.         response = self.client.get(reverse('admin:admin_views_supervillain_delete', args=(self.sv1.pk,)))
2655.         for should in should_contain:
2656.             self.assertContains(response, should, 1)
2657. 
2658.     def test_generic_relations(self):
2659.         """
2660.         If a deleted object has GenericForeignKeys pointing to it,
2661.         those objects should be listed for deletion.
2662.         """
2663.         plot = self.pl3
2664.         tag = FunkyTag.objects.create(content_object=plot, name='hott')
2665.         should_contain = '<li>Funky tag: <a href="%s">hott' % reverse(
2666.             'admin:admin_views_funkytag_change', args=(tag.id,))
2667.         response = self.client.get(reverse('admin:admin_views_plot_delete', args=(plot.pk,)))
2668.         self.assertContains(response, should_contain)
2669. 
2670.     def test_generic_relations_with_related_query_name(self):
2671.         """
2672.         If a deleted object has GenericForeignKey with
2673.         GenericRelation(related_query_name='...') pointing to it, those objects
2674.         should be listed for deletion.
2675.         """
2676.         bookmark = Bookmark.objects.create(name='djangoproject')
2677.         tag = FunkyTag.objects.create(content_object=bookmark, name='django')
2678.         tag_url = reverse('admin:admin_views_funkytag_change', args=(tag.id,))
2679.         should_contain = '<li>Funky tag: <a href="%s">django' % tag_url
2680.         response = self.client.get(reverse('admin:admin_views_bookmark_delete', args=(bookmark.pk,)))
2681.         self.assertContains(response, should_contain)
2682. 
2683.     def test_delete_view_uses_get_deleted_objects(self):
2684.         """The delete view uses ModelAdmin.get_deleted_objects()."""
2685.         book = Book.objects.create(name='Test Book')
2686.         response = self.client.get(reverse('admin2:admin_views_book_delete', args=(book.pk,)))
2687.         # BookAdmin.get_deleted_objects() returns custom text.
2688.         self.assertContains(response, 'a deletable object')
2689. 
2690. 

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

2025-10-06 21:10:02,227 - thread-139660780025408.app.lang_graph.nodes.context_refine_node - DEBUG - reasoning="1. The user's objective is to obtain 5 complete and self-contained test cases that illustrate dynamic functionality in `ModelAdmin` through hooks, similar to the proposed `get_inlines` method.\n2. The context provided contains several relevant test snippets from `tests/admin_views/tests.py` and `tests/admin_inlines/tests.py`. These snippets are intended to test hooks such as `get_queryset`, `get_max_num`, and `get_deleted_objects`.\n3. However, these snippets are incomplete and lack the necessary information to form a comprehensive test case. Specifically, they are missing file-level imports, the complete structure of the test classes (including setup methods), and the definitions of the models and `ModelAdmin` subclasses that implement the dynamic hooks.\n4. To provide the 5 complete examples as requested, it is essential to retrieve the full source code of the relevant files and their dependencies." refined_query='The current context is insufficient to generate 5 complete test cases. The provided snippets lack necessary imports, model definitions, and `ModelAdmin` class definitions containing the dynamic hooks (e.g., `get_queryset`, `get_readonly_fields`). To proceed, please provide the full source code for `tests/admin_views/tests.py` and `tests/admin_inlines/tests.py`, including the definitions of all models and admin classes they utilize within them.'
2025-10-06 21:10:07,676 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I will provide the source code for the requested files. First, I will read the contents of `tests/admin_views/tests.py`, and then I will read the contents of `tests/admin_inlines/tests.py` to provide the necessary context.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/admin_views/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 53550, 'candidates_token_count': 79, 'total_token_count': 53924, 'prompt_tokens_details': [{'modality': 1, 'token_count': 53550}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 79}], 'thoughts_token_count': 295, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.31867792636533326, 'model_name': 'gemini-2.5-pro'} id='run--bf1a9877-5445-4601-a5a3-5d2f5bf134ea-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/admin_views/tests.py'}, 'id': '6bac239f-8212-43ad-a0be-ff2b931b3fb4', 'type': 'tool_call'}] usage_metadata={'input_tokens': 53550, 'output_tokens': 79, 'total_tokens': 53924, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 295}}
2025-10-06 21:10:10,268 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I have started by reading the beginning of the `tests.py` file from the `admin_views` test application. I will now proceed to read the remaining portion of this file and then move on to the `tests.py` file from the `admin_inlines` application to gather all the necessary code.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/admin_views/tests.py", "start_line": 501.0, "end_line": 1001.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 62592, 'candidates_token_count': 94, 'total_token_count': 62721, 'cached_content_token_count': 52024, 'prompt_tokens_details': [{'modality': 1, 'token_count': 62592}], 'cache_tokens_details': [{'modality': 1, 'token_count': 52024}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 94}], 'thoughts_token_count': 35}, 'finish_reason': 'STOP', 'avg_logprobs': -0.13828481511866791, 'model_name': 'gemini-2.5-pro'} id='run--75bbd948-8a56-47fe-bf24-449811a50171-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/admin_views/tests.py', 'start_line': 501.0, 'end_line': 1001.0}, 'id': 'a282b361-7cef-48d6-b659-cd0a32214fc5', 'type': 'tool_call'}] usage_metadata={'input_tokens': 62592, 'output_tokens': 94, 'total_tokens': 62721, 'input_token_details': {'cache_read': 52024}, 'output_token_details': {'reasoning': 35}}
2025-10-06 21:10:12,968 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I have now retrieved the first 1000 lines of `tests/admin_views/tests.py`. I will continue reading the rest of this file and then proceed to read `tests/admin_inlines/tests.py` to gather all the necessary code.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 1001.0, "relative_path": "tests/admin_views/tests.py", "end_line": 1501.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 73011, 'candidates_token_count': 86, 'total_token_count': 73097, 'prompt_tokens_details': [{'modality': 1, 'token_count': 73011}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 86}], 'thoughts_token_count': 0, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.11466185991154161, 'model_name': 'gemini-2.5-pro'} id='run--ddac18fe-8b6d-408a-8281-f4915c3c9458-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 1001.0, 'relative_path': 'tests/admin_views/tests.py', 'end_line': 1501.0}, 'id': '81e82913-5d1f-4133-b153-3e73e58330cc', 'type': 'tool_call'}] usage_metadata={'input_tokens': 73011, 'output_tokens': 86, 'total_tokens': 73097, 'input_token_details': {'cache_read': 0}}
2025-10-06 21:10:15,944 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content="I am continuing to read the `tests/admin_views/tests.py` file to gather all necessary code. So far, I've retrieved the first 1500 lines. I will now read the remainder of this file and then proceed with `tests/admin_inlines/tests.py`." additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 1501.0, "relative_path": "tests/admin_views/tests.py", "end_line": 2001.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 83064, 'candidates_token_count': 94, 'total_token_count': 83158, 'cached_content_token_count': 71631, 'prompt_tokens_details': [{'modality': 1, 'token_count': 83064}], 'cache_tokens_details': [{'modality': 1, 'token_count': 71631}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 94}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.13653783595308344, 'model_name': 'gemini-2.5-pro'} id='run--c646ad50-693f-4e2c-90f8-9844ecc8f099-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 1501.0, 'relative_path': 'tests/admin_views/tests.py', 'end_line': 2001.0}, 'id': 'a14242af-639e-4f97-92cd-2df361847c4a', 'type': 'tool_call'}] usage_metadata={'input_tokens': 83064, 'output_tokens': 94, 'total_tokens': 83158, 'input_token_details': {'cache_read': 71631}}
2025-10-06 21:10:18,578 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content="I am continuing to read the `tests/admin_views/tests.py` file to gather all necessary code. So far, I've retrieved the first 2000 lines. I will now read the remainder of this file and then proceed with `tests/admin_inlines/tests.py`." additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 2001.0, "relative_path": "tests/admin_views/tests.py", "end_line": 2501.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 93869, 'candidates_token_count': 94, 'total_token_count': 93963, 'cached_content_token_count': 79577, 'prompt_tokens_details': [{'modality': 1, 'token_count': 93869}], 'cache_tokens_details': [{'modality': 1, 'token_count': 79577}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 94}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.024772311778778724, 'model_name': 'gemini-2.5-pro'} id='run--4f1ab3e6-020c-4d74-8562-8214b34c0012-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 2001.0, 'relative_path': 'tests/admin_views/tests.py', 'end_line': 2501.0}, 'id': '78aac982-bfff-4b58-9d08-afe2acaca793', 'type': 'tool_call'}] usage_metadata={'input_tokens': 93869, 'output_tokens': 94, 'total_tokens': 93963, 'input_token_details': {'cache_read': 79577}}
2025-10-06 21:10:23,190 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content="I am continuing to read the `tests/admin_views/tests.py` file to gather all necessary code. So far, I've retrieved the first 2500 lines. I will now read the remainder of this file and then proceed with `tests/admin_inlines/tests.py`." additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 2501.0, "relative_path": "tests/admin_views/tests.py", "end_line": 3001.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 103901, 'candidates_token_count': 94, 'total_token_count': 103995, 'cached_content_token_count': 91510, 'prompt_tokens_details': [{'modality': 1, 'token_count': 103901}], 'cache_tokens_details': [{'modality': 1, 'token_count': 91510}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 94}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.00946746290998256, 'model_name': 'gemini-2.5-pro'} id='run--536db726-2266-4283-a95a-29fe0ce20c19-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 2501.0, 'relative_path': 'tests/admin_views/tests.py', 'end_line': 3001.0}, 'id': '8381f6ed-f931-4881-b689-04e33d16fbac', 'type': 'tool_call'}] usage_metadata={'input_tokens': 103901, 'output_tokens': 94, 'total_tokens': 103995, 'input_token_details': {'cache_read': 91510}}
2025-10-06 21:10:25,762 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content="I am continuing to read the `tests/admin_views/tests.py` file to gather all necessary code. So far, I've retrieved the first 3000 lines. I will now read the remainder of this file and then proceed with `tests/admin_inlines/tests.py`." additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/admin_views/tests.py", "start_line": 3001.0, "end_line": 3501.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 114639, 'candidates_token_count': 94, 'total_token_count': 114733, 'cached_content_token_count': 103428, 'prompt_tokens_details': [{'modality': 1, 'token_count': 114639}], 'cache_tokens_details': [{'modality': 1, 'token_count': 103428}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 94}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.007959155326193951, 'model_name': 'gemini-2.5-pro'} id='run--a4629f18-ba6c-4936-bc82-dd0ec1ede588-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/admin_views/tests.py', 'start_line': 3001.0, 'end_line': 3501.0}, 'id': '9ff443e9-cc38-4dc8-bd9e-fb675ed5024a', 'type': 'tool_call'}] usage_metadata={'input_tokens': 114639, 'output_tokens': 94, 'total_tokens': 114733, 'input_token_details': {'cache_read': 103428}}
2025-10-06 21:10:28,419 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content="I am continuing to read the `tests/admin_views/tests.py` file to gather all necessary code. So far, I've retrieved the first 3500 lines. I will now read the remainder of this file and then proceed with `tests/admin_inlines/tests.py`." additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/admin_views/tests.py", "start_line": 3501.0, "end_line": 4001.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 124051, 'candidates_token_count': 94, 'total_token_count': 124145, 'cached_content_token_count': 111368, 'prompt_tokens_details': [{'modality': 1, 'token_count': 124051}], 'cache_tokens_details': [{'modality': 1, 'token_count': 111368}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 94}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.0038050666768500146, 'model_name': 'gemini-2.5-pro'} id='run--99affcfe-7759-41bd-9021-8f54c337c830-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/admin_views/tests.py', 'start_line': 3501.0, 'end_line': 4001.0}, 'id': '881d66ed-706a-4f06-84e2-84e38d192a68', 'type': 'tool_call'}] usage_metadata={'input_tokens': 124051, 'output_tokens': 94, 'total_tokens': 124145, 'input_token_details': {'cache_read': 111368}}
2025-10-06 21:10:31,324 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content="I am continuing to read the `tests/admin_views/tests.py` file to gather all necessary code. So far, I've retrieved the first 4000 lines. I will now read the remainder of this file and then proceed with `tests/admin_inlines/tests.py`." additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/admin_views/tests.py", "start_line": 4001.0, "end_line": 4501.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 133356, 'candidates_token_count': 94, 'total_token_count': 133450, 'cached_content_token_count': 123305, 'prompt_tokens_details': [{'modality': 1, 'token_count': 133356}], 'cache_tokens_details': [{'modality': 1, 'token_count': 123305}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 94}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.005274863002148081, 'model_name': 'gemini-2.5-pro'} id='run--39e89b32-5c7e-4171-8390-c6cbd6cae841-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/admin_views/tests.py', 'start_line': 4001.0, 'end_line': 4501.0}, 'id': '1fc6be56-2c9e-48a2-8c91-2a5f14784ccd', 'type': 'tool_call'}] usage_metadata={'input_tokens': 133356, 'output_tokens': 94, 'total_tokens': 133450, 'input_token_details': {'cache_read': 123305}}
2025-10-06 21:10:34,228 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content="I am continuing to read the `tests/admin_views/tests.py` file to gather all necessary code. So far, I've retrieved the first 4500 lines. I will now read the remainder of this file and then proceed with `tests/admin_inlines/tests.py`." additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/admin_views/tests.py", "start_line": 4501.0, "end_line": 5001.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 144388, 'candidates_token_count': 94, 'total_token_count': 144482, 'cached_content_token_count': 131220, 'prompt_tokens_details': [{'modality': 1, 'token_count': 144388}], 'cache_tokens_details': [{'modality': 1, 'token_count': 131220}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 94}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.005719295841582278, 'model_name': 'gemini-2.5-pro'} id='run--b522a6f8-bca0-4ccf-a352-5cd042dfc022-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/admin_views/tests.py', 'start_line': 4501.0, 'end_line': 5001.0}, 'id': '33bf662c-251d-4424-bad0-afa6e3efe1e4', 'type': 'tool_call'}] usage_metadata={'input_tokens': 144388, 'output_tokens': 94, 'total_tokens': 144482, 'input_token_details': {'cache_read': 131220}}
2025-10-06 21:10:39,771 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I have now retrieved all of the content from `tests/admin_views/tests.py`. I will now proceed to read `tests/admin_inlines/tests.py` to gather the remaining necessary code.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/admin_inlines/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 155662, 'candidates_token_count': 69, 'total_token_count': 155731, 'cached_content_token_count': 143186, 'prompt_tokens_details': [{'modality': 1, 'token_count': 155662}], 'cache_tokens_details': [{'modality': 1, 'token_count': 143186}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 69}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.0561073482900426, 'model_name': 'gemini-2.5-pro'} id='run--909b3ffa-73cf-44e3-a939-7dfda986168e-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/admin_inlines/tests.py'}, 'id': '4a4fa85e-266d-474a-9479-bd37b53a8004', 'type': 'tool_call'}] usage_metadata={'input_tokens': 155662, 'output_tokens': 69, 'total_tokens': 155731, 'input_token_details': {'cache_read': 143186}}
2025-10-06 21:10:44,211 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I have now retrieved all of the content from `tests/admin_views/tests.py` and have started reading `tests/admin_inlines/tests.py`. I will now read the remainder of `tests/admin_inlines/tests.py` to gather all the necessary code to generate the test cases.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 501.0, "relative_path": "tests/admin_inlines/tests.py", "end_line": 1001.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 164708, 'candidates_token_count': 97, 'total_token_count': 164805, 'cached_content_token_count': 154996, 'prompt_tokens_details': [{'modality': 1, 'token_count': 164708}], 'cache_tokens_details': [{'modality': 1, 'token_count': 154996}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 97}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.06235611315855046, 'model_name': 'gemini-2.5-pro'} id='run--ecac2bfd-93d8-44a3-a073-bc38d0680065-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 501.0, 'relative_path': 'tests/admin_inlines/tests.py', 'end_line': 1001.0}, 'id': '2e7e3ef4-d947-48e5-b09c-28509fda33b8', 'type': 'tool_call'}] usage_metadata={'input_tokens': 164708, 'output_tokens': 97, 'total_tokens': 164805, 'input_token_details': {'cache_read': 154996}}
2025-10-06 21:10:47,283 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I have now retrieved all of the content from `tests/admin_views/tests.py` and `tests/admin_inlines/tests.py`. I have all the necessary code to generate the test cases as requested.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 1.0, "relative_path": "tests/admin_inlines/admin.py", "end_line": 487.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 175044, 'candidates_token_count': 77, 'total_token_count': 175121, 'cached_content_token_count': 162909, 'prompt_tokens_details': [{'modality': 1, 'token_count': 175044}], 'cache_tokens_details': [{'modality': 1, 'token_count': 162909}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 77}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.1175511223929269, 'model_name': 'gemini-2.5-pro'} id='run--eb5138bf-92ab-4c1a-9637-2272a12b1cc4-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 1.0, 'relative_path': 'tests/admin_inlines/admin.py', 'end_line': 487.0}, 'id': '1c4a7d11-481d-49d8-8041-2a7f9f917945', 'type': 'tool_call'}] usage_metadata={'input_tokens': 175044, 'output_tokens': 77, 'total_tokens': 175121, 'input_token_details': {'cache_read': 162909}}
2025-10-06 21:10:49,776 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I have now retrieved all of the content from `tests/admin_views/tests.py` and `tests/admin_inlines/tests.py`, as well as `tests/admin_inlines/admin.py`. I have all the necessary code to generate the test cases as requested.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 178309, 'candidates_token_count': 62, 'total_token_count': 178371, 'cached_content_token_count': 174819, 'prompt_tokens_details': [{'modality': 1, 'token_count': 178309}], 'cache_tokens_details': [{'modality': 1, 'token_count': 174819}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 62}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.07436051676350255, 'model_name': 'gemini-2.5-pro'} id='run--5f5aa5a0-b720-439e-8f1b-7ce55e13b777-0' usage_metadata={'input_tokens': 178309, 'output_tokens': 62, 'total_tokens': 178371, 'input_token_details': {'cache_read': 174819}}
2025-10-06 21:10:49,777 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - INFO - Starting context extraction process
2025-10-06 21:10:49,779 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - DEBUG - This is the original user query:

--- BEGIN ORIGINAL QUERY ---
Issue title:
add ModelAdmin.get_inlines() hook to allow set inlines based on the request or model instance.

Issue description: 
Description
	
add ModelAdmin.get_inlines() hook to allow set inlines based on the request or model instance.
Currently, We can override the method get_inline_instances to do such a thing, but a for loop should be copied to my code. So I wished add a hook get_inlines(request, obj=None)

Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

This is the refinement query. Please consider it together with the original query. It's really IMPORTANT!!!

--- BEGIN REFINEMENT QUERY ---
The current context is insufficient to generate 5 complete test cases. The provided snippets lack necessary imports, model definitions, and `ModelAdmin` class definitions containing the dynamic hooks (e.g., `get_queryset`, `get_readonly_fields`). To proceed, please provide the full source code for `tests/admin_views/tests.py` and `tests/admin_inlines/tests.py`, including the definitions of all models and admin classes they utilize within them.
--- END REFINEMENT QUERY ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/admin_views/tests.py
Line number range: 1 - 500
Content:
1. import datetime
2. import os
3. import re
4. import unittest
5. from unittest import mock
6. from urllib.parse import parse_qsl, urljoin, urlparse
7. 
8. import pytz
9. 
10. from django.contrib.admin import AdminSite, ModelAdmin
11. from django.contrib.admin.helpers import ACTION_CHECKBOX_NAME
12. from django.contrib.admin.models import ADDITION, DELETION, LogEntry
13. from django.contrib.admin.options import TO_FIELD_VAR
14. from django.contrib.admin.templatetags.admin_urls import add_preserved_filters
15. from django.contrib.admin.tests import AdminSeleniumTestCase
16. from django.contrib.admin.utils import quote
17. from django.contrib.admin.views.main import IS_POPUP_VAR
18. from django.contrib.auth import REDIRECT_FIELD_NAME, get_permission_codename
19. from django.contrib.auth.models import Group, Permission, User
20. from django.contrib.contenttypes.models import ContentType
21. from django.core import mail
22. from django.core.checks import Error
23. from django.core.files import temp as tempfile
24. from django.forms.utils import ErrorList
25. from django.template.response import TemplateResponse
26. from django.test import (
27.     TestCase, modify_settings, override_settings, skipUnlessDBFeature,
28. )
29. from django.test.utils import override_script_prefix
30. from django.urls import NoReverseMatch, resolve, reverse
31. from django.utils import formats, translation
32. from django.utils.cache import get_max_age
33. from django.utils.encoding import iri_to_uri
34. from django.utils.html import escape
35. from django.utils.http import urlencode
36. 
37. from . import customadmin
38. from .admin import CityAdmin, site, site2
39. from .models import (
40.     Actor, AdminOrderedAdminMethod, AdminOrderedCallable, AdminOrderedField,
41.     AdminOrderedModelMethod, Answer, Answer2, Article, BarAccount, Book,
42.     Bookmark, Category, Chapter, ChapterXtra1, ChapterXtra2, Character, Child,
43.     Choice, City, Collector, Color, ComplexSortedPerson, CoverLetter,
44.     CustomArticle, CyclicOne, CyclicTwo, DooHickey, Employee, EmptyModel,
45.     Fabric, FancyDoodad, FieldOverridePost, FilteredManager, FooAccount,
46.     FoodDelivery, FunkyTag, Gallery, Grommet, Inquisition, Language, Link,
47.     MainPrepopulated, Media, ModelWithStringPrimaryKey, OtherStory, Paper,
48.     Parent, ParentWithDependentChildren, ParentWithUUIDPK, Person, Persona,
49.     Picture, Pizza, Plot, PlotDetails, PluggableSearchPerson, Podcast, Post,
50.     PrePopulatedPost, Promo, Question, ReadablePizza, ReadOnlyPizza,
51.     Recommendation, Recommender, RelatedPrepopulated, RelatedWithUUIDPKModel,
52.     Report, Restaurant, RowLevelChangePermissionModel, SecretHideout, Section,
53.     ShortMessage, Simple, State, Story, SuperSecretHideout, SuperVillain,
54.     Telegram, TitleTranslation, Topping, UnchangeableObject, UndeletableObject,
55.     UnorderedObject, UserProxy, Villain, Vodcast, Whatsit, Widget, Worker,
56.     WorkHour,
57. )
58. 
59. ERROR_MESSAGE = "Please enter the correct username and password \
60. for a staff account. Note that both fields may be case-sensitive."
61. 
62. MULTIPART_ENCTYPE = 'enctype="multipart/form-data"'
63. 
64. 
65. class AdminFieldExtractionMixin:
66.     """
67.     Helper methods for extracting data from AdminForm.
68.     """
69.     def get_admin_form_fields(self, response):
70.         """
71.         Return a list of AdminFields for the AdminForm in the response.
72.         """
73.         fields = []
74.         for fieldset in response.context['adminform']:
75.             for field_line in fieldset:
76.                 fields.extend(field_line)
77.         return fields
78. 
79.     def get_admin_readonly_fields(self, response):
80.         """
81.         Return the readonly fields for the response's AdminForm.
82.         """
83.         return [f for f in self.get_admin_form_fields(response) if f.is_readonly]
84. 
85.     def get_admin_readonly_field(self, response, field_name):
86.         """
87.         Return the readonly field for the given field_name.
88.         """
89.         admin_readonly_fields = self.get_admin_readonly_fields(response)
90.         for field in admin_readonly_fields:
91.             if field.field['name'] == field_name:
92.                 return field
93. 
94. 
95. @override_settings(ROOT_URLCONF='admin_views.urls', USE_I18N=True, USE_L10N=False, LANGUAGE_CODE='en')
96. class AdminViewBasicTestCase(TestCase):
97. 
98.     @classmethod
99.     def setUpTestData(cls):
100.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
101.         cls.s1 = Section.objects.create(name='Test section')
102.         cls.a1 = Article.objects.create(
103.             content='<p>Middle content</p>', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1
104.         )
105.         cls.a2 = Article.objects.create(
106.             content='<p>Oldest content</p>', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1
107.         )
108.         cls.a3 = Article.objects.create(
109.             content='<p>Newest content</p>', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1
110.         )
111.         cls.p1 = PrePopulatedPost.objects.create(title='A Long Title', published=True, slug='a-long-title')
112.         cls.color1 = Color.objects.create(value='Red', warm=True)
113.         cls.color2 = Color.objects.create(value='Orange', warm=True)
114.         cls.color3 = Color.objects.create(value='Blue', warm=False)
115.         cls.color4 = Color.objects.create(value='Green', warm=False)
116.         cls.fab1 = Fabric.objects.create(surface='x')
117.         cls.fab2 = Fabric.objects.create(surface='y')
118.         cls.fab3 = Fabric.objects.create(surface='plain')
119.         cls.b1 = Book.objects.create(name='Book 1')
120.         cls.b2 = Book.objects.create(name='Book 2')
121.         cls.pro1 = Promo.objects.create(name='Promo 1', book=cls.b1)
122.         cls.pro1 = Promo.objects.create(name='Promo 2', book=cls.b2)
123.         cls.chap1 = Chapter.objects.create(title='Chapter 1', content='[ insert contents here ]', book=cls.b1)
124.         cls.chap2 = Chapter.objects.create(title='Chapter 2', content='[ insert contents here ]', book=cls.b1)
125.         cls.chap3 = Chapter.objects.create(title='Chapter 1', content='[ insert contents here ]', book=cls.b2)
126.         cls.chap4 = Chapter.objects.create(title='Chapter 2', content='[ insert contents here ]', book=cls.b2)
127.         cls.cx1 = ChapterXtra1.objects.create(chap=cls.chap1, xtra='ChapterXtra1 1')
128.         cls.cx2 = ChapterXtra1.objects.create(chap=cls.chap3, xtra='ChapterXtra1 2')
129.         Actor.objects.create(name='Palin', age=27)
130. 
131.         # Post data for edit inline
132.         cls.inline_post_data = {
133.             "name": "Test section",
134.             # inline data
135.             "article_set-TOTAL_FORMS": "6",
136.             "article_set-INITIAL_FORMS": "3",
137.             "article_set-MAX_NUM_FORMS": "0",
138.             "article_set-0-id": cls.a1.pk,
139.             # there is no title in database, give one here or formset will fail.
140.             "article_set-0-title": "Norske bostaver æøå skaper problemer",
141.             "article_set-0-content": "&lt;p&gt;Middle content&lt;/p&gt;",
142.             "article_set-0-date_0": "2008-03-18",
143.             "article_set-0-date_1": "11:54:58",
144.             "article_set-0-section": cls.s1.pk,
145.             "article_set-1-id": cls.a2.pk,
146.             "article_set-1-title": "Need a title.",
147.             "article_set-1-content": "&lt;p&gt;Oldest content&lt;/p&gt;",
148.             "article_set-1-date_0": "2000-03-18",
149.             "article_set-1-date_1": "11:54:58",
150.             "article_set-2-id": cls.a3.pk,
151.             "article_set-2-title": "Need a title.",
152.             "article_set-2-content": "&lt;p&gt;Newest content&lt;/p&gt;",
153.             "article_set-2-date_0": "2009-03-18",
154.             "article_set-2-date_1": "11:54:58",
155.             "article_set-3-id": "",
156.             "article_set-3-title": "",
157.             "article_set-3-content": "",
158.             "article_set-3-date_0": "",
159.             "article_set-3-date_1": "",
160.             "article_set-4-id": "",
161.             "article_set-4-title": "",
162.             "article_set-4-content": "",
163.             "article_set-4-date_0": "",
164.             "article_set-4-date_1": "",
165.             "article_set-5-id": "",
166.             "article_set-5-title": "",
167.             "article_set-5-content": "",
168.             "article_set-5-date_0": "",
169.             "article_set-5-date_1": "",
170.         }
171. 
172.     def setUp(self):
173.         self.client.force_login(self.superuser)
174. 
175.     def assertContentBefore(self, response, text1, text2, failing_msg=None):
176.         """
177.         Testing utility asserting that text1 appears before text2 in response
178.         content.
179.         """
180.         self.assertEqual(response.status_code, 200)
181.         self.assertLess(
182.             response.content.index(text1.encode()),
183.             response.content.index(text2.encode()),
184.             (failing_msg or '') + '\nResponse:\n' + response.content.decode(response.charset)
185.         )
186. 
187. 
188. class AdminViewBasicTest(AdminViewBasicTestCase):
189.     def test_trailing_slash_required(self):
190.         """
191.         If you leave off the trailing slash, app should redirect and add it.
192.         """
193.         add_url = reverse('admin:admin_views_article_add')
194.         response = self.client.get(add_url[:-1])
195.         self.assertRedirects(response, add_url, status_code=301)
196. 
197.     def test_basic_add_GET(self):
198.         """
199.         A smoke test to ensure GET on the add_view works.
200.         """
201.         response = self.client.get(reverse('admin:admin_views_section_add'))
202.         self.assertIsInstance(response, TemplateResponse)
203.         self.assertEqual(response.status_code, 200)
204. 
205.     def test_add_with_GET_args(self):
206.         response = self.client.get(reverse('admin:admin_views_section_add'), {'name': 'My Section'})
207.         self.assertContains(
208.             response, 'value="My Section"',
209.             msg_prefix="Couldn't find an input with the right value in the response"
210.         )
211. 
212.     def test_basic_edit_GET(self):
213.         """
214.         A smoke test to ensure GET on the change_view works.
215.         """
216.         response = self.client.get(reverse('admin:admin_views_section_change', args=(self.s1.pk,)))
217.         self.assertIsInstance(response, TemplateResponse)
218.         self.assertEqual(response.status_code, 200)
219. 
220.     def test_basic_edit_GET_string_PK(self):
221.         """
222.         GET on the change_view (when passing a string as the PK argument for a
223.         model with an integer PK field) redirects to the index page with a
224.         message saying the object doesn't exist.
225.         """
226.         response = self.client.get(reverse('admin:admin_views_section_change', args=(quote("abc/<b>"),)), follow=True)
227.         self.assertRedirects(response, reverse('admin:index'))
228.         self.assertEqual(
229.             [m.message for m in response.context['messages']],
230.             ["""section with ID "abc/<b>" doesn't exist. Perhaps it was deleted?"""]
231.         )
232. 
233.     def test_basic_edit_GET_old_url_redirect(self):
234.         """
235.         The change URL changed in Django 1.9, but the old one still redirects.
236.         """
237.         response = self.client.get(
238.             reverse('admin:admin_views_section_change', args=(self.s1.pk,)).replace('change/', '')
239.         )
240.         self.assertRedirects(response, reverse('admin:admin_views_section_change', args=(self.s1.pk,)))
241. 
242.     def test_basic_inheritance_GET_string_PK(self):
243.         """
244.         GET on the change_view (for inherited models) redirects to the index
245.         page with a message saying the object doesn't exist.
246.         """
247.         response = self.client.get(reverse('admin:admin_views_supervillain_change', args=('abc',)), follow=True)
248.         self.assertRedirects(response, reverse('admin:index'))
249.         self.assertEqual(
250.             [m.message for m in response.context['messages']],
251.             ["""super villain with ID "abc" doesn't exist. Perhaps it was deleted?"""]
252.         )
253. 
254.     def test_basic_add_POST(self):
255.         """
256.         A smoke test to ensure POST on add_view works.
257.         """
258.         post_data = {
259.             "name": "Another Section",
260.             # inline data
261.             "article_set-TOTAL_FORMS": "3",
262.             "article_set-INITIAL_FORMS": "0",
263.             "article_set-MAX_NUM_FORMS": "0",
264.         }
265.         response = self.client.post(reverse('admin:admin_views_section_add'), post_data)
266.         self.assertEqual(response.status_code, 302)  # redirect somewhere
267. 
268.     def test_popup_add_POST(self):
269.         """
270.         Ensure http response from a popup is properly escaped.
271.         """
272.         post_data = {
273.             '_popup': '1',
274.             'title': 'title with a new\nline',
275.             'content': 'some content',
276.             'date_0': '2010-09-10',
277.             'date_1': '14:55:39',
278.         }
279.         response = self.client.post(reverse('admin:admin_views_article_add'), post_data)
280.         self.assertContains(response, 'title with a new\\nline')
281. 
282.     def test_basic_edit_POST(self):
283.         """
284.         A smoke test to ensure POST on edit_view works.
285.         """
286.         url = reverse('admin:admin_views_section_change', args=(self.s1.pk,))
287.         response = self.client.post(url, self.inline_post_data)
288.         self.assertEqual(response.status_code, 302)  # redirect somewhere
289. 
290.     def test_edit_save_as(self):
291.         """
292.         Test "save as".
293.         """
294.         post_data = self.inline_post_data.copy()
295.         post_data.update({
296.             '_saveasnew': 'Save+as+new',
297.             "article_set-1-section": "1",
298.             "article_set-2-section": "1",
299.             "article_set-3-section": "1",
300.             "article_set-4-section": "1",
301.             "article_set-5-section": "1",
302.         })
303.         response = self.client.post(reverse('admin:admin_views_section_change', args=(self.s1.pk,)), post_data)
304.         self.assertEqual(response.status_code, 302)  # redirect somewhere
305. 
306.     def test_edit_save_as_delete_inline(self):
307.         """
308.         Should be able to "Save as new" while also deleting an inline.
309.         """
310.         post_data = self.inline_post_data.copy()
311.         post_data.update({
312.             '_saveasnew': 'Save+as+new',
313.             "article_set-1-section": "1",
314.             "article_set-2-section": "1",
315.             "article_set-2-DELETE": "1",
316.             "article_set-3-section": "1",
317.         })
318.         response = self.client.post(reverse('admin:admin_views_section_change', args=(self.s1.pk,)), post_data)
319.         self.assertEqual(response.status_code, 302)
320.         # started with 3 articles, one was deleted.
321.         self.assertEqual(Section.objects.latest('id').article_set.count(), 2)
322. 
323.     def test_change_list_column_field_classes(self):
324.         response = self.client.get(reverse('admin:admin_views_article_changelist'))
325.         # callables display the callable name.
326.         self.assertContains(response, 'column-callable_year')
327.         self.assertContains(response, 'field-callable_year')
328.         # lambdas display as "lambda" + index that they appear in list_display.
329.         self.assertContains(response, 'column-lambda8')
330.         self.assertContains(response, 'field-lambda8')
331. 
332.     def test_change_list_sorting_callable(self):
333.         """
334.         Ensure we can sort on a list_display field that is a callable
335.         (column 2 is callable_year in ArticleAdmin)
336.         """
337.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': 2})
338.         self.assertContentBefore(
339.             response, 'Oldest content', 'Middle content',
340.             "Results of sorting on callable are out of order."
341.         )
342.         self.assertContentBefore(
343.             response, 'Middle content', 'Newest content',
344.             "Results of sorting on callable are out of order."
345.         )
346. 
347.     def test_change_list_sorting_property(self):
348.         """
349.         Sort on a list_display field that is a property (column 10 is
350.         a property in Article model).
351.         """
352.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': 10})
353.         self.assertContentBefore(
354.             response,
355.             'Oldest content',
356.             'Middle content',
357.             'Results of sorting on property are out of order.',
358.         )
359.         self.assertContentBefore(
360.             response,
361.             'Middle content',
362.             'Newest content',
363.             'Results of sorting on property are out of order.',
364.         )
365. 
366.     def test_change_list_sorting_callable_query_expression(self):
367.         """
368.         Query expressions may be used for admin_order_field. (column 9 is
369.         order_by_expression in ArticleAdmin).
370.         """
371.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': '9'})
372.         self.assertContentBefore(
373.             response, 'Oldest content', 'Middle content',
374.             'Results of sorting on callable are out of order.'
375.         )
376.         self.assertContentBefore(
377.             response, 'Middle content', 'Newest content',
378.             'Results of sorting on callable are out of order.'
379.         )
380. 
381.     def test_change_list_sorting_callable_query_expression_reverse(self):
382.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': '-9'})
383.         self.assertContentBefore(
384.             response, 'Middle content', 'Oldest content',
385.             'Results of sorting on callable are out of order.'
386.         )
387.         self.assertContentBefore(
388.             response, 'Newest content', 'Middle content',
389.             'Results of sorting on callable are out of order.'
390.         )
391. 
392.     def test_change_list_sorting_model(self):
393.         """
394.         Ensure we can sort on a list_display field that is a Model method
395.         (column 3 is 'model_year' in ArticleAdmin)
396.         """
397.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': '-3'})
398.         self.assertContentBefore(
399.             response, 'Newest content', 'Middle content',
400.             "Results of sorting on Model method are out of order."
401.         )
402.         self.assertContentBefore(
403.             response, 'Middle content', 'Oldest content',
404.             "Results of sorting on Model method are out of order."
405.         )
406. 
407.     def test_change_list_sorting_model_admin(self):
408.         """
409.         Ensure we can sort on a list_display field that is a ModelAdmin method
410.         (column 4 is 'modeladmin_year' in ArticleAdmin)
411.         """
412.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': '4'})
413.         self.assertContentBefore(
414.             response, 'Oldest content', 'Middle content',
415.             "Results of sorting on ModelAdmin method are out of order."
416.         )
417.         self.assertContentBefore(
418.             response, 'Middle content', 'Newest content',
419.             "Results of sorting on ModelAdmin method are out of order."
420.         )
421. 
422.     def test_change_list_sorting_model_admin_reverse(self):
423.         """
424.         Ensure we can sort on a list_display field that is a ModelAdmin
425.         method in reverse order (i.e. admin_order_field uses the '-' prefix)
426.         (column 6 is 'model_year_reverse' in ArticleAdmin)
427.         """
428.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': '6'})
429.         self.assertContentBefore(
430.             response, '2009', '2008',
431.             "Results of sorting on ModelAdmin method are out of order."
432.         )
433.         self.assertContentBefore(
434.             response, '2008', '2000',
435.             "Results of sorting on ModelAdmin method are out of order."
436.         )
437.         # Let's make sure the ordering is right and that we don't get a
438.         # FieldError when we change to descending order
439.         response = self.client.get(reverse('admin:admin_views_article_changelist'), {'o': '-6'})
440.         self.assertContentBefore(
441.             response, '2000', '2008',
442.             "Results of sorting on ModelAdmin method are out of order."
443.         )
444.         self.assertContentBefore(
445.             response, '2008', '2009',
446.             "Results of sorting on ModelAdmin method are out of order."
447.         )
448. 
449.     def test_change_list_sorting_multiple(self):
450.         p1 = Person.objects.create(name="Chris", gender=1, alive=True)
451.         p2 = Person.objects.create(name="Chris", gender=2, alive=True)
452.         p3 = Person.objects.create(name="Bob", gender=1, alive=True)
453.         link1 = reverse('admin:admin_views_person_change', args=(p1.pk,))
454.         link2 = reverse('admin:admin_views_person_change', args=(p2.pk,))
455.         link3 = reverse('admin:admin_views_person_change', args=(p3.pk,))
456. 
457.         # Sort by name, gender
458.         response = self.client.get(reverse('admin:admin_views_person_changelist'), {'o': '1.2'})
459.         self.assertContentBefore(response, link3, link1)
460.         self.assertContentBefore(response, link1, link2)
461. 
462.         # Sort by gender descending, name
463.         response = self.client.get(reverse('admin:admin_views_person_changelist'), {'o': '-2.1'})
464.         self.assertContentBefore(response, link2, link3)
465.         self.assertContentBefore(response, link3, link1)
466. 
467.     def test_change_list_sorting_preserve_queryset_ordering(self):
468.         """
469.         If no ordering is defined in `ModelAdmin.ordering` or in the query
470.         string, then the underlying order of the queryset should not be
471.         changed, even if it is defined in `Modeladmin.get_queryset()`.
472.         Refs #11868, #7309.
473.         """
474.         p1 = Person.objects.create(name="Amy", gender=1, alive=True, age=80)
475.         p2 = Person.objects.create(name="Bob", gender=1, alive=True, age=70)
476.         p3 = Person.objects.create(name="Chris", gender=2, alive=False, age=60)
477.         link1 = reverse('admin:admin_views_person_change', args=(p1.pk,))
478.         link2 = reverse('admin:admin_views_person_change', args=(p2.pk,))
479.         link3 = reverse('admin:admin_views_person_change', args=(p3.pk,))
480. 
481.         response = self.client.get(reverse('admin:admin_views_person_changelist'), {})
482.         self.assertContentBefore(response, link3, link2)
483.         self.assertContentBefore(response, link2, link1)
484. 
485.     def test_change_list_sorting_model_meta(self):
486.         # Test ordering on Model Meta is respected
487. 
488.         l1 = Language.objects.create(iso='ur', name='Urdu')
489.         l2 = Language.objects.create(iso='ar', name='Arabic')
490.         link1 = reverse('admin:admin_views_language_change', args=(quote(l1.pk),))
491.         link2 = reverse('admin:admin_views_language_change', args=(quote(l2.pk),))
492. 
493.         response = self.client.get(reverse('admin:admin_views_language_changelist'), {})
494.         self.assertContentBefore(response, link2, link1)
495. 
496.         # Test we can override with query string
497.         response = self.client.get(reverse('admin:admin_views_language_changelist'), {'o': '-1'})
498.         self.assertContentBefore(response, link1, link2)
499. 
500.     def test_change_list_sorting_override_model_admin(self):

File: tests/admin_views/tests.py
Line number range: 501 - 1001
Content:
501.         # Test ordering on Model Admin is respected, and overrides Model Meta
502.         dt = datetime.datetime.now()
503.         p1 = Podcast.objects.create(name="A", release_date=dt)
504.         p2 = Podcast.objects.create(name="B", release_date=dt - datetime.timedelta(10))
505.         link1 = reverse('admin:admin_views_podcast_change', args=(p1.pk,))
506.         link2 = reverse('admin:admin_views_podcast_change', args=(p2.pk,))
507. 
508.         response = self.client.get(reverse('admin:admin_views_podcast_changelist'), {})
509.         self.assertContentBefore(response, link1, link2)
510. 
511.     def test_multiple_sort_same_field(self):
512.         # The changelist displays the correct columns if two columns correspond
513.         # to the same ordering field.
514.         dt = datetime.datetime.now()
515.         p1 = Podcast.objects.create(name="A", release_date=dt)
516.         p2 = Podcast.objects.create(name="B", release_date=dt - datetime.timedelta(10))
517.         link1 = reverse('admin:admin_views_podcast_change', args=(quote(p1.pk),))
518.         link2 = reverse('admin:admin_views_podcast_change', args=(quote(p2.pk),))
519. 
520.         response = self.client.get(reverse('admin:admin_views_podcast_changelist'), {})
521.         self.assertContentBefore(response, link1, link2)
522. 
523.         p1 = ComplexSortedPerson.objects.create(name="Bob", age=10)
524.         p2 = ComplexSortedPerson.objects.create(name="Amy", age=20)
525.         link1 = reverse('admin:admin_views_complexsortedperson_change', args=(p1.pk,))
526.         link2 = reverse('admin:admin_views_complexsortedperson_change', args=(p2.pk,))
527. 
528.         response = self.client.get(reverse('admin:admin_views_complexsortedperson_changelist'), {})
529.         # Should have 5 columns (including action checkbox col)
530.         self.assertContains(response, '<th scope="col"', count=5)
531. 
532.         self.assertContains(response, 'Name')
533.         self.assertContains(response, 'Colored name')
534. 
535.         # Check order
536.         self.assertContentBefore(response, 'Name', 'Colored name')
537. 
538.         # Check sorting - should be by name
539.         self.assertContentBefore(response, link2, link1)
540. 
541.     def test_sort_indicators_admin_order(self):
542.         """
543.         The admin shows default sort indicators for all kinds of 'ordering'
544.         fields: field names, method on the model admin and model itself, and
545.         other callables. See #17252.
546.         """
547.         models = [(AdminOrderedField, 'adminorderedfield'),
548.                   (AdminOrderedModelMethod, 'adminorderedmodelmethod'),
549.                   (AdminOrderedAdminMethod, 'adminorderedadminmethod'),
550.                   (AdminOrderedCallable, 'adminorderedcallable')]
551.         for model, url in models:
552.             model.objects.create(stuff='The Last Item', order=3)
553.             model.objects.create(stuff='The First Item', order=1)
554.             model.objects.create(stuff='The Middle Item', order=2)
555.             response = self.client.get(reverse('admin:admin_views_%s_changelist' % url), {})
556.             self.assertEqual(response.status_code, 200)
557.             # Should have 3 columns including action checkbox col.
558.             self.assertContains(response, '<th scope="col"', count=3, msg_prefix=url)
559.             # Check if the correct column was selected. 2 is the index of the
560.             # 'order' column in the model admin's 'list_display' with 0 being
561.             # the implicit 'action_checkbox' and 1 being the column 'stuff'.
562.             self.assertEqual(response.context['cl'].get_ordering_field_columns(), {2: 'asc'})
563.             # Check order of records.
564.             self.assertContentBefore(response, 'The First Item', 'The Middle Item')
565.             self.assertContentBefore(response, 'The Middle Item', 'The Last Item')
566. 
567.     def test_has_related_field_in_list_display_fk(self):
568.         """Joins shouldn't be performed for <FK>_id fields in list display."""
569.         state = State.objects.create(name='Karnataka')
570.         City.objects.create(state=state, name='Bangalore')
571.         response = self.client.get(reverse('admin:admin_views_city_changelist'), {})
572. 
573.         response.context['cl'].list_display = ['id', 'name', 'state']
574.         self.assertIs(response.context['cl'].has_related_field_in_list_display(), True)
575. 
576.         response.context['cl'].list_display = ['id', 'name', 'state_id']
577.         self.assertIs(response.context['cl'].has_related_field_in_list_display(), False)
578. 
579.     def test_has_related_field_in_list_display_o2o(self):
580.         """Joins shouldn't be performed for <O2O>_id fields in list display."""
581.         media = Media.objects.create(name='Foo')
582.         Vodcast.objects.create(media=media)
583.         response = self.client.get(reverse('admin:admin_views_vodcast_changelist'), {})
584. 
585.         response.context['cl'].list_display = ['media']
586.         self.assertIs(response.context['cl'].has_related_field_in_list_display(), True)
587. 
588.         response.context['cl'].list_display = ['media_id']
589.         self.assertIs(response.context['cl'].has_related_field_in_list_display(), False)
590. 
591.     def test_limited_filter(self):
592.         """Ensure admin changelist filters do not contain objects excluded via limit_choices_to.
593.         This also tests relation-spanning filters (e.g. 'color__value').
594.         """
595.         response = self.client.get(reverse('admin:admin_views_thing_changelist'))
596.         self.assertContains(
597.             response, '<div id="changelist-filter">',
598.             msg_prefix="Expected filter not found in changelist view"
599.         )
600.         self.assertNotContains(
601.             response, '<a href="?color__id__exact=3">Blue</a>',
602.             msg_prefix="Changelist filter not correctly limited by limit_choices_to"
603.         )
604. 
605.     def test_relation_spanning_filters(self):
606.         changelist_url = reverse('admin:admin_views_chapterxtra1_changelist')
607.         response = self.client.get(changelist_url)
608.         self.assertContains(response, '<div id="changelist-filter">')
609.         filters = {
610.             'chap__id__exact': {
611.                 'values': [c.id for c in Chapter.objects.all()],
612.                 'test': lambda obj, value: obj.chap.id == value,
613.             },
614.             'chap__title': {
615.                 'values': [c.title for c in Chapter.objects.all()],
616.                 'test': lambda obj, value: obj.chap.title == value,
617.             },
618.             'chap__book__id__exact': {
619.                 'values': [b.id for b in Book.objects.all()],
620.                 'test': lambda obj, value: obj.chap.book.id == value,
621.             },
622.             'chap__book__name': {
623.                 'values': [b.name for b in Book.objects.all()],
624.                 'test': lambda obj, value: obj.chap.book.name == value,
625.             },
626.             'chap__book__promo__id__exact': {
627.                 'values': [p.id for p in Promo.objects.all()],
628.                 'test': lambda obj, value: obj.chap.book.promo_set.filter(id=value).exists(),
629.             },
630.             'chap__book__promo__name': {
631.                 'values': [p.name for p in Promo.objects.all()],
632.                 'test': lambda obj, value: obj.chap.book.promo_set.filter(name=value).exists(),
633.             },
634.             # A forward relation (book) after a reverse relation (promo).
635.             'guest_author__promo__book__id__exact': {
636.                 'values': [p.id for p in Book.objects.all()],
637.                 'test': lambda obj, value: obj.guest_author.promo_set.filter(book=value).exists(),
638.             },
639.         }
640.         for filter_path, params in filters.items():
641.             for value in params['values']:
642.                 query_string = urlencode({filter_path: value})
643.                 # ensure filter link exists
644.                 self.assertContains(response, '<a href="?%s"' % query_string)
645.                 # ensure link works
646.                 filtered_response = self.client.get('%s?%s' % (changelist_url, query_string))
647.                 self.assertEqual(filtered_response.status_code, 200)
648.                 # ensure changelist contains only valid objects
649.                 for obj in filtered_response.context['cl'].queryset.all():
650.                     self.assertTrue(params['test'](obj, value))
651. 
652.     def test_incorrect_lookup_parameters(self):
653.         """Ensure incorrect lookup parameters are handled gracefully."""
654.         changelist_url = reverse('admin:admin_views_thing_changelist')
655.         response = self.client.get(changelist_url, {'notarealfield': '5'})
656.         self.assertRedirects(response, '%s?e=1' % changelist_url)
657. 
658.         # Spanning relationships through a nonexistent related object (Refs #16716)
659.         response = self.client.get(changelist_url, {'notarealfield__whatever': '5'})
660.         self.assertRedirects(response, '%s?e=1' % changelist_url)
661. 
662.         response = self.client.get(changelist_url, {'color__id__exact': 'StringNotInteger!'})
663.         self.assertRedirects(response, '%s?e=1' % changelist_url)
664. 
665.         # Regression test for #18530
666.         response = self.client.get(changelist_url, {'pub_date__gte': 'foo'})
667.         self.assertRedirects(response, '%s?e=1' % changelist_url)
668. 
669.     def test_isnull_lookups(self):
670.         """Ensure is_null is handled correctly."""
671.         Article.objects.create(title="I Could Go Anywhere", content="Versatile", date=datetime.datetime.now())
672.         changelist_url = reverse('admin:admin_views_article_changelist')
673.         response = self.client.get(changelist_url)
674.         self.assertContains(response, '4 articles')
675.         response = self.client.get(changelist_url, {'section__isnull': 'false'})
676.         self.assertContains(response, '3 articles')
677.         response = self.client.get(changelist_url, {'section__isnull': '0'})
678.         self.assertContains(response, '3 articles')
679.         response = self.client.get(changelist_url, {'section__isnull': 'true'})
680.         self.assertContains(response, '1 article')
681.         response = self.client.get(changelist_url, {'section__isnull': '1'})
682.         self.assertContains(response, '1 article')
683. 
684.     def test_logout_and_password_change_URLs(self):
685.         response = self.client.get(reverse('admin:admin_views_article_changelist'))
686.         self.assertContains(response, '<a href="%s">' % reverse('admin:logout'))
687.         self.assertContains(response, '<a href="%s">' % reverse('admin:password_change'))
688. 
689.     def test_named_group_field_choices_change_list(self):
690.         """
691.         Ensures the admin changelist shows correct values in the relevant column
692.         for rows corresponding to instances of a model in which a named group
693.         has been used in the choices option of a field.
694.         """
695.         link1 = reverse('admin:admin_views_fabric_change', args=(self.fab1.pk,))
696.         link2 = reverse('admin:admin_views_fabric_change', args=(self.fab2.pk,))
697.         response = self.client.get(reverse('admin:admin_views_fabric_changelist'))
698.         fail_msg = (
699.             "Changelist table isn't showing the right human-readable values "
700.             "set by a model field 'choices' option named group."
701.         )
702.         self.assertContains(response, '<a href="%s">Horizontal</a>' % link1, msg_prefix=fail_msg, html=True)
703.         self.assertContains(response, '<a href="%s">Vertical</a>' % link2, msg_prefix=fail_msg, html=True)
704. 
705.     def test_named_group_field_choices_filter(self):
706.         """
707.         Ensures the filter UI shows correctly when at least one named group has
708.         been used in the choices option of a model field.
709.         """
710.         response = self.client.get(reverse('admin:admin_views_fabric_changelist'))
711.         fail_msg = (
712.             "Changelist filter isn't showing options contained inside a model "
713.             "field 'choices' option named group."
714.         )
715.         self.assertContains(response, '<div id="changelist-filter">')
716.         self.assertContains(
717.             response, '<a href="?surface__exact=x" title="Horizontal">Horizontal</a>',
718.             msg_prefix=fail_msg, html=True
719.         )
720.         self.assertContains(
721.             response, '<a href="?surface__exact=y" title="Vertical">Vertical</a>',
722.             msg_prefix=fail_msg, html=True
723.         )
724. 
725.     def test_change_list_null_boolean_display(self):
726.         Post.objects.create(public=None)
727.         response = self.client.get(reverse('admin:admin_views_post_changelist'))
728.         self.assertContains(response, 'icon-unknown.svg')
729. 
730.     def test_i18n_language_non_english_default(self):
731.         """
732.         Check if the JavaScript i18n view returns an empty language catalog
733.         if the default language is non-English but the selected language
734.         is English. See #13388 and #3594 for more details.
735.         """
736.         with self.settings(LANGUAGE_CODE='fr'), translation.override('en-us'):
737.             response = self.client.get(reverse('admin:jsi18n'))
738.             self.assertNotContains(response, 'Choisir une heure')
739. 
740.     def test_i18n_language_non_english_fallback(self):
741.         """
742.         Makes sure that the fallback language is still working properly
743.         in cases where the selected language cannot be found.
744.         """
745.         with self.settings(LANGUAGE_CODE='fr'), translation.override('none'):
746.             response = self.client.get(reverse('admin:jsi18n'))
747.             self.assertContains(response, 'Choisir une heure')
748. 
749.     def test_jsi18n_with_context(self):
750.         response = self.client.get(reverse('admin-extra-context:jsi18n'))
751.         self.assertEqual(response.status_code, 200)
752. 
753.     def test_L10N_deactivated(self):
754.         """
755.         Check if L10N is deactivated, the JavaScript i18n view doesn't
756.         return localized date/time formats. Refs #14824.
757.         """
758.         with self.settings(LANGUAGE_CODE='ru', USE_L10N=False), translation.override('none'):
759.             response = self.client.get(reverse('admin:jsi18n'))
760.             self.assertNotContains(response, '%d.%m.%Y %H:%M:%S')
761.             self.assertContains(response, '%Y-%m-%d %H:%M:%S')
762. 
763.     def test_disallowed_filtering(self):
764.         with self.assertLogs('django.security.DisallowedModelAdminLookup', 'ERROR'):
765.             response = self.client.get(
766.                 "%s?owner__email__startswith=fuzzy" % reverse('admin:admin_views_album_changelist')
767.             )
768.         self.assertEqual(response.status_code, 400)
769. 
770.         # Filters are allowed if explicitly included in list_filter
771.         response = self.client.get("%s?color__value__startswith=red" % reverse('admin:admin_views_thing_changelist'))
772.         self.assertEqual(response.status_code, 200)
773.         response = self.client.get("%s?color__value=red" % reverse('admin:admin_views_thing_changelist'))
774.         self.assertEqual(response.status_code, 200)
775. 
776.         # Filters should be allowed if they involve a local field without the
777.         # need to whitelist them in list_filter or date_hierarchy.
778.         response = self.client.get("%s?age__gt=30" % reverse('admin:admin_views_person_changelist'))
779.         self.assertEqual(response.status_code, 200)
780. 
781.         e1 = Employee.objects.create(name='Anonymous', gender=1, age=22, alive=True, code='123')
782.         e2 = Employee.objects.create(name='Visitor', gender=2, age=19, alive=True, code='124')
783.         WorkHour.objects.create(datum=datetime.datetime.now(), employee=e1)
784.         WorkHour.objects.create(datum=datetime.datetime.now(), employee=e2)
785.         response = self.client.get(reverse('admin:admin_views_workhour_changelist'))
786.         self.assertContains(response, 'employee__person_ptr__exact')
787.         response = self.client.get("%s?employee__person_ptr__exact=%d" % (
788.             reverse('admin:admin_views_workhour_changelist'), e1.pk)
789.         )
790.         self.assertEqual(response.status_code, 200)
791. 
792.     def test_disallowed_to_field(self):
793.         url = reverse('admin:admin_views_section_changelist')
794.         with self.assertLogs('django.security.DisallowedModelAdminToField', 'ERROR'):
795.             response = self.client.get(url, {TO_FIELD_VAR: 'missing_field'})
796.         self.assertEqual(response.status_code, 400)
797. 
798.         # Specifying a field that is not referred by any other model registered
799.         # to this admin site should raise an exception.
800.         with self.assertLogs('django.security.DisallowedModelAdminToField', 'ERROR'):
801.             response = self.client.get(reverse('admin:admin_views_section_changelist'), {TO_FIELD_VAR: 'name'})
802.         self.assertEqual(response.status_code, 400)
803. 
804.         # #23839 - Primary key should always be allowed, even if the referenced model isn't registered.
805.         response = self.client.get(reverse('admin:admin_views_notreferenced_changelist'), {TO_FIELD_VAR: 'id'})
806.         self.assertEqual(response.status_code, 200)
807. 
808.         # #23915 - Specifying a field referenced by another model though a m2m should be allowed.
809.         response = self.client.get(reverse('admin:admin_views_recipe_changelist'), {TO_FIELD_VAR: 'rname'})
810.         self.assertEqual(response.status_code, 200)
811. 
812.         # #23604, #23915 - Specifying a field referenced through a reverse m2m relationship should be allowed.
813.         response = self.client.get(reverse('admin:admin_views_ingredient_changelist'), {TO_FIELD_VAR: 'iname'})
814.         self.assertEqual(response.status_code, 200)
815. 
816.         # #23329 - Specifying a field that is not referred by any other model directly registered
817.         # to this admin site but registered through inheritance should be allowed.
818.         response = self.client.get(reverse('admin:admin_views_referencedbyparent_changelist'), {TO_FIELD_VAR: 'name'})
819.         self.assertEqual(response.status_code, 200)
820. 
821.         # #23431 - Specifying a field that is only referred to by a inline of a registered
822.         # model should be allowed.
823.         response = self.client.get(reverse('admin:admin_views_referencedbyinline_changelist'), {TO_FIELD_VAR: 'name'})
824.         self.assertEqual(response.status_code, 200)
825. 
826.         # #25622 - Specifying a field of a model only referred by a generic
827.         # relation should raise DisallowedModelAdminToField.
828.         url = reverse('admin:admin_views_referencedbygenrel_changelist')
829.         with self.assertLogs('django.security.DisallowedModelAdminToField', 'ERROR'):
830.             response = self.client.get(url, {TO_FIELD_VAR: 'object_id'})
831.         self.assertEqual(response.status_code, 400)
832. 
833.         # We also want to prevent the add, change, and delete views from
834.         # leaking a disallowed field value.
835.         with self.assertLogs('django.security.DisallowedModelAdminToField', 'ERROR'):
836.             response = self.client.post(reverse('admin:admin_views_section_add'), {TO_FIELD_VAR: 'name'})
837.         self.assertEqual(response.status_code, 400)
838. 
839.         section = Section.objects.create()
840.         url = reverse('admin:admin_views_section_change', args=(section.pk,))
841.         with self.assertLogs('django.security.DisallowedModelAdminToField', 'ERROR'):
842.             response = self.client.post(url, {TO_FIELD_VAR: 'name'})
843.         self.assertEqual(response.status_code, 400)
844. 
845.         url = reverse('admin:admin_views_section_delete', args=(section.pk,))
846.         with self.assertLogs('django.security.DisallowedModelAdminToField', 'ERROR'):
847.             response = self.client.post(url, {TO_FIELD_VAR: 'name'})
848.         self.assertEqual(response.status_code, 400)
849. 
850.     def test_allowed_filtering_15103(self):
851.         """
852.         Regressions test for ticket 15103 - filtering on fields defined in a
853.         ForeignKey 'limit_choices_to' should be allowed, otherwise raw_id_fields
854.         can break.
855.         """
856.         # Filters should be allowed if they are defined on a ForeignKey pointing to this model
857.         url = "%s?leader__name=Palin&leader__age=27" % reverse('admin:admin_views_inquisition_changelist')
858.         response = self.client.get(url)
859.         self.assertEqual(response.status_code, 200)
860. 
861.     def test_popup_dismiss_related(self):
862.         """
863.         Regression test for ticket 20664 - ensure the pk is properly quoted.
864.         """
865.         actor = Actor.objects.create(name="Palin", age=27)
866.         response = self.client.get("%s?%s" % (reverse('admin:admin_views_actor_changelist'), IS_POPUP_VAR))
867.         self.assertContains(response, 'data-popup-opener="%s"' % actor.pk)
868. 
869.     def test_hide_change_password(self):
870.         """
871.         Tests if the "change password" link in the admin is hidden if the User
872.         does not have a usable password set.
873.         (against 9bea85795705d015cdadc82c68b99196a8554f5c)
874.         """
875.         user = User.objects.get(username='super')
876.         user.set_unusable_password()
877.         user.save()
878.         self.client.force_login(user)
879.         response = self.client.get(reverse('admin:index'))
880.         self.assertNotContains(
881.             response, reverse('admin:password_change'),
882.             msg_prefix='The "change password" link should not be displayed if a user does not have a usable password.'
883.         )
884. 
885.     def test_change_view_with_show_delete_extra_context(self):
886.         """
887.         The 'show_delete' context variable in the admin's change view controls
888.         the display of the delete button.
889.         """
890.         instance = UndeletableObject.objects.create(name='foo')
891.         response = self.client.get(reverse('admin:admin_views_undeletableobject_change', args=(instance.pk,)))
892.         self.assertNotContains(response, 'deletelink')
893. 
894.     def test_change_view_logs_m2m_field_changes(self):
895.         """Changes to ManyToManyFields are included in the object's history."""
896.         pizza = ReadablePizza.objects.create(name='Cheese')
897.         cheese = Topping.objects.create(name='cheese')
898.         post_data = {'name': pizza.name, 'toppings': [cheese.pk]}
899.         response = self.client.post(reverse('admin:admin_views_readablepizza_change', args=(pizza.pk,)), post_data)
900.         self.assertRedirects(response, reverse('admin:admin_views_readablepizza_changelist'))
901.         pizza_ctype = ContentType.objects.get_for_model(ReadablePizza, for_concrete_model=False)
902.         log = LogEntry.objects.filter(content_type=pizza_ctype, object_id=pizza.pk).first()
903.         self.assertEqual(log.get_change_message(), 'Changed toppings.')
904. 
905.     def test_allows_attributeerror_to_bubble_up(self):
906.         """
907.         AttributeErrors are allowed to bubble when raised inside a change list
908.         view. Requires a model to be created so there's something to display.
909.         Refs: #16655, #18593, and #18747
910.         """
911.         Simple.objects.create()
912.         with self.assertRaises(AttributeError):
913.             self.client.get(reverse('admin:admin_views_simple_changelist'))
914. 
915.     def test_changelist_with_no_change_url(self):
916.         """
917.         ModelAdmin.changelist_view shouldn't result in a NoReverseMatch if url
918.         for change_view is removed from get_urls (#20934).
919.         """
920.         o = UnchangeableObject.objects.create()
921.         response = self.client.get(reverse('admin:admin_views_unchangeableobject_changelist'))
922.         self.assertEqual(response.status_code, 200)
923.         # Check the format of the shown object -- shouldn't contain a change link
924.         self.assertContains(response, '<th class="field-__str__">%s</th>' % o, html=True)
925. 
926.     def test_invalid_appindex_url(self):
927.         """
928.         #21056 -- URL reversing shouldn't work for nonexistent apps.
929.         """
930.         good_url = '/test_admin/admin/admin_views/'
931.         confirm_good_url = reverse('admin:app_list',
932.                                    kwargs={'app_label': 'admin_views'})
933.         self.assertEqual(good_url, confirm_good_url)
934. 
935.         with self.assertRaises(NoReverseMatch):
936.             reverse('admin:app_list', kwargs={'app_label': 'this_should_fail'})
937.         with self.assertRaises(NoReverseMatch):
938.             reverse('admin:app_list', args=('admin_views2',))
939. 
940.     def test_resolve_admin_views(self):
941.         index_match = resolve('/test_admin/admin4/')
942.         list_match = resolve('/test_admin/admin4/auth/user/')
943.         self.assertIs(index_match.func.admin_site, customadmin.simple_site)
944.         self.assertIsInstance(list_match.func.model_admin, customadmin.CustomPwdTemplateUserAdmin)
945. 
946.     def test_adminsite_display_site_url(self):
947.         """
948.         #13749 - Admin should display link to front-end site 'View site'
949.         """
950.         url = reverse('admin:index')
951.         response = self.client.get(url)
952.         self.assertEqual(response.context['site_url'], '/my-site-url/')
953.         self.assertContains(response, '<a href="/my-site-url/">View site</a>')
954. 
955.     @override_settings(TIME_ZONE='America/Sao_Paulo', USE_TZ=True)
956.     def test_date_hierarchy_timezone_dst(self):
957.         # This datetime doesn't exist in this timezone due to DST.
958.         date = pytz.timezone('America/Sao_Paulo').localize(datetime.datetime(2016, 10, 16, 15), is_dst=None)
959.         q = Question.objects.create(question='Why?', expires=date)
960.         Answer2.objects.create(question=q, answer='Because.')
961.         response = self.client.get(reverse('admin:admin_views_answer2_changelist'))
962.         self.assertEqual(response.status_code, 200)
963.         self.assertContains(response, 'question__expires__day=16')
964.         self.assertContains(response, 'question__expires__month=10')
965.         self.assertContains(response, 'question__expires__year=2016')
966. 
967.     def test_sortable_by_columns_subset(self):
968.         expected_sortable_fields = ('date', 'callable_year')
969.         expected_not_sortable_fields = (
970.             'content', 'model_year', 'modeladmin_year', 'model_year_reversed',
971.             'section',
972.         )
973.         response = self.client.get(reverse('admin6:admin_views_article_changelist'))
974.         for field_name in expected_sortable_fields:
975.             self.assertContains(response, '<th scope="col"  class="sortable column-%s">' % field_name)
976.         for field_name in expected_not_sortable_fields:
977.             self.assertContains(response, '<th scope="col"  class="column-%s">' % field_name)
978. 
979.     def test_get_sortable_by_columns_subset(self):
980.         response = self.client.get(reverse('admin6:admin_views_actor_changelist'))
981.         self.assertContains(response, '<th scope="col"  class="sortable column-age">')
982.         self.assertContains(response, '<th scope="col"  class="column-name">')
983. 
984.     def test_sortable_by_no_column(self):
985.         expected_not_sortable_fields = ('title', 'book')
986.         response = self.client.get(reverse('admin6:admin_views_chapter_changelist'))
987.         for field_name in expected_not_sortable_fields:
988.             self.assertContains(response, '<th scope="col"  class="column-%s">' % field_name)
989.         self.assertNotContains(response, '<th scope="col"  class="sortable column')
990. 
991.     def test_get_sortable_by_no_column(self):
992.         response = self.client.get(reverse('admin6:admin_views_color_changelist'))
993.         self.assertContains(response, '<th scope="col"  class="column-value">')
994.         self.assertNotContains(response, '<th scope="col"  class="sortable column')
995. 
996. 
997. @override_settings(TEMPLATES=[{
998.     'BACKEND': 'django.template.backends.django.DjangoTemplates',
999.     # Put this app's and the shared tests templates dirs in DIRS to take precedence
1000.     # over the admin's templates dir.
1001.     'DIRS': [

File: tests/admin_views/tests.py
Line number range: 1001 - 1501
Content:
1001.     'DIRS': [
1002.         os.path.join(os.path.dirname(__file__), 'templates'),
1003.         os.path.join(os.path.dirname(os.path.dirname(__file__)), 'templates'),
1004.     ],
1005.     'APP_DIRS': True,
1006.     'OPTIONS': {
1007.         'context_processors': [
1008.             'django.template.context_processors.debug',
1009.             'django.template.context_processors.request',
1010.             'django.contrib.auth.context_processors.auth',
1011.             'django.contrib.messages.context_processors.messages',
1012.         ],
1013.     },
1014. }])
1015. class AdminCustomTemplateTests(AdminViewBasicTestCase):
1016.     def test_custom_model_admin_templates(self):
1017.         # Test custom change list template with custom extra context
1018.         response = self.client.get(reverse('admin:admin_views_customarticle_changelist'))
1019.         self.assertContains(response, "var hello = 'Hello!';")
1020.         self.assertTemplateUsed(response, 'custom_admin/change_list.html')
1021. 
1022.         # Test custom add form template
1023.         response = self.client.get(reverse('admin:admin_views_customarticle_add'))
1024.         self.assertTemplateUsed(response, 'custom_admin/add_form.html')
1025. 
1026.         # Add an article so we can test delete, change, and history views
1027.         post = self.client.post(reverse('admin:admin_views_customarticle_add'), {
1028.             'content': '<p>great article</p>',
1029.             'date_0': '2008-03-18',
1030.             'date_1': '10:54:39'
1031.         })
1032.         self.assertRedirects(post, reverse('admin:admin_views_customarticle_changelist'))
1033.         self.assertEqual(CustomArticle.objects.all().count(), 1)
1034.         article_pk = CustomArticle.objects.all()[0].pk
1035. 
1036.         # Test custom delete, change, and object history templates
1037.         # Test custom change form template
1038.         response = self.client.get(reverse('admin:admin_views_customarticle_change', args=(article_pk,)))
1039.         self.assertTemplateUsed(response, 'custom_admin/change_form.html')
1040.         response = self.client.get(reverse('admin:admin_views_customarticle_delete', args=(article_pk,)))
1041.         self.assertTemplateUsed(response, 'custom_admin/delete_confirmation.html')
1042.         response = self.client.post(reverse('admin:admin_views_customarticle_changelist'), data={
1043.             'index': 0,
1044.             'action': ['delete_selected'],
1045.             '_selected_action': ['1'],
1046.         })
1047.         self.assertTemplateUsed(response, 'custom_admin/delete_selected_confirmation.html')
1048.         response = self.client.get(reverse('admin:admin_views_customarticle_history', args=(article_pk,)))
1049.         self.assertTemplateUsed(response, 'custom_admin/object_history.html')
1050. 
1051.         # A custom popup response template may be specified by
1052.         # ModelAdmin.popup_response_template.
1053.         response = self.client.post(reverse('admin:admin_views_customarticle_add') + '?%s=1' % IS_POPUP_VAR, {
1054.             'content': '<p>great article</p>',
1055.             'date_0': '2008-03-18',
1056.             'date_1': '10:54:39',
1057.             IS_POPUP_VAR: '1'
1058.         })
1059.         self.assertEqual(response.template_name, 'custom_admin/popup_response.html')
1060. 
1061.     def test_extended_bodyclass_template_change_form(self):
1062.         """
1063.         The admin/change_form.html template uses block.super in the
1064.         bodyclass block.
1065.         """
1066.         response = self.client.get(reverse('admin:admin_views_section_add'))
1067.         self.assertContains(response, 'bodyclass_consistency_check ')
1068. 
1069.     def test_change_password_template(self):
1070.         user = User.objects.get(username='super')
1071.         response = self.client.get(reverse('admin:auth_user_password_change', args=(user.id,)))
1072.         # The auth/user/change_password.html template uses super in the
1073.         # bodyclass block.
1074.         self.assertContains(response, 'bodyclass_consistency_check ')
1075. 
1076.         # When a site has multiple passwords in the browser's password manager,
1077.         # a browser pop up asks which user the new password is for. To prevent
1078.         # this, the username is added to the change password form.
1079.         self.assertContains(response, '<input type="text" name="username" value="super" style="display: none">')
1080. 
1081.     def test_extended_bodyclass_template_index(self):
1082.         """
1083.         The admin/index.html template uses block.super in the bodyclass block.
1084.         """
1085.         response = self.client.get(reverse('admin:index'))
1086.         self.assertContains(response, 'bodyclass_consistency_check ')
1087. 
1088.     def test_extended_bodyclass_change_list(self):
1089.         """
1090.         The admin/change_list.html' template uses block.super
1091.         in the bodyclass block.
1092.         """
1093.         response = self.client.get(reverse('admin:admin_views_article_changelist'))
1094.         self.assertContains(response, 'bodyclass_consistency_check ')
1095. 
1096.     def test_extended_bodyclass_template_login(self):
1097.         """
1098.         The admin/login.html template uses block.super in the
1099.         bodyclass block.
1100.         """
1101.         self.client.logout()
1102.         response = self.client.get(reverse('admin:login'))
1103.         self.assertContains(response, 'bodyclass_consistency_check ')
1104. 
1105.     def test_extended_bodyclass_template_delete_confirmation(self):
1106.         """
1107.         The admin/delete_confirmation.html template uses
1108.         block.super in the bodyclass block.
1109.         """
1110.         group = Group.objects.create(name="foogroup")
1111.         response = self.client.get(reverse('admin:auth_group_delete', args=(group.id,)))
1112.         self.assertContains(response, 'bodyclass_consistency_check ')
1113. 
1114.     def test_extended_bodyclass_template_delete_selected_confirmation(self):
1115.         """
1116.         The admin/delete_selected_confirmation.html template uses
1117.         block.super in bodyclass block.
1118.         """
1119.         group = Group.objects.create(name="foogroup")
1120.         post_data = {
1121.             'action': 'delete_selected',
1122.             'selected_across': '0',
1123.             'index': '0',
1124.             '_selected_action': group.id
1125.         }
1126.         response = self.client.post(reverse('admin:auth_group_changelist'), post_data)
1127.         self.assertEqual(response.context['site_header'], 'Django administration')
1128.         self.assertContains(response, 'bodyclass_consistency_check ')
1129. 
1130.     def test_filter_with_custom_template(self):
1131.         """
1132.         A custom template can be used to render an admin filter.
1133.         """
1134.         response = self.client.get(reverse('admin:admin_views_color2_changelist'))
1135.         self.assertTemplateUsed(response, 'custom_filter_template.html')
1136. 
1137. 
1138. @override_settings(ROOT_URLCONF='admin_views.urls')
1139. class AdminViewFormUrlTest(TestCase):
1140.     current_app = "admin3"
1141. 
1142.     @classmethod
1143.     def setUpTestData(cls):
1144.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
1145.         cls.s1 = Section.objects.create(name='Test section')
1146.         cls.a1 = Article.objects.create(
1147.             content='<p>Middle content</p>', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1
1148.         )
1149.         cls.a2 = Article.objects.create(
1150.             content='<p>Oldest content</p>', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1
1151.         )
1152.         cls.a3 = Article.objects.create(
1153.             content='<p>Newest content</p>', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1
1154.         )
1155.         cls.p1 = PrePopulatedPost.objects.create(title='A Long Title', published=True, slug='a-long-title')
1156. 
1157.     def setUp(self):
1158.         self.client.force_login(self.superuser)
1159. 
1160.     def test_change_form_URL_has_correct_value(self):
1161.         """
1162.         change_view has form_url in response.context
1163.         """
1164.         response = self.client.get(
1165.             reverse('admin:admin_views_section_change', args=(self.s1.pk,), current_app=self.current_app)
1166.         )
1167.         self.assertIn('form_url', response.context, msg='form_url not present in response.context')
1168.         self.assertEqual(response.context['form_url'], 'pony')
1169. 
1170.     def test_initial_data_can_be_overridden(self):
1171.         """
1172.         The behavior for setting initial form data can be overridden in the
1173.         ModelAdmin class. Usually, the initial value is set via the GET params.
1174.         """
1175.         response = self.client.get(
1176.             reverse('admin:admin_views_restaurant_add', current_app=self.current_app),
1177.             {'name': 'test_value'}
1178.         )
1179.         # this would be the usual behaviour
1180.         self.assertNotContains(response, 'value="test_value"')
1181.         # this is the overridden behaviour
1182.         self.assertContains(response, 'value="overridden_value"')
1183. 
1184. 
1185. @override_settings(ROOT_URLCONF='admin_views.urls')
1186. class AdminJavaScriptTest(TestCase):
1187. 
1188.     @classmethod
1189.     def setUpTestData(cls):
1190.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
1191. 
1192.     def setUp(self):
1193.         self.client.force_login(self.superuser)
1194. 
1195.     def test_js_minified_only_if_debug_is_false(self):
1196.         """
1197.         The minified versions of the JS files are only used when DEBUG is False.
1198.         """
1199.         with override_settings(DEBUG=False):
1200.             response = self.client.get(reverse('admin:admin_views_section_add'))
1201.             self.assertNotContains(response, 'vendor/jquery/jquery.js')
1202.             self.assertContains(response, 'vendor/jquery/jquery.min.js')
1203.             self.assertNotContains(response, 'prepopulate.js')
1204.             self.assertContains(response, 'prepopulate.min.js')
1205.             self.assertNotContains(response, 'actions.js')
1206.             self.assertContains(response, 'actions.min.js')
1207.             self.assertNotContains(response, 'collapse.js')
1208.             self.assertContains(response, 'collapse.min.js')
1209.             self.assertNotContains(response, 'inlines.js')
1210.             self.assertContains(response, 'inlines.min.js')
1211.         with override_settings(DEBUG=True):
1212.             response = self.client.get(reverse('admin:admin_views_section_add'))
1213.             self.assertContains(response, 'vendor/jquery/jquery.js')
1214.             self.assertNotContains(response, 'vendor/jquery/jquery.min.js')
1215.             self.assertContains(response, 'prepopulate.js')
1216.             self.assertNotContains(response, 'prepopulate.min.js')
1217.             self.assertContains(response, 'actions.js')
1218.             self.assertNotContains(response, 'actions.min.js')
1219.             self.assertContains(response, 'collapse.js')
1220.             self.assertNotContains(response, 'collapse.min.js')
1221.             self.assertContains(response, 'inlines.js')
1222.             self.assertNotContains(response, 'inlines.min.js')
1223. 
1224. 
1225. @override_settings(ROOT_URLCONF='admin_views.urls')
1226. class SaveAsTests(TestCase):
1227. 
1228.     @classmethod
1229.     def setUpTestData(cls):
1230.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
1231.         cls.per1 = Person.objects.create(name='John Mauchly', gender=1, alive=True)
1232. 
1233.     def setUp(self):
1234.         self.client.force_login(self.superuser)
1235. 
1236.     def test_save_as_duplication(self):
1237.         """'save as' creates a new person"""
1238.         post_data = {'_saveasnew': '', 'name': 'John M', 'gender': 1, 'age': 42}
1239.         response = self.client.post(reverse('admin:admin_views_person_change', args=(self.per1.pk,)), post_data)
1240.         self.assertEqual(len(Person.objects.filter(name='John M')), 1)
1241.         self.assertEqual(len(Person.objects.filter(id=self.per1.pk)), 1)
1242.         new_person = Person.objects.latest('id')
1243.         self.assertRedirects(response, reverse('admin:admin_views_person_change', args=(new_person.pk,)))
1244. 
1245.     def test_save_as_continue_false(self):
1246.         """
1247.         Saving a new object using "Save as new" redirects to the changelist
1248.         instead of the change view when ModelAdmin.save_as_continue=False.
1249.         """
1250.         post_data = {'_saveasnew': '', 'name': 'John M', 'gender': 1, 'age': 42}
1251.         url = reverse('admin:admin_views_person_change', args=(self.per1.pk,), current_app=site2.name)
1252.         response = self.client.post(url, post_data)
1253.         self.assertEqual(len(Person.objects.filter(name='John M')), 1)
1254.         self.assertEqual(len(Person.objects.filter(id=self.per1.pk)), 1)
1255.         self.assertRedirects(response, reverse('admin:admin_views_person_changelist', current_app=site2.name))
1256. 
1257.     def test_save_as_new_with_validation_errors(self):
1258.         """
1259.         When you click "Save as new" and have a validation error,
1260.         you only see the "Save as new" button and not the other save buttons,
1261.         and that only the "Save as" button is visible.
1262.         """
1263.         response = self.client.post(reverse('admin:admin_views_person_change', args=(self.per1.pk,)), {
1264.             '_saveasnew': '',
1265.             'gender': 'invalid',
1266.             '_addanother': 'fail',
1267.         })
1268.         self.assertContains(response, 'Please correct the errors below.')
1269.         self.assertFalse(response.context['show_save_and_add_another'])
1270.         self.assertFalse(response.context['show_save_and_continue'])
1271.         self.assertTrue(response.context['show_save_as_new'])
1272. 
1273.     def test_save_as_new_with_validation_errors_with_inlines(self):
1274.         parent = Parent.objects.create(name='Father')
1275.         child = Child.objects.create(parent=parent, name='Child')
1276.         response = self.client.post(reverse('admin:admin_views_parent_change', args=(parent.pk,)), {
1277.             '_saveasnew': 'Save as new',
1278.             'child_set-0-parent': parent.pk,
1279.             'child_set-0-id': child.pk,
1280.             'child_set-0-name': 'Child',
1281.             'child_set-INITIAL_FORMS': 1,
1282.             'child_set-MAX_NUM_FORMS': 1000,
1283.             'child_set-MIN_NUM_FORMS': 0,
1284.             'child_set-TOTAL_FORMS': 4,
1285.             'name': '_invalid',
1286.         })
1287.         self.assertContains(response, 'Please correct the error below.')
1288.         self.assertFalse(response.context['show_save_and_add_another'])
1289.         self.assertFalse(response.context['show_save_and_continue'])
1290.         self.assertTrue(response.context['show_save_as_new'])
1291. 
1292.     def test_save_as_new_with_inlines_with_validation_errors(self):
1293.         parent = Parent.objects.create(name='Father')
1294.         child = Child.objects.create(parent=parent, name='Child')
1295.         response = self.client.post(reverse('admin:admin_views_parent_change', args=(parent.pk,)), {
1296.             '_saveasnew': 'Save as new',
1297.             'child_set-0-parent': parent.pk,
1298.             'child_set-0-id': child.pk,
1299.             'child_set-0-name': '_invalid',
1300.             'child_set-INITIAL_FORMS': 1,
1301.             'child_set-MAX_NUM_FORMS': 1000,
1302.             'child_set-MIN_NUM_FORMS': 0,
1303.             'child_set-TOTAL_FORMS': 4,
1304.             'name': 'Father',
1305.         })
1306.         self.assertContains(response, 'Please correct the error below.')
1307.         self.assertFalse(response.context['show_save_and_add_another'])
1308.         self.assertFalse(response.context['show_save_and_continue'])
1309.         self.assertTrue(response.context['show_save_as_new'])
1310. 
1311. 
1312. @override_settings(ROOT_URLCONF='admin_views.urls')
1313. class CustomModelAdminTest(AdminViewBasicTestCase):
1314. 
1315.     def test_custom_admin_site_login_form(self):
1316.         self.client.logout()
1317.         response = self.client.get(reverse('admin2:index'), follow=True)
1318.         self.assertIsInstance(response, TemplateResponse)
1319.         self.assertEqual(response.status_code, 200)
1320.         login = self.client.post(reverse('admin2:login'), {
1321.             REDIRECT_FIELD_NAME: reverse('admin2:index'),
1322.             'username': 'customform',
1323.             'password': 'secret',
1324.         }, follow=True)
1325.         self.assertIsInstance(login, TemplateResponse)
1326.         self.assertEqual(login.status_code, 200)
1327.         self.assertContains(login, 'custom form error')
1328.         self.assertContains(login, 'path/to/media.css')
1329. 
1330.     def test_custom_admin_site_login_template(self):
1331.         self.client.logout()
1332.         response = self.client.get(reverse('admin2:index'), follow=True)
1333.         self.assertIsInstance(response, TemplateResponse)
1334.         self.assertTemplateUsed(response, 'custom_admin/login.html')
1335.         self.assertContains(response, 'Hello from a custom login template')
1336. 
1337.     def test_custom_admin_site_logout_template(self):
1338.         response = self.client.get(reverse('admin2:logout'))
1339.         self.assertIsInstance(response, TemplateResponse)
1340.         self.assertTemplateUsed(response, 'custom_admin/logout.html')
1341.         self.assertContains(response, 'Hello from a custom logout template')
1342. 
1343.     def test_custom_admin_site_index_view_and_template(self):
1344.         response = self.client.get(reverse('admin2:index'))
1345.         self.assertIsInstance(response, TemplateResponse)
1346.         self.assertTemplateUsed(response, 'custom_admin/index.html')
1347.         self.assertContains(response, 'Hello from a custom index template *bar*')
1348. 
1349.     def test_custom_admin_site_app_index_view_and_template(self):
1350.         response = self.client.get(reverse('admin2:app_list', args=('admin_views',)))
1351.         self.assertIsInstance(response, TemplateResponse)
1352.         self.assertTemplateUsed(response, 'custom_admin/app_index.html')
1353.         self.assertContains(response, 'Hello from a custom app_index template')
1354. 
1355.     def test_custom_admin_site_password_change_template(self):
1356.         response = self.client.get(reverse('admin2:password_change'))
1357.         self.assertIsInstance(response, TemplateResponse)
1358.         self.assertTemplateUsed(response, 'custom_admin/password_change_form.html')
1359.         self.assertContains(response, 'Hello from a custom password change form template')
1360. 
1361.     def test_custom_admin_site_password_change_with_extra_context(self):
1362.         response = self.client.get(reverse('admin2:password_change'))
1363.         self.assertIsInstance(response, TemplateResponse)
1364.         self.assertTemplateUsed(response, 'custom_admin/password_change_form.html')
1365.         self.assertContains(response, 'eggs')
1366. 
1367.     def test_custom_admin_site_password_change_done_template(self):
1368.         response = self.client.get(reverse('admin2:password_change_done'))
1369.         self.assertIsInstance(response, TemplateResponse)
1370.         self.assertTemplateUsed(response, 'custom_admin/password_change_done.html')
1371.         self.assertContains(response, 'Hello from a custom password change done template')
1372. 
1373.     def test_custom_admin_site_view(self):
1374.         self.client.force_login(self.superuser)
1375.         response = self.client.get(reverse('admin2:my_view'))
1376.         self.assertEqual(response.content, b"Django is a magical pony!")
1377. 
1378.     def test_pwd_change_custom_template(self):
1379.         self.client.force_login(self.superuser)
1380.         su = User.objects.get(username='super')
1381.         response = self.client.get(reverse('admin4:auth_user_password_change', args=(su.pk,)))
1382.         self.assertEqual(response.status_code, 200)
1383. 
1384. 
1385. def get_perm(Model, codename):
1386.     """Return the permission object, for the Model"""
1387.     ct = ContentType.objects.get_for_model(Model, for_concrete_model=False)
1388.     return Permission.objects.get(content_type=ct, codename=codename)
1389. 
1390. 
1391. @override_settings(
1392.     ROOT_URLCONF='admin_views.urls',
1393.     # Test with the admin's documented list of required context processors.
1394.     TEMPLATES=[{
1395.         'BACKEND': 'django.template.backends.django.DjangoTemplates',
1396.         'APP_DIRS': True,
1397.         'OPTIONS': {
1398.             'context_processors': [
1399.                 'django.contrib.auth.context_processors.auth',
1400.                 'django.contrib.messages.context_processors.messages',
1401.             ],
1402.         },
1403.     }],
1404. )
1405. class AdminViewPermissionsTest(TestCase):
1406.     """Tests for Admin Views Permissions."""
1407. 
1408.     @classmethod
1409.     def setUpTestData(cls):
1410.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
1411.         cls.viewuser = User.objects.create_user(username='viewuser', password='secret', is_staff=True)
1412.         cls.adduser = User.objects.create_user(username='adduser', password='secret', is_staff=True)
1413.         cls.changeuser = User.objects.create_user(username='changeuser', password='secret', is_staff=True)
1414.         cls.deleteuser = User.objects.create_user(username='deleteuser', password='secret', is_staff=True)
1415.         cls.joepublicuser = User.objects.create_user(username='joepublic', password='secret')
1416.         cls.nostaffuser = User.objects.create_user(username='nostaff', password='secret')
1417.         cls.s1 = Section.objects.create(name='Test section')
1418.         cls.a1 = Article.objects.create(
1419.             content='<p>Middle content</p>', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1,
1420.             another_section=cls.s1,
1421.         )
1422.         cls.a2 = Article.objects.create(
1423.             content='<p>Oldest content</p>', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1
1424.         )
1425.         cls.a3 = Article.objects.create(
1426.             content='<p>Newest content</p>', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1
1427.         )
1428.         cls.p1 = PrePopulatedPost.objects.create(title='A Long Title', published=True, slug='a-long-title')
1429. 
1430.         # Setup permissions, for our users who can add, change, and delete.
1431.         opts = Article._meta
1432. 
1433.         # User who can view Articles
1434.         cls.viewuser.user_permissions.add(get_perm(Article, get_permission_codename('view', opts)))
1435.         # User who can add Articles
1436.         cls.adduser.user_permissions.add(get_perm(Article, get_permission_codename('add', opts)))
1437.         # User who can change Articles
1438.         cls.changeuser.user_permissions.add(get_perm(Article, get_permission_codename('change', opts)))
1439.         cls.nostaffuser.user_permissions.add(get_perm(Article, get_permission_codename('change', opts)))
1440. 
1441.         # User who can delete Articles
1442.         cls.deleteuser.user_permissions.add(get_perm(Article, get_permission_codename('delete', opts)))
1443.         cls.deleteuser.user_permissions.add(get_perm(Section, get_permission_codename('delete', Section._meta)))
1444. 
1445.         # login POST dicts
1446.         cls.index_url = reverse('admin:index')
1447.         cls.super_login = {
1448.             REDIRECT_FIELD_NAME: cls.index_url,
1449.             'username': 'super',
1450.             'password': 'secret',
1451.         }
1452.         cls.super_email_login = {
1453.             REDIRECT_FIELD_NAME: cls.index_url,
1454.             'username': 'super@example.com',
1455.             'password': 'secret',
1456.         }
1457.         cls.super_email_bad_login = {
1458.             REDIRECT_FIELD_NAME: cls.index_url,
1459.             'username': 'super@example.com',
1460.             'password': 'notsecret',
1461.         }
1462.         cls.adduser_login = {
1463.             REDIRECT_FIELD_NAME: cls.index_url,
1464.             'username': 'adduser',
1465.             'password': 'secret',
1466.         }
1467.         cls.changeuser_login = {
1468.             REDIRECT_FIELD_NAME: cls.index_url,
1469.             'username': 'changeuser',
1470.             'password': 'secret',
1471.         }
1472.         cls.deleteuser_login = {
1473.             REDIRECT_FIELD_NAME: cls.index_url,
1474.             'username': 'deleteuser',
1475.             'password': 'secret',
1476.         }
1477.         cls.nostaff_login = {
1478.             REDIRECT_FIELD_NAME: reverse('has_permission_admin:index'),
1479.             'username': 'nostaff',
1480.             'password': 'secret',
1481.         }
1482.         cls.joepublic_login = {
1483.             REDIRECT_FIELD_NAME: cls.index_url,
1484.             'username': 'joepublic',
1485.             'password': 'secret',
1486.         }
1487.         cls.viewuser_login = {
1488.             REDIRECT_FIELD_NAME: cls.index_url,
1489.             'username': 'viewuser',
1490.             'password': 'secret',
1491.         }
1492.         cls.no_username_login = {
1493.             REDIRECT_FIELD_NAME: cls.index_url,
1494.             'password': 'secret',
1495.         }
1496. 
1497.     def test_login(self):
1498.         """
1499.         Make sure only staff members can log in.
1500. 
1501.         Successful posts to the login page will redirect to the original url.

File: tests/admin_views/tests.py
Line number range: 1501 - 2001
Content:
1501.         Successful posts to the login page will redirect to the original url.
1502.         Unsuccessful attempts will continue to render the login page with
1503.         a 200 status code.
1504.         """
1505.         login_url = '%s?next=%s' % (reverse('admin:login'), reverse('admin:index'))
1506.         # Super User
1507.         response = self.client.get(self.index_url)
1508.         self.assertRedirects(response, login_url)
1509.         login = self.client.post(login_url, self.super_login)
1510.         self.assertRedirects(login, self.index_url)
1511.         self.assertFalse(login.context)
1512.         self.client.get(reverse('admin:logout'))
1513. 
1514.         # Test if user enters email address
1515.         response = self.client.get(self.index_url)
1516.         self.assertEqual(response.status_code, 302)
1517.         login = self.client.post(login_url, self.super_email_login)
1518.         self.assertContains(login, ERROR_MESSAGE)
1519.         # only correct passwords get a username hint
1520.         login = self.client.post(login_url, self.super_email_bad_login)
1521.         self.assertContains(login, ERROR_MESSAGE)
1522.         new_user = User(username='jondoe', password='secret', email='super@example.com')
1523.         new_user.save()
1524.         # check to ensure if there are multiple email addresses a user doesn't get a 500
1525.         login = self.client.post(login_url, self.super_email_login)
1526.         self.assertContains(login, ERROR_MESSAGE)
1527. 
1528.         # View User
1529.         response = self.client.get(self.index_url)
1530.         self.assertEqual(response.status_code, 302)
1531.         login = self.client.post(login_url, self.viewuser_login)
1532.         self.assertRedirects(login, self.index_url)
1533.         self.assertFalse(login.context)
1534.         self.client.get(reverse('admin:logout'))
1535. 
1536.         # Add User
1537.         response = self.client.get(self.index_url)
1538.         self.assertEqual(response.status_code, 302)
1539.         login = self.client.post(login_url, self.adduser_login)
1540.         self.assertRedirects(login, self.index_url)
1541.         self.assertFalse(login.context)
1542.         self.client.get(reverse('admin:logout'))
1543. 
1544.         # Change User
1545.         response = self.client.get(self.index_url)
1546.         self.assertEqual(response.status_code, 302)
1547.         login = self.client.post(login_url, self.changeuser_login)
1548.         self.assertRedirects(login, self.index_url)
1549.         self.assertFalse(login.context)
1550.         self.client.get(reverse('admin:logout'))
1551. 
1552.         # Delete User
1553.         response = self.client.get(self.index_url)
1554.         self.assertEqual(response.status_code, 302)
1555.         login = self.client.post(login_url, self.deleteuser_login)
1556.         self.assertRedirects(login, self.index_url)
1557.         self.assertFalse(login.context)
1558.         self.client.get(reverse('admin:logout'))
1559. 
1560.         # Regular User should not be able to login.
1561.         response = self.client.get(self.index_url)
1562.         self.assertEqual(response.status_code, 302)
1563.         login = self.client.post(login_url, self.joepublic_login)
1564.         self.assertEqual(login.status_code, 200)
1565.         self.assertContains(login, ERROR_MESSAGE)
1566. 
1567.         # Requests without username should not return 500 errors.
1568.         response = self.client.get(self.index_url)
1569.         self.assertEqual(response.status_code, 302)
1570.         login = self.client.post(login_url, self.no_username_login)
1571.         self.assertEqual(login.status_code, 200)
1572.         self.assertFormError(login, 'form', 'username', ['This field is required.'])
1573. 
1574.     def test_login_redirect_for_direct_get(self):
1575.         """
1576.         Login redirect should be to the admin index page when going directly to
1577.         /admin/login/.
1578.         """
1579.         response = self.client.get(reverse('admin:login'))
1580.         self.assertEqual(response.status_code, 200)
1581.         self.assertEqual(response.context[REDIRECT_FIELD_NAME], reverse('admin:index'))
1582. 
1583.     def test_login_has_permission(self):
1584.         # Regular User should not be able to login.
1585.         response = self.client.get(reverse('has_permission_admin:index'))
1586.         self.assertEqual(response.status_code, 302)
1587.         login = self.client.post(reverse('has_permission_admin:login'), self.joepublic_login)
1588.         self.assertEqual(login.status_code, 200)
1589.         self.assertContains(login, 'permission denied')
1590. 
1591.         # User with permissions should be able to login.
1592.         response = self.client.get(reverse('has_permission_admin:index'))
1593.         self.assertEqual(response.status_code, 302)
1594.         login = self.client.post(reverse('has_permission_admin:login'), self.nostaff_login)
1595.         self.assertRedirects(login, reverse('has_permission_admin:index'))
1596.         self.assertFalse(login.context)
1597.         self.client.get(reverse('has_permission_admin:logout'))
1598. 
1599.         # Staff should be able to login.
1600.         response = self.client.get(reverse('has_permission_admin:index'))
1601.         self.assertEqual(response.status_code, 302)
1602.         login = self.client.post(reverse('has_permission_admin:login'), {
1603.             REDIRECT_FIELD_NAME: reverse('has_permission_admin:index'),
1604.             'username': 'deleteuser',
1605.             'password': 'secret',
1606.         })
1607.         self.assertRedirects(login, reverse('has_permission_admin:index'))
1608.         self.assertFalse(login.context)
1609.         self.client.get(reverse('has_permission_admin:logout'))
1610. 
1611.     def test_login_successfully_redirects_to_original_URL(self):
1612.         response = self.client.get(self.index_url)
1613.         self.assertEqual(response.status_code, 302)
1614.         query_string = 'the-answer=42'
1615.         redirect_url = '%s?%s' % (self.index_url, query_string)
1616.         new_next = {REDIRECT_FIELD_NAME: redirect_url}
1617.         post_data = self.super_login.copy()
1618.         post_data.pop(REDIRECT_FIELD_NAME)
1619.         login = self.client.post(
1620.             '%s?%s' % (reverse('admin:login'), urlencode(new_next)),
1621.             post_data)
1622.         self.assertRedirects(login, redirect_url)
1623. 
1624.     def test_double_login_is_not_allowed(self):
1625.         """Regression test for #19327"""
1626.         login_url = '%s?next=%s' % (reverse('admin:login'), reverse('admin:index'))
1627. 
1628.         response = self.client.get(self.index_url)
1629.         self.assertEqual(response.status_code, 302)
1630. 
1631.         # Establish a valid admin session
1632.         login = self.client.post(login_url, self.super_login)
1633.         self.assertRedirects(login, self.index_url)
1634.         self.assertFalse(login.context)
1635. 
1636.         # Logging in with non-admin user fails
1637.         login = self.client.post(login_url, self.joepublic_login)
1638.         self.assertEqual(login.status_code, 200)
1639.         self.assertContains(login, ERROR_MESSAGE)
1640. 
1641.         # Establish a valid admin session
1642.         login = self.client.post(login_url, self.super_login)
1643.         self.assertRedirects(login, self.index_url)
1644.         self.assertFalse(login.context)
1645. 
1646.         # Logging in with admin user while already logged in
1647.         login = self.client.post(login_url, self.super_login)
1648.         self.assertRedirects(login, self.index_url)
1649.         self.assertFalse(login.context)
1650.         self.client.get(reverse('admin:logout'))
1651. 
1652.     def test_login_page_notice_for_non_staff_users(self):
1653.         """
1654.         A logged-in non-staff user trying to access the admin index should be
1655.         presented with the login page and a hint indicating that the current
1656.         user doesn't have access to it.
1657.         """
1658.         hint_template = 'You are authenticated as {}'
1659. 
1660.         # Anonymous user should not be shown the hint
1661.         response = self.client.get(self.index_url, follow=True)
1662.         self.assertContains(response, 'login-form')
1663.         self.assertNotContains(response, hint_template.format(''), status_code=200)
1664. 
1665.         # Non-staff user should be shown the hint
1666.         self.client.force_login(self.nostaffuser)
1667.         response = self.client.get(self.index_url, follow=True)
1668.         self.assertContains(response, 'login-form')
1669.         self.assertContains(response, hint_template.format(self.nostaffuser.username), status_code=200)
1670. 
1671.     def test_add_view(self):
1672.         """Test add view restricts access and actually adds items."""
1673.         add_dict = {
1674.             'title': 'Døm ikke',
1675.             'content': '<p>great article</p>',
1676.             'date_0': '2008-03-18', 'date_1': '10:54:39',
1677.             'section': self.s1.pk,
1678.         }
1679.         # Change User should not have access to add articles
1680.         self.client.force_login(self.changeuser)
1681.         # make sure the view removes test cookie
1682.         self.assertIs(self.client.session.test_cookie_worked(), False)
1683.         response = self.client.get(reverse('admin:admin_views_article_add'))
1684.         self.assertEqual(response.status_code, 403)
1685.         # Try POST just to make sure
1686.         post = self.client.post(reverse('admin:admin_views_article_add'), add_dict)
1687.         self.assertEqual(post.status_code, 403)
1688.         self.assertEqual(Article.objects.count(), 3)
1689.         self.client.get(reverse('admin:logout'))
1690. 
1691.         # View User should not have access to add articles
1692.         self.client.force_login(self.viewuser)
1693.         response = self.client.get(reverse('admin:admin_views_article_add'))
1694.         self.assertEqual(response.status_code, 403)
1695.         # Try POST just to make sure
1696.         post = self.client.post(reverse('admin:admin_views_article_add'), add_dict)
1697.         self.assertEqual(post.status_code, 403)
1698.         self.assertEqual(Article.objects.count(), 3)
1699.         # Now give the user permission to add but not change.
1700.         self.viewuser.user_permissions.add(get_perm(Article, get_permission_codename('add', Article._meta)))
1701.         response = self.client.get(reverse('admin:admin_views_article_add'))
1702.         self.assertContains(response, '<input type="submit" value="Save and view" name="_continue">')
1703.         post = self.client.post(reverse('admin:admin_views_article_add'), add_dict, follow=False)
1704.         self.assertEqual(post.status_code, 302)
1705.         self.assertEqual(Article.objects.count(), 4)
1706.         article = Article.objects.latest('pk')
1707.         response = self.client.get(reverse('admin:admin_views_article_change', args=(article.pk,)))
1708.         self.assertContains(response, '<li class="success">The article "Døm ikke" was added successfully.</li>')
1709.         article.delete()
1710.         self.client.get(reverse('admin:logout'))
1711. 
1712.         # Add user may login and POST to add view, then redirect to admin root
1713.         self.client.force_login(self.adduser)
1714.         addpage = self.client.get(reverse('admin:admin_views_article_add'))
1715.         change_list_link = '&rsaquo; <a href="%s">Articles</a>' % reverse('admin:admin_views_article_changelist')
1716.         self.assertNotContains(
1717.             addpage, change_list_link,
1718.             msg_prefix='User restricted to add permission is given link to change list view in breadcrumbs.'
1719.         )
1720.         post = self.client.post(reverse('admin:admin_views_article_add'), add_dict)
1721.         self.assertRedirects(post, self.index_url)
1722.         self.assertEqual(Article.objects.count(), 4)
1723.         self.assertEqual(len(mail.outbox), 2)
1724.         self.assertEqual(mail.outbox[0].subject, 'Greetings from a created object')
1725.         self.client.get(reverse('admin:logout'))
1726. 
1727.         # The addition was logged correctly
1728.         addition_log = LogEntry.objects.all()[0]
1729.         new_article = Article.objects.last()
1730.         article_ct = ContentType.objects.get_for_model(Article)
1731.         self.assertEqual(addition_log.user_id, self.adduser.pk)
1732.         self.assertEqual(addition_log.content_type_id, article_ct.pk)
1733.         self.assertEqual(addition_log.object_id, str(new_article.pk))
1734.         self.assertEqual(addition_log.object_repr, "Døm ikke")
1735.         self.assertEqual(addition_log.action_flag, ADDITION)
1736.         self.assertEqual(addition_log.get_change_message(), "Added.")
1737. 
1738.         # Super can add too, but is redirected to the change list view
1739.         self.client.force_login(self.superuser)
1740.         addpage = self.client.get(reverse('admin:admin_views_article_add'))
1741.         self.assertContains(
1742.             addpage, change_list_link,
1743.             msg_prefix='Unrestricted user is not given link to change list view in breadcrumbs.'
1744.         )
1745.         post = self.client.post(reverse('admin:admin_views_article_add'), add_dict)
1746.         self.assertRedirects(post, reverse('admin:admin_views_article_changelist'))
1747.         self.assertEqual(Article.objects.count(), 5)
1748.         self.client.get(reverse('admin:logout'))
1749. 
1750.         # 8509 - if a normal user is already logged in, it is possible
1751.         # to change user into the superuser without error
1752.         self.client.force_login(self.joepublicuser)
1753.         # Check and make sure that if user expires, data still persists
1754.         self.client.force_login(self.superuser)
1755.         # make sure the view removes test cookie
1756.         self.assertIs(self.client.session.test_cookie_worked(), False)
1757. 
1758.     @mock.patch('django.contrib.admin.options.InlineModelAdmin.has_change_permission')
1759.     def test_add_view_with_view_only_inlines(self, has_change_permission):
1760.         """User with add permission to a section but view-only for inlines."""
1761.         self.viewuser.user_permissions.add(get_perm(Section, get_permission_codename('add', Section._meta)))
1762.         self.client.force_login(self.viewuser)
1763.         # Valid POST creates a new section.
1764.         data = {
1765.             'name': 'New obj',
1766.             'article_set-TOTAL_FORMS': 0,
1767.             'article_set-INITIAL_FORMS': 0,
1768.         }
1769.         response = self.client.post(reverse('admin:admin_views_section_add'), data)
1770.         self.assertRedirects(response, reverse('admin:index'))
1771.         self.assertEqual(Section.objects.latest('id').name, data['name'])
1772.         # InlineModelAdmin.has_change_permission()'s obj argument is always
1773.         # None during object add.
1774.         self.assertEqual([obj for (request, obj), _ in has_change_permission.call_args_list], [None, None])
1775. 
1776.     def test_change_view(self):
1777.         """Change view should restrict access and allow users to edit items."""
1778.         change_dict = {
1779.             'title': 'Ikke fordømt',
1780.             'content': '<p>edited article</p>',
1781.             'date_0': '2008-03-18', 'date_1': '10:54:39',
1782.             'section': self.s1.pk,
1783.         }
1784.         article_change_url = reverse('admin:admin_views_article_change', args=(self.a1.pk,))
1785.         article_changelist_url = reverse('admin:admin_views_article_changelist')
1786. 
1787.         # add user should not be able to view the list of article or change any of them
1788.         self.client.force_login(self.adduser)
1789.         response = self.client.get(article_changelist_url)
1790.         self.assertEqual(response.status_code, 403)
1791.         response = self.client.get(article_change_url)
1792.         self.assertEqual(response.status_code, 403)
1793.         post = self.client.post(article_change_url, change_dict)
1794.         self.assertEqual(post.status_code, 403)
1795.         self.client.get(reverse('admin:logout'))
1796. 
1797.         # view user should be able to view the article but not change any of them
1798.         # (the POST can be sent, but no modification occurs)
1799.         self.client.force_login(self.viewuser)
1800.         response = self.client.get(article_changelist_url)
1801.         self.assertEqual(response.status_code, 200)
1802.         self.assertEqual(response.context['title'], 'Select article to view')
1803.         response = self.client.get(article_change_url)
1804.         self.assertEqual(response.status_code, 200)
1805.         self.assertEqual(response.context['title'], 'View article')
1806.         self.assertContains(response, '<label>Extra form field:</label>')
1807.         self.assertContains(response, '<a href="/test_admin/admin/admin_views/article/" class="closelink">Close</a>')
1808.         post = self.client.post(article_change_url, change_dict)
1809.         self.assertEqual(post.status_code, 302)
1810.         self.assertEqual(Article.objects.get(pk=self.a1.pk).content, '<p>Middle content</p>')
1811.         self.client.get(reverse('admin:logout'))
1812. 
1813.         # change user can view all items and edit them
1814.         self.client.force_login(self.changeuser)
1815.         response = self.client.get(article_changelist_url)
1816.         self.assertEqual(response.status_code, 200)
1817.         self.assertEqual(response.context['title'], 'Select article to change')
1818.         response = self.client.get(article_change_url)
1819.         self.assertEqual(response.status_code, 200)
1820.         self.assertEqual(response.context['title'], 'Change article')
1821.         post = self.client.post(article_change_url, change_dict)
1822.         self.assertRedirects(post, article_changelist_url)
1823.         self.assertEqual(Article.objects.get(pk=self.a1.pk).content, '<p>edited article</p>')
1824. 
1825.         # one error in form should produce singular error message, multiple errors plural
1826.         change_dict['title'] = ''
1827.         post = self.client.post(article_change_url, change_dict)
1828.         self.assertContains(
1829.             post, 'Please correct the error below.',
1830.             msg_prefix='Singular error message not found in response to post with one error'
1831.         )
1832. 
1833.         change_dict['content'] = ''
1834.         post = self.client.post(article_change_url, change_dict)
1835.         self.assertContains(
1836.             post, 'Please correct the errors below.',
1837.             msg_prefix='Plural error message not found in response to post with multiple errors'
1838.         )
1839.         self.client.get(reverse('admin:logout'))
1840. 
1841.         # Test redirection when using row-level change permissions. Refs #11513.
1842.         r1 = RowLevelChangePermissionModel.objects.create(id=1, name="odd id")
1843.         r2 = RowLevelChangePermissionModel.objects.create(id=2, name="even id")
1844.         r3 = RowLevelChangePermissionModel.objects.create(id=3, name='odd id mult 3')
1845.         r6 = RowLevelChangePermissionModel.objects.create(id=6, name='even id mult 3')
1846.         change_url_1 = reverse('admin:admin_views_rowlevelchangepermissionmodel_change', args=(r1.pk,))
1847.         change_url_2 = reverse('admin:admin_views_rowlevelchangepermissionmodel_change', args=(r2.pk,))
1848.         change_url_3 = reverse('admin:admin_views_rowlevelchangepermissionmodel_change', args=(r3.pk,))
1849.         change_url_6 = reverse('admin:admin_views_rowlevelchangepermissionmodel_change', args=(r6.pk,))
1850.         logins = [self.superuser, self.viewuser, self.adduser, self.changeuser, self.deleteuser]
1851.         for login_user in logins:
1852.             with self.subTest(login_user.username):
1853.                 self.client.force_login(login_user)
1854.                 response = self.client.get(change_url_1)
1855.                 self.assertEqual(response.status_code, 403)
1856.                 response = self.client.post(change_url_1, {'name': 'changed'})
1857.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=1).name, 'odd id')
1858.                 self.assertEqual(response.status_code, 403)
1859.                 response = self.client.get(change_url_2)
1860.                 self.assertEqual(response.status_code, 200)
1861.                 response = self.client.post(change_url_2, {'name': 'changed'})
1862.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=2).name, 'changed')
1863.                 self.assertRedirects(response, self.index_url)
1864.                 response = self.client.get(change_url_3)
1865.                 self.assertEqual(response.status_code, 200)
1866.                 response = self.client.post(change_url_3, {'name': 'changed'})
1867.                 self.assertRedirects(response, self.index_url)
1868.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=3).name, 'odd id mult 3')
1869.                 response = self.client.get(change_url_6)
1870.                 self.assertEqual(response.status_code, 200)
1871.                 response = self.client.post(change_url_6, {'name': 'changed'})
1872.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=6).name, 'changed')
1873.                 self.assertRedirects(response, self.index_url)
1874. 
1875.                 self.client.get(reverse('admin:logout'))
1876. 
1877.         for login_user in [self.joepublicuser, self.nostaffuser]:
1878.             with self.subTest(login_user.username):
1879.                 self.client.force_login(login_user)
1880.                 response = self.client.get(change_url_1, follow=True)
1881.                 self.assertContains(response, 'login-form')
1882.                 response = self.client.post(change_url_1, {'name': 'changed'}, follow=True)
1883.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=1).name, 'odd id')
1884.                 self.assertContains(response, 'login-form')
1885.                 response = self.client.get(change_url_2, follow=True)
1886.                 self.assertContains(response, 'login-form')
1887.                 response = self.client.post(change_url_2, {'name': 'changed again'}, follow=True)
1888.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=2).name, 'changed')
1889.                 self.assertContains(response, 'login-form')
1890.                 self.client.get(reverse('admin:logout'))
1891. 
1892.     def test_change_view_without_object_change_permission(self):
1893.         """
1894.         The object should be read-only if the user has permission to view it
1895.         and change objects of that type but not to change the current object.
1896.         """
1897.         change_url = reverse('admin9:admin_views_article_change', args=(self.a1.pk,))
1898.         self.client.force_login(self.viewuser)
1899.         response = self.client.get(change_url)
1900.         self.assertEqual(response.status_code, 200)
1901.         self.assertEqual(response.context['title'], 'View article')
1902.         self.assertContains(response, '<a href="/test_admin/admin9/admin_views/article/" class="closelink">Close</a>')
1903. 
1904.     def test_change_view_post_without_object_change_permission(self):
1905.         """A POST redirects to changelist without modifications."""
1906.         change_dict = {
1907.             'title': 'Ikke fordømt',
1908.             'content': '<p>edited article</p>',
1909.             'date_0': '2008-03-18', 'date_1': '10:54:39',
1910.             'section': self.s1.pk,
1911.         }
1912.         change_url = reverse('admin10:admin_views_article_change', args=(self.a1.pk,))
1913.         changelist_url = reverse('admin10:admin_views_article_changelist')
1914.         self.client.force_login(self.viewuser)
1915.         response = self.client.post(change_url, change_dict)
1916.         self.assertRedirects(response, changelist_url)
1917.         self.assertEqual(Article.objects.get(pk=self.a1.pk).content, '<p>Middle content</p>')
1918. 
1919.     def test_change_view_save_as_new(self):
1920.         """
1921.         'Save as new' should raise PermissionDenied for users without the 'add'
1922.         permission.
1923.         """
1924.         change_dict_save_as_new = {
1925.             '_saveasnew': 'Save as new',
1926.             'title': 'Ikke fordømt',
1927.             'content': '<p>edited article</p>',
1928.             'date_0': '2008-03-18', 'date_1': '10:54:39',
1929.             'section': self.s1.pk,
1930.         }
1931.         article_change_url = reverse('admin:admin_views_article_change', args=(self.a1.pk,))
1932. 
1933.         # Add user can perform "Save as new".
1934.         article_count = Article.objects.count()
1935.         self.client.force_login(self.adduser)
1936.         post = self.client.post(article_change_url, change_dict_save_as_new)
1937.         self.assertRedirects(post, self.index_url)
1938.         self.assertEqual(Article.objects.count(), article_count + 1)
1939.         self.client.logout()
1940. 
1941.         # Change user cannot perform "Save as new" (no 'add' permission).
1942.         article_count = Article.objects.count()
1943.         self.client.force_login(self.changeuser)
1944.         post = self.client.post(article_change_url, change_dict_save_as_new)
1945.         self.assertEqual(post.status_code, 403)
1946.         self.assertEqual(Article.objects.count(), article_count)
1947. 
1948.         # User with both add and change permissions should be redirected to the
1949.         # change page for the newly created object.
1950.         article_count = Article.objects.count()
1951.         self.client.force_login(self.superuser)
1952.         post = self.client.post(article_change_url, change_dict_save_as_new)
1953.         self.assertEqual(Article.objects.count(), article_count + 1)
1954.         new_article = Article.objects.latest('id')
1955.         self.assertRedirects(post, reverse('admin:admin_views_article_change', args=(new_article.pk,)))
1956. 
1957.     def test_change_view_with_view_only_inlines(self):
1958.         """
1959.         User with change permission to a section but view-only for inlines.
1960.         """
1961.         self.viewuser.user_permissions.add(get_perm(Section, get_permission_codename('change', Section._meta)))
1962.         self.client.force_login(self.viewuser)
1963.         # GET shows inlines.
1964.         response = self.client.get(reverse('admin:admin_views_section_change', args=(self.s1.pk,)))
1965.         self.assertEqual(len(response.context['inline_admin_formsets']), 1)
1966.         formset = response.context['inline_admin_formsets'][0]
1967.         self.assertEqual(len(formset.forms), 3)
1968.         # Valid POST changes the name.
1969.         data = {
1970.             'name': 'Can edit name with view-only inlines',
1971.             'article_set-TOTAL_FORMS': 3,
1972.             'article_set-INITIAL_FORMS': 3
1973.         }
1974.         response = self.client.post(reverse('admin:admin_views_section_change', args=(self.s1.pk,)), data)
1975.         self.assertRedirects(response, reverse('admin:admin_views_section_changelist'))
1976.         self.assertEqual(Section.objects.get(pk=self.s1.pk).name, data['name'])
1977.         # Invalid POST reshows inlines.
1978.         del data['name']
1979.         response = self.client.post(reverse('admin:admin_views_section_change', args=(self.s1.pk,)), data)
1980.         self.assertEqual(response.status_code, 200)
1981.         self.assertEqual(len(response.context['inline_admin_formsets']), 1)
1982.         formset = response.context['inline_admin_formsets'][0]
1983.         self.assertEqual(len(formset.forms), 3)
1984. 
1985.     def test_change_view_with_view_and_add_inlines(self):
1986.         """User has view and add permissions on the inline model."""
1987.         self.viewuser.user_permissions.add(get_perm(Section, get_permission_codename('change', Section._meta)))
1988.         self.viewuser.user_permissions.add(get_perm(Article, get_permission_codename('add', Article._meta)))
1989.         self.client.force_login(self.viewuser)
1990.         # GET shows inlines.
1991.         response = self.client.get(reverse('admin:admin_views_section_change', args=(self.s1.pk,)))
1992.         self.assertEqual(len(response.context['inline_admin_formsets']), 1)
1993.         formset = response.context['inline_admin_formsets'][0]
1994.         self.assertEqual(len(formset.forms), 6)
1995.         # Valid POST creates a new article.
1996.         data = {
1997.             'name': 'Can edit name with view-only inlines',
1998.             'article_set-TOTAL_FORMS': 6,
1999.             'article_set-INITIAL_FORMS': 3,
2000.             'article_set-3-id': [''],
2001.             'article_set-3-title': ['A title'],

File: tests/admin_views/tests.py
Line number range: 2001 - 2501
Content:
2001.             'article_set-3-title': ['A title'],
2002.             'article_set-3-content': ['Added content'],
2003.             'article_set-3-date_0': ['2008-3-18'],
2004.             'article_set-3-date_1': ['11:54:58'],
2005.             'article_set-3-section': [str(self.s1.pk)],
2006.         }
2007.         response = self.client.post(reverse('admin:admin_views_section_change', args=(self.s1.pk,)), data)
2008.         self.assertRedirects(response, reverse('admin:admin_views_section_changelist'))
2009.         self.assertEqual(Section.objects.get(pk=self.s1.pk).name, data['name'])
2010.         self.assertEqual(Article.objects.count(), 4)
2011.         # Invalid POST reshows inlines.
2012.         del data['name']
2013.         response = self.client.post(reverse('admin:admin_views_section_change', args=(self.s1.pk,)), data)
2014.         self.assertEqual(response.status_code, 200)
2015.         self.assertEqual(len(response.context['inline_admin_formsets']), 1)
2016.         formset = response.context['inline_admin_formsets'][0]
2017.         self.assertEqual(len(formset.forms), 6)
2018. 
2019.     def test_change_view_with_view_and_delete_inlines(self):
2020.         """User has view and delete permissions on the inline model."""
2021.         self.viewuser.user_permissions.add(get_perm(Section, get_permission_codename('change', Section._meta)))
2022.         self.client.force_login(self.viewuser)
2023.         data = {
2024.             'name': 'Name is required.',
2025.             'article_set-TOTAL_FORMS': 6,
2026.             'article_set-INITIAL_FORMS': 3,
2027.             'article_set-0-id': [str(self.a1.pk)],
2028.             'article_set-0-DELETE': ['on'],
2029.         }
2030.         # Inline POST details are ignored without delete permission.
2031.         response = self.client.post(reverse('admin:admin_views_section_change', args=(self.s1.pk,)), data)
2032.         self.assertRedirects(response, reverse('admin:admin_views_section_changelist'))
2033.         self.assertEqual(Article.objects.count(), 3)
2034.         # Deletion successful when delete permission is added.
2035.         self.viewuser.user_permissions.add(get_perm(Article, get_permission_codename('delete', Article._meta)))
2036.         data = {
2037.             'name': 'Name is required.',
2038.             'article_set-TOTAL_FORMS': 6,
2039.             'article_set-INITIAL_FORMS': 3,
2040.             'article_set-0-id': [str(self.a1.pk)],
2041.             'article_set-0-DELETE': ['on'],
2042.         }
2043.         response = self.client.post(reverse('admin:admin_views_section_change', args=(self.s1.pk,)), data)
2044.         self.assertRedirects(response, reverse('admin:admin_views_section_changelist'))
2045.         self.assertEqual(Article.objects.count(), 2)
2046. 
2047.     def test_delete_view(self):
2048.         """Delete view should restrict access and actually delete items."""
2049.         delete_dict = {'post': 'yes'}
2050.         delete_url = reverse('admin:admin_views_article_delete', args=(self.a1.pk,))
2051. 
2052.         # add user should not be able to delete articles
2053.         self.client.force_login(self.adduser)
2054.         response = self.client.get(delete_url)
2055.         self.assertEqual(response.status_code, 403)
2056.         post = self.client.post(delete_url, delete_dict)
2057.         self.assertEqual(post.status_code, 403)
2058.         self.assertEqual(Article.objects.count(), 3)
2059.         self.client.logout()
2060. 
2061.         # view user should not be able to delete articles
2062.         self.client.force_login(self.viewuser)
2063.         response = self.client.get(delete_url)
2064.         self.assertEqual(response.status_code, 403)
2065.         post = self.client.post(delete_url, delete_dict)
2066.         self.assertEqual(post.status_code, 403)
2067.         self.assertEqual(Article.objects.count(), 3)
2068.         self.client.logout()
2069. 
2070.         # Delete user can delete
2071.         self.client.force_login(self.deleteuser)
2072.         response = self.client.get(reverse('admin:admin_views_section_delete', args=(self.s1.pk,)))
2073.         self.assertContains(response, "<h2>Summary</h2>")
2074.         self.assertContains(response, "<li>Articles: 3</li>")
2075.         # test response contains link to related Article
2076.         self.assertContains(response, "admin_views/article/%s/" % self.a1.pk)
2077. 
2078.         response = self.client.get(delete_url)
2079.         self.assertContains(response, "admin_views/article/%s/" % self.a1.pk)
2080.         self.assertContains(response, "<h2>Summary</h2>")
2081.         self.assertContains(response, "<li>Articles: 1</li>")
2082.         self.assertEqual(response.status_code, 200)
2083.         post = self.client.post(delete_url, delete_dict)
2084.         self.assertRedirects(post, self.index_url)
2085.         self.assertEqual(Article.objects.count(), 2)
2086.         self.assertEqual(len(mail.outbox), 1)
2087.         self.assertEqual(mail.outbox[0].subject, 'Greetings from a deleted object')
2088.         article_ct = ContentType.objects.get_for_model(Article)
2089.         logged = LogEntry.objects.get(content_type=article_ct, action_flag=DELETION)
2090.         self.assertEqual(logged.object_id, str(self.a1.pk))
2091. 
2092.     def test_delete_view_with_no_default_permissions(self):
2093.         """
2094.         The delete view allows users to delete collected objects without a
2095.         'delete' permission (ReadOnlyPizza.Meta.default_permissions is empty).
2096.         """
2097.         pizza = ReadOnlyPizza.objects.create(name='Double Cheese')
2098.         delete_url = reverse('admin:admin_views_readonlypizza_delete', args=(pizza.pk,))
2099.         self.client.force_login(self.adduser)
2100.         response = self.client.get(delete_url)
2101.         self.assertContains(response, 'admin_views/readonlypizza/%s/' % pizza.pk)
2102.         self.assertContains(response, '<h2>Summary</h2>')
2103.         self.assertContains(response, '<li>Read only pizzas: 1</li>')
2104.         self.assertEqual(response.status_code, 200)
2105.         post = self.client.post(delete_url, {'post': 'yes'})
2106.         self.assertRedirects(post, reverse('admin:admin_views_readonlypizza_changelist'))
2107.         self.assertEqual(ReadOnlyPizza.objects.count(), 0)
2108. 
2109.     def test_delete_view_nonexistent_obj(self):
2110.         self.client.force_login(self.deleteuser)
2111.         url = reverse('admin:admin_views_article_delete', args=('nonexistent',))
2112.         response = self.client.get(url, follow=True)
2113.         self.assertRedirects(response, reverse('admin:index'))
2114.         self.assertEqual(
2115.             [m.message for m in response.context['messages']],
2116.             ["""article with ID "nonexistent" doesn't exist. Perhaps it was deleted?"""]
2117.         )
2118. 
2119.     def test_history_view(self):
2120.         """History view should restrict access."""
2121.         # add user should not be able to view the list of article or change any of them
2122.         self.client.force_login(self.adduser)
2123.         response = self.client.get(reverse('admin:admin_views_article_history', args=(self.a1.pk,)))
2124.         self.assertEqual(response.status_code, 403)
2125.         self.client.get(reverse('admin:logout'))
2126. 
2127.         # view user can view all items
2128.         self.client.force_login(self.viewuser)
2129.         response = self.client.get(reverse('admin:admin_views_article_history', args=(self.a1.pk,)))
2130.         self.assertEqual(response.status_code, 200)
2131.         self.client.get(reverse('admin:logout'))
2132. 
2133.         # change user can view all items and edit them
2134.         self.client.force_login(self.changeuser)
2135.         response = self.client.get(reverse('admin:admin_views_article_history', args=(self.a1.pk,)))
2136.         self.assertEqual(response.status_code, 200)
2137. 
2138.         # Test redirection when using row-level change permissions. Refs #11513.
2139.         rl1 = RowLevelChangePermissionModel.objects.create(name="odd id")
2140.         rl2 = RowLevelChangePermissionModel.objects.create(name="even id")
2141.         logins = [self.superuser, self.viewuser, self.adduser, self.changeuser, self.deleteuser]
2142.         for login_user in logins:
2143.             with self.subTest(login_user.username):
2144.                 self.client.force_login(login_user)
2145.                 url = reverse('admin:admin_views_rowlevelchangepermissionmodel_history', args=(rl1.pk,))
2146.                 response = self.client.get(url)
2147.                 self.assertEqual(response.status_code, 403)
2148. 
2149.                 url = reverse('admin:admin_views_rowlevelchangepermissionmodel_history', args=(rl2.pk,))
2150.                 response = self.client.get(url)
2151.                 self.assertEqual(response.status_code, 200)
2152. 
2153.                 self.client.get(reverse('admin:logout'))
2154. 
2155.         for login_user in [self.joepublicuser, self.nostaffuser]:
2156.             with self.subTest(login_user.username):
2157.                 self.client.force_login(login_user)
2158.                 url = reverse('admin:admin_views_rowlevelchangepermissionmodel_history', args=(rl1.pk,))
2159.                 response = self.client.get(url, follow=True)
2160.                 self.assertContains(response, 'login-form')
2161.                 url = reverse('admin:admin_views_rowlevelchangepermissionmodel_history', args=(rl2.pk,))
2162.                 response = self.client.get(url, follow=True)
2163.                 self.assertContains(response, 'login-form')
2164. 
2165.                 self.client.get(reverse('admin:logout'))
2166. 
2167.     def test_history_view_bad_url(self):
2168.         self.client.force_login(self.changeuser)
2169.         response = self.client.get(reverse('admin:admin_views_article_history', args=('foo',)), follow=True)
2170.         self.assertRedirects(response, reverse('admin:index'))
2171.         self.assertEqual(
2172.             [m.message for m in response.context['messages']],
2173.             ["""article with ID "foo" doesn't exist. Perhaps it was deleted?"""]
2174.         )
2175. 
2176.     def test_conditionally_show_add_section_link(self):
2177.         """
2178.         The foreign key widget should only show the "add related" button if the
2179.         user has permission to add that related item.
2180.         """
2181.         self.client.force_login(self.adduser)
2182.         # The user can't add sections yet, so they shouldn't see the "add section" link.
2183.         url = reverse('admin:admin_views_article_add')
2184.         add_link_text = 'add_id_section'
2185.         response = self.client.get(url)
2186.         self.assertNotContains(response, add_link_text)
2187.         # Allow the user to add sections too. Now they can see the "add section" link.
2188.         user = User.objects.get(username='adduser')
2189.         perm = get_perm(Section, get_permission_codename('add', Section._meta))
2190.         user.user_permissions.add(perm)
2191.         response = self.client.get(url)
2192.         self.assertContains(response, add_link_text)
2193. 
2194.     def test_conditionally_show_change_section_link(self):
2195.         """
2196.         The foreign key widget should only show the "change related" button if
2197.         the user has permission to change that related item.
2198.         """
2199.         def get_change_related(response):
2200.             return response.context['adminform'].form.fields['section'].widget.can_change_related
2201. 
2202.         self.client.force_login(self.adduser)
2203.         # The user can't change sections yet, so they shouldn't see the "change section" link.
2204.         url = reverse('admin:admin_views_article_add')
2205.         change_link_text = 'change_id_section'
2206.         response = self.client.get(url)
2207.         self.assertFalse(get_change_related(response))
2208.         self.assertNotContains(response, change_link_text)
2209.         # Allow the user to change sections too. Now they can see the "change section" link.
2210.         user = User.objects.get(username='adduser')
2211.         perm = get_perm(Section, get_permission_codename('change', Section._meta))
2212.         user.user_permissions.add(perm)
2213.         response = self.client.get(url)
2214.         self.assertTrue(get_change_related(response))
2215.         self.assertContains(response, change_link_text)
2216. 
2217.     def test_conditionally_show_delete_section_link(self):
2218.         """
2219.         The foreign key widget should only show the "delete related" button if
2220.         the user has permission to delete that related item.
2221.         """
2222.         def get_delete_related(response):
2223.             return response.context['adminform'].form.fields['sub_section'].widget.can_delete_related
2224. 
2225.         self.client.force_login(self.adduser)
2226.         # The user can't delete sections yet, so they shouldn't see the "delete section" link.
2227.         url = reverse('admin:admin_views_article_add')
2228.         delete_link_text = 'delete_id_sub_section'
2229.         response = self.client.get(url)
2230.         self.assertFalse(get_delete_related(response))
2231.         self.assertNotContains(response, delete_link_text)
2232.         # Allow the user to delete sections too. Now they can see the "delete section" link.
2233.         user = User.objects.get(username='adduser')
2234.         perm = get_perm(Section, get_permission_codename('delete', Section._meta))
2235.         user.user_permissions.add(perm)
2236.         response = self.client.get(url)
2237.         self.assertTrue(get_delete_related(response))
2238.         self.assertContains(response, delete_link_text)
2239. 
2240.     def test_disabled_permissions_when_logged_in(self):
2241.         self.client.force_login(self.superuser)
2242.         superuser = User.objects.get(username='super')
2243.         superuser.is_active = False
2244.         superuser.save()
2245. 
2246.         response = self.client.get(self.index_url, follow=True)
2247.         self.assertContains(response, 'id="login-form"')
2248.         self.assertNotContains(response, 'Log out')
2249. 
2250.         response = self.client.get(reverse('secure_view'), follow=True)
2251.         self.assertContains(response, 'id="login-form"')
2252. 
2253.     def test_disabled_staff_permissions_when_logged_in(self):
2254.         self.client.force_login(self.superuser)
2255.         superuser = User.objects.get(username='super')
2256.         superuser.is_staff = False
2257.         superuser.save()
2258. 
2259.         response = self.client.get(self.index_url, follow=True)
2260.         self.assertContains(response, 'id="login-form"')
2261.         self.assertNotContains(response, 'Log out')
2262. 
2263.         response = self.client.get(reverse('secure_view'), follow=True)
2264.         self.assertContains(response, 'id="login-form"')
2265. 
2266.     def test_app_list_permissions(self):
2267.         """
2268.         If a user has no module perms, the app list returns a 404.
2269.         """
2270.         opts = Article._meta
2271.         change_user = User.objects.get(username='changeuser')
2272.         permission = get_perm(Article, get_permission_codename('change', opts))
2273. 
2274.         self.client.force_login(self.changeuser)
2275. 
2276.         # the user has no module permissions
2277.         change_user.user_permissions.remove(permission)
2278.         response = self.client.get(reverse('admin:app_list', args=('admin_views',)))
2279.         self.assertEqual(response.status_code, 404)
2280. 
2281.         # the user now has module permissions
2282.         change_user.user_permissions.add(permission)
2283.         response = self.client.get(reverse('admin:app_list', args=('admin_views',)))
2284.         self.assertEqual(response.status_code, 200)
2285. 
2286.     def test_shortcut_view_only_available_to_staff(self):
2287.         """
2288.         Only admin users should be able to use the admin shortcut view.
2289.         """
2290.         model_ctype = ContentType.objects.get_for_model(ModelWithStringPrimaryKey)
2291.         obj = ModelWithStringPrimaryKey.objects.create(string_pk='foo')
2292.         shortcut_url = reverse('admin:view_on_site', args=(model_ctype.pk, obj.pk))
2293. 
2294.         # Not logged in: we should see the login page.
2295.         response = self.client.get(shortcut_url, follow=True)
2296.         self.assertTemplateUsed(response, 'admin/login.html')
2297. 
2298.         # Logged in? Redirect.
2299.         self.client.force_login(self.superuser)
2300.         response = self.client.get(shortcut_url, follow=False)
2301.         # Can't use self.assertRedirects() because User.get_absolute_url() is silly.
2302.         self.assertEqual(response.status_code, 302)
2303.         # Domain may depend on contrib.sites tests also run
2304.         self.assertRegex(response.url, 'http://(testserver|example.com)/dummy/foo/')
2305. 
2306.     def test_has_module_permission(self):
2307.         """
2308.         has_module_permission() returns True for all users who
2309.         have any permission for that module (add, change, or delete), so that
2310.         the module is displayed on the admin index page.
2311.         """
2312.         self.client.force_login(self.superuser)
2313.         response = self.client.get(self.index_url)
2314.         self.assertContains(response, 'admin_views')
2315.         self.assertContains(response, 'Articles')
2316.         self.client.logout()
2317. 
2318.         self.client.force_login(self.viewuser)
2319.         response = self.client.get(self.index_url)
2320.         self.assertContains(response, 'admin_views')
2321.         self.assertContains(response, 'Articles')
2322.         self.client.logout()
2323. 
2324.         self.client.force_login(self.adduser)
2325.         response = self.client.get(self.index_url)
2326.         self.assertContains(response, 'admin_views')
2327.         self.assertContains(response, 'Articles')
2328.         self.client.logout()
2329. 
2330.         self.client.force_login(self.changeuser)
2331.         response = self.client.get(self.index_url)
2332.         self.assertContains(response, 'admin_views')
2333.         self.assertContains(response, 'Articles')
2334.         self.client.logout()
2335. 
2336.         self.client.force_login(self.deleteuser)
2337.         response = self.client.get(self.index_url)
2338.         self.assertContains(response, 'admin_views')
2339.         self.assertContains(response, 'Articles')
2340. 
2341.     def test_overriding_has_module_permission(self):
2342.         """
2343.         If has_module_permission() always returns False, the module shouldn't
2344.         be displayed on the admin index page for any users.
2345.         """
2346.         articles = Article._meta.verbose_name_plural.title()
2347.         sections = Section._meta.verbose_name_plural.title()
2348.         index_url = reverse('admin7:index')
2349. 
2350.         self.client.force_login(self.superuser)
2351.         response = self.client.get(index_url)
2352.         self.assertContains(response, sections)
2353.         self.assertNotContains(response, articles)
2354.         self.client.logout()
2355. 
2356.         self.client.force_login(self.viewuser)
2357.         response = self.client.get(index_url)
2358.         self.assertNotContains(response, 'admin_views')
2359.         self.assertNotContains(response, articles)
2360.         self.client.logout()
2361. 
2362.         self.client.force_login(self.adduser)
2363.         response = self.client.get(index_url)
2364.         self.assertNotContains(response, 'admin_views')
2365.         self.assertNotContains(response, articles)
2366.         self.client.logout()
2367. 
2368.         self.client.force_login(self.changeuser)
2369.         response = self.client.get(index_url)
2370.         self.assertNotContains(response, 'admin_views')
2371.         self.assertNotContains(response, articles)
2372.         self.client.logout()
2373. 
2374.         self.client.force_login(self.deleteuser)
2375.         response = self.client.get(index_url)
2376.         self.assertNotContains(response, articles)
2377. 
2378.         # The app list displays Sections but not Articles as the latter has
2379.         # ModelAdmin.has_module_permission() = False.
2380.         self.client.force_login(self.superuser)
2381.         response = self.client.get(reverse('admin7:app_list', args=('admin_views',)))
2382.         self.assertContains(response, sections)
2383.         self.assertNotContains(response, articles)
2384. 
2385.     def test_post_save_message_no_forbidden_links_visible(self):
2386.         """
2387.         Post-save message shouldn't contain a link to the change form if the
2388.         user doesn't have the change permission.
2389.         """
2390.         self.client.force_login(self.adduser)
2391.         # Emulate Article creation for user with add-only permission.
2392.         post_data = {
2393.             "title": "Fun & games",
2394.             "content": "Some content",
2395.             "date_0": "2015-10-31",
2396.             "date_1": "16:35:00",
2397.             "_save": "Save",
2398.         }
2399.         response = self.client.post(reverse('admin:admin_views_article_add'), post_data, follow=True)
2400.         self.assertContains(
2401.             response,
2402.             '<li class="success">The article "Fun &amp; games" was added successfully.</li>',
2403.             html=True
2404.         )
2405. 
2406. 
2407. @override_settings(
2408.     ROOT_URLCONF='admin_views.urls',
2409.     TEMPLATES=[{
2410.         'BACKEND': 'django.template.backends.django.DjangoTemplates',
2411.         'APP_DIRS': True,
2412.         'OPTIONS': {
2413.             'context_processors': [
2414.                 'django.contrib.auth.context_processors.auth',
2415.                 'django.contrib.messages.context_processors.messages',
2416.             ],
2417.         },
2418.     }],
2419. )
2420. class AdminViewProxyModelPermissionsTests(TestCase):
2421.     """Tests for proxy models permissions in the admin."""
2422. 
2423.     @classmethod
2424.     def setUpTestData(cls):
2425.         cls.viewuser = User.objects.create_user(username='viewuser', password='secret', is_staff=True)
2426.         cls.adduser = User.objects.create_user(username='adduser', password='secret', is_staff=True)
2427.         cls.changeuser = User.objects.create_user(username='changeuser', password='secret', is_staff=True)
2428.         cls.deleteuser = User.objects.create_user(username='deleteuser', password='secret', is_staff=True)
2429.         # Setup permissions.
2430.         opts = UserProxy._meta
2431.         cls.viewuser.user_permissions.add(get_perm(UserProxy, get_permission_codename('view', opts)))
2432.         cls.adduser.user_permissions.add(get_perm(UserProxy, get_permission_codename('add', opts)))
2433.         cls.changeuser.user_permissions.add(get_perm(UserProxy, get_permission_codename('change', opts)))
2434.         cls.deleteuser.user_permissions.add(get_perm(UserProxy, get_permission_codename('delete', opts)))
2435.         # UserProxy instances.
2436.         cls.user_proxy = UserProxy.objects.create(username='user_proxy', password='secret')
2437. 
2438.     def test_add(self):
2439.         self.client.force_login(self.adduser)
2440.         url = reverse('admin:admin_views_userproxy_add')
2441.         data = {
2442.             'username': 'can_add',
2443.             'password': 'secret',
2444.             'date_joined_0': '2019-01-15',
2445.             'date_joined_1': '16:59:10',
2446.         }
2447.         response = self.client.post(url, data, follow=True)
2448.         self.assertEqual(response.status_code, 200)
2449.         self.assertTrue(UserProxy.objects.filter(username='can_add').exists())
2450. 
2451.     def test_view(self):
2452.         self.client.force_login(self.viewuser)
2453.         response = self.client.get(reverse('admin:admin_views_userproxy_changelist'))
2454.         self.assertContains(response, '<h1>Select user proxy to view</h1>')
2455.         self.assertEqual(response.status_code, 200)
2456.         response = self.client.get(reverse('admin:admin_views_userproxy_change', args=(self.user_proxy.pk,)))
2457.         self.assertContains(response, '<h1>View user proxy</h1>')
2458.         self.assertContains(response, '<div class="readonly">user_proxy</div>')
2459. 
2460.     def test_change(self):
2461.         self.client.force_login(self.changeuser)
2462.         data = {
2463.             'password': self.user_proxy.password,
2464.             'username': self.user_proxy.username,
2465.             'date_joined_0': self.user_proxy.date_joined.strftime('%Y-%m-%d'),
2466.             'date_joined_1': self.user_proxy.date_joined.strftime('%H:%M:%S'),
2467.             'first_name': 'first_name',
2468.         }
2469.         url = reverse('admin:admin_views_userproxy_change', args=(self.user_proxy.pk,))
2470.         response = self.client.post(url, data)
2471.         self.assertRedirects(response, reverse('admin:admin_views_userproxy_changelist'))
2472.         self.assertEqual(UserProxy.objects.get(pk=self.user_proxy.pk).first_name, 'first_name')
2473. 
2474.     def test_delete(self):
2475.         self.client.force_login(self.deleteuser)
2476.         url = reverse('admin:admin_views_userproxy_delete', args=(self.user_proxy.pk,))
2477.         response = self.client.post(url, {'post': 'yes'}, follow=True)
2478.         self.assertEqual(response.status_code, 200)
2479.         self.assertFalse(UserProxy.objects.filter(pk=self.user_proxy.pk).exists())
2480. 
2481. 
2482. @override_settings(ROOT_URLCONF='admin_views.urls')
2483. class AdminViewsNoUrlTest(TestCase):
2484.     """Regression test for #17333"""
2485. 
2486.     @classmethod
2487.     def setUpTestData(cls):
2488.         # User who can change Reports
2489.         cls.changeuser = User.objects.create_user(username='changeuser', password='secret', is_staff=True)
2490.         cls.changeuser.user_permissions.add(get_perm(Report, get_permission_codename('change', Report._meta)))
2491. 
2492.     def test_no_standard_modeladmin_urls(self):
2493.         """Admin index views don't break when user's ModelAdmin removes standard urls"""
2494.         self.client.force_login(self.changeuser)
2495.         r = self.client.get(reverse('admin:index'))
2496.         # we shouldn't get a 500 error caused by a NoReverseMatch
2497.         self.assertEqual(r.status_code, 200)
2498.         self.client.get(reverse('admin:logout'))
2499. 
2500. 
2501. @skipUnlessDBFeature('can_defer_constraint_checks')

File: tests/admin_views/tests.py
Line number range: 2501 - 3001
Content:
2501. @skipUnlessDBFeature('can_defer_constraint_checks')
2502. @override_settings(ROOT_URLCONF='admin_views.urls')
2503. class AdminViewDeletedObjectsTest(TestCase):
2504. 
2505.     @classmethod
2506.     def setUpTestData(cls):
2507.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
2508.         cls.deleteuser = User.objects.create_user(username='deleteuser', password='secret', is_staff=True)
2509.         cls.s1 = Section.objects.create(name='Test section')
2510.         cls.a1 = Article.objects.create(
2511.             content='<p>Middle content</p>', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1
2512.         )
2513.         cls.a2 = Article.objects.create(
2514.             content='<p>Oldest content</p>', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1
2515.         )
2516.         cls.a3 = Article.objects.create(
2517.             content='<p>Newest content</p>', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1
2518.         )
2519.         cls.p1 = PrePopulatedPost.objects.create(title='A Long Title', published=True, slug='a-long-title')
2520. 
2521.         cls.v1 = Villain.objects.create(name='Adam')
2522.         cls.v2 = Villain.objects.create(name='Sue')
2523.         cls.sv1 = SuperVillain.objects.create(name='Bob')
2524.         cls.pl1 = Plot.objects.create(name='World Domination', team_leader=cls.v1, contact=cls.v2)
2525.         cls.pl2 = Plot.objects.create(name='World Peace', team_leader=cls.v2, contact=cls.v2)
2526.         cls.pl3 = Plot.objects.create(name='Corn Conspiracy', team_leader=cls.v1, contact=cls.v1)
2527.         cls.pd1 = PlotDetails.objects.create(details='almost finished', plot=cls.pl1)
2528.         cls.sh1 = SecretHideout.objects.create(location='underground bunker', villain=cls.v1)
2529.         cls.sh2 = SecretHideout.objects.create(location='floating castle', villain=cls.sv1)
2530.         cls.ssh1 = SuperSecretHideout.objects.create(location='super floating castle!', supervillain=cls.sv1)
2531.         cls.cy1 = CyclicOne.objects.create(name='I am recursive', two_id=1)
2532.         cls.cy2 = CyclicTwo.objects.create(name='I am recursive too', one_id=1)
2533. 
2534.     def setUp(self):
2535.         self.client.force_login(self.superuser)
2536. 
2537.     def test_nesting(self):
2538.         """
2539.         Objects should be nested to display the relationships that
2540.         cause them to be scheduled for deletion.
2541.         """
2542.         pattern = re.compile(
2543.             r'<li>Plot: <a href="%s">World Domination</a>\s*<ul>\s*'
2544.             r'<li>Plot details: <a href="%s">almost finished</a>' % (
2545.                 reverse('admin:admin_views_plot_change', args=(self.pl1.pk,)),
2546.                 reverse('admin:admin_views_plotdetails_change', args=(self.pd1.pk,)),
2547.             )
2548.         )
2549.         response = self.client.get(reverse('admin:admin_views_villain_delete', args=(self.v1.pk,)))
2550.         self.assertRegex(response.content.decode(), pattern)
2551. 
2552.     def test_cyclic(self):
2553.         """
2554.         Cyclic relationships should still cause each object to only be
2555.         listed once.
2556.         """
2557.         one = '<li>Cyclic one: <a href="%s">I am recursive</a>' % (
2558.             reverse('admin:admin_views_cyclicone_change', args=(self.cy1.pk,)),
2559.         )
2560.         two = '<li>Cyclic two: <a href="%s">I am recursive too</a>' % (
2561.             reverse('admin:admin_views_cyclictwo_change', args=(self.cy2.pk,)),
2562.         )
2563.         response = self.client.get(reverse('admin:admin_views_cyclicone_delete', args=(self.cy1.pk,)))
2564. 
2565.         self.assertContains(response, one, 1)
2566.         self.assertContains(response, two, 1)
2567. 
2568.     def test_perms_needed(self):
2569.         self.client.logout()
2570.         delete_user = User.objects.get(username='deleteuser')
2571.         delete_user.user_permissions.add(get_perm(Plot, get_permission_codename('delete', Plot._meta)))
2572. 
2573.         self.client.force_login(self.deleteuser)
2574.         response = self.client.get(reverse('admin:admin_views_plot_delete', args=(self.pl1.pk,)))
2575.         self.assertContains(response, "your account doesn't have permission to delete the following types of objects")
2576.         self.assertContains(response, "<li>plot details</li>")
2577. 
2578.     def test_protected(self):
2579.         q = Question.objects.create(question="Why?")
2580.         a1 = Answer.objects.create(question=q, answer="Because.")
2581.         a2 = Answer.objects.create(question=q, answer="Yes.")
2582. 
2583.         response = self.client.get(reverse('admin:admin_views_question_delete', args=(q.pk,)))
2584.         self.assertContains(response, "would require deleting the following protected related objects")
2585.         self.assertContains(
2586.             response,
2587.             '<li>Answer: <a href="%s">Because.</a></li>' % reverse('admin:admin_views_answer_change', args=(a1.pk,))
2588.         )
2589.         self.assertContains(
2590.             response,
2591.             '<li>Answer: <a href="%s">Yes.</a></li>' % reverse('admin:admin_views_answer_change', args=(a2.pk,))
2592.         )
2593. 
2594.     def test_post_delete_protected(self):
2595.         """
2596.         A POST request to delete protected objects should display the page
2597.         which says the deletion is prohibited.
2598.         """
2599.         q = Question.objects.create(question='Why?')
2600.         Answer.objects.create(question=q, answer='Because.')
2601. 
2602.         response = self.client.post(reverse('admin:admin_views_question_delete', args=(q.pk,)), {'post': 'yes'})
2603.         self.assertEqual(Question.objects.count(), 1)
2604.         self.assertContains(response, "would require deleting the following protected related objects")
2605. 
2606.     def test_not_registered(self):
2607.         should_contain = """<li>Secret hideout: underground bunker"""
2608.         response = self.client.get(reverse('admin:admin_views_villain_delete', args=(self.v1.pk,)))
2609.         self.assertContains(response, should_contain, 1)
2610. 
2611.     def test_multiple_fkeys_to_same_model(self):
2612.         """
2613.         If a deleted object has two relationships from another model,
2614.         both of those should be followed in looking for related
2615.         objects to delete.
2616.         """
2617.         should_contain = '<li>Plot: <a href="%s">World Domination</a>' % reverse(
2618.             'admin:admin_views_plot_change', args=(self.pl1.pk,)
2619.         )
2620.         response = self.client.get(reverse('admin:admin_views_villain_delete', args=(self.v1.pk,)))
2621.         self.assertContains(response, should_contain)
2622.         response = self.client.get(reverse('admin:admin_views_villain_delete', args=(self.v2.pk,)))
2623.         self.assertContains(response, should_contain)
2624. 
2625.     def test_multiple_fkeys_to_same_instance(self):
2626.         """
2627.         If a deleted object has two relationships pointing to it from
2628.         another object, the other object should still only be listed
2629.         once.
2630.         """
2631.         should_contain = '<li>Plot: <a href="%s">World Peace</a></li>' % reverse(
2632.             'admin:admin_views_plot_change', args=(self.pl2.pk,)
2633.         )
2634.         response = self.client.get(reverse('admin:admin_views_villain_delete', args=(self.v2.pk,)))
2635.         self.assertContains(response, should_contain, 1)
2636. 
2637.     def test_inheritance(self):
2638.         """
2639.         In the case of an inherited model, if either the child or
2640.         parent-model instance is deleted, both instances are listed
2641.         for deletion, as well as any relationships they have.
2642.         """
2643.         should_contain = [
2644.             '<li>Villain: <a href="%s">Bob</a>' % reverse('admin:admin_views_villain_change', args=(self.sv1.pk,)),
2645.             '<li>Super villain: <a href="%s">Bob</a>' % reverse(
2646.                 'admin:admin_views_supervillain_change', args=(self.sv1.pk,)
2647.             ),
2648.             '<li>Secret hideout: floating castle',
2649.             '<li>Super secret hideout: super floating castle!',
2650.         ]
2651.         response = self.client.get(reverse('admin:admin_views_villain_delete', args=(self.sv1.pk,)))
2652.         for should in should_contain:
2653.             self.assertContains(response, should, 1)
2654.         response = self.client.get(reverse('admin:admin_views_supervillain_delete', args=(self.sv1.pk,)))
2655.         for should in should_contain:
2656.             self.assertContains(response, should, 1)
2657. 
2658.     def test_generic_relations(self):
2659.         """
2660.         If a deleted object has GenericForeignKeys pointing to it,
2661.         those objects should be listed for deletion.
2662.         """
2663.         plot = self.pl3
2664.         tag = FunkyTag.objects.create(content_object=plot, name='hott')
2665.         should_contain = '<li>Funky tag: <a href="%s">hott' % reverse(
2666.             'admin:admin_views_funkytag_change', args=(tag.id,))
2667.         response = self.client.get(reverse('admin:admin_views_plot_delete', args=(plot.pk,)))
2668.         self.assertContains(response, should_contain)
2669. 
2670.     def test_generic_relations_with_related_query_name(self):
2671.         """
2672.         If a deleted object has GenericForeignKey with
2673.         GenericRelation(related_query_name='...') pointing to it, those objects
2674.         should be listed for deletion.
2675.         """
2676.         bookmark = Bookmark.objects.create(name='djangoproject')
2677.         tag = FunkyTag.objects.create(content_object=bookmark, name='django')
2678.         tag_url = reverse('admin:admin_views_funkytag_change', args=(tag.id,))
2679.         should_contain = '<li>Funky tag: <a href="%s">django' % tag_url
2680.         response = self.client.get(reverse('admin:admin_views_bookmark_delete', args=(bookmark.pk,)))
2681.         self.assertContains(response, should_contain)
2682. 
2683.     def test_delete_view_uses_get_deleted_objects(self):
2684.         """The delete view uses ModelAdmin.get_deleted_objects()."""
2685.         book = Book.objects.create(name='Test Book')
2686.         response = self.client.get(reverse('admin2:admin_views_book_delete', args=(book.pk,)))
2687.         # BookAdmin.get_deleted_objects() returns custom text.
2688.         self.assertContains(response, 'a deletable object')
2689. 
2690. 
2691. @override_settings(ROOT_URLCONF='admin_views.urls')
2692. class TestGenericRelations(TestCase):
2693. 
2694.     @classmethod
2695.     def setUpTestData(cls):
2696.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
2697.         cls.v1 = Villain.objects.create(name='Adam')
2698.         cls.pl3 = Plot.objects.create(name='Corn Conspiracy', team_leader=cls.v1, contact=cls.v1)
2699. 
2700.     def setUp(self):
2701.         self.client.force_login(self.superuser)
2702. 
2703.     def test_generic_content_object_in_list_display(self):
2704.         FunkyTag.objects.create(content_object=self.pl3, name='hott')
2705.         response = self.client.get(reverse('admin:admin_views_funkytag_changelist'))
2706.         self.assertContains(response, "%s</td>" % self.pl3)
2707. 
2708. 
2709. @override_settings(ROOT_URLCONF='admin_views.urls')
2710. class AdminViewStringPrimaryKeyTest(TestCase):
2711. 
2712.     @classmethod
2713.     def setUpTestData(cls):
2714.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
2715.         cls.s1 = Section.objects.create(name='Test section')
2716.         cls.a1 = Article.objects.create(
2717.             content='<p>Middle content</p>', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1
2718.         )
2719.         cls.a2 = Article.objects.create(
2720.             content='<p>Oldest content</p>', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1
2721.         )
2722.         cls.a3 = Article.objects.create(
2723.             content='<p>Newest content</p>', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1
2724.         )
2725.         cls.p1 = PrePopulatedPost.objects.create(title='A Long Title', published=True, slug='a-long-title')
2726.         cls.pk = (
2727.             "abcdefghijklmnopqrstuvwxyz ABCDEFGHIJKLMNOPQRSTUVWXYZ 1234567890 "
2728.             r"""-_.!~*'() ;/?:@&=+$, <>#%" {}|\^[]`"""
2729.         )
2730.         cls.m1 = ModelWithStringPrimaryKey.objects.create(string_pk=cls.pk)
2731.         content_type_pk = ContentType.objects.get_for_model(ModelWithStringPrimaryKey).pk
2732.         user_pk = cls.superuser.pk
2733.         LogEntry.objects.log_action(user_pk, content_type_pk, cls.pk, cls.pk, 2, change_message='Changed something')
2734. 
2735.     def setUp(self):
2736.         self.client.force_login(self.superuser)
2737. 
2738.     def test_get_history_view(self):
2739.         """
2740.         Retrieving the history for an object using urlencoded form of primary
2741.         key should work.
2742.         Refs #12349, #18550.
2743.         """
2744.         response = self.client.get(reverse('admin:admin_views_modelwithstringprimarykey_history', args=(self.pk,)))
2745.         self.assertContains(response, escape(self.pk))
2746.         self.assertContains(response, 'Changed something')
2747.         self.assertEqual(response.status_code, 200)
2748. 
2749.     def test_get_change_view(self):
2750.         "Retrieving the object using urlencoded form of primary key should work"
2751.         response = self.client.get(reverse('admin:admin_views_modelwithstringprimarykey_change', args=(self.pk,)))
2752.         self.assertContains(response, escape(self.pk))
2753.         self.assertEqual(response.status_code, 200)
2754. 
2755.     def test_changelist_to_changeform_link(self):
2756.         "Link to the changeform of the object in changelist should use reverse() and be quoted -- #18072"
2757.         response = self.client.get(reverse('admin:admin_views_modelwithstringprimarykey_changelist'))
2758.         # this URL now comes through reverse(), thus url quoting and iri_to_uri encoding
2759.         pk_final_url = escape(iri_to_uri(quote(self.pk)))
2760.         change_url = reverse(
2761.             'admin:admin_views_modelwithstringprimarykey_change', args=('__fk__',)
2762.         ).replace('__fk__', pk_final_url)
2763.         should_contain = '<th class="field-__str__"><a href="%s">%s</a></th>' % (change_url, escape(self.pk))
2764.         self.assertContains(response, should_contain)
2765. 
2766.     def test_recentactions_link(self):
2767.         "The link from the recent actions list referring to the changeform of the object should be quoted"
2768.         response = self.client.get(reverse('admin:index'))
2769.         link = reverse('admin:admin_views_modelwithstringprimarykey_change', args=(quote(self.pk),))
2770.         should_contain = """<a href="%s">%s</a>""" % (escape(link), escape(self.pk))
2771.         self.assertContains(response, should_contain)
2772. 
2773.     def test_deleteconfirmation_link(self):
2774.         "The link from the delete confirmation page referring back to the changeform of the object should be quoted"
2775.         url = reverse('admin:admin_views_modelwithstringprimarykey_delete', args=(quote(self.pk),))
2776.         response = self.client.get(url)
2777.         # this URL now comes through reverse(), thus url quoting and iri_to_uri encoding
2778.         change_url = reverse(
2779.             'admin:admin_views_modelwithstringprimarykey_change', args=('__fk__',)
2780.         ).replace('__fk__', escape(iri_to_uri(quote(self.pk))))
2781.         should_contain = '<a href="%s">%s</a>' % (change_url, escape(self.pk))
2782.         self.assertContains(response, should_contain)
2783. 
2784.     def test_url_conflicts_with_add(self):
2785.         "A model with a primary key that ends with add or is `add` should be visible"
2786.         add_model = ModelWithStringPrimaryKey.objects.create(pk="i have something to add")
2787.         add_model.save()
2788.         response = self.client.get(
2789.             reverse('admin:admin_views_modelwithstringprimarykey_change', args=(quote(add_model.pk),))
2790.         )
2791.         should_contain = """<h1>Change model with string primary key</h1>"""
2792.         self.assertContains(response, should_contain)
2793. 
2794.         add_model2 = ModelWithStringPrimaryKey.objects.create(pk="add")
2795.         add_url = reverse('admin:admin_views_modelwithstringprimarykey_add')
2796.         change_url = reverse('admin:admin_views_modelwithstringprimarykey_change', args=(quote(add_model2.pk),))
2797.         self.assertNotEqual(add_url, change_url)
2798. 
2799.     def test_url_conflicts_with_delete(self):
2800.         "A model with a primary key that ends with delete should be visible"
2801.         delete_model = ModelWithStringPrimaryKey(pk="delete")
2802.         delete_model.save()
2803.         response = self.client.get(
2804.             reverse('admin:admin_views_modelwithstringprimarykey_change', args=(quote(delete_model.pk),))
2805.         )
2806.         should_contain = """<h1>Change model with string primary key</h1>"""
2807.         self.assertContains(response, should_contain)
2808. 
2809.     def test_url_conflicts_with_history(self):
2810.         "A model with a primary key that ends with history should be visible"
2811.         history_model = ModelWithStringPrimaryKey(pk="history")
2812.         history_model.save()
2813.         response = self.client.get(
2814.             reverse('admin:admin_views_modelwithstringprimarykey_change', args=(quote(history_model.pk),))
2815.         )
2816.         should_contain = """<h1>Change model with string primary key</h1>"""
2817.         self.assertContains(response, should_contain)
2818. 
2819.     def test_shortcut_view_with_escaping(self):
2820.         "'View on site should' work properly with char fields"
2821.         model = ModelWithStringPrimaryKey(pk='abc_123')
2822.         model.save()
2823.         response = self.client.get(
2824.             reverse('admin:admin_views_modelwithstringprimarykey_change', args=(quote(model.pk),))
2825.         )
2826.         should_contain = '/%s/" class="viewsitelink">' % model.pk
2827.         self.assertContains(response, should_contain)
2828. 
2829.     def test_change_view_history_link(self):
2830.         """Object history button link should work and contain the pk value quoted."""
2831.         url = reverse(
2832.             'admin:%s_modelwithstringprimarykey_change' % ModelWithStringPrimaryKey._meta.app_label,
2833.             args=(quote(self.pk),)
2834.         )
2835.         response = self.client.get(url)
2836.         self.assertEqual(response.status_code, 200)
2837.         expected_link = reverse(
2838.             'admin:%s_modelwithstringprimarykey_history' % ModelWithStringPrimaryKey._meta.app_label,
2839.             args=(quote(self.pk),)
2840.         )
2841.         self.assertContains(response, '<a href="%s" class="historylink"' % escape(expected_link))
2842. 
2843.     def test_redirect_on_add_view_continue_button(self):
2844.         """As soon as an object is added using "Save and continue editing"
2845.         button, the user should be redirected to the object's change_view.
2846. 
2847.         In case primary key is a string containing some special characters
2848.         like slash or underscore, these characters must be escaped (see #22266)
2849.         """
2850.         response = self.client.post(
2851.             reverse('admin:admin_views_modelwithstringprimarykey_add'),
2852.             {
2853.                 'string_pk': '123/history',
2854.                 "_continue": "1",  # Save and continue editing
2855.             }
2856.         )
2857. 
2858.         self.assertEqual(response.status_code, 302)  # temporary redirect
2859.         self.assertIn('/123_2Fhistory/', response['location'])  # PK is quoted
2860. 
2861. 
2862. @override_settings(ROOT_URLCONF='admin_views.urls')
2863. class SecureViewTests(TestCase):
2864.     """
2865.     Test behavior of a view protected by the staff_member_required decorator.
2866.     """
2867. 
2868.     def test_secure_view_shows_login_if_not_logged_in(self):
2869.         secure_url = reverse('secure_view')
2870.         response = self.client.get(secure_url)
2871.         self.assertRedirects(response, '%s?next=%s' % (reverse('admin:login'), secure_url))
2872.         response = self.client.get(secure_url, follow=True)
2873.         self.assertTemplateUsed(response, 'admin/login.html')
2874.         self.assertEqual(response.context[REDIRECT_FIELD_NAME], secure_url)
2875. 
2876.     def test_staff_member_required_decorator_works_with_argument(self):
2877.         """
2878.         Staff_member_required decorator works with an argument
2879.         (redirect_field_name).
2880.         """
2881.         secure_url = '/test_admin/admin/secure-view2/'
2882.         response = self.client.get(secure_url)
2883.         self.assertRedirects(response, '%s?myfield=%s' % (reverse('admin:login'), secure_url))
2884. 
2885. 
2886. @override_settings(ROOT_URLCONF='admin_views.urls')
2887. class AdminViewUnicodeTest(TestCase):
2888. 
2889.     @classmethod
2890.     def setUpTestData(cls):
2891.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
2892.         cls.b1 = Book.objects.create(name='Lærdommer')
2893.         cls.p1 = Promo.objects.create(name='<Promo for Lærdommer>', book=cls.b1)
2894.         cls.chap1 = Chapter.objects.create(
2895.             title='Norske bostaver æøå skaper problemer', content='<p>Svært frustrerende med UnicodeDecodeErro</p>',
2896.             book=cls.b1
2897.         )
2898.         cls.chap2 = Chapter.objects.create(
2899.             title='Kjærlighet', content='<p>La kjærligheten til de lidende seire.</p>', book=cls.b1)
2900.         cls.chap3 = Chapter.objects.create(title='Kjærlighet', content='<p>Noe innhold</p>', book=cls.b1)
2901.         cls.chap4 = ChapterXtra1.objects.create(chap=cls.chap1, xtra='<Xtra(1) Norske bostaver æøå skaper problemer>')
2902.         cls.chap5 = ChapterXtra1.objects.create(chap=cls.chap2, xtra='<Xtra(1) Kjærlighet>')
2903.         cls.chap6 = ChapterXtra1.objects.create(chap=cls.chap3, xtra='<Xtra(1) Kjærlighet>')
2904.         cls.chap7 = ChapterXtra2.objects.create(chap=cls.chap1, xtra='<Xtra(2) Norske bostaver æøå skaper problemer>')
2905.         cls.chap8 = ChapterXtra2.objects.create(chap=cls.chap2, xtra='<Xtra(2) Kjærlighet>')
2906.         cls.chap9 = ChapterXtra2.objects.create(chap=cls.chap3, xtra='<Xtra(2) Kjærlighet>')
2907. 
2908.     def setUp(self):
2909.         self.client.force_login(self.superuser)
2910. 
2911.     def test_unicode_edit(self):
2912.         """
2913.         A test to ensure that POST on edit_view handles non-ASCII characters.
2914.         """
2915.         post_data = {
2916.             "name": "Test lærdommer",
2917.             # inline data
2918.             "chapter_set-TOTAL_FORMS": "6",
2919.             "chapter_set-INITIAL_FORMS": "3",
2920.             "chapter_set-MAX_NUM_FORMS": "0",
2921.             "chapter_set-0-id": self.chap1.pk,
2922.             "chapter_set-0-title": "Norske bostaver æøå skaper problemer",
2923.             "chapter_set-0-content": "&lt;p&gt;Svært frustrerende med UnicodeDecodeError&lt;/p&gt;",
2924.             "chapter_set-1-id": self.chap2.id,
2925.             "chapter_set-1-title": "Kjærlighet.",
2926.             "chapter_set-1-content": "&lt;p&gt;La kjærligheten til de lidende seire.&lt;/p&gt;",
2927.             "chapter_set-2-id": self.chap3.id,
2928.             "chapter_set-2-title": "Need a title.",
2929.             "chapter_set-2-content": "&lt;p&gt;Newest content&lt;/p&gt;",
2930.             "chapter_set-3-id": "",
2931.             "chapter_set-3-title": "",
2932.             "chapter_set-3-content": "",
2933.             "chapter_set-4-id": "",
2934.             "chapter_set-4-title": "",
2935.             "chapter_set-4-content": "",
2936.             "chapter_set-5-id": "",
2937.             "chapter_set-5-title": "",
2938.             "chapter_set-5-content": "",
2939.         }
2940. 
2941.         response = self.client.post(reverse('admin:admin_views_book_change', args=(self.b1.pk,)), post_data)
2942.         self.assertEqual(response.status_code, 302)  # redirect somewhere
2943. 
2944.     def test_unicode_delete(self):
2945.         """
2946.         The delete_view handles non-ASCII characters
2947.         """
2948.         delete_dict = {'post': 'yes'}
2949.         delete_url = reverse('admin:admin_views_book_delete', args=(self.b1.pk,))
2950.         response = self.client.get(delete_url)
2951.         self.assertEqual(response.status_code, 200)
2952.         response = self.client.post(delete_url, delete_dict)
2953.         self.assertRedirects(response, reverse('admin:admin_views_book_changelist'))
2954. 
2955. 
2956. @override_settings(ROOT_URLCONF='admin_views.urls')
2957. class AdminViewListEditable(TestCase):
2958. 
2959.     @classmethod
2960.     def setUpTestData(cls):
2961.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
2962.         cls.s1 = Section.objects.create(name='Test section')
2963.         cls.a1 = Article.objects.create(
2964.             content='<p>Middle content</p>', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1
2965.         )
2966.         cls.a2 = Article.objects.create(
2967.             content='<p>Oldest content</p>', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1
2968.         )
2969.         cls.a3 = Article.objects.create(
2970.             content='<p>Newest content</p>', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1
2971.         )
2972.         cls.p1 = PrePopulatedPost.objects.create(title='A Long Title', published=True, slug='a-long-title')
2973.         cls.per1 = Person.objects.create(name='John Mauchly', gender=1, alive=True)
2974.         cls.per2 = Person.objects.create(name='Grace Hopper', gender=1, alive=False)
2975.         cls.per3 = Person.objects.create(name='Guido van Rossum', gender=1, alive=True)
2976. 
2977.     def setUp(self):
2978.         self.client.force_login(self.superuser)
2979. 
2980.     def test_inheritance(self):
2981.         Podcast.objects.create(name="This Week in Django", release_date=datetime.date.today())
2982.         response = self.client.get(reverse('admin:admin_views_podcast_changelist'))
2983.         self.assertEqual(response.status_code, 200)
2984. 
2985.     def test_inheritance_2(self):
2986.         Vodcast.objects.create(name="This Week in Django", released=True)
2987.         response = self.client.get(reverse('admin:admin_views_vodcast_changelist'))
2988.         self.assertEqual(response.status_code, 200)
2989. 
2990.     def test_custom_pk(self):
2991.         Language.objects.create(iso='en', name='English', english_name='English')
2992.         response = self.client.get(reverse('admin:admin_views_language_changelist'))
2993.         self.assertEqual(response.status_code, 200)
2994. 
2995.     def test_changelist_input_html(self):
2996.         response = self.client.get(reverse('admin:admin_views_person_changelist'))
2997.         # 2 inputs per object(the field and the hidden id field) = 6
2998.         # 4 management hidden fields = 4
2999.         # 4 action inputs (3 regular checkboxes, 1 checkbox to select all)
3000.         # main form submit button = 1
3001.         # search field and search submit button = 2

File: tests/admin_views/tests.py
Line number range: 3001 - 3501
Content:
3001.         # search field and search submit button = 2
3002.         # CSRF field = 1
3003.         # field to track 'select all' across paginated views = 1
3004.         # 6 + 4 + 4 + 1 + 2 + 1 + 1 = 19 inputs
3005.         self.assertContains(response, "<input", count=19)
3006.         # 1 select per object = 3 selects
3007.         self.assertContains(response, "<select", count=4)
3008. 
3009.     def test_post_messages(self):
3010.         # Ticket 12707: Saving inline editable should not show admin
3011.         # action warnings
3012.         data = {
3013.             "form-TOTAL_FORMS": "3",
3014.             "form-INITIAL_FORMS": "3",
3015.             "form-MAX_NUM_FORMS": "0",
3016. 
3017.             "form-0-gender": "1",
3018.             "form-0-id": "%s" % self.per1.pk,
3019. 
3020.             "form-1-gender": "2",
3021.             "form-1-id": "%s" % self.per2.pk,
3022. 
3023.             "form-2-alive": "checked",
3024.             "form-2-gender": "1",
3025.             "form-2-id": "%s" % self.per3.pk,
3026. 
3027.             "_save": "Save",
3028.         }
3029.         response = self.client.post(reverse('admin:admin_views_person_changelist'),
3030.                                     data, follow=True)
3031.         self.assertEqual(len(response.context['messages']), 1)
3032. 
3033.     def test_post_submission(self):
3034.         data = {
3035.             "form-TOTAL_FORMS": "3",
3036.             "form-INITIAL_FORMS": "3",
3037.             "form-MAX_NUM_FORMS": "0",
3038. 
3039.             "form-0-gender": "1",
3040.             "form-0-id": "%s" % self.per1.pk,
3041. 
3042.             "form-1-gender": "2",
3043.             "form-1-id": "%s" % self.per2.pk,
3044. 
3045.             "form-2-alive": "checked",
3046.             "form-2-gender": "1",
3047.             "form-2-id": "%s" % self.per3.pk,
3048. 
3049.             "_save": "Save",
3050.         }
3051.         self.client.post(reverse('admin:admin_views_person_changelist'), data)
3052. 
3053.         self.assertIs(Person.objects.get(name="John Mauchly").alive, False)
3054.         self.assertEqual(Person.objects.get(name="Grace Hopper").gender, 2)
3055. 
3056.         # test a filtered page
3057.         data = {
3058.             "form-TOTAL_FORMS": "2",
3059.             "form-INITIAL_FORMS": "2",
3060.             "form-MAX_NUM_FORMS": "0",
3061. 
3062.             "form-0-id": "%s" % self.per1.pk,
3063.             "form-0-gender": "1",
3064.             "form-0-alive": "checked",
3065. 
3066.             "form-1-id": "%s" % self.per3.pk,
3067.             "form-1-gender": "1",
3068.             "form-1-alive": "checked",
3069. 
3070.             "_save": "Save",
3071.         }
3072.         self.client.post(reverse('admin:admin_views_person_changelist') + '?gender__exact=1', data)
3073. 
3074.         self.assertIs(Person.objects.get(name="John Mauchly").alive, True)
3075. 
3076.         # test a searched page
3077.         data = {
3078.             "form-TOTAL_FORMS": "1",
3079.             "form-INITIAL_FORMS": "1",
3080.             "form-MAX_NUM_FORMS": "0",
3081. 
3082.             "form-0-id": "%s" % self.per1.pk,
3083.             "form-0-gender": "1",
3084. 
3085.             "_save": "Save",
3086.         }
3087.         self.client.post(reverse('admin:admin_views_person_changelist') + '?q=john', data)
3088. 
3089.         self.assertIs(Person.objects.get(name="John Mauchly").alive, False)
3090. 
3091.     def test_non_field_errors(self):
3092.         """
3093.         Non-field errors are displayed for each of the forms in the
3094.         changelist's formset.
3095.         """
3096.         fd1 = FoodDelivery.objects.create(reference='123', driver='bill', restaurant='thai')
3097.         fd2 = FoodDelivery.objects.create(reference='456', driver='bill', restaurant='india')
3098.         fd3 = FoodDelivery.objects.create(reference='789', driver='bill', restaurant='pizza')
3099. 
3100.         data = {
3101.             "form-TOTAL_FORMS": "3",
3102.             "form-INITIAL_FORMS": "3",
3103.             "form-MAX_NUM_FORMS": "0",
3104. 
3105.             "form-0-id": str(fd1.id),
3106.             "form-0-reference": "123",
3107.             "form-0-driver": "bill",
3108.             "form-0-restaurant": "thai",
3109. 
3110.             # Same data as above: Forbidden because of unique_together!
3111.             "form-1-id": str(fd2.id),
3112.             "form-1-reference": "456",
3113.             "form-1-driver": "bill",
3114.             "form-1-restaurant": "thai",
3115. 
3116.             "form-2-id": str(fd3.id),
3117.             "form-2-reference": "789",
3118.             "form-2-driver": "bill",
3119.             "form-2-restaurant": "pizza",
3120. 
3121.             "_save": "Save",
3122.         }
3123.         response = self.client.post(reverse('admin:admin_views_fooddelivery_changelist'), data)
3124.         self.assertContains(
3125.             response,
3126.             '<tr><td colspan="4"><ul class="errorlist nonfield"><li>Food delivery '
3127.             'with this Driver and Restaurant already exists.</li></ul></td></tr>',
3128.             1,
3129.             html=True
3130.         )
3131. 
3132.         data = {
3133.             "form-TOTAL_FORMS": "3",
3134.             "form-INITIAL_FORMS": "3",
3135.             "form-MAX_NUM_FORMS": "0",
3136. 
3137.             "form-0-id": str(fd1.id),
3138.             "form-0-reference": "123",
3139.             "form-0-driver": "bill",
3140.             "form-0-restaurant": "thai",
3141. 
3142.             # Same data as above: Forbidden because of unique_together!
3143.             "form-1-id": str(fd2.id),
3144.             "form-1-reference": "456",
3145.             "form-1-driver": "bill",
3146.             "form-1-restaurant": "thai",
3147. 
3148.             # Same data also.
3149.             "form-2-id": str(fd3.id),
3150.             "form-2-reference": "789",
3151.             "form-2-driver": "bill",
3152.             "form-2-restaurant": "thai",
3153. 
3154.             "_save": "Save",
3155.         }
3156.         response = self.client.post(reverse('admin:admin_views_fooddelivery_changelist'), data)
3157.         self.assertContains(
3158.             response,
3159.             '<tr><td colspan="4"><ul class="errorlist nonfield"><li>Food delivery '
3160.             'with this Driver and Restaurant already exists.</li></ul></td></tr>',
3161.             2,
3162.             html=True
3163.         )
3164. 
3165.     def test_non_form_errors(self):
3166.         # test if non-form errors are handled; ticket #12716
3167.         data = {
3168.             "form-TOTAL_FORMS": "1",
3169.             "form-INITIAL_FORMS": "1",
3170.             "form-MAX_NUM_FORMS": "0",
3171. 
3172.             "form-0-id": "%s" % self.per2.pk,
3173.             "form-0-alive": "1",
3174.             "form-0-gender": "2",
3175. 
3176.             # The form processing understands this as a list_editable "Save"
3177.             # and not an action "Go".
3178.             "_save": "Save",
3179.         }
3180.         response = self.client.post(reverse('admin:admin_views_person_changelist'), data)
3181.         self.assertContains(response, "Grace is not a Zombie")
3182. 
3183.     def test_non_form_errors_is_errorlist(self):
3184.         # test if non-form errors are correctly handled; ticket #12878
3185.         data = {
3186.             "form-TOTAL_FORMS": "1",
3187.             "form-INITIAL_FORMS": "1",
3188.             "form-MAX_NUM_FORMS": "0",
3189. 
3190.             "form-0-id": "%s" % self.per2.pk,
3191.             "form-0-alive": "1",
3192.             "form-0-gender": "2",
3193. 
3194.             "_save": "Save",
3195.         }
3196.         response = self.client.post(reverse('admin:admin_views_person_changelist'), data)
3197.         non_form_errors = response.context['cl'].formset.non_form_errors()
3198.         self.assertIsInstance(non_form_errors, ErrorList)
3199.         self.assertEqual(str(non_form_errors), str(ErrorList(["Grace is not a Zombie"])))
3200. 
3201.     def test_list_editable_ordering(self):
3202.         collector = Collector.objects.create(id=1, name="Frederick Clegg")
3203. 
3204.         Category.objects.create(id=1, order=1, collector=collector)
3205.         Category.objects.create(id=2, order=2, collector=collector)
3206.         Category.objects.create(id=3, order=0, collector=collector)
3207.         Category.objects.create(id=4, order=0, collector=collector)
3208. 
3209.         # NB: The order values must be changed so that the items are reordered.
3210.         data = {
3211.             "form-TOTAL_FORMS": "4",
3212.             "form-INITIAL_FORMS": "4",
3213.             "form-MAX_NUM_FORMS": "0",
3214. 
3215.             "form-0-order": "14",
3216.             "form-0-id": "1",
3217.             "form-0-collector": "1",
3218. 
3219.             "form-1-order": "13",
3220.             "form-1-id": "2",
3221.             "form-1-collector": "1",
3222. 
3223.             "form-2-order": "1",
3224.             "form-2-id": "3",
3225.             "form-2-collector": "1",
3226. 
3227.             "form-3-order": "0",
3228.             "form-3-id": "4",
3229.             "form-3-collector": "1",
3230. 
3231.             # The form processing understands this as a list_editable "Save"
3232.             # and not an action "Go".
3233.             "_save": "Save",
3234.         }
3235.         response = self.client.post(reverse('admin:admin_views_category_changelist'), data)
3236.         # Successful post will redirect
3237.         self.assertEqual(response.status_code, 302)
3238. 
3239.         # The order values have been applied to the right objects
3240.         self.assertEqual(Category.objects.get(id=1).order, 14)
3241.         self.assertEqual(Category.objects.get(id=2).order, 13)
3242.         self.assertEqual(Category.objects.get(id=3).order, 1)
3243.         self.assertEqual(Category.objects.get(id=4).order, 0)
3244. 
3245.     def test_list_editable_pagination(self):
3246.         """
3247.         Pagination works for list_editable items.
3248.         """
3249.         UnorderedObject.objects.create(id=1, name='Unordered object #1')
3250.         UnorderedObject.objects.create(id=2, name='Unordered object #2')
3251.         UnorderedObject.objects.create(id=3, name='Unordered object #3')
3252.         response = self.client.get(reverse('admin:admin_views_unorderedobject_changelist'))
3253.         self.assertContains(response, 'Unordered object #3')
3254.         self.assertContains(response, 'Unordered object #2')
3255.         self.assertNotContains(response, 'Unordered object #1')
3256.         response = self.client.get(reverse('admin:admin_views_unorderedobject_changelist') + '?p=1')
3257.         self.assertNotContains(response, 'Unordered object #3')
3258.         self.assertNotContains(response, 'Unordered object #2')
3259.         self.assertContains(response, 'Unordered object #1')
3260. 
3261.     def test_list_editable_action_submit(self):
3262.         # List editable changes should not be executed if the action "Go" button is
3263.         # used to submit the form.
3264.         data = {
3265.             "form-TOTAL_FORMS": "3",
3266.             "form-INITIAL_FORMS": "3",
3267.             "form-MAX_NUM_FORMS": "0",
3268. 
3269.             "form-0-gender": "1",
3270.             "form-0-id": "1",
3271. 
3272.             "form-1-gender": "2",
3273.             "form-1-id": "2",
3274. 
3275.             "form-2-alive": "checked",
3276.             "form-2-gender": "1",
3277.             "form-2-id": "3",
3278. 
3279.             "index": "0",
3280.             "_selected_action": ['3'],
3281.             "action": ['', 'delete_selected'],
3282.         }
3283.         self.client.post(reverse('admin:admin_views_person_changelist'), data)
3284. 
3285.         self.assertIs(Person.objects.get(name="John Mauchly").alive, True)
3286.         self.assertEqual(Person.objects.get(name="Grace Hopper").gender, 1)
3287. 
3288.     def test_list_editable_action_choices(self):
3289.         # List editable changes should be executed if the "Save" button is
3290.         # used to submit the form - any action choices should be ignored.
3291.         data = {
3292.             "form-TOTAL_FORMS": "3",
3293.             "form-INITIAL_FORMS": "3",
3294.             "form-MAX_NUM_FORMS": "0",
3295. 
3296.             "form-0-gender": "1",
3297.             "form-0-id": "%s" % self.per1.pk,
3298. 
3299.             "form-1-gender": "2",
3300.             "form-1-id": "%s" % self.per2.pk,
3301. 
3302.             "form-2-alive": "checked",
3303.             "form-2-gender": "1",
3304.             "form-2-id": "%s" % self.per3.pk,
3305. 
3306.             "_save": "Save",
3307.             "_selected_action": ['1'],
3308.             "action": ['', 'delete_selected'],
3309.         }
3310.         self.client.post(reverse('admin:admin_views_person_changelist'), data)
3311. 
3312.         self.assertIs(Person.objects.get(name="John Mauchly").alive, False)
3313.         self.assertEqual(Person.objects.get(name="Grace Hopper").gender, 2)
3314. 
3315.     def test_list_editable_popup(self):
3316.         """
3317.         Fields should not be list-editable in popups.
3318.         """
3319.         response = self.client.get(reverse('admin:admin_views_person_changelist'))
3320.         self.assertNotEqual(response.context['cl'].list_editable, ())
3321.         response = self.client.get(reverse('admin:admin_views_person_changelist') + '?%s' % IS_POPUP_VAR)
3322.         self.assertEqual(response.context['cl'].list_editable, ())
3323. 
3324.     def test_pk_hidden_fields(self):
3325.         """
3326.         hidden pk fields aren't displayed in the table body and their
3327.         corresponding human-readable value is displayed instead. The hidden pk
3328.         fields are displayed but separately (not in the table) and only once.
3329.         """
3330.         story1 = Story.objects.create(title='The adventures of Guido', content='Once upon a time in Djangoland...')
3331.         story2 = Story.objects.create(
3332.             title='Crouching Tiger, Hidden Python',
3333.             content='The Python was sneaking into...',
3334.         )
3335.         response = self.client.get(reverse('admin:admin_views_story_changelist'))
3336.         # Only one hidden field, in a separate place than the table.
3337.         self.assertContains(response, 'id="id_form-0-id"', 1)
3338.         self.assertContains(response, 'id="id_form-1-id"', 1)
3339.         self.assertContains(
3340.             response,
3341.             '<div class="hiddenfields">\n'
3342.             '<input type="hidden" name="form-0-id" value="%d" id="id_form-0-id">'
3343.             '<input type="hidden" name="form-1-id" value="%d" id="id_form-1-id">\n</div>'
3344.             % (story2.id, story1.id),
3345.             html=True
3346.         )
3347.         self.assertContains(response, '<td class="field-id">%d</td>' % story1.id, 1)
3348.         self.assertContains(response, '<td class="field-id">%d</td>' % story2.id, 1)
3349. 
3350.     def test_pk_hidden_fields_with_list_display_links(self):
3351.         """ Similarly as test_pk_hidden_fields, but when the hidden pk fields are
3352.             referenced in list_display_links.
3353.             Refs #12475.
3354.         """
3355.         story1 = OtherStory.objects.create(
3356.             title='The adventures of Guido',
3357.             content='Once upon a time in Djangoland...',
3358.         )
3359.         story2 = OtherStory.objects.create(
3360.             title='Crouching Tiger, Hidden Python',
3361.             content='The Python was sneaking into...',
3362.         )
3363.         link1 = reverse('admin:admin_views_otherstory_change', args=(story1.pk,))
3364.         link2 = reverse('admin:admin_views_otherstory_change', args=(story2.pk,))
3365.         response = self.client.get(reverse('admin:admin_views_otherstory_changelist'))
3366.         # Only one hidden field, in a separate place than the table.
3367.         self.assertContains(response, 'id="id_form-0-id"', 1)
3368.         self.assertContains(response, 'id="id_form-1-id"', 1)
3369.         self.assertContains(
3370.             response,
3371.             '<div class="hiddenfields">\n'
3372.             '<input type="hidden" name="form-0-id" value="%d" id="id_form-0-id">'
3373.             '<input type="hidden" name="form-1-id" value="%d" id="id_form-1-id">\n</div>'
3374.             % (story2.id, story1.id),
3375.             html=True
3376.         )
3377.         self.assertContains(response, '<th class="field-id"><a href="%s">%d</a></th>' % (link1, story1.id), 1)
3378.         self.assertContains(response, '<th class="field-id"><a href="%s">%d</a></th>' % (link2, story2.id), 1)
3379. 
3380. 
3381. @override_settings(ROOT_URLCONF='admin_views.urls')
3382. class AdminSearchTest(TestCase):
3383. 
3384.     @classmethod
3385.     def setUpTestData(cls):
3386.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
3387.         cls.joepublicuser = User.objects.create_user(username='joepublic', password='secret')
3388.         cls.s1 = Section.objects.create(name='Test section')
3389.         cls.a1 = Article.objects.create(
3390.             content='<p>Middle content</p>', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1
3391.         )
3392.         cls.a2 = Article.objects.create(
3393.             content='<p>Oldest content</p>', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1
3394.         )
3395.         cls.a3 = Article.objects.create(
3396.             content='<p>Newest content</p>', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1
3397.         )
3398.         cls.p1 = PrePopulatedPost.objects.create(title='A Long Title', published=True, slug='a-long-title')
3399. 
3400.         cls.per1 = Person.objects.create(name='John Mauchly', gender=1, alive=True)
3401.         cls.per2 = Person.objects.create(name='Grace Hopper', gender=1, alive=False)
3402.         cls.per3 = Person.objects.create(name='Guido van Rossum', gender=1, alive=True)
3403. 
3404.         cls.t1 = Recommender.objects.create()
3405.         cls.t2 = Recommendation.objects.create(the_recommender=cls.t1)
3406.         cls.t3 = Recommender.objects.create()
3407.         cls.t4 = Recommendation.objects.create(the_recommender=cls.t3)
3408. 
3409.         cls.tt1 = TitleTranslation.objects.create(title=cls.t1, text='Bar')
3410.         cls.tt2 = TitleTranslation.objects.create(title=cls.t2, text='Foo')
3411.         cls.tt3 = TitleTranslation.objects.create(title=cls.t3, text='Few')
3412.         cls.tt4 = TitleTranslation.objects.create(title=cls.t4, text='Bas')
3413. 
3414.     def setUp(self):
3415.         self.client.force_login(self.superuser)
3416. 
3417.     def test_search_on_sibling_models(self):
3418.         "A search that mentions sibling models"
3419.         response = self.client.get(reverse('admin:admin_views_recommendation_changelist') + '?q=bar')
3420.         # confirm the search returned 1 object
3421.         self.assertContains(response, "\n1 recommendation\n")
3422. 
3423.     def test_with_fk_to_field(self):
3424.         """
3425.         The to_field GET parameter is preserved when a search is performed.
3426.         Refs #10918.
3427.         """
3428.         response = self.client.get(reverse('admin:auth_user_changelist') + '?q=joe&%s=id' % TO_FIELD_VAR)
3429.         self.assertContains(response, "\n1 user\n")
3430.         self.assertContains(response, '<input type="hidden" name="%s" value="id">' % TO_FIELD_VAR, html=True)
3431. 
3432.     def test_exact_matches(self):
3433.         response = self.client.get(reverse('admin:admin_views_recommendation_changelist') + '?q=bar')
3434.         # confirm the search returned one object
3435.         self.assertContains(response, "\n1 recommendation\n")
3436. 
3437.         response = self.client.get(reverse('admin:admin_views_recommendation_changelist') + '?q=ba')
3438.         # confirm the search returned zero objects
3439.         self.assertContains(response, "\n0 recommendations\n")
3440. 
3441.     def test_beginning_matches(self):
3442.         response = self.client.get(reverse('admin:admin_views_person_changelist') + '?q=Gui')
3443.         # confirm the search returned one object
3444.         self.assertContains(response, "\n1 person\n")
3445.         self.assertContains(response, "Guido")
3446. 
3447.         response = self.client.get(reverse('admin:admin_views_person_changelist') + '?q=uido')
3448.         # confirm the search returned zero objects
3449.         self.assertContains(response, "\n0 persons\n")
3450.         self.assertNotContains(response, "Guido")
3451. 
3452.     def test_pluggable_search(self):
3453.         PluggableSearchPerson.objects.create(name="Bob", age=10)
3454.         PluggableSearchPerson.objects.create(name="Amy", age=20)
3455. 
3456.         response = self.client.get(reverse('admin:admin_views_pluggablesearchperson_changelist') + '?q=Bob')
3457.         # confirm the search returned one object
3458.         self.assertContains(response, "\n1 pluggable search person\n")
3459.         self.assertContains(response, "Bob")
3460. 
3461.         response = self.client.get(reverse('admin:admin_views_pluggablesearchperson_changelist') + '?q=20')
3462.         # confirm the search returned one object
3463.         self.assertContains(response, "\n1 pluggable search person\n")
3464.         self.assertContains(response, "Amy")
3465. 
3466.     def test_reset_link(self):
3467.         """
3468.         Test presence of reset link in search bar ("1 result (_x total_)").
3469.         """
3470.         #   1 query for session + 1 for fetching user
3471.         # + 1 for filtered result + 1 for filtered count
3472.         # + 1 for total count
3473.         with self.assertNumQueries(5):
3474.             response = self.client.get(reverse('admin:admin_views_person_changelist') + '?q=Gui')
3475.         self.assertContains(
3476.             response,
3477.             """<span class="small quiet">1 result (<a href="?">3 total</a>)</span>""",
3478.             html=True
3479.         )
3480. 
3481.     def test_no_total_count(self):
3482.         """
3483.         #8408 -- "Show all" should be displayed instead of the total count if
3484.         ModelAdmin.show_full_result_count is False.
3485.         """
3486.         #   1 query for session + 1 for fetching user
3487.         # + 1 for filtered result + 1 for filtered count
3488.         with self.assertNumQueries(4):
3489.             response = self.client.get(reverse('admin:admin_views_recommendation_changelist') + '?q=bar')
3490.         self.assertContains(
3491.             response,
3492.             """<span class="small quiet">1 result (<a href="?">Show all</a>)</span>""",
3493.             html=True
3494.         )
3495.         self.assertTrue(response.context['cl'].show_admin_actions)
3496. 
3497. 
3498. @override_settings(ROOT_URLCONF='admin_views.urls')
3499. class AdminInheritedInlinesTest(TestCase):
3500. 
3501.     @classmethod

File: tests/admin_views/tests.py
Line number range: 3501 - 4001
Content:
3501.     @classmethod
3502.     def setUpTestData(cls):
3503.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
3504. 
3505.     def setUp(self):
3506.         self.client.force_login(self.superuser)
3507. 
3508.     def test_inline(self):
3509.         """
3510.         Inline models which inherit from a common parent are correctly handled.
3511.         """
3512.         foo_user = "foo username"
3513.         bar_user = "bar username"
3514. 
3515.         name_re = re.compile(b'name="(.*?)"')
3516. 
3517.         # test the add case
3518.         response = self.client.get(reverse('admin:admin_views_persona_add'))
3519.         names = name_re.findall(response.content)
3520.         # make sure we have no duplicate HTML names
3521.         self.assertEqual(len(names), len(set(names)))
3522. 
3523.         # test the add case
3524.         post_data = {
3525.             "name": "Test Name",
3526.             # inline data
3527.             "accounts-TOTAL_FORMS": "1",
3528.             "accounts-INITIAL_FORMS": "0",
3529.             "accounts-MAX_NUM_FORMS": "0",
3530.             "accounts-0-username": foo_user,
3531.             "accounts-2-TOTAL_FORMS": "1",
3532.             "accounts-2-INITIAL_FORMS": "0",
3533.             "accounts-2-MAX_NUM_FORMS": "0",
3534.             "accounts-2-0-username": bar_user,
3535.         }
3536. 
3537.         response = self.client.post(reverse('admin:admin_views_persona_add'), post_data)
3538.         self.assertEqual(response.status_code, 302)  # redirect somewhere
3539.         self.assertEqual(Persona.objects.count(), 1)
3540.         self.assertEqual(FooAccount.objects.count(), 1)
3541.         self.assertEqual(BarAccount.objects.count(), 1)
3542.         self.assertEqual(FooAccount.objects.all()[0].username, foo_user)
3543.         self.assertEqual(BarAccount.objects.all()[0].username, bar_user)
3544.         self.assertEqual(Persona.objects.all()[0].accounts.count(), 2)
3545. 
3546.         persona_id = Persona.objects.all()[0].id
3547.         foo_id = FooAccount.objects.all()[0].id
3548.         bar_id = BarAccount.objects.all()[0].id
3549. 
3550.         # test the edit case
3551. 
3552.         response = self.client.get(reverse('admin:admin_views_persona_change', args=(persona_id,)))
3553.         names = name_re.findall(response.content)
3554.         # make sure we have no duplicate HTML names
3555.         self.assertEqual(len(names), len(set(names)))
3556. 
3557.         post_data = {
3558.             "name": "Test Name",
3559. 
3560.             "accounts-TOTAL_FORMS": "2",
3561.             "accounts-INITIAL_FORMS": "1",
3562.             "accounts-MAX_NUM_FORMS": "0",
3563. 
3564.             "accounts-0-username": "%s-1" % foo_user,
3565.             "accounts-0-account_ptr": str(foo_id),
3566.             "accounts-0-persona": str(persona_id),
3567. 
3568.             "accounts-2-TOTAL_FORMS": "2",
3569.             "accounts-2-INITIAL_FORMS": "1",
3570.             "accounts-2-MAX_NUM_FORMS": "0",
3571. 
3572.             "accounts-2-0-username": "%s-1" % bar_user,
3573.             "accounts-2-0-account_ptr": str(bar_id),
3574.             "accounts-2-0-persona": str(persona_id),
3575.         }
3576.         response = self.client.post(reverse('admin:admin_views_persona_change', args=(persona_id,)), post_data)
3577.         self.assertEqual(response.status_code, 302)
3578.         self.assertEqual(Persona.objects.count(), 1)
3579.         self.assertEqual(FooAccount.objects.count(), 1)
3580.         self.assertEqual(BarAccount.objects.count(), 1)
3581.         self.assertEqual(FooAccount.objects.all()[0].username, "%s-1" % foo_user)
3582.         self.assertEqual(BarAccount.objects.all()[0].username, "%s-1" % bar_user)
3583.         self.assertEqual(Persona.objects.all()[0].accounts.count(), 2)
3584. 
3585. 
3586. @override_settings(ROOT_URLCONF='admin_views.urls')
3587. class TestCustomChangeList(TestCase):
3588. 
3589.     @classmethod
3590.     def setUpTestData(cls):
3591.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
3592. 
3593.     def setUp(self):
3594.         self.client.force_login(self.superuser)
3595. 
3596.     def test_custom_changelist(self):
3597.         """
3598.         Validate that a custom ChangeList class can be used (#9749)
3599.         """
3600.         # Insert some data
3601.         post_data = {"name": "First Gadget"}
3602.         response = self.client.post(reverse('admin:admin_views_gadget_add'), post_data)
3603.         self.assertEqual(response.status_code, 302)  # redirect somewhere
3604.         # Hit the page once to get messages out of the queue message list
3605.         response = self.client.get(reverse('admin:admin_views_gadget_changelist'))
3606.         # Data is still not visible on the page
3607.         response = self.client.get(reverse('admin:admin_views_gadget_changelist'))
3608.         self.assertEqual(response.status_code, 200)
3609.         self.assertNotContains(response, 'First Gadget')
3610. 
3611. 
3612. @override_settings(ROOT_URLCONF='admin_views.urls')
3613. class TestInlineNotEditable(TestCase):
3614. 
3615.     @classmethod
3616.     def setUpTestData(cls):
3617.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
3618. 
3619.     def setUp(self):
3620.         self.client.force_login(self.superuser)
3621. 
3622.     def test_GET_parent_add(self):
3623.         """
3624.         InlineModelAdmin broken?
3625.         """
3626.         response = self.client.get(reverse('admin:admin_views_parent_add'))
3627.         self.assertEqual(response.status_code, 200)
3628. 
3629. 
3630. @override_settings(ROOT_URLCONF='admin_views.urls')
3631. class AdminCustomQuerysetTest(TestCase):
3632. 
3633.     @classmethod
3634.     def setUpTestData(cls):
3635.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
3636.         cls.pks = [EmptyModel.objects.create().id for i in range(3)]
3637. 
3638.     def setUp(self):
3639.         self.client.force_login(self.superuser)
3640.         self.super_login = {
3641.             REDIRECT_FIELD_NAME: reverse('admin:index'),
3642.             'username': 'super',
3643.             'password': 'secret',
3644.         }
3645. 
3646.     def test_changelist_view(self):
3647.         response = self.client.get(reverse('admin:admin_views_emptymodel_changelist'))
3648.         for i in self.pks:
3649.             if i > 1:
3650.                 self.assertContains(response, 'Primary key = %s' % i)
3651.             else:
3652.                 self.assertNotContains(response, 'Primary key = %s' % i)
3653. 
3654.     def test_changelist_view_count_queries(self):
3655.         # create 2 Person objects
3656.         Person.objects.create(name='person1', gender=1)
3657.         Person.objects.create(name='person2', gender=2)
3658.         changelist_url = reverse('admin:admin_views_person_changelist')
3659. 
3660.         # 5 queries are expected: 1 for the session, 1 for the user,
3661.         # 2 for the counts and 1 for the objects on the page
3662.         with self.assertNumQueries(5):
3663.             resp = self.client.get(changelist_url)
3664.             self.assertEqual(resp.context['selection_note'], '0 of 2 selected')
3665.             self.assertEqual(resp.context['selection_note_all'], 'All 2 selected')
3666.         with self.assertNumQueries(5):
3667.             extra = {'q': 'not_in_name'}
3668.             resp = self.client.get(changelist_url, extra)
3669.             self.assertEqual(resp.context['selection_note'], '0 of 0 selected')
3670.             self.assertEqual(resp.context['selection_note_all'], 'All 0 selected')
3671.         with self.assertNumQueries(5):
3672.             extra = {'q': 'person'}
3673.             resp = self.client.get(changelist_url, extra)
3674.             self.assertEqual(resp.context['selection_note'], '0 of 2 selected')
3675.             self.assertEqual(resp.context['selection_note_all'], 'All 2 selected')
3676.         with self.assertNumQueries(5):
3677.             extra = {'gender__exact': '1'}
3678.             resp = self.client.get(changelist_url, extra)
3679.             self.assertEqual(resp.context['selection_note'], '0 of 1 selected')
3680.             self.assertEqual(resp.context['selection_note_all'], '1 selected')
3681. 
3682.     def test_change_view(self):
3683.         for i in self.pks:
3684.             url = reverse('admin:admin_views_emptymodel_change', args=(i,))
3685.             response = self.client.get(url, follow=True)
3686.             if i > 1:
3687.                 self.assertEqual(response.status_code, 200)
3688.             else:
3689.                 self.assertRedirects(response, reverse('admin:index'))
3690.                 self.assertEqual(
3691.                     [m.message for m in response.context['messages']],
3692.                     ["""empty model with ID "1" doesn't exist. Perhaps it was deleted?"""]
3693.                 )
3694. 
3695.     def test_add_model_modeladmin_defer_qs(self):
3696.         # Test for #14529. defer() is used in ModelAdmin.get_queryset()
3697. 
3698.         # model has __str__ method
3699.         self.assertEqual(CoverLetter.objects.count(), 0)
3700.         # Emulate model instance creation via the admin
3701.         post_data = {
3702.             "author": "Candidate, Best",
3703.             "_save": "Save",
3704.         }
3705.         response = self.client.post(reverse('admin:admin_views_coverletter_add'), post_data, follow=True)
3706.         self.assertEqual(response.status_code, 200)
3707.         self.assertEqual(CoverLetter.objects.count(), 1)
3708.         # Message should contain non-ugly model verbose name
3709.         pk = CoverLetter.objects.all()[0].pk
3710.         self.assertContains(
3711.             response,
3712.             '<li class="success">The cover letter "<a href="%s">'
3713.             'Candidate, Best</a>" was added successfully.</li>' %
3714.             reverse('admin:admin_views_coverletter_change', args=(pk,)), html=True
3715.         )
3716. 
3717.         # model has no __str__ method
3718.         self.assertEqual(ShortMessage.objects.count(), 0)
3719.         # Emulate model instance creation via the admin
3720.         post_data = {
3721.             "content": "What's this SMS thing?",
3722.             "_save": "Save",
3723.         }
3724.         response = self.client.post(reverse('admin:admin_views_shortmessage_add'), post_data, follow=True)
3725.         self.assertEqual(response.status_code, 200)
3726.         self.assertEqual(ShortMessage.objects.count(), 1)
3727.         # Message should contain non-ugly model verbose name
3728.         sm = ShortMessage.objects.all()[0]
3729.         self.assertContains(
3730.             response,
3731.             '<li class="success">The short message "<a href="%s">'
3732.             '%s</a>" was added successfully.</li>' %
3733.             (reverse('admin:admin_views_shortmessage_change', args=(sm.pk,)), sm), html=True
3734.         )
3735. 
3736.     def test_add_model_modeladmin_only_qs(self):
3737.         # Test for #14529. only() is used in ModelAdmin.get_queryset()
3738. 
3739.         # model has __str__ method
3740.         self.assertEqual(Telegram.objects.count(), 0)
3741.         # Emulate model instance creation via the admin
3742.         post_data = {
3743.             "title": "Urgent telegram",
3744.             "_save": "Save",
3745.         }
3746.         response = self.client.post(reverse('admin:admin_views_telegram_add'), post_data, follow=True)
3747.         self.assertEqual(response.status_code, 200)
3748.         self.assertEqual(Telegram.objects.count(), 1)
3749.         # Message should contain non-ugly model verbose name
3750.         pk = Telegram.objects.all()[0].pk
3751.         self.assertContains(
3752.             response,
3753.             '<li class="success">The telegram "<a href="%s">'
3754.             'Urgent telegram</a>" was added successfully.</li>' %
3755.             reverse('admin:admin_views_telegram_change', args=(pk,)), html=True
3756.         )
3757. 
3758.         # model has no __str__ method
3759.         self.assertEqual(Paper.objects.count(), 0)
3760.         # Emulate model instance creation via the admin
3761.         post_data = {
3762.             "title": "My Modified Paper Title",
3763.             "_save": "Save",
3764.         }
3765.         response = self.client.post(reverse('admin:admin_views_paper_add'), post_data, follow=True)
3766.         self.assertEqual(response.status_code, 200)
3767.         self.assertEqual(Paper.objects.count(), 1)
3768.         # Message should contain non-ugly model verbose name
3769.         p = Paper.objects.all()[0]
3770.         self.assertContains(
3771.             response,
3772.             '<li class="success">The paper "<a href="%s">'
3773.             '%s</a>" was added successfully.</li>' %
3774.             (reverse('admin:admin_views_paper_change', args=(p.pk,)), p), html=True
3775.         )
3776. 
3777.     def test_edit_model_modeladmin_defer_qs(self):
3778.         # Test for #14529. defer() is used in ModelAdmin.get_queryset()
3779. 
3780.         # model has __str__ method
3781.         cl = CoverLetter.objects.create(author="John Doe")
3782.         self.assertEqual(CoverLetter.objects.count(), 1)
3783.         response = self.client.get(reverse('admin:admin_views_coverletter_change', args=(cl.pk,)))
3784.         self.assertEqual(response.status_code, 200)
3785.         # Emulate model instance edit via the admin
3786.         post_data = {
3787.             "author": "John Doe II",
3788.             "_save": "Save",
3789.         }
3790.         url = reverse('admin:admin_views_coverletter_change', args=(cl.pk,))
3791.         response = self.client.post(url, post_data, follow=True)
3792.         self.assertEqual(response.status_code, 200)
3793.         self.assertEqual(CoverLetter.objects.count(), 1)
3794.         # Message should contain non-ugly model verbose name. Instance
3795.         # representation is set by model's __str__()
3796.         self.assertContains(
3797.             response,
3798.             '<li class="success">The cover letter "<a href="%s">'
3799.             'John Doe II</a>" was changed successfully.</li>' %
3800.             reverse('admin:admin_views_coverletter_change', args=(cl.pk,)), html=True
3801.         )
3802. 
3803.         # model has no __str__ method
3804.         sm = ShortMessage.objects.create(content="This is expensive")
3805.         self.assertEqual(ShortMessage.objects.count(), 1)
3806.         response = self.client.get(reverse('admin:admin_views_shortmessage_change', args=(sm.pk,)))
3807.         self.assertEqual(response.status_code, 200)
3808.         # Emulate model instance edit via the admin
3809.         post_data = {
3810.             "content": "Too expensive",
3811.             "_save": "Save",
3812.         }
3813.         url = reverse('admin:admin_views_shortmessage_change', args=(sm.pk,))
3814.         response = self.client.post(url, post_data, follow=True)
3815.         self.assertEqual(response.status_code, 200)
3816.         self.assertEqual(ShortMessage.objects.count(), 1)
3817.         # Message should contain non-ugly model verbose name. The ugly(!)
3818.         # instance representation is set by __str__().
3819.         self.assertContains(
3820.             response,
3821.             '<li class="success">The short message "<a href="%s">'
3822.             '%s</a>" was changed successfully.</li>' %
3823.             (reverse('admin:admin_views_shortmessage_change', args=(sm.pk,)), sm), html=True
3824.         )
3825. 
3826.     def test_edit_model_modeladmin_only_qs(self):
3827.         # Test for #14529. only() is used in ModelAdmin.get_queryset()
3828. 
3829.         # model has __str__ method
3830.         t = Telegram.objects.create(title="First Telegram")
3831.         self.assertEqual(Telegram.objects.count(), 1)
3832.         response = self.client.get(reverse('admin:admin_views_telegram_change', args=(t.pk,)))
3833.         self.assertEqual(response.status_code, 200)
3834.         # Emulate model instance edit via the admin
3835.         post_data = {
3836.             "title": "Telegram without typo",
3837.             "_save": "Save",
3838.         }
3839.         response = self.client.post(reverse('admin:admin_views_telegram_change', args=(t.pk,)), post_data, follow=True)
3840.         self.assertEqual(response.status_code, 200)
3841.         self.assertEqual(Telegram.objects.count(), 1)
3842.         # Message should contain non-ugly model verbose name. The instance
3843.         # representation is set by model's __str__()
3844.         self.assertContains(
3845.             response,
3846.             '<li class="success">The telegram "<a href="%s">'
3847.             'Telegram without typo</a>" was changed successfully.</li>' %
3848.             reverse('admin:admin_views_telegram_change', args=(t.pk,)), html=True
3849.         )
3850. 
3851.         # model has no __str__ method
3852.         p = Paper.objects.create(title="My Paper Title")
3853.         self.assertEqual(Paper.objects.count(), 1)
3854.         response = self.client.get(reverse('admin:admin_views_paper_change', args=(p.pk,)))
3855.         self.assertEqual(response.status_code, 200)
3856.         # Emulate model instance edit via the admin
3857.         post_data = {
3858.             "title": "My Modified Paper Title",
3859.             "_save": "Save",
3860.         }
3861.         response = self.client.post(reverse('admin:admin_views_paper_change', args=(p.pk,)), post_data, follow=True)
3862.         self.assertEqual(response.status_code, 200)
3863.         self.assertEqual(Paper.objects.count(), 1)
3864.         # Message should contain non-ugly model verbose name. The ugly(!)
3865.         # instance representation is set by __str__().
3866.         self.assertContains(
3867.             response,
3868.             '<li class="success">The paper "<a href="%s">'
3869.             '%s</a>" was changed successfully.</li>' %
3870.             (reverse('admin:admin_views_paper_change', args=(p.pk,)), p), html=True
3871.         )
3872. 
3873.     def test_history_view_custom_qs(self):
3874.         """
3875.         Custom querysets are considered for the admin history view.
3876.         """
3877.         self.client.post(reverse('admin:login'), self.super_login)
3878.         FilteredManager.objects.create(pk=1)
3879.         FilteredManager.objects.create(pk=2)
3880.         response = self.client.get(reverse('admin:admin_views_filteredmanager_changelist'))
3881.         self.assertContains(response, "PK=1")
3882.         self.assertContains(response, "PK=2")
3883.         self.assertEqual(
3884.             self.client.get(reverse('admin:admin_views_filteredmanager_history', args=(1,))).status_code, 200
3885.         )
3886.         self.assertEqual(
3887.             self.client.get(reverse('admin:admin_views_filteredmanager_history', args=(2,))).status_code, 200
3888.         )
3889. 
3890. 
3891. @override_settings(ROOT_URLCONF='admin_views.urls')
3892. class AdminInlineFileUploadTest(TestCase):
3893. 
3894.     @classmethod
3895.     def setUpTestData(cls):
3896.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
3897.         file1 = tempfile.NamedTemporaryFile(suffix=".file1")
3898.         file1.write(b'a' * (2 ** 21))
3899.         filename = file1.name
3900.         file1.close()
3901.         cls.gallery = Gallery.objects.create(name='Test Gallery')
3902.         cls.picture = Picture.objects.create(
3903.             name='Test Picture',
3904.             image=filename,
3905.             gallery=cls.gallery,
3906.         )
3907. 
3908.     def setUp(self):
3909.         self.client.force_login(self.superuser)
3910. 
3911.     def test_form_has_multipart_enctype(self):
3912.         response = self.client.get(
3913.             reverse('admin:admin_views_gallery_change', args=(self.gallery.id,))
3914.         )
3915.         self.assertIs(response.context['has_file_field'], True)
3916.         self.assertContains(response, MULTIPART_ENCTYPE)
3917. 
3918.     def test_inline_file_upload_edit_validation_error_post(self):
3919.         """
3920.         Inline file uploads correctly display prior data (#10002).
3921.         """
3922.         post_data = {
3923.             "name": "Test Gallery",
3924.             "pictures-TOTAL_FORMS": "2",
3925.             "pictures-INITIAL_FORMS": "1",
3926.             "pictures-MAX_NUM_FORMS": "0",
3927.             "pictures-0-id": str(self.picture.id),
3928.             "pictures-0-gallery": str(self.gallery.id),
3929.             "pictures-0-name": "Test Picture",
3930.             "pictures-0-image": "",
3931.             "pictures-1-id": "",
3932.             "pictures-1-gallery": str(self.gallery.id),
3933.             "pictures-1-name": "Test Picture 2",
3934.             "pictures-1-image": "",
3935.         }
3936.         response = self.client.post(
3937.             reverse('admin:admin_views_gallery_change', args=(self.gallery.id,)), post_data
3938.         )
3939.         self.assertContains(response, b"Currently")
3940. 
3941. 
3942. @override_settings(ROOT_URLCONF='admin_views.urls')
3943. class AdminInlineTests(TestCase):
3944. 
3945.     @classmethod
3946.     def setUpTestData(cls):
3947.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
3948.         cls.collector = Collector.objects.create(pk=1, name='John Fowles')
3949. 
3950.     def setUp(self):
3951.         self.post_data = {
3952.             "name": "Test Name",
3953. 
3954.             "widget_set-TOTAL_FORMS": "3",
3955.             "widget_set-INITIAL_FORMS": "0",
3956.             "widget_set-MAX_NUM_FORMS": "0",
3957.             "widget_set-0-id": "",
3958.             "widget_set-0-owner": "1",
3959.             "widget_set-0-name": "",
3960.             "widget_set-1-id": "",
3961.             "widget_set-1-owner": "1",
3962.             "widget_set-1-name": "",
3963.             "widget_set-2-id": "",
3964.             "widget_set-2-owner": "1",
3965.             "widget_set-2-name": "",
3966. 
3967.             "doohickey_set-TOTAL_FORMS": "3",
3968.             "doohickey_set-INITIAL_FORMS": "0",
3969.             "doohickey_set-MAX_NUM_FORMS": "0",
3970.             "doohickey_set-0-owner": "1",
3971.             "doohickey_set-0-code": "",
3972.             "doohickey_set-0-name": "",
3973.             "doohickey_set-1-owner": "1",
3974.             "doohickey_set-1-code": "",
3975.             "doohickey_set-1-name": "",
3976.             "doohickey_set-2-owner": "1",
3977.             "doohickey_set-2-code": "",
3978.             "doohickey_set-2-name": "",
3979. 
3980.             "grommet_set-TOTAL_FORMS": "3",
3981.             "grommet_set-INITIAL_FORMS": "0",
3982.             "grommet_set-MAX_NUM_FORMS": "0",
3983.             "grommet_set-0-code": "",
3984.             "grommet_set-0-owner": "1",
3985.             "grommet_set-0-name": "",
3986.             "grommet_set-1-code": "",
3987.             "grommet_set-1-owner": "1",
3988.             "grommet_set-1-name": "",
3989.             "grommet_set-2-code": "",
3990.             "grommet_set-2-owner": "1",
3991.             "grommet_set-2-name": "",
3992. 
3993.             "whatsit_set-TOTAL_FORMS": "3",
3994.             "whatsit_set-INITIAL_FORMS": "0",
3995.             "whatsit_set-MAX_NUM_FORMS": "0",
3996.             "whatsit_set-0-owner": "1",
3997.             "whatsit_set-0-index": "",
3998.             "whatsit_set-0-name": "",
3999.             "whatsit_set-1-owner": "1",
4000.             "whatsit_set-1-index": "",
4001.             "whatsit_set-1-name": "",

File: tests/admin_views/tests.py
Line number range: 4001 - 4501
Content:
4001.             "whatsit_set-1-name": "",
4002.             "whatsit_set-2-owner": "1",
4003.             "whatsit_set-2-index": "",
4004.             "whatsit_set-2-name": "",
4005. 
4006.             "fancydoodad_set-TOTAL_FORMS": "3",
4007.             "fancydoodad_set-INITIAL_FORMS": "0",
4008.             "fancydoodad_set-MAX_NUM_FORMS": "0",
4009.             "fancydoodad_set-0-doodad_ptr": "",
4010.             "fancydoodad_set-0-owner": "1",
4011.             "fancydoodad_set-0-name": "",
4012.             "fancydoodad_set-0-expensive": "on",
4013.             "fancydoodad_set-1-doodad_ptr": "",
4014.             "fancydoodad_set-1-owner": "1",
4015.             "fancydoodad_set-1-name": "",
4016.             "fancydoodad_set-1-expensive": "on",
4017.             "fancydoodad_set-2-doodad_ptr": "",
4018.             "fancydoodad_set-2-owner": "1",
4019.             "fancydoodad_set-2-name": "",
4020.             "fancydoodad_set-2-expensive": "on",
4021. 
4022.             "category_set-TOTAL_FORMS": "3",
4023.             "category_set-INITIAL_FORMS": "0",
4024.             "category_set-MAX_NUM_FORMS": "0",
4025.             "category_set-0-order": "",
4026.             "category_set-0-id": "",
4027.             "category_set-0-collector": "1",
4028.             "category_set-1-order": "",
4029.             "category_set-1-id": "",
4030.             "category_set-1-collector": "1",
4031.             "category_set-2-order": "",
4032.             "category_set-2-id": "",
4033.             "category_set-2-collector": "1",
4034.         }
4035. 
4036.         self.client.force_login(self.superuser)
4037. 
4038.     def test_simple_inline(self):
4039.         "A simple model can be saved as inlines"
4040.         # First add a new inline
4041.         self.post_data['widget_set-0-name'] = "Widget 1"
4042.         collector_url = reverse('admin:admin_views_collector_change', args=(self.collector.pk,))
4043.         response = self.client.post(collector_url, self.post_data)
4044.         self.assertEqual(response.status_code, 302)
4045.         self.assertEqual(Widget.objects.count(), 1)
4046.         self.assertEqual(Widget.objects.all()[0].name, "Widget 1")
4047.         widget_id = Widget.objects.all()[0].id
4048. 
4049.         # The PK link exists on the rendered form
4050.         response = self.client.get(collector_url)
4051.         self.assertContains(response, 'name="widget_set-0-id"')
4052. 
4053.         # No file or image fields, no enctype on the forms
4054.         self.assertIs(response.context['has_file_field'], False)
4055.         self.assertNotContains(response, MULTIPART_ENCTYPE)
4056. 
4057.         # Now resave that inline
4058.         self.post_data['widget_set-INITIAL_FORMS'] = "1"
4059.         self.post_data['widget_set-0-id'] = str(widget_id)
4060.         self.post_data['widget_set-0-name'] = "Widget 1"
4061.         response = self.client.post(collector_url, self.post_data)
4062.         self.assertEqual(response.status_code, 302)
4063.         self.assertEqual(Widget.objects.count(), 1)
4064.         self.assertEqual(Widget.objects.all()[0].name, "Widget 1")
4065. 
4066.         # Now modify that inline
4067.         self.post_data['widget_set-INITIAL_FORMS'] = "1"
4068.         self.post_data['widget_set-0-id'] = str(widget_id)
4069.         self.post_data['widget_set-0-name'] = "Widget 1 Updated"
4070.         response = self.client.post(collector_url, self.post_data)
4071.         self.assertEqual(response.status_code, 302)
4072.         self.assertEqual(Widget.objects.count(), 1)
4073.         self.assertEqual(Widget.objects.all()[0].name, "Widget 1 Updated")
4074. 
4075.     def test_simple_inline_permissions(self):
4076.         """
4077.         Changes aren't allowed without change permissions for the inline object.
4078.         """
4079.         # User who can view Articles
4080.         permissionuser = User.objects.create_user(
4081.             username='permissionuser', password='secret',
4082.             email='vuser@example.com', is_staff=True,
4083.         )
4084.         permissionuser.user_permissions.add(get_perm(Collector, get_permission_codename('view', Collector._meta)))
4085.         permissionuser.user_permissions.add(get_perm(Widget, get_permission_codename('view', Widget._meta)))
4086.         self.client.force_login(permissionuser)
4087.         # Without add permission, a new inline can't be added.
4088.         self.post_data['widget_set-0-name'] = 'Widget 1'
4089.         collector_url = reverse('admin:admin_views_collector_change', args=(self.collector.pk,))
4090.         response = self.client.post(collector_url, self.post_data)
4091.         self.assertEqual(response.status_code, 302)
4092.         self.assertEqual(Widget.objects.count(), 0)
4093.         # But after adding the permisson it can.
4094.         permissionuser.user_permissions.add(get_perm(Widget, get_permission_codename('add', Widget._meta)))
4095.         self.post_data['widget_set-0-name'] = "Widget 1"
4096.         collector_url = reverse('admin:admin_views_collector_change', args=(self.collector.pk,))
4097.         response = self.client.post(collector_url, self.post_data)
4098.         self.assertEqual(response.status_code, 302)
4099.         self.assertEqual(Widget.objects.count(), 1)
4100.         self.assertEqual(Widget.objects.first().name, 'Widget 1')
4101.         widget_id = Widget.objects.first().id
4102.         # Without the change permission, a POST doesn't change the object.
4103.         self.post_data['widget_set-INITIAL_FORMS'] = '1'
4104.         self.post_data['widget_set-0-id'] = str(widget_id)
4105.         self.post_data['widget_set-0-name'] = 'Widget 1 Updated'
4106.         response = self.client.post(collector_url, self.post_data)
4107.         self.assertEqual(response.status_code, 302)
4108.         self.assertEqual(Widget.objects.count(), 1)
4109.         self.assertEqual(Widget.objects.first().name, 'Widget 1')
4110.         # Now adding the change permission and editing works.
4111.         permissionuser.user_permissions.remove(get_perm(Widget, get_permission_codename('add', Widget._meta)))
4112.         permissionuser.user_permissions.add(get_perm(Widget, get_permission_codename('change', Widget._meta)))
4113.         self.post_data['widget_set-INITIAL_FORMS'] = '1'
4114.         self.post_data['widget_set-0-id'] = str(widget_id)
4115.         self.post_data['widget_set-0-name'] = 'Widget 1 Updated'
4116.         response = self.client.post(collector_url, self.post_data)
4117.         self.assertEqual(response.status_code, 302)
4118.         self.assertEqual(Widget.objects.count(), 1)
4119.         self.assertEqual(Widget.objects.first().name, 'Widget 1 Updated')
4120. 
4121.     def test_explicit_autofield_inline(self):
4122.         "A model with an explicit autofield primary key can be saved as inlines. Regression for #8093"
4123.         # First add a new inline
4124.         self.post_data['grommet_set-0-name'] = "Grommet 1"
4125.         collector_url = reverse('admin:admin_views_collector_change', args=(self.collector.pk,))
4126.         response = self.client.post(collector_url, self.post_data)
4127.         self.assertEqual(response.status_code, 302)
4128.         self.assertEqual(Grommet.objects.count(), 1)
4129.         self.assertEqual(Grommet.objects.all()[0].name, "Grommet 1")
4130. 
4131.         # The PK link exists on the rendered form
4132.         response = self.client.get(collector_url)
4133.         self.assertContains(response, 'name="grommet_set-0-code"')
4134. 
4135.         # Now resave that inline
4136.         self.post_data['grommet_set-INITIAL_FORMS'] = "1"
4137.         self.post_data['grommet_set-0-code'] = str(Grommet.objects.all()[0].code)
4138.         self.post_data['grommet_set-0-name'] = "Grommet 1"
4139.         response = self.client.post(collector_url, self.post_data)
4140.         self.assertEqual(response.status_code, 302)
4141.         self.assertEqual(Grommet.objects.count(), 1)
4142.         self.assertEqual(Grommet.objects.all()[0].name, "Grommet 1")
4143. 
4144.         # Now modify that inline
4145.         self.post_data['grommet_set-INITIAL_FORMS'] = "1"
4146.         self.post_data['grommet_set-0-code'] = str(Grommet.objects.all()[0].code)
4147.         self.post_data['grommet_set-0-name'] = "Grommet 1 Updated"
4148.         response = self.client.post(collector_url, self.post_data)
4149.         self.assertEqual(response.status_code, 302)
4150.         self.assertEqual(Grommet.objects.count(), 1)
4151.         self.assertEqual(Grommet.objects.all()[0].name, "Grommet 1 Updated")
4152. 
4153.     def test_char_pk_inline(self):
4154.         "A model with a character PK can be saved as inlines. Regression for #10992"
4155.         # First add a new inline
4156.         self.post_data['doohickey_set-0-code'] = "DH1"
4157.         self.post_data['doohickey_set-0-name'] = "Doohickey 1"
4158.         collector_url = reverse('admin:admin_views_collector_change', args=(self.collector.pk,))
4159.         response = self.client.post(collector_url, self.post_data)
4160.         self.assertEqual(response.status_code, 302)
4161.         self.assertEqual(DooHickey.objects.count(), 1)
4162.         self.assertEqual(DooHickey.objects.all()[0].name, "Doohickey 1")
4163. 
4164.         # The PK link exists on the rendered form
4165.         response = self.client.get(collector_url)
4166.         self.assertContains(response, 'name="doohickey_set-0-code"')
4167. 
4168.         # Now resave that inline
4169.         self.post_data['doohickey_set-INITIAL_FORMS'] = "1"
4170.         self.post_data['doohickey_set-0-code'] = "DH1"
4171.         self.post_data['doohickey_set-0-name'] = "Doohickey 1"
4172.         response = self.client.post(collector_url, self.post_data)
4173.         self.assertEqual(response.status_code, 302)
4174.         self.assertEqual(DooHickey.objects.count(), 1)
4175.         self.assertEqual(DooHickey.objects.all()[0].name, "Doohickey 1")
4176. 
4177.         # Now modify that inline
4178.         self.post_data['doohickey_set-INITIAL_FORMS'] = "1"
4179.         self.post_data['doohickey_set-0-code'] = "DH1"
4180.         self.post_data['doohickey_set-0-name'] = "Doohickey 1 Updated"
4181.         response = self.client.post(collector_url, self.post_data)
4182.         self.assertEqual(response.status_code, 302)
4183.         self.assertEqual(DooHickey.objects.count(), 1)
4184.         self.assertEqual(DooHickey.objects.all()[0].name, "Doohickey 1 Updated")
4185. 
4186.     def test_integer_pk_inline(self):
4187.         "A model with an integer PK can be saved as inlines. Regression for #10992"
4188.         # First add a new inline
4189.         self.post_data['whatsit_set-0-index'] = "42"
4190.         self.post_data['whatsit_set-0-name'] = "Whatsit 1"
4191.         collector_url = reverse('admin:admin_views_collector_change', args=(self.collector.pk,))
4192.         response = self.client.post(collector_url, self.post_data)
4193.         self.assertEqual(response.status_code, 302)
4194.         self.assertEqual(Whatsit.objects.count(), 1)
4195.         self.assertEqual(Whatsit.objects.all()[0].name, "Whatsit 1")
4196. 
4197.         # The PK link exists on the rendered form
4198.         response = self.client.get(collector_url)
4199.         self.assertContains(response, 'name="whatsit_set-0-index"')
4200. 
4201.         # Now resave that inline
4202.         self.post_data['whatsit_set-INITIAL_FORMS'] = "1"
4203.         self.post_data['whatsit_set-0-index'] = "42"
4204.         self.post_data['whatsit_set-0-name'] = "Whatsit 1"
4205.         response = self.client.post(collector_url, self.post_data)
4206.         self.assertEqual(response.status_code, 302)
4207.         self.assertEqual(Whatsit.objects.count(), 1)
4208.         self.assertEqual(Whatsit.objects.all()[0].name, "Whatsit 1")
4209. 
4210.         # Now modify that inline
4211.         self.post_data['whatsit_set-INITIAL_FORMS'] = "1"
4212.         self.post_data['whatsit_set-0-index'] = "42"
4213.         self.post_data['whatsit_set-0-name'] = "Whatsit 1 Updated"
4214.         response = self.client.post(collector_url, self.post_data)
4215.         self.assertEqual(response.status_code, 302)
4216.         self.assertEqual(Whatsit.objects.count(), 1)
4217.         self.assertEqual(Whatsit.objects.all()[0].name, "Whatsit 1 Updated")
4218. 
4219.     def test_inherited_inline(self):
4220.         "An inherited model can be saved as inlines. Regression for #11042"
4221.         # First add a new inline
4222.         self.post_data['fancydoodad_set-0-name'] = "Fancy Doodad 1"
4223.         collector_url = reverse('admin:admin_views_collector_change', args=(self.collector.pk,))
4224.         response = self.client.post(collector_url, self.post_data)
4225.         self.assertEqual(response.status_code, 302)
4226.         self.assertEqual(FancyDoodad.objects.count(), 1)
4227.         self.assertEqual(FancyDoodad.objects.all()[0].name, "Fancy Doodad 1")
4228.         doodad_pk = FancyDoodad.objects.all()[0].pk
4229. 
4230.         # The PK link exists on the rendered form
4231.         response = self.client.get(collector_url)
4232.         self.assertContains(response, 'name="fancydoodad_set-0-doodad_ptr"')
4233. 
4234.         # Now resave that inline
4235.         self.post_data['fancydoodad_set-INITIAL_FORMS'] = "1"
4236.         self.post_data['fancydoodad_set-0-doodad_ptr'] = str(doodad_pk)
4237.         self.post_data['fancydoodad_set-0-name'] = "Fancy Doodad 1"
4238.         response = self.client.post(collector_url, self.post_data)
4239.         self.assertEqual(response.status_code, 302)
4240.         self.assertEqual(FancyDoodad.objects.count(), 1)
4241.         self.assertEqual(FancyDoodad.objects.all()[0].name, "Fancy Doodad 1")
4242. 
4243.         # Now modify that inline
4244.         self.post_data['fancydoodad_set-INITIAL_FORMS'] = "1"
4245.         self.post_data['fancydoodad_set-0-doodad_ptr'] = str(doodad_pk)
4246.         self.post_data['fancydoodad_set-0-name'] = "Fancy Doodad 1 Updated"
4247.         response = self.client.post(collector_url, self.post_data)
4248.         self.assertEqual(response.status_code, 302)
4249.         self.assertEqual(FancyDoodad.objects.count(), 1)
4250.         self.assertEqual(FancyDoodad.objects.all()[0].name, "Fancy Doodad 1 Updated")
4251. 
4252.     def test_ordered_inline(self):
4253.         """
4254.         An inline with an editable ordering fields is updated correctly.
4255.         """
4256.         # Create some objects with an initial ordering
4257.         Category.objects.create(id=1, order=1, collector=self.collector)
4258.         Category.objects.create(id=2, order=2, collector=self.collector)
4259.         Category.objects.create(id=3, order=0, collector=self.collector)
4260.         Category.objects.create(id=4, order=0, collector=self.collector)
4261. 
4262.         # NB: The order values must be changed so that the items are reordered.
4263.         self.post_data.update({
4264.             "name": "Frederick Clegg",
4265. 
4266.             "category_set-TOTAL_FORMS": "7",
4267.             "category_set-INITIAL_FORMS": "4",
4268.             "category_set-MAX_NUM_FORMS": "0",
4269. 
4270.             "category_set-0-order": "14",
4271.             "category_set-0-id": "1",
4272.             "category_set-0-collector": "1",
4273. 
4274.             "category_set-1-order": "13",
4275.             "category_set-1-id": "2",
4276.             "category_set-1-collector": "1",
4277. 
4278.             "category_set-2-order": "1",
4279.             "category_set-2-id": "3",
4280.             "category_set-2-collector": "1",
4281. 
4282.             "category_set-3-order": "0",
4283.             "category_set-3-id": "4",
4284.             "category_set-3-collector": "1",
4285. 
4286.             "category_set-4-order": "",
4287.             "category_set-4-id": "",
4288.             "category_set-4-collector": "1",
4289. 
4290.             "category_set-5-order": "",
4291.             "category_set-5-id": "",
4292.             "category_set-5-collector": "1",
4293. 
4294.             "category_set-6-order": "",
4295.             "category_set-6-id": "",
4296.             "category_set-6-collector": "1",
4297.         })
4298.         collector_url = reverse('admin:admin_views_collector_change', args=(self.collector.pk,))
4299.         response = self.client.post(collector_url, self.post_data)
4300.         # Successful post will redirect
4301.         self.assertEqual(response.status_code, 302)
4302. 
4303.         # The order values have been applied to the right objects
4304.         self.assertEqual(self.collector.category_set.count(), 4)
4305.         self.assertEqual(Category.objects.get(id=1).order, 14)
4306.         self.assertEqual(Category.objects.get(id=2).order, 13)
4307.         self.assertEqual(Category.objects.get(id=3).order, 1)
4308.         self.assertEqual(Category.objects.get(id=4).order, 0)
4309. 
4310. 
4311. @override_settings(ROOT_URLCONF='admin_views.urls')
4312. class NeverCacheTests(TestCase):
4313. 
4314.     @classmethod
4315.     def setUpTestData(cls):
4316.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
4317.         cls.s1 = Section.objects.create(name='Test section')
4318. 
4319.     def setUp(self):
4320.         self.client.force_login(self.superuser)
4321. 
4322.     def test_admin_index(self):
4323.         "Check the never-cache status of the main index"
4324.         response = self.client.get(reverse('admin:index'))
4325.         self.assertEqual(get_max_age(response), 0)
4326. 
4327.     def test_app_index(self):
4328.         "Check the never-cache status of an application index"
4329.         response = self.client.get(reverse('admin:app_list', args=('admin_views',)))
4330.         self.assertEqual(get_max_age(response), 0)
4331. 
4332.     def test_model_index(self):
4333.         "Check the never-cache status of a model index"
4334.         response = self.client.get(reverse('admin:admin_views_fabric_changelist'))
4335.         self.assertEqual(get_max_age(response), 0)
4336. 
4337.     def test_model_add(self):
4338.         "Check the never-cache status of a model add page"
4339.         response = self.client.get(reverse('admin:admin_views_fabric_add'))
4340.         self.assertEqual(get_max_age(response), 0)
4341. 
4342.     def test_model_view(self):
4343.         "Check the never-cache status of a model edit page"
4344.         response = self.client.get(reverse('admin:admin_views_section_change', args=(self.s1.pk,)))
4345.         self.assertEqual(get_max_age(response), 0)
4346. 
4347.     def test_model_history(self):
4348.         "Check the never-cache status of a model history page"
4349.         response = self.client.get(reverse('admin:admin_views_section_history', args=(self.s1.pk,)))
4350.         self.assertEqual(get_max_age(response), 0)
4351. 
4352.     def test_model_delete(self):
4353.         "Check the never-cache status of a model delete page"
4354.         response = self.client.get(reverse('admin:admin_views_section_delete', args=(self.s1.pk,)))
4355.         self.assertEqual(get_max_age(response), 0)
4356. 
4357.     def test_login(self):
4358.         "Check the never-cache status of login views"
4359.         self.client.logout()
4360.         response = self.client.get(reverse('admin:index'))
4361.         self.assertEqual(get_max_age(response), 0)
4362. 
4363.     def test_logout(self):
4364.         "Check the never-cache status of logout view"
4365.         response = self.client.get(reverse('admin:logout'))
4366.         self.assertEqual(get_max_age(response), 0)
4367. 
4368.     def test_password_change(self):
4369.         "Check the never-cache status of the password change view"
4370.         self.client.logout()
4371.         response = self.client.get(reverse('admin:password_change'))
4372.         self.assertIsNone(get_max_age(response))
4373. 
4374.     def test_password_change_done(self):
4375.         "Check the never-cache status of the password change done view"
4376.         response = self.client.get(reverse('admin:password_change_done'))
4377.         self.assertIsNone(get_max_age(response))
4378. 
4379.     def test_JS_i18n(self):
4380.         "Check the never-cache status of the JavaScript i18n view"
4381.         response = self.client.get(reverse('admin:jsi18n'))
4382.         self.assertIsNone(get_max_age(response))
4383. 
4384. 
4385. @override_settings(ROOT_URLCONF='admin_views.urls')
4386. class PrePopulatedTest(TestCase):
4387. 
4388.     @classmethod
4389.     def setUpTestData(cls):
4390.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
4391.         cls.p1 = PrePopulatedPost.objects.create(title='A Long Title', published=True, slug='a-long-title')
4392. 
4393.     def setUp(self):
4394.         self.client.force_login(self.superuser)
4395. 
4396.     def test_prepopulated_on(self):
4397.         response = self.client.get(reverse('admin:admin_views_prepopulatedpost_add'))
4398.         self.assertContains(response, "&quot;id&quot;: &quot;#id_slug&quot;")
4399.         self.assertContains(response, "&quot;dependency_ids&quot;: [&quot;#id_title&quot;]")
4400.         self.assertContains(response, "&quot;id&quot;: &quot;#id_prepopulatedsubpost_set-0-subslug&quot;")
4401. 
4402.     def test_prepopulated_off(self):
4403.         response = self.client.get(reverse('admin:admin_views_prepopulatedpost_change', args=(self.p1.pk,)))
4404.         self.assertContains(response, "A Long Title")
4405.         self.assertNotContains(response, "&quot;id&quot;: &quot;#id_slug&quot;")
4406.         self.assertNotContains(response, "&quot;dependency_ids&quot;: [&quot;#id_title&quot;]")
4407.         self.assertNotContains(
4408.             response,
4409.             "&quot;id&quot;: &quot;#id_prepopulatedsubpost_set-0-subslug&quot;"
4410.         )
4411. 
4412.     @override_settings(USE_THOUSAND_SEPARATOR=True, USE_L10N=True)
4413.     def test_prepopulated_maxlength_localized(self):
4414.         """
4415.         Regression test for #15938: if USE_THOUSAND_SEPARATOR is set, make sure
4416.         that maxLength (in the JavaScript) is rendered without separators.
4417.         """
4418.         response = self.client.get(reverse('admin:admin_views_prepopulatedpostlargeslug_add'))
4419.         self.assertContains(response, "&quot;maxLength&quot;: 1000")  # instead of 1,000
4420. 
4421.     def test_view_only_add_form(self):
4422.         """
4423.         PrePopulatedPostReadOnlyAdmin.prepopulated_fields includes 'slug'
4424.         which is present in the add view, even if the
4425.         ModelAdmin.has_change_permission() returns False.
4426.         """
4427.         response = self.client.get(reverse('admin7:admin_views_prepopulatedpost_add'))
4428.         self.assertContains(response, 'data-prepopulated-fields=')
4429.         self.assertContains(response, '&quot;id&quot;: &quot;#id_slug&quot;')
4430. 
4431.     def test_view_only_change_form(self):
4432.         """
4433.         PrePopulatedPostReadOnlyAdmin.prepopulated_fields includes 'slug'. That
4434.         doesn't break a view-only change view.
4435.         """
4436.         response = self.client.get(reverse('admin7:admin_views_prepopulatedpost_change', args=(self.p1.pk,)))
4437.         self.assertContains(response, 'data-prepopulated-fields="[]"')
4438.         self.assertContains(response, '<div class="readonly">%s</div>' % self.p1.slug)
4439. 
4440. 
4441. @override_settings(ROOT_URLCONF='admin_views.urls')
4442. class SeleniumTests(AdminSeleniumTestCase):
4443. 
4444.     available_apps = ['admin_views'] + AdminSeleniumTestCase.available_apps
4445. 
4446.     def setUp(self):
4447.         self.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
4448.         self.p1 = PrePopulatedPost.objects.create(title='A Long Title', published=True, slug='a-long-title')
4449. 
4450.     def test_prepopulated_fields(self):
4451.         """
4452.         The JavaScript-automated prepopulated fields work with the main form
4453.         and with stacked and tabular inlines.
4454.         Refs #13068, #9264, #9983, #9784.
4455.         """
4456.         self.admin_login(username='super', password='secret', login_url=reverse('admin:index'))
4457.         self.selenium.get(self.live_server_url + reverse('admin:admin_views_mainprepopulated_add'))
4458.         self.wait_for('.select2')
4459. 
4460.         # Main form ----------------------------------------------------------
4461.         self.selenium.find_element_by_id('id_pubdate').send_keys('2012-02-18')
4462.         self.get_select_option('#id_status', 'option two').click()
4463.         self.selenium.find_element_by_id('id_name').send_keys(' this is the mAin nÀMë and it\'s awεšomeııı')
4464.         slug1 = self.selenium.find_element_by_id('id_slug1').get_attribute('value')
4465.         slug2 = self.selenium.find_element_by_id('id_slug2').get_attribute('value')
4466.         slug3 = self.selenium.find_element_by_id('id_slug3').get_attribute('value')
4467.         self.assertEqual(slug1, 'main-name-and-its-awesomeiii-2012-02-18')
4468.         self.assertEqual(slug2, 'option-two-main-name-and-its-awesomeiii')
4469.         self.assertEqual(slug3, 'this-is-the-main-n\xe0m\xeb-and-its-aw\u03b5\u0161ome\u0131\u0131\u0131')
4470. 
4471.         # Stacked inlines ----------------------------------------------------
4472.         # Initial inline
4473.         self.selenium.find_element_by_id('id_relatedprepopulated_set-0-pubdate').send_keys('2011-12-17')
4474.         self.get_select_option('#id_relatedprepopulated_set-0-status', 'option one').click()
4475.         self.selenium.find_element_by_id('id_relatedprepopulated_set-0-name').send_keys(
4476.             ' here is a sŤāÇkeð   inline !  '
4477.         )
4478.         slug1 = self.selenium.find_element_by_id('id_relatedprepopulated_set-0-slug1').get_attribute('value')
4479.         slug2 = self.selenium.find_element_by_id('id_relatedprepopulated_set-0-slug2').get_attribute('value')
4480.         self.assertEqual(slug1, 'here-stacked-inline-2011-12-17')
4481.         self.assertEqual(slug2, 'option-one-here-stacked-inline')
4482.         initial_select2_inputs = self.selenium.find_elements_by_class_name('select2-selection')
4483.         # Inline formsets have empty/invisible forms.
4484.         # Only the 4 visible select2 inputs are initialized.
4485.         num_initial_select2_inputs = len(initial_select2_inputs)
4486.         self.assertEqual(num_initial_select2_inputs, 4)
4487. 
4488.         # Add an inline
4489.         self.selenium.find_elements_by_link_text('Add another Related prepopulated')[0].click()
4490.         self.assertEqual(
4491.             len(self.selenium.find_elements_by_class_name('select2-selection')),
4492.             num_initial_select2_inputs + 2
4493.         )
4494.         self.selenium.find_element_by_id('id_relatedprepopulated_set-1-pubdate').send_keys('1999-01-25')
4495.         self.get_select_option('#id_relatedprepopulated_set-1-status', 'option two').click()
4496.         self.selenium.find_element_by_id('id_relatedprepopulated_set-1-name').send_keys(
4497.             ' now you haVe anöther   sŤāÇkeð  inline with a very ... '
4498.             'loooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooog text... '
4499.         )
4500.         slug1 = self.selenium.find_element_by_id('id_relatedprepopulated_set-1-slug1').get_attribute('value')
4501.         slug2 = self.selenium.find_element_by_id('id_relatedprepopulated_set-1-slug2').get_attribute('value')

File: tests/admin_views/tests.py
Line number range: 4501 - 5001
Content:
4501.         slug2 = self.selenium.find_element_by_id('id_relatedprepopulated_set-1-slug2').get_attribute('value')
4502.         # 50 characters maximum for slug1 field
4503.         self.assertEqual(slug1, 'now-you-have-another-stacked-inline-very-loooooooo')
4504.         # 60 characters maximum for slug2 field
4505.         self.assertEqual(slug2, 'option-two-now-you-have-another-stacked-inline-very-looooooo')
4506. 
4507.         # Tabular inlines ----------------------------------------------------
4508.         # Initial inline
4509.         self.selenium.find_element_by_id('id_relatedprepopulated_set-2-0-pubdate').send_keys('1234-12-07')
4510.         self.get_select_option('#id_relatedprepopulated_set-2-0-status', 'option two').click()
4511.         self.selenium.find_element_by_id('id_relatedprepopulated_set-2-0-name').send_keys(
4512.             'And now, with a tÃbűlaŘ inline !!!'
4513.         )
4514.         slug1 = self.selenium.find_element_by_id('id_relatedprepopulated_set-2-0-slug1').get_attribute('value')
4515.         slug2 = self.selenium.find_element_by_id('id_relatedprepopulated_set-2-0-slug2').get_attribute('value')
4516.         self.assertEqual(slug1, 'and-now-tabular-inline-1234-12-07')
4517.         self.assertEqual(slug2, 'option-two-and-now-tabular-inline')
4518. 
4519.         # Add an inline
4520.         self.selenium.find_elements_by_link_text('Add another Related prepopulated')[1].click()
4521.         self.assertEqual(
4522.             len(self.selenium.find_elements_by_class_name('select2-selection')),
4523.             num_initial_select2_inputs + 4
4524.         )
4525.         self.selenium.find_element_by_id('id_relatedprepopulated_set-2-1-pubdate').send_keys('1981-08-22')
4526.         self.get_select_option('#id_relatedprepopulated_set-2-1-status', 'option one').click()
4527.         self.selenium.find_element_by_id('id_relatedprepopulated_set-2-1-name').send_keys(
4528.             r'a tÃbűlaŘ inline with ignored ;"&*^\%$#@-/`~ characters'
4529.         )
4530.         slug1 = self.selenium.find_element_by_id('id_relatedprepopulated_set-2-1-slug1').get_attribute('value')
4531.         slug2 = self.selenium.find_element_by_id('id_relatedprepopulated_set-2-1-slug2').get_attribute('value')
4532.         self.assertEqual(slug1, 'tabular-inline-ignored-characters-1981-08-22')
4533.         self.assertEqual(slug2, 'option-one-tabular-inline-ignored-characters')
4534.         # Add an inline without an initial inline.
4535.         # The button is outside of the browser frame.
4536.         self.selenium.execute_script("window.scrollTo(0, document.body.scrollHeight);")
4537.         self.selenium.find_elements_by_link_text('Add another Related prepopulated')[2].click()
4538.         self.assertEqual(
4539.             len(self.selenium.find_elements_by_class_name('select2-selection')),
4540.             num_initial_select2_inputs + 6
4541.         )
4542.         # Save and check that everything is properly stored in the database
4543.         self.selenium.find_element_by_xpath('//input[@value="Save"]').click()
4544.         self.wait_page_loaded()
4545.         self.assertEqual(MainPrepopulated.objects.all().count(), 1)
4546.         MainPrepopulated.objects.get(
4547.             name=' this is the mAin nÀMë and it\'s awεšomeııı',
4548.             pubdate='2012-02-18',
4549.             status='option two',
4550.             slug1='main-name-and-its-awesomeiii-2012-02-18',
4551.             slug2='option-two-main-name-and-its-awesomeiii',
4552.         )
4553.         self.assertEqual(RelatedPrepopulated.objects.all().count(), 4)
4554.         RelatedPrepopulated.objects.get(
4555.             name=' here is a sŤāÇkeð   inline !  ',
4556.             pubdate='2011-12-17',
4557.             status='option one',
4558.             slug1='here-stacked-inline-2011-12-17',
4559.             slug2='option-one-here-stacked-inline',
4560.         )
4561.         RelatedPrepopulated.objects.get(
4562.             # 75 characters in name field
4563.             name=' now you haVe anöther   sŤāÇkeð  inline with a very ... loooooooooooooooooo',
4564.             pubdate='1999-01-25',
4565.             status='option two',
4566.             slug1='now-you-have-another-stacked-inline-very-loooooooo',
4567.             slug2='option-two-now-you-have-another-stacked-inline-very-looooooo',
4568.         )
4569.         RelatedPrepopulated.objects.get(
4570.             name='And now, with a tÃbűlaŘ inline !!!',
4571.             pubdate='1234-12-07',
4572.             status='option two',
4573.             slug1='and-now-tabular-inline-1234-12-07',
4574.             slug2='option-two-and-now-tabular-inline',
4575.         )
4576.         RelatedPrepopulated.objects.get(
4577.             name=r'a tÃbűlaŘ inline with ignored ;"&*^\%$#@-/`~ characters',
4578.             pubdate='1981-08-22',
4579.             status='option one',
4580.             slug1='tabular-inline-ignored-characters-1981-08-22',
4581.             slug2='option-one-tabular-inline-ignored-characters',
4582.         )
4583. 
4584.     def test_populate_existing_object(self):
4585.         """
4586.         The prepopulation works for existing objects too, as long as
4587.         the original field is empty (#19082).
4588.         """
4589.         # Slugs are empty to start with.
4590.         item = MainPrepopulated.objects.create(
4591.             name=' this is the mAin nÀMë',
4592.             pubdate='2012-02-18',
4593.             status='option two',
4594.             slug1='',
4595.             slug2='',
4596.         )
4597.         self.admin_login(username='super', password='secret', login_url=reverse('admin:index'))
4598. 
4599.         object_url = self.live_server_url + reverse('admin:admin_views_mainprepopulated_change', args=(item.id,))
4600. 
4601.         self.selenium.get(object_url)
4602.         self.selenium.find_element_by_id('id_name').send_keys(' the best')
4603. 
4604.         # The slugs got prepopulated since they were originally empty
4605.         slug1 = self.selenium.find_element_by_id('id_slug1').get_attribute('value')
4606.         slug2 = self.selenium.find_element_by_id('id_slug2').get_attribute('value')
4607.         self.assertEqual(slug1, 'main-name-best-2012-02-18')
4608.         self.assertEqual(slug2, 'option-two-main-name-best')
4609. 
4610.         # Save the object
4611.         self.selenium.find_element_by_xpath('//input[@value="Save"]').click()
4612.         self.wait_page_loaded()
4613. 
4614.         self.selenium.get(object_url)
4615.         self.selenium.find_element_by_id('id_name').send_keys(' hello')
4616. 
4617.         # The slugs got prepopulated didn't change since they were originally not empty
4618.         slug1 = self.selenium.find_element_by_id('id_slug1').get_attribute('value')
4619.         slug2 = self.selenium.find_element_by_id('id_slug2').get_attribute('value')
4620.         self.assertEqual(slug1, 'main-name-best-2012-02-18')
4621.         self.assertEqual(slug2, 'option-two-main-name-best')
4622. 
4623.     def test_collapsible_fieldset(self):
4624.         """
4625.         The 'collapse' class in fieldsets definition allows to
4626.         show/hide the appropriate field section.
4627.         """
4628.         self.admin_login(username='super', password='secret', login_url=reverse('admin:index'))
4629.         self.selenium.get(self.live_server_url + reverse('admin:admin_views_article_add'))
4630.         self.assertFalse(self.selenium.find_element_by_id('id_title').is_displayed())
4631.         self.selenium.find_elements_by_link_text('Show')[0].click()
4632.         self.assertTrue(self.selenium.find_element_by_id('id_title').is_displayed())
4633.         self.assertEqual(self.selenium.find_element_by_id('fieldsetcollapser0').text, "Hide")
4634. 
4635.     def test_first_field_focus(self):
4636.         """JavaScript-assisted auto-focus on first usable form field."""
4637.         # First form field has a single widget
4638.         self.admin_login(username='super', password='secret', login_url=reverse('admin:index'))
4639.         self.selenium.get(self.live_server_url + reverse('admin:admin_views_picture_add'))
4640.         self.assertEqual(
4641.             self.selenium.switch_to.active_element,
4642.             self.selenium.find_element_by_id('id_name')
4643.         )
4644. 
4645.         # First form field has a MultiWidget
4646.         self.selenium.get(self.live_server_url + reverse('admin:admin_views_reservation_add'))
4647.         self.assertEqual(
4648.             self.selenium.switch_to.active_element,
4649.             self.selenium.find_element_by_id('id_start_date_0')
4650.         )
4651. 
4652.     def test_cancel_delete_confirmation(self):
4653.         "Cancelling the deletion of an object takes the user back one page."
4654.         pizza = Pizza.objects.create(name="Double Cheese")
4655.         url = reverse('admin:admin_views_pizza_change', args=(pizza.id,))
4656.         full_url = self.live_server_url + url
4657.         self.admin_login(username='super', password='secret', login_url=reverse('admin:index'))
4658.         self.selenium.get(full_url)
4659.         self.selenium.find_element_by_class_name('deletelink').click()
4660.         # Click 'cancel' on the delete page.
4661.         self.selenium.find_element_by_class_name('cancel-link').click()
4662.         # Wait until we're back on the change page.
4663.         self.wait_for_text('#content h1', 'Change pizza')
4664.         self.assertEqual(self.selenium.current_url, full_url)
4665.         self.assertEqual(Pizza.objects.count(), 1)
4666. 
4667.     def test_cancel_delete_related_confirmation(self):
4668.         """
4669.         Cancelling the deletion of an object with relations takes the user back
4670.         one page.
4671.         """
4672.         pizza = Pizza.objects.create(name="Double Cheese")
4673.         topping1 = Topping.objects.create(name="Cheddar")
4674.         topping2 = Topping.objects.create(name="Mozzarella")
4675.         pizza.toppings.add(topping1, topping2)
4676.         url = reverse('admin:admin_views_pizza_change', args=(pizza.id,))
4677.         full_url = self.live_server_url + url
4678.         self.admin_login(username='super', password='secret', login_url=reverse('admin:index'))
4679.         self.selenium.get(full_url)
4680.         self.selenium.find_element_by_class_name('deletelink').click()
4681.         # Click 'cancel' on the delete page.
4682.         self.selenium.find_element_by_class_name('cancel-link').click()
4683.         # Wait until we're back on the change page.
4684.         self.wait_for_text('#content h1', 'Change pizza')
4685.         self.assertEqual(self.selenium.current_url, full_url)
4686.         self.assertEqual(Pizza.objects.count(), 1)
4687.         self.assertEqual(Topping.objects.count(), 2)
4688. 
4689.     def test_list_editable_popups(self):
4690.         """
4691.         list_editable foreign keys have add/change popups.
4692.         """
4693.         from selenium.webdriver.support.ui import Select
4694.         s1 = Section.objects.create(name='Test section')
4695.         Article.objects.create(
4696.             title='foo',
4697.             content='<p>Middle content</p>',
4698.             date=datetime.datetime(2008, 3, 18, 11, 54, 58),
4699.             section=s1,
4700.         )
4701.         self.admin_login(username='super', password='secret', login_url=reverse('admin:index'))
4702.         self.selenium.get(self.live_server_url + reverse('admin:admin_views_article_changelist'))
4703.         # Change popup
4704.         self.selenium.find_element_by_id('change_id_form-0-section').click()
4705.         self.wait_for_popup()
4706.         self.selenium.switch_to.window(self.selenium.window_handles[-1])
4707.         self.wait_for_text('#content h1', 'Change section')
4708.         name_input = self.selenium.find_element_by_id('id_name')
4709.         name_input.clear()
4710.         name_input.send_keys('<i>edited section</i>')
4711.         self.selenium.find_element_by_xpath('//input[@value="Save"]').click()
4712.         self.selenium.switch_to.window(self.selenium.window_handles[0])
4713.         select = Select(self.selenium.find_element_by_id('id_form-0-section'))
4714.         self.assertEqual(select.first_selected_option.text, '<i>edited section</i>')
4715.         # Rendered select2 input.
4716.         select2_display = self.selenium.find_element_by_class_name('select2-selection__rendered')
4717.         # Clear button (×\n) is included in text.
4718.         self.assertEqual(select2_display.text, '×\n<i>edited section</i>')
4719. 
4720.         # Add popup
4721.         self.selenium.find_element_by_id('add_id_form-0-section').click()
4722.         self.wait_for_popup()
4723.         self.selenium.switch_to.window(self.selenium.window_handles[-1])
4724.         self.wait_for_text('#content h1', 'Add section')
4725.         self.selenium.find_element_by_id('id_name').send_keys('new section')
4726.         self.selenium.find_element_by_xpath('//input[@value="Save"]').click()
4727.         self.selenium.switch_to.window(self.selenium.window_handles[0])
4728.         select = Select(self.selenium.find_element_by_id('id_form-0-section'))
4729.         self.assertEqual(select.first_selected_option.text, 'new section')
4730.         select2_display = self.selenium.find_element_by_class_name('select2-selection__rendered')
4731.         # Clear button (×\n) is included in text.
4732.         self.assertEqual(select2_display.text, '×\nnew section')
4733. 
4734.     def test_inline_uuid_pk_edit_with_popup(self):
4735.         from selenium.webdriver.support.ui import Select
4736.         parent = ParentWithUUIDPK.objects.create(title='test')
4737.         related_with_parent = RelatedWithUUIDPKModel.objects.create(parent=parent)
4738.         self.admin_login(username='super', password='secret', login_url=reverse('admin:index'))
4739.         change_url = reverse('admin:admin_views_relatedwithuuidpkmodel_change', args=(related_with_parent.id,))
4740.         self.selenium.get(self.live_server_url + change_url)
4741.         self.selenium.find_element_by_id('change_id_parent').click()
4742.         self.wait_for_popup()
4743.         self.selenium.switch_to.window(self.selenium.window_handles[-1])
4744.         self.selenium.find_element_by_xpath('//input[@value="Save"]').click()
4745.         self.selenium.switch_to.window(self.selenium.window_handles[0])
4746.         select = Select(self.selenium.find_element_by_id('id_parent'))
4747.         self.assertEqual(select.first_selected_option.text, str(parent.id))
4748.         self.assertEqual(select.first_selected_option.get_attribute('value'), str(parent.id))
4749. 
4750.     def test_inline_uuid_pk_add_with_popup(self):
4751.         from selenium.webdriver.support.ui import Select
4752.         self.admin_login(username='super', password='secret', login_url=reverse('admin:index'))
4753.         self.selenium.get(self.live_server_url + reverse('admin:admin_views_relatedwithuuidpkmodel_add'))
4754.         self.selenium.find_element_by_id('add_id_parent').click()
4755.         self.wait_for_popup()
4756.         self.selenium.switch_to.window(self.selenium.window_handles[-1])
4757.         self.selenium.find_element_by_id('id_title').send_keys('test')
4758.         self.selenium.find_element_by_xpath('//input[@value="Save"]').click()
4759.         self.selenium.switch_to.window(self.selenium.window_handles[0])
4760.         select = Select(self.selenium.find_element_by_id('id_parent'))
4761.         uuid_id = str(ParentWithUUIDPK.objects.first().id)
4762.         self.assertEqual(select.first_selected_option.text, uuid_id)
4763.         self.assertEqual(select.first_selected_option.get_attribute('value'), uuid_id)
4764. 
4765.     def test_inline_uuid_pk_delete_with_popup(self):
4766.         from selenium.webdriver.support.ui import Select
4767.         parent = ParentWithUUIDPK.objects.create(title='test')
4768.         related_with_parent = RelatedWithUUIDPKModel.objects.create(parent=parent)
4769.         self.admin_login(username='super', password='secret', login_url=reverse('admin:index'))
4770.         change_url = reverse('admin:admin_views_relatedwithuuidpkmodel_change', args=(related_with_parent.id,))
4771.         self.selenium.get(self.live_server_url + change_url)
4772.         self.selenium.find_element_by_id('delete_id_parent').click()
4773.         self.wait_for_popup()
4774.         self.selenium.switch_to.window(self.selenium.window_handles[-1])
4775.         self.selenium.find_element_by_xpath('//input[@value="Yes, I\'m sure"]').click()
4776.         self.selenium.switch_to.window(self.selenium.window_handles[0])
4777.         select = Select(self.selenium.find_element_by_id('id_parent'))
4778.         self.assertEqual(ParentWithUUIDPK.objects.count(), 0)
4779.         self.assertEqual(select.first_selected_option.text, '---------')
4780.         self.assertEqual(select.first_selected_option.get_attribute('value'), '')
4781. 
4782.     def test_inline_with_popup_cancel_delete(self):
4783.         """Clicking ""No, take me back" on a delete popup closes the window."""
4784.         parent = ParentWithUUIDPK.objects.create(title='test')
4785.         related_with_parent = RelatedWithUUIDPKModel.objects.create(parent=parent)
4786.         self.admin_login(username='super', password='secret', login_url=reverse('admin:index'))
4787.         change_url = reverse('admin:admin_views_relatedwithuuidpkmodel_change', args=(related_with_parent.id,))
4788.         self.selenium.get(self.live_server_url + change_url)
4789.         self.selenium.find_element_by_id('delete_id_parent').click()
4790.         self.wait_for_popup()
4791.         self.selenium.switch_to.window(self.selenium.window_handles[-1])
4792.         self.selenium.find_element_by_xpath('//a[text()="No, take me back"]').click()
4793.         self.selenium.switch_to.window(self.selenium.window_handles[0])
4794.         self.assertEqual(len(self.selenium.window_handles), 1)
4795. 
4796.     def test_list_editable_raw_id_fields(self):
4797.         parent = ParentWithUUIDPK.objects.create(title='test')
4798.         parent2 = ParentWithUUIDPK.objects.create(title='test2')
4799.         RelatedWithUUIDPKModel.objects.create(parent=parent)
4800.         self.admin_login(username='super', password='secret', login_url=reverse('admin:index'))
4801.         change_url = reverse('admin:admin_views_relatedwithuuidpkmodel_changelist', current_app=site2.name)
4802.         self.selenium.get(self.live_server_url + change_url)
4803.         self.selenium.find_element_by_id('lookup_id_form-0-parent').click()
4804.         self.wait_for_popup()
4805.         self.selenium.switch_to.window(self.selenium.window_handles[-1])
4806.         # Select "parent2" in the popup.
4807.         self.selenium.find_element_by_link_text(str(parent2.pk)).click()
4808.         self.selenium.switch_to.window(self.selenium.window_handles[0])
4809.         # The newly selected pk should appear in the raw id input.
4810.         value = self.selenium.find_element_by_id('id_form-0-parent').get_attribute('value')
4811.         self.assertEqual(value, str(parent2.pk))
4812. 
4813. 
4814. @override_settings(ROOT_URLCONF='admin_views.urls')
4815. class ReadonlyTest(AdminFieldExtractionMixin, TestCase):
4816. 
4817.     @classmethod
4818.     def setUpTestData(cls):
4819.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
4820. 
4821.     def setUp(self):
4822.         self.client.force_login(self.superuser)
4823. 
4824.     def test_readonly_get(self):
4825.         response = self.client.get(reverse('admin:admin_views_post_add'))
4826.         self.assertEqual(response.status_code, 200)
4827.         self.assertNotContains(response, 'name="posted"')
4828.         # 3 fields + 2 submit buttons + 5 inline management form fields, + 2
4829.         # hidden fields for inlines + 1 field for the inline + 2 empty form
4830.         self.assertContains(response, "<input", count=15)
4831.         self.assertContains(response, formats.localize(datetime.date.today()))
4832.         self.assertContains(response, "<label>Awesomeness level:</label>")
4833.         self.assertContains(response, "Very awesome.")
4834.         self.assertContains(response, "Unknown coolness.")
4835.         self.assertContains(response, "foo")
4836. 
4837.         # Multiline text in a readonly field gets <br> tags
4838.         self.assertContains(response, 'Multiline<br>test<br>string')
4839.         self.assertContains(response, '<div class="readonly">Multiline<br>html<br>content</div>', html=True)
4840.         self.assertContains(response, 'InlineMultiline<br>test<br>string')
4841. 
4842.         self.assertContains(response, formats.localize(datetime.date.today() - datetime.timedelta(days=7)))
4843. 
4844.         self.assertContains(response, '<div class="form-row field-coolness">')
4845.         self.assertContains(response, '<div class="form-row field-awesomeness_level">')
4846.         self.assertContains(response, '<div class="form-row field-posted">')
4847.         self.assertContains(response, '<div class="form-row field-value">')
4848.         self.assertContains(response, '<div class="form-row">')
4849.         self.assertContains(response, '<div class="help">', 3)
4850.         self.assertContains(
4851.             response,
4852.             '<div class="help">Some help text for the title (with unicode ŠĐĆŽćžšđ)</div>',
4853.             html=True
4854.         )
4855.         self.assertContains(
4856.             response,
4857.             '<div class="help">Some help text for the content (with unicode ŠĐĆŽćžšđ)</div>',
4858.             html=True
4859.         )
4860.         self.assertContains(
4861.             response,
4862.             '<div class="help">Some help text for the date (with unicode ŠĐĆŽćžšđ)</div>',
4863.             html=True
4864.         )
4865. 
4866.         p = Post.objects.create(title="I worked on readonly_fields", content="Its good stuff")
4867.         response = self.client.get(reverse('admin:admin_views_post_change', args=(p.pk,)))
4868.         self.assertContains(response, "%d amount of cool" % p.pk)
4869. 
4870.     def test_readonly_text_field(self):
4871.         p = Post.objects.create(
4872.             title="Readonly test", content="test",
4873.             readonly_content='test\r\n\r\ntest\r\n\r\ntest\r\n\r\ntest',
4874.         )
4875.         Link.objects.create(
4876.             url="http://www.djangoproject.com", post=p,
4877.             readonly_link_content="test\r\nlink",
4878.         )
4879.         response = self.client.get(reverse('admin:admin_views_post_change', args=(p.pk,)))
4880.         # Checking readonly field.
4881.         self.assertContains(response, 'test<br><br>test<br><br>test<br><br>test')
4882.         # Checking readonly field in inline.
4883.         self.assertContains(response, 'test<br>link')
4884. 
4885.     def test_readonly_post(self):
4886.         data = {
4887.             "title": "Django Got Readonly Fields",
4888.             "content": "This is an incredible development.",
4889.             "link_set-TOTAL_FORMS": "1",
4890.             "link_set-INITIAL_FORMS": "0",
4891.             "link_set-MAX_NUM_FORMS": "0",
4892.         }
4893.         response = self.client.post(reverse('admin:admin_views_post_add'), data)
4894.         self.assertEqual(response.status_code, 302)
4895.         self.assertEqual(Post.objects.count(), 1)
4896.         p = Post.objects.get()
4897.         self.assertEqual(p.posted, datetime.date.today())
4898. 
4899.         data["posted"] = "10-8-1990"  # some date that's not today
4900.         response = self.client.post(reverse('admin:admin_views_post_add'), data)
4901.         self.assertEqual(response.status_code, 302)
4902.         self.assertEqual(Post.objects.count(), 2)
4903.         p = Post.objects.order_by('-id')[0]
4904.         self.assertEqual(p.posted, datetime.date.today())
4905. 
4906.     def test_readonly_manytomany(self):
4907.         "Regression test for #13004"
4908.         response = self.client.get(reverse('admin:admin_views_pizza_add'))
4909.         self.assertEqual(response.status_code, 200)
4910. 
4911.     def test_user_password_change_limited_queryset(self):
4912.         su = User.objects.filter(is_superuser=True)[0]
4913.         response = self.client.get(reverse('admin2:auth_user_password_change', args=(su.pk,)))
4914.         self.assertEqual(response.status_code, 404)
4915. 
4916.     def test_change_form_renders_correct_null_choice_value(self):
4917.         """
4918.         Regression test for #17911.
4919.         """
4920.         choice = Choice.objects.create(choice=None)
4921.         response = self.client.get(reverse('admin:admin_views_choice_change', args=(choice.pk,)))
4922.         self.assertContains(response, '<div class="readonly">No opinion</div>', html=True)
4923. 
4924.     def test_readonly_manytomany_backwards_ref(self):
4925.         """
4926.         Regression test for #16433 - backwards references for related objects
4927.         broke if the related field is read-only due to the help_text attribute
4928.         """
4929.         topping = Topping.objects.create(name='Salami')
4930.         pizza = Pizza.objects.create(name='Americano')
4931.         pizza.toppings.add(topping)
4932.         response = self.client.get(reverse('admin:admin_views_topping_add'))
4933.         self.assertEqual(response.status_code, 200)
4934. 
4935.     def test_readonly_manytomany_forwards_ref(self):
4936.         topping = Topping.objects.create(name='Salami')
4937.         pizza = Pizza.objects.create(name='Americano')
4938.         pizza.toppings.add(topping)
4939.         response = self.client.get(reverse('admin:admin_views_pizza_change', args=(pizza.pk,)))
4940.         self.assertContains(response, '<label>Toppings:</label>', html=True)
4941.         self.assertContains(response, '<div class="readonly">Salami</div>', html=True)
4942. 
4943.     def test_readonly_onetoone_backwards_ref(self):
4944.         """
4945.         Can reference a reverse OneToOneField in ModelAdmin.readonly_fields.
4946.         """
4947.         v1 = Villain.objects.create(name='Adam')
4948.         pl = Plot.objects.create(name='Test Plot', team_leader=v1, contact=v1)
4949.         pd = PlotDetails.objects.create(details='Brand New Plot', plot=pl)
4950. 
4951.         response = self.client.get(reverse('admin:admin_views_plotproxy_change', args=(pl.pk,)))
4952.         field = self.get_admin_readonly_field(response, 'plotdetails')
4953.         self.assertEqual(field.contents(), 'Brand New Plot')
4954. 
4955.         # The reverse relation also works if the OneToOneField is null.
4956.         pd.plot = None
4957.         pd.save()
4958. 
4959.         response = self.client.get(reverse('admin:admin_views_plotproxy_change', args=(pl.pk,)))
4960.         field = self.get_admin_readonly_field(response, 'plotdetails')
4961.         self.assertEqual(field.contents(), '-')  # default empty value
4962. 
4963.     def test_readonly_field_overrides(self):
4964.         """
4965.         Regression test for #22087 - ModelForm Meta overrides are ignored by
4966.         AdminReadonlyField
4967.         """
4968.         p = FieldOverridePost.objects.create(title="Test Post", content="Test Content")
4969.         response = self.client.get(reverse('admin:admin_views_fieldoverridepost_change', args=(p.pk,)))
4970.         self.assertContains(response, '<div class="help">Overridden help text for the date</div>')
4971.         self.assertContains(response, '<label for="id_public">Overridden public label:</label>', html=True)
4972.         self.assertNotContains(response, "Some help text for the date (with unicode ŠĐĆŽćžšđ)")
4973. 
4974.     def test_correct_autoescaping(self):
4975.         """
4976.         Make sure that non-field readonly elements are properly autoescaped (#24461)
4977.         """
4978.         section = Section.objects.create(name='<a>evil</a>')
4979.         response = self.client.get(reverse('admin:admin_views_section_change', args=(section.pk,)))
4980.         self.assertNotContains(response, "<a>evil</a>", status_code=200)
4981.         self.assertContains(response, "&lt;a&gt;evil&lt;/a&gt;", status_code=200)
4982. 
4983.     def test_label_suffix_translated(self):
4984.         pizza = Pizza.objects.create(name='Americano')
4985.         url = reverse('admin:admin_views_pizza_change', args=(pizza.pk,))
4986.         with self.settings(LANGUAGE_CODE='fr'):
4987.             response = self.client.get(url)
4988.         self.assertContains(response, '<label>Toppings\u00A0:</label>', html=True)
4989. 
4990. 
4991. @override_settings(ROOT_URLCONF='admin_views.urls')
4992. class LimitChoicesToInAdminTest(TestCase):
4993. 
4994.     @classmethod
4995.     def setUpTestData(cls):
4996.         cls.superuser = User.objects.create_superuser(username='super', password='secret', email='super@example.com')
4997. 
4998.     def setUp(self):
4999.         self.client.force_login(self.superuser)
5000. 
5001.     def test_limit_choices_to_as_callable(self):

File: tests/admin_inlines/tests.py
Line number range: 1 - 500
Content:
1. from django.contrib.admin import ModelAdmin, TabularInline
2. from django.contrib.admin.helpers import InlineAdminForm
3. from django.contrib.admin.tests import AdminSeleniumTestCase
4. from django.contrib.auth.models import Permission, User
5. from django.contrib.contenttypes.models import ContentType
6. from django.test import RequestFactory, TestCase, override_settings
7. from django.urls import reverse
8. 
9. from .admin import InnerInline, site as admin_site
10. from .models import (
11.     Author, BinaryTree, Book, Chapter, Child, ChildModel1, ChildModel2,
12.     Fashionista, FootNote, Holder, Holder2, Holder3, Holder4, Inner, Inner2,
13.     Inner3, Inner4Stacked, Inner4Tabular, Novel, OutfitItem, Parent,
14.     ParentModelWithCustomPk, Person, Poll, Profile, ProfileCollection,
15.     Question, Sighting, SomeChildModel, SomeParentModel, Teacher,
16. )
17. 
18. INLINE_CHANGELINK_HTML = 'class="inlinechangelink">Change</a>'
19. 
20. 
21. class TestDataMixin:
22. 
23.     @classmethod
24.     def setUpTestData(cls):
25.         cls.superuser = User.objects.create_superuser(username='super', email='super@example.com', password='secret')
26. 
27. 
28. @override_settings(ROOT_URLCONF='admin_inlines.urls')
29. class TestInline(TestDataMixin, TestCase):
30.     factory = RequestFactory()
31. 
32.     @classmethod
33.     def setUpTestData(cls):
34.         super().setUpTestData()
35.         cls.holder = Holder.objects.create(dummy=13)
36.         Inner.objects.create(dummy=42, holder=cls.holder)
37. 
38.     def setUp(self):
39.         self.client.force_login(self.superuser)
40. 
41.     def test_can_delete(self):
42.         """
43.         can_delete should be passed to inlineformset factory.
44.         """
45.         response = self.client.get(
46.             reverse('admin:admin_inlines_holder_change', args=(self.holder.id,))
47.         )
48.         inner_formset = response.context['inline_admin_formsets'][0].formset
49.         expected = InnerInline.can_delete
50.         actual = inner_formset.can_delete
51.         self.assertEqual(expected, actual, 'can_delete must be equal')
52. 
53.     def test_readonly_stacked_inline_label(self):
54.         """Bug #13174."""
55.         holder = Holder.objects.create(dummy=42)
56.         Inner.objects.create(holder=holder, dummy=42, readonly='')
57.         response = self.client.get(
58.             reverse('admin:admin_inlines_holder_change', args=(holder.id,))
59.         )
60.         self.assertContains(response, '<label>Inner readonly label:</label>')
61. 
62.     def test_many_to_many_inlines(self):
63.         "Autogenerated many-to-many inlines are displayed correctly (#13407)"
64.         response = self.client.get(reverse('admin:admin_inlines_author_add'))
65.         # The heading for the m2m inline block uses the right text
66.         self.assertContains(response, '<h2>Author-book relationships</h2>')
67.         # The "add another" label is correct
68.         self.assertContains(response, 'Add another Author-book relationship')
69.         # The '+' is dropped from the autogenerated form prefix (Author_books+)
70.         self.assertContains(response, 'id="id_Author_books-TOTAL_FORMS"')
71. 
72.     def test_inline_primary(self):
73.         person = Person.objects.create(firstname='Imelda')
74.         item = OutfitItem.objects.create(name='Shoes')
75.         # Imelda likes shoes, but can't carry her own bags.
76.         data = {
77.             'shoppingweakness_set-TOTAL_FORMS': 1,
78.             'shoppingweakness_set-INITIAL_FORMS': 0,
79.             'shoppingweakness_set-MAX_NUM_FORMS': 0,
80.             '_save': 'Save',
81.             'person': person.id,
82.             'max_weight': 0,
83.             'shoppingweakness_set-0-item': item.id,
84.         }
85.         response = self.client.post(reverse('admin:admin_inlines_fashionista_add'), data)
86.         self.assertEqual(response.status_code, 302)
87.         self.assertEqual(len(Fashionista.objects.filter(person__firstname='Imelda')), 1)
88. 
89.     def test_tabular_inline_column_css_class(self):
90.         """
91.         Field names are included in the context to output a field-specific
92.         CSS class name in the column headers.
93.         """
94.         response = self.client.get(reverse('admin:admin_inlines_poll_add'))
95.         text_field, call_me_field = list(response.context['inline_admin_formset'].fields())
96.         # Editable field.
97.         self.assertEqual(text_field['name'], 'text')
98.         self.assertContains(response, '<th class="column-text required">')
99.         # Read-only field.
100.         self.assertEqual(call_me_field['name'], 'call_me')
101.         self.assertContains(response, '<th class="column-call_me">')
102. 
103.     def test_custom_form_tabular_inline_label(self):
104.         """
105.         A model form with a form field specified (TitleForm.title1) should have
106.         its label rendered in the tabular inline.
107.         """
108.         response = self.client.get(reverse('admin:admin_inlines_titlecollection_add'))
109.         self.assertContains(response, '<th class="column-title1 required">Title1</th>', html=True)
110. 
111.     def test_custom_form_tabular_inline_overridden_label(self):
112.         """
113.         SomeChildModelForm.__init__() overrides the label of a form field.
114.         That label is displayed in the TabularInline.
115.         """
116.         response = self.client.get(reverse('admin:admin_inlines_someparentmodel_add'))
117.         field = list(response.context['inline_admin_formset'].fields())[0]
118.         self.assertEqual(field['label'], 'new label')
119.         self.assertContains(response, '<th class="column-name required">New label</th>', html=True)
120. 
121.     def test_tabular_non_field_errors(self):
122.         """
123.         non_field_errors are displayed correctly, including the correct value
124.         for colspan.
125.         """
126.         data = {
127.             'title_set-TOTAL_FORMS': 1,
128.             'title_set-INITIAL_FORMS': 0,
129.             'title_set-MAX_NUM_FORMS': 0,
130.             '_save': 'Save',
131.             'title_set-0-title1': 'a title',
132.             'title_set-0-title2': 'a different title',
133.         }
134.         response = self.client.post(reverse('admin:admin_inlines_titlecollection_add'), data)
135.         # Here colspan is "4": two fields (title1 and title2), one hidden field and the delete checkbox.
136.         self.assertContains(
137.             response,
138.             '<tr><td colspan="4"><ul class="errorlist nonfield">'
139.             '<li>The two titles must be the same</li></ul></td></tr>'
140.         )
141. 
142.     def test_no_parent_callable_lookup(self):
143.         """Admin inline `readonly_field` shouldn't invoke parent ModelAdmin callable"""
144.         # Identically named callable isn't present in the parent ModelAdmin,
145.         # rendering of the add view shouldn't explode
146.         response = self.client.get(reverse('admin:admin_inlines_novel_add'))
147.         self.assertEqual(response.status_code, 200)
148.         # View should have the child inlines section
149.         self.assertContains(
150.             response,
151.             '<div class="js-inline-admin-formset inline-group" id="chapter_set-group"'
152.         )
153. 
154.     def test_callable_lookup(self):
155.         """Admin inline should invoke local callable when its name is listed in readonly_fields"""
156.         response = self.client.get(reverse('admin:admin_inlines_poll_add'))
157.         self.assertEqual(response.status_code, 200)
158.         # Add parent object view should have the child inlines section
159.         self.assertContains(
160.             response,
161.             '<div class="js-inline-admin-formset inline-group" id="question_set-group"'
162.         )
163.         # The right callable should be used for the inline readonly_fields
164.         # column cells
165.         self.assertContains(response, '<p>Callable in QuestionInline</p>')
166. 
167.     def test_help_text(self):
168.         """
169.         The inlines' model field help texts are displayed when using both the
170.         stacked and tabular layouts.
171.         """
172.         response = self.client.get(reverse('admin:admin_inlines_holder4_add'))
173.         self.assertContains(response, '<div class="help">Awesome stacked help text is awesome.</div>', 4)
174.         self.assertContains(
175.             response,
176.             '<img src="/static/admin/img/icon-unknown.svg" '
177.             'class="help help-tooltip" width="10" height="10" '
178.             'alt="(Awesome tabular help text is awesome.)" '
179.             'title="Awesome tabular help text is awesome.">',
180.             1
181.         )
182.         # ReadOnly fields
183.         response = self.client.get(reverse('admin:admin_inlines_capofamiglia_add'))
184.         self.assertContains(
185.             response,
186.             '<img src="/static/admin/img/icon-unknown.svg" '
187.             'class="help help-tooltip" width="10" height="10" '
188.             'alt="(Help text for ReadOnlyInline)" '
189.             'title="Help text for ReadOnlyInline">',
190.             1
191.         )
192. 
193.     def test_tabular_model_form_meta_readonly_field(self):
194.         """
195.         Tabular inlines use ModelForm.Meta.help_texts and labels for read-only
196.         fields.
197.         """
198.         response = self.client.get(reverse('admin:admin_inlines_someparentmodel_add'))
199.         self.assertContains(
200.             response,
201.             '<img src="/static/admin/img/icon-unknown.svg" '
202.             'class="help help-tooltip" width="10" height="10" '
203.             'alt="(Help text from ModelForm.Meta)" '
204.             'title="Help text from ModelForm.Meta">'
205.         )
206.         self.assertContains(response, 'Label from ModelForm.Meta')
207. 
208.     def test_inline_hidden_field_no_column(self):
209.         """#18263 -- Make sure hidden fields don't get a column in tabular inlines"""
210.         parent = SomeParentModel.objects.create(name='a')
211.         SomeChildModel.objects.create(name='b', position='0', parent=parent)
212.         SomeChildModel.objects.create(name='c', position='1', parent=parent)
213.         response = self.client.get(reverse('admin:admin_inlines_someparentmodel_change', args=(parent.pk,)))
214.         self.assertNotContains(response, '<td class="field-position">')
215.         self.assertInHTML(
216.             '<input id="id_somechildmodel_set-1-position" '
217.             'name="somechildmodel_set-1-position" type="hidden" value="1">',
218.             response.rendered_content,
219.         )
220. 
221.     def test_non_related_name_inline(self):
222.         """
223.         Multiple inlines with related_name='+' have correct form prefixes.
224.         """
225.         response = self.client.get(reverse('admin:admin_inlines_capofamiglia_add'))
226.         self.assertContains(response, '<input type="hidden" name="-1-0-id" id="id_-1-0-id">', html=True)
227.         self.assertContains(
228.             response,
229.             '<input type="hidden" name="-1-0-capo_famiglia" id="id_-1-0-capo_famiglia">',
230.             html=True
231.         )
232.         self.assertContains(
233.             response,
234.             '<input id="id_-1-0-name" type="text" class="vTextField" name="-1-0-name" maxlength="100">',
235.             html=True
236.         )
237.         self.assertContains(response, '<input type="hidden" name="-2-0-id" id="id_-2-0-id">', html=True)
238.         self.assertContains(
239.             response,
240.             '<input type="hidden" name="-2-0-capo_famiglia" id="id_-2-0-capo_famiglia">',
241.             html=True
242.         )
243.         self.assertContains(
244.             response,
245.             '<input id="id_-2-0-name" type="text" class="vTextField" name="-2-0-name" maxlength="100">',
246.             html=True
247.         )
248. 
249.     @override_settings(USE_L10N=True, USE_THOUSAND_SEPARATOR=True)
250.     def test_localize_pk_shortcut(self):
251.         """
252.         The "View on Site" link is correct for locales that use thousand
253.         separators.
254.         """
255.         holder = Holder.objects.create(pk=123456789, dummy=42)
256.         inner = Inner.objects.create(pk=987654321, holder=holder, dummy=42, readonly='')
257.         response = self.client.get(reverse('admin:admin_inlines_holder_change', args=(holder.id,)))
258.         inner_shortcut = 'r/%s/%s/' % (ContentType.objects.get_for_model(inner).pk, inner.pk)
259.         self.assertContains(response, inner_shortcut)
260. 
261.     def test_custom_pk_shortcut(self):
262.         """
263.         The "View on Site" link is correct for models with a custom primary key
264.         field.
265.         """
266.         parent = ParentModelWithCustomPk.objects.create(my_own_pk="foo", name="Foo")
267.         child1 = ChildModel1.objects.create(my_own_pk="bar", name="Bar", parent=parent)
268.         child2 = ChildModel2.objects.create(my_own_pk="baz", name="Baz", parent=parent)
269.         response = self.client.get(reverse('admin:admin_inlines_parentmodelwithcustompk_change', args=('foo',)))
270.         child1_shortcut = 'r/%s/%s/' % (ContentType.objects.get_for_model(child1).pk, child1.pk)
271.         child2_shortcut = 'r/%s/%s/' % (ContentType.objects.get_for_model(child2).pk, child2.pk)
272.         self.assertContains(response, child1_shortcut)
273.         self.assertContains(response, child2_shortcut)
274. 
275.     def test_create_inlines_on_inherited_model(self):
276.         """
277.         An object can be created with inlines when it inherits another class.
278.         """
279.         data = {
280.             'name': 'Martian',
281.             'sighting_set-TOTAL_FORMS': 1,
282.             'sighting_set-INITIAL_FORMS': 0,
283.             'sighting_set-MAX_NUM_FORMS': 0,
284.             'sighting_set-0-place': 'Zone 51',
285.             '_save': 'Save',
286.         }
287.         response = self.client.post(reverse('admin:admin_inlines_extraterrestrial_add'), data)
288.         self.assertEqual(response.status_code, 302)
289.         self.assertEqual(Sighting.objects.filter(et__name='Martian').count(), 1)
290. 
291.     def test_custom_get_extra_form(self):
292.         bt_head = BinaryTree.objects.create(name="Tree Head")
293.         BinaryTree.objects.create(name="First Child", parent=bt_head)
294.         # The maximum number of forms should respect 'get_max_num' on the
295.         # ModelAdmin
296.         max_forms_input = (
297.             '<input id="id_binarytree_set-MAX_NUM_FORMS" '
298.             'name="binarytree_set-MAX_NUM_FORMS" type="hidden" value="%d">'
299.         )
300.         # The total number of forms will remain the same in either case
301.         total_forms_hidden = (
302.             '<input id="id_binarytree_set-TOTAL_FORMS" '
303.             'name="binarytree_set-TOTAL_FORMS" type="hidden" value="2">'
304.         )
305.         response = self.client.get(reverse('admin:admin_inlines_binarytree_add'))
306.         self.assertInHTML(max_forms_input % 3, response.rendered_content)
307.         self.assertInHTML(total_forms_hidden, response.rendered_content)
308. 
309.         response = self.client.get(reverse('admin:admin_inlines_binarytree_change', args=(bt_head.id,)))
310.         self.assertInHTML(max_forms_input % 2, response.rendered_content)
311.         self.assertInHTML(total_forms_hidden, response.rendered_content)
312. 
313.     def test_min_num(self):
314.         """
315.         min_num and extra determine number of forms.
316.         """
317.         class MinNumInline(TabularInline):
318.             model = BinaryTree
319.             min_num = 2
320.             extra = 3
321. 
322.         modeladmin = ModelAdmin(BinaryTree, admin_site)
323.         modeladmin.inlines = [MinNumInline]
324.         min_forms = (
325.             '<input id="id_binarytree_set-MIN_NUM_FORMS" '
326.             'name="binarytree_set-MIN_NUM_FORMS" type="hidden" value="2">'
327.         )
328.         total_forms = (
329.             '<input id="id_binarytree_set-TOTAL_FORMS" '
330.             'name="binarytree_set-TOTAL_FORMS" type="hidden" value="5">'
331.         )
332.         request = self.factory.get(reverse('admin:admin_inlines_binarytree_add'))
333.         request.user = User(username='super', is_superuser=True)
334.         response = modeladmin.changeform_view(request)
335.         self.assertInHTML(min_forms, response.rendered_content)
336.         self.assertInHTML(total_forms, response.rendered_content)
337. 
338.     def test_custom_min_num(self):
339.         bt_head = BinaryTree.objects.create(name="Tree Head")
340.         BinaryTree.objects.create(name="First Child", parent=bt_head)
341. 
342.         class MinNumInline(TabularInline):
343.             model = BinaryTree
344.             extra = 3
345. 
346.             def get_min_num(self, request, obj=None, **kwargs):
347.                 if obj:
348.                     return 5
349.                 return 2
350. 
351.         modeladmin = ModelAdmin(BinaryTree, admin_site)
352.         modeladmin.inlines = [MinNumInline]
353.         min_forms = (
354.             '<input id="id_binarytree_set-MIN_NUM_FORMS" '
355.             'name="binarytree_set-MIN_NUM_FORMS" type="hidden" value="%d">'
356.         )
357.         total_forms = (
358.             '<input id="id_binarytree_set-TOTAL_FORMS" '
359.             'name="binarytree_set-TOTAL_FORMS" type="hidden" value="%d">'
360.         )
361.         request = self.factory.get(reverse('admin:admin_inlines_binarytree_add'))
362.         request.user = User(username='super', is_superuser=True)
363.         response = modeladmin.changeform_view(request)
364.         self.assertInHTML(min_forms % 2, response.rendered_content)
365.         self.assertInHTML(total_forms % 5, response.rendered_content)
366. 
367.         request = self.factory.get(reverse('admin:admin_inlines_binarytree_change', args=(bt_head.id,)))
368.         request.user = User(username='super', is_superuser=True)
369.         response = modeladmin.changeform_view(request, object_id=str(bt_head.id))
370.         self.assertInHTML(min_forms % 5, response.rendered_content)
371.         self.assertInHTML(total_forms % 8, response.rendered_content)
372. 
373.     def test_inline_nonauto_noneditable_pk(self):
374.         response = self.client.get(reverse('admin:admin_inlines_author_add'))
375.         self.assertContains(
376.             response,
377.             '<input id="id_nonautopkbook_set-0-rand_pk" '
378.             'name="nonautopkbook_set-0-rand_pk" type="hidden">',
379.             html=True
380.         )
381.         self.assertContains(
382.             response,
383.             '<input id="id_nonautopkbook_set-2-0-rand_pk" '
384.             'name="nonautopkbook_set-2-0-rand_pk" type="hidden">',
385.             html=True
386.         )
387. 
388.     def test_inline_nonauto_noneditable_inherited_pk(self):
389.         response = self.client.get(reverse('admin:admin_inlines_author_add'))
390.         self.assertContains(
391.             response,
392.             '<input id="id_nonautopkbookchild_set-0-nonautopkbook_ptr" '
393.             'name="nonautopkbookchild_set-0-nonautopkbook_ptr" type="hidden">',
394.             html=True
395.         )
396.         self.assertContains(
397.             response,
398.             '<input id="id_nonautopkbookchild_set-2-nonautopkbook_ptr" '
399.             'name="nonautopkbookchild_set-2-nonautopkbook_ptr" type="hidden">',
400.             html=True
401.         )
402. 
403.     def test_inline_editable_pk(self):
404.         response = self.client.get(reverse('admin:admin_inlines_author_add'))
405.         self.assertContains(
406.             response,
407.             '<input class="vIntegerField" id="id_editablepkbook_set-0-manual_pk" '
408.             'name="editablepkbook_set-0-manual_pk" type="number">',
409.             html=True, count=1
410.         )
411.         self.assertContains(
412.             response,
413.             '<input class="vIntegerField" id="id_editablepkbook_set-2-0-manual_pk" '
414.             'name="editablepkbook_set-2-0-manual_pk" type="number">',
415.             html=True, count=1
416.         )
417. 
418.     def test_stacked_inline_edit_form_contains_has_original_class(self):
419.         holder = Holder.objects.create(dummy=1)
420.         holder.inner_set.create(dummy=1)
421.         response = self.client.get(reverse('admin:admin_inlines_holder_change', args=(holder.pk,)))
422.         self.assertContains(
423.             response,
424.             '<div class="inline-related has_original" id="inner_set-0">',
425.             count=1
426.         )
427.         self.assertContains(
428.             response,
429.             '<div class="inline-related" id="inner_set-1">',
430.             count=1
431.         )
432. 
433.     def test_inlines_show_change_link_registered(self):
434.         "Inlines `show_change_link` for registered models when enabled."
435.         holder = Holder4.objects.create(dummy=1)
436.         item1 = Inner4Stacked.objects.create(dummy=1, holder=holder)
437.         item2 = Inner4Tabular.objects.create(dummy=1, holder=holder)
438.         items = (
439.             ('inner4stacked', item1.pk),
440.             ('inner4tabular', item2.pk),
441.         )
442.         response = self.client.get(reverse('admin:admin_inlines_holder4_change', args=(holder.pk,)))
443.         self.assertTrue(response.context['inline_admin_formset'].opts.has_registered_model)
444.         for model, pk in items:
445.             url = reverse('admin:admin_inlines_%s_change' % model, args=(pk,))
446.             self.assertContains(response, '<a href="%s" %s' % (url, INLINE_CHANGELINK_HTML))
447. 
448.     def test_inlines_show_change_link_unregistered(self):
449.         "Inlines `show_change_link` disabled for unregistered models."
450.         parent = ParentModelWithCustomPk.objects.create(my_own_pk="foo", name="Foo")
451.         ChildModel1.objects.create(my_own_pk="bar", name="Bar", parent=parent)
452.         ChildModel2.objects.create(my_own_pk="baz", name="Baz", parent=parent)
453.         response = self.client.get(reverse('admin:admin_inlines_parentmodelwithcustompk_change', args=('foo',)))
454.         self.assertFalse(response.context['inline_admin_formset'].opts.has_registered_model)
455.         self.assertNotContains(response, INLINE_CHANGELINK_HTML)
456. 
457.     def test_tabular_inline_show_change_link_false_registered(self):
458.         "Inlines `show_change_link` disabled by default."
459.         poll = Poll.objects.create(name="New poll")
460.         Question.objects.create(poll=poll)
461.         response = self.client.get(reverse('admin:admin_inlines_poll_change', args=(poll.pk,)))
462.         self.assertTrue(response.context['inline_admin_formset'].opts.has_registered_model)
463.         self.assertNotContains(response, INLINE_CHANGELINK_HTML)
464. 
465.     def test_noneditable_inline_has_field_inputs(self):
466.         """Inlines without change permission shows field inputs on add form."""
467.         response = self.client.get(reverse('admin:admin_inlines_novelreadonlychapter_add'))
468.         self.assertContains(
469.             response,
470.             '<input type="text" name="chapter_set-0-name" '
471.             'class="vTextField" maxlength="40" id="id_chapter_set-0-name">',
472.             html=True
473.         )
474. 
475. 
476. @override_settings(ROOT_URLCONF='admin_inlines.urls')
477. class TestInlineMedia(TestDataMixin, TestCase):
478. 
479.     def setUp(self):
480.         self.client.force_login(self.superuser)
481. 
482.     def test_inline_media_only_base(self):
483.         holder = Holder(dummy=13)
484.         holder.save()
485.         Inner(dummy=42, holder=holder).save()
486.         change_url = reverse('admin:admin_inlines_holder_change', args=(holder.id,))
487.         response = self.client.get(change_url)
488.         self.assertContains(response, 'my_awesome_admin_scripts.js')
489. 
490.     def test_inline_media_only_inline(self):
491.         holder = Holder3(dummy=13)
492.         holder.save()
493.         Inner3(dummy=42, holder=holder).save()
494.         change_url = reverse('admin:admin_inlines_holder3_change', args=(holder.id,))
495.         response = self.client.get(change_url)
496.         self.assertEqual(
497.             response.context['inline_admin_formsets'][0].media._js,
498.             [
499.                 'admin/js/vendor/jquery/jquery.min.js',
500.                 'my_awesome_inline_scripts.js',

File: tests/admin_inlines/tests.py
Line number range: 501 - 1001
Content:
501.                 'custom_number.js',
502.                 'admin/js/jquery.init.js',
503.                 'admin/js/inlines.min.js',
504.             ]
505.         )
506.         self.assertContains(response, 'my_awesome_inline_scripts.js')
507. 
508.     def test_all_inline_media(self):
509.         holder = Holder2(dummy=13)
510.         holder.save()
511.         Inner2(dummy=42, holder=holder).save()
512.         change_url = reverse('admin:admin_inlines_holder2_change', args=(holder.id,))
513.         response = self.client.get(change_url)
514.         self.assertContains(response, 'my_awesome_admin_scripts.js')
515.         self.assertContains(response, 'my_awesome_inline_scripts.js')
516. 
517. 
518. @override_settings(ROOT_URLCONF='admin_inlines.urls')
519. class TestInlineAdminForm(TestCase):
520. 
521.     def test_immutable_content_type(self):
522.         """Regression for #9362
523.         The problem depends only on InlineAdminForm and its "original"
524.         argument, so we can safely set the other arguments to None/{}. We just
525.         need to check that the content_type argument of Child isn't altered by
526.         the internals of the inline form."""
527. 
528.         sally = Teacher.objects.create(name='Sally')
529.         john = Parent.objects.create(name='John')
530.         joe = Child.objects.create(name='Joe', teacher=sally, parent=john)
531. 
532.         iaf = InlineAdminForm(None, None, {}, {}, joe)
533.         parent_ct = ContentType.objects.get_for_model(Parent)
534.         self.assertEqual(iaf.original.content_type, parent_ct)
535. 
536. 
537. @override_settings(ROOT_URLCONF='admin_inlines.urls')
538. class TestInlineProtectedOnDelete(TestDataMixin, TestCase):
539. 
540.     def setUp(self):
541.         self.client.force_login(self.superuser)
542. 
543.     def test_deleting_inline_with_protected_delete_does_not_validate(self):
544.         lotr = Novel.objects.create(name='Lord of the rings')
545.         chapter = Chapter.objects.create(novel=lotr, name='Many Meetings')
546.         foot_note = FootNote.objects.create(chapter=chapter, note='yadda yadda')
547. 
548.         change_url = reverse('admin:admin_inlines_novel_change', args=(lotr.id,))
549.         response = self.client.get(change_url)
550.         data = {
551.             'name': lotr.name,
552.             'chapter_set-TOTAL_FORMS': 1,
553.             'chapter_set-INITIAL_FORMS': 1,
554.             'chapter_set-MAX_NUM_FORMS': 1000,
555.             '_save': 'Save',
556.             'chapter_set-0-id': chapter.id,
557.             'chapter_set-0-name': chapter.name,
558.             'chapter_set-0-novel': lotr.id,
559.             'chapter_set-0-DELETE': 'on'
560.         }
561.         response = self.client.post(change_url, data)
562.         self.assertContains(response, "Deleting chapter %s would require deleting "
563.                             "the following protected related objects: foot note %s"
564.                             % (chapter, foot_note))
565. 
566. 
567. @override_settings(ROOT_URLCONF='admin_inlines.urls')
568. class TestInlinePermissions(TestCase):
569.     """
570.     Make sure the admin respects permissions for objects that are edited
571.     inline. Refs #8060.
572.     """
573. 
574.     @classmethod
575.     def setUpTestData(cls):
576.         cls.user = User(username='admin', is_staff=True, is_active=True)
577.         cls.user.set_password('secret')
578.         cls.user.save()
579. 
580.         cls.author_ct = ContentType.objects.get_for_model(Author)
581.         cls.holder_ct = ContentType.objects.get_for_model(Holder2)
582.         cls.book_ct = ContentType.objects.get_for_model(Book)
583.         cls.inner_ct = ContentType.objects.get_for_model(Inner2)
584. 
585.         # User always has permissions to add and change Authors, and Holders,
586.         # the main (parent) models of the inlines. Permissions on the inlines
587.         # vary per test.
588.         permission = Permission.objects.get(codename='add_author', content_type=cls.author_ct)
589.         cls.user.user_permissions.add(permission)
590.         permission = Permission.objects.get(codename='change_author', content_type=cls.author_ct)
591.         cls.user.user_permissions.add(permission)
592.         permission = Permission.objects.get(codename='add_holder2', content_type=cls.holder_ct)
593.         cls.user.user_permissions.add(permission)
594.         permission = Permission.objects.get(codename='change_holder2', content_type=cls.holder_ct)
595.         cls.user.user_permissions.add(permission)
596. 
597.         author = Author.objects.create(pk=1, name='The Author')
598.         cls.book = author.books.create(name='The inline Book')
599.         cls.author_change_url = reverse('admin:admin_inlines_author_change', args=(author.id,))
600.         # Get the ID of the automatically created intermediate model for the Author-Book m2m
601.         author_book_auto_m2m_intermediate = Author.books.through.objects.get(author=author, book=cls.book)
602.         cls.author_book_auto_m2m_intermediate_id = author_book_auto_m2m_intermediate.pk
603. 
604.         cls.holder = Holder2.objects.create(dummy=13)
605.         cls.inner2 = Inner2.objects.create(dummy=42, holder=cls.holder)
606. 
607.     def setUp(self):
608.         self.holder_change_url = reverse('admin:admin_inlines_holder2_change', args=(self.holder.id,))
609.         self.client.force_login(self.user)
610. 
611.     def test_inline_add_m2m_noperm(self):
612.         response = self.client.get(reverse('admin:admin_inlines_author_add'))
613.         # No change permission on books, so no inline
614.         self.assertNotContains(response, '<h2>Author-book relationships</h2>')
615.         self.assertNotContains(response, 'Add another Author-Book Relationship')
616.         self.assertNotContains(response, 'id="id_Author_books-TOTAL_FORMS"')
617. 
618.     def test_inline_add_fk_noperm(self):
619.         response = self.client.get(reverse('admin:admin_inlines_holder2_add'))
620.         # No permissions on Inner2s, so no inline
621.         self.assertNotContains(response, '<h2>Inner2s</h2>')
622.         self.assertNotContains(response, 'Add another Inner2')
623.         self.assertNotContains(response, 'id="id_inner2_set-TOTAL_FORMS"')
624. 
625.     def test_inline_change_m2m_noperm(self):
626.         response = self.client.get(self.author_change_url)
627.         # No change permission on books, so no inline
628.         self.assertNotContains(response, '<h2>Author-book relationships</h2>')
629.         self.assertNotContains(response, 'Add another Author-Book Relationship')
630.         self.assertNotContains(response, 'id="id_Author_books-TOTAL_FORMS"')
631. 
632.     def test_inline_change_fk_noperm(self):
633.         response = self.client.get(self.holder_change_url)
634.         # No permissions on Inner2s, so no inline
635.         self.assertNotContains(response, '<h2>Inner2s</h2>')
636.         self.assertNotContains(response, 'Add another Inner2')
637.         self.assertNotContains(response, 'id="id_inner2_set-TOTAL_FORMS"')
638. 
639.     def test_inline_add_m2m_view_only_perm(self):
640.         permission = Permission.objects.get(codename='view_book', content_type=self.book_ct)
641.         self.user.user_permissions.add(permission)
642.         response = self.client.get(reverse('admin:admin_inlines_author_add'))
643.         # View-only inlines. (It could be nicer to hide the empty, non-editable
644.         # inlines on the add page.)
645.         self.assertIs(response.context['inline_admin_formset'].has_view_permission, True)
646.         self.assertIs(response.context['inline_admin_formset'].has_add_permission, False)
647.         self.assertIs(response.context['inline_admin_formset'].has_change_permission, False)
648.         self.assertIs(response.context['inline_admin_formset'].has_delete_permission, False)
649.         self.assertContains(response, '<h2>Author-book relationships</h2>')
650.         self.assertContains(
651.             response,
652.             '<input type="hidden" name="Author_books-TOTAL_FORMS" value="0" '
653.             'id="id_Author_books-TOTAL_FORMS">',
654.             html=True,
655.         )
656.         self.assertNotContains(response, 'Add another Author-Book Relationship')
657. 
658.     def test_inline_add_m2m_add_perm(self):
659.         permission = Permission.objects.get(codename='add_book', content_type=self.book_ct)
660.         self.user.user_permissions.add(permission)
661.         response = self.client.get(reverse('admin:admin_inlines_author_add'))
662.         # No change permission on Books, so no inline
663.         self.assertNotContains(response, '<h2>Author-book relationships</h2>')
664.         self.assertNotContains(response, 'Add another Author-Book Relationship')
665.         self.assertNotContains(response, 'id="id_Author_books-TOTAL_FORMS"')
666. 
667.     def test_inline_add_fk_add_perm(self):
668.         permission = Permission.objects.get(codename='add_inner2', content_type=self.inner_ct)
669.         self.user.user_permissions.add(permission)
670.         response = self.client.get(reverse('admin:admin_inlines_holder2_add'))
671.         # Add permission on inner2s, so we get the inline
672.         self.assertContains(response, '<h2>Inner2s</h2>')
673.         self.assertContains(response, 'Add another Inner2')
674.         self.assertContains(response, '<input type="hidden" id="id_inner2_set-TOTAL_FORMS" '
675.                             'value="3" name="inner2_set-TOTAL_FORMS">', html=True)
676. 
677.     def test_inline_change_m2m_add_perm(self):
678.         permission = Permission.objects.get(codename='add_book', content_type=self.book_ct)
679.         self.user.user_permissions.add(permission)
680.         response = self.client.get(self.author_change_url)
681.         # No change permission on books, so no inline
682.         self.assertNotContains(response, '<h2>Author-book relationships</h2>')
683.         self.assertNotContains(response, 'Add another Author-Book Relationship')
684.         self.assertNotContains(response, 'id="id_Author_books-TOTAL_FORMS"')
685.         self.assertNotContains(response, 'id="id_Author_books-0-DELETE"')
686. 
687.     def test_inline_change_m2m_view_only_perm(self):
688.         permission = Permission.objects.get(codename='view_book', content_type=self.book_ct)
689.         self.user.user_permissions.add(permission)
690.         response = self.client.get(self.author_change_url)
691.         # View-only inlines.
692.         self.assertIs(response.context['inline_admin_formset'].has_view_permission, True)
693.         self.assertIs(response.context['inline_admin_formset'].has_add_permission, False)
694.         self.assertIs(response.context['inline_admin_formset'].has_change_permission, False)
695.         self.assertIs(response.context['inline_admin_formset'].has_delete_permission, False)
696.         self.assertContains(response, '<h2>Author-book relationships</h2>')
697.         self.assertContains(
698.             response,
699.             '<input type="hidden" name="Author_books-TOTAL_FORMS" value="1" '
700.             'id="id_Author_books-TOTAL_FORMS">',
701.             html=True,
702.         )
703.         # The field in the inline is read-only.
704.         self.assertContains(response, '<p>%s</p>' % self.book)
705.         self.assertNotContains(
706.             response,
707.             '<input type="checkbox" name="Author_books-0-DELETE" id="id_Author_books-0-DELETE">',
708.             html=True,
709.         )
710. 
711.     def test_inline_change_m2m_change_perm(self):
712.         permission = Permission.objects.get(codename='change_book', content_type=self.book_ct)
713.         self.user.user_permissions.add(permission)
714.         response = self.client.get(self.author_change_url)
715.         # We have change perm on books, so we can add/change/delete inlines
716.         self.assertIs(response.context['inline_admin_formset'].has_view_permission, True)
717.         self.assertIs(response.context['inline_admin_formset'].has_add_permission, True)
718.         self.assertIs(response.context['inline_admin_formset'].has_change_permission, True)
719.         self.assertIs(response.context['inline_admin_formset'].has_delete_permission, True)
720.         self.assertContains(response, '<h2>Author-book relationships</h2>')
721.         self.assertContains(response, 'Add another Author-book relationship')
722.         self.assertContains(response, '<input type="hidden" id="id_Author_books-TOTAL_FORMS" '
723.                             'value="4" name="Author_books-TOTAL_FORMS">', html=True)
724.         self.assertContains(
725.             response,
726.             '<input type="hidden" id="id_Author_books-0-id" value="%i" '
727.             'name="Author_books-0-id">' % self.author_book_auto_m2m_intermediate_id,
728.             html=True
729.         )
730.         self.assertContains(response, 'id="id_Author_books-0-DELETE"')
731. 
732.     def test_inline_change_fk_add_perm(self):
733.         permission = Permission.objects.get(codename='add_inner2', content_type=self.inner_ct)
734.         self.user.user_permissions.add(permission)
735.         response = self.client.get(self.holder_change_url)
736.         # Add permission on inner2s, so we can add but not modify existing
737.         self.assertContains(response, '<h2>Inner2s</h2>')
738.         self.assertContains(response, 'Add another Inner2')
739.         # 3 extra forms only, not the existing instance form
740.         self.assertContains(
741.             response,
742.             '<input type="hidden" id="id_inner2_set-TOTAL_FORMS" value="3" '
743.             'name="inner2_set-TOTAL_FORMS">',
744.             html=True
745.         )
746.         self.assertNotContains(
747.             response,
748.             '<input type="hidden" id="id_inner2_set-0-id" value="%i" name="inner2_set-0-id">' % self.inner2.id,
749.             html=True
750.         )
751. 
752.     def test_inline_change_fk_change_perm(self):
753.         permission = Permission.objects.get(codename='change_inner2', content_type=self.inner_ct)
754.         self.user.user_permissions.add(permission)
755.         response = self.client.get(self.holder_change_url)
756.         # Change permission on inner2s, so we can change existing but not add new
757.         self.assertContains(response, '<h2>Inner2s</h2>', count=2)
758.         # Just the one form for existing instances
759.         self.assertContains(
760.             response, '<input type="hidden" id="id_inner2_set-TOTAL_FORMS" value="1" name="inner2_set-TOTAL_FORMS">',
761.             html=True
762.         )
763.         self.assertContains(
764.             response,
765.             '<input type="hidden" id="id_inner2_set-0-id" value="%i" name="inner2_set-0-id">' % self.inner2.id,
766.             html=True
767.         )
768.         # max-num 0 means we can't add new ones
769.         self.assertContains(
770.             response,
771.             '<input type="hidden" id="id_inner2_set-MAX_NUM_FORMS" value="0" name="inner2_set-MAX_NUM_FORMS">',
772.             html=True
773.         )
774.         # TabularInline
775.         self.assertContains(response, '<th class="column-dummy required">Dummy</th>', html=True)
776.         self.assertContains(
777.             response,
778.             '<input type="number" name="inner2_set-2-0-dummy" value="%s" '
779.             'class="vIntegerField" id="id_inner2_set-2-0-dummy">' % self.inner2.dummy,
780.             html=True,
781.         )
782. 
783.     def test_inline_change_fk_add_change_perm(self):
784.         permission = Permission.objects.get(codename='add_inner2', content_type=self.inner_ct)
785.         self.user.user_permissions.add(permission)
786.         permission = Permission.objects.get(codename='change_inner2', content_type=self.inner_ct)
787.         self.user.user_permissions.add(permission)
788.         response = self.client.get(self.holder_change_url)
789.         # Add/change perm, so we can add new and change existing
790.         self.assertContains(response, '<h2>Inner2s</h2>')
791.         # One form for existing instance and three extra for new
792.         self.assertContains(
793.             response, '<input type="hidden" id="id_inner2_set-TOTAL_FORMS" value="4" name="inner2_set-TOTAL_FORMS">',
794.             html=True
795.         )
796.         self.assertContains(
797.             response,
798.             '<input type="hidden" id="id_inner2_set-0-id" value="%i" name="inner2_set-0-id">' % self.inner2.id,
799.             html=True
800.         )
801. 
802.     def test_inline_change_fk_change_del_perm(self):
803.         permission = Permission.objects.get(codename='change_inner2', content_type=self.inner_ct)
804.         self.user.user_permissions.add(permission)
805.         permission = Permission.objects.get(codename='delete_inner2', content_type=self.inner_ct)
806.         self.user.user_permissions.add(permission)
807.         response = self.client.get(self.holder_change_url)
808.         # Change/delete perm on inner2s, so we can change/delete existing
809.         self.assertContains(response, '<h2>Inner2s</h2>')
810.         # One form for existing instance only, no new
811.         self.assertContains(
812.             response,
813.             '<input type="hidden" id="id_inner2_set-TOTAL_FORMS" value="1" name="inner2_set-TOTAL_FORMS">',
814.             html=True
815.         )
816.         self.assertContains(
817.             response,
818.             '<input type="hidden" id="id_inner2_set-0-id" value="%i" name="inner2_set-0-id">' % self.inner2.id,
819.             html=True
820.         )
821.         self.assertContains(response, 'id="id_inner2_set-0-DELETE"')
822. 
823.     def test_inline_change_fk_all_perms(self):
824.         permission = Permission.objects.get(codename='add_inner2', content_type=self.inner_ct)
825.         self.user.user_permissions.add(permission)
826.         permission = Permission.objects.get(codename='change_inner2', content_type=self.inner_ct)
827.         self.user.user_permissions.add(permission)
828.         permission = Permission.objects.get(codename='delete_inner2', content_type=self.inner_ct)
829.         self.user.user_permissions.add(permission)
830.         response = self.client.get(self.holder_change_url)
831.         # All perms on inner2s, so we can add/change/delete
832.         self.assertContains(response, '<h2>Inner2s</h2>', count=2)
833.         # One form for existing instance only, three for new
834.         self.assertContains(
835.             response,
836.             '<input type="hidden" id="id_inner2_set-TOTAL_FORMS" value="4" name="inner2_set-TOTAL_FORMS">',
837.             html=True
838.         )
839.         self.assertContains(
840.             response,
841.             '<input type="hidden" id="id_inner2_set-0-id" value="%i" name="inner2_set-0-id">' % self.inner2.id,
842.             html=True
843.         )
844.         self.assertContains(response, 'id="id_inner2_set-0-DELETE"')
845.         # TabularInline
846.         self.assertContains(response, '<th class="column-dummy required">Dummy</th>', html=True)
847.         self.assertContains(
848.             response,
849.             '<input type="number" name="inner2_set-2-0-dummy" value="%s" '
850.             'class="vIntegerField" id="id_inner2_set-2-0-dummy">' % self.inner2.dummy,
851.             html=True,
852.         )
853. 
854. 
855. @override_settings(ROOT_URLCONF='admin_inlines.urls')
856. class SeleniumTests(AdminSeleniumTestCase):
857. 
858.     available_apps = ['admin_inlines'] + AdminSeleniumTestCase.available_apps
859. 
860.     def setUp(self):
861.         User.objects.create_superuser(username='super', password='secret', email='super@example.com')
862. 
863.     def test_add_stackeds(self):
864.         """
865.         The "Add another XXX" link correctly adds items to the stacked formset.
866.         """
867.         self.admin_login(username='super', password='secret')
868.         self.selenium.get(self.live_server_url + reverse('admin:admin_inlines_holder4_add'))
869. 
870.         inline_id = '#inner4stacked_set-group'
871. 
872.         def rows_length():
873.             return len(self.selenium.find_elements_by_css_selector('%s .dynamic-inner4stacked_set' % inline_id))
874.         self.assertEqual(rows_length(), 3)
875. 
876.         add_button = self.selenium.find_element_by_link_text(
877.             'Add another Inner4 stacked')
878.         add_button.click()
879. 
880.         self.assertEqual(rows_length(), 4)
881. 
882.     def test_delete_stackeds(self):
883.         self.admin_login(username='super', password='secret')
884.         self.selenium.get(self.live_server_url + reverse('admin:admin_inlines_holder4_add'))
885. 
886.         inline_id = '#inner4stacked_set-group'
887. 
888.         def rows_length():
889.             return len(self.selenium.find_elements_by_css_selector('%s .dynamic-inner4stacked_set' % inline_id))
890.         self.assertEqual(rows_length(), 3)
891. 
892.         add_button = self.selenium.find_element_by_link_text(
893.             'Add another Inner4 stacked')
894.         add_button.click()
895.         add_button.click()
896. 
897.         self.assertEqual(rows_length(), 5, msg="sanity check")
898.         for delete_link in self.selenium.find_elements_by_css_selector('%s .inline-deletelink' % inline_id):
899.             delete_link.click()
900.         self.assertEqual(rows_length(), 3)
901. 
902.     def test_add_inlines(self):
903.         """
904.         The "Add another XXX" link correctly adds items to the inline form.
905.         """
906.         self.admin_login(username='super', password='secret')
907.         self.selenium.get(self.live_server_url + reverse('admin:admin_inlines_profilecollection_add'))
908. 
909.         # There's only one inline to start with and it has the correct ID.
910.         self.assertEqual(len(self.selenium.find_elements_by_css_selector(
911.             '.dynamic-profile_set')), 1)
912.         self.assertEqual(self.selenium.find_elements_by_css_selector(
913.             '.dynamic-profile_set')[0].get_attribute('id'),
914.             'profile_set-0')
915.         self.assertEqual(len(self.selenium.find_elements_by_css_selector(
916.             '.dynamic-profile_set#profile_set-0 input[name=profile_set-0-first_name]')), 1)
917.         self.assertEqual(len(self.selenium.find_elements_by_css_selector(
918.             '.dynamic-profile_set#profile_set-0 input[name=profile_set-0-last_name]')), 1)
919. 
920.         # Add an inline
921.         self.selenium.find_element_by_link_text('Add another Profile').click()
922. 
923.         # The inline has been added, it has the right id, and it contains the
924.         # correct fields.
925.         self.assertEqual(len(self.selenium.find_elements_by_css_selector('.dynamic-profile_set')), 2)
926.         self.assertEqual(self.selenium.find_elements_by_css_selector(
927.             '.dynamic-profile_set')[1].get_attribute('id'), 'profile_set-1')
928.         self.assertEqual(len(self.selenium.find_elements_by_css_selector(
929.             '.dynamic-profile_set#profile_set-1 input[name=profile_set-1-first_name]')), 1)
930.         self.assertEqual(len(self.selenium.find_elements_by_css_selector(
931.             '.dynamic-profile_set#profile_set-1 input[name=profile_set-1-last_name]')), 1)
932. 
933.         # Let's add another one to be sure
934.         self.selenium.find_element_by_link_text('Add another Profile').click()
935.         self.assertEqual(len(self.selenium.find_elements_by_css_selector('.dynamic-profile_set')), 3)
936.         self.assertEqual(self.selenium.find_elements_by_css_selector(
937.             '.dynamic-profile_set')[2].get_attribute('id'), 'profile_set-2')
938.         self.assertEqual(len(self.selenium.find_elements_by_css_selector(
939.             '.dynamic-profile_set#profile_set-2 input[name=profile_set-2-first_name]')), 1)
940.         self.assertEqual(len(self.selenium.find_elements_by_css_selector(
941.             '.dynamic-profile_set#profile_set-2 input[name=profile_set-2-last_name]')), 1)
942. 
943.         # Enter some data and click 'Save'
944.         self.selenium.find_element_by_name('profile_set-0-first_name').send_keys('0 first name 1')
945.         self.selenium.find_element_by_name('profile_set-0-last_name').send_keys('0 last name 2')
946.         self.selenium.find_element_by_name('profile_set-1-first_name').send_keys('1 first name 1')
947.         self.selenium.find_element_by_name('profile_set-1-last_name').send_keys('1 last name 2')
948.         self.selenium.find_element_by_name('profile_set-2-first_name').send_keys('2 first name 1')
949.         self.selenium.find_element_by_name('profile_set-2-last_name').send_keys('2 last name 2')
950. 
951.         self.selenium.find_element_by_xpath('//input[@value="Save"]').click()
952.         self.wait_page_loaded()
953. 
954.         # The objects have been created in the database
955.         self.assertEqual(ProfileCollection.objects.all().count(), 1)
956.         self.assertEqual(Profile.objects.all().count(), 3)
957. 
958.     def test_delete_inlines(self):
959.         self.admin_login(username='super', password='secret')
960.         self.selenium.get(self.live_server_url + reverse('admin:admin_inlines_profilecollection_add'))
961. 
962.         # Add a few inlines
963.         self.selenium.find_element_by_link_text('Add another Profile').click()
964.         self.selenium.find_element_by_link_text('Add another Profile').click()
965.         self.selenium.find_element_by_link_text('Add another Profile').click()
966.         self.selenium.find_element_by_link_text('Add another Profile').click()
967.         self.assertEqual(len(self.selenium.find_elements_by_css_selector(
968.             '#profile_set-group table tr.dynamic-profile_set')), 5)
969.         self.assertEqual(len(self.selenium.find_elements_by_css_selector(
970.             'form#profilecollection_form tr.dynamic-profile_set#profile_set-0')), 1)
971.         self.assertEqual(len(self.selenium.find_elements_by_css_selector(
972.             'form#profilecollection_form tr.dynamic-profile_set#profile_set-1')), 1)
973.         self.assertEqual(len(self.selenium.find_elements_by_css_selector(
974.             'form#profilecollection_form tr.dynamic-profile_set#profile_set-2')), 1)
975.         self.assertEqual(len(self.selenium.find_elements_by_css_selector(
976.             'form#profilecollection_form tr.dynamic-profile_set#profile_set-3')), 1)
977.         self.assertEqual(len(self.selenium.find_elements_by_css_selector(
978.             'form#profilecollection_form tr.dynamic-profile_set#profile_set-4')), 1)
979. 
980.         # Click on a few delete buttons
981.         self.selenium.find_element_by_css_selector(
982.             'form#profilecollection_form tr.dynamic-profile_set#profile_set-1 td.delete a').click()
983.         self.selenium.find_element_by_css_selector(
984.             'form#profilecollection_form tr.dynamic-profile_set#profile_set-2 td.delete a').click()
985.         # The rows are gone and the IDs have been re-sequenced
986.         self.assertEqual(len(self.selenium.find_elements_by_css_selector(
987.             '#profile_set-group table tr.dynamic-profile_set')), 3)
988.         self.assertEqual(len(self.selenium.find_elements_by_css_selector(
989.             'form#profilecollection_form tr.dynamic-profile_set#profile_set-0')), 1)
990.         self.assertEqual(len(self.selenium.find_elements_by_css_selector(
991.             'form#profilecollection_form tr.dynamic-profile_set#profile_set-1')), 1)
992.         self.assertEqual(len(self.selenium.find_elements_by_css_selector(
993.             'form#profilecollection_form tr.dynamic-profile_set#profile_set-2')), 1)
994. 
995.     def test_alternating_rows(self):
996.         self.admin_login(username='super', password='secret')
997.         self.selenium.get(self.live_server_url + reverse('admin:admin_inlines_profilecollection_add'))
998. 
999.         # Add a few inlines
1000.         self.selenium.find_element_by_link_text('Add another Profile').click()
1001.         self.selenium.find_element_by_link_text('Add another Profile').click()

File: tests/admin_inlines/admin.py
Line number range: 1 - 487
Content:
1. from django import forms
2. from django.contrib import admin
3. from django.db import models
4. 
5. from .models import (
6.     Author, BinaryTree, CapoFamiglia, Chapter, ChildModel1, ChildModel2,
7.     Consigliere, EditablePKBook, ExtraTerrestrial, Fashionista, Holder,
8.     Holder2, Holder3, Holder4, Inner, Inner2, Inner3, Inner4Stacked,
9.     Inner4Tabular, NonAutoPKBook, NonAutoPKBookChild, Novel,
10.     NovelReadonlyChapter, ParentModelWithCustomPk, Poll, Profile,
11.     ProfileCollection, Question, ReadOnlyInline, ShoppingWeakness, Sighting,
12.     SomeChildModel, SomeParentModel, SottoCapo, Title, TitleCollection,
13. )
14. 
15. site = admin.AdminSite(name="admin")
16. 
17. 
18. class BookInline(admin.TabularInline):
19.     model = Author.books.through
20. 
21. 
22. class NonAutoPKBookTabularInline(admin.TabularInline):
23.     model = NonAutoPKBook
24.     classes = ('collapse',)
25. 
26. 
27. class NonAutoPKBookChildTabularInline(admin.TabularInline):
28.     model = NonAutoPKBookChild
29.     classes = ('collapse',)
30. 
31. 
32. class NonAutoPKBookStackedInline(admin.StackedInline):
33.     model = NonAutoPKBook
34.     classes = ('collapse',)
35. 
36. 
37. class EditablePKBookTabularInline(admin.TabularInline):
38.     model = EditablePKBook
39. 
40. 
41. class EditablePKBookStackedInline(admin.StackedInline):
42.     model = EditablePKBook
43. 
44. 
45. class AuthorAdmin(admin.ModelAdmin):
46.     inlines = [
47.         BookInline, NonAutoPKBookTabularInline, NonAutoPKBookStackedInline,
48.         EditablePKBookTabularInline, EditablePKBookStackedInline,
49.         NonAutoPKBookChildTabularInline,
50.     ]
51. 
52. 
53. class InnerInline(admin.StackedInline):
54.     model = Inner
55.     can_delete = False
56.     readonly_fields = ('readonly',)  # For bug #13174 tests.
57. 
58. 
59. class HolderAdmin(admin.ModelAdmin):
60. 
61.     class Media:
62.         js = ('my_awesome_admin_scripts.js',)
63. 
64. 
65. class ReadOnlyInlineInline(admin.TabularInline):
66.     model = ReadOnlyInline
67.     readonly_fields = ['name']
68. 
69. 
70. class InnerInline2(admin.StackedInline):
71.     model = Inner2
72. 
73.     class Media:
74.         js = ('my_awesome_inline_scripts.js',)
75. 
76. 
77. class InnerInline2Tabular(admin.TabularInline):
78.     model = Inner2
79. 
80. 
81. class CustomNumberWidget(forms.NumberInput):
82.     class Media:
83.         js = ('custom_number.js',)
84. 
85. 
86. class InnerInline3(admin.StackedInline):
87.     model = Inner3
88.     formfield_overrides = {
89.         models.IntegerField: {'widget': CustomNumberWidget},
90.     }
91. 
92.     class Media:
93.         js = ('my_awesome_inline_scripts.js',)
94. 
95. 
96. class TitleForm(forms.ModelForm):
97.     title1 = forms.CharField(max_length=100)
98. 
99.     def clean(self):
100.         cleaned_data = self.cleaned_data
101.         title1 = cleaned_data.get("title1")
102.         title2 = cleaned_data.get("title2")
103.         if title1 != title2:
104.             raise forms.ValidationError("The two titles must be the same")
105.         return cleaned_data
106. 
107. 
108. class TitleInline(admin.TabularInline):
109.     model = Title
110.     form = TitleForm
111.     extra = 1
112. 
113. 
114. class Inner4StackedInline(admin.StackedInline):
115.     model = Inner4Stacked
116.     show_change_link = True
117. 
118. 
119. class Inner4TabularInline(admin.TabularInline):
120.     model = Inner4Tabular
121.     show_change_link = True
122. 
123. 
124. class Holder4Admin(admin.ModelAdmin):
125.     inlines = [Inner4StackedInline, Inner4TabularInline]
126. 
127. 
128. class InlineWeakness(admin.TabularInline):
129.     model = ShoppingWeakness
130.     extra = 1
131. 
132. 
133. class QuestionInline(admin.TabularInline):
134.     model = Question
135.     readonly_fields = ['call_me']
136. 
137.     def call_me(self, obj):
138.         return 'Callable in QuestionInline'
139. 
140. 
141. class PollAdmin(admin.ModelAdmin):
142.     inlines = [QuestionInline]
143. 
144.     def call_me(self, obj):
145.         return 'Callable in PollAdmin'
146. 
147. 
148. class ChapterInline(admin.TabularInline):
149.     model = Chapter
150.     readonly_fields = ['call_me']
151. 
152.     def call_me(self, obj):
153.         return 'Callable in ChapterInline'
154. 
155. 
156. class NovelAdmin(admin.ModelAdmin):
157.     inlines = [ChapterInline]
158. 
159. 
160. class ReadOnlyChapterInline(admin.TabularInline):
161.     model = Chapter
162. 
163.     def has_change_permission(self, request, obj=None):
164.         return False
165. 
166. 
167. class NovelReadonlyChapterAdmin(admin.ModelAdmin):
168.     inlines = [ReadOnlyChapterInline]
169. 
170. 
171. class ConsigliereInline(admin.TabularInline):
172.     model = Consigliere
173. 
174. 
175. class SottoCapoInline(admin.TabularInline):
176.     model = SottoCapo
177. 
178. 
179. class ProfileInline(admin.TabularInline):
180.     model = Profile
181.     extra = 1
182. 
183. 
184. # admin for #18433
185. class ChildModel1Inline(admin.TabularInline):
186.     model = ChildModel1
187. 
188. 
189. class ChildModel2Inline(admin.StackedInline):
190.     model = ChildModel2
191. 
192. 
193. # admin for #19425 and #18388
194. class BinaryTreeAdmin(admin.TabularInline):
195.     model = BinaryTree
196. 
197.     def get_extra(self, request, obj=None, **kwargs):
198.         extra = 2
199.         if obj:
200.             return extra - obj.binarytree_set.count()
201.         return extra
202. 
203.     def get_max_num(self, request, obj=None, **kwargs):
204.         max_num = 3
205.         if obj:
206.             return max_num - obj.binarytree_set.count()
207.         return max_num
208. 
209. 
210. # admin for #19524
211. class SightingInline(admin.TabularInline):
212.     model = Sighting
213. 
214. 
215. # admin and form for #18263
216. class SomeChildModelForm(forms.ModelForm):
217. 
218.     class Meta:
219.         fields = '__all__'
220.         model = SomeChildModel
221.         widgets = {
222.             'position': forms.HiddenInput,
223.         }
224.         labels = {'readonly_field': 'Label from ModelForm.Meta'}
225.         help_texts = {'readonly_field': 'Help text from ModelForm.Meta'}
226. 
227.     def __init__(self, *args, **kwargs):
228.         super().__init__(*args, **kwargs)
229.         self.fields['name'].label = 'new label'
230. 
231. 
232. class SomeChildModelInline(admin.TabularInline):
233.     model = SomeChildModel
234.     form = SomeChildModelForm
235.     readonly_fields = ('readonly_field',)
236. 
237. 
238. site.register(TitleCollection, inlines=[TitleInline])
239. # Test bug #12561 and #12778
240. # only ModelAdmin media
241. site.register(Holder, HolderAdmin, inlines=[InnerInline])
242. # ModelAdmin and Inline media
243. site.register(Holder2, HolderAdmin, inlines=[InnerInline2, InnerInline2Tabular])
244. # only Inline media
245. site.register(Holder3, inlines=[InnerInline3])
246. 
247. site.register(Poll, PollAdmin)
248. site.register(Novel, NovelAdmin)
249. site.register(NovelReadonlyChapter, NovelReadonlyChapterAdmin)
250. site.register(Fashionista, inlines=[InlineWeakness])
251. site.register(Holder4, Holder4Admin)
252. site.register(Author, AuthorAdmin)
253. site.register(CapoFamiglia, inlines=[ConsigliereInline, SottoCapoInline, ReadOnlyInlineInline])
254. site.register(ProfileCollection, inlines=[ProfileInline])
255. site.register(ParentModelWithCustomPk, inlines=[ChildModel1Inline, ChildModel2Inline])
256. site.register(BinaryTree, inlines=[BinaryTreeAdmin])
257. site.register(ExtraTerrestrial, inlines=[SightingInline])
258. site.register(SomeParentModel, inlines=[SomeChildModelInline])
259. site.register([Question, Inner4Stacked, Inner4Tabular])


--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to a given query and the refinement query, and return your response in the specified format!
EVERY context object MUST include: reasoning, relative_path, start_line, and end_line.

2025-10-06 21:11:53,015 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="1. Query requirement analysis:\n   - The user wants to dynamically configure inlines based on the request or model instance, similar to hooks like `get_queryset` or `get_readonly_fields`.\n   - This file defines multiple `ModelAdmin` and `InlineModelAdmin` classes with overridden methods like `get_extra`, `get_max_num`, and `has_change_permission`.\n\n2. Extended relevance:\n   - This code is essential context for the tests in `tests/admin_inlines/tests.py`.\n   - It provides concrete examples of how to implement dynamic behavior in admin inlines, which is the core of the user's request. For example, the `BinaryTreeAdmin` overrides `get_extra` and `get_max_num` based on the object instance (`obj`), and `ReadOnlyChapterInline` overrides `has_change_permission`.", relative_path='tests/admin_inlines/admin.py', start_line=1, end_line=259), ContextOutput(reasoning="1. Query requirement analysis:\n   - The user wants to see tests for dynamically configuring inlines based on the request.\n   - This test class, `TestInlinePermissions`, specifically tests how inline behavior (add, change, view, delete) changes based on the user's permissions, which are determined from the request object.\n\n2. Extended relevance:\n   - These tests (`test_inline_add_fk_noperm`, `test_inline_change_fk_change_perm`, etc.) directly assert that the presence and behavior of inlines are controlled by permission hooks. This is a direct parallel to the user's goal of controlling which inlines appear via a new hook like `get_inlines`.", relative_path='tests/admin_inlines/tests.py', start_line=568, end_line=853), ContextOutput(reasoning="1. Query requirement analysis:\n   - The user is asking for examples of how to test dynamic inline functionality.\n   - This test class, `TestInline`, contains several tests for inline behavior that is configured in the `ModelAdmin`.\n\n2. Extended relevance:\n   - `test_callable_lookup` (lines 154-166) tests the use of a callable in `readonly_fields` for an inline, demonstrating a pattern of dynamic content generation.\n   - `test_custom_get_extra_form` (lines 291-312) and `test_custom_min_num` (lines 338-372) test the dynamic adjustment of inline form counts based on the request and object, which is very similar to the user's goal.", relative_path='tests/admin_inlines/tests.py', start_line=28, end_line=372), ContextOutput(reasoning="1. Query requirement analysis:\n   - The user wants to dynamically control inlines based on the request or object.\n   - This test class, `AdminViewPermissionsTest`, contains multiple tests that verify how inlines are displayed and behave based on user permissions, which are checked against the request.\n\n2. Extended relevance:\n   - The tests `test_add_view_with_view_only_inlines`, `test_change_view_with_view_only_inlines`, `test_change_view_with_view_and_add_inlines`, and `test_change_view_with_view_and_delete_inlines` are excellent examples. They show how a user's permissions (part of the request context) determine whether inlines are read-only, allow additions, or allow deletions. This directly relates to the desired dynamic behavior.", relative_path='tests/admin_views/tests.py', start_line=1405, end_line=2046), ContextOutput(reasoning="1. Query requirement analysis:\n   - The user mentioned `get_queryset` as an example of an existing dynamic hook they would like to emulate for inlines.\n   - This test class, `AdminCustomQuerysetTest`, is dedicated to testing the functionality of a custom `get_queryset` method on a `ModelAdmin`.\n\n2. Extended relevance:\n   - The tests `test_changelist_view` and `test_change_view` verify that the admin views correctly filter objects based on the custom queryset. This provides a complete, self-contained example of testing a dynamic hook (`get_queryset`) that modifies admin behavior based on the object's properties, which is analogous to the user's proposed `get_inlines(request, obj)` hook.", relative_path='tests/admin_views/tests.py', start_line=3631, end_line=3889)]
2025-10-06 21:11:53,018 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - INFO - Context extraction complete, returning context [Context(relative_path='tests/admin_inlines/tests.py', content='433.     def test_inlines_show_change_link_registered(self):\n434.         "Inlines `show_change_link` for registered models when enabled."\n435.         holder = Holder4.objects.create(dummy=1)\n436.         item1 = Inner4Stacked.objects.create(dummy=1, holder=holder)\n437.         item2 = Inner4Tabular.objects.create(dummy=1, holder=holder)\n438.         items = (\n439.             (\'inner4stacked\', item1.pk),\n440.             (\'inner4tabular\', item2.pk),\n441.         )\n442.         response = self.client.get(reverse(\'admin:admin_inlines_holder4_change\', args=(holder.pk,)))\n443.         self.assertTrue(response.context[\'inline_admin_formset\'].opts.has_registered_model)\n444.         for model, pk in items:\n445.             url = reverse(\'admin:admin_inlines_%s_change\' % model, args=(pk,))\n446.             self.assertContains(response, \'<a href="%s" %s\' % (url, INLINE_CHANGELINK_HTML))\n447. ', start_line_number=433, end_line_number=447), Context(relative_path='tests/admin_views/tests.py', content='6181.     def test_check(self):\n6182.         "The view_on_site value is either a boolean or a callable"\n6183.         try:\n6184.             admin = CityAdmin(City, AdminSite())\n6185.             CityAdmin.view_on_site = True\n6186.             self.assertEqual(admin.check(), [])\n6187.             CityAdmin.view_on_site = False\n6188.             self.assertEqual(admin.check(), [])\n6189.             CityAdmin.view_on_site = lambda obj: obj.get_absolute_url()\n6190.             self.assertEqual(admin.check(), [])\n6191.             CityAdmin.view_on_site = []\n6192.             self.assertEqual(admin.check(), [\n6193.                 Error(\n6194.                     "The value of \'view_on_site\' must be a callable or a boolean value.",\n6195.                     obj=CityAdmin,\n6196.                     id=\'admin.E025\',\n6197.                 ),\n6198.             ])\n6199.         finally:\n6200.             # Restore the original values for the benefit of other tests.\n6201.             CityAdmin.view_on_site = True\n6202. ', start_line_number=6181, end_line_number=6202), Context(relative_path='tests/admin_views/tests.py', content='4815. class ReadonlyTest(AdminFieldExtractionMixin, TestCase):\n4816. \n4817.     @classmethod\n4818.     def setUpTestData(cls):\n4819.         cls.superuser = User.objects.create_superuser(username=\'super\', password=\'secret\', email=\'super@example.com\')\n4820. \n4821.     def setUp(self):\n4822.         self.client.force_login(self.superuser)\n4823. \n4824.     def test_readonly_get(self):\n4825.         response = self.client.get(reverse(\'admin:admin_views_post_add\'))\n4826.         self.assertEqual(response.status_code, 200)\n4827.         self.assertNotContains(response, \'name="posted"\')\n4828.         # 3 fields + 2 submit buttons + 5 inline management form fields, + 2\n4829.         # hidden fields for inlines + 1 field for the inline + 2 empty form\n4830.         self.assertContains(response, "<input", count=15)\n4831.         self.assertContains(response, formats.localize(datetime.date.today()))\n4832.         self.assertContains(response, "<label>Awesomeness level:</label>")\n4833.         self.assertContains(response, "Very awesome.")\n4834.         self.assertContains(response, "Unknown coolness.")\n4835.         self.assertContains(response, "foo")\n4836. \n4837.         # Multiline text in a readonly field gets <br> tags\n4838.         self.assertContains(response, \'Multiline<br>test<br>string\')\n4839.         self.assertContains(response, \'<div class="readonly">Multiline<br>html<br>content</div>\', html=True)\n4840.         self.assertContains(response, \'InlineMultiline<br>test<br>string\')\n4841. \n4842.         self.assertContains(response, formats.localize(datetime.date.today() - datetime.timedelta(days=7)))\n4843. \n4844.         self.assertContains(response, \'<div class="form-row field-coolness">\')\n4845.         self.assertContains(response, \'<div class="form-row field-awesomeness_level">\')\n4846.         self.assertContains(response, \'<div class="form-row field-posted">\')\n4847.         self.assertContains(response, \'<div class="form-row field-value">\')\n4848.         self.assertContains(response, \'<div class="form-row">\')\n4849.         self.assertContains(response, \'<div class="help">\', 3)\n4850.         self.assertContains(\n4851.             response,\n4852.             \'<div class="help">Some help text for the title (with unicode ŠĐĆŽćžšđ)</div>\',\n4853.             html=True\n4854.         )\n4855.         self.assertContains(\n4856.             response,\n4857.             \'<div class="help">Some help text for the content (with unicode ŠĐĆŽćžšđ)</div>\',\n4858.             html=True\n4859.         )\n4860.         self.assertContains(\n4861.             response,\n4862.             \'<div class="help">Some help text for the date (with unicode ŠĐĆŽćžšđ)</div>\',\n4863.             html=True\n4864.         )\n4865. \n4866.         p = Post.objects.create(title="I worked on readonly_fields", content="Its good stuff")\n4867.         response = self.client.get(reverse(\'admin:admin_views_post_change\', args=(p.pk,)))\n4868.         self.assertContains(response, "%d amount of cool" % p.pk)\n4869. \n4870.     def test_readonly_text_field(self):\n4871.         p = Post.objects.create(\n4872.             title="Readonly test", content="test",\n4873.             readonly_content=\'test\\r\\n\\r\\ntest\\r\\n\\r\\ntest\\r\\n\\r\\ntest\',\n4874.         )\n4875.         Link.objects.create(\n4876.             url="http://www.djangoproject.com", post=p,\n4877.             readonly_link_content="test\\r\\nlink",\n4878.         )\n4879.         response = self.client.get(reverse(\'admin:admin_views_post_change\', args=(p.pk,)))\n4880.         # Checking readonly field.\n4881.         self.assertContains(response, \'test<br><br>test<br><br>test<br><br>test\')\n4882.         # Checking readonly field in inline.\n4883.         self.assertContains(response, \'test<br>link\')\n4884. \n4885.     def test_readonly_post(self):\n4886.         data = {\n4887.             "title": "Django Got Readonly Fields",\n4888.             "content": "This is an incredible development.",\n4889.             "link_set-TOTAL_FORMS": "1",\n4890.             "link_set-INITIAL_FORMS": "0",\n4891.             "link_set-MAX_NUM_FORMS": "0",\n4892.         }\n4893.         response = self.client.post(reverse(\'admin:admin_views_post_add\'), data)\n4894.         self.assertEqual(response.status_code, 302)\n4895.         self.assertEqual(Post.objects.count(), 1)\n4896.         p = Post.objects.get()\n4897.         self.assertEqual(p.posted, datetime.date.today())\n4898. \n4899.         data["posted"] = "10-8-1990"  # some date that\'s not today\n4900.         response = self.client.post(reverse(\'admin:admin_views_post_add\'), data)\n4901.         self.assertEqual(response.status_code, 302)\n4902.         self.assertEqual(Post.objects.count(), 2)\n4903.         p = Post.objects.order_by(\'-id\')[0]\n4904.         self.assertEqual(p.posted, datetime.date.today())\n4905. \n4906.     def test_readonly_manytomany(self):\n4907.         "Regression test for #13004"\n4908.         response = self.client.get(reverse(\'admin:admin_views_pizza_add\'))\n4909.         self.assertEqual(response.status_code, 200)\n4910. \n4911.     def test_user_password_change_limited_queryset(self):\n4912.         su = User.objects.filter(is_superuser=True)[0]\n4913.         response = self.client.get(reverse(\'admin2:auth_user_password_change\', args=(su.pk,)))\n4914.         self.assertEqual(response.status_code, 404)\n4915. \n4916.     def test_change_form_renders_correct_null_choice_value(self):\n4917.         """\n4918.         Regression test for #17911.\n4919.         """\n4920.         choice = Choice.objects.create(choice=None)\n4921.         response = self.client.get(reverse(\'admin:admin_views_choice_change\', args=(choice.pk,)))\n4922.         self.assertContains(response, \'<div class="readonly">No opinion</div>\', html=True)\n4923. \n4924.     def test_readonly_manytomany_backwards_ref(self):\n4925.         """\n4926.         Regression test for #16433 - backwards references for related objects\n4927.         broke if the related field is read-only due to the help_text attribute\n4928.         """\n4929.         topping = Topping.objects.create(name=\'Salami\')\n4930.         pizza = Pizza.objects.create(name=\'Americano\')\n4931.         pizza.toppings.add(topping)\n4932.         response = self.client.get(reverse(\'admin:admin_views_topping_add\'))\n4933.         self.assertEqual(response.status_code, 200)\n4934. \n4935.     def test_readonly_manytomany_forwards_ref(self):\n4936.         topping = Topping.objects.create(name=\'Salami\')\n4937.         pizza = Pizza.objects.create(name=\'Americano\')\n4938.         pizza.toppings.add(topping)\n4939.         response = self.client.get(reverse(\'admin:admin_views_pizza_change\', args=(pizza.pk,)))\n4940.         self.assertContains(response, \'<label>Toppings:</label>\', html=True)\n4941.         self.assertContains(response, \'<div class="readonly">Salami</div>\', html=True)\n4942. \n4943.     def test_readonly_onetoone_backwards_ref(self):\n4944.         """\n4945.         Can reference a reverse OneToOneField in ModelAdmin.readonly_fields.\n4946.         """\n4947.         v1 = Villain.objects.create(name=\'Adam\')\n4948.         pl = Plot.objects.create(name=\'Test Plot\', team_leader=v1, contact=v1)\n4949.         pd = PlotDetails.objects.create(details=\'Brand New Plot\', plot=pl)\n4950. \n4951.         response = self.client.get(reverse(\'admin:admin_views_plotproxy_change\', args=(pl.pk,)))\n4952.         field = self.get_admin_readonly_field(response, \'plotdetails\')\n4953.         self.assertEqual(field.contents(), \'Brand New Plot\')\n4954. \n4955.         # The reverse relation also works if the OneToOneField is null.\n4956.         pd.plot = None\n4957.         pd.save()\n4958. \n4959.         response = self.client.get(reverse(\'admin:admin_views_plotproxy_change\', args=(pl.pk,)))\n4960.         field = self.get_admin_readonly_field(response, \'plotdetails\')\n4961.         self.assertEqual(field.contents(), \'-\')  # default empty value\n4962. \n4963.     def test_readonly_field_overrides(self):\n4964.         """\n4965.         Regression test for #22087 - ModelForm Meta overrides are ignored by\n4966.         AdminReadonlyField\n4967.         """\n4968.         p = FieldOverridePost.objects.create(title="Test Post", content="Test Content")\n4969.         response = self.client.get(reverse(\'admin:admin_views_fieldoverridepost_change\', args=(p.pk,)))\n4970.         self.assertContains(response, \'<div class="help">Overridden help text for the date</div>\')\n4971.         self.assertContains(response, \'<label for="id_public">Overridden public label:</label>\', html=True)\n4972.         self.assertNotContains(response, "Some help text for the date (with unicode ŠĐĆŽćžšđ)")\n4973. \n4974.     def test_correct_autoescaping(self):\n4975.         """\n4976.         Make sure that non-field readonly elements are properly autoescaped (#24461)\n4977.         """\n4978.         section = Section.objects.create(name=\'<a>evil</a>\')\n4979.         response = self.client.get(reverse(\'admin:admin_views_section_change\', args=(section.pk,)))\n4980.         self.assertNotContains(response, "<a>evil</a>", status_code=200)\n4981.         self.assertContains(response, "&lt;a&gt;evil&lt;/a&gt;", status_code=200)\n4982. \n4983.     def test_label_suffix_translated(self):\n4984.         pizza = Pizza.objects.create(name=\'Americano\')\n4985.         url = reverse(\'admin:admin_views_pizza_change\', args=(pizza.pk,))\n4986.         with self.settings(LANGUAGE_CODE=\'fr\'):\n4987.             response = self.client.get(url)\n4988.         self.assertContains(response, \'<label>Toppings\\u00A0:</label>\', html=True)\n4989. \n4990. ', start_line_number=4815, end_line_number=4990), Context(relative_path='tests/admin_views/tests.py', content='3631. class AdminCustomQuerysetTest(TestCase):\n3632. \n3633.     @classmethod\n3634.     def setUpTestData(cls):\n3635.         cls.superuser = User.objects.create_superuser(username=\'super\', password=\'secret\', email=\'super@example.com\')\n3636.         cls.pks = [EmptyModel.objects.create().id for i in range(3)]\n3637. \n3638.     def setUp(self):\n3639.         self.client.force_login(self.superuser)\n3640.         self.super_login = {\n3641.             REDIRECT_FIELD_NAME: reverse(\'admin:index\'),\n3642.             \'username\': \'super\',\n3643.             \'password\': \'secret\',\n3644.         }\n3645. \n3646.     def test_changelist_view(self):\n3647.         response = self.client.get(reverse(\'admin:admin_views_emptymodel_changelist\'))\n3648.         for i in self.pks:\n3649.             if i > 1:\n3650.                 self.assertContains(response, \'Primary key = %s\' % i)\n3651.             else:\n3652.                 self.assertNotContains(response, \'Primary key = %s\' % i)\n3653. \n3654.     def test_changelist_view_count_queries(self):\n3655.         # create 2 Person objects\n3656.         Person.objects.create(name=\'person1\', gender=1)\n3657.         Person.objects.create(name=\'person2\', gender=2)\n3658.         changelist_url = reverse(\'admin:admin_views_person_changelist\')\n3659. \n3660.         # 5 queries are expected: 1 for the session, 1 for the user,\n3661.         # 2 for the counts and 1 for the objects on the page\n3662.         with self.assertNumQueries(5):\n3663.             resp = self.client.get(changelist_url)\n3664.             self.assertEqual(resp.context[\'selection_note\'], \'0 of 2 selected\')\n3665.             self.assertEqual(resp.context[\'selection_note_all\'], \'All 2 selected\')\n3666.         with self.assertNumQueries(5):\n3667.             extra = {\'q\': \'not_in_name\'}\n3668.             resp = self.client.get(changelist_url, extra)\n3669.             self.assertEqual(resp.context[\'selection_note\'], \'0 of 0 selected\')\n3670.             self.assertEqual(resp.context[\'selection_note_all\'], \'All 0 selected\')\n3671.         with self.assertNumQueries(5):\n3672.             extra = {\'q\': \'person\'}\n3673.             resp = self.client.get(changelist_url, extra)\n3674.             self.assertEqual(resp.context[\'selection_note\'], \'0 of 2 selected\')\n3675.             self.assertEqual(resp.context[\'selection_note_all\'], \'All 2 selected\')\n3676.         with self.assertNumQueries(5):\n3677.             extra = {\'gender__exact\': \'1\'}\n3678.             resp = self.client.get(changelist_url, extra)\n3679.             self.assertEqual(resp.context[\'selection_note\'], \'0 of 1 selected\')\n3680.             self.assertEqual(resp.context[\'selection_note_all\'], \'1 selected\')\n3681. \n3682.     def test_change_view(self):\n3683.         for i in self.pks:\n3684.             url = reverse(\'admin:admin_views_emptymodel_change\', args=(i,))\n3685.             response = self.client.get(url, follow=True)\n3686.             if i > 1:\n3687.                 self.assertEqual(response.status_code, 200)\n3688.             else:\n3689.                 self.assertRedirects(response, reverse(\'admin:index\'))\n3690.                 self.assertEqual(\n3691.                     [m.message for m in response.context[\'messages\']],\n3692.                     ["""empty model with ID "1" doesn\'t exist. Perhaps it was deleted?"""]\n3693.                 )\n3694. \n3695.     def test_add_model_modeladmin_defer_qs(self):\n3696.         # Test for #14529. defer() is used in ModelAdmin.get_queryset()\n3697. \n3698.         # model has __str__ method\n3699.         self.assertEqual(CoverLetter.objects.count(), 0)\n3700.         # Emulate model instance creation via the admin\n3701.         post_data = {\n3702.             "author": "Candidate, Best",\n3703.             "_save": "Save",\n3704.         }\n3705.         response = self.client.post(reverse(\'admin:admin_views_coverletter_add\'), post_data, follow=True)\n3706.         self.assertEqual(response.status_code, 200)\n3707.         self.assertEqual(CoverLetter.objects.count(), 1)\n3708.         # Message should contain non-ugly model verbose name\n3709.         pk = CoverLetter.objects.all()[0].pk\n3710.         self.assertContains(\n3711.             response,\n3712.             \'<li class="success">The cover letter "<a href="%s">\'\n3713.             \'Candidate, Best</a>" was added successfully.</li>\' %\n3714.             reverse(\'admin:admin_views_coverletter_change\', args=(pk,)), html=True\n3715.         )\n3716. \n3717.         # model has no __str__ method\n3718.         self.assertEqual(ShortMessage.objects.count(), 0)\n3719.         # Emulate model instance creation via the admin\n3720.         post_data = {\n3721.             "content": "What\'s this SMS thing?",\n3722.             "_save": "Save",\n3723.         }\n3724.         response = self.client.post(reverse(\'admin:admin_views_shortmessage_add\'), post_data, follow=True)\n3725.         self.assertEqual(response.status_code, 200)\n3726.         self.assertEqual(ShortMessage.objects.count(), 1)\n3727.         # Message should contain non-ugly model verbose name\n3728.         sm = ShortMessage.objects.all()[0]\n3729.         self.assertContains(\n3730.             response,\n3731.             \'<li class="success">The short message "<a href="%s">\'\n3732.             \'%s</a>" was added successfully.</li>\' %\n3733.             (reverse(\'admin:admin_views_shortmessage_change\', args=(sm.pk,)), sm), html=True\n3734.         )\n3735. \n3736.     def test_add_model_modeladmin_only_qs(self):\n3737.         # Test for #14529. only() is used in ModelAdmin.get_queryset()\n3738. \n3739.         # model has __str__ method\n3740.         self.assertEqual(Telegram.objects.count(), 0)\n3741.         # Emulate model instance creation via the admin\n3742.         post_data = {\n3743.             "title": "Urgent telegram",\n3744.             "_save": "Save",\n3745.         }\n3746.         response = self.client.post(reverse(\'admin:admin_views_telegram_add\'), post_data, follow=True)\n3747.         self.assertEqual(response.status_code, 200)\n3748.         self.assertEqual(Telegram.objects.count(), 1)\n3749.         # Message should contain non-ugly model verbose name\n3750.         pk = Telegram.objects.all()[0].pk\n3751.         self.assertContains(\n3752.             response,\n3753.             \'<li class="success">The telegram "<a href="%s">\'\n3754.             \'Urgent telegram</a>" was added successfully.</li>\' %\n3755.             reverse(\'admin:admin_views_telegram_change\', args=(pk,)), html=True\n3756.         )\n3757. \n3758.         # model has no __str__ method\n3759.         self.assertEqual(Paper.objects.count(), 0)\n3760.         # Emulate model instance creation via the admin\n3761.         post_data = {\n3762.             "title": "My Modified Paper Title",\n3763.             "_save": "Save",\n3764.         }\n3765.         response = self.client.post(reverse(\'admin:admin_views_paper_add\'), post_data, follow=True)\n3766.         self.assertEqual(response.status_code, 200)\n3767.         self.assertEqual(Paper.objects.count(), 1)\n3768.         # Message should contain non-ugly model verbose name\n3769.         p = Paper.objects.all()[0]\n3770.         self.assertContains(\n3771.             response,\n3772.             \'<li class="success">The paper "<a href="%s">\'\n3773.             \'%s</a>" was added successfully.</li>\' %\n3774.             (reverse(\'admin:admin_views_paper_change\', args=(p.pk,)), p), html=True\n3775.         )\n3776. \n3777.     def test_edit_model_modeladmin_defer_qs(self):\n3778.         # Test for #14529. defer() is used in ModelAdmin.get_queryset()\n3779. \n3780.         # model has __str__ method\n3781.         cl = CoverLetter.objects.create(author="John Doe")\n3782.         self.assertEqual(CoverLetter.objects.count(), 1)\n3783.         response = self.client.get(reverse(\'admin:admin_views_coverletter_change\', args=(cl.pk,)))\n3784.         self.assertEqual(response.status_code, 200)\n3785.         # Emulate model instance edit via the admin\n3786.         post_data = {\n3787.             "author": "John Doe II",\n3788.             "_save": "Save",\n3789.         }\n3790.         url = reverse(\'admin:admin_views_coverletter_change\', args=(cl.pk,))\n3791.         response = self.client.post(url, post_data, follow=True)\n3792.         self.assertEqual(response.status_code, 200)\n3793.         self.assertEqual(CoverLetter.objects.count(), 1)\n3794.         # Message should contain non-ugly model verbose name. Instance\n3795.         # representation is set by model\'s __str__()\n3796.         self.assertContains(\n3797.             response,\n3798.             \'<li class="success">The cover letter "<a href="%s">\'\n3799.             \'John Doe II</a>" was changed successfully.</li>\' %\n3800.             reverse(\'admin:admin_views_coverletter_change\', args=(cl.pk,)), html=True\n3801.         )\n3802. \n3803.         # model has no __str__ method\n3804.         sm = ShortMessage.objects.create(content="This is expensive")\n3805.         self.assertEqual(ShortMessage.objects.count(), 1)\n3806.         response = self.client.get(reverse(\'admin:admin_views_shortmessage_change\', args=(sm.pk,)))\n3807.         self.assertEqual(response.status_code, 200)\n3808.         # Emulate model instance edit via the admin\n3809.         post_data = {\n3810.             "content": "Too expensive",\n3811.             "_save": "Save",\n3812.         }\n3813.         url = reverse(\'admin:admin_views_shortmessage_change\', args=(sm.pk,))\n3814.         response = self.client.post(url, post_data, follow=True)\n3815.         self.assertEqual(response.status_code, 200)\n3816.         self.assertEqual(ShortMessage.objects.count(), 1)\n3817.         # Message should contain non-ugly model verbose name. The ugly(!)\n3818.         # instance representation is set by __str__().\n3819.         self.assertContains(\n3820.             response,\n3821.             \'<li class="success">The short message "<a href="%s">\'\n3822.             \'%s</a>" was changed successfully.</li>\' %\n3823.             (reverse(\'admin:admin_views_shortmessage_change\', args=(sm.pk,)), sm), html=True\n3824.         )\n3825. \n3826.     def test_edit_model_modeladmin_only_qs(self):\n3827.         # Test for #14529. only() is used in ModelAdmin.get_queryset()\n3828. \n3829.         # model has __str__ method\n3830.         t = Telegram.objects.create(title="First Telegram")\n3831.         self.assertEqual(Telegram.objects.count(), 1)\n3832.         response = self.client.get(reverse(\'admin:admin_views_telegram_change\', args=(t.pk,)))\n3833.         self.assertEqual(response.status_code, 200)\n3834.         # Emulate model instance edit via the admin\n3835.         post_data = {\n3836.             "title": "Telegram without typo",\n3837.             "_save": "Save",\n3838.         }\n3839.         response = self.client.post(reverse(\'admin:admin_views_telegram_change\', args=(t.pk,)), post_data, follow=True)\n3840.         self.assertEqual(response.status_code, 200)\n3841.         self.assertEqual(Telegram.objects.count(), 1)\n3842.         # Message should contain non-ugly model verbose name. The instance\n3843.         # representation is set by model\'s __str__()\n3844.         self.assertContains(\n3845.             response,\n3846.             \'<li class="success">The telegram "<a href="%s">\'\n3847.             \'Telegram without typo</a>" was changed successfully.</li>\' %\n3848.             reverse(\'admin:admin_views_telegram_change\', args=(t.pk,)), html=True\n3849.         )\n3850. \n3851.         # model has no __str__ method\n3852.         p = Paper.objects.create(title="My Paper Title")\n3853.         self.assertEqual(Paper.objects.count(), 1)\n3854.         response = self.client.get(reverse(\'admin:admin_views_paper_change\', args=(p.pk,)))\n3855.         self.assertEqual(response.status_code, 200)\n3856.         # Emulate model instance edit via the admin\n3857.         post_data = {\n3858.             "title": "My Modified Paper Title",\n3859.             "_save": "Save",\n3860.         }\n3861.         response = self.client.post(reverse(\'admin:admin_views_paper_change\', args=(p.pk,)), post_data, follow=True)\n3862.         self.assertEqual(response.status_code, 200)\n3863.         self.assertEqual(Paper.objects.count(), 1)\n3864.         # Message should contain non-ugly model verbose name. The ugly(!)\n3865.         # instance representation is set by __str__().\n3866.         self.assertContains(\n3867.             response,\n3868.             \'<li class="success">The paper "<a href="%s">\'\n3869.             \'%s</a>" was changed successfully.</li>\' %\n3870.             (reverse(\'admin:admin_views_paper_change\', args=(p.pk,)), p), html=True\n3871.         )\n3872. \n3873.     def test_history_view_custom_qs(self):\n3874.         """\n3875.         Custom querysets are considered for the admin history view.\n3876.         """\n3877.         self.client.post(reverse(\'admin:login\'), self.super_login)\n3878.         FilteredManager.objects.create(pk=1)\n3879.         FilteredManager.objects.create(pk=2)\n3880.         response = self.client.get(reverse(\'admin:admin_views_filteredmanager_changelist\'))\n3881.         self.assertContains(response, "PK=1")\n3882.         self.assertContains(response, "PK=2")\n3883.         self.assertEqual(\n3884.             self.client.get(reverse(\'admin:admin_views_filteredmanager_history\', args=(1,))).status_code, 200\n3885.         )\n3886.         self.assertEqual(\n3887.             self.client.get(reverse(\'admin:admin_views_filteredmanager_history\', args=(2,))).status_code, 200\n3888.         )\n3889. \n3890. ', start_line_number=3631, end_line_number=3890), Context(relative_path='tests/admin_views/tests.py', content='1138. @override_settings(ROOT_URLCONF=\'admin_views.urls\')\n1139. class AdminViewFormUrlTest(TestCase):\n1140.     current_app = "admin3"\n1141. \n1142.     @classmethod\n1143.     def setUpTestData(cls):\n1144.         cls.superuser = User.objects.create_superuser(username=\'super\', password=\'secret\', email=\'super@example.com\')\n1145.         cls.s1 = Section.objects.create(name=\'Test section\')\n1146.         cls.a1 = Article.objects.create(\n1147.             content=\'<p>Middle content</p>\', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1\n1148.         )\n1149.         cls.a2 = Article.objects.create(\n1150.             content=\'<p>Oldest content</p>\', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1\n1151.         )\n1152.         cls.a3 = Article.objects.create(\n1153.             content=\'<p>Newest content</p>\', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1\n1154.         )\n1155.         cls.p1 = PrePopulatedPost.objects.create(title=\'A Long Title\', published=True, slug=\'a-long-title\')\n1156. \n1157.     def setUp(self):\n1158.         self.client.force_login(self.superuser)\n1159. \n1160.     def test_change_form_URL_has_correct_value(self):\n1161.         """\n1162.         change_view has form_url in response.context\n1163.         """\n1164.         response = self.client.get(\n1165.             reverse(\'admin:admin_views_section_change\', args=(self.s1.pk,), current_app=self.current_app)\n1166.         )\n1167.         self.assertIn(\'form_url\', response.context, msg=\'form_url not present in response.context\')\n1168.         self.assertEqual(response.context[\'form_url\'], \'pony\')\n1169. \n1170.     def test_initial_data_can_be_overridden(self):\n1171.         """\n1172.         The behavior for setting initial form data can be overridden in the\n1173.         ModelAdmin class. Usually, the initial value is set via the GET params.\n1174.         """\n1175.         response = self.client.get(\n1176.             reverse(\'admin:admin_views_restaurant_add\', current_app=self.current_app),\n1177.             {\'name\': \'test_value\'}\n1178.         )\n1179.         # this would be the usual behaviour\n1180.         self.assertNotContains(response, \'value="test_value"\')\n1181.         # this is the overridden behaviour\n1182.         self.assertContains(response, \'value="overridden_value"\')\n1183. ', start_line_number=1138, end_line_number=1183), Context(relative_path='tests/admin_views/tests.py', content='3587. class TestCustomChangeList(TestCase):\n3588. \n3589.     @classmethod\n3590.     def setUpTestData(cls):\n3591.         cls.superuser = User.objects.create_superuser(username=\'super\', password=\'secret\', email=\'super@example.com\')\n3592. \n3593.     def setUp(self):\n3594.         self.client.force_login(self.superuser)\n3595. \n3596.     def test_custom_changelist(self):\n3597.         """\n3598.         Validate that a custom ChangeList class can be used (#9749)\n3599.         """\n3600.         # Insert some data\n3601.         post_data = {"name": "First Gadget"}\n3602.         response = self.client.post(reverse(\'admin:admin_views_gadget_add\'), post_data)\n3603.         self.assertEqual(response.status_code, 302)  # redirect somewhere\n3604.         # Hit the page once to get messages out of the queue message list\n3605.         response = self.client.get(reverse(\'admin:admin_views_gadget_changelist\'))\n3606.         # Data is still not visible on the page\n3607.         response = self.client.get(reverse(\'admin:admin_views_gadget_changelist\'))\n3608.         self.assertEqual(response.status_code, 200)\n3609.         self.assertNotContains(response, \'First Gadget\')\n3610. \n3611. ', start_line_number=3587, end_line_number=3611), Context(relative_path='tests/admin_views/tests.py', content='2501. @skipUnlessDBFeature(\'can_defer_constraint_checks\')\n2502. @override_settings(ROOT_URLCONF=\'admin_views.urls\')\n2503. class AdminViewDeletedObjectsTest(TestCase):\n2504. \n2505.     @classmethod\n2506.     def setUpTestData(cls):\n2507.         cls.superuser = User.objects.create_superuser(username=\'super\', password=\'secret\', email=\'super@example.com\')\n2508.         cls.deleteuser = User.objects.create_user(username=\'deleteuser\', password=\'secret\', is_staff=True)\n2509.         cls.s1 = Section.objects.create(name=\'Test section\')\n2510.         cls.a1 = Article.objects.create(\n2511.             content=\'<p>Middle content</p>\', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1\n2512.         )\n2513.         cls.a2 = Article.objects.create(\n2514.             content=\'<p>Oldest content</p>\', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1\n2515.         )\n2516.         cls.a3 = Article.objects.create(\n2517.             content=\'<p>Newest content</p>\', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1\n2518.         )\n2519.         cls.p1 = PrePopulatedPost.objects.create(title=\'A Long Title\', published=True, slug=\'a-long-title\')\n2520. \n2521.         cls.v1 = Villain.objects.create(name=\'Adam\')\n2522.         cls.v2 = Villain.objects.create(name=\'Sue\')\n2523.         cls.sv1 = SuperVillain.objects.create(name=\'Bob\')\n2524.         cls.pl1 = Plot.objects.create(name=\'World Domination\', team_leader=cls.v1, contact=cls.v2)\n2525.         cls.pl2 = Plot.objects.create(name=\'World Peace\', team_leader=cls.v2, contact=cls.v2)\n2526.         cls.pl3 = Plot.objects.create(name=\'Corn Conspiracy\', team_leader=cls.v1, contact=cls.v1)\n2527.         cls.pd1 = PlotDetails.objects.create(details=\'almost finished\', plot=cls.pl1)\n2528.         cls.sh1 = SecretHideout.objects.create(location=\'underground bunker\', villain=cls.v1)\n2529.         cls.sh2 = SecretHideout.objects.create(location=\'floating castle\', villain=cls.sv1)\n2530.         cls.ssh1 = SuperSecretHideout.objects.create(location=\'super floating castle!\', supervillain=cls.sv1)\n2531.         cls.cy1 = CyclicOne.objects.create(name=\'I am recursive\', two_id=1)\n2532.         cls.cy2 = CyclicTwo.objects.create(name=\'I am recursive too\', one_id=1)\n2533. \n2534.     def setUp(self):\n2535.         self.client.force_login(self.superuser)\n2536. \n2537.     def test_nesting(self):\n2538.         """\n2539.         Objects should be nested to display the relationships that\n2540.         cause them to be scheduled for deletion.\n2541.         """\n2542.         pattern = re.compile(\n2543.             r\'<li>Plot: <a href="%s">World Domination</a>\\s*<ul>\\s*\'\n2544.             r\'<li>Plot details: <a href="%s">almost finished</a>\' % (\n2545.                 reverse(\'admin:admin_views_plot_change\', args=(self.pl1.pk,)),\n2546.                 reverse(\'admin:admin_views_plotdetails_change\', args=(self.pd1.pk,)),\n2547.             )\n2548.         )\n2549.         response = self.client.get(reverse(\'admin:admin_views_villain_delete\', args=(self.v1.pk,)))\n2550.         self.assertRegex(response.content.decode(), pattern)\n2551. \n2552.     def test_cyclic(self):\n2553.         """\n2554.         Cyclic relationships should still cause each object to only be\n2555.         listed once.\n2556.         """\n2557.         one = \'<li>Cyclic one: <a href="%s">I am recursive</a>\' % (\n2558.             reverse(\'admin:admin_views_cyclicone_change\', args=(self.cy1.pk,)),\n2559.         )\n2560.         two = \'<li>Cyclic two: <a href="%s">I am recursive too</a>\' % (\n2561.             reverse(\'admin:admin_views_cyclictwo_change\', args=(self.cy2.pk,)),\n2562.         )\n2563.         response = self.client.get(reverse(\'admin:admin_views_cyclicone_delete\', args=(self.cy1.pk,)))\n2564. \n2565.         self.assertContains(response, one, 1)\n2566.         self.assertContains(response, two, 1)\n2567. \n2568.     def test_perms_needed(self):\n2569.         self.client.logout()\n2570.         delete_user = User.objects.get(username=\'deleteuser\')\n2571.         delete_user.user_permissions.add(get_perm(Plot, get_permission_codename(\'delete\', Plot._meta)))\n2572. \n2573.         self.client.force_login(self.deleteuser)\n2574.         response = self.client.get(reverse(\'admin:admin_views_plot_delete\', args=(self.pl1.pk,)))\n2575.         self.assertContains(response, "your account doesn\'t have permission to delete the following types of objects")\n2576.         self.assertContains(response, "<li>plot details</li>")\n2577. \n2578.     def test_protected(self):\n2579.         q = Question.objects.create(question="Why?")\n2580.         a1 = Answer.objects.create(question=q, answer="Because.")\n2581.         a2 = Answer.objects.create(question=q, answer="Yes.")\n2582. \n2583.         response = self.client.get(reverse(\'admin:admin_views_question_delete\', args=(q.pk,)))\n2584.         self.assertContains(response, "would require deleting the following protected related objects")\n2585.         self.assertContains(\n2586.             response,\n2587.             \'<li>Answer: <a href="%s">Because.</a></li>\' % reverse(\'admin:admin_views_answer_change\', args=(a1.pk,))\n2588.         )\n2589.         self.assertContains(\n2590.             response,\n2591.             \'<li>Answer: <a href="%s">Yes.</a></li>\' % reverse(\'admin:admin_views_answer_change\', args=(a2.pk,))\n2592.         )\n2593. \n2594.     def test_post_delete_protected(self):\n2595.         """\n2596.         A POST request to delete protected objects should display the page\n2597.         which says the deletion is prohibited.\n2598.         """\n2599.         q = Question.objects.create(question=\'Why?\')\n2600.         Answer.objects.create(question=q, answer=\'Because.\')\n2601. \n2602.         response = self.client.post(reverse(\'admin:admin_views_question_delete\', args=(q.pk,)), {\'post\': \'yes\'})\n2603.         self.assertEqual(Question.objects.count(), 1)\n2604.         self.assertContains(response, "would require deleting the following protected related objects")\n2605. \n2606.     def test_not_registered(self):\n2607.         should_contain = """<li>Secret hideout: underground bunker"""\n2608.         response = self.client.get(reverse(\'admin:admin_views_villain_delete\', args=(self.v1.pk,)))\n2609.         self.assertContains(response, should_contain, 1)\n2610. \n2611.     def test_multiple_fkeys_to_same_model(self):\n2612.         """\n2613.         If a deleted object has two relationships from another model,\n2614.         both of those should be followed in looking for related\n2615.         objects to delete.\n2616.         """\n2617.         should_contain = \'<li>Plot: <a href="%s">World Domination</a>\' % reverse(\n2618.             \'admin:admin_views_plot_change\', args=(self.pl1.pk,)\n2619.         )\n2620.         response = self.client.get(reverse(\'admin:admin_views_villain_delete\', args=(self.v1.pk,)))\n2621.         self.assertContains(response, should_contain)\n2622.         response = self.client.get(reverse(\'admin:admin_views_villain_delete\', args=(self.v2.pk,)))\n2623.         self.assertContains(response, should_contain)\n2624. \n2625.     def test_multiple_fkeys_to_same_instance(self):\n2626.         """\n2627.         If a deleted object has two relationships pointing to it from\n2628.         another object, the other object should still only be listed\n2629.         once.\n2630.         """\n2631.         should_contain = \'<li>Plot: <a href="%s">World Peace</a></li>\' % reverse(\n2632.             \'admin:admin_views_plot_change\', args=(self.pl2.pk,)\n2633.         )\n2634.         response = self.client.get(reverse(\'admin:admin_views_villain_delete\', args=(self.v2.pk,)))\n2635.         self.assertContains(response, should_contain, 1)\n2636. \n2637.     def test_inheritance(self):\n2638.         """\n2639.         In the case of an inherited model, if either the child or\n2640.         parent-model instance is deleted, both instances are listed\n2641.         for deletion, as well as any relationships they have.\n2642.         """\n2643.         should_contain = [\n2644.             \'<li>Villain: <a href="%s">Bob</a>\' % reverse(\'admin:admin_views_villain_change\', args=(self.sv1.pk,)),\n2645.             \'<li>Super villain: <a href="%s">Bob</a>\' % reverse(\n2646.                 \'admin:admin_views_supervillain_change\', args=(self.sv1.pk,)\n2647.             ),\n2648.             \'<li>Secret hideout: floating castle\',\n2649.             \'<li>Super secret hideout: super floating castle!\',\n2650.         ]\n2651.         response = self.client.get(reverse(\'admin:admin_views_villain_delete\', args=(self.sv1.pk,)))\n2652.         for should in should_contain:\n2653.             self.assertContains(response, should, 1)\n2654.         response = self.client.get(reverse(\'admin:admin_views_supervillain_delete\', args=(self.sv1.pk,)))\n2655.         for should in should_contain:\n2656.             self.assertContains(response, should, 1)\n2657. \n2658.     def test_generic_relations(self):\n2659.         """\n2660.         If a deleted object has GenericForeignKeys pointing to it,\n2661.         those objects should be listed for deletion.\n2662.         """\n2663.         plot = self.pl3\n2664.         tag = FunkyTag.objects.create(content_object=plot, name=\'hott\')\n2665.         should_contain = \'<li>Funky tag: <a href="%s">hott\' % reverse(\n2666.             \'admin:admin_views_funkytag_change\', args=(tag.id,))\n2667.         response = self.client.get(reverse(\'admin:admin_views_plot_delete\', args=(plot.pk,)))\n2668.         self.assertContains(response, should_contain)\n2669. \n2670.     def test_generic_relations_with_related_query_name(self):\n2671.         """\n2672.         If a deleted object has GenericForeignKey with\n2673.         GenericRelation(related_query_name=\'...\') pointing to it, those objects\n2674.         should be listed for deletion.\n2675.         """\n2676.         bookmark = Bookmark.objects.create(name=\'djangoproject\')\n2677.         tag = FunkyTag.objects.create(content_object=bookmark, name=\'django\')\n2678.         tag_url = reverse(\'admin:admin_views_funkytag_change\', args=(tag.id,))\n2679.         should_contain = \'<li>Funky tag: <a href="%s">django\' % tag_url\n2680.         response = self.client.get(reverse(\'admin:admin_views_bookmark_delete\', args=(bookmark.pk,)))\n2681.         self.assertContains(response, should_contain)\n2682. \n2683.     def test_delete_view_uses_get_deleted_objects(self):\n2684.         """The delete view uses ModelAdmin.get_deleted_objects()."""\n2685.         book = Book.objects.create(name=\'Test Book\')\n2686.         response = self.client.get(reverse(\'admin2:admin_views_book_delete\', args=(book.pk,)))\n2687.         # BookAdmin.get_deleted_objects() returns custom text.\n2688.         self.assertContains(response, \'a deletable object\')\n2689. \n2690. ', start_line_number=2501, end_line_number=2690), Context(relative_path='tests/admin_inlines/admin.py', content='1. from django import forms\n2. from django.contrib import admin\n3. from django.db import models\n4. \n5. from .models import (\n6.     Author, BinaryTree, CapoFamiglia, Chapter, ChildModel1, ChildModel2,\n7.     Consigliere, EditablePKBook, ExtraTerrestrial, Fashionista, Holder,\n8.     Holder2, Holder3, Holder4, Inner, Inner2, Inner3, Inner4Stacked,\n9.     Inner4Tabular, NonAutoPKBook, NonAutoPKBookChild, Novel,\n10.     NovelReadonlyChapter, ParentModelWithCustomPk, Poll, Profile,\n11.     ProfileCollection, Question, ReadOnlyInline, ShoppingWeakness, Sighting,\n12.     SomeChildModel, SomeParentModel, SottoCapo, Title, TitleCollection,\n13. )\n14. \n15. site = admin.AdminSite(name="admin")\n16. \n17. \n18. class BookInline(admin.TabularInline):\n19.     model = Author.books.through\n20. \n21. \n22. class NonAutoPKBookTabularInline(admin.TabularInline):\n23.     model = NonAutoPKBook\n24.     classes = (\'collapse\',)\n25. \n26. \n27. class NonAutoPKBookChildTabularInline(admin.TabularInline):\n28.     model = NonAutoPKBookChild\n29.     classes = (\'collapse\',)\n30. \n31. \n32. class NonAutoPKBookStackedInline(admin.StackedInline):\n33.     model = NonAutoPKBook\n34.     classes = (\'collapse\',)\n35. \n36. \n37. class EditablePKBookTabularInline(admin.TabularInline):\n38.     model = EditablePKBook\n39. \n40. \n41. class EditablePKBookStackedInline(admin.StackedInline):\n42.     model = EditablePKBook\n43. \n44. \n45. class AuthorAdmin(admin.ModelAdmin):\n46.     inlines = [\n47.         BookInline, NonAutoPKBookTabularInline, NonAutoPKBookStackedInline,\n48.         EditablePKBookTabularInline, EditablePKBookStackedInline,\n49.         NonAutoPKBookChildTabularInline,\n50.     ]\n51. \n52. \n53. class InnerInline(admin.StackedInline):\n54.     model = Inner\n55.     can_delete = False\n56.     readonly_fields = (\'readonly\',)  # For bug #13174 tests.\n57. \n58. \n59. class HolderAdmin(admin.ModelAdmin):\n60. \n61.     class Media:\n62.         js = (\'my_awesome_admin_scripts.js\',)\n63. \n64. \n65. class ReadOnlyInlineInline(admin.TabularInline):\n66.     model = ReadOnlyInline\n67.     readonly_fields = [\'name\']\n68. \n69. \n70. class InnerInline2(admin.StackedInline):\n71.     model = Inner2\n72. \n73.     class Media:\n74.         js = (\'my_awesome_inline_scripts.js\',)\n75. \n76. \n77. class InnerInline2Tabular(admin.TabularInline):\n78.     model = Inner2\n79. \n80. \n81. class CustomNumberWidget(forms.NumberInput):\n82.     class Media:\n83.         js = (\'custom_number.js\',)\n84. \n85. \n86. class InnerInline3(admin.StackedInline):\n87.     model = Inner3\n88.     formfield_overrides = {\n89.         models.IntegerField: {\'widget\': CustomNumberWidget},\n90.     }\n91. \n92.     class Media:\n93.         js = (\'my_awesome_inline_scripts.js\',)\n94. \n95. \n96. class TitleForm(forms.ModelForm):\n97.     title1 = forms.CharField(max_length=100)\n98. \n99.     def clean(self):\n100.         cleaned_data = self.cleaned_data\n101.         title1 = cleaned_data.get("title1")\n102.         title2 = cleaned_data.get("title2")\n103.         if title1 != title2:\n104.             raise forms.ValidationError("The two titles must be the same")\n105.         return cleaned_data\n106. \n107. \n108. class TitleInline(admin.TabularInline):\n109.     model = Title\n110.     form = TitleForm\n111.     extra = 1\n112. \n113. \n114. class Inner4StackedInline(admin.StackedInline):\n115.     model = Inner4Stacked\n116.     show_change_link = True\n117. \n118. \n119. class Inner4TabularInline(admin.TabularInline):\n120.     model = Inner4Tabular\n121.     show_change_link = True\n122. \n123. \n124. class Holder4Admin(admin.ModelAdmin):\n125.     inlines = [Inner4StackedInline, Inner4TabularInline]\n126. \n127. \n128. class InlineWeakness(admin.TabularInline):\n129.     model = ShoppingWeakness\n130.     extra = 1\n131. \n132. \n133. class QuestionInline(admin.TabularInline):\n134.     model = Question\n135.     readonly_fields = [\'call_me\']\n136. \n137.     def call_me(self, obj):\n138.         return \'Callable in QuestionInline\'\n139. \n140. \n141. class PollAdmin(admin.ModelAdmin):\n142.     inlines = [QuestionInline]\n143. \n144.     def call_me(self, obj):\n145.         return \'Callable in PollAdmin\'\n146. \n147. \n148. class ChapterInline(admin.TabularInline):\n149.     model = Chapter\n150.     readonly_fields = [\'call_me\']\n151. \n152.     def call_me(self, obj):\n153.         return \'Callable in ChapterInline\'\n154. \n155. \n156. class NovelAdmin(admin.ModelAdmin):\n157.     inlines = [ChapterInline]\n158. \n159. \n160. class ReadOnlyChapterInline(admin.TabularInline):\n161.     model = Chapter\n162. \n163.     def has_change_permission(self, request, obj=None):\n164.         return False\n165. \n166. \n167. class NovelReadonlyChapterAdmin(admin.ModelAdmin):\n168.     inlines = [ReadOnlyChapterInline]\n169. \n170. \n171. class ConsigliereInline(admin.TabularInline):\n172.     model = Consigliere\n173. \n174. \n175. class SottoCapoInline(admin.TabularInline):\n176.     model = SottoCapo\n177. \n178. \n179. class ProfileInline(admin.TabularInline):\n180.     model = Profile\n181.     extra = 1\n182. \n183. \n184. # admin for #18433\n185. class ChildModel1Inline(admin.TabularInline):\n186.     model = ChildModel1\n187. \n188. \n189. class ChildModel2Inline(admin.StackedInline):\n190.     model = ChildModel2\n191. \n192. \n193. # admin for #19425 and #18388\n194. class BinaryTreeAdmin(admin.TabularInline):\n195.     model = BinaryTree\n196. \n197.     def get_extra(self, request, obj=None, **kwargs):\n198.         extra = 2\n199.         if obj:\n200.             return extra - obj.binarytree_set.count()\n201.         return extra\n202. \n203.     def get_max_num(self, request, obj=None, **kwargs):\n204.         max_num = 3\n205.         if obj:\n206.             return max_num - obj.binarytree_set.count()\n207.         return max_num\n208. \n209. \n210. # admin for #19524\n211. class SightingInline(admin.TabularInline):\n212.     model = Sighting\n213. \n214. \n215. # admin and form for #18263\n216. class SomeChildModelForm(forms.ModelForm):\n217. \n218.     class Meta:\n219.         fields = \'__all__\'\n220.         model = SomeChildModel\n221.         widgets = {\n222.             \'position\': forms.HiddenInput,\n223.         }\n224.         labels = {\'readonly_field\': \'Label from ModelForm.Meta\'}\n225.         help_texts = {\'readonly_field\': \'Help text from ModelForm.Meta\'}\n226. \n227.     def __init__(self, *args, **kwargs):\n228.         super().__init__(*args, **kwargs)\n229.         self.fields[\'name\'].label = \'new label\'\n230. \n231. \n232. class SomeChildModelInline(admin.TabularInline):\n233.     model = SomeChildModel\n234.     form = SomeChildModelForm\n235.     readonly_fields = (\'readonly_field\',)\n236. \n237. \n238. site.register(TitleCollection, inlines=[TitleInline])\n239. # Test bug #12561 and #12778\n240. # only ModelAdmin media\n241. site.register(Holder, HolderAdmin, inlines=[InnerInline])\n242. # ModelAdmin and Inline media\n243. site.register(Holder2, HolderAdmin, inlines=[InnerInline2, InnerInline2Tabular])\n244. # only Inline media\n245. site.register(Holder3, inlines=[InnerInline3])\n246. \n247. site.register(Poll, PollAdmin)\n248. site.register(Novel, NovelAdmin)\n249. site.register(NovelReadonlyChapter, NovelReadonlyChapterAdmin)\n250. site.register(Fashionista, inlines=[InlineWeakness])\n251. site.register(Holder4, Holder4Admin)\n252. site.register(Author, AuthorAdmin)\n253. site.register(CapoFamiglia, inlines=[ConsigliereInline, SottoCapoInline, ReadOnlyInlineInline])\n254. site.register(ProfileCollection, inlines=[ProfileInline])\n255. site.register(ParentModelWithCustomPk, inlines=[ChildModel1Inline, ChildModel2Inline])\n256. site.register(BinaryTree, inlines=[BinaryTreeAdmin])\n257. site.register(ExtraTerrestrial, inlines=[SightingInline])\n258. site.register(SomeParentModel, inlines=[SomeChildModelInline])\n259. site.register([Question, Inner4Stacked, Inner4Tabular])', start_line_number=1, end_line_number=259), Context(relative_path='tests/admin_inlines/tests.py', content='568. class TestInlinePermissions(TestCase):\n569.     """\n570.     Make sure the admin respects permissions for objects that are edited\n571.     inline. Refs #8060.\n572.     """\n573. \n574.     @classmethod\n575.     def setUpTestData(cls):\n576.         cls.user = User(username=\'admin\', is_staff=True, is_active=True)\n577.         cls.user.set_password(\'secret\')\n578.         cls.user.save()\n579. \n580.         cls.author_ct = ContentType.objects.get_for_model(Author)\n581.         cls.holder_ct = ContentType.objects.get_for_model(Holder2)\n582.         cls.book_ct = ContentType.objects.get_for_model(Book)\n583.         cls.inner_ct = ContentType.objects.get_for_model(Inner2)\n584. \n585.         # User always has permissions to add and change Authors, and Holders,\n586.         # the main (parent) models of the inlines. Permissions on the inlines\n587.         # vary per test.\n588.         permission = Permission.objects.get(codename=\'add_author\', content_type=cls.author_ct)\n589.         cls.user.user_permissions.add(permission)\n590.         permission = Permission.objects.get(codename=\'change_author\', content_type=cls.author_ct)\n591.         cls.user.user_permissions.add(permission)\n592.         permission = Permission.objects.get(codename=\'add_holder2\', content_type=cls.holder_ct)\n593.         cls.user.user_permissions.add(permission)\n594.         permission = Permission.objects.get(codename=\'change_holder2\', content_type=cls.holder_ct)\n595.         cls.user.user_permissions.add(permission)\n596. \n597.         author = Author.objects.create(pk=1, name=\'The Author\')\n598.         cls.book = author.books.create(name=\'The inline Book\')\n599.         cls.author_change_url = reverse(\'admin:admin_inlines_author_change\', args=(author.id,))\n600.         # Get the ID of the automatically created intermediate model for the Author-Book m2m\n601.         author_book_auto_m2m_intermediate = Author.books.through.objects.get(author=author, book=cls.book)\n602.         cls.author_book_auto_m2m_intermediate_id = author_book_auto_m2m_intermediate.pk\n603. \n604.         cls.holder = Holder2.objects.create(dummy=13)\n605.         cls.inner2 = Inner2.objects.create(dummy=42, holder=cls.holder)\n606. \n607.     def setUp(self):\n608.         self.holder_change_url = reverse(\'admin:admin_inlines_holder2_change\', args=(self.holder.id,))\n609.         self.client.force_login(self.user)\n610. \n611.     def test_inline_add_m2m_noperm(self):\n612.         response = self.client.get(reverse(\'admin:admin_inlines_author_add\'))\n613.         # No change permission on books, so no inline\n614.         self.assertNotContains(response, \'<h2>Author-book relationships</h2>\')\n615.         self.assertNotContains(response, \'Add another Author-Book Relationship\')\n616.         self.assertNotContains(response, \'id="id_Author_books-TOTAL_FORMS"\')\n617. \n618.     def test_inline_add_fk_noperm(self):\n619.         response = self.client.get(reverse(\'admin:admin_inlines_holder2_add\'))\n620.         # No permissions on Inner2s, so no inline\n621.         self.assertNotContains(response, \'<h2>Inner2s</h2>\')\n622.         self.assertNotContains(response, \'Add another Inner2\')\n623.         self.assertNotContains(response, \'id="id_inner2_set-TOTAL_FORMS"\')\n624. \n625.     def test_inline_change_m2m_noperm(self):\n626.         response = self.client.get(self.author_change_url)\n627.         # No change permission on books, so no inline\n628.         self.assertNotContains(response, \'<h2>Author-book relationships</h2>\')\n629.         self.assertNotContains(response, \'Add another Author-Book Relationship\')\n630.         self.assertNotContains(response, \'id="id_Author_books-TOTAL_FORMS"\')\n631. \n632.     def test_inline_change_fk_noperm(self):\n633.         response = self.client.get(self.holder_change_url)\n634.         # No permissions on Inner2s, so no inline\n635.         self.assertNotContains(response, \'<h2>Inner2s</h2>\')\n636.         self.assertNotContains(response, \'Add another Inner2\')\n637.         self.assertNotContains(response, \'id="id_inner2_set-TOTAL_FORMS"\')\n638. \n639.     def test_inline_add_m2m_view_only_perm(self):\n640.         permission = Permission.objects.get(codename=\'view_book\', content_type=self.book_ct)\n641.         self.user.user_permissions.add(permission)\n642.         response = self.client.get(reverse(\'admin:admin_inlines_author_add\'))\n643.         # View-only inlines. (It could be nicer to hide the empty, non-editable\n644.         # inlines on the add page.)\n645.         self.assertIs(response.context[\'inline_admin_formset\'].has_view_permission, True)\n646.         self.assertIs(response.context[\'inline_admin_formset\'].has_add_permission, False)\n647.         self.assertIs(response.context[\'inline_admin_formset\'].has_change_permission, False)\n648.         self.assertIs(response.context[\'inline_admin_formset\'].has_delete_permission, False)\n649.         self.assertContains(response, \'<h2>Author-book relationships</h2>\')\n650.         self.assertContains(\n651.             response,\n652.             \'<input type="hidden" name="Author_books-TOTAL_FORMS" value="0" \'\n653.             \'id="id_Author_books-TOTAL_FORMS">\',\n654.             html=True,\n655.         )\n656.         self.assertNotContains(response, \'Add another Author-Book Relationship\')\n657. \n658.     def test_inline_add_m2m_add_perm(self):\n659.         permission = Permission.objects.get(codename=\'add_book\', content_type=self.book_ct)\n660.         self.user.user_permissions.add(permission)\n661.         response = self.client.get(reverse(\'admin:admin_inlines_author_add\'))\n662.         # No change permission on Books, so no inline\n663.         self.assertNotContains(response, \'<h2>Author-book relationships</h2>\')\n664.         self.assertNotContains(response, \'Add another Author-Book Relationship\')\n665.         self.assertNotContains(response, \'id="id_Author_books-TOTAL_FORMS"\')\n666. \n667.     def test_inline_add_fk_add_perm(self):\n668.         permission = Permission.objects.get(codename=\'add_inner2\', content_type=self.inner_ct)\n669.         self.user.user_permissions.add(permission)\n670.         response = self.client.get(reverse(\'admin:admin_inlines_holder2_add\'))\n671.         # Add permission on inner2s, so we get the inline\n672.         self.assertContains(response, \'<h2>Inner2s</h2>\')\n673.         self.assertContains(response, \'Add another Inner2\')\n674.         self.assertContains(response, \'<input type="hidden" id="id_inner2_set-TOTAL_FORMS" \'\n675.                             \'value="3" name="inner2_set-TOTAL_FORMS">\', html=True)\n676. \n677.     def test_inline_change_m2m_add_perm(self):\n678.         permission = Permission.objects.get(codename=\'add_book\', content_type=self.book_ct)\n679.         self.user.user_permissions.add(permission)\n680.         response = self.client.get(self.author_change_url)\n681.         # No change permission on books, so no inline\n682.         self.assertNotContains(response, \'<h2>Author-book relationships</h2>\')\n683.         self.assertNotContains(response, \'Add another Author-Book Relationship\')\n684.         self.assertNotContains(response, \'id="id_Author_books-TOTAL_FORMS"\')\n685.         self.assertNotContains(response, \'id="id_Author_books-0-DELETE"\')\n686. \n687.     def test_inline_change_m2m_view_only_perm(self):\n688.         permission = Permission.objects.get(codename=\'view_book\', content_type=self.book_ct)\n689.         self.user.user_permissions.add(permission)\n690.         response = self.client.get(self.author_change_url)\n691.         # View-only inlines.\n692.         self.assertIs(response.context[\'inline_admin_formset\'].has_view_permission, True)\n693.         self.assertIs(response.context[\'inline_admin_formset\'].has_add_permission, False)\n694.         self.assertIs(response.context[\'inline_admin_formset\'].has_change_permission, False)\n695.         self.assertIs(response.context[\'inline_admin_formset\'].has_delete_permission, False)\n696.         self.assertContains(response, \'<h2>Author-book relationships</h2>\')\n697.         self.assertContains(\n698.             response,\n699.             \'<input type="hidden" name="Author_books-TOTAL_FORMS" value="1" \'\n700.             \'id="id_Author_books-TOTAL_FORMS">\',\n701.             html=True,\n702.         )\n703.         # The field in the inline is read-only.\n704.         self.assertContains(response, \'<p>%s</p>\' % self.book)\n705.         self.assertNotContains(\n706.             response,\n707.             \'<input type="checkbox" name="Author_books-0-DELETE" id="id_Author_books-0-DELETE">\',\n708.             html=True,\n709.         )\n710. \n711.     def test_inline_change_m2m_change_perm(self):\n712.         permission = Permission.objects.get(codename=\'change_book\', content_type=self.book_ct)\n713.         self.user.user_permissions.add(permission)\n714.         response = self.client.get(self.author_change_url)\n715.         # We have change perm on books, so we can add/change/delete inlines\n716.         self.assertIs(response.context[\'inline_admin_formset\'].has_view_permission, True)\n717.         self.assertIs(response.context[\'inline_admin_formset\'].has_add_permission, True)\n718.         self.assertIs(response.context[\'inline_admin_formset\'].has_change_permission, True)\n719.         self.assertIs(response.context[\'inline_admin_formset\'].has_delete_permission, True)\n720.         self.assertContains(response, \'<h2>Author-book relationships</h2>\')\n721.         self.assertContains(response, \'Add another Author-book relationship\')\n722.         self.assertContains(response, \'<input type="hidden" id="id_Author_books-TOTAL_FORMS" \'\n723.                             \'value="4" name="Author_books-TOTAL_FORMS">\', html=True)\n724.         self.assertContains(\n725.             response,\n726.             \'<input type="hidden" id="id_Author_books-0-id" value="%i" \'\n727.             \'name="Author_books-0-id">\' % self.author_book_auto_m2m_intermediate_id,\n728.             html=True\n729.         )\n730.         self.assertContains(response, \'id="id_Author_books-0-DELETE"\')\n731. \n732.     def test_inline_change_fk_add_perm(self):\n733.         permission = Permission.objects.get(codename=\'add_inner2\', content_type=self.inner_ct)\n734.         self.user.user_permissions.add(permission)\n735.         response = self.client.get(self.holder_change_url)\n736.         # Add permission on inner2s, so we can add but not modify existing\n737.         self.assertContains(response, \'<h2>Inner2s</h2>\')\n738.         self.assertContains(response, \'Add another Inner2\')\n739.         # 3 extra forms only, not the existing instance form\n740.         self.assertContains(\n741.             response,\n742.             \'<input type="hidden" id="id_inner2_set-TOTAL_FORMS" value="3" \'\n743.             \'name="inner2_set-TOTAL_FORMS">\',\n744.             html=True\n745.         )\n746.         self.assertNotContains(\n747.             response,\n748.             \'<input type="hidden" id="id_inner2_set-0-id" value="%i" name="inner2_set-0-id">\' % self.inner2.id,\n749.             html=True\n750.         )\n751. \n752.     def test_inline_change_fk_change_perm(self):\n753.         permission = Permission.objects.get(codename=\'change_inner2\', content_type=self.inner_ct)\n754.         self.user.user_permissions.add(permission)\n755.         response = self.client.get(self.holder_change_url)\n756.         # Change permission on inner2s, so we can change existing but not add new\n757.         self.assertContains(response, \'<h2>Inner2s</h2>\', count=2)\n758.         # Just the one form for existing instances\n759.         self.assertContains(\n760.             response, \'<input type="hidden" id="id_inner2_set-TOTAL_FORMS" value="1" name="inner2_set-TOTAL_FORMS">\',\n761.             html=True\n762.         )\n763.         self.assertContains(\n764.             response,\n765.             \'<input type="hidden" id="id_inner2_set-0-id" value="%i" name="inner2_set-0-id">\' % self.inner2.id,\n766.             html=True\n767.         )\n768.         # max-num 0 means we can\'t add new ones\n769.         self.assertContains(\n770.             response,\n771.             \'<input type="hidden" id="id_inner2_set-MAX_NUM_FORMS" value="0" name="inner2_set-MAX_NUM_FORMS">\',\n772.             html=True\n773.         )\n774.         # TabularInline\n775.         self.assertContains(response, \'<th class="column-dummy required">Dummy</th>\', html=True)\n776.         self.assertContains(\n777.             response,\n778.             \'<input type="number" name="inner2_set-2-0-dummy" value="%s" \'\n779.             \'class="vIntegerField" id="id_inner2_set-2-0-dummy">\' % self.inner2.dummy,\n780.             html=True,\n781.         )\n782. \n783.     def test_inline_change_fk_add_change_perm(self):\n784.         permission = Permission.objects.get(codename=\'add_inner2\', content_type=self.inner_ct)\n785.         self.user.user_permissions.add(permission)\n786.         permission = Permission.objects.get(codename=\'change_inner2\', content_type=self.inner_ct)\n787.         self.user.user_permissions.add(permission)\n788.         response = self.client.get(self.holder_change_url)\n789.         # Add/change perm, so we can add new and change existing\n790.         self.assertContains(response, \'<h2>Inner2s</h2>\')\n791.         # One form for existing instance and three extra for new\n792.         self.assertContains(\n793.             response, \'<input type="hidden" id="id_inner2_set-TOTAL_FORMS" value="4" name="inner2_set-TOTAL_FORMS">\',\n794.             html=True\n795.         )\n796.         self.assertContains(\n797.             response,\n798.             \'<input type="hidden" id="id_inner2_set-0-id" value="%i" name="inner2_set-0-id">\' % self.inner2.id,\n799.             html=True\n800.         )\n801. \n802.     def test_inline_change_fk_change_del_perm(self):\n803.         permission = Permission.objects.get(codename=\'change_inner2\', content_type=self.inner_ct)\n804.         self.user.user_permissions.add(permission)\n805.         permission = Permission.objects.get(codename=\'delete_inner2\', content_type=self.inner_ct)\n806.         self.user.user_permissions.add(permission)\n807.         response = self.client.get(self.holder_change_url)\n808.         # Change/delete perm on inner2s, so we can change/delete existing\n809.         self.assertContains(response, \'<h2>Inner2s</h2>\')\n810.         # One form for existing instance only, no new\n811.         self.assertContains(\n812.             response,\n813.             \'<input type="hidden" id="id_inner2_set-TOTAL_FORMS" value="1" name="inner2_set-TOTAL_FORMS">\',\n814.             html=True\n815.         )\n816.         self.assertContains(\n817.             response,\n818.             \'<input type="hidden" id="id_inner2_set-0-id" value="%i" name="inner2_set-0-id">\' % self.inner2.id,\n819.             html=True\n820.         )\n821.         self.assertContains(response, \'id="id_inner2_set-0-DELETE"\')\n822. \n823.     def test_inline_change_fk_all_perms(self):\n824.         permission = Permission.objects.get(codename=\'add_inner2\', content_type=self.inner_ct)\n825.         self.user.user_permissions.add(permission)\n826.         permission = Permission.objects.get(codename=\'change_inner2\', content_type=self.inner_ct)\n827.         self.user.user_permissions.add(permission)\n828.         permission = Permission.objects.get(codename=\'delete_inner2\', content_type=self.inner_ct)\n829.         self.user.user_permissions.add(permission)\n830.         response = self.client.get(self.holder_change_url)\n831.         # All perms on inner2s, so we can add/change/delete\n832.         self.assertContains(response, \'<h2>Inner2s</h2>\', count=2)\n833.         # One form for existing instance only, three for new\n834.         self.assertContains(\n835.             response,\n836.             \'<input type="hidden" id="id_inner2_set-TOTAL_FORMS" value="4" name="inner2_set-TOTAL_FORMS">\',\n837.             html=True\n838.         )\n839.         self.assertContains(\n840.             response,\n841.             \'<input type="hidden" id="id_inner2_set-0-id" value="%i" name="inner2_set-0-id">\' % self.inner2.id,\n842.             html=True\n843.         )\n844.         self.assertContains(response, \'id="id_inner2_set-0-DELETE"\')\n845.         # TabularInline\n846.         self.assertContains(response, \'<th class="column-dummy required">Dummy</th>\', html=True)\n847.         self.assertContains(\n848.             response,\n849.             \'<input type="number" name="inner2_set-2-0-dummy" value="%s" \'\n850.             \'class="vIntegerField" id="id_inner2_set-2-0-dummy">\' % self.inner2.dummy,\n851.             html=True,\n852.         )\n853. ', start_line_number=568, end_line_number=853), Context(relative_path='tests/admin_inlines/tests.py', content='28. @override_settings(ROOT_URLCONF=\'admin_inlines.urls\')\n29. class TestInline(TestDataMixin, TestCase):\n30.     factory = RequestFactory()\n31. \n32.     @classmethod\n33.     def setUpTestData(cls):\n34.         super().setUpTestData()\n35.         cls.holder = Holder.objects.create(dummy=13)\n36.         Inner.objects.create(dummy=42, holder=cls.holder)\n37. \n38.     def setUp(self):\n39.         self.client.force_login(self.superuser)\n40. \n41.     def test_can_delete(self):\n42.         """\n43.         can_delete should be passed to inlineformset factory.\n44.         """\n45.         response = self.client.get(\n46.             reverse(\'admin:admin_inlines_holder_change\', args=(self.holder.id,))\n47.         )\n48.         inner_formset = response.context[\'inline_admin_formsets\'][0].formset\n49.         expected = InnerInline.can_delete\n50.         actual = inner_formset.can_delete\n51.         self.assertEqual(expected, actual, \'can_delete must be equal\')\n52. \n53.     def test_readonly_stacked_inline_label(self):\n54.         """Bug #13174."""\n55.         holder = Holder.objects.create(dummy=42)\n56.         Inner.objects.create(holder=holder, dummy=42, readonly=\'\')\n57.         response = self.client.get(\n58.             reverse(\'admin:admin_inlines_holder_change\', args=(holder.id,))\n59.         )\n60.         self.assertContains(response, \'<label>Inner readonly label:</label>\')\n61. \n62.     def test_many_to_many_inlines(self):\n63.         "Autogenerated many-to-many inlines are displayed correctly (#13407)"\n64.         response = self.client.get(reverse(\'admin:admin_inlines_author_add\'))\n65.         # The heading for the m2m inline block uses the right text\n66.         self.assertContains(response, \'<h2>Author-book relationships</h2>\')\n67.         # The "add another" label is correct\n68.         self.assertContains(response, \'Add another Author-book relationship\')\n69.         # The \'+\' is dropped from the autogenerated form prefix (Author_books+)\n70.         self.assertContains(response, \'id="id_Author_books-TOTAL_FORMS"\')\n71. \n72.     def test_inline_primary(self):\n73.         person = Person.objects.create(firstname=\'Imelda\')\n74.         item = OutfitItem.objects.create(name=\'Shoes\')\n75.         # Imelda likes shoes, but can\'t carry her own bags.\n76.         data = {\n77.             \'shoppingweakness_set-TOTAL_FORMS\': 1,\n78.             \'shoppingweakness_set-INITIAL_FORMS\': 0,\n79.             \'shoppingweakness_set-MAX_NUM_FORMS\': 0,\n80.             \'_save\': \'Save\',\n81.             \'person\': person.id,\n82.             \'max_weight\': 0,\n83.             \'shoppingweakness_set-0-item\': item.id,\n84.         }\n85.         response = self.client.post(reverse(\'admin:admin_inlines_fashionista_add\'), data)\n86.         self.assertEqual(response.status_code, 302)\n87.         self.assertEqual(len(Fashionista.objects.filter(person__firstname=\'Imelda\')), 1)\n88. \n89.     def test_tabular_inline_column_css_class(self):\n90.         """\n91.         Field names are included in the context to output a field-specific\n92.         CSS class name in the column headers.\n93.         """\n94.         response = self.client.get(reverse(\'admin:admin_inlines_poll_add\'))\n95.         text_field, call_me_field = list(response.context[\'inline_admin_formset\'].fields())\n96.         # Editable field.\n97.         self.assertEqual(text_field[\'name\'], \'text\')\n98.         self.assertContains(response, \'<th class="column-text required">\')\n99.         # Read-only field.\n100.         self.assertEqual(call_me_field[\'name\'], \'call_me\')\n101.         self.assertContains(response, \'<th class="column-call_me">\')\n102. \n103.     def test_custom_form_tabular_inline_label(self):\n104.         """\n105.         A model form with a form field specified (TitleForm.title1) should have\n106.         its label rendered in the tabular inline.\n107.         """\n108.         response = self.client.get(reverse(\'admin:admin_inlines_titlecollection_add\'))\n109.         self.assertContains(response, \'<th class="column-title1 required">Title1</th>\', html=True)\n110. \n111.     def test_custom_form_tabular_inline_overridden_label(self):\n112.         """\n113.         SomeChildModelForm.__init__() overrides the label of a form field.\n114.         That label is displayed in the TabularInline.\n115.         """\n116.         response = self.client.get(reverse(\'admin:admin_inlines_someparentmodel_add\'))\n117.         field = list(response.context[\'inline_admin_formset\'].fields())[0]\n118.         self.assertEqual(field[\'label\'], \'new label\')\n119.         self.assertContains(response, \'<th class="column-name required">New label</th>\', html=True)\n120. \n121.     def test_tabular_non_field_errors(self):\n122.         """\n123.         non_field_errors are displayed correctly, including the correct value\n124.         for colspan.\n125.         """\n126.         data = {\n127.             \'title_set-TOTAL_FORMS\': 1,\n128.             \'title_set-INITIAL_FORMS\': 0,\n129.             \'title_set-MAX_NUM_FORMS\': 0,\n130.             \'_save\': \'Save\',\n131.             \'title_set-0-title1\': \'a title\',\n132.             \'title_set-0-title2\': \'a different title\',\n133.         }\n134.         response = self.client.post(reverse(\'admin:admin_inlines_titlecollection_add\'), data)\n135.         # Here colspan is "4": two fields (title1 and title2), one hidden field and the delete checkbox.\n136.         self.assertContains(\n137.             response,\n138.             \'<tr><td colspan="4"><ul class="errorlist nonfield">\'\n139.             \'<li>The two titles must be the same</li></ul></td></tr>\'\n140.         )\n141. \n142.     def test_no_parent_callable_lookup(self):\n143.         """Admin inline `readonly_field` shouldn\'t invoke parent ModelAdmin callable"""\n144.         # Identically named callable isn\'t present in the parent ModelAdmin,\n145.         # rendering of the add view shouldn\'t explode\n146.         response = self.client.get(reverse(\'admin:admin_inlines_novel_add\'))\n147.         self.assertEqual(response.status_code, 200)\n148.         # View should have the child inlines section\n149.         self.assertContains(\n150.             response,\n151.             \'<div class="js-inline-admin-formset inline-group" id="chapter_set-group"\'\n152.         )\n153. \n154.     def test_callable_lookup(self):\n155.         """Admin inline should invoke local callable when its name is listed in readonly_fields"""\n156.         response = self.client.get(reverse(\'admin:admin_inlines_poll_add\'))\n157.         self.assertEqual(response.status_code, 200)\n158.         # Add parent object view should have the child inlines section\n159.         self.assertContains(\n160.             response,\n161.             \'<div class="js-inline-admin-formset inline-group" id="question_set-group"\'\n162.         )\n163.         # The right callable should be used for the inline readonly_fields\n164.         # column cells\n165.         self.assertContains(response, \'<p>Callable in QuestionInline</p>\')\n166. \n167.     def test_help_text(self):\n168.         """\n169.         The inlines\' model field help texts are displayed when using both the\n170.         stacked and tabular layouts.\n171.         """\n172.         response = self.client.get(reverse(\'admin:admin_inlines_holder4_add\'))\n173.         self.assertContains(response, \'<div class="help">Awesome stacked help text is awesome.</div>\', 4)\n174.         self.assertContains(\n175.             response,\n176.             \'<img src="/static/admin/img/icon-unknown.svg" \'\n177.             \'class="help help-tooltip" width="10" height="10" \'\n178.             \'alt="(Awesome tabular help text is awesome.)" \'\n179.             \'title="Awesome tabular help text is awesome.">\',\n180.             1\n181.         )\n182.         # ReadOnly fields\n183.         response = self.client.get(reverse(\'admin:admin_inlines_capofamiglia_add\'))\n184.         self.assertContains(\n185.             response,\n186.             \'<img src="/static/admin/img/icon-unknown.svg" \'\n187.             \'class="help help-tooltip" width="10" height="10" \'\n188.             \'alt="(Help text for ReadOnlyInline)" \'\n189.             \'title="Help text for ReadOnlyInline">\',\n190.             1\n191.         )\n192. \n193.     def test_tabular_model_form_meta_readonly_field(self):\n194.         """\n195.         Tabular inlines use ModelForm.Meta.help_texts and labels for read-only\n196.         fields.\n197.         """\n198.         response = self.client.get(reverse(\'admin:admin_inlines_someparentmodel_add\'))\n199.         self.assertContains(\n200.             response,\n201.             \'<img src="/static/admin/img/icon-unknown.svg" \'\n202.             \'class="help help-tooltip" width="10" height="10" \'\n203.             \'alt="(Help text from ModelForm.Meta)" \'\n204.             \'title="Help text from ModelForm.Meta">\'\n205.         )\n206.         self.assertContains(response, \'Label from ModelForm.Meta\')\n207. \n208.     def test_inline_hidden_field_no_column(self):\n209.         """#18263 -- Make sure hidden fields don\'t get a column in tabular inlines"""\n210.         parent = SomeParentModel.objects.create(name=\'a\')\n211.         SomeChildModel.objects.create(name=\'b\', position=\'0\', parent=parent)\n212.         SomeChildModel.objects.create(name=\'c\', position=\'1\', parent=parent)\n213.         response = self.client.get(reverse(\'admin:admin_inlines_someparentmodel_change\', args=(parent.pk,)))\n214.         self.assertNotContains(response, \'<td class="field-position">\')\n215.         self.assertInHTML(\n216.             \'<input id="id_somechildmodel_set-1-position" \'\n217.             \'name="somechildmodel_set-1-position" type="hidden" value="1">\',\n218.             response.rendered_content,\n219.         )\n220. \n221.     def test_non_related_name_inline(self):\n222.         """\n223.         Multiple inlines with related_name=\'+\' have correct form prefixes.\n224.         """\n225.         response = self.client.get(reverse(\'admin:admin_inlines_capofamiglia_add\'))\n226.         self.assertContains(response, \'<input type="hidden" name="-1-0-id" id="id_-1-0-id">\', html=True)\n227.         self.assertContains(\n228.             response,\n229.             \'<input type="hidden" name="-1-0-capo_famiglia" id="id_-1-0-capo_famiglia">\',\n230.             html=True\n231.         )\n232.         self.assertContains(\n233.             response,\n234.             \'<input id="id_-1-0-name" type="text" class="vTextField" name="-1-0-name" maxlength="100">\',\n235.             html=True\n236.         )\n237.         self.assertContains(response, \'<input type="hidden" name="-2-0-id" id="id_-2-0-id">\', html=True)\n238.         self.assertContains(\n239.             response,\n240.             \'<input type="hidden" name="-2-0-capo_famiglia" id="id_-2-0-capo_famiglia">\',\n241.             html=True\n242.         )\n243.         self.assertContains(\n244.             response,\n245.             \'<input id="id_-2-0-name" type="text" class="vTextField" name="-2-0-name" maxlength="100">\',\n246.             html=True\n247.         )\n248. \n249.     @override_settings(USE_L10N=True, USE_THOUSAND_SEPARATOR=True)\n250.     def test_localize_pk_shortcut(self):\n251.         """\n252.         The "View on Site" link is correct for locales that use thousand\n253.         separators.\n254.         """\n255.         holder = Holder.objects.create(pk=123456789, dummy=42)\n256.         inner = Inner.objects.create(pk=987654321, holder=holder, dummy=42, readonly=\'\')\n257.         response = self.client.get(reverse(\'admin:admin_inlines_holder_change\', args=(holder.id,)))\n258.         inner_shortcut = \'r/%s/%s/\' % (ContentType.objects.get_for_model(inner).pk, inner.pk)\n259.         self.assertContains(response, inner_shortcut)\n260. \n261.     def test_custom_pk_shortcut(self):\n262.         """\n263.         The "View on Site" link is correct for models with a custom primary key\n264.         field.\n265.         """\n266.         parent = ParentModelWithCustomPk.objects.create(my_own_pk="foo", name="Foo")\n267.         child1 = ChildModel1.objects.create(my_own_pk="bar", name="Bar", parent=parent)\n268.         child2 = ChildModel2.objects.create(my_own_pk="baz", name="Baz", parent=parent)\n269.         response = self.client.get(reverse(\'admin:admin_inlines_parentmodelwithcustompk_change\', args=(\'foo\',)))\n270.         child1_shortcut = \'r/%s/%s/\' % (ContentType.objects.get_for_model(child1).pk, child1.pk)\n271.         child2_shortcut = \'r/%s/%s/\' % (ContentType.objects.get_for_model(child2).pk, child2.pk)\n272.         self.assertContains(response, child1_shortcut)\n273.         self.assertContains(response, child2_shortcut)\n274. \n275.     def test_create_inlines_on_inherited_model(self):\n276.         """\n277.         An object can be created with inlines when it inherits another class.\n278.         """\n279.         data = {\n280.             \'name\': \'Martian\',\n281.             \'sighting_set-TOTAL_FORMS\': 1,\n282.             \'sighting_set-INITIAL_FORMS\': 0,\n283.             \'sighting_set-MAX_NUM_FORMS\': 0,\n284.             \'sighting_set-0-place\': \'Zone 51\',\n285.             \'_save\': \'Save\',\n286.         }\n287.         response = self.client.post(reverse(\'admin:admin_inlines_extraterrestrial_add\'), data)\n288.         self.assertEqual(response.status_code, 302)\n289.         self.assertEqual(Sighting.objects.filter(et__name=\'Martian\').count(), 1)\n290. \n291.     def test_custom_get_extra_form(self):\n292.         bt_head = BinaryTree.objects.create(name="Tree Head")\n293.         BinaryTree.objects.create(name="First Child", parent=bt_head)\n294.         # The maximum number of forms should respect \'get_max_num\' on the\n295.         # ModelAdmin\n296.         max_forms_input = (\n297.             \'<input id="id_binarytree_set-MAX_NUM_FORMS" \'\n298.             \'name="binarytree_set-MAX_NUM_FORMS" type="hidden" value="%d">\'\n299.         )\n300.         # The total number of forms will remain the same in either case\n301.         total_forms_hidden = (\n302.             \'<input id="id_binarytree_set-TOTAL_FORMS" \'\n303.             \'name="binarytree_set-TOTAL_FORMS" type="hidden" value="2">\'\n304.         )\n305.         response = self.client.get(reverse(\'admin:admin_inlines_binarytree_add\'))\n306.         self.assertInHTML(max_forms_input % 3, response.rendered_content)\n307.         self.assertInHTML(total_forms_hidden, response.rendered_content)\n308. \n309.         response = self.client.get(reverse(\'admin:admin_inlines_binarytree_change\', args=(bt_head.id,)))\n310.         self.assertInHTML(max_forms_input % 2, response.rendered_content)\n311.         self.assertInHTML(total_forms_hidden, response.rendered_content)\n312. \n313.     def test_min_num(self):\n314.         """\n315.         min_num and extra determine number of forms.\n316.         """\n317.         class MinNumInline(TabularInline):\n318.             model = BinaryTree\n319.             min_num = 2\n320.             extra = 3\n321. \n322.         modeladmin = ModelAdmin(BinaryTree, admin_site)\n323.         modeladmin.inlines = [MinNumInline]\n324.         min_forms = (\n325.             \'<input id="id_binarytree_set-MIN_NUM_FORMS" \'\n326.             \'name="binarytree_set-MIN_NUM_FORMS" type="hidden" value="2">\'\n327.         )\n328.         total_forms = (\n329.             \'<input id="id_binarytree_set-TOTAL_FORMS" \'\n330.             \'name="binarytree_set-TOTAL_FORMS" type="hidden" value="5">\'\n331.         )\n332.         request = self.factory.get(reverse(\'admin:admin_inlines_binarytree_add\'))\n333.         request.user = User(username=\'super\', is_superuser=True)\n334.         response = modeladmin.changeform_view(request)\n335.         self.assertInHTML(min_forms, response.rendered_content)\n336.         self.assertInHTML(total_forms, response.rendered_content)\n337. \n338.     def test_custom_min_num(self):\n339.         bt_head = BinaryTree.objects.create(name="Tree Head")\n340.         BinaryTree.objects.create(name="First Child", parent=bt_head)\n341. \n342.         class MinNumInline(TabularInline):\n343.             model = BinaryTree\n344.             extra = 3\n345. \n346.             def get_min_num(self, request, obj=None, **kwargs):\n347.                 if obj:\n348.                     return 5\n349.                 return 2\n350. \n351.         modeladmin = ModelAdmin(BinaryTree, admin_site)\n352.         modeladmin.inlines = [MinNumInline]\n353.         min_forms = (\n354.             \'<input id="id_binarytree_set-MIN_NUM_FORMS" \'\n355.             \'name="binarytree_set-MIN_NUM_FORMS" type="hidden" value="%d">\'\n356.         )\n357.         total_forms = (\n358.             \'<input id="id_binarytree_set-TOTAL_FORMS" \'\n359.             \'name="binarytree_set-TOTAL_FORMS" type="hidden" value="%d">\'\n360.         )\n361.         request = self.factory.get(reverse(\'admin:admin_inlines_binarytree_add\'))\n362.         request.user = User(username=\'super\', is_superuser=True)\n363.         response = modeladmin.changeform_view(request)\n364.         self.assertInHTML(min_forms % 2, response.rendered_content)\n365.         self.assertInHTML(total_forms % 5, response.rendered_content)\n366. \n367.         request = self.factory.get(reverse(\'admin:admin_inlines_binarytree_change\', args=(bt_head.id,)))\n368.         request.user = User(username=\'super\', is_superuser=True)\n369.         response = modeladmin.changeform_view(request, object_id=str(bt_head.id))\n370.         self.assertInHTML(min_forms % 5, response.rendered_content)\n371.         self.assertInHTML(total_forms % 8, response.rendered_content)\n372. ', start_line_number=28, end_line_number=372), Context(relative_path='tests/admin_views/tests.py', content='1405. class AdminViewPermissionsTest(TestCase):\n1406.     """Tests for Admin Views Permissions."""\n1407. \n1408.     @classmethod\n1409.     def setUpTestData(cls):\n1410.         cls.superuser = User.objects.create_superuser(username=\'super\', password=\'secret\', email=\'super@example.com\')\n1411.         cls.viewuser = User.objects.create_user(username=\'viewuser\', password=\'secret\', is_staff=True)\n1412.         cls.adduser = User.objects.create_user(username=\'adduser\', password=\'secret\', is_staff=True)\n1413.         cls.changeuser = User.objects.create_user(username=\'changeuser\', password=\'secret\', is_staff=True)\n1414.         cls.deleteuser = User.objects.create_user(username=\'deleteuser\', password=\'secret\', is_staff=True)\n1415.         cls.joepublicuser = User.objects.create_user(username=\'joepublic\', password=\'secret\')\n1416.         cls.nostaffuser = User.objects.create_user(username=\'nostaff\', password=\'secret\')\n1417.         cls.s1 = Section.objects.create(name=\'Test section\')\n1418.         cls.a1 = Article.objects.create(\n1419.             content=\'<p>Middle content</p>\', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1,\n1420.             another_section=cls.s1,\n1421.         )\n1422.         cls.a2 = Article.objects.create(\n1423.             content=\'<p>Oldest content</p>\', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1\n1424.         )\n1425.         cls.a3 = Article.objects.create(\n1426.             content=\'<p>Newest content</p>\', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1\n1427.         )\n1428.         cls.p1 = PrePopulatedPost.objects.create(title=\'A Long Title\', published=True, slug=\'a-long-title\')\n1429. \n1430.         # Setup permissions, for our users who can add, change, and delete.\n1431.         opts = Article._meta\n1432. \n1433.         # User who can view Articles\n1434.         cls.viewuser.user_permissions.add(get_perm(Article, get_permission_codename(\'view\', opts)))\n1435.         # User who can add Articles\n1436.         cls.adduser.user_permissions.add(get_perm(Article, get_permission_codename(\'add\', opts)))\n1437.         # User who can change Articles\n1438.         cls.changeuser.user_permissions.add(get_perm(Article, get_permission_codename(\'change\', opts)))\n1439.         cls.nostaffuser.user_permissions.add(get_perm(Article, get_permission_codename(\'change\', opts)))\n1440. \n1441.         # User who can delete Articles\n1442.         cls.deleteuser.user_permissions.add(get_perm(Article, get_permission_codename(\'delete\', opts)))\n1443.         cls.deleteuser.user_permissions.add(get_perm(Section, get_permission_codename(\'delete\', Section._meta)))\n1444. \n1445.         # login POST dicts\n1446.         cls.index_url = reverse(\'admin:index\')\n1447.         cls.super_login = {\n1448.             REDIRECT_FIELD_NAME: cls.index_url,\n1449.             \'username\': \'super\',\n1450.             \'password\': \'secret\',\n1451.         }\n1452.         cls.super_email_login = {\n1453.             REDIRECT_FIELD_NAME: cls.index_url,\n1454.             \'username\': \'super@example.com\',\n1455.             \'password\': \'secret\',\n1456.         }\n1457.         cls.super_email_bad_login = {\n1458.             REDIRECT_FIELD_NAME: cls.index_url,\n1459.             \'username\': \'super@example.com\',\n1460.             \'password\': \'notsecret\',\n1461.         }\n1462.         cls.adduser_login = {\n1463.             REDIRECT_FIELD_NAME: cls.index_url,\n1464.             \'username\': \'adduser\',\n1465.             \'password\': \'secret\',\n1466.         }\n1467.         cls.changeuser_login = {\n1468.             REDIRECT_FIELD_NAME: cls.index_url,\n1469.             \'username\': \'changeuser\',\n1470.             \'password\': \'secret\',\n1471.         }\n1472.         cls.deleteuser_login = {\n1473.             REDIRECT_FIELD_NAME: cls.index_url,\n1474.             \'username\': \'deleteuser\',\n1475.             \'password\': \'secret\',\n1476.         }\n1477.         cls.nostaff_login = {\n1478.             REDIRECT_FIELD_NAME: reverse(\'has_permission_admin:index\'),\n1479.             \'username\': \'nostaff\',\n1480.             \'password\': \'secret\',\n1481.         }\n1482.         cls.joepublic_login = {\n1483.             REDIRECT_FIELD_NAME: cls.index_url,\n1484.             \'username\': \'joepublic\',\n1485.             \'password\': \'secret\',\n1486.         }\n1487.         cls.viewuser_login = {\n1488.             REDIRECT_FIELD_NAME: cls.index_url,\n1489.             \'username\': \'viewuser\',\n1490.             \'password\': \'secret\',\n1491.         }\n1492.         cls.no_username_login = {\n1493.             REDIRECT_FIELD_NAME: cls.index_url,\n1494.             \'password\': \'secret\',\n1495.         }\n1496. \n1497.     def test_login(self):\n1498.         """\n1499.         Make sure only staff members can log in.\n1500. \n1501.         Successful posts to the login page will redirect to the original url.\n1502.         Unsuccessful attempts will continue to render the login page with\n1503.         a 200 status code.\n1504.         """\n1505.         login_url = \'%s?next=%s\' % (reverse(\'admin:login\'), reverse(\'admin:index\'))\n1506.         # Super User\n1507.         response = self.client.get(self.index_url)\n1508.         self.assertRedirects(response, login_url)\n1509.         login = self.client.post(login_url, self.super_login)\n1510.         self.assertRedirects(login, self.index_url)\n1511.         self.assertFalse(login.context)\n1512.         self.client.get(reverse(\'admin:logout\'))\n1513. \n1514.         # Test if user enters email address\n1515.         response = self.client.get(self.index_url)\n1516.         self.assertEqual(response.status_code, 302)\n1517.         login = self.client.post(login_url, self.super_email_login)\n1518.         self.assertContains(login, ERROR_MESSAGE)\n1519.         # only correct passwords get a username hint\n1520.         login = self.client.post(login_url, self.super_email_bad_login)\n1521.         self.assertContains(login, ERROR_MESSAGE)\n1522.         new_user = User(username=\'jondoe\', password=\'secret\', email=\'super@example.com\')\n1523.         new_user.save()\n1524.         # check to ensure if there are multiple email addresses a user doesn\'t get a 500\n1525.         login = self.client.post(login_url, self.super_email_login)\n1526.         self.assertContains(login, ERROR_MESSAGE)\n1527. \n1528.         # View User\n1529.         response = self.client.get(self.index_url)\n1530.         self.assertEqual(response.status_code, 302)\n1531.         login = self.client.post(login_url, self.viewuser_login)\n1532.         self.assertRedirects(login, self.index_url)\n1533.         self.assertFalse(login.context)\n1534.         self.client.get(reverse(\'admin:logout\'))\n1535. \n1536.         # Add User\n1537.         response = self.client.get(self.index_url)\n1538.         self.assertEqual(response.status_code, 302)\n1539.         login = self.client.post(login_url, self.adduser_login)\n1540.         self.assertRedirects(login, self.index_url)\n1541.         self.assertFalse(login.context)\n1542.         self.client.get(reverse(\'admin:logout\'))\n1543. \n1544.         # Change User\n1545.         response = self.client.get(self.index_url)\n1546.         self.assertEqual(response.status_code, 302)\n1547.         login = self.client.post(login_url, self.changeuser_login)\n1548.         self.assertRedirects(login, self.index_url)\n1549.         self.assertFalse(login.context)\n1550.         self.client.get(reverse(\'admin:logout\'))\n1551. \n1552.         # Delete User\n1553.         response = self.client.get(self.index_url)\n1554.         self.assertEqual(response.status_code, 302)\n1555.         login = self.client.post(login_url, self.deleteuser_login)\n1556.         self.assertRedirects(login, self.index_url)\n1557.         self.assertFalse(login.context)\n1558.         self.client.get(reverse(\'admin:logout\'))\n1559. \n1560.         # Regular User should not be able to login.\n1561.         response = self.client.get(self.index_url)\n1562.         self.assertEqual(response.status_code, 302)\n1563.         login = self.client.post(login_url, self.joepublic_login)\n1564.         self.assertEqual(login.status_code, 200)\n1565.         self.assertContains(login, ERROR_MESSAGE)\n1566. \n1567.         # Requests without username should not return 500 errors.\n1568.         response = self.client.get(self.index_url)\n1569.         self.assertEqual(response.status_code, 302)\n1570.         login = self.client.post(login_url, self.no_username_login)\n1571.         self.assertEqual(login.status_code, 200)\n1572.         self.assertFormError(login, \'form\', \'username\', [\'This field is required.\'])\n1573. \n1574.     def test_login_redirect_for_direct_get(self):\n1575.         """\n1576.         Login redirect should be to the admin index page when going directly to\n1577.         /admin/login/.\n1578.         """\n1579.         response = self.client.get(reverse(\'admin:login\'))\n1580.         self.assertEqual(response.status_code, 200)\n1581.         self.assertEqual(response.context[REDIRECT_FIELD_NAME], reverse(\'admin:index\'))\n1582. \n1583.     def test_login_has_permission(self):\n1584.         # Regular User should not be able to login.\n1585.         response = self.client.get(reverse(\'has_permission_admin:index\'))\n1586.         self.assertEqual(response.status_code, 302)\n1587.         login = self.client.post(reverse(\'has_permission_admin:login\'), self.joepublic_login)\n1588.         self.assertEqual(login.status_code, 200)\n1589.         self.assertContains(login, \'permission denied\')\n1590. \n1591.         # User with permissions should be able to login.\n1592.         response = self.client.get(reverse(\'has_permission_admin:index\'))\n1593.         self.assertEqual(response.status_code, 302)\n1594.         login = self.client.post(reverse(\'has_permission_admin:login\'), self.nostaff_login)\n1595.         self.assertRedirects(login, reverse(\'has_permission_admin:index\'))\n1596.         self.assertFalse(login.context)\n1597.         self.client.get(reverse(\'has_permission_admin:logout\'))\n1598. \n1599.         # Staff should be able to login.\n1600.         response = self.client.get(reverse(\'has_permission_admin:index\'))\n1601.         self.assertEqual(response.status_code, 302)\n1602.         login = self.client.post(reverse(\'has_permission_admin:login\'), {\n1603.             REDIRECT_FIELD_NAME: reverse(\'has_permission_admin:index\'),\n1604.             \'username\': \'deleteuser\',\n1605.             \'password\': \'secret\',\n1606.         })\n1607.         self.assertRedirects(login, reverse(\'has_permission_admin:index\'))\n1608.         self.assertFalse(login.context)\n1609.         self.client.get(reverse(\'has_permission_admin:logout\'))\n1610. \n1611.     def test_login_successfully_redirects_to_original_URL(self):\n1612.         response = self.client.get(self.index_url)\n1613.         self.assertEqual(response.status_code, 302)\n1614.         query_string = \'the-answer=42\'\n1615.         redirect_url = \'%s?%s\' % (self.index_url, query_string)\n1616.         new_next = {REDIRECT_FIELD_NAME: redirect_url}\n1617.         post_data = self.super_login.copy()\n1618.         post_data.pop(REDIRECT_FIELD_NAME)\n1619.         login = self.client.post(\n1620.             \'%s?%s\' % (reverse(\'admin:login\'), urlencode(new_next)),\n1621.             post_data)\n1622.         self.assertRedirects(login, redirect_url)\n1623. \n1624.     def test_double_login_is_not_allowed(self):\n1625.         """Regression test for #19327"""\n1626.         login_url = \'%s?next=%s\' % (reverse(\'admin:login\'), reverse(\'admin:index\'))\n1627. \n1628.         response = self.client.get(self.index_url)\n1629.         self.assertEqual(response.status_code, 302)\n1630. \n1631.         # Establish a valid admin session\n1632.         login = self.client.post(login_url, self.super_login)\n1633.         self.assertRedirects(login, self.index_url)\n1634.         self.assertFalse(login.context)\n1635. \n1636.         # Logging in with non-admin user fails\n1637.         login = self.client.post(login_url, self.joepublic_login)\n1638.         self.assertEqual(login.status_code, 200)\n1639.         self.assertContains(login, ERROR_MESSAGE)\n1640. \n1641.         # Establish a valid admin session\n1642.         login = self.client.post(login_url, self.super_login)\n1643.         self.assertRedirects(login, self.index_url)\n1644.         self.assertFalse(login.context)\n1645. \n1646.         # Logging in with admin user while already logged in\n1647.         login = self.client.post(login_url, self.super_login)\n1648.         self.assertRedirects(login, self.index_url)\n1649.         self.assertFalse(login.context)\n1650.         self.client.get(reverse(\'admin:logout\'))\n1651. \n1652.     def test_login_page_notice_for_non_staff_users(self):\n1653.         """\n1654.         A logged-in non-staff user trying to access the admin index should be\n1655.         presented with the login page and a hint indicating that the current\n1656.         user doesn\'t have access to it.\n1657.         """\n1658.         hint_template = \'You are authenticated as {}\'\n1659. \n1660.         # Anonymous user should not be shown the hint\n1661.         response = self.client.get(self.index_url, follow=True)\n1662.         self.assertContains(response, \'login-form\')\n1663.         self.assertNotContains(response, hint_template.format(\'\'), status_code=200)\n1664. \n1665.         # Non-staff user should be shown the hint\n1666.         self.client.force_login(self.nostaffuser)\n1667.         response = self.client.get(self.index_url, follow=True)\n1668.         self.assertContains(response, \'login-form\')\n1669.         self.assertContains(response, hint_template.format(self.nostaffuser.username), status_code=200)\n1670. \n1671.     def test_add_view(self):\n1672.         """Test add view restricts access and actually adds items."""\n1673.         add_dict = {\n1674.             \'title\': \'Døm ikke\',\n1675.             \'content\': \'<p>great article</p>\',\n1676.             \'date_0\': \'2008-03-18\', \'date_1\': \'10:54:39\',\n1677.             \'section\': self.s1.pk,\n1678.         }\n1679.         # Change User should not have access to add articles\n1680.         self.client.force_login(self.changeuser)\n1681.         # make sure the view removes test cookie\n1682.         self.assertIs(self.client.session.test_cookie_worked(), False)\n1683.         response = self.client.get(reverse(\'admin:admin_views_article_add\'))\n1684.         self.assertEqual(response.status_code, 403)\n1685.         # Try POST just to make sure\n1686.         post = self.client.post(reverse(\'admin:admin_views_article_add\'), add_dict)\n1687.         self.assertEqual(post.status_code, 403)\n1688.         self.assertEqual(Article.objects.count(), 3)\n1689.         self.client.get(reverse(\'admin:logout\'))\n1690. \n1691.         # View User should not have access to add articles\n1692.         self.client.force_login(self.viewuser)\n1693.         response = self.client.get(reverse(\'admin:admin_views_article_add\'))\n1694.         self.assertEqual(response.status_code, 403)\n1695.         # Try POST just to make sure\n1696.         post = self.client.post(reverse(\'admin:admin_views_article_add\'), add_dict)\n1697.         self.assertEqual(post.status_code, 403)\n1698.         self.assertEqual(Article.objects.count(), 3)\n1699.         # Now give the user permission to add but not change.\n1700.         self.viewuser.user_permissions.add(get_perm(Article, get_permission_codename(\'add\', Article._meta)))\n1701.         response = self.client.get(reverse(\'admin:admin_views_article_add\'))\n1702.         self.assertContains(response, \'<input type="submit" value="Save and view" name="_continue">\')\n1703.         post = self.client.post(reverse(\'admin:admin_views_article_add\'), add_dict, follow=False)\n1704.         self.assertEqual(post.status_code, 302)\n1705.         self.assertEqual(Article.objects.count(), 4)\n1706.         article = Article.objects.latest(\'pk\')\n1707.         response = self.client.get(reverse(\'admin:admin_views_article_change\', args=(article.pk,)))\n1708.         self.assertContains(response, \'<li class="success">The article "Døm ikke" was added successfully.</li>\')\n1709.         article.delete()\n1710.         self.client.get(reverse(\'admin:logout\'))\n1711. \n1712.         # Add user may login and POST to add view, then redirect to admin root\n1713.         self.client.force_login(self.adduser)\n1714.         addpage = self.client.get(reverse(\'admin:admin_views_article_add\'))\n1715.         change_list_link = \'&rsaquo; <a href="%s">Articles</a>\' % reverse(\'admin:admin_views_article_changelist\')\n1716.         self.assertNotContains(\n1717.             addpage, change_list_link,\n1718.             msg_prefix=\'User restricted to add permission is given link to change list view in breadcrumbs.\'\n1719.         )\n1720.         post = self.client.post(reverse(\'admin:admin_views_article_add\'), add_dict)\n1721.         self.assertRedirects(post, self.index_url)\n1722.         self.assertEqual(Article.objects.count(), 4)\n1723.         self.assertEqual(len(mail.outbox), 2)\n1724.         self.assertEqual(mail.outbox[0].subject, \'Greetings from a created object\')\n1725.         self.client.get(reverse(\'admin:logout\'))\n1726. \n1727.         # The addition was logged correctly\n1728.         addition_log = LogEntry.objects.all()[0]\n1729.         new_article = Article.objects.last()\n1730.         article_ct = ContentType.objects.get_for_model(Article)\n1731.         self.assertEqual(addition_log.user_id, self.adduser.pk)\n1732.         self.assertEqual(addition_log.content_type_id, article_ct.pk)\n1733.         self.assertEqual(addition_log.object_id, str(new_article.pk))\n1734.         self.assertEqual(addition_log.object_repr, "Døm ikke")\n1735.         self.assertEqual(addition_log.action_flag, ADDITION)\n1736.         self.assertEqual(addition_log.get_change_message(), "Added.")\n1737. \n1738.         # Super can add too, but is redirected to the change list view\n1739.         self.client.force_login(self.superuser)\n1740.         addpage = self.client.get(reverse(\'admin:admin_views_article_add\'))\n1741.         self.assertContains(\n1742.             addpage, change_list_link,\n1743.             msg_prefix=\'Unrestricted user is not given link to change list view in breadcrumbs.\'\n1744.         )\n1745.         post = self.client.post(reverse(\'admin:admin_views_article_add\'), add_dict)\n1746.         self.assertRedirects(post, reverse(\'admin:admin_views_article_changelist\'))\n1747.         self.assertEqual(Article.objects.count(), 5)\n1748.         self.client.get(reverse(\'admin:logout\'))\n1749. \n1750.         # 8509 - if a normal user is already logged in, it is possible\n1751.         # to change user into the superuser without error\n1752.         self.client.force_login(self.joepublicuser)\n1753.         # Check and make sure that if user expires, data still persists\n1754.         self.client.force_login(self.superuser)\n1755.         # make sure the view removes test cookie\n1756.         self.assertIs(self.client.session.test_cookie_worked(), False)\n1757. \n1758.     @mock.patch(\'django.contrib.admin.options.InlineModelAdmin.has_change_permission\')\n1759.     def test_add_view_with_view_only_inlines(self, has_change_permission):\n1760.         """User with add permission to a section but view-only for inlines."""\n1761.         self.viewuser.user_permissions.add(get_perm(Section, get_permission_codename(\'add\', Section._meta)))\n1762.         self.client.force_login(self.viewuser)\n1763.         # Valid POST creates a new section.\n1764.         data = {\n1765.             \'name\': \'New obj\',\n1766.             \'article_set-TOTAL_FORMS\': 0,\n1767.             \'article_set-INITIAL_FORMS\': 0,\n1768.         }\n1769.         response = self.client.post(reverse(\'admin:admin_views_section_add\'), data)\n1770.         self.assertRedirects(response, reverse(\'admin:index\'))\n1771.         self.assertEqual(Section.objects.latest(\'id\').name, data[\'name\'])\n1772.         # InlineModelAdmin.has_change_permission()\'s obj argument is always\n1773.         # None during object add.\n1774.         self.assertEqual([obj for (request, obj), _ in has_change_permission.call_args_list], [None, None])\n1775. \n1776.     def test_change_view(self):\n1777.         """Change view should restrict access and allow users to edit items."""\n1778.         change_dict = {\n1779.             \'title\': \'Ikke fordømt\',\n1780.             \'content\': \'<p>edited article</p>\',\n1781.             \'date_0\': \'2008-03-18\', \'date_1\': \'10:54:39\',\n1782.             \'section\': self.s1.pk,\n1783.         }\n1784.         article_change_url = reverse(\'admin:admin_views_article_change\', args=(self.a1.pk,))\n1785.         article_changelist_url = reverse(\'admin:admin_views_article_changelist\')\n1786. \n1787.         # add user should not be able to view the list of article or change any of them\n1788.         self.client.force_login(self.adduser)\n1789.         response = self.client.get(article_changelist_url)\n1790.         self.assertEqual(response.status_code, 403)\n1791.         response = self.client.get(article_change_url)\n1792.         self.assertEqual(response.status_code, 403)\n1793.         post = self.client.post(article_change_url, change_dict)\n1794.         self.assertEqual(post.status_code, 403)\n1795.         self.client.get(reverse(\'admin:logout\'))\n1796. \n1797.         # view user should be able to view the article but not change any of them\n1798.         # (the POST can be sent, but no modification occurs)\n1799.         self.client.force_login(self.viewuser)\n1800.         response = self.client.get(article_changelist_url)\n1801.         self.assertEqual(response.status_code, 200)\n1802.         self.assertEqual(response.context[\'title\'], \'Select article to view\')\n1803.         response = self.client.get(article_change_url)\n1804.         self.assertEqual(response.status_code, 200)\n1805.         self.assertEqual(response.context[\'title\'], \'View article\')\n1806.         self.assertContains(response, \'<label>Extra form field:</label>\')\n1807.         self.assertContains(response, \'<a href="/test_admin/admin/admin_views/article/" class="closelink">Close</a>\')\n1808.         post = self.client.post(article_change_url, change_dict)\n1809.         self.assertEqual(post.status_code, 302)\n1810.         self.assertEqual(Article.objects.get(pk=self.a1.pk).content, \'<p>Middle content</p>\')\n1811.         self.client.get(reverse(\'admin:logout\'))\n1812. \n1813.         # change user can view all items and edit them\n1814.         self.client.force_login(self.changeuser)\n1815.         response = self.client.get(article_changelist_url)\n1816.         self.assertEqual(response.status_code, 200)\n1817.         self.assertEqual(response.context[\'title\'], \'Select article to change\')\n1818.         response = self.client.get(article_change_url)\n1819.         self.assertEqual(response.status_code, 200)\n1820.         self.assertEqual(response.context[\'title\'], \'Change article\')\n1821.         post = self.client.post(article_change_url, change_dict)\n1822.         self.assertRedirects(post, article_changelist_url)\n1823.         self.assertEqual(Article.objects.get(pk=self.a1.pk).content, \'<p>edited article</p>\')\n1824. \n1825.         # one error in form should produce singular error message, multiple errors plural\n1826.         change_dict[\'title\'] = \'\'\n1827.         post = self.client.post(article_change_url, change_dict)\n1828.         self.assertContains(\n1829.             post, \'Please correct the error below.\',\n1830.             msg_prefix=\'Singular error message not found in response to post with one error\'\n1831.         )\n1832. \n1833.         change_dict[\'content\'] = \'\'\n1834.         post = self.client.post(article_change_url, change_dict)\n1835.         self.assertContains(\n1836.             post, \'Please correct the errors below.\',\n1837.             msg_prefix=\'Plural error message not found in response to post with multiple errors\'\n1838.         )\n1839.         self.client.get(reverse(\'admin:logout\'))\n1840. \n1841.         # Test redirection when using row-level change permissions. Refs #11513.\n1842.         r1 = RowLevelChangePermissionModel.objects.create(id=1, name="odd id")\n1843.         r2 = RowLevelChangePermissionModel.objects.create(id=2, name="even id")\n1844.         r3 = RowLevelChangePermissionModel.objects.create(id=3, name=\'odd id mult 3\')\n1845.         r6 = RowLevelChangePermissionModel.objects.create(id=6, name=\'even id mult 3\')\n1846.         change_url_1 = reverse(\'admin:admin_views_rowlevelchangepermissionmodel_change\', args=(r1.pk,))\n1847.         change_url_2 = reverse(\'admin:admin_views_rowlevelchangepermissionmodel_change\', args=(r2.pk,))\n1848.         change_url_3 = reverse(\'admin:admin_views_rowlevelchangepermissionmodel_change\', args=(r3.pk,))\n1849.         change_url_6 = reverse(\'admin:admin_views_rowlevelchangepermissionmodel_change\', args=(r6.pk,))\n1850.         logins = [self.superuser, self.viewuser, self.adduser, self.changeuser, self.deleteuser]\n1851.         for login_user in logins:\n1852.             with self.subTest(login_user.username):\n1853.                 self.client.force_login(login_user)\n1854.                 response = self.client.get(change_url_1)\n1855.                 self.assertEqual(response.status_code, 403)\n1856.                 response = self.client.post(change_url_1, {\'name\': \'changed\'})\n1857.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=1).name, \'odd id\')\n1858.                 self.assertEqual(response.status_code, 403)\n1859.                 response = self.client.get(change_url_2)\n1860.                 self.assertEqual(response.status_code, 200)\n1861.                 response = self.client.post(change_url_2, {\'name\': \'changed\'})\n1862.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=2).name, \'changed\')\n1863.                 self.assertRedirects(response, self.index_url)\n1864.                 response = self.client.get(change_url_3)\n1865.                 self.assertEqual(response.status_code, 200)\n1866.                 response = self.client.post(change_url_3, {\'name\': \'changed\'})\n1867.                 self.assertRedirects(response, self.index_url)\n1868.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=3).name, \'odd id mult 3\')\n1869.                 response = self.client.get(change_url_6)\n1870.                 self.assertEqual(response.status_code, 200)\n1871.                 response = self.client.post(change_url_6, {\'name\': \'changed\'})\n1872.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=6).name, \'changed\')\n1873.                 self.assertRedirects(response, self.index_url)\n1874. \n1875.                 self.client.get(reverse(\'admin:logout\'))\n1876. \n1877.         for login_user in [self.joepublicuser, self.nostaffuser]:\n1878.             with self.subTest(login_user.username):\n1879.                 self.client.force_login(login_user)\n1880.                 response = self.client.get(change_url_1, follow=True)\n1881.                 self.assertContains(response, \'login-form\')\n1882.                 response = self.client.post(change_url_1, {\'name\': \'changed\'}, follow=True)\n1883.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=1).name, \'odd id\')\n1884.                 self.assertContains(response, \'login-form\')\n1885.                 response = self.client.get(change_url_2, follow=True)\n1886.                 self.assertContains(response, \'login-form\')\n1887.                 response = self.client.post(change_url_2, {\'name\': \'changed again\'}, follow=True)\n1888.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=2).name, \'changed\')\n1889.                 self.assertContains(response, \'login-form\')\n1890.                 self.client.get(reverse(\'admin:logout\'))\n1891. \n1892.     def test_change_view_without_object_change_permission(self):\n1893.         """\n1894.         The object should be read-only if the user has permission to view it\n1895.         and change objects of that type but not to change the current object.\n1896.         """\n1897.         change_url = reverse(\'admin9:admin_views_article_change\', args=(self.a1.pk,))\n1898.         self.client.force_login(self.viewuser)\n1899.         response = self.client.get(change_url)\n1900.         self.assertEqual(response.status_code, 200)\n1901.         self.assertEqual(response.context[\'title\'], \'View article\')\n1902.         self.assertContains(response, \'<a href="/test_admin/admin9/admin_views/article/" class="closelink">Close</a>\')\n1903. \n1904.     def test_change_view_post_without_object_change_permission(self):\n1905.         """A POST redirects to changelist without modifications."""\n1906.         change_dict = {\n1907.             \'title\': \'Ikke fordømt\',\n1908.             \'content\': \'<p>edited article</p>\',\n1909.             \'date_0\': \'2008-03-18\', \'date_1\': \'10:54:39\',\n1910.             \'section\': self.s1.pk,\n1911.         }\n1912.         change_url = reverse(\'admin10:admin_views_article_change\', args=(self.a1.pk,))\n1913.         changelist_url = reverse(\'admin10:admin_views_article_changelist\')\n1914.         self.client.force_login(self.viewuser)\n1915.         response = self.client.post(change_url, change_dict)\n1916.         self.assertRedirects(response, changelist_url)\n1917.         self.assertEqual(Article.objects.get(pk=self.a1.pk).content, \'<p>Middle content</p>\')\n1918. \n1919.     def test_change_view_save_as_new(self):\n1920.         """\n1921.         \'Save as new\' should raise PermissionDenied for users without the \'add\'\n1922.         permission.\n1923.         """\n1924.         change_dict_save_as_new = {\n1925.             \'_saveasnew\': \'Save as new\',\n1926.             \'title\': \'Ikke fordømt\',\n1927.             \'content\': \'<p>edited article</p>\',\n1928.             \'date_0\': \'2008-03-18\', \'date_1\': \'10:54:39\',\n1929.             \'section\': self.s1.pk,\n1930.         }\n1931.         article_change_url = reverse(\'admin:admin_views_article_change\', args=(self.a1.pk,))\n1932. \n1933.         # Add user can perform "Save as new".\n1934.         article_count = Article.objects.count()\n1935.         self.client.force_login(self.adduser)\n1936.         post = self.client.post(article_change_url, change_dict_save_as_new)\n1937.         self.assertRedirects(post, self.index_url)\n1938.         self.assertEqual(Article.objects.count(), article_count + 1)\n1939.         self.client.logout()\n1940. \n1941.         # Change user cannot perform "Save as new" (no \'add\' permission).\n1942.         article_count = Article.objects.count()\n1943.         self.client.force_login(self.changeuser)\n1944.         post = self.client.post(article_change_url, change_dict_save_as_new)\n1945.         self.assertEqual(post.status_code, 403)\n1946.         self.assertEqual(Article.objects.count(), article_count)\n1947. \n1948.         # User with both add and change permissions should be redirected to the\n1949.         # change page for the newly created object.\n1950.         article_count = Article.objects.count()\n1951.         self.client.force_login(self.superuser)\n1952.         post = self.client.post(article_change_url, change_dict_save_as_new)\n1953.         self.assertEqual(Article.objects.count(), article_count + 1)\n1954.         new_article = Article.objects.latest(\'id\')\n1955.         self.assertRedirects(post, reverse(\'admin:admin_views_article_change\', args=(new_article.pk,)))\n1956. \n1957.     def test_change_view_with_view_only_inlines(self):\n1958.         """\n1959.         User with change permission to a section but view-only for inlines.\n1960.         """\n1961.         self.viewuser.user_permissions.add(get_perm(Section, get_permission_codename(\'change\', Section._meta)))\n1962.         self.client.force_login(self.viewuser)\n1963.         # GET shows inlines.\n1964.         response = self.client.get(reverse(\'admin:admin_views_section_change\', args=(self.s1.pk,)))\n1965.         self.assertEqual(len(response.context[\'inline_admin_formsets\']), 1)\n1966.         formset = response.context[\'inline_admin_formsets\'][0]\n1967.         self.assertEqual(len(formset.forms), 3)\n1968.         # Valid POST changes the name.\n1969.         data = {\n1970.             \'name\': \'Can edit name with view-only inlines\',\n1971.             \'article_set-TOTAL_FORMS\': 3,\n1972.             \'article_set-INITIAL_FORMS\': 3\n1973.         }\n1974.         response = self.client.post(reverse(\'admin:admin_views_section_change\', args=(self.s1.pk,)), data)\n1975.         self.assertRedirects(response, reverse(\'admin:admin_views_section_changelist\'))\n1976.         self.assertEqual(Section.objects.get(pk=self.s1.pk).name, data[\'name\'])\n1977.         # Invalid POST reshows inlines.\n1978.         del data[\'name\']\n1979.         response = self.client.post(reverse(\'admin:admin_views_section_change\', args=(self.s1.pk,)), data)\n1980.         self.assertEqual(response.status_code, 200)\n1981.         self.assertEqual(len(response.context[\'inline_admin_formsets\']), 1)\n1982.         formset = response.context[\'inline_admin_formsets\'][0]\n1983.         self.assertEqual(len(formset.forms), 3)\n1984. \n1985.     def test_change_view_with_view_and_add_inlines(self):\n1986.         """User has view and add permissions on the inline model."""\n1987.         self.viewuser.user_permissions.add(get_perm(Section, get_permission_codename(\'change\', Section._meta)))\n1988.         self.viewuser.user_permissions.add(get_perm(Article, get_permission_codename(\'add\', Article._meta)))\n1989.         self.client.force_login(self.viewuser)\n1990.         # GET shows inlines.\n1991.         response = self.client.get(reverse(\'admin:admin_views_section_change\', args=(self.s1.pk,)))\n1992.         self.assertEqual(len(response.context[\'inline_admin_formsets\']), 1)\n1993.         formset = response.context[\'inline_admin_formsets\'][0]\n1994.         self.assertEqual(len(formset.forms), 6)\n1995.         # Valid POST creates a new article.\n1996.         data = {\n1997.             \'name\': \'Can edit name with view-only inlines\',\n1998.             \'article_set-TOTAL_FORMS\': 6,\n1999.             \'article_set-INITIAL_FORMS\': 3,\n2000.             \'article_set-3-id\': [\'\'],\n2001.             \'article_set-3-title\': [\'A title\'],\n2002.             \'article_set-3-content\': [\'Added content\'],\n2003.             \'article_set-3-date_0\': [\'2008-3-18\'],\n2004.             \'article_set-3-date_1\': [\'11:54:58\'],\n2005.             \'article_set-3-section\': [str(self.s1.pk)],\n2006.         }\n2007.         response = self.client.post(reverse(\'admin:admin_views_section_change\', args=(self.s1.pk,)), data)\n2008.         self.assertRedirects(response, reverse(\'admin:admin_views_section_changelist\'))\n2009.         self.assertEqual(Section.objects.get(pk=self.s1.pk).name, data[\'name\'])\n2010.         self.assertEqual(Article.objects.count(), 4)\n2011.         # Invalid POST reshows inlines.\n2012.         del data[\'name\']\n2013.         response = self.client.post(reverse(\'admin:admin_views_section_change\', args=(self.s1.pk,)), data)\n2014.         self.assertEqual(response.status_code, 200)\n2015.         self.assertEqual(len(response.context[\'inline_admin_formsets\']), 1)\n2016.         formset = response.context[\'inline_admin_formsets\'][0]\n2017.         self.assertEqual(len(formset.forms), 6)\n2018. \n2019.     def test_change_view_with_view_and_delete_inlines(self):\n2020.         """User has view and delete permissions on the inline model."""\n2021.         self.viewuser.user_permissions.add(get_perm(Section, get_permission_codename(\'change\', Section._meta)))\n2022.         self.client.force_login(self.viewuser)\n2023.         data = {\n2024.             \'name\': \'Name is required.\',\n2025.             \'article_set-TOTAL_FORMS\': 6,\n2026.             \'article_set-INITIAL_FORMS\': 3,\n2027.             \'article_set-0-id\': [str(self.a1.pk)],\n2028.             \'article_set-0-DELETE\': [\'on\'],\n2029.         }\n2030.         # Inline POST details are ignored without delete permission.\n2031.         response = self.client.post(reverse(\'admin:admin_views_section_change\', args=(self.s1.pk,)), data)\n2032.         self.assertRedirects(response, reverse(\'admin:admin_views_section_changelist\'))\n2033.         self.assertEqual(Article.objects.count(), 3)\n2034.         # Deletion successful when delete permission is added.\n2035.         self.viewuser.user_permissions.add(get_perm(Article, get_permission_codename(\'delete\', Article._meta)))\n2036.         data = {\n2037.             \'name\': \'Name is required.\',\n2038.             \'article_set-TOTAL_FORMS\': 6,\n2039.             \'article_set-INITIAL_FORMS\': 3,\n2040.             \'article_set-0-id\': [str(self.a1.pk)],\n2041.             \'article_set-0-DELETE\': [\'on\'],\n2042.         }\n2043.         response = self.client.post(reverse(\'admin:admin_views_section_change\', args=(self.s1.pk,)), data)\n2044.         self.assertRedirects(response, reverse(\'admin:admin_views_section_changelist\'))\n2045.         self.assertEqual(Article.objects.count(), 2)\n2046. ', start_line_number=1405, end_line_number=2046)]
2025-10-06 21:11:53,019 - thread-139660780025408.app.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-10-06 21:11:53,019 - thread-139660780025408.app.lang_graph.nodes.context_refine_node - INFO - Reached max_refined_query_loop, not asking for more context
2025-10-06 21:11:53,020 - thread-139660780025408.app.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Context retrieved: [Context(relative_path='tests/admin_inlines/tests.py', content='433.     def test_inlines_show_change_link_registered(self):\n434.         "Inlines `show_change_link` for registered models when enabled."\n435.         holder = Holder4.objects.create(dummy=1)\n436.         item1 = Inner4Stacked.objects.create(dummy=1, holder=holder)\n437.         item2 = Inner4Tabular.objects.create(dummy=1, holder=holder)\n438.         items = (\n439.             (\'inner4stacked\', item1.pk),\n440.             (\'inner4tabular\', item2.pk),\n441.         )\n442.         response = self.client.get(reverse(\'admin:admin_inlines_holder4_change\', args=(holder.pk,)))\n443.         self.assertTrue(response.context[\'inline_admin_formset\'].opts.has_registered_model)\n444.         for model, pk in items:\n445.             url = reverse(\'admin:admin_inlines_%s_change\' % model, args=(pk,))\n446.             self.assertContains(response, \'<a href="%s" %s\' % (url, INLINE_CHANGELINK_HTML))\n447. ', start_line_number=433, end_line_number=447), Context(relative_path='tests/admin_views/tests.py', content='6181.     def test_check(self):\n6182.         "The view_on_site value is either a boolean or a callable"\n6183.         try:\n6184.             admin = CityAdmin(City, AdminSite())\n6185.             CityAdmin.view_on_site = True\n6186.             self.assertEqual(admin.check(), [])\n6187.             CityAdmin.view_on_site = False\n6188.             self.assertEqual(admin.check(), [])\n6189.             CityAdmin.view_on_site = lambda obj: obj.get_absolute_url()\n6190.             self.assertEqual(admin.check(), [])\n6191.             CityAdmin.view_on_site = []\n6192.             self.assertEqual(admin.check(), [\n6193.                 Error(\n6194.                     "The value of \'view_on_site\' must be a callable or a boolean value.",\n6195.                     obj=CityAdmin,\n6196.                     id=\'admin.E025\',\n6197.                 ),\n6198.             ])\n6199.         finally:\n6200.             # Restore the original values for the benefit of other tests.\n6201.             CityAdmin.view_on_site = True\n6202. ', start_line_number=6181, end_line_number=6202), Context(relative_path='tests/admin_views/tests.py', content='4815. class ReadonlyTest(AdminFieldExtractionMixin, TestCase):\n4816. \n4817.     @classmethod\n4818.     def setUpTestData(cls):\n4819.         cls.superuser = User.objects.create_superuser(username=\'super\', password=\'secret\', email=\'super@example.com\')\n4820. \n4821.     def setUp(self):\n4822.         self.client.force_login(self.superuser)\n4823. \n4824.     def test_readonly_get(self):\n4825.         response = self.client.get(reverse(\'admin:admin_views_post_add\'))\n4826.         self.assertEqual(response.status_code, 200)\n4827.         self.assertNotContains(response, \'name="posted"\')\n4828.         # 3 fields + 2 submit buttons + 5 inline management form fields, + 2\n4829.         # hidden fields for inlines + 1 field for the inline + 2 empty form\n4830.         self.assertContains(response, "<input", count=15)\n4831.         self.assertContains(response, formats.localize(datetime.date.today()))\n4832.         self.assertContains(response, "<label>Awesomeness level:</label>")\n4833.         self.assertContains(response, "Very awesome.")\n4834.         self.assertContains(response, "Unknown coolness.")\n4835.         self.assertContains(response, "foo")\n4836. \n4837.         # Multiline text in a readonly field gets <br> tags\n4838.         self.assertContains(response, \'Multiline<br>test<br>string\')\n4839.         self.assertContains(response, \'<div class="readonly">Multiline<br>html<br>content</div>\', html=True)\n4840.         self.assertContains(response, \'InlineMultiline<br>test<br>string\')\n4841. \n4842.         self.assertContains(response, formats.localize(datetime.date.today() - datetime.timedelta(days=7)))\n4843. \n4844.         self.assertContains(response, \'<div class="form-row field-coolness">\')\n4845.         self.assertContains(response, \'<div class="form-row field-awesomeness_level">\')\n4846.         self.assertContains(response, \'<div class="form-row field-posted">\')\n4847.         self.assertContains(response, \'<div class="form-row field-value">\')\n4848.         self.assertContains(response, \'<div class="form-row">\')\n4849.         self.assertContains(response, \'<div class="help">\', 3)\n4850.         self.assertContains(\n4851.             response,\n4852.             \'<div class="help">Some help text for the title (with unicode ŠĐĆŽćžšđ)</div>\',\n4853.             html=True\n4854.         )\n4855.         self.assertContains(\n4856.             response,\n4857.             \'<div class="help">Some help text for the content (with unicode ŠĐĆŽćžšđ)</div>\',\n4858.             html=True\n4859.         )\n4860.         self.assertContains(\n4861.             response,\n4862.             \'<div class="help">Some help text for the date (with unicode ŠĐĆŽćžšđ)</div>\',\n4863.             html=True\n4864.         )\n4865. \n4866.         p = Post.objects.create(title="I worked on readonly_fields", content="Its good stuff")\n4867.         response = self.client.get(reverse(\'admin:admin_views_post_change\', args=(p.pk,)))\n4868.         self.assertContains(response, "%d amount of cool" % p.pk)\n4869. \n4870.     def test_readonly_text_field(self):\n4871.         p = Post.objects.create(\n4872.             title="Readonly test", content="test",\n4873.             readonly_content=\'test\\r\\n\\r\\ntest\\r\\n\\r\\ntest\\r\\n\\r\\ntest\',\n4874.         )\n4875.         Link.objects.create(\n4876.             url="http://www.djangoproject.com", post=p,\n4877.             readonly_link_content="test\\r\\nlink",\n4878.         )\n4879.         response = self.client.get(reverse(\'admin:admin_views_post_change\', args=(p.pk,)))\n4880.         # Checking readonly field.\n4881.         self.assertContains(response, \'test<br><br>test<br><br>test<br><br>test\')\n4882.         # Checking readonly field in inline.\n4883.         self.assertContains(response, \'test<br>link\')\n4884. \n4885.     def test_readonly_post(self):\n4886.         data = {\n4887.             "title": "Django Got Readonly Fields",\n4888.             "content": "This is an incredible development.",\n4889.             "link_set-TOTAL_FORMS": "1",\n4890.             "link_set-INITIAL_FORMS": "0",\n4891.             "link_set-MAX_NUM_FORMS": "0",\n4892.         }\n4893.         response = self.client.post(reverse(\'admin:admin_views_post_add\'), data)\n4894.         self.assertEqual(response.status_code, 302)\n4895.         self.assertEqual(Post.objects.count(), 1)\n4896.         p = Post.objects.get()\n4897.         self.assertEqual(p.posted, datetime.date.today())\n4898. \n4899.         data["posted"] = "10-8-1990"  # some date that\'s not today\n4900.         response = self.client.post(reverse(\'admin:admin_views_post_add\'), data)\n4901.         self.assertEqual(response.status_code, 302)\n4902.         self.assertEqual(Post.objects.count(), 2)\n4903.         p = Post.objects.order_by(\'-id\')[0]\n4904.         self.assertEqual(p.posted, datetime.date.today())\n4905. \n4906.     def test_readonly_manytomany(self):\n4907.         "Regression test for #13004"\n4908.         response = self.client.get(reverse(\'admin:admin_views_pizza_add\'))\n4909.         self.assertEqual(response.status_code, 200)\n4910. \n4911.     def test_user_password_change_limited_queryset(self):\n4912.         su = User.objects.filter(is_superuser=True)[0]\n4913.         response = self.client.get(reverse(\'admin2:auth_user_password_change\', args=(su.pk,)))\n4914.         self.assertEqual(response.status_code, 404)\n4915. \n4916.     def test_change_form_renders_correct_null_choice_value(self):\n4917.         """\n4918.         Regression test for #17911.\n4919.         """\n4920.         choice = Choice.objects.create(choice=None)\n4921.         response = self.client.get(reverse(\'admin:admin_views_choice_change\', args=(choice.pk,)))\n4922.         self.assertContains(response, \'<div class="readonly">No opinion</div>\', html=True)\n4923. \n4924.     def test_readonly_manytomany_backwards_ref(self):\n4925.         """\n4926.         Regression test for #16433 - backwards references for related objects\n4927.         broke if the related field is read-only due to the help_text attribute\n4928.         """\n4929.         topping = Topping.objects.create(name=\'Salami\')\n4930.         pizza = Pizza.objects.create(name=\'Americano\')\n4931.         pizza.toppings.add(topping)\n4932.         response = self.client.get(reverse(\'admin:admin_views_topping_add\'))\n4933.         self.assertEqual(response.status_code, 200)\n4934. \n4935.     def test_readonly_manytomany_forwards_ref(self):\n4936.         topping = Topping.objects.create(name=\'Salami\')\n4937.         pizza = Pizza.objects.create(name=\'Americano\')\n4938.         pizza.toppings.add(topping)\n4939.         response = self.client.get(reverse(\'admin:admin_views_pizza_change\', args=(pizza.pk,)))\n4940.         self.assertContains(response, \'<label>Toppings:</label>\', html=True)\n4941.         self.assertContains(response, \'<div class="readonly">Salami</div>\', html=True)\n4942. \n4943.     def test_readonly_onetoone_backwards_ref(self):\n4944.         """\n4945.         Can reference a reverse OneToOneField in ModelAdmin.readonly_fields.\n4946.         """\n4947.         v1 = Villain.objects.create(name=\'Adam\')\n4948.         pl = Plot.objects.create(name=\'Test Plot\', team_leader=v1, contact=v1)\n4949.         pd = PlotDetails.objects.create(details=\'Brand New Plot\', plot=pl)\n4950. \n4951.         response = self.client.get(reverse(\'admin:admin_views_plotproxy_change\', args=(pl.pk,)))\n4952.         field = self.get_admin_readonly_field(response, \'plotdetails\')\n4953.         self.assertEqual(field.contents(), \'Brand New Plot\')\n4954. \n4955.         # The reverse relation also works if the OneToOneField is null.\n4956.         pd.plot = None\n4957.         pd.save()\n4958. \n4959.         response = self.client.get(reverse(\'admin:admin_views_plotproxy_change\', args=(pl.pk,)))\n4960.         field = self.get_admin_readonly_field(response, \'plotdetails\')\n4961.         self.assertEqual(field.contents(), \'-\')  # default empty value\n4962. \n4963.     def test_readonly_field_overrides(self):\n4964.         """\n4965.         Regression test for #22087 - ModelForm Meta overrides are ignored by\n4966.         AdminReadonlyField\n4967.         """\n4968.         p = FieldOverridePost.objects.create(title="Test Post", content="Test Content")\n4969.         response = self.client.get(reverse(\'admin:admin_views_fieldoverridepost_change\', args=(p.pk,)))\n4970.         self.assertContains(response, \'<div class="help">Overridden help text for the date</div>\')\n4971.         self.assertContains(response, \'<label for="id_public">Overridden public label:</label>\', html=True)\n4972.         self.assertNotContains(response, "Some help text for the date (with unicode ŠĐĆŽćžšđ)")\n4973. \n4974.     def test_correct_autoescaping(self):\n4975.         """\n4976.         Make sure that non-field readonly elements are properly autoescaped (#24461)\n4977.         """\n4978.         section = Section.objects.create(name=\'<a>evil</a>\')\n4979.         response = self.client.get(reverse(\'admin:admin_views_section_change\', args=(section.pk,)))\n4980.         self.assertNotContains(response, "<a>evil</a>", status_code=200)\n4981.         self.assertContains(response, "&lt;a&gt;evil&lt;/a&gt;", status_code=200)\n4982. \n4983.     def test_label_suffix_translated(self):\n4984.         pizza = Pizza.objects.create(name=\'Americano\')\n4985.         url = reverse(\'admin:admin_views_pizza_change\', args=(pizza.pk,))\n4986.         with self.settings(LANGUAGE_CODE=\'fr\'):\n4987.             response = self.client.get(url)\n4988.         self.assertContains(response, \'<label>Toppings\\u00A0:</label>\', html=True)\n4989. \n4990. ', start_line_number=4815, end_line_number=4990), Context(relative_path='tests/admin_views/tests.py', content='3631. class AdminCustomQuerysetTest(TestCase):\n3632. \n3633.     @classmethod\n3634.     def setUpTestData(cls):\n3635.         cls.superuser = User.objects.create_superuser(username=\'super\', password=\'secret\', email=\'super@example.com\')\n3636.         cls.pks = [EmptyModel.objects.create().id for i in range(3)]\n3637. \n3638.     def setUp(self):\n3639.         self.client.force_login(self.superuser)\n3640.         self.super_login = {\n3641.             REDIRECT_FIELD_NAME: reverse(\'admin:index\'),\n3642.             \'username\': \'super\',\n3643.             \'password\': \'secret\',\n3644.         }\n3645. \n3646.     def test_changelist_view(self):\n3647.         response = self.client.get(reverse(\'admin:admin_views_emptymodel_changelist\'))\n3648.         for i in self.pks:\n3649.             if i > 1:\n3650.                 self.assertContains(response, \'Primary key = %s\' % i)\n3651.             else:\n3652.                 self.assertNotContains(response, \'Primary key = %s\' % i)\n3653. \n3654.     def test_changelist_view_count_queries(self):\n3655.         # create 2 Person objects\n3656.         Person.objects.create(name=\'person1\', gender=1)\n3657.         Person.objects.create(name=\'person2\', gender=2)\n3658.         changelist_url = reverse(\'admin:admin_views_person_changelist\')\n3659. \n3660.         # 5 queries are expected: 1 for the session, 1 for the user,\n3661.         # 2 for the counts and 1 for the objects on the page\n3662.         with self.assertNumQueries(5):\n3663.             resp = self.client.get(changelist_url)\n3664.             self.assertEqual(resp.context[\'selection_note\'], \'0 of 2 selected\')\n3665.             self.assertEqual(resp.context[\'selection_note_all\'], \'All 2 selected\')\n3666.         with self.assertNumQueries(5):\n3667.             extra = {\'q\': \'not_in_name\'}\n3668.             resp = self.client.get(changelist_url, extra)\n3669.             self.assertEqual(resp.context[\'selection_note\'], \'0 of 0 selected\')\n3670.             self.assertEqual(resp.context[\'selection_note_all\'], \'All 0 selected\')\n3671.         with self.assertNumQueries(5):\n3672.             extra = {\'q\': \'person\'}\n3673.             resp = self.client.get(changelist_url, extra)\n3674.             self.assertEqual(resp.context[\'selection_note\'], \'0 of 2 selected\')\n3675.             self.assertEqual(resp.context[\'selection_note_all\'], \'All 2 selected\')\n3676.         with self.assertNumQueries(5):\n3677.             extra = {\'gender__exact\': \'1\'}\n3678.             resp = self.client.get(changelist_url, extra)\n3679.             self.assertEqual(resp.context[\'selection_note\'], \'0 of 1 selected\')\n3680.             self.assertEqual(resp.context[\'selection_note_all\'], \'1 selected\')\n3681. \n3682.     def test_change_view(self):\n3683.         for i in self.pks:\n3684.             url = reverse(\'admin:admin_views_emptymodel_change\', args=(i,))\n3685.             response = self.client.get(url, follow=True)\n3686.             if i > 1:\n3687.                 self.assertEqual(response.status_code, 200)\n3688.             else:\n3689.                 self.assertRedirects(response, reverse(\'admin:index\'))\n3690.                 self.assertEqual(\n3691.                     [m.message for m in response.context[\'messages\']],\n3692.                     ["""empty model with ID "1" doesn\'t exist. Perhaps it was deleted?"""]\n3693.                 )\n3694. \n3695.     def test_add_model_modeladmin_defer_qs(self):\n3696.         # Test for #14529. defer() is used in ModelAdmin.get_queryset()\n3697. \n3698.         # model has __str__ method\n3699.         self.assertEqual(CoverLetter.objects.count(), 0)\n3700.         # Emulate model instance creation via the admin\n3701.         post_data = {\n3702.             "author": "Candidate, Best",\n3703.             "_save": "Save",\n3704.         }\n3705.         response = self.client.post(reverse(\'admin:admin_views_coverletter_add\'), post_data, follow=True)\n3706.         self.assertEqual(response.status_code, 200)\n3707.         self.assertEqual(CoverLetter.objects.count(), 1)\n3708.         # Message should contain non-ugly model verbose name\n3709.         pk = CoverLetter.objects.all()[0].pk\n3710.         self.assertContains(\n3711.             response,\n3712.             \'<li class="success">The cover letter "<a href="%s">\'\n3713.             \'Candidate, Best</a>" was added successfully.</li>\' %\n3714.             reverse(\'admin:admin_views_coverletter_change\', args=(pk,)), html=True\n3715.         )\n3716. \n3717.         # model has no __str__ method\n3718.         self.assertEqual(ShortMessage.objects.count(), 0)\n3719.         # Emulate model instance creation via the admin\n3720.         post_data = {\n3721.             "content": "What\'s this SMS thing?",\n3722.             "_save": "Save",\n3723.         }\n3724.         response = self.client.post(reverse(\'admin:admin_views_shortmessage_add\'), post_data, follow=True)\n3725.         self.assertEqual(response.status_code, 200)\n3726.         self.assertEqual(ShortMessage.objects.count(), 1)\n3727.         # Message should contain non-ugly model verbose name\n3728.         sm = ShortMessage.objects.all()[0]\n3729.         self.assertContains(\n3730.             response,\n3731.             \'<li class="success">The short message "<a href="%s">\'\n3732.             \'%s</a>" was added successfully.</li>\' %\n3733.             (reverse(\'admin:admin_views_shortmessage_change\', args=(sm.pk,)), sm), html=True\n3734.         )\n3735. \n3736.     def test_add_model_modeladmin_only_qs(self):\n3737.         # Test for #14529. only() is used in ModelAdmin.get_queryset()\n3738. \n3739.         # model has __str__ method\n3740.         self.assertEqual(Telegram.objects.count(), 0)\n3741.         # Emulate model instance creation via the admin\n3742.         post_data = {\n3743.             "title": "Urgent telegram",\n3744.             "_save": "Save",\n3745.         }\n3746.         response = self.client.post(reverse(\'admin:admin_views_telegram_add\'), post_data, follow=True)\n3747.         self.assertEqual(response.status_code, 200)\n3748.         self.assertEqual(Telegram.objects.count(), 1)\n3749.         # Message should contain non-ugly model verbose name\n3750.         pk = Telegram.objects.all()[0].pk\n3751.         self.assertContains(\n3752.             response,\n3753.             \'<li class="success">The telegram "<a href="%s">\'\n3754.             \'Urgent telegram</a>" was added successfully.</li>\' %\n3755.             reverse(\'admin:admin_views_telegram_change\', args=(pk,)), html=True\n3756.         )\n3757. \n3758.         # model has no __str__ method\n3759.         self.assertEqual(Paper.objects.count(), 0)\n3760.         # Emulate model instance creation via the admin\n3761.         post_data = {\n3762.             "title": "My Modified Paper Title",\n3763.             "_save": "Save",\n3764.         }\n3765.         response = self.client.post(reverse(\'admin:admin_views_paper_add\'), post_data, follow=True)\n3766.         self.assertEqual(response.status_code, 200)\n3767.         self.assertEqual(Paper.objects.count(), 1)\n3768.         # Message should contain non-ugly model verbose name\n3769.         p = Paper.objects.all()[0]\n3770.         self.assertContains(\n3771.             response,\n3772.             \'<li class="success">The paper "<a href="%s">\'\n3773.             \'%s</a>" was added successfully.</li>\' %\n3774.             (reverse(\'admin:admin_views_paper_change\', args=(p.pk,)), p), html=True\n3775.         )\n3776. \n3777.     def test_edit_model_modeladmin_defer_qs(self):\n3778.         # Test for #14529. defer() is used in ModelAdmin.get_queryset()\n3779. \n3780.         # model has __str__ method\n3781.         cl = CoverLetter.objects.create(author="John Doe")\n3782.         self.assertEqual(CoverLetter.objects.count(), 1)\n3783.         response = self.client.get(reverse(\'admin:admin_views_coverletter_change\', args=(cl.pk,)))\n3784.         self.assertEqual(response.status_code, 200)\n3785.         # Emulate model instance edit via the admin\n3786.         post_data = {\n3787.             "author": "John Doe II",\n3788.             "_save": "Save",\n3789.         }\n3790.         url = reverse(\'admin:admin_views_coverletter_change\', args=(cl.pk,))\n3791.         response = self.client.post(url, post_data, follow=True)\n3792.         self.assertEqual(response.status_code, 200)\n3793.         self.assertEqual(CoverLetter.objects.count(), 1)\n3794.         # Message should contain non-ugly model verbose name. Instance\n3795.         # representation is set by model\'s __str__()\n3796.         self.assertContains(\n3797.             response,\n3798.             \'<li class="success">The cover letter "<a href="%s">\'\n3799.             \'John Doe II</a>" was changed successfully.</li>\' %\n3800.             reverse(\'admin:admin_views_coverletter_change\', args=(cl.pk,)), html=True\n3801.         )\n3802. \n3803.         # model has no __str__ method\n3804.         sm = ShortMessage.objects.create(content="This is expensive")\n3805.         self.assertEqual(ShortMessage.objects.count(), 1)\n3806.         response = self.client.get(reverse(\'admin:admin_views_shortmessage_change\', args=(sm.pk,)))\n3807.         self.assertEqual(response.status_code, 200)\n3808.         # Emulate model instance edit via the admin\n3809.         post_data = {\n3810.             "content": "Too expensive",\n3811.             "_save": "Save",\n3812.         }\n3813.         url = reverse(\'admin:admin_views_shortmessage_change\', args=(sm.pk,))\n3814.         response = self.client.post(url, post_data, follow=True)\n3815.         self.assertEqual(response.status_code, 200)\n3816.         self.assertEqual(ShortMessage.objects.count(), 1)\n3817.         # Message should contain non-ugly model verbose name. The ugly(!)\n3818.         # instance representation is set by __str__().\n3819.         self.assertContains(\n3820.             response,\n3821.             \'<li class="success">The short message "<a href="%s">\'\n3822.             \'%s</a>" was changed successfully.</li>\' %\n3823.             (reverse(\'admin:admin_views_shortmessage_change\', args=(sm.pk,)), sm), html=True\n3824.         )\n3825. \n3826.     def test_edit_model_modeladmin_only_qs(self):\n3827.         # Test for #14529. only() is used in ModelAdmin.get_queryset()\n3828. \n3829.         # model has __str__ method\n3830.         t = Telegram.objects.create(title="First Telegram")\n3831.         self.assertEqual(Telegram.objects.count(), 1)\n3832.         response = self.client.get(reverse(\'admin:admin_views_telegram_change\', args=(t.pk,)))\n3833.         self.assertEqual(response.status_code, 200)\n3834.         # Emulate model instance edit via the admin\n3835.         post_data = {\n3836.             "title": "Telegram without typo",\n3837.             "_save": "Save",\n3838.         }\n3839.         response = self.client.post(reverse(\'admin:admin_views_telegram_change\', args=(t.pk,)), post_data, follow=True)\n3840.         self.assertEqual(response.status_code, 200)\n3841.         self.assertEqual(Telegram.objects.count(), 1)\n3842.         # Message should contain non-ugly model verbose name. The instance\n3843.         # representation is set by model\'s __str__()\n3844.         self.assertContains(\n3845.             response,\n3846.             \'<li class="success">The telegram "<a href="%s">\'\n3847.             \'Telegram without typo</a>" was changed successfully.</li>\' %\n3848.             reverse(\'admin:admin_views_telegram_change\', args=(t.pk,)), html=True\n3849.         )\n3850. \n3851.         # model has no __str__ method\n3852.         p = Paper.objects.create(title="My Paper Title")\n3853.         self.assertEqual(Paper.objects.count(), 1)\n3854.         response = self.client.get(reverse(\'admin:admin_views_paper_change\', args=(p.pk,)))\n3855.         self.assertEqual(response.status_code, 200)\n3856.         # Emulate model instance edit via the admin\n3857.         post_data = {\n3858.             "title": "My Modified Paper Title",\n3859.             "_save": "Save",\n3860.         }\n3861.         response = self.client.post(reverse(\'admin:admin_views_paper_change\', args=(p.pk,)), post_data, follow=True)\n3862.         self.assertEqual(response.status_code, 200)\n3863.         self.assertEqual(Paper.objects.count(), 1)\n3864.         # Message should contain non-ugly model verbose name. The ugly(!)\n3865.         # instance representation is set by __str__().\n3866.         self.assertContains(\n3867.             response,\n3868.             \'<li class="success">The paper "<a href="%s">\'\n3869.             \'%s</a>" was changed successfully.</li>\' %\n3870.             (reverse(\'admin:admin_views_paper_change\', args=(p.pk,)), p), html=True\n3871.         )\n3872. \n3873.     def test_history_view_custom_qs(self):\n3874.         """\n3875.         Custom querysets are considered for the admin history view.\n3876.         """\n3877.         self.client.post(reverse(\'admin:login\'), self.super_login)\n3878.         FilteredManager.objects.create(pk=1)\n3879.         FilteredManager.objects.create(pk=2)\n3880.         response = self.client.get(reverse(\'admin:admin_views_filteredmanager_changelist\'))\n3881.         self.assertContains(response, "PK=1")\n3882.         self.assertContains(response, "PK=2")\n3883.         self.assertEqual(\n3884.             self.client.get(reverse(\'admin:admin_views_filteredmanager_history\', args=(1,))).status_code, 200\n3885.         )\n3886.         self.assertEqual(\n3887.             self.client.get(reverse(\'admin:admin_views_filteredmanager_history\', args=(2,))).status_code, 200\n3888.         )\n3889. \n3890. ', start_line_number=3631, end_line_number=3890), Context(relative_path='tests/admin_views/tests.py', content='1138. @override_settings(ROOT_URLCONF=\'admin_views.urls\')\n1139. class AdminViewFormUrlTest(TestCase):\n1140.     current_app = "admin3"\n1141. \n1142.     @classmethod\n1143.     def setUpTestData(cls):\n1144.         cls.superuser = User.objects.create_superuser(username=\'super\', password=\'secret\', email=\'super@example.com\')\n1145.         cls.s1 = Section.objects.create(name=\'Test section\')\n1146.         cls.a1 = Article.objects.create(\n1147.             content=\'<p>Middle content</p>\', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1\n1148.         )\n1149.         cls.a2 = Article.objects.create(\n1150.             content=\'<p>Oldest content</p>\', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1\n1151.         )\n1152.         cls.a3 = Article.objects.create(\n1153.             content=\'<p>Newest content</p>\', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1\n1154.         )\n1155.         cls.p1 = PrePopulatedPost.objects.create(title=\'A Long Title\', published=True, slug=\'a-long-title\')\n1156. \n1157.     def setUp(self):\n1158.         self.client.force_login(self.superuser)\n1159. \n1160.     def test_change_form_URL_has_correct_value(self):\n1161.         """\n1162.         change_view has form_url in response.context\n1163.         """\n1164.         response = self.client.get(\n1165.             reverse(\'admin:admin_views_section_change\', args=(self.s1.pk,), current_app=self.current_app)\n1166.         )\n1167.         self.assertIn(\'form_url\', response.context, msg=\'form_url not present in response.context\')\n1168.         self.assertEqual(response.context[\'form_url\'], \'pony\')\n1169. \n1170.     def test_initial_data_can_be_overridden(self):\n1171.         """\n1172.         The behavior for setting initial form data can be overridden in the\n1173.         ModelAdmin class. Usually, the initial value is set via the GET params.\n1174.         """\n1175.         response = self.client.get(\n1176.             reverse(\'admin:admin_views_restaurant_add\', current_app=self.current_app),\n1177.             {\'name\': \'test_value\'}\n1178.         )\n1179.         # this would be the usual behaviour\n1180.         self.assertNotContains(response, \'value="test_value"\')\n1181.         # this is the overridden behaviour\n1182.         self.assertContains(response, \'value="overridden_value"\')\n1183. ', start_line_number=1138, end_line_number=1183), Context(relative_path='tests/admin_views/tests.py', content='3587. class TestCustomChangeList(TestCase):\n3588. \n3589.     @classmethod\n3590.     def setUpTestData(cls):\n3591.         cls.superuser = User.objects.create_superuser(username=\'super\', password=\'secret\', email=\'super@example.com\')\n3592. \n3593.     def setUp(self):\n3594.         self.client.force_login(self.superuser)\n3595. \n3596.     def test_custom_changelist(self):\n3597.         """\n3598.         Validate that a custom ChangeList class can be used (#9749)\n3599.         """\n3600.         # Insert some data\n3601.         post_data = {"name": "First Gadget"}\n3602.         response = self.client.post(reverse(\'admin:admin_views_gadget_add\'), post_data)\n3603.         self.assertEqual(response.status_code, 302)  # redirect somewhere\n3604.         # Hit the page once to get messages out of the queue message list\n3605.         response = self.client.get(reverse(\'admin:admin_views_gadget_changelist\'))\n3606.         # Data is still not visible on the page\n3607.         response = self.client.get(reverse(\'admin:admin_views_gadget_changelist\'))\n3608.         self.assertEqual(response.status_code, 200)\n3609.         self.assertNotContains(response, \'First Gadget\')\n3610. \n3611. ', start_line_number=3587, end_line_number=3611), Context(relative_path='tests/admin_views/tests.py', content='2501. @skipUnlessDBFeature(\'can_defer_constraint_checks\')\n2502. @override_settings(ROOT_URLCONF=\'admin_views.urls\')\n2503. class AdminViewDeletedObjectsTest(TestCase):\n2504. \n2505.     @classmethod\n2506.     def setUpTestData(cls):\n2507.         cls.superuser = User.objects.create_superuser(username=\'super\', password=\'secret\', email=\'super@example.com\')\n2508.         cls.deleteuser = User.objects.create_user(username=\'deleteuser\', password=\'secret\', is_staff=True)\n2509.         cls.s1 = Section.objects.create(name=\'Test section\')\n2510.         cls.a1 = Article.objects.create(\n2511.             content=\'<p>Middle content</p>\', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1\n2512.         )\n2513.         cls.a2 = Article.objects.create(\n2514.             content=\'<p>Oldest content</p>\', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1\n2515.         )\n2516.         cls.a3 = Article.objects.create(\n2517.             content=\'<p>Newest content</p>\', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1\n2518.         )\n2519.         cls.p1 = PrePopulatedPost.objects.create(title=\'A Long Title\', published=True, slug=\'a-long-title\')\n2520. \n2521.         cls.v1 = Villain.objects.create(name=\'Adam\')\n2522.         cls.v2 = Villain.objects.create(name=\'Sue\')\n2523.         cls.sv1 = SuperVillain.objects.create(name=\'Bob\')\n2524.         cls.pl1 = Plot.objects.create(name=\'World Domination\', team_leader=cls.v1, contact=cls.v2)\n2525.         cls.pl2 = Plot.objects.create(name=\'World Peace\', team_leader=cls.v2, contact=cls.v2)\n2526.         cls.pl3 = Plot.objects.create(name=\'Corn Conspiracy\', team_leader=cls.v1, contact=cls.v1)\n2527.         cls.pd1 = PlotDetails.objects.create(details=\'almost finished\', plot=cls.pl1)\n2528.         cls.sh1 = SecretHideout.objects.create(location=\'underground bunker\', villain=cls.v1)\n2529.         cls.sh2 = SecretHideout.objects.create(location=\'floating castle\', villain=cls.sv1)\n2530.         cls.ssh1 = SuperSecretHideout.objects.create(location=\'super floating castle!\', supervillain=cls.sv1)\n2531.         cls.cy1 = CyclicOne.objects.create(name=\'I am recursive\', two_id=1)\n2532.         cls.cy2 = CyclicTwo.objects.create(name=\'I am recursive too\', one_id=1)\n2533. \n2534.     def setUp(self):\n2535.         self.client.force_login(self.superuser)\n2536. \n2537.     def test_nesting(self):\n2538.         """\n2539.         Objects should be nested to display the relationships that\n2540.         cause them to be scheduled for deletion.\n2541.         """\n2542.         pattern = re.compile(\n2543.             r\'<li>Plot: <a href="%s">World Domination</a>\\s*<ul>\\s*\'\n2544.             r\'<li>Plot details: <a href="%s">almost finished</a>\' % (\n2545.                 reverse(\'admin:admin_views_plot_change\', args=(self.pl1.pk,)),\n2546.                 reverse(\'admin:admin_views_plotdetails_change\', args=(self.pd1.pk,)),\n2547.             )\n2548.         )\n2549.         response = self.client.get(reverse(\'admin:admin_views_villain_delete\', args=(self.v1.pk,)))\n2550.         self.assertRegex(response.content.decode(), pattern)\n2551. \n2552.     def test_cyclic(self):\n2553.         """\n2554.         Cyclic relationships should still cause each object to only be\n2555.         listed once.\n2556.         """\n2557.         one = \'<li>Cyclic one: <a href="%s">I am recursive</a>\' % (\n2558.             reverse(\'admin:admin_views_cyclicone_change\', args=(self.cy1.pk,)),\n2559.         )\n2560.         two = \'<li>Cyclic two: <a href="%s">I am recursive too</a>\' % (\n2561.             reverse(\'admin:admin_views_cyclictwo_change\', args=(self.cy2.pk,)),\n2562.         )\n2563.         response = self.client.get(reverse(\'admin:admin_views_cyclicone_delete\', args=(self.cy1.pk,)))\n2564. \n2565.         self.assertContains(response, one, 1)\n2566.         self.assertContains(response, two, 1)\n2567. \n2568.     def test_perms_needed(self):\n2569.         self.client.logout()\n2570.         delete_user = User.objects.get(username=\'deleteuser\')\n2571.         delete_user.user_permissions.add(get_perm(Plot, get_permission_codename(\'delete\', Plot._meta)))\n2572. \n2573.         self.client.force_login(self.deleteuser)\n2574.         response = self.client.get(reverse(\'admin:admin_views_plot_delete\', args=(self.pl1.pk,)))\n2575.         self.assertContains(response, "your account doesn\'t have permission to delete the following types of objects")\n2576.         self.assertContains(response, "<li>plot details</li>")\n2577. \n2578.     def test_protected(self):\n2579.         q = Question.objects.create(question="Why?")\n2580.         a1 = Answer.objects.create(question=q, answer="Because.")\n2581.         a2 = Answer.objects.create(question=q, answer="Yes.")\n2582. \n2583.         response = self.client.get(reverse(\'admin:admin_views_question_delete\', args=(q.pk,)))\n2584.         self.assertContains(response, "would require deleting the following protected related objects")\n2585.         self.assertContains(\n2586.             response,\n2587.             \'<li>Answer: <a href="%s">Because.</a></li>\' % reverse(\'admin:admin_views_answer_change\', args=(a1.pk,))\n2588.         )\n2589.         self.assertContains(\n2590.             response,\n2591.             \'<li>Answer: <a href="%s">Yes.</a></li>\' % reverse(\'admin:admin_views_answer_change\', args=(a2.pk,))\n2592.         )\n2593. \n2594.     def test_post_delete_protected(self):\n2595.         """\n2596.         A POST request to delete protected objects should display the page\n2597.         which says the deletion is prohibited.\n2598.         """\n2599.         q = Question.objects.create(question=\'Why?\')\n2600.         Answer.objects.create(question=q, answer=\'Because.\')\n2601. \n2602.         response = self.client.post(reverse(\'admin:admin_views_question_delete\', args=(q.pk,)), {\'post\': \'yes\'})\n2603.         self.assertEqual(Question.objects.count(), 1)\n2604.         self.assertContains(response, "would require deleting the following protected related objects")\n2605. \n2606.     def test_not_registered(self):\n2607.         should_contain = """<li>Secret hideout: underground bunker"""\n2608.         response = self.client.get(reverse(\'admin:admin_views_villain_delete\', args=(self.v1.pk,)))\n2609.         self.assertContains(response, should_contain, 1)\n2610. \n2611.     def test_multiple_fkeys_to_same_model(self):\n2612.         """\n2613.         If a deleted object has two relationships from another model,\n2614.         both of those should be followed in looking for related\n2615.         objects to delete.\n2616.         """\n2617.         should_contain = \'<li>Plot: <a href="%s">World Domination</a>\' % reverse(\n2618.             \'admin:admin_views_plot_change\', args=(self.pl1.pk,)\n2619.         )\n2620.         response = self.client.get(reverse(\'admin:admin_views_villain_delete\', args=(self.v1.pk,)))\n2621.         self.assertContains(response, should_contain)\n2622.         response = self.client.get(reverse(\'admin:admin_views_villain_delete\', args=(self.v2.pk,)))\n2623.         self.assertContains(response, should_contain)\n2624. \n2625.     def test_multiple_fkeys_to_same_instance(self):\n2626.         """\n2627.         If a deleted object has two relationships pointing to it from\n2628.         another object, the other object should still only be listed\n2629.         once.\n2630.         """\n2631.         should_contain = \'<li>Plot: <a href="%s">World Peace</a></li>\' % reverse(\n2632.             \'admin:admin_views_plot_change\', args=(self.pl2.pk,)\n2633.         )\n2634.         response = self.client.get(reverse(\'admin:admin_views_villain_delete\', args=(self.v2.pk,)))\n2635.         self.assertContains(response, should_contain, 1)\n2636. \n2637.     def test_inheritance(self):\n2638.         """\n2639.         In the case of an inherited model, if either the child or\n2640.         parent-model instance is deleted, both instances are listed\n2641.         for deletion, as well as any relationships they have.\n2642.         """\n2643.         should_contain = [\n2644.             \'<li>Villain: <a href="%s">Bob</a>\' % reverse(\'admin:admin_views_villain_change\', args=(self.sv1.pk,)),\n2645.             \'<li>Super villain: <a href="%s">Bob</a>\' % reverse(\n2646.                 \'admin:admin_views_supervillain_change\', args=(self.sv1.pk,)\n2647.             ),\n2648.             \'<li>Secret hideout: floating castle\',\n2649.             \'<li>Super secret hideout: super floating castle!\',\n2650.         ]\n2651.         response = self.client.get(reverse(\'admin:admin_views_villain_delete\', args=(self.sv1.pk,)))\n2652.         for should in should_contain:\n2653.             self.assertContains(response, should, 1)\n2654.         response = self.client.get(reverse(\'admin:admin_views_supervillain_delete\', args=(self.sv1.pk,)))\n2655.         for should in should_contain:\n2656.             self.assertContains(response, should, 1)\n2657. \n2658.     def test_generic_relations(self):\n2659.         """\n2660.         If a deleted object has GenericForeignKeys pointing to it,\n2661.         those objects should be listed for deletion.\n2662.         """\n2663.         plot = self.pl3\n2664.         tag = FunkyTag.objects.create(content_object=plot, name=\'hott\')\n2665.         should_contain = \'<li>Funky tag: <a href="%s">hott\' % reverse(\n2666.             \'admin:admin_views_funkytag_change\', args=(tag.id,))\n2667.         response = self.client.get(reverse(\'admin:admin_views_plot_delete\', args=(plot.pk,)))\n2668.         self.assertContains(response, should_contain)\n2669. \n2670.     def test_generic_relations_with_related_query_name(self):\n2671.         """\n2672.         If a deleted object has GenericForeignKey with\n2673.         GenericRelation(related_query_name=\'...\') pointing to it, those objects\n2674.         should be listed for deletion.\n2675.         """\n2676.         bookmark = Bookmark.objects.create(name=\'djangoproject\')\n2677.         tag = FunkyTag.objects.create(content_object=bookmark, name=\'django\')\n2678.         tag_url = reverse(\'admin:admin_views_funkytag_change\', args=(tag.id,))\n2679.         should_contain = \'<li>Funky tag: <a href="%s">django\' % tag_url\n2680.         response = self.client.get(reverse(\'admin:admin_views_bookmark_delete\', args=(bookmark.pk,)))\n2681.         self.assertContains(response, should_contain)\n2682. \n2683.     def test_delete_view_uses_get_deleted_objects(self):\n2684.         """The delete view uses ModelAdmin.get_deleted_objects()."""\n2685.         book = Book.objects.create(name=\'Test Book\')\n2686.         response = self.client.get(reverse(\'admin2:admin_views_book_delete\', args=(book.pk,)))\n2687.         # BookAdmin.get_deleted_objects() returns custom text.\n2688.         self.assertContains(response, \'a deletable object\')\n2689. \n2690. ', start_line_number=2501, end_line_number=2690), Context(relative_path='tests/admin_inlines/admin.py', content='1. from django import forms\n2. from django.contrib import admin\n3. from django.db import models\n4. \n5. from .models import (\n6.     Author, BinaryTree, CapoFamiglia, Chapter, ChildModel1, ChildModel2,\n7.     Consigliere, EditablePKBook, ExtraTerrestrial, Fashionista, Holder,\n8.     Holder2, Holder3, Holder4, Inner, Inner2, Inner3, Inner4Stacked,\n9.     Inner4Tabular, NonAutoPKBook, NonAutoPKBookChild, Novel,\n10.     NovelReadonlyChapter, ParentModelWithCustomPk, Poll, Profile,\n11.     ProfileCollection, Question, ReadOnlyInline, ShoppingWeakness, Sighting,\n12.     SomeChildModel, SomeParentModel, SottoCapo, Title, TitleCollection,\n13. )\n14. \n15. site = admin.AdminSite(name="admin")\n16. \n17. \n18. class BookInline(admin.TabularInline):\n19.     model = Author.books.through\n20. \n21. \n22. class NonAutoPKBookTabularInline(admin.TabularInline):\n23.     model = NonAutoPKBook\n24.     classes = (\'collapse\',)\n25. \n26. \n27. class NonAutoPKBookChildTabularInline(admin.TabularInline):\n28.     model = NonAutoPKBookChild\n29.     classes = (\'collapse\',)\n30. \n31. \n32. class NonAutoPKBookStackedInline(admin.StackedInline):\n33.     model = NonAutoPKBook\n34.     classes = (\'collapse\',)\n35. \n36. \n37. class EditablePKBookTabularInline(admin.TabularInline):\n38.     model = EditablePKBook\n39. \n40. \n41. class EditablePKBookStackedInline(admin.StackedInline):\n42.     model = EditablePKBook\n43. \n44. \n45. class AuthorAdmin(admin.ModelAdmin):\n46.     inlines = [\n47.         BookInline, NonAutoPKBookTabularInline, NonAutoPKBookStackedInline,\n48.         EditablePKBookTabularInline, EditablePKBookStackedInline,\n49.         NonAutoPKBookChildTabularInline,\n50.     ]\n51. \n52. \n53. class InnerInline(admin.StackedInline):\n54.     model = Inner\n55.     can_delete = False\n56.     readonly_fields = (\'readonly\',)  # For bug #13174 tests.\n57. \n58. \n59. class HolderAdmin(admin.ModelAdmin):\n60. \n61.     class Media:\n62.         js = (\'my_awesome_admin_scripts.js\',)\n63. \n64. \n65. class ReadOnlyInlineInline(admin.TabularInline):\n66.     model = ReadOnlyInline\n67.     readonly_fields = [\'name\']\n68. \n69. \n70. class InnerInline2(admin.StackedInline):\n71.     model = Inner2\n72. \n73.     class Media:\n74.         js = (\'my_awesome_inline_scripts.js\',)\n75. \n76. \n77. class InnerInline2Tabular(admin.TabularInline):\n78.     model = Inner2\n79. \n80. \n81. class CustomNumberWidget(forms.NumberInput):\n82.     class Media:\n83.         js = (\'custom_number.js\',)\n84. \n85. \n86. class InnerInline3(admin.StackedInline):\n87.     model = Inner3\n88.     formfield_overrides = {\n89.         models.IntegerField: {\'widget\': CustomNumberWidget},\n90.     }\n91. \n92.     class Media:\n93.         js = (\'my_awesome_inline_scripts.js\',)\n94. \n95. \n96. class TitleForm(forms.ModelForm):\n97.     title1 = forms.CharField(max_length=100)\n98. \n99.     def clean(self):\n100.         cleaned_data = self.cleaned_data\n101.         title1 = cleaned_data.get("title1")\n102.         title2 = cleaned_data.get("title2")\n103.         if title1 != title2:\n104.             raise forms.ValidationError("The two titles must be the same")\n105.         return cleaned_data\n106. \n107. \n108. class TitleInline(admin.TabularInline):\n109.     model = Title\n110.     form = TitleForm\n111.     extra = 1\n112. \n113. \n114. class Inner4StackedInline(admin.StackedInline):\n115.     model = Inner4Stacked\n116.     show_change_link = True\n117. \n118. \n119. class Inner4TabularInline(admin.TabularInline):\n120.     model = Inner4Tabular\n121.     show_change_link = True\n122. \n123. \n124. class Holder4Admin(admin.ModelAdmin):\n125.     inlines = [Inner4StackedInline, Inner4TabularInline]\n126. \n127. \n128. class InlineWeakness(admin.TabularInline):\n129.     model = ShoppingWeakness\n130.     extra = 1\n131. \n132. \n133. class QuestionInline(admin.TabularInline):\n134.     model = Question\n135.     readonly_fields = [\'call_me\']\n136. \n137.     def call_me(self, obj):\n138.         return \'Callable in QuestionInline\'\n139. \n140. \n141. class PollAdmin(admin.ModelAdmin):\n142.     inlines = [QuestionInline]\n143. \n144.     def call_me(self, obj):\n145.         return \'Callable in PollAdmin\'\n146. \n147. \n148. class ChapterInline(admin.TabularInline):\n149.     model = Chapter\n150.     readonly_fields = [\'call_me\']\n151. \n152.     def call_me(self, obj):\n153.         return \'Callable in ChapterInline\'\n154. \n155. \n156. class NovelAdmin(admin.ModelAdmin):\n157.     inlines = [ChapterInline]\n158. \n159. \n160. class ReadOnlyChapterInline(admin.TabularInline):\n161.     model = Chapter\n162. \n163.     def has_change_permission(self, request, obj=None):\n164.         return False\n165. \n166. \n167. class NovelReadonlyChapterAdmin(admin.ModelAdmin):\n168.     inlines = [ReadOnlyChapterInline]\n169. \n170. \n171. class ConsigliereInline(admin.TabularInline):\n172.     model = Consigliere\n173. \n174. \n175. class SottoCapoInline(admin.TabularInline):\n176.     model = SottoCapo\n177. \n178. \n179. class ProfileInline(admin.TabularInline):\n180.     model = Profile\n181.     extra = 1\n182. \n183. \n184. # admin for #18433\n185. class ChildModel1Inline(admin.TabularInline):\n186.     model = ChildModel1\n187. \n188. \n189. class ChildModel2Inline(admin.StackedInline):\n190.     model = ChildModel2\n191. \n192. \n193. # admin for #19425 and #18388\n194. class BinaryTreeAdmin(admin.TabularInline):\n195.     model = BinaryTree\n196. \n197.     def get_extra(self, request, obj=None, **kwargs):\n198.         extra = 2\n199.         if obj:\n200.             return extra - obj.binarytree_set.count()\n201.         return extra\n202. \n203.     def get_max_num(self, request, obj=None, **kwargs):\n204.         max_num = 3\n205.         if obj:\n206.             return max_num - obj.binarytree_set.count()\n207.         return max_num\n208. \n209. \n210. # admin for #19524\n211. class SightingInline(admin.TabularInline):\n212.     model = Sighting\n213. \n214. \n215. # admin and form for #18263\n216. class SomeChildModelForm(forms.ModelForm):\n217. \n218.     class Meta:\n219.         fields = \'__all__\'\n220.         model = SomeChildModel\n221.         widgets = {\n222.             \'position\': forms.HiddenInput,\n223.         }\n224.         labels = {\'readonly_field\': \'Label from ModelForm.Meta\'}\n225.         help_texts = {\'readonly_field\': \'Help text from ModelForm.Meta\'}\n226. \n227.     def __init__(self, *args, **kwargs):\n228.         super().__init__(*args, **kwargs)\n229.         self.fields[\'name\'].label = \'new label\'\n230. \n231. \n232. class SomeChildModelInline(admin.TabularInline):\n233.     model = SomeChildModel\n234.     form = SomeChildModelForm\n235.     readonly_fields = (\'readonly_field\',)\n236. \n237. \n238. site.register(TitleCollection, inlines=[TitleInline])\n239. # Test bug #12561 and #12778\n240. # only ModelAdmin media\n241. site.register(Holder, HolderAdmin, inlines=[InnerInline])\n242. # ModelAdmin and Inline media\n243. site.register(Holder2, HolderAdmin, inlines=[InnerInline2, InnerInline2Tabular])\n244. # only Inline media\n245. site.register(Holder3, inlines=[InnerInline3])\n246. \n247. site.register(Poll, PollAdmin)\n248. site.register(Novel, NovelAdmin)\n249. site.register(NovelReadonlyChapter, NovelReadonlyChapterAdmin)\n250. site.register(Fashionista, inlines=[InlineWeakness])\n251. site.register(Holder4, Holder4Admin)\n252. site.register(Author, AuthorAdmin)\n253. site.register(CapoFamiglia, inlines=[ConsigliereInline, SottoCapoInline, ReadOnlyInlineInline])\n254. site.register(ProfileCollection, inlines=[ProfileInline])\n255. site.register(ParentModelWithCustomPk, inlines=[ChildModel1Inline, ChildModel2Inline])\n256. site.register(BinaryTree, inlines=[BinaryTreeAdmin])\n257. site.register(ExtraTerrestrial, inlines=[SightingInline])\n258. site.register(SomeParentModel, inlines=[SomeChildModelInline])\n259. site.register([Question, Inner4Stacked, Inner4Tabular])', start_line_number=1, end_line_number=259), Context(relative_path='tests/admin_inlines/tests.py', content='568. class TestInlinePermissions(TestCase):\n569.     """\n570.     Make sure the admin respects permissions for objects that are edited\n571.     inline. Refs #8060.\n572.     """\n573. \n574.     @classmethod\n575.     def setUpTestData(cls):\n576.         cls.user = User(username=\'admin\', is_staff=True, is_active=True)\n577.         cls.user.set_password(\'secret\')\n578.         cls.user.save()\n579. \n580.         cls.author_ct = ContentType.objects.get_for_model(Author)\n581.         cls.holder_ct = ContentType.objects.get_for_model(Holder2)\n582.         cls.book_ct = ContentType.objects.get_for_model(Book)\n583.         cls.inner_ct = ContentType.objects.get_for_model(Inner2)\n584. \n585.         # User always has permissions to add and change Authors, and Holders,\n586.         # the main (parent) models of the inlines. Permissions on the inlines\n587.         # vary per test.\n588.         permission = Permission.objects.get(codename=\'add_author\', content_type=cls.author_ct)\n589.         cls.user.user_permissions.add(permission)\n590.         permission = Permission.objects.get(codename=\'change_author\', content_type=cls.author_ct)\n591.         cls.user.user_permissions.add(permission)\n592.         permission = Permission.objects.get(codename=\'add_holder2\', content_type=cls.holder_ct)\n593.         cls.user.user_permissions.add(permission)\n594.         permission = Permission.objects.get(codename=\'change_holder2\', content_type=cls.holder_ct)\n595.         cls.user.user_permissions.add(permission)\n596. \n597.         author = Author.objects.create(pk=1, name=\'The Author\')\n598.         cls.book = author.books.create(name=\'The inline Book\')\n599.         cls.author_change_url = reverse(\'admin:admin_inlines_author_change\', args=(author.id,))\n600.         # Get the ID of the automatically created intermediate model for the Author-Book m2m\n601.         author_book_auto_m2m_intermediate = Author.books.through.objects.get(author=author, book=cls.book)\n602.         cls.author_book_auto_m2m_intermediate_id = author_book_auto_m2m_intermediate.pk\n603. \n604.         cls.holder = Holder2.objects.create(dummy=13)\n605.         cls.inner2 = Inner2.objects.create(dummy=42, holder=cls.holder)\n606. \n607.     def setUp(self):\n608.         self.holder_change_url = reverse(\'admin:admin_inlines_holder2_change\', args=(self.holder.id,))\n609.         self.client.force_login(self.user)\n610. \n611.     def test_inline_add_m2m_noperm(self):\n612.         response = self.client.get(reverse(\'admin:admin_inlines_author_add\'))\n613.         # No change permission on books, so no inline\n614.         self.assertNotContains(response, \'<h2>Author-book relationships</h2>\')\n615.         self.assertNotContains(response, \'Add another Author-Book Relationship\')\n616.         self.assertNotContains(response, \'id="id_Author_books-TOTAL_FORMS"\')\n617. \n618.     def test_inline_add_fk_noperm(self):\n619.         response = self.client.get(reverse(\'admin:admin_inlines_holder2_add\'))\n620.         # No permissions on Inner2s, so no inline\n621.         self.assertNotContains(response, \'<h2>Inner2s</h2>\')\n622.         self.assertNotContains(response, \'Add another Inner2\')\n623.         self.assertNotContains(response, \'id="id_inner2_set-TOTAL_FORMS"\')\n624. \n625.     def test_inline_change_m2m_noperm(self):\n626.         response = self.client.get(self.author_change_url)\n627.         # No change permission on books, so no inline\n628.         self.assertNotContains(response, \'<h2>Author-book relationships</h2>\')\n629.         self.assertNotContains(response, \'Add another Author-Book Relationship\')\n630.         self.assertNotContains(response, \'id="id_Author_books-TOTAL_FORMS"\')\n631. \n632.     def test_inline_change_fk_noperm(self):\n633.         response = self.client.get(self.holder_change_url)\n634.         # No permissions on Inner2s, so no inline\n635.         self.assertNotContains(response, \'<h2>Inner2s</h2>\')\n636.         self.assertNotContains(response, \'Add another Inner2\')\n637.         self.assertNotContains(response, \'id="id_inner2_set-TOTAL_FORMS"\')\n638. \n639.     def test_inline_add_m2m_view_only_perm(self):\n640.         permission = Permission.objects.get(codename=\'view_book\', content_type=self.book_ct)\n641.         self.user.user_permissions.add(permission)\n642.         response = self.client.get(reverse(\'admin:admin_inlines_author_add\'))\n643.         # View-only inlines. (It could be nicer to hide the empty, non-editable\n644.         # inlines on the add page.)\n645.         self.assertIs(response.context[\'inline_admin_formset\'].has_view_permission, True)\n646.         self.assertIs(response.context[\'inline_admin_formset\'].has_add_permission, False)\n647.         self.assertIs(response.context[\'inline_admin_formset\'].has_change_permission, False)\n648.         self.assertIs(response.context[\'inline_admin_formset\'].has_delete_permission, False)\n649.         self.assertContains(response, \'<h2>Author-book relationships</h2>\')\n650.         self.assertContains(\n651.             response,\n652.             \'<input type="hidden" name="Author_books-TOTAL_FORMS" value="0" \'\n653.             \'id="id_Author_books-TOTAL_FORMS">\',\n654.             html=True,\n655.         )\n656.         self.assertNotContains(response, \'Add another Author-Book Relationship\')\n657. \n658.     def test_inline_add_m2m_add_perm(self):\n659.         permission = Permission.objects.get(codename=\'add_book\', content_type=self.book_ct)\n660.         self.user.user_permissions.add(permission)\n661.         response = self.client.get(reverse(\'admin:admin_inlines_author_add\'))\n662.         # No change permission on Books, so no inline\n663.         self.assertNotContains(response, \'<h2>Author-book relationships</h2>\')\n664.         self.assertNotContains(response, \'Add another Author-Book Relationship\')\n665.         self.assertNotContains(response, \'id="id_Author_books-TOTAL_FORMS"\')\n666. \n667.     def test_inline_add_fk_add_perm(self):\n668.         permission = Permission.objects.get(codename=\'add_inner2\', content_type=self.inner_ct)\n669.         self.user.user_permissions.add(permission)\n670.         response = self.client.get(reverse(\'admin:admin_inlines_holder2_add\'))\n671.         # Add permission on inner2s, so we get the inline\n672.         self.assertContains(response, \'<h2>Inner2s</h2>\')\n673.         self.assertContains(response, \'Add another Inner2\')\n674.         self.assertContains(response, \'<input type="hidden" id="id_inner2_set-TOTAL_FORMS" \'\n675.                             \'value="3" name="inner2_set-TOTAL_FORMS">\', html=True)\n676. \n677.     def test_inline_change_m2m_add_perm(self):\n678.         permission = Permission.objects.get(codename=\'add_book\', content_type=self.book_ct)\n679.         self.user.user_permissions.add(permission)\n680.         response = self.client.get(self.author_change_url)\n681.         # No change permission on books, so no inline\n682.         self.assertNotContains(response, \'<h2>Author-book relationships</h2>\')\n683.         self.assertNotContains(response, \'Add another Author-Book Relationship\')\n684.         self.assertNotContains(response, \'id="id_Author_books-TOTAL_FORMS"\')\n685.         self.assertNotContains(response, \'id="id_Author_books-0-DELETE"\')\n686. \n687.     def test_inline_change_m2m_view_only_perm(self):\n688.         permission = Permission.objects.get(codename=\'view_book\', content_type=self.book_ct)\n689.         self.user.user_permissions.add(permission)\n690.         response = self.client.get(self.author_change_url)\n691.         # View-only inlines.\n692.         self.assertIs(response.context[\'inline_admin_formset\'].has_view_permission, True)\n693.         self.assertIs(response.context[\'inline_admin_formset\'].has_add_permission, False)\n694.         self.assertIs(response.context[\'inline_admin_formset\'].has_change_permission, False)\n695.         self.assertIs(response.context[\'inline_admin_formset\'].has_delete_permission, False)\n696.         self.assertContains(response, \'<h2>Author-book relationships</h2>\')\n697.         self.assertContains(\n698.             response,\n699.             \'<input type="hidden" name="Author_books-TOTAL_FORMS" value="1" \'\n700.             \'id="id_Author_books-TOTAL_FORMS">\',\n701.             html=True,\n702.         )\n703.         # The field in the inline is read-only.\n704.         self.assertContains(response, \'<p>%s</p>\' % self.book)\n705.         self.assertNotContains(\n706.             response,\n707.             \'<input type="checkbox" name="Author_books-0-DELETE" id="id_Author_books-0-DELETE">\',\n708.             html=True,\n709.         )\n710. \n711.     def test_inline_change_m2m_change_perm(self):\n712.         permission = Permission.objects.get(codename=\'change_book\', content_type=self.book_ct)\n713.         self.user.user_permissions.add(permission)\n714.         response = self.client.get(self.author_change_url)\n715.         # We have change perm on books, so we can add/change/delete inlines\n716.         self.assertIs(response.context[\'inline_admin_formset\'].has_view_permission, True)\n717.         self.assertIs(response.context[\'inline_admin_formset\'].has_add_permission, True)\n718.         self.assertIs(response.context[\'inline_admin_formset\'].has_change_permission, True)\n719.         self.assertIs(response.context[\'inline_admin_formset\'].has_delete_permission, True)\n720.         self.assertContains(response, \'<h2>Author-book relationships</h2>\')\n721.         self.assertContains(response, \'Add another Author-book relationship\')\n722.         self.assertContains(response, \'<input type="hidden" id="id_Author_books-TOTAL_FORMS" \'\n723.                             \'value="4" name="Author_books-TOTAL_FORMS">\', html=True)\n724.         self.assertContains(\n725.             response,\n726.             \'<input type="hidden" id="id_Author_books-0-id" value="%i" \'\n727.             \'name="Author_books-0-id">\' % self.author_book_auto_m2m_intermediate_id,\n728.             html=True\n729.         )\n730.         self.assertContains(response, \'id="id_Author_books-0-DELETE"\')\n731. \n732.     def test_inline_change_fk_add_perm(self):\n733.         permission = Permission.objects.get(codename=\'add_inner2\', content_type=self.inner_ct)\n734.         self.user.user_permissions.add(permission)\n735.         response = self.client.get(self.holder_change_url)\n736.         # Add permission on inner2s, so we can add but not modify existing\n737.         self.assertContains(response, \'<h2>Inner2s</h2>\')\n738.         self.assertContains(response, \'Add another Inner2\')\n739.         # 3 extra forms only, not the existing instance form\n740.         self.assertContains(\n741.             response,\n742.             \'<input type="hidden" id="id_inner2_set-TOTAL_FORMS" value="3" \'\n743.             \'name="inner2_set-TOTAL_FORMS">\',\n744.             html=True\n745.         )\n746.         self.assertNotContains(\n747.             response,\n748.             \'<input type="hidden" id="id_inner2_set-0-id" value="%i" name="inner2_set-0-id">\' % self.inner2.id,\n749.             html=True\n750.         )\n751. \n752.     def test_inline_change_fk_change_perm(self):\n753.         permission = Permission.objects.get(codename=\'change_inner2\', content_type=self.inner_ct)\n754.         self.user.user_permissions.add(permission)\n755.         response = self.client.get(self.holder_change_url)\n756.         # Change permission on inner2s, so we can change existing but not add new\n757.         self.assertContains(response, \'<h2>Inner2s</h2>\', count=2)\n758.         # Just the one form for existing instances\n759.         self.assertContains(\n760.             response, \'<input type="hidden" id="id_inner2_set-TOTAL_FORMS" value="1" name="inner2_set-TOTAL_FORMS">\',\n761.             html=True\n762.         )\n763.         self.assertContains(\n764.             response,\n765.             \'<input type="hidden" id="id_inner2_set-0-id" value="%i" name="inner2_set-0-id">\' % self.inner2.id,\n766.             html=True\n767.         )\n768.         # max-num 0 means we can\'t add new ones\n769.         self.assertContains(\n770.             response,\n771.             \'<input type="hidden" id="id_inner2_set-MAX_NUM_FORMS" value="0" name="inner2_set-MAX_NUM_FORMS">\',\n772.             html=True\n773.         )\n774.         # TabularInline\n775.         self.assertContains(response, \'<th class="column-dummy required">Dummy</th>\', html=True)\n776.         self.assertContains(\n777.             response,\n778.             \'<input type="number" name="inner2_set-2-0-dummy" value="%s" \'\n779.             \'class="vIntegerField" id="id_inner2_set-2-0-dummy">\' % self.inner2.dummy,\n780.             html=True,\n781.         )\n782. \n783.     def test_inline_change_fk_add_change_perm(self):\n784.         permission = Permission.objects.get(codename=\'add_inner2\', content_type=self.inner_ct)\n785.         self.user.user_permissions.add(permission)\n786.         permission = Permission.objects.get(codename=\'change_inner2\', content_type=self.inner_ct)\n787.         self.user.user_permissions.add(permission)\n788.         response = self.client.get(self.holder_change_url)\n789.         # Add/change perm, so we can add new and change existing\n790.         self.assertContains(response, \'<h2>Inner2s</h2>\')\n791.         # One form for existing instance and three extra for new\n792.         self.assertContains(\n793.             response, \'<input type="hidden" id="id_inner2_set-TOTAL_FORMS" value="4" name="inner2_set-TOTAL_FORMS">\',\n794.             html=True\n795.         )\n796.         self.assertContains(\n797.             response,\n798.             \'<input type="hidden" id="id_inner2_set-0-id" value="%i" name="inner2_set-0-id">\' % self.inner2.id,\n799.             html=True\n800.         )\n801. \n802.     def test_inline_change_fk_change_del_perm(self):\n803.         permission = Permission.objects.get(codename=\'change_inner2\', content_type=self.inner_ct)\n804.         self.user.user_permissions.add(permission)\n805.         permission = Permission.objects.get(codename=\'delete_inner2\', content_type=self.inner_ct)\n806.         self.user.user_permissions.add(permission)\n807.         response = self.client.get(self.holder_change_url)\n808.         # Change/delete perm on inner2s, so we can change/delete existing\n809.         self.assertContains(response, \'<h2>Inner2s</h2>\')\n810.         # One form for existing instance only, no new\n811.         self.assertContains(\n812.             response,\n813.             \'<input type="hidden" id="id_inner2_set-TOTAL_FORMS" value="1" name="inner2_set-TOTAL_FORMS">\',\n814.             html=True\n815.         )\n816.         self.assertContains(\n817.             response,\n818.             \'<input type="hidden" id="id_inner2_set-0-id" value="%i" name="inner2_set-0-id">\' % self.inner2.id,\n819.             html=True\n820.         )\n821.         self.assertContains(response, \'id="id_inner2_set-0-DELETE"\')\n822. \n823.     def test_inline_change_fk_all_perms(self):\n824.         permission = Permission.objects.get(codename=\'add_inner2\', content_type=self.inner_ct)\n825.         self.user.user_permissions.add(permission)\n826.         permission = Permission.objects.get(codename=\'change_inner2\', content_type=self.inner_ct)\n827.         self.user.user_permissions.add(permission)\n828.         permission = Permission.objects.get(codename=\'delete_inner2\', content_type=self.inner_ct)\n829.         self.user.user_permissions.add(permission)\n830.         response = self.client.get(self.holder_change_url)\n831.         # All perms on inner2s, so we can add/change/delete\n832.         self.assertContains(response, \'<h2>Inner2s</h2>\', count=2)\n833.         # One form for existing instance only, three for new\n834.         self.assertContains(\n835.             response,\n836.             \'<input type="hidden" id="id_inner2_set-TOTAL_FORMS" value="4" name="inner2_set-TOTAL_FORMS">\',\n837.             html=True\n838.         )\n839.         self.assertContains(\n840.             response,\n841.             \'<input type="hidden" id="id_inner2_set-0-id" value="%i" name="inner2_set-0-id">\' % self.inner2.id,\n842.             html=True\n843.         )\n844.         self.assertContains(response, \'id="id_inner2_set-0-DELETE"\')\n845.         # TabularInline\n846.         self.assertContains(response, \'<th class="column-dummy required">Dummy</th>\', html=True)\n847.         self.assertContains(\n848.             response,\n849.             \'<input type="number" name="inner2_set-2-0-dummy" value="%s" \'\n850.             \'class="vIntegerField" id="id_inner2_set-2-0-dummy">\' % self.inner2.dummy,\n851.             html=True,\n852.         )\n853. ', start_line_number=568, end_line_number=853), Context(relative_path='tests/admin_inlines/tests.py', content='28. @override_settings(ROOT_URLCONF=\'admin_inlines.urls\')\n29. class TestInline(TestDataMixin, TestCase):\n30.     factory = RequestFactory()\n31. \n32.     @classmethod\n33.     def setUpTestData(cls):\n34.         super().setUpTestData()\n35.         cls.holder = Holder.objects.create(dummy=13)\n36.         Inner.objects.create(dummy=42, holder=cls.holder)\n37. \n38.     def setUp(self):\n39.         self.client.force_login(self.superuser)\n40. \n41.     def test_can_delete(self):\n42.         """\n43.         can_delete should be passed to inlineformset factory.\n44.         """\n45.         response = self.client.get(\n46.             reverse(\'admin:admin_inlines_holder_change\', args=(self.holder.id,))\n47.         )\n48.         inner_formset = response.context[\'inline_admin_formsets\'][0].formset\n49.         expected = InnerInline.can_delete\n50.         actual = inner_formset.can_delete\n51.         self.assertEqual(expected, actual, \'can_delete must be equal\')\n52. \n53.     def test_readonly_stacked_inline_label(self):\n54.         """Bug #13174."""\n55.         holder = Holder.objects.create(dummy=42)\n56.         Inner.objects.create(holder=holder, dummy=42, readonly=\'\')\n57.         response = self.client.get(\n58.             reverse(\'admin:admin_inlines_holder_change\', args=(holder.id,))\n59.         )\n60.         self.assertContains(response, \'<label>Inner readonly label:</label>\')\n61. \n62.     def test_many_to_many_inlines(self):\n63.         "Autogenerated many-to-many inlines are displayed correctly (#13407)"\n64.         response = self.client.get(reverse(\'admin:admin_inlines_author_add\'))\n65.         # The heading for the m2m inline block uses the right text\n66.         self.assertContains(response, \'<h2>Author-book relationships</h2>\')\n67.         # The "add another" label is correct\n68.         self.assertContains(response, \'Add another Author-book relationship\')\n69.         # The \'+\' is dropped from the autogenerated form prefix (Author_books+)\n70.         self.assertContains(response, \'id="id_Author_books-TOTAL_FORMS"\')\n71. \n72.     def test_inline_primary(self):\n73.         person = Person.objects.create(firstname=\'Imelda\')\n74.         item = OutfitItem.objects.create(name=\'Shoes\')\n75.         # Imelda likes shoes, but can\'t carry her own bags.\n76.         data = {\n77.             \'shoppingweakness_set-TOTAL_FORMS\': 1,\n78.             \'shoppingweakness_set-INITIAL_FORMS\': 0,\n79.             \'shoppingweakness_set-MAX_NUM_FORMS\': 0,\n80.             \'_save\': \'Save\',\n81.             \'person\': person.id,\n82.             \'max_weight\': 0,\n83.             \'shoppingweakness_set-0-item\': item.id,\n84.         }\n85.         response = self.client.post(reverse(\'admin:admin_inlines_fashionista_add\'), data)\n86.         self.assertEqual(response.status_code, 302)\n87.         self.assertEqual(len(Fashionista.objects.filter(person__firstname=\'Imelda\')), 1)\n88. \n89.     def test_tabular_inline_column_css_class(self):\n90.         """\n91.         Field names are included in the context to output a field-specific\n92.         CSS class name in the column headers.\n93.         """\n94.         response = self.client.get(reverse(\'admin:admin_inlines_poll_add\'))\n95.         text_field, call_me_field = list(response.context[\'inline_admin_formset\'].fields())\n96.         # Editable field.\n97.         self.assertEqual(text_field[\'name\'], \'text\')\n98.         self.assertContains(response, \'<th class="column-text required">\')\n99.         # Read-only field.\n100.         self.assertEqual(call_me_field[\'name\'], \'call_me\')\n101.         self.assertContains(response, \'<th class="column-call_me">\')\n102. \n103.     def test_custom_form_tabular_inline_label(self):\n104.         """\n105.         A model form with a form field specified (TitleForm.title1) should have\n106.         its label rendered in the tabular inline.\n107.         """\n108.         response = self.client.get(reverse(\'admin:admin_inlines_titlecollection_add\'))\n109.         self.assertContains(response, \'<th class="column-title1 required">Title1</th>\', html=True)\n110. \n111.     def test_custom_form_tabular_inline_overridden_label(self):\n112.         """\n113.         SomeChildModelForm.__init__() overrides the label of a form field.\n114.         That label is displayed in the TabularInline.\n115.         """\n116.         response = self.client.get(reverse(\'admin:admin_inlines_someparentmodel_add\'))\n117.         field = list(response.context[\'inline_admin_formset\'].fields())[0]\n118.         self.assertEqual(field[\'label\'], \'new label\')\n119.         self.assertContains(response, \'<th class="column-name required">New label</th>\', html=True)\n120. \n121.     def test_tabular_non_field_errors(self):\n122.         """\n123.         non_field_errors are displayed correctly, including the correct value\n124.         for colspan.\n125.         """\n126.         data = {\n127.             \'title_set-TOTAL_FORMS\': 1,\n128.             \'title_set-INITIAL_FORMS\': 0,\n129.             \'title_set-MAX_NUM_FORMS\': 0,\n130.             \'_save\': \'Save\',\n131.             \'title_set-0-title1\': \'a title\',\n132.             \'title_set-0-title2\': \'a different title\',\n133.         }\n134.         response = self.client.post(reverse(\'admin:admin_inlines_titlecollection_add\'), data)\n135.         # Here colspan is "4": two fields (title1 and title2), one hidden field and the delete checkbox.\n136.         self.assertContains(\n137.             response,\n138.             \'<tr><td colspan="4"><ul class="errorlist nonfield">\'\n139.             \'<li>The two titles must be the same</li></ul></td></tr>\'\n140.         )\n141. \n142.     def test_no_parent_callable_lookup(self):\n143.         """Admin inline `readonly_field` shouldn\'t invoke parent ModelAdmin callable"""\n144.         # Identically named callable isn\'t present in the parent ModelAdmin,\n145.         # rendering of the add view shouldn\'t explode\n146.         response = self.client.get(reverse(\'admin:admin_inlines_novel_add\'))\n147.         self.assertEqual(response.status_code, 200)\n148.         # View should have the child inlines section\n149.         self.assertContains(\n150.             response,\n151.             \'<div class="js-inline-admin-formset inline-group" id="chapter_set-group"\'\n152.         )\n153. \n154.     def test_callable_lookup(self):\n155.         """Admin inline should invoke local callable when its name is listed in readonly_fields"""\n156.         response = self.client.get(reverse(\'admin:admin_inlines_poll_add\'))\n157.         self.assertEqual(response.status_code, 200)\n158.         # Add parent object view should have the child inlines section\n159.         self.assertContains(\n160.             response,\n161.             \'<div class="js-inline-admin-formset inline-group" id="question_set-group"\'\n162.         )\n163.         # The right callable should be used for the inline readonly_fields\n164.         # column cells\n165.         self.assertContains(response, \'<p>Callable in QuestionInline</p>\')\n166. \n167.     def test_help_text(self):\n168.         """\n169.         The inlines\' model field help texts are displayed when using both the\n170.         stacked and tabular layouts.\n171.         """\n172.         response = self.client.get(reverse(\'admin:admin_inlines_holder4_add\'))\n173.         self.assertContains(response, \'<div class="help">Awesome stacked help text is awesome.</div>\', 4)\n174.         self.assertContains(\n175.             response,\n176.             \'<img src="/static/admin/img/icon-unknown.svg" \'\n177.             \'class="help help-tooltip" width="10" height="10" \'\n178.             \'alt="(Awesome tabular help text is awesome.)" \'\n179.             \'title="Awesome tabular help text is awesome.">\',\n180.             1\n181.         )\n182.         # ReadOnly fields\n183.         response = self.client.get(reverse(\'admin:admin_inlines_capofamiglia_add\'))\n184.         self.assertContains(\n185.             response,\n186.             \'<img src="/static/admin/img/icon-unknown.svg" \'\n187.             \'class="help help-tooltip" width="10" height="10" \'\n188.             \'alt="(Help text for ReadOnlyInline)" \'\n189.             \'title="Help text for ReadOnlyInline">\',\n190.             1\n191.         )\n192. \n193.     def test_tabular_model_form_meta_readonly_field(self):\n194.         """\n195.         Tabular inlines use ModelForm.Meta.help_texts and labels for read-only\n196.         fields.\n197.         """\n198.         response = self.client.get(reverse(\'admin:admin_inlines_someparentmodel_add\'))\n199.         self.assertContains(\n200.             response,\n201.             \'<img src="/static/admin/img/icon-unknown.svg" \'\n202.             \'class="help help-tooltip" width="10" height="10" \'\n203.             \'alt="(Help text from ModelForm.Meta)" \'\n204.             \'title="Help text from ModelForm.Meta">\'\n205.         )\n206.         self.assertContains(response, \'Label from ModelForm.Meta\')\n207. \n208.     def test_inline_hidden_field_no_column(self):\n209.         """#18263 -- Make sure hidden fields don\'t get a column in tabular inlines"""\n210.         parent = SomeParentModel.objects.create(name=\'a\')\n211.         SomeChildModel.objects.create(name=\'b\', position=\'0\', parent=parent)\n212.         SomeChildModel.objects.create(name=\'c\', position=\'1\', parent=parent)\n213.         response = self.client.get(reverse(\'admin:admin_inlines_someparentmodel_change\', args=(parent.pk,)))\n214.         self.assertNotContains(response, \'<td class="field-position">\')\n215.         self.assertInHTML(\n216.             \'<input id="id_somechildmodel_set-1-position" \'\n217.             \'name="somechildmodel_set-1-position" type="hidden" value="1">\',\n218.             response.rendered_content,\n219.         )\n220. \n221.     def test_non_related_name_inline(self):\n222.         """\n223.         Multiple inlines with related_name=\'+\' have correct form prefixes.\n224.         """\n225.         response = self.client.get(reverse(\'admin:admin_inlines_capofamiglia_add\'))\n226.         self.assertContains(response, \'<input type="hidden" name="-1-0-id" id="id_-1-0-id">\', html=True)\n227.         self.assertContains(\n228.             response,\n229.             \'<input type="hidden" name="-1-0-capo_famiglia" id="id_-1-0-capo_famiglia">\',\n230.             html=True\n231.         )\n232.         self.assertContains(\n233.             response,\n234.             \'<input id="id_-1-0-name" type="text" class="vTextField" name="-1-0-name" maxlength="100">\',\n235.             html=True\n236.         )\n237.         self.assertContains(response, \'<input type="hidden" name="-2-0-id" id="id_-2-0-id">\', html=True)\n238.         self.assertContains(\n239.             response,\n240.             \'<input type="hidden" name="-2-0-capo_famiglia" id="id_-2-0-capo_famiglia">\',\n241.             html=True\n242.         )\n243.         self.assertContains(\n244.             response,\n245.             \'<input id="id_-2-0-name" type="text" class="vTextField" name="-2-0-name" maxlength="100">\',\n246.             html=True\n247.         )\n248. \n249.     @override_settings(USE_L10N=True, USE_THOUSAND_SEPARATOR=True)\n250.     def test_localize_pk_shortcut(self):\n251.         """\n252.         The "View on Site" link is correct for locales that use thousand\n253.         separators.\n254.         """\n255.         holder = Holder.objects.create(pk=123456789, dummy=42)\n256.         inner = Inner.objects.create(pk=987654321, holder=holder, dummy=42, readonly=\'\')\n257.         response = self.client.get(reverse(\'admin:admin_inlines_holder_change\', args=(holder.id,)))\n258.         inner_shortcut = \'r/%s/%s/\' % (ContentType.objects.get_for_model(inner).pk, inner.pk)\n259.         self.assertContains(response, inner_shortcut)\n260. \n261.     def test_custom_pk_shortcut(self):\n262.         """\n263.         The "View on Site" link is correct for models with a custom primary key\n264.         field.\n265.         """\n266.         parent = ParentModelWithCustomPk.objects.create(my_own_pk="foo", name="Foo")\n267.         child1 = ChildModel1.objects.create(my_own_pk="bar", name="Bar", parent=parent)\n268.         child2 = ChildModel2.objects.create(my_own_pk="baz", name="Baz", parent=parent)\n269.         response = self.client.get(reverse(\'admin:admin_inlines_parentmodelwithcustompk_change\', args=(\'foo\',)))\n270.         child1_shortcut = \'r/%s/%s/\' % (ContentType.objects.get_for_model(child1).pk, child1.pk)\n271.         child2_shortcut = \'r/%s/%s/\' % (ContentType.objects.get_for_model(child2).pk, child2.pk)\n272.         self.assertContains(response, child1_shortcut)\n273.         self.assertContains(response, child2_shortcut)\n274. \n275.     def test_create_inlines_on_inherited_model(self):\n276.         """\n277.         An object can be created with inlines when it inherits another class.\n278.         """\n279.         data = {\n280.             \'name\': \'Martian\',\n281.             \'sighting_set-TOTAL_FORMS\': 1,\n282.             \'sighting_set-INITIAL_FORMS\': 0,\n283.             \'sighting_set-MAX_NUM_FORMS\': 0,\n284.             \'sighting_set-0-place\': \'Zone 51\',\n285.             \'_save\': \'Save\',\n286.         }\n287.         response = self.client.post(reverse(\'admin:admin_inlines_extraterrestrial_add\'), data)\n288.         self.assertEqual(response.status_code, 302)\n289.         self.assertEqual(Sighting.objects.filter(et__name=\'Martian\').count(), 1)\n290. \n291.     def test_custom_get_extra_form(self):\n292.         bt_head = BinaryTree.objects.create(name="Tree Head")\n293.         BinaryTree.objects.create(name="First Child", parent=bt_head)\n294.         # The maximum number of forms should respect \'get_max_num\' on the\n295.         # ModelAdmin\n296.         max_forms_input = (\n297.             \'<input id="id_binarytree_set-MAX_NUM_FORMS" \'\n298.             \'name="binarytree_set-MAX_NUM_FORMS" type="hidden" value="%d">\'\n299.         )\n300.         # The total number of forms will remain the same in either case\n301.         total_forms_hidden = (\n302.             \'<input id="id_binarytree_set-TOTAL_FORMS" \'\n303.             \'name="binarytree_set-TOTAL_FORMS" type="hidden" value="2">\'\n304.         )\n305.         response = self.client.get(reverse(\'admin:admin_inlines_binarytree_add\'))\n306.         self.assertInHTML(max_forms_input % 3, response.rendered_content)\n307.         self.assertInHTML(total_forms_hidden, response.rendered_content)\n308. \n309.         response = self.client.get(reverse(\'admin:admin_inlines_binarytree_change\', args=(bt_head.id,)))\n310.         self.assertInHTML(max_forms_input % 2, response.rendered_content)\n311.         self.assertInHTML(total_forms_hidden, response.rendered_content)\n312. \n313.     def test_min_num(self):\n314.         """\n315.         min_num and extra determine number of forms.\n316.         """\n317.         class MinNumInline(TabularInline):\n318.             model = BinaryTree\n319.             min_num = 2\n320.             extra = 3\n321. \n322.         modeladmin = ModelAdmin(BinaryTree, admin_site)\n323.         modeladmin.inlines = [MinNumInline]\n324.         min_forms = (\n325.             \'<input id="id_binarytree_set-MIN_NUM_FORMS" \'\n326.             \'name="binarytree_set-MIN_NUM_FORMS" type="hidden" value="2">\'\n327.         )\n328.         total_forms = (\n329.             \'<input id="id_binarytree_set-TOTAL_FORMS" \'\n330.             \'name="binarytree_set-TOTAL_FORMS" type="hidden" value="5">\'\n331.         )\n332.         request = self.factory.get(reverse(\'admin:admin_inlines_binarytree_add\'))\n333.         request.user = User(username=\'super\', is_superuser=True)\n334.         response = modeladmin.changeform_view(request)\n335.         self.assertInHTML(min_forms, response.rendered_content)\n336.         self.assertInHTML(total_forms, response.rendered_content)\n337. \n338.     def test_custom_min_num(self):\n339.         bt_head = BinaryTree.objects.create(name="Tree Head")\n340.         BinaryTree.objects.create(name="First Child", parent=bt_head)\n341. \n342.         class MinNumInline(TabularInline):\n343.             model = BinaryTree\n344.             extra = 3\n345. \n346.             def get_min_num(self, request, obj=None, **kwargs):\n347.                 if obj:\n348.                     return 5\n349.                 return 2\n350. \n351.         modeladmin = ModelAdmin(BinaryTree, admin_site)\n352.         modeladmin.inlines = [MinNumInline]\n353.         min_forms = (\n354.             \'<input id="id_binarytree_set-MIN_NUM_FORMS" \'\n355.             \'name="binarytree_set-MIN_NUM_FORMS" type="hidden" value="%d">\'\n356.         )\n357.         total_forms = (\n358.             \'<input id="id_binarytree_set-TOTAL_FORMS" \'\n359.             \'name="binarytree_set-TOTAL_FORMS" type="hidden" value="%d">\'\n360.         )\n361.         request = self.factory.get(reverse(\'admin:admin_inlines_binarytree_add\'))\n362.         request.user = User(username=\'super\', is_superuser=True)\n363.         response = modeladmin.changeform_view(request)\n364.         self.assertInHTML(min_forms % 2, response.rendered_content)\n365.         self.assertInHTML(total_forms % 5, response.rendered_content)\n366. \n367.         request = self.factory.get(reverse(\'admin:admin_inlines_binarytree_change\', args=(bt_head.id,)))\n368.         request.user = User(username=\'super\', is_superuser=True)\n369.         response = modeladmin.changeform_view(request, object_id=str(bt_head.id))\n370.         self.assertInHTML(min_forms % 5, response.rendered_content)\n371.         self.assertInHTML(total_forms % 8, response.rendered_content)\n372. ', start_line_number=28, end_line_number=372), Context(relative_path='tests/admin_views/tests.py', content='1405. class AdminViewPermissionsTest(TestCase):\n1406.     """Tests for Admin Views Permissions."""\n1407. \n1408.     @classmethod\n1409.     def setUpTestData(cls):\n1410.         cls.superuser = User.objects.create_superuser(username=\'super\', password=\'secret\', email=\'super@example.com\')\n1411.         cls.viewuser = User.objects.create_user(username=\'viewuser\', password=\'secret\', is_staff=True)\n1412.         cls.adduser = User.objects.create_user(username=\'adduser\', password=\'secret\', is_staff=True)\n1413.         cls.changeuser = User.objects.create_user(username=\'changeuser\', password=\'secret\', is_staff=True)\n1414.         cls.deleteuser = User.objects.create_user(username=\'deleteuser\', password=\'secret\', is_staff=True)\n1415.         cls.joepublicuser = User.objects.create_user(username=\'joepublic\', password=\'secret\')\n1416.         cls.nostaffuser = User.objects.create_user(username=\'nostaff\', password=\'secret\')\n1417.         cls.s1 = Section.objects.create(name=\'Test section\')\n1418.         cls.a1 = Article.objects.create(\n1419.             content=\'<p>Middle content</p>\', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1,\n1420.             another_section=cls.s1,\n1421.         )\n1422.         cls.a2 = Article.objects.create(\n1423.             content=\'<p>Oldest content</p>\', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1\n1424.         )\n1425.         cls.a3 = Article.objects.create(\n1426.             content=\'<p>Newest content</p>\', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1\n1427.         )\n1428.         cls.p1 = PrePopulatedPost.objects.create(title=\'A Long Title\', published=True, slug=\'a-long-title\')\n1429. \n1430.         # Setup permissions, for our users who can add, change, and delete.\n1431.         opts = Article._meta\n1432. \n1433.         # User who can view Articles\n1434.         cls.viewuser.user_permissions.add(get_perm(Article, get_permission_codename(\'view\', opts)))\n1435.         # User who can add Articles\n1436.         cls.adduser.user_permissions.add(get_perm(Article, get_permission_codename(\'add\', opts)))\n1437.         # User who can change Articles\n1438.         cls.changeuser.user_permissions.add(get_perm(Article, get_permission_codename(\'change\', opts)))\n1439.         cls.nostaffuser.user_permissions.add(get_perm(Article, get_permission_codename(\'change\', opts)))\n1440. \n1441.         # User who can delete Articles\n1442.         cls.deleteuser.user_permissions.add(get_perm(Article, get_permission_codename(\'delete\', opts)))\n1443.         cls.deleteuser.user_permissions.add(get_perm(Section, get_permission_codename(\'delete\', Section._meta)))\n1444. \n1445.         # login POST dicts\n1446.         cls.index_url = reverse(\'admin:index\')\n1447.         cls.super_login = {\n1448.             REDIRECT_FIELD_NAME: cls.index_url,\n1449.             \'username\': \'super\',\n1450.             \'password\': \'secret\',\n1451.         }\n1452.         cls.super_email_login = {\n1453.             REDIRECT_FIELD_NAME: cls.index_url,\n1454.             \'username\': \'super@example.com\',\n1455.             \'password\': \'secret\',\n1456.         }\n1457.         cls.super_email_bad_login = {\n1458.             REDIRECT_FIELD_NAME: cls.index_url,\n1459.             \'username\': \'super@example.com\',\n1460.             \'password\': \'notsecret\',\n1461.         }\n1462.         cls.adduser_login = {\n1463.             REDIRECT_FIELD_NAME: cls.index_url,\n1464.             \'username\': \'adduser\',\n1465.             \'password\': \'secret\',\n1466.         }\n1467.         cls.changeuser_login = {\n1468.             REDIRECT_FIELD_NAME: cls.index_url,\n1469.             \'username\': \'changeuser\',\n1470.             \'password\': \'secret\',\n1471.         }\n1472.         cls.deleteuser_login = {\n1473.             REDIRECT_FIELD_NAME: cls.index_url,\n1474.             \'username\': \'deleteuser\',\n1475.             \'password\': \'secret\',\n1476.         }\n1477.         cls.nostaff_login = {\n1478.             REDIRECT_FIELD_NAME: reverse(\'has_permission_admin:index\'),\n1479.             \'username\': \'nostaff\',\n1480.             \'password\': \'secret\',\n1481.         }\n1482.         cls.joepublic_login = {\n1483.             REDIRECT_FIELD_NAME: cls.index_url,\n1484.             \'username\': \'joepublic\',\n1485.             \'password\': \'secret\',\n1486.         }\n1487.         cls.viewuser_login = {\n1488.             REDIRECT_FIELD_NAME: cls.index_url,\n1489.             \'username\': \'viewuser\',\n1490.             \'password\': \'secret\',\n1491.         }\n1492.         cls.no_username_login = {\n1493.             REDIRECT_FIELD_NAME: cls.index_url,\n1494.             \'password\': \'secret\',\n1495.         }\n1496. \n1497.     def test_login(self):\n1498.         """\n1499.         Make sure only staff members can log in.\n1500. \n1501.         Successful posts to the login page will redirect to the original url.\n1502.         Unsuccessful attempts will continue to render the login page with\n1503.         a 200 status code.\n1504.         """\n1505.         login_url = \'%s?next=%s\' % (reverse(\'admin:login\'), reverse(\'admin:index\'))\n1506.         # Super User\n1507.         response = self.client.get(self.index_url)\n1508.         self.assertRedirects(response, login_url)\n1509.         login = self.client.post(login_url, self.super_login)\n1510.         self.assertRedirects(login, self.index_url)\n1511.         self.assertFalse(login.context)\n1512.         self.client.get(reverse(\'admin:logout\'))\n1513. \n1514.         # Test if user enters email address\n1515.         response = self.client.get(self.index_url)\n1516.         self.assertEqual(response.status_code, 302)\n1517.         login = self.client.post(login_url, self.super_email_login)\n1518.         self.assertContains(login, ERROR_MESSAGE)\n1519.         # only correct passwords get a username hint\n1520.         login = self.client.post(login_url, self.super_email_bad_login)\n1521.         self.assertContains(login, ERROR_MESSAGE)\n1522.         new_user = User(username=\'jondoe\', password=\'secret\', email=\'super@example.com\')\n1523.         new_user.save()\n1524.         # check to ensure if there are multiple email addresses a user doesn\'t get a 500\n1525.         login = self.client.post(login_url, self.super_email_login)\n1526.         self.assertContains(login, ERROR_MESSAGE)\n1527. \n1528.         # View User\n1529.         response = self.client.get(self.index_url)\n1530.         self.assertEqual(response.status_code, 302)\n1531.         login = self.client.post(login_url, self.viewuser_login)\n1532.         self.assertRedirects(login, self.index_url)\n1533.         self.assertFalse(login.context)\n1534.         self.client.get(reverse(\'admin:logout\'))\n1535. \n1536.         # Add User\n1537.         response = self.client.get(self.index_url)\n1538.         self.assertEqual(response.status_code, 302)\n1539.         login = self.client.post(login_url, self.adduser_login)\n1540.         self.assertRedirects(login, self.index_url)\n1541.         self.assertFalse(login.context)\n1542.         self.client.get(reverse(\'admin:logout\'))\n1543. \n1544.         # Change User\n1545.         response = self.client.get(self.index_url)\n1546.         self.assertEqual(response.status_code, 302)\n1547.         login = self.client.post(login_url, self.changeuser_login)\n1548.         self.assertRedirects(login, self.index_url)\n1549.         self.assertFalse(login.context)\n1550.         self.client.get(reverse(\'admin:logout\'))\n1551. \n1552.         # Delete User\n1553.         response = self.client.get(self.index_url)\n1554.         self.assertEqual(response.status_code, 302)\n1555.         login = self.client.post(login_url, self.deleteuser_login)\n1556.         self.assertRedirects(login, self.index_url)\n1557.         self.assertFalse(login.context)\n1558.         self.client.get(reverse(\'admin:logout\'))\n1559. \n1560.         # Regular User should not be able to login.\n1561.         response = self.client.get(self.index_url)\n1562.         self.assertEqual(response.status_code, 302)\n1563.         login = self.client.post(login_url, self.joepublic_login)\n1564.         self.assertEqual(login.status_code, 200)\n1565.         self.assertContains(login, ERROR_MESSAGE)\n1566. \n1567.         # Requests without username should not return 500 errors.\n1568.         response = self.client.get(self.index_url)\n1569.         self.assertEqual(response.status_code, 302)\n1570.         login = self.client.post(login_url, self.no_username_login)\n1571.         self.assertEqual(login.status_code, 200)\n1572.         self.assertFormError(login, \'form\', \'username\', [\'This field is required.\'])\n1573. \n1574.     def test_login_redirect_for_direct_get(self):\n1575.         """\n1576.         Login redirect should be to the admin index page when going directly to\n1577.         /admin/login/.\n1578.         """\n1579.         response = self.client.get(reverse(\'admin:login\'))\n1580.         self.assertEqual(response.status_code, 200)\n1581.         self.assertEqual(response.context[REDIRECT_FIELD_NAME], reverse(\'admin:index\'))\n1582. \n1583.     def test_login_has_permission(self):\n1584.         # Regular User should not be able to login.\n1585.         response = self.client.get(reverse(\'has_permission_admin:index\'))\n1586.         self.assertEqual(response.status_code, 302)\n1587.         login = self.client.post(reverse(\'has_permission_admin:login\'), self.joepublic_login)\n1588.         self.assertEqual(login.status_code, 200)\n1589.         self.assertContains(login, \'permission denied\')\n1590. \n1591.         # User with permissions should be able to login.\n1592.         response = self.client.get(reverse(\'has_permission_admin:index\'))\n1593.         self.assertEqual(response.status_code, 302)\n1594.         login = self.client.post(reverse(\'has_permission_admin:login\'), self.nostaff_login)\n1595.         self.assertRedirects(login, reverse(\'has_permission_admin:index\'))\n1596.         self.assertFalse(login.context)\n1597.         self.client.get(reverse(\'has_permission_admin:logout\'))\n1598. \n1599.         # Staff should be able to login.\n1600.         response = self.client.get(reverse(\'has_permission_admin:index\'))\n1601.         self.assertEqual(response.status_code, 302)\n1602.         login = self.client.post(reverse(\'has_permission_admin:login\'), {\n1603.             REDIRECT_FIELD_NAME: reverse(\'has_permission_admin:index\'),\n1604.             \'username\': \'deleteuser\',\n1605.             \'password\': \'secret\',\n1606.         })\n1607.         self.assertRedirects(login, reverse(\'has_permission_admin:index\'))\n1608.         self.assertFalse(login.context)\n1609.         self.client.get(reverse(\'has_permission_admin:logout\'))\n1610. \n1611.     def test_login_successfully_redirects_to_original_URL(self):\n1612.         response = self.client.get(self.index_url)\n1613.         self.assertEqual(response.status_code, 302)\n1614.         query_string = \'the-answer=42\'\n1615.         redirect_url = \'%s?%s\' % (self.index_url, query_string)\n1616.         new_next = {REDIRECT_FIELD_NAME: redirect_url}\n1617.         post_data = self.super_login.copy()\n1618.         post_data.pop(REDIRECT_FIELD_NAME)\n1619.         login = self.client.post(\n1620.             \'%s?%s\' % (reverse(\'admin:login\'), urlencode(new_next)),\n1621.             post_data)\n1622.         self.assertRedirects(login, redirect_url)\n1623. \n1624.     def test_double_login_is_not_allowed(self):\n1625.         """Regression test for #19327"""\n1626.         login_url = \'%s?next=%s\' % (reverse(\'admin:login\'), reverse(\'admin:index\'))\n1627. \n1628.         response = self.client.get(self.index_url)\n1629.         self.assertEqual(response.status_code, 302)\n1630. \n1631.         # Establish a valid admin session\n1632.         login = self.client.post(login_url, self.super_login)\n1633.         self.assertRedirects(login, self.index_url)\n1634.         self.assertFalse(login.context)\n1635. \n1636.         # Logging in with non-admin user fails\n1637.         login = self.client.post(login_url, self.joepublic_login)\n1638.         self.assertEqual(login.status_code, 200)\n1639.         self.assertContains(login, ERROR_MESSAGE)\n1640. \n1641.         # Establish a valid admin session\n1642.         login = self.client.post(login_url, self.super_login)\n1643.         self.assertRedirects(login, self.index_url)\n1644.         self.assertFalse(login.context)\n1645. \n1646.         # Logging in with admin user while already logged in\n1647.         login = self.client.post(login_url, self.super_login)\n1648.         self.assertRedirects(login, self.index_url)\n1649.         self.assertFalse(login.context)\n1650.         self.client.get(reverse(\'admin:logout\'))\n1651. \n1652.     def test_login_page_notice_for_non_staff_users(self):\n1653.         """\n1654.         A logged-in non-staff user trying to access the admin index should be\n1655.         presented with the login page and a hint indicating that the current\n1656.         user doesn\'t have access to it.\n1657.         """\n1658.         hint_template = \'You are authenticated as {}\'\n1659. \n1660.         # Anonymous user should not be shown the hint\n1661.         response = self.client.get(self.index_url, follow=True)\n1662.         self.assertContains(response, \'login-form\')\n1663.         self.assertNotContains(response, hint_template.format(\'\'), status_code=200)\n1664. \n1665.         # Non-staff user should be shown the hint\n1666.         self.client.force_login(self.nostaffuser)\n1667.         response = self.client.get(self.index_url, follow=True)\n1668.         self.assertContains(response, \'login-form\')\n1669.         self.assertContains(response, hint_template.format(self.nostaffuser.username), status_code=200)\n1670. \n1671.     def test_add_view(self):\n1672.         """Test add view restricts access and actually adds items."""\n1673.         add_dict = {\n1674.             \'title\': \'Døm ikke\',\n1675.             \'content\': \'<p>great article</p>\',\n1676.             \'date_0\': \'2008-03-18\', \'date_1\': \'10:54:39\',\n1677.             \'section\': self.s1.pk,\n1678.         }\n1679.         # Change User should not have access to add articles\n1680.         self.client.force_login(self.changeuser)\n1681.         # make sure the view removes test cookie\n1682.         self.assertIs(self.client.session.test_cookie_worked(), False)\n1683.         response = self.client.get(reverse(\'admin:admin_views_article_add\'))\n1684.         self.assertEqual(response.status_code, 403)\n1685.         # Try POST just to make sure\n1686.         post = self.client.post(reverse(\'admin:admin_views_article_add\'), add_dict)\n1687.         self.assertEqual(post.status_code, 403)\n1688.         self.assertEqual(Article.objects.count(), 3)\n1689.         self.client.get(reverse(\'admin:logout\'))\n1690. \n1691.         # View User should not have access to add articles\n1692.         self.client.force_login(self.viewuser)\n1693.         response = self.client.get(reverse(\'admin:admin_views_article_add\'))\n1694.         self.assertEqual(response.status_code, 403)\n1695.         # Try POST just to make sure\n1696.         post = self.client.post(reverse(\'admin:admin_views_article_add\'), add_dict)\n1697.         self.assertEqual(post.status_code, 403)\n1698.         self.assertEqual(Article.objects.count(), 3)\n1699.         # Now give the user permission to add but not change.\n1700.         self.viewuser.user_permissions.add(get_perm(Article, get_permission_codename(\'add\', Article._meta)))\n1701.         response = self.client.get(reverse(\'admin:admin_views_article_add\'))\n1702.         self.assertContains(response, \'<input type="submit" value="Save and view" name="_continue">\')\n1703.         post = self.client.post(reverse(\'admin:admin_views_article_add\'), add_dict, follow=False)\n1704.         self.assertEqual(post.status_code, 302)\n1705.         self.assertEqual(Article.objects.count(), 4)\n1706.         article = Article.objects.latest(\'pk\')\n1707.         response = self.client.get(reverse(\'admin:admin_views_article_change\', args=(article.pk,)))\n1708.         self.assertContains(response, \'<li class="success">The article "Døm ikke" was added successfully.</li>\')\n1709.         article.delete()\n1710.         self.client.get(reverse(\'admin:logout\'))\n1711. \n1712.         # Add user may login and POST to add view, then redirect to admin root\n1713.         self.client.force_login(self.adduser)\n1714.         addpage = self.client.get(reverse(\'admin:admin_views_article_add\'))\n1715.         change_list_link = \'&rsaquo; <a href="%s">Articles</a>\' % reverse(\'admin:admin_views_article_changelist\')\n1716.         self.assertNotContains(\n1717.             addpage, change_list_link,\n1718.             msg_prefix=\'User restricted to add permission is given link to change list view in breadcrumbs.\'\n1719.         )\n1720.         post = self.client.post(reverse(\'admin:admin_views_article_add\'), add_dict)\n1721.         self.assertRedirects(post, self.index_url)\n1722.         self.assertEqual(Article.objects.count(), 4)\n1723.         self.assertEqual(len(mail.outbox), 2)\n1724.         self.assertEqual(mail.outbox[0].subject, \'Greetings from a created object\')\n1725.         self.client.get(reverse(\'admin:logout\'))\n1726. \n1727.         # The addition was logged correctly\n1728.         addition_log = LogEntry.objects.all()[0]\n1729.         new_article = Article.objects.last()\n1730.         article_ct = ContentType.objects.get_for_model(Article)\n1731.         self.assertEqual(addition_log.user_id, self.adduser.pk)\n1732.         self.assertEqual(addition_log.content_type_id, article_ct.pk)\n1733.         self.assertEqual(addition_log.object_id, str(new_article.pk))\n1734.         self.assertEqual(addition_log.object_repr, "Døm ikke")\n1735.         self.assertEqual(addition_log.action_flag, ADDITION)\n1736.         self.assertEqual(addition_log.get_change_message(), "Added.")\n1737. \n1738.         # Super can add too, but is redirected to the change list view\n1739.         self.client.force_login(self.superuser)\n1740.         addpage = self.client.get(reverse(\'admin:admin_views_article_add\'))\n1741.         self.assertContains(\n1742.             addpage, change_list_link,\n1743.             msg_prefix=\'Unrestricted user is not given link to change list view in breadcrumbs.\'\n1744.         )\n1745.         post = self.client.post(reverse(\'admin:admin_views_article_add\'), add_dict)\n1746.         self.assertRedirects(post, reverse(\'admin:admin_views_article_changelist\'))\n1747.         self.assertEqual(Article.objects.count(), 5)\n1748.         self.client.get(reverse(\'admin:logout\'))\n1749. \n1750.         # 8509 - if a normal user is already logged in, it is possible\n1751.         # to change user into the superuser without error\n1752.         self.client.force_login(self.joepublicuser)\n1753.         # Check and make sure that if user expires, data still persists\n1754.         self.client.force_login(self.superuser)\n1755.         # make sure the view removes test cookie\n1756.         self.assertIs(self.client.session.test_cookie_worked(), False)\n1757. \n1758.     @mock.patch(\'django.contrib.admin.options.InlineModelAdmin.has_change_permission\')\n1759.     def test_add_view_with_view_only_inlines(self, has_change_permission):\n1760.         """User with add permission to a section but view-only for inlines."""\n1761.         self.viewuser.user_permissions.add(get_perm(Section, get_permission_codename(\'add\', Section._meta)))\n1762.         self.client.force_login(self.viewuser)\n1763.         # Valid POST creates a new section.\n1764.         data = {\n1765.             \'name\': \'New obj\',\n1766.             \'article_set-TOTAL_FORMS\': 0,\n1767.             \'article_set-INITIAL_FORMS\': 0,\n1768.         }\n1769.         response = self.client.post(reverse(\'admin:admin_views_section_add\'), data)\n1770.         self.assertRedirects(response, reverse(\'admin:index\'))\n1771.         self.assertEqual(Section.objects.latest(\'id\').name, data[\'name\'])\n1772.         # InlineModelAdmin.has_change_permission()\'s obj argument is always\n1773.         # None during object add.\n1774.         self.assertEqual([obj for (request, obj), _ in has_change_permission.call_args_list], [None, None])\n1775. \n1776.     def test_change_view(self):\n1777.         """Change view should restrict access and allow users to edit items."""\n1778.         change_dict = {\n1779.             \'title\': \'Ikke fordømt\',\n1780.             \'content\': \'<p>edited article</p>\',\n1781.             \'date_0\': \'2008-03-18\', \'date_1\': \'10:54:39\',\n1782.             \'section\': self.s1.pk,\n1783.         }\n1784.         article_change_url = reverse(\'admin:admin_views_article_change\', args=(self.a1.pk,))\n1785.         article_changelist_url = reverse(\'admin:admin_views_article_changelist\')\n1786. \n1787.         # add user should not be able to view the list of article or change any of them\n1788.         self.client.force_login(self.adduser)\n1789.         response = self.client.get(article_changelist_url)\n1790.         self.assertEqual(response.status_code, 403)\n1791.         response = self.client.get(article_change_url)\n1792.         self.assertEqual(response.status_code, 403)\n1793.         post = self.client.post(article_change_url, change_dict)\n1794.         self.assertEqual(post.status_code, 403)\n1795.         self.client.get(reverse(\'admin:logout\'))\n1796. \n1797.         # view user should be able to view the article but not change any of them\n1798.         # (the POST can be sent, but no modification occurs)\n1799.         self.client.force_login(self.viewuser)\n1800.         response = self.client.get(article_changelist_url)\n1801.         self.assertEqual(response.status_code, 200)\n1802.         self.assertEqual(response.context[\'title\'], \'Select article to view\')\n1803.         response = self.client.get(article_change_url)\n1804.         self.assertEqual(response.status_code, 200)\n1805.         self.assertEqual(response.context[\'title\'], \'View article\')\n1806.         self.assertContains(response, \'<label>Extra form field:</label>\')\n1807.         self.assertContains(response, \'<a href="/test_admin/admin/admin_views/article/" class="closelink">Close</a>\')\n1808.         post = self.client.post(article_change_url, change_dict)\n1809.         self.assertEqual(post.status_code, 302)\n1810.         self.assertEqual(Article.objects.get(pk=self.a1.pk).content, \'<p>Middle content</p>\')\n1811.         self.client.get(reverse(\'admin:logout\'))\n1812. \n1813.         # change user can view all items and edit them\n1814.         self.client.force_login(self.changeuser)\n1815.         response = self.client.get(article_changelist_url)\n1816.         self.assertEqual(response.status_code, 200)\n1817.         self.assertEqual(response.context[\'title\'], \'Select article to change\')\n1818.         response = self.client.get(article_change_url)\n1819.         self.assertEqual(response.status_code, 200)\n1820.         self.assertEqual(response.context[\'title\'], \'Change article\')\n1821.         post = self.client.post(article_change_url, change_dict)\n1822.         self.assertRedirects(post, article_changelist_url)\n1823.         self.assertEqual(Article.objects.get(pk=self.a1.pk).content, \'<p>edited article</p>\')\n1824. \n1825.         # one error in form should produce singular error message, multiple errors plural\n1826.         change_dict[\'title\'] = \'\'\n1827.         post = self.client.post(article_change_url, change_dict)\n1828.         self.assertContains(\n1829.             post, \'Please correct the error below.\',\n1830.             msg_prefix=\'Singular error message not found in response to post with one error\'\n1831.         )\n1832. \n1833.         change_dict[\'content\'] = \'\'\n1834.         post = self.client.post(article_change_url, change_dict)\n1835.         self.assertContains(\n1836.             post, \'Please correct the errors below.\',\n1837.             msg_prefix=\'Plural error message not found in response to post with multiple errors\'\n1838.         )\n1839.         self.client.get(reverse(\'admin:logout\'))\n1840. \n1841.         # Test redirection when using row-level change permissions. Refs #11513.\n1842.         r1 = RowLevelChangePermissionModel.objects.create(id=1, name="odd id")\n1843.         r2 = RowLevelChangePermissionModel.objects.create(id=2, name="even id")\n1844.         r3 = RowLevelChangePermissionModel.objects.create(id=3, name=\'odd id mult 3\')\n1845.         r6 = RowLevelChangePermissionModel.objects.create(id=6, name=\'even id mult 3\')\n1846.         change_url_1 = reverse(\'admin:admin_views_rowlevelchangepermissionmodel_change\', args=(r1.pk,))\n1847.         change_url_2 = reverse(\'admin:admin_views_rowlevelchangepermissionmodel_change\', args=(r2.pk,))\n1848.         change_url_3 = reverse(\'admin:admin_views_rowlevelchangepermissionmodel_change\', args=(r3.pk,))\n1849.         change_url_6 = reverse(\'admin:admin_views_rowlevelchangepermissionmodel_change\', args=(r6.pk,))\n1850.         logins = [self.superuser, self.viewuser, self.adduser, self.changeuser, self.deleteuser]\n1851.         for login_user in logins:\n1852.             with self.subTest(login_user.username):\n1853.                 self.client.force_login(login_user)\n1854.                 response = self.client.get(change_url_1)\n1855.                 self.assertEqual(response.status_code, 403)\n1856.                 response = self.client.post(change_url_1, {\'name\': \'changed\'})\n1857.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=1).name, \'odd id\')\n1858.                 self.assertEqual(response.status_code, 403)\n1859.                 response = self.client.get(change_url_2)\n1860.                 self.assertEqual(response.status_code, 200)\n1861.                 response = self.client.post(change_url_2, {\'name\': \'changed\'})\n1862.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=2).name, \'changed\')\n1863.                 self.assertRedirects(response, self.index_url)\n1864.                 response = self.client.get(change_url_3)\n1865.                 self.assertEqual(response.status_code, 200)\n1866.                 response = self.client.post(change_url_3, {\'name\': \'changed\'})\n1867.                 self.assertRedirects(response, self.index_url)\n1868.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=3).name, \'odd id mult 3\')\n1869.                 response = self.client.get(change_url_6)\n1870.                 self.assertEqual(response.status_code, 200)\n1871.                 response = self.client.post(change_url_6, {\'name\': \'changed\'})\n1872.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=6).name, \'changed\')\n1873.                 self.assertRedirects(response, self.index_url)\n1874. \n1875.                 self.client.get(reverse(\'admin:logout\'))\n1876. \n1877.         for login_user in [self.joepublicuser, self.nostaffuser]:\n1878.             with self.subTest(login_user.username):\n1879.                 self.client.force_login(login_user)\n1880.                 response = self.client.get(change_url_1, follow=True)\n1881.                 self.assertContains(response, \'login-form\')\n1882.                 response = self.client.post(change_url_1, {\'name\': \'changed\'}, follow=True)\n1883.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=1).name, \'odd id\')\n1884.                 self.assertContains(response, \'login-form\')\n1885.                 response = self.client.get(change_url_2, follow=True)\n1886.                 self.assertContains(response, \'login-form\')\n1887.                 response = self.client.post(change_url_2, {\'name\': \'changed again\'}, follow=True)\n1888.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=2).name, \'changed\')\n1889.                 self.assertContains(response, \'login-form\')\n1890.                 self.client.get(reverse(\'admin:logout\'))\n1891. \n1892.     def test_change_view_without_object_change_permission(self):\n1893.         """\n1894.         The object should be read-only if the user has permission to view it\n1895.         and change objects of that type but not to change the current object.\n1896.         """\n1897.         change_url = reverse(\'admin9:admin_views_article_change\', args=(self.a1.pk,))\n1898.         self.client.force_login(self.viewuser)\n1899.         response = self.client.get(change_url)\n1900.         self.assertEqual(response.status_code, 200)\n1901.         self.assertEqual(response.context[\'title\'], \'View article\')\n1902.         self.assertContains(response, \'<a href="/test_admin/admin9/admin_views/article/" class="closelink">Close</a>\')\n1903. \n1904.     def test_change_view_post_without_object_change_permission(self):\n1905.         """A POST redirects to changelist without modifications."""\n1906.         change_dict = {\n1907.             \'title\': \'Ikke fordømt\',\n1908.             \'content\': \'<p>edited article</p>\',\n1909.             \'date_0\': \'2008-03-18\', \'date_1\': \'10:54:39\',\n1910.             \'section\': self.s1.pk,\n1911.         }\n1912.         change_url = reverse(\'admin10:admin_views_article_change\', args=(self.a1.pk,))\n1913.         changelist_url = reverse(\'admin10:admin_views_article_changelist\')\n1914.         self.client.force_login(self.viewuser)\n1915.         response = self.client.post(change_url, change_dict)\n1916.         self.assertRedirects(response, changelist_url)\n1917.         self.assertEqual(Article.objects.get(pk=self.a1.pk).content, \'<p>Middle content</p>\')\n1918. \n1919.     def test_change_view_save_as_new(self):\n1920.         """\n1921.         \'Save as new\' should raise PermissionDenied for users without the \'add\'\n1922.         permission.\n1923.         """\n1924.         change_dict_save_as_new = {\n1925.             \'_saveasnew\': \'Save as new\',\n1926.             \'title\': \'Ikke fordømt\',\n1927.             \'content\': \'<p>edited article</p>\',\n1928.             \'date_0\': \'2008-03-18\', \'date_1\': \'10:54:39\',\n1929.             \'section\': self.s1.pk,\n1930.         }\n1931.         article_change_url = reverse(\'admin:admin_views_article_change\', args=(self.a1.pk,))\n1932. \n1933.         # Add user can perform "Save as new".\n1934.         article_count = Article.objects.count()\n1935.         self.client.force_login(self.adduser)\n1936.         post = self.client.post(article_change_url, change_dict_save_as_new)\n1937.         self.assertRedirects(post, self.index_url)\n1938.         self.assertEqual(Article.objects.count(), article_count + 1)\n1939.         self.client.logout()\n1940. \n1941.         # Change user cannot perform "Save as new" (no \'add\' permission).\n1942.         article_count = Article.objects.count()\n1943.         self.client.force_login(self.changeuser)\n1944.         post = self.client.post(article_change_url, change_dict_save_as_new)\n1945.         self.assertEqual(post.status_code, 403)\n1946.         self.assertEqual(Article.objects.count(), article_count)\n1947. \n1948.         # User with both add and change permissions should be redirected to the\n1949.         # change page for the newly created object.\n1950.         article_count = Article.objects.count()\n1951.         self.client.force_login(self.superuser)\n1952.         post = self.client.post(article_change_url, change_dict_save_as_new)\n1953.         self.assertEqual(Article.objects.count(), article_count + 1)\n1954.         new_article = Article.objects.latest(\'id\')\n1955.         self.assertRedirects(post, reverse(\'admin:admin_views_article_change\', args=(new_article.pk,)))\n1956. \n1957.     def test_change_view_with_view_only_inlines(self):\n1958.         """\n1959.         User with change permission to a section but view-only for inlines.\n1960.         """\n1961.         self.viewuser.user_permissions.add(get_perm(Section, get_permission_codename(\'change\', Section._meta)))\n1962.         self.client.force_login(self.viewuser)\n1963.         # GET shows inlines.\n1964.         response = self.client.get(reverse(\'admin:admin_views_section_change\', args=(self.s1.pk,)))\n1965.         self.assertEqual(len(response.context[\'inline_admin_formsets\']), 1)\n1966.         formset = response.context[\'inline_admin_formsets\'][0]\n1967.         self.assertEqual(len(formset.forms), 3)\n1968.         # Valid POST changes the name.\n1969.         data = {\n1970.             \'name\': \'Can edit name with view-only inlines\',\n1971.             \'article_set-TOTAL_FORMS\': 3,\n1972.             \'article_set-INITIAL_FORMS\': 3\n1973.         }\n1974.         response = self.client.post(reverse(\'admin:admin_views_section_change\', args=(self.s1.pk,)), data)\n1975.         self.assertRedirects(response, reverse(\'admin:admin_views_section_changelist\'))\n1976.         self.assertEqual(Section.objects.get(pk=self.s1.pk).name, data[\'name\'])\n1977.         # Invalid POST reshows inlines.\n1978.         del data[\'name\']\n1979.         response = self.client.post(reverse(\'admin:admin_views_section_change\', args=(self.s1.pk,)), data)\n1980.         self.assertEqual(response.status_code, 200)\n1981.         self.assertEqual(len(response.context[\'inline_admin_formsets\']), 1)\n1982.         formset = response.context[\'inline_admin_formsets\'][0]\n1983.         self.assertEqual(len(formset.forms), 3)\n1984. \n1985.     def test_change_view_with_view_and_add_inlines(self):\n1986.         """User has view and add permissions on the inline model."""\n1987.         self.viewuser.user_permissions.add(get_perm(Section, get_permission_codename(\'change\', Section._meta)))\n1988.         self.viewuser.user_permissions.add(get_perm(Article, get_permission_codename(\'add\', Article._meta)))\n1989.         self.client.force_login(self.viewuser)\n1990.         # GET shows inlines.\n1991.         response = self.client.get(reverse(\'admin:admin_views_section_change\', args=(self.s1.pk,)))\n1992.         self.assertEqual(len(response.context[\'inline_admin_formsets\']), 1)\n1993.         formset = response.context[\'inline_admin_formsets\'][0]\n1994.         self.assertEqual(len(formset.forms), 6)\n1995.         # Valid POST creates a new article.\n1996.         data = {\n1997.             \'name\': \'Can edit name with view-only inlines\',\n1998.             \'article_set-TOTAL_FORMS\': 6,\n1999.             \'article_set-INITIAL_FORMS\': 3,\n2000.             \'article_set-3-id\': [\'\'],\n2001.             \'article_set-3-title\': [\'A title\'],\n2002.             \'article_set-3-content\': [\'Added content\'],\n2003.             \'article_set-3-date_0\': [\'2008-3-18\'],\n2004.             \'article_set-3-date_1\': [\'11:54:58\'],\n2005.             \'article_set-3-section\': [str(self.s1.pk)],\n2006.         }\n2007.         response = self.client.post(reverse(\'admin:admin_views_section_change\', args=(self.s1.pk,)), data)\n2008.         self.assertRedirects(response, reverse(\'admin:admin_views_section_changelist\'))\n2009.         self.assertEqual(Section.objects.get(pk=self.s1.pk).name, data[\'name\'])\n2010.         self.assertEqual(Article.objects.count(), 4)\n2011.         # Invalid POST reshows inlines.\n2012.         del data[\'name\']\n2013.         response = self.client.post(reverse(\'admin:admin_views_section_change\', args=(self.s1.pk,)), data)\n2014.         self.assertEqual(response.status_code, 200)\n2015.         self.assertEqual(len(response.context[\'inline_admin_formsets\']), 1)\n2016.         formset = response.context[\'inline_admin_formsets\'][0]\n2017.         self.assertEqual(len(formset.forms), 6)\n2018. \n2019.     def test_change_view_with_view_and_delete_inlines(self):\n2020.         """User has view and delete permissions on the inline model."""\n2021.         self.viewuser.user_permissions.add(get_perm(Section, get_permission_codename(\'change\', Section._meta)))\n2022.         self.client.force_login(self.viewuser)\n2023.         data = {\n2024.             \'name\': \'Name is required.\',\n2025.             \'article_set-TOTAL_FORMS\': 6,\n2026.             \'article_set-INITIAL_FORMS\': 3,\n2027.             \'article_set-0-id\': [str(self.a1.pk)],\n2028.             \'article_set-0-DELETE\': [\'on\'],\n2029.         }\n2030.         # Inline POST details are ignored without delete permission.\n2031.         response = self.client.post(reverse(\'admin:admin_views_section_change\', args=(self.s1.pk,)), data)\n2032.         self.assertRedirects(response, reverse(\'admin:admin_views_section_changelist\'))\n2033.         self.assertEqual(Article.objects.count(), 3)\n2034.         # Deletion successful when delete permission is added.\n2035.         self.viewuser.user_permissions.add(get_perm(Article, get_permission_codename(\'delete\', Article._meta)))\n2036.         data = {\n2037.             \'name\': \'Name is required.\',\n2038.             \'article_set-TOTAL_FORMS\': 6,\n2039.             \'article_set-INITIAL_FORMS\': 3,\n2040.             \'article_set-0-id\': [str(self.a1.pk)],\n2041.             \'article_set-0-DELETE\': [\'on\'],\n2042.         }\n2043.         response = self.client.post(reverse(\'admin:admin_views_section_change\', args=(self.s1.pk,)), data)\n2044.         self.assertRedirects(response, reverse(\'admin:admin_views_section_changelist\'))\n2045.         self.assertEqual(Article.objects.count(), 2)\n2046. ', start_line_number=1405, end_line_number=2046)]
2025-10-06 21:11:53,022 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_write_message_node - DEBUG - Sending message to BugReproducingWriteNode:
content='Issue title:\nadd ModelAdmin.get_inlines() hook to allow set inlines based on the request or model instance.\n\nIssue description: \nDescription\n\t\nadd ModelAdmin.get_inlines() hook to allow set inlines based on the request or model instance.\nCurrently, We can override the method get_inline_instances to do such a thing, but a for loop should be copied to my code. So I wished add a hook get_inlines(request, obj=None)\n\nIssue comments:\n\n\nBug reproducing context:\nFile: tests/admin_inlines/tests.py\nLine number range: 433 - 447\nContent:\n433.     def test_inlines_show_change_link_registered(self):\n434.         "Inlines `show_change_link` for registered models when enabled."\n435.         holder = Holder4.objects.create(dummy=1)\n436.         item1 = Inner4Stacked.objects.create(dummy=1, holder=holder)\n437.         item2 = Inner4Tabular.objects.create(dummy=1, holder=holder)\n438.         items = (\n439.             (\'inner4stacked\', item1.pk),\n440.             (\'inner4tabular\', item2.pk),\n441.         )\n442.         response = self.client.get(reverse(\'admin:admin_inlines_holder4_change\', args=(holder.pk,)))\n443.         self.assertTrue(response.context[\'inline_admin_formset\'].opts.has_registered_model)\n444.         for model, pk in items:\n445.             url = reverse(\'admin:admin_inlines_%s_change\' % model, args=(pk,))\n446.             self.assertContains(response, \'<a href="%s" %s\' % (url, INLINE_CHANGELINK_HTML))\n447. \n\n\nFile: tests/admin_views/tests.py\nLine number range: 6181 - 6202\nContent:\n6181.     def test_check(self):\n6182.         "The view_on_site value is either a boolean or a callable"\n6183.         try:\n6184.             admin = CityAdmin(City, AdminSite())\n6185.             CityAdmin.view_on_site = True\n6186.             self.assertEqual(admin.check(), [])\n6187.             CityAdmin.view_on_site = False\n6188.             self.assertEqual(admin.check(), [])\n6189.             CityAdmin.view_on_site = lambda obj: obj.get_absolute_url()\n6190.             self.assertEqual(admin.check(), [])\n6191.             CityAdmin.view_on_site = []\n6192.             self.assertEqual(admin.check(), [\n6193.                 Error(\n6194.                     "The value of \'view_on_site\' must be a callable or a boolean value.",\n6195.                     obj=CityAdmin,\n6196.                     id=\'admin.E025\',\n6197.                 ),\n6198.             ])\n6199.         finally:\n6200.             # Restore the original values for the benefit of other tests.\n6201.             CityAdmin.view_on_site = True\n6202. \n\n\nFile: tests/admin_views/tests.py\nLine number range: 4815 - 4990\nContent:\n4815. class ReadonlyTest(AdminFieldExtractionMixin, TestCase):\n4816. \n4817.     @classmethod\n4818.     def setUpTestData(cls):\n4819.         cls.superuser = User.objects.create_superuser(username=\'super\', password=\'secret\', email=\'super@example.com\')\n4820. \n4821.     def setUp(self):\n4822.         self.client.force_login(self.superuser)\n4823. \n4824.     def test_readonly_get(self):\n4825.         response = self.client.get(reverse(\'admin:admin_views_post_add\'))\n4826.         self.assertEqual(response.status_code, 200)\n4827.         self.assertNotContains(response, \'name="posted"\')\n4828.         # 3 fields + 2 submit buttons + 5 inline management form fields, + 2\n4829.         # hidden fields for inlines + 1 field for the inline + 2 empty form\n4830.         self.assertContains(response, "<input", count=15)\n4831.         self.assertContains(response, formats.localize(datetime.date.today()))\n4832.         self.assertContains(response, "<label>Awesomeness level:</label>")\n4833.         self.assertContains(response, "Very awesome.")\n4834.         self.assertContains(response, "Unknown coolness.")\n4835.         self.assertContains(response, "foo")\n4836. \n4837.         # Multiline text in a readonly field gets <br> tags\n4838.         self.assertContains(response, \'Multiline<br>test<br>string\')\n4839.         self.assertContains(response, \'<div class="readonly">Multiline<br>html<br>content</div>\', html=True)\n4840.         self.assertContains(response, \'InlineMultiline<br>test<br>string\')\n4841. \n4842.         self.assertContains(response, formats.localize(datetime.date.today() - datetime.timedelta(days=7)))\n4843. \n4844.         self.assertContains(response, \'<div class="form-row field-coolness">\')\n4845.         self.assertContains(response, \'<div class="form-row field-awesomeness_level">\')\n4846.         self.assertContains(response, \'<div class="form-row field-posted">\')\n4847.         self.assertContains(response, \'<div class="form-row field-value">\')\n4848.         self.assertContains(response, \'<div class="form-row">\')\n4849.         self.assertContains(response, \'<div class="help">\', 3)\n4850.         self.assertContains(\n4851.             response,\n4852.             \'<div class="help">Some help text for the title (with unicode ŠĐĆŽćžšđ)</div>\',\n4853.             html=True\n4854.         )\n4855.         self.assertContains(\n4856.             response,\n4857.             \'<div class="help">Some help text for the content (with unicode ŠĐĆŽćžšđ)</div>\',\n4858.             html=True\n4859.         )\n4860.         self.assertContains(\n4861.             response,\n4862.             \'<div class="help">Some help text for the date (with unicode ŠĐĆŽćžšđ)</div>\',\n4863.             html=True\n4864.         )\n4865. \n4866.         p = Post.objects.create(title="I worked on readonly_fields", content="Its good stuff")\n4867.         response = self.client.get(reverse(\'admin:admin_views_post_change\', args=(p.pk,)))\n4868.         self.assertContains(response, "%d amount of cool" % p.pk)\n4869. \n4870.     def test_readonly_text_field(self):\n4871.         p = Post.objects.create(\n4872.             title="Readonly test", content="test",\n4873.             readonly_content=\'test\\r\\n\\r\\ntest\\r\\n\\r\\ntest\\r\\n\\r\\ntest\',\n4874.         )\n4875.         Link.objects.create(\n4876.             url="http://www.djangoproject.com", post=p,\n4877.             readonly_link_content="test\\r\\nlink",\n4878.         )\n4879.         response = self.client.get(reverse(\'admin:admin_views_post_change\', args=(p.pk,)))\n4880.         # Checking readonly field.\n4881.         self.assertContains(response, \'test<br><br>test<br><br>test<br><br>test\')\n4882.         # Checking readonly field in inline.\n4883.         self.assertContains(response, \'test<br>link\')\n4884. \n4885.     def test_readonly_post(self):\n4886.         data = {\n4887.             "title": "Django Got Readonly Fields",\n4888.             "content": "This is an incredible development.",\n4889.             "link_set-TOTAL_FORMS": "1",\n4890.             "link_set-INITIAL_FORMS": "0",\n4891.             "link_set-MAX_NUM_FORMS": "0",\n4892.         }\n4893.         response = self.client.post(reverse(\'admin:admin_views_post_add\'), data)\n4894.         self.assertEqual(response.status_code, 302)\n4895.         self.assertEqual(Post.objects.count(), 1)\n4896.         p = Post.objects.get()\n4897.         self.assertEqual(p.posted, datetime.date.today())\n4898. \n4899.         data["posted"] = "10-8-1990"  # some date that\'s not today\n4900.         response = self.client.post(reverse(\'admin:admin_views_post_add\'), data)\n4901.         self.assertEqual(response.status_code, 302)\n4902.         self.assertEqual(Post.objects.count(), 2)\n4903.         p = Post.objects.order_by(\'-id\')[0]\n4904.         self.assertEqual(p.posted, datetime.date.today())\n4905. \n4906.     def test_readonly_manytomany(self):\n4907.         "Regression test for #13004"\n4908.         response = self.client.get(reverse(\'admin:admin_views_pizza_add\'))\n4909.         self.assertEqual(response.status_code, 200)\n4910. \n4911.     def test_user_password_change_limited_queryset(self):\n4912.         su = User.objects.filter(is_superuser=True)[0]\n4913.         response = self.client.get(reverse(\'admin2:auth_user_password_change\', args=(su.pk,)))\n4914.         self.assertEqual(response.status_code, 404)\n4915. \n4916.     def test_change_form_renders_correct_null_choice_value(self):\n4917.         """\n4918.         Regression test for #17911.\n4919.         """\n4920.         choice = Choice.objects.create(choice=None)\n4921.         response = self.client.get(reverse(\'admin:admin_views_choice_change\', args=(choice.pk,)))\n4922.         self.assertContains(response, \'<div class="readonly">No opinion</div>\', html=True)\n4923. \n4924.     def test_readonly_manytomany_backwards_ref(self):\n4925.         """\n4926.         Regression test for #16433 - backwards references for related objects\n4927.         broke if the related field is read-only due to the help_text attribute\n4928.         """\n4929.         topping = Topping.objects.create(name=\'Salami\')\n4930.         pizza = Pizza.objects.create(name=\'Americano\')\n4931.         pizza.toppings.add(topping)\n4932.         response = self.client.get(reverse(\'admin:admin_views_topping_add\'))\n4933.         self.assertEqual(response.status_code, 200)\n4934. \n4935.     def test_readonly_manytomany_forwards_ref(self):\n4936.         topping = Topping.objects.create(name=\'Salami\')\n4937.         pizza = Pizza.objects.create(name=\'Americano\')\n4938.         pizza.toppings.add(topping)\n4939.         response = self.client.get(reverse(\'admin:admin_views_pizza_change\', args=(pizza.pk,)))\n4940.         self.assertContains(response, \'<label>Toppings:</label>\', html=True)\n4941.         self.assertContains(response, \'<div class="readonly">Salami</div>\', html=True)\n4942. \n4943.     def test_readonly_onetoone_backwards_ref(self):\n4944.         """\n4945.         Can reference a reverse OneToOneField in ModelAdmin.readonly_fields.\n4946.         """\n4947.         v1 = Villain.objects.create(name=\'Adam\')\n4948.         pl = Plot.objects.create(name=\'Test Plot\', team_leader=v1, contact=v1)\n4949.         pd = PlotDetails.objects.create(details=\'Brand New Plot\', plot=pl)\n4950. \n4951.         response = self.client.get(reverse(\'admin:admin_views_plotproxy_change\', args=(pl.pk,)))\n4952.         field = self.get_admin_readonly_field(response, \'plotdetails\')\n4953.         self.assertEqual(field.contents(), \'Brand New Plot\')\n4954. \n4955.         # The reverse relation also works if the OneToOneField is null.\n4956.         pd.plot = None\n4957.         pd.save()\n4958. \n4959.         response = self.client.get(reverse(\'admin:admin_views_plotproxy_change\', args=(pl.pk,)))\n4960.         field = self.get_admin_readonly_field(response, \'plotdetails\')\n4961.         self.assertEqual(field.contents(), \'-\')  # default empty value\n4962. \n4963.     def test_readonly_field_overrides(self):\n4964.         """\n4965.         Regression test for #22087 - ModelForm Meta overrides are ignored by\n4966.         AdminReadonlyField\n4967.         """\n4968.         p = FieldOverridePost.objects.create(title="Test Post", content="Test Content")\n4969.         response = self.client.get(reverse(\'admin:admin_views_fieldoverridepost_change\', args=(p.pk,)))\n4970.         self.assertContains(response, \'<div class="help">Overridden help text for the date</div>\')\n4971.         self.assertContains(response, \'<label for="id_public">Overridden public label:</label>\', html=True)\n4972.         self.assertNotContains(response, "Some help text for the date (with unicode ŠĐĆŽćžšđ)")\n4973. \n4974.     def test_correct_autoescaping(self):\n4975.         """\n4976.         Make sure that non-field readonly elements are properly autoescaped (#24461)\n4977.         """\n4978.         section = Section.objects.create(name=\'<a>evil</a>\')\n4979.         response = self.client.get(reverse(\'admin:admin_views_section_change\', args=(section.pk,)))\n4980.         self.assertNotContains(response, "<a>evil</a>", status_code=200)\n4981.         self.assertContains(response, "&lt;a&gt;evil&lt;/a&gt;", status_code=200)\n4982. \n4983.     def test_label_suffix_translated(self):\n4984.         pizza = Pizza.objects.create(name=\'Americano\')\n4985.         url = reverse(\'admin:admin_views_pizza_change\', args=(pizza.pk,))\n4986.         with self.settings(LANGUAGE_CODE=\'fr\'):\n4987.             response = self.client.get(url)\n4988.         self.assertContains(response, \'<label>Toppings\\u00A0:</label>\', html=True)\n4989. \n4990. \n\n\nFile: tests/admin_views/tests.py\nLine number range: 3631 - 3890\nContent:\n3631. class AdminCustomQuerysetTest(TestCase):\n3632. \n3633.     @classmethod\n3634.     def setUpTestData(cls):\n3635.         cls.superuser = User.objects.create_superuser(username=\'super\', password=\'secret\', email=\'super@example.com\')\n3636.         cls.pks = [EmptyModel.objects.create().id for i in range(3)]\n3637. \n3638.     def setUp(self):\n3639.         self.client.force_login(self.superuser)\n3640.         self.super_login = {\n3641.             REDIRECT_FIELD_NAME: reverse(\'admin:index\'),\n3642.             \'username\': \'super\',\n3643.             \'password\': \'secret\',\n3644.         }\n3645. \n3646.     def test_changelist_view(self):\n3647.         response = self.client.get(reverse(\'admin:admin_views_emptymodel_changelist\'))\n3648.         for i in self.pks:\n3649.             if i > 1:\n3650.                 self.assertContains(response, \'Primary key = %s\' % i)\n3651.             else:\n3652.                 self.assertNotContains(response, \'Primary key = %s\' % i)\n3653. \n3654.     def test_changelist_view_count_queries(self):\n3655.         # create 2 Person objects\n3656.         Person.objects.create(name=\'person1\', gender=1)\n3657.         Person.objects.create(name=\'person2\', gender=2)\n3658.         changelist_url = reverse(\'admin:admin_views_person_changelist\')\n3659. \n3660.         # 5 queries are expected: 1 for the session, 1 for the user,\n3661.         # 2 for the counts and 1 for the objects on the page\n3662.         with self.assertNumQueries(5):\n3663.             resp = self.client.get(changelist_url)\n3664.             self.assertEqual(resp.context[\'selection_note\'], \'0 of 2 selected\')\n3665.             self.assertEqual(resp.context[\'selection_note_all\'], \'All 2 selected\')\n3666.         with self.assertNumQueries(5):\n3667.             extra = {\'q\': \'not_in_name\'}\n3668.             resp = self.client.get(changelist_url, extra)\n3669.             self.assertEqual(resp.context[\'selection_note\'], \'0 of 0 selected\')\n3670.             self.assertEqual(resp.context[\'selection_note_all\'], \'All 0 selected\')\n3671.         with self.assertNumQueries(5):\n3672.             extra = {\'q\': \'person\'}\n3673.             resp = self.client.get(changelist_url, extra)\n3674.             self.assertEqual(resp.context[\'selection_note\'], \'0 of 2 selected\')\n3675.             self.assertEqual(resp.context[\'selection_note_all\'], \'All 2 selected\')\n3676.         with self.assertNumQueries(5):\n3677.             extra = {\'gender__exact\': \'1\'}\n3678.             resp = self.client.get(changelist_url, extra)\n3679.             self.assertEqual(resp.context[\'selection_note\'], \'0 of 1 selected\')\n3680.             self.assertEqual(resp.context[\'selection_note_all\'], \'1 selected\')\n3681. \n3682.     def test_change_view(self):\n3683.         for i in self.pks:\n3684.             url = reverse(\'admin:admin_views_emptymodel_change\', args=(i,))\n3685.             response = self.client.get(url, follow=True)\n3686.             if i > 1:\n3687.                 self.assertEqual(response.status_code, 200)\n3688.             else:\n3689.                 self.assertRedirects(response, reverse(\'admin:index\'))\n3690.                 self.assertEqual(\n3691.                     [m.message for m in response.context[\'messages\']],\n3692.                     ["""empty model with ID "1" doesn\'t exist. Perhaps it was deleted?"""]\n3693.                 )\n3694. \n3695.     def test_add_model_modeladmin_defer_qs(self):\n3696.         # Test for #14529. defer() is used in ModelAdmin.get_queryset()\n3697. \n3698.         # model has __str__ method\n3699.         self.assertEqual(CoverLetter.objects.count(), 0)\n3700.         # Emulate model instance creation via the admin\n3701.         post_data = {\n3702.             "author": "Candidate, Best",\n3703.             "_save": "Save",\n3704.         }\n3705.         response = self.client.post(reverse(\'admin:admin_views_coverletter_add\'), post_data, follow=True)\n3706.         self.assertEqual(response.status_code, 200)\n3707.         self.assertEqual(CoverLetter.objects.count(), 1)\n3708.         # Message should contain non-ugly model verbose name\n3709.         pk = CoverLetter.objects.all()[0].pk\n3710.         self.assertContains(\n3711.             response,\n3712.             \'<li class="success">The cover letter "<a href="%s">\'\n3713.             \'Candidate, Best</a>" was added successfully.</li>\' %\n3714.             reverse(\'admin:admin_views_coverletter_change\', args=(pk,)), html=True\n3715.         )\n3716. \n3717.         # model has no __str__ method\n3718.         self.assertEqual(ShortMessage.objects.count(), 0)\n3719.         # Emulate model instance creation via the admin\n3720.         post_data = {\n3721.             "content": "What\'s this SMS thing?",\n3722.             "_save": "Save",\n3723.         }\n3724.         response = self.client.post(reverse(\'admin:admin_views_shortmessage_add\'), post_data, follow=True)\n3725.         self.assertEqual(response.status_code, 200)\n3726.         self.assertEqual(ShortMessage.objects.count(), 1)\n3727.         # Message should contain non-ugly model verbose name\n3728.         sm = ShortMessage.objects.all()[0]\n3729.         self.assertContains(\n3730.             response,\n3731.             \'<li class="success">The short message "<a href="%s">\'\n3732.             \'%s</a>" was added successfully.</li>\' %\n3733.             (reverse(\'admin:admin_views_shortmessage_change\', args=(sm.pk,)), sm), html=True\n3734.         )\n3735. \n3736.     def test_add_model_modeladmin_only_qs(self):\n3737.         # Test for #14529. only() is used in ModelAdmin.get_queryset()\n3738. \n3739.         # model has __str__ method\n3740.         self.assertEqual(Telegram.objects.count(), 0)\n3741.         # Emulate model instance creation via the admin\n3742.         post_data = {\n3743.             "title": "Urgent telegram",\n3744.             "_save": "Save",\n3745.         }\n3746.         response = self.client.post(reverse(\'admin:admin_views_telegram_add\'), post_data, follow=True)\n3747.         self.assertEqual(response.status_code, 200)\n3748.         self.assertEqual(Telegram.objects.count(), 1)\n3749.         # Message should contain non-ugly model verbose name\n3750.         pk = Telegram.objects.all()[0].pk\n3751.         self.assertContains(\n3752.             response,\n3753.             \'<li class="success">The telegram "<a href="%s">\'\n3754.             \'Urgent telegram</a>" was added successfully.</li>\' %\n3755.             reverse(\'admin:admin_views_telegram_change\', args=(pk,)), html=True\n3756.         )\n3757. \n3758.         # model has no __str__ method\n3759.         self.assertEqual(Paper.objects.count(), 0)\n3760.         # Emulate model instance creation via the admin\n3761.         post_data = {\n3762.             "title": "My Modified Paper Title",\n3763.             "_save": "Save",\n3764.         }\n3765.         response = self.client.post(reverse(\'admin:admin_views_paper_add\'), post_data, follow=True)\n3766.         self.assertEqual(response.status_code, 200)\n3767.         self.assertEqual(Paper.objects.count(), 1)\n3768.         # Message should contain non-ugly model verbose name\n3769.         p = Paper.objects.all()[0]\n3770.         self.assertContains(\n3771.             response,\n3772.             \'<li class="success">The paper "<a href="%s">\'\n3773.             \'%s</a>" was added successfully.</li>\' %\n3774.             (reverse(\'admin:admin_views_paper_change\', args=(p.pk,)), p), html=True\n3775.         )\n3776. \n3777.     def test_edit_model_modeladmin_defer_qs(self):\n3778.         # Test for #14529. defer() is used in ModelAdmin.get_queryset()\n3779. \n3780.         # model has __str__ method\n3781.         cl = CoverLetter.objects.create(author="John Doe")\n3782.         self.assertEqual(CoverLetter.objects.count(), 1)\n3783.         response = self.client.get(reverse(\'admin:admin_views_coverletter_change\', args=(cl.pk,)))\n3784.         self.assertEqual(response.status_code, 200)\n3785.         # Emulate model instance edit via the admin\n3786.         post_data = {\n3787.             "author": "John Doe II",\n3788.             "_save": "Save",\n3789.         }\n3790.         url = reverse(\'admin:admin_views_coverletter_change\', args=(cl.pk,))\n3791.         response = self.client.post(url, post_data, follow=True)\n3792.         self.assertEqual(response.status_code, 200)\n3793.         self.assertEqual(CoverLetter.objects.count(), 1)\n3794.         # Message should contain non-ugly model verbose name. Instance\n3795.         # representation is set by model\'s __str__()\n3796.         self.assertContains(\n3797.             response,\n3798.             \'<li class="success">The cover letter "<a href="%s">\'\n3799.             \'John Doe II</a>" was changed successfully.</li>\' %\n3800.             reverse(\'admin:admin_views_coverletter_change\', args=(cl.pk,)), html=True\n3801.         )\n3802. \n3803.         # model has no __str__ method\n3804.         sm = ShortMessage.objects.create(content="This is expensive")\n3805.         self.assertEqual(ShortMessage.objects.count(), 1)\n3806.         response = self.client.get(reverse(\'admin:admin_views_shortmessage_change\', args=(sm.pk,)))\n3807.         self.assertEqual(response.status_code, 200)\n3808.         # Emulate model instance edit via the admin\n3809.         post_data = {\n3810.             "content": "Too expensive",\n3811.             "_save": "Save",\n3812.         }\n3813.         url = reverse(\'admin:admin_views_shortmessage_change\', args=(sm.pk,))\n3814.         response = self.client.post(url, post_data, follow=True)\n3815.         self.assertEqual(response.status_code, 200)\n3816.         self.assertEqual(ShortMessage.objects.count(), 1)\n3817.         # Message should contain non-ugly model verbose name. The ugly(!)\n3818.         # instance representation is set by __str__().\n3819.         self.assertContains(\n3820.             response,\n3821.             \'<li class="success">The short message "<a href="%s">\'\n3822.             \'%s</a>" was changed successfully.</li>\' %\n3823.             (reverse(\'admin:admin_views_shortmessage_change\', args=(sm.pk,)), sm), html=True\n3824.         )\n3825. \n3826.     def test_edit_model_modeladmin_only_qs(self):\n3827.         # Test for #14529. only() is used in ModelAdmin.get_queryset()\n3828. \n3829.         # model has __str__ method\n3830.         t = Telegram.objects.create(title="First Telegram")\n3831.         self.assertEqual(Telegram.objects.count(), 1)\n3832.         response = self.client.get(reverse(\'admin:admin_views_telegram_change\', args=(t.pk,)))\n3833.         self.assertEqual(response.status_code, 200)\n3834.         # Emulate model instance edit via the admin\n3835.         post_data = {\n3836.             "title": "Telegram without typo",\n3837.             "_save": "Save",\n3838.         }\n3839.         response = self.client.post(reverse(\'admin:admin_views_telegram_change\', args=(t.pk,)), post_data, follow=True)\n3840.         self.assertEqual(response.status_code, 200)\n3841.         self.assertEqual(Telegram.objects.count(), 1)\n3842.         # Message should contain non-ugly model verbose name. The instance\n3843.         # representation is set by model\'s __str__()\n3844.         self.assertContains(\n3845.             response,\n3846.             \'<li class="success">The telegram "<a href="%s">\'\n3847.             \'Telegram without typo</a>" was changed successfully.</li>\' %\n3848.             reverse(\'admin:admin_views_telegram_change\', args=(t.pk,)), html=True\n3849.         )\n3850. \n3851.         # model has no __str__ method\n3852.         p = Paper.objects.create(title="My Paper Title")\n3853.         self.assertEqual(Paper.objects.count(), 1)\n3854.         response = self.client.get(reverse(\'admin:admin_views_paper_change\', args=(p.pk,)))\n3855.         self.assertEqual(response.status_code, 200)\n3856.         # Emulate model instance edit via the admin\n3857.         post_data = {\n3858.             "title": "My Modified Paper Title",\n3859.             "_save": "Save",\n3860.         }\n3861.         response = self.client.post(reverse(\'admin:admin_views_paper_change\', args=(p.pk,)), post_data, follow=True)\n3862.         self.assertEqual(response.status_code, 200)\n3863.         self.assertEqual(Paper.objects.count(), 1)\n3864.         # Message should contain non-ugly model verbose name. The ugly(!)\n3865.         # instance representation is set by __str__().\n3866.         self.assertContains(\n3867.             response,\n3868.             \'<li class="success">The paper "<a href="%s">\'\n3869.             \'%s</a>" was changed successfully.</li>\' %\n3870.             (reverse(\'admin:admin_views_paper_change\', args=(p.pk,)), p), html=True\n3871.         )\n3872. \n3873.     def test_history_view_custom_qs(self):\n3874.         """\n3875.         Custom querysets are considered for the admin history view.\n3876.         """\n3877.         self.client.post(reverse(\'admin:login\'), self.super_login)\n3878.         FilteredManager.objects.create(pk=1)\n3879.         FilteredManager.objects.create(pk=2)\n3880.         response = self.client.get(reverse(\'admin:admin_views_filteredmanager_changelist\'))\n3881.         self.assertContains(response, "PK=1")\n3882.         self.assertContains(response, "PK=2")\n3883.         self.assertEqual(\n3884.             self.client.get(reverse(\'admin:admin_views_filteredmanager_history\', args=(1,))).status_code, 200\n3885.         )\n3886.         self.assertEqual(\n3887.             self.client.get(reverse(\'admin:admin_views_filteredmanager_history\', args=(2,))).status_code, 200\n3888.         )\n3889. \n3890. \n\n\nFile: tests/admin_views/tests.py\nLine number range: 1138 - 1183\nContent:\n1138. @override_settings(ROOT_URLCONF=\'admin_views.urls\')\n1139. class AdminViewFormUrlTest(TestCase):\n1140.     current_app = "admin3"\n1141. \n1142.     @classmethod\n1143.     def setUpTestData(cls):\n1144.         cls.superuser = User.objects.create_superuser(username=\'super\', password=\'secret\', email=\'super@example.com\')\n1145.         cls.s1 = Section.objects.create(name=\'Test section\')\n1146.         cls.a1 = Article.objects.create(\n1147.             content=\'<p>Middle content</p>\', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1\n1148.         )\n1149.         cls.a2 = Article.objects.create(\n1150.             content=\'<p>Oldest content</p>\', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1\n1151.         )\n1152.         cls.a3 = Article.objects.create(\n1153.             content=\'<p>Newest content</p>\', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1\n1154.         )\n1155.         cls.p1 = PrePopulatedPost.objects.create(title=\'A Long Title\', published=True, slug=\'a-long-title\')\n1156. \n1157.     def setUp(self):\n1158.         self.client.force_login(self.superuser)\n1159. \n1160.     def test_change_form_URL_has_correct_value(self):\n1161.         """\n1162.         change_view has form_url in response.context\n1163.         """\n1164.         response = self.client.get(\n1165.             reverse(\'admin:admin_views_section_change\', args=(self.s1.pk,), current_app=self.current_app)\n1166.         )\n1167.         self.assertIn(\'form_url\', response.context, msg=\'form_url not present in response.context\')\n1168.         self.assertEqual(response.context[\'form_url\'], \'pony\')\n1169. \n1170.     def test_initial_data_can_be_overridden(self):\n1171.         """\n1172.         The behavior for setting initial form data can be overridden in the\n1173.         ModelAdmin class. Usually, the initial value is set via the GET params.\n1174.         """\n1175.         response = self.client.get(\n1176.             reverse(\'admin:admin_views_restaurant_add\', current_app=self.current_app),\n1177.             {\'name\': \'test_value\'}\n1178.         )\n1179.         # this would be the usual behaviour\n1180.         self.assertNotContains(response, \'value="test_value"\')\n1181.         # this is the overridden behaviour\n1182.         self.assertContains(response, \'value="overridden_value"\')\n1183. \n\n\nFile: tests/admin_views/tests.py\nLine number range: 3587 - 3611\nContent:\n3587. class TestCustomChangeList(TestCase):\n3588. \n3589.     @classmethod\n3590.     def setUpTestData(cls):\n3591.         cls.superuser = User.objects.create_superuser(username=\'super\', password=\'secret\', email=\'super@example.com\')\n3592. \n3593.     def setUp(self):\n3594.         self.client.force_login(self.superuser)\n3595. \n3596.     def test_custom_changelist(self):\n3597.         """\n3598.         Validate that a custom ChangeList class can be used (#9749)\n3599.         """\n3600.         # Insert some data\n3601.         post_data = {"name": "First Gadget"}\n3602.         response = self.client.post(reverse(\'admin:admin_views_gadget_add\'), post_data)\n3603.         self.assertEqual(response.status_code, 302)  # redirect somewhere\n3604.         # Hit the page once to get messages out of the queue message list\n3605.         response = self.client.get(reverse(\'admin:admin_views_gadget_changelist\'))\n3606.         # Data is still not visible on the page\n3607.         response = self.client.get(reverse(\'admin:admin_views_gadget_changelist\'))\n3608.         self.assertEqual(response.status_code, 200)\n3609.         self.assertNotContains(response, \'First Gadget\')\n3610. \n3611. \n\n\nFile: tests/admin_views/tests.py\nLine number range: 2501 - 2690\nContent:\n2501. @skipUnlessDBFeature(\'can_defer_constraint_checks\')\n2502. @override_settings(ROOT_URLCONF=\'admin_views.urls\')\n2503. class AdminViewDeletedObjectsTest(TestCase):\n2504. \n2505.     @classmethod\n2506.     def setUpTestData(cls):\n2507.         cls.superuser = User.objects.create_superuser(username=\'super\', password=\'secret\', email=\'super@example.com\')\n2508.         cls.deleteuser = User.objects.create_user(username=\'deleteuser\', password=\'secret\', is_staff=True)\n2509.         cls.s1 = Section.objects.create(name=\'Test section\')\n2510.         cls.a1 = Article.objects.create(\n2511.             content=\'<p>Middle content</p>\', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1\n2512.         )\n2513.         cls.a2 = Article.objects.create(\n2514.             content=\'<p>Oldest content</p>\', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1\n2515.         )\n2516.         cls.a3 = Article.objects.create(\n2517.             content=\'<p>Newest content</p>\', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1\n2518.         )\n2519.         cls.p1 = PrePopulatedPost.objects.create(title=\'A Long Title\', published=True, slug=\'a-long-title\')\n2520. \n2521.         cls.v1 = Villain.objects.create(name=\'Adam\')\n2522.         cls.v2 = Villain.objects.create(name=\'Sue\')\n2523.         cls.sv1 = SuperVillain.objects.create(name=\'Bob\')\n2524.         cls.pl1 = Plot.objects.create(name=\'World Domination\', team_leader=cls.v1, contact=cls.v2)\n2525.         cls.pl2 = Plot.objects.create(name=\'World Peace\', team_leader=cls.v2, contact=cls.v2)\n2526.         cls.pl3 = Plot.objects.create(name=\'Corn Conspiracy\', team_leader=cls.v1, contact=cls.v1)\n2527.         cls.pd1 = PlotDetails.objects.create(details=\'almost finished\', plot=cls.pl1)\n2528.         cls.sh1 = SecretHideout.objects.create(location=\'underground bunker\', villain=cls.v1)\n2529.         cls.sh2 = SecretHideout.objects.create(location=\'floating castle\', villain=cls.sv1)\n2530.         cls.ssh1 = SuperSecretHideout.objects.create(location=\'super floating castle!\', supervillain=cls.sv1)\n2531.         cls.cy1 = CyclicOne.objects.create(name=\'I am recursive\', two_id=1)\n2532.         cls.cy2 = CyclicTwo.objects.create(name=\'I am recursive too\', one_id=1)\n2533. \n2534.     def setUp(self):\n2535.         self.client.force_login(self.superuser)\n2536. \n2537.     def test_nesting(self):\n2538.         """\n2539.         Objects should be nested to display the relationships that\n2540.         cause them to be scheduled for deletion.\n2541.         """\n2542.         pattern = re.compile(\n2543.             r\'<li>Plot: <a href="%s">World Domination</a>\\s*<ul>\\s*\'\n2544.             r\'<li>Plot details: <a href="%s">almost finished</a>\' % (\n2545.                 reverse(\'admin:admin_views_plot_change\', args=(self.pl1.pk,)),\n2546.                 reverse(\'admin:admin_views_plotdetails_change\', args=(self.pd1.pk,)),\n2547.             )\n2548.         )\n2549.         response = self.client.get(reverse(\'admin:admin_views_villain_delete\', args=(self.v1.pk,)))\n2550.         self.assertRegex(response.content.decode(), pattern)\n2551. \n2552.     def test_cyclic(self):\n2553.         """\n2554.         Cyclic relationships should still cause each object to only be\n2555.         listed once.\n2556.         """\n2557.         one = \'<li>Cyclic one: <a href="%s">I am recursive</a>\' % (\n2558.             reverse(\'admin:admin_views_cyclicone_change\', args=(self.cy1.pk,)),\n2559.         )\n2560.         two = \'<li>Cyclic two: <a href="%s">I am recursive too</a>\' % (\n2561.             reverse(\'admin:admin_views_cyclictwo_change\', args=(self.cy2.pk,)),\n2562.         )\n2563.         response = self.client.get(reverse(\'admin:admin_views_cyclicone_delete\', args=(self.cy1.pk,)))\n2564. \n2565.         self.assertContains(response, one, 1)\n2566.         self.assertContains(response, two, 1)\n2567. \n2568.     def test_perms_needed(self):\n2569.         self.client.logout()\n2570.         delete_user = User.objects.get(username=\'deleteuser\')\n2571.         delete_user.user_permissions.add(get_perm(Plot, get_permission_codename(\'delete\', Plot._meta)))\n2572. \n2573.         self.client.force_login(self.deleteuser)\n2574.         response = self.client.get(reverse(\'admin:admin_views_plot_delete\', args=(self.pl1.pk,)))\n2575.         self.assertContains(response, "your account doesn\'t have permission to delete the following types of objects")\n2576.         self.assertContains(response, "<li>plot details</li>")\n2577. \n2578.     def test_protected(self):\n2579.         q = Question.objects.create(question="Why?")\n2580.         a1 = Answer.objects.create(question=q, answer="Because.")\n2581.         a2 = Answer.objects.create(question=q, answer="Yes.")\n2582. \n2583.         response = self.client.get(reverse(\'admin:admin_views_question_delete\', args=(q.pk,)))\n2584.         self.assertContains(response, "would require deleting the following protected related objects")\n2585.         self.assertContains(\n2586.             response,\n2587.             \'<li>Answer: <a href="%s">Because.</a></li>\' % reverse(\'admin:admin_views_answer_change\', args=(a1.pk,))\n2588.         )\n2589.         self.assertContains(\n2590.             response,\n2591.             \'<li>Answer: <a href="%s">Yes.</a></li>\' % reverse(\'admin:admin_views_answer_change\', args=(a2.pk,))\n2592.         )\n2593. \n2594.     def test_post_delete_protected(self):\n2595.         """\n2596.         A POST request to delete protected objects should display the page\n2597.         which says the deletion is prohibited.\n2598.         """\n2599.         q = Question.objects.create(question=\'Why?\')\n2600.         Answer.objects.create(question=q, answer=\'Because.\')\n2601. \n2602.         response = self.client.post(reverse(\'admin:admin_views_question_delete\', args=(q.pk,)), {\'post\': \'yes\'})\n2603.         self.assertEqual(Question.objects.count(), 1)\n2604.         self.assertContains(response, "would require deleting the following protected related objects")\n2605. \n2606.     def test_not_registered(self):\n2607.         should_contain = """<li>Secret hideout: underground bunker"""\n2608.         response = self.client.get(reverse(\'admin:admin_views_villain_delete\', args=(self.v1.pk,)))\n2609.         self.assertContains(response, should_contain, 1)\n2610. \n2611.     def test_multiple_fkeys_to_same_model(self):\n2612.         """\n2613.         If a deleted object has two relationships from another model,\n2614.         both of those should be followed in looking for related\n2615.         objects to delete.\n2616.         """\n2617.         should_contain = \'<li>Plot: <a href="%s">World Domination</a>\' % reverse(\n2618.             \'admin:admin_views_plot_change\', args=(self.pl1.pk,)\n2619.         )\n2620.         response = self.client.get(reverse(\'admin:admin_views_villain_delete\', args=(self.v1.pk,)))\n2621.         self.assertContains(response, should_contain)\n2622.         response = self.client.get(reverse(\'admin:admin_views_villain_delete\', args=(self.v2.pk,)))\n2623.         self.assertContains(response, should_contain)\n2624. \n2625.     def test_multiple_fkeys_to_same_instance(self):\n2626.         """\n2627.         If a deleted object has two relationships pointing to it from\n2628.         another object, the other object should still only be listed\n2629.         once.\n2630.         """\n2631.         should_contain = \'<li>Plot: <a href="%s">World Peace</a></li>\' % reverse(\n2632.             \'admin:admin_views_plot_change\', args=(self.pl2.pk,)\n2633.         )\n2634.         response = self.client.get(reverse(\'admin:admin_views_villain_delete\', args=(self.v2.pk,)))\n2635.         self.assertContains(response, should_contain, 1)\n2636. \n2637.     def test_inheritance(self):\n2638.         """\n2639.         In the case of an inherited model, if either the child or\n2640.         parent-model instance is deleted, both instances are listed\n2641.         for deletion, as well as any relationships they have.\n2642.         """\n2643.         should_contain = [\n2644.             \'<li>Villain: <a href="%s">Bob</a>\' % reverse(\'admin:admin_views_villain_change\', args=(self.sv1.pk,)),\n2645.             \'<li>Super villain: <a href="%s">Bob</a>\' % reverse(\n2646.                 \'admin:admin_views_supervillain_change\', args=(self.sv1.pk,)\n2647.             ),\n2648.             \'<li>Secret hideout: floating castle\',\n2649.             \'<li>Super secret hideout: super floating castle!\',\n2650.         ]\n2651.         response = self.client.get(reverse(\'admin:admin_views_villain_delete\', args=(self.sv1.pk,)))\n2652.         for should in should_contain:\n2653.             self.assertContains(response, should, 1)\n2654.         response = self.client.get(reverse(\'admin:admin_views_supervillain_delete\', args=(self.sv1.pk,)))\n2655.         for should in should_contain:\n2656.             self.assertContains(response, should, 1)\n2657. \n2658.     def test_generic_relations(self):\n2659.         """\n2660.         If a deleted object has GenericForeignKeys pointing to it,\n2661.         those objects should be listed for deletion.\n2662.         """\n2663.         plot = self.pl3\n2664.         tag = FunkyTag.objects.create(content_object=plot, name=\'hott\')\n2665.         should_contain = \'<li>Funky tag: <a href="%s">hott\' % reverse(\n2666.             \'admin:admin_views_funkytag_change\', args=(tag.id,))\n2667.         response = self.client.get(reverse(\'admin:admin_views_plot_delete\', args=(plot.pk,)))\n2668.         self.assertContains(response, should_contain)\n2669. \n2670.     def test_generic_relations_with_related_query_name(self):\n2671.         """\n2672.         If a deleted object has GenericForeignKey with\n2673.         GenericRelation(related_query_name=\'...\') pointing to it, those objects\n2674.         should be listed for deletion.\n2675.         """\n2676.         bookmark = Bookmark.objects.create(name=\'djangoproject\')\n2677.         tag = FunkyTag.objects.create(content_object=bookmark, name=\'django\')\n2678.         tag_url = reverse(\'admin:admin_views_funkytag_change\', args=(tag.id,))\n2679.         should_contain = \'<li>Funky tag: <a href="%s">django\' % tag_url\n2680.         response = self.client.get(reverse(\'admin:admin_views_bookmark_delete\', args=(bookmark.pk,)))\n2681.         self.assertContains(response, should_contain)\n2682. \n2683.     def test_delete_view_uses_get_deleted_objects(self):\n2684.         """The delete view uses ModelAdmin.get_deleted_objects()."""\n2685.         book = Book.objects.create(name=\'Test Book\')\n2686.         response = self.client.get(reverse(\'admin2:admin_views_book_delete\', args=(book.pk,)))\n2687.         # BookAdmin.get_deleted_objects() returns custom text.\n2688.         self.assertContains(response, \'a deletable object\')\n2689. \n2690. \n\n\nFile: tests/admin_inlines/admin.py\nLine number range: 1 - 259\nContent:\n1. from django import forms\n2. from django.contrib import admin\n3. from django.db import models\n4. \n5. from .models import (\n6.     Author, BinaryTree, CapoFamiglia, Chapter, ChildModel1, ChildModel2,\n7.     Consigliere, EditablePKBook, ExtraTerrestrial, Fashionista, Holder,\n8.     Holder2, Holder3, Holder4, Inner, Inner2, Inner3, Inner4Stacked,\n9.     Inner4Tabular, NonAutoPKBook, NonAutoPKBookChild, Novel,\n10.     NovelReadonlyChapter, ParentModelWithCustomPk, Poll, Profile,\n11.     ProfileCollection, Question, ReadOnlyInline, ShoppingWeakness, Sighting,\n12.     SomeChildModel, SomeParentModel, SottoCapo, Title, TitleCollection,\n13. )\n14. \n15. site = admin.AdminSite(name="admin")\n16. \n17. \n18. class BookInline(admin.TabularInline):\n19.     model = Author.books.through\n20. \n21. \n22. class NonAutoPKBookTabularInline(admin.TabularInline):\n23.     model = NonAutoPKBook\n24.     classes = (\'collapse\',)\n25. \n26. \n27. class NonAutoPKBookChildTabularInline(admin.TabularInline):\n28.     model = NonAutoPKBookChild\n29.     classes = (\'collapse\',)\n30. \n31. \n32. class NonAutoPKBookStackedInline(admin.StackedInline):\n33.     model = NonAutoPKBook\n34.     classes = (\'collapse\',)\n35. \n36. \n37. class EditablePKBookTabularInline(admin.TabularInline):\n38.     model = EditablePKBook\n39. \n40. \n41. class EditablePKBookStackedInline(admin.StackedInline):\n42.     model = EditablePKBook\n43. \n44. \n45. class AuthorAdmin(admin.ModelAdmin):\n46.     inlines = [\n47.         BookInline, NonAutoPKBookTabularInline, NonAutoPKBookStackedInline,\n48.         EditablePKBookTabularInline, EditablePKBookStackedInline,\n49.         NonAutoPKBookChildTabularInline,\n50.     ]\n51. \n52. \n53. class InnerInline(admin.StackedInline):\n54.     model = Inner\n55.     can_delete = False\n56.     readonly_fields = (\'readonly\',)  # For bug #13174 tests.\n57. \n58. \n59. class HolderAdmin(admin.ModelAdmin):\n60. \n61.     class Media:\n62.         js = (\'my_awesome_admin_scripts.js\',)\n63. \n64. \n65. class ReadOnlyInlineInline(admin.TabularInline):\n66.     model = ReadOnlyInline\n67.     readonly_fields = [\'name\']\n68. \n69. \n70. class InnerInline2(admin.StackedInline):\n71.     model = Inner2\n72. \n73.     class Media:\n74.         js = (\'my_awesome_inline_scripts.js\',)\n75. \n76. \n77. class InnerInline2Tabular(admin.TabularInline):\n78.     model = Inner2\n79. \n80. \n81. class CustomNumberWidget(forms.NumberInput):\n82.     class Media:\n83.         js = (\'custom_number.js\',)\n84. \n85. \n86. class InnerInline3(admin.StackedInline):\n87.     model = Inner3\n88.     formfield_overrides = {\n89.         models.IntegerField: {\'widget\': CustomNumberWidget},\n90.     }\n91. \n92.     class Media:\n93.         js = (\'my_awesome_inline_scripts.js\',)\n94. \n95. \n96. class TitleForm(forms.ModelForm):\n97.     title1 = forms.CharField(max_length=100)\n98. \n99.     def clean(self):\n100.         cleaned_data = self.cleaned_data\n101.         title1 = cleaned_data.get("title1")\n102.         title2 = cleaned_data.get("title2")\n103.         if title1 != title2:\n104.             raise forms.ValidationError("The two titles must be the same")\n105.         return cleaned_data\n106. \n107. \n108. class TitleInline(admin.TabularInline):\n109.     model = Title\n110.     form = TitleForm\n111.     extra = 1\n112. \n113. \n114. class Inner4StackedInline(admin.StackedInline):\n115.     model = Inner4Stacked\n116.     show_change_link = True\n117. \n118. \n119. class Inner4TabularInline(admin.TabularInline):\n120.     model = Inner4Tabular\n121.     show_change_link = True\n122. \n123. \n124. class Holder4Admin(admin.ModelAdmin):\n125.     inlines = [Inner4StackedInline, Inner4TabularInline]\n126. \n127. \n128. class InlineWeakness(admin.TabularInline):\n129.     model = ShoppingWeakness\n130.     extra = 1\n131. \n132. \n133. class QuestionInline(admin.TabularInline):\n134.     model = Question\n135.     readonly_fields = [\'call_me\']\n136. \n137.     def call_me(self, obj):\n138.         return \'Callable in QuestionInline\'\n139. \n140. \n141. class PollAdmin(admin.ModelAdmin):\n142.     inlines = [QuestionInline]\n143. \n144.     def call_me(self, obj):\n145.         return \'Callable in PollAdmin\'\n146. \n147. \n148. class ChapterInline(admin.TabularInline):\n149.     model = Chapter\n150.     readonly_fields = [\'call_me\']\n151. \n152.     def call_me(self, obj):\n153.         return \'Callable in ChapterInline\'\n154. \n155. \n156. class NovelAdmin(admin.ModelAdmin):\n157.     inlines = [ChapterInline]\n158. \n159. \n160. class ReadOnlyChapterInline(admin.TabularInline):\n161.     model = Chapter\n162. \n163.     def has_change_permission(self, request, obj=None):\n164.         return False\n165. \n166. \n167. class NovelReadonlyChapterAdmin(admin.ModelAdmin):\n168.     inlines = [ReadOnlyChapterInline]\n169. \n170. \n171. class ConsigliereInline(admin.TabularInline):\n172.     model = Consigliere\n173. \n174. \n175. class SottoCapoInline(admin.TabularInline):\n176.     model = SottoCapo\n177. \n178. \n179. class ProfileInline(admin.TabularInline):\n180.     model = Profile\n181.     extra = 1\n182. \n183. \n184. # admin for #18433\n185. class ChildModel1Inline(admin.TabularInline):\n186.     model = ChildModel1\n187. \n188. \n189. class ChildModel2Inline(admin.StackedInline):\n190.     model = ChildModel2\n191. \n192. \n193. # admin for #19425 and #18388\n194. class BinaryTreeAdmin(admin.TabularInline):\n195.     model = BinaryTree\n196. \n197.     def get_extra(self, request, obj=None, **kwargs):\n198.         extra = 2\n199.         if obj:\n200.             return extra - obj.binarytree_set.count()\n201.         return extra\n202. \n203.     def get_max_num(self, request, obj=None, **kwargs):\n204.         max_num = 3\n205.         if obj:\n206.             return max_num - obj.binarytree_set.count()\n207.         return max_num\n208. \n209. \n210. # admin for #19524\n211. class SightingInline(admin.TabularInline):\n212.     model = Sighting\n213. \n214. \n215. # admin and form for #18263\n216. class SomeChildModelForm(forms.ModelForm):\n217. \n218.     class Meta:\n219.         fields = \'__all__\'\n220.         model = SomeChildModel\n221.         widgets = {\n222.             \'position\': forms.HiddenInput,\n223.         }\n224.         labels = {\'readonly_field\': \'Label from ModelForm.Meta\'}\n225.         help_texts = {\'readonly_field\': \'Help text from ModelForm.Meta\'}\n226. \n227.     def __init__(self, *args, **kwargs):\n228.         super().__init__(*args, **kwargs)\n229.         self.fields[\'name\'].label = \'new label\'\n230. \n231. \n232. class SomeChildModelInline(admin.TabularInline):\n233.     model = SomeChildModel\n234.     form = SomeChildModelForm\n235.     readonly_fields = (\'readonly_field\',)\n236. \n237. \n238. site.register(TitleCollection, inlines=[TitleInline])\n239. # Test bug #12561 and #12778\n240. # only ModelAdmin media\n241. site.register(Holder, HolderAdmin, inlines=[InnerInline])\n242. # ModelAdmin and Inline media\n243. site.register(Holder2, HolderAdmin, inlines=[InnerInline2, InnerInline2Tabular])\n244. # only Inline media\n245. site.register(Holder3, inlines=[InnerInline3])\n246. \n247. site.register(Poll, PollAdmin)\n248. site.register(Novel, NovelAdmin)\n249. site.register(NovelReadonlyChapter, NovelReadonlyChapterAdmin)\n250. site.register(Fashionista, inlines=[InlineWeakness])\n251. site.register(Holder4, Holder4Admin)\n252. site.register(Author, AuthorAdmin)\n253. site.register(CapoFamiglia, inlines=[ConsigliereInline, SottoCapoInline, ReadOnlyInlineInline])\n254. site.register(ProfileCollection, inlines=[ProfileInline])\n255. site.register(ParentModelWithCustomPk, inlines=[ChildModel1Inline, ChildModel2Inline])\n256. site.register(BinaryTree, inlines=[BinaryTreeAdmin])\n257. site.register(ExtraTerrestrial, inlines=[SightingInline])\n258. site.register(SomeParentModel, inlines=[SomeChildModelInline])\n259. site.register([Question, Inner4Stacked, Inner4Tabular])\n\n\nFile: tests/admin_inlines/tests.py\nLine number range: 568 - 853\nContent:\n568. class TestInlinePermissions(TestCase):\n569.     """\n570.     Make sure the admin respects permissions for objects that are edited\n571.     inline. Refs #8060.\n572.     """\n573. \n574.     @classmethod\n575.     def setUpTestData(cls):\n576.         cls.user = User(username=\'admin\', is_staff=True, is_active=True)\n577.         cls.user.set_password(\'secret\')\n578.         cls.user.save()\n579. \n580.         cls.author_ct = ContentType.objects.get_for_model(Author)\n581.         cls.holder_ct = ContentType.objects.get_for_model(Holder2)\n582.         cls.book_ct = ContentType.objects.get_for_model(Book)\n583.         cls.inner_ct = ContentType.objects.get_for_model(Inner2)\n584. \n585.         # User always has permissions to add and change Authors, and Holders,\n586.         # the main (parent) models of the inlines. Permissions on the inlines\n587.         # vary per test.\n588.         permission = Permission.objects.get(codename=\'add_author\', content_type=cls.author_ct)\n589.         cls.user.user_permissions.add(permission)\n590.         permission = Permission.objects.get(codename=\'change_author\', content_type=cls.author_ct)\n591.         cls.user.user_permissions.add(permission)\n592.         permission = Permission.objects.get(codename=\'add_holder2\', content_type=cls.holder_ct)\n593.         cls.user.user_permissions.add(permission)\n594.         permission = Permission.objects.get(codename=\'change_holder2\', content_type=cls.holder_ct)\n595.         cls.user.user_permissions.add(permission)\n596. \n597.         author = Author.objects.create(pk=1, name=\'The Author\')\n598.         cls.book = author.books.create(name=\'The inline Book\')\n599.         cls.author_change_url = reverse(\'admin:admin_inlines_author_change\', args=(author.id,))\n600.         # Get the ID of the automatically created intermediate model for the Author-Book m2m\n601.         author_book_auto_m2m_intermediate = Author.books.through.objects.get(author=author, book=cls.book)\n602.         cls.author_book_auto_m2m_intermediate_id = author_book_auto_m2m_intermediate.pk\n603. \n604.         cls.holder = Holder2.objects.create(dummy=13)\n605.         cls.inner2 = Inner2.objects.create(dummy=42, holder=cls.holder)\n606. \n607.     def setUp(self):\n608.         self.holder_change_url = reverse(\'admin:admin_inlines_holder2_change\', args=(self.holder.id,))\n609.         self.client.force_login(self.user)\n610. \n611.     def test_inline_add_m2m_noperm(self):\n612.         response = self.client.get(reverse(\'admin:admin_inlines_author_add\'))\n613.         # No change permission on books, so no inline\n614.         self.assertNotContains(response, \'<h2>Author-book relationships</h2>\')\n615.         self.assertNotContains(response, \'Add another Author-Book Relationship\')\n616.         self.assertNotContains(response, \'id="id_Author_books-TOTAL_FORMS"\')\n617. \n618.     def test_inline_add_fk_noperm(self):\n619.         response = self.client.get(reverse(\'admin:admin_inlines_holder2_add\'))\n620.         # No permissions on Inner2s, so no inline\n621.         self.assertNotContains(response, \'<h2>Inner2s</h2>\')\n622.         self.assertNotContains(response, \'Add another Inner2\')\n623.         self.assertNotContains(response, \'id="id_inner2_set-TOTAL_FORMS"\')\n624. \n625.     def test_inline_change_m2m_noperm(self):\n626.         response = self.client.get(self.author_change_url)\n627.         # No change permission on books, so no inline\n628.         self.assertNotContains(response, \'<h2>Author-book relationships</h2>\')\n629.         self.assertNotContains(response, \'Add another Author-Book Relationship\')\n630.         self.assertNotContains(response, \'id="id_Author_books-TOTAL_FORMS"\')\n631. \n632.     def test_inline_change_fk_noperm(self):\n633.         response = self.client.get(self.holder_change_url)\n634.         # No permissions on Inner2s, so no inline\n635.         self.assertNotContains(response, \'<h2>Inner2s</h2>\')\n636.         self.assertNotContains(response, \'Add another Inner2\')\n637.         self.assertNotContains(response, \'id="id_inner2_set-TOTAL_FORMS"\')\n638. \n639.     def test_inline_add_m2m_view_only_perm(self):\n640.         permission = Permission.objects.get(codename=\'view_book\', content_type=self.book_ct)\n641.         self.user.user_permissions.add(permission)\n642.         response = self.client.get(reverse(\'admin:admin_inlines_author_add\'))\n643.         # View-only inlines. (It could be nicer to hide the empty, non-editable\n644.         # inlines on the add page.)\n645.         self.assertIs(response.context[\'inline_admin_formset\'].has_view_permission, True)\n646.         self.assertIs(response.context[\'inline_admin_formset\'].has_add_permission, False)\n647.         self.assertIs(response.context[\'inline_admin_formset\'].has_change_permission, False)\n648.         self.assertIs(response.context[\'inline_admin_formset\'].has_delete_permission, False)\n649.         self.assertContains(response, \'<h2>Author-book relationships</h2>\')\n650.         self.assertContains(\n651.             response,\n652.             \'<input type="hidden" name="Author_books-TOTAL_FORMS" value="0" \'\n653.             \'id="id_Author_books-TOTAL_FORMS">\',\n654.             html=True,\n655.         )\n656.         self.assertNotContains(response, \'Add another Author-Book Relationship\')\n657. \n658.     def test_inline_add_m2m_add_perm(self):\n659.         permission = Permission.objects.get(codename=\'add_book\', content_type=self.book_ct)\n660.         self.user.user_permissions.add(permission)\n661.         response = self.client.get(reverse(\'admin:admin_inlines_author_add\'))\n662.         # No change permission on Books, so no inline\n663.         self.assertNotContains(response, \'<h2>Author-book relationships</h2>\')\n664.         self.assertNotContains(response, \'Add another Author-Book Relationship\')\n665.         self.assertNotContains(response, \'id="id_Author_books-TOTAL_FORMS"\')\n666. \n667.     def test_inline_add_fk_add_perm(self):\n668.         permission = Permission.objects.get(codename=\'add_inner2\', content_type=self.inner_ct)\n669.         self.user.user_permissions.add(permission)\n670.         response = self.client.get(reverse(\'admin:admin_inlines_holder2_add\'))\n671.         # Add permission on inner2s, so we get the inline\n672.         self.assertContains(response, \'<h2>Inner2s</h2>\')\n673.         self.assertContains(response, \'Add another Inner2\')\n674.         self.assertContains(response, \'<input type="hidden" id="id_inner2_set-TOTAL_FORMS" \'\n675.                             \'value="3" name="inner2_set-TOTAL_FORMS">\', html=True)\n676. \n677.     def test_inline_change_m2m_add_perm(self):\n678.         permission = Permission.objects.get(codename=\'add_book\', content_type=self.book_ct)\n679.         self.user.user_permissions.add(permission)\n680.         response = self.client.get(self.author_change_url)\n681.         # No change permission on books, so no inline\n682.         self.assertNotContains(response, \'<h2>Author-book relationships</h2>\')\n683.         self.assertNotContains(response, \'Add another Author-Book Relationship\')\n684.         self.assertNotContains(response, \'id="id_Author_books-TOTAL_FORMS"\')\n685.         self.assertNotContains(response, \'id="id_Author_books-0-DELETE"\')\n686. \n687.     def test_inline_change_m2m_view_only_perm(self):\n688.         permission = Permission.objects.get(codename=\'view_book\', content_type=self.book_ct)\n689.         self.user.user_permissions.add(permission)\n690.         response = self.client.get(self.author_change_url)\n691.         # View-only inlines.\n692.         self.assertIs(response.context[\'inline_admin_formset\'].has_view_permission, True)\n693.         self.assertIs(response.context[\'inline_admin_formset\'].has_add_permission, False)\n694.         self.assertIs(response.context[\'inline_admin_formset\'].has_change_permission, False)\n695.         self.assertIs(response.context[\'inline_admin_formset\'].has_delete_permission, False)\n696.         self.assertContains(response, \'<h2>Author-book relationships</h2>\')\n697.         self.assertContains(\n698.             response,\n699.             \'<input type="hidden" name="Author_books-TOTAL_FORMS" value="1" \'\n700.             \'id="id_Author_books-TOTAL_FORMS">\',\n701.             html=True,\n702.         )\n703.         # The field in the inline is read-only.\n704.         self.assertContains(response, \'<p>%s</p>\' % self.book)\n705.         self.assertNotContains(\n706.             response,\n707.             \'<input type="checkbox" name="Author_books-0-DELETE" id="id_Author_books-0-DELETE">\',\n708.             html=True,\n709.         )\n710. \n711.     def test_inline_change_m2m_change_perm(self):\n712.         permission = Permission.objects.get(codename=\'change_book\', content_type=self.book_ct)\n713.         self.user.user_permissions.add(permission)\n714.         response = self.client.get(self.author_change_url)\n715.         # We have change perm on books, so we can add/change/delete inlines\n716.         self.assertIs(response.context[\'inline_admin_formset\'].has_view_permission, True)\n717.         self.assertIs(response.context[\'inline_admin_formset\'].has_add_permission, True)\n718.         self.assertIs(response.context[\'inline_admin_formset\'].has_change_permission, True)\n719.         self.assertIs(response.context[\'inline_admin_formset\'].has_delete_permission, True)\n720.         self.assertContains(response, \'<h2>Author-book relationships</h2>\')\n721.         self.assertContains(response, \'Add another Author-book relationship\')\n722.         self.assertContains(response, \'<input type="hidden" id="id_Author_books-TOTAL_FORMS" \'\n723.                             \'value="4" name="Author_books-TOTAL_FORMS">\', html=True)\n724.         self.assertContains(\n725.             response,\n726.             \'<input type="hidden" id="id_Author_books-0-id" value="%i" \'\n727.             \'name="Author_books-0-id">\' % self.author_book_auto_m2m_intermediate_id,\n728.             html=True\n729.         )\n730.         self.assertContains(response, \'id="id_Author_books-0-DELETE"\')\n731. \n732.     def test_inline_change_fk_add_perm(self):\n733.         permission = Permission.objects.get(codename=\'add_inner2\', content_type=self.inner_ct)\n734.         self.user.user_permissions.add(permission)\n735.         response = self.client.get(self.holder_change_url)\n736.         # Add permission on inner2s, so we can add but not modify existing\n737.         self.assertContains(response, \'<h2>Inner2s</h2>\')\n738.         self.assertContains(response, \'Add another Inner2\')\n739.         # 3 extra forms only, not the existing instance form\n740.         self.assertContains(\n741.             response,\n742.             \'<input type="hidden" id="id_inner2_set-TOTAL_FORMS" value="3" \'\n743.             \'name="inner2_set-TOTAL_FORMS">\',\n744.             html=True\n745.         )\n746.         self.assertNotContains(\n747.             response,\n748.             \'<input type="hidden" id="id_inner2_set-0-id" value="%i" name="inner2_set-0-id">\' % self.inner2.id,\n749.             html=True\n750.         )\n751. \n752.     def test_inline_change_fk_change_perm(self):\n753.         permission = Permission.objects.get(codename=\'change_inner2\', content_type=self.inner_ct)\n754.         self.user.user_permissions.add(permission)\n755.         response = self.client.get(self.holder_change_url)\n756.         # Change permission on inner2s, so we can change existing but not add new\n757.         self.assertContains(response, \'<h2>Inner2s</h2>\', count=2)\n758.         # Just the one form for existing instances\n759.         self.assertContains(\n760.             response, \'<input type="hidden" id="id_inner2_set-TOTAL_FORMS" value="1" name="inner2_set-TOTAL_FORMS">\',\n761.             html=True\n762.         )\n763.         self.assertContains(\n764.             response,\n765.             \'<input type="hidden" id="id_inner2_set-0-id" value="%i" name="inner2_set-0-id">\' % self.inner2.id,\n766.             html=True\n767.         )\n768.         # max-num 0 means we can\'t add new ones\n769.         self.assertContains(\n770.             response,\n771.             \'<input type="hidden" id="id_inner2_set-MAX_NUM_FORMS" value="0" name="inner2_set-MAX_NUM_FORMS">\',\n772.             html=True\n773.         )\n774.         # TabularInline\n775.         self.assertContains(response, \'<th class="column-dummy required">Dummy</th>\', html=True)\n776.         self.assertContains(\n777.             response,\n778.             \'<input type="number" name="inner2_set-2-0-dummy" value="%s" \'\n779.             \'class="vIntegerField" id="id_inner2_set-2-0-dummy">\' % self.inner2.dummy,\n780.             html=True,\n781.         )\n782. \n783.     def test_inline_change_fk_add_change_perm(self):\n784.         permission = Permission.objects.get(codename=\'add_inner2\', content_type=self.inner_ct)\n785.         self.user.user_permissions.add(permission)\n786.         permission = Permission.objects.get(codename=\'change_inner2\', content_type=self.inner_ct)\n787.         self.user.user_permissions.add(permission)\n788.         response = self.client.get(self.holder_change_url)\n789.         # Add/change perm, so we can add new and change existing\n790.         self.assertContains(response, \'<h2>Inner2s</h2>\')\n791.         # One form for existing instance and three extra for new\n792.         self.assertContains(\n793.             response, \'<input type="hidden" id="id_inner2_set-TOTAL_FORMS" value="4" name="inner2_set-TOTAL_FORMS">\',\n794.             html=True\n795.         )\n796.         self.assertContains(\n797.             response,\n798.             \'<input type="hidden" id="id_inner2_set-0-id" value="%i" name="inner2_set-0-id">\' % self.inner2.id,\n799.             html=True\n800.         )\n801. \n802.     def test_inline_change_fk_change_del_perm(self):\n803.         permission = Permission.objects.get(codename=\'change_inner2\', content_type=self.inner_ct)\n804.         self.user.user_permissions.add(permission)\n805.         permission = Permission.objects.get(codename=\'delete_inner2\', content_type=self.inner_ct)\n806.         self.user.user_permissions.add(permission)\n807.         response = self.client.get(self.holder_change_url)\n808.         # Change/delete perm on inner2s, so we can change/delete existing\n809.         self.assertContains(response, \'<h2>Inner2s</h2>\')\n810.         # One form for existing instance only, no new\n811.         self.assertContains(\n812.             response,\n813.             \'<input type="hidden" id="id_inner2_set-TOTAL_FORMS" value="1" name="inner2_set-TOTAL_FORMS">\',\n814.             html=True\n815.         )\n816.         self.assertContains(\n817.             response,\n818.             \'<input type="hidden" id="id_inner2_set-0-id" value="%i" name="inner2_set-0-id">\' % self.inner2.id,\n819.             html=True\n820.         )\n821.         self.assertContains(response, \'id="id_inner2_set-0-DELETE"\')\n822. \n823.     def test_inline_change_fk_all_perms(self):\n824.         permission = Permission.objects.get(codename=\'add_inner2\', content_type=self.inner_ct)\n825.         self.user.user_permissions.add(permission)\n826.         permission = Permission.objects.get(codename=\'change_inner2\', content_type=self.inner_ct)\n827.         self.user.user_permissions.add(permission)\n828.         permission = Permission.objects.get(codename=\'delete_inner2\', content_type=self.inner_ct)\n829.         self.user.user_permissions.add(permission)\n830.         response = self.client.get(self.holder_change_url)\n831.         # All perms on inner2s, so we can add/change/delete\n832.         self.assertContains(response, \'<h2>Inner2s</h2>\', count=2)\n833.         # One form for existing instance only, three for new\n834.         self.assertContains(\n835.             response,\n836.             \'<input type="hidden" id="id_inner2_set-TOTAL_FORMS" value="4" name="inner2_set-TOTAL_FORMS">\',\n837.             html=True\n838.         )\n839.         self.assertContains(\n840.             response,\n841.             \'<input type="hidden" id="id_inner2_set-0-id" value="%i" name="inner2_set-0-id">\' % self.inner2.id,\n842.             html=True\n843.         )\n844.         self.assertContains(response, \'id="id_inner2_set-0-DELETE"\')\n845.         # TabularInline\n846.         self.assertContains(response, \'<th class="column-dummy required">Dummy</th>\', html=True)\n847.         self.assertContains(\n848.             response,\n849.             \'<input type="number" name="inner2_set-2-0-dummy" value="%s" \'\n850.             \'class="vIntegerField" id="id_inner2_set-2-0-dummy">\' % self.inner2.dummy,\n851.             html=True,\n852.         )\n853. \n\n\nFile: tests/admin_inlines/tests.py\nLine number range: 28 - 372\nContent:\n28. @override_settings(ROOT_URLCONF=\'admin_inlines.urls\')\n29. class TestInline(TestDataMixin, TestCase):\n30.     factory = RequestFactory()\n31. \n32.     @classmethod\n33.     def setUpTestData(cls):\n34.         super().setUpTestData()\n35.         cls.holder = Holder.objects.create(dummy=13)\n36.         Inner.objects.create(dummy=42, holder=cls.holder)\n37. \n38.     def setUp(self):\n39.         self.client.force_login(self.superuser)\n40. \n41.     def test_can_delete(self):\n42.         """\n43.         can_delete should be passed to inlineformset factory.\n44.         """\n45.         response = self.client.get(\n46.             reverse(\'admin:admin_inlines_holder_change\', args=(self.holder.id,))\n47.         )\n48.         inner_formset = response.context[\'inline_admin_formsets\'][0].formset\n49.         expected = InnerInline.can_delete\n50.         actual = inner_formset.can_delete\n51.         self.assertEqual(expected, actual, \'can_delete must be equal\')\n52. \n53.     def test_readonly_stacked_inline_label(self):\n54.         """Bug #13174."""\n55.         holder = Holder.objects.create(dummy=42)\n56.         Inner.objects.create(holder=holder, dummy=42, readonly=\'\')\n57.         response = self.client.get(\n58.             reverse(\'admin:admin_inlines_holder_change\', args=(holder.id,))\n59.         )\n60.         self.assertContains(response, \'<label>Inner readonly label:</label>\')\n61. \n62.     def test_many_to_many_inlines(self):\n63.         "Autogenerated many-to-many inlines are displayed correctly (#13407)"\n64.         response = self.client.get(reverse(\'admin:admin_inlines_author_add\'))\n65.         # The heading for the m2m inline block uses the right text\n66.         self.assertContains(response, \'<h2>Author-book relationships</h2>\')\n67.         # The "add another" label is correct\n68.         self.assertContains(response, \'Add another Author-book relationship\')\n69.         # The \'+\' is dropped from the autogenerated form prefix (Author_books+)\n70.         self.assertContains(response, \'id="id_Author_books-TOTAL_FORMS"\')\n71. \n72.     def test_inline_primary(self):\n73.         person = Person.objects.create(firstname=\'Imelda\')\n74.         item = OutfitItem.objects.create(name=\'Shoes\')\n75.         # Imelda likes shoes, but can\'t carry her own bags.\n76.         data = {\n77.             \'shoppingweakness_set-TOTAL_FORMS\': 1,\n78.             \'shoppingweakness_set-INITIAL_FORMS\': 0,\n79.             \'shoppingweakness_set-MAX_NUM_FORMS\': 0,\n80.             \'_save\': \'Save\',\n81.             \'person\': person.id,\n82.             \'max_weight\': 0,\n83.             \'shoppingweakness_set-0-item\': item.id,\n84.         }\n85.         response = self.client.post(reverse(\'admin:admin_inlines_fashionista_add\'), data)\n86.         self.assertEqual(response.status_code, 302)\n87.         self.assertEqual(len(Fashionista.objects.filter(person__firstname=\'Imelda\')), 1)\n88. \n89.     def test_tabular_inline_column_css_class(self):\n90.         """\n91.         Field names are included in the context to output a field-specific\n92.         CSS class name in the column headers.\n93.         """\n94.         response = self.client.get(reverse(\'admin:admin_inlines_poll_add\'))\n95.         text_field, call_me_field = list(response.context[\'inline_admin_formset\'].fields())\n96.         # Editable field.\n97.         self.assertEqual(text_field[\'name\'], \'text\')\n98.         self.assertContains(response, \'<th class="column-text required">\')\n99.         # Read-only field.\n100.         self.assertEqual(call_me_field[\'name\'], \'call_me\')\n101.         self.assertContains(response, \'<th class="column-call_me">\')\n102. \n103.     def test_custom_form_tabular_inline_label(self):\n104.         """\n105.         A model form with a form field specified (TitleForm.title1) should have\n106.         its label rendered in the tabular inline.\n107.         """\n108.         response = self.client.get(reverse(\'admin:admin_inlines_titlecollection_add\'))\n109.         self.assertContains(response, \'<th class="column-title1 required">Title1</th>\', html=True)\n110. \n111.     def test_custom_form_tabular_inline_overridden_label(self):\n112.         """\n113.         SomeChildModelForm.__init__() overrides the label of a form field.\n114.         That label is displayed in the TabularInline.\n115.         """\n116.         response = self.client.get(reverse(\'admin:admin_inlines_someparentmodel_add\'))\n117.         field = list(response.context[\'inline_admin_formset\'].fields())[0]\n118.         self.assertEqual(field[\'label\'], \'new label\')\n119.         self.assertContains(response, \'<th class="column-name required">New label</th>\', html=True)\n120. \n121.     def test_tabular_non_field_errors(self):\n122.         """\n123.         non_field_errors are displayed correctly, including the correct value\n124.         for colspan.\n125.         """\n126.         data = {\n127.             \'title_set-TOTAL_FORMS\': 1,\n128.             \'title_set-INITIAL_FORMS\': 0,\n129.             \'title_set-MAX_NUM_FORMS\': 0,\n130.             \'_save\': \'Save\',\n131.             \'title_set-0-title1\': \'a title\',\n132.             \'title_set-0-title2\': \'a different title\',\n133.         }\n134.         response = self.client.post(reverse(\'admin:admin_inlines_titlecollection_add\'), data)\n135.         # Here colspan is "4": two fields (title1 and title2), one hidden field and the delete checkbox.\n136.         self.assertContains(\n137.             response,\n138.             \'<tr><td colspan="4"><ul class="errorlist nonfield">\'\n139.             \'<li>The two titles must be the same</li></ul></td></tr>\'\n140.         )\n141. \n142.     def test_no_parent_callable_lookup(self):\n143.         """Admin inline `readonly_field` shouldn\'t invoke parent ModelAdmin callable"""\n144.         # Identically named callable isn\'t present in the parent ModelAdmin,\n145.         # rendering of the add view shouldn\'t explode\n146.         response = self.client.get(reverse(\'admin:admin_inlines_novel_add\'))\n147.         self.assertEqual(response.status_code, 200)\n148.         # View should have the child inlines section\n149.         self.assertContains(\n150.             response,\n151.             \'<div class="js-inline-admin-formset inline-group" id="chapter_set-group"\'\n152.         )\n153. \n154.     def test_callable_lookup(self):\n155.         """Admin inline should invoke local callable when its name is listed in readonly_fields"""\n156.         response = self.client.get(reverse(\'admin:admin_inlines_poll_add\'))\n157.         self.assertEqual(response.status_code, 200)\n158.         # Add parent object view should have the child inlines section\n159.         self.assertContains(\n160.             response,\n161.             \'<div class="js-inline-admin-formset inline-group" id="question_set-group"\'\n162.         )\n163.         # The right callable should be used for the inline readonly_fields\n164.         # column cells\n165.         self.assertContains(response, \'<p>Callable in QuestionInline</p>\')\n166. \n167.     def test_help_text(self):\n168.         """\n169.         The inlines\' model field help texts are displayed when using both the\n170.         stacked and tabular layouts.\n171.         """\n172.         response = self.client.get(reverse(\'admin:admin_inlines_holder4_add\'))\n173.         self.assertContains(response, \'<div class="help">Awesome stacked help text is awesome.</div>\', 4)\n174.         self.assertContains(\n175.             response,\n176.             \'<img src="/static/admin/img/icon-unknown.svg" \'\n177.             \'class="help help-tooltip" width="10" height="10" \'\n178.             \'alt="(Awesome tabular help text is awesome.)" \'\n179.             \'title="Awesome tabular help text is awesome.">\',\n180.             1\n181.         )\n182.         # ReadOnly fields\n183.         response = self.client.get(reverse(\'admin:admin_inlines_capofamiglia_add\'))\n184.         self.assertContains(\n185.             response,\n186.             \'<img src="/static/admin/img/icon-unknown.svg" \'\n187.             \'class="help help-tooltip" width="10" height="10" \'\n188.             \'alt="(Help text for ReadOnlyInline)" \'\n189.             \'title="Help text for ReadOnlyInline">\',\n190.             1\n191.         )\n192. \n193.     def test_tabular_model_form_meta_readonly_field(self):\n194.         """\n195.         Tabular inlines use ModelForm.Meta.help_texts and labels for read-only\n196.         fields.\n197.         """\n198.         response = self.client.get(reverse(\'admin:admin_inlines_someparentmodel_add\'))\n199.         self.assertContains(\n200.             response,\n201.             \'<img src="/static/admin/img/icon-unknown.svg" \'\n202.             \'class="help help-tooltip" width="10" height="10" \'\n203.             \'alt="(Help text from ModelForm.Meta)" \'\n204.             \'title="Help text from ModelForm.Meta">\'\n205.         )\n206.         self.assertContains(response, \'Label from ModelForm.Meta\')\n207. \n208.     def test_inline_hidden_field_no_column(self):\n209.         """#18263 -- Make sure hidden fields don\'t get a column in tabular inlines"""\n210.         parent = SomeParentModel.objects.create(name=\'a\')\n211.         SomeChildModel.objects.create(name=\'b\', position=\'0\', parent=parent)\n212.         SomeChildModel.objects.create(name=\'c\', position=\'1\', parent=parent)\n213.         response = self.client.get(reverse(\'admin:admin_inlines_someparentmodel_change\', args=(parent.pk,)))\n214.         self.assertNotContains(response, \'<td class="field-position">\')\n215.         self.assertInHTML(\n216.             \'<input id="id_somechildmodel_set-1-position" \'\n217.             \'name="somechildmodel_set-1-position" type="hidden" value="1">\',\n218.             response.rendered_content,\n219.         )\n220. \n221.     def test_non_related_name_inline(self):\n222.         """\n223.         Multiple inlines with related_name=\'+\' have correct form prefixes.\n224.         """\n225.         response = self.client.get(reverse(\'admin:admin_inlines_capofamiglia_add\'))\n226.         self.assertContains(response, \'<input type="hidden" name="-1-0-id" id="id_-1-0-id">\', html=True)\n227.         self.assertContains(\n228.             response,\n229.             \'<input type="hidden" name="-1-0-capo_famiglia" id="id_-1-0-capo_famiglia">\',\n230.             html=True\n231.         )\n232.         self.assertContains(\n233.             response,\n234.             \'<input id="id_-1-0-name" type="text" class="vTextField" name="-1-0-name" maxlength="100">\',\n235.             html=True\n236.         )\n237.         self.assertContains(response, \'<input type="hidden" name="-2-0-id" id="id_-2-0-id">\', html=True)\n238.         self.assertContains(\n239.             response,\n240.             \'<input type="hidden" name="-2-0-capo_famiglia" id="id_-2-0-capo_famiglia">\',\n241.             html=True\n242.         )\n243.         self.assertContains(\n244.             response,\n245.             \'<input id="id_-2-0-name" type="text" class="vTextField" name="-2-0-name" maxlength="100">\',\n246.             html=True\n247.         )\n248. \n249.     @override_settings(USE_L10N=True, USE_THOUSAND_SEPARATOR=True)\n250.     def test_localize_pk_shortcut(self):\n251.         """\n252.         The "View on Site" link is correct for locales that use thousand\n253.         separators.\n254.         """\n255.         holder = Holder.objects.create(pk=123456789, dummy=42)\n256.         inner = Inner.objects.create(pk=987654321, holder=holder, dummy=42, readonly=\'\')\n257.         response = self.client.get(reverse(\'admin:admin_inlines_holder_change\', args=(holder.id,)))\n258.         inner_shortcut = \'r/%s/%s/\' % (ContentType.objects.get_for_model(inner).pk, inner.pk)\n259.         self.assertContains(response, inner_shortcut)\n260. \n261.     def test_custom_pk_shortcut(self):\n262.         """\n263.         The "View on Site" link is correct for models with a custom primary key\n264.         field.\n265.         """\n266.         parent = ParentModelWithCustomPk.objects.create(my_own_pk="foo", name="Foo")\n267.         child1 = ChildModel1.objects.create(my_own_pk="bar", name="Bar", parent=parent)\n268.         child2 = ChildModel2.objects.create(my_own_pk="baz", name="Baz", parent=parent)\n269.         response = self.client.get(reverse(\'admin:admin_inlines_parentmodelwithcustompk_change\', args=(\'foo\',)))\n270.         child1_shortcut = \'r/%s/%s/\' % (ContentType.objects.get_for_model(child1).pk, child1.pk)\n271.         child2_shortcut = \'r/%s/%s/\' % (ContentType.objects.get_for_model(child2).pk, child2.pk)\n272.         self.assertContains(response, child1_shortcut)\n273.         self.assertContains(response, child2_shortcut)\n274. \n275.     def test_create_inlines_on_inherited_model(self):\n276.         """\n277.         An object can be created with inlines when it inherits another class.\n278.         """\n279.         data = {\n280.             \'name\': \'Martian\',\n281.             \'sighting_set-TOTAL_FORMS\': 1,\n282.             \'sighting_set-INITIAL_FORMS\': 0,\n283.             \'sighting_set-MAX_NUM_FORMS\': 0,\n284.             \'sighting_set-0-place\': \'Zone 51\',\n285.             \'_save\': \'Save\',\n286.         }\n287.         response = self.client.post(reverse(\'admin:admin_inlines_extraterrestrial_add\'), data)\n288.         self.assertEqual(response.status_code, 302)\n289.         self.assertEqual(Sighting.objects.filter(et__name=\'Martian\').count(), 1)\n290. \n291.     def test_custom_get_extra_form(self):\n292.         bt_head = BinaryTree.objects.create(name="Tree Head")\n293.         BinaryTree.objects.create(name="First Child", parent=bt_head)\n294.         # The maximum number of forms should respect \'get_max_num\' on the\n295.         # ModelAdmin\n296.         max_forms_input = (\n297.             \'<input id="id_binarytree_set-MAX_NUM_FORMS" \'\n298.             \'name="binarytree_set-MAX_NUM_FORMS" type="hidden" value="%d">\'\n299.         )\n300.         # The total number of forms will remain the same in either case\n301.         total_forms_hidden = (\n302.             \'<input id="id_binarytree_set-TOTAL_FORMS" \'\n303.             \'name="binarytree_set-TOTAL_FORMS" type="hidden" value="2">\'\n304.         )\n305.         response = self.client.get(reverse(\'admin:admin_inlines_binarytree_add\'))\n306.         self.assertInHTML(max_forms_input % 3, response.rendered_content)\n307.         self.assertInHTML(total_forms_hidden, response.rendered_content)\n308. \n309.         response = self.client.get(reverse(\'admin:admin_inlines_binarytree_change\', args=(bt_head.id,)))\n310.         self.assertInHTML(max_forms_input % 2, response.rendered_content)\n311.         self.assertInHTML(total_forms_hidden, response.rendered_content)\n312. \n313.     def test_min_num(self):\n314.         """\n315.         min_num and extra determine number of forms.\n316.         """\n317.         class MinNumInline(TabularInline):\n318.             model = BinaryTree\n319.             min_num = 2\n320.             extra = 3\n321. \n322.         modeladmin = ModelAdmin(BinaryTree, admin_site)\n323.         modeladmin.inlines = [MinNumInline]\n324.         min_forms = (\n325.             \'<input id="id_binarytree_set-MIN_NUM_FORMS" \'\n326.             \'name="binarytree_set-MIN_NUM_FORMS" type="hidden" value="2">\'\n327.         )\n328.         total_forms = (\n329.             \'<input id="id_binarytree_set-TOTAL_FORMS" \'\n330.             \'name="binarytree_set-TOTAL_FORMS" type="hidden" value="5">\'\n331.         )\n332.         request = self.factory.get(reverse(\'admin:admin_inlines_binarytree_add\'))\n333.         request.user = User(username=\'super\', is_superuser=True)\n334.         response = modeladmin.changeform_view(request)\n335.         self.assertInHTML(min_forms, response.rendered_content)\n336.         self.assertInHTML(total_forms, response.rendered_content)\n337. \n338.     def test_custom_min_num(self):\n339.         bt_head = BinaryTree.objects.create(name="Tree Head")\n340.         BinaryTree.objects.create(name="First Child", parent=bt_head)\n341. \n342.         class MinNumInline(TabularInline):\n343.             model = BinaryTree\n344.             extra = 3\n345. \n346.             def get_min_num(self, request, obj=None, **kwargs):\n347.                 if obj:\n348.                     return 5\n349.                 return 2\n350. \n351.         modeladmin = ModelAdmin(BinaryTree, admin_site)\n352.         modeladmin.inlines = [MinNumInline]\n353.         min_forms = (\n354.             \'<input id="id_binarytree_set-MIN_NUM_FORMS" \'\n355.             \'name="binarytree_set-MIN_NUM_FORMS" type="hidden" value="%d">\'\n356.         )\n357.         total_forms = (\n358.             \'<input id="id_binarytree_set-TOTAL_FORMS" \'\n359.             \'name="binarytree_set-TOTAL_FORMS" type="hidden" value="%d">\'\n360.         )\n361.         request = self.factory.get(reverse(\'admin:admin_inlines_binarytree_add\'))\n362.         request.user = User(username=\'super\', is_superuser=True)\n363.         response = modeladmin.changeform_view(request)\n364.         self.assertInHTML(min_forms % 2, response.rendered_content)\n365.         self.assertInHTML(total_forms % 5, response.rendered_content)\n366. \n367.         request = self.factory.get(reverse(\'admin:admin_inlines_binarytree_change\', args=(bt_head.id,)))\n368.         request.user = User(username=\'super\', is_superuser=True)\n369.         response = modeladmin.changeform_view(request, object_id=str(bt_head.id))\n370.         self.assertInHTML(min_forms % 5, response.rendered_content)\n371.         self.assertInHTML(total_forms % 8, response.rendered_content)\n372. \n\n\nFile: tests/admin_views/tests.py\nLine number range: 1405 - 2046\nContent:\n1405. class AdminViewPermissionsTest(TestCase):\n1406.     """Tests for Admin Views Permissions."""\n1407. \n1408.     @classmethod\n1409.     def setUpTestData(cls):\n1410.         cls.superuser = User.objects.create_superuser(username=\'super\', password=\'secret\', email=\'super@example.com\')\n1411.         cls.viewuser = User.objects.create_user(username=\'viewuser\', password=\'secret\', is_staff=True)\n1412.         cls.adduser = User.objects.create_user(username=\'adduser\', password=\'secret\', is_staff=True)\n1413.         cls.changeuser = User.objects.create_user(username=\'changeuser\', password=\'secret\', is_staff=True)\n1414.         cls.deleteuser = User.objects.create_user(username=\'deleteuser\', password=\'secret\', is_staff=True)\n1415.         cls.joepublicuser = User.objects.create_user(username=\'joepublic\', password=\'secret\')\n1416.         cls.nostaffuser = User.objects.create_user(username=\'nostaff\', password=\'secret\')\n1417.         cls.s1 = Section.objects.create(name=\'Test section\')\n1418.         cls.a1 = Article.objects.create(\n1419.             content=\'<p>Middle content</p>\', date=datetime.datetime(2008, 3, 18, 11, 54, 58), section=cls.s1,\n1420.             another_section=cls.s1,\n1421.         )\n1422.         cls.a2 = Article.objects.create(\n1423.             content=\'<p>Oldest content</p>\', date=datetime.datetime(2000, 3, 18, 11, 54, 58), section=cls.s1\n1424.         )\n1425.         cls.a3 = Article.objects.create(\n1426.             content=\'<p>Newest content</p>\', date=datetime.datetime(2009, 3, 18, 11, 54, 58), section=cls.s1\n1427.         )\n1428.         cls.p1 = PrePopulatedPost.objects.create(title=\'A Long Title\', published=True, slug=\'a-long-title\')\n1429. \n1430.         # Setup permissions, for our users who can add, change, and delete.\n1431.         opts = Article._meta\n1432. \n1433.         # User who can view Articles\n1434.         cls.viewuser.user_permissions.add(get_perm(Article, get_permission_codename(\'view\', opts)))\n1435.         # User who can add Articles\n1436.         cls.adduser.user_permissions.add(get_perm(Article, get_permission_codename(\'add\', opts)))\n1437.         # User who can change Articles\n1438.         cls.changeuser.user_permissions.add(get_perm(Article, get_permission_codename(\'change\', opts)))\n1439.         cls.nostaffuser.user_permissions.add(get_perm(Article, get_permission_codename(\'change\', opts)))\n1440. \n1441.         # User who can delete Articles\n1442.         cls.deleteuser.user_permissions.add(get_perm(Article, get_permission_codename(\'delete\', opts)))\n1443.         cls.deleteuser.user_permissions.add(get_perm(Section, get_permission_codename(\'delete\', Section._meta)))\n1444. \n1445.         # login POST dicts\n1446.         cls.index_url = reverse(\'admin:index\')\n1447.         cls.super_login = {\n1448.             REDIRECT_FIELD_NAME: cls.index_url,\n1449.             \'username\': \'super\',\n1450.             \'password\': \'secret\',\n1451.         }\n1452.         cls.super_email_login = {\n1453.             REDIRECT_FIELD_NAME: cls.index_url,\n1454.             \'username\': \'super@example.com\',\n1455.             \'password\': \'secret\',\n1456.         }\n1457.         cls.super_email_bad_login = {\n1458.             REDIRECT_FIELD_NAME: cls.index_url,\n1459.             \'username\': \'super@example.com\',\n1460.             \'password\': \'notsecret\',\n1461.         }\n1462.         cls.adduser_login = {\n1463.             REDIRECT_FIELD_NAME: cls.index_url,\n1464.             \'username\': \'adduser\',\n1465.             \'password\': \'secret\',\n1466.         }\n1467.         cls.changeuser_login = {\n1468.             REDIRECT_FIELD_NAME: cls.index_url,\n1469.             \'username\': \'changeuser\',\n1470.             \'password\': \'secret\',\n1471.         }\n1472.         cls.deleteuser_login = {\n1473.             REDIRECT_FIELD_NAME: cls.index_url,\n1474.             \'username\': \'deleteuser\',\n1475.             \'password\': \'secret\',\n1476.         }\n1477.         cls.nostaff_login = {\n1478.             REDIRECT_FIELD_NAME: reverse(\'has_permission_admin:index\'),\n1479.             \'username\': \'nostaff\',\n1480.             \'password\': \'secret\',\n1481.         }\n1482.         cls.joepublic_login = {\n1483.             REDIRECT_FIELD_NAME: cls.index_url,\n1484.             \'username\': \'joepublic\',\n1485.             \'password\': \'secret\',\n1486.         }\n1487.         cls.viewuser_login = {\n1488.             REDIRECT_FIELD_NAME: cls.index_url,\n1489.             \'username\': \'viewuser\',\n1490.             \'password\': \'secret\',\n1491.         }\n1492.         cls.no_username_login = {\n1493.             REDIRECT_FIELD_NAME: cls.index_url,\n1494.             \'password\': \'secret\',\n1495.         }\n1496. \n1497.     def test_login(self):\n1498.         """\n1499.         Make sure only staff members can log in.\n1500. \n1501.         Successful posts to the login page will redirect to the original url.\n1502.         Unsuccessful attempts will continue to render the login page with\n1503.         a 200 status code.\n1504.         """\n1505.         login_url = \'%s?next=%s\' % (reverse(\'admin:login\'), reverse(\'admin:index\'))\n1506.         # Super User\n1507.         response = self.client.get(self.index_url)\n1508.         self.assertRedirects(response, login_url)\n1509.         login = self.client.post(login_url, self.super_login)\n1510.         self.assertRedirects(login, self.index_url)\n1511.         self.assertFalse(login.context)\n1512.         self.client.get(reverse(\'admin:logout\'))\n1513. \n1514.         # Test if user enters email address\n1515.         response = self.client.get(self.index_url)\n1516.         self.assertEqual(response.status_code, 302)\n1517.         login = self.client.post(login_url, self.super_email_login)\n1518.         self.assertContains(login, ERROR_MESSAGE)\n1519.         # only correct passwords get a username hint\n1520.         login = self.client.post(login_url, self.super_email_bad_login)\n1521.         self.assertContains(login, ERROR_MESSAGE)\n1522.         new_user = User(username=\'jondoe\', password=\'secret\', email=\'super@example.com\')\n1523.         new_user.save()\n1524.         # check to ensure if there are multiple email addresses a user doesn\'t get a 500\n1525.         login = self.client.post(login_url, self.super_email_login)\n1526.         self.assertContains(login, ERROR_MESSAGE)\n1527. \n1528.         # View User\n1529.         response = self.client.get(self.index_url)\n1530.         self.assertEqual(response.status_code, 302)\n1531.         login = self.client.post(login_url, self.viewuser_login)\n1532.         self.assertRedirects(login, self.index_url)\n1533.         self.assertFalse(login.context)\n1534.         self.client.get(reverse(\'admin:logout\'))\n1535. \n1536.         # Add User\n1537.         response = self.client.get(self.index_url)\n1538.         self.assertEqual(response.status_code, 302)\n1539.         login = self.client.post(login_url, self.adduser_login)\n1540.         self.assertRedirects(login, self.index_url)\n1541.         self.assertFalse(login.context)\n1542.         self.client.get(reverse(\'admin:logout\'))\n1543. \n1544.         # Change User\n1545.         response = self.client.get(self.index_url)\n1546.         self.assertEqual(response.status_code, 302)\n1547.         login = self.client.post(login_url, self.changeuser_login)\n1548.         self.assertRedirects(login, self.index_url)\n1549.         self.assertFalse(login.context)\n1550.         self.client.get(reverse(\'admin:logout\'))\n1551. \n1552.         # Delete User\n1553.         response = self.client.get(self.index_url)\n1554.         self.assertEqual(response.status_code, 302)\n1555.         login = self.client.post(login_url, self.deleteuser_login)\n1556.         self.assertRedirects(login, self.index_url)\n1557.         self.assertFalse(login.context)\n1558.         self.client.get(reverse(\'admin:logout\'))\n1559. \n1560.         # Regular User should not be able to login.\n1561.         response = self.client.get(self.index_url)\n1562.         self.assertEqual(response.status_code, 302)\n1563.         login = self.client.post(login_url, self.joepublic_login)\n1564.         self.assertEqual(login.status_code, 200)\n1565.         self.assertContains(login, ERROR_MESSAGE)\n1566. \n1567.         # Requests without username should not return 500 errors.\n1568.         response = self.client.get(self.index_url)\n1569.         self.assertEqual(response.status_code, 302)\n1570.         login = self.client.post(login_url, self.no_username_login)\n1571.         self.assertEqual(login.status_code, 200)\n1572.         self.assertFormError(login, \'form\', \'username\', [\'This field is required.\'])\n1573. \n1574.     def test_login_redirect_for_direct_get(self):\n1575.         """\n1576.         Login redirect should be to the admin index page when going directly to\n1577.         /admin/login/.\n1578.         """\n1579.         response = self.client.get(reverse(\'admin:login\'))\n1580.         self.assertEqual(response.status_code, 200)\n1581.         self.assertEqual(response.context[REDIRECT_FIELD_NAME], reverse(\'admin:index\'))\n1582. \n1583.     def test_login_has_permission(self):\n1584.         # Regular User should not be able to login.\n1585.         response = self.client.get(reverse(\'has_permission_admin:index\'))\n1586.         self.assertEqual(response.status_code, 302)\n1587.         login = self.client.post(reverse(\'has_permission_admin:login\'), self.joepublic_login)\n1588.         self.assertEqual(login.status_code, 200)\n1589.         self.assertContains(login, \'permission denied\')\n1590. \n1591.         # User with permissions should be able to login.\n1592.         response = self.client.get(reverse(\'has_permission_admin:index\'))\n1593.         self.assertEqual(response.status_code, 302)\n1594.         login = self.client.post(reverse(\'has_permission_admin:login\'), self.nostaff_login)\n1595.         self.assertRedirects(login, reverse(\'has_permission_admin:index\'))\n1596.         self.assertFalse(login.context)\n1597.         self.client.get(reverse(\'has_permission_admin:logout\'))\n1598. \n1599.         # Staff should be able to login.\n1600.         response = self.client.get(reverse(\'has_permission_admin:index\'))\n1601.         self.assertEqual(response.status_code, 302)\n1602.         login = self.client.post(reverse(\'has_permission_admin:login\'), {\n1603.             REDIRECT_FIELD_NAME: reverse(\'has_permission_admin:index\'),\n1604.             \'username\': \'deleteuser\',\n1605.             \'password\': \'secret\',\n1606.         })\n1607.         self.assertRedirects(login, reverse(\'has_permission_admin:index\'))\n1608.         self.assertFalse(login.context)\n1609.         self.client.get(reverse(\'has_permission_admin:logout\'))\n1610. \n1611.     def test_login_successfully_redirects_to_original_URL(self):\n1612.         response = self.client.get(self.index_url)\n1613.         self.assertEqual(response.status_code, 302)\n1614.         query_string = \'the-answer=42\'\n1615.         redirect_url = \'%s?%s\' % (self.index_url, query_string)\n1616.         new_next = {REDIRECT_FIELD_NAME: redirect_url}\n1617.         post_data = self.super_login.copy()\n1618.         post_data.pop(REDIRECT_FIELD_NAME)\n1619.         login = self.client.post(\n1620.             \'%s?%s\' % (reverse(\'admin:login\'), urlencode(new_next)),\n1621.             post_data)\n1622.         self.assertRedirects(login, redirect_url)\n1623. \n1624.     def test_double_login_is_not_allowed(self):\n1625.         """Regression test for #19327"""\n1626.         login_url = \'%s?next=%s\' % (reverse(\'admin:login\'), reverse(\'admin:index\'))\n1627. \n1628.         response = self.client.get(self.index_url)\n1629.         self.assertEqual(response.status_code, 302)\n1630. \n1631.         # Establish a valid admin session\n1632.         login = self.client.post(login_url, self.super_login)\n1633.         self.assertRedirects(login, self.index_url)\n1634.         self.assertFalse(login.context)\n1635. \n1636.         # Logging in with non-admin user fails\n1637.         login = self.client.post(login_url, self.joepublic_login)\n1638.         self.assertEqual(login.status_code, 200)\n1639.         self.assertContains(login, ERROR_MESSAGE)\n1640. \n1641.         # Establish a valid admin session\n1642.         login = self.client.post(login_url, self.super_login)\n1643.         self.assertRedirects(login, self.index_url)\n1644.         self.assertFalse(login.context)\n1645. \n1646.         # Logging in with admin user while already logged in\n1647.         login = self.client.post(login_url, self.super_login)\n1648.         self.assertRedirects(login, self.index_url)\n1649.         self.assertFalse(login.context)\n1650.         self.client.get(reverse(\'admin:logout\'))\n1651. \n1652.     def test_login_page_notice_for_non_staff_users(self):\n1653.         """\n1654.         A logged-in non-staff user trying to access the admin index should be\n1655.         presented with the login page and a hint indicating that the current\n1656.         user doesn\'t have access to it.\n1657.         """\n1658.         hint_template = \'You are authenticated as {}\'\n1659. \n1660.         # Anonymous user should not be shown the hint\n1661.         response = self.client.get(self.index_url, follow=True)\n1662.         self.assertContains(response, \'login-form\')\n1663.         self.assertNotContains(response, hint_template.format(\'\'), status_code=200)\n1664. \n1665.         # Non-staff user should be shown the hint\n1666.         self.client.force_login(self.nostaffuser)\n1667.         response = self.client.get(self.index_url, follow=True)\n1668.         self.assertContains(response, \'login-form\')\n1669.         self.assertContains(response, hint_template.format(self.nostaffuser.username), status_code=200)\n1670. \n1671.     def test_add_view(self):\n1672.         """Test add view restricts access and actually adds items."""\n1673.         add_dict = {\n1674.             \'title\': \'Døm ikke\',\n1675.             \'content\': \'<p>great article</p>\',\n1676.             \'date_0\': \'2008-03-18\', \'date_1\': \'10:54:39\',\n1677.             \'section\': self.s1.pk,\n1678.         }\n1679.         # Change User should not have access to add articles\n1680.         self.client.force_login(self.changeuser)\n1681.         # make sure the view removes test cookie\n1682.         self.assertIs(self.client.session.test_cookie_worked(), False)\n1683.         response = self.client.get(reverse(\'admin:admin_views_article_add\'))\n1684.         self.assertEqual(response.status_code, 403)\n1685.         # Try POST just to make sure\n1686.         post = self.client.post(reverse(\'admin:admin_views_article_add\'), add_dict)\n1687.         self.assertEqual(post.status_code, 403)\n1688.         self.assertEqual(Article.objects.count(), 3)\n1689.         self.client.get(reverse(\'admin:logout\'))\n1690. \n1691.         # View User should not have access to add articles\n1692.         self.client.force_login(self.viewuser)\n1693.         response = self.client.get(reverse(\'admin:admin_views_article_add\'))\n1694.         self.assertEqual(response.status_code, 403)\n1695.         # Try POST just to make sure\n1696.         post = self.client.post(reverse(\'admin:admin_views_article_add\'), add_dict)\n1697.         self.assertEqual(post.status_code, 403)\n1698.         self.assertEqual(Article.objects.count(), 3)\n1699.         # Now give the user permission to add but not change.\n1700.         self.viewuser.user_permissions.add(get_perm(Article, get_permission_codename(\'add\', Article._meta)))\n1701.         response = self.client.get(reverse(\'admin:admin_views_article_add\'))\n1702.         self.assertContains(response, \'<input type="submit" value="Save and view" name="_continue">\')\n1703.         post = self.client.post(reverse(\'admin:admin_views_article_add\'), add_dict, follow=False)\n1704.         self.assertEqual(post.status_code, 302)\n1705.         self.assertEqual(Article.objects.count(), 4)\n1706.         article = Article.objects.latest(\'pk\')\n1707.         response = self.client.get(reverse(\'admin:admin_views_article_change\', args=(article.pk,)))\n1708.         self.assertContains(response, \'<li class="success">The article "Døm ikke" was added successfully.</li>\')\n1709.         article.delete()\n1710.         self.client.get(reverse(\'admin:logout\'))\n1711. \n1712.         # Add user may login and POST to add view, then redirect to admin root\n1713.         self.client.force_login(self.adduser)\n1714.         addpage = self.client.get(reverse(\'admin:admin_views_article_add\'))\n1715.         change_list_link = \'&rsaquo; <a href="%s">Articles</a>\' % reverse(\'admin:admin_views_article_changelist\')\n1716.         self.assertNotContains(\n1717.             addpage, change_list_link,\n1718.             msg_prefix=\'User restricted to add permission is given link to change list view in breadcrumbs.\'\n1719.         )\n1720.         post = self.client.post(reverse(\'admin:admin_views_article_add\'), add_dict)\n1721.         self.assertRedirects(post, self.index_url)\n1722.         self.assertEqual(Article.objects.count(), 4)\n1723.         self.assertEqual(len(mail.outbox), 2)\n1724.         self.assertEqual(mail.outbox[0].subject, \'Greetings from a created object\')\n1725.         self.client.get(reverse(\'admin:logout\'))\n1726. \n1727.         # The addition was logged correctly\n1728.         addition_log = LogEntry.objects.all()[0]\n1729.         new_article = Article.objects.last()\n1730.         article_ct = ContentType.objects.get_for_model(Article)\n1731.         self.assertEqual(addition_log.user_id, self.adduser.pk)\n1732.         self.assertEqual(addition_log.content_type_id, article_ct.pk)\n1733.         self.assertEqual(addition_log.object_id, str(new_article.pk))\n1734.         self.assertEqual(addition_log.object_repr, "Døm ikke")\n1735.         self.assertEqual(addition_log.action_flag, ADDITION)\n1736.         self.assertEqual(addition_log.get_change_message(), "Added.")\n1737. \n1738.         # Super can add too, but is redirected to the change list view\n1739.         self.client.force_login(self.superuser)\n1740.         addpage = self.client.get(reverse(\'admin:admin_views_article_add\'))\n1741.         self.assertContains(\n1742.             addpage, change_list_link,\n1743.             msg_prefix=\'Unrestricted user is not given link to change list view in breadcrumbs.\'\n1744.         )\n1745.         post = self.client.post(reverse(\'admin:admin_views_article_add\'), add_dict)\n1746.         self.assertRedirects(post, reverse(\'admin:admin_views_article_changelist\'))\n1747.         self.assertEqual(Article.objects.count(), 5)\n1748.         self.client.get(reverse(\'admin:logout\'))\n1749. \n1750.         # 8509 - if a normal user is already logged in, it is possible\n1751.         # to change user into the superuser without error\n1752.         self.client.force_login(self.joepublicuser)\n1753.         # Check and make sure that if user expires, data still persists\n1754.         self.client.force_login(self.superuser)\n1755.         # make sure the view removes test cookie\n1756.         self.assertIs(self.client.session.test_cookie_worked(), False)\n1757. \n1758.     @mock.patch(\'django.contrib.admin.options.InlineModelAdmin.has_change_permission\')\n1759.     def test_add_view_with_view_only_inlines(self, has_change_permission):\n1760.         """User with add permission to a section but view-only for inlines."""\n1761.         self.viewuser.user_permissions.add(get_perm(Section, get_permission_codename(\'add\', Section._meta)))\n1762.         self.client.force_login(self.viewuser)\n1763.         # Valid POST creates a new section.\n1764.         data = {\n1765.             \'name\': \'New obj\',\n1766.             \'article_set-TOTAL_FORMS\': 0,\n1767.             \'article_set-INITIAL_FORMS\': 0,\n1768.         }\n1769.         response = self.client.post(reverse(\'admin:admin_views_section_add\'), data)\n1770.         self.assertRedirects(response, reverse(\'admin:index\'))\n1771.         self.assertEqual(Section.objects.latest(\'id\').name, data[\'name\'])\n1772.         # InlineModelAdmin.has_change_permission()\'s obj argument is always\n1773.         # None during object add.\n1774.         self.assertEqual([obj for (request, obj), _ in has_change_permission.call_args_list], [None, None])\n1775. \n1776.     def test_change_view(self):\n1777.         """Change view should restrict access and allow users to edit items."""\n1778.         change_dict = {\n1779.             \'title\': \'Ikke fordømt\',\n1780.             \'content\': \'<p>edited article</p>\',\n1781.             \'date_0\': \'2008-03-18\', \'date_1\': \'10:54:39\',\n1782.             \'section\': self.s1.pk,\n1783.         }\n1784.         article_change_url = reverse(\'admin:admin_views_article_change\', args=(self.a1.pk,))\n1785.         article_changelist_url = reverse(\'admin:admin_views_article_changelist\')\n1786. \n1787.         # add user should not be able to view the list of article or change any of them\n1788.         self.client.force_login(self.adduser)\n1789.         response = self.client.get(article_changelist_url)\n1790.         self.assertEqual(response.status_code, 403)\n1791.         response = self.client.get(article_change_url)\n1792.         self.assertEqual(response.status_code, 403)\n1793.         post = self.client.post(article_change_url, change_dict)\n1794.         self.assertEqual(post.status_code, 403)\n1795.         self.client.get(reverse(\'admin:logout\'))\n1796. \n1797.         # view user should be able to view the article but not change any of them\n1798.         # (the POST can be sent, but no modification occurs)\n1799.         self.client.force_login(self.viewuser)\n1800.         response = self.client.get(article_changelist_url)\n1801.         self.assertEqual(response.status_code, 200)\n1802.         self.assertEqual(response.context[\'title\'], \'Select article to view\')\n1803.         response = self.client.get(article_change_url)\n1804.         self.assertEqual(response.status_code, 200)\n1805.         self.assertEqual(response.context[\'title\'], \'View article\')\n1806.         self.assertContains(response, \'<label>Extra form field:</label>\')\n1807.         self.assertContains(response, \'<a href="/test_admin/admin/admin_views/article/" class="closelink">Close</a>\')\n1808.         post = self.client.post(article_change_url, change_dict)\n1809.         self.assertEqual(post.status_code, 302)\n1810.         self.assertEqual(Article.objects.get(pk=self.a1.pk).content, \'<p>Middle content</p>\')\n1811.         self.client.get(reverse(\'admin:logout\'))\n1812. \n1813.         # change user can view all items and edit them\n1814.         self.client.force_login(self.changeuser)\n1815.         response = self.client.get(article_changelist_url)\n1816.         self.assertEqual(response.status_code, 200)\n1817.         self.assertEqual(response.context[\'title\'], \'Select article to change\')\n1818.         response = self.client.get(article_change_url)\n1819.         self.assertEqual(response.status_code, 200)\n1820.         self.assertEqual(response.context[\'title\'], \'Change article\')\n1821.         post = self.client.post(article_change_url, change_dict)\n1822.         self.assertRedirects(post, article_changelist_url)\n1823.         self.assertEqual(Article.objects.get(pk=self.a1.pk).content, \'<p>edited article</p>\')\n1824. \n1825.         # one error in form should produce singular error message, multiple errors plural\n1826.         change_dict[\'title\'] = \'\'\n1827.         post = self.client.post(article_change_url, change_dict)\n1828.         self.assertContains(\n1829.             post, \'Please correct the error below.\',\n1830.             msg_prefix=\'Singular error message not found in response to post with one error\'\n1831.         )\n1832. \n1833.         change_dict[\'content\'] = \'\'\n1834.         post = self.client.post(article_change_url, change_dict)\n1835.         self.assertContains(\n1836.             post, \'Please correct the errors below.\',\n1837.             msg_prefix=\'Plural error message not found in response to post with multiple errors\'\n1838.         )\n1839.         self.client.get(reverse(\'admin:logout\'))\n1840. \n1841.         # Test redirection when using row-level change permissions. Refs #11513.\n1842.         r1 = RowLevelChangePermissionModel.objects.create(id=1, name="odd id")\n1843.         r2 = RowLevelChangePermissionModel.objects.create(id=2, name="even id")\n1844.         r3 = RowLevelChangePermissionModel.objects.create(id=3, name=\'odd id mult 3\')\n1845.         r6 = RowLevelChangePermissionModel.objects.create(id=6, name=\'even id mult 3\')\n1846.         change_url_1 = reverse(\'admin:admin_views_rowlevelchangepermissionmodel_change\', args=(r1.pk,))\n1847.         change_url_2 = reverse(\'admin:admin_views_rowlevelchangepermissionmodel_change\', args=(r2.pk,))\n1848.         change_url_3 = reverse(\'admin:admin_views_rowlevelchangepermissionmodel_change\', args=(r3.pk,))\n1849.         change_url_6 = reverse(\'admin:admin_views_rowlevelchangepermissionmodel_change\', args=(r6.pk,))\n1850.         logins = [self.superuser, self.viewuser, self.adduser, self.changeuser, self.deleteuser]\n1851.         for login_user in logins:\n1852.             with self.subTest(login_user.username):\n1853.                 self.client.force_login(login_user)\n1854.                 response = self.client.get(change_url_1)\n1855.                 self.assertEqual(response.status_code, 403)\n1856.                 response = self.client.post(change_url_1, {\'name\': \'changed\'})\n1857.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=1).name, \'odd id\')\n1858.                 self.assertEqual(response.status_code, 403)\n1859.                 response = self.client.get(change_url_2)\n1860.                 self.assertEqual(response.status_code, 200)\n1861.                 response = self.client.post(change_url_2, {\'name\': \'changed\'})\n1862.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=2).name, \'changed\')\n1863.                 self.assertRedirects(response, self.index_url)\n1864.                 response = self.client.get(change_url_3)\n1865.                 self.assertEqual(response.status_code, 200)\n1866.                 response = self.client.post(change_url_3, {\'name\': \'changed\'})\n1867.                 self.assertRedirects(response, self.index_url)\n1868.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=3).name, \'odd id mult 3\')\n1869.                 response = self.client.get(change_url_6)\n1870.                 self.assertEqual(response.status_code, 200)\n1871.                 response = self.client.post(change_url_6, {\'name\': \'changed\'})\n1872.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=6).name, \'changed\')\n1873.                 self.assertRedirects(response, self.index_url)\n1874. \n1875.                 self.client.get(reverse(\'admin:logout\'))\n1876. \n1877.         for login_user in [self.joepublicuser, self.nostaffuser]:\n1878.             with self.subTest(login_user.username):\n1879.                 self.client.force_login(login_user)\n1880.                 response = self.client.get(change_url_1, follow=True)\n1881.                 self.assertContains(response, \'login-form\')\n1882.                 response = self.client.post(change_url_1, {\'name\': \'changed\'}, follow=True)\n1883.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=1).name, \'odd id\')\n1884.                 self.assertContains(response, \'login-form\')\n1885.                 response = self.client.get(change_url_2, follow=True)\n1886.                 self.assertContains(response, \'login-form\')\n1887.                 response = self.client.post(change_url_2, {\'name\': \'changed again\'}, follow=True)\n1888.                 self.assertEqual(RowLevelChangePermissionModel.objects.get(id=2).name, \'changed\')\n1889.                 self.assertContains(response, \'login-form\')\n1890.                 self.client.get(reverse(\'admin:logout\'))\n1891. \n1892.     def test_change_view_without_object_change_permission(self):\n1893.         """\n1894.         The object should be read-only if the user has permission to view it\n1895.         and change objects of that type but not to change the current object.\n1896.         """\n1897.         change_url = reverse(\'admin9:admin_views_article_change\', args=(self.a1.pk,))\n1898.         self.client.force_login(self.viewuser)\n1899.         response = self.client.get(change_url)\n1900.         self.assertEqual(response.status_code, 200)\n1901.         self.assertEqual(response.context[\'title\'], \'View article\')\n1902.         self.assertContains(response, \'<a href="/test_admin/admin9/admin_views/article/" class="closelink">Close</a>\')\n1903. \n1904.     def test_change_view_post_without_object_change_permission(self):\n1905.         """A POST redirects to changelist without modifications."""\n1906.         change_dict = {\n1907.             \'title\': \'Ikke fordømt\',\n1908.             \'content\': \'<p>edited article</p>\',\n1909.             \'date_0\': \'2008-03-18\', \'date_1\': \'10:54:39\',\n1910.             \'section\': self.s1.pk,\n1911.         }\n1912.         change_url = reverse(\'admin10:admin_views_article_change\', args=(self.a1.pk,))\n1913.         changelist_url = reverse(\'admin10:admin_views_article_changelist\')\n1914.         self.client.force_login(self.viewuser)\n1915.         response = self.client.post(change_url, change_dict)\n1916.         self.assertRedirects(response, changelist_url)\n1917.         self.assertEqual(Article.objects.get(pk=self.a1.pk).content, \'<p>Middle content</p>\')\n1918. \n1919.     def test_change_view_save_as_new(self):\n1920.         """\n1921.         \'Save as new\' should raise PermissionDenied for users without the \'add\'\n1922.         permission.\n1923.         """\n1924.         change_dict_save_as_new = {\n1925.             \'_saveasnew\': \'Save as new\',\n1926.             \'title\': \'Ikke fordømt\',\n1927.             \'content\': \'<p>edited article</p>\',\n1928.             \'date_0\': \'2008-03-18\', \'date_1\': \'10:54:39\',\n1929.             \'section\': self.s1.pk,\n1930.         }\n1931.         article_change_url = reverse(\'admin:admin_views_article_change\', args=(self.a1.pk,))\n1932. \n1933.         # Add user can perform "Save as new".\n1934.         article_count = Article.objects.count()\n1935.         self.client.force_login(self.adduser)\n1936.         post = self.client.post(article_change_url, change_dict_save_as_new)\n1937.         self.assertRedirects(post, self.index_url)\n1938.         self.assertEqual(Article.objects.count(), article_count + 1)\n1939.         self.client.logout()\n1940. \n1941.         # Change user cannot perform "Save as new" (no \'add\' permission).\n1942.         article_count = Article.objects.count()\n1943.         self.client.force_login(self.changeuser)\n1944.         post = self.client.post(article_change_url, change_dict_save_as_new)\n1945.         self.assertEqual(post.status_code, 403)\n1946.         self.assertEqual(Article.objects.count(), article_count)\n1947. \n1948.         # User with both add and change permissions should be redirected to the\n1949.         # change page for the newly created object.\n1950.         article_count = Article.objects.count()\n1951.         self.client.force_login(self.superuser)\n1952.         post = self.client.post(article_change_url, change_dict_save_as_new)\n1953.         self.assertEqual(Article.objects.count(), article_count + 1)\n1954.         new_article = Article.objects.latest(\'id\')\n1955.         self.assertRedirects(post, reverse(\'admin:admin_views_article_change\', args=(new_article.pk,)))\n1956. \n1957.     def test_change_view_with_view_only_inlines(self):\n1958.         """\n1959.         User with change permission to a section but view-only for inlines.\n1960.         """\n1961.         self.viewuser.user_permissions.add(get_perm(Section, get_permission_codename(\'change\', Section._meta)))\n1962.         self.client.force_login(self.viewuser)\n1963.         # GET shows inlines.\n1964.         response = self.client.get(reverse(\'admin:admin_views_section_change\', args=(self.s1.pk,)))\n1965.         self.assertEqual(len(response.context[\'inline_admin_formsets\']), 1)\n1966.         formset = response.context[\'inline_admin_formsets\'][0]\n1967.         self.assertEqual(len(formset.forms), 3)\n1968.         # Valid POST changes the name.\n1969.         data = {\n1970.             \'name\': \'Can edit name with view-only inlines\',\n1971.             \'article_set-TOTAL_FORMS\': 3,\n1972.             \'article_set-INITIAL_FORMS\': 3\n1973.         }\n1974.         response = self.client.post(reverse(\'admin:admin_views_section_change\', args=(self.s1.pk,)), data)\n1975.         self.assertRedirects(response, reverse(\'admin:admin_views_section_changelist\'))\n1976.         self.assertEqual(Section.objects.get(pk=self.s1.pk).name, data[\'name\'])\n1977.         # Invalid POST reshows inlines.\n1978.         del data[\'name\']\n1979.         response = self.client.post(reverse(\'admin:admin_views_section_change\', args=(self.s1.pk,)), data)\n1980.         self.assertEqual(response.status_code, 200)\n1981.         self.assertEqual(len(response.context[\'inline_admin_formsets\']), 1)\n1982.         formset = response.context[\'inline_admin_formsets\'][0]\n1983.         self.assertEqual(len(formset.forms), 3)\n1984. \n1985.     def test_change_view_with_view_and_add_inlines(self):\n1986.         """User has view and add permissions on the inline model."""\n1987.         self.viewuser.user_permissions.add(get_perm(Section, get_permission_codename(\'change\', Section._meta)))\n1988.         self.viewuser.user_permissions.add(get_perm(Article, get_permission_codename(\'add\', Article._meta)))\n1989.         self.client.force_login(self.viewuser)\n1990.         # GET shows inlines.\n1991.         response = self.client.get(reverse(\'admin:admin_views_section_change\', args=(self.s1.pk,)))\n1992.         self.assertEqual(len(response.context[\'inline_admin_formsets\']), 1)\n1993.         formset = response.context[\'inline_admin_formsets\'][0]\n1994.         self.assertEqual(len(formset.forms), 6)\n1995.         # Valid POST creates a new article.\n1996.         data = {\n1997.             \'name\': \'Can edit name with view-only inlines\',\n1998.             \'article_set-TOTAL_FORMS\': 6,\n1999.             \'article_set-INITIAL_FORMS\': 3,\n2000.             \'article_set-3-id\': [\'\'],\n2001.             \'article_set-3-title\': [\'A title\'],\n2002.             \'article_set-3-content\': [\'Added content\'],\n2003.             \'article_set-3-date_0\': [\'2008-3-18\'],\n2004.             \'article_set-3-date_1\': [\'11:54:58\'],\n2005.             \'article_set-3-section\': [str(self.s1.pk)],\n2006.         }\n2007.         response = self.client.post(reverse(\'admin:admin_views_section_change\', args=(self.s1.pk,)), data)\n2008.         self.assertRedirects(response, reverse(\'admin:admin_views_section_changelist\'))\n2009.         self.assertEqual(Section.objects.get(pk=self.s1.pk).name, data[\'name\'])\n2010.         self.assertEqual(Article.objects.count(), 4)\n2011.         # Invalid POST reshows inlines.\n2012.         del data[\'name\']\n2013.         response = self.client.post(reverse(\'admin:admin_views_section_change\', args=(self.s1.pk,)), data)\n2014.         self.assertEqual(response.status_code, 200)\n2015.         self.assertEqual(len(response.context[\'inline_admin_formsets\']), 1)\n2016.         formset = response.context[\'inline_admin_formsets\'][0]\n2017.         self.assertEqual(len(formset.forms), 6)\n2018. \n2019.     def test_change_view_with_view_and_delete_inlines(self):\n2020.         """User has view and delete permissions on the inline model."""\n2021.         self.viewuser.user_permissions.add(get_perm(Section, get_permission_codename(\'change\', Section._meta)))\n2022.         self.client.force_login(self.viewuser)\n2023.         data = {\n2024.             \'name\': \'Name is required.\',\n2025.             \'article_set-TOTAL_FORMS\': 6,\n2026.             \'article_set-INITIAL_FORMS\': 3,\n2027.             \'article_set-0-id\': [str(self.a1.pk)],\n2028.             \'article_set-0-DELETE\': [\'on\'],\n2029.         }\n2030.         # Inline POST details are ignored without delete permission.\n2031.         response = self.client.post(reverse(\'admin:admin_views_section_change\', args=(self.s1.pk,)), data)\n2032.         self.assertRedirects(response, reverse(\'admin:admin_views_section_changelist\'))\n2033.         self.assertEqual(Article.objects.count(), 3)\n2034.         # Deletion successful when delete permission is added.\n2035.         self.viewuser.user_permissions.add(get_perm(Article, get_permission_codename(\'delete\', Article._meta)))\n2036.         data = {\n2037.             \'name\': \'Name is required.\',\n2038.             \'article_set-TOTAL_FORMS\': 6,\n2039.             \'article_set-INITIAL_FORMS\': 3,\n2040.             \'article_set-0-id\': [str(self.a1.pk)],\n2041.             \'article_set-0-DELETE\': [\'on\'],\n2042.         }\n2043.         response = self.client.post(reverse(\'admin:admin_views_section_change\', args=(self.s1.pk,)), data)\n2044.         self.assertRedirects(response, reverse(\'admin:admin_views_section_changelist\'))\n2045.         self.assertEqual(Article.objects.count(), 2)\n2046. \n\n\nNow generate the complete self-contained test case that reproduces the bug with the same error/exception.\n' additional_kwargs={} response_metadata={}
2025-10-06 21:13:27,027 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_write_node - DEBUG - content='```python\nfrom django.contrib import admin\nfrom django.contrib.auth.models import User\nfrom django.test import TestCase, override_settings\nfrom django.urls import reverse\n\nfrom .admin import site as admin_site\nfrom .models import Holder4, Inner4Stacked, Inner4Tabular\n\n\n@override_settings(ROOT_URLCONF=\'admin_inlines.urls\')\nclass GetInlinesHookTest(TestCase):\n\n    @classmethod\n    def setUpTestData(cls):\n        cls.superuser = User.objects.create_superuser(\'super\', \'super@example.com\', \'password\')\n\n    def setUp(self):\n        self.client.force_login(self.superuser)\n\n    def test_get_inlines_hook(self):\n        """\n        ModelAdmin.get_inlines() can be used to dynamically specify inlines.\n        """\n        class Inner4StackedInline(admin.StackedInline):\n            model = Inner4Stacked\n\n        class Inner4TabularInline(admin.TabularInline):\n            model = Inner4Tabular\n\n        class DynamicInlinesHolder4Admin(admin.ModelAdmin):\n            inlines = [Inner4TabularInline]\n\n            def get_inlines(self, request, obj=None):\n                if obj and obj.dummy > 10:\n                    return [Inner4StackedInline]\n                return self.inlines\n\n        original_admin = admin_site._registry[Holder4]\n        admin_site.unregister(Holder4)\n        admin_site.register(Holder4, DynamicInlinesHolder4Admin)\n\n        try:\n            # When dummy > 10, the stacked inline should be used.\n            holder = Holder4.objects.create(dummy=20)\n            response = self.client.get(reverse(\'admin:admin_inlines_holder4_change\', args=(holder.pk,)))\n            self.assertContains(response, \'id="inner4stacked_set-group"\')\n            self.assertNotContains(response, \'id="inner4tabular_set-group"\')\n        finally:\n            # Restore original ModelAdmin.\n            admin_site.unregister(Holder4)\n            admin_site.register(Holder4, original_admin)\n```' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'citation_metadata': {'citations': [{'start_index': 30509, 'end_index': 30781, 'uri': 'https://github.com/Yoann-Vie/esgi-hearthstone', 'title': '', 'license_': ''}]}, 'usage_metadata': {'prompt_token_count': 42123, 'candidates_token_count': 497, 'total_token_count': 53482, 'prompt_tokens_details': [{'modality': 1, 'token_count': 42123}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 497}], 'thoughts_token_count': 10862, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -3.1138400225572185, 'model_name': 'gemini-2.5-pro'} id='run--53375ecc-a6a0-49f4-909f-0101138e0580-0' usage_metadata={'input_tokens': 42123, 'output_tokens': 497, 'total_tokens': 53482, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 10862}}
2025-10-06 21:13:37,456 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'create_file', 'arguments': '{"content": "from django.contrib import admin\\nfrom django.contrib.auth.models import User\\nfrom django.test import TestCase, override_settings\\nfrom django.urls import reverse\\n\\nfrom .admin import site as admin_site\\nfrom .models import Holder4, Inner4Stacked, Inner4Tabular\\n\\n\\n@override_settings(ROOT_URLCONF=\'admin_inlines.urls\')\\nclass GetInlinesHookTest(TestCase):\\n\\n    @classmethod\\n    def setUpTestData(cls):\\n        cls.superuser = User.objects.create_superuser(\'super\', \'super@example.com\', \'password\')\\n\\n    def setUp(self):\\n        self.client.force_login(self.superuser)\\n\\n    def test_get_inlines_hook(self):\\n        \\"\\"\\"\\n        ModelAdmin.get_inlines() can be used to dynamically specify inlines.\\n        \\"\\"\\"\\n        class Inner4StackedInline(admin.StackedInline):\\n            model = Inner4Stacked\\n\\n        class Inner4TabularInline(admin.TabularInline):\\n            model = Inner4Tabular\\n\\n        class DynamicInlinesHolder4Admin(admin.ModelAdmin):\\n            inlines = [Inner4TabularInline]\\n\\n            def get_inlines(self, request, obj=None):\\n                if obj and obj.dummy > 10:\\n                    return [Inner4StackedInline]\\n                return self.inlines\\n\\n        original_admin = admin_site._registry[Holder4]\\n        admin_site.unregister(Holder4)\\n        admin_site.register(Holder4, DynamicInlinesHolder4Admin)\\n\\n        try:\\n            # When dummy > 10, the stacked inline should be used.\\n            holder = Holder4.objects.create(dummy=20)\\n            response = self.client.get(reverse(\'admin:admin_inlines_holder4_change\', args=(holder.pk,)))\\n            self.assertContains(response, \'id=\\"inner4stacked_set-group\\"\')\\n            self.assertNotContains(response, \'id=\\"inner4tabular_set-group\\"\')\\n        finally:\\n            # Restore original ModelAdmin.\\n            admin_site.unregister(Holder4)\\n            admin_site.register(Holder4, original_admin)\\n", "relative_path": "tests/admin_inlines/test_get_inlines_hook.py"}'}, '__gemini_function_call_thought_signatures__': {'b21e981a-24ef-4bb3-9b71-17ddf8f58529': 'Cu4RAR/MhbbUA+4PUfP34WbndATTUtMdnNSCqtXvRTexpWIyjLBixUuW+KIycGillKALTCZWegwQ5NHhJOX2ObYYFBlb7nHbgpw3qVaHWYcWpqqJ7aBnkqejSauC6y+cKF2xsCGecdWnKRB/qpDFyRPvvRS8kj5sQ4jU0ej2fF/pmRrCRsQqhm82fc/X5HmFZ3Mtf3nfemxtPW0QY+1ZXR9P1IuMctGAPHOyaURPNwGvVIgp6HrGy6CiDLBwGnZoh+Revvpe0PbZFoCXx8hCG2PDn5S2x9ACnXVx3DDpIyHF79NQktUadV0iHyzCHLSCS+jv/vQ/Ci6mY715wmX389bGzMmhWHs9DPMUVf0KfEkK14tbWrEzSg8Cz/CPfgBcTouHk5oZ70djQL3PmMwmoekTg3xqCNvkJ3hJG4y8YpuhIceKXwHu9d3EOygopMTAWnVQFaO62TB2UUqJhdiXDFkhP3DP+ujP1Esepzqw2Kfct1ucXGDsXbKYOaKroAHx81pTJtDi1ReaM+dgbxFdQb2M92a3q/F/iUxCsZpNsKCm9xNMJK/Nt4WT1XRxaP53k14XgxiYUGgd4XQYL0wr3q0R3iG1MQu1Zdo0VXpSvlQnTq7Iox1Y2FETUnyJ3bL9toX+2gN4gGxqSKs6QVok5aoj5PGvFSmxNdamizJ4wQ+VuYO62bMlY2I91ZK7EBfIj0aD+YYl/rLdqVYGT/j0BnaMwvhHKlvCTkItBATxtn+gU3jwnliPFTsJ1CpzaSgWilocsw1MM/hBRPV6616ygGb6eYBbDBI8/6ey14dzNovG2fN+ancgctIdvJM/DLtY+4vGCvSRMlphhgQuHCz/BHinvV6/qASYnTtvhCbAemwyfDZjFgFwM1ioYRp1zGuZnaVsce/D3AkTmlEqrJ1IEc4bMc4on5ADFTVg7TLTTL5irHQ4pVdSrcOnxsb4z3ZNUDm6InLOq+Mbmil6QmJD2YkHvPbO5NWm1rtJY6i99Yhz7mFinIbZcg7D3aB9PIBirjBIJ4BUmdWrdG7x30KVH9l8r1PHbVb5XTeHeuxEVWoEat6vwF1E7DA6KWbIn00DO9T0FueZ2fooPM27tAFf9YMh2wQtANF7escYEy/sXdFEhmNxDMeupbl7nRJP5eCkfEVz1/L/ScDg5nU3gkpzBrw2Azn/BlIdeIFrrrnbOdX6GlEAUn5Am2g6GXGJvY+ebsPhRxco2eQgNvlkUHSQAlQnfgn2v0UcCgaLNTT7f6PVfyeYy0oGJ5cxm8zY/OSyC7SxlwXIX+6ZrzNkoAk/gIy0LgiGfero3kWrmTR57uqI8SCJUEcu60t9xG7DI4zCgECM727Po4krxdkougiFuGTKoK7dhz7GQuRBm/4cBPctVMIlnp4ivDyrxeysb15NAwmvhky9ArQdTrffmMkQeGGxiCZCOIJYOH662RptTl/hlMOuaJDLIAR0jYfZmztD7lhZ9jN5ethkRJDmsoeiP+pij4C5TePWbvkf6Wio8gB8SDcfOmQQS8LfZrdlxGV4YcjDhWp2Vo+z7PlL55NdIwKgUBm748tXPvIIVUVF/UKq89amKydFl3ovKMYptA3Jkpc5+BZrTJk+lsTIpVAQy+3cp373KmW5Yj0ZzX5zmbJR5sjZZ2BjIjQtYToF8kYGQ5n/jKbr+Fq1HJ53GhK0XwMkbu/IJ3FxUh2U0jfT1RQEQbuTMUAr9h+7a0ESvHXZ2MlcSvRAmEvnyJHvhV80h7BjsAX4NqcOu8xu8982f4sl33PrMnepqA+AxD0rutlKB+pKfayQdh9p1NSFTSGEnAxPFOr3GKZ2hfPvB1AgTAUvfm8enlG+bh/igUAJfJceFKRDVyOqcK+XroBlkxlZMr5qv3kORIvQyuOSYydbs87ni/0inlIbN6mfXMw8I3Ad3mpqq0VJGtm8Qp2za9xgDCHzoB7PWuGFuAoZ+WxJzqxMPkVAcVarX1S7wSvXwb7t/ONFZ4KR5c9496ZePujNdezqSWcDc4WY9zZ/M6ugvVjDbK+BAQT6B6dcJ/P5LkNFcmZzByVsnns0fF/RKVgx2X/rnovrvlNbl2TrmqiEM8y2wEsRtjzamvRwshWAMq7PxiGtC1X/Gq8PmniPMO37nt3tRM5/LRe/mDkj5npqt1wqrSPsaKsYGB11WqGXL74nYZMUwUUN9XcGgf6jeU+CNXn3zKl4wwz/RQu4FIZKDXbiTMQMgEZAWalDo8p0tomHhxnIpHWiYEzZDvQvPzwbWVQ/pj/OAzNrufCQhlBVQ0eiHK6n0Z12xX0ACYPg3WxVLEVk1MXRMk6N71f3SZKYGFamHhDwlXyjXmHBl8ZUp8kQpyj+0BE4nBSL25t4QzlKLbc3mY/0JZqM5qbZj/NTbaYNRroahWgk34S/z3FTXlyZ0/xJV8q6UCTxIHUFBdjjO0wU1jQ9h+iHfJ1BawaiaduAQkWQgQQ+HcRhgQgSJUYiUT9+DedZp3ubaKJT93t7ujTuud8hyiUCOMhHEE8FB0Pz7k9fKyfLmwfEgybxto+iryW6o8Ygwl9GxkJFwW8A/t7U9ViYOrjItNQkbnzN+fPSxjdHXK1PZIeqJO3Aw6Bij7SUpjFAA8Vo+HKBUzD+BPA3Z2c+H9SSR7+qo8FpheiqqPJgqJlK/xS+VPtsk+2ab/Y2HxhAIQbpvHgfFWEOLUZh4Tg3e1LSGD0Xn6csTVUrEjNc3jDRaG2hYQFrCZ7W0KeoUiksC8BR69mcX+Eh9oLjF/fa00uELsmZXj7B6z86CkVWOjwQginjxsH9JNbhErmbc3ywNjOoggHCDOOcWANulSmayRWZMSBXJSz2HfA0oBfp+J2ETLaXqvIF3IG35Vm1vBdMscaoFyOhHfQRpIu7UOliUGC8EvhbsqEajp4Qy83y82PsYMkTIcRUwgtpwRcDJtksT24AezZ6mTMSwQeOPyzyvg77le2J01t/lvVerrTd48EpVZVNr/nHIbSKhpQ3WBhb2l5Dsdk8iyjp/4tVL/6xiYhgJe2y6cGo6yP3l7FPtY08pTN20nf9f1tb'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 52268, 'candidates_token_count': 517, 'total_token_count': 53420, 'prompt_tokens_details': [{'modality': 1, 'token_count': 52268}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 517}], 'thoughts_token_count': 635, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.10355878936944662, 'model_name': 'gemini-2.5-pro'} id='run--e9e554c6-4e4b-4cd6-be09-ad7dbaf8dd65-0' tool_calls=[{'name': 'create_file', 'args': {'content': 'from django.contrib import admin\nfrom django.contrib.auth.models import User\nfrom django.test import TestCase, override_settings\nfrom django.urls import reverse\n\nfrom .admin import site as admin_site\nfrom .models import Holder4, Inner4Stacked, Inner4Tabular\n\n\n@override_settings(ROOT_URLCONF=\'admin_inlines.urls\')\nclass GetInlinesHookTest(TestCase):\n\n    @classmethod\n    def setUpTestData(cls):\n        cls.superuser = User.objects.create_superuser(\'super\', \'super@example.com\', \'password\')\n\n    def setUp(self):\n        self.client.force_login(self.superuser)\n\n    def test_get_inlines_hook(self):\n        """\n        ModelAdmin.get_inlines() can be used to dynamically specify inlines.\n        """\n        class Inner4StackedInline(admin.StackedInline):\n            model = Inner4Stacked\n\n        class Inner4TabularInline(admin.TabularInline):\n            model = Inner4Tabular\n\n        class DynamicInlinesHolder4Admin(admin.ModelAdmin):\n            inlines = [Inner4TabularInline]\n\n            def get_inlines(self, request, obj=None):\n                if obj and obj.dummy > 10:\n                    return [Inner4StackedInline]\n                return self.inlines\n\n        original_admin = admin_site._registry[Holder4]\n        admin_site.unregister(Holder4)\n        admin_site.register(Holder4, DynamicInlinesHolder4Admin)\n\n        try:\n            # When dummy > 10, the stacked inline should be used.\n            holder = Holder4.objects.create(dummy=20)\n            response = self.client.get(reverse(\'admin:admin_inlines_holder4_change\', args=(holder.pk,)))\n            self.assertContains(response, \'id="inner4stacked_set-group"\')\n            self.assertNotContains(response, \'id="inner4tabular_set-group"\')\n        finally:\n            # Restore original ModelAdmin.\n            admin_site.unregister(Holder4)\n            admin_site.register(Holder4, original_admin)\n', 'relative_path': 'tests/admin_inlines/test_get_inlines_hook.py'}, 'id': 'b21e981a-24ef-4bb3-9b71-17ddf8f58529', 'type': 'tool_call'}] usage_metadata={'input_tokens': 52268, 'output_tokens': 517, 'total_tokens': 53420, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 635}}
2025-10-06 21:13:38,771 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='tests/admin_inlines/test_get_inlines_hook.py' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 52812, 'candidates_token_count': 17, 'total_token_count': 52829, 'cached_content_token_count': 50434, 'prompt_tokens_details': [{'modality': 1, 'token_count': 53445}], 'cache_tokens_details': [{'modality': 1, 'token_count': 50434}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 17}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -6.205599193516023e-06, 'model_name': 'gemini-2.5-pro'} id='run--cca0791f-4bcf-4137-bc1e-089990298646-0' usage_metadata={'input_tokens': 52812, 'output_tokens': 17, 'total_tokens': 52829, 'input_token_details': {'cache_read': 50434}}
2025-10-06 21:13:38,931 - thread-139660780025408.app.lang_graph.nodes.git_diff_node - INFO - Generated patch:
diff --git a/tests/admin_inlines/test_get_inlines_hook.py b/tests/admin_inlines/test_get_inlines_hook.py
new file mode 100644
index 0000000000..b5552fcbf4
--- /dev/null
+++ b/tests/admin_inlines/test_get_inlines_hook.py
@@ -0,0 +1,51 @@
+from django.contrib import admin
+from django.contrib.auth.models import User
+from django.test import TestCase, override_settings
+from django.urls import reverse
+
+from .admin import site as admin_site
+from .models import Holder4, Inner4Stacked, Inner4Tabular
+
+
+@override_settings(ROOT_URLCONF='admin_inlines.urls')
+class GetInlinesHookTest(TestCase):
+
+    @classmethod
+    def setUpTestData(cls):
+        cls.superuser = User.objects.create_superuser('super', 'super@example.com', 'password')
+
+    def setUp(self):
+        self.client.force_login(self.superuser)
+
+    def test_get_inlines_hook(self):
+        """
+        ModelAdmin.get_inlines() can be used to dynamically specify inlines.
+        """
+        class Inner4StackedInline(admin.StackedInline):
+            model = Inner4Stacked
+
+        class Inner4TabularInline(admin.TabularInline):
+            model = Inner4Tabular
+
+        class DynamicInlinesHolder4Admin(admin.ModelAdmin):
+            inlines = [Inner4TabularInline]
+
+            def get_inlines(self, request, obj=None):
+                if obj and obj.dummy > 10:
+                    return [Inner4StackedInline]
+                return self.inlines
+
+        original_admin = admin_site._registry[Holder4]
+        admin_site.unregister(Holder4)
+        admin_site.register(Holder4, DynamicInlinesHolder4Admin)
+
+        try:
+            # When dummy > 10, the stacked inline should be used.
+            holder = Holder4.objects.create(dummy=20)
+            response = self.client.get(reverse('admin:admin_inlines_holder4_change', args=(holder.pk,)))
+            self.assertContains(response, 'id="inner4stacked_set-group"')
+            self.assertNotContains(response, 'id="inner4tabular_set-group"')
+        finally:
+            # Restore original ModelAdmin.
+            admin_site.unregister(Holder4)
+            admin_site.register(Holder4, original_admin)

2025-10-06 21:13:38,931 - thread-139660780025408.app.lang_graph.nodes.update_container_node - INFO - Copy over all updated files to the container
2025-10-06 21:13:38,978 - thread-139660780025408.app.docker.base_container - INFO - Resetting git repository in the container
2025-10-06 21:13:38,978 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: git reset --hard
2025-10-06 21:13:39,484 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 0
2025-10-06 21:13:39,484 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:

HEAD is now at 7d49ad7656 Fixed #14808 -- Doc'd that trans and blocktrans tags don't escape translations.

2025-10-06 21:13:39,484 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: git clean -fd
2025-10-06 21:13:39,585 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 0
2025-10-06 21:13:39,585 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:


2025-10-06 21:13:39,585 - thread-139660780025408.app.docker.base_container - INFO - Updating files in the container after edits.
2025-10-06 21:13:39,586 - thread-139660780025408.app.docker.base_container - INFO - Creating directory tests/admin_inlines in the container
2025-10-06 21:13:39,586 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: mkdir -p tests/admin_inlines
2025-10-06 21:13:39,686 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 0
2025-10-06 21:13:39,686 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:


2025-10-06 21:13:39,687 - thread-139660780025408.app.docker.base_container - INFO - Updating tests/admin_inlines/test_get_inlines_hook.py in the container
2025-10-06 21:13:39,689 - thread-139660780025408.app.docker.base_container - INFO - Files updated successfully
2025-10-06 21:13:43,083 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'run_command', 'arguments': '{"command": "./manage.py test admin_inlines.tests.GetInlinesTests.test_get_inlines_hook"}'}, '__gemini_function_call_thought_signatures__': {'02cdf9bd-c6db-4df8-9237-60ea0fdced2e': 'CpEFAR/MhbY6dUj7F/b9S5BTbPJmHITS6G6QEV/MsRtbAEcfFwu8iancAWsYC2jdVt8Vo5A7HPVIYpJU7KUs9d1TYeN/2Xc2GWrKjlEmYvuYo/pMcka0tdefrhQ+Kdf9x21Sai0Cv+Wbj/3Nzk8gFdp0LRIz4P0bZjjTvh1wY1vJGAz9nLzQgJNZzHfNjvgPRy6MQ4CUxU1fLVzvYu6pTCfzT9yThMFiCj2h3jugRs+rs4c2BB0aNTauGGTIgEq/gF3rQe0J271lKg5ZV/G1ej3jEDXYpTgI3fBerOsWQzmi7zqPxokewpRmmZK6GywNdv+f7IqJyHTnnl8AkIJfdS8xylfq57a17x+aen8denfNDqupZ+/3oI2WkaFtIZpyWnzogWwZd5r7QpketUj/4PL8ju2CbkSlxRWvAHU68aFPrRrbbzPfwSeNliUI/opnl85epLd2TX4Tcdo8268XK4A+nQLShY9b2xITMzAlVyy3PehvvTQ0EppsXBji3itnJO42GHM5Tgtk4rzZnKHnSjezUBp/UfOJ9u/krU0Bqa4w1M6MR1aajPRva+WdX5MMrBwrxKzZcwA49hRJlVt3x/bZPrN5VvCBshmCTLZI8makyNXJND7SfbDmaViZm/O6tIGvzZDHr+olLViiPCVHu/iWEV++uol7oi82Zd7BI2DQHDUUssa/IArqVJ2k48PLAXqBlUpBKp5Y7cSOwsJ5MAOmOWwEebwbhVakTb/miR+7o2T692AtdfIegysKUXIafJ+eQhUpDiitO2rBd3rzsjLJz3MnDyyz+YuvSBjzTctq3JcK0JUtldLIVCDpBDeOpXNeggkbMetwClgIb2YP4b7DHFGPzmFgqY5/zW8Wu5YBbDfI'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 326, 'candidates_token_count': 29, 'total_token_count': 536, 'prompt_tokens_details': [{'modality': 1, 'token_count': 326}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 29}], 'thoughts_token_count': 181, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.507754292981378, 'model_name': 'gemini-2.5-pro'} id='run--21babfd1-c241-4088-905c-ec489ac7c8cf-0' tool_calls=[{'name': 'run_command', 'args': {'command': './manage.py test admin_inlines.tests.GetInlinesTests.test_get_inlines_hook'}, 'id': '02cdf9bd-c6db-4df8-9237-60ea0fdced2e', 'type': 'tool_call'}] usage_metadata={'input_tokens': 326, 'output_tokens': 29, 'total_tokens': 536, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 181}}
2025-10-06 21:13:43,085 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: ./manage.py test admin_inlines.tests.GetInlinesTests.test_get_inlines_hook
2025-10-06 21:13:43,185 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 127
2025-10-06 21:13:43,186 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:

bash: ./manage.py: No such file or directory

2025-10-06 21:13:48,382 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'run_command', 'arguments': '{"command": "ls -l"}'}, '__gemini_function_call_thought_signatures__': {'2aa23c84-1982-4658-ab56-c7f286785236': 'CqsKAR/MhbaNu3l7WIs33LtgTTy484iZbgXLjuQRr/Lli9T58Gzh3ajNLEstHCYJIp2JVc3/JfLgaB6mbYCQ5a1OENjyC70VFVA8q4uBJcIEpfx8NHLouj2J1hiVQyOjofm9lkqBdLmKqx9LunlikHoD0xF3CdyiHLfR5yxh6WcNcm9xNCffKCRIwD2dAwXBM06UyFVUcU1m4p1x92/qeahIBgxxyuN3AkHcU2jH2oJVaT5f1P2S9s5wxTMlpqXp1q6BEWvWTjjIqAnHvY/DTOIUWd3xIhOzzyAOA1CRtubBEXsiiASc4OS2nYrbo+rvQy1y5wWsWbBs6k31bZ/xNnsjgz1gCMp+fz/uGnj/tQ7q9FD0006c7dSNXb+oHUSzOKkVmVyBnlXFTo4Am6d4C50kkIDem2v7FwR+rVlqI78F7dcfF8hKGSyE5f7EVLQt/Sqtt4y/7vlhYxGEYP9m+Lq4qxTZMkyOsGTZkhmMA/MpEzwKBDx5dadKbp933q2F98/uGj0vRqgnX06w1pbyQ9F+yq6uUpX8fYYJuoAKEptQ4AYg09pJG0bUaf3aIFx8o+EN7UnfDZpOD3WshX7TsC4bcAJrTk7QfWYfQ9G2PR0GThyuOCtwtnQmKHZEoyDzlgqpncfBoLloryW5d9Ru6egYzi1A+sX7wWfs8IAc5MCDWV5/NweKqemMAI0b1gdgHVt+FqgqJZxuah0Jsa/1AXUyGEDxyqhBpUqWIagp8+AEMTmegyxzRYSahXzp+Eu7Z5K2XUMRpr/XhKYEdC+sdVqoLuQY2nri+bZjoqUNjB8msQJxBdH6UoUwPS6jyj3LRobuFh+2rmrQIuJoCaSozK9qCHqN8JOsxcuMKQmdj2ssySoi0ipEQ2dzbo4I7lAfiFWcza4my4hpBS/2R0/h8DgpJRG9I/10tzKwXlx0BpkwO2XfBJKT5AdFYwqEJmzsoGc2CXquzGNhj1XKuWgqmPnrPQdLn3t4sYaf3n3VmvjYyOxM47I38Kszui/HzrfYijI1fpG4VZvguyGCi3SXJTCd7izzoirWU3h086qpjAEgtHfCb8f2WJOyOxgb42ACur5ufT7GKyxxa3a2LKeLQdnXCUWd5FjYHsDBNTRfSKcLyfB5++oAJH+WvLcJdG8ssYQ2G33Wvo4gudZ8fpp2SrPK490OgE/5msBwSiAVn85iuql9UJRqJxzAGK7YuDrb8DgKoqWfNmzfKTbM6lu3cKEQFbAPY9MTM6PY2hr6vtZ35t4p/r4xOrrNhmSX4ob446ZWQX0dCoz4FPD7F9khetzH6Kq0F6aoGUSvvtTLOwycZ45M4KhacadOZE8ri7QlQ/CeA+f3L18Q5mNld5NID6QQj8LgBAvAv9qHfCpGMFK8CcyY6b8Ynr0IXcVjyCOsxmKnVFPUPl8jO9ScBAQ6PVHODs31cREJSme/jH4hLz7nJM69UBRdNAq3b2JUCnw6QKT6cqoDaklLrK7gWOt3k4NsCUdpn/9iQ0njkUzhwsWGP6gU3czkutTX4I8j4/1EAuNFVTJ1hORBfyjJ1Fe8KKcAinlIx5YPUp3LgKBO+yZKka6ECnx8Y3ORo2laIKMjC+/+dC999cJbE+z2Zjlz7aFyhL8lky3Rpq2GJKeKiO9Zwt6+xKZgAh2SiASq54O/XzI038OgV/DbUuEgjFb5yh1qxmz1F98VGw0qSK4DhBzthFrx/aWbNA7MWZ57wHLlFdayusWm4/5foSnW6LnuR8j3F1O5QDkrJAOV3TPm'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 373, 'candidates_token_count': 7, 'total_token_count': 733, 'prompt_tokens_details': [{'modality': 1, 'token_count': 552}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 7}], 'thoughts_token_count': 353, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -6.312064034598214, 'model_name': 'gemini-2.5-pro'} id='run--408b1d4e-c02b-4ea3-a5c7-3595f4a7ebc4-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -l'}, 'id': '2aa23c84-1982-4658-ab56-c7f286785236', 'type': 'tool_call'}] usage_metadata={'input_tokens': 373, 'output_tokens': 7, 'total_tokens': 733, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 353}}
2025-10-06 21:13:48,383 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: ls -l
2025-10-06 21:13:48,484 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 0
2025-10-06 21:13:48,484 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:

total 152
-rw-r--r-- 1 root root 35748 Oct  6 13:13 AUTHORS
-rw-r--r-- 1 root root  1115 Oct  6 13:13 CONTRIBUTING.rst
drwxrwxrwx 1 root root  4096 Oct  6 13:13 django
drwxr-xr-x 1 root root  4096 Oct  6 12:59 Django.egg-info
drwxrwxrwx 1 root root  4096 Oct  6 13:13 docs
drwxrwxrwx 1 root root  4096 Oct  6 13:13 extras
-rw-r--r-- 1 root root   353 Oct  6 13:13 Gruntfile.js
-rw-r--r-- 1 root root   311 Oct  6 13:13 INSTALL
drwxrwxrwx 1 root root  4096 Oct  6 13:13 js_tests
-rw-r--r-- 1 root root  1552 Oct  6 13:13 LICENSE
-rw-r--r-- 1 root root 13231 Oct  6 13:13 LICENSE.python
-rw-r--r-- 1 root root   307 Oct  6 13:13 MANIFEST.in
-rw-r--r-- 1 root root   347 Oct  6 13:13 package.json
-rw-r--r-- 1 root root  1878 Oct  6 13:13 README.rst
drwxrwxrwx 1 root root  4096 Oct  6 13:13 scripts
-rw-r--r-- 1 root root   425 Oct  6 13:13 setup.cfg
-rw-r--r-- 1 root root  4689 Oct  6 13:13 setup.py
drwxrwxrwx 1 root root 12288 Oct  6 13:13 tests
-rw-r--r-- 1 root root  1405 Oct  6 13:13 tox.ini

2025-10-06 21:13:50,972 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'run_command', 'arguments': '{"command": "cat tox.ini"}'}, '__gemini_function_call_thought_signatures__': {'ddbbf781-a06e-4f4b-a732-634b946ea579': 'CqwDAR/MhbZgrCc0q3YS0wvx5IBeYvPw3BdagO+KJHdoVM2t4TqyuOWFadslFTPILRWOjB8YI7226Fg7kd8FnhieGNfT76j1QFxzfipC+6OQDP70RUF5Vde7/nk+YzKd+U/sDZmnYIygSzoOM+va4Bfx4JoNEE1zYcTrE/JJuGpmRA0fIDKKMOOxqTlu1GDbaO8yzNZ6Dp1TFWm/uWjrvEnY4yGVDbdDZMif+qomOMLh5TLR4yamoCZpAgk8NzGfBqSIuMVtTkFpgKfIrrw6Q5QTkfE4qr+iIIUg2/Wh8AMH6bji5QzC72sSdJKKVU2nQrOuJvrAQYL3s69EZd0nPatt0RdT1kQZ8T8cI8+CwMfXn0FMOQ9P4BFS4wR9blw7T1udSof+XT51+ufLNYPUyCjeQebXeQc4sfUWi4/eo3cvtGtMNGWVSUY0rOzY7iq7gonVD3Z4EKQY0XqLAGZzI1Ebu5NURjZ2UNNpXjz4rtvUB2cRsSNUjLPA5anYvvceSWuceWC0BV3SiU7nGboJkK4Ozqopr1+raz/0DyYPcXbu/CU5gxYNv9qYujM3Gk0='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 924, 'candidates_token_count': 8, 'total_token_count': 1039, 'prompt_tokens_details': [{'modality': 1, 'token_count': 1453}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 8}], 'thoughts_token_count': 107, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -1.1246100664138794, 'model_name': 'gemini-2.5-pro'} id='run--067839f7-583f-4dad-848f-89921e22967a-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'cat tox.ini'}, 'id': 'ddbbf781-a06e-4f4b-a732-634b946ea579', 'type': 'tool_call'}] usage_metadata={'input_tokens': 924, 'output_tokens': 8, 'total_tokens': 1039, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 107}}
2025-10-06 21:13:50,973 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: cat tox.ini
2025-10-06 21:13:51,074 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 0
2025-10-06 21:13:51,074 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:

# Tox (https://tox.readthedocs.io/) is a tool for running tests in multiple
# virtualenvs. This configuration file helps to run the test suite on all
# supported Python versions. To use it, "pip install tox" and then run "tox"
# from this directory.

[tox]
skipsdist = true
envlist =
    py3
    flake8
    docs
    isort

# Add environment to use the default python3 installation
[testenv:py3]
basepython = python3

[testenv]
usedevelop = true
passenv = DJANGO_SETTINGS_MODULE PYTHONPATH HOME DISPLAY
setenv =
    PYTHONDONTWRITEBYTECODE=1
deps =
    py{3,36,37}: -rtests/requirements/py3.txt
    postgres: -rtests/requirements/postgres.txt
    mysql: -rtests/requirements/mysql.txt
    oracle: -rtests/requirements/oracle.txt
changedir = tests
commands =
    {envpython} runtests.py {posargs}

[testenv:flake8]
basepython = python3
usedevelop = false
deps = flake8
changedir = {toxinidir}
commands = flake8 .

[testenv:docs]
basepython = python3
usedevelop = false
whitelist_externals =
    make
deps =
    Sphinx
    pyenchant
    sphinxcontrib-spelling
changedir = docs
commands =
    make spelling

[testenv:isort]
basepython = python3
usedevelop = false
deps = isort
changedir = {toxinidir}
commands = isort --recursive --check-only --diff django tests scripts

[testenv:javascript]
usedevelop = false
deps =
changedir = {toxinidir}
whitelist_externals = npm
commands =
    npm install
    npm test

2025-10-06 21:13:53,436 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'run_command', 'arguments': '{"command": "cd tests && python runtests.py admin_inlines.test_get_inlines_hook"}'}, '__gemini_function_call_thought_signatures__': {'bff1ae2a-a44e-46b1-8cc2-54731e95abd9': 'CswEAR/Mhbas5pBeCMejFjRSFuzmMlrQiDp4Hc1255OcHvsuzHNaACLP8MjqWM5l1pLdr+CaT8LVe8Bk+BrItkQLwJJ48ToOWiV3x9Nw8260dVFcUS/dHyCE98VTPhix2jaK6ss14PpaFWdb++6zFD7mL5KoDTABTRXMiN6t7Oc34lmEysbV86qawpu4YE2CgewzRMPLhgKUEiU3sXlf0tl6KF5Z6n2yqOale4hf1Zo7DKidHVe33eHlU3fGIlnkNcZHwjOatUr4EwajSFfc+dQc7gIqYoePjq39Vi8RDYpMf8V6k56jD4e/II/7WbRLmQ2oepgH80Utk5w16/D0aw1+7XeADT/gDNPhdL7yH8vPckJb4ZOyJavmb3okOT3xhlFCZEyQbxEfuJVB7Tl5voCNPxwxFGnenbXIef4tBpt66UafvRWSiXp4jind/4kDbP1BiZL0rRV5gMvCoTJhuaK64rOBvO9NQZUxyabCOCNK7pVe0R6mITreySaaWpZbIoek2PplftUvALIt0hmy5CRbNs/sFcuqqLzsTKaNRgPHQfsp7COn5fEyjaTh5A3dpd2HsHNwsPJaPyCwNtRNG/3LkXOeRY5/d660VvRjink/aLCXPx0tFiLn0VHbh1O3MtsVZyuw9I6+5j+xlLtfhiutUEkeeg5ecGB1VWKYKJTvLvv/vikFrveNhxg4lp/37KS9tGaDTlLKG5nzcZFMW3dhoaBpqY20Lb027CApSPwsrUvSU4/yVKGB79CIb6//Sw7xUj82UDVx0hKWsfIU'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 1366, 'candidates_token_count': 25, 'total_token_count': 1563, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2000}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 25}], 'thoughts_token_count': 172, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.605953483581543, 'model_name': 'gemini-2.5-pro'} id='run--12ff0d27-3575-4d97-ab27-149b4d36a739-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'cd tests && python runtests.py admin_inlines.test_get_inlines_hook'}, 'id': 'bff1ae2a-a44e-46b1-8cc2-54731e95abd9', 'type': 'tool_call'}] usage_metadata={'input_tokens': 1366, 'output_tokens': 25, 'total_tokens': 1563, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 172}}
2025-10-06 21:13:53,438 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: cd tests && python runtests.py admin_inlines.test_get_inlines_hook
2025-10-06 21:13:54,200 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 1
2025-10-06 21:13:54,200 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:

Testing against Django installed in '/testbed/django' with up to 8 processes
Creating test database for alias 'default'...
System check identified no issues (0 silenced).
E
======================================================================
ERROR: test_get_inlines_hook (admin_inlines.test_get_inlines_hook.GetInlinesHookTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/testbed/tests/admin_inlines/test_get_inlines_hook.py", line 46, in test_get_inlines_hook
    self.assertContains(response, 'id="inner4stacked_set-group"')
  File "/testbed/django/test/testcases.py", line 454, in assertContains
    self.assertTrue(real_count != 0, msg_prefix + "Couldn't find %s in response" % text_repr)
  File "/opt/miniconda3/envs/testbed/lib/python3.6/unittest/case.py", line 682, in assertTrue
    raise self.failureException(msg)
AssertionError: False is not true : Couldn't find 'id="inner4stacked_set-group"' in response

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/testbed/tests/admin_inlines/test_get_inlines_hook.py", line 51, in test_get_inlines_hook
    admin_site.register(Holder4, original_admin)
  File "/testbed/django/contrib/admin/sites.py", line 132, in register
    self._registry[model] = admin_class(model, self)
TypeError: 'Holder4Admin' object is not callable

----------------------------------------------------------------------
Ran 1 test in 0.072s

FAILED (errors=1)
Destroying test database for alias 'default'...

2025-10-06 21:13:58,086 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='I have executed the test file and here is the output:\n```\nTesting against Django installed in \'/testbed/django\' with up to 8 processes\nCreating test database for alias \'default\'...\nSystem check identified no issues (0 silenced).\nE\n======================================================================\nERROR: test_get_inlines_hook (admin_inlines.test_get_inlines_hook.GetInlinesHookTest)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File "/testbed/tests/admin_inlines/test_get_inlines_hook.py", line 46, in test_get_inlines_hook\n    self.assertContains(response, \'id="inner4stacked_set-group"\')\n  File "/testbed/django/test/testcases.py", line 454, in assertContains\n    self.assertTrue(real_count != 0, msg_prefix + "Couldn\'t find %s in response" % text_repr)\n  File "/opt/miniconda3/envs/testbed/lib/python3.6/unittest/case.py", line 682, in assertTrue\n    raise self.failureException(msg)\nAssertionError: False is not true : Couldn\'t find \'id="inner4stacked_set-group"\' in response\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File "/testbed/tests/admin_inlines/test_get_inlines_hook.py", line 51, in test_get_inlines_hook\n    admin_site.register(Holder4, original_admin)\n  File "/testbed/django/contrib/admin/sites.py", line 132, in register\n    self._registry[model] = admin_class(model, self)\nTypeError: \'Holder4Admin\' object is not callable\n\n----------------------------------------------------------------------\nRan 1 test in 0.072s\n\nFAILED (errors=1)\nDestroying test database for alias \'default\'...\n```' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 1842, 'candidates_token_count': 462, 'total_token_count': 2349, 'cached_content_token_count': 1626, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2646}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1626}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 462}], 'thoughts_token_count': 45}, 'finish_reason': 'STOP', 'avg_logprobs': -0.011425436317146598, 'model_name': 'gemini-2.5-pro'} id='run--cb3e9b56-b04a-4698-b719-4be2679e3857-0' usage_metadata={'input_tokens': 1842, 'output_tokens': 462, 'total_tokens': 2349, 'input_token_details': {'cache_read': 1626}, 'output_token_details': {'reasoning': 45}}
2025-10-06 21:14:13,381 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_structured_node - DEBUG - reproduced_bug=True reproduced_bug_failure_log='E\n======================================================================\nERROR: test_get_inlines_hook (admin_inlines.test_get_inlines_hook.GetInlinesHookTest)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File "/testbed/tests/admin_inlines/test_get_inlines_hook.py", line 46, in test_get_inlines_hook\n    self.assertContains(response, \'id="inner4stacked_set-group"\')\n  File "/testbed/django/test/testcases.py", line 454, in assertContains\n    self.assertTrue(real_count != 0, msg_prefix + "Couldn\'t find %s in response" % text_repr)\n  File "/opt/miniconda3/envs/testbed/lib/python3.6/unittest/case.py", line 682, in assertTrue\n    raise self.failureException(msg)\nAssertionError: False is not true : Couldn\'t find \'id="inner4stacked_set-group"\' in response\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File "/testbed/tests/admin_inlines/test_get_inlines_hook.py", line 51, in test_get_inlines_hook\n    admin_site.register(Holder4, original_admin)\n  File "/testbed/django/contrib/admin/sites.py", line 132, in register\n    self._registry[model] = admin_class(model, self)\nTypeError: \'Holder4Admin\' object is not callable' reproduced_bug_commands=['python tests/runtests.py admin_inlines.test_get_inlines_hook']
2025-10-06 21:14:13,382 - thread-139660780025408.app.docker.base_container - INFO - Cleaning up container and temporary files
2025-10-06 21:14:13,382 - thread-139660780025408.app.docker.base_container - INFO - Closing persistent shell...
2025-10-06 21:14:13,482 - thread-139660780025408.app.docker.base_container - INFO - Cleaning up container and temporary files
