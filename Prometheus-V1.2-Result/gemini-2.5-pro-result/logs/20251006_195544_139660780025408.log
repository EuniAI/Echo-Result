2025-10-06 19:55:44,590 - thread-139660780025408.app.docker.base_container - INFO - Created temporary project directory: /tmp/tmp7vtlq1pc/django
2025-10-06 19:55:44,590 - thread-139660780025408.app.docker.base_container - DEBUG - Using workdir: /testbed
2025-10-06 19:55:44,591 - thread-139660780025408.app.docker.base_container - INFO - Pulling docker image: swebench/sweb.eval.x86_64.django_1776_django-15467:v1
2025-10-06 19:56:10,571 - thread-139660780025408.app.docker.base_container - INFO - Tagging pulled image as: prometheus_user_defined_container_95ecf89c00
2025-10-06 19:56:10,575 - thread-139660780025408.app.docker.base_container - INFO - Starting container from image prometheus_user_defined_container_95ecf89c00
2025-10-06 19:56:11,647 - thread-139660780025408.app.docker.base_container - INFO - Starting persistent shell for interactive mode...
2025-10-06 19:56:11,787 - thread-139660780025408.app.docker.base_container - INFO - Persistent shell is ready
2025-10-06 19:56:11,787 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: . /opt/miniconda3/bin/activate
2025-10-06 19:56:11,912 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 0
2025-10-06 19:56:11,912 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:


2025-10-06 19:56:11,912 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: conda activate testbed
2025-10-06 19:56:12,037 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 0
2025-10-06 19:56:12,037 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:


2025-10-06 19:56:12,037 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: python -m pip install -e .
2025-10-06 19:56:14,869 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 0
2025-10-06 19:56:14,869 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:

Obtaining file:///testbed
  Installing build dependencies ... [?25l- \ | done
[?25h  Checking if build backend supports build_editable ... [?25ldone
[?25h  Getting requirements to build editable ... [?25l- \ done
[?25h  Preparing editable metadata (pyproject.toml) ... [?25l- \ done
[?25hRequirement already satisfied: asgiref>=3.4.1 in /opt/miniconda3/envs/testbed/lib/python3.9/site-packages (from Django==4.1.dev20220226170756) (3.8.1)
Requirement already satisfied: sqlparse>=0.2.2 in /opt/miniconda3/envs/testbed/lib/python3.9/site-packages (from Django==4.1.dev20220226170756) (0.5.1)
Requirement already satisfied: typing-extensions>=4 in /opt/miniconda3/envs/testbed/lib/python3.9/site-packages (from asgiref>=3.4.1->Django==4.1.dev20220226170756) (4.12.2)
Building wheels for collected packages: Django
  Building editable for Django (pyproject.toml) ... [?25l- \ | / done
[?25h  Created wheel for Django: filename=django-4.1.dev20220226170756-0.editable-py3-none-any.whl size=26977 sha256=3b8ff77550aa66a6479f1921fb43b7203c9f9060b7469a199f7b368a46fc77fd
  Stored in directory: /tmp/pip-ephem-wheel-cache-b99qt89d/wheels/7d/66/67/70d1ee2124ccf21d601c352e25cdca10f611f7c8b3f9ffb9e4
Successfully built Django
Installing collected packages: Django
  Attempting uninstall: Django
    Found existing installation: Django 4.1.dev20220226170756
    Uninstalling Django-4.1.dev20220226170756:
      Successfully uninstalled Django-4.1.dev20220226170756
Successfully installed Django-4.1.dev20220226170756
[33mWARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager, possibly rendering your system unusable.It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv. Use the --root-user-action option if you know what you are doing and want to suppress this warning.[0m[33m

2025-10-06 19:56:14,930 - thread-139660780025408.app.lang_graph.nodes.issue_bug_reproduction_context_message_node - DEBUG - Sending query to context provider subgraph:
Issue title:
ModelAdmin with defined radio_fields override empty_label

Issue description: 
Description
	
ModelAdmin drops my "empty_label" and set "default_empty_label". For example:
class MyModelAdmin(ModelAdmin):
	radio_fields = 'myfield',
	def formfield_for_foreignkey(self, db_field, *args, **kwargs):
		if db_field.name == 'myfield':
			kwargs['empty_label'] = "I WANT TO SET MY OWN EMPTY LABEL"
		return super().formfield_for_foreignkey(db_field, *args, **kwargs)
You get never the "I WANT TO SET MY OWN EMPTY LABEL"
How to fix it:
In django\contrib\admin\options.py, row 234:
kwargs['empty_label'] = _('None') if db_field.blank else None
Should be changed on:
kwargs['empty_label'] = (kwargs.get('empty_label') or _('None')) if db_field.blank else None

Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-10-06 19:56:14,930 - thread-139660780025408.app.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Enter context retrieval subgraph
2025-10-06 19:56:14,931 - thread-139660780025408.app.lang_graph.nodes.context_query_message_node - DEBUG - Sending query to ContextProviderNode:
content='Issue title:\nModelAdmin with defined radio_fields override empty_label\n\nIssue description: \nDescription\n\t\nModelAdmin drops my "empty_label" and set "default_empty_label". For example:\nclass MyModelAdmin(ModelAdmin):\n\tradio_fields = \'myfield\',\n\tdef formfield_for_foreignkey(self, db_field, *args, **kwargs):\n\t\tif db_field.name == \'myfield\':\n\t\t\tkwargs[\'empty_label\'] = "I WANT TO SET MY OWN EMPTY LABEL"\n\t\treturn super().formfield_for_foreignkey(db_field, *args, **kwargs)\nYou get never the "I WANT TO SET MY OWN EMPTY LABEL"\nHow to fix it:\nIn django\\contrib\\admin\\options.py, row 234:\nkwargs[\'empty_label\'] = _(\'None\') if db_field.blank else None\nShould be changed on:\nkwargs[\'empty_label\'] = (kwargs.get(\'empty_label\') or _(\'None\')) if db_field.blank else None\n\nIssue comments:\n\n\nOBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,\nincluding ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.\n\n<reasoning>\n1. Analyze bug characteristics:\n   - Core functionality being tested\n   - Input parameters and configurations\n   - Expected error conditions\n   - Environmental dependencies\n\n2. Search requirements:\n   - Required imports and dependencies\n   - Test files exercising similar functionality\n   - Mock/fixture setup patterns\n   - Assertion styles\n   - Error handling tests\n\n3. Focus areas:\n   - All necessary imports (standard library, testing frameworks, mocking utilities)\n   - Dependencies and third-party packages\n   - Test setup and teardown\n   - Mock object configuration\n   - Network/external service simulation\n   - Error condition verification\n</reasoning>\n\nREQUIREMENTS:\n- Return 5 complete, self-contained test cases most similar to bug scenario\n- Must include ALL necessary imports at the start of each test file\n- Must include full test method implementation\n- Must include ALL mock/fixture setup\n- Must include helper functions used by test\n- Must preserve exact file paths and line numbers\n\n<examples>\n<example id="database-timeout">\n<bug>\ndb.execute("SELECT * FROM users").fetchall() \nraises ConnectionTimeout when load is high\n</bug>\n\n<ideal_test_match>\n# File: tests/test_database.py\nimport pytest\nfrom unittest.mock import Mock, patch\nfrom database.exceptions import ConnectionTimeout\nfrom database.models import QueryResult\nfrom database.client import DatabaseClient\n\nclass TestDatabaseTimeout:\n    @pytest.fixture\n    def mock_db_connection(self):\n        conn = Mock()\n        conn.execute.side_effect = [\n            ConnectionTimeout("Connection timed out"),\n            QueryResult(["user1", "user2"])  # Second try succeeds\n        ]\n        return conn\n        \n    def test_handle_timeout_during_query(self, mock_db_connection):\n        # Complete test showing timeout scenario\n        # Including retry logic verification\n        # With all necessary assertions\n</ideal_test_match>\n</example>\n\n<example id="file-permission">\n<bug>\nFileProcessor(\'/root/data.txt\').process() \nfails with PermissionError\n</bug>\n\n<ideal_test_match>\n# File: tests/test_file_processor.py\nimport os\nimport pytest\nfrom unittest.mock import patch, mock_open\nfrom file_processor import FileProcessor\nfrom file_processor.exceptions import ProcessingError\n\nclass TestFilePermissions:\n    @patch(\'os.access\')\n    @patch(\'builtins.open\')\n    def test_file_permission_denied(self, mock_open, mock_access):\n        # Full test setup with mocked file system\n        # Permission denial simulation\n        # Error handling verification\n</ideal_test_match>\n</example>\n\nSearch priority:\n1. Tests of exact same functionality (including import patterns)\n2. Tests with similar error conditions\n3. Tests with comparable mocking patterns\n4. Tests demonstrating similar assertions\n\nFind the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.\n' additional_kwargs={} response_metadata={}
2025-10-06 19:57:19,138 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I have identified five relevant test cases that are similar to the reported bug. I started by searching for tests related to `radio_fields` and `formfield_for_foreignkey` in the `tests/` directory. I found several relevant tests in `tests/admin_views/tests.py` that cover the behavior of `radio_fields` with `ForeignKey` and the customization of form fields in the admin. I also found a relevant test in `tests/modeladmin/tests.py` that deals with form field choices.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/modeladmin/tests.py", "start_line": 108.0, "end_line": 134.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 57279, 'candidates_token_count': 286, 'total_token_count': 64769, 'prompt_tokens_details': [{'modality': 1, 'token_count': 57279}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 286}], 'thoughts_token_count': 7204, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -3.670050347601617, 'model_name': 'gemini-2.5-pro'} id='run--a0cddc57-7364-40c8-8c4d-0a999c22d9c1-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 1.0, 'relative_path': 'tests/admin_views/tests.py', 'end_line': 47.0}, 'id': 'eb8941dc-441f-45a0-a037-b0ebe4c8e079', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/admin_views/tests.py', 'start_line': 1478.0, 'end_line': 1505.0}, 'id': 'd29c60d2-874b-4d38-833f-6d7bc63f7558', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/admin_views/tests.py', 'start_line': 1047.0, 'end_line': 1047.0}, 'id': '6f7ef5d6-c61e-4d6b-a7a7-6e9d6fcda019', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/admin_views/tests.py', 'start_line': 1341.0, 'end_line': 1392.0}, 'id': '36a80336-bbe9-4436-b513-f164e9849184', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/modeladmin/tests.py', 'start_line': 1.0, 'end_line': 13.0}, 'id': '857d9e3a-c11c-41cf-90fc-ba3cfbf1244a', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/modeladmin/tests.py', 'start_line': 108.0, 'end_line': 134.0}, 'id': '8b3a9634-d011-429a-a4d1-0e8592e4e025', 'type': 'tool_call'}] usage_metadata={'input_tokens': 57279, 'output_tokens': 286, 'total_tokens': 64769, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 7204}}
2025-10-06 19:57:33,325 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I have identified five relevant test cases that are similar to the reported bug. I started by searching for tests related to `radio_fields` and `formfield_for_foreignkey` in the `tests/` directory. I found several relevant tests in `tests/admin_views/tests.py` that cover the behavior of `radio_fields` with `ForeignKey` and the customization of form fields in the admin. I also found a relevant test in `tests/modeladmin/tests.py` that deals with form field choices.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"text": "empty_label", "relative_path": "tests/forms_tests/tests/test_forms.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 60495, 'candidates_token_count': 291, 'total_token_count': 61862, 'prompt_tokens_details': [{'modality': 1, 'token_count': 60495}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 291}], 'thoughts_token_count': 1076, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.472811826725596, 'model_name': 'gemini-2.5-pro'} id='run--c60b8b93-0136-4a21-8375-5b1d327d0b2f-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'radio_fields', 'relative_path': 'tests/admin_views/tests.py'}, 'id': '3a41bd26-d679-45ac-b3a3-e8fb5f6d9043', 'type': 'tool_call'}, {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'radio_fields', 'relative_path': 'tests/modeladmin/tests.py'}, 'id': '2942548e-6e43-4596-8b73-0d48e13dfaec', 'type': 'tool_call'}, {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'empty_label', 'relative_path': 'tests/admin_views/tests.py'}, 'id': '8ccbac44-f1d6-4589-bb8c-fbca7599cf10', 'type': 'tool_call'}, {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'empty_label', 'relative_path': 'tests/modeladmin/tests.py'}, 'id': 'b29f222a-0cc3-45c7-89ee-f2bfc7a25bea', 'type': 'tool_call'}, {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'empty_label', 'relative_path': 'tests/forms_tests/tests/test_forms.py'}, 'id': '8fb95c9e-d3f5-4851-9734-b6fecb1a1e01', 'type': 'tool_call'}] usage_metadata={'input_tokens': 60495, 'output_tokens': 291, 'total_tokens': 61862, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 1076}}
2025-10-06 19:57:41,140 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I have identified five relevant test cases that are similar to the reported bug. I started by searching for tests related to `radio_fields` and `formfield_for_foreignkey` in the `tests/` directory. These searches helped me locate relevant tests in `tests/admin_views/tests.py` and `tests/modeladmin/tests.py`. I then expanded my search to include `empty_label` to find more specific examples of how empty labels are handled in forms. This led me to `tests/forms_tests/field_tests/test_choicefield.py` which contains several tests that are highly relevant to the issue.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/forms_tests/field_tests/test_choicefield.py", "start_line": 26.0, "end_line": 35.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 121974, 'candidates_token_count': 455, 'total_token_count': 122429, 'prompt_tokens_details': [{'modality': 1, 'token_count': 121974}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 455}], 'thoughts_token_count': 0, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.0887964604975103, 'model_name': 'gemini-2.5-pro'} id='run--1b9a7d51-b4c3-42e1-87ec-9498669c648e-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 1.0, 'relative_path': 'tests/admin_views/tests.py', 'end_line': 47.0}, 'id': '93877331-4c8c-43ad-a442-b38914bae82a', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'start_line': 1478.0, 'relative_path': 'tests/admin_views/tests.py', 'end_line': 1505.0}, 'id': '13560a92-c8f8-41bb-92df-0fb6fcf2fd0e', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/admin_views/tests.py', 'start_line': 1047.0, 'end_line': 1047.0}, 'id': '0722e990-b2b3-4c78-b16c-7ea90a1f2546', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/admin_views/tests.py', 'start_line': 1341.0, 'end_line': 1392.0}, 'id': '43701e33-f5e2-4e5c-bb9b-32187c638b6d', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/modeladmin/tests.py', 'start_line': 1.0, 'end_line': 13.0}, 'id': '68d29485-35fc-4380-85b0-b74a40b20b6d', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/modeladmin/tests.py', 'start_line': 108.0, 'end_line': 134.0}, 'id': '27ed9b81-5b58-4092-9538-69a36ac00005', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/forms_tests/field_tests/test_choicefield.py', 'start_line': 1.0, 'end_line': 1.0}, 'id': '2d1c5b20-2fe6-40f0-896a-b621f67d3240', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/forms_tests/field_tests/test_choicefield.py', 'start_line': 36.0, 'end_line': 50.0}, 'id': 'f10bf2c2-7d89-4aa1-afb7-6956d1bb7f11', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'start_line': 24.0, 'relative_path': 'tests/forms_tests/field_tests/test_choicefield.py', 'end_line': 24.0}, 'id': 'd25463d0-919b-4bf4-9fdb-e929140ad636', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/forms_tests/field_tests/test_choicefield.py', 'start_line': 26.0, 'end_line': 35.0}, 'id': '9e41399e-ab43-4d93-a775-7a1c4aefd96b', 'type': 'tool_call'}] usage_metadata={'input_tokens': 121974, 'output_tokens': 455, 'total_tokens': 122429, 'input_token_details': {'cache_read': 0}}
2025-10-06 19:57:47,451 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I have found five relevant test cases that demonstrate similar functionality to the reported bug. The tests cover `radio_fields` with `ForeignKey`, `empty_label` customization, and `ChoiceField` behavior, which are all relevant to the issue. I will now retrieve the full content of these tests, including all necessary imports and supporting code, to provide a comprehensive set of examples.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/forms_tests/field_tests/test_choicefield.py", "start_line": 26.0, "end_line": 35.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 126123, 'candidates_token_count': 395, 'total_token_count': 126518, 'cached_content_token_count': 118033, 'prompt_tokens_details': [{'modality': 1, 'token_count': 126123}], 'cache_tokens_details': [{'modality': 1, 'token_count': 118033}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 395}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.040694074992892106, 'model_name': 'gemini-2.5-pro'} id='run--c1b7084a-feae-45d9-b082-b5d8d7e2d412-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/admin_views/tests.py', 'start_line': 1.0, 'end_line': 47.0}, 'id': 'ff20db81-d752-4ea5-825b-a31ebaf16cdc', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/admin_views/tests.py', 'start_line': 1478.0, 'end_line': 1505.0}, 'id': 'aba92449-d81a-482d-b5e9-2ef15a4c1a01', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/admin_views/tests.py', 'start_line': 1047.0, 'end_line': 1047.0}, 'id': 'c8d6f02a-48d5-4ed4-9bbf-231597a47e3f', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'start_line': 1341.0, 'relative_path': 'tests/admin_views/tests.py', 'end_line': 1392.0}, 'id': '9d9b9590-7fff-4c21-8da3-e49161de88b6', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/modeladmin/tests.py', 'start_line': 1.0, 'end_line': 13.0}, 'id': '1fd08f73-77b5-4d67-a795-b95623749817', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/modeladmin/tests.py', 'start_line': 108.0, 'end_line': 134.0}, 'id': 'f4fea884-2734-48e0-925d-6853237c3f48', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'start_line': 1.0, 'relative_path': 'tests/forms_tests/field_tests/test_choicefield.py', 'end_line': 1.0}, 'id': 'cec93f90-a69d-4bd6-8249-9a514afefce1', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'start_line': 36.0, 'relative_path': 'tests/forms_tests/field_tests/test_choicefield.py', 'end_line': 50.0}, 'id': '0c195d16-cee3-4dc3-8f28-b6dd71988e22', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'start_line': 24.0, 'relative_path': 'tests/forms_tests/field_tests/test_choicefield.py', 'end_line': 24.0}, 'id': '393a655e-e742-48e6-9efd-81d2e54b17b0', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/forms_tests/field_tests/test_choicefield.py', 'start_line': 26.0, 'end_line': 35.0}, 'id': 'edc45d18-7f91-439a-b5b8-5a42eb0395fd', 'type': 'tool_call'}] usage_metadata={'input_tokens': 126123, 'output_tokens': 395, 'total_tokens': 126518, 'input_token_details': {'cache_read': 118033}}
2025-10-06 19:57:54,506 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I have gathered five relevant test cases that are similar to the reported bug. I began by searching for tests related to `radio_fields` and `formfield_for_foreignkey` in the `tests/` directory, which led me to `tests/admin_views/tests.py` and `tests/modeladmin/tests.py`. I then refined my search to include `empty_label`, which helped me find highly relevant tests in `tests/forms_tests/field_tests/test_choicefield.py`. These tests cover the behavior of `radio_fields` with `ForeignKey`, the customization of form fields, and the handling of empty labels in `ChoiceField`, providing a solid foundation for understanding and addressing the issue.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 7.0, "relative_path": "tests/forms_tests/field_tests/test_choicefield.py", "end_line": 18.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 130212, 'candidates_token_count': 450, 'total_token_count': 130662, 'cached_content_token_count': 125595, 'prompt_tokens_details': [{'modality': 1, 'token_count': 130212}], 'cache_tokens_details': [{'modality': 1, 'token_count': 125595}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 450}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.10808237711588542, 'model_name': 'gemini-2.5-pro'} id='run--48d9ab11-4dec-4e07-9af5-cd42f7727ea4-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/admin_views/models.py', 'start_line': 1.0, 'end_line': 50.0}, 'id': '40c964fc-d2fe-4194-80fd-74f3c4e76a14', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/admin_views/tests.py', 'start_line': 2908.0, 'end_line': 2940.0}, 'id': '7c39f368-9ee9-450e-acc3-be375aa351cc', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/modeladmin/models.py', 'start_line': 1.0, 'end_line': 41.0}, 'id': '8abc361b-188e-427b-be86-404fd54a1645', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/modeladmin/tests.py', 'start_line': 586.0, 'end_line': 622.0}, 'id': '0f360f2f-f4f1-4b75-a80f-3e336d2ac18c', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/forms_tests/field_tests/test_choicefield.py', 'start_line': 1.0, 'end_line': 5.0}, 'id': 'c9dcdb3f-22bf-4acd-bd69-9ff9b3c27720', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'start_line': 19.0, 'relative_path': 'tests/forms_tests/field_tests/test_choicefield.py', 'end_line': 24.0}, 'id': 'abdf1e63-7443-4f56-a17a-dee9d9ac4b0d', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/forms_tests/field_tests/test_choicefield.py', 'start_line': 25.0, 'end_line': 37.0}, 'id': 'b3e8a642-b751-4af3-b920-502c4b868c9f', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'start_line': 38.0, 'relative_path': 'tests/forms_tests/field_tests/test_choicefield.py', 'end_line': 50.0}, 'id': 'c766042c-b2e4-42c0-80f4-d0b63e22fe04', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'start_line': 7.0, 'relative_path': 'tests/forms_tests/field_tests/test_choicefield.py', 'end_line': 18.0}, 'id': '77048793-e3d9-496e-ba27-632a64f51939', 'type': 'tool_call'}] usage_metadata={'input_tokens': 130212, 'output_tokens': 450, 'total_tokens': 130662, 'input_token_details': {'cache_read': 125595}}
2025-10-06 19:57:56,481 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={} response_metadata={'usage_metadata': {'prompt_token_count': 134354, 'total_token_count': 134354, 'cached_content_token_count': 129223, 'prompt_tokens_details': [{'modality': 1, 'token_count': 134354}], 'cache_tokens_details': [{'modality': 1, 'token_count': 129223}], 'candidates_token_count': 0, 'thoughts_token_count': 0, 'candidates_tokens_details': []}, 'model_name': 'gemini-2.5-pro'} id='run--a16347da-e0a3-4200-ac14-50f8a8272055-0' usage_metadata={'input_tokens': 134354, 'output_tokens': 0, 'total_tokens': 134354, 'input_token_details': {'cache_read': 129223}}
2025-10-06 19:57:56,482 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - INFO - Starting context extraction process
2025-10-06 19:57:56,483 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - DEBUG - This is the original user query:

--- BEGIN ORIGINAL QUERY ---
Issue title:
ModelAdmin with defined radio_fields override empty_label

Issue description: 
Description
	
ModelAdmin drops my "empty_label" and set "default_empty_label". For example:
class MyModelAdmin(ModelAdmin):
	radio_fields = 'myfield',
	def formfield_for_foreignkey(self, db_field, *args, **kwargs):
		if db_field.name == 'myfield':
			kwargs['empty_label'] = "I WANT TO SET MY OWN EMPTY LABEL"
		return super().formfield_for_foreignkey(db_field, *args, **kwargs)
You get never the "I WANT TO SET MY OWN EMPTY LABEL"
How to fix it:
In django\contrib\admin\options.py, row 234:
kwargs['empty_label'] = _('None') if db_field.blank else None
Should be changed on:
kwargs['empty_label'] = (kwargs.get('empty_label') or _('None')) if db_field.blank else None

Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/admin_views/tests.py
Line number range: 1 - 47
Content:
1. import datetime
2. import os
3. import re
4. import unittest
5. from unittest import mock
6. from urllib.parse import parse_qsl, urljoin, urlparse
7. 
8. try:
9.     import zoneinfo
10. except ImportError:
11.     from backports import zoneinfo
12. 
13. try:
14.     import pytz
15. except ImportError:
16.     pytz = None
17. 
18. from django.contrib import admin
19. from django.contrib.admin import AdminSite, ModelAdmin
20. from django.contrib.admin.helpers import ACTION_CHECKBOX_NAME
21. from django.contrib.admin.models import ADDITION, DELETION, LogEntry
22. from django.contrib.admin.options import TO_FIELD_VAR
23. from django.contrib.admin.templatetags.admin_urls import add_preserved_filters
24. from django.contrib.admin.tests import AdminSeleniumTestCase
25. from django.contrib.admin.utils import quote
26. from django.contrib.admin.views.main import IS_POPUP_VAR
27. from django.contrib.auth import REDIRECT_FIELD_NAME, get_permission_codename
28. from django.contrib.auth.models import Group, Permission, User
29. from django.contrib.contenttypes.models import ContentType
30. from django.core import mail
31. from django.core.checks import Error
32. from django.core.files import temp as tempfile
33. from django.forms.utils import ErrorList
34. from django.template.response import TemplateResponse
35. from django.test import (
36.     TestCase,
37.     modify_settings,
38.     override_settings,
39.     skipUnlessDBFeature,
40. )
41. from django.test.utils import override_script_prefix
42. from django.urls import NoReverseMatch, resolve, reverse
43. from django.utils import formats, translation
44. from django.utils.cache import get_max_age
45. from django.utils.encoding import iri_to_uri
46. from django.utils.html import escape
47. from django.utils.http import urlencode

File: tests/admin_views/tests.py
Line number range: 1478 - 1505
Content:
1478.         self.assertRedirects(
1479.             post, reverse("admin:admin_views_customarticle_changelist")
1480.         )
1481.         self.assertEqual(CustomArticle.objects.count(), 1)
1482.         article_pk = CustomArticle.objects.all()[0].pk
1483. 
1484.         # Test custom delete, change, and object history templates
1485.         # Test custom change form template
1486.         response = self.client.get(
1487.             reverse("admin:admin_views_customarticle_change", args=(article_pk,))
1488.         )
1489.         self.assertTemplateUsed(response, "custom_admin/change_form.html")
1490.         response = self.client.get(
1491.             reverse("admin:admin_views_customarticle_delete", args=(article_pk,))
1492.         )
1493.         self.assertTemplateUsed(response, "custom_admin/delete_confirmation.html")
1494.         response = self.client.post(
1495.             reverse("admin:admin_views_customarticle_changelist"),
1496.             data={
1497.                 "index": 0,
1498.                 "action": ["delete_selected"],
1499.                 "_selected_action": ["1"],
1500.             },
1501.         )
1502.         self.assertTemplateUsed(
1503.             response, "custom_admin/delete_selected_confirmation.html"
1504.         )
1505.         response = self.client.get(

File: tests/admin_views/tests.py
Line number range: 1047 - 1047
Content:
1047.         )

File: tests/admin_views/tests.py
Line number range: 1341 - 1392
Content:
1341.         response = self.client.get(reverse("admin6:admin_views_color_changelist"))
1342.         self.assertContains(response, '<th scope="col" class="column-value">')
1343.         self.assertNotContains(response, '<th scope="col" class="sortable column')
1344. 
1345.     def test_app_index_context(self):
1346.         response = self.client.get(reverse("admin:app_list", args=("admin_views",)))
1347.         self.assertContains(
1348.             response,
1349.             "<title>Admin_Views administration | Django site admin</title>",
1350.         )
1351.         self.assertEqual(response.context["title"], "Admin_Views administration")
1352.         self.assertEqual(response.context["app_label"], "admin_views")
1353. 
1354.     def test_change_view_subtitle_per_object(self):
1355.         response = self.client.get(
1356.             reverse("admin:admin_views_article_change", args=(self.a1.pk,)),
1357.         )
1358.         self.assertContains(
1359.             response,
1360.             "<title>Article 1 | Change article | Django site admin</title>",
1361.         )
1362.         self.assertContains(response, "<h1>Change article</h1>")
1363.         self.assertContains(response, "<h2>Article 1</h2>")
1364.         response = self.client.get(
1365.             reverse("admin:admin_views_article_change", args=(self.a2.pk,)),
1366.         )
1367.         self.assertContains(
1368.             response,
1369.             "<title>Article 2 | Change article | Django site admin</title>",
1370.         )
1371.         self.assertContains(response, "<h1>Change article</h1>")
1372.         self.assertContains(response, "<h2>Article 2</h2>")
1373. 
1374.     def test_view_subtitle_per_object(self):
1375.         viewuser = User.objects.create_user(
1376.             username="viewuser",
1377.             password="secret",
1378.             is_staff=True,
1379.         )
1380.         viewuser.user_permissions.add(
1381.             get_perm(Article, get_permission_codename("view", Article._meta)),
1382.         )
1383.         self.client.force_login(viewuser)
1384.         response = self.client.get(
1385.             reverse("admin:admin_views_article_change", args=(self.a1.pk,)),
1386.         )
1387.         self.assertContains(
1388.             response,
1389.             "<title>Article 1 | View article | Django site admin</title>",
1390.         )
1391.         self.assertContains(response, "<h1>View article</h1>")
1392.         self.assertContains(response, "<h2>Article 1</h2>")

File: tests/modeladmin/tests.py
Line number range: 1 - 13
Content:
1. from datetime import date
2. 
3. from django import forms
4. from django.contrib.admin.models import ADDITION, CHANGE, DELETION, LogEntry
5. from django.contrib.admin.options import (
6.     HORIZONTAL,
7.     VERTICAL,
8.     ModelAdmin,
9.     TabularInline,
10.     get_content_type_for_model,
11. )
12. from django.contrib.admin.sites import AdminSite
13. from django.contrib.admin.widgets import (

File: tests/modeladmin/tests.py
Line number range: 41 - 805
Content:
class ModelAdminTests(TestCase):
    @classmethod
    def setUpTestData(cls):
        cls.band = Band.objects.create(
            name="The Doors",
            bio="",
            sign_date=date(1965, 1, 1),
        )

    def setUp(self):
        self.site = AdminSite()

    def test_modeladmin_str(self):
        ma = ModelAdmin(Band, self.site)
        self.assertEqual(str(ma), "modeladmin.ModelAdmin")

    def test_default_attributes(self):
        ma = ModelAdmin(Band, self.site)
        self.assertEqual(ma.actions, ())
        self.assertEqual(ma.inlines, ())

    # form/fields/fieldsets interaction ##############################

    def test_default_fields(self):
        ma = ModelAdmin(Band, self.site)
        self.assertEqual(
            list(ma.get_form(request).base_fields), ["name", "bio", "sign_date"]
        )
        self.assertEqual(list(ma.get_fields(request)), ["name", "bio", "sign_date"])
        self.assertEqual(
            list(ma.get_fields(request, self.band)), ["name", "bio", "sign_date"]
        )
        self.assertIsNone(ma.get_exclude(request, self.band))

    def test_default_fieldsets(self):
        # fieldsets_add and fieldsets_change should return a special data structure that
        # is used in the templates. They should generate the "right thing" whether we
        # have specified a custom form, the fields argument, or nothing at all.
        #
        # Here's the default case. There are no custom form_add/form_change methods,
        # no fields argument, and no fieldsets argument.
        ma = ModelAdmin(Band, self.site)
        self.assertEqual(
            ma.get_fieldsets(request),
            [(None, {"fields": ["name", "bio", "sign_date"]})],
        )
        self.assertEqual(
            ma.get_fieldsets(request, self.band),
            [(None, {"fields": ["name", "bio", "sign_date"]})],
        )

    def test_get_fieldsets(self):
        # get_fieldsets() is called when figuring out form fields (#18681).
        class BandAdmin(ModelAdmin):
            def get_fieldsets(self, request, obj=None):
                return [(None, {"fields": ["name", "bio"]})]

        ma = BandAdmin(Band, self.site)
        form = ma.get_form(None)
        self.assertEqual(form._meta.fields, ["name", "bio"])

        class InlineBandAdmin(TabularInline):
            model = Concert
            fk_name = "main_band"
            can_delete = False

            def get_fieldsets(self, request, obj=None):
                return [(None, {"fields": ["day", "transport"]})]

        ma = InlineBandAdmin(Band, self.site)
        form = ma.get_formset(None).form
        self.assertEqual(form._meta.fields, ["day", "transport"])

    def test_lookup_allowed_allows_nonexistent_lookup(self):
        """
        A lookup_allowed allows a parameter whose field lookup doesn't exist.
        (#21129).
        """

        class BandAdmin(ModelAdmin):
            fields = ["name"]

        ma = BandAdmin(Band, self.site)
        self.assertTrue(ma.lookup_allowed("name__nonexistent", "test_value"))

    @isolate_apps("modeladmin")
    def test_lookup_allowed_onetoone(self):
        class Department(models.Model):
            code = models.CharField(max_length=4, unique=True)

        class Employee(models.Model):
            department = models.ForeignKey(Department, models.CASCADE, to_field="code")

        class EmployeeProfile(models.Model):
            employee = models.OneToOneField(Employee, models.CASCADE)

        class EmployeeInfo(models.Model):
            employee = models.OneToOneField(Employee, models.CASCADE)
            description = models.CharField(max_length=100)

        class EmployeeProfileAdmin(ModelAdmin):
            list_filter = [
                "employee__employeeinfo__description",
                "employee__department__code",
            ]

        ma = EmployeeProfileAdmin(EmployeeProfile, self.site)
        # Reverse OneToOneField
        self.assertIs(
            ma.lookup_allowed("employee__employeeinfo__description", "test_value"), True
        )
        # OneToOneField and ForeignKey
        self.assertIs(
            ma.lookup_allowed("employee__department__code", "test_value"), True
        )

    def test_field_arguments(self):
        # If fields is specified, fieldsets_add and fieldsets_change should
        # just stick the fields into a formsets structure and return it.
        class BandAdmin(ModelAdmin):
            fields = ["name"]

        ma = BandAdmin(Band, self.site)

        self.assertEqual(list(ma.get_fields(request)), ["name"])
        self.assertEqual(list(ma.get_fields(request, self.band)), ["name"])
        self.assertEqual(ma.get_fieldsets(request), [(None, {"fields": ["name"]})])
        self.assertEqual(
            ma.get_fieldsets(request, self.band), [(None, {"fields": ["name"]})]
        )

    def test_field_arguments_restricted_on_form(self):
        # If fields or fieldsets is specified, it should exclude fields on the
        # Form class to the fields specified. This may cause errors to be
        # raised in the db layer if required model fields aren't in fields/
        # fieldsets, but that's preferable to ghost errors where a field in the
        # Form class isn't being displayed because it's not in fields/fieldsets.

        # Using `fields`.
        class BandAdmin(ModelAdmin):
            fields = ["name"]

        ma = BandAdmin(Band, self.site)
        self.assertEqual(list(ma.get_form(request).base_fields), ["name"])
        self.assertEqual(list(ma.get_form(request, self.band).base_fields), ["name"])

        # Using `fieldsets`.
        class BandAdmin(ModelAdmin):
            fieldsets = [(None, {"fields": ["name"]})]

        ma = BandAdmin(Band, self.site)
        self.assertEqual(list(ma.get_form(request).base_fields), ["name"])
        self.assertEqual(list(ma.get_form(request, self.band).base_fields), ["name"])

        # Using `exclude`.
        class BandAdmin(ModelAdmin):
            exclude = ["bio"]

        ma = BandAdmin(Band, self.site)
        self.assertEqual(list(ma.get_form(request).base_fields), ["name", "sign_date"])

        # You can also pass a tuple to `exclude`.
        class BandAdmin(ModelAdmin):
            exclude = ("bio",)

        ma = BandAdmin(Band, self.site)
        self.assertEqual(list(ma.get_form(request).base_fields), ["name", "sign_date"])

        # Using `fields` and `exclude`.
        class BandAdmin(ModelAdmin):
            fields = ["name", "bio"]
            exclude = ["bio"]

        ma = BandAdmin(Band, self.site)
        self.assertEqual(list(ma.get_form(request).base_fields), ["name"])

    def test_custom_form_meta_exclude_with_readonly(self):
        """
        The custom ModelForm's `Meta.exclude` is respected when used in
        conjunction with `ModelAdmin.readonly_fields` and when no
        `ModelAdmin.exclude` is defined (#14496).
        """
        # With ModelAdmin
        class AdminBandForm(forms.ModelForm):
            class Meta:
                model = Band
                exclude = ["bio"]

        class BandAdmin(ModelAdmin):
            readonly_fields = ["name"]
            form = AdminBandForm

        ma = BandAdmin(Band, self.site)
        self.assertEqual(list(ma.get_form(request).base_fields), ["sign_date"])

        # With InlineModelAdmin
        class AdminConcertForm(forms.ModelForm):
            class Meta:
                model = Concert
                exclude = ["day"]

        class ConcertInline(TabularInline):
            readonly_fields = ["transport"]
            form = AdminConcertForm
            fk_name = "main_band"
            model = Concert

        class BandAdmin(ModelAdmin):
            inlines = [ConcertInline]

        ma = BandAdmin(Band, self.site)
        self.assertEqual(
            list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),
            ["main_band", "opening_band", "id", "DELETE"],
        )

    def test_custom_formfield_override_readonly(self):
        class AdminBandForm(forms.ModelForm):
            name = forms.CharField()

            class Meta:
                exclude = ()
                model = Band

        class BandAdmin(ModelAdmin):
            form = AdminBandForm
            readonly_fields = ["name"]

        ma = BandAdmin(Band, self.site)

        # `name` shouldn't appear in base_fields because it's part of
        # readonly_fields.
        self.assertEqual(list(ma.get_form(request).base_fields), ["bio", "sign_date"])
        # But it should appear in get_fields()/fieldsets() so it can be
        # displayed as read-only.
        self.assertEqual(list(ma.get_fields(request)), ["bio", "sign_date", "name"])
        self.assertEqual(
            list(ma.get_fieldsets(request)),
            [(None, {"fields": ["bio", "sign_date", "name"]})],
        )

    def test_custom_form_meta_exclude(self):
        """
        The custom ModelForm's `Meta.exclude` is overridden if
        `ModelAdmin.exclude` or `InlineModelAdmin.exclude` are defined (#14496).
        """
        # With ModelAdmin
        class AdminBandForm(forms.ModelForm):
            class Meta:
                model = Band
                exclude = ["bio"]

        class BandAdmin(ModelAdmin):
            exclude = ["name"]
            form = AdminBandForm

        ma = BandAdmin(Band, self.site)
        self.assertEqual(list(ma.get_form(request).base_fields), ["bio", "sign_date"])

        # With InlineModelAdmin
        class AdminConcertForm(forms.ModelForm):
            class Meta:
                model = Concert
                exclude = ["day"]

        class ConcertInline(TabularInline):
            exclude = ["transport"]
            form = AdminConcertForm
            fk_name = "main_band"
            model = Concert

        class BandAdmin(ModelAdmin):
            inlines = [ConcertInline]

        ma = BandAdmin(Band, self.site)
        self.assertEqual(
            list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),
            ["main_band", "opening_band", "day", "id", "DELETE"],
        )

    def test_overriding_get_exclude(self):
        class BandAdmin(ModelAdmin):
            def get_exclude(self, request, obj=None):
                return ["name"]

        self.assertEqual(
            list(BandAdmin(Band, self.site).get_form(request).base_fields),
            ["bio", "sign_date"],
        )

    def test_get_exclude_overrides_exclude(self):
        class BandAdmin(ModelAdmin):
            exclude = ["bio"]

            def get_exclude(self, request, obj=None):
                return ["name"]

        self.assertEqual(
            list(BandAdmin(Band, self.site).get_form(request).base_fields),
            ["bio", "sign_date"],
        )

    def test_get_exclude_takes_obj(self):
        class BandAdmin(ModelAdmin):
            def get_exclude(self, request, obj=None):
                if obj:
                    return ["sign_date"]
                return ["name"]

        self.assertEqual(
            list(BandAdmin(Band, self.site).get_form(request, self.band).base_fields),
            ["name", "bio"],
        )

    def test_custom_form_validation(self):
        # If a form is specified, it should use it allowing custom validation
        # to work properly. This won't break any of the admin widgets or media.
        class AdminBandForm(forms.ModelForm):
            delete = forms.BooleanField()

        class BandAdmin(ModelAdmin):
            form = AdminBandForm

        ma = BandAdmin(Band, self.site)
        self.assertEqual(
            list(ma.get_form(request).base_fields),
            ["name", "bio", "sign_date", "delete"],
        )
        self.assertEqual(
            type(ma.get_form(request).base_fields["sign_date"].widget), AdminDateWidget
        )

    def test_form_exclude_kwarg_override(self):
        """
        The `exclude` kwarg passed to `ModelAdmin.get_form()` overrides all
        other declarations (#8999).
        """

        class AdminBandForm(forms.ModelForm):
            class Meta:
                model = Band
                exclude = ["name"]

        class BandAdmin(ModelAdmin):
            exclude = ["sign_date"]
            form = AdminBandForm

            def get_form(self, request, obj=None, **kwargs):
                kwargs["exclude"] = ["bio"]
                return super().get_form(request, obj, **kwargs)

        ma = BandAdmin(Band, self.site)
        self.assertEqual(list(ma.get_form(request).base_fields), ["name", "sign_date"])

    def test_formset_exclude_kwarg_override(self):
        """
        The `exclude` kwarg passed to `InlineModelAdmin.get_formset()`
        overrides all other declarations (#8999).
        """

        class AdminConcertForm(forms.ModelForm):
            class Meta:
                model = Concert
                exclude = ["day"]

        class ConcertInline(TabularInline):
            exclude = ["transport"]
            form = AdminConcertForm
            fk_name = "main_band"
            model = Concert

            def get_formset(self, request, obj=None, **kwargs):
                kwargs["exclude"] = ["opening_band"]
                return super().get_formset(request, obj, **kwargs)

        class BandAdmin(ModelAdmin):
            inlines = [ConcertInline]

        ma = BandAdmin(Band, self.site)
        self.assertEqual(
            list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),
            ["main_band", "day", "transport", "id", "DELETE"],
        )

    def test_formset_overriding_get_exclude_with_form_fields(self):
        class AdminConcertForm(forms.ModelForm):
            class Meta:
                model = Concert
                fields = ["main_band", "opening_band", "day", "transport"]

        class ConcertInline(TabularInline):
            form = AdminConcertForm
            fk_name = "main_band"
            model = Concert

            def get_exclude(self, request, obj=None):
                return ["opening_band"]

        class BandAdmin(ModelAdmin):
            inlines = [ConcertInline]

        ma = BandAdmin(Band, self.site)
        self.assertEqual(
            list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),
            ["main_band", "day", "transport", "id", "DELETE"],
        )

    def test_formset_overriding_get_exclude_with_form_exclude(self):
        class AdminConcertForm(forms.ModelForm):
            class Meta:
                model = Concert
                exclude = ["day"]

        class ConcertInline(TabularInline):
            form = AdminConcertForm
            fk_name = "main_band"
            model = Concert

            def get_exclude(self, request, obj=None):
                return ["opening_band"]

        class BandAdmin(ModelAdmin):
            inlines = [ConcertInline]

        ma = BandAdmin(Band, self.site)
        self.assertEqual(
            list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),
            ["main_band", "day", "transport", "id", "DELETE"],
        )

    def test_raw_id_fields_widget_override(self):
        """
        The autocomplete_fields, raw_id_fields, and radio_fields widgets may
        overridden by specifying a widget in get_formset().
        """

        class ConcertInline(TabularInline):
            model = Concert
            fk_name = "main_band"
            raw_id_fields = ("opening_band",)

            def get_formset(self, request, obj=None, **kwargs):
                kwargs["widgets"] = {"opening_band": Select}
                return super().get_formset(request, obj, **kwargs)

        class BandAdmin(ModelAdmin):
            inlines = [ConcertInline]

        ma = BandAdmin(Band, self.site)
        band_widget = (
            list(ma.get_formsets_with_inlines(request))[0][0]()
            .forms[0]
            .fields["opening_band"]
            .widget
        )
        # Without the override this would be ForeignKeyRawIdWidget.
        self.assertIsInstance(band_widget, Select)

    def test_queryset_override(self):
        # If the queryset of a ModelChoiceField in a custom form is overridden,
        # RelatedFieldWidgetWrapper doesn't mess that up.
        band2 = Band.objects.create(
            name="The Beatles", bio="", sign_date=date(1962, 1, 1)
        )

        ma = ModelAdmin(Concert, self.site)
        form = ma.get_form(request)()

        self.assertHTMLEqual(
            str(form["main_band"]),
            '<div class="related-widget-wrapper">'
            '<select name="main_band" id="id_main_band" required>'
            '<option value="" selected>---------</option>'
            '<option value="%d">The Beatles</option>'
            '<option value="%d">The Doors</option>'
            "</select></div>" % (band2.id, self.band.id),
        )

        class AdminConcertForm(forms.ModelForm):
            def __init__(self, *args, **kwargs):
                super().__init__(*args, **kwargs)
                self.fields["main_band"].queryset = Band.objects.filter(
                    name="The Doors"
                )

        class ConcertAdminWithForm(ModelAdmin):
            form = AdminConcertForm

        ma = ConcertAdminWithForm(Concert, self.site)
        form = ma.get_form(request)()

        self.assertHTMLEqual(
            str(form["main_band"]),
            '<div class="related-widget-wrapper">'
            '<select name="main_band" id="id_main_band" required>'
            '<option value="" selected>---------</option>'
            '<option value="%d">The Doors</option>'
            "</select></div>" % self.band.id,
        )

    def test_regression_for_ticket_15820(self):
        """
        `obj` is passed from `InlineModelAdmin.get_fieldsets()` to
        `InlineModelAdmin.get_formset()`.
        """

        class CustomConcertForm(forms.ModelForm):
            class Meta:
                model = Concert
                fields = ["day"]

        class ConcertInline(TabularInline):
            model = Concert
            fk_name = "main_band"

            def get_formset(self, request, obj=None, **kwargs):
                if obj:
                    kwargs["form"] = CustomConcertForm
                return super().get_formset(request, obj, **kwargs)

        class BandAdmin(ModelAdmin):
            inlines = [ConcertInline]

        Concert.objects.create(main_band=self.band, opening_band=self.band, day=1)
        ma = BandAdmin(Band, self.site)
        inline_instances = ma.get_inline_instances(request)
        fieldsets = list(inline_instances[0].get_fieldsets(request))
        self.assertEqual(
            fieldsets[0][1]["fields"], ["main_band", "opening_band", "day", "transport"]
        )
        fieldsets = list(
            inline_instances[0].get_fieldsets(request, inline_instances[0].model)
        )
        self.assertEqual(fieldsets[0][1]["fields"], ["day"])

    # radio_fields behavior ###########################################

    def test_default_foreign_key_widget(self):
        # First, without any radio_fields specified, the widgets for ForeignKey
        # and fields with choices specified ought to be a basic Select widget.
        # ForeignKey widgets in the admin are wrapped with RelatedFieldWidgetWrapper so
        # they need to be handled properly when type checking. For Select fields, all of
        # the choices lists have a first entry of dashes.
        cma = ModelAdmin(Concert, self.site)
        cmafa = cma.get_form(request)

        self.assertEqual(type(cmafa.base_fields["main_band"].widget.widget), Select)
        self.assertEqual(
            list(cmafa.base_fields["main_band"].widget.choices),
            [("", "---------"), (self.band.id, "The Doors")],
        )

        self.assertEqual(type(cmafa.base_fields["opening_band"].widget.widget), Select)
        self.assertEqual(
            list(cmafa.base_fields["opening_band"].widget.choices),
            [("", "---------"), (self.band.id, "The Doors")],
        )
        self.assertEqual(type(cmafa.base_fields["day"].widget), Select)
        self.assertEqual(
            list(cmafa.base_fields["day"].widget.choices),
            [("", "---------"), (1, "Fri"), (2, "Sat")],
        )
        self.assertEqual(type(cmafa.base_fields["transport"].widget), Select)
        self.assertEqual(
            list(cmafa.base_fields["transport"].widget.choices),
            [("", "---------"), (1, "Plane"), (2, "Train"), (3, "Bus")],
        )

    def test_foreign_key_as_radio_field(self):
        # Now specify all the fields as radio_fields.  Widgets should now be
        # RadioSelect, and the choices list should have a first entry of 'None' if
        # blank=True for the model field.  Finally, the widget should have the
        # 'radiolist' attr, and 'inline' as well if the field is specified HORIZONTAL.
        class ConcertAdmin(ModelAdmin):
            radio_fields = {
                "main_band": HORIZONTAL,
                "opening_band": VERTICAL,
                "day": VERTICAL,
                "transport": HORIZONTAL,
            }

        cma = ConcertAdmin(Concert, self.site)
        cmafa = cma.get_form(request)

        self.assertEqual(
            type(cmafa.base_fields["main_band"].widget.widget), AdminRadioSelect
        )
        self.assertEqual(
            cmafa.base_fields["main_band"].widget.attrs, {"class": "radiolist inline"}
        )
        self.assertEqual(
            list(cmafa.base_fields["main_band"].widget.choices),
            [(self.band.id, "The Doors")],
        )

        self.assertEqual(
            type(cmafa.base_fields["opening_band"].widget.widget), AdminRadioSelect
        )
        self.assertEqual(
            cmafa.base_fields["opening_band"].widget.attrs, {"class": "radiolist"}
        )
        self.assertEqual(
            list(cmafa.base_fields["opening_band"].widget.choices),
            [("", "None"), (self.band.id, "The Doors")],
        )
        self.assertEqual(type(cmafa.base_fields["day"].widget), AdminRadioSelect)
        self.assertEqual(cmafa.base_fields["day"].widget.attrs, {"class": "radiolist"})
        self.assertEqual(
            list(cmafa.base_fields["day"].widget.choices), [(1, "Fri"), (2, "Sat")]
        )

        self.assertEqual(type(cmafa.base_fields["transport"].widget), AdminRadioSelect)
        self.assertEqual(
            cmafa.base_fields["transport"].widget.attrs, {"class": "radiolist inline"}
        )
        self.assertEqual(
            list(cmafa.base_fields["transport"].widget.choices),
            [("", "None"), (1, "Plane"), (2, "Train"), (3, "Bus")],
        )

        class AdminConcertForm(forms.ModelForm):
            class Meta:
                model = Concert
                exclude = ("transport",)

        class ConcertAdmin(ModelAdmin):
            form = AdminConcertForm

        ma = ConcertAdmin(Concert, self.site)
        self.assertEqual(
            list(ma.get_form(request).base_fields), ["main_band", "opening_band", "day"]
        )

        class AdminConcertForm(forms.ModelForm):
            extra = forms.CharField()

            class Meta:
                model = Concert
                fields = ["extra", "transport"]

        class ConcertAdmin(ModelAdmin):
            form = AdminConcertForm

        ma = ConcertAdmin(Concert, self.site)
        self.assertEqual(list(ma.get_form(request).base_fields), ["extra", "transport"])

        class ConcertInline(TabularInline):
            form = AdminConcertForm
            model = Concert
            fk_name = "main_band"
            can_delete = True

        class BandAdmin(ModelAdmin):
            inlines = [ConcertInline]

        ma = BandAdmin(Band, self.site)
        self.assertEqual(
            list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),
            ["extra", "transport", "id", "DELETE", "main_band"],
        )

    def test_log_actions(self):
        ma = ModelAdmin(Band, self.site)
        mock_request = MockRequest()
        mock_request.user = User.objects.create(username="bill")
        content_type = get_content_type_for_model(self.band)
        tests = (
            (ma.log_addition, ADDITION, {"added": {}}),
            (ma.log_change, CHANGE, {"changed": {"fields": ["name", "bio"]}}),
            (ma.log_deletion, DELETION, str(self.band)),
        )
        for method, flag, message in tests:
            with self.subTest(name=method.__name__):
                created = method(mock_request, self.band, message)
                fetched = LogEntry.objects.filter(action_flag=flag).latest("id")
                self.assertEqual(created, fetched)
                self.assertEqual(fetched.action_flag, flag)
                self.assertEqual(fetched.content_type, content_type)
                self.assertEqual(fetched.object_id, str(self.band.pk))
                self.assertEqual(fetched.user, mock_request.user)
                if flag == DELETION:
                    self.assertEqual(fetched.change_message, "")
                    self.assertEqual(fetched.object_repr, message)
                else:
                    self.assertEqual(fetched.change_message, str(message))
                    self.assertEqual(fetched.object_repr, str(self.band))

    def test_get_autocomplete_fields(self):
        class NameAdmin(ModelAdmin):
            search_fields = ["name"]

        class SongAdmin(ModelAdmin):
            autocomplete_fields = ["featuring"]
            fields = ["featuring", "band"]

        class OtherSongAdmin(SongAdmin):
            def get_autocomplete_fields(self, request):
                return ["band"]

        self.site.register(Band, NameAdmin)
        try:
            # Uses autocomplete_fields if not overridden.
            model_admin = SongAdmin(Song, self.site)
            form = model_admin.get_form(request)()
            self.assertIsInstance(
                form.fields["featuring"].widget.widget, AutocompleteSelectMultiple
            )
            # Uses overridden get_autocomplete_fields
            model_admin = OtherSongAdmin(Song, self.site)
            form = model_admin.get_form(request)()
            self.assertIsInstance(form.fields["band"].widget.widget, AutocompleteSelect)
        finally:
            self.site.unregister(Band)

    def test_get_deleted_objects(self):
        mock_request = MockRequest()
        mock_request.user = User.objects.create_superuser(
            username="bob", email="bob@test.com", password="test"
        )
        self.site.register(Band, ModelAdmin)
        ma = self.site._registry[Band]
        (
            deletable_objects,
            model_count,
            perms_needed,
            protected,
        ) = ma.get_deleted_objects([self.band], request)
        self.assertEqual(deletable_objects, ["Band: The Doors"])
        self.assertEqual(model_count, {"bands": 1})
        self.assertEqual(perms_needed, set())
        self.assertEqual(protected, [])

    def test_get_deleted_objects_with_custom_has_delete_permission(self):
        """
        ModelAdmin.get_deleted_objects() uses ModelAdmin.has_delete_permission()
        for permissions checking.
        """
        mock_request = MockRequest()
        mock_request.user = User.objects.create_superuser(
            username="bob", email="bob@test.com", password="test"
        )

        class TestModelAdmin(ModelAdmin):
            def has_delete_permission(self, request, obj=None):
                return False

        self.site.register(Band, TestModelAdmin)
        ma = self.site._registry[Band]
        (
            deletable_objects,
            model_count,
            perms_needed,
            protected,
        ) = ma.get_deleted_objects([self.band], request)
        self.assertEqual(deletable_objects, ["Band: The Doors"])
        self.assertEqual(model_count, {"bands": 1})
        self.assertEqual(perms_needed, {"band"})
        self.assertEqual(protected, [])

    def test_modeladmin_repr(self):
        ma = ModelAdmin(Band, self.site)
        self.assertEqual(
            repr(ma),
            "<ModelAdmin: model=Band site=AdminSite(name='admin')>",
        )

File: tests/forms_tests/tests/test_forms.py
Line number range: 82 - 4391
Content:
class FormsTestCase(SimpleTestCase):
    # A Form is a collection of Fields. It knows how to validate a set of data and it
    # knows how to render itself in a couple of default ways (e.g., an HTML table).
    # You can pass it data in __init__(), as a dictionary.

    def test_form(self):
        # Pass a dictionary to a Form's __init__().
        p = Person(
            {"first_name": "John", "last_name": "Lennon", "birthday": "1940-10-9"}
        )

        self.assertTrue(p.is_bound)
        self.assertEqual(p.errors, {})
        self.assertIsInstance(p.errors, dict)
        self.assertTrue(p.is_valid())
        self.assertHTMLEqual(p.errors.as_ul(), "")
        self.assertEqual(p.errors.as_text(), "")
        self.assertEqual(p.cleaned_data["first_name"], "John")
        self.assertEqual(p.cleaned_data["last_name"], "Lennon")
        self.assertEqual(p.cleaned_data["birthday"], datetime.date(1940, 10, 9))
        self.assertHTMLEqual(
            str(p["first_name"]),
            '<input type="text" name="first_name" value="John" id="id_first_name" '
            "required>",
        )
        self.assertHTMLEqual(
            str(p["last_name"]),
            '<input type="text" name="last_name" value="Lennon" id="id_last_name" '
            "required>",
        )
        self.assertHTMLEqual(
            str(p["birthday"]),
            '<input type="text" name="birthday" value="1940-10-9" id="id_birthday" '
            "required>",
        )

        msg = (
            "Key 'nonexistentfield' not found in 'Person'. Choices are: birthday, "
            "first_name, last_name."
        )
        with self.assertRaisesMessage(KeyError, msg):
            p["nonexistentfield"]

        form_output = []

        for boundfield in p:
            form_output.append(str(boundfield))

        self.assertHTMLEqual(
            "\n".join(form_output),
            """<input type="text" name="first_name" value="John" id="id_first_name" required>
<input type="text" name="last_name" value="Lennon" id="id_last_name" required>
<input type="text" name="birthday" value="1940-10-9" id="id_birthday" required>""",
        )

        form_output = []

        for boundfield in p:
            form_output.append([boundfield.label, boundfield.data])

        self.assertEqual(
            form_output,
            [
                ["First name", "John"],
                ["Last name", "Lennon"],
                ["Birthday", "1940-10-9"],
            ],
        )
        self.assertHTMLEqual(
            str(p),
            """
            <tr><th><label for="id_first_name">First name:</label></th><td>
            <input type="text" name="first_name" value="John" id="id_first_name"
                required></td></tr>
            <tr><th><label for="id_last_name">Last name:</label></th><td>
            <input type="text" name="last_name" value="Lennon" id="id_last_name"
                required></td></tr>
            <tr><th><label for="id_birthday">Birthday:</label></th><td>
            <input type="text" name="birthday" value="1940-10-9" id="id_birthday"
                required></td></tr>
            """,
        )

    def test_empty_dict(self):
        # Empty dictionaries are valid, too.
        p = Person({})
        self.assertTrue(p.is_bound)
        self.assertEqual(p.errors["first_name"], ["This field is required."])
        self.assertEqual(p.errors["last_name"], ["This field is required."])
        self.assertEqual(p.errors["birthday"], ["This field is required."])
        self.assertFalse(p.is_valid())
        self.assertEqual(p.cleaned_data, {})
        self.assertHTMLEqual(
            str(p),
            """<tr><th><label for="id_first_name">First name:</label></th><td>
<ul class="errorlist"><li>This field is required.</li></ul>
<input type="text" name="first_name" id="id_first_name" required></td></tr>
<tr><th><label for="id_last_name">Last name:</label></th>
<td><ul class="errorlist"><li>This field is required.</li></ul>
<input type="text" name="last_name" id="id_last_name" required></td></tr>
<tr><th><label for="id_birthday">Birthday:</label></th><td>
<ul class="errorlist"><li>This field is required.</li></ul>
<input type="text" name="birthday" id="id_birthday" required></td></tr>""",
        )
        self.assertHTMLEqual(
            p.as_table(),
            """<tr><th><label for="id_first_name">First name:</label></th><td>
<ul class="errorlist"><li>This field is required.</li></ul>
<input type="text" name="first_name" id="id_first_name" required></td></tr>
<tr><th><label for="id_last_name">Last name:</label></th>
<td><ul class="errorlist"><li>This field is required.</li></ul>
<input type="text" name="last_name" id="id_last_name" required></td></tr>
<tr><th><label for="id_birthday">Birthday:</label></th>
<td><ul class="errorlist"><li>This field is required.</li></ul>
<input type="text" name="birthday" id="id_birthday" required></td></tr>""",
        )
        self.assertHTMLEqual(
            p.as_ul(),
            """<li><ul class="errorlist"><li>This field is required.</li></ul>
<label for="id_first_name">First name:</label>
<input type="text" name="first_name" id="id_first_name" required></li>
<li><ul class="errorlist"><li>This field is required.</li></ul>
<label for="id_last_name">Last name:</label>
<input type="text" name="last_name" id="id_last_name" required></li>
<li><ul class="errorlist"><li>This field is required.</li></ul>
<label for="id_birthday">Birthday:</label>
<input type="text" name="birthday" id="id_birthday" required></li>""",
        )
        self.assertHTMLEqual(
            p.as_p(),
            """<ul class="errorlist"><li>This field is required.</li></ul>
<p><label for="id_first_name">First name:</label>
<input type="text" name="first_name" id="id_first_name" required></p>
<ul class="errorlist"><li>This field is required.</li></ul>
<p><label for="id_last_name">Last name:</label>
<input type="text" name="last_name" id="id_last_name" required></p>
<ul class="errorlist"><li>This field is required.</li></ul>
<p><label for="id_birthday">Birthday:</label>
<input type="text" name="birthday" id="id_birthday" required></p>""",
        )

    def test_empty_querydict_args(self):
        data = QueryDict()
        files = QueryDict()
        p = Person(data, files)
        self.assertIs(p.data, data)
        self.assertIs(p.files, files)

    def test_unbound_form(self):
        # If you don't pass any values to the Form's __init__(), or if you pass None,
        # the Form will be considered unbound and won't do any validation. Form.errors
        # will be an empty dictionary *but* Form.is_valid() will return False.
        p = Person()
        self.assertFalse(p.is_bound)
        self.assertEqual(p.errors, {})
        self.assertFalse(p.is_valid())
        with self.assertRaises(AttributeError):
            p.cleaned_data

        self.assertHTMLEqual(
            str(p),
            """<tr><th><label for="id_first_name">First name:</label></th><td>
<input type="text" name="first_name" id="id_first_name" required></td></tr>
<tr><th><label for="id_last_name">Last name:</label></th><td>
<input type="text" name="last_name" id="id_last_name" required></td></tr>
<tr><th><label for="id_birthday">Birthday:</label></th><td>
<input type="text" name="birthday" id="id_birthday" required></td></tr>""",
        )
        self.assertHTMLEqual(
            p.as_table(),
            """<tr><th><label for="id_first_name">First name:</label></th><td>
<input type="text" name="first_name" id="id_first_name" required></td></tr>
<tr><th><label for="id_last_name">Last name:</label></th><td>
<input type="text" name="last_name" id="id_last_name" required></td></tr>
<tr><th><label for="id_birthday">Birthday:</label></th><td>
<input type="text" name="birthday" id="id_birthday" required></td></tr>""",
        )
        self.assertHTMLEqual(
            p.as_ul(),
            """<li><label for="id_first_name">First name:</label>
<input type="text" name="first_name" id="id_first_name" required></li>
<li><label for="id_last_name">Last name:</label>
<input type="text" name="last_name" id="id_last_name" required></li>
<li><label for="id_birthday">Birthday:</label>
<input type="text" name="birthday" id="id_birthday" required></li>""",
        )
        self.assertHTMLEqual(
            p.as_p(),
            """<p><label for="id_first_name">First name:</label>
<input type="text" name="first_name" id="id_first_name" required></p>
<p><label for="id_last_name">Last name:</label>
<input type="text" name="last_name" id="id_last_name" required></p>
<p><label for="id_birthday">Birthday:</label>
<input type="text" name="birthday" id="id_birthday" required></p>""",
        )

    def test_unicode_values(self):
        # Unicode values are handled properly.
        p = Person(
            {
                "first_name": "John",
                "last_name": "\u0160\u0110\u0106\u017d\u0107\u017e\u0161\u0111",
                "birthday": "1940-10-9",
            }
        )
        self.assertHTMLEqual(
            p.as_table(),
            '<tr><th><label for="id_first_name">First name:</label></th><td>'
            '<input type="text" name="first_name" value="John" id="id_first_name" '
            "required></td></tr>\n"
            '<tr><th><label for="id_last_name">Last name:</label>'
            '</th><td><input type="text" name="last_name" '
            'value="\u0160\u0110\u0106\u017d\u0107\u017e\u0161\u0111"'
            'id="id_last_name" required></td></tr>\n'
            '<tr><th><label for="id_birthday">Birthday:</label></th><td>'
            '<input type="text" name="birthday" value="1940-10-9" id="id_birthday" '
            "required></td></tr>",
        )
        self.assertHTMLEqual(
            p.as_ul(),
            '<li><label for="id_first_name">First name:</label> '
            '<input type="text" name="first_name" value="John" id="id_first_name" '
            "required></li>\n"
            '<li><label for="id_last_name">Last name:</label> '
            '<input type="text" name="last_name" '
            'value="\u0160\u0110\u0106\u017d\u0107\u017e\u0161\u0111" '
            'id="id_last_name" required></li>\n'
            '<li><label for="id_birthday">Birthday:</label> '
            '<input type="text" name="birthday" value="1940-10-9" id="id_birthday" '
            "required></li>",
        )
        self.assertHTMLEqual(
            p.as_p(),
            '<p><label for="id_first_name">First name:</label> '
            '<input type="text" name="first_name" value="John" id="id_first_name" '
            "required></p>\n"
            '<p><label for="id_last_name">Last name:</label> '
            '<input type="text" name="last_name" '
            'value="\u0160\u0110\u0106\u017d\u0107\u017e\u0161\u0111" '
            'id="id_last_name" required></p>\n'
            '<p><label for="id_birthday">Birthday:</label> '
            '<input type="text" name="birthday" value="1940-10-9" id="id_birthday" '
            "required></p>",
        )

        p = Person({"last_name": "Lennon"})
        self.assertEqual(p.errors["first_name"], ["This field is required."])
        self.assertEqual(p.errors["birthday"], ["This field is required."])
        self.assertFalse(p.is_valid())
        self.assertEqual(
            p.errors,
            {
                "birthday": ["This field is required."],
                "first_name": ["This field is required."],
            },
        )
        self.assertEqual(p.cleaned_data, {"last_name": "Lennon"})
        self.assertEqual(p["first_name"].errors, ["This field is required."])
        self.assertHTMLEqual(
            p["first_name"].errors.as_ul(),
            '<ul class="errorlist"><li>This field is required.</li></ul>',
        )
        self.assertEqual(p["first_name"].errors.as_text(), "* This field is required.")

        p = Person()
        self.assertHTMLEqual(
            str(p["first_name"]),
            '<input type="text" name="first_name" id="id_first_name" required>',
        )
        self.assertHTMLEqual(
            str(p["last_name"]),
            '<input type="text" name="last_name" id="id_last_name" required>',
        )
        self.assertHTMLEqual(
            str(p["birthday"]),
            '<input type="text" name="birthday" id="id_birthday" required>',
        )

    def test_cleaned_data_only_fields(self):
        # cleaned_data will always *only* contain a key for fields defined in the
        # Form, even if you pass extra data when you define the Form. In this
        # example, we pass a bunch of extra fields to the form constructor,
        # but cleaned_data contains only the form's fields.
        data = {
            "first_name": "John",
            "last_name": "Lennon",
            "birthday": "1940-10-9",
            "extra1": "hello",
            "extra2": "hello",
        }
        p = Person(data)
        self.assertTrue(p.is_valid())
        self.assertEqual(p.cleaned_data["first_name"], "John")
        self.assertEqual(p.cleaned_data["last_name"], "Lennon")
        self.assertEqual(p.cleaned_data["birthday"], datetime.date(1940, 10, 9))

    def test_optional_data(self):
        # cleaned_data will include a key and value for *all* fields defined in
        # the Form, even if the Form's data didn't include a value for fields
        # that are not required. In this example, the data dictionary doesn't
        # include a value for the "nick_name" field, but cleaned_data includes
        # it. For CharFields, it's set to the empty string.
        class OptionalPersonForm(Form):
            first_name = CharField()
            last_name = CharField()
            nick_name = CharField(required=False)

        data = {"first_name": "John", "last_name": "Lennon"}
        f = OptionalPersonForm(data)
        self.assertTrue(f.is_valid())
        self.assertEqual(f.cleaned_data["nick_name"], "")
        self.assertEqual(f.cleaned_data["first_name"], "John")
        self.assertEqual(f.cleaned_data["last_name"], "Lennon")

        # For DateFields, it's set to None.
        class OptionalPersonForm(Form):
            first_name = CharField()
            last_name = CharField()
            birth_date = DateField(required=False)

        data = {"first_name": "John", "last_name": "Lennon"}
        f = OptionalPersonForm(data)
        self.assertTrue(f.is_valid())
        self.assertIsNone(f.cleaned_data["birth_date"])
        self.assertEqual(f.cleaned_data["first_name"], "John")
        self.assertEqual(f.cleaned_data["last_name"], "Lennon")

    def test_auto_id(self):
        # "auto_id" tells the Form to add an "id" attribute to each form
        # element. If it's a string that contains '%s', Django will use that as
        # a format string into which the field's name will be inserted. It will
        # also put a <label> around the human-readable labels for a field.
        p = Person(auto_id="%s_id")
        self.assertHTMLEqual(
            p.as_table(),
            """<tr><th><label for="first_name_id">First name:</label></th><td>
<input type="text" name="first_name" id="first_name_id" required></td></tr>
<tr><th><label for="last_name_id">Last name:</label></th><td>
<input type="text" name="last_name" id="last_name_id" required></td></tr>
<tr><th><label for="birthday_id">Birthday:</label></th><td>
<input type="text" name="birthday" id="birthday_id" required></td></tr>""",
        )
        self.assertHTMLEqual(
            p.as_ul(),
            """<li><label for="first_name_id">First name:</label>
<input type="text" name="first_name" id="first_name_id" required></li>
<li><label for="last_name_id">Last name:</label>
<input type="text" name="last_name" id="last_name_id" required></li>
<li><label for="birthday_id">Birthday:</label>
<input type="text" name="birthday" id="birthday_id" required></li>""",
        )
        self.assertHTMLEqual(
            p.as_p(),
            """<p><label for="first_name_id">First name:</label>
<input type="text" name="first_name" id="first_name_id" required></p>
<p><label for="last_name_id">Last name:</label>
<input type="text" name="last_name" id="last_name_id" required></p>
<p><label for="birthday_id">Birthday:</label>
<input type="text" name="birthday" id="birthday_id" required></p>""",
        )

    def test_auto_id_true(self):
        # If auto_id is any True value whose str() does not contain '%s', the "id"
        # attribute will be the name of the field.
        p = Person(auto_id=True)
        self.assertHTMLEqual(
            p.as_ul(),
            """<li><label for="first_name">First name:</label>
<input type="text" name="first_name" id="first_name" required></li>
<li><label for="last_name">Last name:</label>
<input type="text" name="last_name" id="last_name" required></li>
<li><label for="birthday">Birthday:</label>
<input type="text" name="birthday" id="birthday" required></li>""",
        )

    def test_auto_id_false(self):
        # If auto_id is any False value, an "id" attribute won't be output unless it
        # was manually entered.
        p = Person(auto_id=False)
        self.assertHTMLEqual(
            p.as_ul(),
            """<li>First name: <input type="text" name="first_name" required></li>
<li>Last name: <input type="text" name="last_name" required></li>
<li>Birthday: <input type="text" name="birthday" required></li>""",
        )

    def test_id_on_field(self):
        # In this example, auto_id is False, but the "id" attribute for the "first_name"
        # field is given. Also note that field gets a <label>, while the others don't.
        p = PersonNew(auto_id=False)
        self.assertHTMLEqual(
            p.as_ul(),
            """<li><label for="first_name_id">First name:</label>
<input type="text" id="first_name_id" name="first_name" required></li>
<li>Last name: <input type="text" name="last_name" required></li>
<li>Birthday: <input type="text" name="birthday" required></li>""",
        )

    def test_auto_id_on_form_and_field(self):
        # If the "id" attribute is specified in the Form and auto_id is True, the "id"
        # attribute in the Form gets precedence.
        p = PersonNew(auto_id=True)
        self.assertHTMLEqual(
            p.as_ul(),
            """<li><label for="first_name_id">First name:</label>
<input type="text" id="first_name_id" name="first_name" required></li>
<li><label for="last_name">Last name:</label>
<input type="text" name="last_name" id="last_name" required></li>
<li><label for="birthday">Birthday:</label>
<input type="text" name="birthday" id="birthday" required></li>""",
        )

    def test_various_boolean_values(self):
        class SignupForm(Form):
            email = EmailField()
            get_spam = BooleanField()

        f = SignupForm(auto_id=False)
        self.assertHTMLEqual(
            str(f["email"]), '<input type="email" name="email" required>'
        )
        self.assertHTMLEqual(
            str(f["get_spam"]), '<input type="checkbox" name="get_spam" required>'
        )

        f = SignupForm({"email": "test@example.com", "get_spam": True}, auto_id=False)
        self.assertHTMLEqual(
            str(f["email"]),
            '<input type="email" name="email" value="test@example.com" required>',
        )
        self.assertHTMLEqual(
            str(f["get_spam"]),
            '<input checked type="checkbox" name="get_spam" required>',
        )

        # 'True' or 'true' should be rendered without a value attribute
        f = SignupForm({"email": "test@example.com", "get_spam": "True"}, auto_id=False)
        self.assertHTMLEqual(
            str(f["get_spam"]),
            '<input checked type="checkbox" name="get_spam" required>',
        )

        f = SignupForm({"email": "test@example.com", "get_spam": "true"}, auto_id=False)
        self.assertHTMLEqual(
            str(f["get_spam"]),
            '<input checked type="checkbox" name="get_spam" required>',
        )

        # A value of 'False' or 'false' should be rendered unchecked
        f = SignupForm(
            {"email": "test@example.com", "get_spam": "False"}, auto_id=False
        )
        self.assertHTMLEqual(
            str(f["get_spam"]), '<input type="checkbox" name="get_spam" required>'
        )

        f = SignupForm(
            {"email": "test@example.com", "get_spam": "false"}, auto_id=False
        )
        self.assertHTMLEqual(
            str(f["get_spam"]), '<input type="checkbox" name="get_spam" required>'
        )

        # A value of '0' should be interpreted as a True value (#16820)
        f = SignupForm({"email": "test@example.com", "get_spam": "0"})
        self.assertTrue(f.is_valid())
        self.assertTrue(f.cleaned_data.get("get_spam"))

    def test_widget_output(self):
        # Any Field can have a Widget class passed to its constructor:
        class ContactForm(Form):
            subject = CharField()
            message = CharField(widget=Textarea)

        f = ContactForm(auto_id=False)
        self.assertHTMLEqual(
            str(f["subject"]), '<input type="text" name="subject" required>'
        )
        self.assertHTMLEqual(
            str(f["message"]),
            '<textarea name="message" rows="10" cols="40" required></textarea>',
        )

        # as_textarea(), as_text() and as_hidden() are shortcuts for changing the output
        # widget type:
        self.assertHTMLEqual(
            f["subject"].as_textarea(),
            '<textarea name="subject" rows="10" cols="40" required></textarea>',
        )
        self.assertHTMLEqual(
            f["message"].as_text(), '<input type="text" name="message" required>'
        )
        self.assertHTMLEqual(
            f["message"].as_hidden(), '<input type="hidden" name="message">'
        )

        # The 'widget' parameter to a Field can also be an instance:
        class ContactForm(Form):
            subject = CharField()
            message = CharField(widget=Textarea(attrs={"rows": 80, "cols": 20}))

        f = ContactForm(auto_id=False)
        self.assertHTMLEqual(
            str(f["message"]),
            '<textarea name="message" rows="80" cols="20" required></textarea>',
        )

        # Instance-level attrs are *not* carried over to as_textarea(), as_text() and
        # as_hidden():
        self.assertHTMLEqual(
            f["message"].as_text(), '<input type="text" name="message" required>'
        )
        f = ContactForm({"subject": "Hello", "message": "I love you."}, auto_id=False)
        self.assertHTMLEqual(
            f["subject"].as_textarea(),
            '<textarea rows="10" cols="40" name="subject" required>Hello</textarea>',
        )
        self.assertHTMLEqual(
            f["message"].as_text(),
            '<input type="text" name="message" value="I love you." required>',
        )
        self.assertHTMLEqual(
            f["message"].as_hidden(),
            '<input type="hidden" name="message" value="I love you.">',
        )

    def test_forms_with_choices(self):
        # For a form with a <select>, use ChoiceField:
        class FrameworkForm(Form):
            name = CharField()
            language = ChoiceField(choices=[("P", "Python"), ("J", "Java")])

        f = FrameworkForm(auto_id=False)
        self.assertHTMLEqual(
            str(f["language"]),
            """<select name="language">
<option value="P">Python</option>
<option value="J">Java</option>
</select>""",
        )
        f = FrameworkForm({"name": "Django", "language": "P"}, auto_id=False)
        self.assertHTMLEqual(
            str(f["language"]),
            """<select name="language">
<option value="P" selected>Python</option>
<option value="J">Java</option>
</select>""",
        )

        # A subtlety: If one of the choices' value is the empty string and the form is
        # unbound, then the <option> for the empty-string choice will get selected.
        class FrameworkForm(Form):
            name = CharField()
            language = ChoiceField(
                choices=[("", "------"), ("P", "Python"), ("J", "Java")]
            )

        f = FrameworkForm(auto_id=False)
        self.assertHTMLEqual(
            str(f["language"]),
            """<select name="language" required>
<option value="" selected>------</option>
<option value="P">Python</option>
<option value="J">Java</option>
</select>""",
        )

        # You can specify widget attributes in the Widget constructor.
        class FrameworkForm(Form):
            name = CharField()
            language = ChoiceField(
                choices=[("P", "Python"), ("J", "Java")],
                widget=Select(attrs={"class": "foo"}),
            )

        f = FrameworkForm(auto_id=False)
        self.assertHTMLEqual(
            str(f["language"]),
            """<select class="foo" name="language">
<option value="P">Python</option>
<option value="J">Java</option>
</select>""",
        )
        f = FrameworkForm({"name": "Django", "language": "P"}, auto_id=False)
        self.assertHTMLEqual(
            str(f["language"]),
            """<select class="foo" name="language">
<option value="P" selected>Python</option>
<option value="J">Java</option>
</select>""",
        )

        # When passing a custom widget instance to ChoiceField, note that setting
        # 'choices' on the widget is meaningless. The widget will use the choices
        # defined on the Field, not the ones defined on the Widget.
        class FrameworkForm(Form):
            name = CharField()
            language = ChoiceField(
                choices=[("P", "Python"), ("J", "Java")],
                widget=Select(
                    choices=[("R", "Ruby"), ("P", "Perl")], attrs={"class": "foo"}
                ),
            )

        f = FrameworkForm(auto_id=False)
        self.assertHTMLEqual(
            str(f["language"]),
            """<select class="foo" name="language">
<option value="P">Python</option>
<option value="J">Java</option>
</select>""",
        )
        f = FrameworkForm({"name": "Django", "language": "P"}, auto_id=False)
        self.assertHTMLEqual(
            str(f["language"]),
            """<select class="foo" name="language">
<option value="P" selected>Python</option>
<option value="J">Java</option>
</select>""",
        )

        # You can set a ChoiceField's choices after the fact.
        class FrameworkForm(Form):
            name = CharField()
            language = ChoiceField()

        f = FrameworkForm(auto_id=False)
        self.assertHTMLEqual(
            str(f["language"]),
            """<select name="language">
</select>""",
        )
        f.fields["language"].choices = [("P", "Python"), ("J", "Java")]
        self.assertHTMLEqual(
            str(f["language"]),
            """<select name="language">
<option value="P">Python</option>
<option value="J">Java</option>
</select>""",
        )

    def test_forms_with_radio(self):
        # Add widget=RadioSelect to use that widget with a ChoiceField.
        f = FrameworkForm(auto_id=False)
        self.assertHTMLEqual(
            str(f["language"]),
            """<div>
<div><label><input type="radio" name="language" value="P" required> Python</label></div>
<div><label><input type="radio" name="language" value="J" required> Java</label></div>
</div>""",
        )
        self.assertHTMLEqual(
            f.as_table(),
            """<tr><th>Name:</th><td><input type="text" name="name" required></td></tr>
<tr><th>Language:</th><td><div>
<div><label><input type="radio" name="language" value="P" required> Python</label></div>
<div><label><input type="radio" name="language" value="J" required> Java</label></div>
</div></td></tr>""",
        )
        self.assertHTMLEqual(
            f.as_ul(),
            """<li>Name: <input type="text" name="name" required></li>
<li>Language: <div>
<div><label><input type="radio" name="language" value="P" required> Python</label></div>
<div><label><input type="radio" name="language" value="J" required> Java</label></div>
</div></li>""",
        )

        # Regarding auto_id and <label>, RadioSelect is a special case. Each
        # radio button gets a distinct ID, formed by appending an underscore
        # plus the button's zero-based index.
        f = FrameworkForm(auto_id="id_%s")
        self.assertHTMLEqual(
            str(f["language"]),
            """
            <div id="id_language">
            <div><label for="id_language_0">
            <input type="radio" id="id_language_0" value="P" name="language" required>
            Python</label></div>
            <div><label for="id_language_1">
            <input type="radio" id="id_language_1" value="J" name="language" required>
            Java</label></div>
            </div>""",
        )

        # When RadioSelect is used with auto_id, and the whole form is printed
        # using either as_table() or as_ul(), the label for the RadioSelect
        # will **not** point to the ID of the *first* radio button to improve
        # accessibility for screen reader users.
        self.assertHTMLEqual(
            f.as_table(),
            """
            <tr><th><label for="id_name">Name:</label></th><td>
            <input type="text" name="name" id="id_name" required></td></tr>
            <tr><th><label>Language:</label></th><td><div id="id_language">
            <div><label for="id_language_0">
            <input type="radio" id="id_language_0" value="P" name="language" required>
            Python</label></div>
            <div><label for="id_language_1">
            <input type="radio" id="id_language_1" value="J" name="language" required>
            Java</label></div>
            </div></td></tr>""",
        )
        self.assertHTMLEqual(
            f.as_ul(),
            """
            <li><label for="id_name">Name:</label>
            <input type="text" name="name" id="id_name" required></li>
            <li><label>Language:</label> <div id="id_language">
            <div><label for="id_language_0">
            <input type="radio" id="id_language_0" value="P" name="language" required>
            Python</label></div>
            <div><label for="id_language_1">
            <input type="radio" id="id_language_1" value="J" name="language" required>
            Java</label></div>
            </div></li>
            """,
        )
        self.assertHTMLEqual(
            f.as_p(),
            """
            <p><label for="id_name">Name:</label>
            <input type="text" name="name" id="id_name" required></p>
            <p><label>Language:</label> <div id="id_language">
            <div><label for="id_language_0">
            <input type="radio" id="id_language_0" value="P" name="language" required>
            Python</label></div>
            <div><label for="id_language_1">
            <input type="radio" id="id_language_1" value="J" name="language" required>
            Java</label></div>
            </div></p>
            """,
        )

    def test_form_with_iterable_boundfield(self):
        class BeatleForm(Form):
            name = ChoiceField(
                choices=[
                    ("john", "John"),
                    ("paul", "Paul"),
                    ("george", "George"),
                    ("ringo", "Ringo"),
                ],
                widget=RadioSelect,
            )

        f = BeatleForm(auto_id=False)
        self.assertHTMLEqual(
            "\n".join(str(bf) for bf in f["name"]),
            """<label><input type="radio" name="name" value="john" required> John</label>
<label><input type="radio" name="name" value="paul" required> Paul</label>
<label><input type="radio" name="name" value="george" required> George</label>
<label><input type="radio" name="name" value="ringo" required> Ringo</label>""",
        )
        self.assertHTMLEqual(
            "\n".join("<div>%s</div>" % bf for bf in f["name"]),
            """
            <div><label>
            <input type="radio" name="name" value="john" required> John</label></div>
            <div><label>
            <input type="radio" name="name" value="paul" required> Paul</label></div>
            <div><label>
            <input type="radio" name="name" value="george" required> George
            </label></div>
            <div><label>
            <input type="radio" name="name" value="ringo" required> Ringo</label></div>
            """,
        )

    def test_form_with_iterable_boundfield_id(self):
        class BeatleForm(Form):
            name = ChoiceField(
                choices=[
                    ("john", "John"),
                    ("paul", "Paul"),
                    ("george", "George"),
                    ("ringo", "Ringo"),
                ],
                widget=RadioSelect,
            )

        fields = list(BeatleForm()["name"])
        self.assertEqual(len(fields), 4)

        self.assertEqual(fields[0].id_for_label, "id_name_0")
        self.assertEqual(fields[0].choice_label, "John")
        self.assertHTMLEqual(
            fields[0].tag(),
            '<input type="radio" name="name" value="john" id="id_name_0" required>',
        )
        self.assertHTMLEqual(
            str(fields[0]),
            '<label for="id_name_0"><input type="radio" name="name" '
            'value="john" id="id_name_0" required> John</label>',
        )

        self.assertEqual(fields[1].id_for_label, "id_name_1")
        self.assertEqual(fields[1].choice_label, "Paul")
        self.assertHTMLEqual(
            fields[1].tag(),
            '<input type="radio" name="name" value="paul" id="id_name_1" required>',
        )
        self.assertHTMLEqual(
            str(fields[1]),
            '<label for="id_name_1"><input type="radio" name="name" '
            'value="paul" id="id_name_1" required> Paul</label>',
        )

    def test_iterable_boundfield_select(self):
        class BeatleForm(Form):
            name = ChoiceField(
                choices=[
                    ("john", "John"),
                    ("paul", "Paul"),
                    ("george", "George"),
                    ("ringo", "Ringo"),
                ]
            )

        fields = list(BeatleForm(auto_id=False)["name"])
        self.assertEqual(len(fields), 4)

        self.assertIsNone(fields[0].id_for_label)
        self.assertEqual(fields[0].choice_label, "John")
        self.assertHTMLEqual(fields[0].tag(), '<option value="john">John</option>')
        self.assertHTMLEqual(str(fields[0]), '<option value="john">John</option>')

    def test_form_with_noniterable_boundfield(self):
        # You can iterate over any BoundField, not just those with widget=RadioSelect.
        class BeatleForm(Form):
            name = CharField()

        f = BeatleForm(auto_id=False)
        self.assertHTMLEqual(
            "\n".join(str(bf) for bf in f["name"]),
            '<input type="text" name="name" required>',
        )

    def test_boundfield_slice(self):
        class BeatleForm(Form):
            name = ChoiceField(
                choices=[
                    ("john", "John"),
                    ("paul", "Paul"),
                    ("george", "George"),
                    ("ringo", "Ringo"),
                ],
                widget=RadioSelect,
            )

        f = BeatleForm()
        bf = f["name"]
        self.assertEqual(
            [str(item) for item in bf[1:]],
            [str(bf[1]), str(bf[2]), str(bf[3])],
        )

    def test_boundfield_invalid_index(self):
        class TestForm(Form):
            name = ChoiceField(choices=[])

        field = TestForm()["name"]
        msg = "BoundField indices must be integers or slices, not str."
        with self.assertRaisesMessage(TypeError, msg):
            field["foo"]

    def test_boundfield_bool(self):
        """BoundField without any choices (subwidgets) evaluates to True."""

        class TestForm(Form):
            name = ChoiceField(choices=[])

        self.assertIs(bool(TestForm()["name"]), True)

    def test_forms_with_multiple_choice(self):
        # MultipleChoiceField is a special case, as its data is required to be a list:
        class SongForm(Form):
            name = CharField()
            composers = MultipleChoiceField()

        f = SongForm(auto_id=False)
        self.assertHTMLEqual(
            str(f["composers"]),
            """<select multiple name="composers" required>
</select>""",
        )

        class SongForm(Form):
            name = CharField()
            composers = MultipleChoiceField(
                choices=[("J", "John Lennon"), ("P", "Paul McCartney")]
            )

        f = SongForm(auto_id=False)
        self.assertHTMLEqual(
            str(f["composers"]),
            """<select multiple name="composers" required>
<option value="J">John Lennon</option>
<option value="P">Paul McCartney</option>
</select>""",
        )
        f = SongForm({"name": "Yesterday", "composers": ["P"]}, auto_id=False)
        self.assertHTMLEqual(
            str(f["name"]), '<input type="text" name="name" value="Yesterday" required>'
        )
        self.assertHTMLEqual(
            str(f["composers"]),
            """<select multiple name="composers" required>
<option value="J">John Lennon</option>
<option value="P" selected>Paul McCartney</option>
</select>""",
        )
        f = SongForm()
        self.assertHTMLEqual(
            f.as_table(),
            '<tr><th><label for="id_name">Name:</label></th>'
            '<td><input type="text" name="name" required id="id_name"></td>'
            '</tr><tr><th><label for="id_composers">Composers:</label></th>'
            '<td><select name="composers" required id="id_composers" multiple>'
            '<option value="J">John Lennon</option>'
            '<option value="P">Paul McCartney</option>'
            "</select></td></tr>",
        )
        self.assertHTMLEqual(
            f.as_ul(),
            '<li><label for="id_name">Name:</label>'
            '<input type="text" name="name" required id="id_name"></li>'
            '<li><label for="id_composers">Composers:</label>'
            '<select name="composers" required id="id_composers" multiple>'
            '<option value="J">John Lennon</option>'
            '<option value="P">Paul McCartney</option>'
            "</select></li>",
        )
        self.assertHTMLEqual(
            f.as_p(),
            '<p><label for="id_name">Name:</label>'
            '<input type="text" name="name" required id="id_name"></p>'
            '<p><label for="id_composers">Composers:</label>'
            '<select name="composers" required id="id_composers" multiple>'
            '<option value="J">John Lennon</option>'
            '<option value="P">Paul McCartney</option>'
            "</select></p>",
        )

    def test_multiple_checkbox_render(self):
        f = SongForm()
        self.assertHTMLEqual(
            f.as_table(),
            '<tr><th><label for="id_name">Name:</label></th><td>'
            '<input type="text" name="name" required id="id_name"></td></tr>'
            '<tr><th><label>Composers:</label></th><td><div id="id_composers">'
            '<div><label for="id_composers_0">'
            '<input type="checkbox" name="composers" value="J" '
            'id="id_composers_0">John Lennon</label></div>'
            '<div><label for="id_composers_1">'
            '<input type="checkbox" name="composers" value="P" '
            'id="id_composers_1">Paul McCartney</label></div>'
            "</div></td></tr>",
        )
        self.assertHTMLEqual(
            f.as_ul(),
            '<li><label for="id_name">Name:</label>'
            '<input type="text" name="name" required id="id_name"></li>'
            '<li><label>Composers:</label><div id="id_composers">'
            '<div><label for="id_composers_0">'
            '<input type="checkbox" name="composers" value="J" '
            'id="id_composers_0">John Lennon</label></div>'
            '<div><label for="id_composers_1">'
            '<input type="checkbox" name="composers" value="P" '
            'id="id_composers_1">Paul McCartney</label></div>'
            "</div></li>",
        )
        self.assertHTMLEqual(
            f.as_p(),
            '<p><label for="id_name">Name:</label>'
            '<input type="text" name="name" required id="id_name"></p>'
            '<p><label>Composers:</label><div id="id_composers">'
            '<div><label for="id_composers_0">'
            '<input type="checkbox" name="composers" value="J" '
            'id="id_composers_0">John Lennon</label></div>'
            '<div><label for="id_composers_1">'
            '<input type="checkbox" name="composers" value="P" '
            'id="id_composers_1">Paul McCartney</label></div>'
            "</div></p>",
        )

    def test_form_with_disabled_fields(self):
        class PersonForm(Form):
            name = CharField()
            birthday = DateField(disabled=True)

        class PersonFormFieldInitial(Form):
            name = CharField()
            birthday = DateField(disabled=True, initial=datetime.date(1974, 8, 16))

        # Disabled fields are generally not transmitted by user agents.
        # The value from the form's initial data is used.
        f1 = PersonForm(
            {"name": "John Doe"}, initial={"birthday": datetime.date(1974, 8, 16)}
        )
        f2 = PersonFormFieldInitial({"name": "John Doe"})
        for form in (f1, f2):
            self.assertTrue(form.is_valid())
            self.assertEqual(
                form.cleaned_data,
                {"birthday": datetime.date(1974, 8, 16), "name": "John Doe"},
            )

        # Values provided in the form's data are ignored.
        data = {"name": "John Doe", "birthday": "1984-11-10"}
        f1 = PersonForm(data, initial={"birthday": datetime.date(1974, 8, 16)})
        f2 = PersonFormFieldInitial(data)
        for form in (f1, f2):
            self.assertTrue(form.is_valid())
            self.assertEqual(
                form.cleaned_data,
                {"birthday": datetime.date(1974, 8, 16), "name": "John Doe"},
            )

        # Initial data remains present on invalid forms.
        data = {}
        f1 = PersonForm(data, initial={"birthday": datetime.date(1974, 8, 16)})
        f2 = PersonFormFieldInitial(data)
        for form in (f1, f2):
            self.assertFalse(form.is_valid())
            self.assertEqual(form["birthday"].value(), datetime.date(1974, 8, 16))

    def test_hidden_data(self):
        class SongForm(Form):
            name = CharField()
            composers = MultipleChoiceField(
                choices=[("J", "John Lennon"), ("P", "Paul McCartney")]
            )

        # MultipleChoiceField rendered as_hidden() is a special case. Because it can
        # have multiple values, its as_hidden() renders multiple <input type="hidden">
        # tags.
        f = SongForm({"name": "Yesterday", "composers": ["P"]}, auto_id=False)
        self.assertHTMLEqual(
            f["composers"].as_hidden(),
            '<input type="hidden" name="composers" value="P">',
        )
        f = SongForm({"name": "From Me To You", "composers": ["P", "J"]}, auto_id=False)
        self.assertHTMLEqual(
            f["composers"].as_hidden(),
            """<input type="hidden" name="composers" value="P">
<input type="hidden" name="composers" value="J">""",
        )

        # DateTimeField rendered as_hidden() is special too
        class MessageForm(Form):
            when = SplitDateTimeField()

        f = MessageForm({"when_0": "1992-01-01", "when_1": "01:01"})
        self.assertTrue(f.is_valid())
        self.assertHTMLEqual(
            str(f["when"]),
            '<input type="text" name="when_0" value="1992-01-01" id="id_when_0" '
            "required>"
            '<input type="text" name="when_1" value="01:01" id="id_when_1" required>',
        )
        self.assertHTMLEqual(
            f["when"].as_hidden(),
            '<input type="hidden" name="when_0" value="1992-01-01" id="id_when_0">'
            '<input type="hidden" name="when_1" value="01:01" id="id_when_1">',
        )

    def test_multiple_choice_checkbox(self):
        # MultipleChoiceField can also be used with the CheckboxSelectMultiple widget.
        f = SongForm(auto_id=False)
        self.assertHTMLEqual(
            str(f["composers"]),
            """
            <div>
            <div><label><input type="checkbox" name="composers" value="J">
            John Lennon</label></div>
            <div><label><input type="checkbox" name="composers" value="P">
            Paul McCartney</label></div>
            </div>
            """,
        )
        f = SongForm({"composers": ["J"]}, auto_id=False)
        self.assertHTMLEqual(
            str(f["composers"]),
            """
            <div>
            <div><label><input checked type="checkbox" name="composers" value="J">
            John Lennon</label></div>
            <div><label><input type="checkbox" name="composers" value="P">
            Paul McCartney</label></div>
            </div>
            """,
        )
        f = SongForm({"composers": ["J", "P"]}, auto_id=False)
        self.assertHTMLEqual(
            str(f["composers"]),
            """
            <div>
            <div><label><input checked type="checkbox" name="composers" value="J">
            John Lennon</label></div>
            <div><label><input checked type="checkbox" name="composers" value="P">
            Paul McCartney</label></div>
            </div>
            """,
        )

    def test_checkbox_auto_id(self):
        # Regarding auto_id, CheckboxSelectMultiple is a special case. Each checkbox
        # gets a distinct ID, formed by appending an underscore plus the checkbox's
        # zero-based index.
        class SongForm(Form):
            name = CharField()
            composers = MultipleChoiceField(
                choices=[("J", "John Lennon"), ("P", "Paul McCartney")],
                widget=CheckboxSelectMultiple,
            )

        f = SongForm(auto_id="%s_id")
        self.assertHTMLEqual(
            str(f["composers"]),
            """
            <div id="composers_id">
            <div><label for="composers_id_0">
            <input type="checkbox" name="composers" value="J" id="composers_id_0">
            John Lennon</label></div>
            <div><label for="composers_id_1">
            <input type="checkbox" name="composers" value="P" id="composers_id_1">
            Paul McCartney</label></div>
            </div>
            """,
        )

    def test_multiple_choice_list_data(self):
        # Data for a MultipleChoiceField should be a list. QueryDict and
        # MultiValueDict conveniently work with this.
        class SongForm(Form):
            name = CharField()
            composers = MultipleChoiceField(
                choices=[("J", "John Lennon"), ("P", "Paul McCartney")],
                widget=CheckboxSelectMultiple,
            )

        data = {"name": "Yesterday", "composers": ["J", "P"]}
        f = SongForm(data)
        self.assertEqual(f.errors, {})

        data = QueryDict("name=Yesterday&composers=J&composers=P")
        f = SongForm(data)
        self.assertEqual(f.errors, {})

        data = MultiValueDict({"name": ["Yesterday"], "composers": ["J", "P"]})
        f = SongForm(data)
        self.assertEqual(f.errors, {})

        # SelectMultiple uses ducktyping so that MultiValueDictLike.getlist()
        # is called.
        f = SongForm(MultiValueDictLike({"name": "Yesterday", "composers": "J"}))
        self.assertEqual(f.errors, {})
        self.assertEqual(f.cleaned_data["composers"], ["J"])

    def test_multiple_hidden(self):
        class SongForm(Form):
            name = CharField()
            composers = MultipleChoiceField(
                choices=[("J", "John Lennon"), ("P", "Paul McCartney")],
                widget=CheckboxSelectMultiple,
            )

        # The MultipleHiddenInput widget renders multiple values as hidden fields.
        class SongFormHidden(Form):
            name = CharField()
            composers = MultipleChoiceField(
                choices=[("J", "John Lennon"), ("P", "Paul McCartney")],
                widget=MultipleHiddenInput,
            )

        f = SongFormHidden(
            MultiValueDict({"name": ["Yesterday"], "composers": ["J", "P"]}),
            auto_id=False,
        )
        self.assertHTMLEqual(
            f.as_ul(),
            """<li>Name: <input type="text" name="name" value="Yesterday" required>
<input type="hidden" name="composers" value="J">
<input type="hidden" name="composers" value="P"></li>""",
        )

        # When using CheckboxSelectMultiple, the framework expects a list of input and
        # returns a list of input.
        f = SongForm({"name": "Yesterday"}, auto_id=False)
        self.assertEqual(f.errors["composers"], ["This field is required."])
        f = SongForm({"name": "Yesterday", "composers": ["J"]}, auto_id=False)
        self.assertEqual(f.errors, {})
        self.assertEqual(f.cleaned_data["composers"], ["J"])
        self.assertEqual(f.cleaned_data["name"], "Yesterday")
        f = SongForm({"name": "Yesterday", "composers": ["J", "P"]}, auto_id=False)
        self.assertEqual(f.errors, {})
        self.assertEqual(f.cleaned_data["composers"], ["J", "P"])
        self.assertEqual(f.cleaned_data["name"], "Yesterday")

        # MultipleHiddenInput uses ducktyping so that
        # MultiValueDictLike.getlist() is called.
        f = SongForm(MultiValueDictLike({"name": "Yesterday", "composers": "J"}))
        self.assertEqual(f.errors, {})
        self.assertEqual(f.cleaned_data["composers"], ["J"])

    def test_escaping(self):
        # Validation errors are HTML-escaped when output as HTML.
        class EscapingForm(Form):
            special_name = CharField(label="<em>Special</em> Field")
            special_safe_name = CharField(label=mark_safe("<em>Special</em> Field"))

            def clean_special_name(self):
                raise ValidationError(
                    "Something's wrong with '%s'" % self.cleaned_data["special_name"]
                )

            def clean_special_safe_name(self):
                raise ValidationError(
                    mark_safe(
                        "'<b>%s</b>' is a safe string"
                        % self.cleaned_data["special_safe_name"]
                    )
                )

        f = EscapingForm(
            {
                "special_name": "Nothing to escape",
                "special_safe_name": "Nothing to escape",
            },
            auto_id=False,
        )
        self.assertHTMLEqual(
            f.as_table(),
            """
            <tr><th>&lt;em&gt;Special&lt;/em&gt; Field:</th><td>
            <ul class="errorlist">
            <li>Something&#x27;s wrong with &#x27;Nothing to escape&#x27;</li></ul>
            <input type="text" name="special_name" value="Nothing to escape" required>
            </td></tr>
            <tr><th><em>Special</em> Field:</th><td>
            <ul class="errorlist">
            <li>'<b>Nothing to escape</b>' is a safe string</li></ul>
            <input type="text" name="special_safe_name" value="Nothing to escape"
                required></td></tr>
            """,
        )
        f = EscapingForm(
            {
                "special_name": "Should escape < & > and <script>alert('xss')</script>",
                "special_safe_name": "<i>Do not escape</i>",
            },
            auto_id=False,
        )
        self.assertHTMLEqual(
            f.as_table(),
            "<tr><th>&lt;em&gt;Special&lt;/em&gt; Field:</th><td>"
            '<ul class="errorlist"><li>'
            "Something&#x27;s wrong with &#x27;Should escape &lt; &amp; &gt; and "
            "&lt;script&gt;alert(&#x27;xss&#x27;)&lt;/script&gt;&#x27;</li></ul>"
            '<input type="text" name="special_name" value="Should escape &lt; &amp; '
            '&gt; and &lt;script&gt;alert(&#x27;xss&#x27;)&lt;/script&gt;" required>'
            "</td></tr>"
            "<tr><th><em>Special</em> Field:</th><td>"
            '<ul class="errorlist">'
            "<li>'<b><i>Do not escape</i></b>' is a safe string</li></ul>"
            '<input type="text" name="special_safe_name" '
            'value="&lt;i&gt;Do not escape&lt;/i&gt;" required></td></tr>',
        )

    def test_validating_multiple_fields(self):
        # There are a couple of ways to do multiple-field validation. If you
        # want the validation message to be associated with a particular field,
        # implement the clean_XXX() method on the Form, where XXX is the field
        # name. As in Field.clean(), the clean_XXX() method should return the
        # cleaned value. In the clean_XXX() method, you have access to
        # self.cleaned_data, which is a dictionary of all the data that has
        # been cleaned *so far*, in order by the fields, including the current
        # field (e.g., the field XXX if you're in clean_XXX()).
        class UserRegistration(Form):
            username = CharField(max_length=10)
            password1 = CharField(widget=PasswordInput)
            password2 = CharField(widget=PasswordInput)

            def clean_password2(self):
                if (
                    self.cleaned_data.get("password1")
                    and self.cleaned_data.get("password2")
                    and self.cleaned_data["password1"] != self.cleaned_data["password2"]
                ):
                    raise ValidationError("Please make sure your passwords match.")

                return self.cleaned_data["password2"]

        f = UserRegistration(auto_id=False)
        self.assertEqual(f.errors, {})
        f = UserRegistration({}, auto_id=False)
        self.assertEqual(f.errors["username"], ["This field is required."])
        self.assertEqual(f.errors["password1"], ["This field is required."])
        self.assertEqual(f.errors["password2"], ["This field is required."])
        f = UserRegistration(
            {"username": "adrian", "password1": "foo", "password2": "bar"},
            auto_id=False,
        )
        self.assertEqual(
            f.errors["password2"], ["Please make sure your passwords match."]
        )
        f = UserRegistration(
            {"username": "adrian", "password1": "foo", "password2": "foo"},
            auto_id=False,
        )
        self.assertEqual(f.errors, {})
        self.assertEqual(f.cleaned_data["username"], "adrian")
        self.assertEqual(f.cleaned_data["password1"], "foo")
        self.assertEqual(f.cleaned_data["password2"], "foo")

        # Another way of doing multiple-field validation is by implementing the
        # Form's clean() method. Usually ValidationError raised by that method
        # will not be associated with a particular field and will have a
        # special-case association with the field named '__all__'. It's
        # possible to associate the errors to particular field with the
        # Form.add_error() method or by passing a dictionary that maps each
        # field to one or more errors.
        #
        # Note that in Form.clean(), you have access to self.cleaned_data, a
        # dictionary of all the fields/values that have *not* raised a
        # ValidationError. Also note Form.clean() is required to return a
        # dictionary of all clean data.
        class UserRegistration(Form):
            username = CharField(max_length=10)
            password1 = CharField(widget=PasswordInput)
            password2 = CharField(widget=PasswordInput)

            def clean(self):
                # Test raising a ValidationError as NON_FIELD_ERRORS.
                if (
                    self.cleaned_data.get("password1")
                    and self.cleaned_data.get("password2")
                    and self.cleaned_data["password1"] != self.cleaned_data["password2"]
                ):
                    raise ValidationError("Please make sure your passwords match.")

                # Test raising ValidationError that targets multiple fields.
                errors = {}
                if self.cleaned_data.get("password1") == "FORBIDDEN_VALUE":
                    errors["password1"] = "Forbidden value."
                if self.cleaned_data.get("password2") == "FORBIDDEN_VALUE":
                    errors["password2"] = ["Forbidden value."]
                if errors:
                    raise ValidationError(errors)

                # Test Form.add_error()
                if self.cleaned_data.get("password1") == "FORBIDDEN_VALUE2":
                    self.add_error(None, "Non-field error 1.")
                    self.add_error("password1", "Forbidden value 2.")
                if self.cleaned_data.get("password2") == "FORBIDDEN_VALUE2":
                    self.add_error("password2", "Forbidden value 2.")
                    raise ValidationError("Non-field error 2.")

                return self.cleaned_data

        f = UserRegistration(auto_id=False)
        self.assertEqual(f.errors, {})

        f = UserRegistration({}, auto_id=False)
        self.assertHTMLEqual(
            f.as_table(),
            """<tr><th>Username:</th><td>
<ul class="errorlist"><li>This field is required.</li></ul>
<input type="text" name="username" maxlength="10" required></td></tr>
<tr><th>Password1:</th><td><ul class="errorlist"><li>This field is required.</li></ul>
<input type="password" name="password1" required></td></tr>
<tr><th>Password2:</th><td><ul class="errorlist"><li>This field is required.</li></ul>
<input type="password" name="password2" required></td></tr>""",
        )
        self.assertEqual(f.errors["username"], ["This field is required."])
        self.assertEqual(f.errors["password1"], ["This field is required."])
        self.assertEqual(f.errors["password2"], ["This field is required."])

        f = UserRegistration(
            {"username": "adrian", "password1": "foo", "password2": "bar"},
            auto_id=False,
        )
        self.assertEqual(
            f.errors["__all__"], ["Please make sure your passwords match."]
        )
        self.assertHTMLEqual(
            f.as_table(),
            """
            <tr><td colspan="2">
            <ul class="errorlist nonfield">
            <li>Please make sure your passwords match.</li></ul></td></tr>
            <tr><th>Username:</th><td>
            <input type="text" name="username" value="adrian" maxlength="10" required>
            </td></tr>
            <tr><th>Password1:</th><td>
            <input type="password" name="password1" required></td></tr>
            <tr><th>Password2:</th><td>
            <input type="password" name="password2" required></td></tr>
            """,
        )
        self.assertHTMLEqual(
            f.as_ul(),
            """
            <li><ul class="errorlist nonfield">
            <li>Please make sure your passwords match.</li></ul></li>
            <li>Username:
            <input type="text" name="username" value="adrian" maxlength="10" required>
            </li>
            <li>Password1: <input type="password" name="password1" required></li>
            <li>Password2: <input type="password" name="password2" required></li>
            """,
        )

        f = UserRegistration(
            {"username": "adrian", "password1": "foo", "password2": "foo"},
            auto_id=False,
        )
        self.assertEqual(f.errors, {})
        self.assertEqual(f.cleaned_data["username"], "adrian")
        self.assertEqual(f.cleaned_data["password1"], "foo")
        self.assertEqual(f.cleaned_data["password2"], "foo")

        f = UserRegistration(
            {
                "username": "adrian",
                "password1": "FORBIDDEN_VALUE",
                "password2": "FORBIDDEN_VALUE",
            },
            auto_id=False,
        )
        self.assertEqual(f.errors["password1"], ["Forbidden value."])
        self.assertEqual(f.errors["password2"], ["Forbidden value."])

        f = UserRegistration(
            {
                "username": "adrian",
                "password1": "FORBIDDEN_VALUE2",
                "password2": "FORBIDDEN_VALUE2",
            },
            auto_id=False,
        )
        self.assertEqual(
            f.errors["__all__"], ["Non-field error 1.", "Non-field error 2."]
        )
        self.assertEqual(f.errors["password1"], ["Forbidden value 2."])
        self.assertEqual(f.errors["password2"], ["Forbidden value 2."])

        with self.assertRaisesMessage(ValueError, "has no field named"):
            f.add_error("missing_field", "Some error.")

    def test_update_error_dict(self):
        class CodeForm(Form):
            code = CharField(max_length=10)

            def clean(self):
                try:
                    raise ValidationError({"code": [ValidationError("Code error 1.")]})
                except ValidationError as e:
                    self._errors = e.update_error_dict(self._errors)

                try:
                    raise ValidationError({"code": [ValidationError("Code error 2.")]})
                except ValidationError as e:
                    self._errors = e.update_error_dict(self._errors)

                try:
                    raise ValidationError({"code": forms.ErrorList(["Code error 3."])})
                except ValidationError as e:
                    self._errors = e.update_error_dict(self._errors)

                try:
                    raise ValidationError("Non-field error 1.")
                except ValidationError as e:
                    self._errors = e.update_error_dict(self._errors)

                try:
                    raise ValidationError([ValidationError("Non-field error 2.")])
                except ValidationError as e:
                    self._errors = e.update_error_dict(self._errors)

                # The newly added list of errors is an instance of ErrorList.
                for field, error_list in self._errors.items():
                    if not isinstance(error_list, self.error_class):
                        self._errors[field] = self.error_class(error_list)

        form = CodeForm({"code": "hello"})
        # Trigger validation.
        self.assertFalse(form.is_valid())

        # update_error_dict didn't lose track of the ErrorDict type.
        self.assertIsInstance(form._errors, forms.ErrorDict)

        self.assertEqual(
            dict(form.errors),
            {
                "code": ["Code error 1.", "Code error 2.", "Code error 3."],
                NON_FIELD_ERRORS: ["Non-field error 1.", "Non-field error 2."],
            },
        )

    def test_has_error(self):
        class UserRegistration(Form):
            username = CharField(max_length=10)
            password1 = CharField(widget=PasswordInput, min_length=5)
            password2 = CharField(widget=PasswordInput)

            def clean(self):
                if (
                    self.cleaned_data.get("password1")
                    and self.cleaned_data.get("password2")
                    and self.cleaned_data["password1"] != self.cleaned_data["password2"]
                ):
                    raise ValidationError(
                        "Please make sure your passwords match.",
                        code="password_mismatch",
                    )

        f = UserRegistration(data={})
        self.assertTrue(f.has_error("password1"))
        self.assertTrue(f.has_error("password1", "required"))
        self.assertFalse(f.has_error("password1", "anything"))

        f = UserRegistration(data={"password1": "Hi", "password2": "Hi"})
        self.assertTrue(f.has_error("password1"))
        self.assertTrue(f.has_error("password1", "min_length"))
        self.assertFalse(f.has_error("password1", "anything"))
        self.assertFalse(f.has_error("password2"))
        self.assertFalse(f.has_error("password2", "anything"))

        f = UserRegistration(data={"password1": "Bonjour", "password2": "Hello"})
        self.assertFalse(f.has_error("password1"))
        self.assertFalse(f.has_error("password1", "required"))
        self.assertTrue(f.has_error(NON_FIELD_ERRORS))
        self.assertTrue(f.has_error(NON_FIELD_ERRORS, "password_mismatch"))
        self.assertFalse(f.has_error(NON_FIELD_ERRORS, "anything"))

    def test_html_output_with_hidden_input_field_errors(self):
        class TestForm(Form):
            hidden_input = CharField(widget=HiddenInput)

            def clean(self):
                self.add_error(None, "Form error")

        f = TestForm(data={})
        error_dict = {
            "hidden_input": ["This field is required."],
            "__all__": ["Form error"],
        }
        self.assertEqual(f.errors, error_dict)
        f.as_table()
        self.assertEqual(f.errors, error_dict)
        self.assertHTMLEqual(
            f.as_table(),
            '<tr><td colspan="2"><ul class="errorlist nonfield"><li>Form error</li>'
            "<li>(Hidden field hidden_input) This field is required.</li></ul>"
            '<input type="hidden" name="hidden_input" id="id_hidden_input"></td></tr>',
        )
        self.assertHTMLEqual(
            f.as_ul(),
            '<li><ul class="errorlist nonfield"><li>Form error</li>'
            "<li>(Hidden field hidden_input) This field is required.</li></ul>"
            '<input type="hidden" name="hidden_input" id="id_hidden_input"></li>',
        )
        self.assertHTMLEqual(
            f.as_p(),
            '<ul class="errorlist nonfield"><li>Form error</li>'
            "<li>(Hidden field hidden_input) This field is required.</li></ul>"
            '<p><input type="hidden" name="hidden_input" id="id_hidden_input"></p>',
        )

    def test_dynamic_construction(self):
        # It's possible to construct a Form dynamically by adding to the self.fields
        # dictionary in __init__(). Don't forget to call Form.__init__() within the
        # subclass' __init__().
        class Person(Form):
            first_name = CharField()
            last_name = CharField()

            def __init__(self, *args, **kwargs):
                super().__init__(*args, **kwargs)
                self.fields["birthday"] = DateField()

        p = Person(auto_id=False)
        self.assertHTMLEqual(
            p.as_table(),
            """
            <tr><th>First name:</th><td>
            <input type="text" name="first_name" required></td></tr>
            <tr><th>Last name:</th><td>
            <input type="text" name="last_name" required></td></tr>
            <tr><th>Birthday:</th><td>
            <input type="text" name="birthday" required></td></tr>
            """,
        )

        # Instances of a dynamic Form do not persist fields from one Form instance to
        # the next.
        class MyForm(Form):
            def __init__(self, data=None, auto_id=False, field_list=[]):
                Form.__init__(self, data, auto_id=auto_id)

                for field in field_list:
                    self.fields[field[0]] = field[1]

        field_list = [("field1", CharField()), ("field2", CharField())]
        my_form = MyForm(field_list=field_list)
        self.assertHTMLEqual(
            my_form.as_table(),
            """
            <tr><th>Field1:</th><td><input type="text" name="field1" required></td></tr>
            <tr><th>Field2:</th><td><input type="text" name="field2" required></td></tr>
            """,
        )
        field_list = [("field3", CharField()), ("field4", CharField())]
        my_form = MyForm(field_list=field_list)
        self.assertHTMLEqual(
            my_form.as_table(),
            """
            <tr><th>Field3:</th><td><input type="text" name="field3" required></td></tr>
            <tr><th>Field4:</th><td><input type="text" name="field4" required></td></tr>
            """,
        )

        class MyForm(Form):
            default_field_1 = CharField()
            default_field_2 = CharField()

            def __init__(self, data=None, auto_id=False, field_list=[]):
                Form.__init__(self, data, auto_id=auto_id)

                for field in field_list:
                    self.fields[field[0]] = field[1]

        field_list = [("field1", CharField()), ("field2", CharField())]
        my_form = MyForm(field_list=field_list)
        self.assertHTMLEqual(
            my_form.as_table(),
            """
            <tr><th>Default field 1:</th><td>
            <input type="text" name="default_field_1" required></td></tr>
            <tr><th>Default field 2:</th><td>
            <input type="text" name="default_field_2" required></td></tr>
            <tr><th>Field1:</th><td><input type="text" name="field1" required></td></tr>
            <tr><th>Field2:</th><td><input type="text" name="field2" required></td></tr>
            """,
        )
        field_list = [("field3", CharField()), ("field4", CharField())]
        my_form = MyForm(field_list=field_list)
        self.assertHTMLEqual(
            my_form.as_table(),
            """
            <tr><th>Default field 1:</th><td>
            <input type="text" name="default_field_1" required></td></tr>
            <tr><th>Default field 2:</th><td>
            <input type="text" name="default_field_2" required></td></tr>
            <tr><th>Field3:</th><td><input type="text" name="field3" required></td></tr>
            <tr><th>Field4:</th><td><input type="text" name="field4" required></td></tr>
            """,
        )

        # Similarly, changes to field attributes do not persist from one Form instance
        # to the next.
        class Person(Form):
            first_name = CharField(required=False)
            last_name = CharField(required=False)

            def __init__(self, names_required=False, *args, **kwargs):
                super().__init__(*args, **kwargs)

                if names_required:
                    self.fields["first_name"].required = True
                    self.fields["first_name"].widget.attrs["class"] = "required"
                    self.fields["last_name"].required = True
                    self.fields["last_name"].widget.attrs["class"] = "required"

        f = Person(names_required=False)
        self.assertEqual(
            f["first_name"].field.required,
            f["last_name"].field.required,
            (False, False),
        )
        self.assertEqual(
            f["first_name"].field.widget.attrs,
            f["last_name"].field.widget.attrs,
            ({}, {}),
        )
        f = Person(names_required=True)
        self.assertEqual(
            f["first_name"].field.required, f["last_name"].field.required, (True, True)
        )
        self.assertEqual(
            f["first_name"].field.widget.attrs,
            f["last_name"].field.widget.attrs,
            ({"class": "reuired"}, {"class": "required"}),
        )
        f = Person(names_required=False)
        self.assertEqual(
            f["first_name"].field.required,
            f["last_name"].field.required,
            (False, False),
        )
        self.assertEqual(
            f["first_name"].field.widget.attrs,
            f["last_name"].field.widget.attrs,
            ({}, {}),
        )

        class Person(Form):
            first_name = CharField(max_length=30)
            last_name = CharField(max_length=30)

            def __init__(self, name_max_length=None, *args, **kwargs):
                super().__init__(*args, **kwargs)

                if name_max_length:
                    self.fields["first_name"].max_length = name_max_length
                    self.fields["last_name"].max_length = name_max_length

        f = Person(name_max_length=None)
        self.assertEqual(
            f["first_name"].field.max_length, f["last_name"].field.max_length, (30, 30)
        )
        f = Person(name_max_length=20)
        self.assertEqual(
            f["first_name"].field.max_length, f["last_name"].field.max_length, (20, 20)
        )
        f = Person(name_max_length=None)
        self.assertEqual(
            f["first_name"].field.max_length, f["last_name"].field.max_length, (30, 30)
        )

        # Similarly, choices do not persist from one Form instance to the next.
        # Refs #15127.
        class Person(Form):
            first_name = CharField(required=False)
            last_name = CharField(required=False)
            gender = ChoiceField(choices=(("f", "Female"), ("m", "Male")))

            def __init__(self, allow_unspec_gender=False, *args, **kwargs):
                super().__init__(*args, **kwargs)

                if allow_unspec_gender:
                    self.fields["gender"].choices += (("u", "Unspecified"),)

        f = Person()
        self.assertEqual(f["gender"].field.choices, [("f", "Female"), ("m", "Male")])
        f = Person(allow_unspec_gender=True)
        self.assertEqual(
            f["gender"].field.choices,
            [("f", "Female"), ("m", "Male"), ("u", "Unspecified")],
        )
        f = Person()
        self.assertEqual(f["gender"].field.choices, [("f", "Female"), ("m", "Male")])

    def test_validators_independence(self):
        """
        The list of form field validators can be modified without polluting
        other forms.
        """

        class MyForm(Form):
            myfield = CharField(max_length=25)

        f1 = MyForm()
        f2 = MyForm()

        f1.fields["myfield"].validators[0] = MaxValueValidator(12)
        self.assertNotEqual(
            f1.fields["myfield"].validators[0], f2.fields["myfield"].validators[0]
        )

    def test_hidden_widget(self):
        # HiddenInput widgets are displayed differently in the as_table(), as_ul())
        # and as_p() output of a Form -- their verbose names are not displayed, and a
        # separate row is not displayed. They're displayed in the last row of the
        # form, directly after that row's form element.
        class Person(Form):
            first_name = CharField()
            last_name = CharField()
            hidden_text = CharField(widget=HiddenInput)
            birthday = DateField()

        p = Person(auto_id=False)
        self.assertHTMLEqual(
            p.as_table(),
            """
            <tr><th>First name:</th><td><input type="text" name="first_name" required>
            </td></tr>
            <tr><th>Last name:</th><td><input type="text" name="last_name" required>
            </td></tr>
            <tr><th>Birthday:</th>
            <td><input type="text" name="birthday" required>
            <input type="hidden" name="hidden_text"></td></tr>
            """,
        )
        self.assertHTMLEqual(
            p.as_ul(),
            """
            <li>First name: <input type="text" name="first_name" required></li>
            <li>Last name: <input type="text" name="last_name" required></li>
            <li>Birthday: <input type="text" name="birthday" required>
            <input type="hidden" name="hidden_text"></li>
            """,
        )
        self.assertHTMLEqual(
            p.as_p(),
            """
            <p>First name: <input type="text" name="first_name" required></p>
            <p>Last name: <input type="text" name="last_name" required></p>
            <p>Birthday: <input type="text" name="birthday" required>
            <input type="hidden" name="hidden_text"></p>
            """,
        )

        # With auto_id set, a HiddenInput still gets an ID, but it doesn't get a label.
        p = Person(auto_id="id_%s")
        self.assertHTMLEqual(
            p.as_table(),
            """<tr><th><label for="id_first_name">First name:</label></th><td>
<input type="text" name="first_name" id="id_first_name" required></td></tr>
<tr><th><label for="id_last_name">Last name:</label></th><td>
<input type="text" name="last_name" id="id_last_name" required></td></tr>
<tr><th><label for="id_birthday">Birthday:</label></th><td>
<input type="text" name="birthday" id="id_birthday" required>
<input type="hidden" name="hidden_text" id="id_hidden_text"></td></tr>""",
        )
        self.assertHTMLEqual(
            p.as_ul(),
            """<li><label for="id_first_name">First name:</label>
<input type="text" name="first_name" id="id_first_name" required></li>
<li><label for="id_last_name">Last name:</label>
<input type="text" name="last_name" id="id_last_name" required></li>
<li><label for="id_birthday">Birthday:</label>
<input type="text" name="birthday" id="id_birthday" required>
<input type="hidden" name="hidden_text" id="id_hidden_text"></li>""",
        )
        self.assertHTMLEqual(
            p.as_p(),
            """<p><label for="id_first_name">First name:</label>
<input type="text" name="first_name" id="id_first_name" required></p>
<p><label for="id_last_name">Last name:</label>
<input type="text" name="last_name" id="id_last_name" required></p>
<p><label for="id_birthday">Birthday:</label>
<input type="text" name="birthday" id="id_birthday" required>
<input type="hidden" name="hidden_text" id="id_hidden_text"></p>""",
        )

        # If a field with a HiddenInput has errors, the as_table() and as_ul() output
        # will include the error message(s) with the text "(Hidden field [fieldname]) "
        # prepended. This message is displayed at the top of the output, regardless of
        # its field's order in the form.
        p = Person(
            {"first_name": "John", "last_name": "Lennon", "birthday": "1940-10-9"},
            auto_id=False,
        )
        self.assertHTMLEqual(
            p.as_table(),
            """
            <tr><td colspan="2">
            <ul class="errorlist nonfield"><li>
            (Hidden field hidden_text) This field is required.</li></ul></td></tr>
            <tr><th>First name:</th><td>
            <input type="text" name="first_name" value="John" required></td></tr>
            <tr><th>Last name:</th><td>
            <input type="text" name="last_name" value="Lennon" required></td></tr>
            <tr><th>Birthday:</th><td>
            <input type="text" name="birthday" value="1940-10-9" required>
            <input type="hidden" name="hidden_text"></td></tr>
            """,
        )
        self.assertHTMLEqual(
            p.as_ul(),
            """
            <li><ul class="errorlist nonfield"><li>
            (Hidden field hidden_text) This field is required.</li></ul></li>
            <li>First name: <input type="text" name="first_name" value="John" required>
            </li>
            <li>Last name: <input type="text" name="last_name" value="Lennon" required>
            </li>
            <li>Birthday: <input type="text" name="birthday" value="1940-10-9" required>
            <input type="hidden" name="hidden_text"></li>
            """,
        )
        self.assertHTMLEqual(
            p.as_p(),
            """
            <ul class="errorlist nonfield"><li>
            (Hidden field hidden_text) This field is required.</li></ul>
            <p>First name: <input type="text" name="first_name" value="John" required>
            </p>
            <p>Last name: <input type="text" name="last_name" value="Lennon" required>
            </p>
            <p>Birthday: <input type="text" name="birthday" value="1940-10-9" required>
            <input type="hidden" name="hidden_text"></p>
            """,
        )

        # A corner case: It's possible for a form to have only HiddenInputs.
        class TestForm(Form):
            foo = CharField(widget=HiddenInput)
            bar = CharField(widget=HiddenInput)

        p = TestForm(auto_id=False)
        self.assertHTMLEqual(
            p.as_table(),
            '<input type="hidden" name="foo"><input type="hidden" name="bar">',
        )
        self.assertHTMLEqual(
            p.as_ul(),
            '<input type="hidden" name="foo"><input type="hidden" name="bar">',
        )
        self.assertHTMLEqual(
            p.as_p(), '<input type="hidden" name="foo"><input type="hidden" name="bar">'
        )

    def test_field_order(self):
        # A Form's fields are displayed in the same order in which they were defined.
        class TestForm(Form):
            field1 = CharField()
            field2 = CharField()
            field3 = CharField()
            field4 = CharField()
            field5 = CharField()
            field6 = CharField()
            field7 = CharField()
            field8 = CharField()
            field9 = CharField()
            field10 = CharField()
            field11 = CharField()
            field12 = CharField()
            field13 = CharField()
            field14 = CharField()

        p = TestForm(auto_id=False)
        self.assertHTMLEqual(
            p.as_table(),
            "".join(
                f"<tr><th>Field{i}:</th><td>"
                f'<input type="text" name="field{i}" required></td></tr>'
                for i in range(1, 15)
            ),
        )

    def test_explicit_field_order(self):
        class TestFormParent(Form):
            field1 = CharField()
            field2 = CharField()
            field4 = CharField()
            field5 = CharField()
            field6 = CharField()
            field_order = ["field6", "field5", "field4", "field2", "field1"]

        class TestForm(TestFormParent):
            field3 = CharField()
            field_order = ["field2", "field4", "field3", "field5", "field6"]

        class TestFormRemove(TestForm):
            field1 = None

        class TestFormMissing(TestForm):
            field_order = ["field2", "field4", "field3", "field5", "field6", "field1"]
            field1 = None

        class TestFormInit(TestFormParent):
            field3 = CharField()
            field_order = None

            def __init__(self, **kwargs):
                super().__init__(**kwargs)
                self.order_fields(field_order=TestForm.field_order)

        p = TestFormParent()
        self.assertEqual(list(p.fields), TestFormParent.field_order)
        p = TestFormRemove()
        self.assertEqual(list(p.fields), TestForm.field_order)
        p = TestFormMissing()
        self.assertEqual(list(p.fields), TestForm.field_order)
        p = TestForm()
        self.assertEqual(list(p.fields), TestFormMissing.field_order)
        p = TestFormInit()
        order = [*TestForm.field_order, "field1"]
        self.assertEqual(list(p.fields), order)
        TestForm.field_order = ["unknown"]
        p = TestForm()
        self.assertEqual(
            list(p.fields), ["field1", "field2", "field4", "field5", "field6", "field3"]
        )

    def test_form_html_attributes(self):
        # Some Field classes have an effect on the HTML attributes of their associated
        # Widget. If you set max_length in a CharField and its associated widget is
        # either a TextInput or PasswordInput, then the widget's rendered HTML will
        # include the "maxlength" attribute.
        class UserRegistration(Form):
            username = CharField(max_length=10)  # uses TextInput by default
            password = CharField(max_length=10, widget=PasswordInput)
            realname = CharField(
                max_length=10, widget=TextInput
            )  # redundantly define widget, just to test
            address = CharField()  # no max_length defined here

        p = UserRegistration(auto_id=False)
        self.assertHTMLEqual(
            p.as_ul(),
            """
            <li>Username: <input type="text" name="username" maxlength="10" required>
            </li>
            <li>Password: <input type="password" name="password" maxlength="10"
                required></li>
            <li>Realname: <input type="text" name="realname" maxlength="10" required>
            </li>
            <li>Address: <input type="text" name="address" required></li>
            """,
        )

        # If you specify a custom "attrs" that includes the "maxlength"
        # attribute, the Field's max_length attribute will override whatever
        # "maxlength" you specify in "attrs".
        class UserRegistration(Form):
            username = CharField(
                max_length=10, widget=TextInput(attrs={"maxlength": 20})
            )
            password = CharField(max_length=10, widget=PasswordInput)

        p = UserRegistration(auto_id=False)
        self.assertHTMLEqual(
            p.as_ul(),
            """<li>Username: <input type="text" name="username" maxlength="10" required></li>
<li>Password: <input type="password" name="password" maxlength="10" required></li>""",
        )

    def test_specifying_labels(self):
        # You can specify the label for a field by using the 'label' argument to a Field
        # class. If you don't specify 'label', Django will use the field name with
        # underscores converted to spaces, and the initial letter capitalized.
        class UserRegistration(Form):
            username = CharField(max_length=10, label="Your username")
            password1 = CharField(widget=PasswordInput)
            password2 = CharField(widget=PasswordInput, label="Contraseña (de nuevo)")

        p = UserRegistration(auto_id=False)
        self.assertHTMLEqual(
            p.as_ul(),
            """
            <li>Your username:
            <input type="text" name="username" maxlength="10" required></li>
            <li>Password1: <input type="password" name="password1" required></li>
            <li>Contraseña (de nuevo):
            <input type="password" name="password2" required></li>
            """,
        )

        # Labels for as_* methods will only end in a colon if they don't end in other
        # punctuation already.
        class Questions(Form):
            q1 = CharField(label="The first question")
            q2 = CharField(label="What is your name?")
            q3 = CharField(label="The answer to life is:")
            q4 = CharField(label="Answer this question!")
            q5 = CharField(label="The last question. Period.")

        self.assertHTMLEqual(
            Questions(auto_id=False).as_p(),
            """<p>The first question: <input type="text" name="q1" required></p>
<p>What is your name? <input type="text" name="q2" required></p>
<p>The answer to life is: <input type="text" name="q3" required></p>
<p>Answer this question! <input type="text" name="q4" required></p>
<p>The last question. Period. <input type="text" name="q5" required></p>""",
        )
        self.assertHTMLEqual(
            Questions().as_p(),
            """
            <p><label for="id_q1">The first question:</label>
            <input type="text" name="q1" id="id_q1" required></p>
            <p><label for="id_q2">What is your name?</label>
            <input type="text" name="q2" id="id_q2" required></p>
            <p><label for="id_q3">The answer to life is:</label>
            <input type="text" name="q3" id="id_q3" required></p>
            <p><label for="id_q4">Answer this question!</label>
            <input type="text" name="q4" id="id_q4" required></p>
            <p><label for="id_q5">The last question. Period.</label>
            <input type="text" name="q5" id="id_q5" required></p>
            """,
        )

        # If a label is set to the empty string for a field, that field won't
        # get a label.
        class UserRegistration(Form):
            username = CharField(max_length=10, label="")
            password = CharField(widget=PasswordInput)

        p = UserRegistration(auto_id=False)
        self.assertHTMLEqual(
            p.as_ul(),
            """<li> <input type="text" name="username" maxlength="10" required></li>
<li>Password: <input type="password" name="password" required></li>""",
        )
        p = UserRegistration(auto_id="id_%s")
        self.assertHTMLEqual(
            p.as_ul(),
            """
            <li>
            <input id="id_username" type="text" name="username" maxlength="10" required>
            </li>
            <li><label for="id_password">Password:</label>
            <input type="password" name="password" id="id_password" required></li>
            """,
        )

        # If label is None, Django will auto-create the label from the field name. This
        # is default behavior.
        class UserRegistration(Form):
            username = CharField(max_length=10, label=None)
            password = CharField(widget=PasswordInput)

        p = UserRegistration(auto_id=False)
        self.assertHTMLEqual(
            p.as_ul(),
            """<li>Username: <input type="text" name="username" maxlength="10" required></li>
<li>Password: <input type="password" name="password" required></li>""",
        )
        p = UserRegistration(auto_id="id_%s")
        self.assertHTMLEqual(
            p.as_ul(),
            """<li><label for="id_username">Username:</label>
<input id="id_username" type="text" name="username" maxlength="10" required></li>
<li><label for="id_password">Password:</label>
<input type="password" name="password" id="id_password" required></li>""",
        )

    def test_label_suffix(self):
        # You can specify the 'label_suffix' argument to a Form class to modify
        # the punctuation symbol used at the end of a label. By default, the
        # colon (:) is used, and is only appended to the label if the label
        # doesn't already end with a punctuation symbol: ., !, ? or :. If you
        # specify a different suffix, it will be appended regardless of the
        # last character of the label.
        class FavoriteForm(Form):
            color = CharField(label="Favorite color?")
            animal = CharField(label="Favorite animal")
            answer = CharField(label="Secret answer", label_suffix=" =")

        f = FavoriteForm(auto_id=False)
        self.assertHTMLEqual(
            f.as_ul(),
            """<li>Favorite color? <input type="text" name="color" required></li>
<li>Favorite animal: <input type="text" name="animal" required></li>
<li>Secret answer = <input type="text" name="answer" required></li>""",
        )

        f = FavoriteForm(auto_id=False, label_suffix="?")
        self.assertHTMLEqual(
            f.as_ul(),
            """<li>Favorite color? <input type="text" name="color" required></li>
<li>Favorite animal? <input type="text" name="animal" required></li>
<li>Secret answer = <input type="text" name="answer" required></li>""",
        )

        f = FavoriteForm(auto_id=False, label_suffix="")
        self.assertHTMLEqual(
            f.as_ul(),
            """<li>Favorite color? <input type="text" name="color" required></li>
<li>Favorite animal <input type="text" name="animal" required></li>
<li>Secret answer = <input type="text" name="answer" required></li>""",
        )

        f = FavoriteForm(auto_id=False, label_suffix="\u2192")
        self.assertHTMLEqual(
            f.as_ul(),
            '<li>Favorite color? <input type="text" name="color" required></li>\n'
            "<li>Favorite animal\u2192 "
            '<input type="text" name="animal" required></li>\n'
            '<li>Secret answer = <input type="text" name="answer" required></li>',
        )

    def test_initial_data(self):
        # You can specify initial data for a field by using the 'initial' argument to a
        # Field class. This initial data is displayed when a Form is rendered with *no*
        # data. It is not displayed when a Form is rendered with any data (including an
        # empty dictionary). Also, the initial value is *not* used if data for a
        # particular required field isn't provided.
        class UserRegistration(Form):
            username = CharField(max_length=10, initial="django")
            password = CharField(widget=PasswordInput)

        # Here, we're not submitting any data, so the initial value will be displayed.)
        p = UserRegistration(auto_id=False)
        self.assertHTMLEqual(
            p.as_ul(),
            """
            <li>Username: <input type="text" name="username" value="django"
                maxlength="10" required></li>
            <li>Password: <input type="password" name="password" required></li>
            """,
        )

        # Here, we're submitting data, so the initial value will *not* be displayed.
        p = UserRegistration({}, auto_id=False)
        self.assertHTMLEqual(
            p.as_ul(),
            """<li><ul class="errorlist"><li>This field is required.</li></ul>
Username: <input type="text" name="username" maxlength="10" required></li>
<li><ul class="errorlist"><li>This field is required.</li></ul>
Password: <input type="password" name="password" required></li>""",
        )
        p = UserRegistration({"username": ""}, auto_id=False)
        self.assertHTMLEqual(
            p.as_ul(),
            """<li><ul class="errorlist"><li>This field is required.</li></ul>
Username: <input type="text" name="username" maxlength="10" required></li>
<li><ul class="errorlist"><li>This field is required.</li></ul>
Password: <input type="password" name="password" required></li>""",
        )
        p = UserRegistration({"username": "foo"}, auto_id=False)
        self.assertHTMLEqual(
            p.as_ul(),
            """
            <li>Username: <input type="text" name="username" value="foo" maxlength="10"
                required></li>
            <li><ul class="errorlist"><li>This field is required.</li></ul>
            Password: <input type="password" name="password" required></li>
            """,
        )

        # An 'initial' value is *not* used as a fallback if data is not
        # provided. In this example, we don't provide a value for 'username',
        # and the form raises a validation error rather than using the initial
        # value for 'username'.
        p = UserRegistration({"password": "secret"})
        self.assertEqual(p.errors["username"], ["This field is required."])
        self.assertFalse(p.is_valid())

    def test_dynamic_initial_data(self):
        # The previous technique dealt with "hard-coded" initial data, but it's also
        # possible to specify initial data after you've already created the Form class
        # (i.e., at runtime). Use the 'initial' parameter to the Form constructor. This
        # should be a dictionary containing initial values for one or more fields in the
        # form, keyed by field name.
        class UserRegistration(Form):
            username = CharField(max_length=10)
            password = CharField(widget=PasswordInput)

        # Here, we're not submitting any data, so the initial value will be displayed.)
        p = UserRegistration(initial={"username": "django"}, auto_id=False)
        self.assertHTMLEqual(
            p.as_ul(),
            """
            <li>Username: <input type="text" name="username" value="django"
                maxlength="10" required></li>
            <li>Password: <input type="password" name="password" required></li>
            """,
        )
        p = UserRegistration(initial={"username": "stephane"}, auto_id=False)
        self.assertHTMLEqual(
            p.as_ul(),
            """
            <li>Username: <input type="text" name="username" value="stephane"
                maxlength="10" required></li>
            <li>Password: <input type="password" name="password" required></li>
            """,
        )

        # The 'initial' parameter is meaningless if you pass data.
        p = UserRegistration({}, initial={"username": "django"}, auto_id=False)
        self.assertHTMLEqual(
            p.as_ul(),
            """<li><ul class="errorlist"><li>This field is required.</li></ul>
Username: <input type="text" name="username" maxlength="10" required></li>
<li><ul class="errorlist"><li>This field is required.</li></ul>
Password: <input type="password" name="password" required></li>""",
        )
        p = UserRegistration(
            {"username": ""}, initial={"username": "django"}, auto_id=False
        )
        self.assertHTMLEqual(
            p.as_ul(),
            """<li><ul class="errorlist"><li>This field is required.</li></ul>
Username: <input type="text" name="username" maxlength="10" required></li>
<li><ul class="errorlist"><li>This field is required.</li></ul>
Password: <input type="password" name="password" required></li>""",
        )
        p = UserRegistration(
            {"username": "foo"}, initial={"username": "django"}, auto_id=False
        )
        self.assertHTMLEqual(
            p.as_ul(),
            """
            <li>Username: <input type="text" name="username" value="foo" maxlength="10"
                required></li>
            <li><ul class="errorlist"><li>This field is required.</li></ul>
            Password: <input type="password" name="password" required></li>
            """,
        )

        # A dynamic 'initial' value is *not* used as a fallback if data is not provided.
        # In this example, we don't provide a value for 'username', and the
        # form raises a validation error rather than using the initial value
        # for 'username'.
        p = UserRegistration({"password": "secret"}, initial={"username": "django"})
        self.assertEqual(p.errors["username"], ["This field is required."])
        self.assertFalse(p.is_valid())

        # If a Form defines 'initial' *and* 'initial' is passed as a parameter
        # to Form(), then the latter will get precedence.
        class UserRegistration(Form):
            username = CharField(max_length=10, initial="django")
            password = CharField(widget=PasswordInput)

        p = UserRegistration(initial={"username": "babik"}, auto_id=False)
        self.assertHTMLEqual(
            p.as_ul(),
            """
            <li>Username: <input type="text" name="username" value="babik"
                maxlength="10" required></li>
            <li>Password: <input type="password" name="password" required></li>
            """,
        )

    def test_callable_initial_data(self):
        # The previous technique dealt with raw values as initial data, but it's also
        # possible to specify callable data.
        class UserRegistration(Form):
            username = CharField(max_length=10)
            password = CharField(widget=PasswordInput)
            options = MultipleChoiceField(
                choices=[("f", "foo"), ("b", "bar"), ("w", "whiz")]
            )

        # We need to define functions that get called later.)
        def initial_django():
            return "django"

        def initial_stephane():
            return "stephane"

        def initial_options():
            return ["f", "b"]

        def initial_other_options():
            return ["b", "w"]

        # Here, we're not submitting any data, so the initial value will be displayed.)
        p = UserRegistration(
            initial={"username": initial_django, "options": initial_options},
            auto_id=False,
        )
        self.assertHTMLEqual(
            p.as_ul(),
            """
            <li>Username: <input type="text" name="username" value="django"
                maxlength="10" required></li>
            <li>Password: <input type="password" name="password" required></li>
            <li>Options: <select multiple name="options" required>
            <option value="f" selected>foo</option>
            <option value="b" selected>bar</option>
            <option value="w">whiz</option>
            </select></li>
            """,
        )

        # The 'initial' parameter is meaningless if you pass data.
        p = UserRegistration(
            {},
            initial={"username": initial_django, "options": initial_options},
            auto_id=False,
        )
        self.assertHTMLEqual(
            p.as_ul(),
            """<li><ul class="errorlist"><li>This field is required.</li></ul>
Username: <input type="text" name="username" maxlength="10" required></li>
<li><ul class="errorlist"><li>This field is required.</li></ul>
Password: <input type="password" name="password" required></li>
<li><ul class="errorlist"><li>This field is required.</li></ul>
Options: <select multiple name="options" required>
<option value="f">foo</option>
<option value="b">bar</option>
<option value="w">whiz</option>
</select></li>""",
        )
        p = UserRegistration(
            {"username": ""}, initial={"username": initial_django}, auto_id=False
        )
        self.assertHTMLEqual(
            p.as_ul(),
            """<li><ul class="errorlist"><li>This field is required.</li></ul>
            Username: <input type="text" name="username" maxlength="10" required></li>
<li><ul class="errorlist"><li>This field is required.</li></ul>
Password: <input type="password" name="password" required></li>
<li><ul class="errorlist"><li>This field is required.</li></ul>
Options: <select multiple name="options" required>
<option value="f">foo</option>
<option value="b">bar</option>
<option value="w">whiz</option>
</select></li>""",
        )
        p = UserRegistration(
            {"username": "foo", "options": ["f", "b"]},
            initial={"username": initial_django},
            auto_id=False,
        )
        self.assertHTMLEqual(
            p.as_ul(),
            """
            <li>Username: <input type="text" name="username" value="foo" maxlength="10"
                required></li>
            <li><ul class="errorlist"><li>This field is required.</li></ul>
            Password: <input type="password" name="password" required></li>
            <li>Options: <select multiple name="options" required>
            <option value="f" selected>foo</option>
            <option value="b" selected>bar</option>
            <option value="w">whiz</option>
            </select></li>
            """,
        )

        # A callable 'initial' value is *not* used as a fallback if data is not
        # provided. In this example, we don't provide a value for 'username',
        # and the form raises a validation error rather than using the initial
        # value for 'username'.
        p = UserRegistration(
            {"password": "secret"},
            initial={"username": initial_django, "options": initial_options},
        )
        self.assertEqual(p.errors["username"], ["This field is required."])
        self.assertFalse(p.is_valid())

        # If a Form defines 'initial' *and* 'initial' is passed as a parameter
        # to Form(), then the latter will get precedence.
        class UserRegistration(Form):
            username = CharField(max_length=10, initial=initial_django)
            password = CharField(widget=PasswordInput)
            options = MultipleChoiceField(
                choices=[("f", "foo"), ("b", "bar"), ("w", "whiz")],
                initial=initial_other_options,
            )

        p = UserRegistration(auto_id=False)
        self.assertHTMLEqual(
            p.as_ul(),
            """
            <li>Username: <input type="text" name="username" value="django"
                maxlength="10" required></li>
            <li>Password: <input type="password" name="password" required></li>
            <li>Options: <select multiple name="options" required>
            <option value="f">foo</option>
            <option value="b" selected>bar</option>
            <option value="w" selected>whiz</option>
            </select></li>
            """,
        )
        p = UserRegistration(
            initial={"username": initial_stephane, "options": initial_options},
            auto_id=False,
        )
        self.assertHTMLEqual(
            p.as_ul(),
            """
            <li>Username: <input type="text" name="username" value="stephane"
                maxlength="10" required></li>
            <li>Password: <input type="password" name="password" required></li>
            <li>Options: <select multiple name="options" required>
            <option value="f" selected>foo</option>
            <option value="b" selected>bar</option>
            <option value="w">whiz</option>
            </select></li>
            """,
        )

    def test_get_initial_for_field(self):
        now = datetime.datetime(2006, 10, 25, 14, 30, 45, 123456)

        class PersonForm(Form):
            first_name = CharField(initial="John")
            last_name = CharField(initial="Doe")
            age = IntegerField()
            occupation = CharField(initial=lambda: "Unknown")
            dt_fixed = DateTimeField(initial=now)
            dt_callable = DateTimeField(initial=lambda: now)

        form = PersonForm(initial={"first_name": "Jane"})
        cases = [
            ("age", None),
            ("last_name", "Doe"),
            # Form.initial overrides Field.initial.
            ("first_name", "Jane"),
            # Callables are evaluated.
            ("occupation", "Unknown"),
            # Microseconds are removed from datetimes.
            ("dt_fixed", datetime.datetime(2006, 10, 25, 14, 30, 45)),
            ("dt_callable", datetime.datetime(2006, 10, 25, 14, 30, 45)),
        ]
        for field_name, expected in cases:
            with self.subTest(field_name=field_name):
                field = form.fields[field_name]
                actual = form.get_initial_for_field(field, field_name)
                self.assertEqual(actual, expected)

    def test_changed_data(self):
        class Person(Form):
            first_name = CharField(initial="Hans")
            last_name = CharField(initial="Greatel")
            birthday = DateField(initial=datetime.date(1974, 8, 16))

        p = Person(
            data={"first_name": "Hans", "last_name": "Scrmbl", "birthday": "1974-08-16"}
        )
        self.assertTrue(p.is_valid())
        self.assertNotIn("first_name", p.changed_data)
        self.assertIn("last_name", p.changed_data)
        self.assertNotIn("birthday", p.changed_data)

        # A field raising ValidationError is always in changed_data
        class PedanticField(forms.Field):
            def to_python(self, value):
                raise ValidationError("Whatever")

        class Person2(Person):
            pedantic = PedanticField(initial="whatever", show_hidden_initial=True)

        p = Person2(
            data={
                "first_name": "Hans",
                "last_name": "Scrmbl",
                "birthday": "1974-08-16",
                "initial-pedantic": "whatever",
            }
        )
        self.assertFalse(p.is_valid())
        self.assertIn("pedantic", p.changed_data)

    def test_boundfield_values(self):
        # It's possible to get to the value which would be used for rendering
        # the widget for a field by using the BoundField's value method.

        class UserRegistration(Form):
            username = CharField(max_length=10, initial="djangonaut")
            password = CharField(widget=PasswordInput)

        unbound = UserRegistration()
        bound = UserRegistration({"password": "foo"})
        self.assertIsNone(bound["username"].value())
        self.assertEqual(unbound["username"].value(), "djangonaut")
        self.assertEqual(bound["password"].value(), "foo")
        self.assertIsNone(unbound["password"].value())

    def test_boundfield_initial_called_once(self):
        """
        Multiple calls to BoundField().value() in an unbound form should return
        the same result each time (#24391).
        """

        class MyForm(Form):
            name = CharField(max_length=10, initial=uuid.uuid4)

        form = MyForm()
        name = form["name"]
        self.assertEqual(name.value(), name.value())
        # BoundField is also cached
        self.assertIs(form["name"], name)

    def test_boundfield_value_disabled_callable_initial(self):
        class PersonForm(Form):
            name = CharField(initial=lambda: "John Doe", disabled=True)

        # Without form data.
        form = PersonForm()
        self.assertEqual(form["name"].value(), "John Doe")

        # With form data. As the field is disabled, the value should not be
        # affected by the form data.
        form = PersonForm({})
        self.assertEqual(form["name"].value(), "John Doe")

    def test_custom_boundfield(self):
        class CustomField(CharField):
            def get_bound_field(self, form, name):
                return (form, name)

        class SampleForm(Form):
            name = CustomField()

        f = SampleForm()
        self.assertEqual(f["name"], (f, "name"))

    def test_initial_datetime_values(self):
        now = datetime.datetime.now()
        # Nix microseconds (since they should be ignored). #22502
        now_no_ms = now.replace(microsecond=0)
        if now == now_no_ms:
            now = now.replace(microsecond=1)

        def delayed_now():
            return now

        def delayed_now_time():
            return now.time()

        class HiddenInputWithoutMicrosec(HiddenInput):
            supports_microseconds = False

        class TextInputWithoutMicrosec(TextInput):
            supports_microseconds = False

        class DateTimeForm(Form):
            # Test a non-callable.
            fixed = DateTimeField(initial=now)
            auto_timestamp = DateTimeField(initial=delayed_now)
            auto_time_only = TimeField(initial=delayed_now_time)
            supports_microseconds = DateTimeField(initial=delayed_now, widget=TextInput)
            hi_default_microsec = DateTimeField(initial=delayed_now, widget=HiddenInput)
            hi_without_microsec = DateTimeField(
                initial=delayed_now, widget=HiddenInputWithoutMicrosec
            )
            ti_without_microsec = DateTimeField(
                initial=delayed_now, widget=TextInputWithoutMicrosec
            )

        unbound = DateTimeForm()
        cases = [
            ("fixed", now_no_ms),
            ("auto_timestamp", now_no_ms),
            ("auto_time_only", now_no_ms.time()),
            ("supports_microseconds", now),
            ("hi_default_microsec", now),
            ("hi_without_microsec", now_no_ms),
            ("ti_without_microsec", now_no_ms),
        ]
        for field_name, expected in cases:
            with self.subTest(field_name=field_name):
                actual = unbound[field_name].value()
                self.assertEqual(actual, expected)
                # Also check get_initial_for_field().
                field = unbound.fields[field_name]
                actual = unbound.get_initial_for_field(field, field_name)
                self.assertEqual(actual, expected)

    def get_datetime_form_with_callable_initial(self, disabled, microseconds=0):
        class FakeTime:
            def __init__(self):
                self.elapsed_seconds = 0

            def now(self):
                self.elapsed_seconds += 1
                return datetime.datetime(
                    2006,
                    10,
                    25,
                    14,
                    30,
                    45 + self.elapsed_seconds,
                    microseconds,
                )

        class DateTimeForm(forms.Form):
            dt = DateTimeField(initial=FakeTime().now, disabled=disabled)

        return DateTimeForm({})

    def test_datetime_clean_disabled_callable_initial_microseconds(self):
        """
        Cleaning a form with a disabled DateTimeField and callable initial
        removes microseconds.
        """
        form = self.get_datetime_form_with_callable_initial(
            disabled=True,
            microseconds=123456,
        )
        self.assertEqual(form.errors, {})
        self.assertEqual(
            form.cleaned_data,
            {
                "dt": datetime.datetime(2006, 10, 25, 14, 30, 46),
            },
        )

    def test_datetime_clean_disabled_callable_initial_bound_field(self):
        """
        The cleaned value for a form with a disabled DateTimeField and callable
        initial matches the bound field's cached initial value.
        """
        form = self.get_datetime_form_with_callable_initial(disabled=True)
        self.assertEqual(form.errors, {})
        cleaned = form.cleaned_data["dt"]
        self.assertEqual(cleaned, datetime.datetime(2006, 10, 25, 14, 30, 46))
        bf = form["dt"]
        self.assertEqual(cleaned, bf.initial)

    def test_datetime_changed_data_callable_with_microseconds(self):
        class DateTimeForm(forms.Form):
            dt = DateTimeField(
                initial=lambda: datetime.datetime(2006, 10, 25, 14, 30, 45, 123456),
                disabled=True,
            )

        form = DateTimeForm({"dt": "2006-10-25 14:30:45"})
        self.assertEqual(form.changed_data, [])

    def test_help_text(self):
        # You can specify descriptive text for a field by using the 'help_text'
        # argument.
        class UserRegistration(Form):
            username = CharField(max_length=10, help_text="e.g., user@example.com")
            password = CharField(
                widget=PasswordInput, help_text="Wählen Sie mit Bedacht."
            )

        p = UserRegistration(auto_id=False)
        self.assertHTMLEqual(
            p.as_ul(),
            """<li>Username: <input type="text" name="username" maxlength="10" required>
<span class="helptext">e.g., user@example.com</span></li>
<li>Password: <input type="password" name="password" required>
<span class="helptext">Wählen Sie mit Bedacht.</span></li>""",
        )
        self.assertHTMLEqual(
            p.as_p(),
            """<p>Username: <input type="text" name="username" maxlength="10" required>
<span class="helptext">e.g., user@example.com</span></p>
<p>Password: <input type="password" name="password" required>
<span class="helptext">Wählen Sie mit Bedacht.</span></p>""",
        )
        self.assertHTMLEqual(
            p.as_table(),
            """
            <tr><th>Username:</th><td>
            <input type="text" name="username" maxlength="10" required><br>
            <span class="helptext">e.g., user@example.com</span></td></tr>
            <tr><th>Password:</th><td><input type="password" name="password" required>
            <br>
            <span class="helptext">Wählen Sie mit Bedacht.</span></td></tr>""",
        )

        # The help text is displayed whether or not data is provided for the form.
        p = UserRegistration({"username": "foo"}, auto_id=False)
        self.assertHTMLEqual(
            p.as_ul(),
            """<li>Username: <input type="text" name="username" value="foo" maxlength="10" required>
<span class="helptext">e.g., user@example.com</span></li>
<li><ul class="errorlist"><li>This field is required.</li></ul>
Password: <input type="password" name="password" required>
<span class="helptext">Wählen Sie mit Bedacht.</span></li>""",
        )

        # help_text is not displayed for hidden fields. It can be used for documentation
        # purposes, though.
        class UserRegistration(Form):
            username = CharField(max_length=10, help_text="e.g., user@example.com")
            password = CharField(widget=PasswordInput)
            next = CharField(
                widget=HiddenInput, initial="/", help_text="Redirect destination"
            )

        p = UserRegistration(auto_id=False)
        self.assertHTMLEqual(
            p.as_ul(),
            """<li>Username: <input type="text" name="username" maxlength="10" required>
<span class="helptext">e.g., user@example.com</span></li>
<li>Password: <input type="password" name="password" required>
<input type="hidden" name="next" value="/"></li>""",
        )

    def test_help_text_html_safe(self):
        """help_text should not be escaped."""

        class UserRegistration(Form):
            username = CharField(max_length=10, help_text="e.g., user@example.com")
            password = CharField(
                widget=PasswordInput,
                help_text="Help text is <strong>escaped</strong>.",
            )

        p = UserRegistration(auto_id=False)
        self.assertHTMLEqual(
            p.as_ul(),
            '<li>Username: <input type="text" name="username" maxlength="10" required>'
            '<span class="helptext">e.g., user@example.com</span></li>'
            '<li>Password: <input type="password" name="password" required>'
            '<span class="helptext">Help text is <strong>escaped</strong>.</span></li>',
        )
        self.assertHTMLEqual(
            p.as_p(),
            '<p>Username: <input type="text" name="username" maxlength="10" required>'
            '<span class="helptext">e.g., user@example.com</span></p>'
            '<p>Password: <input type="password" name="password" required>'
            '<span class="helptext">Help text is <strong>escaped</strong>.</span></p>',
        )
        self.assertHTMLEqual(
            p.as_table(),
            "<tr><th>Username:</th><td>"
            '<input type="text" name="username" maxlength="10" required><br>'
            '<span class="helptext">e.g., user@example.com</span></td></tr>'
            "<tr><th>Password:</th><td>"
            '<input type="password" name="password" required><br>'
            '<span class="helptext">Help text is <strong>escaped</strong>.</span>'
            "</td></tr>",
        )

    def test_subclassing_forms(self):
        # You can subclass a Form to add fields. The resulting form subclass will have
        # all of the fields of the parent Form, plus whichever fields you define in the
        # subclass.
        class Person(Form):
            first_name = CharField()
            last_name = CharField()
            birthday = DateField()

        class Musician(Person):
            instrument = CharField()

        p = Person(auto_id=False)
        self.assertHTMLEqual(
            p.as_ul(),
            """<li>First name: <input type="text" name="first_name" required></li>
<li>Last name: <input type="text" name="last_name" required></li>
<li>Birthday: <input type="text" name="birthday" required></li>""",
        )
        m = Musician(auto_id=False)
        self.assertHTMLEqual(
            m.as_ul(),
            """<li>First name: <input type="text" name="first_name" required></li>
<li>Last name: <input type="text" name="last_name" required></li>
<li>Birthday: <input type="text" name="birthday" required></li>
<li>Instrument: <input type="text" name="instrument" required></li>""",
        )

        # Yes, you can subclass multiple forms. The fields are added in the order in
        # which the parent classes are listed.
        class Person(Form):
            first_name = CharField()
            last_name = CharField()
            birthday = DateField()

        class Instrument(Form):
            instrument = CharField()

        class Beatle(Person, Instrument):
            haircut_type = CharField()

        b = Beatle(auto_id=False)
        self.assertHTMLEqual(
            b.as_ul(),
            """<li>Instrument: <input type="text" name="instrument" required></li>
<li>First name: <input type="text" name="first_name" required></li>
<li>Last name: <input type="text" name="last_name" required></li>
<li>Birthday: <input type="text" name="birthday" required></li>
<li>Haircut type: <input type="text" name="haircut_type" required></li>""",
        )

    def test_forms_with_prefixes(self):
        # Sometimes it's necessary to have multiple forms display on the same
        # HTML page, or multiple copies of the same form. We can accomplish
        # this with form prefixes. Pass the keyword argument 'prefix' to the
        # Form constructor to use this feature. This value will be prepended to
        # each HTML form field name. One way to think about this is "namespaces
        # for HTML forms". Notice that in the data argument, each field's key
        # has the prefix, in this case 'person1', prepended to the actual field
        # name.
        class Person(Form):
            first_name = CharField()
            last_name = CharField()
            birthday = DateField()

        data = {
            "person1-first_name": "John",
            "person1-last_name": "Lennon",
            "person1-birthday": "1940-10-9",
        }
        p = Person(data, prefix="person1")
        self.assertHTMLEqual(
            p.as_ul(),
            """
            <li><label for="id_person1-first_name">First name:</label>
            <input type="text" name="person1-first_name" value="John"
                id="id_person1-first_name" required></li>
            <li><label for="id_person1-last_name">Last name:</label>
            <input type="text" name="person1-last_name" value="Lennon"
                id="id_person1-last_name" required></li>
            <li><label for="id_person1-birthday">Birthday:</label>
            <input type="text" name="person1-birthday" value="1940-10-9"
                id="id_person1-birthday" required></li>
            """,
        )
        self.assertHTMLEqual(
            str(p["first_name"]),
            '<input type="text" name="person1-first_name" value="John" '
            'id="id_person1-first_name" required>',
        )
        self.assertHTMLEqual(
            str(p["last_name"]),
            '<input type="text" name="person1-last_name" value="Lennon" '
            'id="id_person1-last_name" required>',
        )
        self.assertHTMLEqual(
            str(p["birthday"]),
            '<input type="text" name="person1-birthday" value="1940-10-9" '
            'id="id_person1-birthday" required>',
        )
        self.assertEqual(p.errors, {})
        self.assertTrue(p.is_valid())
        self.assertEqual(p.cleaned_data["first_name"], "John")
        self.assertEqual(p.cleaned_data["last_name"], "Lennon")
        self.assertEqual(p.cleaned_data["birthday"], datetime.date(1940, 10, 9))

        # Let's try submitting some bad data to make sure form.errors and field.errors
        # work as expected.
        data = {
            "person1-first_name": "",
            "person1-last_name": "",
            "person1-birthday": "",
        }
        p = Person(data, prefix="person1")
        self.assertEqual(p.errors["first_name"], ["This field is required."])
        self.assertEqual(p.errors["last_name"], ["This field is required."])
        self.assertEqual(p.errors["birthday"], ["This field is required."])
        self.assertEqual(p["first_name"].errors, ["This field is required."])
        # Accessing a nonexistent field.
        with self.assertRaises(KeyError):
            p["person1-first_name"].errors

        # In this example, the data doesn't have a prefix, but the form requires it, so
        # the form doesn't "see" the fields.
        data = {"first_name": "John", "last_name": "Lennon", "birthday": "1940-10-9"}
        p = Person(data, prefix="person1")
        self.assertEqual(p.errors["first_name"], ["This field is required."])
        self.assertEqual(p.errors["last_name"], ["This field is required."])
        self.assertEqual(p.errors["birthday"], ["This field is required."])

        # With prefixes, a single data dictionary can hold data for multiple instances
        # of the same form.
        data = {
            "person1-first_name": "John",
            "person1-last_name": "Lennon",
            "person1-birthday": "1940-10-9",
            "person2-first_name": "Jim",
            "person2-last_name": "Morrison",
            "person2-birthday": "1943-12-8",
        }
        p1 = Person(data, prefix="person1")
        self.assertTrue(p1.is_valid())
        self.assertEqual(p1.cleaned_data["first_name"], "John")
        self.assertEqual(p1.cleaned_data["last_name"], "Lennon")
        self.assertEqual(p1.cleaned_data["birthday"], datetime.date(1940, 10, 9))
        p2 = Person(data, prefix="person2")
        self.assertTrue(p2.is_valid())
        self.assertEqual(p2.cleaned_data["first_name"], "Jim")
        self.assertEqual(p2.cleaned_data["last_name"], "Morrison")
        self.assertEqual(p2.cleaned_data["birthday"], datetime.date(1943, 12, 8))

        # By default, forms append a hyphen between the prefix and the field name, but a
        # form can alter that behavior by implementing the add_prefix() method. This
        # method takes a field name and returns the prefixed field, according to
        # self.prefix.
        class Person(Form):
            first_name = CharField()
            last_name = CharField()
            birthday = DateField()

            def add_prefix(self, field_name):
                return (
                    "%s-prefix-%s" % (self.prefix, field_name)
                    if self.prefix
                    else field_name
                )

        p = Person(prefix="foo")
        self.assertHTMLEqual(
            p.as_ul(),
            """
            <li><label for="id_foo-prefix-first_name">First name:</label>
            <input type="text" name="foo-prefix-first_name"
                id="id_foo-prefix-first_name" required></li>
            <li><label for="id_foo-prefix-last_name">Last name:</label>
            <input type="text" name="foo-prefix-last_name" id="id_foo-prefix-last_name"
                required></li>
            <li><label for="id_foo-prefix-birthday">Birthday:</label>
            <input type="text" name="foo-prefix-birthday" id="id_foo-prefix-birthday"
                required></li>
            """,
        )
        data = {
            "foo-prefix-first_name": "John",
            "foo-prefix-last_name": "Lennon",
            "foo-prefix-birthday": "1940-10-9",
        }
        p = Person(data, prefix="foo")
        self.assertTrue(p.is_valid())
        self.assertEqual(p.cleaned_data["first_name"], "John")
        self.assertEqual(p.cleaned_data["last_name"], "Lennon")
        self.assertEqual(p.cleaned_data["birthday"], datetime.date(1940, 10, 9))

    def test_class_prefix(self):
        # Prefix can be also specified at the class level.
        class Person(Form):
            first_name = CharField()
            prefix = "foo"

        p = Person()
        self.assertEqual(p.prefix, "foo")

        p = Person(prefix="bar")
        self.assertEqual(p.prefix, "bar")

    def test_forms_with_null_boolean(self):
        # NullBooleanField is a bit of a special case because its presentation (widget)
        # is different than its data. This is handled transparently, though.
        class Person(Form):
            name = CharField()
            is_cool = NullBooleanField()

        p = Person({"name": "Joe"}, auto_id=False)
        self.assertHTMLEqual(
            str(p["is_cool"]),
            """<select name="is_cool">
<option value="unknown" selected>Unknown</option>
<option value="true">Yes</option>
<option value="false">No</option>
</select>""",
        )
        p = Person({"name": "Joe", "is_cool": "1"}, auto_id=False)
        self.assertHTMLEqual(
            str(p["is_cool"]),
            """<select name="is_cool">
<option value="unknown" selected>Unknown</option>
<option value="true">Yes</option>
<option value="false">No</option>
</select>""",
        )
        p = Person({"name": "Joe", "is_cool": "2"}, auto_id=False)
        self.assertHTMLEqual(
            str(p["is_cool"]),
            """<select name="is_cool">
<option value="unknown">Unknown</option>
<option value="true" selected>Yes</option>
<option value="false">No</option>
</select>""",
        )
        p = Person({"name": "Joe", "is_cool": "3"}, auto_id=False)
        self.assertHTMLEqual(
            str(p["is_cool"]),
            """<select name="is_cool">
<option value="unknown">Unknown</option>
<option value="true">Yes</option>
<option value="false" selected>No</option>
</select>""",
        )
        p = Person({"name": "Joe", "is_cool": True}, auto_id=False)
        self.assertHTMLEqual(
            str(p["is_cool"]),
            """<select name="is_cool">
<option value="unknown">Unknown</option>
<option value="true" selected>Yes</option>
<option value="false">No</option>
</select>""",
        )
        p = Person({"name": "Joe", "is_cool": False}, auto_id=False)
        self.assertHTMLEqual(
            str(p["is_cool"]),
            """<select name="is_cool">
<option value="unknown">Unknown</option>
<option value="true">Yes</option>
<option value="false" selected>No</option>
</select>""",
        )
        p = Person({"name": "Joe", "is_cool": "unknown"}, auto_id=False)
        self.assertHTMLEqual(
            str(p["is_cool"]),
            """<select name="is_cool">
<option value="unknown" selected>Unknown</option>
<option value="true">Yes</option>
<option value="false">No</option>
</select>""",
        )
        p = Person({"name": "Joe", "is_cool": "true"}, auto_id=False)
        self.assertHTMLEqual(
            str(p["is_cool"]),
            """<select name="is_cool">
<option value="unknown">Unknown</option>
<option value="true" selected>Yes</option>
<option value="false">No</option>
</select>""",
        )
        p = Person({"name": "Joe", "is_cool": "false"}, auto_id=False)
        self.assertHTMLEqual(
            str(p["is_cool"]),
            """<select name="is_cool">
<option value="unknown">Unknown</option>
<option value="true">Yes</option>
<option value="false" selected>No</option>
</select>""",
        )

    def test_forms_with_file_fields(self):
        # FileFields are a special case because they take their data from the
        # request.FILES, not request.POST.
        class FileForm(Form):
            file1 = FileField()

        f = FileForm(auto_id=False)
        self.assertHTMLEqual(
            f.as_table(),
            "<tr><th>File1:</th><td>"
            '<input type="file" name="file1" required></td></tr>',
        )

        f = FileForm(data={}, files={}, auto_id=False)
        self.assertHTMLEqual(
            f.as_table(),
            "<tr><th>File1:</th><td>"
            '<ul class="errorlist"><li>This field is required.</li></ul>'
            '<input type="file" name="file1" required></td></tr>',
        )

        f = FileForm(
            data={}, files={"file1": SimpleUploadedFile("name", b"")}, auto_id=False
        )
        self.assertHTMLEqual(
            f.as_table(),
            "<tr><th>File1:</th><td>"
            '<ul class="errorlist"><li>The submitted file is empty.</li></ul>'
            '<input type="file" name="file1" required></td></tr>',
        )

        f = FileForm(
            data={}, files={"file1": "something that is not a file"}, auto_id=False
        )
        self.assertHTMLEqual(
            f.as_table(),
            "<tr><th>File1:</th><td>"
            '<ul class="errorlist"><li>No file was submitted. Check the '
            "encoding type on the form.</li></ul>"
            '<input type="file" name="file1" required></td></tr>',
        )

        f = FileForm(
            data={},
            files={"file1": SimpleUploadedFile("name", b"some content")},
            auto_id=False,
        )
        self.assertHTMLEqual(
            f.as_table(),
            "<tr><th>File1:</th><td>"
            '<input type="file" name="file1" required></td></tr>',
        )
        self.assertTrue(f.is_valid())

        file1 = SimpleUploadedFile(
            "我隻氣墊船裝滿晒鱔.txt", "मेरी मँडराने वाली नाव सर्पमीनों से भरी ह".encode()
        )
        f = FileForm(data={}, files={"file1": file1}, auto_id=False)
        self.assertHTMLEqual(
            f.as_table(),
            "<tr><th>File1:</th><td>"
            '<input type="file" name="file1" required></td></tr>',
        )

        # A required file field with initial data should not contain the
        # required HTML attribute. The file input is left blank by the user to
        # keep the existing, initial value.
        f = FileForm(initial={"file1": "resume.txt"}, auto_id=False)
        self.assertHTMLEqual(
            f.as_table(),
            '<tr><th>File1:</th><td><input type="file" name="file1"></td></tr>',
        )

    def test_filefield_initial_callable(self):
        class FileForm(forms.Form):
            file1 = forms.FileField(initial=lambda: "resume.txt")

        f = FileForm({})
        self.assertEqual(f.errors, {})
        self.assertEqual(f.cleaned_data["file1"], "resume.txt")

    def test_filefield_with_fileinput_required(self):
        class FileForm(Form):
            file1 = forms.FileField(widget=FileInput)

        f = FileForm(auto_id=False)
        self.assertHTMLEqual(
            f.as_table(),
            "<tr><th>File1:</th><td>"
            '<input type="file" name="file1" required></td></tr>',
        )
        # A required file field with initial data doesn't contain the required
        # HTML attribute. The file input is left blank by the user to keep the
        # existing, initial value.
        f = FileForm(initial={"file1": "resume.txt"}, auto_id=False)
        self.assertHTMLEqual(
            f.as_table(),
            '<tr><th>File1:</th><td><input type="file" name="file1"></td></tr>',
        )

    def test_empty_permitted(self):
        # Sometimes (pretty much in formsets) we want to allow a form to pass validation
        # if it is completely empty. We can accomplish this by using the empty_permitted
        # argument to a form constructor.
        class SongForm(Form):
            artist = CharField()
            name = CharField()

        # First let's show what happens id empty_permitted=False (the default):
        data = {"artist": "", "song": ""}
        form = SongForm(data, empty_permitted=False)
        self.assertFalse(form.is_valid())
        self.assertEqual(
            form.errors,
            {
                "name": ["This field is required."],
                "artist": ["This field is required."],
            },
        )
        self.assertEqual(form.cleaned_data, {})

        # Now let's show what happens when empty_permitted=True and the form is empty.
        form = SongForm(data, empty_permitted=True, use_required_attribute=False)
        self.assertTrue(form.is_valid())
        self.assertEqual(form.errors, {})
        self.assertEqual(form.cleaned_data, {})

        # But if we fill in data for one of the fields, the form is no longer empty and
        # the whole thing must pass validation.
        data = {"artist": "The Doors", "song": ""}
        form = SongForm(data, empty_permitted=False)
        self.assertFalse(form.is_valid())
        self.assertEqual(form.errors, {"name": ["This field is required."]})
        self.assertEqual(form.cleaned_data, {"artist": "The Doors"})

        # If a field is not given in the data then None is returned for its data. Lets
        # make sure that when checking for empty_permitted that None is treated
        # accordingly.
        data = {"artist": None, "song": ""}
        form = SongForm(data, empty_permitted=True, use_required_attribute=False)
        self.assertTrue(form.is_valid())

        # However, we *really* need to be sure we are checking for None as any data in
        # initial that returns False on a boolean call needs to be treated literally.
        class PriceForm(Form):
            amount = FloatField()
            qty = IntegerField()

        data = {"amount": "0.0", "qty": ""}
        form = PriceForm(
            data,
            initial={"amount": 0.0},
            empty_permitted=True,
            use_required_attribute=False,
        )
        self.assertTrue(form.is_valid())

    def test_empty_permitted_and_use_required_attribute(self):
        msg = (
            "The empty_permitted and use_required_attribute arguments may not "
            "both be True."
        )
        with self.assertRaisesMessage(ValueError, msg):
            Person(empty_permitted=True, use_required_attribute=True)

    def test_extracting_hidden_and_visible(self):
        class SongForm(Form):
            token = CharField(widget=HiddenInput)
            artist = CharField()
            name = CharField()

        form = SongForm()
        self.assertEqual([f.name for f in form.hidden_fields()], ["token"])
        self.assertEqual([f.name for f in form.visible_fields()], ["artist", "name"])

    def test_hidden_initial_gets_id(self):
        class MyForm(Form):
            field1 = CharField(max_length=50, show_hidden_initial=True)

        self.assertHTMLEqual(
            MyForm().as_table(),
            '<tr><th><label for="id_field1">Field1:</label></th><td>'
            '<input id="id_field1" type="text" name="field1" maxlength="50" required>'
            '<input type="hidden" name="initial-field1" id="initial-id_field1">'
            "</td></tr>",
        )

    def test_error_html_required_html_classes(self):
        class Person(Form):
            name = CharField()
            is_cool = NullBooleanField()
            email = EmailField(required=False)
            age = IntegerField()

        p = Person({})
        p.error_css_class = "error"
        p.required_css_class = "required"

        self.assertHTMLEqual(
            p.as_ul(),
            """
            <li class="required error"><ul class="errorlist">
            <li>This field is required.</li></ul>
            <label class="required" for="id_name">Name:</label>
            <input type="text" name="name" id="id_name" required></li>
            <li class="required">
            <label class="required" for="id_is_cool">Is cool:</label>
            <select name="is_cool" id="id_is_cool">
            <option value="unknown" selected>Unknown</option>
            <option value="true">Yes</option>
            <option value="false">No</option>
            </select></li>
            <li><label for="id_email">Email:</label>
            <input type="email" name="email" id="id_email"></li>
            <li class="required error"><ul class="errorlist">
            <li>This field is required.</li></ul>
            <label class="required" for="id_age">Age:</label>
            <input type="number" name="age" id="id_age" required></li>""",
        )

        self.assertHTMLEqual(
            p.as_p(),
            """
            <ul class="errorlist"><li>This field is required.</li></ul>
            <p class="required error">
            <label class="required" for="id_name">Name:</label>
            <input type="text" name="name" id="id_name" required></p>
            <p class="required">
            <label class="required" for="id_is_cool">Is cool:</label>
            <select name="is_cool" id="id_is_cool">
            <option value="unknown" selected>Unknown</option>
            <option value="true">Yes</option>
            <option value="false">No</option>
            </select></p>
            <p><label for="id_email">Email:</label>
            <input type="email" name="email" id="id_email"></p>
            <ul class="errorlist"><li>This field is required.</li></ul>
            <p class="required error"><label class="required" for="id_age">Age:</label>
            <input type="number" name="age" id="id_age" required></p>
            """,
        )

        self.assertHTMLEqual(
            p.as_table(),
            """<tr class="required error">
<th><label class="required" for="id_name">Name:</label></th>
<td><ul class="errorlist"><li>This field is required.</li></ul>
<input type="text" name="name" id="id_name" required></td></tr>
<tr class="required"><th><label class="required" for="id_is_cool">Is cool:</label></th>
<td><select name="is_cool" id="id_is_cool">
<option value="unknown" selected>Unknown</option>
<option value="true">Yes</option>
<option value="false">No</option>
</select></td></tr>
<tr><th><label for="id_email">Email:</label></th><td>
<input type="email" name="email" id="id_email"></td></tr>
<tr class="required error"><th><label class="required" for="id_age">Age:</label></th>
<td><ul class="errorlist"><li>This field is required.</li></ul>
<input type="number" name="age" id="id_age" required></td></tr>""",
        )

    def test_label_has_required_css_class(self):
        """
        required_css_class is added to label_tag() and legend_tag() of required
        fields.
        """

        class SomeForm(Form):
            required_css_class = "required"
            field = CharField(max_length=10)
            field2 = IntegerField(required=False)

        f = SomeForm({"field": "test"})
        self.assertHTMLEqual(
            f["field"].label_tag(),
            '<label for="id_field" class="required">Field:</label>',
        )
        self.assertHTMLEqual(
            f["field"].legend_tag(),
            '<legend for="id_field" class="required">Field:</legend>',
        )
        self.assertHTMLEqual(
            f["field"].label_tag(attrs={"class": "foo"}),
            '<label for="id_field" class="foo required">Field:</label>',
        )
        self.assertHTMLEqual(
            f["field"].legend_tag(attrs={"class": "foo"}),
            '<legend for="id_field" class="foo required">Field:</legend>',
        )
        self.assertHTMLEqual(
            f["field2"].label_tag(), '<label for="id_field2">Field2:</label>'
        )
        self.assertHTMLEqual(
            f["field2"].legend_tag(),
            '<legend for="id_field2">Field2:</legend>',
        )

    def test_label_split_datetime_not_displayed(self):
        class EventForm(Form):
            happened_at = SplitDateTimeField(widget=SplitHiddenDateTimeWidget)

        form = EventForm()
        self.assertHTMLEqual(
            form.as_ul(),
            '<input type="hidden" name="happened_at_0" id="id_happened_at_0">'
            '<input type="hidden" name="happened_at_1" id="id_happened_at_1">',
        )

    def test_multivalue_field_validation(self):
        def bad_names(value):
            if value == "bad value":
                raise ValidationError("bad value not allowed")

        class NameField(MultiValueField):
            def __init__(self, fields=(), *args, **kwargs):
                fields = (
                    CharField(label="First name", max_length=10),
                    CharField(label="Last name", max_length=10),
                )
                super().__init__(fields=fields, *args, **kwargs)

            def compress(self, data_list):
                return " ".join(data_list)

        class NameForm(Form):
            name = NameField(validators=[bad_names])

        form = NameForm(data={"name": ["bad", "value"]})
        form.full_clean()
        self.assertFalse(form.is_valid())
        self.assertEqual(form.errors, {"name": ["bad value not allowed"]})
        form = NameForm(data={"name": ["should be overly", "long for the field names"]})
        self.assertFalse(form.is_valid())
        self.assertEqual(
            form.errors,
            {
                "name": [
                    "Ensure this value has at most 10 characters (it has 16).",
                    "Ensure this value has at most 10 characters (it has 24).",
                ],
            },
        )
        form = NameForm(data={"name": ["fname", "lname"]})
        self.assertTrue(form.is_valid())
        self.assertEqual(form.cleaned_data, {"name": "fname lname"})

    def test_multivalue_deep_copy(self):
        """
        #19298 -- MultiValueField needs to override the default as it needs
        to deep-copy subfields:
        """

        class ChoicesField(MultiValueField):
            def __init__(self, fields=(), *args, **kwargs):
                fields = (
                    ChoiceField(label="Rank", choices=((1, 1), (2, 2))),
                    CharField(label="Name", max_length=10),
                )
                super().__init__(fields=fields, *args, **kwargs)

        field = ChoicesField()
        field2 = copy.deepcopy(field)
        self.assertIsInstance(field2, ChoicesField)
        self.assertIsNot(field2.fields, field.fields)
        self.assertIsNot(field2.fields[0].choices, field.fields[0].choices)

    def test_multivalue_initial_data(self):
        """
        #23674 -- invalid initial data should not break form.changed_data()
        """

        class DateAgeField(MultiValueField):
            def __init__(self, fields=(), *args, **kwargs):
                fields = (DateField(label="Date"), IntegerField(label="Age"))
                super().__init__(fields=fields, *args, **kwargs)

        class DateAgeForm(Form):
            date_age = DateAgeField()

        data = {"date_age": ["1998-12-06", 16]}
        form = DateAgeForm(data, initial={"date_age": ["200-10-10", 14]})
        self.assertTrue(form.has_changed())

    def test_multivalue_optional_subfields(self):
        class PhoneField(MultiValueField):
            def __init__(self, *args, **kwargs):
                fields = (
                    CharField(
                        label="Country Code",
                        validators=[
                            RegexValidator(
                                r"^\+[0-9]{1,2}$", message="Enter a valid country code."
                            )
                        ],
                    ),
                    CharField(label="Phone Number"),
                    CharField(
                        label="Extension",
                        error_messages={"incomplete": "Enter an extension."},
                    ),
                    CharField(
                        label="Label", required=False, help_text="E.g. home, work."
                    ),
                )
                super().__init__(fields, *args, **kwargs)

            def compress(self, data_list):
                if data_list:
                    return "%s.%s ext. %s (label: %s)" % tuple(data_list)
                return None

        # An empty value for any field will raise a `required` error on a
        # required `MultiValueField`.
        f = PhoneField()
        with self.assertRaisesMessage(ValidationError, "'This field is required.'"):
            f.clean("")
        with self.assertRaisesMessage(ValidationError, "'This field is required.'"):
            f.clean(None)
        with self.assertRaisesMessage(ValidationError, "'This field is required.'"):
            f.clean([])
        with self.assertRaisesMessage(ValidationError, "'This field is required.'"):
            f.clean(["+61"])
        with self.assertRaisesMessage(ValidationError, "'This field is required.'"):
            f.clean(["+61", "287654321", "123"])
        self.assertEqual(
            "+61.287654321 ext. 123 (label: Home)",
            f.clean(["+61", "287654321", "123", "Home"]),
        )
        with self.assertRaisesMessage(ValidationError, "'Enter a valid country code.'"):
            f.clean(["61", "287654321", "123", "Home"])

        # Empty values for fields will NOT raise a `required` error on an
        # optional `MultiValueField`
        f = PhoneField(required=False)
        self.assertIsNone(f.clean(""))
        self.assertIsNone(f.clean(None))
        self.assertIsNone(f.clean([]))
        self.assertEqual("+61. ext.  (label: )", f.clean(["+61"]))
        self.assertEqual(
            "+61.287654321 ext. 123 (label: )", f.clean(["+61", "287654321", "123"])
        )
        self.assertEqual(
            "+61.287654321 ext. 123 (label: Home)",
            f.clean(["+61", "287654321", "123", "Home"]),
        )
        with self.assertRaisesMessage(ValidationError, "'Enter a valid country code.'"):
            f.clean(["61", "287654321", "123", "Home"])

        # For a required `MultiValueField` with `require_all_fields=False`, a
        # `required` error will only be raised if all fields are empty. Fields
        # can individually be required or optional. An empty value for any
        # required field will raise an `incomplete` error.
        f = PhoneField(require_all_fields=False)
        with self.assertRaisesMessage(ValidationError, "'This field is required.'"):
            f.clean("")
        with self.assertRaisesMessage(ValidationError, "'This field is required.'"):
            f.clean(None)
        with self.assertRaisesMessage(ValidationError, "'This field is required.'"):
            f.clean([])
        with self.assertRaisesMessage(ValidationError, "'Enter a complete value.'"):
            f.clean(["+61"])
        self.assertEqual(
            "+61.287654321 ext. 123 (label: )", f.clean(["+61", "287654321", "123"])
        )
        with self.assertRaisesMessage(
            ValidationError, "'Enter a complete value.', 'Enter an extension.'"
        ):
            f.clean(["", "", "", "Home"])
        with self.assertRaisesMessage(ValidationError, "'Enter a valid country code.'"):
            f.clean(["61", "287654321", "123", "Home"])

        # For an optional `MultiValueField` with `require_all_fields=False`, we
        # don't get any `required` error but we still get `incomplete` errors.
        f = PhoneField(required=False, require_all_fields=False)
        self.assertIsNone(f.clean(""))
        self.assertIsNone(f.clean(None))
        self.assertIsNone(f.clean([]))
        with self.assertRaisesMessage(ValidationError, "'Enter a complete value.'"):
            f.clean(["+61"])
        self.assertEqual(
            "+61.287654321 ext. 123 (label: )", f.clean(["+61", "287654321", "123"])
        )
        with self.assertRaisesMessage(
            ValidationError, "'Enter a complete value.', 'Enter an extension.'"
        ):
            f.clean(["", "", "", "Home"])
        with self.assertRaisesMessage(ValidationError, "'Enter a valid country code.'"):
            f.clean(["61", "287654321", "123", "Home"])

    def test_multivalue_optional_subfields_rendering(self):
        class PhoneWidget(MultiWidget):
            def __init__(self, attrs=None):
                widgets = [TextInput(), TextInput()]
                super().__init__(widgets, attrs)

            def decompress(self, value):
                return [None, None]

        class PhoneField(MultiValueField):
            def __init__(self, *args, **kwargs):
                fields = [CharField(), CharField(required=False)]
                super().__init__(fields, *args, **kwargs)

        class PhoneForm(Form):
            phone1 = PhoneField(widget=PhoneWidget)
            phone2 = PhoneField(widget=PhoneWidget, required=False)
            phone3 = PhoneField(widget=PhoneWidget, require_all_fields=False)
            phone4 = PhoneField(
                widget=PhoneWidget,
                required=False,
                require_all_fields=False,
            )

        form = PhoneForm(auto_id=False)
        self.assertHTMLEqual(
            form.as_p(),
            """
            <p>Phone1:<input type="text" name="phone1_0" required>
            <input type="text" name="phone1_1" required></p>
            <p>Phone2:<input type="text" name="phone2_0">
            <input type="text" name="phone2_1"></p>
            <p>Phone3:<input type="text" name="phone3_0" required>
            <input type="text" name="phone3_1"></p>
            <p>Phone4:<input type="text" name="phone4_0">
            <input type="text" name="phone4_1"></p>
            """,
        )

    def test_custom_empty_values(self):
        """
        Form fields can customize what is considered as an empty value
        for themselves (#19997).
        """

        class CustomJSONField(CharField):
            empty_values = [None, ""]

            def to_python(self, value):
                # Fake json.loads
                if value == "{}":
                    return {}
                return super().to_python(value)

        class JSONForm(forms.Form):
            json = CustomJSONField()

        form = JSONForm(data={"json": "{}"})
        form.full_clean()
        self.assertEqual(form.cleaned_data, {"json": {}})

    def test_boundfield_label_tag(self):
        class SomeForm(Form):
            field = CharField()

        boundfield = SomeForm()["field"]

        testcases = [  # (args, kwargs, expected)
            # without anything: just print the <label>
            ((), {}, '<%(tag)s for="id_field">Field:</%(tag)s>'),
            # passing just one argument: overrides the field's label
            (("custom",), {}, '<%(tag)s for="id_field">custom:</%(tag)s>'),
            # the overridden label is escaped
            (("custom&",), {}, '<%(tag)s for="id_field">custom&amp;:</%(tag)s>'),
            ((mark_safe("custom&"),), {}, '<%(tag)s for="id_field">custom&:</%(tag)s>'),
            # Passing attrs to add extra attributes on the <label>
            (
                (),
                {"attrs": {"class": "pretty"}},
                '<%(tag)s for="id_field" class="pretty">Field:</%(tag)s>',
            ),
        ]

        for args, kwargs, expected in testcases:
            with self.subTest(args=args, kwargs=kwargs):
                self.assertHTMLEqual(
                    boundfield.label_tag(*args, **kwargs),
                    expected % {"tag": "label"},
                )
                self.assertHTMLEqual(
                    boundfield.legend_tag(*args, **kwargs),
                    expected % {"tag": "legend"},
                )

    def test_boundfield_label_tag_no_id(self):
        """
        If a widget has no id, label_tag() and legend_tag() return the text
        with no surrounding <label>.
        """

        class SomeForm(Form):
            field = CharField()

        boundfield = SomeForm(auto_id="")["field"]

        self.assertHTMLEqual(boundfield.label_tag(), "Field:")
        self.assertHTMLEqual(boundfield.legend_tag(), "Field:")
        self.assertHTMLEqual(boundfield.label_tag("Custom&"), "Custom&amp;:")
        self.assertHTMLEqual(boundfield.legend_tag("Custom&"), "Custom&amp;:")

    def test_boundfield_label_tag_custom_widget_id_for_label(self):
        class CustomIdForLabelTextInput(TextInput):
            def id_for_label(self, id):
                return "custom_" + id

        class EmptyIdForLabelTextInput(TextInput):
            def id_for_label(self, id):
                return None

        class SomeForm(Form):
            custom = CharField(widget=CustomIdForLabelTextInput)
            empty = CharField(widget=EmptyIdForLabelTextInput)

        form = SomeForm()
        self.assertHTMLEqual(
            form["custom"].label_tag(), '<label for="custom_id_custom">Custom:</label>'
        )
        self.assertHTMLEqual(
            form["custom"].legend_tag(),
            '<legend for="custom_id_custom">Custom:</legend>',
        )
        self.assertHTMLEqual(form["empty"].label_tag(), "<label>Empty:</label>")
        self.assertHTMLEqual(form["empty"].legend_tag(), "<legend>Empty:</legend>")

    def test_boundfield_empty_label(self):
        class SomeForm(Form):
            field = CharField(label="")

        boundfield = SomeForm()["field"]

        self.assertHTMLEqual(boundfield.label_tag(), '<label for="id_field"></label>')
        self.assertHTMLEqual(
            boundfield.legend_tag(),
            '<legend for="id_field"></legend>',
        )

    def test_boundfield_id_for_label(self):
        class SomeForm(Form):
            field = CharField(label="")

        self.assertEqual(SomeForm()["field"].id_for_label, "id_field")

    def test_boundfield_id_for_label_override_by_attrs(self):
        """
        If an id is provided in `Widget.attrs`, it overrides the generated ID,
        unless it is `None`.
        """

        class SomeForm(Form):
            field = CharField(widget=TextInput(attrs={"id": "myCustomID"}))
            field_none = CharField(widget=TextInput(attrs={"id": None}))

        form = SomeForm()
        self.assertEqual(form["field"].id_for_label, "myCustomID")
        self.assertEqual(form["field_none"].id_for_label, "id_field_none")

    def test_boundfield_subwidget_id_for_label(self):
        """
        If auto_id is provided when initializing the form, the generated ID in
        subwidgets must reflect that prefix.
        """

        class SomeForm(Form):
            field = MultipleChoiceField(
                choices=[("a", "A"), ("b", "B")],
                widget=CheckboxSelectMultiple,
            )

        form = SomeForm(auto_id="prefix_%s")
        subwidgets = form["field"].subwidgets
        self.assertEqual(subwidgets[0].id_for_label, "prefix_field_0")
        self.assertEqual(subwidgets[1].id_for_label, "prefix_field_1")

    def test_boundfield_widget_type(self):
        class SomeForm(Form):
            first_name = CharField()
            birthday = SplitDateTimeField(widget=SplitHiddenDateTimeWidget)

        f = SomeForm()
        self.assertEqual(f["first_name"].widget_type, "text")
        self.assertEqual(f["birthday"].widget_type, "splithiddendatetime")

    def test_boundfield_css_classes(self):
        form = Person()
        field = form["first_name"]
        self.assertEqual(field.css_classes(), "")
        self.assertEqual(field.css_classes(extra_classes=""), "")
        self.assertEqual(field.css_classes(extra_classes="test"), "test")
        self.assertEqual(field.css_classes(extra_classes="test test"), "test")

    def test_label_suffix_override(self):
        """
        BoundField label_suffix (if provided) overrides Form label_suffix
        """

        class SomeForm(Form):
            field = CharField()

        boundfield = SomeForm(label_suffix="!")["field"]

        self.assertHTMLEqual(
            boundfield.label_tag(label_suffix="$"),
            '<label for="id_field">Field$</label>',
        )
        self.assertHTMLEqual(
            boundfield.legend_tag(label_suffix="$"),
            '<legend for="id_field">Field$</legend>',
        )

    def test_error_dict(self):
        class MyForm(Form):
            foo = CharField()
            bar = CharField()

            def clean(self):
                raise ValidationError(
                    "Non-field error.", code="secret", params={"a": 1, "b": 2}
                )

        form = MyForm({})
        self.assertIs(form.is_valid(), False)

        errors = form.errors.as_text()
        control = [
            "* foo\n  * This field is required.",
            "* bar\n  * This field is required.",
            "* __all__\n  * Non-field error.",
        ]
        for error in control:
            self.assertIn(error, errors)

        errors = form.errors.as_ul()
        control = [
            '<li>foo<ul class="errorlist"><li>This field is required.</li></ul></li>',
            '<li>bar<ul class="errorlist"><li>This field is required.</li></ul></li>',
            '<li>__all__<ul class="errorlist nonfield"><li>Non-field error.</li></ul>'
            "</li>",
        ]
        for error in control:
            self.assertInHTML(error, errors)

        errors = form.errors.get_json_data()
        control = {
            "foo": [{"code": "required", "message": "This field is required."}],
            "bar": [{"code": "required", "message": "This field is required."}],
            "__all__": [{"code": "secret", "message": "Non-field error."}],
        }
        self.assertEqual(errors, control)
        self.assertEqual(json.dumps(errors), form.errors.as_json())

    def test_error_dict_as_json_escape_html(self):
        """#21962 - adding html escape flag to ErrorDict"""

        class MyForm(Form):
            foo = CharField()
            bar = CharField()

            def clean(self):
                raise ValidationError(
                    "<p>Non-field error.</p>",
                    code="secret",
                    params={"a": 1, "b": 2},
                )

        control = {
            "foo": [{"code": "required", "message": "This field is required."}],
            "bar": [{"code": "required", "message": "This field is required."}],
            "__all__": [{"code": "secret", "message": "<p>Non-field error.</p>"}],
        }

        form = MyForm({})
        self.assertFalse(form.is_valid())

        errors = json.loads(form.errors.as_json())
        self.assertEqual(errors, control)

        escaped_error = "&lt;p&gt;Non-field error.&lt;/p&gt;"
        self.assertEqual(
            form.errors.get_json_data(escape_html=True)["__all__"][0]["message"],
            escaped_error,
        )
        errors = json.loads(form.errors.as_json(escape_html=True))
        control["__all__"][0]["message"] = escaped_error
        self.assertEqual(errors, control)

    def test_error_list(self):
        e = ErrorList()
        e.append("Foo")
        e.append(ValidationError("Foo%(bar)s", code="foobar", params={"bar": "bar"}))

        self.assertIsInstance(e, list)
        self.assertIn("Foo", e)
        self.assertIn("Foo", ValidationError(e))

        self.assertEqual(e.as_text(), "* Foo\n* Foobar")

        self.assertEqual(
            e.as_ul(), '<ul class="errorlist"><li>Foo</li><li>Foobar</li></ul>'
        )

        errors = e.get_json_data()
        self.assertEqual(
            errors,
            [{"message": "Foo", "code": ""}, {"message": "Foobar", "code": "foobar"}],
        )
        self.assertEqual(json.dumps(errors), e.as_json())

    def test_error_list_class_not_specified(self):
        e = ErrorList()
        e.append("Foo")
        e.append(ValidationError("Foo%(bar)s", code="foobar", params={"bar": "bar"}))
        self.assertEqual(
            e.as_ul(), '<ul class="errorlist"><li>Foo</li><li>Foobar</li></ul>'
        )

    def test_error_list_class_has_one_class_specified(self):
        e = ErrorList(error_class="foobar-error-class")
        e.append("Foo")
        e.append(ValidationError("Foo%(bar)s", code="foobar", params={"bar": "bar"}))
        self.assertEqual(
            e.as_ul(),
            '<ul class="errorlist foobar-error-class"><li>Foo</li><li>Foobar</li></ul>',
        )

    def test_error_list_with_hidden_field_errors_has_correct_class(self):
        class Person(Form):
            first_name = CharField()
            last_name = CharField(widget=HiddenInput)

        p = Person({"first_name": "John"})
        self.assertHTMLEqual(
            p.as_ul(),
            """<li><ul class="errorlist nonfield">
<li>(Hidden field last_name) This field is required.</li></ul></li><li>
<label for="id_first_name">First name:</label>
<input id="id_first_name" name="first_name" type="text" value="John" required>
<input id="id_last_name" name="last_name" type="hidden"></li>""",
        )
        self.assertHTMLEqual(
            p.as_p(),
            """
            <ul class="errorlist nonfield">
            <li>(Hidden field last_name) This field is required.</li></ul>
            <p><label for="id_first_name">First name:</label>
            <input id="id_first_name" name="first_name" type="text" value="John"
                required>
            <input id="id_last_name" name="last_name" type="hidden"></p>
            """,
        )
        self.assertHTMLEqual(
            p.as_table(),
            """<tr><td colspan="2"><ul class="errorlist nonfield">
<li>(Hidden field last_name) This field is required.</li></ul></td></tr>
<tr><th><label for="id_first_name">First name:</label></th><td>
<input id="id_first_name" name="first_name" type="text" value="John" required>
<input id="id_last_name" name="last_name" type="hidden"></td></tr>""",
        )

    def test_error_list_with_non_field_errors_has_correct_class(self):
        class Person(Form):
            first_name = CharField()
            last_name = CharField()

            def clean(self):
                raise ValidationError("Generic validation error")

        p = Person({"first_name": "John", "last_name": "Lennon"})
        self.assertHTMLEqual(
            str(p.non_field_errors()),
            '<ul class="errorlist nonfield"><li>Generic validation error</li></ul>',
        )
        self.assertHTMLEqual(
            p.as_ul(),
            """<li>
<ul class="errorlist nonfield"><li>Generic validation error</li></ul></li>
<li><label for="id_first_name">First name:</label>
<input id="id_first_name" name="first_name" type="text" value="John" required></li>
<li><label for="id_last_name">Last name:</label>
<input id="id_last_name" name="last_name" type="text" value="Lennon" required></li>""",
        )
        self.assertHTMLEqual(
            p.non_field_errors().as_text(), "* Generic validation error"
        )
        self.assertHTMLEqual(
            p.as_p(),
            """<ul class="errorlist nonfield"><li>Generic validation error</li></ul>
<p><label for="id_first_name">First name:</label>
<input id="id_first_name" name="first_name" type="text" value="John" required></p>
<p><label for="id_last_name">Last name:</label>
<input id="id_last_name" name="last_name" type="text" value="Lennon" required></p>""",
        )
        self.assertHTMLEqual(
            p.as_table(),
            """
            <tr><td colspan="2"><ul class="errorlist nonfield">
            <li>Generic validation error</li></ul></td></tr>
            <tr><th><label for="id_first_name">First name:</label></th><td>
            <input id="id_first_name" name="first_name" type="text" value="John"
                required>
            </td></tr>
            <tr><th><label for="id_last_name">Last name:</label></th><td>
            <input id="id_last_name" name="last_name" type="text" value="Lennon"
                required>
            </td></tr>
            """,
        )

    def test_error_escaping(self):
        class TestForm(Form):
            hidden = CharField(widget=HiddenInput(), required=False)
            visible = CharField()

            def clean_hidden(self):
                raise ValidationError('Foo & "bar"!')

            clean_visible = clean_hidden

        form = TestForm({"hidden": "a", "visible": "b"})
        form.is_valid()
        self.assertHTMLEqual(
            form.as_ul(),
            '<li><ul class="errorlist nonfield">'
            "<li>(Hidden field hidden) Foo &amp; &quot;bar&quot;!</li></ul></li>"
            '<li><ul class="errorlist"><li>Foo &amp; &quot;bar&quot;!</li></ul>'
            '<label for="id_visible">Visible:</label> '
            '<input type="text" name="visible" value="b" id="id_visible" required>'
            '<input type="hidden" name="hidden" value="a" id="id_hidden"></li>',
        )

    def test_baseform_repr(self):
        """
        BaseForm.__repr__() should contain some basic information about the
        form.
        """
        p = Person()
        self.assertEqual(
            repr(p),
            "<Person bound=False, valid=Unknown, "
            "fields=(first_name;last_name;birthday)>",
        )
        p = Person(
            {"first_name": "John", "last_name": "Lennon", "birthday": "1940-10-9"}
        )
        self.assertEqual(
            repr(p),
            "<Person bound=True, valid=Unknown, "
            "fields=(first_name;last_name;birthday)>",
        )
        p.is_valid()
        self.assertEqual(
            repr(p),
            "<Person bound=True, valid=True, fields=(first_name;last_name;birthday)>",
        )
        p = Person(
            {"first_name": "John", "last_name": "Lennon", "birthday": "fakedate"}
        )
        p.is_valid()
        self.assertEqual(
            repr(p),
            "<Person bound=True, valid=False, fields=(first_name;last_name;birthday)>",
        )

    def test_baseform_repr_dont_trigger_validation(self):
        """
        BaseForm.__repr__() shouldn't trigger the form validation.
        """
        p = Person(
            {"first_name": "John", "last_name": "Lennon", "birthday": "fakedate"}
        )
        repr(p)
        with self.assertRaises(AttributeError):
            p.cleaned_data
        self.assertFalse(p.is_valid())
        self.assertEqual(p.cleaned_data, {"first_name": "John", "last_name": "Lennon"})

    def test_accessing_clean(self):
        class UserForm(Form):
            username = CharField(max_length=10)
            password = CharField(widget=PasswordInput)

            def clean(self):
                data = self.cleaned_data

                if not self.errors:
                    data["username"] = data["username"].lower()

                return data

        f = UserForm({"username": "SirRobin", "password": "blue"})
        self.assertTrue(f.is_valid())
        self.assertEqual(f.cleaned_data["username"], "sirrobin")

    def test_changing_cleaned_data_nothing_returned(self):
        class UserForm(Form):
            username = CharField(max_length=10)
            password = CharField(widget=PasswordInput)

            def clean(self):
                self.cleaned_data["username"] = self.cleaned_data["username"].lower()
                # don't return anything

        f = UserForm({"username": "SirRobin", "password": "blue"})
        self.assertTrue(f.is_valid())
        self.assertEqual(f.cleaned_data["username"], "sirrobin")

    def test_changing_cleaned_data_in_clean(self):
        class UserForm(Form):
            username = CharField(max_length=10)
            password = CharField(widget=PasswordInput)

            def clean(self):
                data = self.cleaned_data

                # Return a different dict. We have not changed self.cleaned_data.
                return {
                    "username": data["username"].lower(),
                    "password": "this_is_not_a_secret",
                }

        f = UserForm({"username": "SirRobin", "password": "blue"})
        self.assertTrue(f.is_valid())
        self.assertEqual(f.cleaned_data["username"], "sirrobin")

    def test_multipart_encoded_form(self):
        class FormWithoutFile(Form):
            username = CharField()

        class FormWithFile(Form):
            username = CharField()
            file = FileField()

        class FormWithImage(Form):
            image = ImageField()

        self.assertFalse(FormWithoutFile().is_multipart())
        self.assertTrue(FormWithFile().is_multipart())
        self.assertTrue(FormWithImage().is_multipart())

    def test_html_safe(self):
        class SimpleForm(Form):
            username = CharField()

        form = SimpleForm()
        self.assertTrue(hasattr(SimpleForm, "__html__"))
        self.assertEqual(str(form), form.__html__())
        self.assertTrue(hasattr(form["username"], "__html__"))
        self.assertEqual(str(form["username"]), form["username"].__html__())

    def test_use_required_attribute_true(self):
        class MyForm(Form):
            use_required_attribute = True
            f1 = CharField(max_length=30)
            f2 = CharField(max_length=30, required=False)
            f3 = CharField(widget=Textarea)
            f4 = ChoiceField(choices=[("P", "Python"), ("J", "Java")])

        form = MyForm()
        self.assertHTMLEqual(
            form.as_p(),
            '<p><label for="id_f1">F1:</label>'
            '<input id="id_f1" maxlength="30" name="f1" type="text" required></p>'
            '<p><label for="id_f2">F2:</label>'
            '<input id="id_f2" maxlength="30" name="f2" type="text"></p>'
            '<p><label for="id_f3">F3:</label>'
            '<textarea cols="40" id="id_f3" name="f3" rows="10" required>'
            "</textarea></p>"
            '<p><label for="id_f4">F4:</label> <select id="id_f4" name="f4">'
            '<option value="P">Python</option>'
            '<option value="J">Java</option>'
            "</select></p>",
        )
        self.assertHTMLEqual(
            form.as_ul(),
            '<li><label for="id_f1">F1:</label> '
            '<input id="id_f1" maxlength="30" name="f1" type="text" required></li>'
            '<li><label for="id_f2">F2:</label>'
            '<input id="id_f2" maxlength="30" name="f2" type="text"></li>'
            '<li><label for="id_f3">F3:</label>'
            '<textarea cols="40" id="id_f3" name="f3" rows="10" required>'
            "</textarea></li>"
            '<li><label for="id_f4">F4:</label> <select id="id_f4" name="f4">'
            '<option value="P">Python</option>'
            '<option value="J">Java</option>'
            "</select></li>",
        )
        self.assertHTMLEqual(
            form.as_table(),
            '<tr><th><label for="id_f1">F1:</label></th>'
            '<td><input id="id_f1" maxlength="30" name="f1" type="text" required>'
            "</td></tr>"
            '<tr><th><label for="id_f2">F2:</label></th>'
            '<td><input id="id_f2" maxlength="30" name="f2" type="text"></td></tr>'
            '<tr><th><label for="id_f3">F3:</label></th>'
            '<td><textarea cols="40" id="id_f3" name="f3" rows="10" required>'
            "</textarea></td></tr>"
            '<tr><th><label for="id_f4">F4:</label></th><td>'
            '<select id="id_f4" name="f4">'
            '<option value="P">Python</option>'
            '<option value="J">Java</option>'
            "</select></td></tr>",
        )

    def test_use_required_attribute_false(self):
        class MyForm(Form):
            use_required_attribute = False
            f1 = CharField(max_length=30)
            f2 = CharField(max_length=30, required=False)
            f3 = CharField(widget=Textarea)
            f4 = ChoiceField(choices=[("P", "Python"), ("J", "Java")])

        form = MyForm()
        self.assertHTMLEqual(
            form.as_p(),
            '<p><label for="id_f1">F1:</label>'
            '<input id="id_f1" maxlength="30" name="f1" type="text"></p>'
            '<p><label for="id_f2">F2:</label>'
            '<input id="id_f2" maxlength="30" name="f2" type="text"></p>'
            '<p><label for="id_f3">F3:</label>'
            '<textarea cols="40" id="id_f3" name="f3" rows="10"></textarea></p>'
            '<p><label for="id_f4">F4:</label> <select id="id_f4" name="f4">'
            '<option value="P">Python</option>'
            '<option value="J">Java</option>'
            "</select></p>",
        )
        self.assertHTMLEqual(
            form.as_ul(),
            '<li><label for="id_f1">F1:</label>'
            '<input id="id_f1" maxlength="30" name="f1" type="text"></li>'
            '<li><label for="id_f2">F2:</label>'
            '<input id="id_f2" maxlength="30" name="f2" type="text"></li>'
            '<li><label for="id_f3">F3:</label>'
            '<textarea cols="40" id="id_f3" name="f3" rows="10"></textarea></li>'
            '<li><label for="id_f4">F4:</label> <select id="id_f4" name="f4">'
            '<option value="P">Python</option>'
            '<option value="J">Java</option>'
            "</select></li>",
        )
        self.assertHTMLEqual(
            form.as_table(),
            '<tr><th><label for="id_f1">F1:</label></th>'
            '<td><input id="id_f1" maxlength="30" name="f1" type="text"></td></tr>'
            '<tr><th><label for="id_f2">F2:</label></th>'
            '<td><input id="id_f2" maxlength="30" name="f2" type="text"></td></tr>'
            '<tr><th><label for="id_f3">F3:</label></th><td>'
            '<textarea cols="40" id="id_f3" name="f3" rows="10">'
            "</textarea></td></tr>"
            '<tr><th><label for="id_f4">F4:</label></th><td>'
            '<select id="id_f4" name="f4">'
            '<option value="P">Python</option>'
            '<option value="J">Java</option>'
            "</select></td></tr>",
        )

    def test_only_hidden_fields(self):
        # A form with *only* hidden fields that has errors is going to be very unusual.
        class HiddenForm(Form):
            data = IntegerField(widget=HiddenInput)

        f = HiddenForm({})
        self.assertHTMLEqual(
            f.as_p(),
            '<ul class="errorlist nonfield">'
            "<li>(Hidden field data) This field is required.</li></ul>\n<p> "
            '<input type="hidden" name="data" id="id_data"></p>',
        )
        self.assertHTMLEqual(
            f.as_table(),
            '<tr><td colspan="2"><ul class="errorlist nonfield">'
            "<li>(Hidden field data) This field is required.</li></ul>"
            '<input type="hidden" name="data" id="id_data"></td></tr>',
        )

    def test_field_named_data(self):
        class DataForm(Form):
            data = CharField(max_length=10)

        f = DataForm({"data": "xyzzy"})
        self.assertTrue(f.is_valid())
        self.assertEqual(f.cleaned_data, {"data": "xyzzy"})

    def test_empty_data_files_multi_value_dict(self):
        p = Person()
        self.assertIsInstance(p.data, MultiValueDict)
        self.assertIsInstance(p.files, MultiValueDict)

    def test_field_deep_copy_error_messages(self):
        class CustomCharField(CharField):
            def __init__(self, **kwargs):
                kwargs["error_messages"] = {"invalid": "Form custom error message."}
                super().__init__(**kwargs)

        field = CustomCharField()
        field_copy = copy.deepcopy(field)
        self.assertIsInstance(field_copy, CustomCharField)
        self.assertIsNot(field_copy.error_messages, field.error_messages)

    def test_label_does_not_include_new_line(self):
        form = Person()
        field = form["first_name"]
        self.assertEqual(
            field.label_tag(), '<label for="id_first_name">First name:</label>'
        )
        self.assertEqual(
            field.legend_tag(),
            '<legend for="id_first_name">First name:</legend>',
        )

    @override_settings(USE_THOUSAND_SEPARATOR=True)
    def test_label_attrs_not_localized(self):
        form = Person()
        field = form["first_name"]
        self.assertHTMLEqual(
            field.label_tag(attrs={"number": 9999}),
            '<label number="9999" for="id_first_name">First name:</label>',
        )
        self.assertHTMLEqual(
            field.legend_tag(attrs={"number": 9999}),
            '<legend number="9999" for="id_first_name">First name:</legend>',
        )

File: tests/forms_tests/field_tests/test_choicefield.py
Line number range: 36 - 50
Content:
36.         with self.assertRaisesMessage(ValidationError, msg):
37.             f.clean("John")
38. 
39.     def test_choicefield_4(self):
40.         f = ChoiceField(
41.             choices=[
42.                 ("Numbers", (("1", "One"), ("2", "Two"))),
43.                 ("Letters", (("3", "A"), ("4", "B"))),
44.                 ("5", "Other"),
45.             ]
46.         )
47.         self.assertEqual("1", f.clean(1))
48.         self.assertEqual("1", f.clean("1"))
49.         self.assertEqual("3", f.clean(3))
50.         self.assertEqual("3", f.clean("3"))

File: tests/admin_views/models.py
Line number range: 1 - 50
Content:
1. import datetime
2. import tempfile
3. import uuid
4. 
5. from django.contrib import admin
6. from django.contrib.auth.models import User
7. from django.contrib.contenttypes.fields import GenericForeignKey, GenericRelation
8. from django.contrib.contenttypes.models import ContentType
9. from django.core.exceptions import ValidationError
10. from django.core.files.storage import FileSystemStorage
11. from django.db import models
12. 
13. 
14. class Section(models.Model):
15.     """
16.     A simple section that links to articles, to test linking to related items
17.     in admin views.
18.     """
19. 
20.     name = models.CharField(max_length=100)
21. 
22.     def __str__(self):
23.         return self.name
24. 
25.     @property
26.     def name_property(self):
27.         """
28.         A property that simply returns the name. Used to test #24461
29.         """
30.         return self.name
31. 
32. 
33. class Article(models.Model):
34.     """
35.     A simple article to test admin views. Test backwards compatibility.
36.     """
37. 
38.     title = models.CharField(max_length=100)
39.     content = models.TextField()
40.     date = models.DateTimeField()
41.     section = models.ForeignKey(Section, models.CASCADE, null=True, blank=True)
42.     another_section = models.ForeignKey(
43.         Section, models.CASCADE, null=True, blank=True, related_name="+"
44.     )
45.     sub_section = models.ForeignKey(
46.         Section, models.SET_NULL, null=True, blank=True, related_name="+"
47.     )
48. 
49.     def __str__(self):
50.         return self.title

File: tests/admin_views/tests.py
Line number range: 2908 - 2940
Content:
2908.         self.assertTrue(get_change_related(response))
2909.         self.assertContains(response, change_link_text)
2910. 
2911.     def test_conditionally_show_delete_section_link(self):
2912.         """
2913.         The foreign key widget should only show the "delete related" button if
2914.         the user has permission to delete that related item.
2915.         """
2916. 
2917.         def get_delete_related(response):
2918.             return (
2919.                 response.context["adminform"]
2920.                 .form.fields["sub_section"]
2921.                 .widget.can_delete_related
2922.             )
2923. 
2924.         self.client.force_login(self.adduser)
2925.         # The user can't delete sections yet, so they shouldn't see the
2926.         # "delete section" link.
2927.         url = reverse("admin:admin_views_article_add")
2928.         delete_link_text = "delete_id_sub_section"
2929.         response = self.client.get(url)
2930.         self.assertFalse(get_delete_related(response))
2931.         self.assertNotContains(response, delete_link_text)
2932.         # Allow the user to delete sections too. Now they can see the
2933.         # "delete section" link.
2934.         user = User.objects.get(username="adduser")
2935.         perm = get_perm(Section, get_permission_codename("delete", Section._meta))
2936.         user.user_permissions.add(perm)
2937.         response = self.client.get(url)
2938.         self.assertTrue(get_delete_related(response))
2939.         self.assertContains(response, delete_link_text)

File: tests/modeladmin/models.py
Line number range: 1 - 41
Content:
1. from django.contrib.auth.models import User
2. from django.db import models
3. 
4. 
5. class Band(models.Model):
6.     name = models.CharField(max_length=100)
7.     bio = models.TextField()
8.     sign_date = models.DateField()
9. 
10.     class Meta:
11.         ordering = ("name",)
12. 
13.     def __str__(self):
14.         return self.name
15. 
16. 
17. class Song(models.Model):
18.     name = models.CharField(max_length=100)
19.     band = models.ForeignKey(Band, models.CASCADE)
20.     featuring = models.ManyToManyField(Band, related_name="featured")
21. 
22.     def __str__(self):
23.         return self.name
24. 
25. 
26. class Concert(models.Model):
27.     main_band = models.ForeignKey(Band, models.CASCADE, related_name="main_concerts")
28.     opening_band = models.ForeignKey(
29.         Band, models.CASCADE, related_name="opening_concerts", blank=True
30.     )
31.     day = models.CharField(max_length=3, choices=((1, "Fri"), (2, "Sat")))
32.     transport = models.CharField(
33.         max_length=100, choices=((1, "Plane"), (2, "Train"), (3, "Bus")), blank=True
34.     )
35. 
36. 
37. class ValidationTestModel(models.Model):
38.     name = models.CharField(max_length=100)
39.     slug = models.SlugField()
40.     users = models.ManyToManyField(User)
41.     state = models.CharField(

File: tests/forms_tests/field_tests/test_choicefield.py
Line number range: 1 - 5
Content:
1. from django.core.exceptions import ValidationError
2. from django.db import models
3. from django.forms import ChoiceField, Form
4. from django.test import SimpleTestCase

File: tests/forms_tests/field_tests/test_choicefield.py
Line number range: 19 - 24
Content:
19.         with self.assertRaisesMessage(ValidationError, msg):
20.             f.clean("3")
21. 
22.     def test_choicefield_2(self):
23.         f = ChoiceField(choices=[("1", "One"), ("2", "Two")], required=False)
24.         self.assertEqual("", f.clean(""))

File: tests/forms_tests/field_tests/test_choicefield.py
Line number range: 25 - 37
Content:
25.         self.assertEqual("", f.clean(None))
26.         self.assertEqual("1", f.clean(1))
27.         self.assertEqual("1", f.clean("1"))
28.         msg = "'Select a valid choice. 3 is not one of the available choices.'"
29.         with self.assertRaisesMessage(ValidationError, msg):
30.             f.clean("3")
31. 
32.     def test_choicefield_3(self):
33.         f = ChoiceField(choices=[("J", "John"), ("P", "Paul")])
34.         self.assertEqual("J", f.clean("J"))
35.         msg = "'Select a valid choice. John is not one of the available choices.'"
36.         with self.assertRaisesMessage(ValidationError, msg):
37.             f.clean("John")

File: tests/forms_tests/field_tests/test_choicefield.py
Line number range: 7 - 18
Content:
7. 
8. 
9. class ChoiceFieldTest(FormFieldAssertionsMixin, SimpleTestCase):
10.     def test_choicefield_1(self):
11.         f = ChoiceField(choices=[("1", "One"), ("2", "Two")])
12.         with self.assertRaisesMessage(ValidationError, "'This field is required.'"):
13.             f.clean("")
14.         with self.assertRaisesMessage(ValidationError, "'This field is required.'"):
15.             f.clean(None)
16.         self.assertEqual("1", f.clean(1))
17.         self.assertEqual("1", f.clean("1"))
18.         msg = "'Select a valid choice. 3 is not one of the available choices.'"


--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to a given query and return it in the specified format!
EVERY context object MUST include: reasoning, relative_path, start_line, and end_line.

2025-10-06 19:59:13,886 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="1. Query requirement analysis:\n   - The user is reporting a bug where `radio_fields` in `ModelAdmin` overrides a custom `empty_label` set for a `ForeignKey`.\n   - This test case, `test_foreign_key_as_radio_field`, is the most relevant because it directly examines the behavior of the `radio_fields` option.\n\n2. Extended relevance:\n   - It defines a `ConcertAdmin` that uses `radio_fields` for several fields, including a `ForeignKey` (`opening_band`).\n   - It asserts that the widget for these fields becomes `AdminRadioSelect`.\n   - Crucially, it checks the choices generated for the `opening_band` field, asserting that the empty choice is `('', 'None')`. This is the exact behavior the user is reporting as a bug (the hardcoded 'None' label), making this test essential for understanding and reproducing the issue.", relative_path='tests/modeladmin/tests.py', start_line=723, end_line=771), ContextOutput(reasoning='1. Query requirement analysis:\n   - The query is about how `radio_fields` affects the `empty_label` of a `ForeignKey`.\n   - This test provides the essential "before" picture, showing the default rendering of the same fields that are later tested with `radio_fields`.\n\n2. Extended relevance:\n   - It inspects the default widget for `ForeignKey` fields, confirming it\'s a `Select` widget.\n   - It checks the default choices, specifically noting that the empty choice is `(\'\', \'---------\')`.\n   - This context is critical to understand what `radio_fields` changes and why the user\'s custom `empty_label` is being replaced by the `\'None\'` label that `radio_fields` introduces.', relative_path='tests/modeladmin/tests.py', start_line=690, end_line=721), ContextOutput(reasoning="1. Query requirement analysis:\n   - The user is trying to customize a `ForeignKey` field's properties within a `ModelAdmin` by overriding `formfield_for_foreignkey`.\n   - This test case demonstrates a similar and common pattern for customizing `ForeignKey` fields in the admin.\n\n2. Extended relevance:\n   - It shows how to use a custom `ModelForm` within a `ModelAdmin` to change the properties of a field.\n   - Specifically, it overrides the `queryset` of a `ForeignKey` field and asserts that the rendered widget reflects this change.\n   - This is analogous to the user's goal of modifying the `empty_label` and provides a relevant example of how such customizations are typically implemented and tested.", relative_path='tests/modeladmin/tests.py', start_line=627, end_line=688), ContextOutput(reasoning='1. Query requirement analysis:\n   - The user\'s issue stems from the admin framework dynamically altering a form field widget\'s property (`empty_label`) when `radio_fields` is used.\n   - This test case, `test_conditionally_show_delete_section_link`, provides a strong example of the admin framework dynamically altering a `ForeignKey` widget\'s behavior.\n\n2. Extended relevance:\n   - It tests the logic that decides whether to show the "delete related" link next to a `ForeignKey` widget.\n   - The test inspects the `can_delete_related` attribute of the widget, which is set at runtime based on user permissions.\n   - This is conceptually similar to the bug, where a widget attribute is being controlled by the admin options, making it a relevant example of the underlying mechanism.', relative_path='tests/admin_views/tests.py', start_line=2911, end_line=2939), ContextOutput(reasoning="1. Query requirement analysis:\n   - The bug is about the `empty_label` of a `ForeignKey`, which is a type of `ChoiceField`.\n   - Understanding the basic behavior of `ChoiceField` is fundamental to the issue.\n\n2. Extended relevance:\n   - This test, `test_choicefield_2`, specifically checks the validation of a non-required `ChoiceField`.\n   - It asserts that cleaning an empty string (`''`) or `None` results in a valid, empty value.\n   - This is relevant because the bug revolves around the handling and labeling of the empty choice in a field that allows blank values. This test provides the foundational behavior of choice fields with optional values.", relative_path='tests/forms_tests/field_tests/test_choicefield.py', start_line=22, end_line=30)]
2025-10-06 19:59:13,887 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - INFO - Context extraction complete, returning context [Context(relative_path='tests/modeladmin/tests.py', content='723.                     self.assertEqual(fetched.object_repr, message)\n724.                 else:\n725.                     self.assertEqual(fetched.change_message, str(message))\n726.                     self.assertEqual(fetched.object_repr, str(self.band))\n727. \n728.     def test_get_autocomplete_fields(self):\n729.         class NameAdmin(ModelAdmin):\n730.             search_fields = ["name"]\n731. \n732.         class SongAdmin(ModelAdmin):\n733.             autocomplete_fields = ["featuring"]\n734.             fields = ["featuring", "band"]\n735. \n736.         class OtherSongAdmin(SongAdmin):\n737.             def get_autocomplete_fields(self, request):\n738.                 return ["band"]\n739. \n740.         self.site.register(Band, NameAdmin)\n741.         try:\n742.             # Uses autocomplete_fields if not overridden.\n743.             model_admin = SongAdmin(Song, self.site)\n744.             form = model_admin.get_form(request)()\n745.             self.assertIsInstance(\n746.                 form.fields["featuring"].widget.widget, AutocompleteSelectMultiple\n747.             )\n748.             # Uses overridden get_autocomplete_fields\n749.             model_admin = OtherSongAdmin(Song, self.site)\n750.             form = model_admin.get_form(request)()\n751.             self.assertIsInstance(form.fields["band"].widget.widget, AutocompleteSelect)\n752.         finally:\n753.             self.site.unregister(Band)\n754. \n755.     def test_get_deleted_objects(self):\n756.         mock_request = MockRequest()\n757.         mock_request.user = User.objects.create_superuser(\n758.             username="bob", email="bob@test.com", password="test"\n759.         )\n760.         self.site.register(Band, ModelAdmin)\n761.         ma = self.site._registry[Band]\n762.         (\n763.             deletable_objects,\n764.             model_count,\n765.             perms_needed,\n766.             protected,\n767.         ) = ma.get_deleted_objects([self.band], request)\n768.         self.assertEqual(deletable_objects, ["Band: The Doors"])\n769.         self.assertEqual(model_count, {"bands": 1})\n770.         self.assertEqual(perms_needed, set())\n771.         self.assertEqual(protected, [])', start_line_number=723, end_line_number=771), Context(relative_path='tests/modeladmin/tests.py', content='690.             fk_name = "main_band"\n691.             can_delete = True\n692. \n693.         class BandAdmin(ModelAdmin):\n694.             inlines = [ConcertInline]\n695. \n696.         ma = BandAdmin(Band, self.site)\n697.         self.assertEqual(\n698.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),\n699.             ["extra", "transport", "id", "DELETE", "main_band"],\n700.         )\n701. \n702.     def test_log_actions(self):\n703.         ma = ModelAdmin(Band, self.site)\n704.         mock_request = MockRequest()\n705.         mock_request.user = User.objects.create(username="bill")\n706.         content_type = get_content_type_for_model(self.band)\n707.         tests = (\n708.             (ma.log_addition, ADDITION, {"added": {}}),\n709.             (ma.log_change, CHANGE, {"changed": {"fields": ["name", "bio"]}}),\n710.             (ma.log_deletion, DELETION, str(self.band)),\n711.         )\n712.         for method, flag, message in tests:\n713.             with self.subTest(name=method.__name__):\n714.                 created = method(mock_request, self.band, message)\n715.                 fetched = LogEntry.objects.filter(action_flag=flag).latest("id")\n716.                 self.assertEqual(created, fetched)\n717.                 self.assertEqual(fetched.action_flag, flag)\n718.                 self.assertEqual(fetched.content_type, content_type)\n719.                 self.assertEqual(fetched.object_id, str(self.band.pk))\n720.                 self.assertEqual(fetched.user, mock_request.user)\n721.                 if flag == DELETION:', start_line_number=690, end_line_number=721), Context(relative_path='tests/modeladmin/tests.py', content='627.         )\n628.         self.assertEqual(\n629.             cmafa.base_fields["main_band"].widget.attrs, {"class": "radiolist inline"}\n630.         )\n631.         self.assertEqual(\n632.             list(cmafa.base_fields["main_band"].widget.choices),\n633.             [(self.band.id, "The Doors")],\n634.         )\n635. \n636.         self.assertEqual(\n637.             type(cmafa.base_fields["opening_band"].widget.widget), AdminRadioSelect\n638.         )\n639.         self.assertEqual(\n640.             cmafa.base_fields["opening_band"].widget.attrs, {"class": "radiolist"}\n641.         )\n642.         self.assertEqual(\n643.             list(cmafa.base_fields["opening_band"].widget.choices),\n644.             [("", "None"), (self.band.id, "The Doors")],\n645.         )\n646.         self.assertEqual(type(cmafa.base_fields["day"].widget), AdminRadioSelect)\n647.         self.assertEqual(cmafa.base_fields["day"].widget.attrs, {"class": "radiolist"})\n648.         self.assertEqual(\n649.             list(cmafa.base_fields["day"].widget.choices), [(1, "Fri"), (2, "Sat")]\n650.         )\n651. \n652.         self.assertEqual(type(cmafa.base_fields["transport"].widget), AdminRadioSelect)\n653.         self.assertEqual(\n654.             cmafa.base_fields["transport"].widget.attrs, {"class": "radiolist inline"}\n655.         )\n656.         self.assertEqual(\n657.             list(cmafa.base_fields["transport"].widget.choices),\n658.             [("", "None"), (1, "Plane"), (2, "Train"), (3, "Bus")],\n659.         )\n660. \n661.         class AdminConcertForm(forms.ModelForm):\n662.             class Meta:\n663.                 model = Concert\n664.                 exclude = ("transport",)\n665. \n666.         class ConcertAdmin(ModelAdmin):\n667.             form = AdminConcertForm\n668. \n669.         ma = ConcertAdmin(Concert, self.site)\n670.         self.assertEqual(\n671.             list(ma.get_form(request).base_fields), ["main_band", "opening_band", "day"]\n672.         )\n673. \n674.         class AdminConcertForm(forms.ModelForm):\n675.             extra = forms.CharField()\n676. \n677.             class Meta:\n678.                 model = Concert\n679.                 fields = ["extra", "transport"]\n680. \n681.         class ConcertAdmin(ModelAdmin):\n682.             form = AdminConcertForm\n683. \n684.         ma = ConcertAdmin(Concert, self.site)\n685.         self.assertEqual(list(ma.get_form(request).base_fields), ["extra", "transport"])\n686. \n687.         class ConcertInline(TabularInline):\n688.             form = AdminConcertForm', start_line_number=627, end_line_number=688), Context(relative_path='tests/admin_views/tests.py', content='2911.     def test_conditionally_show_delete_section_link(self):\n2912.         """\n2913.         The foreign key widget should only show the "delete related" button if\n2914.         the user has permission to delete that related item.\n2915.         """\n2916. \n2917.         def get_delete_related(response):\n2918.             return (\n2919.                 response.context["adminform"]\n2920.                 .form.fields["sub_section"]\n2921.                 .widget.can_delete_related\n2922.             )\n2923. \n2924.         self.client.force_login(self.adduser)\n2925.         # The user can\'t delete sections yet, so they shouldn\'t see the\n2926.         # "delete section" link.\n2927.         url = reverse("admin:admin_views_article_add")\n2928.         delete_link_text = "delete_id_sub_section"\n2929.         response = self.client.get(url)\n2930.         self.assertFalse(get_delete_related(response))\n2931.         self.assertNotContains(response, delete_link_text)\n2932.         # Allow the user to delete sections too. Now they can see the\n2933.         # "delete section" link.\n2934.         user = User.objects.get(username="adduser")\n2935.         perm = get_perm(Section, get_permission_codename("delete", Section._meta))\n2936.         user.user_permissions.add(perm)\n2937.         response = self.client.get(url)\n2938.         self.assertTrue(get_delete_related(response))\n2939.         self.assertContains(response, delete_link_text)', start_line_number=2911, end_line_number=2939), Context(relative_path='tests/forms_tests/field_tests/test_choicefield.py', content='22.     def test_choicefield_2(self):\n23.         f = ChoiceField(choices=[("1", "One"), ("2", "Two")], required=False)\n24.         self.assertEqual("", f.clean(""))\n25.         self.assertEqual("", f.clean(None))\n26.         self.assertEqual("1", f.clean(1))\n27.         self.assertEqual("1", f.clean("1"))\n28.         msg = "\'Select a valid choice. 3 is not one of the available choices.\'"\n29.         with self.assertRaisesMessage(ValidationError, msg):\n30.             f.clean("3")', start_line_number=22, end_line_number=30)]
2025-10-06 19:59:13,888 - thread-139660780025408.app.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-10-06 19:59:13,888 - thread-139660780025408.app.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .github
|   ├── CODE_OF_CONDUCT.md
|   ├── FUNDING.yml
|   ├── SECURITY.md
|   └── workflows
|       ├── docs.yml
|       ├── linters.yml
|       ├── new_contributor_pr.yml
|       └── tests.yml
├── .pre-commit-config.yaml
├── .readthedocs.yml
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ar_DZ
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ig
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ky
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ms
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uz
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   ├── 0012_alter_user_first_name_max_length.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   ├── options.py
|   |   |   |   └── widgets.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── constraints.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── ms
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── tg
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── uz
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_redirect_new_path_help_text.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── templates
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── asgi.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   ├── memcached.py
|   |   |   |   └── redis.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── async_checks.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   ├── __init__.py
|   |   |   |   └── django_4_0.py
|   |   |   ├── database.py
|   |   |   ├── files.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── asgi.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── __init__.py
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── optimizemigration.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── jsonl.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _functions.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   └── special.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── enums.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── json.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── autoreload.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── asyncio.py
|   |   ├── autoreload.py
|   |   ├── baseconv.py
|   |   ├── cache.py
|   |   ├── connection.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── datetime_safe.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── topological_sort.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── common.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           └── technical_500.txt
├── docs
|   ├── README.rst
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   └── static
|   |   |       └── fontawesome
|   |   └── djangodocs-epub
|   |       └── static
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── _images
|   |   ├── auth-remote-user.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-backend.txt
|   |   ├── custom-template-tags.txt
|   |   ├── deployment
|   |   |   ├── asgi
|   |   |   |   ├── daphne.txt
|   |   |   |   ├── hypercorn.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── uvicorn.txt
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── legacy-databases.txt
|   |   ├── logging.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── filters.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── constraints.txt
|   |   |   |   ├── expressions.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── logging.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── paginator.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.19.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.20.txt
|   |   ├── 1.11.21.txt
|   |   ├── 1.11.22.txt
|   |   ├── 1.11.23.txt
|   |   ├── 1.11.24.txt
|   |   ├── 1.11.25.txt
|   |   ├── 1.11.26.txt
|   |   ├── 1.11.27.txt
|   |   ├── 1.11.28.txt
|   |   ├── 1.11.29.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.11.txt
|   |   ├── 2.0.12.txt
|   |   ├── 2.0.13.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.10.txt
|   |   ├── 2.1.11.txt
|   |   ├── 2.1.12.txt
|   |   ├── 2.1.13.txt
|   |   ├── 2.1.14.txt
|   |   ├── 2.1.15.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.7.txt
|   |   ├── 2.1.8.txt
|   |   ├── 2.1.9.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.1.txt
|   |   ├── 2.2.10.txt
|   |   ├── 2.2.11.txt
|   |   ├── 2.2.12.txt
|   |   ├── 2.2.13.txt
|   |   ├── 2.2.14.txt
|   |   ├── 2.2.15.txt
|   |   ├── 2.2.16.txt
|   |   ├── 2.2.17.txt
|   |   ├── 2.2.18.txt
|   |   ├── 2.2.19.txt
|   |   ├── 2.2.2.txt
|   |   ├── 2.2.20.txt
|   |   ├── 2.2.21.txt
|   |   ├── 2.2.22.txt
|   |   ├── 2.2.23.txt
|   |   ├── 2.2.24.txt
|   |   ├── 2.2.25.txt
|   |   ├── 2.2.26.txt
|   |   ├── 2.2.27.txt
|   |   ├── 2.2.3.txt
|   |   ├── 2.2.4.txt
|   |   ├── 2.2.5.txt
|   |   ├── 2.2.6.txt
|   |   ├── 2.2.7.txt
|   |   ├── 2.2.8.txt
|   |   ├── 2.2.9.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.1.txt
|   |   ├── 3.0.10.txt
|   |   ├── 3.0.11.txt
|   |   ├── 3.0.12.txt
|   |   ├── 3.0.13.txt
|   |   ├── 3.0.14.txt
|   |   ├── 3.0.2.txt
|   |   ├── 3.0.3.txt
|   |   ├── 3.0.4.txt
|   |   ├── 3.0.5.txt
|   |   ├── 3.0.6.txt
|   |   ├── 3.0.7.txt
|   |   ├── 3.0.8.txt
|   |   ├── 3.0.9.txt
|   |   ├── 3.0.txt
|   |   ├── 3.1.1.txt
|   |   ├── 3.1.10.txt
|   |   ├── 3.1.11.txt
|   |   ├── 3.1.12.txt
|   |   ├── 3.1.13.txt
|   |   ├── 3.1.14.txt
|   |   ├── 3.1.2.txt
|   |   ├── 3.1.3.txt
|   |   ├── 3.1.4.txt
|   |   ├── 3.1.5.txt
|   |   ├── 3.1.6.txt
|   |   ├── 3.1.7.txt
|   |   ├── 3.1.8.txt
|   |   ├── 3.1.9.txt
|   |   ├── 3.1.txt
|   |   ├── 3.2.1.txt
|   |   ├── 3.2.10.txt
|   |   ├── 3.2.11.txt
|   |   ├── 3.2.12.txt
|   |   ├── 3.2.2.txt
|   |   ├── 3.2.3.txt
|   |   ├── 3.2.4.txt
|   |   ├── 3.2.5.txt
|   |   ├── 3.2.6.txt
|   |   ├── 3.2.7.txt
|   |   ├── 3.2.8.txt
|   |   ├── 3.2.9.txt
|   |   ├── 3.2.txt
|   |   ├── 4.0.1.txt
|   |   ├── 4.0.2.txt
|   |   ├── 4.0.3.txt
|   |   ├── 4.0.txt
|   |   ├── 4.1.txt
|   |   ├── index.txt
|   |   └── security.txt
|   ├── requirements.txt
|   └── topics
|       ├── async.txt
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   ├── jsi18n-mocks.test.js
|   |   └── navigation.test.js
|   └── gis
|       └── mapwidget.test.js
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_dynamic_settings_manage.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── .hidden
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       ├── noargs_command.py
    |   |       └── suppress_base_options_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   └── admin
    |   |       └── admin_views
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_forms.py
    |   ├── test_history_view.py
    |   ├── test_multidb.py
    |   ├── test_nav_sidebar.py
    |   ├── test_prevent_double_submission.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   ├── no_config_app
    |   |   └── __init__.py
    |   ├── one_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── tests.py
    |   ├── two_configs_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── two_configs_one_default_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   └── two_default_configs_app
    |       ├── __init__.py
    |       └── apps.py
    ├── asgi
    |   ├── __init__.py
    |   ├── project
    |   |   └── static
    |   |       └── file.txt
    |   ├── tests.py
    |   └── urls.py
    ├── async
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   ├── with_last_login_attr.py
    |   |   └── with_many_to_many.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   └── registration
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_remote_user.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── app_unmigrated
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── test_base.py
    |   |   ├── test_client.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_functions.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   ├── tests.py
    |   └── tests_async.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── template_test_apps
    |   |   ├── __init__.py
    |   |   ├── different_tags_app
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   ├── same_tags_app_1
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   └── same_tags_app_2
    |   |       ├── __init__.py
    |   |       ├── apps.py
    |   |       └── templatetags
    |   ├── test_4_0_compatibility.py
    |   ├── test_async_checks.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_files.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_class_based_error_handlers.py
    |       ├── bad_error_handlers_invalid_path.py
    |       ├── bad_function_based_error_handlers.py
    |       ├── beginning_with_slash.py
    |       ├── cbv_as_view.py
    |       ├── contains_tuple.py
    |       ├── good_class_based_error_handlers.py
    |       ├── good_function_based_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   └── ending_with_dollar.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_collate.py
    |   |   ├── test_greatest.py
    |   |   ├── test_json_object.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_random.py
    |   |   ├── test_round.py
    |   |   ├── test_sign.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_md5.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_sha1.py
    |   |   ├── test_sha224.py
    |   |   ├── test_sha256.py
    |   |   ├── test_sha384.py
    |   |   ├── test_sha512.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── fake_client.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   ├── test_postgresql.py
    |   ├── test_sqlite.py
    |   └── tests.py
    ├── decorators
    |   ├── __init__.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   ├── test_csrf_cookie_masked.py
    |   ├── test_middleware_mixin.py
    |   ├── test_use_l10n.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── empty_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── test_commands.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── absolute_urls.py
    |   ├── no_slash_urls.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   └── registration
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_jsonfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   └── tags.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_deprecation_forms.py
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   └── robots.txt
    |   |   └── registration
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── has_nulls
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   ├── test_srs.py
    |   |   └── tests.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoadmin_deprecated
    |   |   ├── __init__.py
    |   |   ├── admin.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_indexes.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_create_models.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_rastermodels.py
    |   |   |   └── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   └── javascript_ignored.js
    |   |   └── templates
    |   |       └── subdir
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── loading
    |   |   ├── en
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_AU
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_CA
    |   |   |   └── LC_MESSAGES
    |   |   └── en_NZ
    |   |       └── LC_MESSAGES
    |   ├── loading_app
    |   |   ├── __init__.py
    |   |   ├── apps.py
    |   |   └── locale
    |   |       └── en
    |   ├── models.py
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── unchanged
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   ├── tests.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_fake_initial_case_insensitive
    |   |   ├── fake_initial
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── initial
    |   |       ├── 0001_initial.py
    |   |       └── __init__.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_conflict_long_name
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second_migration_with_long_name.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_manual_porting
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   └── __init__.py
    |   ├── test_migrations_namespace_package
    |   |   └── 0001_initial.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_no_operations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   ├── 0005_fifth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_no_replaces
    |   |   ├── 0001_squashed_0002.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_enums
    |   ├── __init__.py
    |   └── tests.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autofield.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_filepathfield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_jsonfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_pk.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── model_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── integration_settings.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_constraints.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_integration.py
    |   ├── test_introspection.py
    |   ├── test_operations.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_contains.py
    |   ├── test_db_returning.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   ├── test_sqlcompiler.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests
    |   ├── __init__.py
    |   ├── test_accept_header.py
    |   ├── test_data_upload_settings.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_jsonl.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_clear_expired.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   ├── templates
    |   |   └── shortcuts
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   ├── test_management.py
    |   ├── test_utils.py
    |   └── urls
    |       ├── __init__.py
    |       ├── empty.py
    |       ├── http.py
    |       ├── https.py
    |       ├── index_only.py
    |       └── sitemap_only.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── cached
    |   |   |   ├── nested
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   ├── loop
    |   |   ├── pathlib
    |   |   |   └── pathlib.txt
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   ├── jinja2
    |   |   └── template_backends
    |   ├── template_strings
    |   |   └── template_backends
    |   ├── templates
    |   |   └── template_backends
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   ├── templates
    |   |   └── template_loader
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   ├── other_templates
    |   |   └── priority
    |   ├── recursive_templates
    |   |   ├── fs
    |   |   ├── fs2
    |   |   └── fs3
    |   ├── relative_templates
    |   |   └── dir1
    |   |       └── dir2
    |   ├── syntax_tests
    |   |   ├── __init__.py
    |   |   ├── i18n
    |   |   |   ├── __init__.py
    |   |   |   ├── base.py
    |   |   |   ├── test_blocktranslate.py
    |   |   |   ├── test_filters.py
    |   |   |   ├── test_get_available_languages.py
    |   |   |   ├── test_get_current_language.py
    |   |   |   ├── test_get_current_language_bidi.py
    |   |   |   ├── test_get_language_info.py
    |   |   |   ├── test_get_language_info_list.py
    |   |   |   ├── test_language.py
    |   |   |   ├── test_translate.py
    |   |   |   └── test_underscore_syntax.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_basic.py
    |   |   ├── test_builtins.py
    |   |   ├── test_cache.py
    |   |   ├── test_comment.py
    |   |   ├── test_cycle.py
    |   |   ├── test_debug.py
    |   |   ├── test_exceptions.py
    |   |   ├── test_extends.py
    |   |   ├── test_filter_syntax.py
    |   |   ├── test_filter_tag.py
    |   |   ├── test_firstof.py
    |   |   ├── test_for.py
    |   |   ├── test_if.py
    |   |   ├── test_if_changed.py
    |   |   ├── test_include.py
    |   |   ├── test_invalid_string.py
    |   |   ├── test_list_index.py
    |   |   ├── test_load.py
    |   |   ├── test_lorem.py
    |   |   ├── test_multiline.py
    |   |   ├── test_named_endblock.py
    |   |   ├── test_now.py
    |   |   ├── test_numpy.py
    |   |   ├── test_regroup.py
    |   |   ├── test_resetcycle.py
    |   |   ├── test_setup.py
    |   |   ├── test_simple_tag.py
    |   |   ├── test_spaceless.py
    |   |   ├── test_static.py
    |   |   ├── test_template_tag.py
    |   |   ├── test_url.py
    |   |   ├── test_verbatim.py
    |   |   ├── test_width_ratio.py
    |   |   └── test_with.py
    |   ├── templates
    |   |   ├── first
    |   |   ├── priority
    |   |   ├── second
    |   |   └── template_tests
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   ├── bad_tag.py
    |   |   ├── custom.py
    |   |   ├── inclusion.py
    |   |   ├── subpackage
    |   |   |   ├── __init__.py
    |   |   |   └── echo.py
    |   |   ├── tag_27584.py
    |   |   └── testtags.py
    |   ├── test_autoreloader.py
    |   ├── test_base.py
    |   ├── test_callables.py
    |   ├── test_context.py
    |   ├── test_custom.py
    |   ├── test_engine.py
    |   ├── test_extends.py
    |   ├── test_extends_relative.py
    |   ├── test_library.py
    |   ├── test_loaders.py
    |   ├── test_logging.py
    |   ├── test_nodelist.py
    |   ├── test_origin.py
    |   ├── test_parser.py
    |   ├── test_response.py
    |   ├── test_smartif.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── utils.py
    |   └── views.py
    ├── templates
    |   ├── comments
    |   |   └── comment_notification_email.txt
    |   ├── custom_admin
    |   └── views
    ├── test_client
    |   ├── __init__.py
    |   ├── auth_backends.py
    |   ├── test_conditional_content_removal.py
    |   ├── test_fakepayload.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_middleware_urlconf.py
    |   └── views.py
    ├── test_client_regress
    |   ├── __init__.py
    |   ├── auth_backends.py
    |   ├── bad_templates
    |   ├── context_processors.py
    |   ├── models.py
    |   ├── session.py
    |   ├── templates
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── test_exceptions
    |   ├── __init__.py
    |   └── test_validation_error.py
    ├── test_runner
    |   ├── __init__.py
    |   ├── models.py
    |   ├── runner.py
    |   ├── test_debug_sql.py
    |   ├── test_discover_runner.py
    |   ├── test_parallel.py
    |   ├── test_shuffler.py
    |   └── tests.py
    ├── test_runner_apps
    |   ├── __init__.py
    |   ├── buffer
    |   |   └── tests_buffer.py
    |   ├── databases
    |   |   ├── __init__.py
    |   |   └── tests.py
    |   ├── failures
    |   |   ├── __init__.py
    |   |   └── tests_failures.py
    |   ├── sample
    |   |   ├── __init__.py
    |   |   ├── doctests.py
    |   |   ├── empty.py
    |   |   ├── pattern_tests.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── tests.py
    |   |   └── tests_sample.py
    |   ├── simple
    |   |   ├── __init__.py
    |   |   └── tests.py
    |   └── tagged
    |       ├── __init__.py
    |       ├── tests.py
    |       ├── tests_inheritance.py
    |       └── tests_syntax_error.py
    ├── test_sqlite.py
    ├── test_utils
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── templates
    |   |   └── template_used
    |   ├── test_serializemixin.py
    |   ├── test_simpletestcase.py
    |   ├── test_testcase.py
    |   ├── test_transactiontestcase.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── timezones
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── transaction_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── transactions
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── unmanaged_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── update_only_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── urlpatterns
    |   ├── __init__.py
    |   ├── converter_urls.py
    |   ├── converters.py
    |   ├── included_urls.py
    |   ├── more_urls.py
    |   ├── path_base64_urls.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
ModelAdmin with defined radio_fields override empty_label

Issue description: 
Description
	
ModelAdmin drops my "empty_label" and set "default_empty_label". For example:
class MyModelAdmin(ModelAdmin):
	radio_fields = 'myfield',
	def formfield_for_foreignkey(self, db_field, *args, **kwargs):
		if db_field.name == 'myfield':
			kwargs['empty_label'] = "I WANT TO SET MY OWN EMPTY LABEL"
		return super().formfield_for_foreignkey(db_field, *args, **kwargs)
You get never the "I WANT TO SET MY OWN EMPTY LABEL"
How to fix it:
In django\contrib\admin\options.py, row 234:
kwargs['empty_label'] = _('None') if db_field.blank else None
Should be changed on:
kwargs['empty_label'] = (kwargs.get('empty_label') or _('None')) if db_field.blank else None

Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: tests/modeladmin/tests.py
Line number range: 723 - 771
Content:
723.                     self.assertEqual(fetched.object_repr, message)
724.                 else:
725.                     self.assertEqual(fetched.change_message, str(message))
726.                     self.assertEqual(fetched.object_repr, str(self.band))
727. 
728.     def test_get_autocomplete_fields(self):
729.         class NameAdmin(ModelAdmin):
730.             search_fields = ["name"]
731. 
732.         class SongAdmin(ModelAdmin):
733.             autocomplete_fields = ["featuring"]
734.             fields = ["featuring", "band"]
735. 
736.         class OtherSongAdmin(SongAdmin):
737.             def get_autocomplete_fields(self, request):
738.                 return ["band"]
739. 
740.         self.site.register(Band, NameAdmin)
741.         try:
742.             # Uses autocomplete_fields if not overridden.
743.             model_admin = SongAdmin(Song, self.site)
744.             form = model_admin.get_form(request)()
745.             self.assertIsInstance(
746.                 form.fields["featuring"].widget.widget, AutocompleteSelectMultiple
747.             )
748.             # Uses overridden get_autocomplete_fields
749.             model_admin = OtherSongAdmin(Song, self.site)
750.             form = model_admin.get_form(request)()
751.             self.assertIsInstance(form.fields["band"].widget.widget, AutocompleteSelect)
752.         finally:
753.             self.site.unregister(Band)
754. 
755.     def test_get_deleted_objects(self):
756.         mock_request = MockRequest()
757.         mock_request.user = User.objects.create_superuser(
758.             username="bob", email="bob@test.com", password="test"
759.         )
760.         self.site.register(Band, ModelAdmin)
761.         ma = self.site._registry[Band]
762.         (
763.             deletable_objects,
764.             model_count,
765.             perms_needed,
766.             protected,
767.         ) = ma.get_deleted_objects([self.band], request)
768.         self.assertEqual(deletable_objects, ["Band: The Doors"])
769.         self.assertEqual(model_count, {"bands": 1})
770.         self.assertEqual(perms_needed, set())
771.         self.assertEqual(protected, [])


File: tests/modeladmin/tests.py
Line number range: 690 - 721
Content:
690.             fk_name = "main_band"
691.             can_delete = True
692. 
693.         class BandAdmin(ModelAdmin):
694.             inlines = [ConcertInline]
695. 
696.         ma = BandAdmin(Band, self.site)
697.         self.assertEqual(
698.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),
699.             ["extra", "transport", "id", "DELETE", "main_band"],
700.         )
701. 
702.     def test_log_actions(self):
703.         ma = ModelAdmin(Band, self.site)
704.         mock_request = MockRequest()
705.         mock_request.user = User.objects.create(username="bill")
706.         content_type = get_content_type_for_model(self.band)
707.         tests = (
708.             (ma.log_addition, ADDITION, {"added": {}}),
709.             (ma.log_change, CHANGE, {"changed": {"fields": ["name", "bio"]}}),
710.             (ma.log_deletion, DELETION, str(self.band)),
711.         )
712.         for method, flag, message in tests:
713.             with self.subTest(name=method.__name__):
714.                 created = method(mock_request, self.band, message)
715.                 fetched = LogEntry.objects.filter(action_flag=flag).latest("id")
716.                 self.assertEqual(created, fetched)
717.                 self.assertEqual(fetched.action_flag, flag)
718.                 self.assertEqual(fetched.content_type, content_type)
719.                 self.assertEqual(fetched.object_id, str(self.band.pk))
720.                 self.assertEqual(fetched.user, mock_request.user)
721.                 if flag == DELETION:


File: tests/modeladmin/tests.py
Line number range: 627 - 688
Content:
627.         )
628.         self.assertEqual(
629.             cmafa.base_fields["main_band"].widget.attrs, {"class": "radiolist inline"}
630.         )
631.         self.assertEqual(
632.             list(cmafa.base_fields["main_band"].widget.choices),
633.             [(self.band.id, "The Doors")],
634.         )
635. 
636.         self.assertEqual(
637.             type(cmafa.base_fields["opening_band"].widget.widget), AdminRadioSelect
638.         )
639.         self.assertEqual(
640.             cmafa.base_fields["opening_band"].widget.attrs, {"class": "radiolist"}
641.         )
642.         self.assertEqual(
643.             list(cmafa.base_fields["opening_band"].widget.choices),
644.             [("", "None"), (self.band.id, "The Doors")],
645.         )
646.         self.assertEqual(type(cmafa.base_fields["day"].widget), AdminRadioSelect)
647.         self.assertEqual(cmafa.base_fields["day"].widget.attrs, {"class": "radiolist"})
648.         self.assertEqual(
649.             list(cmafa.base_fields["day"].widget.choices), [(1, "Fri"), (2, "Sat")]
650.         )
651. 
652.         self.assertEqual(type(cmafa.base_fields["transport"].widget), AdminRadioSelect)
653.         self.assertEqual(
654.             cmafa.base_fields["transport"].widget.attrs, {"class": "radiolist inline"}
655.         )
656.         self.assertEqual(
657.             list(cmafa.base_fields["transport"].widget.choices),
658.             [("", "None"), (1, "Plane"), (2, "Train"), (3, "Bus")],
659.         )
660. 
661.         class AdminConcertForm(forms.ModelForm):
662.             class Meta:
663.                 model = Concert
664.                 exclude = ("transport",)
665. 
666.         class ConcertAdmin(ModelAdmin):
667.             form = AdminConcertForm
668. 
669.         ma = ConcertAdmin(Concert, self.site)
670.         self.assertEqual(
671.             list(ma.get_form(request).base_fields), ["main_band", "opening_band", "day"]
672.         )
673. 
674.         class AdminConcertForm(forms.ModelForm):
675.             extra = forms.CharField()
676. 
677.             class Meta:
678.                 model = Concert
679.                 fields = ["extra", "transport"]
680. 
681.         class ConcertAdmin(ModelAdmin):
682.             form = AdminConcertForm
683. 
684.         ma = ConcertAdmin(Concert, self.site)
685.         self.assertEqual(list(ma.get_form(request).base_fields), ["extra", "transport"])
686. 
687.         class ConcertInline(TabularInline):
688.             form = AdminConcertForm


File: tests/admin_views/tests.py
Line number range: 2911 - 2939
Content:
2911.     def test_conditionally_show_delete_section_link(self):
2912.         """
2913.         The foreign key widget should only show the "delete related" button if
2914.         the user has permission to delete that related item.
2915.         """
2916. 
2917.         def get_delete_related(response):
2918.             return (
2919.                 response.context["adminform"]
2920.                 .form.fields["sub_section"]
2921.                 .widget.can_delete_related
2922.             )
2923. 
2924.         self.client.force_login(self.adduser)
2925.         # The user can't delete sections yet, so they shouldn't see the
2926.         # "delete section" link.
2927.         url = reverse("admin:admin_views_article_add")
2928.         delete_link_text = "delete_id_sub_section"
2929.         response = self.client.get(url)
2930.         self.assertFalse(get_delete_related(response))
2931.         self.assertNotContains(response, delete_link_text)
2932.         # Allow the user to delete sections too. Now they can see the
2933.         # "delete section" link.
2934.         user = User.objects.get(username="adduser")
2935.         perm = get_perm(Section, get_permission_codename("delete", Section._meta))
2936.         user.user_permissions.add(perm)
2937.         response = self.client.get(url)
2938.         self.assertTrue(get_delete_related(response))
2939.         self.assertContains(response, delete_link_text)


File: tests/forms_tests/field_tests/test_choicefield.py
Line number range: 22 - 30
Content:
22.     def test_choicefield_2(self):
23.         f = ChoiceField(choices=[("1", "One"), ("2", "Two")], required=False)
24.         self.assertEqual("", f.clean(""))
25.         self.assertEqual("", f.clean(None))
26.         self.assertEqual("1", f.clean(1))
27.         self.assertEqual("1", f.clean("1"))
28.         msg = "'Select a valid choice. 3 is not one of the available choices.'"
29.         with self.assertRaisesMessage(ValidationError, msg):
30.             f.clean("3")

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

2025-10-06 19:59:40,224 - thread-139660780025408.app.lang_graph.nodes.context_refine_node - DEBUG - reasoning="1. The user wants to find 5 test cases related to a bug in `ModelAdmin` where `radio_fields` overrides the `empty_label` set in `formfield_for_foreignkey`. \n2. The provided context contains snippets of tests from `tests/modeladmin/tests.py`, `tests/admin_views/tests.py`, and `tests/forms_tests/field_tests/test_choicefield.py`.\n3. While some snippets are relevant (e.g., testing `AdminRadioSelect` in `tests/modeladmin/tests.py`), they are incomplete. I need the full test method, including the class setup and imports, to understand the context and determine if it's a good match.\n4. None of the provided snippets explicitly test the interaction between `radio_fields` and overriding `formfield_for_foreignkey` to set an `empty_label`.\n5. To fulfill the request for 5 *complete* and *relevant* test cases, I need to see more of the test files that deal with `ModelAdmin` form field generation and customization." refined_query='Please provide the full source code for the file `tests/modeladmin/tests.py`. I also need any tests from other files that specifically test the `formfield_for_foreignkey` method on a `ModelAdmin`, especially when `radio_fields` is also used. I am looking for tests that inspect the choices or `empty_label` of a form field widget in the admin.'
2025-10-06 19:59:50,339 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I have located the file you requested and will begin by providing its full source code. Afterward, I will search for additional tests related to the `formfield_for_foreignkey` method as you specified.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/modeladmin/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 56409, 'candidates_token_count': 65, 'total_token_count': 56709, 'prompt_tokens_details': [{'modality': 1, 'token_count': 56409}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 65}], 'thoughts_token_count': 235, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.35766865656926083, 'model_name': 'gemini-2.5-pro'} id='run--dd3a7113-bb44-43c3-9c00-f3bf396c257e-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/modeladmin/tests.py'}, 'id': '76835915-965b-4f63-bd62-bca327321540', 'type': 'tool_call'}] usage_metadata={'input_tokens': 56409, 'output_tokens': 65, 'total_tokens': 56709, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 235}}
2025-10-06 19:59:59,841 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content="I have provided the complete source code for `tests/modeladmin/tests.py`. I will now look for other tests that examine the `formfield_for_foreignkey` method, specifically when used with `radio_fields`, to find examples of how the choices and `empty_label` of the form field's widget are tested." additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_basename', 'arguments': '{"text": "formfield_for_foreignkey", "basename": "tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 63406, 'candidates_token_count': 101, 'total_token_count': 63606, 'cached_content_token_count': 6019, 'prompt_tokens_details': [{'modality': 1, 'token_count': 63406}], 'cache_tokens_details': [{'modality': 1, 'token_count': 6019}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 101}], 'thoughts_token_count': 99}, 'finish_reason': 'STOP', 'avg_logprobs': -0.17444072383465153, 'model_name': 'gemini-2.5-pro'} id='run--da9fb1ec-6a63-48f3-90cd-5d38a8f3e0ec-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_basename', 'args': {'text': 'formfield_for_foreignkey', 'basename': 'tests.py'}, 'id': 'adc201f0-1b3f-4201-ac4c-70e65b677244', 'type': 'tool_call'}] usage_metadata={'input_tokens': 63406, 'output_tokens': 101, 'total_tokens': 63606, 'input_token_details': {'cache_read': 6019}, 'output_token_details': {'reasoning': 99}}
2025-10-06 20:00:02,479 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I found a relevant test file at `tests/admin_ordering/tests.py` that contains tests for `formfield_for_foreignkey`. I will now read this file to see if it contains the specific tests you are looking for.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/admin_ordering/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 64501, 'candidates_token_count': 73, 'total_token_count': 64574, 'prompt_tokens_details': [{'modality': 1, 'token_count': 64501}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 73}], 'thoughts_token_count': 0, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.11653928887354184, 'model_name': 'gemini-2.5-pro'} id='run--147a2eb6-4d51-461c-827c-a662e13ae9df-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/admin_ordering/tests.py'}, 'id': 'ffed9623-9734-4129-b4a3-f55f9c90a913', 'type': 'tool_call'}] usage_metadata={'input_tokens': 64501, 'output_tokens': 73, 'total_tokens': 64574, 'input_token_details': {'cache_read': 0}}
2025-10-06 20:00:10,359 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I have reviewed the test file and found that while it does contain tests for `formfield_for_foreignkey`, it does not include any tests that use `radio_fields` or inspect the `empty_label` of the widget. I will now broaden my search to find tests that cover this specific scenario.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_basename', 'arguments': '{"text": "radio_fields", "basename": "tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 67504, 'candidates_token_count': 89, 'total_token_count': 67953, 'cached_content_token_count': 64110, 'prompt_tokens_details': [{'modality': 1, 'token_count': 67504}], 'cache_tokens_details': [{'modality': 1, 'token_count': 64110}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 89}], 'thoughts_token_count': 360}, 'finish_reason': 'STOP', 'avg_logprobs': -0.5414721456806312, 'model_name': 'gemini-2.5-pro'} id='run--2426c3e0-d9d1-45b3-85b3-9267c5c3e4ce-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_basename', 'args': {'text': 'radio_fields', 'basename': 'tests.py'}, 'id': 'e633557f-1766-4aff-849d-2056624298ef', 'type': 'tool_call'}] usage_metadata={'input_tokens': 67504, 'output_tokens': 89, 'total_tokens': 67953, 'input_token_details': {'cache_read': 64110}, 'output_token_details': {'reasoning': 360}}
2025-10-06 20:00:13,168 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I have found a relevant test file at `tests/admin_widgets/tests.py`. I will now read this file to see if it contains the specific tests you are looking for.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/admin_widgets/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 77877, 'candidates_token_count': 61, 'total_token_count': 77938, 'cached_content_token_count': 63847, 'prompt_tokens_details': [{'modality': 1, 'token_count': 77877}], 'cache_tokens_details': [{'modality': 1, 'token_count': 63847}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 61}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.06369165123486129, 'model_name': 'gemini-2.5-pro'} id='run--5c35851b-8c35-4fa3-befd-dc4c88589408-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/admin_widgets/tests.py'}, 'id': '8436d2a9-348b-421d-b190-66854d058512', 'type': 'tool_call'}] usage_metadata={'input_tokens': 77877, 'output_tokens': 61, 'total_tokens': 77938, 'input_token_details': {'cache_read': 63847}}
2025-10-06 20:00:17,921 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I have successfully located the full source code for `tests/modeladmin/tests.py` and found the specific tests you requested. The file `tests/admin_widgets/tests.py` contains a test named `test_radio_fields_ForeignKey` inside the `AdminFormfieldForDBFieldTests` class. This test verifies that when `radio_fields` is used on a `ForeignKey`, the resulting widget is an `AdminRadioSelect`, and it also asserts that the `empty_label` attribute of the form field is `None`, which directly addresses your query.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 85539, 'candidates_token_count': 120, 'total_token_count': 85802, 'cached_content_token_count': 75677, 'prompt_tokens_details': [{'modality': 1, 'token_count': 85539}], 'cache_tokens_details': [{'modality': 1, 'token_count': 75677}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 120}], 'thoughts_token_count': 143}, 'finish_reason': 'STOP', 'avg_logprobs': -0.19344607988993326, 'model_name': 'gemini-2.5-pro'} id='run--12ac3ae9-8844-44da-ac98-02550a040e01-0' usage_metadata={'input_tokens': 85539, 'output_tokens': 120, 'total_tokens': 85802, 'input_token_details': {'cache_read': 75677}, 'output_token_details': {'reasoning': 143}}
2025-10-06 20:00:17,922 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - INFO - Starting context extraction process
2025-10-06 20:00:17,922 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - DEBUG - This is the original user query:

--- BEGIN ORIGINAL QUERY ---
Issue title:
ModelAdmin with defined radio_fields override empty_label

Issue description: 
Description
	
ModelAdmin drops my "empty_label" and set "default_empty_label". For example:
class MyModelAdmin(ModelAdmin):
	radio_fields = 'myfield',
	def formfield_for_foreignkey(self, db_field, *args, **kwargs):
		if db_field.name == 'myfield':
			kwargs['empty_label'] = "I WANT TO SET MY OWN EMPTY LABEL"
		return super().formfield_for_foreignkey(db_field, *args, **kwargs)
You get never the "I WANT TO SET MY OWN EMPTY LABEL"
How to fix it:
In django\contrib\admin\options.py, row 234:
kwargs['empty_label'] = _('None') if db_field.blank else None
Should be changed on:
kwargs['empty_label'] = (kwargs.get('empty_label') or _('None')) if db_field.blank else None

Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

This is the refinement query. Please consider it together with the original query. It's really IMPORTANT!!!

--- BEGIN REFINEMENT QUERY ---
Please provide the full source code for the file `tests/modeladmin/tests.py`. I also need any tests from other files that specifically test the `formfield_for_foreignkey` method on a `ModelAdmin`, especially when `radio_fields` is also used. I am looking for tests that inspect the choices or `empty_label` of a form field widget in the admin.
--- END REFINEMENT QUERY ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/modeladmin/tests.py
Line number range: 1 - 500
Content:
1. from datetime import date
2. 
3. from django import forms
4. from django.contrib.admin.models import ADDITION, CHANGE, DELETION, LogEntry
5. from django.contrib.admin.options import (
6.     HORIZONTAL,
7.     VERTICAL,
8.     ModelAdmin,
9.     TabularInline,
10.     get_content_type_for_model,
11. )
12. from django.contrib.admin.sites import AdminSite
13. from django.contrib.admin.widgets import (
14.     AdminDateWidget,
15.     AdminRadioSelect,
16.     AutocompleteSelect,
17.     AutocompleteSelectMultiple,
18. )
19. from django.contrib.auth.models import User
20. from django.db import models
21. from django.forms.widgets import Select
22. from django.test import SimpleTestCase, TestCase
23. from django.test.utils import isolate_apps
24. 
25. from .models import Band, Concert, Song
26. 
27. 
28. class MockRequest:
29.     pass
30. 
31. 
32. class MockSuperUser:
33.     def has_perm(self, perm, obj=None):
34.         return True
35. 
36. 
37. request = MockRequest()
38. request.user = MockSuperUser()
39. 
40. 
41. class ModelAdminTests(TestCase):
42.     @classmethod
43.     def setUpTestData(cls):
44.         cls.band = Band.objects.create(
45.             name="The Doors",
46.             bio="",
47.             sign_date=date(1965, 1, 1),
48.         )
49. 
50.     def setUp(self):
51.         self.site = AdminSite()
52. 
53.     def test_modeladmin_str(self):
54.         ma = ModelAdmin(Band, self.site)
55.         self.assertEqual(str(ma), "modeladmin.ModelAdmin")
56. 
57.     def test_default_attributes(self):
58.         ma = ModelAdmin(Band, self.site)
59.         self.assertEqual(ma.actions, ())
60.         self.assertEqual(ma.inlines, ())
61. 
62.     # form/fields/fieldsets interaction ##############################
63. 
64.     def test_default_fields(self):
65.         ma = ModelAdmin(Band, self.site)
66.         self.assertEqual(
67.             list(ma.get_form(request).base_fields), ["name", "bio", "sign_date"]
68.         )
69.         self.assertEqual(list(ma.get_fields(request)), ["name", "bio", "sign_date"])
70.         self.assertEqual(
71.             list(ma.get_fields(request, self.band)), ["name", "bio", "sign_date"]
72.         )
73.         self.assertIsNone(ma.get_exclude(request, self.band))
74. 
75.     def test_default_fieldsets(self):
76.         # fieldsets_add and fieldsets_change should return a special data structure that
77.         # is used in the templates. They should generate the "right thing" whether we
78.         # have specified a custom form, the fields argument, or nothing at all.
79.         #
80.         # Here's the default case. There are no custom form_add/form_change methods,
81.         # no fields argument, and no fieldsets argument.
82.         ma = ModelAdmin(Band, self.site)
83.         self.assertEqual(
84.             ma.get_fieldsets(request),
85.             [(None, {"fields": ["name", "bio", "sign_date"]})],
86.         )
87.         self.assertEqual(
88.             ma.get_fieldsets(request, self.band),
89.             [(None, {"fields": ["name", "bio", "sign_date"]})],
90.         )
91. 
92.     def test_get_fieldsets(self):
93.         # get_fieldsets() is called when figuring out form fields (#18681).
94.         class BandAdmin(ModelAdmin):
95.             def get_fieldsets(self, request, obj=None):
96.                 return [(None, {"fields": ["name", "bio"]})]
97. 
98.         ma = BandAdmin(Band, self.site)
99.         form = ma.get_form(None)
100.         self.assertEqual(form._meta.fields, ["name", "bio"])
101. 
102.         class InlineBandAdmin(TabularInline):
103.             model = Concert
104.             fk_name = "main_band"
105.             can_delete = False
106. 
107.             def get_fieldsets(self, request, obj=None):
108.                 return [(None, {"fields": ["day", "transport"]})]
109. 
110.         ma = InlineBandAdmin(Band, self.site)
111.         form = ma.get_formset(None).form
112.         self.assertEqual(form._meta.fields, ["day", "transport"])
113. 
114.     def test_lookup_allowed_allows_nonexistent_lookup(self):
115.         """
116.         A lookup_allowed allows a parameter whose field lookup doesn't exist.
117.         (#21129).
118.         """
119. 
120.         class BandAdmin(ModelAdmin):
121.             fields = ["name"]
122. 
123.         ma = BandAdmin(Band, self.site)
124.         self.assertTrue(ma.lookup_allowed("name__nonexistent", "test_value"))
125. 
126.     @isolate_apps("modeladmin")
127.     def test_lookup_allowed_onetoone(self):
128.         class Department(models.Model):
129.             code = models.CharField(max_length=4, unique=True)
130. 
131.         class Employee(models.Model):
132.             department = models.ForeignKey(Department, models.CASCADE, to_field="code")
133. 
134.         class EmployeeProfile(models.Model):
135.             employee = models.OneToOneField(Employee, models.CASCADE)
136. 
137.         class EmployeeInfo(models.Model):
138.             employee = models.OneToOneField(Employee, models.CASCADE)
139.             description = models.CharField(max_length=100)
140. 
141.         class EmployeeProfileAdmin(ModelAdmin):
142.             list_filter = [
143.                 "employee__employeeinfo__description",
144.                 "employee__department__code",
145.             ]
146. 
147.         ma = EmployeeProfileAdmin(EmployeeProfile, self.site)
148.         # Reverse OneToOneField
149.         self.assertIs(
150.             ma.lookup_allowed("employee__employeeinfo__description", "test_value"), True
151.         )
152.         # OneToOneField and ForeignKey
153.         self.assertIs(
154.             ma.lookup_allowed("employee__department__code", "test_value"), True
155.         )
156. 
157.     def test_field_arguments(self):
158.         # If fields is specified, fieldsets_add and fieldsets_change should
159.         # just stick the fields into a formsets structure and return it.
160.         class BandAdmin(ModelAdmin):
161.             fields = ["name"]
162. 
163.         ma = BandAdmin(Band, self.site)
164. 
165.         self.assertEqual(list(ma.get_fields(request)), ["name"])
166.         self.assertEqual(list(ma.get_fields(request, self.band)), ["name"])
167.         self.assertEqual(ma.get_fieldsets(request), [(None, {"fields": ["name"]})])
168.         self.assertEqual(
169.             ma.get_fieldsets(request, self.band), [(None, {"fields": ["name"]})]
170.         )
171. 
172.     def test_field_arguments_restricted_on_form(self):
173.         # If fields or fieldsets is specified, it should exclude fields on the
174.         # Form class to the fields specified. This may cause errors to be
175.         # raised in the db layer if required model fields aren't in fields/
176.         # fieldsets, but that's preferable to ghost errors where a field in the
177.         # Form class isn't being displayed because it's not in fields/fieldsets.
178. 
179.         # Using `fields`.
180.         class BandAdmin(ModelAdmin):
181.             fields = ["name"]
182. 
183.         ma = BandAdmin(Band, self.site)
184.         self.assertEqual(list(ma.get_form(request).base_fields), ["name"])
185.         self.assertEqual(list(ma.get_form(request, self.band).base_fields), ["name"])
186. 
187.         # Using `fieldsets`.
188.         class BandAdmin(ModelAdmin):
189.             fieldsets = [(None, {"fields": ["name"]})]
190. 
191.         ma = BandAdmin(Band, self.site)
192.         self.assertEqual(list(ma.get_form(request).base_fields), ["name"])
193.         self.assertEqual(list(ma.get_form(request, self.band).base_fields), ["name"])
194. 
195.         # Using `exclude`.
196.         class BandAdmin(ModelAdmin):
197.             exclude = ["bio"]
198. 
199.         ma = BandAdmin(Band, self.site)
200.         self.assertEqual(list(ma.get_form(request).base_fields), ["name", "sign_date"])
201. 
202.         # You can also pass a tuple to `exclude`.
203.         class BandAdmin(ModelAdmin):
204.             exclude = ("bio",)
205. 
206.         ma = BandAdmin(Band, self.site)
207.         self.assertEqual(list(ma.get_form(request).base_fields), ["name", "sign_date"])
208. 
209.         # Using `fields` and `exclude`.
210.         class BandAdmin(ModelAdmin):
211.             fields = ["name", "bio"]
212.             exclude = ["bio"]
213. 
214.         ma = BandAdmin(Band, self.site)
215.         self.assertEqual(list(ma.get_form(request).base_fields), ["name"])
216. 
217.     def test_custom_form_meta_exclude_with_readonly(self):
218.         """
219.         The custom ModelForm's `Meta.exclude` is respected when used in
220.         conjunction with `ModelAdmin.readonly_fields` and when no
221.         `ModelAdmin.exclude` is defined (#14496).
222.         """
223.         # With ModelAdmin
224.         class AdminBandForm(forms.ModelForm):
225.             class Meta:
226.                 model = Band
227.                 exclude = ["bio"]
228. 
229.         class BandAdmin(ModelAdmin):
230.             readonly_fields = ["name"]
231.             form = AdminBandForm
232. 
233.         ma = BandAdmin(Band, self.site)
234.         self.assertEqual(list(ma.get_form(request).base_fields), ["sign_date"])
235. 
236.         # With InlineModelAdmin
237.         class AdminConcertForm(forms.ModelForm):
238.             class Meta:
239.                 model = Concert
240.                 exclude = ["day"]
241. 
242.         class ConcertInline(TabularInline):
243.             readonly_fields = ["transport"]
244.             form = AdminConcertForm
245.             fk_name = "main_band"
246.             model = Concert
247. 
248.         class BandAdmin(ModelAdmin):
249.             inlines = [ConcertInline]
250. 
251.         ma = BandAdmin(Band, self.site)
252.         self.assertEqual(
253.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),
254.             ["main_band", "opening_band", "id", "DELETE"],
255.         )
256. 
257.     def test_custom_formfield_override_readonly(self):
258.         class AdminBandForm(forms.ModelForm):
259.             name = forms.CharField()
260. 
261.             class Meta:
262.                 exclude = ()
263.                 model = Band
264. 
265.         class BandAdmin(ModelAdmin):
266.             form = AdminBandForm
267.             readonly_fields = ["name"]
268. 
269.         ma = BandAdmin(Band, self.site)
270. 
271.         # `name` shouldn't appear in base_fields because it's part of
272.         # readonly_fields.
273.         self.assertEqual(list(ma.get_form(request).base_fields), ["bio", "sign_date"])
274.         # But it should appear in get_fields()/fieldsets() so it can be
275.         # displayed as read-only.
276.         self.assertEqual(list(ma.get_fields(request)), ["bio", "sign_date", "name"])
277.         self.assertEqual(
278.             list(ma.get_fieldsets(request)),
279.             [(None, {"fields": ["bio", "sign_date", "name"]})],
280.         )
281. 
282.     def test_custom_form_meta_exclude(self):
283.         """
284.         The custom ModelForm's `Meta.exclude` is overridden if
285.         `ModelAdmin.exclude` or `InlineModelAdmin.exclude` are defined (#14496).
286.         """
287.         # With ModelAdmin
288.         class AdminBandForm(forms.ModelForm):
289.             class Meta:
290.                 model = Band
291.                 exclude = ["bio"]
292. 
293.         class BandAdmin(ModelAdmin):
294.             exclude = ["name"]
295.             form = AdminBandForm
296. 
297.         ma = BandAdmin(Band, self.site)
298.         self.assertEqual(list(ma.get_form(request).base_fields), ["bio", "sign_date"])
299. 
300.         # With InlineModelAdmin
301.         class AdminConcertForm(forms.ModelForm):
302.             class Meta:
303.                 model = Concert
304.                 exclude = ["day"]
305. 
306.         class ConcertInline(TabularInline):
307.             exclude = ["transport"]
308.             form = AdminConcertForm
309.             fk_name = "main_band"
310.             model = Concert
311. 
312.         class BandAdmin(ModelAdmin):
313.             inlines = [ConcertInline]
314. 
315.         ma = BandAdmin(Band, self.site)
316.         self.assertEqual(
317.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),
318.             ["main_band", "opening_band", "day", "id", "DELETE"],
319.         )
320. 
321.     def test_overriding_get_exclude(self):
322.         class BandAdmin(ModelAdmin):
323.             def get_exclude(self, request, obj=None):
324.                 return ["name"]
325. 
326.         self.assertEqual(
327.             list(BandAdmin(Band, self.site).get_form(request).base_fields),
328.             ["bio", "sign_date"],
329.         )
330. 
331.     def test_get_exclude_overrides_exclude(self):
332.         class BandAdmin(ModelAdmin):
333.             exclude = ["bio"]
334. 
335.             def get_exclude(self, request, obj=None):
336.                 return ["name"]
337. 
338.         self.assertEqual(
339.             list(BandAdmin(Band, self.site).get_form(request).base_fields),
340.             ["bio", "sign_date"],
341.         )
342. 
343.     def test_get_exclude_takes_obj(self):
344.         class BandAdmin(ModelAdmin):
345.             def get_exclude(self, request, obj=None):
346.                 if obj:
347.                     return ["sign_date"]
348.                 return ["name"]
349. 
350.         self.assertEqual(
351.             list(BandAdmin(Band, self.site).get_form(request, self.band).base_fields),
352.             ["name", "bio"],
353.         )
354. 
355.     def test_custom_form_validation(self):
356.         # If a form is specified, it should use it allowing custom validation
357.         # to work properly. This won't break any of the admin widgets or media.
358.         class AdminBandForm(forms.ModelForm):
359.             delete = forms.BooleanField()
360. 
361.         class BandAdmin(ModelAdmin):
362.             form = AdminBandForm
363. 
364.         ma = BandAdmin(Band, self.site)
365.         self.assertEqual(
366.             list(ma.get_form(request).base_fields),
367.             ["name", "bio", "sign_date", "delete"],
368.         )
369.         self.assertEqual(
370.             type(ma.get_form(request).base_fields["sign_date"].widget), AdminDateWidget
371.         )
372. 
373.     def test_form_exclude_kwarg_override(self):
374.         """
375.         The `exclude` kwarg passed to `ModelAdmin.get_form()` overrides all
376.         other declarations (#8999).
377.         """
378. 
379.         class AdminBandForm(forms.ModelForm):
380.             class Meta:
381.                 model = Band
382.                 exclude = ["name"]
383. 
384.         class BandAdmin(ModelAdmin):
385.             exclude = ["sign_date"]
386.             form = AdminBandForm
387. 
388.             def get_form(self, request, obj=None, **kwargs):
389.                 kwargs["exclude"] = ["bio"]
390.                 return super().get_form(request, obj, **kwargs)
391. 
392.         ma = BandAdmin(Band, self.site)
393.         self.assertEqual(list(ma.get_form(request).base_fields), ["name", "sign_date"])
394. 
395.     def test_formset_exclude_kwarg_override(self):
396.         """
397.         The `exclude` kwarg passed to `InlineModelAdmin.get_formset()`
398.         overrides all other declarations (#8999).
399.         """
400. 
401.         class AdminConcertForm(forms.ModelForm):
402.             class Meta:
403.                 model = Concert
404.                 exclude = ["day"]
405. 
406.         class ConcertInline(TabularInline):
407.             exclude = ["transport"]
408.             form = AdminConcertForm
409.             fk_name = "main_band"
410.             model = Concert
411. 
412.             def get_formset(self, request, obj=None, **kwargs):
413.                 kwargs["exclude"] = ["opening_band"]
414.                 return super().get_formset(request, obj, **kwargs)
415. 
416.         class BandAdmin(ModelAdmin):
417.             inlines = [ConcertInline]
418. 
419.         ma = BandAdmin(Band, self.site)
420.         self.assertEqual(
421.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),
422.             ["main_band", "day", "transport", "id", "DELETE"],
423.         )
424. 
425.     def test_formset_overriding_get_exclude_with_form_fields(self):
426.         class AdminConcertForm(forms.ModelForm):
427.             class Meta:
428.                 model = Concert
429.                 fields = ["main_band", "opening_band", "day", "transport"]
430. 
431.         class ConcertInline(TabularInline):
432.             form = AdminConcertForm
433.             fk_name = "main_band"
434.             model = Concert
435. 
436.             def get_exclude(self, request, obj=None):
437.                 return ["opening_band"]
438. 
439.         class BandAdmin(ModelAdmin):
440.             inlines = [ConcertInline]
441. 
442.         ma = BandAdmin(Band, self.site)
443.         self.assertEqual(
444.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),
445.             ["main_band", "day", "transport", "id", "DELETE"],
446.         )
447. 
448.     def test_formset_overriding_get_exclude_with_form_exclude(self):
449.         class AdminConcertForm(forms.ModelForm):
450.             class Meta:
451.                 model = Concert
452.                 exclude = ["day"]
453. 
454.         class ConcertInline(TabularInline):
455.             form = AdminConcertForm
456.             fk_name = "main_band"
457.             model = Concert
458. 
459.             def get_exclude(self, request, obj=None):
460.                 return ["opening_band"]
461. 
462.         class BandAdmin(ModelAdmin):
463.             inlines = [ConcertInline]
464. 
465.         ma = BandAdmin(Band, self.site)
466.         self.assertEqual(
467.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),
468.             ["main_band", "day", "transport", "id", "DELETE"],
469.         )
470. 
471.     def test_raw_id_fields_widget_override(self):
472.         """
473.         The autocomplete_fields, raw_id_fields, and radio_fields widgets may
474.         overridden by specifying a widget in get_formset().
475.         """
476. 
477.         class ConcertInline(TabularInline):
478.             model = Concert
479.             fk_name = "main_band"
480.             raw_id_fields = ("opening_band",)
481. 
482.             def get_formset(self, request, obj=None, **kwargs):
483.                 kwargs["widgets"] = {"opening_band": Select}
484.                 return super().get_formset(request, obj, **kwargs)
485. 
486.         class BandAdmin(ModelAdmin):
487.             inlines = [ConcertInline]
488. 
489.         ma = BandAdmin(Band, self.site)
490.         band_widget = (
491.             list(ma.get_formsets_with_inlines(request))[0][0]()
492.             .forms[0]
493.             .fields["opening_band"]
494.             .widget
495.         )
496.         # Without the override this would be ForeignKeyRawIdWidget.
497.         self.assertIsInstance(band_widget, Select)
498. 
499.     def test_queryset_override(self):
500.         # If the queryset of a ModelChoiceField in a custom form is overridden,

File: tests/admin_ordering/tests.py
Line number range: 1 - 208
Content:
1. from django.contrib import admin
2. from django.contrib.admin.options import ModelAdmin
3. from django.contrib.auth.models import User
4. from django.db.models import F
5. from django.test import RequestFactory, TestCase
6. 
7. from .models import (
8.     Band,
9.     DynOrderingBandAdmin,
10.     Song,
11.     SongInlineDefaultOrdering,
12.     SongInlineNewOrdering,
13. )
14. 
15. 
16. class MockRequest:
17.     pass
18. 
19. 
20. class MockSuperUser:
21.     def has_perm(self, perm, obj=None):
22.         return True
23. 
24.     def has_module_perms(self, module):
25.         return True
26. 
27. 
28. request = MockRequest()
29. request.user = MockSuperUser()
30. 
31. site = admin.AdminSite()
32. 
33. 
34. class TestAdminOrdering(TestCase):
35.     """
36.     Let's make sure that ModelAdmin.get_queryset uses the ordering we define
37.     in ModelAdmin rather that ordering defined in the model's inner Meta
38.     class.
39.     """
40. 
41.     request_factory = RequestFactory()
42. 
43.     @classmethod
44.     def setUpTestData(cls):
45.         Band.objects.bulk_create(
46.             [
47.                 Band(name="Aerosmith", bio="", rank=3),
48.                 Band(name="Radiohead", bio="", rank=1),
49.                 Band(name="Van Halen", bio="", rank=2),
50.             ]
51.         )
52. 
53.     def test_default_ordering(self):
54.         """
55.         The default ordering should be by name, as specified in the inner Meta
56.         class.
57.         """
58.         ma = ModelAdmin(Band, site)
59.         names = [b.name for b in ma.get_queryset(request)]
60.         self.assertEqual(["Aerosmith", "Radiohead", "Van Halen"], names)
61. 
62.     def test_specified_ordering(self):
63.         """
64.         Let's use a custom ModelAdmin that changes the ordering, and make sure
65.         it actually changes.
66.         """
67. 
68.         class BandAdmin(ModelAdmin):
69.             ordering = ("rank",)  # default ordering is ('name',)
70. 
71.         ma = BandAdmin(Band, site)
72.         names = [b.name for b in ma.get_queryset(request)]
73.         self.assertEqual(["Radiohead", "Van Halen", "Aerosmith"], names)
74. 
75.     def test_specified_ordering_by_f_expression(self):
76.         class BandAdmin(ModelAdmin):
77.             ordering = (F("rank").desc(nulls_last=True),)
78. 
79.         band_admin = BandAdmin(Band, site)
80.         names = [b.name for b in band_admin.get_queryset(request)]
81.         self.assertEqual(["Aerosmith", "Van Halen", "Radiohead"], names)
82. 
83.     def test_dynamic_ordering(self):
84.         """
85.         Let's use a custom ModelAdmin that changes the ordering dynamically.
86.         """
87.         super_user = User.objects.create(username="admin", is_superuser=True)
88.         other_user = User.objects.create(username="other")
89.         request = self.request_factory.get("/")
90.         request.user = super_user
91.         ma = DynOrderingBandAdmin(Band, site)
92.         names = [b.name for b in ma.get_queryset(request)]
93.         self.assertEqual(["Radiohead", "Van Halen", "Aerosmith"], names)
94.         request.user = other_user
95.         names = [b.name for b in ma.get_queryset(request)]
96.         self.assertEqual(["Aerosmith", "Radiohead", "Van Halen"], names)
97. 
98. 
99. class TestInlineModelAdminOrdering(TestCase):
100.     """
101.     Let's make sure that InlineModelAdmin.get_queryset uses the ordering we
102.     define in InlineModelAdmin.
103.     """
104. 
105.     @classmethod
106.     def setUpTestData(cls):
107.         cls.band = Band.objects.create(name="Aerosmith", bio="", rank=3)
108.         Song.objects.bulk_create(
109.             [
110.                 Song(band=cls.band, name="Pink", duration=235),
111.                 Song(band=cls.band, name="Dude (Looks Like a Lady)", duration=264),
112.                 Song(band=cls.band, name="Jaded", duration=214),
113.             ]
114.         )
115. 
116.     def test_default_ordering(self):
117.         """
118.         The default ordering should be by name, as specified in the inner Meta
119.         class.
120.         """
121.         inline = SongInlineDefaultOrdering(self.band, site)
122.         names = [s.name for s in inline.get_queryset(request)]
123.         self.assertEqual(["Dude (Looks Like a Lady)", "Jaded", "Pink"], names)
124. 
125.     def test_specified_ordering(self):
126.         """
127.         Let's check with ordering set to something different than the default.
128.         """
129.         inline = SongInlineNewOrdering(self.band, site)
130.         names = [s.name for s in inline.get_queryset(request)]
131.         self.assertEqual(["Jaded", "Pink", "Dude (Looks Like a Lady)"], names)
132. 
133. 
134. class TestRelatedFieldsAdminOrdering(TestCase):
135.     @classmethod
136.     def setUpTestData(cls):
137.         cls.b1 = Band.objects.create(name="Pink Floyd", bio="", rank=1)
138.         cls.b2 = Band.objects.create(name="Foo Fighters", bio="", rank=5)
139. 
140.     def setUp(self):
141.         # we need to register a custom ModelAdmin (instead of just using
142.         # ModelAdmin) because the field creator tries to find the ModelAdmin
143.         # for the related model
144.         class SongAdmin(admin.ModelAdmin):
145.             pass
146. 
147.         site.register(Song, SongAdmin)
148. 
149.     def tearDown(self):
150.         site.unregister(Song)
151.         if Band in site._registry:
152.             site.unregister(Band)
153. 
154.     def check_ordering_of_field_choices(self, correct_ordering):
155.         fk_field = site._registry[Song].formfield_for_foreignkey(
156.             Song.band.field, request=None
157.         )
158.         m2m_field = site._registry[Song].formfield_for_manytomany(
159.             Song.other_interpreters.field, request=None
160.         )
161.         self.assertEqual(list(fk_field.queryset), correct_ordering)
162.         self.assertEqual(list(m2m_field.queryset), correct_ordering)
163. 
164.     def test_no_admin_fallback_to_model_ordering(self):
165.         # should be ordered by name (as defined by the model)
166.         self.check_ordering_of_field_choices([self.b2, self.b1])
167. 
168.     def test_admin_with_no_ordering_fallback_to_model_ordering(self):
169.         class NoOrderingBandAdmin(admin.ModelAdmin):
170.             pass
171. 
172.         site.register(Band, NoOrderingBandAdmin)
173. 
174.         # should be ordered by name (as defined by the model)
175.         self.check_ordering_of_field_choices([self.b2, self.b1])
176. 
177.     def test_admin_ordering_beats_model_ordering(self):
178.         class StaticOrderingBandAdmin(admin.ModelAdmin):
179.             ordering = ("rank",)
180. 
181.         site.register(Band, StaticOrderingBandAdmin)
182. 
183.         # should be ordered by rank (defined by the ModelAdmin)
184.         self.check_ordering_of_field_choices([self.b1, self.b2])
185. 
186.     def test_custom_queryset_still_wins(self):
187.         """Custom queryset has still precedence (#21405)"""
188. 
189.         class SongAdmin(admin.ModelAdmin):
190.             # Exclude one of the two Bands from the querysets
191.             def formfield_for_foreignkey(self, db_field, request, **kwargs):
192.                 if db_field.name == "band":
193.                     kwargs["queryset"] = Band.objects.filter(rank__gt=2)
194.                 return super().formfield_for_foreignkey(db_field, request, **kwargs)
195. 
196.             def formfield_for_manytomany(self, db_field, request, **kwargs):
197.                 if db_field.name == "other_interpreters":
198.                     kwargs["queryset"] = Band.objects.filter(rank__gt=2)
199.                 return super().formfield_for_foreignkey(db_field, request, **kwargs)
200. 
201.         class StaticOrderingBandAdmin(admin.ModelAdmin):
202.             ordering = ("rank",)
203. 
204.         site.unregister(Song)
205.         site.register(Song, SongAdmin)
206.         site.register(Band, StaticOrderingBandAdmin)
207. 
208.         self.check_ordering_of_field_choices([self.b2])

File: tests/modeladmin/tests.py
Line number range: 41 - 805
Content:
class ModelAdminTests(TestCase):
    @classmethod
    def setUpTestData(cls):
        cls.band = Band.objects.create(
            name="The Doors",
            bio="",
            sign_date=date(1965, 1, 1),
        )

    def setUp(self):
        self.site = AdminSite()

    def test_modeladmin_str(self):
        ma = ModelAdmin(Band, self.site)
        self.assertEqual(str(ma), "modeladmin.ModelAdmin")

    def test_default_attributes(self):
        ma = ModelAdmin(Band, self.site)
        self.assertEqual(ma.actions, ())
        self.assertEqual(ma.inlines, ())

    # form/fields/fieldsets interaction ##############################

    def test_default_fields(self):
        ma = ModelAdmin(Band, self.site)
        self.assertEqual(
            list(ma.get_form(request).base_fields), ["name", "bio", "sign_date"]
        )
        self.assertEqual(list(ma.get_fields(request)), ["name", "bio", "sign_date"])
        self.assertEqual(
            list(ma.get_fields(request, self.band)), ["name", "bio", "sign_date"]
        )
        self.assertIsNone(ma.get_exclude(request, self.band))

    def test_default_fieldsets(self):
        # fieldsets_add and fieldsets_change should return a special data structure that
        # is used in the templates. They should generate the "right thing" whether we
        # have specified a custom form, the fields argument, or nothing at all.
        #
        # Here's the default case. There are no custom form_add/form_change methods,
        # no fields argument, and no fieldsets argument.
        ma = ModelAdmin(Band, self.site)
        self.assertEqual(
            ma.get_fieldsets(request),
            [(None, {"fields": ["name", "bio", "sign_date"]})],
        )
        self.assertEqual(
            ma.get_fieldsets(request, self.band),
            [(None, {"fields": ["name", "bio", "sign_date"]})],
        )

    def test_get_fieldsets(self):
        # get_fieldsets() is called when figuring out form fields (#18681).
        class BandAdmin(ModelAdmin):
            def get_fieldsets(self, request, obj=None):
                return [(None, {"fields": ["name", "bio"]})]

        ma = BandAdmin(Band, self.site)
        form = ma.get_form(None)
        self.assertEqual(form._meta.fields, ["name", "bio"])

        class InlineBandAdmin(TabularInline):
            model = Concert
            fk_name = "main_band"
            can_delete = False

            def get_fieldsets(self, request, obj=None):
                return [(None, {"fields": ["day", "transport"]})]

        ma = InlineBandAdmin(Band, self.site)
        form = ma.get_formset(None).form
        self.assertEqual(form._meta.fields, ["day", "transport"])

    def test_lookup_allowed_allows_nonexistent_lookup(self):
        """
        A lookup_allowed allows a parameter whose field lookup doesn't exist.
        (#21129).
        """

        class BandAdmin(ModelAdmin):
            fields = ["name"]

        ma = BandAdmin(Band, self.site)
        self.assertTrue(ma.lookup_allowed("name__nonexistent", "test_value"))

    @isolate_apps("modeladmin")
    def test_lookup_allowed_onetoone(self):
        class Department(models.Model):
            code = models.CharField(max_length=4, unique=True)

        class Employee(models.Model):
            department = models.ForeignKey(Department, models.CASCADE, to_field="code")

        class EmployeeProfile(models.Model):
            employee = models.OneToOneField(Employee, models.CASCADE)

        class EmployeeInfo(models.Model):
            employee = models.OneToOneField(Employee, models.CASCADE)
            description = models.CharField(max_length=100)

        class EmployeeProfileAdmin(ModelAdmin):
            list_filter = [
                "employee__employeeinfo__description",
                "employee__department__code",
            ]

        ma = EmployeeProfileAdmin(EmployeeProfile, self.site)
        # Reverse OneToOneField
        self.assertIs(
            ma.lookup_allowed("employee__employeeinfo__description", "test_value"), True
        )
        # OneToOneField and ForeignKey
        self.assertIs(
            ma.lookup_allowed("employee__department__code", "test_value"), True
        )

    def test_field_arguments(self):
        # If fields is specified, fieldsets_add and fieldsets_change should
        # just stick the fields into a formsets structure and return it.
        class BandAdmin(ModelAdmin):
            fields = ["name"]

        ma = BandAdmin(Band, self.site)

        self.assertEqual(list(ma.get_fields(request)), ["name"])
        self.assertEqual(list(ma.get_fields(request, self.band)), ["name"])
        self.assertEqual(ma.get_fieldsets(request), [(None, {"fields": ["name"]})])
        self.assertEqual(
            ma.get_fieldsets(request, self.band), [(None, {"fields": ["name"]})]
        )

    def test_field_arguments_restricted_on_form(self):
        # If fields or fieldsets is specified, it should exclude fields on the
        # Form class to the fields specified. This may cause errors to be
        # raised in the db layer if required model fields aren't in fields/
        # fieldsets, but that's preferable to ghost errors where a field in the
        # Form class isn't being displayed because it's not in fields/fieldsets.

        # Using `fields`.
        class BandAdmin(ModelAdmin):
            fields = ["name"]

        ma = BandAdmin(Band, self.site)
        self.assertEqual(list(ma.get_form(request).base_fields), ["name"])
        self.assertEqual(list(ma.get_form(request, self.band).base_fields), ["name"])

        # Using `fieldsets`.
        class BandAdmin(ModelAdmin):
            fieldsets = [(None, {"fields": ["name"]})]

        ma = BandAdmin(Band, self.site)
        self.assertEqual(list(ma.get_form(request).base_fields), ["name"])
        self.assertEqual(list(ma.get_form(request, self.band).base_fields), ["name"])

        # Using `exclude`.
        class BandAdmin(ModelAdmin):
            exclude = ["bio"]

        ma = BandAdmin(Band, self.site)
        self.assertEqual(list(ma.get_form(request).base_fields), ["name", "sign_date"])

        # You can also pass a tuple to `exclude`.
        class BandAdmin(ModelAdmin):
            exclude = ("bio",)

        ma = BandAdmin(Band, self.site)
        self.assertEqual(list(ma.get_form(request).base_fields), ["name", "sign_date"])

        # Using `fields` and `exclude`.
        class BandAdmin(ModelAdmin):
            fields = ["name", "bio"]
            exclude = ["bio"]

        ma = BandAdmin(Band, self.site)
        self.assertEqual(list(ma.get_form(request).base_fields), ["name"])

    def test_custom_form_meta_exclude_with_readonly(self):
        """
        The custom ModelForm's `Meta.exclude` is respected when used in
        conjunction with `ModelAdmin.readonly_fields` and when no
        `ModelAdmin.exclude` is defined (#14496).
        """
        # With ModelAdmin
        class AdminBandForm(forms.ModelForm):
            class Meta:
                model = Band
                exclude = ["bio"]

        class BandAdmin(ModelAdmin):
            readonly_fields = ["name"]
            form = AdminBandForm

        ma = BandAdmin(Band, self.site)
        self.assertEqual(list(ma.get_form(request).base_fields), ["sign_date"])

        # With InlineModelAdmin
        class AdminConcertForm(forms.ModelForm):
            class Meta:
                model = Concert
                exclude = ["day"]

        class ConcertInline(TabularInline):
            readonly_fields = ["transport"]
            form = AdminConcertForm
            fk_name = "main_band"
            model = Concert

        class BandAdmin(ModelAdmin):
            inlines = [ConcertInline]

        ma = BandAdmin(Band, self.site)
        self.assertEqual(
            list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),
            ["main_band", "opening_band", "id", "DELETE"],
        )

    def test_custom_formfield_override_readonly(self):
        class AdminBandForm(forms.ModelForm):
            name = forms.CharField()

            class Meta:
                exclude = ()
                model = Band

        class BandAdmin(ModelAdmin):
            form = AdminBandForm
            readonly_fields = ["name"]

        ma = BandAdmin(Band, self.site)

        # `name` shouldn't appear in base_fields because it's part of
        # readonly_fields.
        self.assertEqual(list(ma.get_form(request).base_fields), ["bio", "sign_date"])
        # But it should appear in get_fields()/fieldsets() so it can be
        # displayed as read-only.
        self.assertEqual(list(ma.get_fields(request)), ["bio", "sign_date", "name"])
        self.assertEqual(
            list(ma.get_fieldsets(request)),
            [(None, {"fields": ["bio", "sign_date", "name"]})],
        )

    def test_custom_form_meta_exclude(self):
        """
        The custom ModelForm's `Meta.exclude` is overridden if
        `ModelAdmin.exclude` or `InlineModelAdmin.exclude` are defined (#14496).
        """
        # With ModelAdmin
        class AdminBandForm(forms.ModelForm):
            class Meta:
                model = Band
                exclude = ["bio"]

        class BandAdmin(ModelAdmin):
            exclude = ["name"]
            form = AdminBandForm

        ma = BandAdmin(Band, self.site)
        self.assertEqual(list(ma.get_form(request).base_fields), ["bio", "sign_date"])

        # With InlineModelAdmin
        class AdminConcertForm(forms.ModelForm):
            class Meta:
                model = Concert
                exclude = ["day"]

        class ConcertInline(TabularInline):
            exclude = ["transport"]
            form = AdminConcertForm
            fk_name = "main_band"
            model = Concert

        class BandAdmin(ModelAdmin):
            inlines = [ConcertInline]

        ma = BandAdmin(Band, self.site)
        self.assertEqual(
            list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),
            ["main_band", "opening_band", "day", "id", "DELETE"],
        )

    def test_overriding_get_exclude(self):
        class BandAdmin(ModelAdmin):
            def get_exclude(self, request, obj=None):
                return ["name"]

        self.assertEqual(
            list(BandAdmin(Band, self.site).get_form(request).base_fields),
            ["bio", "sign_date"],
        )

    def test_get_exclude_overrides_exclude(self):
        class BandAdmin(ModelAdmin):
            exclude = ["bio"]

            def get_exclude(self, request, obj=None):
                return ["name"]

        self.assertEqual(
            list(BandAdmin(Band, self.site).get_form(request).base_fields),
            ["bio", "sign_date"],
        )

    def test_get_exclude_takes_obj(self):
        class BandAdmin(ModelAdmin):
            def get_exclude(self, request, obj=None):
                if obj:
                    return ["sign_date"]
                return ["name"]

        self.assertEqual(
            list(BandAdmin(Band, self.site).get_form(request, self.band).base_fields),
            ["name", "bio"],
        )

    def test_custom_form_validation(self):
        # If a form is specified, it should use it allowing custom validation
        # to work properly. This won't break any of the admin widgets or media.
        class AdminBandForm(forms.ModelForm):
            delete = forms.BooleanField()

        class BandAdmin(ModelAdmin):
            form = AdminBandForm

        ma = BandAdmin(Band, self.site)
        self.assertEqual(
            list(ma.get_form(request).base_fields),
            ["name", "bio", "sign_date", "delete"],
        )
        self.assertEqual(
            type(ma.get_form(request).base_fields["sign_date"].widget), AdminDateWidget
        )

    def test_form_exclude_kwarg_override(self):
        """
        The `exclude` kwarg passed to `ModelAdmin.get_form()` overrides all
        other declarations (#8999).
        """

        class AdminBandForm(forms.ModelForm):
            class Meta:
                model = Band
                exclude = ["name"]

        class BandAdmin(ModelAdmin):
            exclude = ["sign_date"]
            form = AdminBandForm

            def get_form(self, request, obj=None, **kwargs):
                kwargs["exclude"] = ["bio"]
                return super().get_form(request, obj, **kwargs)

        ma = BandAdmin(Band, self.site)
        self.assertEqual(list(ma.get_form(request).base_fields), ["name", "sign_date"])

    def test_formset_exclude_kwarg_override(self):
        """
        The `exclude` kwarg passed to `InlineModelAdmin.get_formset()`
        overrides all other declarations (#8999).
        """

        class AdminConcertForm(forms.ModelForm):
            class Meta:
                model = Concert
                exclude = ["day"]

        class ConcertInline(TabularInline):
            exclude = ["transport"]
            form = AdminConcertForm
            fk_name = "main_band"
            model = Concert

            def get_formset(self, request, obj=None, **kwargs):
                kwargs["exclude"] = ["opening_band"]
                return super().get_formset(request, obj, **kwargs)

        class BandAdmin(ModelAdmin):
            inlines = [ConcertInline]

        ma = BandAdmin(Band, self.site)
        self.assertEqual(
            list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),
            ["main_band", "day", "transport", "id", "DELETE"],
        )

    def test_formset_overriding_get_exclude_with_form_fields(self):
        class AdminConcertForm(forms.ModelForm):
            class Meta:
                model = Concert
                fields = ["main_band", "opening_band", "day", "transport"]

        class ConcertInline(TabularInline):
            form = AdminConcertForm
            fk_name = "main_band"
            model = Concert

            def get_exclude(self, request, obj=None):
                return ["opening_band"]

        class BandAdmin(ModelAdmin):
            inlines = [ConcertInline]

        ma = BandAdmin(Band, self.site)
        self.assertEqual(
            list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),
            ["main_band", "day", "transport", "id", "DELETE"],
        )

    def test_formset_overriding_get_exclude_with_form_exclude(self):
        class AdminConcertForm(forms.ModelForm):
            class Meta:
                model = Concert
                exclude = ["day"]

        class ConcertInline(TabularInline):
            form = AdminConcertForm
            fk_name = "main_band"
            model = Concert

            def get_exclude(self, request, obj=None):
                return ["opening_band"]

        class BandAdmin(ModelAdmin):
            inlines = [ConcertInline]

        ma = BandAdmin(Band, self.site)
        self.assertEqual(
            list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),
            ["main_band", "day", "transport", "id", "DELETE"],
        )

    def test_raw_id_fields_widget_override(self):
        """
        The autocomplete_fields, raw_id_fields, and radio_fields widgets may
        overridden by specifying a widget in get_formset().
        """

        class ConcertInline(TabularInline):
            model = Concert
            fk_name = "main_band"
            raw_id_fields = ("opening_band",)

            def get_formset(self, request, obj=None, **kwargs):
                kwargs["widgets"] = {"opening_band": Select}
                return super().get_formset(request, obj, **kwargs)

        class BandAdmin(ModelAdmin):
            inlines = [ConcertInline]

        ma = BandAdmin(Band, self.site)
        band_widget = (
            list(ma.get_formsets_with_inlines(request))[0][0]()
            .forms[0]
            .fields["opening_band"]
            .widget
        )
        # Without the override this would be ForeignKeyRawIdWidget.
        self.assertIsInstance(band_widget, Select)

    def test_queryset_override(self):
        # If the queryset of a ModelChoiceField in a custom form is overridden,
        # RelatedFieldWidgetWrapper doesn't mess that up.
        band2 = Band.objects.create(
            name="The Beatles", bio="", sign_date=date(1962, 1, 1)
        )

        ma = ModelAdmin(Concert, self.site)
        form = ma.get_form(request)()

        self.assertHTMLEqual(
            str(form["main_band"]),
            '<div class="related-widget-wrapper">'
            '<select name="main_band" id="id_main_band" required>'
            '<option value="" selected>---------</option>'
            '<option value="%d">The Beatles</option>'
            '<option value="%d">The Doors</option>'
            "</select></div>" % (band2.id, self.band.id),
        )

        class AdminConcertForm(forms.ModelForm):
            def __init__(self, *args, **kwargs):
                super().__init__(*args, **kwargs)
                self.fields["main_band"].queryset = Band.objects.filter(
                    name="The Doors"
                )

        class ConcertAdminWithForm(ModelAdmin):
            form = AdminConcertForm

        ma = ConcertAdminWithForm(Concert, self.site)
        form = ma.get_form(request)()

        self.assertHTMLEqual(
            str(form["main_band"]),
            '<div class="related-widget-wrapper">'
            '<select name="main_band" id="id_main_band" required>'
            '<option value="" selected>---------</option>'
            '<option value="%d">The Doors</option>'
            "</select></div>" % self.band.id,
        )

    def test_regression_for_ticket_15820(self):
        """
        `obj` is passed from `InlineModelAdmin.get_fieldsets()` to
        `InlineModelAdmin.get_formset()`.
        """

        class CustomConcertForm(forms.ModelForm):
            class Meta:
                model = Concert
                fields = ["day"]

        class ConcertInline(TabularInline):
            model = Concert
            fk_name = "main_band"

            def get_formset(self, request, obj=None, **kwargs):
                if obj:
                    kwargs["form"] = CustomConcertForm
                return super().get_formset(request, obj, **kwargs)

        class BandAdmin(ModelAdmin):
            inlines = [ConcertInline]

        Concert.objects.create(main_band=self.band, opening_band=self.band, day=1)
        ma = BandAdmin(Band, self.site)
        inline_instances = ma.get_inline_instances(request)
        fieldsets = list(inline_instances[0].get_fieldsets(request))
        self.assertEqual(
            fieldsets[0][1]["fields"], ["main_band", "opening_band", "day", "transport"]
        )
        fieldsets = list(
            inline_instances[0].get_fieldsets(request, inline_instances[0].model)
        )
        self.assertEqual(fieldsets[0][1]["fields"], ["day"])

    # radio_fields behavior ###########################################

    def test_default_foreign_key_widget(self):
        # First, without any radio_fields specified, the widgets for ForeignKey
        # and fields with choices specified ought to be a basic Select widget.
        # ForeignKey widgets in the admin are wrapped with RelatedFieldWidgetWrapper so
        # they need to be handled properly when type checking. For Select fields, all of
        # the choices lists have a first entry of dashes.
        cma = ModelAdmin(Concert, self.site)
        cmafa = cma.get_form(request)

        self.assertEqual(type(cmafa.base_fields["main_band"].widget.widget), Select)
        self.assertEqual(
            list(cmafa.base_fields["main_band"].widget.choices),
            [("", "---------"), (self.band.id, "The Doors")],
        )

        self.assertEqual(type(cmafa.base_fields["opening_band"].widget.widget), Select)
        self.assertEqual(
            list(cmafa.base_fields["opening_band"].widget.choices),
            [("", "---------"), (self.band.id, "The Doors")],
        )
        self.assertEqual(type(cmafa.base_fields["day"].widget), Select)
        self.assertEqual(
            list(cmafa.base_fields["day"].widget.choices),
            [("", "---------"), (1, "Fri"), (2, "Sat")],
        )
        self.assertEqual(type(cmafa.base_fields["transport"].widget), Select)
        self.assertEqual(
            list(cmafa.base_fields["transport"].widget.choices),
            [("", "---------"), (1, "Plane"), (2, "Train"), (3, "Bus")],
        )

    def test_foreign_key_as_radio_field(self):
        # Now specify all the fields as radio_fields.  Widgets should now be
        # RadioSelect, and the choices list should have a first entry of 'None' if
        # blank=True for the model field.  Finally, the widget should have the
        # 'radiolist' attr, and 'inline' as well if the field is specified HORIZONTAL.
        class ConcertAdmin(ModelAdmin):
            radio_fields = {
                "main_band": HORIZONTAL,
                "opening_band": VERTICAL,
                "day": VERTICAL,
                "transport": HORIZONTAL,
            }

        cma = ConcertAdmin(Concert, self.site)
        cmafa = cma.get_form(request)

        self.assertEqual(
            type(cmafa.base_fields["main_band"].widget.widget), AdminRadioSelect
        )
        self.assertEqual(
            cmafa.base_fields["main_band"].widget.attrs, {"class": "radiolist inline"}
        )
        self.assertEqual(
            list(cmafa.base_fields["main_band"].widget.choices),
            [(self.band.id, "The Doors")],
        )

        self.assertEqual(
            type(cmafa.base_fields["opening_band"].widget.widget), AdminRadioSelect
        )
        self.assertEqual(
            cmafa.base_fields["opening_band"].widget.attrs, {"class": "radiolist"}
        )
        self.assertEqual(
            list(cmafa.base_fields["opening_band"].widget.choices),
            [("", "None"), (self.band.id, "The Doors")],
        )
        self.assertEqual(type(cmafa.base_fields["day"].widget), AdminRadioSelect)
        self.assertEqual(cmafa.base_fields["day"].widget.attrs, {"class": "radiolist"})
        self.assertEqual(
            list(cmafa.base_fields["day"].widget.choices), [(1, "Fri"), (2, "Sat")]
        )

        self.assertEqual(type(cmafa.base_fields["transport"].widget), AdminRadioSelect)
        self.assertEqual(
            cmafa.base_fields["transport"].widget.attrs, {"class": "radiolist inline"}
        )
        self.assertEqual(
            list(cmafa.base_fields["transport"].widget.choices),
            [("", "None"), (1, "Plane"), (2, "Train"), (3, "Bus")],
        )

        class AdminConcertForm(forms.ModelForm):
            class Meta:
                model = Concert
                exclude = ("transport",)

        class ConcertAdmin(ModelAdmin):
            form = AdminConcertForm

        ma = ConcertAdmin(Concert, self.site)
        self.assertEqual(
            list(ma.get_form(request).base_fields), ["main_band", "opening_band", "day"]
        )

        class AdminConcertForm(forms.ModelForm):
            extra = forms.CharField()

            class Meta:
                model = Concert
                fields = ["extra", "transport"]

        class ConcertAdmin(ModelAdmin):
            form = AdminConcertForm

        ma = ConcertAdmin(Concert, self.site)
        self.assertEqual(list(ma.get_form(request).base_fields), ["extra", "transport"])

        class ConcertInline(TabularInline):
            form = AdminConcertForm
            model = Concert
            fk_name = "main_band"
            can_delete = True

        class BandAdmin(ModelAdmin):
            inlines = [ConcertInline]

        ma = BandAdmin(Band, self.site)
        self.assertEqual(
            list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),
            ["extra", "transport", "id", "DELETE", "main_band"],
        )

    def test_log_actions(self):
        ma = ModelAdmin(Band, self.site)
        mock_request = MockRequest()
        mock_request.user = User.objects.create(username="bill")
        content_type = get_content_type_for_model(self.band)
        tests = (
            (ma.log_addition, ADDITION, {"added": {}}),
            (ma.log_change, CHANGE, {"changed": {"fields": ["name", "bio"]}}),
            (ma.log_deletion, DELETION, str(self.band)),
        )
        for method, flag, message in tests:
            with self.subTest(name=method.__name__):
                created = method(mock_request, self.band, message)
                fetched = LogEntry.objects.filter(action_flag=flag).latest("id")
                self.assertEqual(created, fetched)
                self.assertEqual(fetched.action_flag, flag)
                self.assertEqual(fetched.content_type, content_type)
                self.assertEqual(fetched.object_id, str(self.band.pk))
                self.assertEqual(fetched.user, mock_request.user)
                if flag == DELETION:
                    self.assertEqual(fetched.change_message, "")
                    self.assertEqual(fetched.object_repr, message)
                else:
                    self.assertEqual(fetched.change_message, str(message))
                    self.assertEqual(fetched.object_repr, str(self.band))

    def test_get_autocomplete_fields(self):
        class NameAdmin(ModelAdmin):
            search_fields = ["name"]

        class SongAdmin(ModelAdmin):
            autocomplete_fields = ["featuring"]
            fields = ["featuring", "band"]

        class OtherSongAdmin(SongAdmin):
            def get_autocomplete_fields(self, request):
                return ["band"]

        self.site.register(Band, NameAdmin)
        try:
            # Uses autocomplete_fields if not overridden.
            model_admin = SongAdmin(Song, self.site)
            form = model_admin.get_form(request)()
            self.assertIsInstance(
                form.fields["featuring"].widget.widget, AutocompleteSelectMultiple
            )
            # Uses overridden get_autocomplete_fields
            model_admin = OtherSongAdmin(Song, self.site)
            form = model_admin.get_form(request)()
            self.assertIsInstance(form.fields["band"].widget.widget, AutocompleteSelect)
        finally:
            self.site.unregister(Band)

    def test_get_deleted_objects(self):
        mock_request = MockRequest()
        mock_request.user = User.objects.create_superuser(
            username="bob", email="bob@test.com", password="test"
        )
        self.site.register(Band, ModelAdmin)
        ma = self.site._registry[Band]
        (
            deletable_objects,
            model_count,
            perms_needed,
            protected,
        ) = ma.get_deleted_objects([self.band], request)
        self.assertEqual(deletable_objects, ["Band: The Doors"])
        self.assertEqual(model_count, {"bands": 1})
        self.assertEqual(perms_needed, set())
        self.assertEqual(protected, [])

    def test_get_deleted_objects_with_custom_has_delete_permission(self):
        """
        ModelAdmin.get_deleted_objects() uses ModelAdmin.has_delete_permission()
        for permissions checking.
        """
        mock_request = MockRequest()
        mock_request.user = User.objects.create_superuser(
            username="bob", email="bob@test.com", password="test"
        )

        class TestModelAdmin(ModelAdmin):
            def has_delete_permission(self, request, obj=None):
                return False

        self.site.register(Band, TestModelAdmin)
        ma = self.site._registry[Band]
        (
            deletable_objects,
            model_count,
            perms_needed,
            protected,
        ) = ma.get_deleted_objects([self.band], request)
        self.assertEqual(deletable_objects, ["Band: The Doors"])
        self.assertEqual(model_count, {"bands": 1})
        self.assertEqual(perms_needed, {"band"})
        self.assertEqual(protected, [])

    def test_modeladmin_repr(self):
        ma = ModelAdmin(Band, self.site)
        self.assertEqual(
            repr(ma),
            "<ModelAdmin: model=Band site=AdminSite(name='admin')>",
        )

File: tests/admin_widgets/tests.py
Line number range: 1 - 500
Content:
1. import gettext
2. import os
3. import re
4. from datetime import datetime, timedelta
5. from importlib import import_module
6. 
7. try:
8.     import zoneinfo
9. except ImportError:
10.     from backports import zoneinfo
11. 
12. from django import forms
13. from django.conf import settings
14. from django.contrib import admin
15. from django.contrib.admin import widgets
16. from django.contrib.admin.tests import AdminSeleniumTestCase
17. from django.contrib.auth.models import User
18. from django.core.files.storage import default_storage
19. from django.core.files.uploadedfile import SimpleUploadedFile
20. from django.db.models import (
21.     CharField,
22.     DateField,
23.     DateTimeField,
24.     ManyToManyField,
25.     UUIDField,
26. )
27. from django.test import SimpleTestCase, TestCase, override_settings
28. from django.urls import reverse
29. from django.utils import translation
30. 
31. from .models import (
32.     Advisor,
33.     Album,
34.     Band,
35.     Bee,
36.     Car,
37.     Company,
38.     Event,
39.     Honeycomb,
40.     Individual,
41.     Inventory,
42.     Member,
43.     MyFileField,
44.     Profile,
45.     ReleaseEvent,
46.     School,
47.     Student,
48.     UnsafeLimitChoicesTo,
49.     VideoStream,
50. )
51. from .widgetadmin import site as widget_admin_site
52. 
53. 
54. class TestDataMixin:
55.     @classmethod
56.     def setUpTestData(cls):
57.         cls.superuser = User.objects.create_superuser(
58.             username="super", password="secret", email=None
59.         )
60.         cls.u2 = User.objects.create_user(username="testser", password="secret")
61.         Car.objects.create(owner=cls.superuser, make="Volkswagen", model="Passat")
62.         Car.objects.create(owner=cls.u2, make="BMW", model="M3")
63. 
64. 
65. class AdminFormfieldForDBFieldTests(SimpleTestCase):
66.     """
67.     Tests for correct behavior of ModelAdmin.formfield_for_dbfield
68.     """
69. 
70.     def assertFormfield(self, model, fieldname, widgetclass, **admin_overrides):
71.         """
72.         Helper to call formfield_for_dbfield for a given model and field name
73.         and verify that the returned formfield is appropriate.
74.         """
75.         # Override any settings on the model admin
76.         class MyModelAdmin(admin.ModelAdmin):
77.             pass
78. 
79.         for k in admin_overrides:
80.             setattr(MyModelAdmin, k, admin_overrides[k])
81. 
82.         # Construct the admin, and ask it for a formfield
83.         ma = MyModelAdmin(model, admin.site)
84.         ff = ma.formfield_for_dbfield(model._meta.get_field(fieldname), request=None)
85. 
86.         # "unwrap" the widget wrapper, if needed
87.         if isinstance(ff.widget, widgets.RelatedFieldWidgetWrapper):
88.             widget = ff.widget.widget
89.         else:
90.             widget = ff.widget
91. 
92.         self.assertIsInstance(widget, widgetclass)
93. 
94.         # Return the formfield so that other tests can continue
95.         return ff
96. 
97.     def test_DateField(self):
98.         self.assertFormfield(Event, "start_date", widgets.AdminDateWidget)
99. 
100.     def test_DateTimeField(self):
101.         self.assertFormfield(Member, "birthdate", widgets.AdminSplitDateTime)
102. 
103.     def test_TimeField(self):
104.         self.assertFormfield(Event, "start_time", widgets.AdminTimeWidget)
105. 
106.     def test_TextField(self):
107.         self.assertFormfield(Event, "description", widgets.AdminTextareaWidget)
108. 
109.     def test_URLField(self):
110.         self.assertFormfield(Event, "link", widgets.AdminURLFieldWidget)
111. 
112.     def test_IntegerField(self):
113.         self.assertFormfield(Event, "min_age", widgets.AdminIntegerFieldWidget)
114. 
115.     def test_CharField(self):
116.         self.assertFormfield(Member, "name", widgets.AdminTextInputWidget)
117. 
118.     def test_EmailField(self):
119.         self.assertFormfield(Member, "email", widgets.AdminEmailInputWidget)
120. 
121.     def test_FileField(self):
122.         self.assertFormfield(Album, "cover_art", widgets.AdminFileWidget)
123. 
124.     def test_ForeignKey(self):
125.         self.assertFormfield(Event, "main_band", forms.Select)
126. 
127.     def test_raw_id_ForeignKey(self):
128.         self.assertFormfield(
129.             Event,
130.             "main_band",
131.             widgets.ForeignKeyRawIdWidget,
132.             raw_id_fields=["main_band"],
133.         )
134. 
135.     def test_radio_fields_ForeignKey(self):
136.         ff = self.assertFormfield(
137.             Event,
138.             "main_band",
139.             widgets.AdminRadioSelect,
140.             radio_fields={"main_band": admin.VERTICAL},
141.         )
142.         self.assertIsNone(ff.empty_label)
143. 
144.     def test_many_to_many(self):
145.         self.assertFormfield(Band, "members", forms.SelectMultiple)
146. 
147.     def test_raw_id_many_to_many(self):
148.         self.assertFormfield(
149.             Band, "members", widgets.ManyToManyRawIdWidget, raw_id_fields=["members"]
150.         )
151. 
152.     def test_filtered_many_to_many(self):
153.         self.assertFormfield(
154.             Band, "members", widgets.FilteredSelectMultiple, filter_vertical=["members"]
155.         )
156. 
157.     def test_formfield_overrides(self):
158.         self.assertFormfield(
159.             Event,
160.             "start_date",
161.             forms.TextInput,
162.             formfield_overrides={DateField: {"widget": forms.TextInput}},
163.         )
164. 
165.     def test_formfield_overrides_widget_instances(self):
166.         """
167.         Widget instances in formfield_overrides are not shared between
168.         different fields. (#19423)
169.         """
170. 
171.         class BandAdmin(admin.ModelAdmin):
172.             formfield_overrides = {
173.                 CharField: {"widget": forms.TextInput(attrs={"size": "10"})}
174.             }
175. 
176.         ma = BandAdmin(Band, admin.site)
177.         f1 = ma.formfield_for_dbfield(Band._meta.get_field("name"), request=None)
178.         f2 = ma.formfield_for_dbfield(Band._meta.get_field("style"), request=None)
179.         self.assertNotEqual(f1.widget, f2.widget)
180.         self.assertEqual(f1.widget.attrs["maxlength"], "100")
181.         self.assertEqual(f2.widget.attrs["maxlength"], "20")
182.         self.assertEqual(f2.widget.attrs["size"], "10")
183. 
184.     def test_formfield_overrides_m2m_filter_widget(self):
185.         """
186.         The autocomplete_fields, raw_id_fields, filter_vertical, and
187.         filter_horizontal widgets for ManyToManyFields may be overridden by
188.         specifying a widget in formfield_overrides.
189.         """
190. 
191.         class BandAdmin(admin.ModelAdmin):
192.             filter_vertical = ["members"]
193.             formfield_overrides = {
194.                 ManyToManyField: {"widget": forms.CheckboxSelectMultiple},
195.             }
196. 
197.         ma = BandAdmin(Band, admin.site)
198.         field = ma.formfield_for_dbfield(Band._meta.get_field("members"), request=None)
199.         self.assertIsInstance(field.widget.widget, forms.CheckboxSelectMultiple)
200. 
201.     def test_formfield_overrides_for_datetime_field(self):
202.         """
203.         Overriding the widget for DateTimeField doesn't overrides the default
204.         form_class for that field (#26449).
205.         """
206. 
207.         class MemberAdmin(admin.ModelAdmin):
208.             formfield_overrides = {
209.                 DateTimeField: {"widget": widgets.AdminSplitDateTime}
210.             }
211. 
212.         ma = MemberAdmin(Member, admin.site)
213.         f1 = ma.formfield_for_dbfield(Member._meta.get_field("birthdate"), request=None)
214.         self.assertIsInstance(f1.widget, widgets.AdminSplitDateTime)
215.         self.assertIsInstance(f1, forms.SplitDateTimeField)
216. 
217.     def test_formfield_overrides_for_custom_field(self):
218.         """
219.         formfield_overrides works for a custom field class.
220.         """
221. 
222.         class AlbumAdmin(admin.ModelAdmin):
223.             formfield_overrides = {MyFileField: {"widget": forms.TextInput()}}
224. 
225.         ma = AlbumAdmin(Member, admin.site)
226.         f1 = ma.formfield_for_dbfield(
227.             Album._meta.get_field("backside_art"), request=None
228.         )
229.         self.assertIsInstance(f1.widget, forms.TextInput)
230. 
231.     def test_field_with_choices(self):
232.         self.assertFormfield(Member, "gender", forms.Select)
233. 
234.     def test_choices_with_radio_fields(self):
235.         self.assertFormfield(
236.             Member,
237.             "gender",
238.             widgets.AdminRadioSelect,
239.             radio_fields={"gender": admin.VERTICAL},
240.         )
241. 
242.     def test_inheritance(self):
243.         self.assertFormfield(Album, "backside_art", widgets.AdminFileWidget)
244. 
245.     def test_m2m_widgets(self):
246.         """m2m fields help text as it applies to admin app (#9321)."""
247. 
248.         class AdvisorAdmin(admin.ModelAdmin):
249.             filter_vertical = ["companies"]
250. 
251.         self.assertFormfield(
252.             Advisor,
253.             "companies",
254.             widgets.FilteredSelectMultiple,
255.             filter_vertical=["companies"],
256.         )
257.         ma = AdvisorAdmin(Advisor, admin.site)
258.         f = ma.formfield_for_dbfield(Advisor._meta.get_field("companies"), request=None)
259.         self.assertEqual(
260.             f.help_text,
261.             "Hold down “Control”, or “Command” on a Mac, to select more than one.",
262.         )
263. 
264. 
265. @override_settings(ROOT_URLCONF="admin_widgets.urls")
266. class AdminFormfieldForDBFieldWithRequestTests(TestDataMixin, TestCase):
267.     def test_filter_choices_by_request_user(self):
268.         """
269.         Ensure the user can only see their own cars in the foreign key dropdown.
270.         """
271.         self.client.force_login(self.superuser)
272.         response = self.client.get(reverse("admin:admin_widgets_cartire_add"))
273.         self.assertNotContains(response, "BMW M3")
274.         self.assertContains(response, "Volkswagen Passat")
275. 
276. 
277. @override_settings(ROOT_URLCONF="admin_widgets.urls")
278. class AdminForeignKeyWidgetChangeList(TestDataMixin, TestCase):
279.     def setUp(self):
280.         self.client.force_login(self.superuser)
281. 
282.     def test_changelist_ForeignKey(self):
283.         response = self.client.get(reverse("admin:admin_widgets_car_changelist"))
284.         self.assertContains(response, "/auth/user/add/")
285. 
286. 
287. @override_settings(ROOT_URLCONF="admin_widgets.urls")
288. class AdminForeignKeyRawIdWidget(TestDataMixin, TestCase):
289.     def setUp(self):
290.         self.client.force_login(self.superuser)
291. 
292.     def test_nonexistent_target_id(self):
293.         band = Band.objects.create(name="Bogey Blues")
294.         pk = band.pk
295.         band.delete()
296.         post_data = {
297.             "main_band": str(pk),
298.         }
299.         # Try posting with a nonexistent pk in a raw id field: this
300.         # should result in an error message, not a server exception.
301.         response = self.client.post(reverse("admin:admin_widgets_event_add"), post_data)
302.         self.assertContains(
303.             response,
304.             "Select a valid choice. That choice is not one of the available choices.",
305.         )
306. 
307.     def test_invalid_target_id(self):
308. 
309.         for test_str in ("Iñtërnâtiônàlizætiøn", "1234'", -1234):
310.             # This should result in an error message, not a server exception.
311.             response = self.client.post(
312.                 reverse("admin:admin_widgets_event_add"), {"main_band": test_str}
313.             )
314. 
315.             self.assertContains(
316.                 response,
317.                 "Select a valid choice. That choice is not one of the available "
318.                 "choices.",
319.             )
320. 
321.     def test_url_params_from_lookup_dict_any_iterable(self):
322.         lookup1 = widgets.url_params_from_lookup_dict({"color__in": ("red", "blue")})
323.         lookup2 = widgets.url_params_from_lookup_dict({"color__in": ["red", "blue"]})
324.         self.assertEqual(lookup1, {"color__in": "red,blue"})
325.         self.assertEqual(lookup1, lookup2)
326. 
327.     def test_url_params_from_lookup_dict_callable(self):
328.         def my_callable():
329.             return "works"
330. 
331.         lookup1 = widgets.url_params_from_lookup_dict({"myfield": my_callable})
332.         lookup2 = widgets.url_params_from_lookup_dict({"myfield": my_callable()})
333.         self.assertEqual(lookup1, lookup2)
334. 
335.     def test_label_and_url_for_value_invalid_uuid(self):
336.         field = Bee._meta.get_field("honeycomb")
337.         self.assertIsInstance(field.target_field, UUIDField)
338.         widget = widgets.ForeignKeyRawIdWidget(field.remote_field, admin.site)
339.         self.assertEqual(widget.label_and_url_for_value("invalid-uuid"), ("", ""))
340. 
341. 
342. class FilteredSelectMultipleWidgetTest(SimpleTestCase):
343.     def test_render(self):
344.         # Backslash in verbose_name to ensure it is JavaScript escaped.
345.         w = widgets.FilteredSelectMultiple("test\\", False)
346.         self.assertHTMLEqual(
347.             w.render("test", "test"),
348.             '<select multiple name="test" class="selectfilter" '
349.             'data-field-name="test\\" data-is-stacked="0">\n</select>',
350.         )
351. 
352.     def test_stacked_render(self):
353.         # Backslash in verbose_name to ensure it is JavaScript escaped.
354.         w = widgets.FilteredSelectMultiple("test\\", True)
355.         self.assertHTMLEqual(
356.             w.render("test", "test"),
357.             '<select multiple name="test" class="selectfilterstacked" '
358.             'data-field-name="test\\" data-is-stacked="1">\n</select>',
359.         )
360. 
361. 
362. class AdminDateWidgetTest(SimpleTestCase):
363.     def test_attrs(self):
364.         w = widgets.AdminDateWidget()
365.         self.assertHTMLEqual(
366.             w.render("test", datetime(2007, 12, 1, 9, 30)),
367.             '<input value="2007-12-01" type="text" class="vDateField" name="test" '
368.             'size="10">',
369.         )
370.         # pass attrs to widget
371.         w = widgets.AdminDateWidget(attrs={"size": 20, "class": "myDateField"})
372.         self.assertHTMLEqual(
373.             w.render("test", datetime(2007, 12, 1, 9, 30)),
374.             '<input value="2007-12-01" type="text" class="myDateField" name="test" '
375.             'size="20">',
376.         )
377. 
378. 
379. class AdminTimeWidgetTest(SimpleTestCase):
380.     def test_attrs(self):
381.         w = widgets.AdminTimeWidget()
382.         self.assertHTMLEqual(
383.             w.render("test", datetime(2007, 12, 1, 9, 30)),
384.             '<input value="09:30:00" type="text" class="vTimeField" name="test" '
385.             'size="8">',
386.         )
387.         # pass attrs to widget
388.         w = widgets.AdminTimeWidget(attrs={"size": 20, "class": "myTimeField"})
389.         self.assertHTMLEqual(
390.             w.render("test", datetime(2007, 12, 1, 9, 30)),
391.             '<input value="09:30:00" type="text" class="myTimeField" name="test" '
392.             'size="20">',
393.         )
394. 
395. 
396. class AdminSplitDateTimeWidgetTest(SimpleTestCase):
397.     def test_render(self):
398.         w = widgets.AdminSplitDateTime()
399.         self.assertHTMLEqual(
400.             w.render("test", datetime(2007, 12, 1, 9, 30)),
401.             '<p class="datetime">'
402.             'Date: <input value="2007-12-01" type="text" class="vDateField" '
403.             'name="test_0" size="10"><br>'
404.             'Time: <input value="09:30:00" type="text" class="vTimeField" '
405.             'name="test_1" size="8"></p>',
406.         )
407. 
408.     def test_localization(self):
409.         w = widgets.AdminSplitDateTime()
410. 
411.         with translation.override("de-at"):
412.             w.is_localized = True
413.             self.assertHTMLEqual(
414.                 w.render("test", datetime(2007, 12, 1, 9, 30)),
415.                 '<p class="datetime">'
416.                 'Datum: <input value="01.12.2007" type="text" '
417.                 'class="vDateField" name="test_0"size="10"><br>'
418.                 'Zeit: <input value="09:30:00" type="text" class="vTimeField" '
419.                 'name="test_1" size="8"></p>',
420.             )
421. 
422. 
423. class AdminURLWidgetTest(SimpleTestCase):
424.     def test_get_context_validates_url(self):
425.         w = widgets.AdminURLFieldWidget()
426.         for invalid in ["", "/not/a/full/url/", 'javascript:alert("Danger XSS!")']:
427.             with self.subTest(url=invalid):
428.                 self.assertFalse(w.get_context("name", invalid, {})["url_valid"])
429.         self.assertTrue(w.get_context("name", "http://example.com", {})["url_valid"])
430. 
431.     def test_render(self):
432.         w = widgets.AdminURLFieldWidget()
433.         self.assertHTMLEqual(
434.             w.render("test", ""), '<input class="vURLField" name="test" type="url">'
435.         )
436.         self.assertHTMLEqual(
437.             w.render("test", "http://example.com"),
438.             '<p class="url">Currently:<a href="http://example.com">'
439.             "http://example.com</a><br>"
440.             'Change:<input class="vURLField" name="test" type="url" '
441.             'value="http://example.com"></p>',
442.         )
443. 
444.     def test_render_idn(self):
445.         w = widgets.AdminURLFieldWidget()
446.         self.assertHTMLEqual(
447.             w.render("test", "http://example-äüö.com"),
448.             '<p class="url">Currently: <a href="http://xn--example--7za4pnc.com">'
449.             "http://example-äüö.com</a><br>"
450.             'Change:<input class="vURLField" name="test" type="url" '
451.             'value="http://example-äüö.com"></p>',
452.         )
453. 
454.     def test_render_quoting(self):
455.         """
456.         WARNING: This test doesn't use assertHTMLEqual since it will get rid
457.         of some escapes which are tested here!
458.         """
459.         HREF_RE = re.compile('href="([^"]+)"')
460.         VALUE_RE = re.compile('value="([^"]+)"')
461.         TEXT_RE = re.compile("<a[^>]+>([^>]+)</a>")
462.         w = widgets.AdminURLFieldWidget()
463.         output = w.render("test", "http://example.com/<sometag>some-text</sometag>")
464.         self.assertEqual(
465.             HREF_RE.search(output)[1],
466.             "http://example.com/%3Csometag%3Esome-text%3C/sometag%3E",
467.         )
468.         self.assertEqual(
469.             TEXT_RE.search(output)[1],
470.             "http://example.com/&lt;sometag&gt;some-text&lt;/sometag&gt;",
471.         )
472.         self.assertEqual(
473.             VALUE_RE.search(output)[1],
474.             "http://example.com/&lt;sometag&gt;some-text&lt;/sometag&gt;",
475.         )
476.         output = w.render("test", "http://example-äüö.com/<sometag>some-text</sometag>")
477.         self.assertEqual(
478.             HREF_RE.search(output)[1],
479.             "http://xn--example--7za4pnc.com/%3Csometag%3Esome-text%3C/sometag%3E",
480.         )
481.         self.assertEqual(
482.             TEXT_RE.search(output)[1],
483.             "http://example-äüö.com/&lt;sometag&gt;some-text&lt;/sometag&gt;",
484.         )
485.         self.assertEqual(
486.             VALUE_RE.search(output)[1],
487.             "http://example-äüö.com/&lt;sometag&gt;some-text&lt;/sometag&gt;",
488.         )
489.         output = w.render(
490.             "test", 'http://www.example.com/%C3%A4"><script>alert("XSS!")</script>"'
491.         )
492.         self.assertEqual(
493.             HREF_RE.search(output)[1],
494.             "http://www.example.com/%C3%A4%22%3E%3Cscript%3Ealert(%22XSS!%22)"
495.             "%3C/script%3E%22",
496.         )
497.         self.assertEqual(
498.             TEXT_RE.search(output)[1],
499.             "http://www.example.com/%C3%A4&quot;&gt;&lt;script&gt;"
500.             "alert(&quot;XSS!&quot;)&lt;/script&gt;&quot;",


--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to a given query and the refinement query, and return your response in the specified format!
EVERY context object MUST include: reasoning, relative_path, start_line, and end_line.

2025-10-06 20:01:09,334 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="This file is provided as requested by the user. It contains a comprehensive suite of tests for `ModelAdmin`, which is the class at the center of the reported issue. It includes tests for form generation, fieldsets, inlines, and `radio_fields`, providing broad context for the user's problem.", relative_path='tests/modeladmin/tests.py', start_line=1, end_line=805), ContextOutput(reasoning="This test case is highly relevant as it directly addresses the user's issue. `test_radio_fields_ForeignKey` specifically tests the behavior of a `ForeignKey` when `radio_fields` is applied and, crucially, includes an assertion about the `empty_label` (`self.assertIsNone(ff.empty_label)`). This is the most direct example of testing the functionality described in the bug report. The surrounding `AdminFormfieldForDBFieldTests` class and its `assertFormfield` helper method are included to provide a complete, runnable test structure.", relative_path='tests/admin_widgets/tests.py', start_line=65, end_line=143), ContextOutput(reasoning="This test, `test_custom_queryset_still_wins`, provides a perfect template for how to test an override of the `formfield_for_foreignkey` method. Although it modifies the `queryset` instead of the `empty_label`, the pattern of creating a custom `ModelAdmin`, overriding the method, and then inspecting the resulting form field's properties is directly applicable to creating a regression test for the user's reported bug. The entire test class `TestRelatedFieldsAdminOrdering` is included for completeness.", relative_path='tests/admin_ordering/tests.py', start_line=134, end_line=208), ContextOutput(reasoning="This test, `test_foreign_key_as_radio_field`, is from the file explicitly requested by the user and is highly relevant to the issue. It demonstrates how to test the effects of `radio_fields` on a `ForeignKey`, including assertions on the widget type (`AdminRadioSelect`), its CSS classes (`radiolist inline`), and the content of its choices. This is a key example of how to inspect the properties of a form field widget in an admin test, which is part of the user's request.", relative_path='tests/modeladmin/tests.py', start_line=661, end_line=721), ContextOutput(reasoning="This test, `test_default_foreign_key_widget`, provides the essential baseline for understanding the changes introduced by `radio_fields`. It shows the default widget (`Select`) and choices for a standard `ForeignKey` in the admin. By comparing this test to `test_foreign_key_as_radio_field`, the user can clearly see the 'before and after' effect of using `radio_fields`, which is crucial for understanding the bug and implementing a fix.", relative_path='tests/modeladmin/tests.py', start_line=622, end_line=660)]
2025-10-06 20:01:09,335 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - INFO - Context extraction complete, returning context [Context(relative_path='tests/admin_views/tests.py', content='2911.     def test_conditionally_show_delete_section_link(self):\n2912.         """\n2913.         The foreign key widget should only show the "delete related" button if\n2914.         the user has permission to delete that related item.\n2915.         """\n2916. \n2917.         def get_delete_related(response):\n2918.             return (\n2919.                 response.context["adminform"]\n2920.                 .form.fields["sub_section"]\n2921.                 .widget.can_delete_related\n2922.             )\n2923. \n2924.         self.client.force_login(self.adduser)\n2925.         # The user can\'t delete sections yet, so they shouldn\'t see the\n2926.         # "delete section" link.\n2927.         url = reverse("admin:admin_views_article_add")\n2928.         delete_link_text = "delete_id_sub_section"\n2929.         response = self.client.get(url)\n2930.         self.assertFalse(get_delete_related(response))\n2931.         self.assertNotContains(response, delete_link_text)\n2932.         # Allow the user to delete sections too. Now they can see the\n2933.         # "delete section" link.\n2934.         user = User.objects.get(username="adduser")\n2935.         perm = get_perm(Section, get_permission_codename("delete", Section._meta))\n2936.         user.user_permissions.add(perm)\n2937.         response = self.client.get(url)\n2938.         self.assertTrue(get_delete_related(response))\n2939.         self.assertContains(response, delete_link_text)', start_line_number=2911, end_line_number=2939), Context(relative_path='tests/forms_tests/field_tests/test_choicefield.py', content='22.     def test_choicefield_2(self):\n23.         f = ChoiceField(choices=[("1", "One"), ("2", "Two")], required=False)\n24.         self.assertEqual("", f.clean(""))\n25.         self.assertEqual("", f.clean(None))\n26.         self.assertEqual("1", f.clean(1))\n27.         self.assertEqual("1", f.clean("1"))\n28.         msg = "\'Select a valid choice. 3 is not one of the available choices.\'"\n29.         with self.assertRaisesMessage(ValidationError, msg):\n30.             f.clean("3")', start_line_number=22, end_line_number=30), Context(relative_path='tests/modeladmin/tests.py', content='1. from datetime import date\n2. \n3. from django import forms\n4. from django.contrib.admin.models import ADDITION, CHANGE, DELETION, LogEntry\n5. from django.contrib.admin.options import (\n6.     HORIZONTAL,\n7.     VERTICAL,\n8.     ModelAdmin,\n9.     TabularInline,\n10.     get_content_type_for_model,\n11. )\n12. from django.contrib.admin.sites import AdminSite\n13. from django.contrib.admin.widgets import (\n14.     AdminDateWidget,\n15.     AdminRadioSelect,\n16.     AutocompleteSelect,\n17.     AutocompleteSelectMultiple,\n18. )\n19. from django.contrib.auth.models import User\n20. from django.db import models\n21. from django.forms.widgets import Select\n22. from django.test import SimpleTestCase, TestCase\n23. from django.test.utils import isolate_apps\n24. \n25. from .models import Band, Concert, Song\n26. \n27. \n28. class MockRequest:\n29.     pass\n30. \n31. \n32. class MockSuperUser:\n33.     def has_perm(self, perm, obj=None):\n34.         return True\n35. \n36. \n37. request = MockRequest()\n38. request.user = MockSuperUser()\n39. \n40. \n41. class ModelAdminTests(TestCase):\n42.     @classmethod\n43.     def setUpTestData(cls):\n44.         cls.band = Band.objects.create(\n45.             name="The Doors",\n46.             bio="",\n47.             sign_date=date(1965, 1, 1),\n48.         )\n49. \n50.     def setUp(self):\n51.         self.site = AdminSite()\n52. \n53.     def test_modeladmin_str(self):\n54.         ma = ModelAdmin(Band, self.site)\n55.         self.assertEqual(str(ma), "modeladmin.ModelAdmin")\n56. \n57.     def test_default_attributes(self):\n58.         ma = ModelAdmin(Band, self.site)\n59.         self.assertEqual(ma.actions, ())\n60.         self.assertEqual(ma.inlines, ())\n61. \n62.     # form/fields/fieldsets interaction ##############################\n63. \n64.     def test_default_fields(self):\n65.         ma = ModelAdmin(Band, self.site)\n66.         self.assertEqual(\n67.             list(ma.get_form(request).base_fields), ["name", "bio", "sign_date"]\n68.         )\n69.         self.assertEqual(list(ma.get_fields(request)), ["name", "bio", "sign_date"])\n70.         self.assertEqual(\n71.             list(ma.get_fields(request, self.band)), ["name", "bio", "sign_date"]\n72.         )\n73.         self.assertIsNone(ma.get_exclude(request, self.band))\n74. \n75.     def test_default_fieldsets(self):\n76.         # fieldsets_add and fieldsets_change should return a special data structure that\n77.         # is used in the templates. They should generate the "right thing" whether we\n78.         # have specified a custom form, the fields argument, or nothing at all.\n79.         #\n80.         # Here\'s the default case. There are no custom form_add/form_change methods,\n81.         # no fields argument, and no fieldsets argument.\n82.         ma = ModelAdmin(Band, self.site)\n83.         self.assertEqual(\n84.             ma.get_fieldsets(request),\n85.             [(None, {"fields": ["name", "bio", "sign_date"]})],\n86.         )\n87.         self.assertEqual(\n88.             ma.get_fieldsets(request, self.band),\n89.             [(None, {"fields": ["name", "bio", "sign_date"]})],\n90.         )\n91. \n92.     def test_get_fieldsets(self):\n93.         # get_fieldsets() is called when figuring out form fields (#18681).\n94.         class BandAdmin(ModelAdmin):\n95.             def get_fieldsets(self, request, obj=None):\n96.                 return [(None, {"fields": ["name", "bio"]})]\n97. \n98.         ma = BandAdmin(Band, self.site)\n99.         form = ma.get_form(None)\n100.         self.assertEqual(form._meta.fields, ["name", "bio"])\n101. \n102.         class InlineBandAdmin(TabularInline):\n103.             model = Concert\n104.             fk_name = "main_band"\n105.             can_delete = False\n106. \n107.             def get_fieldsets(self, request, obj=None):\n108.                 return [(None, {"fields": ["day", "transport"]})]\n109. \n110.         ma = InlineBandAdmin(Band, self.site)\n111.         form = ma.get_formset(None).form\n112.         self.assertEqual(form._meta.fields, ["day", "transport"])\n113. \n114.     def test_lookup_allowed_allows_nonexistent_lookup(self):\n115.         """\n116.         A lookup_allowed allows a parameter whose field lookup doesn\'t exist.\n117.         (#21129).\n118.         """\n119. \n120.         class BandAdmin(ModelAdmin):\n121.             fields = ["name"]\n122. \n123.         ma = BandAdmin(Band, self.site)\n124.         self.assertTrue(ma.lookup_allowed("name__nonexistent", "test_value"))\n125. \n126.     @isolate_apps("modeladmin")\n127.     def test_lookup_allowed_onetoone(self):\n128.         class Department(models.Model):\n129.             code = models.CharField(max_length=4, unique=True)\n130. \n131.         class Employee(models.Model):\n132.             department = models.ForeignKey(Department, models.CASCADE, to_field="code")\n133. \n134.         class EmployeeProfile(models.Model):\n135.             employee = models.OneToOneField(Employee, models.CASCADE)\n136. \n137.         class EmployeeInfo(models.Model):\n138.             employee = models.OneToOneField(Employee, models.CASCADE)\n139.             description = models.CharField(max_length=100)\n140. \n141.         class EmployeeProfileAdmin(ModelAdmin):\n142.             list_filter = [\n143.                 "employee__employeeinfo__description",\n144.                 "employee__department__code",\n145.             ]\n146. \n147.         ma = EmployeeProfileAdmin(EmployeeProfile, self.site)\n148.         # Reverse OneToOneField\n149.         self.assertIs(\n150.             ma.lookup_allowed("employee__employeeinfo__description", "test_value"), True\n151.         )\n152.         # OneToOneField and ForeignKey\n153.         self.assertIs(\n154.             ma.lookup_allowed("employee__department__code", "test_value"), True\n155.         )\n156. \n157.     def test_field_arguments(self):\n158.         # If fields is specified, fieldsets_add and fieldsets_change should\n159.         # just stick the fields into a formsets structure and return it.\n160.         class BandAdmin(ModelAdmin):\n161.             fields = ["name"]\n162. \n163.         ma = BandAdmin(Band, self.site)\n164. \n165.         self.assertEqual(list(ma.get_fields(request)), ["name"])\n166.         self.assertEqual(list(ma.get_fields(request, self.band)), ["name"])\n167.         self.assertEqual(ma.get_fieldsets(request), [(None, {"fields": ["name"]})])\n168.         self.assertEqual(\n169.             ma.get_fieldsets(request, self.band), [(None, {"fields": ["name"]})]\n170.         )\n171. \n172.     def test_field_arguments_restricted_on_form(self):\n173.         # If fields or fieldsets is specified, it should exclude fields on the\n174.         # Form class to the fields specified. This may cause errors to be\n175.         # raised in the db layer if required model fields aren\'t in fields/\n176.         # fieldsets, but that\'s preferable to ghost errors where a field in the\n177.         # Form class isn\'t being displayed because it\'s not in fields/fieldsets.\n178. \n179.         # Using `fields`.\n180.         class BandAdmin(ModelAdmin):\n181.             fields = ["name"]\n182. \n183.         ma = BandAdmin(Band, self.site)\n184.         self.assertEqual(list(ma.get_form(request).base_fields), ["name"])\n185.         self.assertEqual(list(ma.get_form(request, self.band).base_fields), ["name"])\n186. \n187.         # Using `fieldsets`.\n188.         class BandAdmin(ModelAdmin):\n189.             fieldsets = [(None, {"fields": ["name"]})]\n190. \n191.         ma = BandAdmin(Band, self.site)\n192.         self.assertEqual(list(ma.get_form(request).base_fields), ["name"])\n193.         self.assertEqual(list(ma.get_form(request, self.band).base_fields), ["name"])\n194. \n195.         # Using `exclude`.\n196.         class BandAdmin(ModelAdmin):\n197.             exclude = ["bio"]\n198. \n199.         ma = BandAdmin(Band, self.site)\n200.         self.assertEqual(list(ma.get_form(request).base_fields), ["name", "sign_date"])\n201. \n202.         # You can also pass a tuple to `exclude`.\n203.         class BandAdmin(ModelAdmin):\n204.             exclude = ("bio",)\n205. \n206.         ma = BandAdmin(Band, self.site)\n207.         self.assertEqual(list(ma.get_form(request).base_fields), ["name", "sign_date"])\n208. \n209.         # Using `fields` and `exclude`.\n210.         class BandAdmin(ModelAdmin):\n211.             fields = ["name", "bio"]\n212.             exclude = ["bio"]\n213. \n214.         ma = BandAdmin(Band, self.site)\n215.         self.assertEqual(list(ma.get_form(request).base_fields), ["name"])\n216. \n217.     def test_custom_form_meta_exclude_with_readonly(self):\n218.         """\n219.         The custom ModelForm\'s `Meta.exclude` is respected when used in\n220.         conjunction with `ModelAdmin.readonly_fields` and when no\n221.         `ModelAdmin.exclude` is defined (#14496).\n222.         """\n223.         # With ModelAdmin\n224.         class AdminBandForm(forms.ModelForm):\n225.             class Meta:\n226.                 model = Band\n227.                 exclude = ["bio"]\n228. \n229.         class BandAdmin(ModelAdmin):\n230.             readonly_fields = ["name"]\n231.             form = AdminBandForm\n232. \n233.         ma = BandAdmin(Band, self.site)\n234.         self.assertEqual(list(ma.get_form(request).base_fields), ["sign_date"])\n235. \n236.         # With InlineModelAdmin\n237.         class AdminConcertForm(forms.ModelForm):\n238.             class Meta:\n239.                 model = Concert\n240.                 exclude = ["day"]\n241. \n242.         class ConcertInline(TabularInline):\n243.             readonly_fields = ["transport"]\n244.             form = AdminConcertForm\n245.             fk_name = "main_band"\n246.             model = Concert\n247. \n248.         class BandAdmin(ModelAdmin):\n249.             inlines = [ConcertInline]\n250. \n251.         ma = BandAdmin(Band, self.site)\n252.         self.assertEqual(\n253.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),\n254.             ["main_band", "opening_band", "id", "DELETE"],\n255.         )\n256. \n257.     def test_custom_formfield_override_readonly(self):\n258.         class AdminBandForm(forms.ModelForm):\n259.             name = forms.CharField()\n260. \n261.             class Meta:\n262.                 exclude = ()\n263.                 model = Band\n264. \n265.         class BandAdmin(ModelAdmin):\n266.             form = AdminBandForm\n267.             readonly_fields = ["name"]\n268. \n269.         ma = BandAdmin(Band, self.site)\n270. \n271.         # `name` shouldn\'t appear in base_fields because it\'s part of\n272.         # readonly_fields.\n273.         self.assertEqual(list(ma.get_form(request).base_fields), ["bio", "sign_date"])\n274.         # But it should appear in get_fields()/fieldsets() so it can be\n275.         # displayed as read-only.\n276.         self.assertEqual(list(ma.get_fields(request)), ["bio", "sign_date", "name"])\n277.         self.assertEqual(\n278.             list(ma.get_fieldsets(request)),\n279.             [(None, {"fields": ["bio", "sign_date", "name"]})],\n280.         )\n281. \n282.     def test_custom_form_meta_exclude(self):\n283.         """\n284.         The custom ModelForm\'s `Meta.exclude` is overridden if\n285.         `ModelAdmin.exclude` or `InlineModelAdmin.exclude` are defined (#14496).\n286.         """\n287.         # With ModelAdmin\n288.         class AdminBandForm(forms.ModelForm):\n289.             class Meta:\n290.                 model = Band\n291.                 exclude = ["bio"]\n292. \n293.         class BandAdmin(ModelAdmin):\n294.             exclude = ["name"]\n295.             form = AdminBandForm\n296. \n297.         ma = BandAdmin(Band, self.site)\n298.         self.assertEqual(list(ma.get_form(request).base_fields), ["bio", "sign_date"])\n299. \n300.         # With InlineModelAdmin\n301.         class AdminConcertForm(forms.ModelForm):\n302.             class Meta:\n303.                 model = Concert\n304.                 exclude = ["day"]\n305. \n306.         class ConcertInline(TabularInline):\n307.             exclude = ["transport"]\n308.             form = AdminConcertForm\n309.             fk_name = "main_band"\n310.             model = Concert\n311. \n312.         class BandAdmin(ModelAdmin):\n313.             inlines = [ConcertInline]\n314. \n315.         ma = BandAdmin(Band, self.site)\n316.         self.assertEqual(\n317.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),\n318.             ["main_band", "opening_band", "day", "id", "DELETE"],\n319.         )\n320. \n321.     def test_overriding_get_exclude(self):\n322.         class BandAdmin(ModelAdmin):\n323.             def get_exclude(self, request, obj=None):\n324.                 return ["name"]\n325. \n326.         self.assertEqual(\n327.             list(BandAdmin(Band, self.site).get_form(request).base_fields),\n328.             ["bio", "sign_date"],\n329.         )\n330. \n331.     def test_get_exclude_overrides_exclude(self):\n332.         class BandAdmin(ModelAdmin):\n333.             exclude = ["bio"]\n334. \n335.             def get_exclude(self, request, obj=None):\n336.                 return ["name"]\n337. \n338.         self.assertEqual(\n339.             list(BandAdmin(Band, self.site).get_form(request).base_fields),\n340.             ["bio", "sign_date"],\n341.         )\n342. \n343.     def test_get_exclude_takes_obj(self):\n344.         class BandAdmin(ModelAdmin):\n345.             def get_exclude(self, request, obj=None):\n346.                 if obj:\n347.                     return ["sign_date"]\n348.                 return ["name"]\n349. \n350.         self.assertEqual(\n351.             list(BandAdmin(Band, self.site).get_form(request, self.band).base_fields),\n352.             ["name", "bio"],\n353.         )\n354. \n355.     def test_custom_form_validation(self):\n356.         # If a form is specified, it should use it allowing custom validation\n357.         # to work properly. This won\'t break any of the admin widgets or media.\n358.         class AdminBandForm(forms.ModelForm):\n359.             delete = forms.BooleanField()\n360. \n361.         class BandAdmin(ModelAdmin):\n362.             form = AdminBandForm\n363. \n364.         ma = BandAdmin(Band, self.site)\n365.         self.assertEqual(\n366.             list(ma.get_form(request).base_fields),\n367.             ["name", "bio", "sign_date", "delete"],\n368.         )\n369.         self.assertEqual(\n370.             type(ma.get_form(request).base_fields["sign_date"].widget), AdminDateWidget\n371.         )\n372. \n373.     def test_form_exclude_kwarg_override(self):\n374.         """\n375.         The `exclude` kwarg passed to `ModelAdmin.get_form()` overrides all\n376.         other declarations (#8999).\n377.         """\n378. \n379.         class AdminBandForm(forms.ModelForm):\n380.             class Meta:\n381.                 model = Band\n382.                 exclude = ["name"]\n383. \n384.         class BandAdmin(ModelAdmin):\n385.             exclude = ["sign_date"]\n386.             form = AdminBandForm\n387. \n388.             def get_form(self, request, obj=None, **kwargs):\n389.                 kwargs["exclude"] = ["bio"]\n390.                 return super().get_form(request, obj, **kwargs)\n391. \n392.         ma = BandAdmin(Band, self.site)\n393.         self.assertEqual(list(ma.get_form(request).base_fields), ["name", "sign_date"])\n394. \n395.     def test_formset_exclude_kwarg_override(self):\n396.         """\n397.         The `exclude` kwarg passed to `InlineModelAdmin.get_formset()`\n398.         overrides all other declarations (#8999).\n399.         """\n400. \n401.         class AdminConcertForm(forms.ModelForm):\n402.             class Meta:\n403.                 model = Concert\n404.                 exclude = ["day"]\n405. \n406.         class ConcertInline(TabularInline):\n407.             exclude = ["transport"]\n408.             form = AdminConcertForm\n409.             fk_name = "main_band"\n410.             model = Concert\n411. \n412.             def get_formset(self, request, obj=None, **kwargs):\n413.                 kwargs["exclude"] = ["opening_band"]\n414.                 return super().get_formset(request, obj, **kwargs)\n415. \n416.         class BandAdmin(ModelAdmin):\n417.             inlines = [ConcertInline]\n418. \n419.         ma = BandAdmin(Band, self.site)\n420.         self.assertEqual(\n421.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),\n422.             ["main_band", "day", "transport", "id", "DELETE"],\n423.         )\n424. \n425.     def test_formset_overriding_get_exclude_with_form_fields(self):\n426.         class AdminConcertForm(forms.ModelForm):\n427.             class Meta:\n428.                 model = Concert\n429.                 fields = ["main_band", "opening_band", "day", "transport"]\n430. \n431.         class ConcertInline(TabularInline):\n432.             form = AdminConcertForm\n433.             fk_name = "main_band"\n434.             model = Concert\n435. \n436.             def get_exclude(self, request, obj=None):\n437.                 return ["opening_band"]\n438. \n439.         class BandAdmin(ModelAdmin):\n440.             inlines = [ConcertInline]\n441. \n442.         ma = BandAdmin(Band, self.site)\n443.         self.assertEqual(\n444.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),\n445.             ["main_band", "day", "transport", "id", "DELETE"],\n446.         )\n447. \n448.     def test_formset_overriding_get_exclude_with_form_exclude(self):\n449.         class AdminConcertForm(forms.ModelForm):\n450.             class Meta:\n451.                 model = Concert\n452.                 exclude = ["day"]\n453. \n454.         class ConcertInline(TabularInline):\n455.             form = AdminConcertForm\n456.             fk_name = "main_band"\n457.             model = Concert\n458. \n459.             def get_exclude(self, request, obj=None):\n460.                 return ["opening_band"]\n461. \n462.         class BandAdmin(ModelAdmin):\n463.             inlines = [ConcertInline]\n464. \n465.         ma = BandAdmin(Band, self.site)\n466.         self.assertEqual(\n467.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),\n468.             ["main_band", "day", "transport", "id", "DELETE"],\n469.         )\n470. \n471.     def test_raw_id_fields_widget_override(self):\n472.         """\n473.         The autocomplete_fields, raw_id_fields, and radio_fields widgets may\n474.         overridden by specifying a widget in get_formset().\n475.         """\n476. \n477.         class ConcertInline(TabularInline):\n478.             model = Concert\n479.             fk_name = "main_band"\n480.             raw_id_fields = ("opening_band",)\n481. \n482.             def get_formset(self, request, obj=None, **kwargs):\n483.                 kwargs["widgets"] = {"opening_band": Select}\n484.                 return super().get_formset(request, obj, **kwargs)\n485. \n486.         class BandAdmin(ModelAdmin):\n487.             inlines = [ConcertInline]\n488. \n489.         ma = BandAdmin(Band, self.site)\n490.         band_widget = (\n491.             list(ma.get_formsets_with_inlines(request))[0][0]()\n492.             .forms[0]\n493.             .fields["opening_band"]\n494.             .widget\n495.         )\n496.         # Without the override this would be ForeignKeyRawIdWidget.\n497.         self.assertIsInstance(band_widget, Select)\n498. \n499.     def test_queryset_override(self):\n500.         # If the queryset of a ModelChoiceField in a custom form is overridden,\n501.         # RelatedFieldWidgetWrapper doesn\'t mess that up.\n502.         band2 = Band.objects.create(\n503.             name="The Beatles", bio="", sign_date=date(1962, 1, 1)\n504.         )\n505. \n506.         ma = ModelAdmin(Concert, self.site)\n507.         form = ma.get_form(request)()\n508. \n509.         self.assertHTMLEqual(\n510.             str(form["main_band"]),\n511.             \'<div class="related-widget-wrapper">\'\n512.             \'<select name="main_band" id="id_main_band" required>\'\n513.             \'<option value="" selected>---------</option>\'\n514.             \'<option value="%d">The Beatles</option>\'\n515.             \'<option value="%d">The Doors</option>\'\n516.             "</select></div>" % (band2.id, self.band.id),\n517.         )\n518. \n519.         class AdminConcertForm(forms.ModelForm):\n520.             def __init__(self, *args, **kwargs):\n521.                 super().__init__(*args, **kwargs)\n522.                 self.fields["main_band"].queryset = Band.objects.filter(\n523.                     name="The Doors"\n524.                 )\n525. \n526.         class ConcertAdminWithForm(ModelAdmin):\n527.             form = AdminConcertForm\n528. \n529.         ma = ConcertAdminWithForm(Concert, self.site)\n530.         form = ma.get_form(request)()\n531. \n532.         self.assertHTMLEqual(\n533.             str(form["main_band"]),\n534.             \'<div class="related-widget-wrapper">\'\n535.             \'<select name="main_band" id="id_main_band" required>\'\n536.             \'<option value="" selected>---------</option>\'\n537.             \'<option value="%d">The Doors</option>\'\n538.             "</select></div>" % self.band.id,\n539.         )\n540. \n541.     def test_regression_for_ticket_15820(self):\n542.         """\n543.         `obj` is passed from `InlineModelAdmin.get_fieldsets()` to\n544.         `InlineModelAdmin.get_formset()`.\n545.         """\n546. \n547.         class CustomConcertForm(forms.ModelForm):\n548.             class Meta:\n549.                 model = Concert\n550.                 fields = ["day"]\n551. \n552.         class ConcertInline(TabularInline):\n553.             model = Concert\n554.             fk_name = "main_band"\n555. \n556.             def get_formset(self, request, obj=None, **kwargs):\n557.                 if obj:\n558.                     kwargs["form"] = CustomConcertForm\n559.                 return super().get_formset(request, obj, **kwargs)\n560. \n561.         class BandAdmin(ModelAdmin):\n562.             inlines = [ConcertInline]\n563. \n564.         Concert.objects.create(main_band=self.band, opening_band=self.band, day=1)\n565.         ma = BandAdmin(Band, self.site)\n566.         inline_instances = ma.get_inline_instances(request)\n567.         fieldsets = list(inline_instances[0].get_fieldsets(request))\n568.         self.assertEqual(\n569.             fieldsets[0][1]["fields"], ["main_band", "opening_band", "day", "transport"]\n570.         )\n571.         fieldsets = list(\n572.             inline_instances[0].get_fieldsets(request, inline_instances[0].model)\n573.         )\n574.         self.assertEqual(fieldsets[0][1]["fields"], ["day"])\n575. \n576.     # radio_fields behavior ###########################################\n577. \n578.     def test_default_foreign_key_widget(self):\n579.         # First, without any radio_fields specified, the widgets for ForeignKey\n580.         # and fields with choices specified ought to be a basic Select widget.\n581.         # ForeignKey widgets in the admin are wrapped with RelatedFieldWidgetWrapper so\n582.         # they need to be handled properly when type checking. For Select fields, all of\n583.         # the choices lists have a first entry of dashes.\n584.         cma = ModelAdmin(Concert, self.site)\n585.         cmafa = cma.get_form(request)\n586. \n587.         self.assertEqual(type(cmafa.base_fields["main_band"].widget.widget), Select)\n588.         self.assertEqual(\n589.             list(cmafa.base_fields["main_band"].widget.choices),\n590.             [("", "---------"), (self.band.id, "The Doors")],\n591.         )\n592. \n593.         self.assertEqual(type(cmafa.base_fields["opening_band"].widget.widget), Select)\n594.         self.assertEqual(\n595.             list(cmafa.base_fields["opening_band"].widget.choices),\n596.             [("", "---------"), (self.band.id, "The Doors")],\n597.         )\n598.         self.assertEqual(type(cmafa.base_fields["day"].widget), Select)\n599.         self.assertEqual(\n600.             list(cmafa.base_fields["day"].widget.choices),\n601.             [("", "---------"), (1, "Fri"), (2, "Sat")],\n602.         )\n603.         self.assertEqual(type(cmafa.base_fields["transport"].widget), Select)\n604.         self.assertEqual(\n605.             list(cmafa.base_fields["transport"].widget.choices),\n606.             [("", "---------"), (1, "Plane"), (2, "Train"), (3, "Bus")],\n607.         )\n608. \n609.     def test_foreign_key_as_radio_field(self):\n610.         # Now specify all the fields as radio_fields.  Widgets should now be\n611.         # RadioSelect, and the choices list should have a first entry of \'None\' if\n612.         # blank=True for the model field.  Finally, the widget should have the\n613.         # \'radiolist\' attr, and \'inline\' as well if the field is specified HORIZONTAL.\n614.         class ConcertAdmin(ModelAdmin):\n615.             radio_fields = {\n616.                 "main_band": HORIZONTAL,\n617.                 "opening_band": VERTICAL,\n618.                 "day": VERTICAL,\n619.                 "transport": HORIZONTAL,\n620.             }\n621. \n622.         cma = ConcertAdmin(Concert, self.site)\n623.         cmafa = cma.get_form(request)\n624. \n625.         self.assertEqual(\n626.             type(cmafa.base_fields["main_band"].widget.widget), AdminRadioSelect\n627.         )\n628.         self.assertEqual(\n629.             cmafa.base_fields["main_band"].widget.attrs, {"class": "radiolist inline"}\n630.         )\n631.         self.assertEqual(\n632.             list(cmafa.base_fields["main_band"].widget.choices),\n633.             [(self.band.id, "The Doors")],\n634.         )\n635. \n636.         self.assertEqual(\n637.             type(cmafa.base_fields["opening_band"].widget.widget), AdminRadioSelect\n638.         )\n639.         self.assertEqual(\n640.             cmafa.base_fields["opening_band"].widget.attrs, {"class": "radiolist"}\n641.         )\n642.         self.assertEqual(\n643.             list(cmafa.base_fields["opening_band"].widget.choices),\n644.             [("", "None"), (self.band.id, "The Doors")],\n645.         )\n646.         self.assertEqual(type(cmafa.base_fields["day"].widget), AdminRadioSelect)\n647.         self.assertEqual(cmafa.base_fields["day"].widget.attrs, {"class": "radiolist"})\n648.         self.assertEqual(\n649.             list(cmafa.base_fields["day"].widget.choices), [(1, "Fri"), (2, "Sat")]\n650.         )\n651. \n652.         self.assertEqual(type(cmafa.base_fields["transport"].widget), AdminRadioSelect)\n653.         self.assertEqual(\n654.             cmafa.base_fields["transport"].widget.attrs, {"class": "radiolist inline"}\n655.         )\n656.         self.assertEqual(\n657.             list(cmafa.base_fields["transport"].widget.choices),\n658.             [("", "None"), (1, "Plane"), (2, "Train"), (3, "Bus")],\n659.         )\n660. \n661.         class AdminConcertForm(forms.ModelForm):\n662.             class Meta:\n663.                 model = Concert\n664.                 exclude = ("transport",)\n665. \n666.         class ConcertAdmin(ModelAdmin):\n667.             form = AdminConcertForm\n668. \n669.         ma = ConcertAdmin(Concert, self.site)\n670.         self.assertEqual(\n671.             list(ma.get_form(request).base_fields), ["main_band", "opening_band", "day"]\n672.         )\n673. \n674.         class AdminConcertForm(forms.ModelForm):\n675.             extra = forms.CharField()\n676. \n677.             class Meta:\n678.                 model = Concert\n679.                 fields = ["extra", "transport"]\n680. \n681.         class ConcertAdmin(ModelAdmin):\n682.             form = AdminConcertForm\n683. \n684.         ma = ConcertAdmin(Concert, self.site)\n685.         self.assertEqual(list(ma.get_form(request).base_fields), ["extra", "transport"])\n686. \n687.         class ConcertInline(TabularInline):\n688.             form = AdminConcertForm\n689.             model = Concert\n690.             fk_name = "main_band"\n691.             can_delete = True\n692. \n693.         class BandAdmin(ModelAdmin):\n694.             inlines = [ConcertInline]\n695. \n696.         ma = BandAdmin(Band, self.site)\n697.         self.assertEqual(\n698.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),\n699.             ["extra", "transport", "id", "DELETE", "main_band"],\n700.         )\n701. \n702.     def test_log_actions(self):\n703.         ma = ModelAdmin(Band, self.site)\n704.         mock_request = MockRequest()\n705.         mock_request.user = User.objects.create(username="bill")\n706.         content_type = get_content_type_for_model(self.band)\n707.         tests = (\n708.             (ma.log_addition, ADDITION, {"added": {}}),\n709.             (ma.log_change, CHANGE, {"changed": {"fields": ["name", "bio"]}}),\n710.             (ma.log_deletion, DELETION, str(self.band)),\n711.         )\n712.         for method, flag, message in tests:\n713.             with self.subTest(name=method.__name__):\n714.                 created = method(mock_request, self.band, message)\n715.                 fetched = LogEntry.objects.filter(action_flag=flag).latest("id")\n716.                 self.assertEqual(created, fetched)\n717.                 self.assertEqual(fetched.action_flag, flag)\n718.                 self.assertEqual(fetched.content_type, content_type)\n719.                 self.assertEqual(fetched.object_id, str(self.band.pk))\n720.                 self.assertEqual(fetched.user, mock_request.user)\n721.                 if flag == DELETION:\n722.                     self.assertEqual(fetched.change_message, "")\n723.                     self.assertEqual(fetched.object_repr, message)\n724.                 else:\n725.                     self.assertEqual(fetched.change_message, str(message))\n726.                     self.assertEqual(fetched.object_repr, str(self.band))\n727. \n728.     def test_get_autocomplete_fields(self):\n729.         class NameAdmin(ModelAdmin):\n730.             search_fields = ["name"]\n731. \n732.         class SongAdmin(ModelAdmin):\n733.             autocomplete_fields = ["featuring"]\n734.             fields = ["featuring", "band"]\n735. \n736.         class OtherSongAdmin(SongAdmin):\n737.             def get_autocomplete_fields(self, request):\n738.                 return ["band"]\n739. \n740.         self.site.register(Band, NameAdmin)\n741.         try:\n742.             # Uses autocomplete_fields if not overridden.\n743.             model_admin = SongAdmin(Song, self.site)\n744.             form = model_admin.get_form(request)()\n745.             self.assertIsInstance(\n746.                 form.fields["featuring"].widget.widget, AutocompleteSelectMultiple\n747.             )\n748.             # Uses overridden get_autocomplete_fields\n749.             model_admin = OtherSongAdmin(Song, self.site)\n750.             form = model_admin.get_form(request)()\n751.             self.assertIsInstance(form.fields["band"].widget.widget, AutocompleteSelect)\n752.         finally:\n753.             self.site.unregister(Band)\n754. \n755.     def test_get_deleted_objects(self):\n756.         mock_request = MockRequest()\n757.         mock_request.user = User.objects.create_superuser(\n758.             username="bob", email="bob@test.com", password="test"\n759.         )\n760.         self.site.register(Band, ModelAdmin)\n761.         ma = self.site._registry[Band]\n762.         (\n763.             deletable_objects,\n764.             model_count,\n765.             perms_needed,\n766.             protected,\n767.         ) = ma.get_deleted_objects([self.band], request)\n768.         self.assertEqual(deletable_objects, ["Band: The Doors"])\n769.         self.assertEqual(model_count, {"bands": 1})\n770.         self.assertEqual(perms_needed, set())\n771.         self.assertEqual(protected, [])\n772. \n773.     def test_get_deleted_objects_with_custom_has_delete_permission(self):\n774.         """\n775.         ModelAdmin.get_deleted_objects() uses ModelAdmin.has_delete_permission()\n776.         for permissions checking.\n777.         """\n778.         mock_request = MockRequest()\n779.         mock_request.user = User.objects.create_superuser(\n780.             username="bob", email="bob@test.com", password="test"\n781.         )\n782. \n783.         class TestModelAdmin(ModelAdmin):\n784.             def has_delete_permission(self, request, obj=None):\n785.                 return False\n786. \n787.         self.site.register(Band, TestModelAdmin)\n788.         ma = self.site._registry[Band]\n789.         (\n790.             deletable_objects,\n791.             model_count,\n792.             perms_needed,\n793.             protected,\n794.         ) = ma.get_deleted_objects([self.band], request)\n795.         self.assertEqual(deletable_objects, ["Band: The Doors"])\n796.         self.assertEqual(model_count, {"bands": 1})\n797.         self.assertEqual(perms_needed, {"band"})\n798.         self.assertEqual(protected, [])\n799. \n800.     def test_modeladmin_repr(self):\n801.         ma = ModelAdmin(Band, self.site)\n802.         self.assertEqual(\n803.             repr(ma),\n804.             "<ModelAdmin: model=Band site=AdminSite(name=\'admin\')>",\n805.         )', start_line_number=1, end_line_number=805), Context(relative_path='tests/admin_widgets/tests.py', content='65. class AdminFormfieldForDBFieldTests(SimpleTestCase):\n66.     """\n67.     Tests for correct behavior of ModelAdmin.formfield_for_dbfield\n68.     """\n69. \n70.     def assertFormfield(self, model, fieldname, widgetclass, **admin_overrides):\n71.         """\n72.         Helper to call formfield_for_dbfield for a given model and field name\n73.         and verify that the returned formfield is appropriate.\n74.         """\n75.         # Override any settings on the model admin\n76.         class MyModelAdmin(admin.ModelAdmin):\n77.             pass\n78. \n79.         for k in admin_overrides:\n80.             setattr(MyModelAdmin, k, admin_overrides[k])\n81. \n82.         # Construct the admin, and ask it for a formfield\n83.         ma = MyModelAdmin(model, admin.site)\n84.         ff = ma.formfield_for_dbfield(model._meta.get_field(fieldname), request=None)\n85. \n86.         # "unwrap" the widget wrapper, if needed\n87.         if isinstance(ff.widget, widgets.RelatedFieldWidgetWrapper):\n88.             widget = ff.widget.widget\n89.         else:\n90.             widget = ff.widget\n91. \n92.         self.assertIsInstance(widget, widgetclass)\n93. \n94.         # Return the formfield so that other tests can continue\n95.         return ff\n96. \n97.     def test_DateField(self):\n98.         self.assertFormfield(Event, "start_date", widgets.AdminDateWidget)\n99. \n100.     def test_DateTimeField(self):\n101.         self.assertFormfield(Member, "birthdate", widgets.AdminSplitDateTime)\n102. \n103.     def test_TimeField(self):\n104.         self.assertFormfield(Event, "start_time", widgets.AdminTimeWidget)\n105. \n106.     def test_TextField(self):\n107.         self.assertFormfield(Event, "description", widgets.AdminTextareaWidget)\n108. \n109.     def test_URLField(self):\n110.         self.assertFormfield(Event, "link", widgets.AdminURLFieldWidget)\n111. \n112.     def test_IntegerField(self):\n113.         self.assertFormfield(Event, "min_age", widgets.AdminIntegerFieldWidget)\n114. \n115.     def test_CharField(self):\n116.         self.assertFormfield(Member, "name", widgets.AdminTextInputWidget)\n117. \n118.     def test_EmailField(self):\n119.         self.assertFormfield(Member, "email", widgets.AdminEmailInputWidget)\n120. \n121.     def test_FileField(self):\n122.         self.assertFormfield(Album, "cover_art", widgets.AdminFileWidget)\n123. \n124.     def test_ForeignKey(self):\n125.         self.assertFormfield(Event, "main_band", forms.Select)\n126. \n127.     def test_raw_id_ForeignKey(self):\n128.         self.assertFormfield(\n129.             Event,\n130.             "main_band",\n131.             widgets.ForeignKeyRawIdWidget,\n132.             raw_id_fields=["main_band"],\n133.         )\n134. \n135.     def test_radio_fields_ForeignKey(self):\n136.         ff = self.assertFormfield(\n137.             Event,\n138.             "main_band",\n139.             widgets.AdminRadioSelect,\n140.             radio_fields={"main_band": admin.VERTICAL},\n141.         )\n142.         self.assertIsNone(ff.empty_label)\n143. ', start_line_number=65, end_line_number=143), Context(relative_path='tests/admin_ordering/tests.py', content='134. class TestRelatedFieldsAdminOrdering(TestCase):\n135.     @classmethod\n136.     def setUpTestData(cls):\n137.         cls.b1 = Band.objects.create(name="Pink Floyd", bio="", rank=1)\n138.         cls.b2 = Band.objects.create(name="Foo Fighters", bio="", rank=5)\n139. \n140.     def setUp(self):\n141.         # we need to register a custom ModelAdmin (instead of just using\n142.         # ModelAdmin) because the field creator tries to find the ModelAdmin\n143.         # for the related model\n144.         class SongAdmin(admin.ModelAdmin):\n145.             pass\n146. \n147.         site.register(Song, SongAdmin)\n148. \n149.     def tearDown(self):\n150.         site.unregister(Song)\n151.         if Band in site._registry:\n152.             site.unregister(Band)\n153. \n154.     def check_ordering_of_field_choices(self, correct_ordering):\n155.         fk_field = site._registry[Song].formfield_for_foreignkey(\n156.             Song.band.field, request=None\n157.         )\n158.         m2m_field = site._registry[Song].formfield_for_manytomany(\n159.             Song.other_interpreters.field, request=None\n160.         )\n161.         self.assertEqual(list(fk_field.queryset), correct_ordering)\n162.         self.assertEqual(list(m2m_field.queryset), correct_ordering)\n163. \n164.     def test_no_admin_fallback_to_model_ordering(self):\n165.         # should be ordered by name (as defined by the model)\n166.         self.check_ordering_of_field_choices([self.b2, self.b1])\n167. \n168.     def test_admin_with_no_ordering_fallback_to_model_ordering(self):\n169.         class NoOrderingBandAdmin(admin.ModelAdmin):\n170.             pass\n171. \n172.         site.register(Band, NoOrderingBandAdmin)\n173. \n174.         # should be ordered by name (as defined by the model)\n175.         self.check_ordering_of_field_choices([self.b2, self.b1])\n176. \n177.     def test_admin_ordering_beats_model_ordering(self):\n178.         class StaticOrderingBandAdmin(admin.ModelAdmin):\n179.             ordering = ("rank",)\n180. \n181.         site.register(Band, StaticOrderingBandAdmin)\n182. \n183.         # should be ordered by rank (defined by the ModelAdmin)\n184.         self.check_ordering_of_field_choices([self.b1, self.b2])\n185. \n186.     def test_custom_queryset_still_wins(self):\n187.         """Custom queryset has still precedence (#21405)"""\n188. \n189.         class SongAdmin(admin.ModelAdmin):\n190.             # Exclude one of the two Bands from the querysets\n191.             def formfield_for_foreignkey(self, db_field, request, **kwargs):\n192.                 if db_field.name == "band":\n193.                     kwargs["queryset"] = Band.objects.filter(rank__gt=2)\n194.                 return super().formfield_for_foreignkey(db_field, request, **kwargs)\n195. \n196.             def formfield_for_manytomany(self, db_field, request, **kwargs):\n197.                 if db_field.name == "other_interpreters":\n198.                     kwargs["queryset"] = Band.objects.filter(rank__gt=2)\n199.                 return super().formfield_for_foreignkey(db_field, request, **kwargs)\n200. \n201.         class StaticOrderingBandAdmin(admin.ModelAdmin):\n202.             ordering = ("rank",)\n203. \n204.         site.unregister(Song)\n205.         site.register(Song, SongAdmin)\n206.         site.register(Band, StaticOrderingBandAdmin)\n207. \n208.         self.check_ordering_of_field_choices([self.b2])', start_line_number=134, end_line_number=208)]
2025-10-06 20:01:09,336 - thread-139660780025408.app.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-10-06 20:01:09,336 - thread-139660780025408.app.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .github
|   ├── CODE_OF_CONDUCT.md
|   ├── FUNDING.yml
|   ├── SECURITY.md
|   └── workflows
|       ├── docs.yml
|       ├── linters.yml
|       ├── new_contributor_pr.yml
|       └── tests.yml
├── .pre-commit-config.yaml
├── .readthedocs.yml
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ar_DZ
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ig
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ky
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ms
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uz
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   ├── 0012_alter_user_first_name_max_length.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   ├── options.py
|   |   |   |   └── widgets.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── constraints.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── ms
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── tg
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── uz
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_redirect_new_path_help_text.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── templates
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── asgi.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   ├── memcached.py
|   |   |   |   └── redis.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── async_checks.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   ├── __init__.py
|   |   |   |   └── django_4_0.py
|   |   |   ├── database.py
|   |   |   ├── files.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── asgi.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── __init__.py
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── optimizemigration.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── jsonl.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _functions.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   └── special.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── enums.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── json.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── autoreload.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── asyncio.py
|   |   ├── autoreload.py
|   |   ├── baseconv.py
|   |   ├── cache.py
|   |   ├── connection.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── datetime_safe.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── topological_sort.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── common.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           └── technical_500.txt
├── docs
|   ├── README.rst
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   └── static
|   |   |       └── fontawesome
|   |   └── djangodocs-epub
|   |       └── static
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── _images
|   |   ├── auth-remote-user.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-backend.txt
|   |   ├── custom-template-tags.txt
|   |   ├── deployment
|   |   |   ├── asgi
|   |   |   |   ├── daphne.txt
|   |   |   |   ├── hypercorn.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── uvicorn.txt
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── legacy-databases.txt
|   |   ├── logging.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── filters.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── constraints.txt
|   |   |   |   ├── expressions.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── logging.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── paginator.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.19.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.20.txt
|   |   ├── 1.11.21.txt
|   |   ├── 1.11.22.txt
|   |   ├── 1.11.23.txt
|   |   ├── 1.11.24.txt
|   |   ├── 1.11.25.txt
|   |   ├── 1.11.26.txt
|   |   ├── 1.11.27.txt
|   |   ├── 1.11.28.txt
|   |   ├── 1.11.29.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.11.txt
|   |   ├── 2.0.12.txt
|   |   ├── 2.0.13.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.10.txt
|   |   ├── 2.1.11.txt
|   |   ├── 2.1.12.txt
|   |   ├── 2.1.13.txt
|   |   ├── 2.1.14.txt
|   |   ├── 2.1.15.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.7.txt
|   |   ├── 2.1.8.txt
|   |   ├── 2.1.9.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.1.txt
|   |   ├── 2.2.10.txt
|   |   ├── 2.2.11.txt
|   |   ├── 2.2.12.txt
|   |   ├── 2.2.13.txt
|   |   ├── 2.2.14.txt
|   |   ├── 2.2.15.txt
|   |   ├── 2.2.16.txt
|   |   ├── 2.2.17.txt
|   |   ├── 2.2.18.txt
|   |   ├── 2.2.19.txt
|   |   ├── 2.2.2.txt
|   |   ├── 2.2.20.txt
|   |   ├── 2.2.21.txt
|   |   ├── 2.2.22.txt
|   |   ├── 2.2.23.txt
|   |   ├── 2.2.24.txt
|   |   ├── 2.2.25.txt
|   |   ├── 2.2.26.txt
|   |   ├── 2.2.27.txt
|   |   ├── 2.2.3.txt
|   |   ├── 2.2.4.txt
|   |   ├── 2.2.5.txt
|   |   ├── 2.2.6.txt
|   |   ├── 2.2.7.txt
|   |   ├── 2.2.8.txt
|   |   ├── 2.2.9.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.1.txt
|   |   ├── 3.0.10.txt
|   |   ├── 3.0.11.txt
|   |   ├── 3.0.12.txt
|   |   ├── 3.0.13.txt
|   |   ├── 3.0.14.txt
|   |   ├── 3.0.2.txt
|   |   ├── 3.0.3.txt
|   |   ├── 3.0.4.txt
|   |   ├── 3.0.5.txt
|   |   ├── 3.0.6.txt
|   |   ├── 3.0.7.txt
|   |   ├── 3.0.8.txt
|   |   ├── 3.0.9.txt
|   |   ├── 3.0.txt
|   |   ├── 3.1.1.txt
|   |   ├── 3.1.10.txt
|   |   ├── 3.1.11.txt
|   |   ├── 3.1.12.txt
|   |   ├── 3.1.13.txt
|   |   ├── 3.1.14.txt
|   |   ├── 3.1.2.txt
|   |   ├── 3.1.3.txt
|   |   ├── 3.1.4.txt
|   |   ├── 3.1.5.txt
|   |   ├── 3.1.6.txt
|   |   ├── 3.1.7.txt
|   |   ├── 3.1.8.txt
|   |   ├── 3.1.9.txt
|   |   ├── 3.1.txt
|   |   ├── 3.2.1.txt
|   |   ├── 3.2.10.txt
|   |   ├── 3.2.11.txt
|   |   ├── 3.2.12.txt
|   |   ├── 3.2.2.txt
|   |   ├── 3.2.3.txt
|   |   ├── 3.2.4.txt
|   |   ├── 3.2.5.txt
|   |   ├── 3.2.6.txt
|   |   ├── 3.2.7.txt
|   |   ├── 3.2.8.txt
|   |   ├── 3.2.9.txt
|   |   ├── 3.2.txt
|   |   ├── 4.0.1.txt
|   |   ├── 4.0.2.txt
|   |   ├── 4.0.3.txt
|   |   ├── 4.0.txt
|   |   ├── 4.1.txt
|   |   ├── index.txt
|   |   └── security.txt
|   ├── requirements.txt
|   └── topics
|       ├── async.txt
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   ├── jsi18n-mocks.test.js
|   |   └── navigation.test.js
|   └── gis
|       └── mapwidget.test.js
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_dynamic_settings_manage.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── .hidden
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       ├── noargs_command.py
    |   |       └── suppress_base_options_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   └── admin
    |   |       └── admin_views
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_forms.py
    |   ├── test_history_view.py
    |   ├── test_multidb.py
    |   ├── test_nav_sidebar.py
    |   ├── test_prevent_double_submission.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   ├── no_config_app
    |   |   └── __init__.py
    |   ├── one_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── tests.py
    |   ├── two_configs_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── two_configs_one_default_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   └── two_default_configs_app
    |       ├── __init__.py
    |       └── apps.py
    ├── asgi
    |   ├── __init__.py
    |   ├── project
    |   |   └── static
    |   |       └── file.txt
    |   ├── tests.py
    |   └── urls.py
    ├── async
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   ├── with_last_login_attr.py
    |   |   └── with_many_to_many.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   └── registration
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_remote_user.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── app_unmigrated
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── test_base.py
    |   |   ├── test_client.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_functions.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   ├── tests.py
    |   └── tests_async.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── template_test_apps
    |   |   ├── __init__.py
    |   |   ├── different_tags_app
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   ├── same_tags_app_1
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   └── same_tags_app_2
    |   |       ├── __init__.py
    |   |       ├── apps.py
    |   |       └── templatetags
    |   ├── test_4_0_compatibility.py
    |   ├── test_async_checks.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_files.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_class_based_error_handlers.py
    |       ├── bad_error_handlers_invalid_path.py
    |       ├── bad_function_based_error_handlers.py
    |       ├── beginning_with_slash.py
    |       ├── cbv_as_view.py
    |       ├── contains_tuple.py
    |       ├── good_class_based_error_handlers.py
    |       ├── good_function_based_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   └── ending_with_dollar.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_collate.py
    |   |   ├── test_greatest.py
    |   |   ├── test_json_object.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_random.py
    |   |   ├── test_round.py
    |   |   ├── test_sign.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_md5.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_sha1.py
    |   |   ├── test_sha224.py
    |   |   ├── test_sha256.py
    |   |   ├── test_sha384.py
    |   |   ├── test_sha512.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── fake_client.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   ├── test_postgresql.py
    |   ├── test_sqlite.py
    |   └── tests.py
    ├── decorators
    |   ├── __init__.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   ├── test_csrf_cookie_masked.py
    |   ├── test_middleware_mixin.py
    |   ├── test_use_l10n.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── empty_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── test_commands.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── absolute_urls.py
    |   ├── no_slash_urls.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   └── registration
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_jsonfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   └── tags.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_deprecation_forms.py
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   └── robots.txt
    |   |   └── registration
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── has_nulls
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   ├── test_srs.py
    |   |   └── tests.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoadmin_deprecated
    |   |   ├── __init__.py
    |   |   ├── admin.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_indexes.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_create_models.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_rastermodels.py
    |   |   |   └── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   └── javascript_ignored.js
    |   |   └── templates
    |   |       └── subdir
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── loading
    |   |   ├── en
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_AU
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_CA
    |   |   |   └── LC_MESSAGES
    |   |   └── en_NZ
    |   |       └── LC_MESSAGES
    |   ├── loading_app
    |   |   ├── __init__.py
    |   |   ├── apps.py
    |   |   └── locale
    |   |       └── en
    |   ├── models.py
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── unchanged
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   ├── tests.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_fake_initial_case_insensitive
    |   |   ├── fake_initial
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── initial
    |   |       ├── 0001_initial.py
    |   |       └── __init__.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_conflict_long_name
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second_migration_with_long_name.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_manual_porting
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   └── __init__.py
    |   ├── test_migrations_namespace_package
    |   |   └── 0001_initial.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_no_operations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   ├── 0005_fifth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_no_replaces
    |   |   ├── 0001_squashed_0002.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_enums
    |   ├── __init__.py
    |   └── tests.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autofield.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_filepathfield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_jsonfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_pk.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── model_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── integration_settings.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_constraints.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_integration.py
    |   ├── test_introspection.py
    |   ├── test_operations.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_contains.py
    |   ├── test_db_returning.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   ├── test_sqlcompiler.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests
    |   ├── __init__.py
    |   ├── test_accept_header.py
    |   ├── test_data_upload_settings.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_jsonl.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_clear_expired.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   ├── templates
    |   |   └── shortcuts
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   ├── test_management.py
    |   ├── test_utils.py
    |   └── urls
    |       ├── __init__.py
    |       ├── empty.py
    |       ├── http.py
    |       ├── https.py
    |       ├── index_only.py
    |       └── sitemap_only.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── cached
    |   |   |   ├── nested
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   ├── loop
    |   |   ├── pathlib
    |   |   |   └── pathlib.txt
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   ├── jinja2
    |   |   └── template_backends
    |   ├── template_strings
    |   |   └── template_backends
    |   ├── templates
    |   |   └── template_backends
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   ├── templates
    |   |   └── template_loader
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   ├── other_templates
    |   |   └── priority
    |   ├── recursive_templates
    |   |   ├── fs
    |   |   ├── fs2
    |   |   └── fs3
    |   ├── relative_templates
    |   |   └── dir1
    |   |       └── dir2
    |   ├── syntax_tests
    |   |   ├── __init__.py
    |   |   ├── i18n
    |   |   |   ├── __init__.py
    |   |   |   ├── base.py
    |   |   |   ├── test_blocktranslate.py
    |   |   |   ├── test_filters.py
    |   |   |   ├── test_get_available_languages.py
    |   |   |   ├── test_get_current_language.py
    |   |   |   ├── test_get_current_language_bidi.py
    |   |   |   ├── test_get_language_info.py
    |   |   |   ├── test_get_language_info_list.py
    |   |   |   ├── test_language.py
    |   |   |   ├── test_translate.py
    |   |   |   └── test_underscore_syntax.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_basic.py
    |   |   ├── test_builtins.py
    |   |   ├── test_cache.py
    |   |   ├── test_comment.py
    |   |   ├── test_cycle.py
    |   |   ├── test_debug.py
    |   |   ├── test_exceptions.py
    |   |   ├── test_extends.py
    |   |   ├── test_filter_syntax.py
    |   |   ├── test_filter_tag.py
    |   |   ├── test_firstof.py
    |   |   ├── test_for.py
    |   |   ├── test_if.py
    |   |   ├── test_if_changed.py
    |   |   ├── test_include.py
    |   |   ├── test_invalid_string.py
    |   |   ├── test_list_index.py
    |   |   ├── test_load.py
    |   |   ├── test_lorem.py
    |   |   ├── test_multiline.py
    |   |   ├── test_named_endblock.py
    |   |   ├── test_now.py
    |   |   ├── test_numpy.py
    |   |   ├── test_regroup.py
    |   |   ├── test_resetcycle.py
    |   |   ├── test_setup.py
    |   |   ├── test_simple_tag.py
    |   |   ├── test_spaceless.py
    |   |   ├── test_static.py
    |   |   ├── test_template_tag.py
    |   |   ├── test_url.py
    |   |   ├── test_verbatim.py
    |   |   ├── test_width_ratio.py
    |   |   └── test_with.py
    |   ├── templates
    |   |   ├── first
    |   |   ├── priority
    |   |   ├── second
    |   |   └── template_tests
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   ├── bad_tag.py
    |   |   ├── custom.py
    |   |   ├── inclusion.py
    |   |   ├── subpackage
    |   |   |   ├── __init__.py
    |   |   |   └── echo.py
    |   |   ├── tag_27584.py
    |   |   └── testtags.py
    |   ├── test_autoreloader.py
    |   ├── test_base.py
    |   ├── test_callables.py
    |   ├── test_context.py
    |   ├── test_custom.py
    |   ├── test_engine.py
    |   ├── test_extends.py
    |   ├── test_extends_relative.py
    |   ├── test_library.py
    |   ├── test_loaders.py
    |   ├── test_logging.py
    |   ├── test_nodelist.py
    |   ├── test_origin.py
    |   ├── test_parser.py
    |   ├── test_response.py
    |   ├── test_smartif.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── utils.py
    |   └── views.py
    ├── templates
    |   ├── comments
    |   |   └── comment_notification_email.txt
    |   ├── custom_admin
    |   └── views
    ├── test_client
    |   ├── __init__.py
    |   ├── auth_backends.py
    |   ├── test_conditional_content_removal.py
    |   ├── test_fakepayload.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_middleware_urlconf.py
    |   └── views.py
    ├── test_client_regress
    |   ├── __init__.py
    |   ├── auth_backends.py
    |   ├── bad_templates
    |   ├── context_processors.py
    |   ├── models.py
    |   ├── session.py
    |   ├── templates
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── test_exceptions
    |   ├── __init__.py
    |   └── test_validation_error.py
    ├── test_runner
    |   ├── __init__.py
    |   ├── models.py
    |   ├── runner.py
    |   ├── test_debug_sql.py
    |   ├── test_discover_runner.py
    |   ├── test_parallel.py
    |   ├── test_shuffler.py
    |   └── tests.py
    ├── test_runner_apps
    |   ├── __init__.py
    |   ├── buffer
    |   |   └── tests_buffer.py
    |   ├── databases
    |   |   ├── __init__.py
    |   |   └── tests.py
    |   ├── failures
    |   |   ├── __init__.py
    |   |   └── tests_failures.py
    |   ├── sample
    |   |   ├── __init__.py
    |   |   ├── doctests.py
    |   |   ├── empty.py
    |   |   ├── pattern_tests.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── tests.py
    |   |   └── tests_sample.py
    |   ├── simple
    |   |   ├── __init__.py
    |   |   └── tests.py
    |   └── tagged
    |       ├── __init__.py
    |       ├── tests.py
    |       ├── tests_inheritance.py
    |       └── tests_syntax_error.py
    ├── test_sqlite.py
    ├── test_utils
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── templates
    |   |   └── template_used
    |   ├── test_serializemixin.py
    |   ├── test_simpletestcase.py
    |   ├── test_testcase.py
    |   ├── test_transactiontestcase.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── timezones
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── transaction_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── transactions
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── unmanaged_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── update_only_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── urlpatterns
    |   ├── __init__.py
    |   ├── converter_urls.py
    |   ├── converters.py
    |   ├── included_urls.py
    |   ├── more_urls.py
    |   ├── path_base64_urls.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
ModelAdmin with defined radio_fields override empty_label

Issue description: 
Description
	
ModelAdmin drops my "empty_label" and set "default_empty_label". For example:
class MyModelAdmin(ModelAdmin):
	radio_fields = 'myfield',
	def formfield_for_foreignkey(self, db_field, *args, **kwargs):
		if db_field.name == 'myfield':
			kwargs['empty_label'] = "I WANT TO SET MY OWN EMPTY LABEL"
		return super().formfield_for_foreignkey(db_field, *args, **kwargs)
You get never the "I WANT TO SET MY OWN EMPTY LABEL"
How to fix it:
In django\contrib\admin\options.py, row 234:
kwargs['empty_label'] = _('None') if db_field.blank else None
Should be changed on:
kwargs['empty_label'] = (kwargs.get('empty_label') or _('None')) if db_field.blank else None

Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: tests/admin_views/tests.py
Line number range: 2911 - 2939
Content:
2911.     def test_conditionally_show_delete_section_link(self):
2912.         """
2913.         The foreign key widget should only show the "delete related" button if
2914.         the user has permission to delete that related item.
2915.         """
2916. 
2917.         def get_delete_related(response):
2918.             return (
2919.                 response.context["adminform"]
2920.                 .form.fields["sub_section"]
2921.                 .widget.can_delete_related
2922.             )
2923. 
2924.         self.client.force_login(self.adduser)
2925.         # The user can't delete sections yet, so they shouldn't see the
2926.         # "delete section" link.
2927.         url = reverse("admin:admin_views_article_add")
2928.         delete_link_text = "delete_id_sub_section"
2929.         response = self.client.get(url)
2930.         self.assertFalse(get_delete_related(response))
2931.         self.assertNotContains(response, delete_link_text)
2932.         # Allow the user to delete sections too. Now they can see the
2933.         # "delete section" link.
2934.         user = User.objects.get(username="adduser")
2935.         perm = get_perm(Section, get_permission_codename("delete", Section._meta))
2936.         user.user_permissions.add(perm)
2937.         response = self.client.get(url)
2938.         self.assertTrue(get_delete_related(response))
2939.         self.assertContains(response, delete_link_text)


File: tests/forms_tests/field_tests/test_choicefield.py
Line number range: 22 - 30
Content:
22.     def test_choicefield_2(self):
23.         f = ChoiceField(choices=[("1", "One"), ("2", "Two")], required=False)
24.         self.assertEqual("", f.clean(""))
25.         self.assertEqual("", f.clean(None))
26.         self.assertEqual("1", f.clean(1))
27.         self.assertEqual("1", f.clean("1"))
28.         msg = "'Select a valid choice. 3 is not one of the available choices.'"
29.         with self.assertRaisesMessage(ValidationError, msg):
30.             f.clean("3")


File: tests/modeladmin/tests.py
Line number range: 1 - 805
Content:
1. from datetime import date
2. 
3. from django import forms
4. from django.contrib.admin.models import ADDITION, CHANGE, DELETION, LogEntry
5. from django.contrib.admin.options import (
6.     HORIZONTAL,
7.     VERTICAL,
8.     ModelAdmin,
9.     TabularInline,
10.     get_content_type_for_model,
11. )
12. from django.contrib.admin.sites import AdminSite
13. from django.contrib.admin.widgets import (
14.     AdminDateWidget,
15.     AdminRadioSelect,
16.     AutocompleteSelect,
17.     AutocompleteSelectMultiple,
18. )
19. from django.contrib.auth.models import User
20. from django.db import models
21. from django.forms.widgets import Select
22. from django.test import SimpleTestCase, TestCase
23. from django.test.utils import isolate_apps
24. 
25. from .models import Band, Concert, Song
26. 
27. 
28. class MockRequest:
29.     pass
30. 
31. 
32. class MockSuperUser:
33.     def has_perm(self, perm, obj=None):
34.         return True
35. 
36. 
37. request = MockRequest()
38. request.user = MockSuperUser()
39. 
40. 
41. class ModelAdminTests(TestCase):
42.     @classmethod
43.     def setUpTestData(cls):
44.         cls.band = Band.objects.create(
45.             name="The Doors",
46.             bio="",
47.             sign_date=date(1965, 1, 1),
48.         )
49. 
50.     def setUp(self):
51.         self.site = AdminSite()
52. 
53.     def test_modeladmin_str(self):
54.         ma = ModelAdmin(Band, self.site)
55.         self.assertEqual(str(ma), "modeladmin.ModelAdmin")
56. 
57.     def test_default_attributes(self):
58.         ma = ModelAdmin(Band, self.site)
59.         self.assertEqual(ma.actions, ())
60.         self.assertEqual(ma.inlines, ())
61. 
62.     # form/fields/fieldsets interaction ##############################
63. 
64.     def test_default_fields(self):
65.         ma = ModelAdmin(Band, self.site)
66.         self.assertEqual(
67.             list(ma.get_form(request).base_fields), ["name", "bio", "sign_date"]
68.         )
69.         self.assertEqual(list(ma.get_fields(request)), ["name", "bio", "sign_date"])
70.         self.assertEqual(
71.             list(ma.get_fields(request, self.band)), ["name", "bio", "sign_date"]
72.         )
73.         self.assertIsNone(ma.get_exclude(request, self.band))
74. 
75.     def test_default_fieldsets(self):
76.         # fieldsets_add and fieldsets_change should return a special data structure that
77.         # is used in the templates. They should generate the "right thing" whether we
78.         # have specified a custom form, the fields argument, or nothing at all.
79.         #
80.         # Here's the default case. There are no custom form_add/form_change methods,
81.         # no fields argument, and no fieldsets argument.
82.         ma = ModelAdmin(Band, self.site)
83.         self.assertEqual(
84.             ma.get_fieldsets(request),
85.             [(None, {"fields": ["name", "bio", "sign_date"]})],
86.         )
87.         self.assertEqual(
88.             ma.get_fieldsets(request, self.band),
89.             [(None, {"fields": ["name", "bio", "sign_date"]})],
90.         )
91. 
92.     def test_get_fieldsets(self):
93.         # get_fieldsets() is called when figuring out form fields (#18681).
94.         class BandAdmin(ModelAdmin):
95.             def get_fieldsets(self, request, obj=None):
96.                 return [(None, {"fields": ["name", "bio"]})]
97. 
98.         ma = BandAdmin(Band, self.site)
99.         form = ma.get_form(None)
100.         self.assertEqual(form._meta.fields, ["name", "bio"])
101. 
102.         class InlineBandAdmin(TabularInline):
103.             model = Concert
104.             fk_name = "main_band"
105.             can_delete = False
106. 
107.             def get_fieldsets(self, request, obj=None):
108.                 return [(None, {"fields": ["day", "transport"]})]
109. 
110.         ma = InlineBandAdmin(Band, self.site)
111.         form = ma.get_formset(None).form
112.         self.assertEqual(form._meta.fields, ["day", "transport"])
113. 
114.     def test_lookup_allowed_allows_nonexistent_lookup(self):
115.         """
116.         A lookup_allowed allows a parameter whose field lookup doesn't exist.
117.         (#21129).
118.         """
119. 
120.         class BandAdmin(ModelAdmin):
121.             fields = ["name"]
122. 
123.         ma = BandAdmin(Band, self.site)
124.         self.assertTrue(ma.lookup_allowed("name__nonexistent", "test_value"))
125. 
126.     @isolate_apps("modeladmin")
127.     def test_lookup_allowed_onetoone(self):
128.         class Department(models.Model):
129.             code = models.CharField(max_length=4, unique=True)
130. 
131.         class Employee(models.Model):
132.             department = models.ForeignKey(Department, models.CASCADE, to_field="code")
133. 
134.         class EmployeeProfile(models.Model):
135.             employee = models.OneToOneField(Employee, models.CASCADE)
136. 
137.         class EmployeeInfo(models.Model):
138.             employee = models.OneToOneField(Employee, models.CASCADE)
139.             description = models.CharField(max_length=100)
140. 
141.         class EmployeeProfileAdmin(ModelAdmin):
142.             list_filter = [
143.                 "employee__employeeinfo__description",
144.                 "employee__department__code",
145.             ]
146. 
147.         ma = EmployeeProfileAdmin(EmployeeProfile, self.site)
148.         # Reverse OneToOneField
149.         self.assertIs(
150.             ma.lookup_allowed("employee__employeeinfo__description", "test_value"), True
151.         )
152.         # OneToOneField and ForeignKey
153.         self.assertIs(
154.             ma.lookup_allowed("employee__department__code", "test_value"), True
155.         )
156. 
157.     def test_field_arguments(self):
158.         # If fields is specified, fieldsets_add and fieldsets_change should
159.         # just stick the fields into a formsets structure and return it.
160.         class BandAdmin(ModelAdmin):
161.             fields = ["name"]
162. 
163.         ma = BandAdmin(Band, self.site)
164. 
165.         self.assertEqual(list(ma.get_fields(request)), ["name"])
166.         self.assertEqual(list(ma.get_fields(request, self.band)), ["name"])
167.         self.assertEqual(ma.get_fieldsets(request), [(None, {"fields": ["name"]})])
168.         self.assertEqual(
169.             ma.get_fieldsets(request, self.band), [(None, {"fields": ["name"]})]
170.         )
171. 
172.     def test_field_arguments_restricted_on_form(self):
173.         # If fields or fieldsets is specified, it should exclude fields on the
174.         # Form class to the fields specified. This may cause errors to be
175.         # raised in the db layer if required model fields aren't in fields/
176.         # fieldsets, but that's preferable to ghost errors where a field in the
177.         # Form class isn't being displayed because it's not in fields/fieldsets.
178. 
179.         # Using `fields`.
180.         class BandAdmin(ModelAdmin):
181.             fields = ["name"]
182. 
183.         ma = BandAdmin(Band, self.site)
184.         self.assertEqual(list(ma.get_form(request).base_fields), ["name"])
185.         self.assertEqual(list(ma.get_form(request, self.band).base_fields), ["name"])
186. 
187.         # Using `fieldsets`.
188.         class BandAdmin(ModelAdmin):
189.             fieldsets = [(None, {"fields": ["name"]})]
190. 
191.         ma = BandAdmin(Band, self.site)
192.         self.assertEqual(list(ma.get_form(request).base_fields), ["name"])
193.         self.assertEqual(list(ma.get_form(request, self.band).base_fields), ["name"])
194. 
195.         # Using `exclude`.
196.         class BandAdmin(ModelAdmin):
197.             exclude = ["bio"]
198. 
199.         ma = BandAdmin(Band, self.site)
200.         self.assertEqual(list(ma.get_form(request).base_fields), ["name", "sign_date"])
201. 
202.         # You can also pass a tuple to `exclude`.
203.         class BandAdmin(ModelAdmin):
204.             exclude = ("bio",)
205. 
206.         ma = BandAdmin(Band, self.site)
207.         self.assertEqual(list(ma.get_form(request).base_fields), ["name", "sign_date"])
208. 
209.         # Using `fields` and `exclude`.
210.         class BandAdmin(ModelAdmin):
211.             fields = ["name", "bio"]
212.             exclude = ["bio"]
213. 
214.         ma = BandAdmin(Band, self.site)
215.         self.assertEqual(list(ma.get_form(request).base_fields), ["name"])
216. 
217.     def test_custom_form_meta_exclude_with_readonly(self):
218.         """
219.         The custom ModelForm's `Meta.exclude` is respected when used in
220.         conjunction with `ModelAdmin.readonly_fields` and when no
221.         `ModelAdmin.exclude` is defined (#14496).
222.         """
223.         # With ModelAdmin
224.         class AdminBandForm(forms.ModelForm):
225.             class Meta:
226.                 model = Band
227.                 exclude = ["bio"]
228. 
229.         class BandAdmin(ModelAdmin):
230.             readonly_fields = ["name"]
231.             form = AdminBandForm
232. 
233.         ma = BandAdmin(Band, self.site)
234.         self.assertEqual(list(ma.get_form(request).base_fields), ["sign_date"])
235. 
236.         # With InlineModelAdmin
237.         class AdminConcertForm(forms.ModelForm):
238.             class Meta:
239.                 model = Concert
240.                 exclude = ["day"]
241. 
242.         class ConcertInline(TabularInline):
243.             readonly_fields = ["transport"]
244.             form = AdminConcertForm
245.             fk_name = "main_band"
246.             model = Concert
247. 
248.         class BandAdmin(ModelAdmin):
249.             inlines = [ConcertInline]
250. 
251.         ma = BandAdmin(Band, self.site)
252.         self.assertEqual(
253.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),
254.             ["main_band", "opening_band", "id", "DELETE"],
255.         )
256. 
257.     def test_custom_formfield_override_readonly(self):
258.         class AdminBandForm(forms.ModelForm):
259.             name = forms.CharField()
260. 
261.             class Meta:
262.                 exclude = ()
263.                 model = Band
264. 
265.         class BandAdmin(ModelAdmin):
266.             form = AdminBandForm
267.             readonly_fields = ["name"]
268. 
269.         ma = BandAdmin(Band, self.site)
270. 
271.         # `name` shouldn't appear in base_fields because it's part of
272.         # readonly_fields.
273.         self.assertEqual(list(ma.get_form(request).base_fields), ["bio", "sign_date"])
274.         # But it should appear in get_fields()/fieldsets() so it can be
275.         # displayed as read-only.
276.         self.assertEqual(list(ma.get_fields(request)), ["bio", "sign_date", "name"])
277.         self.assertEqual(
278.             list(ma.get_fieldsets(request)),
279.             [(None, {"fields": ["bio", "sign_date", "name"]})],
280.         )
281. 
282.     def test_custom_form_meta_exclude(self):
283.         """
284.         The custom ModelForm's `Meta.exclude` is overridden if
285.         `ModelAdmin.exclude` or `InlineModelAdmin.exclude` are defined (#14496).
286.         """
287.         # With ModelAdmin
288.         class AdminBandForm(forms.ModelForm):
289.             class Meta:
290.                 model = Band
291.                 exclude = ["bio"]
292. 
293.         class BandAdmin(ModelAdmin):
294.             exclude = ["name"]
295.             form = AdminBandForm
296. 
297.         ma = BandAdmin(Band, self.site)
298.         self.assertEqual(list(ma.get_form(request).base_fields), ["bio", "sign_date"])
299. 
300.         # With InlineModelAdmin
301.         class AdminConcertForm(forms.ModelForm):
302.             class Meta:
303.                 model = Concert
304.                 exclude = ["day"]
305. 
306.         class ConcertInline(TabularInline):
307.             exclude = ["transport"]
308.             form = AdminConcertForm
309.             fk_name = "main_band"
310.             model = Concert
311. 
312.         class BandAdmin(ModelAdmin):
313.             inlines = [ConcertInline]
314. 
315.         ma = BandAdmin(Band, self.site)
316.         self.assertEqual(
317.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),
318.             ["main_band", "opening_band", "day", "id", "DELETE"],
319.         )
320. 
321.     def test_overriding_get_exclude(self):
322.         class BandAdmin(ModelAdmin):
323.             def get_exclude(self, request, obj=None):
324.                 return ["name"]
325. 
326.         self.assertEqual(
327.             list(BandAdmin(Band, self.site).get_form(request).base_fields),
328.             ["bio", "sign_date"],
329.         )
330. 
331.     def test_get_exclude_overrides_exclude(self):
332.         class BandAdmin(ModelAdmin):
333.             exclude = ["bio"]
334. 
335.             def get_exclude(self, request, obj=None):
336.                 return ["name"]
337. 
338.         self.assertEqual(
339.             list(BandAdmin(Band, self.site).get_form(request).base_fields),
340.             ["bio", "sign_date"],
341.         )
342. 
343.     def test_get_exclude_takes_obj(self):
344.         class BandAdmin(ModelAdmin):
345.             def get_exclude(self, request, obj=None):
346.                 if obj:
347.                     return ["sign_date"]
348.                 return ["name"]
349. 
350.         self.assertEqual(
351.             list(BandAdmin(Band, self.site).get_form(request, self.band).base_fields),
352.             ["name", "bio"],
353.         )
354. 
355.     def test_custom_form_validation(self):
356.         # If a form is specified, it should use it allowing custom validation
357.         # to work properly. This won't break any of the admin widgets or media.
358.         class AdminBandForm(forms.ModelForm):
359.             delete = forms.BooleanField()
360. 
361.         class BandAdmin(ModelAdmin):
362.             form = AdminBandForm
363. 
364.         ma = BandAdmin(Band, self.site)
365.         self.assertEqual(
366.             list(ma.get_form(request).base_fields),
367.             ["name", "bio", "sign_date", "delete"],
368.         )
369.         self.assertEqual(
370.             type(ma.get_form(request).base_fields["sign_date"].widget), AdminDateWidget
371.         )
372. 
373.     def test_form_exclude_kwarg_override(self):
374.         """
375.         The `exclude` kwarg passed to `ModelAdmin.get_form()` overrides all
376.         other declarations (#8999).
377.         """
378. 
379.         class AdminBandForm(forms.ModelForm):
380.             class Meta:
381.                 model = Band
382.                 exclude = ["name"]
383. 
384.         class BandAdmin(ModelAdmin):
385.             exclude = ["sign_date"]
386.             form = AdminBandForm
387. 
388.             def get_form(self, request, obj=None, **kwargs):
389.                 kwargs["exclude"] = ["bio"]
390.                 return super().get_form(request, obj, **kwargs)
391. 
392.         ma = BandAdmin(Band, self.site)
393.         self.assertEqual(list(ma.get_form(request).base_fields), ["name", "sign_date"])
394. 
395.     def test_formset_exclude_kwarg_override(self):
396.         """
397.         The `exclude` kwarg passed to `InlineModelAdmin.get_formset()`
398.         overrides all other declarations (#8999).
399.         """
400. 
401.         class AdminConcertForm(forms.ModelForm):
402.             class Meta:
403.                 model = Concert
404.                 exclude = ["day"]
405. 
406.         class ConcertInline(TabularInline):
407.             exclude = ["transport"]
408.             form = AdminConcertForm
409.             fk_name = "main_band"
410.             model = Concert
411. 
412.             def get_formset(self, request, obj=None, **kwargs):
413.                 kwargs["exclude"] = ["opening_band"]
414.                 return super().get_formset(request, obj, **kwargs)
415. 
416.         class BandAdmin(ModelAdmin):
417.             inlines = [ConcertInline]
418. 
419.         ma = BandAdmin(Band, self.site)
420.         self.assertEqual(
421.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),
422.             ["main_band", "day", "transport", "id", "DELETE"],
423.         )
424. 
425.     def test_formset_overriding_get_exclude_with_form_fields(self):
426.         class AdminConcertForm(forms.ModelForm):
427.             class Meta:
428.                 model = Concert
429.                 fields = ["main_band", "opening_band", "day", "transport"]
430. 
431.         class ConcertInline(TabularInline):
432.             form = AdminConcertForm
433.             fk_name = "main_band"
434.             model = Concert
435. 
436.             def get_exclude(self, request, obj=None):
437.                 return ["opening_band"]
438. 
439.         class BandAdmin(ModelAdmin):
440.             inlines = [ConcertInline]
441. 
442.         ma = BandAdmin(Band, self.site)
443.         self.assertEqual(
444.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),
445.             ["main_band", "day", "transport", "id", "DELETE"],
446.         )
447. 
448.     def test_formset_overriding_get_exclude_with_form_exclude(self):
449.         class AdminConcertForm(forms.ModelForm):
450.             class Meta:
451.                 model = Concert
452.                 exclude = ["day"]
453. 
454.         class ConcertInline(TabularInline):
455.             form = AdminConcertForm
456.             fk_name = "main_band"
457.             model = Concert
458. 
459.             def get_exclude(self, request, obj=None):
460.                 return ["opening_band"]
461. 
462.         class BandAdmin(ModelAdmin):
463.             inlines = [ConcertInline]
464. 
465.         ma = BandAdmin(Band, self.site)
466.         self.assertEqual(
467.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),
468.             ["main_band", "day", "transport", "id", "DELETE"],
469.         )
470. 
471.     def test_raw_id_fields_widget_override(self):
472.         """
473.         The autocomplete_fields, raw_id_fields, and radio_fields widgets may
474.         overridden by specifying a widget in get_formset().
475.         """
476. 
477.         class ConcertInline(TabularInline):
478.             model = Concert
479.             fk_name = "main_band"
480.             raw_id_fields = ("opening_band",)
481. 
482.             def get_formset(self, request, obj=None, **kwargs):
483.                 kwargs["widgets"] = {"opening_band": Select}
484.                 return super().get_formset(request, obj, **kwargs)
485. 
486.         class BandAdmin(ModelAdmin):
487.             inlines = [ConcertInline]
488. 
489.         ma = BandAdmin(Band, self.site)
490.         band_widget = (
491.             list(ma.get_formsets_with_inlines(request))[0][0]()
492.             .forms[0]
493.             .fields["opening_band"]
494.             .widget
495.         )
496.         # Without the override this would be ForeignKeyRawIdWidget.
497.         self.assertIsInstance(band_widget, Select)
498. 
499.     def test_queryset_override(self):
500.         # If the queryset of a ModelChoiceField in a custom form is overridden,
501.         # RelatedFieldWidgetWrapper doesn't mess that up.
502.         band2 = Band.objects.create(
503.             name="The Beatles", bio="", sign_date=date(1962, 1, 1)
504.         )
505. 
506.         ma = ModelAdmin(Concert, self.site)
507.         form = ma.get_form(request)()
508. 
509.         self.assertHTMLEqual(
510.             str(form["main_band"]),
511.             '<div class="related-widget-wrapper">'
512.             '<select name="main_band" id="id_main_band" required>'
513.             '<option value="" selected>---------</option>'
514.             '<option value="%d">The Beatles</option>'
515.             '<option value="%d">The Doors</option>'
516.             "</select></div>" % (band2.id, self.band.id),
517.         )
518. 
519.         class AdminConcertForm(forms.ModelForm):
520.             def __init__(self, *args, **kwargs):
521.                 super().__init__(*args, **kwargs)
522.                 self.fields["main_band"].queryset = Band.objects.filter(
523.                     name="The Doors"
524.                 )
525. 
526.         class ConcertAdminWithForm(ModelAdmin):
527.             form = AdminConcertForm
528. 
529.         ma = ConcertAdminWithForm(Concert, self.site)
530.         form = ma.get_form(request)()
531. 
532.         self.assertHTMLEqual(
533.             str(form["main_band"]),
534.             '<div class="related-widget-wrapper">'
535.             '<select name="main_band" id="id_main_band" required>'
536.             '<option value="" selected>---------</option>'
537.             '<option value="%d">The Doors</option>'
538.             "</select></div>" % self.band.id,
539.         )
540. 
541.     def test_regression_for_ticket_15820(self):
542.         """
543.         `obj` is passed from `InlineModelAdmin.get_fieldsets()` to
544.         `InlineModelAdmin.get_formset()`.
545.         """
546. 
547.         class CustomConcertForm(forms.ModelForm):
548.             class Meta:
549.                 model = Concert
550.                 fields = ["day"]
551. 
552.         class ConcertInline(TabularInline):
553.             model = Concert
554.             fk_name = "main_band"
555. 
556.             def get_formset(self, request, obj=None, **kwargs):
557.                 if obj:
558.                     kwargs["form"] = CustomConcertForm
559.                 return super().get_formset(request, obj, **kwargs)
560. 
561.         class BandAdmin(ModelAdmin):
562.             inlines = [ConcertInline]
563. 
564.         Concert.objects.create(main_band=self.band, opening_band=self.band, day=1)
565.         ma = BandAdmin(Band, self.site)
566.         inline_instances = ma.get_inline_instances(request)
567.         fieldsets = list(inline_instances[0].get_fieldsets(request))
568.         self.assertEqual(
569.             fieldsets[0][1]["fields"], ["main_band", "opening_band", "day", "transport"]
570.         )
571.         fieldsets = list(
572.             inline_instances[0].get_fieldsets(request, inline_instances[0].model)
573.         )
574.         self.assertEqual(fieldsets[0][1]["fields"], ["day"])
575. 
576.     # radio_fields behavior ###########################################
577. 
578.     def test_default_foreign_key_widget(self):
579.         # First, without any radio_fields specified, the widgets for ForeignKey
580.         # and fields with choices specified ought to be a basic Select widget.
581.         # ForeignKey widgets in the admin are wrapped with RelatedFieldWidgetWrapper so
582.         # they need to be handled properly when type checking. For Select fields, all of
583.         # the choices lists have a first entry of dashes.
584.         cma = ModelAdmin(Concert, self.site)
585.         cmafa = cma.get_form(request)
586. 
587.         self.assertEqual(type(cmafa.base_fields["main_band"].widget.widget), Select)
588.         self.assertEqual(
589.             list(cmafa.base_fields["main_band"].widget.choices),
590.             [("", "---------"), (self.band.id, "The Doors")],
591.         )
592. 
593.         self.assertEqual(type(cmafa.base_fields["opening_band"].widget.widget), Select)
594.         self.assertEqual(
595.             list(cmafa.base_fields["opening_band"].widget.choices),
596.             [("", "---------"), (self.band.id, "The Doors")],
597.         )
598.         self.assertEqual(type(cmafa.base_fields["day"].widget), Select)
599.         self.assertEqual(
600.             list(cmafa.base_fields["day"].widget.choices),
601.             [("", "---------"), (1, "Fri"), (2, "Sat")],
602.         )
603.         self.assertEqual(type(cmafa.base_fields["transport"].widget), Select)
604.         self.assertEqual(
605.             list(cmafa.base_fields["transport"].widget.choices),
606.             [("", "---------"), (1, "Plane"), (2, "Train"), (3, "Bus")],
607.         )
608. 
609.     def test_foreign_key_as_radio_field(self):
610.         # Now specify all the fields as radio_fields.  Widgets should now be
611.         # RadioSelect, and the choices list should have a first entry of 'None' if
612.         # blank=True for the model field.  Finally, the widget should have the
613.         # 'radiolist' attr, and 'inline' as well if the field is specified HORIZONTAL.
614.         class ConcertAdmin(ModelAdmin):
615.             radio_fields = {
616.                 "main_band": HORIZONTAL,
617.                 "opening_band": VERTICAL,
618.                 "day": VERTICAL,
619.                 "transport": HORIZONTAL,
620.             }
621. 
622.         cma = ConcertAdmin(Concert, self.site)
623.         cmafa = cma.get_form(request)
624. 
625.         self.assertEqual(
626.             type(cmafa.base_fields["main_band"].widget.widget), AdminRadioSelect
627.         )
628.         self.assertEqual(
629.             cmafa.base_fields["main_band"].widget.attrs, {"class": "radiolist inline"}
630.         )
631.         self.assertEqual(
632.             list(cmafa.base_fields["main_band"].widget.choices),
633.             [(self.band.id, "The Doors")],
634.         )
635. 
636.         self.assertEqual(
637.             type(cmafa.base_fields["opening_band"].widget.widget), AdminRadioSelect
638.         )
639.         self.assertEqual(
640.             cmafa.base_fields["opening_band"].widget.attrs, {"class": "radiolist"}
641.         )
642.         self.assertEqual(
643.             list(cmafa.base_fields["opening_band"].widget.choices),
644.             [("", "None"), (self.band.id, "The Doors")],
645.         )
646.         self.assertEqual(type(cmafa.base_fields["day"].widget), AdminRadioSelect)
647.         self.assertEqual(cmafa.base_fields["day"].widget.attrs, {"class": "radiolist"})
648.         self.assertEqual(
649.             list(cmafa.base_fields["day"].widget.choices), [(1, "Fri"), (2, "Sat")]
650.         )
651. 
652.         self.assertEqual(type(cmafa.base_fields["transport"].widget), AdminRadioSelect)
653.         self.assertEqual(
654.             cmafa.base_fields["transport"].widget.attrs, {"class": "radiolist inline"}
655.         )
656.         self.assertEqual(
657.             list(cmafa.base_fields["transport"].widget.choices),
658.             [("", "None"), (1, "Plane"), (2, "Train"), (3, "Bus")],
659.         )
660. 
661.         class AdminConcertForm(forms.ModelForm):
662.             class Meta:
663.                 model = Concert
664.                 exclude = ("transport",)
665. 
666.         class ConcertAdmin(ModelAdmin):
667.             form = AdminConcertForm
668. 
669.         ma = ConcertAdmin(Concert, self.site)
670.         self.assertEqual(
671.             list(ma.get_form(request).base_fields), ["main_band", "opening_band", "day"]
672.         )
673. 
674.         class AdminConcertForm(forms.ModelForm):
675.             extra = forms.CharField()
676. 
677.             class Meta:
678.                 model = Concert
679.                 fields = ["extra", "transport"]
680. 
681.         class ConcertAdmin(ModelAdmin):
682.             form = AdminConcertForm
683. 
684.         ma = ConcertAdmin(Concert, self.site)
685.         self.assertEqual(list(ma.get_form(request).base_fields), ["extra", "transport"])
686. 
687.         class ConcertInline(TabularInline):
688.             form = AdminConcertForm
689.             model = Concert
690.             fk_name = "main_band"
691.             can_delete = True
692. 
693.         class BandAdmin(ModelAdmin):
694.             inlines = [ConcertInline]
695. 
696.         ma = BandAdmin(Band, self.site)
697.         self.assertEqual(
698.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),
699.             ["extra", "transport", "id", "DELETE", "main_band"],
700.         )
701. 
702.     def test_log_actions(self):
703.         ma = ModelAdmin(Band, self.site)
704.         mock_request = MockRequest()
705.         mock_request.user = User.objects.create(username="bill")
706.         content_type = get_content_type_for_model(self.band)
707.         tests = (
708.             (ma.log_addition, ADDITION, {"added": {}}),
709.             (ma.log_change, CHANGE, {"changed": {"fields": ["name", "bio"]}}),
710.             (ma.log_deletion, DELETION, str(self.band)),
711.         )
712.         for method, flag, message in tests:
713.             with self.subTest(name=method.__name__):
714.                 created = method(mock_request, self.band, message)
715.                 fetched = LogEntry.objects.filter(action_flag=flag).latest("id")
716.                 self.assertEqual(created, fetched)
717.                 self.assertEqual(fetched.action_flag, flag)
718.                 self.assertEqual(fetched.content_type, content_type)
719.                 self.assertEqual(fetched.object_id, str(self.band.pk))
720.                 self.assertEqual(fetched.user, mock_request.user)
721.                 if flag == DELETION:
722.                     self.assertEqual(fetched.change_message, "")
723.                     self.assertEqual(fetched.object_repr, message)
724.                 else:
725.                     self.assertEqual(fetched.change_message, str(message))
726.                     self.assertEqual(fetched.object_repr, str(self.band))
727. 
728.     def test_get_autocomplete_fields(self):
729.         class NameAdmin(ModelAdmin):
730.             search_fields = ["name"]
731. 
732.         class SongAdmin(ModelAdmin):
733.             autocomplete_fields = ["featuring"]
734.             fields = ["featuring", "band"]
735. 
736.         class OtherSongAdmin(SongAdmin):
737.             def get_autocomplete_fields(self, request):
738.                 return ["band"]
739. 
740.         self.site.register(Band, NameAdmin)
741.         try:
742.             # Uses autocomplete_fields if not overridden.
743.             model_admin = SongAdmin(Song, self.site)
744.             form = model_admin.get_form(request)()
745.             self.assertIsInstance(
746.                 form.fields["featuring"].widget.widget, AutocompleteSelectMultiple
747.             )
748.             # Uses overridden get_autocomplete_fields
749.             model_admin = OtherSongAdmin(Song, self.site)
750.             form = model_admin.get_form(request)()
751.             self.assertIsInstance(form.fields["band"].widget.widget, AutocompleteSelect)
752.         finally:
753.             self.site.unregister(Band)
754. 
755.     def test_get_deleted_objects(self):
756.         mock_request = MockRequest()
757.         mock_request.user = User.objects.create_superuser(
758.             username="bob", email="bob@test.com", password="test"
759.         )
760.         self.site.register(Band, ModelAdmin)
761.         ma = self.site._registry[Band]
762.         (
763.             deletable_objects,
764.             model_count,
765.             perms_needed,
766.             protected,
767.         ) = ma.get_deleted_objects([self.band], request)
768.         self.assertEqual(deletable_objects, ["Band: The Doors"])
769.         self.assertEqual(model_count, {"bands": 1})
770.         self.assertEqual(perms_needed, set())
771.         self.assertEqual(protected, [])
772. 
773.     def test_get_deleted_objects_with_custom_has_delete_permission(self):
774.         """
775.         ModelAdmin.get_deleted_objects() uses ModelAdmin.has_delete_permission()
776.         for permissions checking.
777.         """
778.         mock_request = MockRequest()
779.         mock_request.user = User.objects.create_superuser(
780.             username="bob", email="bob@test.com", password="test"
781.         )
782. 
783.         class TestModelAdmin(ModelAdmin):
784.             def has_delete_permission(self, request, obj=None):
785.                 return False
786. 
787.         self.site.register(Band, TestModelAdmin)
788.         ma = self.site._registry[Band]
789.         (
790.             deletable_objects,
791.             model_count,
792.             perms_needed,
793.             protected,
794.         ) = ma.get_deleted_objects([self.band], request)
795.         self.assertEqual(deletable_objects, ["Band: The Doors"])
796.         self.assertEqual(model_count, {"bands": 1})
797.         self.assertEqual(perms_needed, {"band"})
798.         self.assertEqual(protected, [])
799. 
800.     def test_modeladmin_repr(self):
801.         ma = ModelAdmin(Band, self.site)
802.         self.assertEqual(
803.             repr(ma),
804.             "<ModelAdmin: model=Band site=AdminSite(name='admin')>",
805.         )


File: tests/admin_widgets/tests.py
Line number range: 65 - 143
Content:
65. class AdminFormfieldForDBFieldTests(SimpleTestCase):
66.     """
67.     Tests for correct behavior of ModelAdmin.formfield_for_dbfield
68.     """
69. 
70.     def assertFormfield(self, model, fieldname, widgetclass, **admin_overrides):
71.         """
72.         Helper to call formfield_for_dbfield for a given model and field name
73.         and verify that the returned formfield is appropriate.
74.         """
75.         # Override any settings on the model admin
76.         class MyModelAdmin(admin.ModelAdmin):
77.             pass
78. 
79.         for k in admin_overrides:
80.             setattr(MyModelAdmin, k, admin_overrides[k])
81. 
82.         # Construct the admin, and ask it for a formfield
83.         ma = MyModelAdmin(model, admin.site)
84.         ff = ma.formfield_for_dbfield(model._meta.get_field(fieldname), request=None)
85. 
86.         # "unwrap" the widget wrapper, if needed
87.         if isinstance(ff.widget, widgets.RelatedFieldWidgetWrapper):
88.             widget = ff.widget.widget
89.         else:
90.             widget = ff.widget
91. 
92.         self.assertIsInstance(widget, widgetclass)
93. 
94.         # Return the formfield so that other tests can continue
95.         return ff
96. 
97.     def test_DateField(self):
98.         self.assertFormfield(Event, "start_date", widgets.AdminDateWidget)
99. 
100.     def test_DateTimeField(self):
101.         self.assertFormfield(Member, "birthdate", widgets.AdminSplitDateTime)
102. 
103.     def test_TimeField(self):
104.         self.assertFormfield(Event, "start_time", widgets.AdminTimeWidget)
105. 
106.     def test_TextField(self):
107.         self.assertFormfield(Event, "description", widgets.AdminTextareaWidget)
108. 
109.     def test_URLField(self):
110.         self.assertFormfield(Event, "link", widgets.AdminURLFieldWidget)
111. 
112.     def test_IntegerField(self):
113.         self.assertFormfield(Event, "min_age", widgets.AdminIntegerFieldWidget)
114. 
115.     def test_CharField(self):
116.         self.assertFormfield(Member, "name", widgets.AdminTextInputWidget)
117. 
118.     def test_EmailField(self):
119.         self.assertFormfield(Member, "email", widgets.AdminEmailInputWidget)
120. 
121.     def test_FileField(self):
122.         self.assertFormfield(Album, "cover_art", widgets.AdminFileWidget)
123. 
124.     def test_ForeignKey(self):
125.         self.assertFormfield(Event, "main_band", forms.Select)
126. 
127.     def test_raw_id_ForeignKey(self):
128.         self.assertFormfield(
129.             Event,
130.             "main_band",
131.             widgets.ForeignKeyRawIdWidget,
132.             raw_id_fields=["main_band"],
133.         )
134. 
135.     def test_radio_fields_ForeignKey(self):
136.         ff = self.assertFormfield(
137.             Event,
138.             "main_band",
139.             widgets.AdminRadioSelect,
140.             radio_fields={"main_band": admin.VERTICAL},
141.         )
142.         self.assertIsNone(ff.empty_label)
143. 


File: tests/admin_ordering/tests.py
Line number range: 134 - 208
Content:
134. class TestRelatedFieldsAdminOrdering(TestCase):
135.     @classmethod
136.     def setUpTestData(cls):
137.         cls.b1 = Band.objects.create(name="Pink Floyd", bio="", rank=1)
138.         cls.b2 = Band.objects.create(name="Foo Fighters", bio="", rank=5)
139. 
140.     def setUp(self):
141.         # we need to register a custom ModelAdmin (instead of just using
142.         # ModelAdmin) because the field creator tries to find the ModelAdmin
143.         # for the related model
144.         class SongAdmin(admin.ModelAdmin):
145.             pass
146. 
147.         site.register(Song, SongAdmin)
148. 
149.     def tearDown(self):
150.         site.unregister(Song)
151.         if Band in site._registry:
152.             site.unregister(Band)
153. 
154.     def check_ordering_of_field_choices(self, correct_ordering):
155.         fk_field = site._registry[Song].formfield_for_foreignkey(
156.             Song.band.field, request=None
157.         )
158.         m2m_field = site._registry[Song].formfield_for_manytomany(
159.             Song.other_interpreters.field, request=None
160.         )
161.         self.assertEqual(list(fk_field.queryset), correct_ordering)
162.         self.assertEqual(list(m2m_field.queryset), correct_ordering)
163. 
164.     def test_no_admin_fallback_to_model_ordering(self):
165.         # should be ordered by name (as defined by the model)
166.         self.check_ordering_of_field_choices([self.b2, self.b1])
167. 
168.     def test_admin_with_no_ordering_fallback_to_model_ordering(self):
169.         class NoOrderingBandAdmin(admin.ModelAdmin):
170.             pass
171. 
172.         site.register(Band, NoOrderingBandAdmin)
173. 
174.         # should be ordered by name (as defined by the model)
175.         self.check_ordering_of_field_choices([self.b2, self.b1])
176. 
177.     def test_admin_ordering_beats_model_ordering(self):
178.         class StaticOrderingBandAdmin(admin.ModelAdmin):
179.             ordering = ("rank",)
180. 
181.         site.register(Band, StaticOrderingBandAdmin)
182. 
183.         # should be ordered by rank (defined by the ModelAdmin)
184.         self.check_ordering_of_field_choices([self.b1, self.b2])
185. 
186.     def test_custom_queryset_still_wins(self):
187.         """Custom queryset has still precedence (#21405)"""
188. 
189.         class SongAdmin(admin.ModelAdmin):
190.             # Exclude one of the two Bands from the querysets
191.             def formfield_for_foreignkey(self, db_field, request, **kwargs):
192.                 if db_field.name == "band":
193.                     kwargs["queryset"] = Band.objects.filter(rank__gt=2)
194.                 return super().formfield_for_foreignkey(db_field, request, **kwargs)
195. 
196.             def formfield_for_manytomany(self, db_field, request, **kwargs):
197.                 if db_field.name == "other_interpreters":
198.                     kwargs["queryset"] = Band.objects.filter(rank__gt=2)
199.                 return super().formfield_for_foreignkey(db_field, request, **kwargs)
200. 
201.         class StaticOrderingBandAdmin(admin.ModelAdmin):
202.             ordering = ("rank",)
203. 
204.         site.unregister(Song)
205.         site.register(Song, SongAdmin)
206.         site.register(Band, StaticOrderingBandAdmin)
207. 
208.         self.check_ordering_of_field_choices([self.b2])

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

2025-10-06 20:01:53,022 - thread-139660780025408.app.lang_graph.nodes.context_refine_node - DEBUG - reasoning="1. The user's issue involves the interaction between `ModelAdmin.radio_fields` and `ModelAdmin.formfield_for_foreignkey`, specifically regarding the `empty_label` argument.\n2. The provided context includes several relevant test methods, but the files are incomplete. For example, `tests/admin_widgets/tests.py` contains the highly relevant `test_radio_fields_ForeignKey`, but the file's imports and model definitions are missing.\n3. Similarly, `tests/admin_ordering/tests.py` has `test_custom_queryset_still_wins`, which shows the pattern of overriding `formfield_for_foreignkey` that the user is attempting, but its dependencies are not in the context.\n4. To provide the requested 5 complete and self-contained test cases, which must include all imports and setup, I need the full source code for the test files and their associated models." refined_query='Please provide the full source code for the following files: `tests/admin_widgets/tests.py`, `tests/admin_widgets/models.py`, `tests/admin_ordering/tests.py`, and `tests/admin_ordering/models.py`. This will allow the construction of complete test cases related to `ModelAdmin` formfield generation and customization.'
2025-10-06 20:01:57,431 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/admin_ordering/models.py"}'}, '__gemini_function_call_thought_signatures__': {'0d7f616b-10d5-45f7-8691-fa0ce2aae9ea': 'CuECAR/MhbafQn5ozEWFRV6tgsoiq9XIpsLGaz86EWAdWIYz9EJdr12vVfEq8ZvJQbQ/3BNUQRD/pTt2Gtu9HSSfgzV7+IeW3caOWF5jj3ipOjX5EOlioTiW1HMRjuAAT1RJeWYo4yidGLK37HQxkXpcvexcjvj5q8+ReoxYn7XDpdJJNxAjGZAAQFflVPU4sdX6fU3VLkafJIuhX8y3UxyuXz9ux6nFPx8ndlu6D74EktkGKOiTrpbbsW+tTt3qCB1ev+DjMZnAilQCRcvI0GnCm3eaOyWzKyYqk52HW+WFlmzvYG/9qUqfDLcqxYyRpivvLXtwwrL7O8zxxmptB1goDQ0wSLlSYkswtwMeXABYxvK4pqY/vv12YFPsHehiqgm+AWVlBsEgNpIXW9rdQgiUCbpJ8c0xrIrrLcgmRUQfo/glQEJuD6RzFs+woBEh+WSvg0Bw6CAeUyqu0oZYssh70bw='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 56403, 'candidates_token_count': 92, 'total_token_count': 56598, 'prompt_tokens_details': [{'modality': 1, 'token_count': 56403}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 92}], 'thoughts_token_count': 103, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.029927326285320778, 'model_name': 'gemini-2.5-pro'} id='run--a6525555-90fd-4b1b-a918-60af58932cdb-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/admin_widgets/tests.py'}, 'id': '0d7f616b-10d5-45f7-8691-fa0ce2aae9ea', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/admin_widgets/models.py'}, 'id': 'f1679a9b-651e-4b88-8e4b-24c991a5334c', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/admin_ordering/tests.py'}, 'id': '8072771b-8782-4a14-9e07-78cde9c42f11', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/admin_ordering/models.py'}, 'id': '7a037a08-38e3-4a68-99e6-24e72bcac407', 'type': 'tool_call'}] usage_metadata={'input_tokens': 56403, 'output_tokens': 92, 'total_tokens': 56598, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 103}}
2025-10-06 20:02:00,667 - thread-139660780025408.app.lang_graph.nodes.context_provider_node - DEBUG - content='I have successfully retrieved the full source code for `tests/admin_widgets/tests.py`, `tests/admin_widgets/models.py`, `tests/admin_ordering/tests.py`, and `tests/admin_ordering/models.py`. You can now use this code to construct your test cases.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 69999, 'candidates_token_count': 66, 'total_token_count': 70089, 'prompt_tokens_details': [{'modality': 1, 'token_count': 70100}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 66}], 'thoughts_token_count': 24, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.11020247141520183, 'model_name': 'gemini-2.5-pro'} id='run--dbd6453c-747e-4c5d-aa56-7940413450aa-0' usage_metadata={'input_tokens': 69999, 'output_tokens': 66, 'total_tokens': 70089, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 24}}
2025-10-06 20:02:00,668 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - INFO - Starting context extraction process
2025-10-06 20:02:00,668 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - DEBUG - This is the original user query:

--- BEGIN ORIGINAL QUERY ---
Issue title:
ModelAdmin with defined radio_fields override empty_label

Issue description: 
Description
	
ModelAdmin drops my "empty_label" and set "default_empty_label". For example:
class MyModelAdmin(ModelAdmin):
	radio_fields = 'myfield',
	def formfield_for_foreignkey(self, db_field, *args, **kwargs):
		if db_field.name == 'myfield':
			kwargs['empty_label'] = "I WANT TO SET MY OWN EMPTY LABEL"
		return super().formfield_for_foreignkey(db_field, *args, **kwargs)
You get never the "I WANT TO SET MY OWN EMPTY LABEL"
How to fix it:
In django\contrib\admin\options.py, row 234:
kwargs['empty_label'] = _('None') if db_field.blank else None
Should be changed on:
kwargs['empty_label'] = (kwargs.get('empty_label') or _('None')) if db_field.blank else None

Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

This is the refinement query. Please consider it together with the original query. It's really IMPORTANT!!!

--- BEGIN REFINEMENT QUERY ---
Please provide the full source code for the following files: `tests/admin_widgets/tests.py`, `tests/admin_widgets/models.py`, `tests/admin_ordering/tests.py`, and `tests/admin_ordering/models.py`. This will allow the construction of complete test cases related to `ModelAdmin` formfield generation and customization.
--- END REFINEMENT QUERY ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/admin_widgets/tests.py
Line number range: 1 - 500
Content:
1. import gettext
2. import os
3. import re
4. from datetime import datetime, timedelta
5. from importlib import import_module
6. 
7. try:
8.     import zoneinfo
9. except ImportError:
10.     from backports import zoneinfo
11. 
12. from django import forms
13. from django.conf import settings
14. from django.contrib import admin
15. from django.contrib.admin import widgets
16. from django.contrib.admin.tests import AdminSeleniumTestCase
17. from django.contrib.auth.models import User
18. from django.core.files.storage import default_storage
19. from django.core.files.uploadedfile import SimpleUploadedFile
20. from django.db.models import (
21.     CharField,
22.     DateField,
23.     DateTimeField,
24.     ManyToManyField,
25.     UUIDField,
26. )
27. from django.test import SimpleTestCase, TestCase, override_settings
28. from django.urls import reverse
29. from django.utils import translation
30. 
31. from .models import (
32.     Advisor,
33.     Album,
34.     Band,
35.     Bee,
36.     Car,
37.     Company,
38.     Event,
39.     Honeycomb,
40.     Individual,
41.     Inventory,
42.     Member,
43.     MyFileField,
44.     Profile,
45.     ReleaseEvent,
46.     School,
47.     Student,
48.     UnsafeLimitChoicesTo,
49.     VideoStream,
50. )
51. from .widgetadmin import site as widget_admin_site
52. 
53. 
54. class TestDataMixin:
55.     @classmethod
56.     def setUpTestData(cls):
57.         cls.superuser = User.objects.create_superuser(
58.             username="super", password="secret", email=None
59.         )
60.         cls.u2 = User.objects.create_user(username="testser", password="secret")
61.         Car.objects.create(owner=cls.superuser, make="Volkswagen", model="Passat")
62.         Car.objects.create(owner=cls.u2, make="BMW", model="M3")
63. 
64. 
65. class AdminFormfieldForDBFieldTests(SimpleTestCase):
66.     """
67.     Tests for correct behavior of ModelAdmin.formfield_for_dbfield
68.     """
69. 
70.     def assertFormfield(self, model, fieldname, widgetclass, **admin_overrides):
71.         """
72.         Helper to call formfield_for_dbfield for a given model and field name
73.         and verify that the returned formfield is appropriate.
74.         """
75.         # Override any settings on the model admin
76.         class MyModelAdmin(admin.ModelAdmin):
77.             pass
78. 
79.         for k in admin_overrides:
80.             setattr(MyModelAdmin, k, admin_overrides[k])
81. 
82.         # Construct the admin, and ask it for a formfield
83.         ma = MyModelAdmin(model, admin.site)
84.         ff = ma.formfield_for_dbfield(model._meta.get_field(fieldname), request=None)
85. 
86.         # "unwrap" the widget wrapper, if needed
87.         if isinstance(ff.widget, widgets.RelatedFieldWidgetWrapper):
88.             widget = ff.widget.widget
89.         else:
90.             widget = ff.widget
91. 
92.         self.assertIsInstance(widget, widgetclass)
93. 
94.         # Return the formfield so that other tests can continue
95.         return ff
96. 
97.     def test_DateField(self):
98.         self.assertFormfield(Event, "start_date", widgets.AdminDateWidget)
99. 
100.     def test_DateTimeField(self):
101.         self.assertFormfield(Member, "birthdate", widgets.AdminSplitDateTime)
102. 
103.     def test_TimeField(self):
104.         self.assertFormfield(Event, "start_time", widgets.AdminTimeWidget)
105. 
106.     def test_TextField(self):
107.         self.assertFormfield(Event, "description", widgets.AdminTextareaWidget)
108. 
109.     def test_URLField(self):
110.         self.assertFormfield(Event, "link", widgets.AdminURLFieldWidget)
111. 
112.     def test_IntegerField(self):
113.         self.assertFormfield(Event, "min_age", widgets.AdminIntegerFieldWidget)
114. 
115.     def test_CharField(self):
116.         self.assertFormfield(Member, "name", widgets.AdminTextInputWidget)
117. 
118.     def test_EmailField(self):
119.         self.assertFormfield(Member, "email", widgets.AdminEmailInputWidget)
120. 
121.     def test_FileField(self):
122.         self.assertFormfield(Album, "cover_art", widgets.AdminFileWidget)
123. 
124.     def test_ForeignKey(self):
125.         self.assertFormfield(Event, "main_band", forms.Select)
126. 
127.     def test_raw_id_ForeignKey(self):
128.         self.assertFormfield(
129.             Event,
130.             "main_band",
131.             widgets.ForeignKeyRawIdWidget,
132.             raw_id_fields=["main_band"],
133.         )
134. 
135.     def test_radio_fields_ForeignKey(self):
136.         ff = self.assertFormfield(
137.             Event,
138.             "main_band",
139.             widgets.AdminRadioSelect,
140.             radio_fields={"main_band": admin.VERTICAL},
141.         )
142.         self.assertIsNone(ff.empty_label)
143. 
144.     def test_many_to_many(self):
145.         self.assertFormfield(Band, "members", forms.SelectMultiple)
146. 
147.     def test_raw_id_many_to_many(self):
148.         self.assertFormfield(
149.             Band, "members", widgets.ManyToManyRawIdWidget, raw_id_fields=["members"]
150.         )
151. 
152.     def test_filtered_many_to_many(self):
153.         self.assertFormfield(
154.             Band, "members", widgets.FilteredSelectMultiple, filter_vertical=["members"]
155.         )
156. 
157.     def test_formfield_overrides(self):
158.         self.assertFormfield(
159.             Event,
160.             "start_date",
161.             forms.TextInput,
162.             formfield_overrides={DateField: {"widget": forms.TextInput}},
163.         )
164. 
165.     def test_formfield_overrides_widget_instances(self):
166.         """
167.         Widget instances in formfield_overrides are not shared between
168.         different fields. (#19423)
169.         """
170. 
171.         class BandAdmin(admin.ModelAdmin):
172.             formfield_overrides = {
173.                 CharField: {"widget": forms.TextInput(attrs={"size": "10"})}
174.             }
175. 
176.         ma = BandAdmin(Band, admin.site)
177.         f1 = ma.formfield_for_dbfield(Band._meta.get_field("name"), request=None)
178.         f2 = ma.formfield_for_dbfield(Band._meta.get_field("style"), request=None)
179.         self.assertNotEqual(f1.widget, f2.widget)
180.         self.assertEqual(f1.widget.attrs["maxlength"], "100")
181.         self.assertEqual(f2.widget.attrs["maxlength"], "20")
182.         self.assertEqual(f2.widget.attrs["size"], "10")
183. 
184.     def test_formfield_overrides_m2m_filter_widget(self):
185.         """
186.         The autocomplete_fields, raw_id_fields, filter_vertical, and
187.         filter_horizontal widgets for ManyToManyFields may be overridden by
188.         specifying a widget in formfield_overrides.
189.         """
190. 
191.         class BandAdmin(admin.ModelAdmin):
192.             filter_vertical = ["members"]
193.             formfield_overrides = {
194.                 ManyToManyField: {"widget": forms.CheckboxSelectMultiple},
195.             }
196. 
197.         ma = BandAdmin(Band, admin.site)
198.         field = ma.formfield_for_dbfield(Band._meta.get_field("members"), request=None)
199.         self.assertIsInstance(field.widget.widget, forms.CheckboxSelectMultiple)
200. 
201.     def test_formfield_overrides_for_datetime_field(self):
202.         """
203.         Overriding the widget for DateTimeField doesn't overrides the default
204.         form_class for that field (#26449).
205.         """
206. 
207.         class MemberAdmin(admin.ModelAdmin):
208.             formfield_overrides = {
209.                 DateTimeField: {"widget": widgets.AdminSplitDateTime}
210.             }
211. 
212.         ma = MemberAdmin(Member, admin.site)
213.         f1 = ma.formfield_for_dbfield(Member._meta.get_field("birthdate"), request=None)
214.         self.assertIsInstance(f1.widget, widgets.AdminSplitDateTime)
215.         self.assertIsInstance(f1, forms.SplitDateTimeField)
216. 
217.     def test_formfield_overrides_for_custom_field(self):
218.         """
219.         formfield_overrides works for a custom field class.
220.         """
221. 
222.         class AlbumAdmin(admin.ModelAdmin):
223.             formfield_overrides = {MyFileField: {"widget": forms.TextInput()}}
224. 
225.         ma = AlbumAdmin(Member, admin.site)
226.         f1 = ma.formfield_for_dbfield(
227.             Album._meta.get_field("backside_art"), request=None
228.         )
229.         self.assertIsInstance(f1.widget, forms.TextInput)
230. 
231.     def test_field_with_choices(self):
232.         self.assertFormfield(Member, "gender", forms.Select)
233. 
234.     def test_choices_with_radio_fields(self):
235.         self.assertFormfield(
236.             Member,
237.             "gender",
238.             widgets.AdminRadioSelect,
239.             radio_fields={"gender": admin.VERTICAL},
240.         )
241. 
242.     def test_inheritance(self):
243.         self.assertFormfield(Album, "backside_art", widgets.AdminFileWidget)
244. 
245.     def test_m2m_widgets(self):
246.         """m2m fields help text as it applies to admin app (#9321)."""
247. 
248.         class AdvisorAdmin(admin.ModelAdmin):
249.             filter_vertical = ["companies"]
250. 
251.         self.assertFormfield(
252.             Advisor,
253.             "companies",
254.             widgets.FilteredSelectMultiple,
255.             filter_vertical=["companies"],
256.         )
257.         ma = AdvisorAdmin(Advisor, admin.site)
258.         f = ma.formfield_for_dbfield(Advisor._meta.get_field("companies"), request=None)
259.         self.assertEqual(
260.             f.help_text,
261.             "Hold down “Control”, or “Command” on a Mac, to select more than one.",
262.         )
263. 
264. 
265. @override_settings(ROOT_URLCONF="admin_widgets.urls")
266. class AdminFormfieldForDBFieldWithRequestTests(TestDataMixin, TestCase):
267.     def test_filter_choices_by_request_user(self):
268.         """
269.         Ensure the user can only see their own cars in the foreign key dropdown.
270.         """
271.         self.client.force_login(self.superuser)
272.         response = self.client.get(reverse("admin:admin_widgets_cartire_add"))
273.         self.assertNotContains(response, "BMW M3")
274.         self.assertContains(response, "Volkswagen Passat")
275. 
276. 
277. @override_settings(ROOT_URLCONF="admin_widgets.urls")
278. class AdminForeignKeyWidgetChangeList(TestDataMixin, TestCase):
279.     def setUp(self):
280.         self.client.force_login(self.superuser)
281. 
282.     def test_changelist_ForeignKey(self):
283.         response = self.client.get(reverse("admin:admin_widgets_car_changelist"))
284.         self.assertContains(response, "/auth/user/add/")
285. 
286. 
287. @override_settings(ROOT_URLCONF="admin_widgets.urls")
288. class AdminForeignKeyRawIdWidget(TestDataMixin, TestCase):
289.     def setUp(self):
290.         self.client.force_login(self.superuser)
291. 
292.     def test_nonexistent_target_id(self):
293.         band = Band.objects.create(name="Bogey Blues")
294.         pk = band.pk
295.         band.delete()
296.         post_data = {
297.             "main_band": str(pk),
298.         }
299.         # Try posting with a nonexistent pk in a raw id field: this
300.         # should result in an error message, not a server exception.
301.         response = self.client.post(reverse("admin:admin_widgets_event_add"), post_data)
302.         self.assertContains(
303.             response,
304.             "Select a valid choice. That choice is not one of the available choices.",
305.         )
306. 
307.     def test_invalid_target_id(self):
308. 
309.         for test_str in ("Iñtërnâtiônàlizætiøn", "1234'", -1234):
310.             # This should result in an error message, not a server exception.
311.             response = self.client.post(
312.                 reverse("admin:admin_widgets_event_add"), {"main_band": test_str}
313.             )
314. 
315.             self.assertContains(
316.                 response,
317.                 "Select a valid choice. That choice is not one of the available "
318.                 "choices.",
319.             )
320. 
321.     def test_url_params_from_lookup_dict_any_iterable(self):
322.         lookup1 = widgets.url_params_from_lookup_dict({"color__in": ("red", "blue")})
323.         lookup2 = widgets.url_params_from_lookup_dict({"color__in": ["red", "blue"]})
324.         self.assertEqual(lookup1, {"color__in": "red,blue"})
325.         self.assertEqual(lookup1, lookup2)
326. 
327.     def test_url_params_from_lookup_dict_callable(self):
328.         def my_callable():
329.             return "works"
330. 
331.         lookup1 = widgets.url_params_from_lookup_dict({"myfield": my_callable})
332.         lookup2 = widgets.url_params_from_lookup_dict({"myfield": my_callable()})
333.         self.assertEqual(lookup1, lookup2)
334. 
335.     def test_label_and_url_for_value_invalid_uuid(self):
336.         field = Bee._meta.get_field("honeycomb")
337.         self.assertIsInstance(field.target_field, UUIDField)
338.         widget = widgets.ForeignKeyRawIdWidget(field.remote_field, admin.site)
339.         self.assertEqual(widget.label_and_url_for_value("invalid-uuid"), ("", ""))
340. 
341. 
342. class FilteredSelectMultipleWidgetTest(SimpleTestCase):
343.     def test_render(self):
344.         # Backslash in verbose_name to ensure it is JavaScript escaped.
345.         w = widgets.FilteredSelectMultiple("test\\", False)
346.         self.assertHTMLEqual(
347.             w.render("test", "test"),
348.             '<select multiple name="test" class="selectfilter" '
349.             'data-field-name="test\\" data-is-stacked="0">\n</select>',
350.         )
351. 
352.     def test_stacked_render(self):
353.         # Backslash in verbose_name to ensure it is JavaScript escaped.
354.         w = widgets.FilteredSelectMultiple("test\\", True)
355.         self.assertHTMLEqual(
356.             w.render("test", "test"),
357.             '<select multiple name="test" class="selectfilterstacked" '
358.             'data-field-name="test\\" data-is-stacked="1">\n</select>',
359.         )
360. 
361. 
362. class AdminDateWidgetTest(SimpleTestCase):
363.     def test_attrs(self):
364.         w = widgets.AdminDateWidget()
365.         self.assertHTMLEqual(
366.             w.render("test", datetime(2007, 12, 1, 9, 30)),
367.             '<input value="2007-12-01" type="text" class="vDateField" name="test" '
368.             'size="10">',
369.         )
370.         # pass attrs to widget
371.         w = widgets.AdminDateWidget(attrs={"size": 20, "class": "myDateField"})
372.         self.assertHTMLEqual(
373.             w.render("test", datetime(2007, 12, 1, 9, 30)),
374.             '<input value="2007-12-01" type="text" class="myDateField" name="test" '
375.             'size="20">',
376.         )
377. 
378. 
379. class AdminTimeWidgetTest(SimpleTestCase):
380.     def test_attrs(self):
381.         w = widgets.AdminTimeWidget()
382.         self.assertHTMLEqual(
383.             w.render("test", datetime(2007, 12, 1, 9, 30)),
384.             '<input value="09:30:00" type="text" class="vTimeField" name="test" '
385.             'size="8">',
386.         )
387.         # pass attrs to widget
388.         w = widgets.AdminTimeWidget(attrs={"size": 20, "class": "myTimeField"})
389.         self.assertHTMLEqual(
390.             w.render("test", datetime(2007, 12, 1, 9, 30)),
391.             '<input value="09:30:00" type="text" class="myTimeField" name="test" '
392.             'size="20">',
393.         )
394. 
395. 
396. class AdminSplitDateTimeWidgetTest(SimpleTestCase):
397.     def test_render(self):
398.         w = widgets.AdminSplitDateTime()
399.         self.assertHTMLEqual(
400.             w.render("test", datetime(2007, 12, 1, 9, 30)),
401.             '<p class="datetime">'
402.             'Date: <input value="2007-12-01" type="text" class="vDateField" '
403.             'name="test_0" size="10"><br>'
404.             'Time: <input value="09:30:00" type="text" class="vTimeField" '
405.             'name="test_1" size="8"></p>',
406.         )
407. 
408.     def test_localization(self):
409.         w = widgets.AdminSplitDateTime()
410. 
411.         with translation.override("de-at"):
412.             w.is_localized = True
413.             self.assertHTMLEqual(
414.                 w.render("test", datetime(2007, 12, 1, 9, 30)),
415.                 '<p class="datetime">'
416.                 'Datum: <input value="01.12.2007" type="text" '
417.                 'class="vDateField" name="test_0"size="10"><br>'
418.                 'Zeit: <input value="09:30:00" type="text" class="vTimeField" '
419.                 'name="test_1" size="8"></p>',
420.             )
421. 
422. 
423. class AdminURLWidgetTest(SimpleTestCase):
424.     def test_get_context_validates_url(self):
425.         w = widgets.AdminURLFieldWidget()
426.         for invalid in ["", "/not/a/full/url/", 'javascript:alert("Danger XSS!")']:
427.             with self.subTest(url=invalid):
428.                 self.assertFalse(w.get_context("name", invalid, {})["url_valid"])
429.         self.assertTrue(w.get_context("name", "http://example.com", {})["url_valid"])
430. 
431.     def test_render(self):
432.         w = widgets.AdminURLFieldWidget()
433.         self.assertHTMLEqual(
434.             w.render("test", ""), '<input class="vURLField" name="test" type="url">'
435.         )
436.         self.assertHTMLEqual(
437.             w.render("test", "http://example.com"),
438.             '<p class="url">Currently:<a href="http://example.com">'
439.             "http://example.com</a><br>"
440.             'Change:<input class="vURLField" name="test" type="url" '
441.             'value="http://example.com"></p>',
442.         )
443. 
444.     def test_render_idn(self):
445.         w = widgets.AdminURLFieldWidget()
446.         self.assertHTMLEqual(
447.             w.render("test", "http://example-äüö.com"),
448.             '<p class="url">Currently: <a href="http://xn--example--7za4pnc.com">'
449.             "http://example-äüö.com</a><br>"
450.             'Change:<input class="vURLField" name="test" type="url" '
451.             'value="http://example-äüö.com"></p>',
452.         )
453. 
454.     def test_render_quoting(self):
455.         """
456.         WARNING: This test doesn't use assertHTMLEqual since it will get rid
457.         of some escapes which are tested here!
458.         """
459.         HREF_RE = re.compile('href="([^"]+)"')
460.         VALUE_RE = re.compile('value="([^"]+)"')
461.         TEXT_RE = re.compile("<a[^>]+>([^>]+)</a>")
462.         w = widgets.AdminURLFieldWidget()
463.         output = w.render("test", "http://example.com/<sometag>some-text</sometag>")
464.         self.assertEqual(
465.             HREF_RE.search(output)[1],
466.             "http://example.com/%3Csometag%3Esome-text%3C/sometag%3E",
467.         )
468.         self.assertEqual(
469.             TEXT_RE.search(output)[1],
470.             "http://example.com/&lt;sometag&gt;some-text&lt;/sometag&gt;",
471.         )
472.         self.assertEqual(
473.             VALUE_RE.search(output)[1],
474.             "http://example.com/&lt;sometag&gt;some-text&lt;/sometag&gt;",
475.         )
476.         output = w.render("test", "http://example-äüö.com/<sometag>some-text</sometag>")
477.         self.assertEqual(
478.             HREF_RE.search(output)[1],
479.             "http://xn--example--7za4pnc.com/%3Csometag%3Esome-text%3C/sometag%3E",
480.         )
481.         self.assertEqual(
482.             TEXT_RE.search(output)[1],
483.             "http://example-äüö.com/&lt;sometag&gt;some-text&lt;/sometag&gt;",
484.         )
485.         self.assertEqual(
486.             VALUE_RE.search(output)[1],
487.             "http://example-äüö.com/&lt;sometag&gt;some-text&lt;/sometag&gt;",
488.         )
489.         output = w.render(
490.             "test", 'http://www.example.com/%C3%A4"><script>alert("XSS!")</script>"'
491.         )
492.         self.assertEqual(
493.             HREF_RE.search(output)[1],
494.             "http://www.example.com/%C3%A4%22%3E%3Cscript%3Ealert(%22XSS!%22)"
495.             "%3C/script%3E%22",
496.         )
497.         self.assertEqual(
498.             TEXT_RE.search(output)[1],
499.             "http://www.example.com/%C3%A4&quot;&gt;&lt;script&gt;"
500.             "alert(&quot;XSS!&quot;)&lt;/script&gt;&quot;",

File: tests/admin_widgets/models.py
Line number range: 1 - 201
Content:
1. import uuid
2. 
3. from django.contrib.auth.models import User
4. from django.db import models
5. 
6. 
7. class MyFileField(models.FileField):
8.     pass
9. 
10. 
11. class Member(models.Model):
12.     name = models.CharField(max_length=100)
13.     birthdate = models.DateTimeField(blank=True, null=True)
14.     gender = models.CharField(
15.         max_length=1, blank=True, choices=[("M", "Male"), ("F", "Female")]
16.     )
17.     email = models.EmailField(blank=True)
18. 
19.     def __str__(self):
20.         return self.name
21. 
22. 
23. class Artist(models.Model):
24.     pass
25. 
26. 
27. class Band(Artist):
28.     uuid = models.UUIDField(unique=True, default=uuid.uuid4)
29.     name = models.CharField(max_length=100)
30.     style = models.CharField(max_length=20)
31.     members = models.ManyToManyField(Member)
32. 
33.     def __str__(self):
34.         return self.name
35. 
36. 
37. class UnsafeLimitChoicesTo(models.Model):
38.     band = models.ForeignKey(
39.         Band,
40.         models.CASCADE,
41.         limit_choices_to={"name": '"&><escapeme'},
42.     )
43. 
44. 
45. class Album(models.Model):
46.     band = models.ForeignKey(Band, models.CASCADE, to_field="uuid")
47.     featuring = models.ManyToManyField(Band, related_name="featured")
48.     name = models.CharField(max_length=100)
49.     cover_art = models.FileField(upload_to="albums")
50.     backside_art = MyFileField(upload_to="albums_back", null=True)
51. 
52.     def __str__(self):
53.         return self.name
54. 
55. 
56. class ReleaseEvent(models.Model):
57.     """
58.     Used to check that autocomplete widget correctly resolves attname for FK as
59.     PK example.
60.     """
61. 
62.     album = models.ForeignKey(Album, models.CASCADE, primary_key=True)
63.     name = models.CharField(max_length=100)
64. 
65.     class Meta:
66.         ordering = ["name"]
67. 
68.     def __str__(self):
69.         return self.name
70. 
71. 
72. class VideoStream(models.Model):
73.     release_event = models.ForeignKey(ReleaseEvent, models.CASCADE)
74. 
75. 
76. class HiddenInventoryManager(models.Manager):
77.     def get_queryset(self):
78.         return super().get_queryset().filter(hidden=False)
79. 
80. 
81. class Inventory(models.Model):
82.     barcode = models.PositiveIntegerField(unique=True)
83.     parent = models.ForeignKey(
84.         "self", models.SET_NULL, to_field="barcode", blank=True, null=True
85.     )
86.     name = models.CharField(blank=False, max_length=20)
87.     hidden = models.BooleanField(default=False)
88. 
89.     # see #9258
90.     default_manager = models.Manager()
91.     objects = HiddenInventoryManager()
92. 
93.     def __str__(self):
94.         return self.name
95. 
96. 
97. class Event(models.Model):
98.     main_band = models.ForeignKey(
99.         Band,
100.         models.CASCADE,
101.         limit_choices_to=models.Q(pk__gt=0),
102.         related_name="events_main_band_at",
103.     )
104.     supporting_bands = models.ManyToManyField(
105.         Band,
106.         blank=True,
107.         related_name="events_supporting_band_at",
108.         help_text="Supporting Bands.",
109.     )
110.     start_date = models.DateField(blank=True, null=True)
111.     start_time = models.TimeField(blank=True, null=True)
112.     description = models.TextField(blank=True)
113.     link = models.URLField(blank=True)
114.     min_age = models.IntegerField(blank=True, null=True)
115. 
116. 
117. class Car(models.Model):
118.     owner = models.ForeignKey(User, models.CASCADE)
119.     make = models.CharField(max_length=30)
120.     model = models.CharField(max_length=30)
121. 
122.     def __str__(self):
123.         return "%s %s" % (self.make, self.model)
124. 
125. 
126. class CarTire(models.Model):
127.     """
128.     A single car tire. This to test that a user can only select their own cars.
129.     """
130. 
131.     car = models.ForeignKey(Car, models.CASCADE)
132. 
133. 
134. class Honeycomb(models.Model):
135.     id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
136.     location = models.CharField(max_length=20)
137. 
138. 
139. class Bee(models.Model):
140.     """
141.     A model with a FK to a model that won't be registered with the admin
142.     (Honeycomb) so the corresponding raw ID widget won't have a magnifying
143.     glass link to select related honeycomb instances.
144.     """
145. 
146.     honeycomb = models.ForeignKey(Honeycomb, models.CASCADE)
147. 
148. 
149. class Individual(models.Model):
150.     """
151.     A model with a FK to itself. It won't be registered with the admin, so the
152.     corresponding raw ID widget won't have a magnifying glass link to select
153.     related instances (rendering will be called programmatically in this case).
154.     """
155. 
156.     name = models.CharField(max_length=20)
157.     parent = models.ForeignKey("self", models.SET_NULL, null=True)
158.     soulmate = models.ForeignKey(
159.         "self", models.CASCADE, null=True, related_name="soulmates"
160.     )
161. 
162. 
163. class Company(models.Model):
164.     name = models.CharField(max_length=20)
165. 
166. 
167. class Advisor(models.Model):
168.     """
169.     A model with a m2m to a model that won't be registered with the admin
170.     (Company) so the corresponding raw ID widget won't have a magnifying
171.     glass link to select related company instances.
172.     """
173. 
174.     name = models.CharField(max_length=20)
175.     companies = models.ManyToManyField(Company)
176. 
177. 
178. class Student(models.Model):
179.     name = models.CharField(max_length=255)
180. 
181.     class Meta:
182.         ordering = ("name",)
183. 
184.     def __str__(self):
185.         return self.name
186. 
187. 
188. class School(models.Model):
189.     name = models.CharField(max_length=255)
190.     students = models.ManyToManyField(Student, related_name="current_schools")
191.     alumni = models.ManyToManyField(Student, related_name="previous_schools")
192. 
193.     def __str__(self):
194.         return self.name
195. 
196. 
197. class Profile(models.Model):
198.     user = models.ForeignKey("auth.User", models.CASCADE, to_field="username")
199. 
200.     def __str__(self):
201.         return self.user.username

File: tests/admin_ordering/tests.py
Line number range: 1 - 208
Content:
1. from django.contrib import admin
2. from django.contrib.admin.options import ModelAdmin
3. from django.contrib.auth.models import User
4. from django.db.models import F
5. from django.test import RequestFactory, TestCase
6. 
7. from .models import (
8.     Band,
9.     DynOrderingBandAdmin,
10.     Song,
11.     SongInlineDefaultOrdering,
12.     SongInlineNewOrdering,
13. )
14. 
15. 
16. class MockRequest:
17.     pass
18. 
19. 
20. class MockSuperUser:
21.     def has_perm(self, perm, obj=None):
22.         return True
23. 
24.     def has_module_perms(self, module):
25.         return True
26. 
27. 
28. request = MockRequest()
29. request.user = MockSuperUser()
30. 
31. site = admin.AdminSite()
32. 
33. 
34. class TestAdminOrdering(TestCase):
35.     """
36.     Let's make sure that ModelAdmin.get_queryset uses the ordering we define
37.     in ModelAdmin rather that ordering defined in the model's inner Meta
38.     class.
39.     """
40. 
41.     request_factory = RequestFactory()
42. 
43.     @classmethod
44.     def setUpTestData(cls):
45.         Band.objects.bulk_create(
46.             [
47.                 Band(name="Aerosmith", bio="", rank=3),
48.                 Band(name="Radiohead", bio="", rank=1),
49.                 Band(name="Van Halen", bio="", rank=2),
50.             ]
51.         )
52. 
53.     def test_default_ordering(self):
54.         """
55.         The default ordering should be by name, as specified in the inner Meta
56.         class.
57.         """
58.         ma = ModelAdmin(Band, site)
59.         names = [b.name for b in ma.get_queryset(request)]
60.         self.assertEqual(["Aerosmith", "Radiohead", "Van Halen"], names)
61. 
62.     def test_specified_ordering(self):
63.         """
64.         Let's use a custom ModelAdmin that changes the ordering, and make sure
65.         it actually changes.
66.         """
67. 
68.         class BandAdmin(ModelAdmin):
69.             ordering = ("rank",)  # default ordering is ('name',)
70. 
71.         ma = BandAdmin(Band, site)
72.         names = [b.name for b in ma.get_queryset(request)]
73.         self.assertEqual(["Radiohead", "Van Halen", "Aerosmith"], names)
74. 
75.     def test_specified_ordering_by_f_expression(self):
76.         class BandAdmin(ModelAdmin):
77.             ordering = (F("rank").desc(nulls_last=True),)
78. 
79.         band_admin = BandAdmin(Band, site)
80.         names = [b.name for b in band_admin.get_queryset(request)]
81.         self.assertEqual(["Aerosmith", "Van Halen", "Radiohead"], names)
82. 
83.     def test_dynamic_ordering(self):
84.         """
85.         Let's use a custom ModelAdmin that changes the ordering dynamically.
86.         """
87.         super_user = User.objects.create(username="admin", is_superuser=True)
88.         other_user = User.objects.create(username="other")
89.         request = self.request_factory.get("/")
90.         request.user = super_user
91.         ma = DynOrderingBandAdmin(Band, site)
92.         names = [b.name for b in ma.get_queryset(request)]
93.         self.assertEqual(["Radiohead", "Van Halen", "Aerosmith"], names)
94.         request.user = other_user
95.         names = [b.name for b in ma.get_queryset(request)]
96.         self.assertEqual(["Aerosmith", "Radiohead", "Van Halen"], names)
97. 
98. 
99. class TestInlineModelAdminOrdering(TestCase):
100.     """
101.     Let's make sure that InlineModelAdmin.get_queryset uses the ordering we
102.     define in InlineModelAdmin.
103.     """
104. 
105.     @classmethod
106.     def setUpTestData(cls):
107.         cls.band = Band.objects.create(name="Aerosmith", bio="", rank=3)
108.         Song.objects.bulk_create(
109.             [
110.                 Song(band=cls.band, name="Pink", duration=235),
111.                 Song(band=cls.band, name="Dude (Looks Like a Lady)", duration=264),
112.                 Song(band=cls.band, name="Jaded", duration=214),
113.             ]
114.         )
115. 
116.     def test_default_ordering(self):
117.         """
118.         The default ordering should be by name, as specified in the inner Meta
119.         class.
120.         """
121.         inline = SongInlineDefaultOrdering(self.band, site)
122.         names = [s.name for s in inline.get_queryset(request)]
123.         self.assertEqual(["Dude (Looks Like a Lady)", "Jaded", "Pink"], names)
124. 
125.     def test_specified_ordering(self):
126.         """
127.         Let's check with ordering set to something different than the default.
128.         """
129.         inline = SongInlineNewOrdering(self.band, site)
130.         names = [s.name for s in inline.get_queryset(request)]
131.         self.assertEqual(["Jaded", "Pink", "Dude (Looks Like a Lady)"], names)
132. 
133. 
134. class TestRelatedFieldsAdminOrdering(TestCase):
135.     @classmethod
136.     def setUpTestData(cls):
137.         cls.b1 = Band.objects.create(name="Pink Floyd", bio="", rank=1)
138.         cls.b2 = Band.objects.create(name="Foo Fighters", bio="", rank=5)
139. 
140.     def setUp(self):
141.         # we need to register a custom ModelAdmin (instead of just using
142.         # ModelAdmin) because the field creator tries to find the ModelAdmin
143.         # for the related model
144.         class SongAdmin(admin.ModelAdmin):
145.             pass
146. 
147.         site.register(Song, SongAdmin)
148. 
149.     def tearDown(self):
150.         site.unregister(Song)
151.         if Band in site._registry:
152.             site.unregister(Band)
153. 
154.     def check_ordering_of_field_choices(self, correct_ordering):
155.         fk_field = site._registry[Song].formfield_for_foreignkey(
156.             Song.band.field, request=None
157.         )
158.         m2m_field = site._registry[Song].formfield_for_manytomany(
159.             Song.other_interpreters.field, request=None
160.         )
161.         self.assertEqual(list(fk_field.queryset), correct_ordering)
162.         self.assertEqual(list(m2m_field.queryset), correct_ordering)
163. 
164.     def test_no_admin_fallback_to_model_ordering(self):
165.         # should be ordered by name (as defined by the model)
166.         self.check_ordering_of_field_choices([self.b2, self.b1])
167. 
168.     def test_admin_with_no_ordering_fallback_to_model_ordering(self):
169.         class NoOrderingBandAdmin(admin.ModelAdmin):
170.             pass
171. 
172.         site.register(Band, NoOrderingBandAdmin)
173. 
174.         # should be ordered by name (as defined by the model)
175.         self.check_ordering_of_field_choices([self.b2, self.b1])
176. 
177.     def test_admin_ordering_beats_model_ordering(self):
178.         class StaticOrderingBandAdmin(admin.ModelAdmin):
179.             ordering = ("rank",)
180. 
181.         site.register(Band, StaticOrderingBandAdmin)
182. 
183.         # should be ordered by rank (defined by the ModelAdmin)
184.         self.check_ordering_of_field_choices([self.b1, self.b2])
185. 
186.     def test_custom_queryset_still_wins(self):
187.         """Custom queryset has still precedence (#21405)"""
188. 
189.         class SongAdmin(admin.ModelAdmin):
190.             # Exclude one of the two Bands from the querysets
191.             def formfield_for_foreignkey(self, db_field, request, **kwargs):
192.                 if db_field.name == "band":
193.                     kwargs["queryset"] = Band.objects.filter(rank__gt=2)
194.                 return super().formfield_for_foreignkey(db_field, request, **kwargs)
195. 
196.             def formfield_for_manytomany(self, db_field, request, **kwargs):
197.                 if db_field.name == "other_interpreters":
198.                     kwargs["queryset"] = Band.objects.filter(rank__gt=2)
199.                 return super().formfield_for_foreignkey(db_field, request, **kwargs)
200. 
201.         class StaticOrderingBandAdmin(admin.ModelAdmin):
202.             ordering = ("rank",)
203. 
204.         site.unregister(Song)
205.         site.register(Song, SongAdmin)
206.         site.register(Band, StaticOrderingBandAdmin)
207. 
208.         self.check_ordering_of_field_choices([self.b2])

File: tests/admin_ordering/models.py
Line number range: 1 - 38
Content:
1. from django.contrib import admin
2. from django.db import models
3. 
4. 
5. class Band(models.Model):
6.     name = models.CharField(max_length=100)
7.     bio = models.TextField()
8.     rank = models.IntegerField()
9. 
10.     class Meta:
11.         ordering = ("name",)
12. 
13. 
14. class Song(models.Model):
15.     band = models.ForeignKey(Band, models.CASCADE)
16.     name = models.CharField(max_length=100)
17.     duration = models.IntegerField()
18.     other_interpreters = models.ManyToManyField(Band, related_name="covers")
19. 
20.     class Meta:
21.         ordering = ("name",)
22. 
23. 
24. class SongInlineDefaultOrdering(admin.StackedInline):
25.     model = Song
26. 
27. 
28. class SongInlineNewOrdering(admin.StackedInline):
29.     model = Song
30.     ordering = ("duration",)
31. 
32. 
33. class DynOrderingBandAdmin(admin.ModelAdmin):
34.     def get_ordering(self, request):
35.         if request.user.is_superuser:
36.             return ["rank"]
37.         else:
38.             return ["name"]


--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to a given query and the refinement query, and return your response in the specified format!
EVERY context object MUST include: reasoning, relative_path, start_line, and end_line.

2025-10-06 20:02:30,708 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="1. Query requirement analysis:\n   - The user's query is about a bug where `radio_fields` in `ModelAdmin` overrides a custom `empty_label` set via `formfield_for_foreignkey`.\n   - The user wants to find relevant test cases to understand how to fix this.\n   - The refinement query explicitly asks for the full source code of `tests/admin_widgets/tests.py`.\n\n2. Extended relevance:\n   - This file is critical because it contains the test suite for Django's admin widgets.\n   - It includes `AdminFormfieldForDBFieldTests`, which tests the `formfield_for_dbfield` method, central to the user's issue.\n   - Specifically, the test `test_radio_fields_ForeignKey` (lines 135-143) directly tests the behavior of `radio_fields` on a `ForeignKey`, which is the exact scenario described in the bug report. It even asserts the value of `ff.empty_label`.\n   - Other tests in this file, like `test_formfield_overrides` and `test_custom_queryset_still_wins`, demonstrate how to customize form fields in the admin, providing essential patterns for the user.", relative_path='tests/admin_widgets/tests.py', start_line=1, end_line=500), ContextOutput(reasoning="1. Query requirement analysis:\n   - The user's refinement query explicitly asks for the full source code of `tests/admin_widgets/models.py`.\n\n2. Extended relevance:\n   - This file defines the database models used in the tests within `tests/admin_widgets/tests.py`.\n   - Models like `Event`, `Member`, and `Band` are instantiated and manipulated in the tests.\n   - For example, the `Event` model defines the `main_band` `ForeignKey`, which is used in the `test_radio_fields_ForeignKey` test case that is highly relevant to the user's bug report.\n   - Providing this file is essential for understanding and running the tests in `tests/admin_widgets/tests.py`.", relative_path='tests/admin_widgets/models.py', start_line=1, end_line=201), ContextOutput(reasoning="1. Query requirement analysis:\n   - The user's refinement query explicitly asks for the full source code of `tests/admin_ordering/tests.py`.\n\n2. Extended relevance:\n   - This file contains tests for how `ModelAdmin` handles ordering.\n   - More importantly, it demonstrates patterns for customizing `ModelAdmin` behavior, which is what the user is trying to do.\n   - The test `test_custom_queryset_still_wins` (lines 186-200) shows an example of overriding `formfield_for_foreignkey` in a `ModelAdmin` to provide a custom `queryset`. This is a similar pattern to the user's attempt to provide a custom `empty_label`.\n   - It provides a complete, working example of a `ModelAdmin` subclass that overrides `formfield_for_foreignkey`, which is directly applicable to the user's problem.", relative_path='tests/admin_ordering/tests.py', start_line=1, end_line=208), ContextOutput(reasoning="1. Query requirement analysis:\n   - The user's refinement query explicitly asks for the full source code of `tests/admin_ordering/models.py`.\n\n2. Extended relevance:\n   - This file defines the `Band` and `Song` models used in the tests within `tests/admin_ordering/tests.py`.\n   - These models are necessary context to understand the tests that demonstrate `ModelAdmin` customization, such as overriding `formfield_for_foreignkey`.\n   - Without these model definitions, the associated tests are incomplete and cannot be run or fully understood.", relative_path='tests/admin_ordering/models.py', start_line=1, end_line=38), ContextOutput(reasoning="1. Query requirement analysis:\n   - The user's bug is about `radio_fields` on a `ForeignKey` in a `ModelAdmin` incorrectly overriding the `empty_label`.\n\n2. Extended relevance:\n   - This specific test case, `test_radio_fields_ForeignKey`, from `tests/admin_widgets/tests.py` is the most direct and relevant example in the provided context.\n   - It isolates the functionality of applying `radio_fields` to a `ForeignKey` (`main_band` on the `Event` model).\n   - It calls `formfield_for_dbfield` and asserts that the resulting widget is `widgets.AdminRadioSelect`.\n   - Crucially, it includes the assertion `self.assertIsNone(ff.empty_label)`, which directly relates to the `empty_label` attribute at the heart of the user's reported issue. This shows the expected default behavior in the test suite.", relative_path='tests/admin_widgets/tests.py', start_line=135, end_line=143)]
2025-10-06 20:02:30,709 - thread-139660780025408.app.lang_graph.nodes.context_extraction_node - INFO - Context extraction complete, returning context [Context(relative_path='tests/admin_views/tests.py', content='2911.     def test_conditionally_show_delete_section_link(self):\n2912.         """\n2913.         The foreign key widget should only show the "delete related" button if\n2914.         the user has permission to delete that related item.\n2915.         """\n2916. \n2917.         def get_delete_related(response):\n2918.             return (\n2919.                 response.context["adminform"]\n2920.                 .form.fields["sub_section"]\n2921.                 .widget.can_delete_related\n2922.             )\n2923. \n2924.         self.client.force_login(self.adduser)\n2925.         # The user can\'t delete sections yet, so they shouldn\'t see the\n2926.         # "delete section" link.\n2927.         url = reverse("admin:admin_views_article_add")\n2928.         delete_link_text = "delete_id_sub_section"\n2929.         response = self.client.get(url)\n2930.         self.assertFalse(get_delete_related(response))\n2931.         self.assertNotContains(response, delete_link_text)\n2932.         # Allow the user to delete sections too. Now they can see the\n2933.         # "delete section" link.\n2934.         user = User.objects.get(username="adduser")\n2935.         perm = get_perm(Section, get_permission_codename("delete", Section._meta))\n2936.         user.user_permissions.add(perm)\n2937.         response = self.client.get(url)\n2938.         self.assertTrue(get_delete_related(response))\n2939.         self.assertContains(response, delete_link_text)', start_line_number=2911, end_line_number=2939), Context(relative_path='tests/forms_tests/field_tests/test_choicefield.py', content='22.     def test_choicefield_2(self):\n23.         f = ChoiceField(choices=[("1", "One"), ("2", "Two")], required=False)\n24.         self.assertEqual("", f.clean(""))\n25.         self.assertEqual("", f.clean(None))\n26.         self.assertEqual("1", f.clean(1))\n27.         self.assertEqual("1", f.clean("1"))\n28.         msg = "\'Select a valid choice. 3 is not one of the available choices.\'"\n29.         with self.assertRaisesMessage(ValidationError, msg):\n30.             f.clean("3")', start_line_number=22, end_line_number=30), Context(relative_path='tests/modeladmin/tests.py', content='1. from datetime import date\n2. \n3. from django import forms\n4. from django.contrib.admin.models import ADDITION, CHANGE, DELETION, LogEntry\n5. from django.contrib.admin.options import (\n6.     HORIZONTAL,\n7.     VERTICAL,\n8.     ModelAdmin,\n9.     TabularInline,\n10.     get_content_type_for_model,\n11. )\n12. from django.contrib.admin.sites import AdminSite\n13. from django.contrib.admin.widgets import (\n14.     AdminDateWidget,\n15.     AdminRadioSelect,\n16.     AutocompleteSelect,\n17.     AutocompleteSelectMultiple,\n18. )\n19. from django.contrib.auth.models import User\n20. from django.db import models\n21. from django.forms.widgets import Select\n22. from django.test import SimpleTestCase, TestCase\n23. from django.test.utils import isolate_apps\n24. \n25. from .models import Band, Concert, Song\n26. \n27. \n28. class MockRequest:\n29.     pass\n30. \n31. \n32. class MockSuperUser:\n33.     def has_perm(self, perm, obj=None):\n34.         return True\n35. \n36. \n37. request = MockRequest()\n38. request.user = MockSuperUser()\n39. \n40. \n41. class ModelAdminTests(TestCase):\n42.     @classmethod\n43.     def setUpTestData(cls):\n44.         cls.band = Band.objects.create(\n45.             name="The Doors",\n46.             bio="",\n47.             sign_date=date(1965, 1, 1),\n48.         )\n49. \n50.     def setUp(self):\n51.         self.site = AdminSite()\n52. \n53.     def test_modeladmin_str(self):\n54.         ma = ModelAdmin(Band, self.site)\n55.         self.assertEqual(str(ma), "modeladmin.ModelAdmin")\n56. \n57.     def test_default_attributes(self):\n58.         ma = ModelAdmin(Band, self.site)\n59.         self.assertEqual(ma.actions, ())\n60.         self.assertEqual(ma.inlines, ())\n61. \n62.     # form/fields/fieldsets interaction ##############################\n63. \n64.     def test_default_fields(self):\n65.         ma = ModelAdmin(Band, self.site)\n66.         self.assertEqual(\n67.             list(ma.get_form(request).base_fields), ["name", "bio", "sign_date"]\n68.         )\n69.         self.assertEqual(list(ma.get_fields(request)), ["name", "bio", "sign_date"])\n70.         self.assertEqual(\n71.             list(ma.get_fields(request, self.band)), ["name", "bio", "sign_date"]\n72.         )\n73.         self.assertIsNone(ma.get_exclude(request, self.band))\n74. \n75.     def test_default_fieldsets(self):\n76.         # fieldsets_add and fieldsets_change should return a special data structure that\n77.         # is used in the templates. They should generate the "right thing" whether we\n78.         # have specified a custom form, the fields argument, or nothing at all.\n79.         #\n80.         # Here\'s the default case. There are no custom form_add/form_change methods,\n81.         # no fields argument, and no fieldsets argument.\n82.         ma = ModelAdmin(Band, self.site)\n83.         self.assertEqual(\n84.             ma.get_fieldsets(request),\n85.             [(None, {"fields": ["name", "bio", "sign_date"]})],\n86.         )\n87.         self.assertEqual(\n88.             ma.get_fieldsets(request, self.band),\n89.             [(None, {"fields": ["name", "bio", "sign_date"]})],\n90.         )\n91. \n92.     def test_get_fieldsets(self):\n93.         # get_fieldsets() is called when figuring out form fields (#18681).\n94.         class BandAdmin(ModelAdmin):\n95.             def get_fieldsets(self, request, obj=None):\n96.                 return [(None, {"fields": ["name", "bio"]})]\n97. \n98.         ma = BandAdmin(Band, self.site)\n99.         form = ma.get_form(None)\n100.         self.assertEqual(form._meta.fields, ["name", "bio"])\n101. \n102.         class InlineBandAdmin(TabularInline):\n103.             model = Concert\n104.             fk_name = "main_band"\n105.             can_delete = False\n106. \n107.             def get_fieldsets(self, request, obj=None):\n108.                 return [(None, {"fields": ["day", "transport"]})]\n109. \n110.         ma = InlineBandAdmin(Band, self.site)\n111.         form = ma.get_formset(None).form\n112.         self.assertEqual(form._meta.fields, ["day", "transport"])\n113. \n114.     def test_lookup_allowed_allows_nonexistent_lookup(self):\n115.         """\n116.         A lookup_allowed allows a parameter whose field lookup doesn\'t exist.\n117.         (#21129).\n118.         """\n119. \n120.         class BandAdmin(ModelAdmin):\n121.             fields = ["name"]\n122. \n123.         ma = BandAdmin(Band, self.site)\n124.         self.assertTrue(ma.lookup_allowed("name__nonexistent", "test_value"))\n125. \n126.     @isolate_apps("modeladmin")\n127.     def test_lookup_allowed_onetoone(self):\n128.         class Department(models.Model):\n129.             code = models.CharField(max_length=4, unique=True)\n130. \n131.         class Employee(models.Model):\n132.             department = models.ForeignKey(Department, models.CASCADE, to_field="code")\n133. \n134.         class EmployeeProfile(models.Model):\n135.             employee = models.OneToOneField(Employee, models.CASCADE)\n136. \n137.         class EmployeeInfo(models.Model):\n138.             employee = models.OneToOneField(Employee, models.CASCADE)\n139.             description = models.CharField(max_length=100)\n140. \n141.         class EmployeeProfileAdmin(ModelAdmin):\n142.             list_filter = [\n143.                 "employee__employeeinfo__description",\n144.                 "employee__department__code",\n145.             ]\n146. \n147.         ma = EmployeeProfileAdmin(EmployeeProfile, self.site)\n148.         # Reverse OneToOneField\n149.         self.assertIs(\n150.             ma.lookup_allowed("employee__employeeinfo__description", "test_value"), True\n151.         )\n152.         # OneToOneField and ForeignKey\n153.         self.assertIs(\n154.             ma.lookup_allowed("employee__department__code", "test_value"), True\n155.         )\n156. \n157.     def test_field_arguments(self):\n158.         # If fields is specified, fieldsets_add and fieldsets_change should\n159.         # just stick the fields into a formsets structure and return it.\n160.         class BandAdmin(ModelAdmin):\n161.             fields = ["name"]\n162. \n163.         ma = BandAdmin(Band, self.site)\n164. \n165.         self.assertEqual(list(ma.get_fields(request)), ["name"])\n166.         self.assertEqual(list(ma.get_fields(request, self.band)), ["name"])\n167.         self.assertEqual(ma.get_fieldsets(request), [(None, {"fields": ["name"]})])\n168.         self.assertEqual(\n169.             ma.get_fieldsets(request, self.band), [(None, {"fields": ["name"]})]\n170.         )\n171. \n172.     def test_field_arguments_restricted_on_form(self):\n173.         # If fields or fieldsets is specified, it should exclude fields on the\n174.         # Form class to the fields specified. This may cause errors to be\n175.         # raised in the db layer if required model fields aren\'t in fields/\n176.         # fieldsets, but that\'s preferable to ghost errors where a field in the\n177.         # Form class isn\'t being displayed because it\'s not in fields/fieldsets.\n178. \n179.         # Using `fields`.\n180.         class BandAdmin(ModelAdmin):\n181.             fields = ["name"]\n182. \n183.         ma = BandAdmin(Band, self.site)\n184.         self.assertEqual(list(ma.get_form(request).base_fields), ["name"])\n185.         self.assertEqual(list(ma.get_form(request, self.band).base_fields), ["name"])\n186. \n187.         # Using `fieldsets`.\n188.         class BandAdmin(ModelAdmin):\n189.             fieldsets = [(None, {"fields": ["name"]})]\n190. \n191.         ma = BandAdmin(Band, self.site)\n192.         self.assertEqual(list(ma.get_form(request).base_fields), ["name"])\n193.         self.assertEqual(list(ma.get_form(request, self.band).base_fields), ["name"])\n194. \n195.         # Using `exclude`.\n196.         class BandAdmin(ModelAdmin):\n197.             exclude = ["bio"]\n198. \n199.         ma = BandAdmin(Band, self.site)\n200.         self.assertEqual(list(ma.get_form(request).base_fields), ["name", "sign_date"])\n201. \n202.         # You can also pass a tuple to `exclude`.\n203.         class BandAdmin(ModelAdmin):\n204.             exclude = ("bio",)\n205. \n206.         ma = BandAdmin(Band, self.site)\n207.         self.assertEqual(list(ma.get_form(request).base_fields), ["name", "sign_date"])\n208. \n209.         # Using `fields` and `exclude`.\n210.         class BandAdmin(ModelAdmin):\n211.             fields = ["name", "bio"]\n212.             exclude = ["bio"]\n213. \n214.         ma = BandAdmin(Band, self.site)\n215.         self.assertEqual(list(ma.get_form(request).base_fields), ["name"])\n216. \n217.     def test_custom_form_meta_exclude_with_readonly(self):\n218.         """\n219.         The custom ModelForm\'s `Meta.exclude` is respected when used in\n220.         conjunction with `ModelAdmin.readonly_fields` and when no\n221.         `ModelAdmin.exclude` is defined (#14496).\n222.         """\n223.         # With ModelAdmin\n224.         class AdminBandForm(forms.ModelForm):\n225.             class Meta:\n226.                 model = Band\n227.                 exclude = ["bio"]\n228. \n229.         class BandAdmin(ModelAdmin):\n230.             readonly_fields = ["name"]\n231.             form = AdminBandForm\n232. \n233.         ma = BandAdmin(Band, self.site)\n234.         self.assertEqual(list(ma.get_form(request).base_fields), ["sign_date"])\n235. \n236.         # With InlineModelAdmin\n237.         class AdminConcertForm(forms.ModelForm):\n238.             class Meta:\n239.                 model = Concert\n240.                 exclude = ["day"]\n241. \n242.         class ConcertInline(TabularInline):\n243.             readonly_fields = ["transport"]\n244.             form = AdminConcertForm\n245.             fk_name = "main_band"\n246.             model = Concert\n247. \n248.         class BandAdmin(ModelAdmin):\n249.             inlines = [ConcertInline]\n250. \n251.         ma = BandAdmin(Band, self.site)\n252.         self.assertEqual(\n253.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),\n254.             ["main_band", "opening_band", "id", "DELETE"],\n255.         )\n256. \n257.     def test_custom_formfield_override_readonly(self):\n258.         class AdminBandForm(forms.ModelForm):\n259.             name = forms.CharField()\n260. \n261.             class Meta:\n262.                 exclude = ()\n263.                 model = Band\n264. \n265.         class BandAdmin(ModelAdmin):\n266.             form = AdminBandForm\n267.             readonly_fields = ["name"]\n268. \n269.         ma = BandAdmin(Band, self.site)\n270. \n271.         # `name` shouldn\'t appear in base_fields because it\'s part of\n272.         # readonly_fields.\n273.         self.assertEqual(list(ma.get_form(request).base_fields), ["bio", "sign_date"])\n274.         # But it should appear in get_fields()/fieldsets() so it can be\n275.         # displayed as read-only.\n276.         self.assertEqual(list(ma.get_fields(request)), ["bio", "sign_date", "name"])\n277.         self.assertEqual(\n278.             list(ma.get_fieldsets(request)),\n279.             [(None, {"fields": ["bio", "sign_date", "name"]})],\n280.         )\n281. \n282.     def test_custom_form_meta_exclude(self):\n283.         """\n284.         The custom ModelForm\'s `Meta.exclude` is overridden if\n285.         `ModelAdmin.exclude` or `InlineModelAdmin.exclude` are defined (#14496).\n286.         """\n287.         # With ModelAdmin\n288.         class AdminBandForm(forms.ModelForm):\n289.             class Meta:\n290.                 model = Band\n291.                 exclude = ["bio"]\n292. \n293.         class BandAdmin(ModelAdmin):\n294.             exclude = ["name"]\n295.             form = AdminBandForm\n296. \n297.         ma = BandAdmin(Band, self.site)\n298.         self.assertEqual(list(ma.get_form(request).base_fields), ["bio", "sign_date"])\n299. \n300.         # With InlineModelAdmin\n301.         class AdminConcertForm(forms.ModelForm):\n302.             class Meta:\n303.                 model = Concert\n304.                 exclude = ["day"]\n305. \n306.         class ConcertInline(TabularInline):\n307.             exclude = ["transport"]\n308.             form = AdminConcertForm\n309.             fk_name = "main_band"\n310.             model = Concert\n311. \n312.         class BandAdmin(ModelAdmin):\n313.             inlines = [ConcertInline]\n314. \n315.         ma = BandAdmin(Band, self.site)\n316.         self.assertEqual(\n317.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),\n318.             ["main_band", "opening_band", "day", "id", "DELETE"],\n319.         )\n320. \n321.     def test_overriding_get_exclude(self):\n322.         class BandAdmin(ModelAdmin):\n323.             def get_exclude(self, request, obj=None):\n324.                 return ["name"]\n325. \n326.         self.assertEqual(\n327.             list(BandAdmin(Band, self.site).get_form(request).base_fields),\n328.             ["bio", "sign_date"],\n329.         )\n330. \n331.     def test_get_exclude_overrides_exclude(self):\n332.         class BandAdmin(ModelAdmin):\n333.             exclude = ["bio"]\n334. \n335.             def get_exclude(self, request, obj=None):\n336.                 return ["name"]\n337. \n338.         self.assertEqual(\n339.             list(BandAdmin(Band, self.site).get_form(request).base_fields),\n340.             ["bio", "sign_date"],\n341.         )\n342. \n343.     def test_get_exclude_takes_obj(self):\n344.         class BandAdmin(ModelAdmin):\n345.             def get_exclude(self, request, obj=None):\n346.                 if obj:\n347.                     return ["sign_date"]\n348.                 return ["name"]\n349. \n350.         self.assertEqual(\n351.             list(BandAdmin(Band, self.site).get_form(request, self.band).base_fields),\n352.             ["name", "bio"],\n353.         )\n354. \n355.     def test_custom_form_validation(self):\n356.         # If a form is specified, it should use it allowing custom validation\n357.         # to work properly. This won\'t break any of the admin widgets or media.\n358.         class AdminBandForm(forms.ModelForm):\n359.             delete = forms.BooleanField()\n360. \n361.         class BandAdmin(ModelAdmin):\n362.             form = AdminBandForm\n363. \n364.         ma = BandAdmin(Band, self.site)\n365.         self.assertEqual(\n366.             list(ma.get_form(request).base_fields),\n367.             ["name", "bio", "sign_date", "delete"],\n368.         )\n369.         self.assertEqual(\n370.             type(ma.get_form(request).base_fields["sign_date"].widget), AdminDateWidget\n371.         )\n372. \n373.     def test_form_exclude_kwarg_override(self):\n374.         """\n375.         The `exclude` kwarg passed to `ModelAdmin.get_form()` overrides all\n376.         other declarations (#8999).\n377.         """\n378. \n379.         class AdminBandForm(forms.ModelForm):\n380.             class Meta:\n381.                 model = Band\n382.                 exclude = ["name"]\n383. \n384.         class BandAdmin(ModelAdmin):\n385.             exclude = ["sign_date"]\n386.             form = AdminBandForm\n387. \n388.             def get_form(self, request, obj=None, **kwargs):\n389.                 kwargs["exclude"] = ["bio"]\n390.                 return super().get_form(request, obj, **kwargs)\n391. \n392.         ma = BandAdmin(Band, self.site)\n393.         self.assertEqual(list(ma.get_form(request).base_fields), ["name", "sign_date"])\n394. \n395.     def test_formset_exclude_kwarg_override(self):\n396.         """\n397.         The `exclude` kwarg passed to `InlineModelAdmin.get_formset()`\n398.         overrides all other declarations (#8999).\n399.         """\n400. \n401.         class AdminConcertForm(forms.ModelForm):\n402.             class Meta:\n403.                 model = Concert\n404.                 exclude = ["day"]\n405. \n406.         class ConcertInline(TabularInline):\n407.             exclude = ["transport"]\n408.             form = AdminConcertForm\n409.             fk_name = "main_band"\n410.             model = Concert\n411. \n412.             def get_formset(self, request, obj=None, **kwargs):\n413.                 kwargs["exclude"] = ["opening_band"]\n414.                 return super().get_formset(request, obj, **kwargs)\n415. \n416.         class BandAdmin(ModelAdmin):\n417.             inlines = [ConcertInline]\n418. \n419.         ma = BandAdmin(Band, self.site)\n420.         self.assertEqual(\n421.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),\n422.             ["main_band", "day", "transport", "id", "DELETE"],\n423.         )\n424. \n425.     def test_formset_overriding_get_exclude_with_form_fields(self):\n426.         class AdminConcertForm(forms.ModelForm):\n427.             class Meta:\n428.                 model = Concert\n429.                 fields = ["main_band", "opening_band", "day", "transport"]\n430. \n431.         class ConcertInline(TabularInline):\n432.             form = AdminConcertForm\n433.             fk_name = "main_band"\n434.             model = Concert\n435. \n436.             def get_exclude(self, request, obj=None):\n437.                 return ["opening_band"]\n438. \n439.         class BandAdmin(ModelAdmin):\n440.             inlines = [ConcertInline]\n441. \n442.         ma = BandAdmin(Band, self.site)\n443.         self.assertEqual(\n444.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),\n445.             ["main_band", "day", "transport", "id", "DELETE"],\n446.         )\n447. \n448.     def test_formset_overriding_get_exclude_with_form_exclude(self):\n449.         class AdminConcertForm(forms.ModelForm):\n450.             class Meta:\n451.                 model = Concert\n452.                 exclude = ["day"]\n453. \n454.         class ConcertInline(TabularInline):\n455.             form = AdminConcertForm\n456.             fk_name = "main_band"\n457.             model = Concert\n458. \n459.             def get_exclude(self, request, obj=None):\n460.                 return ["opening_band"]\n461. \n462.         class BandAdmin(ModelAdmin):\n463.             inlines = [ConcertInline]\n464. \n465.         ma = BandAdmin(Band, self.site)\n466.         self.assertEqual(\n467.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),\n468.             ["main_band", "day", "transport", "id", "DELETE"],\n469.         )\n470. \n471.     def test_raw_id_fields_widget_override(self):\n472.         """\n473.         The autocomplete_fields, raw_id_fields, and radio_fields widgets may\n474.         overridden by specifying a widget in get_formset().\n475.         """\n476. \n477.         class ConcertInline(TabularInline):\n478.             model = Concert\n479.             fk_name = "main_band"\n480.             raw_id_fields = ("opening_band",)\n481. \n482.             def get_formset(self, request, obj=None, **kwargs):\n483.                 kwargs["widgets"] = {"opening_band": Select}\n484.                 return super().get_formset(request, obj, **kwargs)\n485. \n486.         class BandAdmin(ModelAdmin):\n487.             inlines = [ConcertInline]\n488. \n489.         ma = BandAdmin(Band, self.site)\n490.         band_widget = (\n491.             list(ma.get_formsets_with_inlines(request))[0][0]()\n492.             .forms[0]\n493.             .fields["opening_band"]\n494.             .widget\n495.         )\n496.         # Without the override this would be ForeignKeyRawIdWidget.\n497.         self.assertIsInstance(band_widget, Select)\n498. \n499.     def test_queryset_override(self):\n500.         # If the queryset of a ModelChoiceField in a custom form is overridden,\n501.         # RelatedFieldWidgetWrapper doesn\'t mess that up.\n502.         band2 = Band.objects.create(\n503.             name="The Beatles", bio="", sign_date=date(1962, 1, 1)\n504.         )\n505. \n506.         ma = ModelAdmin(Concert, self.site)\n507.         form = ma.get_form(request)()\n508. \n509.         self.assertHTMLEqual(\n510.             str(form["main_band"]),\n511.             \'<div class="related-widget-wrapper">\'\n512.             \'<select name="main_band" id="id_main_band" required>\'\n513.             \'<option value="" selected>---------</option>\'\n514.             \'<option value="%d">The Beatles</option>\'\n515.             \'<option value="%d">The Doors</option>\'\n516.             "</select></div>" % (band2.id, self.band.id),\n517.         )\n518. \n519.         class AdminConcertForm(forms.ModelForm):\n520.             def __init__(self, *args, **kwargs):\n521.                 super().__init__(*args, **kwargs)\n522.                 self.fields["main_band"].queryset = Band.objects.filter(\n523.                     name="The Doors"\n524.                 )\n525. \n526.         class ConcertAdminWithForm(ModelAdmin):\n527.             form = AdminConcertForm\n528. \n529.         ma = ConcertAdminWithForm(Concert, self.site)\n530.         form = ma.get_form(request)()\n531. \n532.         self.assertHTMLEqual(\n533.             str(form["main_band"]),\n534.             \'<div class="related-widget-wrapper">\'\n535.             \'<select name="main_band" id="id_main_band" required>\'\n536.             \'<option value="" selected>---------</option>\'\n537.             \'<option value="%d">The Doors</option>\'\n538.             "</select></div>" % self.band.id,\n539.         )\n540. \n541.     def test_regression_for_ticket_15820(self):\n542.         """\n543.         `obj` is passed from `InlineModelAdmin.get_fieldsets()` to\n544.         `InlineModelAdmin.get_formset()`.\n545.         """\n546. \n547.         class CustomConcertForm(forms.ModelForm):\n548.             class Meta:\n549.                 model = Concert\n550.                 fields = ["day"]\n551. \n552.         class ConcertInline(TabularInline):\n553.             model = Concert\n554.             fk_name = "main_band"\n555. \n556.             def get_formset(self, request, obj=None, **kwargs):\n557.                 if obj:\n558.                     kwargs["form"] = CustomConcertForm\n559.                 return super().get_formset(request, obj, **kwargs)\n560. \n561.         class BandAdmin(ModelAdmin):\n562.             inlines = [ConcertInline]\n563. \n564.         Concert.objects.create(main_band=self.band, opening_band=self.band, day=1)\n565.         ma = BandAdmin(Band, self.site)\n566.         inline_instances = ma.get_inline_instances(request)\n567.         fieldsets = list(inline_instances[0].get_fieldsets(request))\n568.         self.assertEqual(\n569.             fieldsets[0][1]["fields"], ["main_band", "opening_band", "day", "transport"]\n570.         )\n571.         fieldsets = list(\n572.             inline_instances[0].get_fieldsets(request, inline_instances[0].model)\n573.         )\n574.         self.assertEqual(fieldsets[0][1]["fields"], ["day"])\n575. \n576.     # radio_fields behavior ###########################################\n577. \n578.     def test_default_foreign_key_widget(self):\n579.         # First, without any radio_fields specified, the widgets for ForeignKey\n580.         # and fields with choices specified ought to be a basic Select widget.\n581.         # ForeignKey widgets in the admin are wrapped with RelatedFieldWidgetWrapper so\n582.         # they need to be handled properly when type checking. For Select fields, all of\n583.         # the choices lists have a first entry of dashes.\n584.         cma = ModelAdmin(Concert, self.site)\n585.         cmafa = cma.get_form(request)\n586. \n587.         self.assertEqual(type(cmafa.base_fields["main_band"].widget.widget), Select)\n588.         self.assertEqual(\n589.             list(cmafa.base_fields["main_band"].widget.choices),\n590.             [("", "---------"), (self.band.id, "The Doors")],\n591.         )\n592. \n593.         self.assertEqual(type(cmafa.base_fields["opening_band"].widget.widget), Select)\n594.         self.assertEqual(\n595.             list(cmafa.base_fields["opening_band"].widget.choices),\n596.             [("", "---------"), (self.band.id, "The Doors")],\n597.         )\n598.         self.assertEqual(type(cmafa.base_fields["day"].widget), Select)\n599.         self.assertEqual(\n600.             list(cmafa.base_fields["day"].widget.choices),\n601.             [("", "---------"), (1, "Fri"), (2, "Sat")],\n602.         )\n603.         self.assertEqual(type(cmafa.base_fields["transport"].widget), Select)\n604.         self.assertEqual(\n605.             list(cmafa.base_fields["transport"].widget.choices),\n606.             [("", "---------"), (1, "Plane"), (2, "Train"), (3, "Bus")],\n607.         )\n608. \n609.     def test_foreign_key_as_radio_field(self):\n610.         # Now specify all the fields as radio_fields.  Widgets should now be\n611.         # RadioSelect, and the choices list should have a first entry of \'None\' if\n612.         # blank=True for the model field.  Finally, the widget should have the\n613.         # \'radiolist\' attr, and \'inline\' as well if the field is specified HORIZONTAL.\n614.         class ConcertAdmin(ModelAdmin):\n615.             radio_fields = {\n616.                 "main_band": HORIZONTAL,\n617.                 "opening_band": VERTICAL,\n618.                 "day": VERTICAL,\n619.                 "transport": HORIZONTAL,\n620.             }\n621. \n622.         cma = ConcertAdmin(Concert, self.site)\n623.         cmafa = cma.get_form(request)\n624. \n625.         self.assertEqual(\n626.             type(cmafa.base_fields["main_band"].widget.widget), AdminRadioSelect\n627.         )\n628.         self.assertEqual(\n629.             cmafa.base_fields["main_band"].widget.attrs, {"class": "radiolist inline"}\n630.         )\n631.         self.assertEqual(\n632.             list(cmafa.base_fields["main_band"].widget.choices),\n633.             [(self.band.id, "The Doors")],\n634.         )\n635. \n636.         self.assertEqual(\n637.             type(cmafa.base_fields["opening_band"].widget.widget), AdminRadioSelect\n638.         )\n639.         self.assertEqual(\n640.             cmafa.base_fields["opening_band"].widget.attrs, {"class": "radiolist"}\n641.         )\n642.         self.assertEqual(\n643.             list(cmafa.base_fields["opening_band"].widget.choices),\n644.             [("", "None"), (self.band.id, "The Doors")],\n645.         )\n646.         self.assertEqual(type(cmafa.base_fields["day"].widget), AdminRadioSelect)\n647.         self.assertEqual(cmafa.base_fields["day"].widget.attrs, {"class": "radiolist"})\n648.         self.assertEqual(\n649.             list(cmafa.base_fields["day"].widget.choices), [(1, "Fri"), (2, "Sat")]\n650.         )\n651. \n652.         self.assertEqual(type(cmafa.base_fields["transport"].widget), AdminRadioSelect)\n653.         self.assertEqual(\n654.             cmafa.base_fields["transport"].widget.attrs, {"class": "radiolist inline"}\n655.         )\n656.         self.assertEqual(\n657.             list(cmafa.base_fields["transport"].widget.choices),\n658.             [("", "None"), (1, "Plane"), (2, "Train"), (3, "Bus")],\n659.         )\n660. \n661.         class AdminConcertForm(forms.ModelForm):\n662.             class Meta:\n663.                 model = Concert\n664.                 exclude = ("transport",)\n665. \n666.         class ConcertAdmin(ModelAdmin):\n667.             form = AdminConcertForm\n668. \n669.         ma = ConcertAdmin(Concert, self.site)\n670.         self.assertEqual(\n671.             list(ma.get_form(request).base_fields), ["main_band", "opening_band", "day"]\n672.         )\n673. \n674.         class AdminConcertForm(forms.ModelForm):\n675.             extra = forms.CharField()\n676. \n677.             class Meta:\n678.                 model = Concert\n679.                 fields = ["extra", "transport"]\n680. \n681.         class ConcertAdmin(ModelAdmin):\n682.             form = AdminConcertForm\n683. \n684.         ma = ConcertAdmin(Concert, self.site)\n685.         self.assertEqual(list(ma.get_form(request).base_fields), ["extra", "transport"])\n686. \n687.         class ConcertInline(TabularInline):\n688.             form = AdminConcertForm\n689.             model = Concert\n690.             fk_name = "main_band"\n691.             can_delete = True\n692. \n693.         class BandAdmin(ModelAdmin):\n694.             inlines = [ConcertInline]\n695. \n696.         ma = BandAdmin(Band, self.site)\n697.         self.assertEqual(\n698.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),\n699.             ["extra", "transport", "id", "DELETE", "main_band"],\n700.         )\n701. \n702.     def test_log_actions(self):\n703.         ma = ModelAdmin(Band, self.site)\n704.         mock_request = MockRequest()\n705.         mock_request.user = User.objects.create(username="bill")\n706.         content_type = get_content_type_for_model(self.band)\n707.         tests = (\n708.             (ma.log_addition, ADDITION, {"added": {}}),\n709.             (ma.log_change, CHANGE, {"changed": {"fields": ["name", "bio"]}}),\n710.             (ma.log_deletion, DELETION, str(self.band)),\n711.         )\n712.         for method, flag, message in tests:\n713.             with self.subTest(name=method.__name__):\n714.                 created = method(mock_request, self.band, message)\n715.                 fetched = LogEntry.objects.filter(action_flag=flag).latest("id")\n716.                 self.assertEqual(created, fetched)\n717.                 self.assertEqual(fetched.action_flag, flag)\n718.                 self.assertEqual(fetched.content_type, content_type)\n719.                 self.assertEqual(fetched.object_id, str(self.band.pk))\n720.                 self.assertEqual(fetched.user, mock_request.user)\n721.                 if flag == DELETION:\n722.                     self.assertEqual(fetched.change_message, "")\n723.                     self.assertEqual(fetched.object_repr, message)\n724.                 else:\n725.                     self.assertEqual(fetched.change_message, str(message))\n726.                     self.assertEqual(fetched.object_repr, str(self.band))\n727. \n728.     def test_get_autocomplete_fields(self):\n729.         class NameAdmin(ModelAdmin):\n730.             search_fields = ["name"]\n731. \n732.         class SongAdmin(ModelAdmin):\n733.             autocomplete_fields = ["featuring"]\n734.             fields = ["featuring", "band"]\n735. \n736.         class OtherSongAdmin(SongAdmin):\n737.             def get_autocomplete_fields(self, request):\n738.                 return ["band"]\n739. \n740.         self.site.register(Band, NameAdmin)\n741.         try:\n742.             # Uses autocomplete_fields if not overridden.\n743.             model_admin = SongAdmin(Song, self.site)\n744.             form = model_admin.get_form(request)()\n745.             self.assertIsInstance(\n746.                 form.fields["featuring"].widget.widget, AutocompleteSelectMultiple\n747.             )\n748.             # Uses overridden get_autocomplete_fields\n749.             model_admin = OtherSongAdmin(Song, self.site)\n750.             form = model_admin.get_form(request)()\n751.             self.assertIsInstance(form.fields["band"].widget.widget, AutocompleteSelect)\n752.         finally:\n753.             self.site.unregister(Band)\n754. \n755.     def test_get_deleted_objects(self):\n756.         mock_request = MockRequest()\n757.         mock_request.user = User.objects.create_superuser(\n758.             username="bob", email="bob@test.com", password="test"\n759.         )\n760.         self.site.register(Band, ModelAdmin)\n761.         ma = self.site._registry[Band]\n762.         (\n763.             deletable_objects,\n764.             model_count,\n765.             perms_needed,\n766.             protected,\n767.         ) = ma.get_deleted_objects([self.band], request)\n768.         self.assertEqual(deletable_objects, ["Band: The Doors"])\n769.         self.assertEqual(model_count, {"bands": 1})\n770.         self.assertEqual(perms_needed, set())\n771.         self.assertEqual(protected, [])\n772. \n773.     def test_get_deleted_objects_with_custom_has_delete_permission(self):\n774.         """\n775.         ModelAdmin.get_deleted_objects() uses ModelAdmin.has_delete_permission()\n776.         for permissions checking.\n777.         """\n778.         mock_request = MockRequest()\n779.         mock_request.user = User.objects.create_superuser(\n780.             username="bob", email="bob@test.com", password="test"\n781.         )\n782. \n783.         class TestModelAdmin(ModelAdmin):\n784.             def has_delete_permission(self, request, obj=None):\n785.                 return False\n786. \n787.         self.site.register(Band, TestModelAdmin)\n788.         ma = self.site._registry[Band]\n789.         (\n790.             deletable_objects,\n791.             model_count,\n792.             perms_needed,\n793.             protected,\n794.         ) = ma.get_deleted_objects([self.band], request)\n795.         self.assertEqual(deletable_objects, ["Band: The Doors"])\n796.         self.assertEqual(model_count, {"bands": 1})\n797.         self.assertEqual(perms_needed, {"band"})\n798.         self.assertEqual(protected, [])\n799. \n800.     def test_modeladmin_repr(self):\n801.         ma = ModelAdmin(Band, self.site)\n802.         self.assertEqual(\n803.             repr(ma),\n804.             "<ModelAdmin: model=Band site=AdminSite(name=\'admin\')>",\n805.         )', start_line_number=1, end_line_number=805), Context(relative_path='tests/admin_widgets/tests.py', content='1. import gettext\n2. import os\n3. import re\n4. from datetime import datetime, timedelta\n5. from importlib import import_module\n6. \n7. try:\n8.     import zoneinfo\n9. except ImportError:\n10.     from backports import zoneinfo\n11. \n12. from django import forms\n13. from django.conf import settings\n14. from django.contrib import admin\n15. from django.contrib.admin import widgets\n16. from django.contrib.admin.tests import AdminSeleniumTestCase\n17. from django.contrib.auth.models import User\n18. from django.core.files.storage import default_storage\n19. from django.core.files.uploadedfile import SimpleUploadedFile\n20. from django.db.models import (\n21.     CharField,\n22.     DateField,\n23.     DateTimeField,\n24.     ManyToManyField,\n25.     UUIDField,\n26. )\n27. from django.test import SimpleTestCase, TestCase, override_settings\n28. from django.urls import reverse\n29. from django.utils import translation\n30. \n31. from .models import (\n32.     Advisor,\n33.     Album,\n34.     Band,\n35.     Bee,\n36.     Car,\n37.     Company,\n38.     Event,\n39.     Honeycomb,\n40.     Individual,\n41.     Inventory,\n42.     Member,\n43.     MyFileField,\n44.     Profile,\n45.     ReleaseEvent,\n46.     School,\n47.     Student,\n48.     UnsafeLimitChoicesTo,\n49.     VideoStream,\n50. )\n51. from .widgetadmin import site as widget_admin_site\n52. \n53. \n54. class TestDataMixin:\n55.     @classmethod\n56.     def setUpTestData(cls):\n57.         cls.superuser = User.objects.create_superuser(\n58.             username="super", password="secret", email=None\n59.         )\n60.         cls.u2 = User.objects.create_user(username="testser", password="secret")\n61.         Car.objects.create(owner=cls.superuser, make="Volkswagen", model="Passat")\n62.         Car.objects.create(owner=cls.u2, make="BMW", model="M3")\n63. \n64. \n65. class AdminFormfieldForDBFieldTests(SimpleTestCase):\n66.     """\n67.     Tests for correct behavior of ModelAdmin.formfield_for_dbfield\n68.     """\n69. \n70.     def assertFormfield(self, model, fieldname, widgetclass, **admin_overrides):\n71.         """\n72.         Helper to call formfield_for_dbfield for a given model and field name\n73.         and verify that the returned formfield is appropriate.\n74.         """\n75.         # Override any settings on the model admin\n76.         class MyModelAdmin(admin.ModelAdmin):\n77.             pass\n78. \n79.         for k in admin_overrides:\n80.             setattr(MyModelAdmin, k, admin_overrides[k])\n81. \n82.         # Construct the admin, and ask it for a formfield\n83.         ma = MyModelAdmin(model, admin.site)\n84.         ff = ma.formfield_for_dbfield(model._meta.get_field(fieldname), request=None)\n85. \n86.         # "unwrap" the widget wrapper, if needed\n87.         if isinstance(ff.widget, widgets.RelatedFieldWidgetWrapper):\n88.             widget = ff.widget.widget\n89.         else:\n90.             widget = ff.widget\n91. \n92.         self.assertIsInstance(widget, widgetclass)\n93. \n94.         # Return the formfield so that other tests can continue\n95.         return ff\n96. \n97.     def test_DateField(self):\n98.         self.assertFormfield(Event, "start_date", widgets.AdminDateWidget)\n99. \n100.     def test_DateTimeField(self):\n101.         self.assertFormfield(Member, "birthdate", widgets.AdminSplitDateTime)\n102. \n103.     def test_TimeField(self):\n104.         self.assertFormfield(Event, "start_time", widgets.AdminTimeWidget)\n105. \n106.     def test_TextField(self):\n107.         self.assertFormfield(Event, "description", widgets.AdminTextareaWidget)\n108. \n109.     def test_URLField(self):\n110.         self.assertFormfield(Event, "link", widgets.AdminURLFieldWidget)\n111. \n112.     def test_IntegerField(self):\n113.         self.assertFormfield(Event, "min_age", widgets.AdminIntegerFieldWidget)\n114. \n115.     def test_CharField(self):\n116.         self.assertFormfield(Member, "name", widgets.AdminTextInputWidget)\n117. \n118.     def test_EmailField(self):\n119.         self.assertFormfield(Member, "email", widgets.AdminEmailInputWidget)\n120. \n121.     def test_FileField(self):\n122.         self.assertFormfield(Album, "cover_art", widgets.AdminFileWidget)\n123. \n124.     def test_ForeignKey(self):\n125.         self.assertFormfield(Event, "main_band", forms.Select)\n126. \n127.     def test_raw_id_ForeignKey(self):\n128.         self.assertFormfield(\n129.             Event,\n130.             "main_band",\n131.             widgets.ForeignKeyRawIdWidget,\n132.             raw_id_fields=["main_band"],\n133.         )\n134. \n135.     def test_radio_fields_ForeignKey(self):\n136.         ff = self.assertFormfield(\n137.             Event,\n138.             "main_band",\n139.             widgets.AdminRadioSelect,\n140.             radio_fields={"main_band": admin.VERTICAL},\n141.         )\n142.         self.assertIsNone(ff.empty_label)\n143. \n144.     def test_many_to_many(self):\n145.         self.assertFormfield(Band, "members", forms.SelectMultiple)\n146. \n147.     def test_raw_id_many_to_many(self):\n148.         self.assertFormfield(\n149.             Band, "members", widgets.ManyToManyRawIdWidget, raw_id_fields=["members"]\n150.         )\n151. \n152.     def test_filtered_many_to_many(self):\n153.         self.assertFormfield(\n154.             Band, "members", widgets.FilteredSelectMultiple, filter_vertical=["members"]\n155.         )\n156. \n157.     def test_formfield_overrides(self):\n158.         self.assertFormfield(\n159.             Event,\n160.             "start_date",\n161.             forms.TextInput,\n162.             formfield_overrides={DateField: {"widget": forms.TextInput}},\n163.         )\n164. \n165.     def test_formfield_overrides_widget_instances(self):\n166.         """\n167.         Widget instances in formfield_overrides are not shared between\n168.         different fields. (#19423)\n169.         """\n170. \n171.         class BandAdmin(admin.ModelAdmin):\n172.             formfield_overrides = {\n173.                 CharField: {"widget": forms.TextInput(attrs={"size": "10"})}\n174.             }\n175. \n176.         ma = BandAdmin(Band, admin.site)\n177.         f1 = ma.formfield_for_dbfield(Band._meta.get_field("name"), request=None)\n178.         f2 = ma.formfield_for_dbfield(Band._meta.get_field("style"), request=None)\n179.         self.assertNotEqual(f1.widget, f2.widget)\n180.         self.assertEqual(f1.widget.attrs["maxlength"], "100")\n181.         self.assertEqual(f2.widget.attrs["maxlength"], "20")\n182.         self.assertEqual(f2.widget.attrs["size"], "10")\n183. \n184.     def test_formfield_overrides_m2m_filter_widget(self):\n185.         """\n186.         The autocomplete_fields, raw_id_fields, filter_vertical, and\n187.         filter_horizontal widgets for ManyToManyFields may be overridden by\n188.         specifying a widget in formfield_overrides.\n189.         """\n190. \n191.         class BandAdmin(admin.ModelAdmin):\n192.             filter_vertical = ["members"]\n193.             formfield_overrides = {\n194.                 ManyToManyField: {"widget": forms.CheckboxSelectMultiple},\n195.             }\n196. \n197.         ma = BandAdmin(Band, admin.site)\n198.         field = ma.formfield_for_dbfield(Band._meta.get_field("members"), request=None)\n199.         self.assertIsInstance(field.widget.widget, forms.CheckboxSelectMultiple)\n200. \n201.     def test_formfield_overrides_for_datetime_field(self):\n202.         """\n203.         Overriding the widget for DateTimeField doesn\'t overrides the default\n204.         form_class for that field (#26449).\n205.         """\n206. \n207.         class MemberAdmin(admin.ModelAdmin):\n208.             formfield_overrides = {\n209.                 DateTimeField: {"widget": widgets.AdminSplitDateTime}\n210.             }\n211. \n212.         ma = MemberAdmin(Member, admin.site)\n213.         f1 = ma.formfield_for_dbfield(Member._meta.get_field("birthdate"), request=None)\n214.         self.assertIsInstance(f1.widget, widgets.AdminSplitDateTime)\n215.         self.assertIsInstance(f1, forms.SplitDateTimeField)\n216. \n217.     def test_formfield_overrides_for_custom_field(self):\n218.         """\n219.         formfield_overrides works for a custom field class.\n220.         """\n221. \n222.         class AlbumAdmin(admin.ModelAdmin):\n223.             formfield_overrides = {MyFileField: {"widget": forms.TextInput()}}\n224. \n225.         ma = AlbumAdmin(Member, admin.site)\n226.         f1 = ma.formfield_for_dbfield(\n227.             Album._meta.get_field("backside_art"), request=None\n228.         )\n229.         self.assertIsInstance(f1.widget, forms.TextInput)\n230. \n231.     def test_field_with_choices(self):\n232.         self.assertFormfield(Member, "gender", forms.Select)\n233. \n234.     def test_choices_with_radio_fields(self):\n235.         self.assertFormfield(\n236.             Member,\n237.             "gender",\n238.             widgets.AdminRadioSelect,\n239.             radio_fields={"gender": admin.VERTICAL},\n240.         )\n241. \n242.     def test_inheritance(self):\n243.         self.assertFormfield(Album, "backside_art", widgets.AdminFileWidget)\n244. \n245.     def test_m2m_widgets(self):\n246.         """m2m fields help text as it applies to admin app (#9321)."""\n247. \n248.         class AdvisorAdmin(admin.ModelAdmin):\n249.             filter_vertical = ["companies"]\n250. \n251.         self.assertFormfield(\n252.             Advisor,\n253.             "companies",\n254.             widgets.FilteredSelectMultiple,\n255.             filter_vertical=["companies"],\n256.         )\n257.         ma = AdvisorAdmin(Advisor, admin.site)\n258.         f = ma.formfield_for_dbfield(Advisor._meta.get_field("companies"), request=None)\n259.         self.assertEqual(\n260.             f.help_text,\n261.             "Hold down “Control”, or “Command” on a Mac, to select more than one.",\n262.         )\n263. \n264. \n265. @override_settings(ROOT_URLCONF="admin_widgets.urls")\n266. class AdminFormfieldForDBFieldWithRequestTests(TestDataMixin, TestCase):\n267.     def test_filter_choices_by_request_user(self):\n268.         """\n269.         Ensure the user can only see their own cars in the foreign key dropdown.\n270.         """\n271.         self.client.force_login(self.superuser)\n272.         response = self.client.get(reverse("admin:admin_widgets_cartire_add"))\n273.         self.assertNotContains(response, "BMW M3")\n274.         self.assertContains(response, "Volkswagen Passat")\n275. \n276. \n277. @override_settings(ROOT_URLCONF="admin_widgets.urls")\n278. class AdminForeignKeyWidgetChangeList(TestDataMixin, TestCase):\n279.     def setUp(self):\n280.         self.client.force_login(self.superuser)\n281. \n282.     def test_changelist_ForeignKey(self):\n283.         response = self.client.get(reverse("admin:admin_widgets_car_changelist"))\n284.         self.assertContains(response, "/auth/user/add/")\n285. \n286. \n287. @override_settings(ROOT_URLCONF="admin_widgets.urls")\n288. class AdminForeignKeyRawIdWidget(TestDataMixin, TestCase):\n289.     def setUp(self):\n290.         self.client.force_login(self.superuser)\n291. \n292.     def test_nonexistent_target_id(self):\n293.         band = Band.objects.create(name="Bogey Blues")\n294.         pk = band.pk\n295.         band.delete()\n296.         post_data = {\n297.             "main_band": str(pk),\n298.         }\n299.         # Try posting with a nonexistent pk in a raw id field: this\n300.         # should result in an error message, not a server exception.\n301.         response = self.client.post(reverse("admin:admin_widgets_event_add"), post_data)\n302.         self.assertContains(\n303.             response,\n304.             "Select a valid choice. That choice is not one of the available choices.",\n305.         )\n306. \n307.     def test_invalid_target_id(self):\n308. \n309.         for test_str in ("Iñtërnâtiônàlizætiøn", "1234\'", -1234):\n310.             # This should result in an error message, not a server exception.\n311.             response = self.client.post(\n312.                 reverse("admin:admin_widgets_event_add"), {"main_band": test_str}\n313.             )\n314. \n315.             self.assertContains(\n316.                 response,\n317.                 "Select a valid choice. That choice is not one of the available "\n318.                 "choices.",\n319.             )\n320. \n321.     def test_url_params_from_lookup_dict_any_iterable(self):\n322.         lookup1 = widgets.url_params_from_lookup_dict({"color__in": ("red", "blue")})\n323.         lookup2 = widgets.url_params_from_lookup_dict({"color__in": ["red", "blue"]})\n324.         self.assertEqual(lookup1, {"color__in": "red,blue"})\n325.         self.assertEqual(lookup1, lookup2)\n326. \n327.     def test_url_params_from_lookup_dict_callable(self):\n328.         def my_callable():\n329.             return "works"\n330. \n331.         lookup1 = widgets.url_params_from_lookup_dict({"myfield": my_callable})\n332.         lookup2 = widgets.url_params_from_lookup_dict({"myfield": my_callable()})\n333.         self.assertEqual(lookup1, lookup2)\n334. \n335.     def test_label_and_url_for_value_invalid_uuid(self):\n336.         field = Bee._meta.get_field("honeycomb")\n337.         self.assertIsInstance(field.target_field, UUIDField)\n338.         widget = widgets.ForeignKeyRawIdWidget(field.remote_field, admin.site)\n339.         self.assertEqual(widget.label_and_url_for_value("invalid-uuid"), ("", ""))\n340. \n341. \n342. class FilteredSelectMultipleWidgetTest(SimpleTestCase):\n343.     def test_render(self):\n344.         # Backslash in verbose_name to ensure it is JavaScript escaped.\n345.         w = widgets.FilteredSelectMultiple("test\\\\", False)\n346.         self.assertHTMLEqual(\n347.             w.render("test", "test"),\n348.             \'<select multiple name="test" class="selectfilter" \'\n349.             \'data-field-name="test\\\\" data-is-stacked="0">\\n</select>\',\n350.         )\n351. \n352.     def test_stacked_render(self):\n353.         # Backslash in verbose_name to ensure it is JavaScript escaped.\n354.         w = widgets.FilteredSelectMultiple("test\\\\", True)\n355.         self.assertHTMLEqual(\n356.             w.render("test", "test"),\n357.             \'<select multiple name="test" class="selectfilterstacked" \'\n358.             \'data-field-name="test\\\\" data-is-stacked="1">\\n</select>\',\n359.         )\n360. \n361. \n362. class AdminDateWidgetTest(SimpleTestCase):\n363.     def test_attrs(self):\n364.         w = widgets.AdminDateWidget()\n365.         self.assertHTMLEqual(\n366.             w.render("test", datetime(2007, 12, 1, 9, 30)),\n367.             \'<input value="2007-12-01" type="text" class="vDateField" name="test" \'\n368.             \'size="10">\',\n369.         )\n370.         # pass attrs to widget\n371.         w = widgets.AdminDateWidget(attrs={"size": 20, "class": "myDateField"})\n372.         self.assertHTMLEqual(\n373.             w.render("test", datetime(2007, 12, 1, 9, 30)),\n374.             \'<input value="2007-12-01" type="text" class="myDateField" name="test" \'\n375.             \'size="20">\',\n376.         )\n377. \n378. \n379. class AdminTimeWidgetTest(SimpleTestCase):\n380.     def test_attrs(self):\n381.         w = widgets.AdminTimeWidget()\n382.         self.assertHTMLEqual(\n383.             w.render("test", datetime(2007, 12, 1, 9, 30)),\n384.             \'<input value="09:30:00" type="text" class="vTimeField" name="test" \'\n385.             \'size="8">\',\n386.         )\n387.         # pass attrs to widget\n388.         w = widgets.AdminTimeWidget(attrs={"size": 20, "class": "myTimeField"})\n389.         self.assertHTMLEqual(\n390.             w.render("test", datetime(2007, 12, 1, 9, 30)),\n391.             \'<input value="09:30:00" type="text" class="myTimeField" name="test" \'\n392.             \'size="20">\',\n393.         )\n394. \n395. \n396. class AdminSplitDateTimeWidgetTest(SimpleTestCase):\n397.     def test_render(self):\n398.         w = widgets.AdminSplitDateTime()\n399.         self.assertHTMLEqual(\n400.             w.render("test", datetime(2007, 12, 1, 9, 30)),\n401.             \'<p class="datetime">\'\n402.             \'Date: <input value="2007-12-01" type="text" class="vDateField" \'\n403.             \'name="test_0" size="10"><br>\'\n404.             \'Time: <input value="09:30:00" type="text" class="vTimeField" \'\n405.             \'name="test_1" size="8"></p>\',\n406.         )\n407. \n408.     def test_localization(self):\n409.         w = widgets.AdminSplitDateTime()\n410. \n411.         with translation.override("de-at"):\n412.             w.is_localized = True\n413.             self.assertHTMLEqual(\n414.                 w.render("test", datetime(2007, 12, 1, 9, 30)),\n415.                 \'<p class="datetime">\'\n416.                 \'Datum: <input value="01.12.2007" type="text" \'\n417.                 \'class="vDateField" name="test_0"size="10"><br>\'\n418.                 \'Zeit: <input value="09:30:00" type="text" class="vTimeField" \'\n419.                 \'name="test_1" size="8"></p>\',\n420.             )\n421. \n422. \n423. class AdminURLWidgetTest(SimpleTestCase):\n424.     def test_get_context_validates_url(self):\n425.         w = widgets.AdminURLFieldWidget()\n426.         for invalid in ["", "/not/a/full/url/", \'javascript:alert("Danger XSS!")\']:\n427.             with self.subTest(url=invalid):\n428.                 self.assertFalse(w.get_context("name", invalid, {})["url_valid"])\n429.         self.assertTrue(w.get_context("name", "http://example.com", {})["url_valid"])\n430. \n431.     def test_render(self):\n432.         w = widgets.AdminURLFieldWidget()\n433.         self.assertHTMLEqual(\n434.             w.render("test", ""), \'<input class="vURLField" name="test" type="url">\'\n435.         )\n436.         self.assertHTMLEqual(\n437.             w.render("test", "http://example.com"),\n438.             \'<p class="url">Currently:<a href="http://example.com">\'\n439.             "http://example.com</a><br>"\n440.             \'Change:<input class="vURLField" name="test" type="url" \'\n441.             \'value="http://example.com"></p>\',\n442.         )\n443. \n444.     def test_render_idn(self):\n445.         w = widgets.AdminURLFieldWidget()\n446.         self.assertHTMLEqual(\n447.             w.render("test", "http://example-äüö.com"),\n448.             \'<p class="url">Currently: <a href="http://xn--example--7za4pnc.com">\'\n449.             "http://example-äüö.com</a><br>"\n450.             \'Change:<input class="vURLField" name="test" type="url" \'\n451.             \'value="http://example-äüö.com"></p>\',\n452.         )\n453. \n454.     def test_render_quoting(self):\n455.         """\n456.         WARNING: This test doesn\'t use assertHTMLEqual since it will get rid\n457.         of some escapes which are tested here!\n458.         """\n459.         HREF_RE = re.compile(\'href="([^"]+)"\')\n460.         VALUE_RE = re.compile(\'value="([^"]+)"\')\n461.         TEXT_RE = re.compile("<a[^>]+>([^>]+)</a>")\n462.         w = widgets.AdminURLFieldWidget()\n463.         output = w.render("test", "http://example.com/<sometag>some-text</sometag>")\n464.         self.assertEqual(\n465.             HREF_RE.search(output)[1],\n466.             "http://example.com/%3Csometag%3Esome-text%3C/sometag%3E",\n467.         )\n468.         self.assertEqual(\n469.             TEXT_RE.search(output)[1],\n470.             "http://example.com/&lt;sometag&gt;some-text&lt;/sometag&gt;",\n471.         )\n472.         self.assertEqual(\n473.             VALUE_RE.search(output)[1],\n474.             "http://example.com/&lt;sometag&gt;some-text&lt;/sometag&gt;",\n475.         )\n476.         output = w.render("test", "http://example-äüö.com/<sometag>some-text</sometag>")\n477.         self.assertEqual(\n478.             HREF_RE.search(output)[1],\n479.             "http://xn--example--7za4pnc.com/%3Csometag%3Esome-text%3C/sometag%3E",\n480.         )\n481.         self.assertEqual(\n482.             TEXT_RE.search(output)[1],\n483.             "http://example-äüö.com/&lt;sometag&gt;some-text&lt;/sometag&gt;",\n484.         )\n485.         self.assertEqual(\n486.             VALUE_RE.search(output)[1],\n487.             "http://example-äüö.com/&lt;sometag&gt;some-text&lt;/sometag&gt;",\n488.         )\n489.         output = w.render(\n490.             "test", \'http://www.example.com/%C3%A4"><script>alert("XSS!")</script>"\'\n491.         )\n492.         self.assertEqual(\n493.             HREF_RE.search(output)[1],\n494.             "http://www.example.com/%C3%A4%22%3E%3Cscript%3Ealert(%22XSS!%22)"\n495.             "%3C/script%3E%22",\n496.         )\n497.         self.assertEqual(\n498.             TEXT_RE.search(output)[1],\n499.             "http://www.example.com/%C3%A4&quot;&gt;&lt;script&gt;"\n500.             "alert(&quot;XSS!&quot;)&lt;/script&gt;&quot;",', start_line_number=1, end_line_number=500), Context(relative_path='tests/admin_widgets/models.py', content='1. import uuid\n2. \n3. from django.contrib.auth.models import User\n4. from django.db import models\n5. \n6. \n7. class MyFileField(models.FileField):\n8.     pass\n9. \n10. \n11. class Member(models.Model):\n12.     name = models.CharField(max_length=100)\n13.     birthdate = models.DateTimeField(blank=True, null=True)\n14.     gender = models.CharField(\n15.         max_length=1, blank=True, choices=[("M", "Male"), ("F", "Female")]\n16.     )\n17.     email = models.EmailField(blank=True)\n18. \n19.     def __str__(self):\n20.         return self.name\n21. \n22. \n23. class Artist(models.Model):\n24.     pass\n25. \n26. \n27. class Band(Artist):\n28.     uuid = models.UUIDField(unique=True, default=uuid.uuid4)\n29.     name = models.CharField(max_length=100)\n30.     style = models.CharField(max_length=20)\n31.     members = models.ManyToManyField(Member)\n32. \n33.     def __str__(self):\n34.         return self.name\n35. \n36. \n37. class UnsafeLimitChoicesTo(models.Model):\n38.     band = models.ForeignKey(\n39.         Band,\n40.         models.CASCADE,\n41.         limit_choices_to={"name": \'"&><escapeme\'},\n42.     )\n43. \n44. \n45. class Album(models.Model):\n46.     band = models.ForeignKey(Band, models.CASCADE, to_field="uuid")\n47.     featuring = models.ManyToManyField(Band, related_name="featured")\n48.     name = models.CharField(max_length=100)\n49.     cover_art = models.FileField(upload_to="albums")\n50.     backside_art = MyFileField(upload_to="albums_back", null=True)\n51. \n52.     def __str__(self):\n53.         return self.name\n54. \n55. \n56. class ReleaseEvent(models.Model):\n57.     """\n58.     Used to check that autocomplete widget correctly resolves attname for FK as\n59.     PK example.\n60.     """\n61. \n62.     album = models.ForeignKey(Album, models.CASCADE, primary_key=True)\n63.     name = models.CharField(max_length=100)\n64. \n65.     class Meta:\n66.         ordering = ["name"]\n67. \n68.     def __str__(self):\n69.         return self.name\n70. \n71. \n72. class VideoStream(models.Model):\n73.     release_event = models.ForeignKey(ReleaseEvent, models.CASCADE)\n74. \n75. \n76. class HiddenInventoryManager(models.Manager):\n77.     def get_queryset(self):\n78.         return super().get_queryset().filter(hidden=False)\n79. \n80. \n81. class Inventory(models.Model):\n82.     barcode = models.PositiveIntegerField(unique=True)\n83.     parent = models.ForeignKey(\n84.         "self", models.SET_NULL, to_field="barcode", blank=True, null=True\n85.     )\n86.     name = models.CharField(blank=False, max_length=20)\n87.     hidden = models.BooleanField(default=False)\n88. \n89.     # see #9258\n90.     default_manager = models.Manager()\n91.     objects = HiddenInventoryManager()\n92. \n93.     def __str__(self):\n94.         return self.name\n95. \n96. \n97. class Event(models.Model):\n98.     main_band = models.ForeignKey(\n99.         Band,\n100.         models.CASCADE,\n101.         limit_choices_to=models.Q(pk__gt=0),\n102.         related_name="events_main_band_at",\n103.     )\n104.     supporting_bands = models.ManyToManyField(\n105.         Band,\n106.         blank=True,\n107.         related_name="events_supporting_band_at",\n108.         help_text="Supporting Bands.",\n109.     )\n110.     start_date = models.DateField(blank=True, null=True)\n111.     start_time = models.TimeField(blank=True, null=True)\n112.     description = models.TextField(blank=True)\n113.     link = models.URLField(blank=True)\n114.     min_age = models.IntegerField(blank=True, null=True)\n115. \n116. \n117. class Car(models.Model):\n118.     owner = models.ForeignKey(User, models.CASCADE)\n119.     make = models.CharField(max_length=30)\n120.     model = models.CharField(max_length=30)\n121. \n122.     def __str__(self):\n123.         return "%s %s" % (self.make, self.model)\n124. \n125. \n126. class CarTire(models.Model):\n127.     """\n128.     A single car tire. This to test that a user can only select their own cars.\n129.     """\n130. \n131.     car = models.ForeignKey(Car, models.CASCADE)\n132. \n133. \n134. class Honeycomb(models.Model):\n135.     id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)\n136.     location = models.CharField(max_length=20)\n137. \n138. \n139. class Bee(models.Model):\n140.     """\n141.     A model with a FK to a model that won\'t be registered with the admin\n142.     (Honeycomb) so the corresponding raw ID widget won\'t have a magnifying\n143.     glass link to select related honeycomb instances.\n144.     """\n145. \n146.     honeycomb = models.ForeignKey(Honeycomb, models.CASCADE)\n147. \n148. \n149. class Individual(models.Model):\n150.     """\n151.     A model with a FK to itself. It won\'t be registered with the admin, so the\n152.     corresponding raw ID widget won\'t have a magnifying glass link to select\n153.     related instances (rendering will be called programmatically in this case).\n154.     """\n155. \n156.     name = models.CharField(max_length=20)\n157.     parent = models.ForeignKey("self", models.SET_NULL, null=True)\n158.     soulmate = models.ForeignKey(\n159.         "self", models.CASCADE, null=True, related_name="soulmates"\n160.     )\n161. \n162. \n163. class Company(models.Model):\n164.     name = models.CharField(max_length=20)\n165. \n166. \n167. class Advisor(models.Model):\n168.     """\n169.     A model with a m2m to a model that won\'t be registered with the admin\n170.     (Company) so the corresponding raw ID widget won\'t have a magnifying\n171.     glass link to select related company instances.\n172.     """\n173. \n174.     name = models.CharField(max_length=20)\n175.     companies = models.ManyToManyField(Company)\n176. \n177. \n178. class Student(models.Model):\n179.     name = models.CharField(max_length=255)\n180. \n181.     class Meta:\n182.         ordering = ("name",)\n183. \n184.     def __str__(self):\n185.         return self.name\n186. \n187. \n188. class School(models.Model):\n189.     name = models.CharField(max_length=255)\n190.     students = models.ManyToManyField(Student, related_name="current_schools")\n191.     alumni = models.ManyToManyField(Student, related_name="previous_schools")\n192. \n193.     def __str__(self):\n194.         return self.name\n195. \n196. \n197. class Profile(models.Model):\n198.     user = models.ForeignKey("auth.User", models.CASCADE, to_field="username")\n199. \n200.     def __str__(self):\n201.         return self.user.username', start_line_number=1, end_line_number=201), Context(relative_path='tests/admin_ordering/tests.py', content='1. from django.contrib import admin\n2. from django.contrib.admin.options import ModelAdmin\n3. from django.contrib.auth.models import User\n4. from django.db.models import F\n5. from django.test import RequestFactory, TestCase\n6. \n7. from .models import (\n8.     Band,\n9.     DynOrderingBandAdmin,\n10.     Song,\n11.     SongInlineDefaultOrdering,\n12.     SongInlineNewOrdering,\n13. )\n14. \n15. \n16. class MockRequest:\n17.     pass\n18. \n19. \n20. class MockSuperUser:\n21.     def has_perm(self, perm, obj=None):\n22.         return True\n23. \n24.     def has_module_perms(self, module):\n25.         return True\n26. \n27. \n28. request = MockRequest()\n29. request.user = MockSuperUser()\n30. \n31. site = admin.AdminSite()\n32. \n33. \n34. class TestAdminOrdering(TestCase):\n35.     """\n36.     Let\'s make sure that ModelAdmin.get_queryset uses the ordering we define\n37.     in ModelAdmin rather that ordering defined in the model\'s inner Meta\n38.     class.\n39.     """\n40. \n41.     request_factory = RequestFactory()\n42. \n43.     @classmethod\n44.     def setUpTestData(cls):\n45.         Band.objects.bulk_create(\n46.             [\n47.                 Band(name="Aerosmith", bio="", rank=3),\n48.                 Band(name="Radiohead", bio="", rank=1),\n49.                 Band(name="Van Halen", bio="", rank=2),\n50.             ]\n51.         )\n52. \n53.     def test_default_ordering(self):\n54.         """\n55.         The default ordering should be by name, as specified in the inner Meta\n56.         class.\n57.         """\n58.         ma = ModelAdmin(Band, site)\n59.         names = [b.name for b in ma.get_queryset(request)]\n60.         self.assertEqual(["Aerosmith", "Radiohead", "Van Halen"], names)\n61. \n62.     def test_specified_ordering(self):\n63.         """\n64.         Let\'s use a custom ModelAdmin that changes the ordering, and make sure\n65.         it actually changes.\n66.         """\n67. \n68.         class BandAdmin(ModelAdmin):\n69.             ordering = ("rank",)  # default ordering is (\'name\',)\n70. \n71.         ma = BandAdmin(Band, site)\n72.         names = [b.name for b in ma.get_queryset(request)]\n73.         self.assertEqual(["Radiohead", "Van Halen", "Aerosmith"], names)\n74. \n75.     def test_specified_ordering_by_f_expression(self):\n76.         class BandAdmin(ModelAdmin):\n77.             ordering = (F("rank").desc(nulls_last=True),)\n78. \n79.         band_admin = BandAdmin(Band, site)\n80.         names = [b.name for b in band_admin.get_queryset(request)]\n81.         self.assertEqual(["Aerosmith", "Van Halen", "Radiohead"], names)\n82. \n83.     def test_dynamic_ordering(self):\n84.         """\n85.         Let\'s use a custom ModelAdmin that changes the ordering dynamically.\n86.         """\n87.         super_user = User.objects.create(username="admin", is_superuser=True)\n88.         other_user = User.objects.create(username="other")\n89.         request = self.request_factory.get("/")\n90.         request.user = super_user\n91.         ma = DynOrderingBandAdmin(Band, site)\n92.         names = [b.name for b in ma.get_queryset(request)]\n93.         self.assertEqual(["Radiohead", "Van Halen", "Aerosmith"], names)\n94.         request.user = other_user\n95.         names = [b.name for b in ma.get_queryset(request)]\n96.         self.assertEqual(["Aerosmith", "Radiohead", "Van Halen"], names)\n97. \n98. \n99. class TestInlineModelAdminOrdering(TestCase):\n100.     """\n101.     Let\'s make sure that InlineModelAdmin.get_queryset uses the ordering we\n102.     define in InlineModelAdmin.\n103.     """\n104. \n105.     @classmethod\n106.     def setUpTestData(cls):\n107.         cls.band = Band.objects.create(name="Aerosmith", bio="", rank=3)\n108.         Song.objects.bulk_create(\n109.             [\n110.                 Song(band=cls.band, name="Pink", duration=235),\n111.                 Song(band=cls.band, name="Dude (Looks Like a Lady)", duration=264),\n112.                 Song(band=cls.band, name="Jaded", duration=214),\n113.             ]\n114.         )\n115. \n116.     def test_default_ordering(self):\n117.         """\n118.         The default ordering should be by name, as specified in the inner Meta\n119.         class.\n120.         """\n121.         inline = SongInlineDefaultOrdering(self.band, site)\n122.         names = [s.name for s in inline.get_queryset(request)]\n123.         self.assertEqual(["Dude (Looks Like a Lady)", "Jaded", "Pink"], names)\n124. \n125.     def test_specified_ordering(self):\n126.         """\n127.         Let\'s check with ordering set to something different than the default.\n128.         """\n129.         inline = SongInlineNewOrdering(self.band, site)\n130.         names = [s.name for s in inline.get_queryset(request)]\n131.         self.assertEqual(["Jaded", "Pink", "Dude (Looks Like a Lady)"], names)\n132. \n133. \n134. class TestRelatedFieldsAdminOrdering(TestCase):\n135.     @classmethod\n136.     def setUpTestData(cls):\n137.         cls.b1 = Band.objects.create(name="Pink Floyd", bio="", rank=1)\n138.         cls.b2 = Band.objects.create(name="Foo Fighters", bio="", rank=5)\n139. \n140.     def setUp(self):\n141.         # we need to register a custom ModelAdmin (instead of just using\n142.         # ModelAdmin) because the field creator tries to find the ModelAdmin\n143.         # for the related model\n144.         class SongAdmin(admin.ModelAdmin):\n145.             pass\n146. \n147.         site.register(Song, SongAdmin)\n148. \n149.     def tearDown(self):\n150.         site.unregister(Song)\n151.         if Band in site._registry:\n152.             site.unregister(Band)\n153. \n154.     def check_ordering_of_field_choices(self, correct_ordering):\n155.         fk_field = site._registry[Song].formfield_for_foreignkey(\n156.             Song.band.field, request=None\n157.         )\n158.         m2m_field = site._registry[Song].formfield_for_manytomany(\n159.             Song.other_interpreters.field, request=None\n160.         )\n161.         self.assertEqual(list(fk_field.queryset), correct_ordering)\n162.         self.assertEqual(list(m2m_field.queryset), correct_ordering)\n163. \n164.     def test_no_admin_fallback_to_model_ordering(self):\n165.         # should be ordered by name (as defined by the model)\n166.         self.check_ordering_of_field_choices([self.b2, self.b1])\n167. \n168.     def test_admin_with_no_ordering_fallback_to_model_ordering(self):\n169.         class NoOrderingBandAdmin(admin.ModelAdmin):\n170.             pass\n171. \n172.         site.register(Band, NoOrderingBandAdmin)\n173. \n174.         # should be ordered by name (as defined by the model)\n175.         self.check_ordering_of_field_choices([self.b2, self.b1])\n176. \n177.     def test_admin_ordering_beats_model_ordering(self):\n178.         class StaticOrderingBandAdmin(admin.ModelAdmin):\n179.             ordering = ("rank",)\n180. \n181.         site.register(Band, StaticOrderingBandAdmin)\n182. \n183.         # should be ordered by rank (defined by the ModelAdmin)\n184.         self.check_ordering_of_field_choices([self.b1, self.b2])\n185. \n186.     def test_custom_queryset_still_wins(self):\n187.         """Custom queryset has still precedence (#21405)"""\n188. \n189.         class SongAdmin(admin.ModelAdmin):\n190.             # Exclude one of the two Bands from the querysets\n191.             def formfield_for_foreignkey(self, db_field, request, **kwargs):\n192.                 if db_field.name == "band":\n193.                     kwargs["queryset"] = Band.objects.filter(rank__gt=2)\n194.                 return super().formfield_for_foreignkey(db_field, request, **kwargs)\n195. \n196.             def formfield_for_manytomany(self, db_field, request, **kwargs):\n197.                 if db_field.name == "other_interpreters":\n198.                     kwargs["queryset"] = Band.objects.filter(rank__gt=2)\n199.                 return super().formfield_for_foreignkey(db_field, request, **kwargs)\n200. \n201.         class StaticOrderingBandAdmin(admin.ModelAdmin):\n202.             ordering = ("rank",)\n203. \n204.         site.unregister(Song)\n205.         site.register(Song, SongAdmin)\n206.         site.register(Band, StaticOrderingBandAdmin)\n207. \n208.         self.check_ordering_of_field_choices([self.b2])', start_line_number=1, end_line_number=208), Context(relative_path='tests/admin_ordering/models.py', content='1. from django.contrib import admin\n2. from django.db import models\n3. \n4. \n5. class Band(models.Model):\n6.     name = models.CharField(max_length=100)\n7.     bio = models.TextField()\n8.     rank = models.IntegerField()\n9. \n10.     class Meta:\n11.         ordering = ("name",)\n12. \n13. \n14. class Song(models.Model):\n15.     band = models.ForeignKey(Band, models.CASCADE)\n16.     name = models.CharField(max_length=100)\n17.     duration = models.IntegerField()\n18.     other_interpreters = models.ManyToManyField(Band, related_name="covers")\n19. \n20.     class Meta:\n21.         ordering = ("name",)\n22. \n23. \n24. class SongInlineDefaultOrdering(admin.StackedInline):\n25.     model = Song\n26. \n27. \n28. class SongInlineNewOrdering(admin.StackedInline):\n29.     model = Song\n30.     ordering = ("duration",)\n31. \n32. \n33. class DynOrderingBandAdmin(admin.ModelAdmin):\n34.     def get_ordering(self, request):\n35.         if request.user.is_superuser:\n36.             return ["rank"]\n37.         else:\n38.             return ["name"]', start_line_number=1, end_line_number=38)]
2025-10-06 20:02:30,710 - thread-139660780025408.app.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-10-06 20:02:30,710 - thread-139660780025408.app.lang_graph.nodes.context_refine_node - INFO - Reached max_refined_query_loop, not asking for more context
2025-10-06 20:02:30,711 - thread-139660780025408.app.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Context retrieved: [Context(relative_path='tests/admin_views/tests.py', content='2911.     def test_conditionally_show_delete_section_link(self):\n2912.         """\n2913.         The foreign key widget should only show the "delete related" button if\n2914.         the user has permission to delete that related item.\n2915.         """\n2916. \n2917.         def get_delete_related(response):\n2918.             return (\n2919.                 response.context["adminform"]\n2920.                 .form.fields["sub_section"]\n2921.                 .widget.can_delete_related\n2922.             )\n2923. \n2924.         self.client.force_login(self.adduser)\n2925.         # The user can\'t delete sections yet, so they shouldn\'t see the\n2926.         # "delete section" link.\n2927.         url = reverse("admin:admin_views_article_add")\n2928.         delete_link_text = "delete_id_sub_section"\n2929.         response = self.client.get(url)\n2930.         self.assertFalse(get_delete_related(response))\n2931.         self.assertNotContains(response, delete_link_text)\n2932.         # Allow the user to delete sections too. Now they can see the\n2933.         # "delete section" link.\n2934.         user = User.objects.get(username="adduser")\n2935.         perm = get_perm(Section, get_permission_codename("delete", Section._meta))\n2936.         user.user_permissions.add(perm)\n2937.         response = self.client.get(url)\n2938.         self.assertTrue(get_delete_related(response))\n2939.         self.assertContains(response, delete_link_text)', start_line_number=2911, end_line_number=2939), Context(relative_path='tests/forms_tests/field_tests/test_choicefield.py', content='22.     def test_choicefield_2(self):\n23.         f = ChoiceField(choices=[("1", "One"), ("2", "Two")], required=False)\n24.         self.assertEqual("", f.clean(""))\n25.         self.assertEqual("", f.clean(None))\n26.         self.assertEqual("1", f.clean(1))\n27.         self.assertEqual("1", f.clean("1"))\n28.         msg = "\'Select a valid choice. 3 is not one of the available choices.\'"\n29.         with self.assertRaisesMessage(ValidationError, msg):\n30.             f.clean("3")', start_line_number=22, end_line_number=30), Context(relative_path='tests/modeladmin/tests.py', content='1. from datetime import date\n2. \n3. from django import forms\n4. from django.contrib.admin.models import ADDITION, CHANGE, DELETION, LogEntry\n5. from django.contrib.admin.options import (\n6.     HORIZONTAL,\n7.     VERTICAL,\n8.     ModelAdmin,\n9.     TabularInline,\n10.     get_content_type_for_model,\n11. )\n12. from django.contrib.admin.sites import AdminSite\n13. from django.contrib.admin.widgets import (\n14.     AdminDateWidget,\n15.     AdminRadioSelect,\n16.     AutocompleteSelect,\n17.     AutocompleteSelectMultiple,\n18. )\n19. from django.contrib.auth.models import User\n20. from django.db import models\n21. from django.forms.widgets import Select\n22. from django.test import SimpleTestCase, TestCase\n23. from django.test.utils import isolate_apps\n24. \n25. from .models import Band, Concert, Song\n26. \n27. \n28. class MockRequest:\n29.     pass\n30. \n31. \n32. class MockSuperUser:\n33.     def has_perm(self, perm, obj=None):\n34.         return True\n35. \n36. \n37. request = MockRequest()\n38. request.user = MockSuperUser()\n39. \n40. \n41. class ModelAdminTests(TestCase):\n42.     @classmethod\n43.     def setUpTestData(cls):\n44.         cls.band = Band.objects.create(\n45.             name="The Doors",\n46.             bio="",\n47.             sign_date=date(1965, 1, 1),\n48.         )\n49. \n50.     def setUp(self):\n51.         self.site = AdminSite()\n52. \n53.     def test_modeladmin_str(self):\n54.         ma = ModelAdmin(Band, self.site)\n55.         self.assertEqual(str(ma), "modeladmin.ModelAdmin")\n56. \n57.     def test_default_attributes(self):\n58.         ma = ModelAdmin(Band, self.site)\n59.         self.assertEqual(ma.actions, ())\n60.         self.assertEqual(ma.inlines, ())\n61. \n62.     # form/fields/fieldsets interaction ##############################\n63. \n64.     def test_default_fields(self):\n65.         ma = ModelAdmin(Band, self.site)\n66.         self.assertEqual(\n67.             list(ma.get_form(request).base_fields), ["name", "bio", "sign_date"]\n68.         )\n69.         self.assertEqual(list(ma.get_fields(request)), ["name", "bio", "sign_date"])\n70.         self.assertEqual(\n71.             list(ma.get_fields(request, self.band)), ["name", "bio", "sign_date"]\n72.         )\n73.         self.assertIsNone(ma.get_exclude(request, self.band))\n74. \n75.     def test_default_fieldsets(self):\n76.         # fieldsets_add and fieldsets_change should return a special data structure that\n77.         # is used in the templates. They should generate the "right thing" whether we\n78.         # have specified a custom form, the fields argument, or nothing at all.\n79.         #\n80.         # Here\'s the default case. There are no custom form_add/form_change methods,\n81.         # no fields argument, and no fieldsets argument.\n82.         ma = ModelAdmin(Band, self.site)\n83.         self.assertEqual(\n84.             ma.get_fieldsets(request),\n85.             [(None, {"fields": ["name", "bio", "sign_date"]})],\n86.         )\n87.         self.assertEqual(\n88.             ma.get_fieldsets(request, self.band),\n89.             [(None, {"fields": ["name", "bio", "sign_date"]})],\n90.         )\n91. \n92.     def test_get_fieldsets(self):\n93.         # get_fieldsets() is called when figuring out form fields (#18681).\n94.         class BandAdmin(ModelAdmin):\n95.             def get_fieldsets(self, request, obj=None):\n96.                 return [(None, {"fields": ["name", "bio"]})]\n97. \n98.         ma = BandAdmin(Band, self.site)\n99.         form = ma.get_form(None)\n100.         self.assertEqual(form._meta.fields, ["name", "bio"])\n101. \n102.         class InlineBandAdmin(TabularInline):\n103.             model = Concert\n104.             fk_name = "main_band"\n105.             can_delete = False\n106. \n107.             def get_fieldsets(self, request, obj=None):\n108.                 return [(None, {"fields": ["day", "transport"]})]\n109. \n110.         ma = InlineBandAdmin(Band, self.site)\n111.         form = ma.get_formset(None).form\n112.         self.assertEqual(form._meta.fields, ["day", "transport"])\n113. \n114.     def test_lookup_allowed_allows_nonexistent_lookup(self):\n115.         """\n116.         A lookup_allowed allows a parameter whose field lookup doesn\'t exist.\n117.         (#21129).\n118.         """\n119. \n120.         class BandAdmin(ModelAdmin):\n121.             fields = ["name"]\n122. \n123.         ma = BandAdmin(Band, self.site)\n124.         self.assertTrue(ma.lookup_allowed("name__nonexistent", "test_value"))\n125. \n126.     @isolate_apps("modeladmin")\n127.     def test_lookup_allowed_onetoone(self):\n128.         class Department(models.Model):\n129.             code = models.CharField(max_length=4, unique=True)\n130. \n131.         class Employee(models.Model):\n132.             department = models.ForeignKey(Department, models.CASCADE, to_field="code")\n133. \n134.         class EmployeeProfile(models.Model):\n135.             employee = models.OneToOneField(Employee, models.CASCADE)\n136. \n137.         class EmployeeInfo(models.Model):\n138.             employee = models.OneToOneField(Employee, models.CASCADE)\n139.             description = models.CharField(max_length=100)\n140. \n141.         class EmployeeProfileAdmin(ModelAdmin):\n142.             list_filter = [\n143.                 "employee__employeeinfo__description",\n144.                 "employee__department__code",\n145.             ]\n146. \n147.         ma = EmployeeProfileAdmin(EmployeeProfile, self.site)\n148.         # Reverse OneToOneField\n149.         self.assertIs(\n150.             ma.lookup_allowed("employee__employeeinfo__description", "test_value"), True\n151.         )\n152.         # OneToOneField and ForeignKey\n153.         self.assertIs(\n154.             ma.lookup_allowed("employee__department__code", "test_value"), True\n155.         )\n156. \n157.     def test_field_arguments(self):\n158.         # If fields is specified, fieldsets_add and fieldsets_change should\n159.         # just stick the fields into a formsets structure and return it.\n160.         class BandAdmin(ModelAdmin):\n161.             fields = ["name"]\n162. \n163.         ma = BandAdmin(Band, self.site)\n164. \n165.         self.assertEqual(list(ma.get_fields(request)), ["name"])\n166.         self.assertEqual(list(ma.get_fields(request, self.band)), ["name"])\n167.         self.assertEqual(ma.get_fieldsets(request), [(None, {"fields": ["name"]})])\n168.         self.assertEqual(\n169.             ma.get_fieldsets(request, self.band), [(None, {"fields": ["name"]})]\n170.         )\n171. \n172.     def test_field_arguments_restricted_on_form(self):\n173.         # If fields or fieldsets is specified, it should exclude fields on the\n174.         # Form class to the fields specified. This may cause errors to be\n175.         # raised in the db layer if required model fields aren\'t in fields/\n176.         # fieldsets, but that\'s preferable to ghost errors where a field in the\n177.         # Form class isn\'t being displayed because it\'s not in fields/fieldsets.\n178. \n179.         # Using `fields`.\n180.         class BandAdmin(ModelAdmin):\n181.             fields = ["name"]\n182. \n183.         ma = BandAdmin(Band, self.site)\n184.         self.assertEqual(list(ma.get_form(request).base_fields), ["name"])\n185.         self.assertEqual(list(ma.get_form(request, self.band).base_fields), ["name"])\n186. \n187.         # Using `fieldsets`.\n188.         class BandAdmin(ModelAdmin):\n189.             fieldsets = [(None, {"fields": ["name"]})]\n190. \n191.         ma = BandAdmin(Band, self.site)\n192.         self.assertEqual(list(ma.get_form(request).base_fields), ["name"])\n193.         self.assertEqual(list(ma.get_form(request, self.band).base_fields), ["name"])\n194. \n195.         # Using `exclude`.\n196.         class BandAdmin(ModelAdmin):\n197.             exclude = ["bio"]\n198. \n199.         ma = BandAdmin(Band, self.site)\n200.         self.assertEqual(list(ma.get_form(request).base_fields), ["name", "sign_date"])\n201. \n202.         # You can also pass a tuple to `exclude`.\n203.         class BandAdmin(ModelAdmin):\n204.             exclude = ("bio",)\n205. \n206.         ma = BandAdmin(Band, self.site)\n207.         self.assertEqual(list(ma.get_form(request).base_fields), ["name", "sign_date"])\n208. \n209.         # Using `fields` and `exclude`.\n210.         class BandAdmin(ModelAdmin):\n211.             fields = ["name", "bio"]\n212.             exclude = ["bio"]\n213. \n214.         ma = BandAdmin(Band, self.site)\n215.         self.assertEqual(list(ma.get_form(request).base_fields), ["name"])\n216. \n217.     def test_custom_form_meta_exclude_with_readonly(self):\n218.         """\n219.         The custom ModelForm\'s `Meta.exclude` is respected when used in\n220.         conjunction with `ModelAdmin.readonly_fields` and when no\n221.         `ModelAdmin.exclude` is defined (#14496).\n222.         """\n223.         # With ModelAdmin\n224.         class AdminBandForm(forms.ModelForm):\n225.             class Meta:\n226.                 model = Band\n227.                 exclude = ["bio"]\n228. \n229.         class BandAdmin(ModelAdmin):\n230.             readonly_fields = ["name"]\n231.             form = AdminBandForm\n232. \n233.         ma = BandAdmin(Band, self.site)\n234.         self.assertEqual(list(ma.get_form(request).base_fields), ["sign_date"])\n235. \n236.         # With InlineModelAdmin\n237.         class AdminConcertForm(forms.ModelForm):\n238.             class Meta:\n239.                 model = Concert\n240.                 exclude = ["day"]\n241. \n242.         class ConcertInline(TabularInline):\n243.             readonly_fields = ["transport"]\n244.             form = AdminConcertForm\n245.             fk_name = "main_band"\n246.             model = Concert\n247. \n248.         class BandAdmin(ModelAdmin):\n249.             inlines = [ConcertInline]\n250. \n251.         ma = BandAdmin(Band, self.site)\n252.         self.assertEqual(\n253.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),\n254.             ["main_band", "opening_band", "id", "DELETE"],\n255.         )\n256. \n257.     def test_custom_formfield_override_readonly(self):\n258.         class AdminBandForm(forms.ModelForm):\n259.             name = forms.CharField()\n260. \n261.             class Meta:\n262.                 exclude = ()\n263.                 model = Band\n264. \n265.         class BandAdmin(ModelAdmin):\n266.             form = AdminBandForm\n267.             readonly_fields = ["name"]\n268. \n269.         ma = BandAdmin(Band, self.site)\n270. \n271.         # `name` shouldn\'t appear in base_fields because it\'s part of\n272.         # readonly_fields.\n273.         self.assertEqual(list(ma.get_form(request).base_fields), ["bio", "sign_date"])\n274.         # But it should appear in get_fields()/fieldsets() so it can be\n275.         # displayed as read-only.\n276.         self.assertEqual(list(ma.get_fields(request)), ["bio", "sign_date", "name"])\n277.         self.assertEqual(\n278.             list(ma.get_fieldsets(request)),\n279.             [(None, {"fields": ["bio", "sign_date", "name"]})],\n280.         )\n281. \n282.     def test_custom_form_meta_exclude(self):\n283.         """\n284.         The custom ModelForm\'s `Meta.exclude` is overridden if\n285.         `ModelAdmin.exclude` or `InlineModelAdmin.exclude` are defined (#14496).\n286.         """\n287.         # With ModelAdmin\n288.         class AdminBandForm(forms.ModelForm):\n289.             class Meta:\n290.                 model = Band\n291.                 exclude = ["bio"]\n292. \n293.         class BandAdmin(ModelAdmin):\n294.             exclude = ["name"]\n295.             form = AdminBandForm\n296. \n297.         ma = BandAdmin(Band, self.site)\n298.         self.assertEqual(list(ma.get_form(request).base_fields), ["bio", "sign_date"])\n299. \n300.         # With InlineModelAdmin\n301.         class AdminConcertForm(forms.ModelForm):\n302.             class Meta:\n303.                 model = Concert\n304.                 exclude = ["day"]\n305. \n306.         class ConcertInline(TabularInline):\n307.             exclude = ["transport"]\n308.             form = AdminConcertForm\n309.             fk_name = "main_band"\n310.             model = Concert\n311. \n312.         class BandAdmin(ModelAdmin):\n313.             inlines = [ConcertInline]\n314. \n315.         ma = BandAdmin(Band, self.site)\n316.         self.assertEqual(\n317.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),\n318.             ["main_band", "opening_band", "day", "id", "DELETE"],\n319.         )\n320. \n321.     def test_overriding_get_exclude(self):\n322.         class BandAdmin(ModelAdmin):\n323.             def get_exclude(self, request, obj=None):\n324.                 return ["name"]\n325. \n326.         self.assertEqual(\n327.             list(BandAdmin(Band, self.site).get_form(request).base_fields),\n328.             ["bio", "sign_date"],\n329.         )\n330. \n331.     def test_get_exclude_overrides_exclude(self):\n332.         class BandAdmin(ModelAdmin):\n333.             exclude = ["bio"]\n334. \n335.             def get_exclude(self, request, obj=None):\n336.                 return ["name"]\n337. \n338.         self.assertEqual(\n339.             list(BandAdmin(Band, self.site).get_form(request).base_fields),\n340.             ["bio", "sign_date"],\n341.         )\n342. \n343.     def test_get_exclude_takes_obj(self):\n344.         class BandAdmin(ModelAdmin):\n345.             def get_exclude(self, request, obj=None):\n346.                 if obj:\n347.                     return ["sign_date"]\n348.                 return ["name"]\n349. \n350.         self.assertEqual(\n351.             list(BandAdmin(Band, self.site).get_form(request, self.band).base_fields),\n352.             ["name", "bio"],\n353.         )\n354. \n355.     def test_custom_form_validation(self):\n356.         # If a form is specified, it should use it allowing custom validation\n357.         # to work properly. This won\'t break any of the admin widgets or media.\n358.         class AdminBandForm(forms.ModelForm):\n359.             delete = forms.BooleanField()\n360. \n361.         class BandAdmin(ModelAdmin):\n362.             form = AdminBandForm\n363. \n364.         ma = BandAdmin(Band, self.site)\n365.         self.assertEqual(\n366.             list(ma.get_form(request).base_fields),\n367.             ["name", "bio", "sign_date", "delete"],\n368.         )\n369.         self.assertEqual(\n370.             type(ma.get_form(request).base_fields["sign_date"].widget), AdminDateWidget\n371.         )\n372. \n373.     def test_form_exclude_kwarg_override(self):\n374.         """\n375.         The `exclude` kwarg passed to `ModelAdmin.get_form()` overrides all\n376.         other declarations (#8999).\n377.         """\n378. \n379.         class AdminBandForm(forms.ModelForm):\n380.             class Meta:\n381.                 model = Band\n382.                 exclude = ["name"]\n383. \n384.         class BandAdmin(ModelAdmin):\n385.             exclude = ["sign_date"]\n386.             form = AdminBandForm\n387. \n388.             def get_form(self, request, obj=None, **kwargs):\n389.                 kwargs["exclude"] = ["bio"]\n390.                 return super().get_form(request, obj, **kwargs)\n391. \n392.         ma = BandAdmin(Band, self.site)\n393.         self.assertEqual(list(ma.get_form(request).base_fields), ["name", "sign_date"])\n394. \n395.     def test_formset_exclude_kwarg_override(self):\n396.         """\n397.         The `exclude` kwarg passed to `InlineModelAdmin.get_formset()`\n398.         overrides all other declarations (#8999).\n399.         """\n400. \n401.         class AdminConcertForm(forms.ModelForm):\n402.             class Meta:\n403.                 model = Concert\n404.                 exclude = ["day"]\n405. \n406.         class ConcertInline(TabularInline):\n407.             exclude = ["transport"]\n408.             form = AdminConcertForm\n409.             fk_name = "main_band"\n410.             model = Concert\n411. \n412.             def get_formset(self, request, obj=None, **kwargs):\n413.                 kwargs["exclude"] = ["opening_band"]\n414.                 return super().get_formset(request, obj, **kwargs)\n415. \n416.         class BandAdmin(ModelAdmin):\n417.             inlines = [ConcertInline]\n418. \n419.         ma = BandAdmin(Band, self.site)\n420.         self.assertEqual(\n421.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),\n422.             ["main_band", "day", "transport", "id", "DELETE"],\n423.         )\n424. \n425.     def test_formset_overriding_get_exclude_with_form_fields(self):\n426.         class AdminConcertForm(forms.ModelForm):\n427.             class Meta:\n428.                 model = Concert\n429.                 fields = ["main_band", "opening_band", "day", "transport"]\n430. \n431.         class ConcertInline(TabularInline):\n432.             form = AdminConcertForm\n433.             fk_name = "main_band"\n434.             model = Concert\n435. \n436.             def get_exclude(self, request, obj=None):\n437.                 return ["opening_band"]\n438. \n439.         class BandAdmin(ModelAdmin):\n440.             inlines = [ConcertInline]\n441. \n442.         ma = BandAdmin(Band, self.site)\n443.         self.assertEqual(\n444.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),\n445.             ["main_band", "day", "transport", "id", "DELETE"],\n446.         )\n447. \n448.     def test_formset_overriding_get_exclude_with_form_exclude(self):\n449.         class AdminConcertForm(forms.ModelForm):\n450.             class Meta:\n451.                 model = Concert\n452.                 exclude = ["day"]\n453. \n454.         class ConcertInline(TabularInline):\n455.             form = AdminConcertForm\n456.             fk_name = "main_band"\n457.             model = Concert\n458. \n459.             def get_exclude(self, request, obj=None):\n460.                 return ["opening_band"]\n461. \n462.         class BandAdmin(ModelAdmin):\n463.             inlines = [ConcertInline]\n464. \n465.         ma = BandAdmin(Band, self.site)\n466.         self.assertEqual(\n467.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),\n468.             ["main_band", "day", "transport", "id", "DELETE"],\n469.         )\n470. \n471.     def test_raw_id_fields_widget_override(self):\n472.         """\n473.         The autocomplete_fields, raw_id_fields, and radio_fields widgets may\n474.         overridden by specifying a widget in get_formset().\n475.         """\n476. \n477.         class ConcertInline(TabularInline):\n478.             model = Concert\n479.             fk_name = "main_band"\n480.             raw_id_fields = ("opening_band",)\n481. \n482.             def get_formset(self, request, obj=None, **kwargs):\n483.                 kwargs["widgets"] = {"opening_band": Select}\n484.                 return super().get_formset(request, obj, **kwargs)\n485. \n486.         class BandAdmin(ModelAdmin):\n487.             inlines = [ConcertInline]\n488. \n489.         ma = BandAdmin(Band, self.site)\n490.         band_widget = (\n491.             list(ma.get_formsets_with_inlines(request))[0][0]()\n492.             .forms[0]\n493.             .fields["opening_band"]\n494.             .widget\n495.         )\n496.         # Without the override this would be ForeignKeyRawIdWidget.\n497.         self.assertIsInstance(band_widget, Select)\n498. \n499.     def test_queryset_override(self):\n500.         # If the queryset of a ModelChoiceField in a custom form is overridden,\n501.         # RelatedFieldWidgetWrapper doesn\'t mess that up.\n502.         band2 = Band.objects.create(\n503.             name="The Beatles", bio="", sign_date=date(1962, 1, 1)\n504.         )\n505. \n506.         ma = ModelAdmin(Concert, self.site)\n507.         form = ma.get_form(request)()\n508. \n509.         self.assertHTMLEqual(\n510.             str(form["main_band"]),\n511.             \'<div class="related-widget-wrapper">\'\n512.             \'<select name="main_band" id="id_main_band" required>\'\n513.             \'<option value="" selected>---------</option>\'\n514.             \'<option value="%d">The Beatles</option>\'\n515.             \'<option value="%d">The Doors</option>\'\n516.             "</select></div>" % (band2.id, self.band.id),\n517.         )\n518. \n519.         class AdminConcertForm(forms.ModelForm):\n520.             def __init__(self, *args, **kwargs):\n521.                 super().__init__(*args, **kwargs)\n522.                 self.fields["main_band"].queryset = Band.objects.filter(\n523.                     name="The Doors"\n524.                 )\n525. \n526.         class ConcertAdminWithForm(ModelAdmin):\n527.             form = AdminConcertForm\n528. \n529.         ma = ConcertAdminWithForm(Concert, self.site)\n530.         form = ma.get_form(request)()\n531. \n532.         self.assertHTMLEqual(\n533.             str(form["main_band"]),\n534.             \'<div class="related-widget-wrapper">\'\n535.             \'<select name="main_band" id="id_main_band" required>\'\n536.             \'<option value="" selected>---------</option>\'\n537.             \'<option value="%d">The Doors</option>\'\n538.             "</select></div>" % self.band.id,\n539.         )\n540. \n541.     def test_regression_for_ticket_15820(self):\n542.         """\n543.         `obj` is passed from `InlineModelAdmin.get_fieldsets()` to\n544.         `InlineModelAdmin.get_formset()`.\n545.         """\n546. \n547.         class CustomConcertForm(forms.ModelForm):\n548.             class Meta:\n549.                 model = Concert\n550.                 fields = ["day"]\n551. \n552.         class ConcertInline(TabularInline):\n553.             model = Concert\n554.             fk_name = "main_band"\n555. \n556.             def get_formset(self, request, obj=None, **kwargs):\n557.                 if obj:\n558.                     kwargs["form"] = CustomConcertForm\n559.                 return super().get_formset(request, obj, **kwargs)\n560. \n561.         class BandAdmin(ModelAdmin):\n562.             inlines = [ConcertInline]\n563. \n564.         Concert.objects.create(main_band=self.band, opening_band=self.band, day=1)\n565.         ma = BandAdmin(Band, self.site)\n566.         inline_instances = ma.get_inline_instances(request)\n567.         fieldsets = list(inline_instances[0].get_fieldsets(request))\n568.         self.assertEqual(\n569.             fieldsets[0][1]["fields"], ["main_band", "opening_band", "day", "transport"]\n570.         )\n571.         fieldsets = list(\n572.             inline_instances[0].get_fieldsets(request, inline_instances[0].model)\n573.         )\n574.         self.assertEqual(fieldsets[0][1]["fields"], ["day"])\n575. \n576.     # radio_fields behavior ###########################################\n577. \n578.     def test_default_foreign_key_widget(self):\n579.         # First, without any radio_fields specified, the widgets for ForeignKey\n580.         # and fields with choices specified ought to be a basic Select widget.\n581.         # ForeignKey widgets in the admin are wrapped with RelatedFieldWidgetWrapper so\n582.         # they need to be handled properly when type checking. For Select fields, all of\n583.         # the choices lists have a first entry of dashes.\n584.         cma = ModelAdmin(Concert, self.site)\n585.         cmafa = cma.get_form(request)\n586. \n587.         self.assertEqual(type(cmafa.base_fields["main_band"].widget.widget), Select)\n588.         self.assertEqual(\n589.             list(cmafa.base_fields["main_band"].widget.choices),\n590.             [("", "---------"), (self.band.id, "The Doors")],\n591.         )\n592. \n593.         self.assertEqual(type(cmafa.base_fields["opening_band"].widget.widget), Select)\n594.         self.assertEqual(\n595.             list(cmafa.base_fields["opening_band"].widget.choices),\n596.             [("", "---------"), (self.band.id, "The Doors")],\n597.         )\n598.         self.assertEqual(type(cmafa.base_fields["day"].widget), Select)\n599.         self.assertEqual(\n600.             list(cmafa.base_fields["day"].widget.choices),\n601.             [("", "---------"), (1, "Fri"), (2, "Sat")],\n602.         )\n603.         self.assertEqual(type(cmafa.base_fields["transport"].widget), Select)\n604.         self.assertEqual(\n605.             list(cmafa.base_fields["transport"].widget.choices),\n606.             [("", "---------"), (1, "Plane"), (2, "Train"), (3, "Bus")],\n607.         )\n608. \n609.     def test_foreign_key_as_radio_field(self):\n610.         # Now specify all the fields as radio_fields.  Widgets should now be\n611.         # RadioSelect, and the choices list should have a first entry of \'None\' if\n612.         # blank=True for the model field.  Finally, the widget should have the\n613.         # \'radiolist\' attr, and \'inline\' as well if the field is specified HORIZONTAL.\n614.         class ConcertAdmin(ModelAdmin):\n615.             radio_fields = {\n616.                 "main_band": HORIZONTAL,\n617.                 "opening_band": VERTICAL,\n618.                 "day": VERTICAL,\n619.                 "transport": HORIZONTAL,\n620.             }\n621. \n622.         cma = ConcertAdmin(Concert, self.site)\n623.         cmafa = cma.get_form(request)\n624. \n625.         self.assertEqual(\n626.             type(cmafa.base_fields["main_band"].widget.widget), AdminRadioSelect\n627.         )\n628.         self.assertEqual(\n629.             cmafa.base_fields["main_band"].widget.attrs, {"class": "radiolist inline"}\n630.         )\n631.         self.assertEqual(\n632.             list(cmafa.base_fields["main_band"].widget.choices),\n633.             [(self.band.id, "The Doors")],\n634.         )\n635. \n636.         self.assertEqual(\n637.             type(cmafa.base_fields["opening_band"].widget.widget), AdminRadioSelect\n638.         )\n639.         self.assertEqual(\n640.             cmafa.base_fields["opening_band"].widget.attrs, {"class": "radiolist"}\n641.         )\n642.         self.assertEqual(\n643.             list(cmafa.base_fields["opening_band"].widget.choices),\n644.             [("", "None"), (self.band.id, "The Doors")],\n645.         )\n646.         self.assertEqual(type(cmafa.base_fields["day"].widget), AdminRadioSelect)\n647.         self.assertEqual(cmafa.base_fields["day"].widget.attrs, {"class": "radiolist"})\n648.         self.assertEqual(\n649.             list(cmafa.base_fields["day"].widget.choices), [(1, "Fri"), (2, "Sat")]\n650.         )\n651. \n652.         self.assertEqual(type(cmafa.base_fields["transport"].widget), AdminRadioSelect)\n653.         self.assertEqual(\n654.             cmafa.base_fields["transport"].widget.attrs, {"class": "radiolist inline"}\n655.         )\n656.         self.assertEqual(\n657.             list(cmafa.base_fields["transport"].widget.choices),\n658.             [("", "None"), (1, "Plane"), (2, "Train"), (3, "Bus")],\n659.         )\n660. \n661.         class AdminConcertForm(forms.ModelForm):\n662.             class Meta:\n663.                 model = Concert\n664.                 exclude = ("transport",)\n665. \n666.         class ConcertAdmin(ModelAdmin):\n667.             form = AdminConcertForm\n668. \n669.         ma = ConcertAdmin(Concert, self.site)\n670.         self.assertEqual(\n671.             list(ma.get_form(request).base_fields), ["main_band", "opening_band", "day"]\n672.         )\n673. \n674.         class AdminConcertForm(forms.ModelForm):\n675.             extra = forms.CharField()\n676. \n677.             class Meta:\n678.                 model = Concert\n679.                 fields = ["extra", "transport"]\n680. \n681.         class ConcertAdmin(ModelAdmin):\n682.             form = AdminConcertForm\n683. \n684.         ma = ConcertAdmin(Concert, self.site)\n685.         self.assertEqual(list(ma.get_form(request).base_fields), ["extra", "transport"])\n686. \n687.         class ConcertInline(TabularInline):\n688.             form = AdminConcertForm\n689.             model = Concert\n690.             fk_name = "main_band"\n691.             can_delete = True\n692. \n693.         class BandAdmin(ModelAdmin):\n694.             inlines = [ConcertInline]\n695. \n696.         ma = BandAdmin(Band, self.site)\n697.         self.assertEqual(\n698.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),\n699.             ["extra", "transport", "id", "DELETE", "main_band"],\n700.         )\n701. \n702.     def test_log_actions(self):\n703.         ma = ModelAdmin(Band, self.site)\n704.         mock_request = MockRequest()\n705.         mock_request.user = User.objects.create(username="bill")\n706.         content_type = get_content_type_for_model(self.band)\n707.         tests = (\n708.             (ma.log_addition, ADDITION, {"added": {}}),\n709.             (ma.log_change, CHANGE, {"changed": {"fields": ["name", "bio"]}}),\n710.             (ma.log_deletion, DELETION, str(self.band)),\n711.         )\n712.         for method, flag, message in tests:\n713.             with self.subTest(name=method.__name__):\n714.                 created = method(mock_request, self.band, message)\n715.                 fetched = LogEntry.objects.filter(action_flag=flag).latest("id")\n716.                 self.assertEqual(created, fetched)\n717.                 self.assertEqual(fetched.action_flag, flag)\n718.                 self.assertEqual(fetched.content_type, content_type)\n719.                 self.assertEqual(fetched.object_id, str(self.band.pk))\n720.                 self.assertEqual(fetched.user, mock_request.user)\n721.                 if flag == DELETION:\n722.                     self.assertEqual(fetched.change_message, "")\n723.                     self.assertEqual(fetched.object_repr, message)\n724.                 else:\n725.                     self.assertEqual(fetched.change_message, str(message))\n726.                     self.assertEqual(fetched.object_repr, str(self.band))\n727. \n728.     def test_get_autocomplete_fields(self):\n729.         class NameAdmin(ModelAdmin):\n730.             search_fields = ["name"]\n731. \n732.         class SongAdmin(ModelAdmin):\n733.             autocomplete_fields = ["featuring"]\n734.             fields = ["featuring", "band"]\n735. \n736.         class OtherSongAdmin(SongAdmin):\n737.             def get_autocomplete_fields(self, request):\n738.                 return ["band"]\n739. \n740.         self.site.register(Band, NameAdmin)\n741.         try:\n742.             # Uses autocomplete_fields if not overridden.\n743.             model_admin = SongAdmin(Song, self.site)\n744.             form = model_admin.get_form(request)()\n745.             self.assertIsInstance(\n746.                 form.fields["featuring"].widget.widget, AutocompleteSelectMultiple\n747.             )\n748.             # Uses overridden get_autocomplete_fields\n749.             model_admin = OtherSongAdmin(Song, self.site)\n750.             form = model_admin.get_form(request)()\n751.             self.assertIsInstance(form.fields["band"].widget.widget, AutocompleteSelect)\n752.         finally:\n753.             self.site.unregister(Band)\n754. \n755.     def test_get_deleted_objects(self):\n756.         mock_request = MockRequest()\n757.         mock_request.user = User.objects.create_superuser(\n758.             username="bob", email="bob@test.com", password="test"\n759.         )\n760.         self.site.register(Band, ModelAdmin)\n761.         ma = self.site._registry[Band]\n762.         (\n763.             deletable_objects,\n764.             model_count,\n765.             perms_needed,\n766.             protected,\n767.         ) = ma.get_deleted_objects([self.band], request)\n768.         self.assertEqual(deletable_objects, ["Band: The Doors"])\n769.         self.assertEqual(model_count, {"bands": 1})\n770.         self.assertEqual(perms_needed, set())\n771.         self.assertEqual(protected, [])\n772. \n773.     def test_get_deleted_objects_with_custom_has_delete_permission(self):\n774.         """\n775.         ModelAdmin.get_deleted_objects() uses ModelAdmin.has_delete_permission()\n776.         for permissions checking.\n777.         """\n778.         mock_request = MockRequest()\n779.         mock_request.user = User.objects.create_superuser(\n780.             username="bob", email="bob@test.com", password="test"\n781.         )\n782. \n783.         class TestModelAdmin(ModelAdmin):\n784.             def has_delete_permission(self, request, obj=None):\n785.                 return False\n786. \n787.         self.site.register(Band, TestModelAdmin)\n788.         ma = self.site._registry[Band]\n789.         (\n790.             deletable_objects,\n791.             model_count,\n792.             perms_needed,\n793.             protected,\n794.         ) = ma.get_deleted_objects([self.band], request)\n795.         self.assertEqual(deletable_objects, ["Band: The Doors"])\n796.         self.assertEqual(model_count, {"bands": 1})\n797.         self.assertEqual(perms_needed, {"band"})\n798.         self.assertEqual(protected, [])\n799. \n800.     def test_modeladmin_repr(self):\n801.         ma = ModelAdmin(Band, self.site)\n802.         self.assertEqual(\n803.             repr(ma),\n804.             "<ModelAdmin: model=Band site=AdminSite(name=\'admin\')>",\n805.         )', start_line_number=1, end_line_number=805), Context(relative_path='tests/admin_widgets/tests.py', content='1. import gettext\n2. import os\n3. import re\n4. from datetime import datetime, timedelta\n5. from importlib import import_module\n6. \n7. try:\n8.     import zoneinfo\n9. except ImportError:\n10.     from backports import zoneinfo\n11. \n12. from django import forms\n13. from django.conf import settings\n14. from django.contrib import admin\n15. from django.contrib.admin import widgets\n16. from django.contrib.admin.tests import AdminSeleniumTestCase\n17. from django.contrib.auth.models import User\n18. from django.core.files.storage import default_storage\n19. from django.core.files.uploadedfile import SimpleUploadedFile\n20. from django.db.models import (\n21.     CharField,\n22.     DateField,\n23.     DateTimeField,\n24.     ManyToManyField,\n25.     UUIDField,\n26. )\n27. from django.test import SimpleTestCase, TestCase, override_settings\n28. from django.urls import reverse\n29. from django.utils import translation\n30. \n31. from .models import (\n32.     Advisor,\n33.     Album,\n34.     Band,\n35.     Bee,\n36.     Car,\n37.     Company,\n38.     Event,\n39.     Honeycomb,\n40.     Individual,\n41.     Inventory,\n42.     Member,\n43.     MyFileField,\n44.     Profile,\n45.     ReleaseEvent,\n46.     School,\n47.     Student,\n48.     UnsafeLimitChoicesTo,\n49.     VideoStream,\n50. )\n51. from .widgetadmin import site as widget_admin_site\n52. \n53. \n54. class TestDataMixin:\n55.     @classmethod\n56.     def setUpTestData(cls):\n57.         cls.superuser = User.objects.create_superuser(\n58.             username="super", password="secret", email=None\n59.         )\n60.         cls.u2 = User.objects.create_user(username="testser", password="secret")\n61.         Car.objects.create(owner=cls.superuser, make="Volkswagen", model="Passat")\n62.         Car.objects.create(owner=cls.u2, make="BMW", model="M3")\n63. \n64. \n65. class AdminFormfieldForDBFieldTests(SimpleTestCase):\n66.     """\n67.     Tests for correct behavior of ModelAdmin.formfield_for_dbfield\n68.     """\n69. \n70.     def assertFormfield(self, model, fieldname, widgetclass, **admin_overrides):\n71.         """\n72.         Helper to call formfield_for_dbfield for a given model and field name\n73.         and verify that the returned formfield is appropriate.\n74.         """\n75.         # Override any settings on the model admin\n76.         class MyModelAdmin(admin.ModelAdmin):\n77.             pass\n78. \n79.         for k in admin_overrides:\n80.             setattr(MyModelAdmin, k, admin_overrides[k])\n81. \n82.         # Construct the admin, and ask it for a formfield\n83.         ma = MyModelAdmin(model, admin.site)\n84.         ff = ma.formfield_for_dbfield(model._meta.get_field(fieldname), request=None)\n85. \n86.         # "unwrap" the widget wrapper, if needed\n87.         if isinstance(ff.widget, widgets.RelatedFieldWidgetWrapper):\n88.             widget = ff.widget.widget\n89.         else:\n90.             widget = ff.widget\n91. \n92.         self.assertIsInstance(widget, widgetclass)\n93. \n94.         # Return the formfield so that other tests can continue\n95.         return ff\n96. \n97.     def test_DateField(self):\n98.         self.assertFormfield(Event, "start_date", widgets.AdminDateWidget)\n99. \n100.     def test_DateTimeField(self):\n101.         self.assertFormfield(Member, "birthdate", widgets.AdminSplitDateTime)\n102. \n103.     def test_TimeField(self):\n104.         self.assertFormfield(Event, "start_time", widgets.AdminTimeWidget)\n105. \n106.     def test_TextField(self):\n107.         self.assertFormfield(Event, "description", widgets.AdminTextareaWidget)\n108. \n109.     def test_URLField(self):\n110.         self.assertFormfield(Event, "link", widgets.AdminURLFieldWidget)\n111. \n112.     def test_IntegerField(self):\n113.         self.assertFormfield(Event, "min_age", widgets.AdminIntegerFieldWidget)\n114. \n115.     def test_CharField(self):\n116.         self.assertFormfield(Member, "name", widgets.AdminTextInputWidget)\n117. \n118.     def test_EmailField(self):\n119.         self.assertFormfield(Member, "email", widgets.AdminEmailInputWidget)\n120. \n121.     def test_FileField(self):\n122.         self.assertFormfield(Album, "cover_art", widgets.AdminFileWidget)\n123. \n124.     def test_ForeignKey(self):\n125.         self.assertFormfield(Event, "main_band", forms.Select)\n126. \n127.     def test_raw_id_ForeignKey(self):\n128.         self.assertFormfield(\n129.             Event,\n130.             "main_band",\n131.             widgets.ForeignKeyRawIdWidget,\n132.             raw_id_fields=["main_band"],\n133.         )\n134. \n135.     def test_radio_fields_ForeignKey(self):\n136.         ff = self.assertFormfield(\n137.             Event,\n138.             "main_band",\n139.             widgets.AdminRadioSelect,\n140.             radio_fields={"main_band": admin.VERTICAL},\n141.         )\n142.         self.assertIsNone(ff.empty_label)\n143. \n144.     def test_many_to_many(self):\n145.         self.assertFormfield(Band, "members", forms.SelectMultiple)\n146. \n147.     def test_raw_id_many_to_many(self):\n148.         self.assertFormfield(\n149.             Band, "members", widgets.ManyToManyRawIdWidget, raw_id_fields=["members"]\n150.         )\n151. \n152.     def test_filtered_many_to_many(self):\n153.         self.assertFormfield(\n154.             Band, "members", widgets.FilteredSelectMultiple, filter_vertical=["members"]\n155.         )\n156. \n157.     def test_formfield_overrides(self):\n158.         self.assertFormfield(\n159.             Event,\n160.             "start_date",\n161.             forms.TextInput,\n162.             formfield_overrides={DateField: {"widget": forms.TextInput}},\n163.         )\n164. \n165.     def test_formfield_overrides_widget_instances(self):\n166.         """\n167.         Widget instances in formfield_overrides are not shared between\n168.         different fields. (#19423)\n169.         """\n170. \n171.         class BandAdmin(admin.ModelAdmin):\n172.             formfield_overrides = {\n173.                 CharField: {"widget": forms.TextInput(attrs={"size": "10"})}\n174.             }\n175. \n176.         ma = BandAdmin(Band, admin.site)\n177.         f1 = ma.formfield_for_dbfield(Band._meta.get_field("name"), request=None)\n178.         f2 = ma.formfield_for_dbfield(Band._meta.get_field("style"), request=None)\n179.         self.assertNotEqual(f1.widget, f2.widget)\n180.         self.assertEqual(f1.widget.attrs["maxlength"], "100")\n181.         self.assertEqual(f2.widget.attrs["maxlength"], "20")\n182.         self.assertEqual(f2.widget.attrs["size"], "10")\n183. \n184.     def test_formfield_overrides_m2m_filter_widget(self):\n185.         """\n186.         The autocomplete_fields, raw_id_fields, filter_vertical, and\n187.         filter_horizontal widgets for ManyToManyFields may be overridden by\n188.         specifying a widget in formfield_overrides.\n189.         """\n190. \n191.         class BandAdmin(admin.ModelAdmin):\n192.             filter_vertical = ["members"]\n193.             formfield_overrides = {\n194.                 ManyToManyField: {"widget": forms.CheckboxSelectMultiple},\n195.             }\n196. \n197.         ma = BandAdmin(Band, admin.site)\n198.         field = ma.formfield_for_dbfield(Band._meta.get_field("members"), request=None)\n199.         self.assertIsInstance(field.widget.widget, forms.CheckboxSelectMultiple)\n200. \n201.     def test_formfield_overrides_for_datetime_field(self):\n202.         """\n203.         Overriding the widget for DateTimeField doesn\'t overrides the default\n204.         form_class for that field (#26449).\n205.         """\n206. \n207.         class MemberAdmin(admin.ModelAdmin):\n208.             formfield_overrides = {\n209.                 DateTimeField: {"widget": widgets.AdminSplitDateTime}\n210.             }\n211. \n212.         ma = MemberAdmin(Member, admin.site)\n213.         f1 = ma.formfield_for_dbfield(Member._meta.get_field("birthdate"), request=None)\n214.         self.assertIsInstance(f1.widget, widgets.AdminSplitDateTime)\n215.         self.assertIsInstance(f1, forms.SplitDateTimeField)\n216. \n217.     def test_formfield_overrides_for_custom_field(self):\n218.         """\n219.         formfield_overrides works for a custom field class.\n220.         """\n221. \n222.         class AlbumAdmin(admin.ModelAdmin):\n223.             formfield_overrides = {MyFileField: {"widget": forms.TextInput()}}\n224. \n225.         ma = AlbumAdmin(Member, admin.site)\n226.         f1 = ma.formfield_for_dbfield(\n227.             Album._meta.get_field("backside_art"), request=None\n228.         )\n229.         self.assertIsInstance(f1.widget, forms.TextInput)\n230. \n231.     def test_field_with_choices(self):\n232.         self.assertFormfield(Member, "gender", forms.Select)\n233. \n234.     def test_choices_with_radio_fields(self):\n235.         self.assertFormfield(\n236.             Member,\n237.             "gender",\n238.             widgets.AdminRadioSelect,\n239.             radio_fields={"gender": admin.VERTICAL},\n240.         )\n241. \n242.     def test_inheritance(self):\n243.         self.assertFormfield(Album, "backside_art", widgets.AdminFileWidget)\n244. \n245.     def test_m2m_widgets(self):\n246.         """m2m fields help text as it applies to admin app (#9321)."""\n247. \n248.         class AdvisorAdmin(admin.ModelAdmin):\n249.             filter_vertical = ["companies"]\n250. \n251.         self.assertFormfield(\n252.             Advisor,\n253.             "companies",\n254.             widgets.FilteredSelectMultiple,\n255.             filter_vertical=["companies"],\n256.         )\n257.         ma = AdvisorAdmin(Advisor, admin.site)\n258.         f = ma.formfield_for_dbfield(Advisor._meta.get_field("companies"), request=None)\n259.         self.assertEqual(\n260.             f.help_text,\n261.             "Hold down “Control”, or “Command” on a Mac, to select more than one.",\n262.         )\n263. \n264. \n265. @override_settings(ROOT_URLCONF="admin_widgets.urls")\n266. class AdminFormfieldForDBFieldWithRequestTests(TestDataMixin, TestCase):\n267.     def test_filter_choices_by_request_user(self):\n268.         """\n269.         Ensure the user can only see their own cars in the foreign key dropdown.\n270.         """\n271.         self.client.force_login(self.superuser)\n272.         response = self.client.get(reverse("admin:admin_widgets_cartire_add"))\n273.         self.assertNotContains(response, "BMW M3")\n274.         self.assertContains(response, "Volkswagen Passat")\n275. \n276. \n277. @override_settings(ROOT_URLCONF="admin_widgets.urls")\n278. class AdminForeignKeyWidgetChangeList(TestDataMixin, TestCase):\n279.     def setUp(self):\n280.         self.client.force_login(self.superuser)\n281. \n282.     def test_changelist_ForeignKey(self):\n283.         response = self.client.get(reverse("admin:admin_widgets_car_changelist"))\n284.         self.assertContains(response, "/auth/user/add/")\n285. \n286. \n287. @override_settings(ROOT_URLCONF="admin_widgets.urls")\n288. class AdminForeignKeyRawIdWidget(TestDataMixin, TestCase):\n289.     def setUp(self):\n290.         self.client.force_login(self.superuser)\n291. \n292.     def test_nonexistent_target_id(self):\n293.         band = Band.objects.create(name="Bogey Blues")\n294.         pk = band.pk\n295.         band.delete()\n296.         post_data = {\n297.             "main_band": str(pk),\n298.         }\n299.         # Try posting with a nonexistent pk in a raw id field: this\n300.         # should result in an error message, not a server exception.\n301.         response = self.client.post(reverse("admin:admin_widgets_event_add"), post_data)\n302.         self.assertContains(\n303.             response,\n304.             "Select a valid choice. That choice is not one of the available choices.",\n305.         )\n306. \n307.     def test_invalid_target_id(self):\n308. \n309.         for test_str in ("Iñtërnâtiônàlizætiøn", "1234\'", -1234):\n310.             # This should result in an error message, not a server exception.\n311.             response = self.client.post(\n312.                 reverse("admin:admin_widgets_event_add"), {"main_band": test_str}\n313.             )\n314. \n315.             self.assertContains(\n316.                 response,\n317.                 "Select a valid choice. That choice is not one of the available "\n318.                 "choices.",\n319.             )\n320. \n321.     def test_url_params_from_lookup_dict_any_iterable(self):\n322.         lookup1 = widgets.url_params_from_lookup_dict({"color__in": ("red", "blue")})\n323.         lookup2 = widgets.url_params_from_lookup_dict({"color__in": ["red", "blue"]})\n324.         self.assertEqual(lookup1, {"color__in": "red,blue"})\n325.         self.assertEqual(lookup1, lookup2)\n326. \n327.     def test_url_params_from_lookup_dict_callable(self):\n328.         def my_callable():\n329.             return "works"\n330. \n331.         lookup1 = widgets.url_params_from_lookup_dict({"myfield": my_callable})\n332.         lookup2 = widgets.url_params_from_lookup_dict({"myfield": my_callable()})\n333.         self.assertEqual(lookup1, lookup2)\n334. \n335.     def test_label_and_url_for_value_invalid_uuid(self):\n336.         field = Bee._meta.get_field("honeycomb")\n337.         self.assertIsInstance(field.target_field, UUIDField)\n338.         widget = widgets.ForeignKeyRawIdWidget(field.remote_field, admin.site)\n339.         self.assertEqual(widget.label_and_url_for_value("invalid-uuid"), ("", ""))\n340. \n341. \n342. class FilteredSelectMultipleWidgetTest(SimpleTestCase):\n343.     def test_render(self):\n344.         # Backslash in verbose_name to ensure it is JavaScript escaped.\n345.         w = widgets.FilteredSelectMultiple("test\\\\", False)\n346.         self.assertHTMLEqual(\n347.             w.render("test", "test"),\n348.             \'<select multiple name="test" class="selectfilter" \'\n349.             \'data-field-name="test\\\\" data-is-stacked="0">\\n</select>\',\n350.         )\n351. \n352.     def test_stacked_render(self):\n353.         # Backslash in verbose_name to ensure it is JavaScript escaped.\n354.         w = widgets.FilteredSelectMultiple("test\\\\", True)\n355.         self.assertHTMLEqual(\n356.             w.render("test", "test"),\n357.             \'<select multiple name="test" class="selectfilterstacked" \'\n358.             \'data-field-name="test\\\\" data-is-stacked="1">\\n</select>\',\n359.         )\n360. \n361. \n362. class AdminDateWidgetTest(SimpleTestCase):\n363.     def test_attrs(self):\n364.         w = widgets.AdminDateWidget()\n365.         self.assertHTMLEqual(\n366.             w.render("test", datetime(2007, 12, 1, 9, 30)),\n367.             \'<input value="2007-12-01" type="text" class="vDateField" name="test" \'\n368.             \'size="10">\',\n369.         )\n370.         # pass attrs to widget\n371.         w = widgets.AdminDateWidget(attrs={"size": 20, "class": "myDateField"})\n372.         self.assertHTMLEqual(\n373.             w.render("test", datetime(2007, 12, 1, 9, 30)),\n374.             \'<input value="2007-12-01" type="text" class="myDateField" name="test" \'\n375.             \'size="20">\',\n376.         )\n377. \n378. \n379. class AdminTimeWidgetTest(SimpleTestCase):\n380.     def test_attrs(self):\n381.         w = widgets.AdminTimeWidget()\n382.         self.assertHTMLEqual(\n383.             w.render("test", datetime(2007, 12, 1, 9, 30)),\n384.             \'<input value="09:30:00" type="text" class="vTimeField" name="test" \'\n385.             \'size="8">\',\n386.         )\n387.         # pass attrs to widget\n388.         w = widgets.AdminTimeWidget(attrs={"size": 20, "class": "myTimeField"})\n389.         self.assertHTMLEqual(\n390.             w.render("test", datetime(2007, 12, 1, 9, 30)),\n391.             \'<input value="09:30:00" type="text" class="myTimeField" name="test" \'\n392.             \'size="20">\',\n393.         )\n394. \n395. \n396. class AdminSplitDateTimeWidgetTest(SimpleTestCase):\n397.     def test_render(self):\n398.         w = widgets.AdminSplitDateTime()\n399.         self.assertHTMLEqual(\n400.             w.render("test", datetime(2007, 12, 1, 9, 30)),\n401.             \'<p class="datetime">\'\n402.             \'Date: <input value="2007-12-01" type="text" class="vDateField" \'\n403.             \'name="test_0" size="10"><br>\'\n404.             \'Time: <input value="09:30:00" type="text" class="vTimeField" \'\n405.             \'name="test_1" size="8"></p>\',\n406.         )\n407. \n408.     def test_localization(self):\n409.         w = widgets.AdminSplitDateTime()\n410. \n411.         with translation.override("de-at"):\n412.             w.is_localized = True\n413.             self.assertHTMLEqual(\n414.                 w.render("test", datetime(2007, 12, 1, 9, 30)),\n415.                 \'<p class="datetime">\'\n416.                 \'Datum: <input value="01.12.2007" type="text" \'\n417.                 \'class="vDateField" name="test_0"size="10"><br>\'\n418.                 \'Zeit: <input value="09:30:00" type="text" class="vTimeField" \'\n419.                 \'name="test_1" size="8"></p>\',\n420.             )\n421. \n422. \n423. class AdminURLWidgetTest(SimpleTestCase):\n424.     def test_get_context_validates_url(self):\n425.         w = widgets.AdminURLFieldWidget()\n426.         for invalid in ["", "/not/a/full/url/", \'javascript:alert("Danger XSS!")\']:\n427.             with self.subTest(url=invalid):\n428.                 self.assertFalse(w.get_context("name", invalid, {})["url_valid"])\n429.         self.assertTrue(w.get_context("name", "http://example.com", {})["url_valid"])\n430. \n431.     def test_render(self):\n432.         w = widgets.AdminURLFieldWidget()\n433.         self.assertHTMLEqual(\n434.             w.render("test", ""), \'<input class="vURLField" name="test" type="url">\'\n435.         )\n436.         self.assertHTMLEqual(\n437.             w.render("test", "http://example.com"),\n438.             \'<p class="url">Currently:<a href="http://example.com">\'\n439.             "http://example.com</a><br>"\n440.             \'Change:<input class="vURLField" name="test" type="url" \'\n441.             \'value="http://example.com"></p>\',\n442.         )\n443. \n444.     def test_render_idn(self):\n445.         w = widgets.AdminURLFieldWidget()\n446.         self.assertHTMLEqual(\n447.             w.render("test", "http://example-äüö.com"),\n448.             \'<p class="url">Currently: <a href="http://xn--example--7za4pnc.com">\'\n449.             "http://example-äüö.com</a><br>"\n450.             \'Change:<input class="vURLField" name="test" type="url" \'\n451.             \'value="http://example-äüö.com"></p>\',\n452.         )\n453. \n454.     def test_render_quoting(self):\n455.         """\n456.         WARNING: This test doesn\'t use assertHTMLEqual since it will get rid\n457.         of some escapes which are tested here!\n458.         """\n459.         HREF_RE = re.compile(\'href="([^"]+)"\')\n460.         VALUE_RE = re.compile(\'value="([^"]+)"\')\n461.         TEXT_RE = re.compile("<a[^>]+>([^>]+)</a>")\n462.         w = widgets.AdminURLFieldWidget()\n463.         output = w.render("test", "http://example.com/<sometag>some-text</sometag>")\n464.         self.assertEqual(\n465.             HREF_RE.search(output)[1],\n466.             "http://example.com/%3Csometag%3Esome-text%3C/sometag%3E",\n467.         )\n468.         self.assertEqual(\n469.             TEXT_RE.search(output)[1],\n470.             "http://example.com/&lt;sometag&gt;some-text&lt;/sometag&gt;",\n471.         )\n472.         self.assertEqual(\n473.             VALUE_RE.search(output)[1],\n474.             "http://example.com/&lt;sometag&gt;some-text&lt;/sometag&gt;",\n475.         )\n476.         output = w.render("test", "http://example-äüö.com/<sometag>some-text</sometag>")\n477.         self.assertEqual(\n478.             HREF_RE.search(output)[1],\n479.             "http://xn--example--7za4pnc.com/%3Csometag%3Esome-text%3C/sometag%3E",\n480.         )\n481.         self.assertEqual(\n482.             TEXT_RE.search(output)[1],\n483.             "http://example-äüö.com/&lt;sometag&gt;some-text&lt;/sometag&gt;",\n484.         )\n485.         self.assertEqual(\n486.             VALUE_RE.search(output)[1],\n487.             "http://example-äüö.com/&lt;sometag&gt;some-text&lt;/sometag&gt;",\n488.         )\n489.         output = w.render(\n490.             "test", \'http://www.example.com/%C3%A4"><script>alert("XSS!")</script>"\'\n491.         )\n492.         self.assertEqual(\n493.             HREF_RE.search(output)[1],\n494.             "http://www.example.com/%C3%A4%22%3E%3Cscript%3Ealert(%22XSS!%22)"\n495.             "%3C/script%3E%22",\n496.         )\n497.         self.assertEqual(\n498.             TEXT_RE.search(output)[1],\n499.             "http://www.example.com/%C3%A4&quot;&gt;&lt;script&gt;"\n500.             "alert(&quot;XSS!&quot;)&lt;/script&gt;&quot;",', start_line_number=1, end_line_number=500), Context(relative_path='tests/admin_widgets/models.py', content='1. import uuid\n2. \n3. from django.contrib.auth.models import User\n4. from django.db import models\n5. \n6. \n7. class MyFileField(models.FileField):\n8.     pass\n9. \n10. \n11. class Member(models.Model):\n12.     name = models.CharField(max_length=100)\n13.     birthdate = models.DateTimeField(blank=True, null=True)\n14.     gender = models.CharField(\n15.         max_length=1, blank=True, choices=[("M", "Male"), ("F", "Female")]\n16.     )\n17.     email = models.EmailField(blank=True)\n18. \n19.     def __str__(self):\n20.         return self.name\n21. \n22. \n23. class Artist(models.Model):\n24.     pass\n25. \n26. \n27. class Band(Artist):\n28.     uuid = models.UUIDField(unique=True, default=uuid.uuid4)\n29.     name = models.CharField(max_length=100)\n30.     style = models.CharField(max_length=20)\n31.     members = models.ManyToManyField(Member)\n32. \n33.     def __str__(self):\n34.         return self.name\n35. \n36. \n37. class UnsafeLimitChoicesTo(models.Model):\n38.     band = models.ForeignKey(\n39.         Band,\n40.         models.CASCADE,\n41.         limit_choices_to={"name": \'"&><escapeme\'},\n42.     )\n43. \n44. \n45. class Album(models.Model):\n46.     band = models.ForeignKey(Band, models.CASCADE, to_field="uuid")\n47.     featuring = models.ManyToManyField(Band, related_name="featured")\n48.     name = models.CharField(max_length=100)\n49.     cover_art = models.FileField(upload_to="albums")\n50.     backside_art = MyFileField(upload_to="albums_back", null=True)\n51. \n52.     def __str__(self):\n53.         return self.name\n54. \n55. \n56. class ReleaseEvent(models.Model):\n57.     """\n58.     Used to check that autocomplete widget correctly resolves attname for FK as\n59.     PK example.\n60.     """\n61. \n62.     album = models.ForeignKey(Album, models.CASCADE, primary_key=True)\n63.     name = models.CharField(max_length=100)\n64. \n65.     class Meta:\n66.         ordering = ["name"]\n67. \n68.     def __str__(self):\n69.         return self.name\n70. \n71. \n72. class VideoStream(models.Model):\n73.     release_event = models.ForeignKey(ReleaseEvent, models.CASCADE)\n74. \n75. \n76. class HiddenInventoryManager(models.Manager):\n77.     def get_queryset(self):\n78.         return super().get_queryset().filter(hidden=False)\n79. \n80. \n81. class Inventory(models.Model):\n82.     barcode = models.PositiveIntegerField(unique=True)\n83.     parent = models.ForeignKey(\n84.         "self", models.SET_NULL, to_field="barcode", blank=True, null=True\n85.     )\n86.     name = models.CharField(blank=False, max_length=20)\n87.     hidden = models.BooleanField(default=False)\n88. \n89.     # see #9258\n90.     default_manager = models.Manager()\n91.     objects = HiddenInventoryManager()\n92. \n93.     def __str__(self):\n94.         return self.name\n95. \n96. \n97. class Event(models.Model):\n98.     main_band = models.ForeignKey(\n99.         Band,\n100.         models.CASCADE,\n101.         limit_choices_to=models.Q(pk__gt=0),\n102.         related_name="events_main_band_at",\n103.     )\n104.     supporting_bands = models.ManyToManyField(\n105.         Band,\n106.         blank=True,\n107.         related_name="events_supporting_band_at",\n108.         help_text="Supporting Bands.",\n109.     )\n110.     start_date = models.DateField(blank=True, null=True)\n111.     start_time = models.TimeField(blank=True, null=True)\n112.     description = models.TextField(blank=True)\n113.     link = models.URLField(blank=True)\n114.     min_age = models.IntegerField(blank=True, null=True)\n115. \n116. \n117. class Car(models.Model):\n118.     owner = models.ForeignKey(User, models.CASCADE)\n119.     make = models.CharField(max_length=30)\n120.     model = models.CharField(max_length=30)\n121. \n122.     def __str__(self):\n123.         return "%s %s" % (self.make, self.model)\n124. \n125. \n126. class CarTire(models.Model):\n127.     """\n128.     A single car tire. This to test that a user can only select their own cars.\n129.     """\n130. \n131.     car = models.ForeignKey(Car, models.CASCADE)\n132. \n133. \n134. class Honeycomb(models.Model):\n135.     id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)\n136.     location = models.CharField(max_length=20)\n137. \n138. \n139. class Bee(models.Model):\n140.     """\n141.     A model with a FK to a model that won\'t be registered with the admin\n142.     (Honeycomb) so the corresponding raw ID widget won\'t have a magnifying\n143.     glass link to select related honeycomb instances.\n144.     """\n145. \n146.     honeycomb = models.ForeignKey(Honeycomb, models.CASCADE)\n147. \n148. \n149. class Individual(models.Model):\n150.     """\n151.     A model with a FK to itself. It won\'t be registered with the admin, so the\n152.     corresponding raw ID widget won\'t have a magnifying glass link to select\n153.     related instances (rendering will be called programmatically in this case).\n154.     """\n155. \n156.     name = models.CharField(max_length=20)\n157.     parent = models.ForeignKey("self", models.SET_NULL, null=True)\n158.     soulmate = models.ForeignKey(\n159.         "self", models.CASCADE, null=True, related_name="soulmates"\n160.     )\n161. \n162. \n163. class Company(models.Model):\n164.     name = models.CharField(max_length=20)\n165. \n166. \n167. class Advisor(models.Model):\n168.     """\n169.     A model with a m2m to a model that won\'t be registered with the admin\n170.     (Company) so the corresponding raw ID widget won\'t have a magnifying\n171.     glass link to select related company instances.\n172.     """\n173. \n174.     name = models.CharField(max_length=20)\n175.     companies = models.ManyToManyField(Company)\n176. \n177. \n178. class Student(models.Model):\n179.     name = models.CharField(max_length=255)\n180. \n181.     class Meta:\n182.         ordering = ("name",)\n183. \n184.     def __str__(self):\n185.         return self.name\n186. \n187. \n188. class School(models.Model):\n189.     name = models.CharField(max_length=255)\n190.     students = models.ManyToManyField(Student, related_name="current_schools")\n191.     alumni = models.ManyToManyField(Student, related_name="previous_schools")\n192. \n193.     def __str__(self):\n194.         return self.name\n195. \n196. \n197. class Profile(models.Model):\n198.     user = models.ForeignKey("auth.User", models.CASCADE, to_field="username")\n199. \n200.     def __str__(self):\n201.         return self.user.username', start_line_number=1, end_line_number=201), Context(relative_path='tests/admin_ordering/tests.py', content='1. from django.contrib import admin\n2. from django.contrib.admin.options import ModelAdmin\n3. from django.contrib.auth.models import User\n4. from django.db.models import F\n5. from django.test import RequestFactory, TestCase\n6. \n7. from .models import (\n8.     Band,\n9.     DynOrderingBandAdmin,\n10.     Song,\n11.     SongInlineDefaultOrdering,\n12.     SongInlineNewOrdering,\n13. )\n14. \n15. \n16. class MockRequest:\n17.     pass\n18. \n19. \n20. class MockSuperUser:\n21.     def has_perm(self, perm, obj=None):\n22.         return True\n23. \n24.     def has_module_perms(self, module):\n25.         return True\n26. \n27. \n28. request = MockRequest()\n29. request.user = MockSuperUser()\n30. \n31. site = admin.AdminSite()\n32. \n33. \n34. class TestAdminOrdering(TestCase):\n35.     """\n36.     Let\'s make sure that ModelAdmin.get_queryset uses the ordering we define\n37.     in ModelAdmin rather that ordering defined in the model\'s inner Meta\n38.     class.\n39.     """\n40. \n41.     request_factory = RequestFactory()\n42. \n43.     @classmethod\n44.     def setUpTestData(cls):\n45.         Band.objects.bulk_create(\n46.             [\n47.                 Band(name="Aerosmith", bio="", rank=3),\n48.                 Band(name="Radiohead", bio="", rank=1),\n49.                 Band(name="Van Halen", bio="", rank=2),\n50.             ]\n51.         )\n52. \n53.     def test_default_ordering(self):\n54.         """\n55.         The default ordering should be by name, as specified in the inner Meta\n56.         class.\n57.         """\n58.         ma = ModelAdmin(Band, site)\n59.         names = [b.name for b in ma.get_queryset(request)]\n60.         self.assertEqual(["Aerosmith", "Radiohead", "Van Halen"], names)\n61. \n62.     def test_specified_ordering(self):\n63.         """\n64.         Let\'s use a custom ModelAdmin that changes the ordering, and make sure\n65.         it actually changes.\n66.         """\n67. \n68.         class BandAdmin(ModelAdmin):\n69.             ordering = ("rank",)  # default ordering is (\'name\',)\n70. \n71.         ma = BandAdmin(Band, site)\n72.         names = [b.name for b in ma.get_queryset(request)]\n73.         self.assertEqual(["Radiohead", "Van Halen", "Aerosmith"], names)\n74. \n75.     def test_specified_ordering_by_f_expression(self):\n76.         class BandAdmin(ModelAdmin):\n77.             ordering = (F("rank").desc(nulls_last=True),)\n78. \n79.         band_admin = BandAdmin(Band, site)\n80.         names = [b.name for b in band_admin.get_queryset(request)]\n81.         self.assertEqual(["Aerosmith", "Van Halen", "Radiohead"], names)\n82. \n83.     def test_dynamic_ordering(self):\n84.         """\n85.         Let\'s use a custom ModelAdmin that changes the ordering dynamically.\n86.         """\n87.         super_user = User.objects.create(username="admin", is_superuser=True)\n88.         other_user = User.objects.create(username="other")\n89.         request = self.request_factory.get("/")\n90.         request.user = super_user\n91.         ma = DynOrderingBandAdmin(Band, site)\n92.         names = [b.name for b in ma.get_queryset(request)]\n93.         self.assertEqual(["Radiohead", "Van Halen", "Aerosmith"], names)\n94.         request.user = other_user\n95.         names = [b.name for b in ma.get_queryset(request)]\n96.         self.assertEqual(["Aerosmith", "Radiohead", "Van Halen"], names)\n97. \n98. \n99. class TestInlineModelAdminOrdering(TestCase):\n100.     """\n101.     Let\'s make sure that InlineModelAdmin.get_queryset uses the ordering we\n102.     define in InlineModelAdmin.\n103.     """\n104. \n105.     @classmethod\n106.     def setUpTestData(cls):\n107.         cls.band = Band.objects.create(name="Aerosmith", bio="", rank=3)\n108.         Song.objects.bulk_create(\n109.             [\n110.                 Song(band=cls.band, name="Pink", duration=235),\n111.                 Song(band=cls.band, name="Dude (Looks Like a Lady)", duration=264),\n112.                 Song(band=cls.band, name="Jaded", duration=214),\n113.             ]\n114.         )\n115. \n116.     def test_default_ordering(self):\n117.         """\n118.         The default ordering should be by name, as specified in the inner Meta\n119.         class.\n120.         """\n121.         inline = SongInlineDefaultOrdering(self.band, site)\n122.         names = [s.name for s in inline.get_queryset(request)]\n123.         self.assertEqual(["Dude (Looks Like a Lady)", "Jaded", "Pink"], names)\n124. \n125.     def test_specified_ordering(self):\n126.         """\n127.         Let\'s check with ordering set to something different than the default.\n128.         """\n129.         inline = SongInlineNewOrdering(self.band, site)\n130.         names = [s.name for s in inline.get_queryset(request)]\n131.         self.assertEqual(["Jaded", "Pink", "Dude (Looks Like a Lady)"], names)\n132. \n133. \n134. class TestRelatedFieldsAdminOrdering(TestCase):\n135.     @classmethod\n136.     def setUpTestData(cls):\n137.         cls.b1 = Band.objects.create(name="Pink Floyd", bio="", rank=1)\n138.         cls.b2 = Band.objects.create(name="Foo Fighters", bio="", rank=5)\n139. \n140.     def setUp(self):\n141.         # we need to register a custom ModelAdmin (instead of just using\n142.         # ModelAdmin) because the field creator tries to find the ModelAdmin\n143.         # for the related model\n144.         class SongAdmin(admin.ModelAdmin):\n145.             pass\n146. \n147.         site.register(Song, SongAdmin)\n148. \n149.     def tearDown(self):\n150.         site.unregister(Song)\n151.         if Band in site._registry:\n152.             site.unregister(Band)\n153. \n154.     def check_ordering_of_field_choices(self, correct_ordering):\n155.         fk_field = site._registry[Song].formfield_for_foreignkey(\n156.             Song.band.field, request=None\n157.         )\n158.         m2m_field = site._registry[Song].formfield_for_manytomany(\n159.             Song.other_interpreters.field, request=None\n160.         )\n161.         self.assertEqual(list(fk_field.queryset), correct_ordering)\n162.         self.assertEqual(list(m2m_field.queryset), correct_ordering)\n163. \n164.     def test_no_admin_fallback_to_model_ordering(self):\n165.         # should be ordered by name (as defined by the model)\n166.         self.check_ordering_of_field_choices([self.b2, self.b1])\n167. \n168.     def test_admin_with_no_ordering_fallback_to_model_ordering(self):\n169.         class NoOrderingBandAdmin(admin.ModelAdmin):\n170.             pass\n171. \n172.         site.register(Band, NoOrderingBandAdmin)\n173. \n174.         # should be ordered by name (as defined by the model)\n175.         self.check_ordering_of_field_choices([self.b2, self.b1])\n176. \n177.     def test_admin_ordering_beats_model_ordering(self):\n178.         class StaticOrderingBandAdmin(admin.ModelAdmin):\n179.             ordering = ("rank",)\n180. \n181.         site.register(Band, StaticOrderingBandAdmin)\n182. \n183.         # should be ordered by rank (defined by the ModelAdmin)\n184.         self.check_ordering_of_field_choices([self.b1, self.b2])\n185. \n186.     def test_custom_queryset_still_wins(self):\n187.         """Custom queryset has still precedence (#21405)"""\n188. \n189.         class SongAdmin(admin.ModelAdmin):\n190.             # Exclude one of the two Bands from the querysets\n191.             def formfield_for_foreignkey(self, db_field, request, **kwargs):\n192.                 if db_field.name == "band":\n193.                     kwargs["queryset"] = Band.objects.filter(rank__gt=2)\n194.                 return super().formfield_for_foreignkey(db_field, request, **kwargs)\n195. \n196.             def formfield_for_manytomany(self, db_field, request, **kwargs):\n197.                 if db_field.name == "other_interpreters":\n198.                     kwargs["queryset"] = Band.objects.filter(rank__gt=2)\n199.                 return super().formfield_for_foreignkey(db_field, request, **kwargs)\n200. \n201.         class StaticOrderingBandAdmin(admin.ModelAdmin):\n202.             ordering = ("rank",)\n203. \n204.         site.unregister(Song)\n205.         site.register(Song, SongAdmin)\n206.         site.register(Band, StaticOrderingBandAdmin)\n207. \n208.         self.check_ordering_of_field_choices([self.b2])', start_line_number=1, end_line_number=208), Context(relative_path='tests/admin_ordering/models.py', content='1. from django.contrib import admin\n2. from django.db import models\n3. \n4. \n5. class Band(models.Model):\n6.     name = models.CharField(max_length=100)\n7.     bio = models.TextField()\n8.     rank = models.IntegerField()\n9. \n10.     class Meta:\n11.         ordering = ("name",)\n12. \n13. \n14. class Song(models.Model):\n15.     band = models.ForeignKey(Band, models.CASCADE)\n16.     name = models.CharField(max_length=100)\n17.     duration = models.IntegerField()\n18.     other_interpreters = models.ManyToManyField(Band, related_name="covers")\n19. \n20.     class Meta:\n21.         ordering = ("name",)\n22. \n23. \n24. class SongInlineDefaultOrdering(admin.StackedInline):\n25.     model = Song\n26. \n27. \n28. class SongInlineNewOrdering(admin.StackedInline):\n29.     model = Song\n30.     ordering = ("duration",)\n31. \n32. \n33. class DynOrderingBandAdmin(admin.ModelAdmin):\n34.     def get_ordering(self, request):\n35.         if request.user.is_superuser:\n36.             return ["rank"]\n37.         else:\n38.             return ["name"]', start_line_number=1, end_line_number=38)]
2025-10-06 20:02:30,712 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_write_message_node - DEBUG - Sending message to BugReproducingWriteNode:
content='Issue title:\nModelAdmin with defined radio_fields override empty_label\n\nIssue description: \nDescription\n\t\nModelAdmin drops my "empty_label" and set "default_empty_label". For example:\nclass MyModelAdmin(ModelAdmin):\n\tradio_fields = \'myfield\',\n\tdef formfield_for_foreignkey(self, db_field, *args, **kwargs):\n\t\tif db_field.name == \'myfield\':\n\t\t\tkwargs[\'empty_label\'] = "I WANT TO SET MY OWN EMPTY LABEL"\n\t\treturn super().formfield_for_foreignkey(db_field, *args, **kwargs)\nYou get never the "I WANT TO SET MY OWN EMPTY LABEL"\nHow to fix it:\nIn django\\contrib\\admin\\options.py, row 234:\nkwargs[\'empty_label\'] = _(\'None\') if db_field.blank else None\nShould be changed on:\nkwargs[\'empty_label\'] = (kwargs.get(\'empty_label\') or _(\'None\')) if db_field.blank else None\n\nIssue comments:\n\n\nBug reproducing context:\nFile: tests/admin_views/tests.py\nLine number range: 2911 - 2939\nContent:\n2911.     def test_conditionally_show_delete_section_link(self):\n2912.         """\n2913.         The foreign key widget should only show the "delete related" button if\n2914.         the user has permission to delete that related item.\n2915.         """\n2916. \n2917.         def get_delete_related(response):\n2918.             return (\n2919.                 response.context["adminform"]\n2920.                 .form.fields["sub_section"]\n2921.                 .widget.can_delete_related\n2922.             )\n2923. \n2924.         self.client.force_login(self.adduser)\n2925.         # The user can\'t delete sections yet, so they shouldn\'t see the\n2926.         # "delete section" link.\n2927.         url = reverse("admin:admin_views_article_add")\n2928.         delete_link_text = "delete_id_sub_section"\n2929.         response = self.client.get(url)\n2930.         self.assertFalse(get_delete_related(response))\n2931.         self.assertNotContains(response, delete_link_text)\n2932.         # Allow the user to delete sections too. Now they can see the\n2933.         # "delete section" link.\n2934.         user = User.objects.get(username="adduser")\n2935.         perm = get_perm(Section, get_permission_codename("delete", Section._meta))\n2936.         user.user_permissions.add(perm)\n2937.         response = self.client.get(url)\n2938.         self.assertTrue(get_delete_related(response))\n2939.         self.assertContains(response, delete_link_text)\n\n\nFile: tests/forms_tests/field_tests/test_choicefield.py\nLine number range: 22 - 30\nContent:\n22.     def test_choicefield_2(self):\n23.         f = ChoiceField(choices=[("1", "One"), ("2", "Two")], required=False)\n24.         self.assertEqual("", f.clean(""))\n25.         self.assertEqual("", f.clean(None))\n26.         self.assertEqual("1", f.clean(1))\n27.         self.assertEqual("1", f.clean("1"))\n28.         msg = "\'Select a valid choice. 3 is not one of the available choices.\'"\n29.         with self.assertRaisesMessage(ValidationError, msg):\n30.             f.clean("3")\n\n\nFile: tests/modeladmin/tests.py\nLine number range: 1 - 805\nContent:\n1. from datetime import date\n2. \n3. from django import forms\n4. from django.contrib.admin.models import ADDITION, CHANGE, DELETION, LogEntry\n5. from django.contrib.admin.options import (\n6.     HORIZONTAL,\n7.     VERTICAL,\n8.     ModelAdmin,\n9.     TabularInline,\n10.     get_content_type_for_model,\n11. )\n12. from django.contrib.admin.sites import AdminSite\n13. from django.contrib.admin.widgets import (\n14.     AdminDateWidget,\n15.     AdminRadioSelect,\n16.     AutocompleteSelect,\n17.     AutocompleteSelectMultiple,\n18. )\n19. from django.contrib.auth.models import User\n20. from django.db import models\n21. from django.forms.widgets import Select\n22. from django.test import SimpleTestCase, TestCase\n23. from django.test.utils import isolate_apps\n24. \n25. from .models import Band, Concert, Song\n26. \n27. \n28. class MockRequest:\n29.     pass\n30. \n31. \n32. class MockSuperUser:\n33.     def has_perm(self, perm, obj=None):\n34.         return True\n35. \n36. \n37. request = MockRequest()\n38. request.user = MockSuperUser()\n39. \n40. \n41. class ModelAdminTests(TestCase):\n42.     @classmethod\n43.     def setUpTestData(cls):\n44.         cls.band = Band.objects.create(\n45.             name="The Doors",\n46.             bio="",\n47.             sign_date=date(1965, 1, 1),\n48.         )\n49. \n50.     def setUp(self):\n51.         self.site = AdminSite()\n52. \n53.     def test_modeladmin_str(self):\n54.         ma = ModelAdmin(Band, self.site)\n55.         self.assertEqual(str(ma), "modeladmin.ModelAdmin")\n56. \n57.     def test_default_attributes(self):\n58.         ma = ModelAdmin(Band, self.site)\n59.         self.assertEqual(ma.actions, ())\n60.         self.assertEqual(ma.inlines, ())\n61. \n62.     # form/fields/fieldsets interaction ##############################\n63. \n64.     def test_default_fields(self):\n65.         ma = ModelAdmin(Band, self.site)\n66.         self.assertEqual(\n67.             list(ma.get_form(request).base_fields), ["name", "bio", "sign_date"]\n68.         )\n69.         self.assertEqual(list(ma.get_fields(request)), ["name", "bio", "sign_date"])\n70.         self.assertEqual(\n71.             list(ma.get_fields(request, self.band)), ["name", "bio", "sign_date"]\n72.         )\n73.         self.assertIsNone(ma.get_exclude(request, self.band))\n74. \n75.     def test_default_fieldsets(self):\n76.         # fieldsets_add and fieldsets_change should return a special data structure that\n77.         # is used in the templates. They should generate the "right thing" whether we\n78.         # have specified a custom form, the fields argument, or nothing at all.\n79.         #\n80.         # Here\'s the default case. There are no custom form_add/form_change methods,\n81.         # no fields argument, and no fieldsets argument.\n82.         ma = ModelAdmin(Band, self.site)\n83.         self.assertEqual(\n84.             ma.get_fieldsets(request),\n85.             [(None, {"fields": ["name", "bio", "sign_date"]})],\n86.         )\n87.         self.assertEqual(\n88.             ma.get_fieldsets(request, self.band),\n89.             [(None, {"fields": ["name", "bio", "sign_date"]})],\n90.         )\n91. \n92.     def test_get_fieldsets(self):\n93.         # get_fieldsets() is called when figuring out form fields (#18681).\n94.         class BandAdmin(ModelAdmin):\n95.             def get_fieldsets(self, request, obj=None):\n96.                 return [(None, {"fields": ["name", "bio"]})]\n97. \n98.         ma = BandAdmin(Band, self.site)\n99.         form = ma.get_form(None)\n100.         self.assertEqual(form._meta.fields, ["name", "bio"])\n101. \n102.         class InlineBandAdmin(TabularInline):\n103.             model = Concert\n104.             fk_name = "main_band"\n105.             can_delete = False\n106. \n107.             def get_fieldsets(self, request, obj=None):\n108.                 return [(None, {"fields": ["day", "transport"]})]\n109. \n110.         ma = InlineBandAdmin(Band, self.site)\n111.         form = ma.get_formset(None).form\n112.         self.assertEqual(form._meta.fields, ["day", "transport"])\n113. \n114.     def test_lookup_allowed_allows_nonexistent_lookup(self):\n115.         """\n116.         A lookup_allowed allows a parameter whose field lookup doesn\'t exist.\n117.         (#21129).\n118.         """\n119. \n120.         class BandAdmin(ModelAdmin):\n121.             fields = ["name"]\n122. \n123.         ma = BandAdmin(Band, self.site)\n124.         self.assertTrue(ma.lookup_allowed("name__nonexistent", "test_value"))\n125. \n126.     @isolate_apps("modeladmin")\n127.     def test_lookup_allowed_onetoone(self):\n128.         class Department(models.Model):\n129.             code = models.CharField(max_length=4, unique=True)\n130. \n131.         class Employee(models.Model):\n132.             department = models.ForeignKey(Department, models.CASCADE, to_field="code")\n133. \n134.         class EmployeeProfile(models.Model):\n135.             employee = models.OneToOneField(Employee, models.CASCADE)\n136. \n137.         class EmployeeInfo(models.Model):\n138.             employee = models.OneToOneField(Employee, models.CASCADE)\n139.             description = models.CharField(max_length=100)\n140. \n141.         class EmployeeProfileAdmin(ModelAdmin):\n142.             list_filter = [\n143.                 "employee__employeeinfo__description",\n144.                 "employee__department__code",\n145.             ]\n146. \n147.         ma = EmployeeProfileAdmin(EmployeeProfile, self.site)\n148.         # Reverse OneToOneField\n149.         self.assertIs(\n150.             ma.lookup_allowed("employee__employeeinfo__description", "test_value"), True\n151.         )\n152.         # OneToOneField and ForeignKey\n153.         self.assertIs(\n154.             ma.lookup_allowed("employee__department__code", "test_value"), True\n155.         )\n156. \n157.     def test_field_arguments(self):\n158.         # If fields is specified, fieldsets_add and fieldsets_change should\n159.         # just stick the fields into a formsets structure and return it.\n160.         class BandAdmin(ModelAdmin):\n161.             fields = ["name"]\n162. \n163.         ma = BandAdmin(Band, self.site)\n164. \n165.         self.assertEqual(list(ma.get_fields(request)), ["name"])\n166.         self.assertEqual(list(ma.get_fields(request, self.band)), ["name"])\n167.         self.assertEqual(ma.get_fieldsets(request), [(None, {"fields": ["name"]})])\n168.         self.assertEqual(\n169.             ma.get_fieldsets(request, self.band), [(None, {"fields": ["name"]})]\n170.         )\n171. \n172.     def test_field_arguments_restricted_on_form(self):\n173.         # If fields or fieldsets is specified, it should exclude fields on the\n174.         # Form class to the fields specified. This may cause errors to be\n175.         # raised in the db layer if required model fields aren\'t in fields/\n176.         # fieldsets, but that\'s preferable to ghost errors where a field in the\n177.         # Form class isn\'t being displayed because it\'s not in fields/fieldsets.\n178. \n179.         # Using `fields`.\n180.         class BandAdmin(ModelAdmin):\n181.             fields = ["name"]\n182. \n183.         ma = BandAdmin(Band, self.site)\n184.         self.assertEqual(list(ma.get_form(request).base_fields), ["name"])\n185.         self.assertEqual(list(ma.get_form(request, self.band).base_fields), ["name"])\n186. \n187.         # Using `fieldsets`.\n188.         class BandAdmin(ModelAdmin):\n189.             fieldsets = [(None, {"fields": ["name"]})]\n190. \n191.         ma = BandAdmin(Band, self.site)\n192.         self.assertEqual(list(ma.get_form(request).base_fields), ["name"])\n193.         self.assertEqual(list(ma.get_form(request, self.band).base_fields), ["name"])\n194. \n195.         # Using `exclude`.\n196.         class BandAdmin(ModelAdmin):\n197.             exclude = ["bio"]\n198. \n199.         ma = BandAdmin(Band, self.site)\n200.         self.assertEqual(list(ma.get_form(request).base_fields), ["name", "sign_date"])\n201. \n202.         # You can also pass a tuple to `exclude`.\n203.         class BandAdmin(ModelAdmin):\n204.             exclude = ("bio",)\n205. \n206.         ma = BandAdmin(Band, self.site)\n207.         self.assertEqual(list(ma.get_form(request).base_fields), ["name", "sign_date"])\n208. \n209.         # Using `fields` and `exclude`.\n210.         class BandAdmin(ModelAdmin):\n211.             fields = ["name", "bio"]\n212.             exclude = ["bio"]\n213. \n214.         ma = BandAdmin(Band, self.site)\n215.         self.assertEqual(list(ma.get_form(request).base_fields), ["name"])\n216. \n217.     def test_custom_form_meta_exclude_with_readonly(self):\n218.         """\n219.         The custom ModelForm\'s `Meta.exclude` is respected when used in\n220.         conjunction with `ModelAdmin.readonly_fields` and when no\n221.         `ModelAdmin.exclude` is defined (#14496).\n222.         """\n223.         # With ModelAdmin\n224.         class AdminBandForm(forms.ModelForm):\n225.             class Meta:\n226.                 model = Band\n227.                 exclude = ["bio"]\n228. \n229.         class BandAdmin(ModelAdmin):\n230.             readonly_fields = ["name"]\n231.             form = AdminBandForm\n232. \n233.         ma = BandAdmin(Band, self.site)\n234.         self.assertEqual(list(ma.get_form(request).base_fields), ["sign_date"])\n235. \n236.         # With InlineModelAdmin\n237.         class AdminConcertForm(forms.ModelForm):\n238.             class Meta:\n239.                 model = Concert\n240.                 exclude = ["day"]\n241. \n242.         class ConcertInline(TabularInline):\n243.             readonly_fields = ["transport"]\n244.             form = AdminConcertForm\n245.             fk_name = "main_band"\n246.             model = Concert\n247. \n248.         class BandAdmin(ModelAdmin):\n249.             inlines = [ConcertInline]\n250. \n251.         ma = BandAdmin(Band, self.site)\n252.         self.assertEqual(\n253.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),\n254.             ["main_band", "opening_band", "id", "DELETE"],\n255.         )\n256. \n257.     def test_custom_formfield_override_readonly(self):\n258.         class AdminBandForm(forms.ModelForm):\n259.             name = forms.CharField()\n260. \n261.             class Meta:\n262.                 exclude = ()\n263.                 model = Band\n264. \n265.         class BandAdmin(ModelAdmin):\n266.             form = AdminBandForm\n267.             readonly_fields = ["name"]\n268. \n269.         ma = BandAdmin(Band, self.site)\n270. \n271.         # `name` shouldn\'t appear in base_fields because it\'s part of\n272.         # readonly_fields.\n273.         self.assertEqual(list(ma.get_form(request).base_fields), ["bio", "sign_date"])\n274.         # But it should appear in get_fields()/fieldsets() so it can be\n275.         # displayed as read-only.\n276.         self.assertEqual(list(ma.get_fields(request)), ["bio", "sign_date", "name"])\n277.         self.assertEqual(\n278.             list(ma.get_fieldsets(request)),\n279.             [(None, {"fields": ["bio", "sign_date", "name"]})],\n280.         )\n281. \n282.     def test_custom_form_meta_exclude(self):\n283.         """\n284.         The custom ModelForm\'s `Meta.exclude` is overridden if\n285.         `ModelAdmin.exclude` or `InlineModelAdmin.exclude` are defined (#14496).\n286.         """\n287.         # With ModelAdmin\n288.         class AdminBandForm(forms.ModelForm):\n289.             class Meta:\n290.                 model = Band\n291.                 exclude = ["bio"]\n292. \n293.         class BandAdmin(ModelAdmin):\n294.             exclude = ["name"]\n295.             form = AdminBandForm\n296. \n297.         ma = BandAdmin(Band, self.site)\n298.         self.assertEqual(list(ma.get_form(request).base_fields), ["bio", "sign_date"])\n299. \n300.         # With InlineModelAdmin\n301.         class AdminConcertForm(forms.ModelForm):\n302.             class Meta:\n303.                 model = Concert\n304.                 exclude = ["day"]\n305. \n306.         class ConcertInline(TabularInline):\n307.             exclude = ["transport"]\n308.             form = AdminConcertForm\n309.             fk_name = "main_band"\n310.             model = Concert\n311. \n312.         class BandAdmin(ModelAdmin):\n313.             inlines = [ConcertInline]\n314. \n315.         ma = BandAdmin(Band, self.site)\n316.         self.assertEqual(\n317.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),\n318.             ["main_band", "opening_band", "day", "id", "DELETE"],\n319.         )\n320. \n321.     def test_overriding_get_exclude(self):\n322.         class BandAdmin(ModelAdmin):\n323.             def get_exclude(self, request, obj=None):\n324.                 return ["name"]\n325. \n326.         self.assertEqual(\n327.             list(BandAdmin(Band, self.site).get_form(request).base_fields),\n328.             ["bio", "sign_date"],\n329.         )\n330. \n331.     def test_get_exclude_overrides_exclude(self):\n332.         class BandAdmin(ModelAdmin):\n333.             exclude = ["bio"]\n334. \n335.             def get_exclude(self, request, obj=None):\n336.                 return ["name"]\n337. \n338.         self.assertEqual(\n339.             list(BandAdmin(Band, self.site).get_form(request).base_fields),\n340.             ["bio", "sign_date"],\n341.         )\n342. \n343.     def test_get_exclude_takes_obj(self):\n344.         class BandAdmin(ModelAdmin):\n345.             def get_exclude(self, request, obj=None):\n346.                 if obj:\n347.                     return ["sign_date"]\n348.                 return ["name"]\n349. \n350.         self.assertEqual(\n351.             list(BandAdmin(Band, self.site).get_form(request, self.band).base_fields),\n352.             ["name", "bio"],\n353.         )\n354. \n355.     def test_custom_form_validation(self):\n356.         # If a form is specified, it should use it allowing custom validation\n357.         # to work properly. This won\'t break any of the admin widgets or media.\n358.         class AdminBandForm(forms.ModelForm):\n359.             delete = forms.BooleanField()\n360. \n361.         class BandAdmin(ModelAdmin):\n362.             form = AdminBandForm\n363. \n364.         ma = BandAdmin(Band, self.site)\n365.         self.assertEqual(\n366.             list(ma.get_form(request).base_fields),\n367.             ["name", "bio", "sign_date", "delete"],\n368.         )\n369.         self.assertEqual(\n370.             type(ma.get_form(request).base_fields["sign_date"].widget), AdminDateWidget\n371.         )\n372. \n373.     def test_form_exclude_kwarg_override(self):\n374.         """\n375.         The `exclude` kwarg passed to `ModelAdmin.get_form()` overrides all\n376.         other declarations (#8999).\n377.         """\n378. \n379.         class AdminBandForm(forms.ModelForm):\n380.             class Meta:\n381.                 model = Band\n382.                 exclude = ["name"]\n383. \n384.         class BandAdmin(ModelAdmin):\n385.             exclude = ["sign_date"]\n386.             form = AdminBandForm\n387. \n388.             def get_form(self, request, obj=None, **kwargs):\n389.                 kwargs["exclude"] = ["bio"]\n390.                 return super().get_form(request, obj, **kwargs)\n391. \n392.         ma = BandAdmin(Band, self.site)\n393.         self.assertEqual(list(ma.get_form(request).base_fields), ["name", "sign_date"])\n394. \n395.     def test_formset_exclude_kwarg_override(self):\n396.         """\n397.         The `exclude` kwarg passed to `InlineModelAdmin.get_formset()`\n398.         overrides all other declarations (#8999).\n399.         """\n400. \n401.         class AdminConcertForm(forms.ModelForm):\n402.             class Meta:\n403.                 model = Concert\n404.                 exclude = ["day"]\n405. \n406.         class ConcertInline(TabularInline):\n407.             exclude = ["transport"]\n408.             form = AdminConcertForm\n409.             fk_name = "main_band"\n410.             model = Concert\n411. \n412.             def get_formset(self, request, obj=None, **kwargs):\n413.                 kwargs["exclude"] = ["opening_band"]\n414.                 return super().get_formset(request, obj, **kwargs)\n415. \n416.         class BandAdmin(ModelAdmin):\n417.             inlines = [ConcertInline]\n418. \n419.         ma = BandAdmin(Band, self.site)\n420.         self.assertEqual(\n421.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),\n422.             ["main_band", "day", "transport", "id", "DELETE"],\n423.         )\n424. \n425.     def test_formset_overriding_get_exclude_with_form_fields(self):\n426.         class AdminConcertForm(forms.ModelForm):\n427.             class Meta:\n428.                 model = Concert\n429.                 fields = ["main_band", "opening_band", "day", "transport"]\n430. \n431.         class ConcertInline(TabularInline):\n432.             form = AdminConcertForm\n433.             fk_name = "main_band"\n434.             model = Concert\n435. \n436.             def get_exclude(self, request, obj=None):\n437.                 return ["opening_band"]\n438. \n439.         class BandAdmin(ModelAdmin):\n440.             inlines = [ConcertInline]\n441. \n442.         ma = BandAdmin(Band, self.site)\n443.         self.assertEqual(\n444.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),\n445.             ["main_band", "day", "transport", "id", "DELETE"],\n446.         )\n447. \n448.     def test_formset_overriding_get_exclude_with_form_exclude(self):\n449.         class AdminConcertForm(forms.ModelForm):\n450.             class Meta:\n451.                 model = Concert\n452.                 exclude = ["day"]\n453. \n454.         class ConcertInline(TabularInline):\n455.             form = AdminConcertForm\n456.             fk_name = "main_band"\n457.             model = Concert\n458. \n459.             def get_exclude(self, request, obj=None):\n460.                 return ["opening_band"]\n461. \n462.         class BandAdmin(ModelAdmin):\n463.             inlines = [ConcertInline]\n464. \n465.         ma = BandAdmin(Band, self.site)\n466.         self.assertEqual(\n467.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),\n468.             ["main_band", "day", "transport", "id", "DELETE"],\n469.         )\n470. \n471.     def test_raw_id_fields_widget_override(self):\n472.         """\n473.         The autocomplete_fields, raw_id_fields, and radio_fields widgets may\n474.         overridden by specifying a widget in get_formset().\n475.         """\n476. \n477.         class ConcertInline(TabularInline):\n478.             model = Concert\n479.             fk_name = "main_band"\n480.             raw_id_fields = ("opening_band",)\n481. \n482.             def get_formset(self, request, obj=None, **kwargs):\n483.                 kwargs["widgets"] = {"opening_band": Select}\n484.                 return super().get_formset(request, obj, **kwargs)\n485. \n486.         class BandAdmin(ModelAdmin):\n487.             inlines = [ConcertInline]\n488. \n489.         ma = BandAdmin(Band, self.site)\n490.         band_widget = (\n491.             list(ma.get_formsets_with_inlines(request))[0][0]()\n492.             .forms[0]\n493.             .fields["opening_band"]\n494.             .widget\n495.         )\n496.         # Without the override this would be ForeignKeyRawIdWidget.\n497.         self.assertIsInstance(band_widget, Select)\n498. \n499.     def test_queryset_override(self):\n500.         # If the queryset of a ModelChoiceField in a custom form is overridden,\n501.         # RelatedFieldWidgetWrapper doesn\'t mess that up.\n502.         band2 = Band.objects.create(\n503.             name="The Beatles", bio="", sign_date=date(1962, 1, 1)\n504.         )\n505. \n506.         ma = ModelAdmin(Concert, self.site)\n507.         form = ma.get_form(request)()\n508. \n509.         self.assertHTMLEqual(\n510.             str(form["main_band"]),\n511.             \'<div class="related-widget-wrapper">\'\n512.             \'<select name="main_band" id="id_main_band" required>\'\n513.             \'<option value="" selected>---------</option>\'\n514.             \'<option value="%d">The Beatles</option>\'\n515.             \'<option value="%d">The Doors</option>\'\n516.             "</select></div>" % (band2.id, self.band.id),\n517.         )\n518. \n519.         class AdminConcertForm(forms.ModelForm):\n520.             def __init__(self, *args, **kwargs):\n521.                 super().__init__(*args, **kwargs)\n522.                 self.fields["main_band"].queryset = Band.objects.filter(\n523.                     name="The Doors"\n524.                 )\n525. \n526.         class ConcertAdminWithForm(ModelAdmin):\n527.             form = AdminConcertForm\n528. \n529.         ma = ConcertAdminWithForm(Concert, self.site)\n530.         form = ma.get_form(request)()\n531. \n532.         self.assertHTMLEqual(\n533.             str(form["main_band"]),\n534.             \'<div class="related-widget-wrapper">\'\n535.             \'<select name="main_band" id="id_main_band" required>\'\n536.             \'<option value="" selected>---------</option>\'\n537.             \'<option value="%d">The Doors</option>\'\n538.             "</select></div>" % self.band.id,\n539.         )\n540. \n541.     def test_regression_for_ticket_15820(self):\n542.         """\n543.         `obj` is passed from `InlineModelAdmin.get_fieldsets()` to\n544.         `InlineModelAdmin.get_formset()`.\n545.         """\n546. \n547.         class CustomConcertForm(forms.ModelForm):\n548.             class Meta:\n549.                 model = Concert\n550.                 fields = ["day"]\n551. \n552.         class ConcertInline(TabularInline):\n553.             model = Concert\n554.             fk_name = "main_band"\n555. \n556.             def get_formset(self, request, obj=None, **kwargs):\n557.                 if obj:\n558.                     kwargs["form"] = CustomConcertForm\n559.                 return super().get_formset(request, obj, **kwargs)\n560. \n561.         class BandAdmin(ModelAdmin):\n562.             inlines = [ConcertInline]\n563. \n564.         Concert.objects.create(main_band=self.band, opening_band=self.band, day=1)\n565.         ma = BandAdmin(Band, self.site)\n566.         inline_instances = ma.get_inline_instances(request)\n567.         fieldsets = list(inline_instances[0].get_fieldsets(request))\n568.         self.assertEqual(\n569.             fieldsets[0][1]["fields"], ["main_band", "opening_band", "day", "transport"]\n570.         )\n571.         fieldsets = list(\n572.             inline_instances[0].get_fieldsets(request, inline_instances[0].model)\n573.         )\n574.         self.assertEqual(fieldsets[0][1]["fields"], ["day"])\n575. \n576.     # radio_fields behavior ###########################################\n577. \n578.     def test_default_foreign_key_widget(self):\n579.         # First, without any radio_fields specified, the widgets for ForeignKey\n580.         # and fields with choices specified ought to be a basic Select widget.\n581.         # ForeignKey widgets in the admin are wrapped with RelatedFieldWidgetWrapper so\n582.         # they need to be handled properly when type checking. For Select fields, all of\n583.         # the choices lists have a first entry of dashes.\n584.         cma = ModelAdmin(Concert, self.site)\n585.         cmafa = cma.get_form(request)\n586. \n587.         self.assertEqual(type(cmafa.base_fields["main_band"].widget.widget), Select)\n588.         self.assertEqual(\n589.             list(cmafa.base_fields["main_band"].widget.choices),\n590.             [("", "---------"), (self.band.id, "The Doors")],\n591.         )\n592. \n593.         self.assertEqual(type(cmafa.base_fields["opening_band"].widget.widget), Select)\n594.         self.assertEqual(\n595.             list(cmafa.base_fields["opening_band"].widget.choices),\n596.             [("", "---------"), (self.band.id, "The Doors")],\n597.         )\n598.         self.assertEqual(type(cmafa.base_fields["day"].widget), Select)\n599.         self.assertEqual(\n600.             list(cmafa.base_fields["day"].widget.choices),\n601.             [("", "---------"), (1, "Fri"), (2, "Sat")],\n602.         )\n603.         self.assertEqual(type(cmafa.base_fields["transport"].widget), Select)\n604.         self.assertEqual(\n605.             list(cmafa.base_fields["transport"].widget.choices),\n606.             [("", "---------"), (1, "Plane"), (2, "Train"), (3, "Bus")],\n607.         )\n608. \n609.     def test_foreign_key_as_radio_field(self):\n610.         # Now specify all the fields as radio_fields.  Widgets should now be\n611.         # RadioSelect, and the choices list should have a first entry of \'None\' if\n612.         # blank=True for the model field.  Finally, the widget should have the\n613.         # \'radiolist\' attr, and \'inline\' as well if the field is specified HORIZONTAL.\n614.         class ConcertAdmin(ModelAdmin):\n615.             radio_fields = {\n616.                 "main_band": HORIZONTAL,\n617.                 "opening_band": VERTICAL,\n618.                 "day": VERTICAL,\n619.                 "transport": HORIZONTAL,\n620.             }\n621. \n622.         cma = ConcertAdmin(Concert, self.site)\n623.         cmafa = cma.get_form(request)\n624. \n625.         self.assertEqual(\n626.             type(cmafa.base_fields["main_band"].widget.widget), AdminRadioSelect\n627.         )\n628.         self.assertEqual(\n629.             cmafa.base_fields["main_band"].widget.attrs, {"class": "radiolist inline"}\n630.         )\n631.         self.assertEqual(\n632.             list(cmafa.base_fields["main_band"].widget.choices),\n633.             [(self.band.id, "The Doors")],\n634.         )\n635. \n636.         self.assertEqual(\n637.             type(cmafa.base_fields["opening_band"].widget.widget), AdminRadioSelect\n638.         )\n639.         self.assertEqual(\n640.             cmafa.base_fields["opening_band"].widget.attrs, {"class": "radiolist"}\n641.         )\n642.         self.assertEqual(\n643.             list(cmafa.base_fields["opening_band"].widget.choices),\n644.             [("", "None"), (self.band.id, "The Doors")],\n645.         )\n646.         self.assertEqual(type(cmafa.base_fields["day"].widget), AdminRadioSelect)\n647.         self.assertEqual(cmafa.base_fields["day"].widget.attrs, {"class": "radiolist"})\n648.         self.assertEqual(\n649.             list(cmafa.base_fields["day"].widget.choices), [(1, "Fri"), (2, "Sat")]\n650.         )\n651. \n652.         self.assertEqual(type(cmafa.base_fields["transport"].widget), AdminRadioSelect)\n653.         self.assertEqual(\n654.             cmafa.base_fields["transport"].widget.attrs, {"class": "radiolist inline"}\n655.         )\n656.         self.assertEqual(\n657.             list(cmafa.base_fields["transport"].widget.choices),\n658.             [("", "None"), (1, "Plane"), (2, "Train"), (3, "Bus")],\n659.         )\n660. \n661.         class AdminConcertForm(forms.ModelForm):\n662.             class Meta:\n663.                 model = Concert\n664.                 exclude = ("transport",)\n665. \n666.         class ConcertAdmin(ModelAdmin):\n667.             form = AdminConcertForm\n668. \n669.         ma = ConcertAdmin(Concert, self.site)\n670.         self.assertEqual(\n671.             list(ma.get_form(request).base_fields), ["main_band", "opening_band", "day"]\n672.         )\n673. \n674.         class AdminConcertForm(forms.ModelForm):\n675.             extra = forms.CharField()\n676. \n677.             class Meta:\n678.                 model = Concert\n679.                 fields = ["extra", "transport"]\n680. \n681.         class ConcertAdmin(ModelAdmin):\n682.             form = AdminConcertForm\n683. \n684.         ma = ConcertAdmin(Concert, self.site)\n685.         self.assertEqual(list(ma.get_form(request).base_fields), ["extra", "transport"])\n686. \n687.         class ConcertInline(TabularInline):\n688.             form = AdminConcertForm\n689.             model = Concert\n690.             fk_name = "main_band"\n691.             can_delete = True\n692. \n693.         class BandAdmin(ModelAdmin):\n694.             inlines = [ConcertInline]\n695. \n696.         ma = BandAdmin(Band, self.site)\n697.         self.assertEqual(\n698.             list(list(ma.get_formsets_with_inlines(request))[0][0]().forms[0].fields),\n699.             ["extra", "transport", "id", "DELETE", "main_band"],\n700.         )\n701. \n702.     def test_log_actions(self):\n703.         ma = ModelAdmin(Band, self.site)\n704.         mock_request = MockRequest()\n705.         mock_request.user = User.objects.create(username="bill")\n706.         content_type = get_content_type_for_model(self.band)\n707.         tests = (\n708.             (ma.log_addition, ADDITION, {"added": {}}),\n709.             (ma.log_change, CHANGE, {"changed": {"fields": ["name", "bio"]}}),\n710.             (ma.log_deletion, DELETION, str(self.band)),\n711.         )\n712.         for method, flag, message in tests:\n713.             with self.subTest(name=method.__name__):\n714.                 created = method(mock_request, self.band, message)\n715.                 fetched = LogEntry.objects.filter(action_flag=flag).latest("id")\n716.                 self.assertEqual(created, fetched)\n717.                 self.assertEqual(fetched.action_flag, flag)\n718.                 self.assertEqual(fetched.content_type, content_type)\n719.                 self.assertEqual(fetched.object_id, str(self.band.pk))\n720.                 self.assertEqual(fetched.user, mock_request.user)\n721.                 if flag == DELETION:\n722.                     self.assertEqual(fetched.change_message, "")\n723.                     self.assertEqual(fetched.object_repr, message)\n724.                 else:\n725.                     self.assertEqual(fetched.change_message, str(message))\n726.                     self.assertEqual(fetched.object_repr, str(self.band))\n727. \n728.     def test_get_autocomplete_fields(self):\n729.         class NameAdmin(ModelAdmin):\n730.             search_fields = ["name"]\n731. \n732.         class SongAdmin(ModelAdmin):\n733.             autocomplete_fields = ["featuring"]\n734.             fields = ["featuring", "band"]\n735. \n736.         class OtherSongAdmin(SongAdmin):\n737.             def get_autocomplete_fields(self, request):\n738.                 return ["band"]\n739. \n740.         self.site.register(Band, NameAdmin)\n741.         try:\n742.             # Uses autocomplete_fields if not overridden.\n743.             model_admin = SongAdmin(Song, self.site)\n744.             form = model_admin.get_form(request)()\n745.             self.assertIsInstance(\n746.                 form.fields["featuring"].widget.widget, AutocompleteSelectMultiple\n747.             )\n748.             # Uses overridden get_autocomplete_fields\n749.             model_admin = OtherSongAdmin(Song, self.site)\n750.             form = model_admin.get_form(request)()\n751.             self.assertIsInstance(form.fields["band"].widget.widget, AutocompleteSelect)\n752.         finally:\n753.             self.site.unregister(Band)\n754. \n755.     def test_get_deleted_objects(self):\n756.         mock_request = MockRequest()\n757.         mock_request.user = User.objects.create_superuser(\n758.             username="bob", email="bob@test.com", password="test"\n759.         )\n760.         self.site.register(Band, ModelAdmin)\n761.         ma = self.site._registry[Band]\n762.         (\n763.             deletable_objects,\n764.             model_count,\n765.             perms_needed,\n766.             protected,\n767.         ) = ma.get_deleted_objects([self.band], request)\n768.         self.assertEqual(deletable_objects, ["Band: The Doors"])\n769.         self.assertEqual(model_count, {"bands": 1})\n770.         self.assertEqual(perms_needed, set())\n771.         self.assertEqual(protected, [])\n772. \n773.     def test_get_deleted_objects_with_custom_has_delete_permission(self):\n774.         """\n775.         ModelAdmin.get_deleted_objects() uses ModelAdmin.has_delete_permission()\n776.         for permissions checking.\n777.         """\n778.         mock_request = MockRequest()\n779.         mock_request.user = User.objects.create_superuser(\n780.             username="bob", email="bob@test.com", password="test"\n781.         )\n782. \n783.         class TestModelAdmin(ModelAdmin):\n784.             def has_delete_permission(self, request, obj=None):\n785.                 return False\n786. \n787.         self.site.register(Band, TestModelAdmin)\n788.         ma = self.site._registry[Band]\n789.         (\n790.             deletable_objects,\n791.             model_count,\n792.             perms_needed,\n793.             protected,\n794.         ) = ma.get_deleted_objects([self.band], request)\n795.         self.assertEqual(deletable_objects, ["Band: The Doors"])\n796.         self.assertEqual(model_count, {"bands": 1})\n797.         self.assertEqual(perms_needed, {"band"})\n798.         self.assertEqual(protected, [])\n799. \n800.     def test_modeladmin_repr(self):\n801.         ma = ModelAdmin(Band, self.site)\n802.         self.assertEqual(\n803.             repr(ma),\n804.             "<ModelAdmin: model=Band site=AdminSite(name=\'admin\')>",\n805.         )\n\n\nFile: tests/admin_widgets/tests.py\nLine number range: 1 - 500\nContent:\n1. import gettext\n2. import os\n3. import re\n4. from datetime import datetime, timedelta\n5. from importlib import import_module\n6. \n7. try:\n8.     import zoneinfo\n9. except ImportError:\n10.     from backports import zoneinfo\n11. \n12. from django import forms\n13. from django.conf import settings\n14. from django.contrib import admin\n15. from django.contrib.admin import widgets\n16. from django.contrib.admin.tests import AdminSeleniumTestCase\n17. from django.contrib.auth.models import User\n18. from django.core.files.storage import default_storage\n19. from django.core.files.uploadedfile import SimpleUploadedFile\n20. from django.db.models import (\n21.     CharField,\n22.     DateField,\n23.     DateTimeField,\n24.     ManyToManyField,\n25.     UUIDField,\n26. )\n27. from django.test import SimpleTestCase, TestCase, override_settings\n28. from django.urls import reverse\n29. from django.utils import translation\n30. \n31. from .models import (\n32.     Advisor,\n33.     Album,\n34.     Band,\n35.     Bee,\n36.     Car,\n37.     Company,\n38.     Event,\n39.     Honeycomb,\n40.     Individual,\n41.     Inventory,\n42.     Member,\n43.     MyFileField,\n44.     Profile,\n45.     ReleaseEvent,\n46.     School,\n47.     Student,\n48.     UnsafeLimitChoicesTo,\n49.     VideoStream,\n50. )\n51. from .widgetadmin import site as widget_admin_site\n52. \n53. \n54. class TestDataMixin:\n55.     @classmethod\n56.     def setUpTestData(cls):\n57.         cls.superuser = User.objects.create_superuser(\n58.             username="super", password="secret", email=None\n59.         )\n60.         cls.u2 = User.objects.create_user(username="testser", password="secret")\n61.         Car.objects.create(owner=cls.superuser, make="Volkswagen", model="Passat")\n62.         Car.objects.create(owner=cls.u2, make="BMW", model="M3")\n63. \n64. \n65. class AdminFormfieldForDBFieldTests(SimpleTestCase):\n66.     """\n67.     Tests for correct behavior of ModelAdmin.formfield_for_dbfield\n68.     """\n69. \n70.     def assertFormfield(self, model, fieldname, widgetclass, **admin_overrides):\n71.         """\n72.         Helper to call formfield_for_dbfield for a given model and field name\n73.         and verify that the returned formfield is appropriate.\n74.         """\n75.         # Override any settings on the model admin\n76.         class MyModelAdmin(admin.ModelAdmin):\n77.             pass\n78. \n79.         for k in admin_overrides:\n80.             setattr(MyModelAdmin, k, admin_overrides[k])\n81. \n82.         # Construct the admin, and ask it for a formfield\n83.         ma = MyModelAdmin(model, admin.site)\n84.         ff = ma.formfield_for_dbfield(model._meta.get_field(fieldname), request=None)\n85. \n86.         # "unwrap" the widget wrapper, if needed\n87.         if isinstance(ff.widget, widgets.RelatedFieldWidgetWrapper):\n88.             widget = ff.widget.widget\n89.         else:\n90.             widget = ff.widget\n91. \n92.         self.assertIsInstance(widget, widgetclass)\n93. \n94.         # Return the formfield so that other tests can continue\n95.         return ff\n96. \n97.     def test_DateField(self):\n98.         self.assertFormfield(Event, "start_date", widgets.AdminDateWidget)\n99. \n100.     def test_DateTimeField(self):\n101.         self.assertFormfield(Member, "birthdate", widgets.AdminSplitDateTime)\n102. \n103.     def test_TimeField(self):\n104.         self.assertFormfield(Event, "start_time", widgets.AdminTimeWidget)\n105. \n106.     def test_TextField(self):\n107.         self.assertFormfield(Event, "description", widgets.AdminTextareaWidget)\n108. \n109.     def test_URLField(self):\n110.         self.assertFormfield(Event, "link", widgets.AdminURLFieldWidget)\n111. \n112.     def test_IntegerField(self):\n113.         self.assertFormfield(Event, "min_age", widgets.AdminIntegerFieldWidget)\n114. \n115.     def test_CharField(self):\n116.         self.assertFormfield(Member, "name", widgets.AdminTextInputWidget)\n117. \n118.     def test_EmailField(self):\n119.         self.assertFormfield(Member, "email", widgets.AdminEmailInputWidget)\n120. \n121.     def test_FileField(self):\n122.         self.assertFormfield(Album, "cover_art", widgets.AdminFileWidget)\n123. \n124.     def test_ForeignKey(self):\n125.         self.assertFormfield(Event, "main_band", forms.Select)\n126. \n127.     def test_raw_id_ForeignKey(self):\n128.         self.assertFormfield(\n129.             Event,\n130.             "main_band",\n131.             widgets.ForeignKeyRawIdWidget,\n132.             raw_id_fields=["main_band"],\n133.         )\n134. \n135.     def test_radio_fields_ForeignKey(self):\n136.         ff = self.assertFormfield(\n137.             Event,\n138.             "main_band",\n139.             widgets.AdminRadioSelect,\n140.             radio_fields={"main_band": admin.VERTICAL},\n141.         )\n142.         self.assertIsNone(ff.empty_label)\n143. \n144.     def test_many_to_many(self):\n145.         self.assertFormfield(Band, "members", forms.SelectMultiple)\n146. \n147.     def test_raw_id_many_to_many(self):\n148.         self.assertFormfield(\n149.             Band, "members", widgets.ManyToManyRawIdWidget, raw_id_fields=["members"]\n150.         )\n151. \n152.     def test_filtered_many_to_many(self):\n153.         self.assertFormfield(\n154.             Band, "members", widgets.FilteredSelectMultiple, filter_vertical=["members"]\n155.         )\n156. \n157.     def test_formfield_overrides(self):\n158.         self.assertFormfield(\n159.             Event,\n160.             "start_date",\n161.             forms.TextInput,\n162.             formfield_overrides={DateField: {"widget": forms.TextInput}},\n163.         )\n164. \n165.     def test_formfield_overrides_widget_instances(self):\n166.         """\n167.         Widget instances in formfield_overrides are not shared between\n168.         different fields. (#19423)\n169.         """\n170. \n171.         class BandAdmin(admin.ModelAdmin):\n172.             formfield_overrides = {\n173.                 CharField: {"widget": forms.TextInput(attrs={"size": "10"})}\n174.             }\n175. \n176.         ma = BandAdmin(Band, admin.site)\n177.         f1 = ma.formfield_for_dbfield(Band._meta.get_field("name"), request=None)\n178.         f2 = ma.formfield_for_dbfield(Band._meta.get_field("style"), request=None)\n179.         self.assertNotEqual(f1.widget, f2.widget)\n180.         self.assertEqual(f1.widget.attrs["maxlength"], "100")\n181.         self.assertEqual(f2.widget.attrs["maxlength"], "20")\n182.         self.assertEqual(f2.widget.attrs["size"], "10")\n183. \n184.     def test_formfield_overrides_m2m_filter_widget(self):\n185.         """\n186.         The autocomplete_fields, raw_id_fields, filter_vertical, and\n187.         filter_horizontal widgets for ManyToManyFields may be overridden by\n188.         specifying a widget in formfield_overrides.\n189.         """\n190. \n191.         class BandAdmin(admin.ModelAdmin):\n192.             filter_vertical = ["members"]\n193.             formfield_overrides = {\n194.                 ManyToManyField: {"widget": forms.CheckboxSelectMultiple},\n195.             }\n196. \n197.         ma = BandAdmin(Band, admin.site)\n198.         field = ma.formfield_for_dbfield(Band._meta.get_field("members"), request=None)\n199.         self.assertIsInstance(field.widget.widget, forms.CheckboxSelectMultiple)\n200. \n201.     def test_formfield_overrides_for_datetime_field(self):\n202.         """\n203.         Overriding the widget for DateTimeField doesn\'t overrides the default\n204.         form_class for that field (#26449).\n205.         """\n206. \n207.         class MemberAdmin(admin.ModelAdmin):\n208.             formfield_overrides = {\n209.                 DateTimeField: {"widget": widgets.AdminSplitDateTime}\n210.             }\n211. \n212.         ma = MemberAdmin(Member, admin.site)\n213.         f1 = ma.formfield_for_dbfield(Member._meta.get_field("birthdate"), request=None)\n214.         self.assertIsInstance(f1.widget, widgets.AdminSplitDateTime)\n215.         self.assertIsInstance(f1, forms.SplitDateTimeField)\n216. \n217.     def test_formfield_overrides_for_custom_field(self):\n218.         """\n219.         formfield_overrides works for a custom field class.\n220.         """\n221. \n222.         class AlbumAdmin(admin.ModelAdmin):\n223.             formfield_overrides = {MyFileField: {"widget": forms.TextInput()}}\n224. \n225.         ma = AlbumAdmin(Member, admin.site)\n226.         f1 = ma.formfield_for_dbfield(\n227.             Album._meta.get_field("backside_art"), request=None\n228.         )\n229.         self.assertIsInstance(f1.widget, forms.TextInput)\n230. \n231.     def test_field_with_choices(self):\n232.         self.assertFormfield(Member, "gender", forms.Select)\n233. \n234.     def test_choices_with_radio_fields(self):\n235.         self.assertFormfield(\n236.             Member,\n237.             "gender",\n238.             widgets.AdminRadioSelect,\n239.             radio_fields={"gender": admin.VERTICAL},\n240.         )\n241. \n242.     def test_inheritance(self):\n243.         self.assertFormfield(Album, "backside_art", widgets.AdminFileWidget)\n244. \n245.     def test_m2m_widgets(self):\n246.         """m2m fields help text as it applies to admin app (#9321)."""\n247. \n248.         class AdvisorAdmin(admin.ModelAdmin):\n249.             filter_vertical = ["companies"]\n250. \n251.         self.assertFormfield(\n252.             Advisor,\n253.             "companies",\n254.             widgets.FilteredSelectMultiple,\n255.             filter_vertical=["companies"],\n256.         )\n257.         ma = AdvisorAdmin(Advisor, admin.site)\n258.         f = ma.formfield_for_dbfield(Advisor._meta.get_field("companies"), request=None)\n259.         self.assertEqual(\n260.             f.help_text,\n261.             "Hold down “Control”, or “Command” on a Mac, to select more than one.",\n262.         )\n263. \n264. \n265. @override_settings(ROOT_URLCONF="admin_widgets.urls")\n266. class AdminFormfieldForDBFieldWithRequestTests(TestDataMixin, TestCase):\n267.     def test_filter_choices_by_request_user(self):\n268.         """\n269.         Ensure the user can only see their own cars in the foreign key dropdown.\n270.         """\n271.         self.client.force_login(self.superuser)\n272.         response = self.client.get(reverse("admin:admin_widgets_cartire_add"))\n273.         self.assertNotContains(response, "BMW M3")\n274.         self.assertContains(response, "Volkswagen Passat")\n275. \n276. \n277. @override_settings(ROOT_URLCONF="admin_widgets.urls")\n278. class AdminForeignKeyWidgetChangeList(TestDataMixin, TestCase):\n279.     def setUp(self):\n280.         self.client.force_login(self.superuser)\n281. \n282.     def test_changelist_ForeignKey(self):\n283.         response = self.client.get(reverse("admin:admin_widgets_car_changelist"))\n284.         self.assertContains(response, "/auth/user/add/")\n285. \n286. \n287. @override_settings(ROOT_URLCONF="admin_widgets.urls")\n288. class AdminForeignKeyRawIdWidget(TestDataMixin, TestCase):\n289.     def setUp(self):\n290.         self.client.force_login(self.superuser)\n291. \n292.     def test_nonexistent_target_id(self):\n293.         band = Band.objects.create(name="Bogey Blues")\n294.         pk = band.pk\n295.         band.delete()\n296.         post_data = {\n297.             "main_band": str(pk),\n298.         }\n299.         # Try posting with a nonexistent pk in a raw id field: this\n300.         # should result in an error message, not a server exception.\n301.         response = self.client.post(reverse("admin:admin_widgets_event_add"), post_data)\n302.         self.assertContains(\n303.             response,\n304.             "Select a valid choice. That choice is not one of the available choices.",\n305.         )\n306. \n307.     def test_invalid_target_id(self):\n308. \n309.         for test_str in ("Iñtërnâtiônàlizætiøn", "1234\'", -1234):\n310.             # This should result in an error message, not a server exception.\n311.             response = self.client.post(\n312.                 reverse("admin:admin_widgets_event_add"), {"main_band": test_str}\n313.             )\n314. \n315.             self.assertContains(\n316.                 response,\n317.                 "Select a valid choice. That choice is not one of the available "\n318.                 "choices.",\n319.             )\n320. \n321.     def test_url_params_from_lookup_dict_any_iterable(self):\n322.         lookup1 = widgets.url_params_from_lookup_dict({"color__in": ("red", "blue")})\n323.         lookup2 = widgets.url_params_from_lookup_dict({"color__in": ["red", "blue"]})\n324.         self.assertEqual(lookup1, {"color__in": "red,blue"})\n325.         self.assertEqual(lookup1, lookup2)\n326. \n327.     def test_url_params_from_lookup_dict_callable(self):\n328.         def my_callable():\n329.             return "works"\n330. \n331.         lookup1 = widgets.url_params_from_lookup_dict({"myfield": my_callable})\n332.         lookup2 = widgets.url_params_from_lookup_dict({"myfield": my_callable()})\n333.         self.assertEqual(lookup1, lookup2)\n334. \n335.     def test_label_and_url_for_value_invalid_uuid(self):\n336.         field = Bee._meta.get_field("honeycomb")\n337.         self.assertIsInstance(field.target_field, UUIDField)\n338.         widget = widgets.ForeignKeyRawIdWidget(field.remote_field, admin.site)\n339.         self.assertEqual(widget.label_and_url_for_value("invalid-uuid"), ("", ""))\n340. \n341. \n342. class FilteredSelectMultipleWidgetTest(SimpleTestCase):\n343.     def test_render(self):\n344.         # Backslash in verbose_name to ensure it is JavaScript escaped.\n345.         w = widgets.FilteredSelectMultiple("test\\\\", False)\n346.         self.assertHTMLEqual(\n347.             w.render("test", "test"),\n348.             \'<select multiple name="test" class="selectfilter" \'\n349.             \'data-field-name="test\\\\" data-is-stacked="0">\\n</select>\',\n350.         )\n351. \n352.     def test_stacked_render(self):\n353.         # Backslash in verbose_name to ensure it is JavaScript escaped.\n354.         w = widgets.FilteredSelectMultiple("test\\\\", True)\n355.         self.assertHTMLEqual(\n356.             w.render("test", "test"),\n357.             \'<select multiple name="test" class="selectfilterstacked" \'\n358.             \'data-field-name="test\\\\" data-is-stacked="1">\\n</select>\',\n359.         )\n360. \n361. \n362. class AdminDateWidgetTest(SimpleTestCase):\n363.     def test_attrs(self):\n364.         w = widgets.AdminDateWidget()\n365.         self.assertHTMLEqual(\n366.             w.render("test", datetime(2007, 12, 1, 9, 30)),\n367.             \'<input value="2007-12-01" type="text" class="vDateField" name="test" \'\n368.             \'size="10">\',\n369.         )\n370.         # pass attrs to widget\n371.         w = widgets.AdminDateWidget(attrs={"size": 20, "class": "myDateField"})\n372.         self.assertHTMLEqual(\n373.             w.render("test", datetime(2007, 12, 1, 9, 30)),\n374.             \'<input value="2007-12-01" type="text" class="myDateField" name="test" \'\n375.             \'size="20">\',\n376.         )\n377. \n378. \n379. class AdminTimeWidgetTest(SimpleTestCase):\n380.     def test_attrs(self):\n381.         w = widgets.AdminTimeWidget()\n382.         self.assertHTMLEqual(\n383.             w.render("test", datetime(2007, 12, 1, 9, 30)),\n384.             \'<input value="09:30:00" type="text" class="vTimeField" name="test" \'\n385.             \'size="8">\',\n386.         )\n387.         # pass attrs to widget\n388.         w = widgets.AdminTimeWidget(attrs={"size": 20, "class": "myTimeField"})\n389.         self.assertHTMLEqual(\n390.             w.render("test", datetime(2007, 12, 1, 9, 30)),\n391.             \'<input value="09:30:00" type="text" class="myTimeField" name="test" \'\n392.             \'size="20">\',\n393.         )\n394. \n395. \n396. class AdminSplitDateTimeWidgetTest(SimpleTestCase):\n397.     def test_render(self):\n398.         w = widgets.AdminSplitDateTime()\n399.         self.assertHTMLEqual(\n400.             w.render("test", datetime(2007, 12, 1, 9, 30)),\n401.             \'<p class="datetime">\'\n402.             \'Date: <input value="2007-12-01" type="text" class="vDateField" \'\n403.             \'name="test_0" size="10"><br>\'\n404.             \'Time: <input value="09:30:00" type="text" class="vTimeField" \'\n405.             \'name="test_1" size="8"></p>\',\n406.         )\n407. \n408.     def test_localization(self):\n409.         w = widgets.AdminSplitDateTime()\n410. \n411.         with translation.override("de-at"):\n412.             w.is_localized = True\n413.             self.assertHTMLEqual(\n414.                 w.render("test", datetime(2007, 12, 1, 9, 30)),\n415.                 \'<p class="datetime">\'\n416.                 \'Datum: <input value="01.12.2007" type="text" \'\n417.                 \'class="vDateField" name="test_0"size="10"><br>\'\n418.                 \'Zeit: <input value="09:30:00" type="text" class="vTimeField" \'\n419.                 \'name="test_1" size="8"></p>\',\n420.             )\n421. \n422. \n423. class AdminURLWidgetTest(SimpleTestCase):\n424.     def test_get_context_validates_url(self):\n425.         w = widgets.AdminURLFieldWidget()\n426.         for invalid in ["", "/not/a/full/url/", \'javascript:alert("Danger XSS!")\']:\n427.             with self.subTest(url=invalid):\n428.                 self.assertFalse(w.get_context("name", invalid, {})["url_valid"])\n429.         self.assertTrue(w.get_context("name", "http://example.com", {})["url_valid"])\n430. \n431.     def test_render(self):\n432.         w = widgets.AdminURLFieldWidget()\n433.         self.assertHTMLEqual(\n434.             w.render("test", ""), \'<input class="vURLField" name="test" type="url">\'\n435.         )\n436.         self.assertHTMLEqual(\n437.             w.render("test", "http://example.com"),\n438.             \'<p class="url">Currently:<a href="http://example.com">\'\n439.             "http://example.com</a><br>"\n440.             \'Change:<input class="vURLField" name="test" type="url" \'\n441.             \'value="http://example.com"></p>\',\n442.         )\n443. \n444.     def test_render_idn(self):\n445.         w = widgets.AdminURLFieldWidget()\n446.         self.assertHTMLEqual(\n447.             w.render("test", "http://example-äüö.com"),\n448.             \'<p class="url">Currently: <a href="http://xn--example--7za4pnc.com">\'\n449.             "http://example-äüö.com</a><br>"\n450.             \'Change:<input class="vURLField" name="test" type="url" \'\n451.             \'value="http://example-äüö.com"></p>\',\n452.         )\n453. \n454.     def test_render_quoting(self):\n455.         """\n456.         WARNING: This test doesn\'t use assertHTMLEqual since it will get rid\n457.         of some escapes which are tested here!\n458.         """\n459.         HREF_RE = re.compile(\'href="([^"]+)"\')\n460.         VALUE_RE = re.compile(\'value="([^"]+)"\')\n461.         TEXT_RE = re.compile("<a[^>]+>([^>]+)</a>")\n462.         w = widgets.AdminURLFieldWidget()\n463.         output = w.render("test", "http://example.com/<sometag>some-text</sometag>")\n464.         self.assertEqual(\n465.             HREF_RE.search(output)[1],\n466.             "http://example.com/%3Csometag%3Esome-text%3C/sometag%3E",\n467.         )\n468.         self.assertEqual(\n469.             TEXT_RE.search(output)[1],\n470.             "http://example.com/&lt;sometag&gt;some-text&lt;/sometag&gt;",\n471.         )\n472.         self.assertEqual(\n473.             VALUE_RE.search(output)[1],\n474.             "http://example.com/&lt;sometag&gt;some-text&lt;/sometag&gt;",\n475.         )\n476.         output = w.render("test", "http://example-äüö.com/<sometag>some-text</sometag>")\n477.         self.assertEqual(\n478.             HREF_RE.search(output)[1],\n479.             "http://xn--example--7za4pnc.com/%3Csometag%3Esome-text%3C/sometag%3E",\n480.         )\n481.         self.assertEqual(\n482.             TEXT_RE.search(output)[1],\n483.             "http://example-äüö.com/&lt;sometag&gt;some-text&lt;/sometag&gt;",\n484.         )\n485.         self.assertEqual(\n486.             VALUE_RE.search(output)[1],\n487.             "http://example-äüö.com/&lt;sometag&gt;some-text&lt;/sometag&gt;",\n488.         )\n489.         output = w.render(\n490.             "test", \'http://www.example.com/%C3%A4"><script>alert("XSS!")</script>"\'\n491.         )\n492.         self.assertEqual(\n493.             HREF_RE.search(output)[1],\n494.             "http://www.example.com/%C3%A4%22%3E%3Cscript%3Ealert(%22XSS!%22)"\n495.             "%3C/script%3E%22",\n496.         )\n497.         self.assertEqual(\n498.             TEXT_RE.search(output)[1],\n499.             "http://www.example.com/%C3%A4&quot;&gt;&lt;script&gt;"\n500.             "alert(&quot;XSS!&quot;)&lt;/script&gt;&quot;",\n\n\nFile: tests/admin_widgets/models.py\nLine number range: 1 - 201\nContent:\n1. import uuid\n2. \n3. from django.contrib.auth.models import User\n4. from django.db import models\n5. \n6. \n7. class MyFileField(models.FileField):\n8.     pass\n9. \n10. \n11. class Member(models.Model):\n12.     name = models.CharField(max_length=100)\n13.     birthdate = models.DateTimeField(blank=True, null=True)\n14.     gender = models.CharField(\n15.         max_length=1, blank=True, choices=[("M", "Male"), ("F", "Female")]\n16.     )\n17.     email = models.EmailField(blank=True)\n18. \n19.     def __str__(self):\n20.         return self.name\n21. \n22. \n23. class Artist(models.Model):\n24.     pass\n25. \n26. \n27. class Band(Artist):\n28.     uuid = models.UUIDField(unique=True, default=uuid.uuid4)\n29.     name = models.CharField(max_length=100)\n30.     style = models.CharField(max_length=20)\n31.     members = models.ManyToManyField(Member)\n32. \n33.     def __str__(self):\n34.         return self.name\n35. \n36. \n37. class UnsafeLimitChoicesTo(models.Model):\n38.     band = models.ForeignKey(\n39.         Band,\n40.         models.CASCADE,\n41.         limit_choices_to={"name": \'"&><escapeme\'},\n42.     )\n43. \n44. \n45. class Album(models.Model):\n46.     band = models.ForeignKey(Band, models.CASCADE, to_field="uuid")\n47.     featuring = models.ManyToManyField(Band, related_name="featured")\n48.     name = models.CharField(max_length=100)\n49.     cover_art = models.FileField(upload_to="albums")\n50.     backside_art = MyFileField(upload_to="albums_back", null=True)\n51. \n52.     def __str__(self):\n53.         return self.name\n54. \n55. \n56. class ReleaseEvent(models.Model):\n57.     """\n58.     Used to check that autocomplete widget correctly resolves attname for FK as\n59.     PK example.\n60.     """\n61. \n62.     album = models.ForeignKey(Album, models.CASCADE, primary_key=True)\n63.     name = models.CharField(max_length=100)\n64. \n65.     class Meta:\n66.         ordering = ["name"]\n67. \n68.     def __str__(self):\n69.         return self.name\n70. \n71. \n72. class VideoStream(models.Model):\n73.     release_event = models.ForeignKey(ReleaseEvent, models.CASCADE)\n74. \n75. \n76. class HiddenInventoryManager(models.Manager):\n77.     def get_queryset(self):\n78.         return super().get_queryset().filter(hidden=False)\n79. \n80. \n81. class Inventory(models.Model):\n82.     barcode = models.PositiveIntegerField(unique=True)\n83.     parent = models.ForeignKey(\n84.         "self", models.SET_NULL, to_field="barcode", blank=True, null=True\n85.     )\n86.     name = models.CharField(blank=False, max_length=20)\n87.     hidden = models.BooleanField(default=False)\n88. \n89.     # see #9258\n90.     default_manager = models.Manager()\n91.     objects = HiddenInventoryManager()\n92. \n93.     def __str__(self):\n94.         return self.name\n95. \n96. \n97. class Event(models.Model):\n98.     main_band = models.ForeignKey(\n99.         Band,\n100.         models.CASCADE,\n101.         limit_choices_to=models.Q(pk__gt=0),\n102.         related_name="events_main_band_at",\n103.     )\n104.     supporting_bands = models.ManyToManyField(\n105.         Band,\n106.         blank=True,\n107.         related_name="events_supporting_band_at",\n108.         help_text="Supporting Bands.",\n109.     )\n110.     start_date = models.DateField(blank=True, null=True)\n111.     start_time = models.TimeField(blank=True, null=True)\n112.     description = models.TextField(blank=True)\n113.     link = models.URLField(blank=True)\n114.     min_age = models.IntegerField(blank=True, null=True)\n115. \n116. \n117. class Car(models.Model):\n118.     owner = models.ForeignKey(User, models.CASCADE)\n119.     make = models.CharField(max_length=30)\n120.     model = models.CharField(max_length=30)\n121. \n122.     def __str__(self):\n123.         return "%s %s" % (self.make, self.model)\n124. \n125. \n126. class CarTire(models.Model):\n127.     """\n128.     A single car tire. This to test that a user can only select their own cars.\n129.     """\n130. \n131.     car = models.ForeignKey(Car, models.CASCADE)\n132. \n133. \n134. class Honeycomb(models.Model):\n135.     id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)\n136.     location = models.CharField(max_length=20)\n137. \n138. \n139. class Bee(models.Model):\n140.     """\n141.     A model with a FK to a model that won\'t be registered with the admin\n142.     (Honeycomb) so the corresponding raw ID widget won\'t have a magnifying\n143.     glass link to select related honeycomb instances.\n144.     """\n145. \n146.     honeycomb = models.ForeignKey(Honeycomb, models.CASCADE)\n147. \n148. \n149. class Individual(models.Model):\n150.     """\n151.     A model with a FK to itself. It won\'t be registered with the admin, so the\n152.     corresponding raw ID widget won\'t have a magnifying glass link to select\n153.     related instances (rendering will be called programmatically in this case).\n154.     """\n155. \n156.     name = models.CharField(max_length=20)\n157.     parent = models.ForeignKey("self", models.SET_NULL, null=True)\n158.     soulmate = models.ForeignKey(\n159.         "self", models.CASCADE, null=True, related_name="soulmates"\n160.     )\n161. \n162. \n163. class Company(models.Model):\n164.     name = models.CharField(max_length=20)\n165. \n166. \n167. class Advisor(models.Model):\n168.     """\n169.     A model with a m2m to a model that won\'t be registered with the admin\n170.     (Company) so the corresponding raw ID widget won\'t have a magnifying\n171.     glass link to select related company instances.\n172.     """\n173. \n174.     name = models.CharField(max_length=20)\n175.     companies = models.ManyToManyField(Company)\n176. \n177. \n178. class Student(models.Model):\n179.     name = models.CharField(max_length=255)\n180. \n181.     class Meta:\n182.         ordering = ("name",)\n183. \n184.     def __str__(self):\n185.         return self.name\n186. \n187. \n188. class School(models.Model):\n189.     name = models.CharField(max_length=255)\n190.     students = models.ManyToManyField(Student, related_name="current_schools")\n191.     alumni = models.ManyToManyField(Student, related_name="previous_schools")\n192. \n193.     def __str__(self):\n194.         return self.name\n195. \n196. \n197. class Profile(models.Model):\n198.     user = models.ForeignKey("auth.User", models.CASCADE, to_field="username")\n199. \n200.     def __str__(self):\n201.         return self.user.username\n\n\nFile: tests/admin_ordering/tests.py\nLine number range: 1 - 208\nContent:\n1. from django.contrib import admin\n2. from django.contrib.admin.options import ModelAdmin\n3. from django.contrib.auth.models import User\n4. from django.db.models import F\n5. from django.test import RequestFactory, TestCase\n6. \n7. from .models import (\n8.     Band,\n9.     DynOrderingBandAdmin,\n10.     Song,\n11.     SongInlineDefaultOrdering,\n12.     SongInlineNewOrdering,\n13. )\n14. \n15. \n16. class MockRequest:\n17.     pass\n18. \n19. \n20. class MockSuperUser:\n21.     def has_perm(self, perm, obj=None):\n22.         return True\n23. \n24.     def has_module_perms(self, module):\n25.         return True\n26. \n27. \n28. request = MockRequest()\n29. request.user = MockSuperUser()\n30. \n31. site = admin.AdminSite()\n32. \n33. \n34. class TestAdminOrdering(TestCase):\n35.     """\n36.     Let\'s make sure that ModelAdmin.get_queryset uses the ordering we define\n37.     in ModelAdmin rather that ordering defined in the model\'s inner Meta\n38.     class.\n39.     """\n40. \n41.     request_factory = RequestFactory()\n42. \n43.     @classmethod\n44.     def setUpTestData(cls):\n45.         Band.objects.bulk_create(\n46.             [\n47.                 Band(name="Aerosmith", bio="", rank=3),\n48.                 Band(name="Radiohead", bio="", rank=1),\n49.                 Band(name="Van Halen", bio="", rank=2),\n50.             ]\n51.         )\n52. \n53.     def test_default_ordering(self):\n54.         """\n55.         The default ordering should be by name, as specified in the inner Meta\n56.         class.\n57.         """\n58.         ma = ModelAdmin(Band, site)\n59.         names = [b.name for b in ma.get_queryset(request)]\n60.         self.assertEqual(["Aerosmith", "Radiohead", "Van Halen"], names)\n61. \n62.     def test_specified_ordering(self):\n63.         """\n64.         Let\'s use a custom ModelAdmin that changes the ordering, and make sure\n65.         it actually changes.\n66.         """\n67. \n68.         class BandAdmin(ModelAdmin):\n69.             ordering = ("rank",)  # default ordering is (\'name\',)\n70. \n71.         ma = BandAdmin(Band, site)\n72.         names = [b.name for b in ma.get_queryset(request)]\n73.         self.assertEqual(["Radiohead", "Van Halen", "Aerosmith"], names)\n74. \n75.     def test_specified_ordering_by_f_expression(self):\n76.         class BandAdmin(ModelAdmin):\n77.             ordering = (F("rank").desc(nulls_last=True),)\n78. \n79.         band_admin = BandAdmin(Band, site)\n80.         names = [b.name for b in band_admin.get_queryset(request)]\n81.         self.assertEqual(["Aerosmith", "Van Halen", "Radiohead"], names)\n82. \n83.     def test_dynamic_ordering(self):\n84.         """\n85.         Let\'s use a custom ModelAdmin that changes the ordering dynamically.\n86.         """\n87.         super_user = User.objects.create(username="admin", is_superuser=True)\n88.         other_user = User.objects.create(username="other")\n89.         request = self.request_factory.get("/")\n90.         request.user = super_user\n91.         ma = DynOrderingBandAdmin(Band, site)\n92.         names = [b.name for b in ma.get_queryset(request)]\n93.         self.assertEqual(["Radiohead", "Van Halen", "Aerosmith"], names)\n94.         request.user = other_user\n95.         names = [b.name for b in ma.get_queryset(request)]\n96.         self.assertEqual(["Aerosmith", "Radiohead", "Van Halen"], names)\n97. \n98. \n99. class TestInlineModelAdminOrdering(TestCase):\n100.     """\n101.     Let\'s make sure that InlineModelAdmin.get_queryset uses the ordering we\n102.     define in InlineModelAdmin.\n103.     """\n104. \n105.     @classmethod\n106.     def setUpTestData(cls):\n107.         cls.band = Band.objects.create(name="Aerosmith", bio="", rank=3)\n108.         Song.objects.bulk_create(\n109.             [\n110.                 Song(band=cls.band, name="Pink", duration=235),\n111.                 Song(band=cls.band, name="Dude (Looks Like a Lady)", duration=264),\n112.                 Song(band=cls.band, name="Jaded", duration=214),\n113.             ]\n114.         )\n115. \n116.     def test_default_ordering(self):\n117.         """\n118.         The default ordering should be by name, as specified in the inner Meta\n119.         class.\n120.         """\n121.         inline = SongInlineDefaultOrdering(self.band, site)\n122.         names = [s.name for s in inline.get_queryset(request)]\n123.         self.assertEqual(["Dude (Looks Like a Lady)", "Jaded", "Pink"], names)\n124. \n125.     def test_specified_ordering(self):\n126.         """\n127.         Let\'s check with ordering set to something different than the default.\n128.         """\n129.         inline = SongInlineNewOrdering(self.band, site)\n130.         names = [s.name for s in inline.get_queryset(request)]\n131.         self.assertEqual(["Jaded", "Pink", "Dude (Looks Like a Lady)"], names)\n132. \n133. \n134. class TestRelatedFieldsAdminOrdering(TestCase):\n135.     @classmethod\n136.     def setUpTestData(cls):\n137.         cls.b1 = Band.objects.create(name="Pink Floyd", bio="", rank=1)\n138.         cls.b2 = Band.objects.create(name="Foo Fighters", bio="", rank=5)\n139. \n140.     def setUp(self):\n141.         # we need to register a custom ModelAdmin (instead of just using\n142.         # ModelAdmin) because the field creator tries to find the ModelAdmin\n143.         # for the related model\n144.         class SongAdmin(admin.ModelAdmin):\n145.             pass\n146. \n147.         site.register(Song, SongAdmin)\n148. \n149.     def tearDown(self):\n150.         site.unregister(Song)\n151.         if Band in site._registry:\n152.             site.unregister(Band)\n153. \n154.     def check_ordering_of_field_choices(self, correct_ordering):\n155.         fk_field = site._registry[Song].formfield_for_foreignkey(\n156.             Song.band.field, request=None\n157.         )\n158.         m2m_field = site._registry[Song].formfield_for_manytomany(\n159.             Song.other_interpreters.field, request=None\n160.         )\n161.         self.assertEqual(list(fk_field.queryset), correct_ordering)\n162.         self.assertEqual(list(m2m_field.queryset), correct_ordering)\n163. \n164.     def test_no_admin_fallback_to_model_ordering(self):\n165.         # should be ordered by name (as defined by the model)\n166.         self.check_ordering_of_field_choices([self.b2, self.b1])\n167. \n168.     def test_admin_with_no_ordering_fallback_to_model_ordering(self):\n169.         class NoOrderingBandAdmin(admin.ModelAdmin):\n170.             pass\n171. \n172.         site.register(Band, NoOrderingBandAdmin)\n173. \n174.         # should be ordered by name (as defined by the model)\n175.         self.check_ordering_of_field_choices([self.b2, self.b1])\n176. \n177.     def test_admin_ordering_beats_model_ordering(self):\n178.         class StaticOrderingBandAdmin(admin.ModelAdmin):\n179.             ordering = ("rank",)\n180. \n181.         site.register(Band, StaticOrderingBandAdmin)\n182. \n183.         # should be ordered by rank (defined by the ModelAdmin)\n184.         self.check_ordering_of_field_choices([self.b1, self.b2])\n185. \n186.     def test_custom_queryset_still_wins(self):\n187.         """Custom queryset has still precedence (#21405)"""\n188. \n189.         class SongAdmin(admin.ModelAdmin):\n190.             # Exclude one of the two Bands from the querysets\n191.             def formfield_for_foreignkey(self, db_field, request, **kwargs):\n192.                 if db_field.name == "band":\n193.                     kwargs["queryset"] = Band.objects.filter(rank__gt=2)\n194.                 return super().formfield_for_foreignkey(db_field, request, **kwargs)\n195. \n196.             def formfield_for_manytomany(self, db_field, request, **kwargs):\n197.                 if db_field.name == "other_interpreters":\n198.                     kwargs["queryset"] = Band.objects.filter(rank__gt=2)\n199.                 return super().formfield_for_foreignkey(db_field, request, **kwargs)\n200. \n201.         class StaticOrderingBandAdmin(admin.ModelAdmin):\n202.             ordering = ("rank",)\n203. \n204.         site.unregister(Song)\n205.         site.register(Song, SongAdmin)\n206.         site.register(Band, StaticOrderingBandAdmin)\n207. \n208.         self.check_ordering_of_field_choices([self.b2])\n\n\nFile: tests/admin_ordering/models.py\nLine number range: 1 - 38\nContent:\n1. from django.contrib import admin\n2. from django.db import models\n3. \n4. \n5. class Band(models.Model):\n6.     name = models.CharField(max_length=100)\n7.     bio = models.TextField()\n8.     rank = models.IntegerField()\n9. \n10.     class Meta:\n11.         ordering = ("name",)\n12. \n13. \n14. class Song(models.Model):\n15.     band = models.ForeignKey(Band, models.CASCADE)\n16.     name = models.CharField(max_length=100)\n17.     duration = models.IntegerField()\n18.     other_interpreters = models.ManyToManyField(Band, related_name="covers")\n19. \n20.     class Meta:\n21.         ordering = ("name",)\n22. \n23. \n24. class SongInlineDefaultOrdering(admin.StackedInline):\n25.     model = Song\n26. \n27. \n28. class SongInlineNewOrdering(admin.StackedInline):\n29.     model = Song\n30.     ordering = ("duration",)\n31. \n32. \n33. class DynOrderingBandAdmin(admin.ModelAdmin):\n34.     def get_ordering(self, request):\n35.         if request.user.is_superuser:\n36.             return ["rank"]\n37.         else:\n38.             return ["name"]\n\n\nNow generate the complete self-contained test case that reproduces the bug with the same error/exception.\n' additional_kwargs={} response_metadata={}
2025-10-06 20:03:39,351 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_write_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_file', 'arguments': '{"relative_path": "tests/modeladmin/models.py"}'}, '__gemini_function_call_thought_signatures__': {'f49fc129-9013-47d6-a41c-12c9c0823b9e': 'Cu+hAQEfzIW2//BIFpznXVpem+LQ6V6dhNrXrpVD+E2ANoE0rke26Jb/tRrfQR4DNVCjc1db6tPuFwcq+odqfuaNcEmYZdUbmPNh7T6WweaPcAKkjnyhnUpnNZNdDHCjbAN9byL2GXWp85t5ayc1dUL5qIHU2WqAfWIWDfUQf3tf/SK/QNTDmsZPcvl2CXPJba2g9HHiSYs7Eu8V0301+IdPRmRMb5ocw/MV12g5H6M5glLhujfQheQCDdp5zEvc16oXj/zcWLHlV8hZitCics5hqHTMb3H3WEav7Ow163d/+RifTF4P+oJnobGrROHbvLg7LTL/XJqyVtDcaXhyeOQ1LoHVwL/wrkeG2TI/IrdGWgmQ8uZ8mlBlftIiMpdGz0sZzB1Vxw9pYpGRpA3APeK3fP/x4wS6cygi3eYNK6uXOvOQWEjHgcMn2wFJHAp6T98hat1sgzduELTHLUJZ1EHxURhUTM0JhheOmcsdSF6wwgjbcrOVor7vp2jRe81l3eVPx+uX52M5h11Y+6e2rR/pc5iYbflwmReua0UE/XSl7mgO1Ge0UkEwnHyE/5ZMKCjFnOJBBhVwaPuKuuLP9AvxP5X1AgzF7/nmjctyXzAXkith6NvEURM5oy2vkl8FrUglN+rbJPqL3moKFTwplIUYzJN/4IbN/n8nmDPoyvJhZ6fVWvPaVpCOzhJHg4Yp6MWw9jvM5r9tcY/78nQLE6Gf1rIdntIjeQytqEt6WKIkONYfYm8lyfn+cyo5wNmB5wW/5/EYllht78dfWIUtAvIbBvDc+IujwEKiRncr1wRjInf2PeUjX/JkQqW+gEnqh9ALficFfuyeqX54tgJHYYnZ/++MDp4dTk524hKbG2Z9LzrD6gEbTEPQselsp/nsh4YliEWVyL/Wm95/souXC7VQdFrClL7yEwwBRMPGB1Fo9m+a02Ni7I8YBR2mFssfbs2fggtSwppZQJTiB7ttP91l9SIrMskC26325Gd7yYhhtwURfLgD734DdK5D3+O/1ETSv1mJ3KoeTfT0uOfZEU7wYZNgTWERwx+xW51rO8NwxUErBy8tuuvFsxbzXCa3BBP8bZ1A8SiT1j+RgtR3iv2O5MeR7G8+LXboHnUGDjWfBwc3ZvikfUTbL/6CF/CrJzB23KAemLdCRaI2gupXzM+rdoAnLTHRGTjfE75RXavVSlwolJod8XMXVP1WzevhpfM/dX6DJSOZKdkO5pUqdHNkGlJ0CHxgDrQdwCNSF2ZdnLeIHZ1ESsaAT9o4yQ/2KlrmgNh/sg8aVabIcLDZtHstyMmLWPWew0207+fwIptOFaQtBEcbNfmfZUx9BwD6RSSxQelmSsFLMg9EAP+6zrkJoBvUooPscfLzLpnB5xWnRqLlAjh2ZMo05wfQ/apTu3STANW+MFDvJSFA521/dQcAfGn7Y1bWQo56EeX8obzHMcT25PHqnjtb1wD4Qq73FYwCNSqTP9/QgTdxmlv4gp1VBoBMsQMxxlLP10txv1yFN5+MgwjRN6Y+BoT5dFfuHKs8br1TWjhsD2rLrMB32AWkBUx3f5Cs9vlVWEGis9hDla2mdchSzYHjfIF/GOfTj2YiFbcunpFTFTcMrFfeYDjJspP07VkOMRQ4h0itYFv7vIoGfgCrpipQBRFIkPE8Nm1T7Pi4aolw1AFM3VEDXY5vqIkUvGVuim1iY+1/Gg7/MdB9xCoMe68EhQ5DbH+nP2qkWuAuKlyixkOn/M0jXfYDWL79x+70oJPqf/sGtQHvNZ3rv4i4VLsERscORWbi79Xr4zrIGwXag4tS36af8dLziMVprdyIySxYwnmLsIl00rAym5C2er747MwS1wJPqlxzzlHMV9Z194XqXo4ALG06TvZlbVYDQH7ji6tMXbvBDo82OROup6631kCx+TMwJ2HJHIfQDASZ1072pF2/CpITsMTC3NwbPttGVKmTb4GVHhWfQlkVvfwowsjbKFoxVemF9GDwc/hoGPzEvTwSQ6I6rnzmgou6FfBJiPxKsHGJzvs02StoUyFS5sQiCLcGkpyZnirU1P7bir4FvyxWaDzlm68fA8QG2CMZ6WVOW05X5iRCE/NUCnCV6BsKRPzfJoIYnGIXZmb+lqqyTjvPj4mh29jLK6EZIhaV3YsSE0CONZOGxW5q7t9WTPVcyOafdYA8KFIW3stUIjJWJreTkerFymUoJerEH48A46DMcVCeg87+Xm5WwShJ7BPNs/XrLq8L7dACV1HKlW97bSOmDtIeAEzFLW6EtN0BcqnY6OeY3/VLqPBVuvtMdTRerjhUmxNVouEuwCIyHpMbUFeCwmNrsdBdBhdOspRv+hnMkHuG88ADWHf9eA1nID1LqKGK130vVZQKbrW87BoVOcusM+Nu5kFWYiD+3OHKIIjxhF21JFOLEU0BAkbSfKVTteK3Vx7zSo5HZNutjbR0Lyc941Jp8GM1+yIJaXtlfqimIZrmVbY0XSS7fRd+2o3/9BS2ZJbop5VuOZb5g/twttpiXyKD7NI0qn+g4NZjfuPgETnZSQOuAtYFuigIdMK95py1loPe7QG9CH6EZ7iyUJYYFNFeCgsMqEX6s/IZ0jroB3dQIgmhmakpDoy40P32paKMNprwYFI90fyJ0M+JKQ8LwYgvDoQ4cnBBGmtms1UMAZkdynqdQReG6AuXG3ri9tvVnidxK/tZjxDf7dXDFFhXqdI0kxDEJj8O8ttYflYHtFZJuVdTwFhJgBiPN4Wywwg3mBfj2sekleBjHU9IkEyPe5T0wJw53KS2ERETGfOQ+L77Z6Ic3U8GHjWeXBk6oEc2B+G9pUKnHGnVQ9obLfkSLRNLNLcHipvJlHVnzp07b6hXlbnK9ASI5u/4U3TtoWYp2kxDXvPx0PSFj3KtumRfHE8uNQNwrKoEXTu/Nm2wqGOpHUgopkYQyXF+45/ge2GRDTVDeqD/Otu5lEAqhcPXQVNUcyb3A0fYG0FhFngLlSRUtvYL6BHjvCnDvGJEGHMAmwTnu7EZaoc9ZV6z3J8XzyDJ8L1ROXhHBCaRyxyiLxgAFfO/E/N78/+vXhSldekuh6US7XwWN+j5zuynSfU8lXDspesh7acJauJSyH9Lo1C1++wr8AX5jbcoXXLrNphc06Fsp3nUuh8C9q/zzrZOSK37t9DB9YwUpZw694d2jD3mkMIzTeh7L6KsJCV0ZhbJrTJc0ooOi8RWk80egpJq8lNvuJD9Z+20tOzVlvR9IfveH0mUz/AtV/qslropnrx9OjkK2mudE65vDaveKGqrbo7kiwYj9YIJJMe/3bXUyOxyF68c46d/56ILQTTjPZMzI0KaG2IefN+NAMQwgSJNqkssbXSXq5EUwWg9WVKN2PnOAmA6dXioWjgnz1gllNK1L0owOFNUuQxuAj7r98y/1ltlun+QaEJ4Veb8yEiwRUZ4NLG2b62LsHU0eFz0vZSVCowy7XEnLya7wD1cC7qCTiJJuEeTwJ2c/B4hRWMeur7+MDafbEc3fVXYrc5tgI5oTRqySu0z6kSbYYHmMuzDSi6dDxoOqT0twOamR1lAZDNQhTyvhkHjqro/ZlTZB5Qsl5kb8+FU/xUGXbsd1p72smdSpKA78W30cQ6Sb9DD9XWNUeW9WNSW55bKBo9wM7PrbJeim/oikX8zzQpZFZ892ZSf+yfqMZ+eEPojg3kpWZKW2Jn4kdAA+SOO4FKP821Fsje2qvmkPslwSqIIPvVzeazsF8tLZ6nqAY72QtUsiJPN9Vo8DlFz0nm9Kk+eWfLjsZuWvfjtbVjawuw+TBOMQk/yuAIMNiP7ua58vZLAamcX+Lra4Gonh1SmVkBlFjTO3M+vHEfXwglBM7eDt2/ReaMOEeF9pKO7slirArd8qLD1Hy0zQ4MLBX9pJGN+M8/Scdl4z2CnEU5NG4sKHRVgrqiqrIgVhhT3xUdfF9VdqdxCKTUzLVr2AnKwBwOV+2KZmtvt3YKlPoJNGeMs6PPAu0eIAysVFV5zLvCjfND333VUO7UEEreB6djJjygr+1DQkjQtS+jXf/whJ6iCsR7WXUxDFOuSEnQGLIXqGqCp6ZIx6KrtrdJLVA921tb97shxf4hByHBczlNqExJ0Bvuwt2pjWM9oHSkfSo/ePIIrBA12vNpVXrMbzd44twcsGwEAWX4CE49ohic3F+ys515t1A+7odz7HdIqejuzYG+FFooFSh6I0cwhE3l1/PcvxmgbHSg6C5M74a7njXizWTNl5u2UGniXI5/Q0iqemfhyUffkZiQ7u7Lvd6P4eljnbuo0VhxP7q6Cp7Tfx7U3upI6LTDCdUI5basxrSb1G+TgMVntdUJ65kuGzbkyu9VZvy6LLNTpiAN6PIlY+rNs0pHXtdHCq4b1px4HgaxVdoh2ylmG/EKTHdcBs9BZuqn/cbI9CbiKsn8duzrlN6VPa3+T+yL78X58rdIIszMazObHyyxvhWUer3PRPfRyx7CLcwMcxlP87qH8v1b+n+kMQNAG+IO/gysrKB3LDZNMa9BV/d4ZE71Ag3wujy+qjazUJKIyZpYxUVajP/efMlwTb2trBr+Iz6TXeXHZME7tktYRCj22QIrb9kn9PDC6qfN6z94zYyJvr0HIGMtD7XrkDCSwpQEaP7cbc5Wl+rSxOeU1psfPMw1lw2ESqK2+10cBXiNDi2JQZU61+I/QU8rHmJgyRydS9mb+El3PPefbBKPoTXE2Nsmr9MJiv1kNRVMEC3mdA7zPt3zXuwH5qQFmGjFPVUA1mWguFO06h7Q0GAR0Lcn6gFD64UMakQyIueoQHjjWy551tyOtkC81FAu9nfv5pSa6h6b28qwHM72ftD+puJaMMehB+Whdrst8oHezFwEs8Jo6Ce/hLkBz6+26GvoyqTECzJ+IE3reoQox8Qu9RHWqJ1M+zXheONTQSaL0ZC0Fx3th+G9mmUoaV2Da2aT2eiPUk/AJYNpEjk5AGTTczF/ckBNnDAtOBA52pW5RhY/1eU08i8B8pQjngU+v94Z28b87Xhq8GLfKDpH2YmCSu3ojrRI/k5Pwdb09pK5NoUlcv4N8iMP8//pOJelLNrK4eGH7+CPVSMQ5H38PZc7l8HKd5oSfqFn1v/7CbkcxfeBK64eHNmyke/wOBSjx6t4vtl2sMOBRw0SviD0l/UGSy02a1XGV97MBfjZxSc8V6LvVQOpekQ0/60wRCvOGHbYPd1MkWN+YuQouige6B2SnwFs36DwiKUnxbumBdJyke2hi5sa9TDg+wHzwd+sDwhzPRHuxuhirVln45VhRH+jq6I0YUNC9GJMPphJfaWJIKWz0SdqyYtsfVXFrmUAM+T1KJOICA6sMoeDCr8PkNKVYql8/HDmgfVzHDHK+H4sr9GLX1+BFaPNUIUh1AN0fVXUyMa9QSIc9++KnSmofIlRyChG419rQ+Xl/N1HI1TMta2iFYWTQiK/w5OZ5Ebsoe8LMpO3Oy5fMpaJuPkqEQcPHLars5jThVmdjouveLqhHVb0yhOTQCk3rn7XkCrz0rSDwgsxBh7w5E8v2nFnvEd9/craC2tZtTwLVyr75f76h52widAZvzjjBf+KoIabMhpz9IXEfv6u9LQrrz3Mqnk2UAtrwuiO9JCHy5KPN8onl11M72JlwqBam1Q13b7+vZQE3ob2UBRELeujtY6NsrLf7Vynv63hR/hk2G32gIPa/AWrC7/qw2I5Wf5JhdvexTuKW7rvaNIZHOTpmaM3qhmWjKnSqpkgX6jvrUajpK+HyQz5BNCY6Q+qICtZhDraxE7NOtx/zMPIEoT6qxB8EuGybXAND7Hxl0p2CaVE9jiGzvDj8s5XNE6YBUXtPi3fiKONx4vY+govgAGOdgRvaljPkLKx3yMH3VnikAcXUJaEAwce8FrqFvW9B+PU1aIy7M9qsw/9YYe2abo9EVTVBmk1TpTMEhT39HxZmjertkS38mPU5/5S/jg5uvpu+6AuORtcNfdB7277cPs5SGfyCzLb3ZJ9/GFGTBetSsEMpcyE5XN+4aouJqGcPn/e6KPjGa4Xmd8IptxJI1wZ5qwSvjmne8gnsZTHQbge7SmZY6qqeztGHgUs0eq9sLJJh/sSUGrCj0BckxNjE6KP24Z+fzoH/GCvJdrnGbdW/E3PWyWQZEAXorHtEz3q88QCtpSxeZ4U242tAa65OuBJZFWkKhIbul7SawHaHidVHt7x2jK87ofXu4rp72AFSUFPgehRbMIwcEBpiVvEyAEwAMefL4lI1B7SBPsI7e2MBe66Hkujnb2/RdvDUuW2/AJOM7hgqhtmH3RgXx54lBEJvei96ifeLK0wAx2OHLgaAY7EbTZAN/LFgT0jOmoXN6TfsXlDPln0kMyuJH3qfmNjkKT4BkXKRCEkVibMs9HaCPelvISA1UCDei4FqRKm1XJujNcE09b2lsQZgJKHZTf9lx0cAFki6UCG5w0yeHoMUt4+IKn5vBeL/iGO7z2YYYL1Kl4lDKcTrHubxvWwGzI2zbufLB4O6vVheR69zwriZntjB0acAntGyTzI9VWIZczPRrEztH6GsFCL2pi3NgFa/7ejkNJ7g/If3ClUx2BxvZ19joAIHB1NEVgL3eAnJlzpNS00TzQX458YMNYi00QMN13JLQlSeqsEZU/XueBT888cqhBEdxO886ZnRBM1tkN7VxbvguVb7cGBT2eokcbAwS9YIKHW7xgaJARIFl1SmeEj0m8uUtTJQ1JK+5+XYoMrgGkh4eamZ5mGDl8nE6chKLcK6CcPowfNJtrTxHpd2G75/fW6tWiKLFHkVuKUlYd10utwNVdpdEWLXtsxiJbg01UfDD6zQesJ9NVyfb1sOfGddZj6q4wFAnLs5g/6pmxbReHerdZ4VcLG03wyX0xDGNeKTlNVeuiHyg9VK31TDSeKvNKltp7BmGOKVPIJS6Y2EMwqMdmEBjvf7MQ27n79xn6o+7DUx5nkBVUbRIV3ejssLEmESsrxSrgKQ8m+kBFE/UY7Yq6Ak6gTRmKJi8DsNEmbpNQyJNhbLWpkQy2S4vH1w8ZGlgB92QOUeloUOqu0mlqHgCZoOQtoHSfg1G7G1VaWrd0KS3/WZx24Mh6Uott+to85gOFTF3mZIFYxBgJtkmwJ0CwkDL/2n9bW7WOItZGcwA9oI6rXK0uEougC9Ujocv2infE4Cp0PWwNOmSTcbXs5RlAZw+l+HI7pSbRWMAn+ZFaZfWDepcHkSmlO3OLSvP7k2izoy8GiM0dI04hN8Dgt0MxM+cwh1arhT4y05Kd3qAq+bfeFjdiRqATIQq789XN6Uu7bZu/yuTNxhxzpfvFrpCpiYFkL/X0Eq56fA5cd7db6XClsZ+Ccy4XDIRlz3G2UUS43bHqLvec9tk4XIuDdPXHTSgcnJ+mAzez/VPF6gsSJlMCP80wNFK0HMOfbS41bhVkUatgUDPFYodTBiVTBeCR9a+KPQU7JHp62ZzxElGI7v0zwdnLAaQOUvmko+h/g85dFDqQX1cXw6XcC8z878Ks2a0zrrdzSNhWgjX3jzQ0thR39qOgFSKjMAxXC6A14YreyCi8QTiGc24QqGGieA1YYl68UUZULqJysDeNx5FIVm6B7VS3i/zmVtXCP6haAZv7XjQfc0LsTfwov6LypE3ih5jafOmQcGGkZ0yU6rXamNlCuLT+mrQRCAd64RkmzoVoJkuN0BgIy6cMkRObpqOo9bYEne0AWRn9+xvDtLl+j39pvuUNDVAwmpDhPX4VkyVY5NEWunJy1Ea6heXmQU6UHglq1wvGijtp9I1rX+B1z784obafLzy0VCfohY+Pa3BJJwy0rxF8H/yOQeEVNnlzjSDKalvaXL9cWEn7FI2Y0K0XyY+XJgApYLoMNzOIO0CfQNpLrSdTS8UHYESnkc252KCyyCBjA+F03EBn0yJJCMNZMs4zcd1LAJ+a048w+gZCkeTi1/rX0zZV4W5iaFaqzemznC1P5iW4trApyFeQuy1v8jh02V1py4x5SJc2fgJ9E33rh54r6YVPQtrSjfuAsnPVHQ+S++CJXGYr3T32AlcSogM8zdz27LZvl0+KL7Wt5eqmbiTQVYYVDjS9lE1EMRllWLKcCTObKV/KQmS3alQHujuyonlqUhHlO5DvL8Bj+V2m65gND+ye34zDpO87bxd79MyhtoJFjs70am/8Gc8Dnc9qdMGFchX+j782TfK8uXSLcLaUFXgEnP8Z2R9/mo5jBD4Azps4SuxWw5OIv4XBA1bgGiQ2H0jrfeeu9IZhDUV5PprKb9EPldkoc3rRVyduiLYLfr2lN2J2Vo+SJ4rHMoZX1j9KHohzNJxs5+kidr3bXZl5YS20ovpskY2RcZ8f7EFx6CbA34dNdoGXOAr9qM5UHS6uMIuBojAGuUrYkB65R3IYUmRt7KCprRrfsEosFJKaxxKBRq8Zfpcj9yEQp/16+gcgujqjI4WtQhVOaoo9I5JIzXFeZmLWBd9ox1+QJG3UNo1nbFOF92OTOb5tbZaPhkf+EwcvXfzZj8YrINiv1ZjQy9iW7KL1fhMPdfe6Gva3gtJDvVFtXj59eHjLdU7MODC/kRVCZmRAD/h3dy6wwzBJ961QcjbX33ncqChYkbb6We5Ztq9RgWFhgdqkZXreHBolQGC+qC+vwXg+BxbZeFGtdVzATORNuH63MHcf417iAL6YEHjjufOCMVLnC5snqyO2RYOU9CMulEstgiuUtjavH0k4emKY6jRFOYrwNntnYy8rWtAhMCummO3hJ2Z9vV20+PZAhPQ8Hp2blR+g/6i4248FKaIEZMxQQ05ADMxa64FqtjEewDm4KtUyfneeaLECxfENj66GqTgpbUoYOuaOLQ42VzNnUz3mkmTcVq6JiWGa1q+yvTfgExm8+pTGsJPHo8UrX3ijuKyk0gt6BnDWY64oN8sfXlaCylPgdOUxQBfjt+ZB32AMIFUAX9cP5hs1Bt2VkCy6P0faGPYbTPDzCN9SONHoqfXR+dwPKTwuxgLmqD3KI3nbZeJ26rfUD1Qtp0J4cZTaHKtX3AIG1rbUm68IpzSdr1YepWcWtryvZLz7K9tfi9u3ydWCngDlEPBEmbUYJF5qjVGXlnuI7ozOjyznWqzUo7CJTt4HdN2SvZg0P+g99BC6olMnluZBK5niGgXrQUn44ZOIZnaPRPFWS5zC1/CGaA1rUWbnpyD5l1ERg4qbozaaSuyG8EXOfZE3dd1m4BWLa2JII76iJU93PjI2W1iHLvjeRlhKIS7tcZPS2Z6skXRvs9evq3aP9+pEUp4qTrqqs1NyN3Ksu9MJW75SrbSa3FAKOXKUuGcPlYj7rjbGMunyfXI3IFM6EqJsAjJYPdoy3l8BuVWq5E9t0ICRvGM4Hewwhm/WLCLKkFS+meK7MIv8v9XtSS4fcqANU/PTPX1G+B9J7dhwPi5LlCaf8KxYJAHqXnFD35VJicLOTzhQ8eN5abx8NyO7oHdoAemn0mj0nyelKP9XUPB569D0y9quAlmTLnOfl8GCCTvoXVSrwZryYV/ukuTkfkrrQFeZMcMOGNTSZHVdcNG7Lvqg0EgKkabLds5dArw+FMrPMHH25aBAiAgTNS/exUK1493rKwsh67pZ3i2zvgFvrBz0yT3HUjFOGWTCZ+nQFtj6QgfTTep9Z25d1lhw9ffy9MpC3KEtzzV0F/7p9LuGhypQ41lX6HaX+nboJb/1TVGwhv4xBc05G3or3QqmGWeS843sBbXvT0DS6o540K5Rir+YLGeYewuLj462IBii7+OtsN0klscLNWkymOgkmfO9mKBCF4PB53kLgCJvIbSL2b4w4ycEX6+fGMICRSM0/bhJy+K9xW1c5DRMj0TaGeMTpKO4gyrhR23SIHaNzsPsZLlecz4HpQQ9C7cmmY5Mq7MigbJDSFyEG59IDTB23SUONpC565RnJrJAv0vaJ/S1G1hWaVKRZzstNFGDt7t7W9r/kWth0uh3p+Vk17M63+b8TgwjLXSZQhJdlthaisnPjaQ70PUpfHqLnx7kZRmQXb+p0frbA9BgwC3/UxGDLb5aT4e+efqA9Lj+YK0DTuIMWy65venuR9UqaJWk4rjUQYE9Mf2ko0DXd1zj8bMzcVQfAuXOs+hCcTfI4/3TgEYwyvv7xp+0OxcyFRlFvQAslEhaeU9tdwcfJSDg5ID7yM0qf3rAazg3ovkL0WJDwchEo6dJTS3Dr6XMJaDXQaKL0ZuVy63dHBtqsc0Rqxqu6bE1RCQ3J5/YXGTcrklNF7vDN6YKlDbb5t7jNgigaq87zpOyxPa6jukxpudBJrPGQJnUSFCB2JggUVGmTt97yVWFgdnObz2eKB7Z6bT4Dn3UjDsCAQH2an0YlhtEyad8wTiBZYvLVsNPQ02B3lZAanSMDLTCEzpEdrlqqGb9PXzNoeRBnDzNrMRNvAkiWtWvv9cKAq5TGt22zlVXTPS2AGxWizQZYyWmVwVMl4bwfPX+v9+4UEER1V7kRDhfYZ7+9bvR0P8cZAerfc3gC49ccYljWNTMOy9aRcDUbYyqGqXwtf8vVH/qznWG4bqgYM6zHkpiOSdCYaEuiEmunAkDwVV8cXF1Riuo2uPndL5+S8ePGumgXdnzD+ZmhT4zl++mdF6Ku7hdM7QrJP3tcx9M6TeJMKXkdICTRXjMWsY0xT9RLery1hVimUEySv0HkMelEtOeViitjKw4Yv1FImRhbcmtHmyqjdAiLWWb3fwAQX4uQzLE4MKjQquCqAMoUWt/BniQZ0nA4lcFvBz1elU3L9pDXHSG9d+fJgqV4Hn+x6KJXLp+SHVTPO29cEEVEHu+79FQT3F3umllRMWFRTjF1etQmtfAHWkeAJvDIGka+5H2di2A+gWO8mayszJpXFuCGwDW+uxQZmMd6Y9rD/RWHObp7Hgy41CwjqoaTTEMvZgbA/RyuXi+G42S9meXEWSHLG+EMkVxR1rkuFKnJaYDI1MaVypKNKmIESfMPjmeSDcA3mKLs/gVPGdYeduVfa5lMHD9bnrqlBvnMMr4iED9JGxMnqgz8tNErIiUbJtYlDb0fioJk19sIpqfkdMygOe3vK5NcLQ22YVQPAa9gjpSfOCN7RKJxwETdGV3SRAy4PkkIKTHZnMwsvV9ZHlHTQ9Irj4KGKjgT6fxv0YO6HsAqw5OCSMH7Tq8DU59JiC//mVVBSCg6la07TMo2G6VvN9IGnKWBtirTp1TGo4Zs3JAeEeQZdzrPLLBoET0FM4IirBsZjLHOC4g/7N5jHOqv+ZdD8e0Kuw6qZIEaYW9MyddYUE6oyPvYu9sA2NxAVR8y6r1mfLipFQp2/7QSwMLOgqQ7YC61xOG2XfsENeyiUWhBssSb/wCPQJdEkmDhik7gqAXCM7YeFUY3YppxlSeR2WQ8yA+/lozTkkhoqLJUC931mEnierLe/DAgopXVuDYuyDgi9XfGo4uFQ3HnlPviEwVxD72BodNVot5/oLwGs8oudAema8+shRWrhE4NOcfHv2k9XWs42YAbvAAH+g4akI67l4RKAl/SQdOxdXyxV+SOcLn7P3VBPxXIaAwlKVShj/yP/WHpreW8H+VbjGG4B1JffkAssnlqQzStKZYkmpRtiWSmwoJcsz7kM26TrGk9MWKXvqca3A/Y4xEYEcreReprNIFagWiMVGVPUVYt9rILRpq6//JHqhk2fVZRXMb+v17MmVrp/bugsxrt1Ws4Z596qC0JBfV8PW3H0YjUDM548OnyZNY+D5liROwbTxvIogHFDCa2Xjj40cte9CcntETjmjQLQL1I8ursW8efIhXZ66Q7h5l0lSgWSAIMdjogmtS6LcjO0NSDLuJ7eYXifaBiw2kEy9zYlU0sCyuiX7RPUrbK51MCmPkFkfxLNkvCqH1FV5S7TP47BIVJkSGI5oVKpvGPuh8u5CiIjb6P3d2/rVDPoMSEhuXq6oAP2JNNV06+RAbOCE6lZqbOiMQqykClywVAtJLLvvLwLuyS7WGrYTk/8q98ouslMY1jDuSOUWX9IXmEtL/6rUNjB2qj36qv/NiuQHx5/P/r0/OlJeuNq4cbIFzHLRfJCtfbJt43G2rSwR6fVnDzWLtcAcUMBuY9aupGoUqZ0xE8RdkR9rLrI5Dybn7fnNNsTy+sGF7W46TJJH/ZUp5shZhvpVA23vieVVZlaAMsNrBceaoL95WH4+B/j3FyJNQgL70THRIG3O9oF8tVa7pIWnOWXIjJZIaZHWj91Zv33CIRpBzH6sD4vcPQ2MSHLpw758+N0pAO6EjkSQlSEwZ5uO08xF4+jmWaejFH6DLa5c6g3Hyssmgps1OkhlpnQTufMtb1jrnf+qSSzPhvkPTAd2p+8uTXpdAzDVar9hmzXBc++GhLp7cWYmFNeSDh5IHl24sSVjNeVsw6T0m/WjTiobw3VatSp28tq0fo8aDnKoDKwmlgUbhSkW/YZwnXCfFheaTf5UhqjYh5EbIZRncOZBSVcK160VxsdFV2a0TEQ7F99QO/TjtNVsjEr/VQ2oegpSxRYR6PQompgp8MfB+odVNlsFgnYM/c1HcKeuc1pqvozu7WZg18QEVuzMmmKznQYodOYFE5TK8p+5Z9p4e3d9xiv40sA5vFhtRfcKhhndciZJkI9c0b022VeskwRVZUFBNzTudFYeAy+J0HhnsZyANXGCxZB3OK2AmXep8EM1XHMXBnd8T7Eoe2GsQSXkIkmPovD071lUIIsxWpzDjzem38CVa6CGodLYi/ydUW0BzkLRkh6przd2V5OE9q+QyoVB45xunVYMRqocimHDCoYceaGTs/FtBYiS8PY2HtxFENxU/6Gk0l2kVGT4ezmiQyAvnI0znAPFRm2wVezYr7k2rfQzn7BozcMCR6K6l3pxf1eyjtzKZPA60pqOvZbKk3goyLH/yib/c6MTF9h7geVZXMeS8idlYhWVytQG+mULRkrThbAGxTl7Hf7i3xJg99au3qeo7tKjneA0zJHw+GWZmzFS3ZDhCOuWf44N/oQTH4+FlZX6K3dYxFeEXqfRFxU1EG1r6/6Z1tp1Q+n8q1QwnLwGpbIB0omXPdwrKD4g9Kk3zqydSVc3neVP9hXC9mYMeu9Rr145jHvk4GWsOo0Lis2QvNJCHPkfw7VvZ3mppnaK5aykfugxGqnYiN0NjRwSVQLymrO5QGiE5saVRrnBWANBlhrr/Vgm5V7qui5SU6lmhVYYSvwZxE+6H7EzT9jKqIgDsqP+ZzDB96i9yx1N8enYodIHMNzcwCBuPr4FWAt5baOYTRggIpwgNSv29qNu+Ypdb4BwMVMgn7UvWURDBCbrp/6vTjed0W1lJsi9NSPqOtfI3BoyGrnbfCC/f+6SMvHO3LLNFBQ8qsHU0mgfJxn59nU36vifMSc4nWhVYVTEW8B/UUzZE4XlxZLCHggBsW2Z34sCWmKRByLPrm4Z9WXsGnnqOC0x2rJGu7jigaPLQi4lC8fWDM3ClD0jxAfKmHyh9fFWU5woejyIdWOp1sxvfLRS93emYozKeUIMtv4ipf751Av3c1pOCrBs2MtAbAuvgZwn50c71/zqQ8yxnuzooPZZrd1ytMwCRXeQAsuSZeYryjCJQsXehC4AiOkmJgYf3jyAns8xk8hsKhN0DzidbDknjyGhG2TrgnYeJI0k5HHOGtna5TBijjsZfVFjN7wa+Ctqe5f4L9Goy5cLerXinjot915+Z6ZQdOkq1NMqQNdPbkQvbd5khItfyG2+nSPDPgLmEIqoYNyHFoFd+1u5tsnjmf/DRlpfovpTULXYLl6r4dnRBYa6YuvqL3gg/7PreDGPgg/LsIMEUYtqblE1aUpASOX18kGyqpKR4k1RZV12npImOgVb9MsOcdB2NeWHS2WEFAK0HbuNCMWjrAO4+kcn0lnKPC7m34pN2MKbqrwEqX5oBVfSjrMPHEkRZJw9/qh5ZRX7yyinuScu67oyJM9IEuHuWmXkpIeEK/Q22DKMZt/m0frTP1OatPaR6qjeDc1LvA2cNb6hlHJ+3h7C0pwYr8TYsQy9LDbOwb3TzWHGWI+s0wSWTkLKHRo4bAV2na7Swv1n57doiIFApKGiPJ67HOmIUEPdXwdlOd92vCAfUcRf0Q68Ysq62WveuH7xrQjt3s5Yt05hVz0NQseHSe20FEYVdfEmj8SJmBLucwuiDOjUXnqxJK+PcF9p8x6jqSAMeonLvzM3UCCdarvj6zNOVbB4kjJyoXvImLns+O3OI8jtweqLvzR4fNPaOVDNuxVSSk42CKlzl0tksALXC6ax4JwzTOWScx4iblv8TdhABvaf6bQ/BVqtWo9WKUOls0vJfzbmQNmtWBjYc2UWJGpNULbJbHljk6Pi8GY8mjFoaocvdK05R90aVnnNULyO+OzhMRON8LcDqYmE6yL2tB2jGvenjp0wgK0XkXdRufOTfG4EULKGpL1AMWCvyhXi/ecf+hebMJ+faEwhsvQLx83B3nl0smya+FFirZvszoNkftLIMYSePEsveXzboDfzAT0z7oFsbYtpF9bYMrPecooKcVHI30tUXkbhg3dyEnsPsgdQthY2Jku1mZZI5NU4o5a9OteS//2cMJyJtzq2bi30TVm1PD37TW8zFNplV3Tf5PnTrqaKQmavritvVQCcBiMzjjC61CjUj7N2/7zpmpwTz7D4D8IyN2kgwqB8xOZ/UZQgGCOv1KfoHTAMxxPRYADY/GSAMuo1aWswtwyMpYnj9+Tc2DZKiE+IozvBa0Ev21482ctfBx/auiiYtKfrFgPRZU3hz3F7i0az2qV5rdizh5bAC57tSaTnA81KTgY9GHzsI/kd25PLWOfCMC/HTPyB0ZRFaUIM3XY4WhhrEANsV9iXUnClbqF6gfFpRkjiTZRmWAGTJoNlrNK9QsiO7U09tuZbnITS7CvZ22ZcajRDuHb9+WSE/lL5RxApGw4N6W7+QZ5b04Q1yVVb/8ylBeyVbTEEjKBeu89VNNAo37r4Cenfn/bgbfcwrEB8sbhoT/j5s5RKyJ84vT1/Ya7fWJI6chZyYZpOUfq4rpLorNFHuIRoypooTDTkBszXx/Kr8WBmKwydC0aQTIXDrhgAB8/e6LBm6SgxBbRqeB2I+Axc4yp2aWzUSRYl1jDF/T/1qwc7qCMIH22jxYhdDrLIxir/iZesoC6ozp9m+uKMcZaWOm+2Xw+4FpMQZSZJ4dDj8zPdodKOXzRLDi0TE44ywNncx9GMhTGRniam+FWGxfXAS70SFzyL/jpXRPrQwcqymZmt2z1sslWN8KSh9qH144H3b5SFXxs2AojRfAKzYCT+gexPR+Dk6ZAVl2okHqLmDfWpkwo45C3QbEw4u+WpA1ueMX6KG2rUAXbKIyHGlJtSbMeXcnLU5Sx7/XNldJHxSOQMLgppZSsula9/L0iCifUObjIy794sMCDvIVQdhR6CiGML0Ug9TtlXKb/BuNytH5wxZBm9x9MhzNb+v/Zf+TubpYDAmO4Gioqdfyc3BBu9XmEF/gNCvRx+pEnU4gFeA04d6kY7CCdBmgq8oAMW1/SjOGhjhfIzE/+QiqXfHNVwGxhcHGCCLFr0E8SN7UMXkuhfufdvqWKWzFwrnQjhIZUfwHfCmjjtaHCh7cjh+6SYEZky/2aF/pObEhtYEiiZtCyS3DYLEuSoqJ4UUZQp5Nq4ynipi93aqYHyvvJ3rl6FTGMzARF6TER7PTg9idycWMIWe5a/xPShpbO/Fyd4xbqt8oCyHYdPzCssxmehiznIENCz8Mof4E1x9ktFlpEAehmK8QFirLrjGn8hawL726AV2Lb+xDXdum5dPTcJ0rTMeETjvmRT5zapYdL/uwo+Q4Fy+dFuBcYsIDHpKOwfqIM0UKOEr/nTrYMFWb0dyyhkmtm62ahMDnkyC/l1C7spTrdzWEmC/sVYjlRCBDrdfB15Gq9uf4SQK0XiY/7amFMoFD8bYehA3C7i+TN3CuZar1UqlED6m4vrCA1205Y05f9aPaAxUJ0FOiOrS2ELAWGjJ1Yt7gvrA9EAYgyY4YsXOEhM9wq/+NpNvwYvuaAmeJQktTV1ksQiavmyT2j7IHpASzJi+rvBo8NejFYR/ZvC9ZsZ6FpQXYzaNtHDOUMhUgvX2XLGtptEbOWUDy4pIYwqc1UbHSYHxe/KU7XlqFFvm1kw2GUatN2bIVJm5JdoA74DrDlbjJYq3gagtYXyuLJCWhMPV8NKWTiG/R8lMnJcA2s2P3+bGtPlYgNdD2wQ8Cy9RRvBf9eBg2bY5MCqjrxyZN/esmtPz8FRC/uR7ZImE86mwnBns405or0v/pManoeJf7wpdbCwuODRRSn2RpXLXVka5xEQYYTH8UGOLkhO52gvjU5yFRYYaS+RbH8DYKqR6Yvwv17LBS8HDmnRfooBhba45uRMJz5esQSf7cjVu4OSt6y+o26I6Q1gLuuZr8y0ZaxPCEW9igD1gWwh4q7hTij6GbwQ45PIlmqPvrkMOFnwuq4uEk5jz9Meo6gbPH1erPnhgJCOHsa2y6oE+dAeLTEmrB3kxd+LpHvjbwrItfGvyhf11bH9ymTX2zWSsg1UFGeTQgcslVabupinRnF396jaZ+BikD9N8JJXBs6o0KQByM28GGlT+ofIKyhscxg5DIV/9GM9VdnFiSP5mDM8bs9Tf2aB+I+1Q7+iib1YpQb6M/sC7gqRFLRXPkWpxH+70Fmzn4Q9gt3obfGjqmR9RvXRxr1U3pfNwYmTu098G8T6cBAhA8A8j5nWg9k+HdDLRJKH+asGN7gi2RXUxKF47W/DUuFz/0XFl9OP5SYgqOIQIFYMR5DT2vfk2ex2BIcTSaftdaUiXJnaaPctXvlti8bHpYpRdaim0DeVvMqK09evzOCUEoUzk5JOV/cS5Ff9AzKdLFk/E0TI8ObqWpGn4jsYeX8HYPGr1YlNimUzym17TzXJ6FWOLv3CcboA4BZEYNY23qYx2wZdFV0zY3SGa9nnaOyc8bhl+ObPYYJOQxZurYJBQ4oHtyXmYDU9Rgvsr1rIXlwAhGmSPpPLALKKycVsQ1314zbMcprCsSgbKZ4R9anYuNR/pTGp1Jr9kWRPGQguIJtun5BzCyKgWlFWCf9DQdroVrjld1+WihYEmv/3yCFbWG5zF+8ZOSi9tqQEAZIth1sxgb//EoJi2ohmzILOyWhcOI5yHa4AV5TSJhO4Xb4oH285/yvQDSZ/b+UvRW4zjpPrCbb0rZOtBSvnguPfR/k2aAbHTXMzP2yGCrsr9RlgLLx33p1JgKPSrBcjDkbTLlhUmA4/9gpFc/oVIU4IXomQuUQt2aRjoad0EglMwiMWVPF49SGAOpEte5LhKSD9HXj5CTvkfURmZhoRV2ynnyWWt4tA33fJTClXjvrzSoxkSNphCj6p6QRKncV310RxZvVR32hF55cXefmx5Er6oA5l/S5p6G0WCh64ZuCw/YkyN/gTRRBexEaSBqip8YJ91mKy2FMLzaeeAJuDlorxcge/OjG2KMtpvgIt79eHqa1VTaruoSN+eBuEKqxO863dODtb+gQaZIYt/Ke5PsR7xkX3kYjFUS/vmXcoN1ZDbYIrCPrflmWBZ1ffHIdNry+t71T2pdOifW2LkWS8SMpAqa8U26IQAt0Je41BLAPAtUNgwh00i1YNbUhny2FldnwrYn7qyN47nLF/n0qnD2LR/mZhJbJCC/z8sHHgBiZEqbAzZonqV0M431kBZbQ4PMYhpzMMVunDT8Esfn3mkyV+mV1h0Gz5l4QPm5HcbYnI40C/67eF4Iz6WwZCvKpUA4KWldJANl9256pxImQuwW7ZvJE7A7RrAqA51LtV6heC80HPCDpjISr8GPgB8SMrN2GTLBzn8QTsWqOxNNLEWfSi7qBK9I6j6saB6aDdLqBaynpNxSqaP/U5HziBEIILBPY7VUU6dH9TAkjU3S5loEstRf/NpT5QOP1JGHykVMSSE/9EbAZhGOP2vtyZWT5w/3ABLCdKf+ApKzluTXEPItAiCCpFQ73lqItTkJQ1rljYK1d8Qo1LklmPpInX2tTg5JEXbQqGIna6Wuq9OaHqh4XVYYin4amtp64/TaMW1AQkXh5LStlRKPcgl2CExCPQgKW4KkTNaBwxAJkl+PYfeXZwdIqX6CmBdfKGcUIyJkrV8ci/9BLLcb/A9aAFn9kZbIMVWCVUUIPapeSaBAgt8wT3M9csGrOWcxy9xROJZsITPX/W7374BM7q3tkIHSzMcTwzt32oGx0PEtLcBcUm4pMNDnCo5hNEZHfsr+s501jEl9BD14QRb5u7C3i/ouyyQQ8yhBQaANnofgA0glp+TYj4HlH1GLKNIiARxiMMA5GKJub4h6ZMXG22sNikasKBnADR/awIdHvugHWCe/m0u/+R60aEL7Jldj+k6utasHQXQzzduJSVIap5M6zrNC4t53StKpv4tBRvNA/eIlN8AoskTwxwUioagd/4/SqoYUYO8mPyO81FRUtWLff8eTTFJYGGAv27u6l+9wuUmaK174ofVjFUgUdG3Vsl/6M7OFuoWUWo7QbM9MEWDdlrFKfjnzYtaFl6kgqd3q27VZiiotVDoT5SRbIOQMJqmdcFd1NXeG85JqhiyvtRCddMhHBCpTRT7LyO1g3Y9XfkkWZPp3sTEtcNACsyxfjTY0P9lNSfDtp/TaYbIvCJVQUI6a/8mun9L4pz1K149VC1KaLynDU1CIX5wjHyjihWhZAQzWVQreFH32S+8LfWfruuV1epHGf6uJ0WTNWC1LILdI+aRk/id7YpK4bRStjGjI2vm6gA9ArjNc0b5hFDXYCFrnaFfg+aM3H6lZSsbVGmc8MBzdULoQ5T6nxnlpE2N1BAPGNQb9tFQVeD51YacI3+F/OQC+WmCIBGJSWxA5t8DD5V7pYViVqFE+RBaNhwjEWc+2s3mZ7S+PXU81Lm1GFyEW3iXsYv3ccIZ7EJy3cUzOv8rnvqOkzdwaQfacJetTozES2fLcnwWyLMoVZbH/zKbbkGzlkH9l4eDh54D+79PESXHjYugAZsvEKbmZgC1M3MFHF+b+TGR4CO5IXfMOBLcHH2Civt5Fea1oe+d3y3DM9Etgch+IipZPyxnxWznPfoQdUuHPTiZx3etg7CbT9MW0chU+7zMxjCXWFI4efz6SieSvXPYxu/FWDwKXqSoFmH40ZWYmp5OZPddX8S2OSCwkcCoBB8HTGlq07ZiYxFmXVR2p3VqSNLupmJNKSEuP1BrYeNX90cdtgSHdqTCZxccQj6FD+XxncYGTvw7651+CBbGAMwM0i/YSCKXtHSGjrehuIE+2E87A3S4BPNZvBTzWMcphOI8Y+BHFjMpa0rKNd0CF2IUtDFwVCxJtBki0w7EbtSPVUNutPYuPkpy7zilYCMcUFDcwxCcppou+34N1byVzFUKWcqrrLqx3SUjR6aBDw3kZ433Gk2BSWYr9Yg45XEYuBDGrOKACsdp83P/ZKhCn+YhYPreCExnCZ1qG6IOUsF/42teSSynBwM0/wJ8CDKXGea7GS0xrHibhDhxwc030b/8eGiTN8Qm0rQZ6JPHroQHqv1Wkfu+lahm73LA46Il13s6/w2Kyy6x9uf0gVsi5hWM0RLLuuCToFeJtdWjnh3XEDF3uWf0rDI395Dol8wFa92+OH1ttX89Sa1Q+t7DhMO0JsuaGq6kl2VzcaL+jCLJ9r4KPa57NZ0VjzK0miVEIdPE5ZzZmaHrMxCjlWcYcNVBmg9+dsA23BUg/UmFw3DI3Wg8zvpcQguaWN3yhFIcLvwNP6CezyeuvAnn1lt64Mh/QbPFIcwRK53clu4GDcqRWyjYgasv56tY20+Dwkuf3N9ZWEm2rCxyrP5QPKXaK7Jb7jf9IUYS1L1MXdhCQlEvF+Fj66CpizCh93pB8EaVlbA2dNsyZXhfj37RauMjXznWtU1KNILDjYQuCkv+zI1m3C9qfUYRgb2r/79OaFbIondKkPjCGN9MX8IOvDJ3PNXRls/pBxaB2wzI85efpjlrakKskl9qTqS5EDNpxGeGaiYuA5MNMq9sv9iSuVHK7TWDXA+mcTXZhzV+QkKSqhqiI/UpbwLIBQOEqDLcoPBtJq0mb+oy45GbhXC0qm8Ek2nT3LaPunU/ZGR30/wOO9N/ixgN5sgGVkgJkyNvDXpdHgaS97U28RXn4w+die+4A+pHar6FWgtRR1fhYuqjFmwSF3JvetyZRvplj7gCaRgZH5QFjiiCp7A7Sw6N7nZxBMkKCs2uYKhzLY7sWobNi84Fuol39LG6e1Z1XwynfNBhiFVyfhBAe4Djwg5XmDnv+sNlPn1J3ZVffVkwkDgWFQJytFXBdwx/ycrRaDfOkDlRNvqZUnndP+VaDifzUw9MrRwo0MoBTSgfDdQf48jbg/lo+vIwy5YUAqozfzX19KxeRh0UiAu8gN33khd+y8q2hwC7WxcS9RzYKH5EqfkMOAOOGtMRSttsNWH21kDrkGy4Q61Bg45JHZGjpWEHsapPyBmE0aYfr744HGmhAFd7+TKzgfVd4z1vjFs1Xga8foaDSU9sMYSkc9VscNVnxvR9pnmB+z8oHoPg0kT7AMSfv76jia9GZbjhVc4co1PoByBOYfqU23SPoTSLHF5uowdEoj/i0B9pN3ASCtGnunHPhFwJWJJIjtDybIA7t6Ea7S2Ev81L5ZTcp0HJ+6VNm42Uk1X4pW/ty+MpfbHc15LTGXz+3b/u1j/uzeVzvoIe2dPFezQloOHzonbPKTjFydPjjkEfA2u1kKaCFd0Vb0GIkAXr0oy2CjnpFiqJ+HyPMfKpV25XOTy7FNSHBlZlKwrmskIwqLJ4VIaBpE3kMRUGbuc88toSbFLpVW7iEDWMKvGkWrnM9zlfHToNG4YovCQhMtyOqLggD6Iau2Ekwbkj36sVxaENEZktLy25Sh88yVg2oDv9/UCp+RqDza6d6sYFokjhO9bDiEs7EDgbiSPEgVzCK80yJXvm8j5ZdpszX0CCFMqmovcpXSB/Mh9mhkNPRvh4N1jTsHAhiu54pc2WuEDszTYFwF3NwHn6e9yuTsEYMX32JzVAqRfXShXirrIR8qhKmiaB7PMz6zk9/WRo7gexcnvBgicP6sNA1B50grhc/ZxbddexztwSmApSTNLS5TtD5IO93kJhAWgYw8lZ2X5GEVk8NfaZNQrp0Z+9/LHmrMRHuiZjbj1ZyvmebKBcAnPRs/kosB3TtZfu/8EX/ca21y+wh4DF+gXuTtxVHsbK0fWuWgcSVh8hGW6IVi+0KB6XK18tqFt2hrnRK7dYSONn1xGx+bj/zcMfFaOeKb6W3zPzM5wuTSeDZJNzjroUZ0x4jfDaF0SuBLQ5PVvg2IEGxUHR7cVgPybanQ2KQbtObDlJlx6NleK2j8qG6FnQ2Y9u10BFmPKySyMk02wdHmkYYAAjQmcffzhXRfofIrKIvcyU71XKq1DTL/QxrJlqb5vgsa1f/Kb066Jzg+Sg1dzL91ZZX3SoYM0TeFoOGdY9W0vBGjq+5KeY3eiuLAOZp/+y737xE0myugnlh+RVUfjbMOuqBJGn+abApBZt1UPkw5WhfN44fJaLijpwBJmErB6ecCI8+GyQOwiCKJYaio/JPrnJ18IBhSDngc7/C8q23UTohj80I3FtzKnxUcBciCmfpZuH2MLX0usmCanAFjcR3xtGoiF7jVKeLNY0ogDTU6W2lZ0wLRR5sTVnMOuDrVOfl8VPVgR2RqYNOYZDkYS1GQrmbNeiQ0f+2DD4En9ZPBOL6jl+KDGY2qjE6A06QD4TOpNh6qSu7GIgazgYYX52pUOfvPOeLZX/h5TS8wh4TiHvPujB5IbPi5z2sC3PrlPrVrop8urMovs3rNjw3iJ33UKeTabqkZB4MVg60wBv5WC4QvL3MGrs/XXSx7mZ9G4eBXfm3W578pKWYRfMdvR3UQsoq7XHoJoa7M8smbU9SkNoDK+uJPlAweqiLkXhicEt30AWpvO+rqzRKXQQnpNNFHpe2bYhCbOtxBjXlhNXVw3RAYF3lpll89jMhEcn3aLrtzffibyhF1/b8JQITvS2+APjMIrCxihqpmwH4EqMsUE5KG+02G+ivgXiL76R9aSC7MafoSfTNBiZ/6CzguisRQfid+mTC+Jc2lnuwyn9Dykr/kcsKxYYqtvcPnRnAOZviHClwrcchv06uep4IyfceL8AG7vpJJL+5qvyo1kBs42m3mEdCbh/mHidUoLRMgT8Dh4eE4HtgyEmh0MszKJ8m6tP0uksARBI9X4hPGV65OnHKPJrcG2IvyHKKRwPrwLeKwWvoUa6+MhiNJdXKr8VVIM9U+WnOPL3bj7oolhL73CcdRs6kvfNc8twxSz0o5P8IvP4OxDCh4h9eRyWTvq64JmljJc/joRhQ3mOsOjAIJYInVwBiuL5hqHHD3M9KynO4jCbd8/yg6HEFtSJdYDj1T3wQm3AS+mOzAlTtHmV17ZelA+ncnMKgMnwHSUgf9bNR28W12KSKoLTL10nH/fwd4MsHy6z2IaZsqFFrubF4BTLr7V/HjD17i0I9TLuSbtmILQpAwVqZM9sRWHFwErezf99DpnePb5hKjc5BdtLXDo0i52ttLct5hG+Ij1Aikfpk8ng6tzZrAs111CgGllQKsqBkgL0ivbih/MX0lbKiBMplYnjwuUbaMVK5AhoXenDcG1PSc0cfmgm8WocFycF/5Id7coufA3tjeyHmp2rSghUoirMx0JPXBGnPtidYrMjuhUsmfyxvlPXhKfaOpn7gzIpVEY4X0rKlWiEeO4Pr9TEzdU6NMI67/dQlogCXynUo4kYHJvPzkRWmnAv2jMbtApVeFMbclRbGyWTb4fmL0xEZrlI4FumKVVjEjLABf37ZspQFavTI738N7PtFTVDvcvU+ttTXtx5EwKtbTy59g6fM5HoVHAmwGPuCUc6PFMtE7Ye1ykK/h0ih5WNApkbqaT3BDjZLJj37vDouTDaUhUQPU58qICy1WRBl6DoHUwqF9BPKHMBjnThR7xhqxpxdHm2MdIb2jxbe8bqL/ZBaG/pHoc3BqWuEadNZLEC4bhRqhXG3UqBuHn/pKU6ZoH4X/JoSnuSf5RmZLhvk2DZuSMG0IweZizoACQlkkPQPTAR6w4JpBrn3EUmZXoAMLdL2q+ctlcesbzXV0hRa1JDeuAFlr3s25oX2Gs9mOCOi5fgIQ4o88liZdD0fcFMMny7Lu9bTcmE4JGs6OVOdhgpUXQxphxFXfv1FPn1WOLh+MekoNcP3W6RYo0BSor/5hUnFs4YiNDMYiBRMFl4oU6wtElf1UDyTw+iN9X8i7wfHTCh3nl0y8SjmA3XHjlFM2nrw5qqChSImvR3KAK71yIeQv3glcNt+d+45u156pknQqIrd5RjsBidQDhIS0e2yqNPSy2Qb9C1XRudetf+ynydfeGX/89gfOVGoMX6031KnsDeAMGswbSlF/eh+nRXIfGYBp+sNJwhcVB8Hj3ednYtWRTVvo83UPx+6YmeeYPes9rEtOKw8uTMKRumIA8pSXdCZ4Dm4eANii4smmNDqmB9EmS/2wEgt7W+hvI71NK/TVlTAvG/Yp+nuGPvdqAiUdLNfpG8YqsfXHeCo91O9+64dvWjAvg9/u7py3svvRkl3nDDSXtpOnCeUarBoTkizKuxU+GyYYbuCgZfwkOmpru7LI+niqcI7ugxAK5iYG1163AdjXzhxw5nn5Va6YXd5s9jyRiaWzxOn6hYXnIvuxsYF+z1cUCIa3Ssr6j4LpR38zgaq2mTCXa7BbJGmXSV0DdIB4hENYHlZMHooYEIGnyH4xpKdH8yM+XQDHtB/CVLxLW2hg+YL3+Wj878iKTo1GKCJqZKUcRWxu2F1PPvAoai4se8puis7TV04Z8AWF1gpn7gZnIY3ze8tECT81O6pkSLCDgNCUdeksurP9/217BbJQ6tAurNb/w1ezPNA3rsJxggMaTzRDcqAEQcUIR6wkn1VSF+a9FnkHJZbOQaoNSIAOGDaPq9N4alPUiO7qeH3EiXxdqJZkrg9aC5LMbhuyGg1lnn1AbALMyUkYNLkBDtLawqtXmuHOM0EACbYfCvDEN1hHY+86qAlpjq5PeLwAyNlbNiFyJpy1OnyvKkRJ9Eu7UVGGtVFwGEBYs1jo6yGmG8q1iT+lZ604P2EHOYyJpC2n188lfhl+d3LQQaYcn8key2vrUdUOZBFrqjAbUepdTzIdrnwE0TYZy+dRxlMDQNXFvkyDzWxs+Tdde57bNVE+nOXfw4NxQMQHbCV8zKNJVjP9SPY1QSmehiuq4qSBlpblYHHE9M4spqqQrKVRj7OoWxcwd9byJekXo20Jw+hv0j4+esmRtQsDfcx1/cAZ/a85Fe7xGHU0sQVMRb7pE/pOcFCf4iNCoG2sV1O4jxFO06hCgRHIDarRmwpUAtW10He+gGmX482yD+tC9+v8wn2Y2o7dV+W6DbIol1qYRDGnozfRE7Pm8YNWnnzpaz7dlxyRuVzWvA6It+WEhxWWP3Mg7URSkxey1BxcptIvCGvIuyHab8Cq9dMtrqXh2isDa8fqOjKerrw5A2APdxxSM7dHN4ulOG89C5KnALuh6RUtw+BKxY4tOFZnesYZ01IDsW6va1T48snVAxYDxHV4dkBA0N2QMpv2Kdg5PZ3pJ7r2SxU+1Yj9ME6g3sW55HHu9gb5o6YyGPjsP33o5fSW5g/Cfu0gMYLL7LCRM5tdnqEBDyTjFnfuG9E4bn+mq2WrGGGBOLEJdOTa74Hh48NYDfzDz2emrvvoTBdAxANqe7L6Wmi504Wn+veqpBbIIv5K4lj3FbZfTq7cHBWlTvx7f13Ci2fD5hchAP6R8QLB/RuBQgM7J1hlWxnYb/6ZlYdDwU6RapKaTEAIS7Y7Dne7NeuD8METrZQvEhEFtTfZlKNsh772t8GT0fXwPpZnVrdRi+ebNKcZ24bLTmkxk387K1LlwOW8766DBf2fph0Ef9+4/ckgK4egjjEEnBqjl5pw32E6nsOL6HqM2Uus1d4/BgjoA5i15+HImnNanke2KaBlfe4kahgH/uIoVYei/OxnrLMlPZoomw7P9EIlZCZs2ZiDtUgk5aXJLmkxAcNLNXVQzKWpfQr2Mno1+JYaWtT6jWXjQXFv0J6HTpox0GcSS003J5gQHsFzL+XcipNQnLjuJyhzw2mzs9Z7kzm0tmZYhO6TiC3RQ7zB4d+aDjw8NN4ChJHHeGzmh4S25b9XEs9TLHrEM4mB/9yHXisosoROIr5a9/OeDKJZ3Qv3SQzgRr1RYTF1NYraX7kBFFvnVXmXbNzwNoEEG6oMmsgWW++uZlueKtotXRRLzYkc5MqWYZj0wECviFwExVhdL6XePRXX63eCxRr2xOF+JPhTdJe2VNuV1EoOtv/ldCJdNoTVgON0lzx9rdKSVwwFoMRdfUxD/0aOpre2e8N6yTCCB6Y6EDmhU4guckGzWe0ztdojym7i70DV5F6FVlO/kWDDVOScK3P1s1Ri5TDWPt6o9AA/iHRvVdzYYl93fSrE3eYiozq4FdkidKFa/9b9Hk3UfOfhA/SHnaUeHEuDGtZDZfMmVY5fA3ZU82VozqRveE1TL8SopxoRoBZ/S2b95zr0lXx04J/ZD5s3wzhfkyd+tNx/6j7uh3zHogKmTiX0OfzQYvc1lPJMuTOOPjQCmvq+f5g+uE5WUcsoUMHSL2VXw6siaA4wffxFvMSdm7e6+KoBruIG5jZeEI0PvPzreKhBvi8PEdO7kdc4NpfXkEjUaDzwho+6yYchqjtR75E8UCReDerK4NniNYjXGuPJ6jGE2kNXykxMzz/pgIwrOqmWDazcIu/khvnM7eHMC66bJ3lbKcXNUlcM/YSuRSuVAf7CR3BBZDzSMiHgpwAeWVGtUuRu8gC2X5pKr4H6f5b3AJKPF64pmkOUah86Z6SQjy+abiJGZRf7yxYdZQ0WB/H12mNIg6rdNCmKj/szFG98GhyzaA2lHVQ8uJIS9qlL/4q2Ty74emY/WsrhDtSV3m2ws1P4qAIWEDMOAPlFaOE7JTsB5lPruFHsSS2GOFR+hgJpTtUvDlZNCvs0d1XEAhc1wnrio7FpcxYc6CmJCsJLmul8iT4z+Oz3zS+b77jgkkAY+pBtMvoiUoyeTLZ4K/LMGPjG6SII1hyr1GgEZAaFrCP3QbBayEY5vX+pbZlZsM11oJ3/gVD+eZrXAEtLOUG93pqYQkqO+1LV6vZ8Ta3pZ0jqxglC4zAa3tkPQPEYkzxIWiaCD7JxfXj+SzSyx6/TYa5aHy33R000hyIjHR450bHseFB/zrsyXZYzxUuFHTyyLXa+WV8TibQkPcbgCELfzZl34iT6ksiyessyqiMQqNZm6QEupm9Rm7ewSdBWOiHHKJB2t6sHfEo8i2gXIclsAUR62+s6aHb+9J+SX6kfQLX6Sb2iF33XK7BwshWPyJM0+Pgkd/x71zMGUmwWpwJbv03zAWatOhnwrfDQUGcTENytj9fjhlOVNIlOaf8+9r8FlEPCtOLNizZmef01zySI2yTBUJ0U28ESs2lm1r+05XcaV0jA16RC1CJ4CLAB1mz4r1qdc8e03GzVYgV+bfbb9pQiRQ8sW1l/oxDqCNRSQ57NELrv7RehcraNfjgt7YWBCQfxhwk4DXQxAeEFK5OevL4txImhkVzrxtI3iTAyQ3S/mHIK5aATl9sVQ2fjvNK8BgryKHIQS74+3ru3TmwsCleA7dIIsKV/v2z+Kb/pa0sq7i8zy4STATcoplqXUbPjq6r4EG+lXIU4AKtL327caIxDIcM/U0BdLMk/0TKkZXG3zplIgWU0VBeOvJgRAEEnB98A64DD9nrXTLLxAFnHsGAMFPUQ2OxSnKIPkt1pCAAvXO8Mejv98fzZoKlWHUJfvX8d5KKrbktU1NQcdto13rzRFGaJt5i9cfOjZB1DbKmYu/FF6fbMwC69Pd3sWXAhpzjleRARkXoeaoC7Q96sdJd2NMFySx7UaM3Yq2o/nxbo8aY+mVvNHY9MCvqoqKsG+79JAVDw7ekzomAo+MP6Au7a45maM0VowFuuNfRyhIhHykgDo31ZgLQzu2zavcUJGRLf3fy/okfduH4gW0PoP98Sp9RQZbSx65/yEwj5QhWv/xH5QfwcPSMlqNkM+rz76fCkXknAYh4MOO6g9OEUTz+Fu2L0ttF3oKYMqOzXw6IhoOHOkVZXS03uhr7t2WixHKr098StcaalV5WfLl7hbbBElaAMeXixL1aORgFUUCU+8KGykwFvA19fqZPj5gixOZcDfRsgnKl5QXsL2JK979fKo4zoIDOldQjDbVokIgVAV5geE+Lfv3V5h1SY48wZXmWekA2qPHWcEalasRmwJge5/kRXUvsYGE2q5fu3U2kPD9tOHngoBbNy7lep2ixkB31dK9NeT0t/WesPRGzK3DUHgjUTI/dwt2NR6DUbHFEWq0Kz76elP+wJhT8e/YPGBfP8AUY1QJ2+amN2ol1Y3XnIncAx8wjQNgNldA8ISkUY+ZpznMGGzXt2YGjr1UVN92g+Yxyv6apkoHSke2pH5A4F6eX+y6pX3QUOdh8d238O8DnncMzrSlfIBlErugQ5bEoTQ5sZRAWOleggtEHwujB4ybLQvbeHYzMVeALLwPl8omLdDWyJCQ0bPzFT5jvoKUU='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'citation_metadata': {'citations': [{'start_index': 7815, 'end_index': 8108, 'uri': 'https://github.com/AppScale/gts', 'title': '', 'license_': ''}, {'start_index': 12875, 'end_index': 13157, 'uri': 'https://code.djangoproject.com/ticket/33524', 'title': '', 'license_': ''}]}, 'usage_metadata': {'prompt_token_count': 25793, 'candidates_token_count': 15, 'total_token_count': 32327, 'prompt_tokens_details': [{'modality': 1, 'token_count': 25793}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 15}], 'thoughts_token_count': 6519, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -61.210872395833334, 'model_name': 'gemini-2.5-pro'} id='run--d33c708a-3052-4d31-b024-9f8bd307ba80-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'tests/modeladmin/models.py'}, 'id': 'f49fc129-9013-47d6-a41c-12c9c0823b9e', 'type': 'tool_call'}] usage_metadata={'input_tokens': 25793, 'output_tokens': 15, 'total_tokens': 32327, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 6519}}
2025-10-06 20:03:46,675 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_write_node - DEBUG - content='```python\nfrom datetime import date\n\nfrom django.contrib.admin.options import ModelAdmin, VERTICAL\nfrom django.contrib.admin.sites import AdminSite\nfrom django.test import TestCase\n\nfrom .models import Band, Concert\n\n\nclass MockRequest:\n    pass\n\n\nclass MockSuperUser:\n    def has_perm(self, perm, obj=None):\n        return True\n\n\nrequest = MockRequest()\nrequest.user = MockSuperUser()\n\n\nclass RadioFieldEmptyLabelTest(TestCase):\n    @classmethod\n    def setUpTestData(cls):\n        cls.band = Band.objects.create(\n            name="The Doors",\n            bio="",\n            sign_date=date(1965, 1, 1),\n        )\n\n    def test_radio_fields_override_empty_label(self):\n        """\n        A custom empty_label on a formfield is not overridden when the field\n        is displayed as a radio button.\n        """\n\n        class ConcertAdmin(ModelAdmin):\n            radio_fields = {"opening_band": VERTICAL}\n\n            def formfield_for_foreignkey(self, db_field, request, **kwargs):\n                if db_field.name == "opening_band":\n                    kwargs["empty_label"] = "I WANT TO SET MY OWN EMPTY LABEL"\n                return super().formfield_for_foreignkey(db_field, request, **kwargs)\n\n        ma = ConcertAdmin(Concert, AdminSite())\n        form = ma.get_form(request)\n        self.assertEqual(\n            form.base_fields["opening_band"].empty_label,\n            "I WANT TO SET MY OWN EMPTY LABEL",\n        )\n```' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 26532, 'candidates_token_count': 373, 'total_token_count': 27225, 'cached_content_token_count': 24125, 'prompt_tokens_details': [{'modality': 1, 'token_count': 32378}], 'cache_tokens_details': [{'modality': 1, 'token_count': 24125}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 373}], 'thoughts_token_count': 320}, 'finish_reason': 'STOP', 'avg_logprobs': -0.10583873472648396, 'model_name': 'gemini-2.5-pro'} id='run--94e6bbde-33e5-4d3b-8e85-4ef8becc9e2f-0' usage_metadata={'input_tokens': 26532, 'output_tokens': 373, 'total_tokens': 27225, 'input_token_details': {'cache_read': 24125}, 'output_token_details': {'reasoning': 320}}
2025-10-06 20:04:13,342 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content="I've analyzed the project structure and the provided code. The code is a test case for a bug related to `radio_fields` in Django's `ModelAdmin`.\n\nBased on the project structure, the most suitable location for this test file is within the `tests/modeladmin/` directory, as it directly tests the functionality of `ModelAdmin`. I will name the file `test_radio_fields.py` to clearly indicate its purpose. This follows the existing naming conventions for test files in the project.\n\nNow, I will create the file with the provided code." additional_kwargs={'function_call': {'name': 'create_file', 'arguments': '{"content": "from datetime import date\\n\\nfrom django.contrib.admin.options import ModelAdmin, VERTICAL\\nfrom django.contrib.admin.sites import AdminSite\\nfrom django.test import TestCase\\n\\nfrom .models import Band, Concert\\n\\n\\nclass MockRequest:\\n    pass\\n\\n\\nclass MockSuperUser:\\n    def has_perm(self, perm, obj=None):\\n        return True\\n\\n\\nrequest = MockRequest()\\nrequest.user = MockSuperUser()\\n\\n\\nclass RadioFieldEmptyLabelTest(TestCase):\\n    @classmethod\\n    def setUpTestData(cls):\\n        cls.band = Band.objects.create(\\n            name=\\"The Doors\\",\\n            bio=\\"\\",\\n            sign_date=date(1965, 1, 1),\\n        )\\n\\n    def test_radio_fields_override_empty_label(self):\\n        \\"\\"\\"\\n        A custom empty_label on a formfield is not overridden when the field\\n        is displayed as a radio button.\\n        \\"\\"\\"\\n\\n        class ConcertAdmin(ModelAdmin):\\n            radio_fields = {\\"opening_band\\": VERTICAL}\\n\\n            def formfield_for_foreignkey(self, db_field, request, **kwargs):\\n                if db_field.name == \\"opening_band\\":\\n                    kwargs[\\"empty_label\\"] = \\"I WANT TO SET MY OWN EMPTY LABEL\\"\\n                return super().formfield_for_foreignkey(db_field, request, **kwargs)\\n\\n        ma = ConcertAdmin(Concert, AdminSite())\\n        form = ma.get_form(request)\\n        self.assertEqual(\\n            form.base_fields[\\"opening_band\\"].empty_label,\\n            \\"I WANT TO SET MY OWN EMPTY LABEL\\",\\n        )\\n", "relative_path": "tests/modeladmin/test_radio_fields.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'citation_metadata': {'citations': [{'start_index': 532, 'end_index': 790, 'uri': 'https://github.com/typeddjango/django-stubs', 'license_': 'MIT', 'title': ''}]}, 'usage_metadata': {'prompt_token_count': 55011, 'candidates_token_count': 508, 'total_token_count': 57502, 'prompt_tokens_details': [{'modality': 1, 'token_count': 55011}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 508}], 'thoughts_token_count': 1983, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.5609501515786479, 'model_name': 'gemini-2.5-pro'} id='run--6bd25545-144a-4658-a5ed-ec32806284b7-0' tool_calls=[{'name': 'create_file', 'args': {'content': 'from datetime import date\n\nfrom django.contrib.admin.options import ModelAdmin, VERTICAL\nfrom django.contrib.admin.sites import AdminSite\nfrom django.test import TestCase\n\nfrom .models import Band, Concert\n\n\nclass MockRequest:\n    pass\n\n\nclass MockSuperUser:\n    def has_perm(self, perm, obj=None):\n        return True\n\n\nrequest = MockRequest()\nrequest.user = MockSuperUser()\n\n\nclass RadioFieldEmptyLabelTest(TestCase):\n    @classmethod\n    def setUpTestData(cls):\n        cls.band = Band.objects.create(\n            name="The Doors",\n            bio="",\n            sign_date=date(1965, 1, 1),\n        )\n\n    def test_radio_fields_override_empty_label(self):\n        """\n        A custom empty_label on a formfield is not overridden when the field\n        is displayed as a radio button.\n        """\n\n        class ConcertAdmin(ModelAdmin):\n            radio_fields = {"opening_band": VERTICAL}\n\n            def formfield_for_foreignkey(self, db_field, request, **kwargs):\n                if db_field.name == "opening_band":\n                    kwargs["empty_label"] = "I WANT TO SET MY OWN EMPTY LABEL"\n                return super().formfield_for_foreignkey(db_field, request, **kwargs)\n\n        ma = ConcertAdmin(Concert, AdminSite())\n        form = ma.get_form(request)\n        self.assertEqual(\n            form.base_fields["opening_band"].empty_label,\n            "I WANT TO SET MY OWN EMPTY LABEL",\n        )\n', 'relative_path': 'tests/modeladmin/test_radio_fields.py'}, 'id': '5cd8f424-f61c-49c4-88ef-fb5b138e3338', 'type': 'tool_call'}] usage_metadata={'input_tokens': 55011, 'output_tokens': 508, 'total_tokens': 57502, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 1983}}
2025-10-06 20:04:18,656 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='tests/modeladmin/test_radio_fields.py' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 55542, 'candidates_token_count': 13, 'total_token_count': 55885, 'cached_content_token_count': 54485, 'prompt_tokens_details': [{'modality': 1, 'token_count': 55542}], 'cache_tokens_details': [{'modality': 1, 'token_count': 54485}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 13}], 'thoughts_token_count': 330}, 'finish_reason': 'STOP', 'avg_logprobs': -2.9223098754882812, 'model_name': 'gemini-2.5-pro'} id='run--b8940a68-85ca-49fb-8ba1-7afe845898a3-0' usage_metadata={'input_tokens': 55542, 'output_tokens': 13, 'total_tokens': 55885, 'input_token_details': {'cache_read': 54485}, 'output_token_details': {'reasoning': 330}}
2025-10-06 20:04:18,822 - thread-139660780025408.app.lang_graph.nodes.git_diff_node - INFO - Generated patch:
diff --git a/tests/modeladmin/test_radio_fields.py b/tests/modeladmin/test_radio_fields.py
new file mode 100644
index 0000000000..d8bbe84c46
--- /dev/null
+++ b/tests/modeladmin/test_radio_fields.py
@@ -0,0 +1,51 @@
+from datetime import date
+
+from django.contrib.admin.options import ModelAdmin, VERTICAL
+from django.contrib.admin.sites import AdminSite
+from django.test import TestCase
+
+from .models import Band, Concert
+
+
+class MockRequest:
+    pass
+
+
+class MockSuperUser:
+    def has_perm(self, perm, obj=None):
+        return True
+
+
+request = MockRequest()
+request.user = MockSuperUser()
+
+
+class RadioFieldEmptyLabelTest(TestCase):
+    @classmethod
+    def setUpTestData(cls):
+        cls.band = Band.objects.create(
+            name="The Doors",
+            bio="",
+            sign_date=date(1965, 1, 1),
+        )
+
+    def test_radio_fields_override_empty_label(self):
+        """
+        A custom empty_label on a formfield is not overridden when the field
+        is displayed as a radio button.
+        """
+
+        class ConcertAdmin(ModelAdmin):
+            radio_fields = {"opening_band": VERTICAL}
+
+            def formfield_for_foreignkey(self, db_field, request, **kwargs):
+                if db_field.name == "opening_band":
+                    kwargs["empty_label"] = "I WANT TO SET MY OWN EMPTY LABEL"
+                return super().formfield_for_foreignkey(db_field, request, **kwargs)
+
+        ma = ConcertAdmin(Concert, AdminSite())
+        form = ma.get_form(request)
+        self.assertEqual(
+            form.base_fields["opening_band"].empty_label,
+            "I WANT TO SET MY OWN EMPTY LABEL",
+        )

2025-10-06 20:04:18,822 - thread-139660780025408.app.lang_graph.nodes.update_container_node - INFO - Copy over all updated files to the container
2025-10-06 20:04:18,870 - thread-139660780025408.app.docker.base_container - INFO - Resetting git repository in the container
2025-10-06 20:04:18,870 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: git reset --hard
2025-10-06 20:04:19,380 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 0
2025-10-06 20:04:19,380 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:

HEAD is now at e0442a628e Fixed #33527 -- Removed unnecessary code in ModelAdmin._changeform_view().

2025-10-06 20:04:19,380 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: git clean -fd
2025-10-06 20:04:19,481 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 0
2025-10-06 20:04:19,481 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:


2025-10-06 20:04:19,481 - thread-139660780025408.app.docker.base_container - INFO - Updating files in the container after edits.
2025-10-06 20:04:19,481 - thread-139660780025408.app.docker.base_container - INFO - Creating directory tests/modeladmin in the container
2025-10-06 20:04:19,481 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: mkdir -p tests/modeladmin
2025-10-06 20:04:19,582 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 0
2025-10-06 20:04:19,582 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:


2025-10-06 20:04:19,582 - thread-139660780025408.app.docker.base_container - INFO - Updating tests/modeladmin/test_radio_fields.py in the container
2025-10-06 20:04:19,585 - thread-139660780025408.app.docker.base_container - INFO - Files updated successfully
2025-10-06 20:04:25,140 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'run_command', 'arguments': '{"command": "./manage.py test modeladmin.test_radio_fields"}'}, '__gemini_function_call_thought_signatures__': {'7be4ba78-e34f-434a-b9ec-c1dc7f3fe03a': 'CqMOAR/MhbYaEvuxzHKCpmPgK/17ZzRQmCqOmvZOJ1pkiOdDgXmNsd8iZKYoahrJr56uzC21abi7uhgI2Yam/rA94fMf74cyEFV5yeSbHF7Zd2acJoOF82Z49tMlaLTWZ01WQDd0c2HGvLxeih7DSG+hDRQoxqiWhd6gc6vfHpc89/S12Y3DHHQk800yRNZoF/4UYXOwG+4QNMB2Rl3sXX5ctmvgXX5H+6gHi6JDzPCj2m6dNij2fzC0XWIuyNFmXsST1rnFeJJnE7mmlbpQr16v4UdIOMGyrZECJySwg06qQwWwl529LzJwxvLOVqc8fpAWOSTMUvp947oiIU28YQ+7J/2Ti4JR8GB/HE7IrVra3YTzASGRPy/Ge0tEu1GOqJDjYaEltiSeKJeHQr0IN4au214KhWdhk56wCWDlZ17qhI5UCvFYzXEH4/CaYppCbRqTRzVMjE4iMmKR37hRGKlxLCg1j7Z/O2d1jHsvd6uX38BisaT3+YW8f3SRHN4O3vy1aWOLflvqDxVkjwohDvlRuvUZtUk+aE4uUTslgGUXWmXtlFYTEafurMFrfZ7bEtnEznpMSaHk6ODTFI1UkW9olSt+SrCSBGGbTzNAZmvrFIOzNn/VtHg4fSF6ozvCvJkozNwwnGlpf9qV80G/q3in6GMa+1OZJNnokgysGZ1g/dra9B9AoiBnemC/tzY24jI6+YKB4CDEmVi51O4FXsYSJ8RkpBwQKiC2URsWD5MA64zuBWoLfqFwSp57nNqN4mHQ15Jdt+8MMhBBskTJfoq9r8tSjZxWkpLag2s/lHdSlkwTuQr4+iMlAXi2BdhrxvBKxvQCK4ngYLkr1jj5rHoMj5TkqyvpebWWCeweiMkmrO7hbO9XLjJXdQ+IclwEMQEvXx2H3E8KZ8XAzcu1dvBtsOFhJEhw/Onnsmezdheaf9KDw1K1deNnYok0YiRhfMDMnIJQBmffav9qLBycqOsJm2GmVt/ZoqTDZMjlJVeTwk1QhgtGN8pMfBAa0V/IzOo6KV4beb4vrCXg26dwqkNjLoMvbTBqrSDRlkIwL5yQe3TQdd9OxlVoijnAIIiIg5Nff/BfSWOkhbxc5B3f7LTAxWbnUhddr1NALB82fI4/oCBrY4hQBONDu1rfuI9ogTj9uOUm8sb6sDT005nesqPxWsKIdDWhVVPACwtEyaW7nsbjaVz6b1MJergnfq5ykgESvSj3MykLkwLb1do5duPQS05BdC77cy3IoqmIiZDKQVeqa3NlwShDSMDAFbq4uW4AJNrR2+SoBfE+Ctc5w73dhxZUeyLgSud6JgYg3bdGsgLaw+hCxgVfThY+nGUu5w4c9ori3RVL6ml+N3ZbQtbqhwxPJqhrZ4zrltnCIIAAcUzApT8Tmkub32jiBkC6AguplEglK4SGEuiLtvhBsSbsssYef1eNkaxVduq417nwNDMg0/2ykd0aP4Rb4hlrhZf9MOLW7vUmrJ+0sVjnZ2IQ6zWDYIwBtytsgr0Desme706AOTtXogba6w5UlvufOn2hsP3wv4ZWTTa5QZS7YYyK55HlcFtquZnc6UW8NkBYaTGuY3EJWNhYjIGhP9XAV4i0Pc8cASiwI9VG+AWfcElZNft2yaUEpmglP5gwsj3wg+tzv2VhchzV3JBUw7XPmqHB+uJ2YdATiEwBeh+gYH1gosHbNWsQYv67ILlkoH5li8THTJn67r/nXOYwo+MSV12qcVGONHtu9+OFMQmtba+N84eC1hJNLoCJpQ4k5WxWcBo0VwISbKytJr0CZw8LKdOveM1a+RhJiEHuI1SAviAMLDn8F/Q0bgSjKU4L2JbWP+RCn1yYnHdXT45Aoxq91ytFXKmpej+DfJN0PQpgXCY5SQmYtZ0K9uR+TjrZY6xOpu4Ljlw8cFbd+UAGW8vp8qpMZ7nHBR/0AlsmIBJTKWCvVG+JZZlxmL9eGqaY+eXlqFQ3G1mKuEyTinM866uacloE/a2mmymAuk2hbyLgYJR3MXaFRtn8ND5fvyUNJKsaUsjp/GH7kpd2akp0moFsDdZ/1pCYsLypbF2sf/IzQn0M7fq9feoWZFsDZFPR0c8hlhiDNtHqboUIIhFYsrxLK6b2w1+l+4CrAgIp3o/ttDcYee6K40H3+Ls0yD/nibG7FFeUEm7bzSmhOPiqksZpoFBJI8S2PZdcrZfTkUquvQIi5FFldeARbhLPeAOnAjmbbbEA1Yc2r6gqTK8Y4XGfgaBe4fEPHtaxTXC9m5uQzj9U+mhyIkPwFpiadu3+U5D7qdPJnW17KXQIBO/UikbiFP/9x2OzJ7O/+MH7k9TzmHpyg+xFMkEgDuKpP/GzhbxniNggt2G692GB30T8B37Q4kxQ4vV4kILyAcIQ3vlvEpfmIfCYW4Z1ZM7J2g+2WjSVES3EHageAmNOmwcamwTeaRIUxoIY'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 448, 'candidates_token_count': 18, 'total_token_count': 916, 'prompt_tokens_details': [{'modality': 1, 'token_count': 448}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 18}], 'thoughts_token_count': 450, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -2.436144298977322, 'model_name': 'gemini-2.5-pro'} id='run--5d15a2b8-660e-4856-906e-715d0820707b-0' tool_calls=[{'name': 'run_command', 'args': {'command': './manage.py test modeladmin.test_radio_fields'}, 'id': '7be4ba78-e34f-434a-b9ec-c1dc7f3fe03a', 'type': 'tool_call'}] usage_metadata={'input_tokens': 448, 'output_tokens': 18, 'total_tokens': 916, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 450}}
2025-10-06 20:04:25,142 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: ./manage.py test modeladmin.test_radio_fields
2025-10-06 20:04:25,243 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 127
2025-10-06 20:04:25,243 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:
./manage.py test modeladmin.test
t_radio_fields

bash: ./manage.py: No such file or directory

2025-10-06 20:04:26,922 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'run_command', 'arguments': '{"command": "find . -name manage.py"}'}, '__gemini_function_call_thought_signatures__': {'64dce1eb-8c1f-48e1-8c50-5d00d083dc43': 'Cs8CAR/MhbamaK2qfFlGu/Dm6HzoxMrMDm2Ct+uGewYi/1w/Y0IHgtj32iOCOKYcsLUH7opS8R7IAMh3TK/5gtnHnKschweKV8yMKEtBrYjVcmmML0YQFqZyHUpT8mZ0rxAwy9huCUaKs+S9OBDObgHF+68KpE5dgoEGjmpwKhGIyXDtpC/RpMNYYN2AoqY4N4zkSp594YdM+Tla4KLLPrzA028R2GQOcX43iJm3zWAgCirIOm2C2uQwxTHNc12qY5ifrSTdq6F0JchQ/nP8XXov0ft2PXLN+v4K12WncSL6u2sSKgMbjdV27BechloUTYNdLEr71nGp8zfKLpqhnUZvSFFXc7l4Qt9ImPLyjuMs+cMxtG8JY0dzUxJfdQKaIdtjr+LTgBJHhCfy58GWXmmZXifHm7gXX4pl4K2dYYWor046+itebcoN5MzxYsgBF6M='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 500, 'candidates_token_count': 11, 'total_token_count': 577, 'prompt_tokens_details': [{'modality': 1, 'token_count': 948}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 11}], 'thoughts_token_count': 66, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.8565504767678, 'model_name': 'gemini-2.5-pro'} id='run--69e7bff6-8e68-4b35-b1bf-d9dd8fc1e631-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'find . -name manage.py'}, 'id': '64dce1eb-8c1f-48e1-8c50-5d00d083dc43', 'type': 'tool_call'}] usage_metadata={'input_tokens': 500, 'output_tokens': 11, 'total_tokens': 577, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 66}}
2025-10-06 20:04:26,923 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: find . -name manage.py
2025-10-06 20:04:27,024 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 0
2025-10-06 20:04:27,024 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:

./tests/i18n/sampleproject/manage.py

2025-10-06 20:04:29,049 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'run_command', 'arguments': '{"command": "python tests/i18n/sampleproject/manage.py test modeladmin.test_radio_fields"}'}, '__gemini_function_call_thought_signatures__': {'ce310be2-a61b-442d-887e-2ae9fba09fa5': 'CsoDAR/MhbbiM6SBxPAHvJGDcKUAo+gl/fSoOzh5GufMWeRXnFbAyxUS27Ib9uVZ1UBZDG9Oxt6PaoFlwwtx6Lw5145Z8x1R+i4GMPextnq2oHVDMEAkzugciPnxhUFUONvoZZsWeQDz7J4sq7U8NHYZtIbI6FnK784xH8pv3XQF/uDobKOr/Q+8u7c+tliuEVCst4QDlgoZOSnrNjlgD5uYSxbZ/PKL4S74tgUv9tVcKGamsuGCqMHyul0egoAm3S/m7WwD4ddIkF5szHsvN5oai0En9sCenC+2yogLnckEQdPiWpvFDlUewWLEjuAmOOAhtLVXwN6os706X76+cxNMpBPaVuWbr8+2UqmLuFJ1nXzgUvx0fA5IoyUeGxeWuFH0xj/m83mXmafpSt6dbtd6Bit7ADdTYtfA6A3dKJhQ7QH5qYwTP4gz7PzwLCD1TrB64i/d4KPyPQJaD6Yu2cWiVV6iDHX1eT/ELq/Z/TyfxIBFiCvBxiuyy9U5h4TGSp4KBYHSkgDyEtLjQIxZZQKfBiOGgr2RD1SqTY9fshpgg3NtQIafPmf/a+6zc13eFuk8H01vxWdaUlZSurSp9nSdgNAgUZUt4HJZRCg='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 531, 'candidates_token_count': 28, 'total_token_count': 682, 'prompt_tokens_details': [{'modality': 1, 'token_count': 1043}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 28}], 'thoughts_token_count': 123, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.38574150630405973, 'model_name': 'gemini-2.5-pro'} id='run--90c81378-a664-446f-bea7-6ff8980cc76e-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'python tests/i18n/sampleproject/manage.py test modeladmin.test_radio_fields'}, 'id': 'ce310be2-a61b-442d-887e-2ae9fba09fa5', 'type': 'tool_call'}] usage_metadata={'input_tokens': 531, 'output_tokens': 28, 'total_tokens': 682, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 123}}
2025-10-06 20:04:29,050 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: python tests/i18n/sampleproject/manage.py test modeladmin.test_radio_fields
2025-10-06 20:04:29,501 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 1
2025-10-06 20:04:29,501 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:
python tests/i18n/sampleproject/
/manage.py test modeladmin.test_radio_fields

Found 1 test(s).
System check identified no issues (0 silenced).
E
======================================================================
ERROR: modeladmin (unittest.loader._FailedTest)
----------------------------------------------------------------------
ImportError: Failed to import test module: modeladmin
Traceback (most recent call last):
  File "/opt/miniconda3/envs/testbed/lib/python3.9/unittest/loader.py", line 154, in loadTestsFromName
    module = __import__(module_name)
ModuleNotFoundError: No module named 'modeladmin'


----------------------------------------------------------------------
Ran 1 test in 0.000s

FAILED (errors=1)

2025-10-06 20:04:36,007 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'run_command', 'arguments': '{"command": "PYTHONPATH=$PYTHONPATH:./tests python tests/i18n/sampleproject/manage.py test modeladmin.test_radio_fields"}'}, '__gemini_function_call_thought_signatures__': {'e4fd493c-08ab-4ef5-8cf9-f25eae6cec69': 'CqkNAR/MhbaEYnTvstMoIDvZ83R/DiYUMhIYXEkNudQPVxKk4llvcXRFmzPuCLOUmKG+xT47iKtZs7R2fSRxe6J1Rn9kF20hvx0V3yNRfH1pRinwd/r4XPUncMyM4HFlIqafaPERAsYZS2VtS4D1Z+Si9DfHh290IoObNwl1SiNilK8WaRNCAPR3q23wF1RqtPtJhS9UU1iRY98HJhAyYxXJl/oG7nVV94u4pU5C0fYRcPQfynyEhVgVeEU0ay7nC9FkS7T2wGKnoXZp6YHrFQ+UDZJHarVYpT40BgHZttWpN7tR4gpiaaa1bp/BNruETIFMPIPFs1ZdjjZl6sIeEqbdxUWI+MB+KL2t0mS6i6W+/7CyOJiS3q+y8iqHAKkEO/0MrOjjuDwIwUceHLeEqU1W7Ur8H2DI8yAtozYDcZrR3qw2JG1GNCugT+vlYeaootc6u13TGLH5jtIoMdVyELM3ymM+cVypCR9nyq6eaRpoC6VvqDPMSG22rnfsuWx3KtX0IZ8zGpwcZ4VACHHm4dX6SdKvz32G842XytwDWYGt9lSVfVGzKjijk/azqdrWbhb4sGSPP75MKq6jcTJ52vbb/ZxuOee81fEvRdoisGlpcNTLcls28sihVa4KFQi7IQQqAcrknTbMSEWDhavuCNgcEd4K0lrKHhZ5EIMySfmP2Xy4tP57za4x7TCoqedWbFT1pNz7snp+EI7up1BSFF8RRsWVhaxl9JK8gAY3lFX2caFXwOXlAuLnTJF/b6TOgHN/Y8UD5tKVaCwCVVUEqonUVactm9y/4yxD6CdBVCvVNIMVwFzaJgm014nfyThr+XTmm7tUYA4Nus9EFTz5QC7zUTF87cCOzOxLAneZsu9ToZ/+bphd90Vd4AKZt0wfvtzd+W9ouoOPfk76+50hfA6yY27tj0giesHP18rfFamiwXuPf6Ycdd194SQczn2PQaJhNU3byR3JKWOk8Qdu84lCxvOLJzqiG0+12HncAwqCKnxKV8O0BKgeyGt+akUZljx13M89Be8oMXD1nC6Yn0vyyGoA2DwiLYgGYySYQODjeEpo7FuQt4RyN0k0YZ3veExSv2SU87SFOxPl0+ZuSgI2R4rTh7IMRObzhT88bHWxF4nbrIXYJscz+ZyWNVPJVWv8vh/GxKB6uhIvJ+kAxtnIgjbj5z5YkRh5n+UkzRlXYO2WWgbYt8DWWt3OEcK7W7T7T2pHRVxQrQa2CXDT9Np2jcBEpyaQ0dBzPs0PEZf/0PXKfHgJWamvAg7HXw5Q5BJjwzBJmob1g+DgBXGehNlSO3h0l5UlGTzhJklsEx2muRnLdZ3nnRXkfhv0QdETSAI0ki5zYUltPWzY9QwLDgvsu7MAn+fBzYS0RHr8HZk+P1IkL93Vzhaopbwa2NRMQWGzGsHJ9z0pamT4LsvtMHEu9m7gG7RUjs8dNa/PS5vypE3uay+CyuB0cAgHj6kj6Y8iVBnGmSzwT2iJtWNOjkgzuAw4zB77bwC3HNikWnAdXKKVhnEqP0QdS3JXdTRyV4fWMVEz34PRnUn2qWdgWfZ1iZT+/HqsJuJMZ1mN94r1AIeWPad3yyQlB7cnDHdqlK/mFn16yyuHTJOFxU9z8Fz1Xq7E4CKeP39ENLv4jK3g8gETPYX7cAIzfkYxqRwQVMv6jbThsIrldryyof2Oil+kLeCFDN5ZZV6AwAx5Fc5JAiXJixSf4vwgGEDSff/jMFk7+YDlJMEf6xyDp31j+3D+1Mcl3ftKapo4QEbQTNpE6oPnic2V7qy5KwB9lJFOd4JVa2lr6EEKHDEN4Brr+dAknQmnTb9FUX+kIA5fGhBetVI8+QyRsGS8QMYDsY9l+7Go31e/uCFWCHILKE5NLia6tz0NSLm8RZAkAO+l3bTLaHDADUU2SzGeB+r13UxOa5BeWmSoBHtZHd+vQ0KHsioE/nDQUT/2d3R6Gb92Xrpz+63vppcT2hoZb0DNFKotJPkSuWEw+Q7g50oGyRgSp98dL8VpoKQf4+n8xP4m9cYSyTRke3O/6a55ZeC5Tj8ZsW0/yp85DULP7w6m2q88OGCryBpVqF9/4hrwaygDfozP6eb+g7PcliJYJUyX9fwGArZ2p7W+gAJv+3mYt4C52DyDne38miRNgF3vz1EnJMYSbcUPaocNyERBpFstQHE7OUbgkEoEWOcqm9LCNQsxSTAwakY/ge1+L2dLHS486cDWAlNTfWJZL3eS0k9YlslomCXNIbjCL076680f4ZA/SN9045B+34Ix87JJ0w=='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 746, 'candidates_token_count': 36, 'total_token_count': 1240, 'prompt_tokens_details': [{'modality': 1, 'token_count': 1379}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 36}], 'thoughts_token_count': 458, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -1.2121910519070096, 'model_name': 'gemini-2.5-pro'} id='run--65151b84-ff5f-42de-abdc-5fb7da76f44a-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'PYTHONPATH=$PYTHONPATH:./tests python tests/i18n/sampleproject/manage.py test modeladmin.test_radio_fields'}, 'id': 'e4fd493c-08ab-4ef5-8cf9-f25eae6cec69', 'type': 'tool_call'}] usage_metadata={'input_tokens': 746, 'output_tokens': 36, 'total_tokens': 1240, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 458}}
2025-10-06 20:04:36,008 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: PYTHONPATH=$PYTHONPATH:./tests python tests/i18n/sampleproject/manage.py test modeladmin.test_radio_fields
2025-10-06 20:04:36,282 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 1
2025-10-06 20:04:36,282 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:
PYTHONPATH=$PYTHONPATH:./tests p
python tests/i18n/sampleproject/manage.py test modeladmin.test_radio_fields

Traceback (most recent call last):
  File "/testbed/tests/i18n/sampleproject/manage.py", line 12, in <module>
    execute_from_command_line(sys.argv)
  File "/testbed/django/core/management/__init__.py", line 446, in execute_from_command_line
    utility.execute()
  File "/testbed/django/core/management/__init__.py", line 440, in execute
    self.fetch_command(subcommand).run_from_argv(self.argv)
  File "/testbed/django/core/management/commands/test.py", line 24, in run_from_argv
    super().run_from_argv(argv)
  File "/testbed/django/core/management/base.py", line 402, in run_from_argv
    self.execute(*args, **cmd_options)
  File "/testbed/django/core/management/base.py", line 448, in execute
    output = self.handle(*args, **options)
  File "/testbed/django/core/management/commands/test.py", line 68, in handle
    failures = test_runner.run_tests(test_labels)
  File "/testbed/django/test/runner.py", line 990, in run_tests
    suite = self.build_suite(test_labels, extra_tests)
  File "/testbed/django/test/runner.py", line 841, in build_suite
    tests = self.load_tests_for_label(label, discover_kwargs)
  File "/testbed/django/test/runner.py", line 792, in load_tests_for_label
    tests = self.test_loader.loadTestsFromName(label)
  File "/opt/miniconda3/envs/testbed/lib/python3.9/unittest/loader.py", line 154, in loadTestsFromName
    module = __import__(module_name)
  File "/testbed/tests/modeladmin/test_radio_fields.py", line 7, in <module>
    from .models import Band, Concert
  File "/testbed/tests/modeladmin/models.py", line 1, in <module>
    from django.contrib.auth.models import User
  File "/testbed/django/contrib/auth/models.py", line 5, in <module>
    from django.contrib.contenttypes.models import ContentType
  File "/testbed/django/contrib/contenttypes/models.py", line 131, in <module>
    class ContentType(models.Model):
  File "/testbed/django/db/models/base.py", line 131, in __new__
    raise RuntimeError(
RuntimeError: Model class django.contrib.contenttypes.models.ContentType doesn't declare an explicit app_label and isn't in an application in INSTALLED_APPS.

2025-10-06 20:04:42,137 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'run_command', 'arguments': '{"command": "ls -F"}'}, '__gemini_function_call_thought_signatures__': {'70c0bdde-d9a8-4ee8-bdd3-e342e13c1552': 'CqEHAR/MhbYtZXzQ/nbPNnq/avZEtEsgwMaetMjZScqAWeJTFTOUZex1mHO/WuUUcqZbrjEw6h+0H/eWx0SuUzgMwPI16rH2UNItX3ne0O2iSsfKV0EfurUevBpj2aPMG9ukDRfIpnqr95tH8OFeNhHmg3ctyO3XRx62WcmfsjZdzX0jtYVvJdX1oDj5hMAxaW5H3qUILOaBOi81CYT9d9AzbEWj4ePYYaiKNhvjgqTXajQeS9/QoahhohVAXMpOWkqYIlN94XZXiCHXVgNK78XXRZD27HA8d5HWZVVpYFEGwHMqxa6WDuXg24qf74/61n51rerrAPqv+h/XDuMigi0tmWYMFIc1sLxcaRkrKg5tCT6Ebc45mB0evX7p8nK2OCGxb5GJcBFyq5+eNxNfKMAeLB+Ft+64jO+ARjlb/gnoh/RC0ZUQqC0zwEB36wha4N2uxsvLkvHtlE9AF/hyt2MlEbHcavNu6xdTjlAofS50rKJ3VaEP/bGB9wrmWEMjbhiFWZu9EAMujfk/2ItM5l9ONnaYtgXDniSjaqOby1nDHbfmeBt9Rf3fPQuNceJnxq9RF0cowAmwhHe+mQJ3DJu9S12IXmtnzqPsFmKrqmrQrDfCVoLowmOYSqMUH92hyKfAOe4Z1MwE0gnIbjTnLObgx5OGiu9huFf6dByX7CRJvoHO0Hq/ltVvLBkNGHRkqm7h6xrZKx/PB+Lqk30vqBDaDZhkznLTwz8MCbTXr0Evw3+OMy+o7saaMZVbKD57Yl6AqLTWd6X0VN9tbyxyKvUvgYaxbYEDBwmaVqQ65fAioSLL5fDHPDlvgmKYl8PQx00hCQNTp4VimqfeFsWHTP9cIZAR8l46cIIScV3j+RRlysX9iTPQ2AAgYZiBa6POXgnF5vuZ3dk0uzDqaderQUfqVFCCoLTzgVQE+hWy5fx3/2L4l8xo7+Q7UwfoyjuYW2uR+rq7T7N5e3CTTXDW5AjBR/8VKJdMfs55R2NgMgctkZSEZAiQLvz2lK20WS3lKVxUFPc6btbSUcsM683HEyRTGSKhGNkRjed7Bfn+618bpAgF8GBE8Gs8qY984CCDDJokGKrSKI7PZ2WoTkNxQBoat25wWsDLWH3QSV78K+sfOa0EMeK+Bg1L2nAL5l2zLLFUPlFAIHZw1frGOgS4nBJmtHrgJvaeTPekw3neAnbHAEoyVDngV5LwVUxhDLQohf0F98WNpWSBDqJYgJX1j23rugY='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 1527, 'candidates_token_count': 7, 'total_token_count': 1862, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2616}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 7}], 'thoughts_token_count': 328, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -6.465187072753906, 'model_name': 'gemini-2.5-pro'} id='run--248ca301-7eee-4424-b116-2d19e503fd68-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -F'}, 'id': '70c0bdde-d9a8-4ee8-bdd3-e342e13c1552', 'type': 'tool_call'}] usage_metadata={'input_tokens': 1527, 'output_tokens': 7, 'total_tokens': 1862, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 328}}
2025-10-06 20:04:42,139 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: ls -F
2025-10-06 20:04:42,240 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 0
2025-10-06 20:04:42,240 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:

AUTHORS		  INSTALL	  README.rst  js_tests/       setup.cfg
CONTRIBUTING.rst  LICENSE	  django/     package.json    setup.py
Django.egg-info/  LICENSE.python  docs/       pyproject.toml  tests/
Gruntfile.js	  MANIFEST.in	  extras/     scripts/	      tox.ini

2025-10-06 20:04:43,907 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'run_command', 'arguments': '{"command": "cat tox.ini"}'}, '__gemini_function_call_thought_signatures__': {'0b4d3853-f2eb-443a-98a1-798d7493dd98': 'Co0CAR/MhbbfAH7X+h7bqWvSyXKtBiPih29fcIH8PY44KUjF3HL9DETDv9uWE4rnji01skHeUb4mzouIE4JR7qmj9x4voPO7Ru3NzLvrQoRRW23R2/yNvLUjsJ/5pSTNaKt3k/cK8rQmbu2rxeecAkgOUzzpexYpeiNzS/yb2GNxasqv+Zo8hTXD1nqLf+NmnI2Lgp58ofus6WXs6uUh0qXIfNEjazi2cr8tAaW5cpefMBV/IkYkWkGtRf1KEq270dTgwWLRuA6g4j8CpqqZ51WYFrs48OiAAOwcmC9J9tIMY5LF01jCopNMzpXbR8QLRot9e1PNRqSG3TkFDshq49ND89ZASgd9P2RZ99Ypm3I='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 1623, 'candidates_token_count': 8, 'total_token_count': 1696, 'cached_content_token_count': 1661, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2932}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1661}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 8}], 'thoughts_token_count': 65}, 'finish_reason': 'STOP', 'avg_logprobs': -0.4519307017326355, 'model_name': 'gemini-2.5-pro'} id='run--f85951e4-3c9b-472f-8eb4-f466ab451b17-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'cat tox.ini'}, 'id': '0b4d3853-f2eb-443a-98a1-798d7493dd98', 'type': 'tool_call'}] usage_metadata={'input_tokens': 1623, 'output_tokens': 8, 'total_tokens': 1696, 'input_token_details': {'cache_read': 1661}, 'output_token_details': {'reasoning': 65}}
2025-10-06 20:04:43,908 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: cat tox.ini
2025-10-06 20:04:44,009 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 0
2025-10-06 20:04:44,009 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:

# Tox (https://tox.readthedocs.io/) is a tool for running tests in multiple
# virtualenvs. This configuration file helps to run the test suite on all
# supported Python versions. To use it, "python -m pip install tox" and
# then run "tox" from this directory.

[tox]
minversion = 3.18
skipsdist = true
envlist =
    py3
    black
    flake8 >= 3.7.0
    docs
    isort >= 5.1.0

# Add environment to use the default python3 installation
[testenv:py3]
basepython = python3

[testenv]
usedevelop = true
# OBJC_DISABLE_INITIALIZE_FORK_SAFETY fixes hung tests for MacOS users. (#30806)
passenv = DJANGO_SETTINGS_MODULE PYTHONPATH HOME DISPLAY OBJC_DISABLE_INITIALIZE_FORK_SAFETY
setenv =
    PYTHONDONTWRITEBYTECODE=1
deps =
    py{3,38,39,310}: -rtests/requirements/py3.txt
    postgres: -rtests/requirements/postgres.txt
    mysql: -rtests/requirements/mysql.txt
    oracle: -rtests/requirements/oracle.txt
changedir = tests
commands =
    {envpython} runtests.py {posargs}

[testenv:black]
basepython = python3
usedevelop = false
deps = black
changedir = {toxinidir}
commands = black --check --diff .

[testenv:flake8]
basepython = python3
usedevelop = false
deps = flake8
changedir = {toxinidir}
commands = flake8 .

[testenv:docs]
basepython = python3
usedevelop = false
allowlist_externals =
    make
deps =
    Sphinx
    pyenchant
    sphinxcontrib-spelling
changedir = docs
commands =
    make spelling

[testenv:isort]
basepython = python3
usedevelop = false
deps = isort
changedir = {toxinidir}
commands = isort --check-only --diff django tests scripts

[testenv:javascript]
usedevelop = false
deps =
changedir = {toxinidir}
allowlist_externals =
    npm
commands =
    npm install
    npm test

2025-10-06 20:04:48,632 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'run_command', 'arguments': '{"command": "cd tests && python runtests.py modeladmin.test_radio_fields"}'}, '__gemini_function_call_thought_signatures__': {'e784f4f4-856c-4f7b-800b-81444a01e25d': 'CqwHAR/MhbZrGQKE3ZOgMi5qaRtbmhX9YNXZIj6AUnvJMGuTwaOHxzJ92CXaDbETajcBUa9KymLA2f55U4vUSajMtDpyZv9v1yy8iwNKPUfM5+vuDELi9uuYu86ogg33bUEMxXtPAIGOx0pKgae6V9ezy/BuKHtWoq4LBb4GAtZR7NxPGDzfOAZkiXC5P31EH8mR3sDJJ8CBjtwo4GBtQ51m7gzOSvDVDHmHYJZfR4ycGEk+2GfhI5fRz4RlO3+6fmKna6uyEg2odPRLwDUo3dJTrH9aaNmLhv/k+p8YuKRtdS1UgunNGCrKa5KP9h8xQ3mB1MZUqOCUw3M/Q7zY6ejrDQ3EsBbRX5m1/t/3kF3WxybsNLi2HQDeTP4ivwo/32ByJZ5Hl/7yjOi6SJDr14+kqHVTAwX/bxmTHto69E7tTiuIlh6rtBfI+8tPitomoWfiCyYVT400n+zEylhjZAhvWKmE68qgKaECuBwQP/63SW5eGWftBbjUB8RgF0gnpph57WylHKDt0w9q1lV41n2M+hWP7bA+Q2XtJcOTWfWQDBen67JvVApXt6C+00AnXZR49eUx73au7nnfXdwhT4eqNLXANZXa/L6KQILMa0MxK0PoTHBAY+6+UIF6RwVs6LN0Z11O1avTDUFBMkbAjbCSs+UKxcu+wpI+lwl0SrEXaAhS/JERpidex+rbL1AcpXka0/1gOfzAd92dcBqZ6IFZl1N6JbrYHkf0QuMahyprE1pMANkO80U9iDHbQ8kvNt2bpUICnmw5+776xE9eGEUzdq97kQF0e5MWhjfye5YsAxoarZPJBAXjVhwyiv10uFNcDH/aXDW4ePKaH44Y0/jY92bqH6J+9VIvs4HoWbKB+mDdUDdr6Xw3Gtynuj6C/+VrTpDP4+4nDYpvfyNoj+QmrZ8r44UttDZR3VzGVFeYP9kwm54RpMqSLOUJlZ0o71catStlAtaIvMZmfqcHTqOPk4Yzw+KW9ithzbhh82h241FhpuSbGqEIjdcDdF2G1XejDCHppMuk6XIOxD1efFj7/46iliToX6yUGXmGzLfvOHsLEezA75KflNu/xIeS5Z+i+WhZBQW3248HoerTsxgRkOiCLFzy1Zd8mYn2GThEM8hCr3Ibf4AVnNSrYy8zXVYwBdZZ3XN/3QWshIHj4rOqXyozT9MWC91qOYk2tOQ9SbCEX90lfoIueeysJPzamViUYeUpdCuwemkowVTBqTS++iZUvRIV34EMFEZ4JA=='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2179, 'candidates_token_count': 21, 'total_token_count': 2436, 'cached_content_token_count': 1678, 'prompt_tokens_details': [{'modality': 1, 'token_count': 3550}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1678}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 21}], 'thoughts_token_count': 236}, 'finish_reason': 'STOP', 'avg_logprobs': -1.415107908703032, 'model_name': 'gemini-2.5-pro'} id='run--94fcfb6b-4426-4ff8-a9e1-ea10e027eea5-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'cd tests && python runtests.py modeladmin.test_radio_fields'}, 'id': 'e784f4f4-856c-4f7b-800b-81444a01e25d', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2179, 'output_tokens': 21, 'total_tokens': 2436, 'input_token_details': {'cache_read': 1678}, 'output_token_details': {'reasoning': 236}}
2025-10-06 20:04:48,633 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: cd tests && python runtests.py modeladmin.test_radio_fields
2025-10-06 20:04:49,017 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 1
2025-10-06 20:04:49,017 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:
cd tests && python runtests.py m
modeladmin.test_radio_fields

Testing against Django installed in '/testbed/django' with up to 8 processes
Found 1 test(s).
Creating test database for alias 'default'...
System check identified no issues (0 silenced).
F
======================================================================
FAIL: test_radio_fields_override_empty_label (modeladmin.test_radio_fields.RadioFieldEmptyLabelTest)
A custom empty_label on a formfield is not overridden when the field
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/testbed/tests/modeladmin/test_radio_fields.py", line 48, in test_radio_fields_override_empty_label
    self.assertEqual(
AssertionError: 'None' != 'I WANT TO SET MY OWN EMPTY LABEL'
- None
+ I WANT TO SET MY OWN EMPTY LABEL


----------------------------------------------------------------------
Ran 1 test in 0.001s

FAILED (failures=1)
Destroying test database for alias 'default'...

2025-10-06 20:04:51,398 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'run_command', 'arguments': '{"command": "cd tests && python runtests.py modeladmin.test_radio_fields"}'}, '__gemini_function_call_thought_signatures__': {'aedb8cef-d782-446f-bbd9-6bfc2c0ffa39': 'CqMDAR/MhbYrG3cL3KucCi2P/SVK5leBO+cCdwiwtsEK12V6zXAlBkxMp7kCKzaUc7LPMlaa02Ot06GTmJcmtrrD/GxPuBh+EecbATSusPMHEWsexgp1b3TcvX6ruBmozX0P6kSuBVaq6vRVGgT8WH9kCh1I6mQeCnurQmm+gD8wwVSGSQFwJH4sNgDE/HRIIMlybVlq2at8gVEka04CKNi4nPZZVPLMkZUlSX9wob/+u8dm6sziBcFLzqw9h6VugY50kgnbBJ45MmCqzLZ42jDj7YQSY2bAoQS1EHZYSv+l+svNEnQk1VJHcrEVCq8c4MM6XAex+W3+fIXqmV0bjH2gElqbQEn1Z+QvqGQroh0KL0W4jfgywAAOtNmv8Qwo44bn4lXsopP0jr/X+/88Y/9lvxoOSa2ODZ7jsRaYeRTaJ046e01ln+vYThKnMnNjBvztV51VrIqLabq8Li6uyEgSLXtBNZV8qB05+qEEaYvyubJAzcYB0VaDirNxtTR9fvDdiHNiV1I4GM6PrAvBkFQ2fU+Lr7OnwDDshqcPFj7/l5znNXw='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2449, 'candidates_token_count': 21, 'total_token_count': 2561, 'cached_content_token_count': 3394, 'prompt_tokens_details': [{'modality': 1, 'token_count': 4054}], 'cache_tokens_details': [{'modality': 1, 'token_count': 3394}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 21}], 'thoughts_token_count': 91}, 'finish_reason': 'STOP', 'avg_logprobs': -0.42378911517915274, 'model_name': 'gemini-2.5-pro'} id='run--17381f69-446f-4f1a-b37a-531ba152a0ec-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'cd tests && python runtests.py modeladmin.test_radio_fields'}, 'id': 'aedb8cef-d782-446f-bbd9-6bfc2c0ffa39', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2449, 'output_tokens': 21, 'total_tokens': 2561, 'input_token_details': {'cache_read': 3394}, 'output_token_details': {'reasoning': 91}}
2025-10-06 20:04:51,400 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: cd tests && python runtests.py modeladmin.test_radio_fields
2025-10-06 20:04:51,501 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 1
2025-10-06 20:04:51,501 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:
cd tests && python runtest
ts.py modeladmin.test_radio_fields

bash: cd: tests: No such file or directory

2025-10-06 20:04:55,058 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'run_command', 'arguments': '{"command": "cd tests && python runtests.py modeladmin.test_radio_fields"}'}, '__gemini_function_call_thought_signatures__': {'24e96dab-2a6c-4e87-8eef-14040ca97dc4': 'Cr8FAR/MhbZ+JKJAsFEqdjPjArtS9uA7p3WL6EIR1YQsXxs1+FdSFjc03QduTBIK8TPnCjKwzB2dAjcGHbAOPAdNI5JNhwQ7FLrQdD7hIZjTJe0Kuz66kzQpMNKtUpmuIgFRNcCMq//KY6rruvvCE34l4Lw7lXayMDozLMzzSDrVS8SurzhQo17guhVSQVZTX+xPij2Ms3374ZzC7Q9QahH2EYxsVpoJ0+bCEHsx/gtPkIyAqqr3RUTnArCMa6r6awGWMOJjg2zMJzhEPkqaogA4tnbLYabSipCiOV53c4nMmwYKqcK/FSn2Tw5k3ATUSuM/sVqA0g+yIwwCoe2R4XDRMg248GqNKejkXqpnAwtCCsNlnVZpmPo2WPz9CuM+MuW4fstEclhxFzBnbyeLuTDmzHHe50xTeWNTugPAMXLqJNgF9n65g0TWNNinWG5oKHzAq0j8V2BtleWXNn25dcMvUch5co9rD7OI/3xYW196oWsNCUoC+ZXOyi53jctbnFMiuXbV2S9lfk0/js462MQdObBskh1sH9f0xLDCC65tdJbi3Aa+ovkZpk5x/6HWpoM+BTHZgl11FOg4oI6/HQzRCcejS+ua0VzBHHBN/UOdIdKJmhlUk07MVe5S5T5UOK1Luc7nXmd/3ckie292i+elZFhU9t2wZqXJ3LueHL6evI6lvN00UwA/JfDL/br4GKmtmQlCOgal954vKhiMbtYKc0lWNdox6A/IPGql1Jm2rNEhes5FX8XKRYfjCWXf+B8BqCLW+KNRG7dtkfJz+Bja9T/PapzhoWDX67tdwrkGaSPz+Akc9nwTGW7uIz8bRbyBqiC5veX2zGcSRXvR3hU5kI6dsIZrym0yW6SURiL6jMlCdbp5zhTYUVbr6QyWy5WIh4xnfT4b+W0veBsg/rtbSWphsfQ7lnawSkPIjlOKlA=='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2506, 'candidates_token_count': 21, 'total_token_count': 2690, 'cached_content_token_count': 3389, 'prompt_tokens_details': [{'modality': 1, 'token_count': 4200}], 'cache_tokens_details': [{'modality': 1, 'token_count': 3389}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 21}], 'thoughts_token_count': 163}, 'finish_reason': 'STOP', 'avg_logprobs': -1.0681428455171131, 'model_name': 'gemini-2.5-pro'} id='run--b3653c9f-7be7-4a4c-93b4-eb535962016f-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'cd tests && python runtests.py modeladmin.test_radio_fields'}, 'id': '24e96dab-2a6c-4e87-8eef-14040ca97dc4', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2506, 'output_tokens': 21, 'total_tokens': 2690, 'input_token_details': {'cache_read': 3389}, 'output_token_details': {'reasoning': 163}}
2025-10-06 20:04:55,060 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: cd tests && python runtests.py modeladmin.test_radio_fields
2025-10-06 20:04:55,161 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 1
2025-10-06 20:04:55,161 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:
cd tests && python runtest
ts.py modeladmin.test_radio_fields

bash: cd: tests: No such file or directory

2025-10-06 20:04:56,787 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'run_command', 'arguments': '{"command": "ls -F"}'}, '__gemini_function_call_thought_signatures__': {'07de7453-e34d-4a46-ab89-45ca9a4424ee': 'Cv4BAR/Mhbbq9o0KPWDDodL4UlPsUp4/hjKm99JzKOG+Nv1cVVd2jxRm0nOKhSbJBnXgaDRfGOXl0WvEm5YefWIAXjF4vaaCC8vaVRDbZgFAjSXk+R0JDN1/X6uNwit2oQuv7vgAMf8cEDyyliFmD5lDNHe4mfTGPmh7kCAP0DJ5VDd4LBqXS14XP0Qhxi+/udE76WDC0amgXsmns5ynO6GZ+i4SKavmrbYaOaxtKsLZqvJdmgs7A29qPwtftKnIfyqLxJvtducTFoWiMDarC4uGqyw7BqbSOtX9kgyW3FJ5vMAqmLb//fhgg5R7+sOClwoBuKlJmoqnXHQDzvYhdPM='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2563, 'candidates_token_count': 7, 'total_token_count': 2623, 'cached_content_token_count': 3393, 'prompt_tokens_details': [{'modality': 1, 'token_count': 4418}], 'cache_tokens_details': [{'modality': 1, 'token_count': 3393}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 7}], 'thoughts_token_count': 53}, 'finish_reason': 'STOP', 'avg_logprobs': -0.6160635266985212, 'model_name': 'gemini-2.5-pro'} id='run--ea296c9c-b143-4fdc-8394-23360fc130d0-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -F'}, 'id': '07de7453-e34d-4a46-ab89-45ca9a4424ee', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2563, 'output_tokens': 7, 'total_tokens': 2623, 'input_token_details': {'cache_read': 3393}, 'output_token_details': {'reasoning': 53}}
2025-10-06 20:04:56,788 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: ls -F
2025-10-06 20:04:56,889 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 0
2025-10-06 20:04:56,889 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:

README.rst		      m2m_through_regress/
__pycache__/		      m2o_recursive/
absolute_url_overrides/       mail/
admin_autodiscover/	      managers_regress/
admin_changelist/	      many_to_many/
admin_checks/		      many_to_one/
admin_custom_urls/	      many_to_one_null/
admin_default_site/	      max_lengths/
admin_docs/		      messages_tests/
admin_filters/		      middleware/
admin_inlines/		      middleware_exceptions/
admin_ordering/		      migrate_signals/
admin_registration/	      migration_test_data_persistence/
admin_scripts/		      migrations/
admin_utils/		      migrations2/
admin_views/		      model_enums/
admin_widgets/		      model_fields/
aggregation/		      model_forms/
aggregation_regress/	      model_formsets/
annotations/		      model_formsets_regress/
app_loading/		      model_indexes/
apps/			      model_inheritance/
asgi/			      model_inheritance_regress/
async/			      model_meta/
auth_tests/		      model_options/
backends/		      model_package/
base/			      model_regress/
bash_completion/	      model_utils/
basic/			      modeladmin/
builtin_server/		      multiple_database/
bulk_create/		      mutually_referential/
cache/			      nested_foreign_keys/
check_framework/	      no_models/
conditional_processing/       null_fk/
constraints/		      null_fk_ordering/
contenttypes_tests/	      null_queries/
context_processors/	      one_to_one/
csrf_tests/		      or_lookups/
custom_columns/		      order_with_respect_to/
custom_lookups/		      ordering/
custom_managers/	      pagination/
custom_methods/		      postgres_tests/
custom_migration_operations/  prefetch_related/
custom_pk/		      project_template/
datatypes/		      properties/
dates/			      proxy_model_inheritance/
datetimes/		      proxy_models/
db_functions/		      queries/
db_typecasts/		      queryset_pickle/
db_utils/		      raw_query/
dbshell/		      redirects_tests/
decorators/		      requests/
defer/			      requirements/
defer_regress/		      reserved_names/
delete/			      resolve_url/
delete_regress/		      responses/
deprecation/		      reverse_lookup/
dispatch/		      runtests.py*
distinct_on_fields/	      save_delete_hooks/
empty/			      schema/
empty_models/		      select_for_update/
expressions/		      select_related/
expressions_case/	      select_related_onetoone/
expressions_window/	      select_related_regress/
extra_regress/		      serializers/
field_deconstruction/	      servers/
field_defaults/		      sessions_tests/
field_subclassing/	      settings_tests/
file_storage/		      shell/
file_uploads/		      shortcuts/
files/			      signals/
filtered_relation/	      signed_cookies_tests/
fixtures/		      signing/
fixtures_model_package/       sitemaps_tests/
fixtures_regress/	      sites_framework/
flatpages_tests/	      sites_tests/
force_insert_update/	      staticfiles_tests/
foreign_object/		      str/
forms_tests/		      string_lookup/
from_db_value/		      swappable_models/
generic_inline_admin/	      syndication_tests/
generic_relations/	      template_backends/
generic_relations_regress/    template_loader/
generic_views/		      template_tests/
get_earliest_or_latest/       templates/
get_object_or_404/	      test_client/
get_or_create/		      test_client_regress/
gis_tests/		      test_exceptions/
handlers/		      test_runner/
httpwrappers/		      test_runner_apps/
humanize_tests/		      test_sqlite.py
i18n/			      test_utils/
import_error_package/	      timezones/
indexes/		      transaction_hooks/
inline_formsets/	      transactions/
inspectdb/		      unmanaged_models/
introspection/		      update/
invalid_models_tests/	      update_only_fields/
known_related_objects/	      urlpatterns/
logging_tests/		      urlpatterns_reverse/
lookup/			      urls.py
m2m_and_m2o/		      user_commands/
m2m_intermediary/	      utils_tests/
m2m_multiple/		      validation/
m2m_recursive/		      validators/
m2m_regress/		      version/
m2m_signals/		      view_tests/
m2m_through/		      wsgi/

2025-10-06 20:04:58,991 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'run_command', 'arguments': '{"command": "python runtests.py modeladmin.test_radio_fields"}'}, '__gemini_function_call_thought_signatures__': {'f1a6308e-9837-470c-bb96-c375429a7a4f': 'CvACAR/MhbZXueWSATbcMUFdAaoDv88G5Gpff83c0bhla7W15zKfp3TXX7FisPSCLgoxbBKlfwmdsy+4PZVo6HFi2NdpZnf4YovkCQyeJ8O5azS1DWmXURWUPzyLFlFBYJ1MjphZMpcSPHL1VecCcQBAiVRRC1K0g7IwsUedv2QKxmKkKY7IMicyaldkbKMiUX4a4LLTN7UNaLtqvvmoy6HVPfereje01YcN8S800DKVsn0ORxIT18VfVkWatrwWdN3Mg1dsfQ6ieoGgd1qs2k2dXFVIAx3xZHTsZu6zFh0NWHTCyRp3/Kai+wTgMUbJzkBj0SD4imUxyCpmkeuwQrOjarLP+0KAJRDzGRTckR7V06fi3o2tGGz80vRBCY4NobQI1Inm3PJQbWw93qWVuGIuYcEEq0Kx9GHb0EcdlY2rlbxZKsOecueWL68SSAF06Hi+ifu1HxA3BUsh7kANh7w9ia6gC+Wyp++luIfIMZK7Hv0='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 3798, 'candidates_token_count': 18, 'total_token_count': 3905, 'cached_content_token_count': 3416, 'prompt_tokens_details': [{'modality': 1, 'token_count': 5704}], 'cache_tokens_details': [{'modality': 1, 'token_count': 3416}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 18}], 'thoughts_token_count': 89}, 'finish_reason': 'STOP', 'avg_logprobs': -0.5843737390306261, 'model_name': 'gemini-2.5-pro'} id='run--0e8db0b1-38c4-474b-a746-aee0667e6db4-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'python runtests.py modeladmin.test_radio_fields'}, 'id': 'f1a6308e-9837-470c-bb96-c375429a7a4f', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3798, 'output_tokens': 18, 'total_tokens': 3905, 'input_token_details': {'cache_read': 3416}, 'output_token_details': {'reasoning': 89}}
2025-10-06 20:04:58,993 - thread-139660780025408.app.docker.base_container - DEBUG - Executing command: python runtests.py modeladmin.test_radio_fields
2025-10-06 20:04:59,311 - thread-139660780025408.app.docker.base_container - DEBUG - Command exit code: 1
2025-10-06 20:04:59,311 - thread-139660780025408.app.docker.base_container - DEBUG - Command output:
python runtests.py modelad
dmin.test_radio_fields

Testing against Django installed in '/testbed/django' with up to 8 processes
Found 1 test(s).
Creating test database for alias 'default'...
System check identified no issues (0 silenced).
F
======================================================================
FAIL: test_radio_fields_override_empty_label (modeladmin.test_radio_fields.RadioFieldEmptyLabelTest)
A custom empty_label on a formfield is not overridden when the field
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/testbed/tests/modeladmin/test_radio_fields.py", line 48, in test_radio_fields_override_empty_label
    self.assertEqual(
AssertionError: 'None' != 'I WANT TO SET MY OWN EMPTY LABEL'
- None
+ I WANT TO SET MY OWN EMPTY LABEL


----------------------------------------------------------------------
Ran 1 test in 0.001s

FAILED (failures=1)
Destroying test database for alias 'default'...

2025-10-06 20:05:02,944 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='Testing against Django installed in \'/testbed/django\' with up to 8 processes\nFound 1 test(s).\nCreating test database for alias \'default\'...\nSystem check identified no issues (0 silenced).\nF\n======================================================================\nFAIL: test_radio_fields_override_empty_label (modeladmin.test_radio_fields.RadioFieldEmptyLabelTest)\nA custom empty_label on a formfield is not overridden when the field\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File "/testbed/tests/modeladmin/test_radio_fields.py", line 48, in test_radio_fields_override_empty_label\n    self.assertEqual(\nAssertionError: \'None\' != \'I WANT TO SET MY OWN EMPTY LABEL\'\n- None\n+ I WANT TO SET MY OWN EMPTY LABEL\n\n\n----------------------------------------------------------------------\nRan 1 test in 0.001s\n\nFAILED (failures=1)\nDestroying test database for alias \'default\'...' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 4062, 'candidates_token_count': 224, 'total_token_count': 4354, 'cached_content_token_count': 5133, 'prompt_tokens_details': [{'modality': 1, 'token_count': 6055}], 'cache_tokens_details': [{'modality': 1, 'token_count': 5133}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 224}], 'thoughts_token_count': 68}, 'finish_reason': 'STOP', 'avg_logprobs': -0.021386563777923584, 'model_name': 'gemini-2.5-pro'} id='run--0b7682ac-58d7-44f2-96f8-f7b00718e688-0' usage_metadata={'input_tokens': 4062, 'output_tokens': 224, 'total_tokens': 4354, 'input_token_details': {'cache_read': 5133}, 'output_token_details': {'reasoning': 68}}
2025-10-06 20:05:13,370 - thread-139660780025408.app.lang_graph.nodes.bug_reproducing_structured_node - DEBUG - reproduced_bug=True reproduced_bug_failure_log='FAIL: test_radio_fields_override_empty_label (modeladmin.test_radio_fields.RadioFieldEmptyLabelTest)\nA custom empty_label on a formfield is not overridden when the field\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File "/testbed/tests/modeladmin/test_radio_fields.py", line 48, in test_radio_fields_override_empty_label\n    self.assertEqual(\nAssertionError: \'None\' != \'I WANT TO SET MY OWN EMPTY LABEL\'\n- None\n+ I WANT TO SET MY OWN EMPTY LABEL\n\n\n----------------------------------------------------------------------\nRan 1 test in 0.001s\n\nFAILED (failures=1)' reproduced_bug_commands=['cd tests && python runtests.py modeladmin.test_radio_fields']
2025-10-06 20:05:13,370 - thread-139660780025408.app.docker.base_container - INFO - Cleaning up container and temporary files
2025-10-06 20:05:13,371 - thread-139660780025408.app.docker.base_container - INFO - Closing persistent shell...
2025-10-06 20:05:13,471 - thread-139660780025408.app.docker.base_container - INFO - Cleaning up container and temporary files
