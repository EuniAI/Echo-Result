{"instance_id": "sphinx-doc__sphinx-8459", "repo": "sphinx-doc/sphinx", "version": "3.4", "environment_setup_commit": "3f560cd67239f75840cc7a439ab54d8509c855f6", "patch_list": ["diff --git a/tests/test_ext_autodoc_type_aliases.py b/tests/test_ext_autodoc_type_aliases.py\nnew file mode 100644\nindex 000000000..d3ad353fa\n--- /dev/null\n+++ b/tests/test_ext_autodoc_type_aliases.py\n@@ -0,0 +1,53 @@\n+import sys\n+import pytest\n+from sphinx.testing.util import SphinxTestApp\n+\n+@pytest.mark.skipif(sys.version_info < (3, 7), reason='python 3.7+ is required.')\n+@pytest.mark.sphinx(\n+    'text',\n+    testroot='ext-autodoc',\n+    freshenv=True,\n+    confoverrides={\n+        'autodoc_typehints': 'description',\n+        'autodoc_type_aliases': {\n+            'JSONObject': 'project_types.JSONObject',\n+        },\n+        'extensions': ['sphinx.ext.autodoc', 'sphinx.ext.napoleon'],\n+    }\n+)\n+def test_autodoc_type_aliases_with_typehints_description(app: SphinxTestApp):\n+    \"\"\"\n+    Test that autodoc_type_aliases works with autodoc_typehints = 'description'.\n+    Regression test for sphinx-doc/sphinx#8233.\n+    \"\"\"\n+    (app.srcdir / 'project_types.py').write_text(\n+        'from __future__ import annotations\\n'\n+        'from typing import Any, Dict\\n'\n+        '\\n'\n+        'JSONObject = Dict[str, Any]\\n'\n+        '\\n'\n+        'def sphinx_doc(data: JSONObject) -> JSONObject:\\n'\n+        '    \"\"\"Does it work.\\n'\n+        '\\n'\n+        '    Args:\\n'\n+        '        data: Does it args.\\n'\n+        '\\n'\n+        '    Returns:\\n'\n+        '        Does it work in return.\\n'\n+        '    \"\"\"\\n'\n+        '    return {}\\n',\n+        encoding='utf-8'\n+    )\n+    (app.srcdir / 'index.rst').write_text(\n+        '.. autofunction:: project_types.sphinx_doc\\n',\n+        encoding='utf-8'\n+    )\n+\n+    app.build()\n+\n+    content = (app.outdir / 'index.txt').read_text(encoding='utf-8')\n+\n+    # This assertion will fail with the bug, showing Dict[str, Any] instead.\n+    # When the bug is fixed, it will correctly show the aliased type.\n+    expected_param_line = '* **data** (*project_types.JSONObject*) \u2013 Does it args.'\n+    assert expected_param_line in content\n"], "arch": "x86_64", "base_commit": "68aa4fb29e7dfe521749e1e14f750d7afabb3481", "test_directives": ["tests/test_ext_autodoc_type_aliases.py"], "coverage_files": ["sphinx/ext/autodoc/typehints.py"], "env_name": "testbed", "run_id": "full_evaluation", "patch_id": "pred_pre__Prometheus-Bug-Reproduction-Agent", "timeout": 1800, "rm_image": false, "force_rebuild": false, "exec_mode": "unit_test", "reproduction_script_name": null, "compute_coverage": true, "install": {"python": "3.9", "pip_packages": ["tox==4.16.0", "tox-current-env==0.0.11"], "install": "python -m pip install -e .[test]", "pre_install": ["sed -i 's/pytest/pytest -rA/' tox.ini", "sed -i 's/Jinja2>=2.3/Jinja2<3.0/' setup.py", "sed -i 's/sphinxcontrib-applehelp/sphinxcontrib-applehelp<=1.0.7/' setup.py", "sed -i 's/sphinxcontrib-devhelp/sphinxcontrib-devhelp<=1.0.5/' setup.py", "sed -i 's/sphinxcontrib-qthelp/sphinxcontrib-qthelp<=1.0.6/' setup.py", "sed -i 's/alabaster>=0.7,<0.8/alabaster>=0.7,<0.7.12/' setup.py", "sed -i \"s/'packaging',/'packaging', 'markupsafe<=2.0.1',/\" setup.py", "sed -i 's/sphinxcontrib-htmlhelp/sphinxcontrib-htmlhelp<=2.0.4/' setup.py", "sed -i 's/sphinxcontrib-serializinghtml/sphinxcontrib-serializinghtml<=1.1.9/' setup.py"]}, "cache_level": "instance", "test_command": "python3 /root/trace.py --count -C coverage.cover --include-pattern '/testbed/(sphinx/ext/autodoc/typehints\\.py)' -m tox -epy39 -v -- tests/test_ext_autodoc_type_aliases.py", "req_install_commands": ["conda create -n testbed python=3.9  -y"]}