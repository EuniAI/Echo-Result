{"instance_id": "matplotlib__matplotlib-21568", "repo": "matplotlib/matplotlib", "version": "3.4", "environment_setup_commit": "f93c0a3dcb82feed0262d758626c90d4002685f3", "patch_list": ["diff --git a/lib/matplotlib/tests/test_datetime_usetex.py b/lib/matplotlib/tests/test_datetime_usetex.py\nnew file mode 100644\nindex 0000000000..bfa9d6689f\n--- /dev/null\n+++ b/lib/matplotlib/tests/test_datetime_usetex.py\n@@ -0,0 +1,41 @@\n+import matplotlib as mpl\n+import matplotlib.pyplot as plt\n+import numpy as np\n+import pandas as pd\n+import pytest\n+\n+\n+@pytest.mark.skipif(not mpl.checkdep_usetex(True), reason=\"LaTeX is not installed\")\n+def test_datetime_axis_usetex_spacing():\n+    \"\"\"\n+    Test to reproduce unclear spacing on datetime axis with usetex=True.\n+\n+    This test asserts that the date formatter selects a compact format\n+    for the tick labels (e.g., HH:MM), as it did in older Matplotlib\n+    versions, instead of a long format (e.g., HH:MM:SS) that causes\n+    labels to overlap when using LaTeX.\n+    \"\"\"\n+    mpl.rcParams[\"text.usetex\"] = True\n+\n+    np.random.seed(1)\n+\n+    dates = pd.date_range(\n+        \"2020-01-01 00:00:00\", end=\"2020-01-01 00:10:00\", periods=100\n+    ).to_pydatetime()\n+    data = np.random.rand(100)\n+\n+    fig, ax = plt.subplots(constrained_layout=True)\n+    ax.plot(dates, data)\n+    fig.canvas.draw()\n+\n+    # The buggy formatter produces labels with seconds (e.g., \"00:02:30\"),\n+    # which have two colons. The correct, more compact format (e.g., \"00:02\")\n+    # has only one.\n+    actual_labels = [tick.get_text() for tick in ax.get_xticklabels()]\n+    has_seconds_in_label = any(label.count(':') == 2 for label in actual_labels)\n+\n+    # This assertion fails now because the buggy formatter includes seconds.\n+    # It will pass when the formatter is fixed to choose a more compact format.\n+    assert not has_seconds_in_label, \\\n+        \"Tick labels should use a compact format (e.g., HH:MM) to avoid overlap, \" \\\n+        \"but a format with seconds (HH:MM:SS) was found.\"\n"], "arch": "x86_64", "base_commit": "f0632c0fc7339f68e992ed63ae4cfac76cd41aad", "test_directives": ["lib/matplotlib/tests/test_datetime_usetex.py"], "coverage_files": ["lib/matplotlib/dates.py"], "env_name": "testbed", "run_id": "full_evaluation", "patch_id": "pred_pre__Prometheus-Bug-Reproduction-Agent", "timeout": 1800, "rm_image": false, "force_rebuild": false, "exec_mode": "unit_test", "reproduction_script_name": null, "compute_coverage": true, "install": {"python": "3.8", "packages": "requirements.txt", "install": "python -m pip install -e .", "pre_install": ["apt-get -y update && apt-get -y upgrade && apt-get install -y imagemagick ffmpeg libfreetype6-dev pkg-config texlive texlive-latex-extra texlive-fonts-recommended texlive-xetex texlive-luatex cm-super"], "pip_packages": ["pytest", "ipython"]}, "cache_level": "instance", "test_command": "python3 /root/trace.py --count -C coverage.cover --include-pattern '/testbed/(lib/matplotlib/dates\\.py)' -m pytest --no-header -rA  -p no:cacheprovider lib/matplotlib/tests/test_datetime_usetex.py", "req_install_commands": ["conda create -n testbed python=3.8 -y", "cat <<'EOF_59812759871' > $HOME/requirements.txt\nsphinx>=1.8.1,!=2.0.0,<4.3.0\ncolorspacious\nipython\nipywidgets\nnumpydoc>=0.8\npackaging>=20\npyparsing<3.0.0\nmpl-sphinx-theme\nsphinxcontrib-svg2pdfconverter>=1.1.0\nsphinx-gallery>=0.10\nsphinx-copybutton\nsphinx-panels\nscipy\n\n\ncertifi\ncoverage\npyparsing<3.0.0\npytest!=4.6.0,!=5.4.0\npytest-cov\npytest-rerunfailures\npytest-timeout\npytest-xdist\npython-dateutil\ntornado\n\n\nipykernel\nnbconvert[execute]!=6.0.0,!=6.0.1\nnbformat!=5.0.0,!=5.0.1\npandas!=0.25.0\npikepdf\npytz\npywin32; sys.platform == 'win32'\n\n\nflake8>=3.8\npydocstyle>=5.1.0\nflake8-docstrings>=1.4.0\n\n\nEOF_59812759871", "conda activate testbed && python -m pip install -r $HOME/requirements.txt", "rm $HOME/requirements.txt"]}