{"instance_id": "pylint-dev__pylint-7277", "repo": "pylint-dev/pylint", "version": "2.15", "environment_setup_commit": "e90702074e68e20dc8e5df5013ee3ecf22139c3e", "patch_list": ["diff --git a/tests/test_runpy.py b/tests/test_runpy.py\nnew file mode 100644\nindex 000000000..df781e92d\n--- /dev/null\n+++ b/tests/test_runpy.py\n@@ -0,0 +1,44 @@\n+# Licensed under the GPL: https://www.gnu.org/licenses/old-licenses/gpl-2.0.html\n+# For details: https://github.com/PyCQA/pylint/blob/main/LICENSE\n+# Copyright (c) https://github.com/PyCQA/pylint/blob/main/CONTRIBUTORS.txt\n+\n+\"\"\"\n+Regression test for a bug where pylint removes the first entry from sys.path\n+when run via `runpy`.\n+\"\"\"\n+\n+from __future__ import annotations\n+\n+import runpy\n+import sys\n+from unittest.mock import patch\n+\n+\n+def test_runpy_preserves_custom_sys_path_entry() -> None:\n+    \"\"\"\n+    Verify that when run with `runpy`, pylint does not remove a custom\n+    first entry from `sys.path`.\n+\n+    Pylint should only remove the first entry if it is an empty string, which\n+    is the default behavior when a script is executed. If another tool adds a\n+    path and then calls pylint, that path should be preserved.\n+    \"\"\"\n+    original_path = sys.path[:]\n+    custom_path = \"something\"\n+    sys.path.insert(0, custom_path)\n+\n+    try:\n+        # We patch `pylint.lint.Run` to avoid a full pylint run, and `sys.exit`\n+        # because `pylint.__main__` would call it. We are only interested in the\n+        # side effect on `sys.path` from `modify_sys_path`.\n+        with patch(\"pylint.lint.Run\"), patch(\"sys.exit\"):\n+            runpy.run_module(\"pylint\", run_name=\"__main__\", alter_sys=True)\n+\n+        # The bug is that `modify_sys_path` unconditionally removes the first\n+        # element of `sys.path`. This assertion will fail.\n+        # With the bug fixed, this assertion will pass.\n+        assert sys.path[0] == custom_path\n+    finally:\n+        # Restore sys.path to its original state to avoid side effects\n+        # on other tests.\n+        sys.path[:] = original_path\n"], "arch": "x86_64", "base_commit": "684a1d6aa0a6791e20078bc524f97c8906332390", "test_directives": ["tests/test_runpy.py"], "coverage_files": ["pylint/__init__.py"], "env_name": "testbed", "run_id": "full_evaluation", "patch_id": "pred_pre__Prometheus-Bug-Reproduction-Agent", "timeout": 1800, "rm_image": false, "force_rebuild": false, "exec_mode": "unit_test", "reproduction_script_name": null, "compute_coverage": true, "install": {"python": "3.9", "packages": "requirements.txt", "install": "python -m pip install -e ."}, "cache_level": "instance", "test_command": "python3 /root/trace.py --count -C coverage.cover --include-pattern '/testbed/(pylint/__init__\\.py)' -m pytest --no-header -rA  -p no:cacheprovider tests/test_runpy.py", "req_install_commands": ["conda create -n testbed python=3.9 -y", "cat <<'EOF_59812759871' > $HOME/requirements.txt\nblack==22.6.0\nflake8==5.0.4\nflake8-typing-imports==1.13.0\nisort==5.10.1\nmypy==0.971\n\nastroid==2.12.13  # Pinned to a specific version for tests\ntyping-extensions~=4.4\npy~=1.11.0\npytest~=7.2\npytest-benchmark~=4.0\npytest-timeout~=2.1\ntowncrier~=22.8\nrequests\n\ncoveralls~=3.3\ncoverage~=6.4\npre-commit~=2.20\ntbump~=6.9.0\ncontributors-txt>=0.9.0\npytest-cov~=3.0\npytest-profiling~=1.7\npytest-xdist~=2.5\ntypes-pkg_resources==0.1.3\ntox>=3\n\nEOF_59812759871", "conda activate testbed && python -m pip install -r $HOME/requirements.txt", "rm $HOME/requirements.txt"]}