{"instance_id": "django__django-14855", "repo": "django/django", "version": "4.0", "environment_setup_commit": "475cffd1d64c690cdad16ede4d5e81985738ceb4", "patch_list": ["diff --git a/tests/admin_views/test_readonly_foreign_key.py b/tests/admin_views/test_readonly_foreign_key.py\nnew file mode 100644\nindex 0000000000..ed7d7a2297\n--- /dev/null\n+++ b/tests/admin_views/test_readonly_foreign_key.py\n@@ -0,0 +1,63 @@\n+import admin_views.models\n+from django.contrib import admin\n+from django.contrib.auth.models import User\n+from django.test import TestCase, override_settings\n+from django.urls import path, reverse\n+\n+# Models are defined in admin_views.models, so we can import them.\n+from admin_views.models import Child, Parent\n+\n+\n+# 1. A custom ModelAdmin that makes the ForeignKey readonly.\n+class ChildAdmin(admin.ModelAdmin):\n+    readonly_fields = ('parent',)\n+\n+\n+# 2. A custom AdminSite instance.\n+custom_admin_site = admin.AdminSite(name='custom_admin')\n+custom_admin_site.register(Parent)\n+custom_admin_site.register(Child, ChildAdmin)\n+\n+\n+# 3. URL patterns for the test, including the custom and default admin sites.\n+# This module will be used as the ROOT_URLCONF.\n+urlpatterns = [\n+    path('custom_admin/', custom_admin_site.urls),\n+    path('admin/', admin.site.urls),\n+]\n+\n+\n+# 4. The test class, pointing ROOT_URLCONF to this module.\n+# The path is based on the file's location in the project structure.\n+@override_settings(ROOT_URLCONF='admin_views.test_readonly_foreign_key')\n+class ReadonlyForeignKeyInCustomAdminTest(TestCase):\n+    @classmethod\n+    def setUpTestData(cls):\n+        # Create a user and model instances needed for the test.\n+        cls.superuser = User.objects.create_superuser('super', 'super@example.com', 'password')\n+        cls.parent_obj = Parent.objects.create(name='Test Parent')\n+        cls.child_obj = Child.objects.create(parent=cls.parent_obj, name='Test Child')\n+\n+    def test_readonly_foreign_key_url_in_custom_admin(self):\n+        \"\"\"\n+        The link for a readonly ForeignKey field in a custom admin site should\n+        use the custom site's URL, not the default admin's URL.\n+        \"\"\"\n+        self.client.login(username='super', password='password')\n+\n+        # URL for the change view of the 'Child' object in our custom admin.\n+        child_change_url = reverse('custom_admin:admin_views_child_change', args=[self.child_obj.pk])\n+        response = self.client.get(child_change_url)\n+\n+        # The expected URL for the link to the related 'Parent' object.\n+        # It should be resolved within the 'custom_admin' namespace.\n+        expected_parent_url = reverse('custom_admin:admin_views_parent_change', args=[self.parent_obj.pk])\n+\n+        # This assertion will fail if the bug is present because the generated\n+        # href will point to '/admin/...' instead of '/custom_admin/...'.\n+        self.assertContains(\n+            response,\n+            f'<a href=\"{expected_parent_url}\">{self.parent_obj.name}</a>',\n+            html=True,\n+            msg_prefix=\"The readonly field link does not point to the custom admin URL.\",\n+        )\n"], "arch": "x86_64", "base_commit": "475cffd1d64c690cdad16ede4d5e81985738ceb4", "test_directives": ["admin_views.test_readonly_foreign_key"], "coverage_files": ["django/contrib/admin/helpers.py"], "env_name": "testbed", "run_id": "full_evaluation", "patch_id": "pred_pre__Prometheus-Bug-Reproduction-Agent", "timeout": 1800, "rm_image": false, "force_rebuild": false, "exec_mode": "unit_test", "reproduction_script_name": null, "compute_coverage": true, "install": {"python": "3.8", "packages": "requirements.txt", "install": "python -m pip install -e ."}, "cache_level": "instance", "test_command": "python3 /root/trace.py --count -C coverage.cover --include-pattern '/testbed/(django/contrib/admin/helpers\\.py)' ./tests/runtests.py --verbosity 2 --settings=test_sqlite --parallel 1 admin_views.test_readonly_foreign_key", "req_install_commands": ["conda create -n testbed python=3.8 -y", "cat <<'EOF_59812759871' > $HOME/requirements.txt\nasgiref >= 3.3.2\nargon2-cffi >= 16.1.0\nbackports.zoneinfo; python_version < '3.9'\nbcrypt\ndocutils\ngeoip2\njinja2 >= 2.9.2\nnumpy\nPillow >= 6.2.0\npylibmc; sys.platform != 'win32'\npymemcache >= 3.4.0\npython-memcached >= 1.59\npytz\npywatchman; sys.platform != 'win32'\nPyYAML\nredis >= 3.0.0\nselenium\nsqlparse >= 0.2.2\ntblib >= 1.5.0\ntzdata\ncolorama; sys.platform == 'win32'\n\nEOF_59812759871", "conda activate testbed && python -m pip install -r $HOME/requirements.txt", "rm $HOME/requirements.txt"]}