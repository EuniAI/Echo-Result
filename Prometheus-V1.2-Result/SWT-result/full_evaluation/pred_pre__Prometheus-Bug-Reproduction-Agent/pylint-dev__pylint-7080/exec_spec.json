{"instance_id": "pylint-dev__pylint-7080", "repo": "pylint-dev/pylint", "version": "2.15", "environment_setup_commit": "e90702074e68e20dc8e5df5013ee3ecf22139c3e", "patch_list": ["diff --git a/tests/lint/test_expand_modules_recursive_ignore.py b/tests/lint/test_expand_modules_recursive_ignore.py\nnew file mode 100644\nindex 000000000..3847f9179\n--- /dev/null\n+++ b/tests/lint/test_expand_modules_recursive_ignore.py\n@@ -0,0 +1,115 @@\n+# Licensed under the GPL: https://www.gnu.org/licenses/old-licenses/gpl-2.0.html\n+# For details: https://github.com/PyCQA/pylint/blob/main/LICENSE\n+# Copyright (c) https://github.com/PyCQA/pylint/blob/main/CONTRIBUTORS.txt\n+\n+from __future__ import annotations\n+\n+import re\n+from pathlib import Path\n+\n+import pytest\n+\n+from pylint.checkers import BaseChecker\n+from pylint.lint.expand_modules import _is_in_ignore_list_re, expand_modules\n+from pylint.testutils import CheckerTestCase, set_config\n+from pylint.typing import MessageDefinitionTuple\n+\n+TEST_DIRECTORY = Path(__file__).parent.parent\n+INIT_PATH = str(TEST_DIRECTORY / \"lint/__init__.py\")\n+EXPAND_MODULES = str(TEST_DIRECTORY / \"lint/unittest_expand_modules.py\")\n+this_file = {\n+    \"basename\": \"lint.unittest_expand_modules\",\n+    \"basepath\": EXPAND_MODULES,\n+    \"isarg\": True,\n+    \"name\": \"lint.unittest_expand_modules\",\n+    \"path\": EXPAND_MODULES,\n+}\n+\n+this_file_from_init = {\n+    \"basename\": \"lint\",\n+    \"basepath\": INIT_PATH,\n+    \"isarg\": False,\n+    \"name\": \"lint.unittest_expand_modules\",\n+    \"path\": EXPAND_MODULES,\n+}\n+\n+unittest_lint = {\n+    \"basename\": \"lint\",\n+    \"basepath\": INIT_PATH,\n+    \"isarg\": False,\n+    \"name\": \"lint.unittest_lint\",\n+    \"path\": str(TEST_DIRECTORY / \"lint/unittest_lint.py\"),\n+}\n+\n+test_utils = {\n+    \"basename\": \"lint\",\n+    \"basepath\": INIT_PATH,\n+    \"isarg\": False,\n+    \"name\": \"lint.test_utils\",\n+    \"path\": str(TEST_DIRECTORY / \"lint/test_utils.py\"),\n+}\n+\n+test_pylinter = {\n+    \"basename\": \"lint\",\n+    \"basepath\": INIT_PATH,\n+    \"isarg\": False,\n+    \"name\": \"lint.test_pylinter\",\n+    \"path\": str(TEST_DIRECTORY / \"lint/test_pylinter.py\"),\n+}\n+\n+test_caching = {\n+    \"basename\": \"lint\",\n+    \"basepath\": INIT_PATH,\n+    \"isarg\": False,\n+    \"name\": \"lint.test_caching\",\n+    \"path\": str(TEST_DIRECTORY / \"lint/test_caching.py\"),\n+}\n+\n+\n+init_of_package = {\n+    \"basename\": \"lint\",\n+    \"basepath\": INIT_PATH,\n+    \"isarg\": True,\n+    \"name\": \"lint\",\n+    \"path\": INIT_PATH,\n+}\n+\n+\n+class TestExpandModules(CheckerTestCase):\n+    \"\"\"Test the expand_modules function while allowing options to be set.\"\"\"\n+\n+    class Checker(BaseChecker):\n+        \"\"\"This dummy checker is needed to allow options to be set.\"\"\"\n+\n+        name = \"checker\"\n+        msgs: dict[str, MessageDefinitionTuple] = {}\n+        options = ((\"test-opt\", {\"action\": \"store_true\", \"help\": \"help message\"}),)\n+\n+    CHECKER_CLASS: type = Checker\n+\n+    @set_config(recursive=True, ignore_paths=r\".*tests[\\/]lint[\\/]unittest_lint\\.py\")\n+    def test_recursive_with_ignore_paths_respects_ignore(self) -> None:\n+        \"\"\"Test that recursive discovery respects ignore-paths.\n+\n+        Regression test for https://github.com/PyCQA/pylint/issues/7094\n+        \"\"\"\n+        files_or_modules = [str(TEST_DIRECTORY / \"lint\")]\n+        expected = [\n+            init_of_package,\n+            test_caching,\n+            test_pylinter,\n+            test_utils,\n+            this_file_from_init,\n+        ]\n+\n+        modules, errors = expand_modules(\n+            files_or_modules,\n+            [],\n+            [],\n+            self.linter.config.ignore_paths,\n+        )\n+        modules.sort(key=lambda d: d[\"name\"])\n+        expected.sort(key=lambda d: d[\"name\"])\n+\n+        assert modules == expected\n+        assert not errors\n"], "arch": "x86_64", "base_commit": "3c5eca2ded3dd2b59ebaf23eb289453b5d2930f0", "test_directives": ["tests/lint/test_expand_modules_recursive_ignore.py"], "coverage_files": ["pylint/lint/expand_modules.py"], "env_name": "testbed", "run_id": "full_evaluation", "patch_id": "pred_pre__Prometheus-Bug-Reproduction-Agent", "timeout": 1800, "rm_image": false, "force_rebuild": false, "exec_mode": "unit_test", "reproduction_script_name": null, "compute_coverage": true, "install": {"python": "3.9", "packages": "requirements.txt", "install": "python -m pip install -e ."}, "cache_level": "instance", "test_command": "python3 /root/trace.py --count -C coverage.cover --include-pattern '/testbed/(pylint/lint/expand_modules\\.py)' -m pytest --no-header -rA  -p no:cacheprovider tests/lint/test_expand_modules_recursive_ignore.py", "req_install_commands": ["conda create -n testbed python=3.9 -y", "cat <<'EOF_59812759871' > $HOME/requirements.txt\nblack==22.6.0\nflake8==5.0.4\nflake8-typing-imports==1.13.0\nisort==5.10.1\nmypy==0.971\n\nastroid==2.12.13  # Pinned to a specific version for tests\ntyping-extensions~=4.4\npy~=1.11.0\npytest~=7.2\npytest-benchmark~=4.0\npytest-timeout~=2.1\ntowncrier~=22.8\nrequests\n\ncoveralls~=3.3\ncoverage~=6.4\npre-commit~=2.20\ntbump~=6.9.0\ncontributors-txt>=0.9.0\npytest-cov~=3.0\npytest-profiling~=1.7\npytest-xdist~=2.5\ntypes-pkg_resources==0.1.3\ntox>=3\n\nEOF_59812759871", "conda activate testbed && python -m pip install -r $HOME/requirements.txt", "rm $HOME/requirements.txt"]}