{"instance_id": "sphinx-doc__sphinx-7590", "repo": "sphinx-doc/sphinx", "version": "3.1", "environment_setup_commit": "5afc77ee27fc01c57165ab260d3a76751f9ddb35", "patch_list": ["diff --git a/tests/test_domain_cpp_user_defined_literals.py b/tests/test_domain_cpp_user_defined_literals.py\nnew file mode 100644\nindex 000000000..eab0600a9\n--- /dev/null\n+++ b/tests/test_domain_cpp_user_defined_literals.py\n@@ -0,0 +1,89 @@\n+import re\n+\n+import pytest\n+\n+from sphinx import addnodes\n+from sphinx.domains.cpp import DefinitionParser, DefinitionError, NoOldIdError\n+from sphinx.domains.cpp import Symbol, _max_id, _id_prefix\n+\n+\n+def parse(name, string):\n+    class Config:\n+        cpp_id_attributes = [\"id_attr\"]\n+        cpp_paren_attributes = [\"paren_attr\"]\n+    parser = DefinitionParser(string, location=None, config=Config())\n+    parser.allowFallbackExpressionParsing = False\n+    ast = parser.parse_declaration(name, name)\n+    parser.assert_end()\n+    # The scopedness would usually have been set by CPPEnumObject\n+    if name == \"enum\":\n+        ast.scoped = None  # simulate unscoped enum\n+    return ast\n+\n+\n+def _check(name, input, idDict, output):\n+    # first a simple check of the AST\n+    ast = parse(name, input)\n+    res = str(ast)\n+    if res != output:\n+        print(\"\")\n+        print(\"Input:    \", input)\n+        print(\"Result:   \", res)\n+        print(\"Expected: \", output)\n+        raise DefinitionError(\"\")\n+    rootSymbol = Symbol(None, None, None, None, None, None)\n+    symbol = rootSymbol.add_declaration(ast, docname=\"TestDoc\")\n+    parentNode = addnodes.desc()\n+    signode = addnodes.desc_signature(input, '')\n+    parentNode += signode\n+    ast.describe_signature(signode, 'lastIsName', symbol, options={})\n+\n+    idExpected = [None]\n+    for i in range(1, _max_id + 1):\n+        if i in idDict:\n+            idExpected.append(idDict[i])\n+        else:\n+            idExpected.append(idExpected[i - 1])\n+    idActual = [None]\n+    for i in range(1, _max_id + 1):\n+        try:\n+            id = ast.get_id(version=i)\n+            assert id is not None\n+            idActual.append(id[len(_id_prefix[i]):])\n+        except NoOldIdError:\n+            idActual.append(None)\n+\n+    res = [True]\n+    for i in range(1, _max_id + 1):\n+        res.append(idExpected[i] == idActual[i])\n+\n+    if not all(res):\n+        print(\"input:    %s\" % input.rjust(20))\n+        for i in range(1, _max_id + 1):\n+            if res[i]:\n+                continue\n+            print(\"Error in id version %d.\" % i)\n+            print(\"result:   %s\" % idActual[i])\n+            print(\"expected: %s\" % idExpected[i])\n+        print(rootSymbol.dump(0))\n+        raise DefinitionError(\"\")\n+\n+\n+def check(name, input, idDict, output=None):\n+    if output is None:\n+        output = input\n+    # First, check without semicolon\n+    _check(name, input, idDict, output)\n+    # Second, check with semicolon\n+    _check(name, input + ' ;', idDict, output + ';')\n+\n+\n+def test_user_defined_literal_in_variable_declaration():\n+    \"\"\"Tests parsing of a variable declaration with user-defined literals.\n+\n+    This was not supported and caused a parsing error.\n+    \"\"\"\n+    check('member',\n+          'constexpr auto planck_constant = 6.62607015e-34q_J * 1q_s',\n+          {1: 'planck_constant__auto', 2: '17planck_constant'},\n+          'constexpr auto planck_constant = 6.62607015e-34q_J * 1q_s')\n"], "arch": "x86_64", "base_commit": "2e506c5ab457cba743bb47eb5b8c8eb9dd51d23d", "test_directives": ["tests/test_domain_cpp_user_defined_literals.py"], "coverage_files": ["sphinx/domains/c.py", "sphinx/domains/cpp.py", "sphinx/util/cfamily.py"], "env_name": "testbed", "run_id": "full_evaluation", "patch_id": "pred_pre__Prometheus-Bug-Reproduction-Agent", "timeout": 1800, "rm_image": false, "force_rebuild": false, "exec_mode": "unit_test", "reproduction_script_name": null, "compute_coverage": true, "install": {"python": "3.9", "pip_packages": ["tox==4.16.0", "tox-current-env==0.0.11"], "install": "python -m pip install -e .[test]", "pre_install": ["sed -i 's/pytest/pytest -rA/' tox.ini", "sed -i 's/Jinja2>=2.3/Jinja2<3.0/' setup.py", "sed -i 's/sphinxcontrib-applehelp/sphinxcontrib-applehelp<=1.0.7/' setup.py", "sed -i 's/sphinxcontrib-devhelp/sphinxcontrib-devhelp<=1.0.5/' setup.py", "sed -i 's/sphinxcontrib-qthelp/sphinxcontrib-qthelp<=1.0.6/' setup.py", "sed -i 's/alabaster>=0.7,<0.8/alabaster>=0.7,<0.7.12/' setup.py", "sed -i \"s/'packaging',/'packaging', 'markupsafe<=2.0.1',/\" setup.py", "sed -i 's/sphinxcontrib-htmlhelp/sphinxcontrib-htmlhelp<=2.0.4/' setup.py", "sed -i 's/sphinxcontrib-serializinghtml/sphinxcontrib-serializinghtml<=1.1.9/' setup.py"]}, "cache_level": "instance", "test_command": "python3 /root/trace.py --count -C coverage.cover --include-pattern '/testbed/(sphinx/domains/c\\.py|sphinx/domains/cpp\\.py|sphinx/util/cfamily\\.py)' -m tox -epy39 -v -- tests/test_domain_cpp_user_defined_literals.py", "req_install_commands": ["conda create -n testbed python=3.9  -y"]}