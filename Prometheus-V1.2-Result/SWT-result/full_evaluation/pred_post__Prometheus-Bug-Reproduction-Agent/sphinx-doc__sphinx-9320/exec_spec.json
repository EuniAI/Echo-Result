{"instance_id": "sphinx-doc__sphinx-9320", "repo": "sphinx-doc/sphinx", "version": "4.1", "environment_setup_commit": "9a2c3c4a1559e37e95fdee88c128bb116642c897", "patch_list": ["diff --git a/sphinx/cmd/quickstart.py b/sphinx/cmd/quickstart.py\n--- a/sphinx/cmd/quickstart.py\n+++ b/sphinx/cmd/quickstart.py\n@@ -95,6 +95,12 @@ def is_path(x: str) -> str:\n     return x\n \n \n+def is_path_or_empty(x: str) -> str:\n+    if x == '':\n+        return x\n+    return is_path(x)\n+\n+\n def allow_empty(x: str) -> str:\n     return x\n \n@@ -223,7 +229,7 @@ def ask_user(d: Dict) -> None:\n         print(__('sphinx-quickstart will not overwrite existing Sphinx projects.'))\n         print()\n         d['path'] = do_prompt(__('Please enter a new root path (or just Enter to exit)'),\n-                              '', is_path)\n+                              '', is_path_or_empty)\n         if not d['path']:\n             sys.exit(1)\n \n", "diff --git a/tests/test_quickstart_exit_on_existing_conf.py b/tests/test_quickstart_exit_on_existing_conf.py\nnew file mode 100644\nindex 000000000..7a07adcab\n--- /dev/null\n+++ b/tests/test_quickstart_exit_on_existing_conf.py\n@@ -0,0 +1,61 @@\n+import os\n+import time\n+from io import StringIO\n+\n+import pytest\n+\n+from sphinx.cmd import quickstart as qs\n+from sphinx.util.console import coloron, nocolor\n+\n+warnfile = StringIO()\n+\n+\n+def setup_module():\n+    nocolor()\n+\n+\n+def mock_input(answers, needanswer=False):\n+    called = set()\n+\n+    def input_(prompt):\n+        if prompt in called:\n+            raise AssertionError('answer for %r missing and no default '\n+                                 'present' % prompt)\n+        called.add(prompt)\n+        for question in answers:\n+            if prompt.startswith(qs.PROMPT_PREFIX + question):\n+                return answers[question]\n+        if needanswer:\n+            raise AssertionError('answer for %r missing' % prompt)\n+        return ''\n+    return input_\n+\n+\n+real_input = input\n+\n+\n+def teardown_module():\n+    qs.term_input = real_input\n+    coloron()\n+\n+\n+def test_quickstart_exit_on_existing_conf(tempdir):\n+    \"\"\"Test sphinx-quickstart exits if conf.py exists and user hits Enter.\"\"\"\n+    # Create an existing conf.py file using a robust, basic method.\n+    conf_py_path = os.path.join(str(tempdir), 'conf.py')\n+    with open(conf_py_path, 'w') as f:\n+        pass\n+\n+    # Mock input: Answer the first \"Root path\" question with the tempdir,\n+    # then provide no answer for the subsequent prompt, simulating Enter.\n+    answers = {\n+        'Root path': str(tempdir),\n+    }\n+    qs.term_input = mock_input(answers)\n+\n+    d = {}\n+    # The bug is that sphinx-quickstart does not exit. When fixed, it should\n+    # raise SystemExit. The test will currently fail because the prompt is\n+    # repeated, causing an AssertionError from the mock_input helper.\n+    with pytest.raises(SystemExit):\n+        qs.ask_user(d)\n"], "arch": "x86_64", "base_commit": "e05cef574b8f23ab1b57f57e7da6dee509a4e230", "test_directives": ["tests/test_quickstart_exit_on_existing_conf.py"], "coverage_files": ["sphinx/cmd/quickstart.py"], "env_name": "testbed", "run_id": "full_evaluation", "patch_id": "pred_post__Prometheus-Bug-Reproduction-Agent", "timeout": 1800, "rm_image": false, "force_rebuild": false, "exec_mode": "unit_test", "reproduction_script_name": null, "compute_coverage": true, "install": {"python": "3.9", "pip_packages": ["tox==4.16.0", "tox-current-env==0.0.11"], "install": "python -m pip install -e .[test]", "pre_install": ["sed -i 's/pytest/pytest -rA/' tox.ini", "sed -i 's/Jinja2>=2.3/Jinja2<3.0/' setup.py", "sed -i 's/sphinxcontrib-applehelp/sphinxcontrib-applehelp<=1.0.7/' setup.py", "sed -i 's/sphinxcontrib-devhelp/sphinxcontrib-devhelp<=1.0.5/' setup.py", "sed -i 's/sphinxcontrib-qthelp/sphinxcontrib-qthelp<=1.0.6/' setup.py", "sed -i 's/alabaster>=0.7,<0.8/alabaster>=0.7,<0.7.12/' setup.py", "sed -i \"s/'packaging',/'packaging', 'markupsafe<=2.0.1',/\" setup.py", "grep -q 'sphinxcontrib-htmlhelp>=2.0.0' setup.py && sed -i 's/sphinxcontrib-htmlhelp>=2.0.0/sphinxcontrib-htmlhelp>=2.0.0,<=2.0.4/' setup.py || sed -i 's/sphinxcontrib-htmlhelp/sphinxcontrib-htmlhelp<=2.0.4/' setup.py", "grep -q 'sphinxcontrib-serializinghtml>=1.1.5' setup.py && sed -i 's/sphinxcontrib-serializinghtml>=1.1.5/sphinxcontrib-serializinghtml>=1.1.5,<=1.1.9/' setup.py || sed -i 's/sphinxcontrib-serializinghtml/sphinxcontrib-serializinghtml<=1.1.9/' setup.py"]}, "cache_level": "instance", "test_command": "python3 /root/trace.py --count -C coverage.cover --include-pattern '/testbed/(sphinx/cmd/quickstart\\.py)' -m tox -epy39 -v -- tests/test_quickstart_exit_on_existing_conf.py", "req_install_commands": ["conda create -n testbed python=3.9  -y"]}