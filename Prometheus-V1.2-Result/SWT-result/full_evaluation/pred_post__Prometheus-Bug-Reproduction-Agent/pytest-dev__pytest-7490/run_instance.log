2025-12-07 15:45:03,085 - WARNING - Starting evaluation at 1765122303.0857651
2025-12-07 15:45:03,134 - INFO - Creating container for pytest-dev__pytest-7490...
2025-12-07 15:45:03,163 - INFO - Container for pytest-dev__pytest-7490 created: 65c70fd6fa15499a5fce99fe7046a546dbb9176252007f683edca0fdc9aeccf0
2025-12-07 15:45:03,345 - INFO - Container for pytest-dev__pytest-7490 started: 65c70fd6fa15499a5fce99fe7046a546dbb9176252007f683edca0fdc9aeccf0
2025-12-07 15:45:03,502 - INFO - Git diff before:

2025-12-07 15:45:03,503 - INFO - Eval script for pytest-dev__pytest-7490 written to eval.sh, now applying to container...
2025-12-07 15:45:10,520 - INFO - Test output for pytest-dev__pytest-7490 written to run_instance_swt_logs/full_evaluation/pred_post__Prometheus-Bug-Reproduction-Agent/pytest-dev__pytest-7490/test_output.txt
2025-12-07 15:45:10,592 - INFO - Git diff after:
diff --git a/src/_pytest/skipping.py b/src/_pytest/skipping.py
index 335e10996..e333e78df 100644
--- a/src/_pytest/skipping.py
+++ b/src/_pytest/skipping.py
@@ -231,17 +231,14 @@ unexpectedsuccess_key = StoreKey[str]()
 
 @hookimpl(tryfirst=True)
 def pytest_runtest_setup(item: Item) -> None:
-    item._store[skipped_by_mark_key] = False
-
     skipped = evaluate_skip_marks(item)
+    item._store[skipped_by_mark_key] = skipped is not None
     if skipped:
-        item._store[skipped_by_mark_key] = True
         skip(skipped.reason)
 
-    if not item.config.option.runxfail:
-        item._store[xfailed_key] = xfailed = evaluate_xfail_marks(item)
-        if xfailed and not xfailed.run:
-            xfail("[NOTRUN] " + xfailed.reason)
+    item._store[xfailed_key] = xfailed = evaluate_xfail_marks(item)
+    if xfailed and not item.config.option.runxfail and not xfailed.run:
+        xfail("[NOTRUN] " + xfailed.reason)
 
 
 @hookimpl(hookwrapper=True)
@@ -250,12 +247,16 @@ def pytest_runtest_call(item: Item) -> Generator[None, None, None]:
     if xfailed is None:
         item._store[xfailed_key] = xfailed = evaluate_xfail_marks(item)
 
-    if not item.config.option.runxfail:
-        if xfailed and not xfailed.run:
-            xfail("[NOTRUN] " + xfailed.reason)
+    if xfailed and not item.config.option.runxfail and not xfailed.run:
+        xfail("[NOTRUN] " + xfailed.reason)
 
     yield
 
+    # The test run may have added an xfail mark dynamically.
+    xfailed = item._store.get(xfailed_key, None)
+    if xfailed is None:
+        item._store[xfailed_key] = xfailed = evaluate_xfail_marks(item)
+
 
 @hookimpl(hookwrapper=True)
 def pytest_runtest_makereport(item: Item, call: CallInfo[None]):
2025-12-07 15:45:10,592 - INFO - Git diff changed after running eval script
2025-12-07 15:45:10,592 - INFO - Attempting to stop container exec.eval.x86_64.7ea5f61b7564fbc4e33129.3fac552f5a165e4495b2ea.124396453912864...
2025-12-07 15:45:25,807 - INFO - Attempting to remove container exec.eval.x86_64.7ea5f61b7564fbc4e33129.3fac552f5a165e4495b2ea.124396453912864...
2025-12-07 15:45:25,824 - INFO - Container exec.eval.x86_64.7ea5f61b7564fbc4e33129.3fac552f5a165e4495b2ea.124396453912864 removed.
2025-12-07 15:45:25,824 - WARNING - End of eval at 1765122325.824668
