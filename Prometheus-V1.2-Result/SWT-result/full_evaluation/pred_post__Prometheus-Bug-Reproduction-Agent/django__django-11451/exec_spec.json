{"instance_id": "django__django-11451", "repo": "django/django", "version": "3.0", "environment_setup_commit": "419a78300f7cd27611196e1e464d50fd0385ff27", "patch_list": ["diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,8 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n", "diff --git a/tests/auth_tests/test_model_backend.py b/tests/auth_tests/test_model_backend.py\nnew file mode 100644\nindex 0000000000..80296b05c7\n--- /dev/null\n+++ b/tests/auth_tests/test_model_backend.py\n@@ -0,0 +1,69 @@\n+import datetime\n+from unittest import mock\n+\n+from django.contrib.auth import (\n+    BACKEND_SESSION_KEY, SESSION_KEY, authenticate, get_user, signals,\n+)\n+from django.contrib.auth.backends import BaseBackend, ModelBackend\n+from django.contrib.auth.hashers import MD5PasswordHasher\n+from django.contrib.auth.models import AnonymousUser, Group, Permission, User\n+from django.contrib.contenttypes.models import ContentType\n+from django.core.exceptions import ImproperlyConfigured, PermissionDenied\n+from django.http import HttpRequest\n+from django.test import (\n+    SimpleTestCase, TestCase, modify_settings, override_settings,\n+)\n+\n+from .models import (\n+    CustomPermissionsUser, CustomUser, CustomUserWithoutIsActiveField,\n+    ExtensionUser, UUIDUser,\n+)\n+\n+\n+class BaseModelBackendTest:\n+    \"\"\"\n+    A base class for tests that need to validate the ModelBackend\n+    with different User models. Subclasses should define a class\n+    level UserModel attribute, and a create_users() method to\n+    construct two users for test purposes.\n+    \"\"\"\n+    backend = 'django.contrib.auth.backends.ModelBackend'\n+\n+    def setUp(self):\n+        self.patched_settings = modify_settings(\n+            AUTHENTICATION_BACKENDS={'append': self.backend},\n+        )\n+        self.patched_settings.enable()\n+        self.create_users()\n+\n+    def tearDown(self):\n+        self.patched_settings.disable()\n+        # The custom_perms test messes with ContentTypes, which will\n+        # be cached; flush the cache to ensure there are no side effects\n+        # Refs #14975, #14925\n+        ContentType.objects.clear_cache()\n+\n+\n+class ModelBackendTest(BaseModelBackendTest, TestCase):\n+    \"\"\"\n+    Tests for the ModelBackend using the default User model.\n+    \"\"\"\n+    UserModel = User\n+    user_credentials = {'username': 'test', 'password': 'test'}\n+\n+    def create_users(self):\n+        self.user = User.objects.create_user(email='test@example.com', **self.user_credentials)\n+        self.superuser = User.objects.create_superuser(\n+            username='test2',\n+            email='test2@example.com',\n+            password='test',\n+        )\n+\n+    def test_authenticate_no_username_no_query(self):\n+        \"\"\"\n+        ModelBackend.authenticate() shouldn't make a database query when\n+        username is None.\n+        \"\"\"\n+        with self.assertNumQueries(0):\n+            user = authenticate(username=None)\n+        self.assertIsNone(user)\n"], "arch": "x86_64", "base_commit": "e065b293878b1e3ea56655aa9d33e87576cd77ff", "test_directives": ["auth_tests.test_model_backend"], "coverage_files": ["django/contrib/auth/backends.py"], "env_name": "testbed", "run_id": "full_evaluation", "patch_id": "pred_post__Prometheus-Bug-Reproduction-Agent", "timeout": 1800, "rm_image": false, "force_rebuild": false, "exec_mode": "unit_test", "reproduction_script_name": null, "compute_coverage": true, "install": {"python": "3.6", "packages": "requirements.txt", "install": "python -m pip install -e .", "eval_commands": ["sed -i '/en_US.UTF-8/s/^# //g' /etc/locale.gen && locale-gen", "export LANG=en_US.UTF-8", "export LANGUAGE=en_US:en", "export LC_ALL=en_US.UTF-8"]}, "cache_level": "instance", "test_command": "python3 /root/trace.py --count -C coverage.cover --include-pattern '/testbed/(django/contrib/auth/backends\\.py)' ./tests/runtests.py --verbosity 2 --settings=test_sqlite --parallel 1 auth_tests.test_model_backend", "req_install_commands": ["conda create -n testbed python=3.6 -y", "cat <<'EOF_59812759871' > $HOME/requirements.txt\nasgiref ~= 3.2\nargon2-cffi >= 16.1.0\nbcrypt\ndocutils\ngeoip2\njinja2 >= 2.9.2\nnumpy\nPillow != 5.4.0\npylibmc; sys.platform != 'win32'\npython-memcached >= 1.59\npytz\npywatchman; sys.platform != 'win32'\nPyYAML\nselenium\nsqlparse >= 0.2.2\ntblib >= 1.5.0\n\nEOF_59812759871", "conda activate testbed && python -m pip install -r $HOME/requirements.txt", "rm $HOME/requirements.txt"]}