{"instance_id": "sphinx-doc__sphinx-11445", "repo": "sphinx-doc/sphinx", "version": "7.1", "environment_setup_commit": "89808c6f49e1738765d18309244dca0156ee28f6", "patch_list": ["diff --git a/sphinx/util/rst.py b/sphinx/util/rst.py\n--- a/sphinx/util/rst.py\n+++ b/sphinx/util/rst.py\n@@ -10,22 +10,17 @@\n \n from docutils.parsers.rst import roles\n from docutils.parsers.rst.languages import en as english\n+from docutils.parsers.rst.states import Body\n from docutils.statemachine import StringList\n from docutils.utils import Reporter\n-from jinja2 import Environment\n+from jinja2 import Environment, pass_environment\n \n from sphinx.locale import __\n from sphinx.util import docutils, logging\n \n-try:\n-    from jinja2.utils import pass_environment\n-except ImportError:\n-    from jinja2 import environmentfilter as pass_environment\n-\n-\n logger = logging.getLogger(__name__)\n \n-docinfo_re = re.compile(':\\\\w+:.*?')\n+FIELD_NAME_RE = re.compile(Body.patterns['field_marker'])\n symbols_re = re.compile(r'([!-\\-/:-@\\[-`{-~])')  # symbols without dot(0x2e)\n SECTIONING_CHARS = ['=', '-', '~']\n \n@@ -80,7 +75,7 @@ def prepend_prolog(content: StringList, prolog: str) -> None:\n     if prolog:\n         pos = 0\n         for line in content:\n-            if docinfo_re.match(line):\n+            if FIELD_NAME_RE.match(line):\n                 pos += 1\n             else:\n                 break\n@@ -91,6 +86,7 @@ def prepend_prolog(content: StringList, prolog: str) -> None:\n             pos += 1\n \n         # insert prolog (after docinfo if exists)\n+        lineno = 0\n         for lineno, line in enumerate(prolog.splitlines()):\n             content.insert(pos + lineno, line, '<rst_prolog>', lineno)\n \n", "diff --git a/tests/test_environment_adapters_toctree.py b/tests/test_environment_adapters_toctree.py\nnew file mode 100644\nindex 000000000..096ed83b1\n--- /dev/null\n+++ b/tests/test_environment_adapters_toctree.py\n@@ -0,0 +1,412 @@\n+import pytest\n+from docutils import nodes\n+from docutils.nodes import bullet_list, comment, list_item, literal, reference, title\n+\n+from sphinx import addnodes\n+from sphinx.addnodes import compact_paragraph, only\n+from sphinx.builders.html import StandaloneHTMLBuilder\n+from sphinx.environment.adapters.toctree import TocTree\n+from sphinx.testing.util import assert_node\n+\n+\n+@pytest.mark.sphinx('xml', testroot='toctree')\n+@pytest.mark.test_params(shared_result='test_environment_toctree_basic')\n+def test_process_doc(app):\n+    app.build()\n+    # tocs\n+    toctree = app.env.tocs['index']\n+    assert_node(toctree,\n+                [bullet_list, ([list_item, (compact_paragraph,  # [0][0]\n+                                            [bullet_list, (addnodes.toctree,  # [0][1][0]\n+                                                           only,  # [0][1][1]\n+                                                           list_item)])],  # [0][1][2]\n+                               [list_item, (compact_paragraph,  # [1][0]\n+                                            [bullet_list, (addnodes.toctree,  # [1][1][0]\n+                                                           addnodes.toctree)])],  # [1][1][1]\n+                               list_item)])\n+\n+    assert_node(toctree[0][0],\n+                [compact_paragraph, reference, \"Welcome to Sphinx Tests\u2019s documentation!\"])\n+    assert_node(toctree[0][0][0], reference, anchorname='')\n+    assert_node(toctree[0][1][0], addnodes.toctree,\n+                caption=\"Table of Contents\", glob=False, hidden=False,\n+                titlesonly=False, maxdepth=2, numbered=999,\n+                entries=[(None, 'foo'), (None, 'bar'), (None, 'http://sphinx-doc.org/'),\n+                         (None, 'self')],\n+                includefiles=['foo', 'bar'])\n+\n+    # only branch\n+    assert_node(toctree[0][1][1], addnodes.only, expr=\"html\")\n+    assert_node(toctree[0][1][1],\n+                [only, list_item, ([compact_paragraph, reference, \"Section for HTML\"],\n+                                   [bullet_list, addnodes.toctree])])\n+    assert_node(toctree[0][1][1][0][0][0], reference, anchorname='#section-for-html')\n+    assert_node(toctree[0][1][1][0][1][0], addnodes.toctree,\n+                caption=None, glob=False, hidden=False, entries=[(None, 'baz')],\n+                includefiles=['baz'], titlesonly=False, maxdepth=-1, numbered=0)\n+    assert_node(toctree[0][1][2],\n+                ([compact_paragraph, reference, \"subsection\"],\n+                 [bullet_list, list_item, compact_paragraph, reference, \"subsubsection\"]))\n+\n+    assert_node(toctree[1][0],\n+                [compact_paragraph, reference, \"Test for issue #1157\"])\n+    assert_node(toctree[1][0][0], reference, anchorname='#test-for-issue-1157')\n+    assert_node(toctree[1][1][0], addnodes.toctree,\n+                caption=None, entries=[], glob=False, hidden=False,\n+                titlesonly=False, maxdepth=-1, numbered=0)\n+    assert_node(toctree[1][1][1], addnodes.toctree,\n+                caption=None, glob=False, hidden=True,\n+                titlesonly=False, maxdepth=-1, numbered=0,\n+                entries=[('Latest reference', 'http://sphinx-doc.org/latest/'),\n+                         ('Python', 'http://python.org/')])\n+\n+    assert_node(toctree[2][0],\n+                [compact_paragraph, reference, \"Indices and tables\"])\n+\n+    # other collections\n+    assert app.env.toc_num_entries['index'] == 6\n+    assert app.env.toctree_includes['index'] == ['foo', 'bar', 'baz']\n+    assert app.env.files_to_rebuild['foo'] == {'index'}\n+    assert app.env.files_to_rebuild['bar'] == {'index'}\n+    assert app.env.files_to_rebuild['baz'] == {'index'}\n+    assert app.env.glob_toctrees == set()\n+    assert app.env.numbered_toctrees == {'index'}\n+\n+    # qux has no section title\n+    assert len(app.env.tocs['qux']) == 0\n+    assert_node(app.env.tocs['qux'], nodes.bullet_list)\n+    assert app.env.toc_num_entries['qux'] == 0\n+    assert 'qux' not in app.env.toctree_includes\n+\n+\n+@pytest.mark.sphinx('dummy', testroot='toctree-glob')\n+def test_glob(app):\n+    includefiles = ['foo', 'bar/index', 'bar/bar_1', 'bar/bar_2',\n+                    'bar/bar_3', 'baz', 'qux/index']\n+\n+    app.build()\n+\n+    # tocs\n+    toctree = app.env.tocs['index']\n+    assert_node(toctree,\n+                [bullet_list, list_item, (compact_paragraph,  # [0][0]\n+                                          [bullet_list, (list_item,  # [0][1][0]\n+                                                         list_item)])])  # [0][1][1]\n+\n+    assert_node(toctree[0][0],\n+                [compact_paragraph, reference, \"test-toctree-glob\"])\n+    assert_node(toctree[0][1][0],\n+                [list_item, ([compact_paragraph, reference, \"normal order\"],\n+                             [bullet_list, addnodes.toctree])])  # [0][1][0][1][0]\n+    assert_node(toctree[0][1][0][1][0], addnodes.toctree, caption=None,\n+                glob=True, hidden=False, titlesonly=False,\n+                maxdepth=-1, numbered=0, includefiles=includefiles,\n+                entries=[(None, 'foo'), (None, 'bar/index'), (None, 'bar/bar_1'),\n+                         (None, 'bar/bar_2'), (None, 'bar/bar_3'), (None, 'baz'),\n+                         (None, 'qux/index'),\n+                         ('hyperref', 'https://sphinx-doc.org/?q=sphinx')])\n+    assert_node(toctree[0][1][1],\n+                [list_item, ([compact_paragraph, reference, \"reversed order\"],\n+                             [bullet_list, addnodes.toctree])])  # [0][1][1][1][0]\n+    assert_node(toctree[0][1][1][1][0], addnodes.toctree, caption=None,\n+                glob=True, hidden=False, titlesonly=False,\n+                maxdepth=-1, numbered=0, includefiles=list(reversed(includefiles)),\n+                entries=[(None, 'qux/index'), (None, 'baz'), (None, 'bar/bar_3'),\n+                         (None, 'bar/bar_2'), (None, 'bar/bar_1'), (None, 'bar/index'),\n+                         (None, 'foo')])\n+\n+    # other collections\n+    assert app.env.toc_num_entries['index'] == 3\n+    assert app.env.toctree_includes['index'] == includefiles + list(reversed(includefiles))\n+    for file in includefiles:\n+        assert 'index' in app.env.files_to_rebuild[file]\n+    assert 'index' in app.env.glob_toctrees\n+    assert app.env.numbered_toctrees == set()\n+\n+\n+@pytest.mark.sphinx('dummy', testroot='toctree-domain-objects')\n+def test_domain_objects(app):\n+    includefiles = ['domains']\n+\n+    app.build()\n+\n+    assert app.env.toc_num_entries['index'] == 0\n+    assert app.env.toc_num_entries['domains'] == 9\n+    assert app.env.toctree_includes['index'] == includefiles\n+    for file in includefiles:\n+        assert 'index' in app.env.files_to_rebuild[file]\n+    assert app.env.glob_toctrees == set()\n+    assert app.env.numbered_toctrees == {'index'}\n+\n+    # tocs\n+    toctree = app.env.tocs['domains']\n+    assert_node(toctree,\n+                [bullet_list, list_item, (compact_paragraph,  # [0][0]\n+                                          [bullet_list, (list_item,  # [0][1][0]\n+                                                         [list_item,  # [0][1][1]\n+                                                          (compact_paragraph,  # [0][1][1][0]\n+                                                           [bullet_list, (list_item,  # [0][1][1][1][0]\n+                                                                          list_item,\n+                                                                          list_item,\n+                                                                          list_item)])],  # [0][1][1][1][3]\n+                                                         list_item,\n+                                                         list_item)])])  # [0][1][1]\n+\n+    assert_node(toctree[0][0],\n+                [compact_paragraph, reference, \"test-domain-objects\"])\n+\n+    assert_node(toctree[0][1][0],\n+                [list_item, ([compact_paragraph, reference, literal, \"world()\"])])\n+\n+    assert_node(toctree[0][1][1][1][3],\n+                [list_item, ([compact_paragraph, reference, literal, \"HelloWorldPrinter.print()\"])])\n+\n+\n+@pytest.mark.sphinx('xml', testroot='toctree')\n+@pytest.mark.test_params(shared_result='test_environment_toctree_basic')\n+def test_get_toc_for(app):\n+    app.build()\n+    toctree = TocTree(app.env).get_toc_for('index', app.builder)\n+\n+    assert_node(toctree,\n+                [bullet_list, ([list_item, (compact_paragraph,  # [0][0]\n+                                            [bullet_list, (addnodes.toctree,  # [0][1][0]\n+                                                           comment,  # [0][1][1]\n+                                                           list_item)])],  # [0][1][2]\n+                               [list_item, (compact_paragraph,  # [1][0]\n+                                            [bullet_list, (addnodes.toctree,\n+                                                           addnodes.toctree)])],\n+                               [list_item, compact_paragraph])])  # [2][0]\n+    assert_node(toctree[0][0],\n+                [compact_paragraph, reference, \"Welcome to Sphinx Tests\u2019s documentation!\"])\n+    assert_node(toctree[0][1][2],\n+                ([compact_paragraph, reference, \"subsection\"],\n+                 [bullet_list, list_item, compact_paragraph, reference, \"subsubsection\"]))\n+    assert_node(toctree[1][0],\n+                [compact_paragraph, reference, \"Test for issue #1157\"])\n+    assert_node(toctree[2][0],\n+                [compact_paragraph, reference, \"Indices and tables\"])\n+\n+\n+@pytest.mark.sphinx('xml', testroot='toctree')\n+@pytest.mark.test_params(shared_result='test_environment_toctree_basic')\n+def test_get_toc_for_only(app):\n+    app.build()\n+    builder = StandaloneHTMLBuilder(app, app.env)\n+    toctree = TocTree(app.env).get_toc_for('index', builder)\n+\n+    assert_node(toctree,\n+                [bullet_list, ([list_item, (compact_paragraph,  # [0][0]\n+                                            [bullet_list, (addnodes.toctree,  # [0][1][0]\n+                                                           list_item,  # [0][1][1]\n+                                                           list_item)])],  # [0][1][2]\n+                               [list_item, (compact_paragraph,  # [1][0]\n+                                            [bullet_list, (addnodes.toctree,\n+                                                           addnodes.toctree)])],\n+                               [list_item, compact_paragraph])])  # [2][0]\n+    assert_node(toctree[0][0],\n+                [compact_paragraph, reference, \"Welcome to Sphinx Tests\u2019s documentation!\"])\n+    assert_node(toctree[0][1][1],\n+                ([compact_paragraph, reference, \"Section for HTML\"],\n+                 [bullet_list, addnodes.toctree]))\n+    assert_node(toctree[0][1][2],\n+                ([compact_paragraph, reference, \"subsection\"],\n+                 [bullet_list, list_item, compact_paragraph, reference, \"subsubsection\"]))\n+    assert_node(toctree[1][0],\n+                [compact_paragraph, reference, \"Test for issue #1157\"])\n+    assert_node(toctree[2][0],\n+                [compact_paragraph, reference, \"Indices and tables\"])\n+\n+\n+@pytest.mark.sphinx('xml', testroot='toctree')\n+@pytest.mark.test_params(shared_result='test_environment_toctree_basic')\n+def test_get_toc_for_tocdepth(app):\n+    app.build()\n+    toctree = TocTree(app.env).get_toc_for('tocdepth', app.builder)\n+\n+    assert_node(toctree,\n+                [bullet_list, list_item, (compact_paragraph,  # [0][0]\n+                                          bullet_list)])  # [0][1]\n+    assert_node(toctree[0][0],\n+                [compact_paragraph, reference, \"level 1\"])\n+    assert_node(toctree[0][1],\n+                [bullet_list, list_item, compact_paragraph, reference, \"level 2\"])\n+\n+\n+@pytest.mark.sphinx('xml', testroot='toctree')\n+@pytest.mark.test_params(shared_result='test_environment_toctree_basic')\n+def test_get_toctree_for(app):\n+    app.build()\n+    toctree = TocTree(app.env).get_toctree_for('index', app.builder, collapse=False)\n+    assert_node(toctree,\n+                [compact_paragraph, ([title, \"Table of Contents\"],\n+                                     bullet_list,\n+                                     bullet_list,\n+                                     bullet_list)])\n+\n+    assert_node(toctree[1],\n+                ([list_item, ([compact_paragraph, reference, \"foo\"],\n+                              bullet_list)],\n+                 [list_item, compact_paragraph, reference, \"bar\"],\n+                 [list_item, compact_paragraph, reference, \"http://sphinx-doc.org/\"],\n+                 [list_item, compact_paragraph, reference,\n+                  \"Welcome to Sphinx Tests\u2019s documentation!\"]))\n+    assert_node(toctree[1][0][1],\n+                ([list_item, compact_paragraph, reference, \"quux\"],\n+                 [list_item, compact_paragraph, reference, \"foo.1\"],\n+                 [list_item, compact_paragraph, reference, \"foo.2\"]))\n+\n+    assert_node(toctree[1][0][0][0], reference, refuri=\"foo\", secnumber=[1])\n+    assert_node(toctree[1][0][1][0][0][0], reference, refuri=\"quux\", secnumber=[1, 1])\n+    assert_node(toctree[1][0][1][1][0][0], reference, refuri=\"foo#foo-1\", secnumber=[1, 2])\n+    assert_node(toctree[1][0][1][2][0][0], reference, refuri=\"foo#foo-2\", secnumber=[1, 3])\n+    assert_node(toctree[1][1][0][0], reference, refuri=\"bar\", secnumber=[2])\n+    assert_node(toctree[1][2][0][0], reference, refuri=\"http://sphinx-doc.org/\")\n+    assert_node(toctree[1][3][0][0], reference, refuri=\"\")\n+\n+    assert_node(toctree[2],\n+                [bullet_list, list_item, compact_paragraph, reference, \"baz\"])\n+    assert_node(toctree[3],\n+                ([list_item, compact_paragraph, reference, \"Latest reference\"],\n+                 [list_item, compact_paragraph, reference, \"Python\"]))\n+    assert_node(toctree[3][0][0][0], reference, refuri=\"http://sphinx-doc.org/latest/\")\n+    assert_node(toctree[3][1][0][0], reference, refuri=\"http://python.org/\")\n+\n+\n+@pytest.mark.sphinx('xml', testroot='toctree')\n+@pytest.mark.test_params(shared_result='test_environment_toctree_basic')\n+def test_get_toctree_for_collapse(app):\n+    app.build()\n+    toctree = TocTree(app.env).get_toctree_for('index', app.builder, collapse=True)\n+    assert_node(toctree,\n+                [compact_paragraph, ([title, \"Table of Contents\"],\n+                                     bullet_list,\n+                                     bullet_list,\n+                                     bullet_list)])\n+\n+    assert_node(toctree[1],\n+                ([list_item, compact_paragraph, reference, \"foo\"],\n+                 [list_item, compact_paragraph, reference, \"bar\"],\n+                 [list_item, compact_paragraph, reference, \"http://sphinx-doc.org/\"],\n+                 [list_item, compact_paragraph, reference,\n+                  \"Welcome to Sphinx Tests\u2019s documentation!\"]))\n+    assert_node(toctree[1][0][0][0], reference, refuri=\"foo\", secnumber=[1])\n+    assert_node(toctree[1][1][0][0], reference, refuri=\"bar\", secnumber=[2])\n+    assert_node(toctree[1][2][0][0], reference, refuri=\"http://sphinx-doc.org/\")\n+    assert_node(toctree[1][3][0][0], reference, refuri=\"\")\n+\n+    assert_node(toctree[2],\n+                [bullet_list, list_item, compact_paragraph, reference, \"baz\"])\n+    assert_node(toctree[3],\n+                ([list_item, compact_paragraph, reference, \"Latest reference\"],\n+                 [list_item, compact_paragraph, reference, \"Python\"]))\n+    assert_node(toctree[3][0][0][0], reference, refuri=\"http://sphinx-doc.org/latest/\")\n+    assert_node(toctree[3][1][0][0], reference, refuri=\"http://python.org/\")\n+\n+\n+@pytest.mark.sphinx('xml', testroot='toctree')\n+@pytest.mark.test_params(shared_result='test_environment_toctree_basic')\n+def test_get_toctree_for_maxdepth(app):\n+    app.build()\n+    toctree = TocTree(app.env).get_toctree_for('index', app.builder,\n+                                               collapse=False, maxdepth=3)\n+    assert_node(toctree,\n+                [compact_paragraph, ([title, \"Table of Contents\"],\n+                                     bullet_list,\n+                                     bullet_list,\n+                                     bullet_list)])\n+\n+    assert_node(toctree[1],\n+                ([list_item, ([compact_paragraph, reference, \"foo\"],\n+                              bullet_list)],\n+                 [list_item, compact_paragraph, reference, \"bar\"],\n+                 [list_item, compact_paragraph, reference, \"http://sphinx-doc.org/\"],\n+                 [list_item, compact_paragraph, reference,\n+                  \"Welcome to Sphinx Tests\u2019s documentation!\"]))\n+    assert_node(toctree[1][0][1],\n+                ([list_item, compact_paragraph, reference, \"quux\"],\n+                 [list_item, ([compact_paragraph, reference, \"foo.1\"],\n+                              bullet_list)],\n+                 [list_item, compact_paragraph, reference, \"foo.2\"]))\n+    assert_node(toctree[1][0][1][1][1],\n+                [bullet_list, list_item, compact_paragraph, reference, \"foo.1-1\"])\n+\n+    assert_node(toctree[1][0][0][0], reference, refuri=\"foo\", secnumber=[1])\n+    assert_node(toctree[1][0][1][0][0][0], reference, refuri=\"quux\", secnumber=[1, 1])\n+    assert_node(toctree[1][0][1][1][0][0], reference, refuri=\"foo#foo-1\", secnumber=[1, 2])\n+    assert_node(toctree[1][0][1][1][1][0][0][0],\n+                reference, refuri=\"foo#foo-1-1\", secnumber=[1, 2, 1])\n+    assert_node(toctree[1][0][1][2][0][0], reference, refuri=\"foo#foo-2\", secnumber=[1, 3])\n+    assert_node(toctree[1][1][0][0], reference, refuri=\"bar\", secnumber=[2])\n+    assert_node(toctree[1][2][0][0], reference, refuri=\"http://sphinx-doc.org/\")\n+    assert_node(toctree[1][3][0][0], reference, refuri=\"\")\n+\n+    assert_node(toctree[2],\n+                [bullet_list, list_item, compact_paragraph, reference, \"baz\"])\n+    assert_node(toctree[3],\n+                ([list_item, compact_paragraph, reference, \"Latest reference\"],\n+                 [list_item, compact_paragraph, reference, \"Python\"]))\n+    assert_node(toctree[3][0][0][0], reference, refuri=\"http://sphinx-doc.org/latest/\")\n+    assert_node(toctree[3][1][0][0], reference, refuri=\"http://python.org/\")\n+\n+\n+@pytest.mark.sphinx('xml', testroot='toctree')\n+@pytest.mark.test_params(shared_result='test_environment_toctree_basic')\n+def test_get_toctree_for_includehidden(app):\n+    app.build()\n+    toctree = TocTree(app.env).get_toctree_for('index', app.builder, collapse=False,\n+                                               includehidden=False)\n+    assert_node(toctree,\n+                [compact_paragraph, ([title, \"Table of Contents\"],\n+                                     bullet_list,\n+                                     bullet_list)])\n+\n+    assert_node(toctree[1],\n+                ([list_item, ([compact_paragraph, reference, \"foo\"],\n+                              bullet_list)],\n+                 [list_item, compact_paragraph, reference, \"bar\"],\n+                 [list_item, compact_paragraph, reference, \"http://sphinx-doc.org/\"],\n+                 [list_item, compact_paragraph, reference,\n+                  \"Welcome to Sphinx Tests\u2019s documentation!\"]))\n+    assert_node(toctree[1][0][1],\n+                ([list_item, compact_paragraph, reference, \"quux\"],\n+                 [list_item, compact_paragraph, reference, \"foo.1\"],\n+                 [list_item, compact_paragraph, reference, \"foo.2\"]))\n+\n+    assert_node(toctree[1][0][0][0], reference, refuri=\"foo\", secnumber=[1])\n+    assert_node(toctree[1][0][1][0][0][0], reference, refuri=\"quux\", secnumber=[1, 1])\n+    assert_node(toctree[1][0][1][1][0][0], reference, refuri=\"foo#foo-1\", secnumber=[1, 2])\n+    assert_node(toctree[1][0][1][2][0][0], reference, refuri=\"foo#foo-2\", secnumber=[1, 3])\n+    assert_node(toctree[1][1][0][0], reference, refuri=\"bar\", secnumber=[2])\n+    assert_node(toctree[1][2][0][0], reference, refuri=\"http://sphinx-doc.org/\")\n+\n+    assert_node(toctree[2],\n+                [bullet_list, list_item, compact_paragraph, reference, \"baz\"])\n+\n+\n+@pytest.mark.sphinx('xml', testroot='toctree-index')\n+def test_toctree_index(app):\n+    app.build()\n+    toctree = app.env.tocs['index']\n+    assert_node(toctree,\n+                [bullet_list, ([list_item, (compact_paragraph,  # [0][0]\n+                                            [bullet_list, (addnodes.toctree,  # [0][1][0]\n+                                                           addnodes.toctree)])])])  # [0][1][1]\n+    assert_node(toctree[0][1][1], addnodes.toctree,\n+                caption=\"Indices\", glob=False, hidden=False,\n+                titlesonly=False, maxdepth=-1, numbered=0,\n+                entries=[(None, 'genindex'), (None, 'modindex'), (None, 'search')])\n+\n+\n+@pytest.mark.sphinx(\n+    'html',\n+    confoverrides={'rst_prolog': '.. |foo| replace:: bar'}\n+)\n+def test_rst_prolog_with_domain_directive_heading(app):\n+    \"\"\"Test that a domain directive in a heading is not lost when rst_prolog is used.\"\"\"\n+    (app.srcdir / 'index.rst').write_text('.. toctree::\\n\\n   mypackage\\n')\n+    (app.srcdir / 'mypackage.rst').write_text(':mod:`mypackage`\\n=================\\n\\nContent\\n')\n+    app.build()\n+\n+    toc = app.env.tocs['mypackage']\n+    assert len(toc) == 1\n"], "arch": "x86_64", "base_commit": "71db08c05197545944949d5aa76cd340e7143627", "test_directives": ["tests/test_environment_adapters_toctree.py"], "coverage_files": ["sphinx/util/rst.py"], "env_name": "testbed", "run_id": "full_evaluation", "patch_id": "pred_post__Prometheus-Bug-Reproduction-Agent", "timeout": 1800, "rm_image": false, "force_rebuild": false, "exec_mode": "unit_test", "reproduction_script_name": null, "compute_coverage": true, "install": {"python": "3.9", "pip_packages": ["tox==4.16.0", "tox-current-env==0.0.11"], "install": "python -m pip install -e .[test]", "pre_install": ["sed -i 's/pytest/pytest -rA/' tox.ini"]}, "cache_level": "instance", "test_command": "python3 /root/trace.py --count -C coverage.cover --include-pattern '/testbed/(sphinx/util/rst\\.py)' -m tox -epy39 -v -- tests/test_environment_adapters_toctree.py", "req_install_commands": ["conda create -n testbed python=3.9  -y"]}