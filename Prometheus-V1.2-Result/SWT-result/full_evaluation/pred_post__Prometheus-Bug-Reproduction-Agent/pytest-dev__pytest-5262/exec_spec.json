{"instance_id": "pytest-dev__pytest-5262", "repo": "pytest-dev/pytest", "version": "4.5", "environment_setup_commit": "693c3b7f61d4d32f8927a74f34ce8ac56d63958e", "patch_list": ["diff --git a/src/_pytest/capture.py b/src/_pytest/capture.py\n--- a/src/_pytest/capture.py\n+++ b/src/_pytest/capture.py\n@@ -447,6 +447,10 @@ def name(self):\n         \"\"\"Ensure that file.name is a string.\"\"\"\n         return repr(self.buffer)\n \n+    @property\n+    def mode(self):\n+        return self.buffer.mode.replace(\"b\", \"\")\n+\n     def __getattr__(self, name):\n         return getattr(object.__getattribute__(self, \"buffer\"), name)\n \n", "diff --git a/testing/test_capture_encoded_file_mode.py b/testing/test_capture_encoded_file_mode.py\nnew file mode 100644\nindex 000000000..b40882b4a\n--- /dev/null\n+++ b/testing/test_capture_encoded_file_mode.py\n@@ -0,0 +1,29 @@\n+import os\n+import sys\n+\n+import pytest\n+\n+\n+@pytest.mark.skipif(not hasattr(os, \"dup\"), reason=\"test needs os.dup\")\n+def test_encoded_file_mode_is_text(testdir):\n+    \"\"\"\n+    _pytest.capture.EncodedFile should not report a binary mode.\n+\n+    A stream may be opened in binary mode, but EncodedFile wraps it to\n+    provide a text stream. This was causing problems with youtube-dl, which\n+    would inspect the `mode` attribute and attempt to write bytes to the\n+    stream, which is not supported by EncodedFile on Python 3.\n+\n+    See issue #4939.\n+    \"\"\"\n+    testdir.makepyfile(\n+        \"\"\"\n+        import sys\n+\n+        def test_mode():\n+            assert 'b' not in sys.stdout.mode\n+            assert 'b' not in sys.stderr.mode\n+    \"\"\"\n+    )\n+    result = testdir.runpytest()\n+    result.assert_outcomes(passed=1)\n"], "arch": "x86_64", "base_commit": "58e6a09db49f34886ff13f3b7520dd0bcd7063cd", "test_directives": ["testing/test_capture_encoded_file_mode.py"], "coverage_files": ["src/_pytest/capture.py"], "env_name": "testbed", "run_id": "full_evaluation", "patch_id": "pred_post__Prometheus-Bug-Reproduction-Agent", "timeout": 1800, "rm_image": false, "force_rebuild": false, "exec_mode": "unit_test", "reproduction_script_name": null, "compute_coverage": true, "install": {"python": "3.9", "install": "python -m pip install -e .", "pip_packages": ["atomicwrites==1.4.1", "attrs==23.1.0", "more-itertools==10.1.0", "pluggy==0.11.0", "py==1.11.0", "setuptools==68.0.0", "six==1.16.0", "wcwidth==0.2.6"]}, "cache_level": "instance", "test_command": "python3 /root/trace.py --count -C coverage.cover --include-pattern '/testbed/(src/_pytest/capture\\.py)' -m pytest -rA testing/test_capture_encoded_file_mode.py", "req_install_commands": ["conda create -n testbed python=3.9  -y"]}