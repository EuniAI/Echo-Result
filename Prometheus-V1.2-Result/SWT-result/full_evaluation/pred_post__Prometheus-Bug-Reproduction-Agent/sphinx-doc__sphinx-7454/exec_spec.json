{"instance_id": "sphinx-doc__sphinx-7454", "repo": "sphinx-doc/sphinx", "version": "3.0", "environment_setup_commit": "50d2d289e150cb429de15770bdd48a723de8c45d", "patch_list": ["diff --git a/sphinx/domains/python.py b/sphinx/domains/python.py\n--- a/sphinx/domains/python.py\n+++ b/sphinx/domains/python.py\n@@ -71,8 +71,13 @@\n def _parse_annotation(annotation: str) -> List[Node]:\n     \"\"\"Parse type annotation.\"\"\"\n     def make_xref(text: str) -> addnodes.pending_xref:\n+        if text == 'None':\n+            reftype = 'obj'\n+        else:\n+            reftype = 'class'\n+\n         return pending_xref('', nodes.Text(text),\n-                            refdomain='py', reftype='class', reftarget=text)\n+                            refdomain='py', reftype=reftype, reftarget=text)\n \n     def unparse(node: ast.AST) -> List[Node]:\n         if isinstance(node, ast.Attribute):\n", "diff --git a/tests/test_ext_autodoc_typehints.py b/tests/test_ext_autodoc_typehints.py\nnew file mode 100644\nindex 000000000..c632d6c19\n--- /dev/null\n+++ b/tests/test_ext_autodoc_typehints.py\n@@ -0,0 +1,37 @@\n+import pytest\n+\n+@pytest.mark.sphinx(\n+    'html',\n+    testroot='ext-autodoc',\n+    confoverrides={\n+        'autodoc_typehints': 'signature',\n+        'intersphinx_mapping': {'python': ('https://docs.python.org/3', None)},\n+    }\n+)\n+def test_autodoc_typehints_signature_none_return_type(app):\n+    \"\"\"\n+    Test that a return type of None is linked correctly when\n+    autodoc_typehints is 'signature'. This reproduces the bug where `None`\n+    return types are not linked.\n+    \"\"\"\n+    # Create a minimal rst file to document a method that returns None.\n+    # The 'ext-autodoc' test root provides the 'target.typehints' module,\n+    # which contains 'Math.nothing() -> None'.\n+    (app.srcdir / 'index.rst').write_text(\n+        '.. automethod:: target.typehints.Math.nothing'\n+    )\n+\n+    # Build the documentation.\n+    app.build()\n+\n+    # Read the generated HTML.\n+    content = (app.outdir / 'index.html').read_text()\n+\n+    # Check that the return type \"None\" is a link to the python docs.\n+    # The expected HTML for '-> None' is '\u2192 <a ...>None</a>'.\n+    # This assertion will fail if the link is not generated.\n+    expected_link_html = (\n+        '&#x2192; <a class=\"reference external\" '\n+        'href=\"https://docs.python.org/3/library/constants.html#None\"'\n+    )\n+    assert expected_link_html in content\n"], "arch": "x86_64", "base_commit": "aca3f825f2e4a8817190f3c885a242a285aa0dba", "test_directives": ["tests/test_ext_autodoc_typehints.py"], "coverage_files": ["sphinx/domains/python.py"], "env_name": "testbed", "run_id": "full_evaluation", "patch_id": "pred_post__Prometheus-Bug-Reproduction-Agent", "timeout": 1800, "rm_image": false, "force_rebuild": false, "exec_mode": "unit_test", "reproduction_script_name": null, "compute_coverage": true, "install": {"python": "3.9", "pip_packages": ["tox==4.16.0", "tox-current-env==0.0.11"], "install": "python -m pip install -e .[test]", "pre_install": ["sed -i 's/pytest/pytest -rA/' tox.ini", "sed -i 's/Jinja2>=2.3/Jinja2<3.0/' setup.py", "sed -i 's/sphinxcontrib-applehelp/sphinxcontrib-applehelp<=1.0.7/' setup.py", "sed -i 's/sphinxcontrib-devhelp/sphinxcontrib-devhelp<=1.0.5/' setup.py", "sed -i 's/sphinxcontrib-qthelp/sphinxcontrib-qthelp<=1.0.6/' setup.py", "sed -i 's/alabaster>=0.7,<0.8/alabaster>=0.7,<0.7.12/' setup.py", "sed -i \"s/'packaging',/'packaging', 'markupsafe<=2.0.1',/\" setup.py", "sed -i 's/sphinxcontrib-htmlhelp/sphinxcontrib-htmlhelp<=2.0.4/' setup.py", "sed -i 's/sphinxcontrib-serializinghtml/sphinxcontrib-serializinghtml<=1.1.9/' setup.py"]}, "cache_level": "instance", "test_command": "python3 /root/trace.py --count -C coverage.cover --include-pattern '/testbed/(sphinx/domains/python\\.py)' -m tox -epy39 -v -- tests/test_ext_autodoc_typehints.py", "req_install_commands": ["conda create -n testbed python=3.9  -y"]}