{"instance_id": "django__django-16950", "repo": "django/django", "version": "5.0", "environment_setup_commit": "4a72da71001f154ea60906a2f74898d32b7322a7", "patch_list": ["diff --git a/tests/model_forms/test_inlineformset_uuid_fk.py b/tests/model_forms/test_inlineformset_uuid_fk.py\nnew file mode 100644\nindex 0000000000..fbedd6bbdd\n--- /dev/null\n+++ b/tests/model_forms/test_inlineformset_uuid_fk.py\n@@ -0,0 +1,79 @@\n+import uuid\n+\n+from django.db import models\n+from django.forms import modelform_factory\n+from django.forms.models import inlineformset_factory\n+from django.test import TestCase\n+\n+\n+# Models are based on the bug report.\n+# `app_label` is set to `model_forms` to align with the test suite structure,\n+# ensuring models are discovered and tables are created by the test runner.\n+class Thing(models.Model):\n+    pkid = models.BigAutoField(primary_key=True, editable=False)\n+    id = models.UUIDField(default=uuid.uuid4, editable=False, unique=True)\n+    name = models.CharField(max_length=191)\n+\n+    class Meta:\n+        app_label = \"model_forms\"\n+\n+\n+class SubThing(models.Model):\n+    name = models.CharField(max_length=191)\n+    thing = models.ForeignKey(\n+        Thing,\n+        to_field=\"id\",\n+        on_delete=models.CASCADE,\n+        related_name=\"subthings\",\n+    )\n+\n+    class Meta:\n+        app_label = \"model_forms\"\n+\n+\n+class InlineUUIDDefaultTests(TestCase):\n+    def test_create_parent_with_uuid_to_field_and_inline(self):\n+        \"\"\"\n+        A parent's UUID field default should be preserved when adding an inline\n+        for a new, unsaved parent.\n+        \"\"\"\n+        # 1. Define the forms for parent and inline child.\n+        ThingForm = modelform_factory(Thing, fields=(\"name\",))\n+        SubThingFormSet = inlineformset_factory(\n+            Thing, SubThing, fields=(\"name\",), extra=1\n+        )\n+\n+        # 2. Simulate POST data for creating a new parent and a new child.\n+        data = {\n+            \"name\": \"thing\",\n+            \"subthings-TOTAL_FORMS\": \"1\",\n+            \"subthings-INITIAL_FORMS\": \"0\",\n+            \"subthings-0-name\": \"subthing\",\n+        }\n+\n+        # 3. Validate the parent form and get an unsaved instance.\n+        # At this point, `thing.id` has a default UUID value.\n+        thing_form = ThingForm(data)\n+        self.assertTrue(thing_form.is_valid())\n+        thing = thing_form.save(commit=False)\n+\n+        # 4. Instantiate and validate the inline formset with the unsaved parent.\n+        # On the unpatched codebase, this is where the bug is triggered:\n+        # the `thing.id` field is incorrectly cleared (set to None).\n+        formset = SubThingFormSet(data, instance=thing)\n+        self.assertTrue(formset.is_valid())\n+\n+        # 5. Attempt to save the parent instance.\n+        # Before the fix, this `save()` call fails with an `IntegrityError`\n+        # because `thing.id` is `None`, violating the NOT NULL constraint.\n+        # This is the expected failure that demonstrates the bug.\n+        # After the fix, `thing.id` is preserved, and this save succeeds.\n+        thing.save()\n+\n+        # 6. Save the formset. This code is only reached on the patched version.\n+        formset.save()\n+\n+        # 7. Verify that the objects were created correctly in the database.\n+        self.assertEqual(Thing.objects.count(), 1)\n+        self.assertEqual(SubThing.objects.count(), 1)\n+        self.assertEqual(SubThing.objects.get().thing, thing)\n"], "arch": "x86_64", "base_commit": "f64fd47a7627ed6ffe2df2a32ded6ee528a784eb", "test_directives": ["model_forms.test_inlineformset_uuid_fk"], "coverage_files": ["django/forms/models.py"], "env_name": "testbed", "run_id": "patch_evaluation", "patch_id": "pred_pre__Prometheus-Bug-Reproduction-Agent", "timeout": 1800, "rm_image": false, "force_rebuild": true, "exec_mode": "unit_test", "reproduction_script_name": null, "compute_coverage": true, "install": {"python": "3.11", "packages": "requirements.txt", "install": "python -m pip install -e ."}, "cache_level": "instance", "test_command": "python3 /root/trace.py --count -C coverage.cover --include-pattern '/testbed/(django/forms/models\\.py)' ./tests/runtests.py --verbosity 2 --settings=test_sqlite --parallel 1 model_forms.test_inlineformset_uuid_fk", "req_install_commands": ["conda create -n testbed python=3.11 -y", "cat <<'EOF_59812759871' > $HOME/requirements.txt\naiosmtpd\nasgiref >= 3.7.0\nargon2-cffi >= 19.2.0\nbcrypt\nblack\ndocutils\ngeoip2; python_version < '3.12'\njinja2 >= 2.11.0\nnumpy; python_version < '3.12'\nPillow >= 6.2.1; sys.platform != 'win32' or python_version < '3.12'\npylibmc; sys.platform != 'win32'\npymemcache >= 3.4.0\npywatchman; sys.platform != 'win32'\nPyYAML\nredis >= 3.4.0\nselenium >= 4.8.0\nsqlparse >= 0.3.1\ntblib >= 1.5.0\ntzdata\ncolorama; sys.platform == 'win32'\n\nEOF_59812759871", "conda activate testbed && python -m pip install -r $HOME/requirements.txt", "rm $HOME/requirements.txt"]}