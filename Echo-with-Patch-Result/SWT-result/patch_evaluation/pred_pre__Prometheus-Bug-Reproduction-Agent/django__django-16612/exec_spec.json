{"instance_id": "django__django-16612", "repo": "django/django", "version": "5.0", "environment_setup_commit": "4a72da71001f154ea60906a2f74898d32b7322a7", "patch_list": ["diff --git a/tests/test_admin_catch_all_redirect.py b/tests/test_admin_catch_all_redirect.py\nnew file mode 100644\nindex 0000000000..1bac924cfe\n--- /dev/null\n+++ b/tests/test_admin_catch_all_redirect.py\n@@ -0,0 +1,49 @@\n+from django.contrib import admin\n+from django.contrib.auth.models import User\n+from django.test import TestCase, override_settings\n+from django.urls import path\n+\n+# A minimal admin site and URLconf to make the test self-contained.\n+# Registering a model ensures that a valid URL pattern exists, which is\n+# necessary to trigger the redirect logic in catch_all_view.\n+site = admin.AdminSite(name=\"admin\")\n+site.register(User)\n+\n+urlpatterns = [\n+    path(\"admin/\", site.urls),\n+]\n+\n+\n+@override_settings(ROOT_URLCONF=__name__)\n+class CatchAllViewRedirectTests(TestCase):\n+    @override_settings(APPEND_SLASH=True)\n+    def test_catch_all_redirect_preserves_query_string(self):\n+        \"\"\"\n+        The admin's catch-all view redirect for APPEND_SLASH should preserve\n+        the query string.\n+        \"\"\"\n+        staff_user = User.objects.create_superuser(\n+            \"staff\", \"staff@example.com\", \"password\"\n+        )\n+        self.client.force_login(staff_user)\n+\n+        # A valid admin URL for the User model changelist, but without the\n+        # trailing slash and with a query string.\n+        url_without_slash_with_qs = \"/admin/auth/user?id=123\"\n+\n+        # The expected redirect location should have the trailing slash AND\n+        # the query string.\n+        expected_redirect_url = \"/admin/auth/user/?id=123\"\n+\n+        response = self.client.get(url_without_slash_with_qs)\n+\n+        # The bug is that the redirect location is `/admin/auth/user/` without\n+        # the query string. This assertion will fail with the bug because the\n+        # actual redirect URL doesn't match the expected one. The superuser\n+        # can access the target page, so the target status code is 200.\n+        self.assertRedirects(\n+            response,\n+            expected_redirect_url,\n+            status_code=301,\n+            target_status_code=200,\n+        )\n"], "arch": "x86_64", "base_commit": "55bcbd8d172b689811fae17cde2f09218dd74e9c", "test_directives": ["test_admin_catch_all_redirect"], "coverage_files": ["django/contrib/admin/sites.py"], "env_name": "testbed", "run_id": "patch_evaluation", "patch_id": "pred_pre__Prometheus-Bug-Reproduction-Agent", "timeout": 1800, "rm_image": false, "force_rebuild": true, "exec_mode": "unit_test", "reproduction_script_name": null, "compute_coverage": true, "install": {"python": "3.11", "packages": "requirements.txt", "install": "python -m pip install -e ."}, "cache_level": "instance", "test_command": "python3 /root/trace.py --count -C coverage.cover --include-pattern '/testbed/(django/contrib/admin/sites\\.py)' ./tests/runtests.py --verbosity 2 --settings=test_sqlite --parallel 1 test_admin_catch_all_redirect", "req_install_commands": ["conda create -n testbed python=3.11 -y", "cat <<'EOF_59812759871' > $HOME/requirements.txt\naiosmtpd\nasgiref >= 3.7.0\nargon2-cffi >= 19.2.0\nbcrypt\nblack\ndocutils\ngeoip2; python_version < '3.12'\njinja2 >= 2.11.0\nnumpy; python_version < '3.12'\nPillow >= 6.2.1; sys.platform != 'win32' or python_version < '3.12'\npylibmc; sys.platform != 'win32'\npymemcache >= 3.4.0\npywatchman; sys.platform != 'win32'\nPyYAML\nredis >= 3.4.0\nselenium >= 4.8.0\nsqlparse >= 0.3.1\ntblib >= 1.5.0\ntzdata\ncolorama; sys.platform == 'win32'\n\nEOF_59812759871", "conda activate testbed && python -m pip install -r $HOME/requirements.txt", "rm $HOME/requirements.txt"]}