{"instance_id": "django__django-14752", "repo": "django/django", "version": "4.0", "environment_setup_commit": "475cffd1d64c690cdad16ede4d5e81985738ceb4", "patch_list": ["diff --git a/tests/admin_views/test_autocomplete_refactor.py b/tests/admin_views/test_autocomplete_refactor.py\nnew file mode 100644\nindex 0000000000..4dcbb450cf\n--- /dev/null\n+++ b/tests/admin_views/test_autocomplete_refactor.py\n@@ -0,0 +1,59 @@\n+from django.contrib.admin.views.autocomplete import AutocompleteJsonView\n+from django.test import TestCase\n+\n+# Import the existing Question model from the test application's models.\n+# This relies on the test file being placed in the 'tests/admin_views/' directory\n+# by the test runner, which is standard practice and avoids model conflicts.\n+from .models import Question\n+\n+\n+class CustomAutocompleteJsonView(AutocompleteJsonView):\n+    \"\"\"\n+    A custom AutocompleteJsonView that overrides serialize_result to add\n+    extra data, as proposed in the issue description.\n+    \"\"\"\n+\n+    def serialize_result(self, obj, to_field_name):\n+        \"\"\"\n+        This override calls super() to extend the base result. This call will\n+        raise an AttributeError before the patch is applied, because the\n+        method does not exist on the base class.\n+        \"\"\"\n+        data = super().serialize_result(obj, to_field_name)\n+        data[\"notes\"] = obj.question\n+        return data\n+\n+\n+class AutocompleteRefactorTest(TestCase):\n+    \"\"\"\n+    Tests the refactoring of AutocompleteJsonView to allow customization of the\n+    result serialization.\n+    \"\"\"\n+\n+    @classmethod\n+    def setUpTestData(cls):\n+        # Create a single model instance to be used in the test.\n+        cls.question = Question.objects.create(question=\"Is this a test?\")\n+\n+    def test_serialize_result_can_be_extended(self):\n+        \"\"\"\n+        Tests that overriding serialize_result works as an extension point.\n+        This test directly calls the method to isolate the unit of behavior.\n+        \"\"\"\n+        view = CustomAutocompleteJsonView()\n+        obj = self.question\n+        to_field_name = \"pk\"\n+\n+        # This line will raise an AttributeError before the patch because\n+        # AutocompleteJsonView has no 'serialize_result' method for super()\n+        # to call. This is the expected failure.\n+        result = view.serialize_result(obj, to_field_name)\n+\n+        # This assertion will only be reached after the patch is applied.\n+        # It verifies that the super() call worked and the extra data was added.\n+        expected_result = {\n+            \"id\": str(obj.pk),\n+            \"text\": str(obj),\n+            \"notes\": obj.question,\n+        }\n+        self.assertEqual(result, expected_result)\n"], "arch": "x86_64", "base_commit": "b64db05b9cedd96905d637a2d824cbbf428e40e7", "test_directives": ["admin_views.test_autocomplete_refactor"], "coverage_files": ["django/contrib/admin/views/autocomplete.py"], "env_name": "testbed", "run_id": "patch_evaluation", "patch_id": "pred_pre__Prometheus-Bug-Reproduction-Agent", "timeout": 1800, "rm_image": false, "force_rebuild": true, "exec_mode": "unit_test", "reproduction_script_name": null, "compute_coverage": true, "install": {"python": "3.8", "packages": "requirements.txt", "install": "python -m pip install -e ."}, "cache_level": "instance", "test_command": "python3 /root/trace.py --count -C coverage.cover --include-pattern '/testbed/(django/contrib/admin/views/autocomplete\\.py)' ./tests/runtests.py --verbosity 2 --settings=test_sqlite --parallel 1 admin_views.test_autocomplete_refactor", "req_install_commands": ["conda create -n testbed python=3.8 -y", "cat <<'EOF_59812759871' > $HOME/requirements.txt\nasgiref >= 3.3.2\nargon2-cffi >= 16.1.0\nbackports.zoneinfo; python_version < '3.9'\nbcrypt\ndocutils\ngeoip2\njinja2 >= 2.9.2\nnumpy\nPillow >= 6.2.0\npylibmc; sys.platform != 'win32'\npymemcache >= 3.4.0\npython-memcached >= 1.59\npytz\npywatchman; sys.platform != 'win32'\nPyYAML\nredis >= 3.0.0\nselenium\nsqlparse >= 0.2.2\ntblib >= 1.5.0\ntzdata\ncolorama; sys.platform == 'win32'\n\nEOF_59812759871", "conda activate testbed && python -m pip install -r $HOME/requirements.txt", "rm $HOME/requirements.txt"]}