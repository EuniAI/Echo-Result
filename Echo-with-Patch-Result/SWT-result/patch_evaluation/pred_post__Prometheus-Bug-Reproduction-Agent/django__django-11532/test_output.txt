+ source /opt/miniconda3/bin/activate
++ _CONDA_ROOT=/opt/miniconda3
++ . /opt/miniconda3/etc/profile.d/conda.sh
+++ export CONDA_EXE=/opt/miniconda3/bin/conda
+++ CONDA_EXE=/opt/miniconda3/bin/conda
+++ export _CE_M=
+++ _CE_M=
+++ export _CE_CONDA=
+++ _CE_CONDA=
+++ export CONDA_PYTHON_EXE=/opt/miniconda3/bin/python
+++ CONDA_PYTHON_EXE=/opt/miniconda3/bin/python
+++ '[' -z '' ']'
+++ export CONDA_SHLVL=0
+++ CONDA_SHLVL=0
+++ '[' -n '' ']'
+++++ dirname /opt/miniconda3/bin/conda
++++ dirname /opt/miniconda3/bin
+++ PATH=/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
+++ export PATH
+++ '[' -z '' ']'
+++ PS1=
++ conda activate
++ local cmd=activate
++ case "$cmd" in
++ __conda_activate activate
++ '[' -n '' ']'
++ local ask_conda
+++ PS1=
+++ __conda_exe shell.posix activate
+++ /opt/miniconda3/bin/conda shell.posix activate
++ ask_conda='PS1='\''(base) '\''
export PATH='\''/opt/miniconda3/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'\''
export CONDA_PREFIX='\''/opt/miniconda3'\''
export CONDA_SHLVL='\''1'\''
export CONDA_DEFAULT_ENV='\''base'\''
export CONDA_PROMPT_MODIFIER='\''(base) '\''
export CONDA_EXE='\''/opt/miniconda3/bin/conda'\''
export _CE_M='\'''\''
export _CE_CONDA='\'''\''
export CONDA_PYTHON_EXE='\''/opt/miniconda3/bin/python'\'''
++ eval 'PS1='\''(base) '\''
export PATH='\''/opt/miniconda3/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'\''
export CONDA_PREFIX='\''/opt/miniconda3'\''
export CONDA_SHLVL='\''1'\''
export CONDA_DEFAULT_ENV='\''base'\''
export CONDA_PROMPT_MODIFIER='\''(base) '\''
export CONDA_EXE='\''/opt/miniconda3/bin/conda'\''
export _CE_M='\'''\''
export _CE_CONDA='\'''\''
export CONDA_PYTHON_EXE='\''/opt/miniconda3/bin/python'\'''
+++ PS1='(base) '
+++ export PATH=/opt/miniconda3/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
+++ PATH=/opt/miniconda3/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
+++ export CONDA_PREFIX=/opt/miniconda3
+++ CONDA_PREFIX=/opt/miniconda3
+++ export CONDA_SHLVL=1
+++ CONDA_SHLVL=1
+++ export CONDA_DEFAULT_ENV=base
+++ CONDA_DEFAULT_ENV=base
+++ export 'CONDA_PROMPT_MODIFIER=(base) '
+++ CONDA_PROMPT_MODIFIER='(base) '
+++ export CONDA_EXE=/opt/miniconda3/bin/conda
+++ CONDA_EXE=/opt/miniconda3/bin/conda
+++ export _CE_M=
+++ _CE_M=
+++ export _CE_CONDA=
+++ _CE_CONDA=
+++ export CONDA_PYTHON_EXE=/opt/miniconda3/bin/python
+++ CONDA_PYTHON_EXE=/opt/miniconda3/bin/python
++ __conda_hashr
++ '[' -n '' ']'
++ '[' -n '' ']'
++ hash -r
+ conda activate testbed
+ local cmd=activate
+ case "$cmd" in
+ __conda_activate activate testbed
+ '[' -n '' ']'
+ local ask_conda
++ PS1='(base) '
++ __conda_exe shell.posix activate testbed
++ /opt/miniconda3/bin/conda shell.posix activate testbed
+ ask_conda='PS1='\''(testbed) '\''
export PATH='\''/opt/miniconda3/envs/testbed/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'\''
export CONDA_PREFIX='\''/opt/miniconda3/envs/testbed'\''
export CONDA_SHLVL='\''2'\''
export CONDA_DEFAULT_ENV='\''testbed'\''
export CONDA_PROMPT_MODIFIER='\''(testbed) '\''
export CONDA_PREFIX_1='\''/opt/miniconda3'\''
export CONDA_EXE='\''/opt/miniconda3/bin/conda'\''
export _CE_M='\'''\''
export _CE_CONDA='\'''\''
export CONDA_PYTHON_EXE='\''/opt/miniconda3/bin/python'\'''
+ eval 'PS1='\''(testbed) '\''
export PATH='\''/opt/miniconda3/envs/testbed/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'\''
export CONDA_PREFIX='\''/opt/miniconda3/envs/testbed'\''
export CONDA_SHLVL='\''2'\''
export CONDA_DEFAULT_ENV='\''testbed'\''
export CONDA_PROMPT_MODIFIER='\''(testbed) '\''
export CONDA_PREFIX_1='\''/opt/miniconda3'\''
export CONDA_EXE='\''/opt/miniconda3/bin/conda'\''
export _CE_M='\'''\''
export _CE_CONDA='\'''\''
export CONDA_PYTHON_EXE='\''/opt/miniconda3/bin/python'\'''
++ PS1='(testbed) '
++ export PATH=/opt/miniconda3/envs/testbed/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
++ PATH=/opt/miniconda3/envs/testbed/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
++ export CONDA_PREFIX=/opt/miniconda3/envs/testbed
++ CONDA_PREFIX=/opt/miniconda3/envs/testbed
++ export CONDA_SHLVL=2
++ CONDA_SHLVL=2
++ export CONDA_DEFAULT_ENV=testbed
++ CONDA_DEFAULT_ENV=testbed
++ export 'CONDA_PROMPT_MODIFIER=(testbed) '
++ CONDA_PROMPT_MODIFIER='(testbed) '
++ export CONDA_PREFIX_1=/opt/miniconda3
++ CONDA_PREFIX_1=/opt/miniconda3
++ export CONDA_EXE=/opt/miniconda3/bin/conda
++ CONDA_EXE=/opt/miniconda3/bin/conda
++ export _CE_M=
++ _CE_M=
++ export _CE_CONDA=
++ _CE_CONDA=
++ export CONDA_PYTHON_EXE=/opt/miniconda3/bin/python
++ CONDA_PYTHON_EXE=/opt/miniconda3/bin/python
+ __conda_hashr
+ '[' -n '' ']'
+ '[' -n '' ']'
+ hash -r
+ cd /testbed
+ git diff HEAD a5308514fb4bc5086c9a16a8a24a945eeebb073c
+ sed -i '/en_US.UTF-8/s/^# //g' /etc/locale.gen
+ locale-gen
Generating locales (this might take a while)...
  en_US.UTF-8... done
Generation complete.
+ export LANG=en_US.UTF-8
+ LANG=en_US.UTF-8
+ export LANGUAGE=en_US:en
+ LANGUAGE=en_US:en
+ export LC_ALL=en_US.UTF-8
+ LC_ALL=en_US.UTF-8
+ git config --global --add safe.directory /testbed
+ cd /testbed
+ git status
On branch main
nothing to commit, working tree clean
+ git show
commit a5308514fb4bc5086c9a16a8a24a945eeebb073c
Author: Hasan Ramezani <hasan.r67@gmail.com>
Date:   Fri Jun 21 23:38:27 2019 +0200

    Fixed #27801 -- Made createsuperuser fall back to environment variables for password and required fields.

diff --git a/django/contrib/auth/management/commands/createsuperuser.py b/django/contrib/auth/management/commands/createsuperuser.py
index d700ce4c0e..ece66dfad1 100644
--- a/django/contrib/auth/management/commands/createsuperuser.py
+++ b/django/contrib/auth/management/commands/createsuperuser.py
@@ -2,6 +2,7 @@
 Management utility to create superusers.
 """
 import getpass
+import os
 import sys
 
 from django.contrib.auth import get_user_model
@@ -138,6 +139,13 @@ class Command(BaseCommand):
                     user_data[PASSWORD_FIELD] = password
             else:
                 # Non-interactive mode.
+                # Use password from environment variable, if provided.
+                if PASSWORD_FIELD in user_data and 'DJANGO_SUPERUSER_PASSWORD' in os.environ:
+                    user_data[PASSWORD_FIELD] = os.environ['DJANGO_SUPERUSER_PASSWORD']
+                # Use username from environment variable, if not provided in
+                # options.
+                if username is None:
+                    username = os.environ.get('DJANGO_SUPERUSER_' + self.UserModel.USERNAME_FIELD.upper())
                 if username is None:
                     raise CommandError('You must use --%s with --noinput.' % self.UserModel.USERNAME_FIELD)
                 else:
@@ -147,11 +155,12 @@ class Command(BaseCommand):
 
                 user_data[self.UserModel.USERNAME_FIELD] = username
                 for field_name in self.UserModel.REQUIRED_FIELDS:
-                    if options[field_name]:
-                        field = self.UserModel._meta.get_field(field_name)
-                        user_data[field_name] = field.clean(options[field_name], None)
-                    else:
+                    env_var = 'DJANGO_SUPERUSER_' + field_name.upper()
+                    value = options[field_name] or os.environ.get(env_var)
+                    if not value:
                         raise CommandError('You must use --%s with --noinput.' % field_name)
+                    field = self.UserModel._meta.get_field(field_name)
+                    user_data[field_name] = field.clean(value, None)
 
             self.UserModel._default_manager.db_manager(database).create_superuser(**user_data)
             if options['verbosity'] >= 1:
diff --git a/docs/ref/django-admin.txt b/docs/ref/django-admin.txt
index 69e00b0428..e139c8128f 100644
--- a/docs/ref/django-admin.txt
+++ b/docs/ref/django-admin.txt
@@ -1560,9 +1560,23 @@ useful if you need to create an initial superuser account or if you need to
 programmatically generate superuser accounts for your site(s).
 
 When run interactively, this command will prompt for a password for
-the new superuser account. When run non-interactively, no password
-will be set, and the superuser account will not be able to log in until
-a password has been manually set for it.
+the new superuser account. When run non-interactively, you can provide
+a password by setting the ``DJANGO_SUPERUSER_PASSWORD`` environment variable.
+Otherwise, no password will be set, and the superuser account will not be able
+to log in until a password has been manually set for it.
+
+In non-interactive mode, the
+:attr:`~django.contrib.auth.models.CustomUser.USERNAME_FIELD` and required
+fields (listed in
+:attr:`~django.contrib.auth.models.CustomUser.REQUIRED_FIELDS`) fall back to
+``DJANGO_SUPERUSER_<uppercase_field_name>`` environment variables, unless they
+are overridden by a command line argument. For example, to provide an ``email``
+field, you can use ``DJANGO_SUPERUSER_EMAIL`` environment variable.
+
+.. versionchanged:: 3.0
+
+    Support for using ``DJANGO_SUPERUSER_PASSWORD`` and
+    ``DJANGO_SUPERUSER_<uppercase_field_name>`` environment variables was added.
 
 .. django-admin-option:: --username USERNAME
 .. django-admin-option:: --email EMAIL
diff --git a/docs/releases/3.0.txt b/docs/releases/3.0.txt
index 4c33e7c309..c7f1a4e78b 100644
--- a/docs/releases/3.0.txt
+++ b/docs/releases/3.0.txt
@@ -102,6 +102,10 @@ Minor features
   password fields in :mod:`django.contrib.auth.forms` for better interaction
   with browser password managers.
 
+* :djadmin:`createsuperuser` now falls back to environment variables for
+  password and required fields, when a corresponding command line argument
+  isn't provided in non-interactive mode.
+
 :mod:`django.contrib.contenttypes`
 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 
diff --git a/tests/auth_tests/test_management.py b/tests/auth_tests/test_management.py
index d0a91f3261..bf9b063102 100644
--- a/tests/auth_tests/test_management.py
+++ b/tests/auth_tests/test_management.py
@@ -1,5 +1,6 @@
 import builtins
 import getpass
+import os
 import sys
 from datetime import date
 from io import StringIO
@@ -905,6 +906,61 @@ class CreatesuperuserManagementCommandTestCase(TestCase):
 
         test(self)
 
+    @mock.patch.dict(os.environ, {
+        'DJANGO_SUPERUSER_PASSWORD': 'test_password',
+        'DJANGO_SUPERUSER_USERNAME': 'test_superuser',
+        'DJANGO_SUPERUSER_EMAIL': 'joe@somewhere.org',
+        'DJANGO_SUPERUSER_FIRST_NAME': 'ignored_first_name',
+    })
+    def test_environment_variable_non_interactive(self):
+        call_command('createsuperuser', interactive=False, stdout=StringIO())
+        user = User.objects.get(username='test_superuser')
+        self.assertEqual(user.email, 'joe@somewhere.org')
+        self.assertTrue(user.check_password('test_password'))
+        # Environment variables are ignored for non-required fields.
+        self.assertEqual(user.first_name, '')
+
+    @mock.patch.dict(os.environ, {
+        'DJANGO_SUPERUSER_USERNAME': 'test_superuser',
+        'DJANGO_SUPERUSER_EMAIL': 'joe@somewhere.org',
+    })
+    def test_ignore_environment_variable_non_interactive(self):
+        # Environment variables are ignored in non-interactive mode, if
+        # provided by a command line arguments.
+        call_command(
+            'createsuperuser',
+            interactive=False,
+            username='cmd_superuser',
+            email='cmd@somewhere.org',
+            stdout=StringIO(),
+        )
+        user = User.objects.get(username='cmd_superuser')
+        self.assertEqual(user.email, 'cmd@somewhere.org')
+        self.assertFalse(user.has_usable_password())
+
+    @mock.patch.dict(os.environ, {
+        'DJANGO_SUPERUSER_PASSWORD': 'test_password',
+        'DJANGO_SUPERUSER_USERNAME': 'test_superuser',
+        'DJANGO_SUPERUSER_EMAIL': 'joe@somewhere.org',
+    })
+    def test_ignore_environment_variable_interactive(self):
+        # Environment variables are ignored in interactive mode.
+        @mock_inputs({'password': 'cmd_password'})
+        def test(self):
+            call_command(
+                'createsuperuser',
+                interactive=True,
+                username='cmd_superuser',
+                email='cmd@somewhere.org',
+                stdin=MockTTY(),
+                stdout=StringIO(),
+            )
+            user = User.objects.get(username='cmd_superuser')
+            self.assertEqual(user.email, 'cmd@somewhere.org')
+            self.assertTrue(user.check_password('cmd_password'))
+
+        test(self)
+
 
 class MultiDBCreatesuperuserTestCase(TestCase):
     databases = {'default', 'other'}
+ git diff a5308514fb4bc5086c9a16a8a24a945eeebb073c
+ source /opt/miniconda3/bin/activate
++ _CONDA_ROOT=/opt/miniconda3
++ . /opt/miniconda3/etc/profile.d/conda.sh
+++ export CONDA_EXE=/opt/miniconda3/bin/conda
+++ CONDA_EXE=/opt/miniconda3/bin/conda
+++ export _CE_M=
+++ _CE_M=
+++ export _CE_CONDA=
+++ _CE_CONDA=
+++ export CONDA_PYTHON_EXE=/opt/miniconda3/bin/python
+++ CONDA_PYTHON_EXE=/opt/miniconda3/bin/python
+++ '[' -z x ']'
++ conda activate
++ local cmd=activate
++ case "$cmd" in
++ __conda_activate activate
++ '[' -n '' ']'
++ local ask_conda
+++ PS1='(testbed) '
+++ __conda_exe shell.posix activate
+++ /opt/miniconda3/bin/conda shell.posix activate
++ ask_conda='PS1='\''(base) '\''
export PATH='\''/opt/miniconda3/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'\''
export CONDA_PREFIX='\''/opt/miniconda3'\''
export CONDA_SHLVL='\''3'\''
export CONDA_DEFAULT_ENV='\''base'\''
export CONDA_PROMPT_MODIFIER='\''(base) '\''
export CONDA_PREFIX_2='\''/opt/miniconda3/envs/testbed'\''
export CONDA_EXE='\''/opt/miniconda3/bin/conda'\''
export _CE_M='\'''\''
export _CE_CONDA='\'''\''
export CONDA_PYTHON_EXE='\''/opt/miniconda3/bin/python'\'''
++ eval 'PS1='\''(base) '\''
export PATH='\''/opt/miniconda3/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'\''
export CONDA_PREFIX='\''/opt/miniconda3'\''
export CONDA_SHLVL='\''3'\''
export CONDA_DEFAULT_ENV='\''base'\''
export CONDA_PROMPT_MODIFIER='\''(base) '\''
export CONDA_PREFIX_2='\''/opt/miniconda3/envs/testbed'\''
export CONDA_EXE='\''/opt/miniconda3/bin/conda'\''
export _CE_M='\'''\''
export _CE_CONDA='\'''\''
export CONDA_PYTHON_EXE='\''/opt/miniconda3/bin/python'\'''
+++ PS1='(base) '
+++ export PATH=/opt/miniconda3/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
+++ PATH=/opt/miniconda3/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
+++ export CONDA_PREFIX=/opt/miniconda3
+++ CONDA_PREFIX=/opt/miniconda3
+++ export CONDA_SHLVL=3
+++ CONDA_SHLVL=3
+++ export CONDA_DEFAULT_ENV=base
+++ CONDA_DEFAULT_ENV=base
+++ export 'CONDA_PROMPT_MODIFIER=(base) '
+++ CONDA_PROMPT_MODIFIER='(base) '
+++ export CONDA_PREFIX_2=/opt/miniconda3/envs/testbed
+++ CONDA_PREFIX_2=/opt/miniconda3/envs/testbed
+++ export CONDA_EXE=/opt/miniconda3/bin/conda
+++ CONDA_EXE=/opt/miniconda3/bin/conda
+++ export _CE_M=
+++ _CE_M=
+++ export _CE_CONDA=
+++ _CE_CONDA=
+++ export CONDA_PYTHON_EXE=/opt/miniconda3/bin/python
+++ CONDA_PYTHON_EXE=/opt/miniconda3/bin/python
++ __conda_hashr
++ '[' -n '' ']'
++ '[' -n '' ']'
++ hash -r
+ conda activate testbed
+ local cmd=activate
+ case "$cmd" in
+ __conda_activate activate testbed
+ '[' -n '' ']'
+ local ask_conda
++ PS1='(base) '
++ __conda_exe shell.posix activate testbed
++ /opt/miniconda3/bin/conda shell.posix activate testbed
+ ask_conda='PS1='\''(testbed) '\''
export PATH='\''/opt/miniconda3/envs/testbed/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'\''
export CONDA_PREFIX='\''/opt/miniconda3/envs/testbed'\''
export CONDA_SHLVL='\''4'\''
export CONDA_DEFAULT_ENV='\''testbed'\''
export CONDA_PROMPT_MODIFIER='\''(testbed) '\''
export CONDA_PREFIX_3='\''/opt/miniconda3'\''
export CONDA_EXE='\''/opt/miniconda3/bin/conda'\''
export _CE_M='\'''\''
export _CE_CONDA='\'''\''
export CONDA_PYTHON_EXE='\''/opt/miniconda3/bin/python'\'''
+ eval 'PS1='\''(testbed) '\''
export PATH='\''/opt/miniconda3/envs/testbed/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'\''
export CONDA_PREFIX='\''/opt/miniconda3/envs/testbed'\''
export CONDA_SHLVL='\''4'\''
export CONDA_DEFAULT_ENV='\''testbed'\''
export CONDA_PROMPT_MODIFIER='\''(testbed) '\''
export CONDA_PREFIX_3='\''/opt/miniconda3'\''
export CONDA_EXE='\''/opt/miniconda3/bin/conda'\''
export _CE_M='\'''\''
export _CE_CONDA='\'''\''
export CONDA_PYTHON_EXE='\''/opt/miniconda3/bin/python'\'''
++ PS1='(testbed) '
++ export PATH=/opt/miniconda3/envs/testbed/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
++ PATH=/opt/miniconda3/envs/testbed/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
++ export CONDA_PREFIX=/opt/miniconda3/envs/testbed
++ CONDA_PREFIX=/opt/miniconda3/envs/testbed
++ export CONDA_SHLVL=4
++ CONDA_SHLVL=4
++ export CONDA_DEFAULT_ENV=testbed
++ CONDA_DEFAULT_ENV=testbed
++ export 'CONDA_PROMPT_MODIFIER=(testbed) '
++ CONDA_PROMPT_MODIFIER='(testbed) '
++ export CONDA_PREFIX_3=/opt/miniconda3
++ CONDA_PREFIX_3=/opt/miniconda3
++ export CONDA_EXE=/opt/miniconda3/bin/conda
++ CONDA_EXE=/opt/miniconda3/bin/conda
++ export _CE_M=
++ _CE_M=
++ export _CE_CONDA=
++ _CE_CONDA=
++ export CONDA_PYTHON_EXE=/opt/miniconda3/bin/python
++ CONDA_PYTHON_EXE=/opt/miniconda3/bin/python
+ __conda_hashr
+ '[' -n '' ']'
+ '[' -n '' ']'
+ hash -r
+ python -m pip install -e .
Obtaining file:///testbed
Requirement already satisfied: pytz in /opt/miniconda3/envs/testbed/lib/python3.6/site-packages (from Django==3.0.dev20190702105509) (2025.2)
Requirement already satisfied: sqlparse in /opt/miniconda3/envs/testbed/lib/python3.6/site-packages (from Django==3.0.dev20190702105509) (0.4.4)
Requirement already satisfied: asgiref in /opt/miniconda3/envs/testbed/lib/python3.6/site-packages (from Django==3.0.dev20190702105509) (3.4.1)
Requirement already satisfied: typing-extensions in /opt/miniconda3/envs/testbed/lib/python3.6/site-packages (from asgiref->Django==3.0.dev20190702105509) (4.1.1)
Installing collected packages: Django
  Attempting uninstall: Django
    Found existing installation: Django 3.0.dev20190702105509
    Uninstalling Django-3.0.dev20190702105509:
      Successfully uninstalled Django-3.0.dev20190702105509
  Running setup.py develop for Django
Successfully installed Django-3.0.dev20190702105509
WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv
+ git apply -v -
Checking patch django/core/mail/message.py...
Checking patch django/core/mail/utils.py...
Checking patch django/core/validators.py...
Checking patch django/utils/encoding.py...
Checking patch django/utils/html.py...
Applied patch django/core/mail/message.py cleanly.
Applied patch django/core/mail/utils.py cleanly.
Applied patch django/core/validators.py cleanly.
Applied patch django/utils/encoding.py cleanly.
Applied patch django/utils/html.py cleanly.
+ git apply -v -
Checking patch tests/test_mail_unicode_domain.py...
Applied patch tests/test_mail_unicode_domain.py cleanly.
+ python3 /root/trace.py --count -C coverage.cover --include-pattern '/testbed/(django/utils/html\.py|django/core/validators\.py|django/utils/encoding\.py|django/core/mail/utils\.py|django/core/mail/message\.py)' ./tests/runtests.py --verbosity 2 --settings=test_sqlite --parallel 1 test_mail_unicode_domain
test_unicode_dns_with_non_unicode_encoding (test_mail_unicode_domain.MailUnicodeDomainTests) ... ERROR

======================================================================
ERROR: test_unicode_dns_with_non_unicode_encoding (test_mail_unicode_domain.MailUnicodeDomainTests)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/testbed/django/core/mail/message.py", line 62, in forbid_multi_line_headers
    val.encode('ascii')
UnicodeEncodeError: 'ascii' codec can't encode characters in position 38-39: ordinal not in range(128)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "./tests/test_mail_unicode_domain.py", line 35, in test_unicode_dns_with_non_unicode_encoding
    message = email.message()
  File "/testbed/django/core/mail/message.py", line 257, in message
    msg['Message-ID'] = make_msgid(domain=DNS_NAME)
  File "/testbed/django/core/mail/message.py", line 154, in __setitem__
    name, val = forbid_multi_line_headers(name, val, self.encoding)
  File "/testbed/django/core/mail/message.py", line 67, in forbid_multi_line_headers
    val = Header(val, encoding).encode()
  File "/opt/miniconda3/envs/testbed/lib/python3.6/email/header.py", line 217, in __init__
    self.append(s, charset, errors)
  File "/opt/miniconda3/envs/testbed/lib/python3.6/email/header.py", line 301, in append
    s.encode(output_charset, errors)
UnicodeEncodeError: 'latin-1' codec can't encode characters in position 38-39: ordinal not in range(256)

----------------------------------------------------------------------
Ran 1 test in 0.004s

FAILED (errors=1)
['--count', '-C', 'coverage.cover', '--include-pattern', '/testbed/(django/utils/html\\.py|django/core/validators\\.py|django/utils/encoding\\.py|django/core/mail/utils\\.py|django/core/mail/message\\.py)']
Testing against Django installed in '/testbed/django'
Skipping setup of unused database(s): default, other.
System check identified no issues (0 silenced).
+ cat coverage.cover
{"/testbed/django/utils/encoding.py": {"1": 1, "2": 1, "3": 1, "4": 1, "5": 1, "6": 1, "8": 1, "9": 1, "12": 2, "21": 1, "35": 1, "39": 1, "48": 1, "70": 1, "82": 1, "102": 1, "110": 1, "118": 1, "152": 1, "153": 5, "155": 4, "161": 1, "162": 16, "164": 323, "168": 1, "204": 1, "221": 1, "226": 1, "241": 1, "256": 1, "270": 1, "13": 1, "17": 1, "14": 0, "15": 0, "18": 0, "28": 0, "30": 0, "31": 0, "45": 0, "56": 0, "57": 0, "58": 0, "59": 0, "60": 0, "61": 0, "62": 0, "64": 0, "65": 0, "66": 0, "67": 0, "76": 0, "78": 0, "79": 0, "90": 0, "91": 0, "92": 0, "94": 0, "95": 0, "96": 0, "97": 0, "98": 0, "99": 0, "103": 0, "104": 0, "105": 0, "107": 0, "111": 0, "112": 0, "113": 0, "115": 0, "143": 0, "144": 0, "145": 0, "146": 0, "147": 0, "156": 59, "157": 168, "178": 0, "179": 0, "180": 0, "185": 0, "186": 0, "187": 0, "189": 0, "190": 0, "191": 0, "192": 0, "193": 0, "194": 0, "195": 0, "196": 0, "198": 0, "199": 0, "200": 0, "201": 0, "218": 0, "223": 0, "232": 0, "233": 0, "234": 0, "235": 0, "236": 0, "237": 0, "238": 0, "249": 0, "250": 0, "253": 0, "262": 1, "263": 1, "264": 1, "265": 0, "266": 0, "267": 1}}
{"/testbed/django/utils/html.py": {"3": 1, "4": 1, "5": 1, "6": 1, "7": 1, "11": 1, "12": 1, "13": 1, "14": 1, "15": 1, "18": 1, "19": 1, "22": 1, "24": 1, "25": 1, "26": 1, "27": 1, "30": 1, "44": 1, "45": 1, "46": 1, "47": 1, "48": 1, "49": 1, "50": 1, "51": 1, "52": 1, "53": 1, "54": 1, "55": 1, "59": 34, "62": 1, "69": 1, "70": 1, "71": 1, "75": 1, "89": 1, "104": 1, "115": 1, "135": 1, "136": 1, "147": 2, "166": 1, "176": 1, "191": 1, "197": 1, "232": 1, "233": 1, "349": 1, "357": 1, "40": 0, "65": 0, "81": 0, "82": 0, "83": 0, "84": 0, "85": 0, "96": 0, "97": 0, "98": 0, "99": 0, "101": 0, "110": 0, "111": 0, "112": 0, "129": 0, "130": 0, "131": 0, "138": 0, "139": 0, "140": 0, "141": 0, "143": 0, "144": 0, "148": 1, "153": 1, "156": 1, "159": 1, "162": 1, "149": 0, "150": 0, "151": 0, "154": 0, "157": 0, "160": 0, "163": 0, "170": 0, "171": 0, "172": 0, "173": 0, "181": 0, "182": 0, "183": 0, "184": 0, "186": 0, "187": 0, "188": 0, "194": 0, "199": 0, "207": 0, "208": 0, "209": 0, "211": 0, "213": 0, "214": 0, "215": 0, "216": 0, "218": 0, "221": 0, "222": 0, "224": 0, "226": 0, "227": 0, "229": 0, "200": 0, "204": 0, "249": 0, "251": 0, "256": 0, "288": 0, "303": 0, "304": 0, "305": 0, "309": 0, "311": 0, "314": 0, "315": 0, "316": 0, "317": 0, "318": 0, "319": 0, "320": 0, "321": 0, "322": 0, "323": 0, "324": 0, "325": 0, "326": 0, "327": 0, "330": 0, "331": 0, "332": 0, "333": 0, "334": 0, "335": 0, "336": 0, "338": 0, "339": 0, "340": 0, "341": 0, "342": 0, "343": 0, "344": 0, "345": 0, "346": 0, "252": 0, "253": 0, "254": 0, "262": 0, "263": 0, "264": 0, "266": 0, "267": 0, "268": 0, "269": 0, "270": 0, "272": 0, "273": 0, "274": 0, "275": 0, "276": 0, "280": 0, "281": 0, "282": 0, "283": 0, "284": 0, "285": 0, "286": 0, "291": 0, "292": 0, "293": 0, "294": 0, "295": 0, "297": 0, "299": 0, "300": 0, "301": 0, "354": 0, "362": 7, "363": 0, "364": 0, "365": 0, "367": 7, "368": 0, "369": 0, "370": 0, "372": 7, "373": 7, "374": 7, "375": 7}}
{"/testbed/django/core/validators.py": {"1": 1, "2": 1, "3": 1, "4": 1, "6": 1, "7": 1, "8": 1, "9": 1, "10": 1, "11": 1, "14": 1, "17": 1, "29": 2, "74": 2, "75": 1, "153": 1, "154": 1, "155": 1, "156": 1, "160": 1, "164": 2, "234": 1, "236": 1, "237": 1, "238": 1, "240": 1, "241": 1, "244": 1, "245": 1, "246": 1, "247": 1, "248": 1, "252": 1, "259": 1, "264": 1, "275": 1, "276": 1, "277": 1, "281": 1, "296": 1, "304": 1, "305": 1, "309": 2, "341": 2, "342": 1, "350": 2, "351": 1, "359": 2, "360": 1, "374": 2, "375": 1, "389": 2, "467": 2, "505": 1, "515": 1, "519": 2, "19": 15, "26": 15, "21": 0, "22": 0, "24": 0, "25": 0, "31": 1, "32": 1, "33": 1, "34": 1, "35": 1, "37": 1, "53": 1, "63": 1, "38": 7, "39": 4, "40": 7, "41": 4, "42": 7, "43": 4, "44": 7, "45": 0, "46": 7, "47": 0, "48": 7, "49": 0, "51": 7, "58": 0, "59": 0, "60": 0, "61": 0, "65": 0, "66": 0, "67": 0, "68": 0, "69": 0, "70": 0, "76": 1, "79": 1, "80": 1, "83": 1, "85": 1, "89": 1, "94": 1, "96": 1, "99": 1, "102": 1, "103": 1, "104": 1, "106": 1, "111": 1, "107": 2, "108": 2, "109": 0, "113": 0, "114": 0, "115": 0, "118": 0, "119": 0, "120": 0, "122": 0, "123": 0, "124": 0, "125": 0, "126": 0, "127": 0, "128": 0, "129": 0, "130": 0, "131": 0, "132": 0, "134": 0, "137": 0, "138": 0, "139": 0, "140": 0, "141": 0, "142": 0, "143": 0, "149": 0, "150": 0, "161": 0, "166": 1, "167": 1, "168": 1, "169": 1, "171": 1, "172": 1, "174": 1, "175": 1, "176": 1, "178": 1, "179": 1, "180": 1, "182": 1, "190": 1, "211": 1, "225": 1, "183": 1, "184": 0, "185": 1, "186": 0, "187": 1, "188": 0, "191": 0, "192": 0, "194": 0, "196": 0, "197": 0, "199": 0, "200": 0, "202": 0, "203": 0, "204": 0, "205": 0, "207": 0, "208": 0, "209": 0, "212": 0, "213": 0, "215": 0, "216": 0, "217": 0, "218": 0, "219": 0, "220": 0, "221": 0, "222": 0, "223": 0, "227": 0, "228": 0, "229": 0, "230": 0, "253": 0, "254": 0, "255": 0, "256": 0, "260": 0, "261": 0, "265": 0, "266": 0, "267": 0, "268": 0, "269": 0, "270": 0, "271": 0, "286": 0, "287": 0, "288": 0, "289": 0, "290": 0, "291": 0, "292": 0, "293": 0, "297": 1, "298": 1, "299": 1, "301": 1, "311": 1, "312": 1, "314": 1, "319": 1, "326": 1, "334": 1, "337": 1, "315": 14, "316": 14, "317": 0, "320": 0, "321": 0, "322": 0, "323": 0, "324": 0, "328": 0, "329": 0, "330": 0, "331": 0, "335": 0, "338": 0, "343": 1, "344": 1, "346": 1, "347": 0, "352": 1, "353": 1, "355": 1, "356": 0, "361": 1, "362": 1, "363": 1, "364": 1, "365": 1, "367": 1, "370": 1, "368": 0, "371": 0, "376": 1, "377": 1, "378": 1, "379": 1, "380": 1, "382": 1, "385": 1, "383": 0, "386": 0, "396": 1, "397": 1, "398": 1, "399": 1, "400": 1, "402": 1, "403": 1, "404": 1, "405": 1, "407": 1, "408": 1, "409": 1, "410": 1, "414": 1, "418": 1, "459": 1, "415": 0, "416": 0, "419": 0, "420": 0, "421": 0, "422": 0, "424": 0, "425": 0, "432": 0, "433": 0, "435": 0, "436": 0, "437": 0, "439": 0, "440": 0, "441": 0, "442": 0, "443": 0, "445": 0, "446": 0, "447": 0, "448": 0, "449": 0, "451": 0, "452": 0, "453": 0, "454": 0, "455": 0, "456": 0, "461": 0, "462": 0, "463": 0, "469": 1, "470": 1, "473": 1, "475": 1, "484": 1, "496": 1, "476": 0, "477": 0, "478": 0, "479": 0, "480": 0, "481": 0, "482": 0, "485": 0, "486": 0, "487": 0, "488": 0, "489": 0, "491": 0, "492": 0, "498": 0, "499": 0, "500": 0, "501": 0, "506": 0, "507": 0, "508": 0, "509": 0, "511": 0, "512": 0, "516": 0, "522": 1, "523": 1, "525": 1, "531": 1, "535": 1, "526": 0, "527": 0, "528": 0, "529": 0, "532": 0, "533": 0, "537": 0, "538": 0, "539": 0}}
{"/testbed/django/core/mail/message.py": {"1": 1, "2": 1, "5": 1, "6": 1, "7": 1, "8": 1, "9": 1, "10": 1, "11": 1, "12": 1, "13": 1, "14": 1, "15": 1, "17": 1, "18": 1, "19": 1, "23": 1, "24": 1, "25": 1, "26": 1, "30": 1, "32": 1, "35": 2, "41": 1, "42": 1, "43": 1, "44": 1, "45": 1, "46": 1, "47": 1, "48": 1, "49": 1, "50": 1, "51": 1, "55": 1, "74": 1, "111": 2, "139": 2, "147": 2, "169": 2, "180": 2, "400": 2, "36": 1, "57": 8, "58": 8, "59": 8, "60": 0, "61": 8, "62": 8, "63": 1, "64": 1, "65": 0, "67": 1, "69": 7, "70": 1, "71": 7, "78": 0, "79": 0, "80": 0, "81": 0, "82": 0, "83": 0, "84": 0, "86": 0, "88": 0, "89": 0, "90": 0, "92": 0, "93": 0, "94": 0, "96": 0, "97": 0, "99": 0, "101": 0, "102": 0, "103": 0, "104": 0, "105": 0, "107": 0, "108": 0, "112": 1, "125": 1, "120": 0, "121": 0, "122": 0, "123": 0, "133": 0, "134": 0, "135": 0, "136": 0, "141": 1, "143": 0, "144": 0, "149": 1, "153": 1, "157": 1, "150": 1, "151": 1, "154": 8, "155": 7, "158": 1, "159": 0, "160": 0, "161": 0, "165": 0, "166": 1, "171": 1, "175": 1, "172": 0, "173": 0, "176": 0, "177": 0, "182": 1, "183": 1, "184": 1, "188": 1, "230": 1, "236": 1, "263": 1, "270": 1, "278": 1, "310": 1, "326": 1, "329": 1, "343": 1, "373": 1, "387": 1, "193": 1, "194": 1, "195": 0, "196": 1, "198": 0, "199": 1, "200": 0, "201": 0, "202": 0, "204": 1, "205": 1, "206": 0, "207": 0, "208": 0, "210": 1, "211": 1, "212": 0, "213": 0, "214": 0, "216": 1, "217": 1, "218": 1, "219": 1, "220": 1, "221": 1, "222": 0, "223": 0, "224": 0, "226": 0, "227": 1, "228": 1, "231": 0, "232": 0, "233": 0, "234": 0, "237": 1, "238": 1, "239": 1, "240": 1, "241": 1, "242": 1, "243": 1, "244": 1, "248": 2, "249": 1, "254": 1, "255": 1, "257": 1, "258": 0, "259": 0, "260": 0, "261": 0, "268": 0, "272": 0, "275": 0, "276": 0, "290": 0, "291": 0, "292": 0, "293": 0, "295": 0, "296": 0, "297": 0, "299": 0, "300": 0, "301": 0, "302": 0, "303": 0, "306": 0, "308": 0, "321": 0, "322": 0, "323": 0, "324": 0, "327": 1, "330": 1, "331": 0, "332": 0, "333": 0, "334": 0, "335": 0, "336": 0, "337": 0, "338": 0, "340": 0, "341": 1, "350": 0, "351": 0, "352": 0, "353": 0, "354": 0, "357": 0, "359": 0, "360": 0, "363": 0, "365": 0, "368": 0, "369": 0, "370": 0, "371": 0, "378": 0, "379": 0, "380": 0, "381": 0, "382": 0, "383": 0, "384": 0, "385": 0, "392": 3, "393": 1, "394": 1, "395": 1, "396": 3, "397": 1, "406": 1, "410": 1, "421": 1, "427": 1, "430": 1, "415": 0, "416": 0, "417": 0, "419": 0, "423": 0, "424": 0, "425": 0, "428": 0, "431": 0, "432": 0, "433": 0, "434": 0, "435": 0, "436": 0, "437": 0, "438": 0, "439": 0}}
{"/testbed/django/core/mail/utils.py": {"5": 1, "7": 1, "12": 2, "22": 1, "13": 1, "16": 1, "14": 0, "17": 0, "18": 0, "19": 0}}
+ git checkout a5308514fb4bc5086c9a16a8a24a945eeebb073c
Note: switching to 'a5308514fb4bc5086c9a16a8a24a945eeebb073c'.

You are in 'detached HEAD' state. You can look around, make experimental
changes and commit them, and you can discard any commits you make in this
state without impacting any branches by switching back to a branch.

If you want to create a new branch to retain commits you create, you may
do so (now or later) by using -c with the switch command. Example:

  git switch -c <new-branch-name>

Or undo this operation with:

  git switch -

Turn off this advice by setting config variable advice.detachedHead to false

HEAD is now at a5308514fb Fixed #27801 -- Made createsuperuser fall back to environment variables for password and required fields.
M	django/core/mail/message.py
M	django/core/mail/utils.py
M	django/core/validators.py
M	django/utils/encoding.py
M	django/utils/html.py
+ git apply /root/pre_state.patch
error: unrecognized input
