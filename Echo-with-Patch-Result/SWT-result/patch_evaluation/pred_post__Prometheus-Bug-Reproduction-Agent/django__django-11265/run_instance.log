2025-12-25 18:40:56,090 - WARNING - Starting evaluation at 1766688056.089999
2025-12-25 18:40:56,134 - INFO - Creating container for django__django-11265...
2025-12-25 18:40:58,790 - INFO - Container for django__django-11265 created: d3df08273d06e9a3dbe55d0a4615048acd00510c3218ba6ac195386d57891664
2025-12-25 18:41:00,418 - INFO - Container for django__django-11265 started: d3df08273d06e9a3dbe55d0a4615048acd00510c3218ba6ac195386d57891664
2025-12-25 18:41:01,674 - INFO - Git diff before:

2025-12-25 18:41:01,674 - INFO - Eval script for django__django-11265 written to eval.sh, now applying to container...
2025-12-25 18:42:30,574 - INFO - Test output for django__django-11265 written to run_instance_swt_logs/patch_evaluation/pred_post__Prometheus-Bug-Reproduction-Agent/django__django-11265/test_output.txt
2025-12-25 18:42:30,665 - INFO - Git diff after:
diff --git a/django/db/models/sql/query.py b/django/db/models/sql/query.py
index d69c24419b..08d7faf194 100644
--- a/django/db/models/sql/query.py
+++ b/django/db/models/sql/query.py
@@ -1666,6 +1666,7 @@ class Query(BaseExpression):
             filter_expr = (filter_lhs, OuterRef(filter_rhs.name))
         # Generate the inner query.
         query = Query(self.model)
+        query._filtered_relations = self._filtered_relations
         query.add_filter(filter_expr)
         query.clear_ordering(True)
         # Try to have as simple as possible subquery -> trim leading joins from
@@ -2140,9 +2141,13 @@ class Query(BaseExpression):
             join_field.foreign_related_fields[0].name)
         trimmed_prefix = LOOKUP_SEP.join(trimmed_prefix)
         # Lets still see if we can trim the first join from the inner query
-        # (that is, self). We can't do this for LEFT JOINs because we would
-        # miss those rows that have nothing on the outer side.
-        if self.alias_map[lookup_tables[trimmed_paths + 1]].join_type != LOUTER:
+        # (that is, self). We can't do this for:
+        # - LEFT JOINs because we would miss those rows that have nothing on
+        #   the outer side,
+        # - INNER JOINs from filtered relations because we would miss their
+        #   filters.
+        first_join = self.alias_map[lookup_tables[trimmed_paths + 1]]
+        if first_join.join_type != LOUTER and not first_join.filtered_relation:
             select_fields = [r[0] for r in join_field.related_fields]
             select_alias = lookup_tables[trimmed_paths + 1]
             self.unref_alias(lookup_tables[trimmed_paths])
2025-12-25 18:42:30,665 - INFO - Git diff changed after running eval script
2025-12-25 18:42:30,665 - INFO - Attempting to stop container exec.eval.x86_64.ee2ad6945f237e9160354f.e6ba61833b7289b8507a96.129899102646064...
2025-12-25 18:42:52,383 - INFO - Attempting to remove container exec.eval.x86_64.ee2ad6945f237e9160354f.e6ba61833b7289b8507a96.129899102646064...
2025-12-25 18:42:52,554 - INFO - Container exec.eval.x86_64.ee2ad6945f237e9160354f.e6ba61833b7289b8507a96.129899102646064 removed.
2025-12-25 18:42:52,555 - WARNING - End of eval at 1766688172.555053
2025-12-25 19:46:03,101 - WARNING - Starting evaluation at 1766691963.101506
2025-12-25 19:46:03,117 - WARNING - Starting evaluation at 1766691963.1179523
2025-12-25 19:46:03,136 - WARNING - Starting evaluation at 1766691963.136713
2025-12-25 19:46:03,156 - WARNING - Starting evaluation at 1766691963.156086
2025-12-25 19:46:03,171 - WARNING - Starting evaluation at 1766691963.1716616
2025-12-26 02:43:28,492 - WARNING - Starting evaluation at 1766717008.4923892
2025-12-26 02:43:28,513 - WARNING - Starting evaluation at 1766717008.5135624
2025-12-26 02:43:28,548 - WARNING - Starting evaluation at 1766717008.548735
2025-12-26 02:43:28,586 - WARNING - Starting evaluation at 1766717008.5865982
2025-12-26 02:43:28,617 - WARNING - Starting evaluation at 1766717008.6172516
2025-12-26 09:38:09,417 - WARNING - Starting evaluation at 1766741889.4175973
2025-12-26 09:38:09,429 - WARNING - Starting evaluation at 1766741889.429115
2025-12-26 09:38:09,440 - WARNING - Starting evaluation at 1766741889.4406402
2025-12-26 09:38:09,451 - WARNING - Starting evaluation at 1766741889.4517832
2025-12-26 09:38:09,461 - WARNING - Starting evaluation at 1766741889.461215
2025-12-26 09:53:33,368 - WARNING - Starting evaluation at 1766742813.368522
2025-12-26 09:53:33,379 - WARNING - Starting evaluation at 1766742813.3797092
2025-12-26 09:53:33,390 - WARNING - Starting evaluation at 1766742813.3901749
2025-12-26 09:53:33,400 - WARNING - Starting evaluation at 1766742813.4002671
2025-12-26 09:53:33,410 - WARNING - Starting evaluation at 1766742813.410459
2025-12-26 10:15:25,738 - WARNING - Starting evaluation at 1766744125.7383122
2025-12-26 10:15:25,752 - WARNING - Starting evaluation at 1766744125.7522037
2025-12-26 10:15:25,765 - WARNING - Starting evaluation at 1766744125.7658951
2025-12-26 10:15:25,779 - WARNING - Starting evaluation at 1766744125.7792587
2025-12-26 10:15:25,791 - WARNING - Starting evaluation at 1766744125.7912824
2025-12-26 11:07:37,603 - WARNING - Starting evaluation at 1766747257.6035085
2025-12-26 11:07:37,616 - WARNING - Starting evaluation at 1766747257.6168842
2025-12-26 11:07:37,630 - WARNING - Starting evaluation at 1766747257.630709
2025-12-26 11:07:37,641 - WARNING - Starting evaluation at 1766747257.6412616
2025-12-26 11:07:37,653 - WARNING - Starting evaluation at 1766747257.6537752
2025-12-26 11:07:48,620 - INFO - Grading answer for django__django-11265...
2025-12-26 11:07:48,629 - INFO - report: {'django__django-11265': {'patch_is_None': False, 'patch_exists': True, 'patch_successfully_applied': True, 'resolved': False, 'coverage_pred': 0.0, 'coverage_gold': 0.75, 'coverage_base': 0.0, 'coverage_delta_pred': 0.0, 'coverage_delta_gold': 0.75, 'added_f2p': 0, 'tests_base': {'FAIL_TO_PASS': [], 'PASS_TO_PASS': ['test_with_prefetch_related (filtered_relation.tests.FilteredRelationTests)', 'test_with_join_and_complex_condition (filtered_relation.tests.FilteredRelationTests)', 'test_select_for_update (filtered_relation.tests.FilteredRelationTests)', 'test_difference (filtered_relation.tests.FilteredRelationTests)', 'test_select_related_with_empty_relation (filtered_relation.tests.FilteredRelationTests)', 'test_internal_queryset_alias_mapping (filtered_relation.tests.FilteredRelationTests)', 'test_with_m2m (filtered_relation.tests.FilteredRelationTests)', 'test_defer (filtered_relation.tests.FilteredRelationTests)', 'test_with_m2m_deep (filtered_relation.tests.FilteredRelationTests)', 'test_exclude_relation_with_join (filtered_relation.tests.FilteredRelationTests)', 'test_intersection (filtered_relation.tests.FilteredRelationTests)', 'test_select_related (filtered_relation.tests.FilteredRelationTests)', 'test_select_related_foreign_key (filtered_relation.tests.FilteredRelationTests)', 'test_values_list (filtered_relation.tests.FilteredRelationTests)', 'test_multiple_times (filtered_relation.tests.FilteredRelationTests)', 'test_with_generic_foreign_key (filtered_relation.tests.FilteredRelationTests)', 'test_only_not_supported (filtered_relation.tests.FilteredRelationTests)', 'test_with_empty_relation_name_error (filtered_relation.tests.FilteredRelationTests)', 'test_without_join (filtered_relation.tests.FilteredRelationTests)', 'test_union (filtered_relation.tests.FilteredRelationTests)', 'test_values (filtered_relation.tests.FilteredRelationTests)', 'test_with_foreign_key_error (filtered_relation.tests.FilteredRelationTests)', 'test_with_multiple_filter (filtered_relation.tests.FilteredRelationTests)', 'test_with_condition_as_expression_error (filtered_relation.tests.FilteredRelationTests)', 'test_as_subquery (filtered_relation.tests.FilteredRelationTests)', 'test_with_m2m_multijoin (filtered_relation.tests.FilteredRelationTests)', 'test_aggregate (filtered_relation.tests.FilteredRelationAggregationTests)', 'test_extra (filtered_relation.tests.FilteredRelationTests)', 'test_with_foreign_key_on_condition_error (filtered_relation.tests.FilteredRelationTests)', 'test_with_join (filtered_relation.tests.FilteredRelationTests)'], 'FAIL_TO_FAIL': [], 'PASS_TO_FAIL': [], 'UNMATCHED': ['test_select_related_foreign_key_for_update_of (filtered_relation.tests.FilteredRelationTests)']}, 'tests_pred': {'FAIL_TO_PASS': [], 'PASS_TO_PASS': ['test_with_prefetch_related (filtered_relation.tests.FilteredRelationTests)', 'test_with_join_and_complex_condition (filtered_relation.tests.FilteredRelationTests)', 'test_select_for_update (filtered_relation.tests.FilteredRelationTests)', 'test_difference (filtered_relation.tests.FilteredRelationTests)', 'test_select_related_with_empty_relation (filtered_relation.tests.FilteredRelationTests)', 'test_internal_queryset_alias_mapping (filtered_relation.tests.FilteredRelationTests)', 'test_with_m2m (filtered_relation.tests.FilteredRelationTests)', 'test_defer (filtered_relation.tests.FilteredRelationTests)', 'test_with_m2m_deep (filtered_relation.tests.FilteredRelationTests)', 'test_exclude_relation_with_join (filtered_relation.tests.FilteredRelationTests)', 'test_intersection (filtered_relation.tests.FilteredRelationTests)', 'test_select_related (filtered_relation.tests.FilteredRelationTests)', 'test_select_related_foreign_key (filtered_relation.tests.FilteredRelationTests)', 'test_values_list (filtered_relation.tests.FilteredRelationTests)', 'test_multiple_times (filtered_relation.tests.FilteredRelationTests)', 'test_with_generic_foreign_key (filtered_relation.tests.FilteredRelationTests)', 'test_only_not_supported (filtered_relation.tests.FilteredRelationTests)', 'test_with_empty_relation_name_error (filtered_relation.tests.FilteredRelationTests)', 'test_without_join (filtered_relation.tests.FilteredRelationTests)', 'test_union (filtered_relation.tests.FilteredRelationTests)', 'test_values (filtered_relation.tests.FilteredRelationTests)', 'test_with_foreign_key_error (filtered_relation.tests.FilteredRelationTests)', 'test_with_multiple_filter (filtered_relation.tests.FilteredRelationTests)', 'test_with_condition_as_expression_error (filtered_relation.tests.FilteredRelationTests)', 'test_as_subquery (filtered_relation.tests.FilteredRelationTests)', 'test_with_m2m_multijoin (filtered_relation.tests.FilteredRelationTests)', 'test_aggregate (filtered_relation.tests.FilteredRelationAggregationTests)', 'test_extra (filtered_relation.tests.FilteredRelationTests)', 'test_with_foreign_key_on_condition_error (filtered_relation.tests.FilteredRelationTests)', 'test_with_join (filtered_relation.tests.FilteredRelationTests)'], 'FAIL_TO_FAIL': [], 'PASS_TO_FAIL': [], 'UNMATCHED': ['test_select_related_foreign_key_for_update_of (filtered_relation.tests.FilteredRelationTests)']}, 'tests_gold': {'FAIL_TO_PASS': ['test_with_exclude (filtered_relation.tests.FilteredRelationTests)'], 'PASS_TO_PASS': ['test_with_prefetch_related (filtered_relation.tests.FilteredRelationTests)', 'test_with_join_and_complex_condition (filtered_relation.tests.FilteredRelationTests)', 'test_select_for_update (filtered_relation.tests.FilteredRelationTests)', 'test_difference (filtered_relation.tests.FilteredRelationTests)', 'test_select_related_with_empty_relation (filtered_relation.tests.FilteredRelationTests)', 'test_internal_queryset_alias_mapping (filtered_relation.tests.FilteredRelationTests)', 'test_with_m2m (filtered_relation.tests.FilteredRelationTests)', 'test_defer (filtered_relation.tests.FilteredRelationTests)', 'test_with_m2m_deep (filtered_relation.tests.FilteredRelationTests)', 'test_exclude_relation_with_join (filtered_relation.tests.FilteredRelationTests)', 'test_intersection (filtered_relation.tests.FilteredRelationTests)', 'test_select_related (filtered_relation.tests.FilteredRelationTests)', 'test_select_related_foreign_key (filtered_relation.tests.FilteredRelationTests)', 'test_values_list (filtered_relation.tests.FilteredRelationTests)', 'test_multiple_times (filtered_relation.tests.FilteredRelationTests)', 'test_with_generic_foreign_key (filtered_relation.tests.FilteredRelationTests)', 'test_only_not_supported (filtered_relation.tests.FilteredRelationTests)', 'test_with_empty_relation_name_error (filtered_relation.tests.FilteredRelationTests)', 'test_without_join (filtered_relation.tests.FilteredRelationTests)', 'test_union (filtered_relation.tests.FilteredRelationTests)', 'test_values (filtered_relation.tests.FilteredRelationTests)', 'test_with_foreign_key_error (filtered_relation.tests.FilteredRelationTests)', 'test_with_multiple_filter (filtered_relation.tests.FilteredRelationTests)', 'test_with_condition_as_expression_error (filtered_relation.tests.FilteredRelationTests)', 'test_as_subquery (filtered_relation.tests.FilteredRelationTests)', 'test_with_m2m_multijoin (filtered_relation.tests.FilteredRelationTests)', 'test_aggregate (filtered_relation.tests.FilteredRelationAggregationTests)', 'test_extra (filtered_relation.tests.FilteredRelationTests)', 'test_with_foreign_key_on_condition_error (filtered_relation.tests.FilteredRelationTests)', 'test_with_join (filtered_relation.tests.FilteredRelationTests)'], 'FAIL_TO_FAIL': [], 'PASS_TO_FAIL': [], 'UNMATCHED': ['test_select_related_foreign_key_for_update_of (filtered_relation.tests.FilteredRelationTests)']}}}
Result for django__django-11265: resolved: False
