2025-12-25 18:06:36,814 - WARNING - Starting evaluation at 1766685996.8147392
2025-12-25 18:06:36,860 - INFO - Creating container for django__django-10973...
2025-12-25 18:06:39,651 - INFO - Container for django__django-10973 created: 03e636a6113f975b9e0a075aef2aefcee6e85ba5f8da3ac3c14b3652acc84c0f
2025-12-25 18:06:41,361 - INFO - Container for django__django-10973 started: 03e636a6113f975b9e0a075aef2aefcee6e85ba5f8da3ac3c14b3652acc84c0f
2025-12-25 18:06:42,497 - INFO - Git diff before:

2025-12-25 18:06:42,497 - INFO - Eval script for django__django-10973 written to eval.sh, now applying to container...
2025-12-25 18:08:46,787 - INFO - Test output for django__django-10973 written to run_instance_swt_logs/patch_evaluation/pred_post__Prometheus-Bug-Reproduction-Agent/django__django-10973/test_output.txt
2025-12-25 18:08:46,871 - INFO - Git diff after:
diff --git a/django/db/backends/postgresql/client.py b/django/db/backends/postgresql/client.py
index 7fca6eff30..cf4df76882 100644
--- a/django/db/backends/postgresql/client.py
+++ b/django/db/backends/postgresql/client.py
@@ -2,17 +2,9 @@ import os
 import signal
 import subprocess
 
-from django.core.files.temp import NamedTemporaryFile
 from django.db.backends.base.client import BaseDatabaseClient
 
 
-def _escape_pgpass(txt):
-    """
-    Escape a fragment of a PostgreSQL .pgpass file.
-    """
-    return txt.replace('\\', '\\\\').replace(':', '\\:')
-
-
 class DatabaseClient(BaseDatabaseClient):
     executable_name = 'psql'
 
@@ -34,38 +26,17 @@ class DatabaseClient(BaseDatabaseClient):
             args += ['-p', str(port)]
         args += [dbname]
 
-        temp_pgpass = None
         sigint_handler = signal.getsignal(signal.SIGINT)
+        subprocess_env = os.environ.copy()
+        if passwd:
+            subprocess_env['PGPASSWORD'] = str(passwd)
         try:
-            if passwd:
-                # Create temporary .pgpass file.
-                temp_pgpass = NamedTemporaryFile(mode='w+')
-                try:
-                    print(
-                        _escape_pgpass(host) or '*',
-                        str(port) or '*',
-                        _escape_pgpass(dbname) or '*',
-                        _escape_pgpass(user) or '*',
-                        _escape_pgpass(passwd),
-                        file=temp_pgpass,
-                        sep=':',
-                        flush=True,
-                    )
-                    os.environ['PGPASSFILE'] = temp_pgpass.name
-                except UnicodeEncodeError:
-                    # If the current locale can't encode the data, let the
-                    # user input the password manually.
-                    pass
             # Allow SIGINT to pass to psql to abort queries.
             signal.signal(signal.SIGINT, signal.SIG_IGN)
-            subprocess.check_call(args)
+            subprocess.run(args, check=True, env=subprocess_env)
         finally:
             # Restore the original SIGINT handler.
             signal.signal(signal.SIGINT, sigint_handler)
-            if temp_pgpass:
-                temp_pgpass.close()
-                if 'PGPASSFILE' in os.environ:  # unit tests need cleanup
-                    del os.environ['PGPASSFILE']
 
     def runshell(self):
         DatabaseClient.runshell_db(self.connection.get_connection_params())
2025-12-25 18:08:46,871 - INFO - Git diff changed after running eval script
2025-12-25 18:08:46,872 - INFO - Attempting to stop container exec.eval.x86_64.ee2ad6945f237e9160354f.a72d056e2daeffe29c39de.129899102642704...
2025-12-25 18:09:03,262 - INFO - Attempting to remove container exec.eval.x86_64.ee2ad6945f237e9160354f.a72d056e2daeffe29c39de.129899102642704...
2025-12-25 18:09:03,411 - INFO - Container exec.eval.x86_64.ee2ad6945f237e9160354f.a72d056e2daeffe29c39de.129899102642704 removed.
2025-12-25 18:09:03,412 - WARNING - End of eval at 1766686143.4121132
2025-12-25 19:46:02,877 - WARNING - Starting evaluation at 1766691962.8776248
2025-12-25 19:46:02,897 - WARNING - Starting evaluation at 1766691962.8974075
2025-12-25 19:46:02,920 - WARNING - Starting evaluation at 1766691962.920087
2025-12-25 19:46:02,938 - WARNING - Starting evaluation at 1766691962.93895
2025-12-25 19:46:02,962 - WARNING - Starting evaluation at 1766691962.9623816
2025-12-26 02:43:28,107 - WARNING - Starting evaluation at 1766717008.107028
2025-12-26 02:43:28,134 - WARNING - Starting evaluation at 1766717008.1347075
2025-12-26 02:43:28,170 - WARNING - Starting evaluation at 1766717008.1703234
2025-12-26 02:43:28,199 - WARNING - Starting evaluation at 1766717008.199426
2025-12-26 02:43:28,249 - WARNING - Starting evaluation at 1766717008.2496693
2025-12-26 09:38:09,152 - WARNING - Starting evaluation at 1766741889.1528358
2025-12-26 09:38:09,164 - WARNING - Starting evaluation at 1766741889.1645324
2025-12-26 09:38:09,176 - WARNING - Starting evaluation at 1766741889.176888
2025-12-26 09:38:09,187 - WARNING - Starting evaluation at 1766741889.1872003
2025-12-26 09:38:09,197 - WARNING - Starting evaluation at 1766741889.1978724
2025-12-26 09:53:33,094 - WARNING - Starting evaluation at 1766742813.0948482
2025-12-26 09:53:33,103 - WARNING - Starting evaluation at 1766742813.1037836
2025-12-26 09:53:33,112 - WARNING - Starting evaluation at 1766742813.1122181
2025-12-26 09:53:33,121 - WARNING - Starting evaluation at 1766742813.1216357
2025-12-26 09:53:33,130 - WARNING - Starting evaluation at 1766742813.1304514
2025-12-26 10:15:25,391 - WARNING - Starting evaluation at 1766744125.390996
2025-12-26 10:15:25,403 - WARNING - Starting evaluation at 1766744125.4039578
2025-12-26 10:15:25,419 - WARNING - Starting evaluation at 1766744125.4197142
2025-12-26 10:15:25,436 - WARNING - Starting evaluation at 1766744125.4365377
2025-12-26 10:15:25,452 - WARNING - Starting evaluation at 1766744125.4523535
2025-12-26 11:07:37,427 - WARNING - Starting evaluation at 1766747257.4270446
2025-12-26 11:07:37,437 - WARNING - Starting evaluation at 1766747257.4378812
2025-12-26 11:07:37,449 - WARNING - Starting evaluation at 1766747257.4495366
2025-12-26 11:07:37,460 - WARNING - Starting evaluation at 1766747257.4609492
2025-12-26 11:07:37,472 - WARNING - Starting evaluation at 1766747257.4721937
2025-12-26 11:07:48,520 - INFO - Grading answer for django__django-10973...
2025-12-26 11:07:48,527 - INFO - report: {'django__django-10973': {'patch_is_None': False, 'patch_exists': True, 'patch_successfully_applied': True, 'resolved': True, 'coverage_pred': 0.9285714285714286, 'coverage_gold': 0.9285714285714286, 'coverage_base': 0.0, 'coverage_delta_pred': 0.9285714285714286, 'coverage_delta_gold': 0.9285714285714286, 'added_f2p': 1, 'tests_base': {'FAIL_TO_PASS': [], 'PASS_TO_PASS': [], 'FAIL_TO_FAIL': [], 'PASS_TO_FAIL': [], 'UNMATCHED': ['tests (unittest.loader._FailedTest)']}, 'tests_pred': {'FAIL_TO_PASS': ['test_runshell_db_uses_subprocess_run (django.db.backends.postgresql.tests.test_client.PostgreSqlClientTestCase)'], 'PASS_TO_PASS': [], 'FAIL_TO_FAIL': [], 'PASS_TO_FAIL': [], 'UNMATCHED': []}, 'tests_gold': {'FAIL_TO_PASS': ['test_basic (dbshell.test_postgresql.PostgreSqlDbshellCommandTestCase)', 'test_column (dbshell.test_postgresql.PostgreSqlDbshellCommandTestCase)', 'test_sigint_handler (dbshell.test_postgresql.PostgreSqlDbshellCommandTestCase)', 'test_nopass (dbshell.test_postgresql.PostgreSqlDbshellCommandTestCase)', 'test_accent (dbshell.test_postgresql.PostgreSqlDbshellCommandTestCase)'], 'PASS_TO_PASS': [], 'FAIL_TO_FAIL': [], 'PASS_TO_FAIL': [], 'UNMATCHED': []}}}
Result for django__django-10973: resolved: True
