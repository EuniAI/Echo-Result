2025-12-21 02:23:03,892 - thread-126362081822400.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: Doc rendering is incorrect when :param has datatype dict(str,str)

Description: **Describe the bug**
I have a parameter defined under docstring of a method as:-
:param dict(str, str) opc_meta: (optional)

Which is being incorrectly rendered in the generated docs as:-
str) opc_meta (dict(str,) –(optional) 

**To Reproduce**
Create any method with the docstring containg the above param

**Expected behavior**
The param should be rendered in the generated docs as:-
opc_meta (dict(str,str)) – (optional) 

**Your project**
[sphinxTest.zip](https://github.com/sphinx-doc/sphinx/files/6468074/sphinxTest.zip)


**Screenshots**
<img width="612" alt="Screen Shot 2021-05-12 at 12 30 50 PM" src="https://user-images.githubusercontent.com/8617566/118020143-5f59a280-b31f-11eb-8dc2-5280d5c4896b.png">
<img width="681" alt="Screen Shot 2021-05-12 at 12 32 25 PM" src="https://user-images.githubusercontent.com/8617566/118020154-62549300-b31f-11eb-953d-9287f9cc27ff.png">


**Environment info**
- OS: Mac
- Python version: 3.9.0
- Sphinx version: 4.0.1
- Sphinx extensions:  ["sphinx.ext.autodoc", "sphinx.ext.autosummary", "sphinx.ext.intersphinx", "autodocsumm"]
- Extra tools: Browser Firefox.

**Additional context**
N/A



Patch information:
diff --git a/sphinx/util/docfields.py b/sphinx/util/docfields.py
index 3a3367ebe..6d48e910c 100644
--- a/sphinx/util/docfields.py
+++ b/sphinx/util/docfields.py
@@ -298,7 +298,7 @@ class DocFieldTransformer:
             # also support syntax like ``:param type name:``
             if typedesc.is_typed:
                 try:
-                    argtype, argname = fieldarg.split(None, 1)
+                    argtype, argname = fieldarg.rsplit(None, 1)
                 except ValueError:
                     pass
                 else:


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-12-21 02:23:04,011 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sphinx
├── .circleci
|   └── config.yml
├── .codecov.yml
├── .github
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.md
|   |   ├── config.yml
|   |   └── feature_request.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   └── workflows
|       ├── builddoc.yml
|       ├── lint.yml
|       ├── main.yml
|       ├── nodejs.yml
|       └── transifex.yml
├── .readthedocs.yml
├── CONTRIBUTING.rst
├── README.rst
├── bindep.txt
├── doc
|   ├── _static
|   |   ├── conf.py.txt
|   |   └── themes
|   |       └── fullsize
|   ├── _templates
|   |   ├── index.html
|   |   └── indexsidebar.html
|   ├── _themes
|   |   └── sphinx13
|   |       ├── layout.html
|   |       └── static
|   |           └── sphinx13.css
|   ├── changes.rst
|   ├── conf.py
|   ├── contents.rst
|   ├── development
|   |   ├── builders.rst
|   |   ├── index.rst
|   |   ├── overview.rst
|   |   ├── theming.rst
|   |   └── tutorials
|   |       ├── autodoc_ext.rst
|   |       ├── examples
|   |       |   ├── README.rst
|   |       |   ├── autodoc_intenum.py
|   |       |   ├── helloworld.py
|   |       |   ├── recipe.py
|   |       |   └── todo.py
|   |       ├── helloworld.rst
|   |       ├── index.rst
|   |       ├── recipe.rst
|   |       └── todo.rst
|   ├── examples.rst
|   ├── extdev
|   |   ├── appapi.rst
|   |   ├── builderapi.rst
|   |   ├── collectorapi.rst
|   |   ├── deprecated.rst
|   |   ├── domainapi.rst
|   |   ├── envapi.rst
|   |   ├── i18n.rst
|   |   ├── index.rst
|   |   ├── logging.rst
|   |   ├── markupapi.rst
|   |   ├── nodes.rst
|   |   ├── parserapi.rst
|   |   ├── projectapi.rst
|   |   └── utils.rst
|   ├── faq.rst
|   ├── glossary.rst
|   ├── internals
|   |   ├── authors.rst
|   |   ├── code-of-conduct.rst
|   |   ├── contributing.rst
|   |   ├── index.rst
|   |   ├── organization.rst
|   |   └── release-process.rst
|   ├── latex.rst
|   ├── man
|   |   ├── index.rst
|   |   ├── sphinx-apidoc.rst
|   |   ├── sphinx-autogen.rst
|   |   ├── sphinx-build.rst
|   |   └── sphinx-quickstart.rst
|   ├── templating.rst
|   └── usage
|       ├── advanced
|       |   ├── intl.rst
|       |   ├── setuptools.rst
|       |   └── websupport
|       |       ├── api.rst
|       |       ├── index.rst
|       |       ├── quickstart.rst
|       |       ├── searchadapters.rst
|       |       └── storagebackends.rst
|       ├── builders
|       |   └── index.rst
|       ├── configuration.rst
|       ├── extensions
|       |   ├── autodoc.rst
|       |   ├── autosectionlabel.rst
|       |   ├── autosummary.rst
|       |   ├── coverage.rst
|       |   ├── doctest.rst
|       |   ├── duration.rst
|       |   ├── example_google.py
|       |   ├── example_google.rst
|       |   ├── example_numpy.py
|       |   ├── example_numpy.rst
|       |   ├── extlinks.rst
|       |   ├── githubpages.rst
|       |   ├── graphviz.rst
|       |   ├── ifconfig.rst
|       |   ├── imgconverter.rst
|       |   ├── index.rst
|       |   ├── inheritance.rst
|       |   ├── intersphinx.rst
|       |   ├── linkcode.rst
|       |   ├── math.rst
|       |   ├── napoleon.rst
|       |   ├── todo.rst
|       |   └── viewcode.rst
|       ├── index.rst
|       ├── installation.rst
|       ├── markdown.rst
|       ├── quickstart.rst
|       ├── restructuredtext
|       |   ├── basics.rst
|       |   ├── directives.rst
|       |   ├── domains.rst
|       |   ├── field-lists.rst
|       |   ├── index.rst
|       |   └── roles.rst
|       └── theming.rst
├── karma.conf.js
├── setup.py
├── sphinx
|   ├── __init__.py
|   ├── __main__.py
|   ├── addnodes.py
|   ├── application.py
|   ├── builders
|   |   ├── __init__.py
|   |   ├── _epub_base.py
|   |   ├── changes.py
|   |   ├── dirhtml.py
|   |   ├── dummy.py
|   |   ├── epub3.py
|   |   ├── gettext.py
|   |   ├── html
|   |   |   ├── __init__.py
|   |   |   └── transforms.py
|   |   ├── latex
|   |   |   ├── __init__.py
|   |   |   ├── constants.py
|   |   |   ├── nodes.py
|   |   |   ├── theming.py
|   |   |   ├── transforms.py
|   |   |   └── util.py
|   |   ├── linkcheck.py
|   |   ├── manpage.py
|   |   ├── singlehtml.py
|   |   ├── texinfo.py
|   |   ├── text.py
|   |   └── xml.py
|   ├── cmd
|   |   ├── __init__.py
|   |   ├── build.py
|   |   ├── make_mode.py
|   |   └── quickstart.py
|   ├── config.py
|   ├── deprecation.py
|   ├── directives
|   |   ├── __init__.py
|   |   ├── code.py
|   |   ├── other.py
|   |   └── patches.py
|   ├── domains
|   |   ├── __init__.py
|   |   ├── c.py
|   |   ├── changeset.py
|   |   ├── citation.py
|   |   ├── cpp.py
|   |   ├── index.py
|   |   ├── javascript.py
|   |   ├── math.py
|   |   ├── python.py
|   |   ├── rst.py
|   |   └── std.py
|   ├── environment
|   |   ├── __init__.py
|   |   ├── adapters
|   |   |   ├── __init__.py
|   |   |   ├── asset.py
|   |   |   ├── indexentries.py
|   |   |   └── toctree.py
|   |   └── collectors
|   |       ├── __init__.py
|   |       ├── asset.py
|   |       ├── dependencies.py
|   |       ├── metadata.py
|   |       ├── title.py
|   |       └── toctree.py
|   ├── errors.py
|   ├── events.py
|   ├── ext
|   |   ├── __init__.py
|   |   ├── apidoc.py
|   |   ├── autodoc
|   |   |   ├── __init__.py
|   |   |   ├── deprecated.py
|   |   |   ├── directive.py
|   |   |   ├── importer.py
|   |   |   ├── mock.py
|   |   |   ├── preserve_defaults.py
|   |   |   ├── type_comment.py
|   |   |   └── typehints.py
|   |   ├── autosectionlabel.py
|   |   ├── autosummary
|   |   |   ├── __init__.py
|   |   |   ├── generate.py
|   |   |   └── templates
|   |   |       └── autosummary
|   |   ├── coverage.py
|   |   ├── doctest.py
|   |   ├── duration.py
|   |   ├── extlinks.py
|   |   ├── githubpages.py
|   |   ├── graphviz.py
|   |   ├── ifconfig.py
|   |   ├── imgconverter.py
|   |   ├── imgmath.py
|   |   ├── inheritance_diagram.py
|   |   ├── intersphinx.py
|   |   ├── linkcode.py
|   |   ├── mathjax.py
|   |   ├── napoleon
|   |   |   ├── __init__.py
|   |   |   ├── docstring.py
|   |   |   └── iterators.py
|   |   ├── todo.py
|   |   └── viewcode.py
|   ├── extension.py
|   ├── highlighting.py
|   ├── io.py
|   ├── jinja2glue.py
|   ├── locale
|   |   ├── __init__.py
|   |   ├── ar
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bg
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bn
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ca
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cak
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cs
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cy
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── da
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── de
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── el
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eo
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── es
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── et
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fa
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── he
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi_IN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── id
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── it
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ja
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ko
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── mk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nb_NO
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ne
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_BR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_PT
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ro
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ru
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── si
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sq
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr@latin
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr_RS
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ta
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── te
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── tr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── uk_UA
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ur
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── vi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_CN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   └── zh_TW
|   |       └── LC_MESSAGES
|   |           └── sphinx.js
|   ├── parsers.py
|   ├── project.py
|   ├── pycode
|   |   ├── __init__.py
|   |   ├── ast.py
|   |   └── parser.py
|   ├── pygments_styles.py
|   ├── registry.py
|   ├── roles.py
|   ├── search
|   |   ├── __init__.py
|   |   ├── da.py
|   |   ├── de.py
|   |   ├── en.py
|   |   ├── es.py
|   |   ├── fi.py
|   |   ├── fr.py
|   |   ├── hu.py
|   |   ├── it.py
|   |   ├── ja.py
|   |   ├── jssplitter.py
|   |   ├── minified-js
|   |   |   ├── base-stemmer.js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── nl.py
|   |   ├── no.py
|   |   ├── non-minified-js
|   |   |   ├── base-stemmer.js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── pt.py
|   |   ├── ro.py
|   |   ├── ru.py
|   |   ├── sv.py
|   |   ├── tr.py
|   |   └── zh.py
|   ├── setup_command.py
|   ├── templates
|   |   ├── apidoc
|   |   ├── epub3
|   |   |   └── container.xml
|   |   ├── gettext
|   |   ├── graphviz
|   |   |   └── graphviz.css
|   |   ├── htmlhelp
|   |   ├── imgmath
|   |   ├── latex
|   |   ├── quickstart
|   |   └── texinfo
|   ├── testing
|   |   ├── __init__.py
|   |   ├── comparer.py
|   |   ├── fixtures.py
|   |   ├── path.py
|   |   ├── restructuredtext.py
|   |   └── util.py
|   ├── texinputs
|   ├── texinputs_win
|   ├── themes
|   |   ├── agogo
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── basic
|   |   |   ├── changes
|   |   |   |   ├── frameset.html
|   |   |   |   ├── rstsource.html
|   |   |   |   └── versionchanges.html
|   |   |   ├── defindex.html
|   |   |   ├── domainindex.html
|   |   |   ├── genindex-single.html
|   |   |   ├── genindex-split.html
|   |   |   ├── genindex.html
|   |   |   ├── globaltoc.html
|   |   |   ├── layout.html
|   |   |   ├── localtoc.html
|   |   |   ├── opensearch.xml
|   |   |   ├── page.html
|   |   |   ├── relations.html
|   |   |   ├── search.html
|   |   |   ├── searchbox.html
|   |   |   ├── sourcelink.html
|   |   |   └── static
|   |   |       ├── doctools.js
|   |   |       ├── jquery-3.5.1.js
|   |   |       ├── jquery.js
|   |   |       ├── searchtools.js
|   |   |       ├── underscore-1.13.1.js
|   |   |       └── underscore.js
|   |   ├── bizstyle
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── css3-mediaqueries.js
|   |   |       └── css3-mediaqueries_src.js
|   |   ├── classic
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── default
|   |   |   └── static
|   |   |       └── default.css
|   |   ├── epub
|   |   |   ├── epub-cover.html
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── haiku
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── nature
|   |   |   └── static
|   |   ├── nonav
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       └── nonav.css
|   |   ├── pyramid
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── epub.css
|   |   |       └── ie6.css
|   |   ├── scrolls
|   |   |   ├── artwork
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── print.css
|   |   |       └── theme_extras.js
|   |   ├── sphinxdoc
|   |   |   └── static
|   |   └── traditional
|   |       └── static
|   ├── theming.py
|   ├── transforms
|   |   ├── __init__.py
|   |   ├── compact_bullet_list.py
|   |   ├── i18n.py
|   |   ├── post_transforms
|   |   |   ├── __init__.py
|   |   |   ├── code.py
|   |   |   └── images.py
|   |   └── references.py
|   ├── util
|   |   ├── __init__.py
|   |   ├── build_phase.py
|   |   ├── cfamily.py
|   |   ├── compat.py
|   |   ├── console.py
|   |   ├── docfields.py
|   |   ├── docstrings.py
|   |   ├── docutils.py
|   |   ├── fileutil.py
|   |   ├── i18n.py
|   |   ├── images.py
|   |   ├── inspect.py
|   |   ├── inventory.py
|   |   ├── jsdump.py
|   |   ├── logging.py
|   |   ├── matching.py
|   |   ├── math.py
|   |   ├── nodes.py
|   |   ├── osutil.py
|   |   ├── parallel.py
|   |   ├── png.py
|   |   ├── pycompat.py
|   |   ├── requests.py
|   |   ├── rst.py
|   |   ├── smartypants.py
|   |   ├── stemmer
|   |   |   ├── __init__.py
|   |   |   └── porter.py
|   |   ├── tags.py
|   |   ├── template.py
|   |   ├── texescape.py
|   |   └── typing.py
|   ├── versioning.py
|   └── writers
|       ├── __init__.py
|       ├── html.py
|       ├── html5.py
|       ├── latex.py
|       ├── manpage.py
|       ├── texinfo.py
|       ├── text.py
|       └── xml.py
├── tests
|   ├── __init__.py
|   ├── certs
|   ├── conftest.py
|   ├── ext_napoleon_pep526_data_google.py
|   ├── ext_napoleon_pep526_data_numpy.py
|   ├── js
|   |   ├── doctools.js
|   |   └── searchtools.js
|   ├── roots
|   |   ├── test-add_enumerable_node
|   |   |   ├── conf.py
|   |   |   ├── enumerable_node.py
|   |   |   └── index.rst
|   |   ├── test-add_source_parser
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-add_source_parser-conflicts-with-users-setting
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-api-set-translator
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nonext
|   |   |   |   └── conf.py
|   |   |   └── translator.py
|   |   ├── test-apidoc-pep420
|   |   |   └── a
|   |   |       └── b
|   |   ├── test-apidoc-subpackage-in-toc
|   |   |   └── parent
|   |   |       ├── __init__.py
|   |   |       └── child
|   |   ├── test-apidoc-toc
|   |   |   └── mypackage
|   |   |       ├── __init__.py
|   |   |       ├── main.py
|   |   |       ├── no_init
|   |   |       ├── resource
|   |   |       └── something
|   |   ├── test-apidoc-trailing-underscore
|   |   |   └── package_
|   |   |       ├── __init__.py
|   |   |       └── module_.py
|   |   ├── test-autosummary
|   |   |   ├── conf.py
|   |   |   ├── dummy_module.py
|   |   |   ├── index.rst
|   |   |   ├── sphinx.rst
|   |   |   └── underscore_module_.py
|   |   ├── test-basic
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-html-translator
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-text
|   |   |   ├── conf.py
|   |   |   ├── doc1.txt
|   |   |   ├── doc2.txt
|   |   |   ├── index.txt
|   |   |   ├── lineblock.txt
|   |   |   ├── listitems.txt
|   |   |   ├── maxwidth.txt
|   |   |   ├── nonascii_maxwidth.txt
|   |   |   ├── nonascii_table.txt
|   |   |   ├── nonascii_title.txt
|   |   |   ├── table.txt
|   |   |   ├── table_colspan.txt
|   |   |   ├── table_colspan_and_rowspan.txt
|   |   |   ├── table_colspan_left.txt
|   |   |   └── table_rowspan.txt
|   |   ├── test-builder-dirhtml
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo
|   |   |   |   ├── foo_1.rst
|   |   |   |   ├── foo_2.rst
|   |   |   |   └── index.rst
|   |   |   └── index.rst
|   |   ├── test-builder-gettext-dont-rebuild-mo
|   |   |   ├── bom.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-changes
|   |   |   ├── base.rst
|   |   |   ├── c-api.rst
|   |   |   ├── conf.py
|   |   |   ├── contents.rst
|   |   |   └── library
|   |   |       └── utils.rst
|   |   ├── test-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-config
|   |   |   └── conf.py
|   |   ├── test-correct-year
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-default_role
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-directive-code
|   |   |   ├── caption.rst
|   |   |   ├── classes.rst
|   |   |   ├── conf.py
|   |   |   ├── emphasize.rst
|   |   |   ├── force.rst
|   |   |   ├── highlight.rst
|   |   |   ├── index.rst
|   |   |   ├── linenos.rst
|   |   |   ├── linenothreshold.rst
|   |   |   ├── namedblocks.rst
|   |   |   ├── py-decorators.rst
|   |   |   ├── python.rst
|   |   |   └── target.py
|   |   ├── test-directive-csv-table
|   |   |   ├── conf.py
|   |   |   └── subdir
|   |   ├── test-directive-only
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── only.rst
|   |   ├── test-directives-raw
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-docutilsconf
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-c
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── conf.py
|   |   |   ├── function_param_target.rst
|   |   |   ├── index.rst
|   |   |   ├── namespace.rst
|   |   |   └── ns_lookup.rst
|   |   ├── test-domain-c-intersphinx
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-cpp
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── any-role.rst
|   |   |   ├── backslash.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── lookup-key-overload.rst
|   |   |   ├── multi-decl-lookup.rst
|   |   |   ├── roles-targets-ok.rst
|   |   |   ├── roles-targets-warn.rst
|   |   |   ├── roles.rst
|   |   |   ├── roles2.rst
|   |   |   ├── semicolon.rst
|   |   |   ├── warn-template-param-qualified-name.rst
|   |   |   └── xref_consistency.rst
|   |   ├── test-domain-cpp-intersphinx
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-js
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py
|   |   |   ├── abbr.rst
|   |   |   ├── canonical.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   ├── module_option.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py-python_use_unqualified_type_names
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-py-xref-warning
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-double-inheriting-theme
|   |   |   ├── base_themes_dir
|   |   |   |   ├── base_theme1
|   |   |   |   └── base_theme2
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-epub-anchor-id
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autodoc
|   |   |   ├── autodoc_dummy_bar.py
|   |   |   ├── autodoc_dummy_module.py
|   |   |   ├── bug2437
|   |   |   |   ├── __init__.py
|   |   |   |   └── autodoc_dummy_foo.py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target
|   |   |       ├── TYPE_CHECKING.py
|   |   |       ├── __init__.py
|   |   |       ├── abstractmethods.py
|   |   |       ├── annotated.py
|   |   |       ├── autoclass_content.py
|   |   |       ├── autodoc_type_aliases.py
|   |   |       ├── bound_method.py
|   |   |       ├── cached_property.py
|   |   |       ├── callable.py
|   |   |       ├── canonical
|   |   |       ├── classes.py
|   |   |       ├── coroutine.py
|   |   |       ├── decorator.py
|   |   |       ├── descriptor.py
|   |   |       ├── docstring_signature.py
|   |   |       ├── empty_all.py
|   |   |       ├── enums.py
|   |   |       ├── final.py
|   |   |       ├── functions.py
|   |   |       ├── generic_class.py
|   |   |       ├── genericalias.py
|   |   |       ├── hide_value.py
|   |   |       ├── imported_members.py
|   |   |       ├── inheritance.py
|   |   |       ├── instance_variable.py
|   |   |       ├── metadata.py
|   |   |       ├── methods.py
|   |   |       ├── module.py
|   |   |       ├── name_conflict
|   |   |       ├── name_mangling.py
|   |   |       ├── need_mocks.py
|   |   |       ├── overload.py
|   |   |       ├── overload2.py
|   |   |       ├── partialfunction.py
|   |   |       ├── partialmethod.py
|   |   |       ├── pep570.py
|   |   |       ├── pep604.py
|   |   |       ├── preserve_defaults.py
|   |   |       ├── private.py
|   |   |       ├── process_docstring.py
|   |   |       ├── properties.py
|   |   |       ├── singledispatch.py
|   |   |       ├── singledispatchmethod.py
|   |   |       ├── slots.py
|   |   |       ├── sort_by_all.py
|   |   |       ├── typed_vars.py
|   |   |       ├── typehints.py
|   |   |       ├── typevar.py
|   |   |       ├── uninitialized_attributes.py
|   |   |       └── wrappedfunction.py
|   |   ├── test-ext-autosectionlabel
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosectionlabel-prefix-document
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── autosummary_importfail.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-filename-map
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-imported_members
|   |   |   ├── autosummary_dummy_package
|   |   |   |   ├── __init__.py
|   |   |   |   └── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-mock_imports
|   |   |   ├── conf.py
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-recursive
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── package
|   |   |   |   ├── __init__.py
|   |   |   |   ├── module.py
|   |   |   |   ├── module_importfail.py
|   |   |   |   └── package
|   |   |   └── package2
|   |   |       ├── __init__.py
|   |   |       └── module.py
|   |   ├── test-ext-autosummary-skip-member
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-autosummary-template
|   |   |   ├── _templates
|   |   |   |   └── empty.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-coverage
|   |   |   ├── conf.py
|   |   |   ├── coverage_ignored.py
|   |   |   ├── coverage_not_ignored.py
|   |   |   └── index.rst
|   |   ├── test-ext-doctest
|   |   |   ├── conf.py
|   |   |   └── doctest.txt
|   |   ├── test-ext-doctest-skipif
|   |   |   ├── conf.py
|   |   |   └── skipif.txt
|   |   ├── test-ext-doctest-with-autodoc
|   |   |   ├── conf.py
|   |   |   ├── dir
|   |   |   |   ├── __init__.py
|   |   |   |   ├── bar.py
|   |   |   |   └── inner.rst
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-githubpages
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-graphviz
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-ifconfig
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-imgconverter
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-inheritance_diagram
|   |   |   ├── conf.py
|   |   |   ├── example
|   |   |   |   ├── __init__.py
|   |   |   |   └── sphinx.py
|   |   |   ├── index.rst
|   |   |   └── test.py
|   |   ├── test-ext-intersphinx-cppdomain
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── math.rst
|   |   |   ├── nomath.rst
|   |   |   └── page.rst
|   |   ├── test-ext-math-compat
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math-simple
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-todo
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-ext-viewcode
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── objects.rst
|   |   |   └── spam
|   |   |       ├── __init__.py
|   |   |       ├── mod1.py
|   |   |       ├── mod2.py
|   |   |       └── mod3.py
|   |   ├── test-ext-viewcode-find
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── not_a_package
|   |   |       ├── __init__.py
|   |   |       └── submodule.py
|   |   ├── test-extensions
|   |   |   ├── conf.py
|   |   |   ├── read_parallel.py
|   |   |   ├── read_serial.py
|   |   |   ├── write_parallel.py
|   |   |   └── write_serial.py
|   |   ├── test-footnotes
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-gettext-template
|   |   |   ├── _templates
|   |   |   |   ├── template1.html
|   |   |   |   └── template2.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-glossary
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-highlight_options
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_assets
|   |   |   ├── conf.py
|   |   |   ├── extra
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   └── subdir
|   |   |   ├── index.rst
|   |   |   ├── static
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   ├── js
|   |   |   |   └── subdir
|   |   |   └── subdir
|   |   |       └── _build
|   |   ├── test-html_entity
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_scaled_image_link
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_style
|   |   |   ├── _static
|   |   |   |   └── default.css
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-parsed-literal
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-section
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-images
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── subdir
|   |   |       └── index.rst
|   |   ├── test-index_on_title
|   |   |   ├── conf.py
|   |   |   └── contents.rst
|   |   ├── test-inheritance
|   |   |   ├── basic_diagram.rst
|   |   |   ├── conf.py
|   |   |   ├── diagram_module_w_2_top_classes.rst
|   |   |   ├── diagram_w_1_top_class.rst
|   |   |   ├── diagram_w_2_top_classes.rst
|   |   |   ├── diagram_w_nested_classes.rst
|   |   |   ├── diagram_w_parts.rst
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── test.py
|   |   |   |   └── test_nested.py
|   |   |   └── index.rst
|   |   ├── test-intl
|   |   |   ├── _templates
|   |   |   |   └── contents.html
|   |   |   ├── admonitions.txt
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── definition_terms.txt
|   |   |   ├── docfields.txt
|   |   |   ├── external_links.txt
|   |   |   ├── figure.txt
|   |   |   ├── footnote.txt
|   |   |   ├── glossary_terms.txt
|   |   |   ├── glossary_terms_inconsistency.txt
|   |   |   ├── index.txt
|   |   |   ├── index_entries.txt
|   |   |   ├── label_target.txt
|   |   |   ├── literalblock.txt
|   |   |   ├── only.txt
|   |   |   ├── raw.txt
|   |   |   ├── refs.txt
|   |   |   ├── refs_inconsistency.txt
|   |   |   ├── refs_python_domain.txt
|   |   |   ├── role_xref.txt
|   |   |   ├── rubric.txt
|   |   |   ├── section.txt
|   |   |   ├── seealso.txt
|   |   |   ├── subdir
|   |   |   |   └── index.txt
|   |   |   ├── table.txt
|   |   |   ├── toctree.txt
|   |   |   ├── topic.txt
|   |   |   ├── versionchange.txt
|   |   |   ├── warnings.txt
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-keep_warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-babel
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-latex-equations
|   |   |   ├── conf.py
|   |   |   ├── equations.rst
|   |   |   └── expects
|   |   ├── test-latex-figure-in-admonition
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-includegraphics
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-index
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-labels
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── otherdoc.rst
|   |   ├── test-latex-numfig
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── indexhowto.rst
|   |   |   └── indexmanual.rst
|   |   ├── test-latex-table
|   |   |   ├── _mytemplates
|   |   |   |   └── latex
|   |   |   ├── complex.rst
|   |   |   ├── conf.py
|   |   |   ├── expects
|   |   |   ├── index.rst
|   |   |   ├── longtable.rst
|   |   |   └── tabular.rst
|   |   ├── test-latex-theme
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── theme
|   |   |       └── custom
|   |   ├── test-latex-title
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-unicode
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck
|   |   |   ├── conf.py
|   |   |   └── links.txt
|   |   ├── test-linkcheck-localserver
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-anchor
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-https
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-locale
|   |   |   ├── locale1
|   |   |   |   └── en
|   |   |   └── locale2
|   |   |       └── en
|   |   ├── test-manpage_url
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-citation
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-rubric
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-maxlistdepth
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-metadata
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-need-escaped
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux.rst
|   |   ├── test-nested-enumerated-list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nested-tables
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nitpicky-warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-numbered-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-numfig
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-productionlist
|   |   |   ├── Bare.rst
|   |   |   ├── Dup1.rst
|   |   |   ├── Dup2.rst
|   |   |   ├── LineContinuation.rst
|   |   |   ├── P1.rst
|   |   |   ├── P2.rst
|   |   |   ├── conf.py
|   |   |   ├── firstLineRule.rst
|   |   |   └── index.rst
|   |   ├── test-prolog
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── markdown.md
|   |   |   ├── prolog_markdown_parser.py
|   |   |   └── restructuredtext.rst
|   |   ├── test-pycode
|   |   |   └── cp_1251_coded.py
|   |   ├── test-pycode-egg
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── src
|   |   |       ├── sample.py
|   |   |       └── setup.py
|   |   ├── test-reST-code-block
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-refonly_bullet_list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-roles-download
|   |   |   ├── another
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-root
|   |   |   ├── _templates
|   |   |   |   ├── contentssb.html
|   |   |   |   ├── customsb.html
|   |   |   |   └── layout.html
|   |   |   ├── autodoc.txt
|   |   |   ├── autodoc_target.py
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── extapi.txt
|   |   |   ├── extensions.txt
|   |   |   ├── footnote.txt
|   |   |   ├── images.txt
|   |   |   ├── includes.txt
|   |   |   ├── index.txt
|   |   |   ├── lists.txt
|   |   |   ├── markup.txt
|   |   |   ├── math.txt
|   |   |   ├── objects.txt
|   |   |   ├── parsermod.py
|   |   |   ├── special
|   |   |   |   └── code.py
|   |   |   └── subdir
|   |   |       ├── excluded.txt
|   |   |       ├── images.txt
|   |   |       └── includes.txt
|   |   ├── test-search
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nosearch.rst
|   |   |   └── tocitem.rst
|   |   ├── test-setup
|   |   |   ├── doc
|   |   |   |   ├── conf.py
|   |   |   |   └── index.txt
|   |   |   └── setup.py
|   |   ├── test-smartquotes
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-stylesheets
|   |   |   ├── _templates
|   |   |   |   └── layout.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-templating
|   |   |   ├── _templates
|   |   |   |   ├── autosummary
|   |   |   |   └── layout.html
|   |   |   ├── autosummary_templating.txt
|   |   |   ├── conf.py
|   |   |   └── index.txt
|   |   ├── test-theming
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── setup.py
|   |   |   └── test_theme
|   |   |       ├── __init__.py
|   |   |       ├── staticfiles
|   |   |       └── test-theme
|   |   ├── test-tocdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   ├── qux.rst
|   |   |   └── tocdepth.rst
|   |   ├── test-toctree-duplicated
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree-empty
|   |   |   ├── _templates
|   |   |   |   └── localtoc.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-toctree-glob
|   |   |   ├── bar
|   |   |   |   ├── bar_1.rst
|   |   |   |   ├── bar_2.rst
|   |   |   |   ├── bar_3.rst
|   |   |   |   ├── bar_4
|   |   |   |   └── index.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux
|   |   |       ├── index.rst
|   |   |       ├── qux_1.rst
|   |   |       └── qux_2.rst
|   |   ├── test-toctree-maxdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   └── qux.rst
|   |   ├── test-transforms-post_transforms-missing-reference
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-trim_doctest_flags
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-versioning
|   |   |   ├── added.txt
|   |   |   ├── conf.py
|   |   |   ├── deleted.txt
|   |   |   ├── deleted_end.txt
|   |   |   ├── index.txt
|   |   |   ├── insert.txt
|   |   |   ├── insert_beginning.txt
|   |   |   ├── insert_similar.txt
|   |   |   ├── modified.txt
|   |   |   └── original.txt
|   |   └── test-warnings
|   |       ├── autodoc_fodder.py
|   |       ├── conf.py
|   |       ├── index.rst
|   |       └── undecodable.rst
|   ├── test_api_translator.py
|   ├── test_application.py
|   ├── test_build.py
|   ├── test_build_changes.py
|   ├── test_build_dirhtml.py
|   ├── test_build_epub.py
|   ├── test_build_gettext.py
|   ├── test_build_html.py
|   ├── test_build_latex.py
|   ├── test_build_linkcheck.py
|   ├── test_build_manpage.py
|   ├── test_build_texinfo.py
|   ├── test_build_text.py
|   ├── test_builder.py
|   ├── test_catalogs.py
|   ├── test_config.py
|   ├── test_correct_year.py
|   ├── test_directive_code.py
|   ├── test_directive_only.py
|   ├── test_directive_other.py
|   ├── test_directive_patch.py
|   ├── test_docutilsconf.py
|   ├── test_domain_c.py
|   ├── test_domain_cpp.py
|   ├── test_domain_js.py
|   ├── test_domain_py.py
|   ├── test_domain_rst.py
|   ├── test_domain_std.py
|   ├── test_environment.py
|   ├── test_environment_indexentries.py
|   ├── test_environment_toctree.py
|   ├── test_errors.py
|   ├── test_events.py
|   ├── test_ext_apidoc.py
|   ├── test_ext_autodoc.py
|   ├── test_ext_autodoc_autoattribute.py
|   ├── test_ext_autodoc_autoclass.py
|   ├── test_ext_autodoc_autodata.py
|   ├── test_ext_autodoc_autofunction.py
|   ├── test_ext_autodoc_automodule.py
|   ├── test_ext_autodoc_autoproperty.py
|   ├── test_ext_autodoc_configs.py
|   ├── test_ext_autodoc_events.py
|   ├── test_ext_autodoc_mock.py
|   ├── test_ext_autodoc_preserve_defaults.py
|   ├── test_ext_autodoc_private_members.py
|   ├── test_ext_autosectionlabel.py
|   ├── test_ext_autosummary.py
|   ├── test_ext_coverage.py
|   ├── test_ext_doctest.py
|   ├── test_ext_duration.py
|   ├── test_ext_githubpages.py
|   ├── test_ext_graphviz.py
|   ├── test_ext_ifconfig.py
|   ├── test_ext_imgconverter.py
|   ├── test_ext_inheritance_diagram.py
|   ├── test_ext_intersphinx.py
|   ├── test_ext_math.py
|   ├── test_ext_napoleon.py
|   ├── test_ext_napoleon_docstring.py
|   ├── test_ext_napoleon_iterators.py
|   ├── test_ext_todo.py
|   ├── test_ext_viewcode.py
|   ├── test_highlighting.py
|   ├── test_intl.py
|   ├── test_locale.py
|   ├── test_markup.py
|   ├── test_metadata.py
|   ├── test_parser.py
|   ├── test_project.py
|   ├── test_pycode.py
|   ├── test_pycode_ast.py
|   ├── test_pycode_parser.py
|   ├── test_quickstart.py
|   ├── test_roles.py
|   ├── test_search.py
|   ├── test_setup_command.py
|   ├── test_smartquotes.py
|   ├── test_templating.py
|   ├── test_theming.py
|   ├── test_toctree.py
|   ├── test_transforms_post_transforms.py
|   ├── test_transforms_post_transforms_code.py
|   ├── test_util.py
|   ├── test_util_docstrings.py
|   ├── test_util_docutils.py
|   ├── test_util_fileutil.py
|   ├── test_util_i18n.py
|   ├── test_util_images.py
|   ├── test_util_inspect.py
|   ├── test_util_inventory.py
|   ├── test_util_jsdump.py
|   ├── test_util_logging.py
|   ├── test_util_matching.py
|   ├── test_util_nodes.py
|   ├── test_util_rst.py
|   ├── test_util_template.py
|   ├── test_util_typing.py
|   ├── test_versioning.py
|   ├── test_writer_latex.py
|   ├── typing_test_data.py
|   └── utils.py
└── utils
    ├── __init__.py
    ├── bump_docker.sh
    ├── bump_version.py
    ├── checks.py
    ├── doclinter.py
    └── jssplitter_generator.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Doc rendering is incorrect when :param has datatype dict(str,str)

Description: **Describe the bug**
I have a parameter defined under docstring of a method as:-
:param dict(str, str) opc_meta: (optional)

Which is being incorrectly rendered in the generated docs as:-
str) opc_meta (dict(str,) –(optional) 

**To Reproduce**
Create any method with the docstring containg the above param

**Expected behavior**
The param should be rendered in the generated docs as:-
opc_meta (dict(str,str)) – (optional) 

**Your project**
[sphinxTest.zip](https://github.com/sphinx-doc/sphinx/files/6468074/sphinxTest.zip)


**Screenshots**
<img width="612" alt="Screen Shot 2021-05-12 at 12 30 50 PM" src="https://user-images.githubusercontent.com/8617566/118020143-5f59a280-b31f-11eb-8dc2-5280d5c4896b.png">
<img width="681" alt="Screen Shot 2021-05-12 at 12 32 25 PM" src="https://user-images.githubusercontent.com/8617566/118020154-62549300-b31f-11eb-953d-9287f9cc27ff.png">


**Environment info**
- OS: Mac
- Python version: 3.9.0
- Sphinx version: 4.0.1
- Sphinx extensions:  ["sphinx.ext.autodoc", "sphinx.ext.autosummary", "sphinx.ext.intersphinx", "autodocsumm"]
- Extra tools: Browser Firefox.

**Additional context**
N/A



Patch information:
diff --git a/sphinx/util/docfields.py b/sphinx/util/docfields.py
index 3a3367ebe..6d48e910c 100644
--- a/sphinx/util/docfields.py
+++ b/sphinx/util/docfields.py
@@ -298,7 +298,7 @@ class DocFieldTransformer:
             # also support syntax like ``:param type name:``
             if typedesc.is_typed:
                 try:
-                    argtype, argname = fieldarg.split(None, 1)
+                    argtype, argname = fieldarg.rsplit(None, 1)
                 except ValueError:
                     pass
                 else:


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 02:23:40,521 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="The user wants to find 3 relevant test cases for a bug in docstring parameter parsing. The bug is caused by incorrect splitting of a parameter's type and name when the type contains a space, as in `dict(str, str)`. The provided patch is in `sphinx/util/docfields.py`. The functionality involves `docfields` for parsing, the Python domain for semantic understanding, and `autodoc` for docstring extraction and rendering. Therefore, I need to examine tests for all these components to find relevant examples. The most relevant files are `tests/test_util_docfields.py` (for the patched module), `tests/test_domain_py.py` (for python-specific parsing), and `tests/test_ext_autodoc.py` (for end-to-end testing)." query='Please provide the full content of `tests/test_util_docfields.py`, `tests/test_domain_py.py`, and `tests/test_ext_autodoc.py`.' extra_requirements='' purpose='I need to analyze these test files to find at least three existing test cases that cover the parsing of complex parameter types in docstrings, which will help in understanding how this functionality is currently tested and to find tests similar to the bug report.'
2025-12-21 02:23:40,522 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `tests/test_util_docfields.py`, `tests/test_domain_py.py`, and `tests/test_ext_autodoc.py`.
2025-12-21 02:23:40,522 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-21 02:23:40,523 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-21 02:23:40,523 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-21 02:23:40,523 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `tests/test_util_docfields.py`, `tests/test_domain_py.py`, and `tests/test_ext_autodoc.py`.
Purpose: I need to analyze these test files to find at least three existing test cases that cover the parsing of complex parameter types in docstrings, which will help in understanding how this functionality is currently tested and to find tests similar to the bug report.
2025-12-21 02:23:43,837 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have started by reading the three test files you requested: `tests/test_util_docfields.py`, `tests/test_domain_py.py`, and `tests/test_ext_autodoc.py`. Now I will proceed to analyze their contents to find test cases related to parsing complex parameter types in docstrings.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/test_ext_autodoc.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2126, 'candidates_token_count': 141, 'total_token_count': 2451, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2126}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 141}], 'thoughts_token_count': 184, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.03005643939295559, 'model_name': 'gemini-2.5-pro'} id='run--2c0dc2a5-df95-430c-b0f3-b017d5b69f0c-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/test_util_docfields.py'}, 'id': 'b4a388c6-777b-4ba7-8197-abba9f2fdc40', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/test_domain_py.py'}, 'id': '7fd527ef-b218-413a-ace3-a541c45b5705', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/test_ext_autodoc.py'}, 'id': 'cc4c29d2-9f06-4401-870d-e3ec10dd3c2d', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2126, 'output_tokens': 141, 'total_tokens': 2451, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 184}}
2025-12-21 02:23:51,754 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have analyzed the content of `tests/test_domain_py.py` and `tests/test_ext_autodoc.py` to find relevant test cases. I found that `tests/test_util_docfields.py` does not exist. I will now retrieve the most relevant test cases that cover the parsing of complex parameter types in docstrings.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/test_ext_autodoc.py", "end_line": 302.0, "start_line": 289.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 19160, 'candidates_token_count': 164, 'total_token_count': 19959, 'cached_content_token_count': 1862, 'prompt_tokens_details': [{'modality': 1, 'token_count': 19160}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1862}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 164}], 'thoughts_token_count': 635}, 'finish_reason': 'STOP', 'avg_logprobs': -0.4205485553276248, 'model_name': 'gemini-2.5-pro'} id='run--1e832fb7-8f75-4cfd-ae5d-5f80bfc5d3bb-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/test_domain_py.py', 'end_line': 335.0, 'start_line': 278.0}, 'id': '2708a51b-e18c-46f7-a200-5bbeac91ca1f', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/test_domain_py.py', 'end_line': 399.0, 'start_line': 353.0}, 'id': '640d68ad-d4a2-44a9-a451-eca4fbbda27b', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/test_ext_autodoc.py', 'end_line': 302.0, 'start_line': 289.0}, 'id': 'bf9321cc-7858-43c1-98c1-c46503db6538', 'type': 'tool_call'}] usage_metadata={'input_tokens': 19160, 'output_tokens': 164, 'total_tokens': 19959, 'input_token_details': {'cache_read': 1862}, 'output_token_details': {'reasoning': 635}}
2025-12-21 02:24:18,059 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the content of `tests/test_domain_py.py` and `tests/test_ext_autodoc.py`, but `tests/test_util_docfields.py` was not found. I then identified and extracted three relevant test cases that demonstrate how complex parameter types in docstrings are parsed and tested. These examples from the test suite should provide a good foundation for understanding the existing test coverage and for creating new tests related to the bug report.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'citation_metadata': {'citations': [{'start_index': 1327, 'end_index': 2144, 'uri': 'https://github.com/Adix82/sphinx', 'title': '', 'license_': ''}, {'start_index': 2144, 'end_index': 2878, 'uri': 'https://github.com/Adix82/sphinx', 'title': '', 'license_': ''}, {'start_index': 2874, 'end_index': 3304, 'uri': 'https://github.com/Adix82/sphinx', 'title': '', 'license_': ''}, {'start_index': 3048, 'end_index': 3683, 'uri': 'https://github.com/jbms/sphinx', 'title': '', 'license_': ''}, {'start_index': 3509, 'end_index': 4133, 'uri': 'https://github.com/Adix82/sphinx', 'title': '', 'license_': ''}, {'start_index': 4167, 'end_index': 5195, 'uri': 'https://github.com/Adix82/sphinx', 'title': '', 'license_': ''}, {'start_index': 5369, 'end_index': 7541, 'uri': 'https://github.com/jbms/sphinx', 'title': '', 'license_': ''}, {'start_index': 7619, 'end_index': 7971, 'uri': 'https://github.com/Adix82/sphinx', 'title': '', 'license_': ''}, {'start_index': 8692, 'end_index': 9479, 'uri': 'https://github.com/Adix82/sphinx', 'title': '', 'license_': ''}, {'start_index': 9479, 'end_index': 10187, 'uri': 'https://github.com/Adix82/sphinx', 'title': '', 'license_': ''}, {'start_index': 10183, 'end_index': 10599, 'uri': 'https://github.com/Adix82/sphinx', 'title': '', 'license_': ''}, {'start_index': 10351, 'end_index': 10964, 'uri': 'https://github.com/jbms/sphinx', 'title': '', 'license_': ''}, {'start_index': 10796, 'end_index': 11397, 'uri': 'https://github.com/Adix82/sphinx', 'title': '', 'license_': ''}, {'start_index': 11416, 'end_index': 12424, 'uri': 'https://github.com/Adix82/sphinx', 'title': '', 'license_': ''}, {'start_index': 12594, 'end_index': 14711, 'uri': 'https://github.com/jbms/sphinx', 'title': '', 'license_': ''}, {'start_index': 14772, 'end_index': 15107, 'uri': 'https://github.com/Adix82/sphinx', 'title': '', 'license_': ''}]}, 'usage_metadata': {'prompt_token_count': 21546, 'candidates_token_count': 98, 'total_token_count': 25158, 'cached_content_token_count': 18593, 'prompt_tokens_details': [{'modality': 1, 'token_count': 21546}], 'cache_tokens_details': [{'modality': 1, 'token_count': 18593}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 98}], 'thoughts_token_count': 3514}, 'finish_reason': 'STOP', 'avg_logprobs': -0.3546671186174665, 'model_name': 'gemini-2.5-pro'} id='run--d85dca09-c3eb-47a5-8293-22e24de8eb31-0' usage_metadata={'input_tokens': 21546, 'output_tokens': 98, 'total_tokens': 25158, 'input_token_details': {'cache_read': 18593}, 'output_token_details': {'reasoning': 3514}}
2025-12-21 02:24:18,061 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `tests/test_util_docfields.py`, `tests/test_domain_py.py`, and `tests/test_ext_autodoc.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
I need to analyze these test files to find at least three existing test cases that cover the parsing of complex parameter types in docstrings, which will help in understanding how this functionality is currently tested and to find tests similar to the bug report.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/test_domain_py.py
Line number range: 1 - 500
Content:
1. """
2.     test_domain_py
3.     ~~~~~~~~~~~~~~
4. 
5.     Tests the Python Domain
6. 
7.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import re
12. import sys
13. from unittest.mock import Mock
14. 
15. import pytest
16. from docutils import nodes
17. 
18. from sphinx import addnodes
19. from sphinx.addnodes import (desc, desc_addname, desc_annotation, desc_content, desc_name,
20.                              desc_optional, desc_parameter, desc_parameterlist, desc_returns,
21.                              desc_sig_name, desc_sig_operator, desc_sig_punctuation,
22.                              desc_signature, pending_xref)
23. from sphinx.domains import IndexEntry
24. from sphinx.domains.python import (PythonDomain, PythonModuleIndex, _parse_annotation,
25.                                    _pseudo_parse_arglist, py_sig_re)
26. from sphinx.testing import restructuredtext
27. from sphinx.testing.util import assert_node
28. 
29. 
30. def parse(sig):
31.     m = py_sig_re.match(sig)
32.     if m is None:
33.         raise ValueError
34.     name_prefix, name, arglist, retann = m.groups()
35.     signode = addnodes.desc_signature(sig, '')
36.     _pseudo_parse_arglist(signode, arglist)
37.     return signode.astext()
38. 
39. 
40. def test_function_signatures():
41.     rv = parse('func(a=1) -> int object')
42.     assert rv == '(a=1)'
43. 
44.     rv = parse('func(a=1, [b=None])')
45.     assert rv == '(a=1, [b=None])'
46. 
47.     rv = parse('func(a=1[, b=None])')
48.     assert rv == '(a=1, [b=None])'
49. 
50.     rv = parse("compile(source : string, filename, symbol='file')")
51.     assert rv == "(source : string, filename, symbol='file')"
52. 
53.     rv = parse('func(a=[], [b=None])')
54.     assert rv == '(a=[], [b=None])'
55. 
56.     rv = parse('func(a=[][, b=None])')
57.     assert rv == '(a=[], [b=None])'
58. 
59. 
60. @pytest.mark.sphinx('dummy', testroot='domain-py')
61. def test_domain_py_xrefs(app, status, warning):
62.     """Domain objects have correct prefixes when looking up xrefs"""
63.     app.builder.build_all()
64. 
65.     def assert_refnode(node, module_name, class_name, target, reftype=None,
66.                        domain='py'):
67.         attributes = {
68.             'refdomain': domain,
69.             'reftarget': target,
70.         }
71.         if reftype is not None:
72.             attributes['reftype'] = reftype
73.         if module_name is not False:
74.             attributes['py:module'] = module_name
75.         if class_name is not False:
76.             attributes['py:class'] = class_name
77.         assert_node(node, **attributes)
78. 
79.     doctree = app.env.get_doctree('roles')
80.     refnodes = list(doctree.traverse(pending_xref))
81.     assert_refnode(refnodes[0], None, None, 'TopLevel', 'class')
82.     assert_refnode(refnodes[1], None, None, 'top_level', 'meth')
83.     assert_refnode(refnodes[2], None, 'NestedParentA', 'child_1', 'meth')
84.     assert_refnode(refnodes[3], None, 'NestedParentA', 'NestedChildA.subchild_2', 'meth')
85.     assert_refnode(refnodes[4], None, 'NestedParentA', 'child_2', 'meth')
86.     assert_refnode(refnodes[5], False, 'NestedParentA', 'any_child', domain='')
87.     assert_refnode(refnodes[6], None, 'NestedParentA', 'NestedChildA', 'class')
88.     assert_refnode(refnodes[7], None, 'NestedParentA.NestedChildA', 'subchild_2', 'meth')
89.     assert_refnode(refnodes[8], None, 'NestedParentA.NestedChildA',
90.                    'NestedParentA.child_1', 'meth')
91.     assert_refnode(refnodes[9], None, 'NestedParentA', 'NestedChildA.subchild_1', 'meth')
92.     assert_refnode(refnodes[10], None, 'NestedParentB', 'child_1', 'meth')
93.     assert_refnode(refnodes[11], None, 'NestedParentB', 'NestedParentB', 'class')
94.     assert_refnode(refnodes[12], None, None, 'NestedParentA.NestedChildA', 'class')
95.     assert len(refnodes) == 13
96. 
97.     doctree = app.env.get_doctree('module')
98.     refnodes = list(doctree.traverse(pending_xref))
99.     assert_refnode(refnodes[0], 'module_a.submodule', None,
100.                    'ModTopLevel', 'class')
101.     assert_refnode(refnodes[1], 'module_a.submodule', 'ModTopLevel',
102.                    'mod_child_1', 'meth')
103.     assert_refnode(refnodes[2], 'module_a.submodule', 'ModTopLevel',
104.                    'ModTopLevel.mod_child_1', 'meth')
105.     assert_refnode(refnodes[3], 'module_a.submodule', 'ModTopLevel',
106.                    'mod_child_2', 'meth')
107.     assert_refnode(refnodes[4], 'module_a.submodule', 'ModTopLevel',
108.                    'module_a.submodule.ModTopLevel.mod_child_1', 'meth')
109.     assert_refnode(refnodes[5], 'module_a.submodule', 'ModTopLevel',
110.                    'prop', 'attr')
111.     assert_refnode(refnodes[6], 'module_a.submodule', 'ModTopLevel',
112.                    'prop', 'meth')
113.     assert_refnode(refnodes[7], 'module_b.submodule', None,
114.                    'ModTopLevel', 'class')
115.     assert_refnode(refnodes[8], 'module_b.submodule', 'ModTopLevel',
116.                    'ModNoModule', 'class')
117.     assert_refnode(refnodes[9], False, False, 'int', 'class')
118.     assert_refnode(refnodes[10], False, False, 'tuple', 'class')
119.     assert_refnode(refnodes[11], False, False, 'str', 'class')
120.     assert_refnode(refnodes[12], False, False, 'float', 'class')
121.     assert_refnode(refnodes[13], False, False, 'list', 'class')
122.     assert_refnode(refnodes[14], False, False, 'ModTopLevel', 'class')
123.     assert_refnode(refnodes[15], False, False, 'index', 'doc', domain='std')
124.     assert len(refnodes) == 16
125. 
126.     doctree = app.env.get_doctree('module_option')
127.     refnodes = list(doctree.traverse(pending_xref))
128.     print(refnodes)
129.     print(refnodes[0])
130.     print(refnodes[1])
131.     assert_refnode(refnodes[0], 'test.extra', 'B', 'foo', 'meth')
132.     assert_refnode(refnodes[1], 'test.extra', 'B', 'foo', 'meth')
133.     assert len(refnodes) == 2
134. 
135. 
136. @pytest.mark.sphinx('html', testroot='domain-py')
137. def test_domain_py_xrefs_abbreviations(app, status, warning):
138.     app.builder.build_all()
139. 
140.     content = (app.outdir / 'abbr.html').read_text()
141.     assert re.search(r'normal: <a .* href="module.html#module_a.submodule.ModTopLevel.'
142.                      r'mod_child_1" .*><.*>module_a.submodule.ModTopLevel.mod_child_1\(\)'
143.                      r'<.*></a>',
144.                      content)
145.     assert re.search(r'relative: <a .* href="module.html#module_a.submodule.ModTopLevel.'
146.                      r'mod_child_1" .*><.*>ModTopLevel.mod_child_1\(\)<.*></a>',
147.                      content)
148.     assert re.search(r'short name: <a .* href="module.html#module_a.submodule.ModTopLevel.'
149.                      r'mod_child_1" .*><.*>mod_child_1\(\)<.*></a>',
150.                      content)
151.     assert re.search(r'relative \+ short name: <a .* href="module.html#module_a.submodule.'
152.                      r'ModTopLevel.mod_child_1" .*><.*>mod_child_1\(\)<.*></a>',
153.                      content)
154.     assert re.search(r'short name \+ relative: <a .* href="module.html#module_a.submodule.'
155.                      r'ModTopLevel.mod_child_1" .*><.*>mod_child_1\(\)<.*></a>',
156.                      content)
157. 
158. 
159. @pytest.mark.sphinx('dummy', testroot='domain-py')
160. def test_domain_py_objects(app, status, warning):
161.     app.builder.build_all()
162. 
163.     modules = app.env.domains['py'].data['modules']
164.     objects = app.env.domains['py'].data['objects']
165. 
166.     assert 'module_a.submodule' in modules
167.     assert 'module_a.submodule' in objects
168.     assert 'module_b.submodule' in modules
169.     assert 'module_b.submodule' in objects
170. 
171.     assert objects['module_a.submodule.ModTopLevel'][2] == 'class'
172.     assert objects['module_a.submodule.ModTopLevel.mod_child_1'][2] == 'method'
173.     assert objects['module_a.submodule.ModTopLevel.mod_child_2'][2] == 'method'
174.     assert 'ModTopLevel.ModNoModule' not in objects
175.     assert objects['ModNoModule'][2] == 'class'
176.     assert objects['module_b.submodule.ModTopLevel'][2] == 'class'
177. 
178.     assert objects['TopLevel'][2] == 'class'
179.     assert objects['top_level'][2] == 'method'
180.     assert objects['NestedParentA'][2] == 'class'
181.     assert objects['NestedParentA.child_1'][2] == 'method'
182.     assert objects['NestedParentA.any_child'][2] == 'method'
183.     assert objects['NestedParentA.NestedChildA'][2] == 'class'
184.     assert objects['NestedParentA.NestedChildA.subchild_1'][2] == 'method'
185.     assert objects['NestedParentA.NestedChildA.subchild_2'][2] == 'method'
186.     assert objects['NestedParentA.child_2'][2] == 'method'
187.     assert objects['NestedParentB'][2] == 'class'
188.     assert objects['NestedParentB.child_1'][2] == 'method'
189. 
190. 
191. @pytest.mark.sphinx('html', testroot='domain-py')
192. def test_resolve_xref_for_properties(app, status, warning):
193.     app.builder.build_all()
194. 
195.     content = (app.outdir / 'module.html').read_text()
196.     assert ('Link to <a class="reference internal" href="#module_a.submodule.ModTopLevel.prop"'
197.             ' title="module_a.submodule.ModTopLevel.prop">'
198.             '<code class="xref py py-attr docutils literal notranslate"><span class="pre">'
199.             'prop</span> <span class="pre">attribute</span></code></a>' in content)
200.     assert ('Link to <a class="reference internal" href="#module_a.submodule.ModTopLevel.prop"'
201.             ' title="module_a.submodule.ModTopLevel.prop">'
202.             '<code class="xref py py-meth docutils literal notranslate"><span class="pre">'
203.             'prop</span> <span class="pre">method</span></code></a>' in content)
204.     assert ('Link to <a class="reference internal" href="#module_a.submodule.ModTopLevel.prop"'
205.             ' title="module_a.submodule.ModTopLevel.prop">'
206.             '<code class="xref py py-attr docutils literal notranslate"><span class="pre">'
207.             'prop</span> <span class="pre">attribute</span></code></a>' in content)
208. 
209. 
210. @pytest.mark.sphinx('dummy', testroot='domain-py')
211. def test_domain_py_find_obj(app, status, warning):
212. 
213.     def find_obj(modname, prefix, obj_name, obj_type, searchmode=0):
214.         return app.env.domains['py'].find_obj(
215.             app.env, modname, prefix, obj_name, obj_type, searchmode)
216. 
217.     app.builder.build_all()
218. 
219.     assert (find_obj(None, None, 'NONEXISTANT', 'class') == [])
220.     assert (find_obj(None, None, 'NestedParentA', 'class') ==
221.             [('NestedParentA', ('roles', 'NestedParentA', 'class', False))])
222.     assert (find_obj(None, None, 'NestedParentA.NestedChildA', 'class') ==
223.             [('NestedParentA.NestedChildA',
224.               ('roles', 'NestedParentA.NestedChildA', 'class', False))])
225.     assert (find_obj(None, 'NestedParentA', 'NestedChildA', 'class') ==
226.             [('NestedParentA.NestedChildA',
227.               ('roles', 'NestedParentA.NestedChildA', 'class', False))])
228.     assert (find_obj(None, None, 'NestedParentA.NestedChildA.subchild_1', 'meth') ==
229.             [('NestedParentA.NestedChildA.subchild_1',
230.               ('roles', 'NestedParentA.NestedChildA.subchild_1', 'method', False))])
231.     assert (find_obj(None, 'NestedParentA', 'NestedChildA.subchild_1', 'meth') ==
232.             [('NestedParentA.NestedChildA.subchild_1',
233.               ('roles', 'NestedParentA.NestedChildA.subchild_1', 'method', False))])
234.     assert (find_obj(None, 'NestedParentA.NestedChildA', 'subchild_1', 'meth') ==
235.             [('NestedParentA.NestedChildA.subchild_1',
236.               ('roles', 'NestedParentA.NestedChildA.subchild_1', 'method', False))])
237. 
238. 
239. @pytest.mark.sphinx('html', testroot='domain-py', freshenv=True)
240. def test_domain_py_canonical(app, status, warning):
241.     app.builder.build_all()
242. 
243.     content = (app.outdir / 'canonical.html').read_text()
244.     assert ('<a class="reference internal" href="#canonical.Foo" title="canonical.Foo">'
245.             '<code class="xref py py-class docutils literal notranslate">'
246.             '<span class="pre">Foo</span></code></a>' in content)
247.     assert warning.getvalue() == ''
248. 
249. 
250. def test_get_full_qualified_name():
251.     env = Mock(domaindata={})
252.     domain = PythonDomain(env)
253. 
254.     # non-python references
255.     node = nodes.reference()
256.     assert domain.get_full_qualified_name(node) is None
257. 
258.     # simple reference
259.     node = nodes.reference(reftarget='func')
260.     assert domain.get_full_qualified_name(node) == 'func'
261. 
262.     # with py:module context
263.     kwargs = {'py:module': 'module1'}
264.     node = nodes.reference(reftarget='func', **kwargs)
265.     assert domain.get_full_qualified_name(node) == 'module1.func'
266. 
267.     # with py:class context
268.     kwargs = {'py:class': 'Class'}
269.     node = nodes.reference(reftarget='func', **kwargs)
270.     assert domain.get_full_qualified_name(node) == 'Class.func'
271. 
272.     # with both py:module and py:class context
273.     kwargs = {'py:module': 'module1', 'py:class': 'Class'}
274.     node = nodes.reference(reftarget='func', **kwargs)
275.     assert domain.get_full_qualified_name(node) == 'module1.Class.func'
276. 
277. 
278. def test_parse_annotation(app):
279.     doctree = _parse_annotation("int", app.env)
280.     assert_node(doctree, ([pending_xref, "int"],))
281.     assert_node(doctree[0], pending_xref, refdomain="py", reftype="class", reftarget="int")
282. 
283.     doctree = _parse_annotation("List[int]", app.env)
284.     assert_node(doctree, ([pending_xref, "List"],
285.                           [desc_sig_punctuation, "["],
286.                           [pending_xref, "int"],
287.                           [desc_sig_punctuation, "]"]))
288. 
289.     doctree = _parse_annotation("Tuple[int, int]", app.env)
290.     assert_node(doctree, ([pending_xref, "Tuple"],
291.                           [desc_sig_punctuation, "["],
292.                           [pending_xref, "int"],
293.                           [desc_sig_punctuation, ", "],
294.                           [pending_xref, "int"],
295.                           [desc_sig_punctuation, "]"]))
296. 
297.     doctree = _parse_annotation("Tuple[()]", app.env)
298.     assert_node(doctree, ([pending_xref, "Tuple"],
299.                           [desc_sig_punctuation, "["],
300.                           [desc_sig_punctuation, "("],
301.                           [desc_sig_punctuation, ")"],
302.                           [desc_sig_punctuation, "]"]))
303. 
304.     doctree = _parse_annotation("Tuple[int, ...]", app.env)
305.     assert_node(doctree, ([pending_xref, "Tuple"],
306.                           [desc_sig_punctuation, "["],
307.                           [pending_xref, "int"],
308.                           [desc_sig_punctuation, ", "],
309.                           [desc_sig_punctuation, "..."],
310.                           [desc_sig_punctuation, "]"]))
311. 
312.     doctree = _parse_annotation("Callable[[int, int], int]", app.env)
313.     assert_node(doctree, ([pending_xref, "Callable"],
314.                           [desc_sig_punctuation, "["],
315.                           [desc_sig_punctuation, "["],
316.                           [pending_xref, "int"],
317.                           [desc_sig_punctuation, ", "],
318.                           [pending_xref, "int"],
319.                           [desc_sig_punctuation, "]"],
320.                           [desc_sig_punctuation, ", "],
321.                           [pending_xref, "int"],
322.                           [desc_sig_punctuation, "]"]))
323. 
324.     doctree = _parse_annotation("List[None]", app.env)
325.     assert_node(doctree, ([pending_xref, "List"],
326.                           [desc_sig_punctuation, "["],
327.                           [pending_xref, "None"],
328.                           [desc_sig_punctuation, "]"]))
329. 
330.     # None type makes an object-reference (not a class reference)
331.     doctree = _parse_annotation("None", app.env)
332.     assert_node(doctree, ([pending_xref, "None"],))
333.     assert_node(doctree[0], pending_xref, refdomain="py", reftype="obj", reftarget="None")
334. 
335. 
336. def test_pyfunction_signature(app):
337.     text = ".. py:function:: hello(name: str) -> str"
338.     doctree = restructuredtext.parse(app, text)
339.     assert_node(doctree, (addnodes.index,
340.                           [desc, ([desc_signature, ([desc_name, "hello"],
341.                                                     desc_parameterlist,
342.                                                     [desc_returns, pending_xref, "str"])],
343.                                   desc_content)]))
344.     assert_node(doctree[1], addnodes.desc, desctype="function",
345.                 domain="py", objtype="function", noindex=False)
346.     assert_node(doctree[1][0][1],
347.                 [desc_parameterlist, desc_parameter, ([desc_sig_name, "name"],
348.                                                       [desc_sig_punctuation, ":"],
349.                                                       " ",
350.                                                       [nodes.inline, pending_xref, "str"])])
351. 
352. 
353. def test_pyfunction_signature_full(app):
354.     text = (".. py:function:: hello(a: str, b = 1, *args: str, "
355.             "c: bool = True, d: tuple = (1, 2), **kwargs: str) -> str")
356.     doctree = restructuredtext.parse(app, text)
357.     assert_node(doctree, (addnodes.index,
358.                           [desc, ([desc_signature, ([desc_name, "hello"],
359.                                                     desc_parameterlist,
360.                                                     [desc_returns, pending_xref, "str"])],
361.                                   desc_content)]))
362.     assert_node(doctree[1], addnodes.desc, desctype="function",
363.                 domain="py", objtype="function", noindex=False)
364.     assert_node(doctree[1][0][1],
365.                 [desc_parameterlist, ([desc_parameter, ([desc_sig_name, "a"],
366.                                                         [desc_sig_punctuation, ":"],
367.                                                         " ",
368.                                                         [desc_sig_name, pending_xref, "str"])],
369.                                       [desc_parameter, ([desc_sig_name, "b"],
370.                                                         [desc_sig_operator, "="],
371.                                                         [nodes.inline, "1"])],
372.                                       [desc_parameter, ([desc_sig_operator, "*"],
373.                                                         [desc_sig_name, "args"],
374.                                                         [desc_sig_punctuation, ":"],
375.                                                         " ",
376.                                                         [desc_sig_name, pending_xref, "str"])],
377.                                       [desc_parameter, ([desc_sig_name, "c"],
378.                                                         [desc_sig_punctuation, ":"],
379.                                                         " ",
380.                                                         [desc_sig_name, pending_xref, "bool"],
381.                                                         " ",
382.                                                         [desc_sig_operator, "="],
383.                                                         " ",
384.                                                         [nodes.inline, "True"])],
385.                                       [desc_parameter, ([desc_sig_name, "d"],
386.                                                         [desc_sig_punctuation, ":"],
387.                                                         " ",
388.                                                         [desc_sig_name, pending_xref, "tuple"],
389.                                                         " ",
390.                                                         [desc_sig_operator, "="],
391.                                                         " ",
392.                                                         [nodes.inline, "(1, 2)"])],
393.                                       [desc_parameter, ([desc_sig_operator, "**"],
394.                                                         [desc_sig_name, "kwargs"],
395.                                                         [desc_sig_punctuation, ":"],
396.                                                         " ",
397.                                                         [desc_sig_name, pending_xref, "str"])])])
398. 
399. 
400. @pytest.mark.skipif(sys.version_info < (3, 8), reason='python 3.8+ is required.')
401. def test_pyfunction_signature_full_py38(app):
402.     # case: separator at head
403.     text = ".. py:function:: hello(*, a)"
404.     doctree = restructuredtext.parse(app, text)
405.     assert_node(doctree[1][0][1],
406.                 [desc_parameterlist, ([desc_parameter, nodes.inline, "*"],
407.                                       [desc_parameter, desc_sig_name, "a"])])
408. 
409.     # case: separator in the middle
410.     text = ".. py:function:: hello(a, /, b, *, c)"
411.     doctree = restructuredtext.parse(app, text)
412.     assert_node(doctree[1][0][1],
413.                 [desc_parameterlist, ([desc_parameter, desc_sig_name, "a"],
414.                                       [desc_parameter, desc_sig_operator, "/"],
415.                                       [desc_parameter, desc_sig_name, "b"],
416.                                       [desc_parameter, desc_sig_operator, "*"],
417.                                       [desc_parameter, desc_sig_name, "c"])])
418. 
419.     # case: separator in the middle (2)
420.     text = ".. py:function:: hello(a, /, *, b)"
421.     doctree = restructuredtext.parse(app, text)
422.     assert_node(doctree[1][0][1],
423.                 [desc_parameterlist, ([desc_parameter, desc_sig_name, "a"],
424.                                       [desc_parameter, desc_sig_operator, "/"],
425.                                       [desc_parameter, desc_sig_operator, "*"],
426.                                       [desc_parameter, desc_sig_name, "b"])])
427. 
428.     # case: separator at tail
429.     text = ".. py:function:: hello(a, /)"
430.     doctree = restructuredtext.parse(app, text)
431.     assert_node(doctree[1][0][1],
432.                 [desc_parameterlist, ([desc_parameter, desc_sig_name, "a"],
433.                                       [desc_parameter, desc_sig_operator, "/"])])
434. 
435. 
436. @pytest.mark.skipif(sys.version_info < (3, 8), reason='python 3.8+ is required.')
437. def test_pyfunction_with_number_literals(app):
438.     text = ".. py:function:: hello(age=0x10, height=1_6_0)"
439.     doctree = restructuredtext.parse(app, text)
440.     assert_node(doctree[1][0][1],
441.                 [desc_parameterlist, ([desc_parameter, ([desc_sig_name, "age"],
442.                                                         [desc_sig_operator, "="],
443.                                                         [nodes.inline, "0x10"])],
444.                                       [desc_parameter, ([desc_sig_name, "height"],
445.                                                         [desc_sig_operator, "="],
446.                                                         [nodes.inline, "1_6_0"])])])
447. 
448. 
449. def test_pyfunction_with_union_type_operator(app):
450.     text = ".. py:function:: hello(age: int | None)"
451.     doctree = restructuredtext.parse(app, text)
452.     assert_node(doctree[1][0][1],
453.                 [desc_parameterlist, ([desc_parameter, ([desc_sig_name, "age"],
454.                                                         [desc_sig_punctuation, ":"],
455.                                                         " ",
456.                                                         [desc_sig_name, ([pending_xref, "int"],
457.                                                                          " ",
458.                                                                          [desc_sig_punctuation, "|"],
459.                                                                          " ",
460.                                                                          [pending_xref, "None"])])])])
461. 
462. 
463. def test_optional_pyfunction_signature(app):
464.     text = ".. py:function:: compile(source [, filename [, symbol]]) -> ast object"
465.     doctree = restructuredtext.parse(app, text)
466.     assert_node(doctree, (addnodes.index,
467.                           [desc, ([desc_signature, ([desc_name, "compile"],
468.                                                     desc_parameterlist,
469.                                                     [desc_returns, pending_xref, "ast object"])],
470.                                   desc_content)]))
471.     assert_node(doctree[1], addnodes.desc, desctype="function",
472.                 domain="py", objtype="function", noindex=False)
473.     assert_node(doctree[1][0][1],
474.                 ([desc_parameter, "source"],
475.                  [desc_optional, ([desc_parameter, "filename"],
476.                                   [desc_optional, desc_parameter, "symbol"])]))
477. 
478. 
479. def test_pyexception_signature(app):
480.     text = ".. py:exception:: exceptions.IOError"
481.     doctree = restructuredtext.parse(app, text)
482.     assert_node(doctree, (addnodes.index,
483.                           [desc, ([desc_signature, ([desc_annotation, "exception "],
484.                                                     [desc_addname, "exceptions."],
485.                                                     [desc_name, "IOError"])],
486.                                   desc_content)]))
487.     assert_node(doctree[1], desc, desctype="exception",
488.                 domain="py", objtype="exception", noindex=False)
489. 
490. 
491. def test_exceptions_module_is_ignored(app):
492.     text = (".. py:exception:: IOError\n"
493.             "   :module: exceptions\n")
494.     doctree = restructuredtext.parse(app, text)
495.     assert_node(doctree, (addnodes.index,
496.                           [desc, ([desc_signature, ([desc_annotation, "exception "],
497.                                                     [desc_name, "IOError"])],
498.                                   desc_content)]))
499.     assert_node(doctree[1], desc, desctype="exception",
500.                 domain="py", objtype="exception", noindex=False)


File: tests/test_ext_autodoc.py
Line number range: 1 - 500
Content:
1. """
2.     test_ext_autodoc
3.     ~~~~~~~~~~~~~~~~
4. 
5.     Test the autodoc extension.  This tests mainly the Documenters; the auto
6.     directives are tested in a test source file translated by test_build.
7. 
8.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
9.     :license: BSD, see LICENSE for details.
10. """
11. 
12. import sys
13. from unittest.mock import Mock
14. from warnings import catch_warnings
15. 
16. import pytest
17. from docutils.statemachine import ViewList
18. 
19. from sphinx import addnodes
20. from sphinx.ext.autodoc import ALL, ModuleLevelDocumenter, Options
21. from sphinx.ext.autodoc.directive import DocumenterBridge, process_documenter_options
22. from sphinx.testing.util import SphinxTestApp, Struct  # NOQA
23. from sphinx.util.docutils import LoggingReporter
24. 
25. try:
26.     # Enable pyximport to test cython module
27.     import pyximport
28.     pyximport.install()
29. except ImportError:
30.     pyximport = None
31. 
32. 
33. def do_autodoc(app, objtype, name, options=None):
34.     if options is None:
35.         options = {}
36.     app.env.temp_data.setdefault('docname', 'index')  # set dummy docname
37.     doccls = app.registry.documenters[objtype]
38.     docoptions = process_documenter_options(doccls, app.config, options)
39.     state = Mock()
40.     state.document.settings.tab_width = 8
41.     bridge = DocumenterBridge(app.env, LoggingReporter(''), docoptions, 1, state)
42.     documenter = doccls(bridge, name)
43.     documenter.generate()
44. 
45.     return bridge.result
46. 
47. 
48. def make_directive_bridge(env):
49.     options = Options(
50.         inherited_members = False,
51.         undoc_members = False,
52.         private_members = False,
53.         special_members = False,
54.         imported_members = False,
55.         show_inheritance = False,
56.         noindex = False,
57.         annotation = None,
58.         synopsis = '',
59.         platform = '',
60.         deprecated = False,
61.         members = [],
62.         member_order = 'alphabetical',
63.         exclude_members = set(),
64.         ignore_module_all = False,
65.     )
66. 
67.     directive = Struct(
68.         env = env,
69.         genopt = options,
70.         result = ViewList(),
71.         record_dependencies = set(),
72.         state = Mock(),
73.     )
74.     directive.state.document.settings.tab_width = 8
75. 
76.     return directive
77. 
78. 
79. processed_signatures = []
80. 
81. 
82. def process_signature(app, what, name, obj, options, args, retann):
83.     processed_signatures.append((what, name))
84.     if name == 'bar':
85.         return '42', None
86. 
87. 
88. def skip_member(app, what, name, obj, skip, options):
89.     if name in ('__special1__', '__special2__'):
90.         return skip
91.     if name.startswith('__'):
92.         return True
93.     if name == 'skipmeth':
94.         return True
95. 
96. 
97. def test_parse_name(app):
98.     def verify(objtype, name, result):
99.         inst = app.registry.documenters[objtype](directive, name)
100.         assert inst.parse_name()
101.         assert (inst.modname, inst.objpath, inst.args, inst.retann) == result
102. 
103.     directive = make_directive_bridge(app.env)
104. 
105.     # for modules
106.     verify('module', 'test_ext_autodoc', ('test_ext_autodoc', [], None, None))
107.     verify('module', 'test.test_ext_autodoc', ('test.test_ext_autodoc', [], None, None))
108.     verify('module', 'test(arg)', ('test', [], 'arg', None))
109.     assert 'signature arguments' in app._warning.getvalue()
110. 
111.     # for functions/classes
112.     verify('function', 'test_ext_autodoc.raises',
113.            ('test_ext_autodoc', ['raises'], None, None))
114.     verify('function', 'test_ext_autodoc.raises(exc) -> None',
115.            ('test_ext_autodoc', ['raises'], 'exc', 'None'))
116.     directive.env.temp_data['autodoc:module'] = 'test_ext_autodoc'
117.     verify('function', 'raises', ('test_ext_autodoc', ['raises'], None, None))
118.     del directive.env.temp_data['autodoc:module']
119.     directive.env.ref_context['py:module'] = 'test_ext_autodoc'
120.     verify('function', 'raises', ('test_ext_autodoc', ['raises'], None, None))
121.     verify('class', 'Base', ('test_ext_autodoc', ['Base'], None, None))
122. 
123.     # for members
124.     directive.env.ref_context['py:module'] = 'sphinx.testing.util'
125.     verify('method', 'SphinxTestApp.cleanup',
126.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
127.     directive.env.ref_context['py:module'] = 'sphinx.testing.util'
128.     directive.env.ref_context['py:class'] = 'Foo'
129.     directive.env.temp_data['autodoc:class'] = 'SphinxTestApp'
130.     verify('method', 'cleanup',
131.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
132.     verify('method', 'SphinxTestApp.cleanup',
133.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
134. 
135. 
136. def test_format_signature(app):
137.     app.connect('autodoc-process-signature', process_signature)
138.     app.connect('autodoc-skip-member', skip_member)
139. 
140.     directive = make_directive_bridge(app.env)
141. 
142.     def formatsig(objtype, name, obj, args, retann):
143.         inst = app.registry.documenters[objtype](directive, name)
144.         inst.fullname = name
145.         inst.doc_as_attr = False  # for class objtype
146.         inst.parent = object  # dummy
147.         inst.object = obj
148.         inst.objpath = [name]
149.         inst.args = args
150.         inst.retann = retann
151.         res = inst.format_signature()
152.         print(res)
153.         return res
154. 
155.     # no signatures for modules
156.     assert formatsig('module', 'test', None, None, None) == ''
157. 
158.     # test for functions
159.     def f(a, b, c=1, **d):
160.         pass
161. 
162.     def g(a='\n'):
163.         pass
164.     assert formatsig('function', 'f', f, None, None) == '(a, b, c=1, **d)'
165.     assert formatsig('function', 'f', f, 'a, b, c, d', None) == '(a, b, c, d)'
166.     assert formatsig('function', 'g', g, None, None) == r"(a='\n')"
167. 
168.     # test for classes
169.     class D:
170.         pass
171. 
172.     class E:
173.         def __init__(self):
174.             pass
175. 
176.     # an empty init and no init are the same
177.     for C in (D, E):
178.         assert formatsig('class', 'D', C, None, None) == '()'
179. 
180.     class SomeMeta(type):
181.         def __call__(cls, a, b=None):
182.             return type.__call__(cls, a, b)
183. 
184.     # these three are all equivalent
185.     class F:
186.         def __init__(self, a, b=None):
187.             pass
188. 
189.     class FNew:
190.         def __new__(cls, a, b=None):
191.             return super().__new__(cls)
192. 
193.     class FMeta(metaclass=SomeMeta):
194.         pass
195. 
196.     # and subclasses should always inherit
197.     class G(F):
198.         pass
199. 
200.     class GNew(FNew):
201.         pass
202. 
203.     class GMeta(FMeta):
204.         pass
205. 
206.     # subclasses inherit
207.     for C in (F, FNew, FMeta, G, GNew, GMeta):
208.         assert formatsig('class', 'C', C, None, None) == '(a, b=None)'
209.     assert formatsig('class', 'C', D, 'a, b', 'X') == '(a, b) -> X'
210. 
211.     class ListSubclass(list):
212.         pass
213. 
214.     # only supported if the python implementation decides to document it
215.     if getattr(list, '__text_signature__', None) is not None:
216.         assert formatsig('class', 'C', ListSubclass, None, None) == '(iterable=(), /)'
217.     else:
218.         assert formatsig('class', 'C', ListSubclass, None, None) == ''
219. 
220.     class ExceptionSubclass(Exception):
221.         pass
222. 
223.     # Exception has no __text_signature__ at least in Python 3.8
224.     if getattr(Exception, '__text_signature__', None) is None:
225.         assert formatsig('class', 'C', ExceptionSubclass, None, None) == ''
226. 
227.     # __init__ have signature at first line of docstring
228.     directive.env.config.autoclass_content = 'both'
229. 
230.     class F2:
231.         '''some docstring for F2.'''
232.         def __init__(self, *args, **kw):
233.             '''
234.             __init__(a1, a2, kw1=True, kw2=False)
235. 
236.             some docstring for __init__.
237.             '''
238.     class G2(F2):
239.         pass
240. 
241.     assert formatsig('class', 'F2', F2, None, None) == \
242.         '(a1, a2, kw1=True, kw2=False)'
243.     assert formatsig('class', 'G2', G2, None, None) == \
244.         '(a1, a2, kw1=True, kw2=False)'
245. 
246.     # test for methods
247.     class H:
248.         def foo1(self, b, *c):
249.             pass
250. 
251.         def foo2(b, *c):
252.             pass
253. 
254.         def foo3(self, d='\n'):
255.             pass
256.     assert formatsig('method', 'H.foo', H.foo1, None, None) == '(b, *c)'
257.     assert formatsig('method', 'H.foo', H.foo1, 'a', None) == '(a)'
258.     assert formatsig('method', 'H.foo', H.foo2, None, None) == '(*c)'
259.     assert formatsig('method', 'H.foo', H.foo3, None, None) == r"(d='\n')"
260. 
261.     # test bound methods interpreted as functions
262.     assert formatsig('function', 'foo', H().foo1, None, None) == '(b, *c)'
263.     assert formatsig('function', 'foo', H().foo2, None, None) == '(*c)'
264.     assert formatsig('function', 'foo', H().foo3, None, None) == r"(d='\n')"
265. 
266.     # test exception handling (exception is caught and args is '')
267.     directive.env.config.autodoc_docstring_signature = False
268.     assert formatsig('function', 'int', int, None, None) == ''
269. 
270.     # test processing by event handler
271.     assert formatsig('method', 'bar', H.foo1, None, None) == '42'
272. 
273.     # test functions created via functools.partial
274.     from functools import partial
275.     curried1 = partial(lambda a, b, c: None, 'A')
276.     assert formatsig('function', 'curried1', curried1, None, None) == \
277.         '(b, c)'
278.     curried2 = partial(lambda a, b, c=42: None, 'A')
279.     assert formatsig('function', 'curried2', curried2, None, None) == \
280.         '(b, c=42)'
281.     curried3 = partial(lambda a, b, *c: None, 'A')
282.     assert formatsig('function', 'curried3', curried3, None, None) == \
283.         '(b, *c)'
284.     curried4 = partial(lambda a, b, c=42, *d, **e: None, 'A')
285.     assert formatsig('function', 'curried4', curried4, None, None) == \
286.         '(b, c=42, *d, **e)'
287. 
288. 
289. @pytest.mark.sphinx('html', testroot='ext-autodoc')
290. def test_autodoc_process_signature_typing_generic(app):
291.     actual = do_autodoc(app, 'class', 'target.generic_class.A', {})
292. 
293.     assert list(actual) == [
294.         '',
295.         '.. py:class:: A(a, b=None)',
296.         '   :module: target.generic_class',
297.         '',
298.         '   docstring for A',
299.         '',
300.     ]
301. 
302. 
303. def test_autodoc_process_signature_typehints(app):
304.     captured = []
305. 
306.     def process_signature(*args):
307.         captured.append(args)
308. 
309.     app.connect('autodoc-process-signature', process_signature)
310. 
311.     def func(x: int, y: int) -> int:
312.         pass
313. 
314.     directive = make_directive_bridge(app.env)
315.     inst = app.registry.documenters['function'](directive, 'func')
316.     inst.fullname = 'func'
317.     inst.object = func
318.     inst.objpath = ['func']
319.     inst.format_signature()
320.     assert captured == [(app, 'function', 'func', func,
321.                          directive.genopt, '(x: int, y: int)', 'int')]
322. 
323. 
324. def test_get_doc(app):
325.     directive = make_directive_bridge(app.env)
326. 
327.     def getdocl(objtype, obj):
328.         inst = app.registry.documenters[objtype](directive, 'tmp')
329.         inst.parent = object  # dummy
330.         inst.object = obj
331.         inst.objpath = [obj.__name__]
332.         inst.doc_as_attr = False
333.         inst.format_signature()  # handle docstring signatures!
334.         ds = inst.get_doc()
335.         # for testing purposes, concat them and strip the empty line at the end
336.         res = sum(ds, [])[:-1]
337.         print(res)
338.         return res
339. 
340.     # objects without docstring
341.     def f():
342.         pass
343.     assert getdocl('function', f) == []
344. 
345.     # standard function, diverse docstring styles...
346.     def f():
347.         """Docstring"""
348.     def g():
349.         """
350.         Docstring
351.         """
352.     for func in (f, g):
353.         assert getdocl('function', func) == ['Docstring']
354. 
355.     # first line vs. other lines indentation
356.     def f():
357.         """First line
358. 
359.         Other
360.           lines
361.         """
362.     assert getdocl('function', f) == ['First line', '', 'Other', '  lines']
363. 
364.     # charset guessing (this module is encoded in utf-8)
365.     def f():
366.         """Döcstring"""
367.     assert getdocl('function', f) == ['Döcstring']
368. 
369.     # verify that method docstrings get extracted in both normal case
370.     # and in case of bound method posing as a function
371.     class J:  # NOQA
372.         def foo(self):
373.             """Method docstring"""
374.     assert getdocl('method', J.foo) == ['Method docstring']
375.     assert getdocl('function', J().foo) == ['Method docstring']
376. 
377. 
378. @pytest.mark.sphinx('html', testroot='ext-autodoc')
379. def test_new_documenter(app):
380.     class MyDocumenter(ModuleLevelDocumenter):
381.         objtype = 'integer'
382.         directivetype = 'integer'
383.         priority = 100
384. 
385.         @classmethod
386.         def can_document_member(cls, member, membername, isattr, parent):
387.             return isinstance(member, int)
388. 
389.         def document_members(self, all_members=False):
390.             return
391. 
392.     app.add_autodocumenter(MyDocumenter)
393. 
394.     options = {"members": 'integer'}
395.     actual = do_autodoc(app, 'module', 'target', options)
396.     assert list(actual) == [
397.         '',
398.         '.. py:module:: target',
399.         '',
400.         '',
401.         '.. py:integer:: integer',
402.         '   :module: target',
403.         '',
404.         '   documentation for the integer',
405.         '',
406.     ]
407. 
408. 
409. def test_attrgetter_using(app):
410.     from target import Class
411.     from target.inheritance import Derived
412. 
413.     directive = make_directive_bridge(app.env)
414. 
415.     def assert_getter_works(objtype, name, obj, attrs=[], **kw):
416.         getattr_spy = []
417. 
418.         def special_getattr(obj, name, *defargs):
419.             if name in attrs:
420.                 getattr_spy.append((obj, name))
421.                 return None
422.             return getattr(obj, name, *defargs)
423.         app.add_autodoc_attrgetter(type, special_getattr)
424. 
425.         del getattr_spy[:]
426.         inst = app.registry.documenters[objtype](directive, name)
427.         inst.generate(**kw)
428. 
429.         hooked_members = [s[1] for s in getattr_spy]
430.         documented_members = [s[1] for s in processed_signatures]
431.         for attr in attrs:
432.             fullname = '.'.join((name, attr))
433.             assert attr in hooked_members
434.             assert fullname not in documented_members, \
435.                 '%r was not hooked by special_attrgetter function' % fullname
436. 
437.     with catch_warnings(record=True):
438.         directive.genopt['members'] = ALL
439.         directive.genopt['inherited_members'] = False
440.         print(directive.genopt)
441.         assert_getter_works('class', 'target.Class', Class, ['meth'])
442. 
443.         directive.genopt['inherited_members'] = True
444.         assert_getter_works('class', 'target.inheritance.Derived', Derived, ['inheritedmeth'])
445. 
446. 
447. @pytest.mark.sphinx('html', testroot='ext-autodoc')
448. def test_py_module(app, warning):
449.     # without py:module
450.     actual = do_autodoc(app, 'method', 'Class.meth')
451.     assert list(actual) == []
452.     assert ("don't know which module to import for autodocumenting 'Class.meth'"
453.             in warning.getvalue())
454. 
455.     # with py:module
456.     app.env.ref_context['py:module'] = 'target'
457.     warning.truncate(0)
458. 
459.     actual = do_autodoc(app, 'method', 'Class.meth')
460.     assert list(actual) == [
461.         '',
462.         '.. py:method:: Class.meth()',
463.         '   :module: target',
464.         '',
465.         '   Function.',
466.         '',
467.     ]
468.     assert ("don't know which module to import for autodocumenting 'Class.meth'"
469.             not in warning.getvalue())
470. 
471. 
472. @pytest.mark.sphinx('html', testroot='ext-autodoc')
473. def test_autodoc_decorator(app):
474.     actual = do_autodoc(app, 'decorator', 'target.decorator.deco1')
475.     assert list(actual) == [
476.         '',
477.         '.. py:decorator:: deco1',
478.         '   :module: target.decorator',
479.         '',
480.         '   docstring for deco1',
481.         '',
482.     ]
483. 
484.     actual = do_autodoc(app, 'decorator', 'target.decorator.deco2')
485.     assert list(actual) == [
486.         '',
487.         '.. py:decorator:: deco2(condition, message)',
488.         '   :module: target.decorator',
489.         '',
490.         '   docstring for deco2',
491.         '',
492.     ]
493. 
494. 
495. @pytest.mark.sphinx('html', testroot='ext-autodoc')
496. def test_autodoc_exception(app):
497.     actual = do_autodoc(app, 'exception', 'target.CustomEx')
498.     assert list(actual) == [
499.         '',
500.         '.. py:exception:: CustomEx',

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-21 02:24:23,266 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='The user has requested the full content of the file `tests/test_domain_py.py`. This context block includes the entire content of the file as provided.', relative_path='tests/test_domain_py.py', start_line=1, end_line=500), ContextOutput(reasoning='The user has requested the full content of the file `tests/test_ext_autodoc.py`. This context block includes the entire content of the file as provided.', relative_path='tests/test_ext_autodoc.py', start_line=1, end_line=500)]
2025-12-21 02:24:23,269 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 2 contexts to memory for query: Please provide the full content of `tests/test_util_docfields.py`, `tests/test_domain_py.py`, and `tests/test_ext_autodoc.py`.
2025-12-21 02:24:23,269 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-21 02:24:23,269 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-21 02:24:23,269 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 2 new contexts to 0 existing contexts
2025-12-21 02:24:23,269 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 2 total contexts (removed 0 duplicates)
2025-12-21 02:24:23,270 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sphinx
├── .circleci
|   └── config.yml
├── .codecov.yml
├── .github
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.md
|   |   ├── config.yml
|   |   └── feature_request.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   └── workflows
|       ├── builddoc.yml
|       ├── lint.yml
|       ├── main.yml
|       ├── nodejs.yml
|       └── transifex.yml
├── .readthedocs.yml
├── CONTRIBUTING.rst
├── README.rst
├── bindep.txt
├── doc
|   ├── _static
|   |   ├── conf.py.txt
|   |   └── themes
|   |       └── fullsize
|   ├── _templates
|   |   ├── index.html
|   |   └── indexsidebar.html
|   ├── _themes
|   |   └── sphinx13
|   |       ├── layout.html
|   |       └── static
|   |           └── sphinx13.css
|   ├── changes.rst
|   ├── conf.py
|   ├── contents.rst
|   ├── development
|   |   ├── builders.rst
|   |   ├── index.rst
|   |   ├── overview.rst
|   |   ├── theming.rst
|   |   └── tutorials
|   |       ├── autodoc_ext.rst
|   |       ├── examples
|   |       |   ├── README.rst
|   |       |   ├── autodoc_intenum.py
|   |       |   ├── helloworld.py
|   |       |   ├── recipe.py
|   |       |   └── todo.py
|   |       ├── helloworld.rst
|   |       ├── index.rst
|   |       ├── recipe.rst
|   |       └── todo.rst
|   ├── examples.rst
|   ├── extdev
|   |   ├── appapi.rst
|   |   ├── builderapi.rst
|   |   ├── collectorapi.rst
|   |   ├── deprecated.rst
|   |   ├── domainapi.rst
|   |   ├── envapi.rst
|   |   ├── i18n.rst
|   |   ├── index.rst
|   |   ├── logging.rst
|   |   ├── markupapi.rst
|   |   ├── nodes.rst
|   |   ├── parserapi.rst
|   |   ├── projectapi.rst
|   |   └── utils.rst
|   ├── faq.rst
|   ├── glossary.rst
|   ├── internals
|   |   ├── authors.rst
|   |   ├── code-of-conduct.rst
|   |   ├── contributing.rst
|   |   ├── index.rst
|   |   ├── organization.rst
|   |   └── release-process.rst
|   ├── latex.rst
|   ├── man
|   |   ├── index.rst
|   |   ├── sphinx-apidoc.rst
|   |   ├── sphinx-autogen.rst
|   |   ├── sphinx-build.rst
|   |   └── sphinx-quickstart.rst
|   ├── templating.rst
|   └── usage
|       ├── advanced
|       |   ├── intl.rst
|       |   ├── setuptools.rst
|       |   └── websupport
|       |       ├── api.rst
|       |       ├── index.rst
|       |       ├── quickstart.rst
|       |       ├── searchadapters.rst
|       |       └── storagebackends.rst
|       ├── builders
|       |   └── index.rst
|       ├── configuration.rst
|       ├── extensions
|       |   ├── autodoc.rst
|       |   ├── autosectionlabel.rst
|       |   ├── autosummary.rst
|       |   ├── coverage.rst
|       |   ├── doctest.rst
|       |   ├── duration.rst
|       |   ├── example_google.py
|       |   ├── example_google.rst
|       |   ├── example_numpy.py
|       |   ├── example_numpy.rst
|       |   ├── extlinks.rst
|       |   ├── githubpages.rst
|       |   ├── graphviz.rst
|       |   ├── ifconfig.rst
|       |   ├── imgconverter.rst
|       |   ├── index.rst
|       |   ├── inheritance.rst
|       |   ├── intersphinx.rst
|       |   ├── linkcode.rst
|       |   ├── math.rst
|       |   ├── napoleon.rst
|       |   ├── todo.rst
|       |   └── viewcode.rst
|       ├── index.rst
|       ├── installation.rst
|       ├── markdown.rst
|       ├── quickstart.rst
|       ├── restructuredtext
|       |   ├── basics.rst
|       |   ├── directives.rst
|       |   ├── domains.rst
|       |   ├── field-lists.rst
|       |   ├── index.rst
|       |   └── roles.rst
|       └── theming.rst
├── karma.conf.js
├── setup.py
├── sphinx
|   ├── __init__.py
|   ├── __main__.py
|   ├── addnodes.py
|   ├── application.py
|   ├── builders
|   |   ├── __init__.py
|   |   ├── _epub_base.py
|   |   ├── changes.py
|   |   ├── dirhtml.py
|   |   ├── dummy.py
|   |   ├── epub3.py
|   |   ├── gettext.py
|   |   ├── html
|   |   |   ├── __init__.py
|   |   |   └── transforms.py
|   |   ├── latex
|   |   |   ├── __init__.py
|   |   |   ├── constants.py
|   |   |   ├── nodes.py
|   |   |   ├── theming.py
|   |   |   ├── transforms.py
|   |   |   └── util.py
|   |   ├── linkcheck.py
|   |   ├── manpage.py
|   |   ├── singlehtml.py
|   |   ├── texinfo.py
|   |   ├── text.py
|   |   └── xml.py
|   ├── cmd
|   |   ├── __init__.py
|   |   ├── build.py
|   |   ├── make_mode.py
|   |   └── quickstart.py
|   ├── config.py
|   ├── deprecation.py
|   ├── directives
|   |   ├── __init__.py
|   |   ├── code.py
|   |   ├── other.py
|   |   └── patches.py
|   ├── domains
|   |   ├── __init__.py
|   |   ├── c.py
|   |   ├── changeset.py
|   |   ├── citation.py
|   |   ├── cpp.py
|   |   ├── index.py
|   |   ├── javascript.py
|   |   ├── math.py
|   |   ├── python.py
|   |   ├── rst.py
|   |   └── std.py
|   ├── environment
|   |   ├── __init__.py
|   |   ├── adapters
|   |   |   ├── __init__.py
|   |   |   ├── asset.py
|   |   |   ├── indexentries.py
|   |   |   └── toctree.py
|   |   └── collectors
|   |       ├── __init__.py
|   |       ├── asset.py
|   |       ├── dependencies.py
|   |       ├── metadata.py
|   |       ├── title.py
|   |       └── toctree.py
|   ├── errors.py
|   ├── events.py
|   ├── ext
|   |   ├── __init__.py
|   |   ├── apidoc.py
|   |   ├── autodoc
|   |   |   ├── __init__.py
|   |   |   ├── deprecated.py
|   |   |   ├── directive.py
|   |   |   ├── importer.py
|   |   |   ├── mock.py
|   |   |   ├── preserve_defaults.py
|   |   |   ├── type_comment.py
|   |   |   └── typehints.py
|   |   ├── autosectionlabel.py
|   |   ├── autosummary
|   |   |   ├── __init__.py
|   |   |   ├── generate.py
|   |   |   └── templates
|   |   |       └── autosummary
|   |   ├── coverage.py
|   |   ├── doctest.py
|   |   ├── duration.py
|   |   ├── extlinks.py
|   |   ├── githubpages.py
|   |   ├── graphviz.py
|   |   ├── ifconfig.py
|   |   ├── imgconverter.py
|   |   ├── imgmath.py
|   |   ├── inheritance_diagram.py
|   |   ├── intersphinx.py
|   |   ├── linkcode.py
|   |   ├── mathjax.py
|   |   ├── napoleon
|   |   |   ├── __init__.py
|   |   |   ├── docstring.py
|   |   |   └── iterators.py
|   |   ├── todo.py
|   |   └── viewcode.py
|   ├── extension.py
|   ├── highlighting.py
|   ├── io.py
|   ├── jinja2glue.py
|   ├── locale
|   |   ├── __init__.py
|   |   ├── ar
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bg
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bn
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ca
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cak
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cs
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cy
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── da
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── de
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── el
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eo
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── es
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── et
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fa
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── he
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi_IN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── id
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── it
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ja
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ko
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── mk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nb_NO
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ne
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_BR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_PT
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ro
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ru
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── si
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sq
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr@latin
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr_RS
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ta
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── te
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── tr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── uk_UA
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ur
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── vi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_CN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   └── zh_TW
|   |       └── LC_MESSAGES
|   |           └── sphinx.js
|   ├── parsers.py
|   ├── project.py
|   ├── pycode
|   |   ├── __init__.py
|   |   ├── ast.py
|   |   └── parser.py
|   ├── pygments_styles.py
|   ├── registry.py
|   ├── roles.py
|   ├── search
|   |   ├── __init__.py
|   |   ├── da.py
|   |   ├── de.py
|   |   ├── en.py
|   |   ├── es.py
|   |   ├── fi.py
|   |   ├── fr.py
|   |   ├── hu.py
|   |   ├── it.py
|   |   ├── ja.py
|   |   ├── jssplitter.py
|   |   ├── minified-js
|   |   |   ├── base-stemmer.js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── nl.py
|   |   ├── no.py
|   |   ├── non-minified-js
|   |   |   ├── base-stemmer.js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── pt.py
|   |   ├── ro.py
|   |   ├── ru.py
|   |   ├── sv.py
|   |   ├── tr.py
|   |   └── zh.py
|   ├── setup_command.py
|   ├── templates
|   |   ├── apidoc
|   |   ├── epub3
|   |   |   └── container.xml
|   |   ├── gettext
|   |   ├── graphviz
|   |   |   └── graphviz.css
|   |   ├── htmlhelp
|   |   ├── imgmath
|   |   ├── latex
|   |   ├── quickstart
|   |   └── texinfo
|   ├── testing
|   |   ├── __init__.py
|   |   ├── comparer.py
|   |   ├── fixtures.py
|   |   ├── path.py
|   |   ├── restructuredtext.py
|   |   └── util.py
|   ├── texinputs
|   ├── texinputs_win
|   ├── themes
|   |   ├── agogo
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── basic
|   |   |   ├── changes
|   |   |   |   ├── frameset.html
|   |   |   |   ├── rstsource.html
|   |   |   |   └── versionchanges.html
|   |   |   ├── defindex.html
|   |   |   ├── domainindex.html
|   |   |   ├── genindex-single.html
|   |   |   ├── genindex-split.html
|   |   |   ├── genindex.html
|   |   |   ├── globaltoc.html
|   |   |   ├── layout.html
|   |   |   ├── localtoc.html
|   |   |   ├── opensearch.xml
|   |   |   ├── page.html
|   |   |   ├── relations.html
|   |   |   ├── search.html
|   |   |   ├── searchbox.html
|   |   |   ├── sourcelink.html
|   |   |   └── static
|   |   |       ├── doctools.js
|   |   |       ├── jquery-3.5.1.js
|   |   |       ├── jquery.js
|   |   |       ├── searchtools.js
|   |   |       ├── underscore-1.13.1.js
|   |   |       └── underscore.js
|   |   ├── bizstyle
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── css3-mediaqueries.js
|   |   |       └── css3-mediaqueries_src.js
|   |   ├── classic
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── default
|   |   |   └── static
|   |   |       └── default.css
|   |   ├── epub
|   |   |   ├── epub-cover.html
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── haiku
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── nature
|   |   |   └── static
|   |   ├── nonav
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       └── nonav.css
|   |   ├── pyramid
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── epub.css
|   |   |       └── ie6.css
|   |   ├── scrolls
|   |   |   ├── artwork
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── print.css
|   |   |       └── theme_extras.js
|   |   ├── sphinxdoc
|   |   |   └── static
|   |   └── traditional
|   |       └── static
|   ├── theming.py
|   ├── transforms
|   |   ├── __init__.py
|   |   ├── compact_bullet_list.py
|   |   ├── i18n.py
|   |   ├── post_transforms
|   |   |   ├── __init__.py
|   |   |   ├── code.py
|   |   |   └── images.py
|   |   └── references.py
|   ├── util
|   |   ├── __init__.py
|   |   ├── build_phase.py
|   |   ├── cfamily.py
|   |   ├── compat.py
|   |   ├── console.py
|   |   ├── docfields.py
|   |   ├── docstrings.py
|   |   ├── docutils.py
|   |   ├── fileutil.py
|   |   ├── i18n.py
|   |   ├── images.py
|   |   ├── inspect.py
|   |   ├── inventory.py
|   |   ├── jsdump.py
|   |   ├── logging.py
|   |   ├── matching.py
|   |   ├── math.py
|   |   ├── nodes.py
|   |   ├── osutil.py
|   |   ├── parallel.py
|   |   ├── png.py
|   |   ├── pycompat.py
|   |   ├── requests.py
|   |   ├── rst.py
|   |   ├── smartypants.py
|   |   ├── stemmer
|   |   |   ├── __init__.py
|   |   |   └── porter.py
|   |   ├── tags.py
|   |   ├── template.py
|   |   ├── texescape.py
|   |   └── typing.py
|   ├── versioning.py
|   └── writers
|       ├── __init__.py
|       ├── html.py
|       ├── html5.py
|       ├── latex.py
|       ├── manpage.py
|       ├── texinfo.py
|       ├── text.py
|       └── xml.py
├── tests
|   ├── __init__.py
|   ├── certs
|   ├── conftest.py
|   ├── ext_napoleon_pep526_data_google.py
|   ├── ext_napoleon_pep526_data_numpy.py
|   ├── js
|   |   ├── doctools.js
|   |   └── searchtools.js
|   ├── roots
|   |   ├── test-add_enumerable_node
|   |   |   ├── conf.py
|   |   |   ├── enumerable_node.py
|   |   |   └── index.rst
|   |   ├── test-add_source_parser
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-add_source_parser-conflicts-with-users-setting
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-api-set-translator
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nonext
|   |   |   |   └── conf.py
|   |   |   └── translator.py
|   |   ├── test-apidoc-pep420
|   |   |   └── a
|   |   |       └── b
|   |   ├── test-apidoc-subpackage-in-toc
|   |   |   └── parent
|   |   |       ├── __init__.py
|   |   |       └── child
|   |   ├── test-apidoc-toc
|   |   |   └── mypackage
|   |   |       ├── __init__.py
|   |   |       ├── main.py
|   |   |       ├── no_init
|   |   |       ├── resource
|   |   |       └── something
|   |   ├── test-apidoc-trailing-underscore
|   |   |   └── package_
|   |   |       ├── __init__.py
|   |   |       └── module_.py
|   |   ├── test-autosummary
|   |   |   ├── conf.py
|   |   |   ├── dummy_module.py
|   |   |   ├── index.rst
|   |   |   ├── sphinx.rst
|   |   |   └── underscore_module_.py
|   |   ├── test-basic
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-html-translator
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-text
|   |   |   ├── conf.py
|   |   |   ├── doc1.txt
|   |   |   ├── doc2.txt
|   |   |   ├── index.txt
|   |   |   ├── lineblock.txt
|   |   |   ├── listitems.txt
|   |   |   ├── maxwidth.txt
|   |   |   ├── nonascii_maxwidth.txt
|   |   |   ├── nonascii_table.txt
|   |   |   ├── nonascii_title.txt
|   |   |   ├── table.txt
|   |   |   ├── table_colspan.txt
|   |   |   ├── table_colspan_and_rowspan.txt
|   |   |   ├── table_colspan_left.txt
|   |   |   └── table_rowspan.txt
|   |   ├── test-builder-dirhtml
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo
|   |   |   |   ├── foo_1.rst
|   |   |   |   ├── foo_2.rst
|   |   |   |   └── index.rst
|   |   |   └── index.rst
|   |   ├── test-builder-gettext-dont-rebuild-mo
|   |   |   ├── bom.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-changes
|   |   |   ├── base.rst
|   |   |   ├── c-api.rst
|   |   |   ├── conf.py
|   |   |   ├── contents.rst
|   |   |   └── library
|   |   |       └── utils.rst
|   |   ├── test-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-config
|   |   |   └── conf.py
|   |   ├── test-correct-year
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-default_role
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-directive-code
|   |   |   ├── caption.rst
|   |   |   ├── classes.rst
|   |   |   ├── conf.py
|   |   |   ├── emphasize.rst
|   |   |   ├── force.rst
|   |   |   ├── highlight.rst
|   |   |   ├── index.rst
|   |   |   ├── linenos.rst
|   |   |   ├── linenothreshold.rst
|   |   |   ├── namedblocks.rst
|   |   |   ├── py-decorators.rst
|   |   |   ├── python.rst
|   |   |   └── target.py
|   |   ├── test-directive-csv-table
|   |   |   ├── conf.py
|   |   |   └── subdir
|   |   ├── test-directive-only
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── only.rst
|   |   ├── test-directives-raw
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-docutilsconf
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-c
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── conf.py
|   |   |   ├── function_param_target.rst
|   |   |   ├── index.rst
|   |   |   ├── namespace.rst
|   |   |   └── ns_lookup.rst
|   |   ├── test-domain-c-intersphinx
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-cpp
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── any-role.rst
|   |   |   ├── backslash.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── lookup-key-overload.rst
|   |   |   ├── multi-decl-lookup.rst
|   |   |   ├── roles-targets-ok.rst
|   |   |   ├── roles-targets-warn.rst
|   |   |   ├── roles.rst
|   |   |   ├── roles2.rst
|   |   |   ├── semicolon.rst
|   |   |   ├── warn-template-param-qualified-name.rst
|   |   |   └── xref_consistency.rst
|   |   ├── test-domain-cpp-intersphinx
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-js
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py
|   |   |   ├── abbr.rst
|   |   |   ├── canonical.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   ├── module_option.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py-python_use_unqualified_type_names
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-py-xref-warning
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-double-inheriting-theme
|   |   |   ├── base_themes_dir
|   |   |   |   ├── base_theme1
|   |   |   |   └── base_theme2
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-epub-anchor-id
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autodoc
|   |   |   ├── autodoc_dummy_bar.py
|   |   |   ├── autodoc_dummy_module.py
|   |   |   ├── bug2437
|   |   |   |   ├── __init__.py
|   |   |   |   └── autodoc_dummy_foo.py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target
|   |   |       ├── TYPE_CHECKING.py
|   |   |       ├── __init__.py
|   |   |       ├── abstractmethods.py
|   |   |       ├── annotated.py
|   |   |       ├── autoclass_content.py
|   |   |       ├── autodoc_type_aliases.py
|   |   |       ├── bound_method.py
|   |   |       ├── cached_property.py
|   |   |       ├── callable.py
|   |   |       ├── canonical
|   |   |       ├── classes.py
|   |   |       ├── coroutine.py
|   |   |       ├── decorator.py
|   |   |       ├── descriptor.py
|   |   |       ├── docstring_signature.py
|   |   |       ├── empty_all.py
|   |   |       ├── enums.py
|   |   |       ├── final.py
|   |   |       ├── functions.py
|   |   |       ├── generic_class.py
|   |   |       ├── genericalias.py
|   |   |       ├── hide_value.py
|   |   |       ├── imported_members.py
|   |   |       ├── inheritance.py
|   |   |       ├── instance_variable.py
|   |   |       ├── metadata.py
|   |   |       ├── methods.py
|   |   |       ├── module.py
|   |   |       ├── name_conflict
|   |   |       ├── name_mangling.py
|   |   |       ├── need_mocks.py
|   |   |       ├── overload.py
|   |   |       ├── overload2.py
|   |   |       ├── partialfunction.py
|   |   |       ├── partialmethod.py
|   |   |       ├── pep570.py
|   |   |       ├── pep604.py
|   |   |       ├── preserve_defaults.py
|   |   |       ├── private.py
|   |   |       ├── process_docstring.py
|   |   |       ├── properties.py
|   |   |       ├── singledispatch.py
|   |   |       ├── singledispatchmethod.py
|   |   |       ├── slots.py
|   |   |       ├── sort_by_all.py
|   |   |       ├── typed_vars.py
|   |   |       ├── typehints.py
|   |   |       ├── typevar.py
|   |   |       ├── uninitialized_attributes.py
|   |   |       └── wrappedfunction.py
|   |   ├── test-ext-autosectionlabel
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosectionlabel-prefix-document
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── autosummary_importfail.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-filename-map
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-imported_members
|   |   |   ├── autosummary_dummy_package
|   |   |   |   ├── __init__.py
|   |   |   |   └── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-mock_imports
|   |   |   ├── conf.py
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-recursive
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── package
|   |   |   |   ├── __init__.py
|   |   |   |   ├── module.py
|   |   |   |   ├── module_importfail.py
|   |   |   |   └── package
|   |   |   └── package2
|   |   |       ├── __init__.py
|   |   |       └── module.py
|   |   ├── test-ext-autosummary-skip-member
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-autosummary-template
|   |   |   ├── _templates
|   |   |   |   └── empty.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-coverage
|   |   |   ├── conf.py
|   |   |   ├── coverage_ignored.py
|   |   |   ├── coverage_not_ignored.py
|   |   |   └── index.rst
|   |   ├── test-ext-doctest
|   |   |   ├── conf.py
|   |   |   └── doctest.txt
|   |   ├── test-ext-doctest-skipif
|   |   |   ├── conf.py
|   |   |   └── skipif.txt
|   |   ├── test-ext-doctest-with-autodoc
|   |   |   ├── conf.py
|   |   |   ├── dir
|   |   |   |   ├── __init__.py
|   |   |   |   ├── bar.py
|   |   |   |   └── inner.rst
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-githubpages
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-graphviz
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-ifconfig
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-imgconverter
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-inheritance_diagram
|   |   |   ├── conf.py
|   |   |   ├── example
|   |   |   |   ├── __init__.py
|   |   |   |   └── sphinx.py
|   |   |   ├── index.rst
|   |   |   └── test.py
|   |   ├── test-ext-intersphinx-cppdomain
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── math.rst
|   |   |   ├── nomath.rst
|   |   |   └── page.rst
|   |   ├── test-ext-math-compat
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math-simple
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-todo
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-ext-viewcode
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── objects.rst
|   |   |   └── spam
|   |   |       ├── __init__.py
|   |   |       ├── mod1.py
|   |   |       ├── mod2.py
|   |   |       └── mod3.py
|   |   ├── test-ext-viewcode-find
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── not_a_package
|   |   |       ├── __init__.py
|   |   |       └── submodule.py
|   |   ├── test-extensions
|   |   |   ├── conf.py
|   |   |   ├── read_parallel.py
|   |   |   ├── read_serial.py
|   |   |   ├── write_parallel.py
|   |   |   └── write_serial.py
|   |   ├── test-footnotes
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-gettext-template
|   |   |   ├── _templates
|   |   |   |   ├── template1.html
|   |   |   |   └── template2.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-glossary
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-highlight_options
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_assets
|   |   |   ├── conf.py
|   |   |   ├── extra
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   └── subdir
|   |   |   ├── index.rst
|   |   |   ├── static
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   ├── js
|   |   |   |   └── subdir
|   |   |   └── subdir
|   |   |       └── _build
|   |   ├── test-html_entity
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_scaled_image_link
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_style
|   |   |   ├── _static
|   |   |   |   └── default.css
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-parsed-literal
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-section
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-images
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── subdir
|   |   |       └── index.rst
|   |   ├── test-index_on_title
|   |   |   ├── conf.py
|   |   |   └── contents.rst
|   |   ├── test-inheritance
|   |   |   ├── basic_diagram.rst
|   |   |   ├── conf.py
|   |   |   ├── diagram_module_w_2_top_classes.rst
|   |   |   ├── diagram_w_1_top_class.rst
|   |   |   ├── diagram_w_2_top_classes.rst
|   |   |   ├── diagram_w_nested_classes.rst
|   |   |   ├── diagram_w_parts.rst
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── test.py
|   |   |   |   └── test_nested.py
|   |   |   └── index.rst
|   |   ├── test-intl
|   |   |   ├── _templates
|   |   |   |   └── contents.html
|   |   |   ├── admonitions.txt
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── definition_terms.txt
|   |   |   ├── docfields.txt
|   |   |   ├── external_links.txt
|   |   |   ├── figure.txt
|   |   |   ├── footnote.txt
|   |   |   ├── glossary_terms.txt
|   |   |   ├── glossary_terms_inconsistency.txt
|   |   |   ├── index.txt
|   |   |   ├── index_entries.txt
|   |   |   ├── label_target.txt
|   |   |   ├── literalblock.txt
|   |   |   ├── only.txt
|   |   |   ├── raw.txt
|   |   |   ├── refs.txt
|   |   |   ├── refs_inconsistency.txt
|   |   |   ├── refs_python_domain.txt
|   |   |   ├── role_xref.txt
|   |   |   ├── rubric.txt
|   |   |   ├── section.txt
|   |   |   ├── seealso.txt
|   |   |   ├── subdir
|   |   |   |   └── index.txt
|   |   |   ├── table.txt
|   |   |   ├── toctree.txt
|   |   |   ├── topic.txt
|   |   |   ├── versionchange.txt
|   |   |   ├── warnings.txt
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-keep_warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-babel
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-latex-equations
|   |   |   ├── conf.py
|   |   |   ├── equations.rst
|   |   |   └── expects
|   |   ├── test-latex-figure-in-admonition
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-includegraphics
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-index
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-labels
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── otherdoc.rst
|   |   ├── test-latex-numfig
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── indexhowto.rst
|   |   |   └── indexmanual.rst
|   |   ├── test-latex-table
|   |   |   ├── _mytemplates
|   |   |   |   └── latex
|   |   |   ├── complex.rst
|   |   |   ├── conf.py
|   |   |   ├── expects
|   |   |   ├── index.rst
|   |   |   ├── longtable.rst
|   |   |   └── tabular.rst
|   |   ├── test-latex-theme
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── theme
|   |   |       └── custom
|   |   ├── test-latex-title
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-unicode
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck
|   |   |   ├── conf.py
|   |   |   └── links.txt
|   |   ├── test-linkcheck-localserver
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-anchor
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-https
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-locale
|   |   |   ├── locale1
|   |   |   |   └── en
|   |   |   └── locale2
|   |   |       └── en
|   |   ├── test-manpage_url
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-citation
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-rubric
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-maxlistdepth
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-metadata
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-need-escaped
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux.rst
|   |   ├── test-nested-enumerated-list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nested-tables
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nitpicky-warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-numbered-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-numfig
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-productionlist
|   |   |   ├── Bare.rst
|   |   |   ├── Dup1.rst
|   |   |   ├── Dup2.rst
|   |   |   ├── LineContinuation.rst
|   |   |   ├── P1.rst
|   |   |   ├── P2.rst
|   |   |   ├── conf.py
|   |   |   ├── firstLineRule.rst
|   |   |   └── index.rst
|   |   ├── test-prolog
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── markdown.md
|   |   |   ├── prolog_markdown_parser.py
|   |   |   └── restructuredtext.rst
|   |   ├── test-pycode
|   |   |   └── cp_1251_coded.py
|   |   ├── test-pycode-egg
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── src
|   |   |       ├── sample.py
|   |   |       └── setup.py
|   |   ├── test-reST-code-block
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-refonly_bullet_list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-roles-download
|   |   |   ├── another
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-root
|   |   |   ├── _templates
|   |   |   |   ├── contentssb.html
|   |   |   |   ├── customsb.html
|   |   |   |   └── layout.html
|   |   |   ├── autodoc.txt
|   |   |   ├── autodoc_target.py
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── extapi.txt
|   |   |   ├── extensions.txt
|   |   |   ├── footnote.txt
|   |   |   ├── images.txt
|   |   |   ├── includes.txt
|   |   |   ├── index.txt
|   |   |   ├── lists.txt
|   |   |   ├── markup.txt
|   |   |   ├── math.txt
|   |   |   ├── objects.txt
|   |   |   ├── parsermod.py
|   |   |   ├── special
|   |   |   |   └── code.py
|   |   |   └── subdir
|   |   |       ├── excluded.txt
|   |   |       ├── images.txt
|   |   |       └── includes.txt
|   |   ├── test-search
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nosearch.rst
|   |   |   └── tocitem.rst
|   |   ├── test-setup
|   |   |   ├── doc
|   |   |   |   ├── conf.py
|   |   |   |   └── index.txt
|   |   |   └── setup.py
|   |   ├── test-smartquotes
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-stylesheets
|   |   |   ├── _templates
|   |   |   |   └── layout.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-templating
|   |   |   ├── _templates
|   |   |   |   ├── autosummary
|   |   |   |   └── layout.html
|   |   |   ├── autosummary_templating.txt
|   |   |   ├── conf.py
|   |   |   └── index.txt
|   |   ├── test-theming
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── setup.py
|   |   |   └── test_theme
|   |   |       ├── __init__.py
|   |   |       ├── staticfiles
|   |   |       └── test-theme
|   |   ├── test-tocdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   ├── qux.rst
|   |   |   └── tocdepth.rst
|   |   ├── test-toctree-duplicated
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree-empty
|   |   |   ├── _templates
|   |   |   |   └── localtoc.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-toctree-glob
|   |   |   ├── bar
|   |   |   |   ├── bar_1.rst
|   |   |   |   ├── bar_2.rst
|   |   |   |   ├── bar_3.rst
|   |   |   |   ├── bar_4
|   |   |   |   └── index.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux
|   |   |       ├── index.rst
|   |   |       ├── qux_1.rst
|   |   |       └── qux_2.rst
|   |   ├── test-toctree-maxdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   └── qux.rst
|   |   ├── test-transforms-post_transforms-missing-reference
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-trim_doctest_flags
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-versioning
|   |   |   ├── added.txt
|   |   |   ├── conf.py
|   |   |   ├── deleted.txt
|   |   |   ├── deleted_end.txt
|   |   |   ├── index.txt
|   |   |   ├── insert.txt
|   |   |   ├── insert_beginning.txt
|   |   |   ├── insert_similar.txt
|   |   |   ├── modified.txt
|   |   |   └── original.txt
|   |   └── test-warnings
|   |       ├── autodoc_fodder.py
|   |       ├── conf.py
|   |       ├── index.rst
|   |       └── undecodable.rst
|   ├── test_api_translator.py
|   ├── test_application.py
|   ├── test_build.py
|   ├── test_build_changes.py
|   ├── test_build_dirhtml.py
|   ├── test_build_epub.py
|   ├── test_build_gettext.py
|   ├── test_build_html.py
|   ├── test_build_latex.py
|   ├── test_build_linkcheck.py
|   ├── test_build_manpage.py
|   ├── test_build_texinfo.py
|   ├── test_build_text.py
|   ├── test_builder.py
|   ├── test_catalogs.py
|   ├── test_config.py
|   ├── test_correct_year.py
|   ├── test_directive_code.py
|   ├── test_directive_only.py
|   ├── test_directive_other.py
|   ├── test_directive_patch.py
|   ├── test_docutilsconf.py
|   ├── test_domain_c.py
|   ├── test_domain_cpp.py
|   ├── test_domain_js.py
|   ├── test_domain_py.py
|   ├── test_domain_rst.py
|   ├── test_domain_std.py
|   ├── test_environment.py
|   ├── test_environment_indexentries.py
|   ├── test_environment_toctree.py
|   ├── test_errors.py
|   ├── test_events.py
|   ├── test_ext_apidoc.py
|   ├── test_ext_autodoc.py
|   ├── test_ext_autodoc_autoattribute.py
|   ├── test_ext_autodoc_autoclass.py
|   ├── test_ext_autodoc_autodata.py
|   ├── test_ext_autodoc_autofunction.py
|   ├── test_ext_autodoc_automodule.py
|   ├── test_ext_autodoc_autoproperty.py
|   ├── test_ext_autodoc_configs.py
|   ├── test_ext_autodoc_events.py
|   ├── test_ext_autodoc_mock.py
|   ├── test_ext_autodoc_preserve_defaults.py
|   ├── test_ext_autodoc_private_members.py
|   ├── test_ext_autosectionlabel.py
|   ├── test_ext_autosummary.py
|   ├── test_ext_coverage.py
|   ├── test_ext_doctest.py
|   ├── test_ext_duration.py
|   ├── test_ext_githubpages.py
|   ├── test_ext_graphviz.py
|   ├── test_ext_ifconfig.py
|   ├── test_ext_imgconverter.py
|   ├── test_ext_inheritance_diagram.py
|   ├── test_ext_intersphinx.py
|   ├── test_ext_math.py
|   ├── test_ext_napoleon.py
|   ├── test_ext_napoleon_docstring.py
|   ├── test_ext_napoleon_iterators.py
|   ├── test_ext_todo.py
|   ├── test_ext_viewcode.py
|   ├── test_highlighting.py
|   ├── test_intl.py
|   ├── test_locale.py
|   ├── test_markup.py
|   ├── test_metadata.py
|   ├── test_parser.py
|   ├── test_project.py
|   ├── test_pycode.py
|   ├── test_pycode_ast.py
|   ├── test_pycode_parser.py
|   ├── test_quickstart.py
|   ├── test_roles.py
|   ├── test_search.py
|   ├── test_setup_command.py
|   ├── test_smartquotes.py
|   ├── test_templating.py
|   ├── test_theming.py
|   ├── test_toctree.py
|   ├── test_transforms_post_transforms.py
|   ├── test_transforms_post_transforms_code.py
|   ├── test_util.py
|   ├── test_util_docstrings.py
|   ├── test_util_docutils.py
|   ├── test_util_fileutil.py
|   ├── test_util_i18n.py
|   ├── test_util_images.py
|   ├── test_util_inspect.py
|   ├── test_util_inventory.py
|   ├── test_util_jsdump.py
|   ├── test_util_logging.py
|   ├── test_util_matching.py
|   ├── test_util_nodes.py
|   ├── test_util_rst.py
|   ├── test_util_template.py
|   ├── test_util_typing.py
|   ├── test_versioning.py
|   ├── test_writer_latex.py
|   ├── typing_test_data.py
|   └── utils.py
└── utils
    ├── __init__.py
    ├── bump_docker.sh
    ├── bump_version.py
    ├── checks.py
    ├── doclinter.py
    └── jssplitter_generator.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Doc rendering is incorrect when :param has datatype dict(str,str)

Description: **Describe the bug**
I have a parameter defined under docstring of a method as:-
:param dict(str, str) opc_meta: (optional)

Which is being incorrectly rendered in the generated docs as:-
str) opc_meta (dict(str,) –(optional) 

**To Reproduce**
Create any method with the docstring containg the above param

**Expected behavior**
The param should be rendered in the generated docs as:-
opc_meta (dict(str,str)) – (optional) 

**Your project**
[sphinxTest.zip](https://github.com/sphinx-doc/sphinx/files/6468074/sphinxTest.zip)


**Screenshots**
<img width="612" alt="Screen Shot 2021-05-12 at 12 30 50 PM" src="https://user-images.githubusercontent.com/8617566/118020143-5f59a280-b31f-11eb-8dc2-5280d5c4896b.png">
<img width="681" alt="Screen Shot 2021-05-12 at 12 32 25 PM" src="https://user-images.githubusercontent.com/8617566/118020154-62549300-b31f-11eb-953d-9287f9cc27ff.png">


**Environment info**
- OS: Mac
- Python version: 3.9.0
- Sphinx version: 4.0.1
- Sphinx extensions:  ["sphinx.ext.autodoc", "sphinx.ext.autosummary", "sphinx.ext.intersphinx", "autodocsumm"]
- Extra tools: Browser Firefox.

**Additional context**
N/A



Patch information:
diff --git a/sphinx/util/docfields.py b/sphinx/util/docfields.py
index 3a3367ebe..6d48e910c 100644
--- a/sphinx/util/docfields.py
+++ b/sphinx/util/docfields.py
@@ -298,7 +298,7 @@ class DocFieldTransformer:
             # also support syntax like ``:param type name:``
             if typedesc.is_typed:
                 try:
-                    argtype, argname = fieldarg.split(None, 1)
+                    argtype, argname = fieldarg.rsplit(None, 1)
                 except ValueError:
                     pass
                 else:


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `tests/test_util_docfields.py`, `tests/test_domain_py.py`, and `tests/test_ext_autodoc.py`.
Extra Requirements: 
Purpose: I need to analyze these test files to find at least three existing test cases that cover the parsing of complex parameter types in docstrings, which will help in understanding how this functionality is currently tested and to find tests similar to the bug report.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: tests/test_domain_py.py
Line number range: 1 - 500
Content:
1. """
2.     test_domain_py
3.     ~~~~~~~~~~~~~~
4. 
5.     Tests the Python Domain
6. 
7.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import re
12. import sys
13. from unittest.mock import Mock
14. 
15. import pytest
16. from docutils import nodes
17. 
18. from sphinx import addnodes
19. from sphinx.addnodes import (desc, desc_addname, desc_annotation, desc_content, desc_name,
20.                              desc_optional, desc_parameter, desc_parameterlist, desc_returns,
21.                              desc_sig_name, desc_sig_operator, desc_sig_punctuation,
22.                              desc_signature, pending_xref)
23. from sphinx.domains import IndexEntry
24. from sphinx.domains.python import (PythonDomain, PythonModuleIndex, _parse_annotation,
25.                                    _pseudo_parse_arglist, py_sig_re)
26. from sphinx.testing import restructuredtext
27. from sphinx.testing.util import assert_node
28. 
29. 
30. def parse(sig):
31.     m = py_sig_re.match(sig)
32.     if m is None:
33.         raise ValueError
34.     name_prefix, name, arglist, retann = m.groups()
35.     signode = addnodes.desc_signature(sig, '')
36.     _pseudo_parse_arglist(signode, arglist)
37.     return signode.astext()
38. 
39. 
40. def test_function_signatures():
41.     rv = parse('func(a=1) -> int object')
42.     assert rv == '(a=1)'
43. 
44.     rv = parse('func(a=1, [b=None])')
45.     assert rv == '(a=1, [b=None])'
46. 
47.     rv = parse('func(a=1[, b=None])')
48.     assert rv == '(a=1, [b=None])'
49. 
50.     rv = parse("compile(source : string, filename, symbol='file')")
51.     assert rv == "(source : string, filename, symbol='file')"
52. 
53.     rv = parse('func(a=[], [b=None])')
54.     assert rv == '(a=[], [b=None])'
55. 
56.     rv = parse('func(a=[][, b=None])')
57.     assert rv == '(a=[], [b=None])'
58. 
59. 
60. @pytest.mark.sphinx('dummy', testroot='domain-py')
61. def test_domain_py_xrefs(app, status, warning):
62.     """Domain objects have correct prefixes when looking up xrefs"""
63.     app.builder.build_all()
64. 
65.     def assert_refnode(node, module_name, class_name, target, reftype=None,
66.                        domain='py'):
67.         attributes = {
68.             'refdomain': domain,
69.             'reftarget': target,
70.         }
71.         if reftype is not None:
72.             attributes['reftype'] = reftype
73.         if module_name is not False:
74.             attributes['py:module'] = module_name
75.         if class_name is not False:
76.             attributes['py:class'] = class_name
77.         assert_node(node, **attributes)
78. 
79.     doctree = app.env.get_doctree('roles')
80.     refnodes = list(doctree.traverse(pending_xref))
81.     assert_refnode(refnodes[0], None, None, 'TopLevel', 'class')
82.     assert_refnode(refnodes[1], None, None, 'top_level', 'meth')
83.     assert_refnode(refnodes[2], None, 'NestedParentA', 'child_1', 'meth')
84.     assert_refnode(refnodes[3], None, 'NestedParentA', 'NestedChildA.subchild_2', 'meth')
85.     assert_refnode(refnodes[4], None, 'NestedParentA', 'child_2', 'meth')
86.     assert_refnode(refnodes[5], False, 'NestedParentA', 'any_child', domain='')
87.     assert_refnode(refnodes[6], None, 'NestedParentA', 'NestedChildA', 'class')
88.     assert_refnode(refnodes[7], None, 'NestedParentA.NestedChildA', 'subchild_2', 'meth')
89.     assert_refnode(refnodes[8], None, 'NestedParentA.NestedChildA',
90.                    'NestedParentA.child_1', 'meth')
91.     assert_refnode(refnodes[9], None, 'NestedParentA', 'NestedChildA.subchild_1', 'meth')
92.     assert_refnode(refnodes[10], None, 'NestedParentB', 'child_1', 'meth')
93.     assert_refnode(refnodes[11], None, 'NestedParentB', 'NestedParentB', 'class')
94.     assert_refnode(refnodes[12], None, None, 'NestedParentA.NestedChildA', 'class')
95.     assert len(refnodes) == 13
96. 
97.     doctree = app.env.get_doctree('module')
98.     refnodes = list(doctree.traverse(pending_xref))
99.     assert_refnode(refnodes[0], 'module_a.submodule', None,
100.                    'ModTopLevel', 'class')
101.     assert_refnode(refnodes[1], 'module_a.submodule', 'ModTopLevel',
102.                    'mod_child_1', 'meth')
103.     assert_refnode(refnodes[2], 'module_a.submodule', 'ModTopLevel',
104.                    'ModTopLevel.mod_child_1', 'meth')
105.     assert_refnode(refnodes[3], 'module_a.submodule', 'ModTopLevel',
106.                    'mod_child_2', 'meth')
107.     assert_refnode(refnodes[4], 'module_a.submodule', 'ModTopLevel',
108.                    'module_a.submodule.ModTopLevel.mod_child_1', 'meth')
109.     assert_refnode(refnodes[5], 'module_a.submodule', 'ModTopLevel',
110.                    'prop', 'attr')
111.     assert_refnode(refnodes[6], 'module_a.submodule', 'ModTopLevel',
112.                    'prop', 'meth')
113.     assert_refnode(refnodes[7], 'module_b.submodule', None,
114.                    'ModTopLevel', 'class')
115.     assert_refnode(refnodes[8], 'module_b.submodule', 'ModTopLevel',
116.                    'ModNoModule', 'class')
117.     assert_refnode(refnodes[9], False, False, 'int', 'class')
118.     assert_refnode(refnodes[10], False, False, 'tuple', 'class')
119.     assert_refnode(refnodes[11], False, False, 'str', 'class')
120.     assert_refnode(refnodes[12], False, False, 'float', 'class')
121.     assert_refnode(refnodes[13], False, False, 'list', 'class')
122.     assert_refnode(refnodes[14], False, False, 'ModTopLevel', 'class')
123.     assert_refnode(refnodes[15], False, False, 'index', 'doc', domain='std')
124.     assert len(refnodes) == 16
125. 
126.     doctree = app.env.get_doctree('module_option')
127.     refnodes = list(doctree.traverse(pending_xref))
128.     print(refnodes)
129.     print(refnodes[0])
130.     print(refnodes[1])
131.     assert_refnode(refnodes[0], 'test.extra', 'B', 'foo', 'meth')
132.     assert_refnode(refnodes[1], 'test.extra', 'B', 'foo', 'meth')
133.     assert len(refnodes) == 2
134. 
135. 
136. @pytest.mark.sphinx('html', testroot='domain-py')
137. def test_domain_py_xrefs_abbreviations(app, status, warning):
138.     app.builder.build_all()
139. 
140.     content = (app.outdir / 'abbr.html').read_text()
141.     assert re.search(r'normal: <a .* href="module.html#module_a.submodule.ModTopLevel.'
142.                      r'mod_child_1" .*><.*>module_a.submodule.ModTopLevel.mod_child_1\(\)'
143.                      r'<.*></a>',
144.                      content)
145.     assert re.search(r'relative: <a .* href="module.html#module_a.submodule.ModTopLevel.'
146.                      r'mod_child_1" .*><.*>ModTopLevel.mod_child_1\(\)<.*></a>',
147.                      content)
148.     assert re.search(r'short name: <a .* href="module.html#module_a.submodule.ModTopLevel.'
149.                      r'mod_child_1" .*><.*>mod_child_1\(\)<.*></a>',
150.                      content)
151.     assert re.search(r'relative \+ short name: <a .* href="module.html#module_a.submodule.'
152.                      r'ModTopLevel.mod_child_1" .*><.*>mod_child_1\(\)<.*></a>',
153.                      content)
154.     assert re.search(r'short name \+ relative: <a .* href="module.html#module_a.submodule.'
155.                      r'ModTopLevel.mod_child_1" .*><.*>mod_child_1\(\)<.*></a>',
156.                      content)
157. 
158. 
159. @pytest.mark.sphinx('dummy', testroot='domain-py')
160. def test_domain_py_objects(app, status, warning):
161.     app.builder.build_all()
162. 
163.     modules = app.env.domains['py'].data['modules']
164.     objects = app.env.domains['py'].data['objects']
165. 
166.     assert 'module_a.submodule' in modules
167.     assert 'module_a.submodule' in objects
168.     assert 'module_b.submodule' in modules
169.     assert 'module_b.submodule' in objects
170. 
171.     assert objects['module_a.submodule.ModTopLevel'][2] == 'class'
172.     assert objects['module_a.submodule.ModTopLevel.mod_child_1'][2] == 'method'
173.     assert objects['module_a.submodule.ModTopLevel.mod_child_2'][2] == 'method'
174.     assert 'ModTopLevel.ModNoModule' not in objects
175.     assert objects['ModNoModule'][2] == 'class'
176.     assert objects['module_b.submodule.ModTopLevel'][2] == 'class'
177. 
178.     assert objects['TopLevel'][2] == 'class'
179.     assert objects['top_level'][2] == 'method'
180.     assert objects['NestedParentA'][2] == 'class'
181.     assert objects['NestedParentA.child_1'][2] == 'method'
182.     assert objects['NestedParentA.any_child'][2] == 'method'
183.     assert objects['NestedParentA.NestedChildA'][2] == 'class'
184.     assert objects['NestedParentA.NestedChildA.subchild_1'][2] == 'method'
185.     assert objects['NestedParentA.NestedChildA.subchild_2'][2] == 'method'
186.     assert objects['NestedParentA.child_2'][2] == 'method'
187.     assert objects['NestedParentB'][2] == 'class'
188.     assert objects['NestedParentB.child_1'][2] == 'method'
189. 
190. 
191. @pytest.mark.sphinx('html', testroot='domain-py')
192. def test_resolve_xref_for_properties(app, status, warning):
193.     app.builder.build_all()
194. 
195.     content = (app.outdir / 'module.html').read_text()
196.     assert ('Link to <a class="reference internal" href="#module_a.submodule.ModTopLevel.prop"'
197.             ' title="module_a.submodule.ModTopLevel.prop">'
198.             '<code class="xref py py-attr docutils literal notranslate"><span class="pre">'
199.             'prop</span> <span class="pre">attribute</span></code></a>' in content)
200.     assert ('Link to <a class="reference internal" href="#module_a.submodule.ModTopLevel.prop"'
201.             ' title="module_a.submodule.ModTopLevel.prop">'
202.             '<code class="xref py py-meth docutils literal notranslate"><span class="pre">'
203.             'prop</span> <span class="pre">method</span></code></a>' in content)
204.     assert ('Link to <a class="reference internal" href="#module_a.submodule.ModTopLevel.prop"'
205.             ' title="module_a.submodule.ModTopLevel.prop">'
206.             '<code class="xref py py-attr docutils literal notranslate"><span class="pre">'
207.             'prop</span> <span class="pre">attribute</span></code></a>' in content)
208. 
209. 
210. @pytest.mark.sphinx('dummy', testroot='domain-py')
211. def test_domain_py_find_obj(app, status, warning):
212. 
213.     def find_obj(modname, prefix, obj_name, obj_type, searchmode=0):
214.         return app.env.domains['py'].find_obj(
215.             app.env, modname, prefix, obj_name, obj_type, searchmode)
216. 
217.     app.builder.build_all()
218. 
219.     assert (find_obj(None, None, 'NONEXISTANT', 'class') == [])
220.     assert (find_obj(None, None, 'NestedParentA', 'class') ==
221.             [('NestedParentA', ('roles', 'NestedParentA', 'class', False))])
222.     assert (find_obj(None, None, 'NestedParentA.NestedChildA', 'class') ==
223.             [('NestedParentA.NestedChildA',
224.               ('roles', 'NestedParentA.NestedChildA', 'class', False))])
225.     assert (find_obj(None, 'NestedParentA', 'NestedChildA', 'class') ==
226.             [('NestedParentA.NestedChildA',
227.               ('roles', 'NestedParentA.NestedChildA', 'class', False))])
228.     assert (find_obj(None, None, 'NestedParentA.NestedChildA.subchild_1', 'meth') ==
229.             [('NestedParentA.NestedChildA.subchild_1',
230.               ('roles', 'NestedParentA.NestedChildA.subchild_1', 'method', False))])
231.     assert (find_obj(None, 'NestedParentA', 'NestedChildA.subchild_1', 'meth') ==
232.             [('NestedParentA.NestedChildA.subchild_1',
233.               ('roles', 'NestedParentA.NestedChildA.subchild_1', 'method', False))])
234.     assert (find_obj(None, 'NestedParentA.NestedChildA', 'subchild_1', 'meth') ==
235.             [('NestedParentA.NestedChildA.subchild_1',
236.               ('roles', 'NestedParentA.NestedChildA.subchild_1', 'method', False))])
237. 
238. 
239. @pytest.mark.sphinx('html', testroot='domain-py', freshenv=True)
240. def test_domain_py_canonical(app, status, warning):
241.     app.builder.build_all()
242. 
243.     content = (app.outdir / 'canonical.html').read_text()
244.     assert ('<a class="reference internal" href="#canonical.Foo" title="canonical.Foo">'
245.             '<code class="xref py py-class docutils literal notranslate">'
246.             '<span class="pre">Foo</span></code></a>' in content)
247.     assert warning.getvalue() == ''
248. 
249. 
250. def test_get_full_qualified_name():
251.     env = Mock(domaindata={})
252.     domain = PythonDomain(env)
253. 
254.     # non-python references
255.     node = nodes.reference()
256.     assert domain.get_full_qualified_name(node) is None
257. 
258.     # simple reference
259.     node = nodes.reference(reftarget='func')
260.     assert domain.get_full_qualified_name(node) == 'func'
261. 
262.     # with py:module context
263.     kwargs = {'py:module': 'module1'}
264.     node = nodes.reference(reftarget='func', **kwargs)
265.     assert domain.get_full_qualified_name(node) == 'module1.func'
266. 
267.     # with py:class context
268.     kwargs = {'py:class': 'Class'}
269.     node = nodes.reference(reftarget='func', **kwargs)
270.     assert domain.get_full_qualified_name(node) == 'Class.func'
271. 
272.     # with both py:module and py:class context
273.     kwargs = {'py:module': 'module1', 'py:class': 'Class'}
274.     node = nodes.reference(reftarget='func', **kwargs)
275.     assert domain.get_full_qualified_name(node) == 'module1.Class.func'
276. 
277. 
278. def test_parse_annotation(app):
279.     doctree = _parse_annotation("int", app.env)
280.     assert_node(doctree, ([pending_xref, "int"],))
281.     assert_node(doctree[0], pending_xref, refdomain="py", reftype="class", reftarget="int")
282. 
283.     doctree = _parse_annotation("List[int]", app.env)
284.     assert_node(doctree, ([pending_xref, "List"],
285.                           [desc_sig_punctuation, "["],
286.                           [pending_xref, "int"],
287.                           [desc_sig_punctuation, "]"]))
288. 
289.     doctree = _parse_annotation("Tuple[int, int]", app.env)
290.     assert_node(doctree, ([pending_xref, "Tuple"],
291.                           [desc_sig_punctuation, "["],
292.                           [pending_xref, "int"],
293.                           [desc_sig_punctuation, ", "],
294.                           [pending_xref, "int"],
295.                           [desc_sig_punctuation, "]"]))
296. 
297.     doctree = _parse_annotation("Tuple[()]", app.env)
298.     assert_node(doctree, ([pending_xref, "Tuple"],
299.                           [desc_sig_punctuation, "["],
300.                           [desc_sig_punctuation, "("],
301.                           [desc_sig_punctuation, ")"],
302.                           [desc_sig_punctuation, "]"]))
303. 
304.     doctree = _parse_annotation("Tuple[int, ...]", app.env)
305.     assert_node(doctree, ([pending_xref, "Tuple"],
306.                           [desc_sig_punctuation, "["],
307.                           [pending_xref, "int"],
308.                           [desc_sig_punctuation, ", "],
309.                           [desc_sig_punctuation, "..."],
310.                           [desc_sig_punctuation, "]"]))
311. 
312.     doctree = _parse_annotation("Callable[[int, int], int]", app.env)
313.     assert_node(doctree, ([pending_xref, "Callable"],
314.                           [desc_sig_punctuation, "["],
315.                           [desc_sig_punctuation, "["],
316.                           [pending_xref, "int"],
317.                           [desc_sig_punctuation, ", "],
318.                           [pending_xref, "int"],
319.                           [desc_sig_punctuation, "]"],
320.                           [desc_sig_punctuation, ", "],
321.                           [pending_xref, "int"],
322.                           [desc_sig_punctuation, "]"]))
323. 
324.     doctree = _parse_annotation("List[None]", app.env)
325.     assert_node(doctree, ([pending_xref, "List"],
326.                           [desc_sig_punctuation, "["],
327.                           [pending_xref, "None"],
328.                           [desc_sig_punctuation, "]"]))
329. 
330.     # None type makes an object-reference (not a class reference)
331.     doctree = _parse_annotation("None", app.env)
332.     assert_node(doctree, ([pending_xref, "None"],))
333.     assert_node(doctree[0], pending_xref, refdomain="py", reftype="obj", reftarget="None")
334. 
335. 
336. def test_pyfunction_signature(app):
337.     text = ".. py:function:: hello(name: str) -> str"
338.     doctree = restructuredtext.parse(app, text)
339.     assert_node(doctree, (addnodes.index,
340.                           [desc, ([desc_signature, ([desc_name, "hello"],
341.                                                     desc_parameterlist,
342.                                                     [desc_returns, pending_xref, "str"])],
343.                                   desc_content)]))
344.     assert_node(doctree[1], addnodes.desc, desctype="function",
345.                 domain="py", objtype="function", noindex=False)
346.     assert_node(doctree[1][0][1],
347.                 [desc_parameterlist, desc_parameter, ([desc_sig_name, "name"],
348.                                                       [desc_sig_punctuation, ":"],
349.                                                       " ",
350.                                                       [nodes.inline, pending_xref, "str"])])
351. 
352. 
353. def test_pyfunction_signature_full(app):
354.     text = (".. py:function:: hello(a: str, b = 1, *args: str, "
355.             "c: bool = True, d: tuple = (1, 2), **kwargs: str) -> str")
356.     doctree = restructuredtext.parse(app, text)
357.     assert_node(doctree, (addnodes.index,
358.                           [desc, ([desc_signature, ([desc_name, "hello"],
359.                                                     desc_parameterlist,
360.                                                     [desc_returns, pending_xref, "str"])],
361.                                   desc_content)]))
362.     assert_node(doctree[1], addnodes.desc, desctype="function",
363.                 domain="py", objtype="function", noindex=False)
364.     assert_node(doctree[1][0][1],
365.                 [desc_parameterlist, ([desc_parameter, ([desc_sig_name, "a"],
366.                                                         [desc_sig_punctuation, ":"],
367.                                                         " ",
368.                                                         [desc_sig_name, pending_xref, "str"])],
369.                                       [desc_parameter, ([desc_sig_name, "b"],
370.                                                         [desc_sig_operator, "="],
371.                                                         [nodes.inline, "1"])],
372.                                       [desc_parameter, ([desc_sig_operator, "*"],
373.                                                         [desc_sig_name, "args"],
374.                                                         [desc_sig_punctuation, ":"],
375.                                                         " ",
376.                                                         [desc_sig_name, pending_xref, "str"])],
377.                                       [desc_parameter, ([desc_sig_name, "c"],
378.                                                         [desc_sig_punctuation, ":"],
379.                                                         " ",
380.                                                         [desc_sig_name, pending_xref, "bool"],
381.                                                         " ",
382.                                                         [desc_sig_operator, "="],
383.                                                         " ",
384.                                                         [nodes.inline, "True"])],
385.                                       [desc_parameter, ([desc_sig_name, "d"],
386.                                                         [desc_sig_punctuation, ":"],
387.                                                         " ",
388.                                                         [desc_sig_name, pending_xref, "tuple"],
389.                                                         " ",
390.                                                         [desc_sig_operator, "="],
391.                                                         " ",
392.                                                         [nodes.inline, "(1, 2)"])],
393.                                       [desc_parameter, ([desc_sig_operator, "**"],
394.                                                         [desc_sig_name, "kwargs"],
395.                                                         [desc_sig_punctuation, ":"],
396.                                                         " ",
397.                                                         [desc_sig_name, pending_xref, "str"])])])
398. 
399. 
400. @pytest.mark.skipif(sys.version_info < (3, 8), reason='python 3.8+ is required.')
401. def test_pyfunction_signature_full_py38(app):
402.     # case: separator at head
403.     text = ".. py:function:: hello(*, a)"
404.     doctree = restructuredtext.parse(app, text)
405.     assert_node(doctree[1][0][1],
406.                 [desc_parameterlist, ([desc_parameter, nodes.inline, "*"],
407.                                       [desc_parameter, desc_sig_name, "a"])])
408. 
409.     # case: separator in the middle
410.     text = ".. py:function:: hello(a, /, b, *, c)"
411.     doctree = restructuredtext.parse(app, text)
412.     assert_node(doctree[1][0][1],
413.                 [desc_parameterlist, ([desc_parameter, desc_sig_name, "a"],
414.                                       [desc_parameter, desc_sig_operator, "/"],
415.                                       [desc_parameter, desc_sig_name, "b"],
416.                                       [desc_parameter, desc_sig_operator, "*"],
417.                                       [desc_parameter, desc_sig_name, "c"])])
418. 
419.     # case: separator in the middle (2)
420.     text = ".. py:function:: hello(a, /, *, b)"
421.     doctree = restructuredtext.parse(app, text)
422.     assert_node(doctree[1][0][1],
423.                 [desc_parameterlist, ([desc_parameter, desc_sig_name, "a"],
424.                                       [desc_parameter, desc_sig_operator, "/"],
425.                                       [desc_parameter, desc_sig_operator, "*"],
426.                                       [desc_parameter, desc_sig_name, "b"])])
427. 
428.     # case: separator at tail
429.     text = ".. py:function:: hello(a, /)"
430.     doctree = restructuredtext.parse(app, text)
431.     assert_node(doctree[1][0][1],
432.                 [desc_parameterlist, ([desc_parameter, desc_sig_name, "a"],
433.                                       [desc_parameter, desc_sig_operator, "/"])])
434. 
435. 
436. @pytest.mark.skipif(sys.version_info < (3, 8), reason='python 3.8+ is required.')
437. def test_pyfunction_with_number_literals(app):
438.     text = ".. py:function:: hello(age=0x10, height=1_6_0)"
439.     doctree = restructuredtext.parse(app, text)
440.     assert_node(doctree[1][0][1],
441.                 [desc_parameterlist, ([desc_parameter, ([desc_sig_name, "age"],
442.                                                         [desc_sig_operator, "="],
443.                                                         [nodes.inline, "0x10"])],
444.                                       [desc_parameter, ([desc_sig_name, "height"],
445.                                                         [desc_sig_operator, "="],
446.                                                         [nodes.inline, "1_6_0"])])])
447. 
448. 
449. def test_pyfunction_with_union_type_operator(app):
450.     text = ".. py:function:: hello(age: int | None)"
451.     doctree = restructuredtext.parse(app, text)
452.     assert_node(doctree[1][0][1],
453.                 [desc_parameterlist, ([desc_parameter, ([desc_sig_name, "age"],
454.                                                         [desc_sig_punctuation, ":"],
455.                                                         " ",
456.                                                         [desc_sig_name, ([pending_xref, "int"],
457.                                                                          " ",
458.                                                                          [desc_sig_punctuation, "|"],
459.                                                                          " ",
460.                                                                          [pending_xref, "None"])])])])
461. 
462. 
463. def test_optional_pyfunction_signature(app):
464.     text = ".. py:function:: compile(source [, filename [, symbol]]) -> ast object"
465.     doctree = restructuredtext.parse(app, text)
466.     assert_node(doctree, (addnodes.index,
467.                           [desc, ([desc_signature, ([desc_name, "compile"],
468.                                                     desc_parameterlist,
469.                                                     [desc_returns, pending_xref, "ast object"])],
470.                                   desc_content)]))
471.     assert_node(doctree[1], addnodes.desc, desctype="function",
472.                 domain="py", objtype="function", noindex=False)
473.     assert_node(doctree[1][0][1],
474.                 ([desc_parameter, "source"],
475.                  [desc_optional, ([desc_parameter, "filename"],
476.                                   [desc_optional, desc_parameter, "symbol"])]))
477. 
478. 
479. def test_pyexception_signature(app):
480.     text = ".. py:exception:: exceptions.IOError"
481.     doctree = restructuredtext.parse(app, text)
482.     assert_node(doctree, (addnodes.index,
483.                           [desc, ([desc_signature, ([desc_annotation, "exception "],
484.                                                     [desc_addname, "exceptions."],
485.                                                     [desc_name, "IOError"])],
486.                                   desc_content)]))
487.     assert_node(doctree[1], desc, desctype="exception",
488.                 domain="py", objtype="exception", noindex=False)
489. 
490. 
491. def test_exceptions_module_is_ignored(app):
492.     text = (".. py:exception:: IOError\n"
493.             "   :module: exceptions\n")
494.     doctree = restructuredtext.parse(app, text)
495.     assert_node(doctree, (addnodes.index,
496.                           [desc, ([desc_signature, ([desc_annotation, "exception "],
497.                                                     [desc_name, "IOError"])],
498.                                   desc_content)]))
499.     assert_node(doctree[1], desc, desctype="exception",
500.                 domain="py", objtype="exception", noindex=False)


File: tests/test_ext_autodoc.py
Line number range: 1 - 500
Content:
1. """
2.     test_ext_autodoc
3.     ~~~~~~~~~~~~~~~~
4. 
5.     Test the autodoc extension.  This tests mainly the Documenters; the auto
6.     directives are tested in a test source file translated by test_build.
7. 
8.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
9.     :license: BSD, see LICENSE for details.
10. """
11. 
12. import sys
13. from unittest.mock import Mock
14. from warnings import catch_warnings
15. 
16. import pytest
17. from docutils.statemachine import ViewList
18. 
19. from sphinx import addnodes
20. from sphinx.ext.autodoc import ALL, ModuleLevelDocumenter, Options
21. from sphinx.ext.autodoc.directive import DocumenterBridge, process_documenter_options
22. from sphinx.testing.util import SphinxTestApp, Struct  # NOQA
23. from sphinx.util.docutils import LoggingReporter
24. 
25. try:
26.     # Enable pyximport to test cython module
27.     import pyximport
28.     pyximport.install()
29. except ImportError:
30.     pyximport = None
31. 
32. 
33. def do_autodoc(app, objtype, name, options=None):
34.     if options is None:
35.         options = {}
36.     app.env.temp_data.setdefault('docname', 'index')  # set dummy docname
37.     doccls = app.registry.documenters[objtype]
38.     docoptions = process_documenter_options(doccls, app.config, options)
39.     state = Mock()
40.     state.document.settings.tab_width = 8
41.     bridge = DocumenterBridge(app.env, LoggingReporter(''), docoptions, 1, state)
42.     documenter = doccls(bridge, name)
43.     documenter.generate()
44. 
45.     return bridge.result
46. 
47. 
48. def make_directive_bridge(env):
49.     options = Options(
50.         inherited_members = False,
51.         undoc_members = False,
52.         private_members = False,
53.         special_members = False,
54.         imported_members = False,
55.         show_inheritance = False,
56.         noindex = False,
57.         annotation = None,
58.         synopsis = '',
59.         platform = '',
60.         deprecated = False,
61.         members = [],
62.         member_order = 'alphabetical',
63.         exclude_members = set(),
64.         ignore_module_all = False,
65.     )
66. 
67.     directive = Struct(
68.         env = env,
69.         genopt = options,
70.         result = ViewList(),
71.         record_dependencies = set(),
72.         state = Mock(),
73.     )
74.     directive.state.document.settings.tab_width = 8
75. 
76.     return directive
77. 
78. 
79. processed_signatures = []
80. 
81. 
82. def process_signature(app, what, name, obj, options, args, retann):
83.     processed_signatures.append((what, name))
84.     if name == 'bar':
85.         return '42', None
86. 
87. 
88. def skip_member(app, what, name, obj, skip, options):
89.     if name in ('__special1__', '__special2__'):
90.         return skip
91.     if name.startswith('__'):
92.         return True
93.     if name == 'skipmeth':
94.         return True
95. 
96. 
97. def test_parse_name(app):
98.     def verify(objtype, name, result):
99.         inst = app.registry.documenters[objtype](directive, name)
100.         assert inst.parse_name()
101.         assert (inst.modname, inst.objpath, inst.args, inst.retann) == result
102. 
103.     directive = make_directive_bridge(app.env)
104. 
105.     # for modules
106.     verify('module', 'test_ext_autodoc', ('test_ext_autodoc', [], None, None))
107.     verify('module', 'test.test_ext_autodoc', ('test.test_ext_autodoc', [], None, None))
108.     verify('module', 'test(arg)', ('test', [], 'arg', None))
109.     assert 'signature arguments' in app._warning.getvalue()
110. 
111.     # for functions/classes
112.     verify('function', 'test_ext_autodoc.raises',
113.            ('test_ext_autodoc', ['raises'], None, None))
114.     verify('function', 'test_ext_autodoc.raises(exc) -> None',
115.            ('test_ext_autodoc', ['raises'], 'exc', 'None'))
116.     directive.env.temp_data['autodoc:module'] = 'test_ext_autodoc'
117.     verify('function', 'raises', ('test_ext_autodoc', ['raises'], None, None))
118.     del directive.env.temp_data['autodoc:module']
119.     directive.env.ref_context['py:module'] = 'test_ext_autodoc'
120.     verify('function', 'raises', ('test_ext_autodoc', ['raises'], None, None))
121.     verify('class', 'Base', ('test_ext_autodoc', ['Base'], None, None))
122. 
123.     # for members
124.     directive.env.ref_context['py:module'] = 'sphinx.testing.util'
125.     verify('method', 'SphinxTestApp.cleanup',
126.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
127.     directive.env.ref_context['py:module'] = 'sphinx.testing.util'
128.     directive.env.ref_context['py:class'] = 'Foo'
129.     directive.env.temp_data['autodoc:class'] = 'SphinxTestApp'
130.     verify('method', 'cleanup',
131.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
132.     verify('method', 'SphinxTestApp.cleanup',
133.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
134. 
135. 
136. def test_format_signature(app):
137.     app.connect('autodoc-process-signature', process_signature)
138.     app.connect('autodoc-skip-member', skip_member)
139. 
140.     directive = make_directive_bridge(app.env)
141. 
142.     def formatsig(objtype, name, obj, args, retann):
143.         inst = app.registry.documenters[objtype](directive, name)
144.         inst.fullname = name
145.         inst.doc_as_attr = False  # for class objtype
146.         inst.parent = object  # dummy
147.         inst.object = obj
148.         inst.objpath = [name]
149.         inst.args = args
150.         inst.retann = retann
151.         res = inst.format_signature()
152.         print(res)
153.         return res
154. 
155.     # no signatures for modules
156.     assert formatsig('module', 'test', None, None, None) == ''
157. 
158.     # test for functions
159.     def f(a, b, c=1, **d):
160.         pass
161. 
162.     def g(a='\n'):
163.         pass
164.     assert formatsig('function', 'f', f, None, None) == '(a, b, c=1, **d)'
165.     assert formatsig('function', 'f', f, 'a, b, c, d', None) == '(a, b, c, d)'
166.     assert formatsig('function', 'g', g, None, None) == r"(a='\n')"
167. 
168.     # test for classes
169.     class D:
170.         pass
171. 
172.     class E:
173.         def __init__(self):
174.             pass
175. 
176.     # an empty init and no init are the same
177.     for C in (D, E):
178.         assert formatsig('class', 'D', C, None, None) == '()'
179. 
180.     class SomeMeta(type):
181.         def __call__(cls, a, b=None):
182.             return type.__call__(cls, a, b)
183. 
184.     # these three are all equivalent
185.     class F:
186.         def __init__(self, a, b=None):
187.             pass
188. 
189.     class FNew:
190.         def __new__(cls, a, b=None):
191.             return super().__new__(cls)
192. 
193.     class FMeta(metaclass=SomeMeta):
194.         pass
195. 
196.     # and subclasses should always inherit
197.     class G(F):
198.         pass
199. 
200.     class GNew(FNew):
201.         pass
202. 
203.     class GMeta(FMeta):
204.         pass
205. 
206.     # subclasses inherit
207.     for C in (F, FNew, FMeta, G, GNew, GMeta):
208.         assert formatsig('class', 'C', C, None, None) == '(a, b=None)'
209.     assert formatsig('class', 'C', D, 'a, b', 'X') == '(a, b) -> X'
210. 
211.     class ListSubclass(list):
212.         pass
213. 
214.     # only supported if the python implementation decides to document it
215.     if getattr(list, '__text_signature__', None) is not None:
216.         assert formatsig('class', 'C', ListSubclass, None, None) == '(iterable=(), /)'
217.     else:
218.         assert formatsig('class', 'C', ListSubclass, None, None) == ''
219. 
220.     class ExceptionSubclass(Exception):
221.         pass
222. 
223.     # Exception has no __text_signature__ at least in Python 3.8
224.     if getattr(Exception, '__text_signature__', None) is None:
225.         assert formatsig('class', 'C', ExceptionSubclass, None, None) == ''
226. 
227.     # __init__ have signature at first line of docstring
228.     directive.env.config.autoclass_content = 'both'
229. 
230.     class F2:
231.         '''some docstring for F2.'''
232.         def __init__(self, *args, **kw):
233.             '''
234.             __init__(a1, a2, kw1=True, kw2=False)
235. 
236.             some docstring for __init__.
237.             '''
238.     class G2(F2):
239.         pass
240. 
241.     assert formatsig('class', 'F2', F2, None, None) == \
242.         '(a1, a2, kw1=True, kw2=False)'
243.     assert formatsig('class', 'G2', G2, None, None) == \
244.         '(a1, a2, kw1=True, kw2=False)'
245. 
246.     # test for methods
247.     class H:
248.         def foo1(self, b, *c):
249.             pass
250. 
251.         def foo2(b, *c):
252.             pass
253. 
254.         def foo3(self, d='\n'):
255.             pass
256.     assert formatsig('method', 'H.foo', H.foo1, None, None) == '(b, *c)'
257.     assert formatsig('method', 'H.foo', H.foo1, 'a', None) == '(a)'
258.     assert formatsig('method', 'H.foo', H.foo2, None, None) == '(*c)'
259.     assert formatsig('method', 'H.foo', H.foo3, None, None) == r"(d='\n')"
260. 
261.     # test bound methods interpreted as functions
262.     assert formatsig('function', 'foo', H().foo1, None, None) == '(b, *c)'
263.     assert formatsig('function', 'foo', H().foo2, None, None) == '(*c)'
264.     assert formatsig('function', 'foo', H().foo3, None, None) == r"(d='\n')"
265. 
266.     # test exception handling (exception is caught and args is '')
267.     directive.env.config.autodoc_docstring_signature = False
268.     assert formatsig('function', 'int', int, None, None) == ''
269. 
270.     # test processing by event handler
271.     assert formatsig('method', 'bar', H.foo1, None, None) == '42'
272. 
273.     # test functions created via functools.partial
274.     from functools import partial
275.     curried1 = partial(lambda a, b, c: None, 'A')
276.     assert formatsig('function', 'curried1', curried1, None, None) == \
277.         '(b, c)'
278.     curried2 = partial(lambda a, b, c=42: None, 'A')
279.     assert formatsig('function', 'curried2', curried2, None, None) == \
280.         '(b, c=42)'
281.     curried3 = partial(lambda a, b, *c: None, 'A')
282.     assert formatsig('function', 'curried3', curried3, None, None) == \
283.         '(b, *c)'
284.     curried4 = partial(lambda a, b, c=42, *d, **e: None, 'A')
285.     assert formatsig('function', 'curried4', curried4, None, None) == \
286.         '(b, c=42, *d, **e)'
287. 
288. 
289. @pytest.mark.sphinx('html', testroot='ext-autodoc')
290. def test_autodoc_process_signature_typing_generic(app):
291.     actual = do_autodoc(app, 'class', 'target.generic_class.A', {})
292. 
293.     assert list(actual) == [
294.         '',
295.         '.. py:class:: A(a, b=None)',
296.         '   :module: target.generic_class',
297.         '',
298.         '   docstring for A',
299.         '',
300.     ]
301. 
302. 
303. def test_autodoc_process_signature_typehints(app):
304.     captured = []
305. 
306.     def process_signature(*args):
307.         captured.append(args)
308. 
309.     app.connect('autodoc-process-signature', process_signature)
310. 
311.     def func(x: int, y: int) -> int:
312.         pass
313. 
314.     directive = make_directive_bridge(app.env)
315.     inst = app.registry.documenters['function'](directive, 'func')
316.     inst.fullname = 'func'
317.     inst.object = func
318.     inst.objpath = ['func']
319.     inst.format_signature()
320.     assert captured == [(app, 'function', 'func', func,
321.                          directive.genopt, '(x: int, y: int)', 'int')]
322. 
323. 
324. def test_get_doc(app):
325.     directive = make_directive_bridge(app.env)
326. 
327.     def getdocl(objtype, obj):
328.         inst = app.registry.documenters[objtype](directive, 'tmp')
329.         inst.parent = object  # dummy
330.         inst.object = obj
331.         inst.objpath = [obj.__name__]
332.         inst.doc_as_attr = False
333.         inst.format_signature()  # handle docstring signatures!
334.         ds = inst.get_doc()
335.         # for testing purposes, concat them and strip the empty line at the end
336.         res = sum(ds, [])[:-1]
337.         print(res)
338.         return res
339. 
340.     # objects without docstring
341.     def f():
342.         pass
343.     assert getdocl('function', f) == []
344. 
345.     # standard function, diverse docstring styles...
346.     def f():
347.         """Docstring"""
348.     def g():
349.         """
350.         Docstring
351.         """
352.     for func in (f, g):
353.         assert getdocl('function', func) == ['Docstring']
354. 
355.     # first line vs. other lines indentation
356.     def f():
357.         """First line
358. 
359.         Other
360.           lines
361.         """
362.     assert getdocl('function', f) == ['First line', '', 'Other', '  lines']
363. 
364.     # charset guessing (this module is encoded in utf-8)
365.     def f():
366.         """Döcstring"""
367.     assert getdocl('function', f) == ['Döcstring']
368. 
369.     # verify that method docstrings get extracted in both normal case
370.     # and in case of bound method posing as a function
371.     class J:  # NOQA
372.         def foo(self):
373.             """Method docstring"""
374.     assert getdocl('method', J.foo) == ['Method docstring']
375.     assert getdocl('function', J().foo) == ['Method docstring']
376. 
377. 
378. @pytest.mark.sphinx('html', testroot='ext-autodoc')
379. def test_new_documenter(app):
380.     class MyDocumenter(ModuleLevelDocumenter):
381.         objtype = 'integer'
382.         directivetype = 'integer'
383.         priority = 100
384. 
385.         @classmethod
386.         def can_document_member(cls, member, membername, isattr, parent):
387.             return isinstance(member, int)
388. 
389.         def document_members(self, all_members=False):
390.             return
391. 
392.     app.add_autodocumenter(MyDocumenter)
393. 
394.     options = {"members": 'integer'}
395.     actual = do_autodoc(app, 'module', 'target', options)
396.     assert list(actual) == [
397.         '',
398.         '.. py:module:: target',
399.         '',
400.         '',
401.         '.. py:integer:: integer',
402.         '   :module: target',
403.         '',
404.         '   documentation for the integer',
405.         '',
406.     ]
407. 
408. 
409. def test_attrgetter_using(app):
410.     from target import Class
411.     from target.inheritance import Derived
412. 
413.     directive = make_directive_bridge(app.env)
414. 
415.     def assert_getter_works(objtype, name, obj, attrs=[], **kw):
416.         getattr_spy = []
417. 
418.         def special_getattr(obj, name, *defargs):
419.             if name in attrs:
420.                 getattr_spy.append((obj, name))
421.                 return None
422.             return getattr(obj, name, *defargs)
423.         app.add_autodoc_attrgetter(type, special_getattr)
424. 
425.         del getattr_spy[:]
426.         inst = app.registry.documenters[objtype](directive, name)
427.         inst.generate(**kw)
428. 
429.         hooked_members = [s[1] for s in getattr_spy]
430.         documented_members = [s[1] for s in processed_signatures]
431.         for attr in attrs:
432.             fullname = '.'.join((name, attr))
433.             assert attr in hooked_members
434.             assert fullname not in documented_members, \
435.                 '%r was not hooked by special_attrgetter function' % fullname
436. 
437.     with catch_warnings(record=True):
438.         directive.genopt['members'] = ALL
439.         directive.genopt['inherited_members'] = False
440.         print(directive.genopt)
441.         assert_getter_works('class', 'target.Class', Class, ['meth'])
442. 
443.         directive.genopt['inherited_members'] = True
444.         assert_getter_works('class', 'target.inheritance.Derived', Derived, ['inheritedmeth'])
445. 
446. 
447. @pytest.mark.sphinx('html', testroot='ext-autodoc')
448. def test_py_module(app, warning):
449.     # without py:module
450.     actual = do_autodoc(app, 'method', 'Class.meth')
451.     assert list(actual) == []
452.     assert ("don't know which module to import for autodocumenting 'Class.meth'"
453.             in warning.getvalue())
454. 
455.     # with py:module
456.     app.env.ref_context['py:module'] = 'target'
457.     warning.truncate(0)
458. 
459.     actual = do_autodoc(app, 'method', 'Class.meth')
460.     assert list(actual) == [
461.         '',
462.         '.. py:method:: Class.meth()',
463.         '   :module: target',
464.         '',
465.         '   Function.',
466.         '',
467.     ]
468.     assert ("don't know which module to import for autodocumenting 'Class.meth'"
469.             not in warning.getvalue())
470. 
471. 
472. @pytest.mark.sphinx('html', testroot='ext-autodoc')
473. def test_autodoc_decorator(app):
474.     actual = do_autodoc(app, 'decorator', 'target.decorator.deco1')
475.     assert list(actual) == [
476.         '',
477.         '.. py:decorator:: deco1',
478.         '   :module: target.decorator',
479.         '',
480.         '   docstring for deco1',
481.         '',
482.     ]
483. 
484.     actual = do_autodoc(app, 'decorator', 'target.decorator.deco2')
485.     assert list(actual) == [
486.         '',
487.         '.. py:decorator:: deco2(condition, message)',
488.         '   :module: target.decorator',
489.         '',
490.         '   docstring for deco2',
491.         '',
492.     ]
493. 
494. 
495. @pytest.mark.sphinx('html', testroot='ext-autodoc')
496. def test_autodoc_exception(app):
497.     actual = do_autodoc(app, 'exception', 'target.CustomEx')
498.     assert list(actual) == [
499.         '',
500.         '.. py:exception:: CustomEx',

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 02:25:33,508 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find test cases related to a bug in parsing typed `:param` fields in docstrings. The initial context from `tests/test_domain_py.py` and `tests/test_ext_autodoc.py` did not contain specific tests for this functionality. The bug is related to `autodoc` and the underlying doc-field parsing. Therefore, the most relevant files to inspect are the test sources for `autodoc` integration tests, which are likely to contain examples of complex types in docstrings, and any unit tests for docutils field processing.' query='Please provide the content of `tests/roots/test-ext-autodoc/target/typehints.py`, `tests/roots/test-ext-autodoc/index.rst`, and `tests/test_util_docutils.py`.' extra_requirements='If providing all files is not possible, please prioritize `tests/roots/test-ext-autodoc/target/typehints.py` and `tests/test_util_docutils.py`.' purpose='These files are needed to find existing test cases that cover the parsing of complex data types in docstring parameter fields, which is central to the reported bug.'
2025-12-21 02:25:33,509 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the content of `tests/roots/test-ext-autodoc/target/typehints.py`, `tests/roots/test-ext-autodoc/index.rst`, and `tests/test_util_docutils.py`.
2025-12-21 02:25:33,509 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-21 02:25:33,510 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-21 02:25:33,510 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-21 02:25:33,510 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the content of `tests/roots/test-ext-autodoc/target/typehints.py`, `tests/roots/test-ext-autodoc/index.rst`, and `tests/test_util_docutils.py`.
Extra requirements: If providing all files is not possible, please prioritize `tests/roots/test-ext-autodoc/target/typehints.py` and `tests/test_util_docutils.py`.
Purpose: These files are needed to find existing test cases that cover the parsing of complex data types in docstring parameter fields, which is central to the reported bug.
2025-12-21 02:25:36,124 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I will fetch the contents of the three requested files to help you find existing test cases related to parsing complex data types in docstring parameter fields.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/test_util_docutils.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2166, 'candidates_token_count': 112, 'total_token_count': 2378, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2166}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 112}], 'thoughts_token_count': 100, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.04094764590263367, 'model_name': 'gemini-2.5-pro'} id='run--632e195a-94b4-4dbf-938d-90edb2001b6a-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/roots/test-ext-autodoc/target/typehints.py'}, 'id': 'f6a362e6-193b-4d6f-ae9a-84c2be845897', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/roots/test-ext-autodoc/index.rst'}, 'id': '8dcb0cee-e340-400d-a65f-0c500426ae8a', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/test_util_docutils.py'}, 'id': 'd5e583b0-1330-45c3-9a85-e7a92caa6820', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2166, 'output_tokens': 112, 'total_tokens': 2378, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 100}}
2025-12-21 02:25:44,604 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have successfully retrieved the contents of the three files you requested: `tests/roots/test-ext-autodoc/target/typehints.py`, `tests/roots/test-ext-autodoc/index.rst`, and `tests/test_util_docutils.py`. You can now examine these files for existing test cases that cover the parsing of complex data types in docstring parameter fields, which you mentioned is central to the bug you are investigating. The `typehints.py` file should be particularly useful as it contains numerous examples of complex type hints.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 4651, 'candidates_token_count': 119, 'total_token_count': 5546, 'cached_content_token_count': 1686, 'prompt_tokens_details': [{'modality': 1, 'token_count': 4651}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1686}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 119}], 'thoughts_token_count': 776}, 'finish_reason': 'STOP', 'avg_logprobs': -0.6281744051380318, 'model_name': 'gemini-2.5-pro'} id='run--1b6d8a88-7671-4178-a793-36fed8d423c6-0' usage_metadata={'input_tokens': 4651, 'output_tokens': 119, 'total_tokens': 5546, 'input_token_details': {'cache_read': 1686}, 'output_token_details': {'reasoning': 776}}
2025-12-21 02:25:44,605 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the content of `tests/roots/test-ext-autodoc/target/typehints.py`, `tests/roots/test-ext-autodoc/index.rst`, and `tests/test_util_docutils.py`.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If providing all files is not possible, please prioritize `tests/roots/test-ext-autodoc/target/typehints.py` and `tests/test_util_docutils.py`.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
These files are needed to find existing test cases that cover the parsing of complex data types in docstring parameter fields, which is central to the reported bug.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/roots/test-ext-autodoc/index.rst
Line number range: 1 - 15
Content:
1. 
2. .. automodule:: autodoc_dummy_module
3.    :members:
4. 
5. .. automodule:: bug2437.autodoc_dummy_foo
6.    :members:
7. 
8. .. automodule:: autodoc_dummy_bar
9.    :members:
10. 
11. .. autofunction:: target.typehints.incr
12. 
13. .. autofunction:: target.overload.sum
14. 
15. .. autofunction:: target.typehints.tuple_args


File: tests/roots/test-ext-autodoc/target/typehints.py
Line number range: 1 - 80
Content:
1. from typing import Any, Tuple, Union
2. 
3. 
4. def incr(a: int, b: int = 1) -> int:
5.     return a + b
6. 
7. 
8. def decr(a, b = 1):
9.     # type: (int, int) -> int
10.     return a - b
11. 
12. 
13. class Math:
14.     def __init__(self, s: str, o: Any = None) -> None:
15.         pass
16. 
17.     def incr(self, a: int, b: int = 1) -> int:
18.         return a + b
19. 
20.     def decr(self, a, b = 1):
21.         # type: (int, int) -> int
22.         return a - b
23. 
24.     def nothing(self):
25.         # type: () -> None
26.         pass
27. 
28.     def horse(self,
29.               a,  # type: str
30.               b,  # type: int
31.               ):
32.         # type: (...) -> None
33.         return
34. 
35. 
36. def tuple_args(x: Tuple[int, Union[int, str]]) -> Tuple[int, int]:
37.     pass
38. 
39. 
40. class NewAnnotation:
41.     def __new__(cls, i: int) -> 'NewAnnotation':
42.         pass
43. 
44. 
45. class NewComment:
46.     def __new__(cls, i):
47.         # type: (int) -> NewComment
48.         pass
49. 
50. 
51. class _MetaclassWithCall(type):
52.     def __call__(cls, a: int):
53.         pass
54. 
55. 
56. class SignatureFromMetaclass(metaclass=_MetaclassWithCall):
57.     pass
58. 
59. 
60. def complex_func(arg1, arg2, arg3=None, *args, **kwargs):
61.     # type: (str, List[int], Tuple[int, Union[str, Unknown]], *str, **str) -> None
62.     pass
63. 
64. 
65. def missing_attr(c,
66.                  a,  # type: str
67.                  b=None  # type: Optional[str]
68.                  ):
69.     # type: (...) -> str
70.     return a + (b or "")
71. 
72. 
73. class _ClassWithDocumentedInit:
74.     """Class docstring."""
75. 
76.     def __init__(self, x: int) -> None:
77.         """Init docstring.
78. 
79.         :param x: Some integer
80.         """


File: tests/test_util_docutils.py
Line number range: 1 - 95
Content:
1. """
2.     test_util_docutils
3.     ~~~~~~~~~~~~~~~~~~
4. 
5.     Tests util.utils functions.
6. 
7.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import os
12. 
13. from docutils import nodes
14. 
15. from sphinx.util.docutils import (SphinxFileOutput, SphinxTranslator, docutils_namespace,
16.                                   new_document, register_node)
17. 
18. 
19. def test_register_node():
20.     class custom_node(nodes.Element):
21.         pass
22. 
23.     with docutils_namespace():
24.         register_node(custom_node)
25. 
26.         # check registered
27.         assert hasattr(nodes.GenericNodeVisitor, 'visit_custom_node')
28.         assert hasattr(nodes.GenericNodeVisitor, 'depart_custom_node')
29.         assert hasattr(nodes.SparseNodeVisitor, 'visit_custom_node')
30.         assert hasattr(nodes.SparseNodeVisitor, 'depart_custom_node')
31. 
32.     # check unregistered outside namespace
33.     assert not hasattr(nodes.GenericNodeVisitor, 'visit_custom_node')
34.     assert not hasattr(nodes.GenericNodeVisitor, 'depart_custom_node')
35.     assert not hasattr(nodes.SparseNodeVisitor, 'visit_custom_node')
36.     assert not hasattr(nodes.SparseNodeVisitor, 'depart_custom_node')
37. 
38. 
39. def test_SphinxFileOutput(tmpdir):
40.     content = 'Hello Sphinx World'
41. 
42.     # write test.txt at first
43.     filename = str(tmpdir / 'test.txt')
44.     output = SphinxFileOutput(destination_path=filename)
45.     output.write(content)
46.     os.utime(filename, (0, 0))
47. 
48.     # overrite it again
49.     output.write(content)
50.     assert os.stat(filename).st_mtime != 0  # updated
51. 
52.     # write test2.txt at first
53.     filename = str(tmpdir / 'test2.txt')
54.     output = SphinxFileOutput(destination_path=filename, overwrite_if_changed=True)
55.     output.write(content)
56.     os.utime(filename, (0, 0))
57. 
58.     # overrite it again
59.     output.write(content)
60.     assert os.stat(filename).st_mtime == 0  # not updated
61. 
62.     # overrite it again (content changed)
63.     output.write(content + "; content change")
64.     assert os.stat(filename).st_mtime != 0  # updated
65. 
66. 
67. def test_SphinxTranslator(app):
68.     class CustomNode(nodes.inline):
69.         pass
70. 
71.     class MyTranslator(SphinxTranslator):
72.         def __init__(self, *args):
73.             self.called = []
74.             super().__init__(*args)
75. 
76.         def visit_document(self, node):
77.             pass
78. 
79.         def depart_document(self, node):
80.             pass
81. 
82.         def visit_inline(self, node):
83.             self.called.append('visit_inline')
84. 
85.         def depart_inline(self, node):
86.             self.called.append('depart_inline')
87. 
88.     document = new_document('')
89.     document += CustomNode()
90. 
91.     translator = MyTranslator(document, app.builder)
92.     document.walkabout(translator)
93. 
94.     # MyTranslator does not have visit_CustomNode. But it calls visit_inline instead.
95.     assert translator.called == ['visit_inline', 'depart_inline']

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-21 02:25:53,173 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="1. Query requirement analysis:\n   - The user query explicitly asks for the content of the file `tests/roots/test-ext-autodoc/target/typehints.py`.\n   - The purpose is to find test cases for parsing complex data types in docstrings, and this file contains various functions with type hints.\n2. Extended relevance:\n   - This file is central to the user's goal as it defines Python functions with different kinds of type annotations, which are then used in tests for Sphinx's autodoc extension.", relative_path='tests/roots/test-ext-autodoc/target/typehints.py', start_line=1, end_line=80), ContextOutput(reasoning='1. Query requirement analysis:\n   - The user query explicitly asks for the content of the file `tests/roots/test-ext-autodoc/index.rst`.\n   - This file is the root document for the `test-ext-autodoc` test, and it includes the directives to document the code from `target/typehints.py`.\n2. Extended relevance:\n   - Understanding this file is necessary to see how the Python objects from `typehints.py` are being imported and documented by Sphinx, which is crucial for debugging the docstring parsing.', relative_path='tests/roots/test-ext-autodoc/index.rst', start_line=1, end_line=15), ContextOutput(reasoning='1. Query requirement analysis:\n   - The user query explicitly asks for the content of the file `tests/test_util_docutils.py`.\n   - The purpose is to find existing test cases related to parsing, and this file contains tests for docutils, the underlying parsing library used by Sphinx.\n2. Extended relevance:\n   - This file provides insight into how docutils is being used and tested within the Sphinx project, which can be relevant for understanding how docstrings are parsed and handled.', relative_path='tests/test_util_docutils.py', start_line=1, end_line=95)]
2025-12-21 02:25:53,174 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 3 contexts to memory for query: Please provide the content of `tests/roots/test-ext-autodoc/target/typehints.py`, `tests/roots/test-ext-autodoc/index.rst`, and `tests/test_util_docutils.py`.
2025-12-21 02:25:53,174 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-21 02:25:53,174 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-21 02:25:53,174 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 3 new contexts to 2 existing contexts
2025-12-21 02:25:53,175 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 5 total contexts (removed 0 duplicates)
2025-12-21 02:25:53,175 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sphinx
├── .circleci
|   └── config.yml
├── .codecov.yml
├── .github
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.md
|   |   ├── config.yml
|   |   └── feature_request.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   └── workflows
|       ├── builddoc.yml
|       ├── lint.yml
|       ├── main.yml
|       ├── nodejs.yml
|       └── transifex.yml
├── .readthedocs.yml
├── CONTRIBUTING.rst
├── README.rst
├── bindep.txt
├── doc
|   ├── _static
|   |   ├── conf.py.txt
|   |   └── themes
|   |       └── fullsize
|   ├── _templates
|   |   ├── index.html
|   |   └── indexsidebar.html
|   ├── _themes
|   |   └── sphinx13
|   |       ├── layout.html
|   |       └── static
|   |           └── sphinx13.css
|   ├── changes.rst
|   ├── conf.py
|   ├── contents.rst
|   ├── development
|   |   ├── builders.rst
|   |   ├── index.rst
|   |   ├── overview.rst
|   |   ├── theming.rst
|   |   └── tutorials
|   |       ├── autodoc_ext.rst
|   |       ├── examples
|   |       |   ├── README.rst
|   |       |   ├── autodoc_intenum.py
|   |       |   ├── helloworld.py
|   |       |   ├── recipe.py
|   |       |   └── todo.py
|   |       ├── helloworld.rst
|   |       ├── index.rst
|   |       ├── recipe.rst
|   |       └── todo.rst
|   ├── examples.rst
|   ├── extdev
|   |   ├── appapi.rst
|   |   ├── builderapi.rst
|   |   ├── collectorapi.rst
|   |   ├── deprecated.rst
|   |   ├── domainapi.rst
|   |   ├── envapi.rst
|   |   ├── i18n.rst
|   |   ├── index.rst
|   |   ├── logging.rst
|   |   ├── markupapi.rst
|   |   ├── nodes.rst
|   |   ├── parserapi.rst
|   |   ├── projectapi.rst
|   |   └── utils.rst
|   ├── faq.rst
|   ├── glossary.rst
|   ├── internals
|   |   ├── authors.rst
|   |   ├── code-of-conduct.rst
|   |   ├── contributing.rst
|   |   ├── index.rst
|   |   ├── organization.rst
|   |   └── release-process.rst
|   ├── latex.rst
|   ├── man
|   |   ├── index.rst
|   |   ├── sphinx-apidoc.rst
|   |   ├── sphinx-autogen.rst
|   |   ├── sphinx-build.rst
|   |   └── sphinx-quickstart.rst
|   ├── templating.rst
|   └── usage
|       ├── advanced
|       |   ├── intl.rst
|       |   ├── setuptools.rst
|       |   └── websupport
|       |       ├── api.rst
|       |       ├── index.rst
|       |       ├── quickstart.rst
|       |       ├── searchadapters.rst
|       |       └── storagebackends.rst
|       ├── builders
|       |   └── index.rst
|       ├── configuration.rst
|       ├── extensions
|       |   ├── autodoc.rst
|       |   ├── autosectionlabel.rst
|       |   ├── autosummary.rst
|       |   ├── coverage.rst
|       |   ├── doctest.rst
|       |   ├── duration.rst
|       |   ├── example_google.py
|       |   ├── example_google.rst
|       |   ├── example_numpy.py
|       |   ├── example_numpy.rst
|       |   ├── extlinks.rst
|       |   ├── githubpages.rst
|       |   ├── graphviz.rst
|       |   ├── ifconfig.rst
|       |   ├── imgconverter.rst
|       |   ├── index.rst
|       |   ├── inheritance.rst
|       |   ├── intersphinx.rst
|       |   ├── linkcode.rst
|       |   ├── math.rst
|       |   ├── napoleon.rst
|       |   ├── todo.rst
|       |   └── viewcode.rst
|       ├── index.rst
|       ├── installation.rst
|       ├── markdown.rst
|       ├── quickstart.rst
|       ├── restructuredtext
|       |   ├── basics.rst
|       |   ├── directives.rst
|       |   ├── domains.rst
|       |   ├── field-lists.rst
|       |   ├── index.rst
|       |   └── roles.rst
|       └── theming.rst
├── karma.conf.js
├── setup.py
├── sphinx
|   ├── __init__.py
|   ├── __main__.py
|   ├── addnodes.py
|   ├── application.py
|   ├── builders
|   |   ├── __init__.py
|   |   ├── _epub_base.py
|   |   ├── changes.py
|   |   ├── dirhtml.py
|   |   ├── dummy.py
|   |   ├── epub3.py
|   |   ├── gettext.py
|   |   ├── html
|   |   |   ├── __init__.py
|   |   |   └── transforms.py
|   |   ├── latex
|   |   |   ├── __init__.py
|   |   |   ├── constants.py
|   |   |   ├── nodes.py
|   |   |   ├── theming.py
|   |   |   ├── transforms.py
|   |   |   └── util.py
|   |   ├── linkcheck.py
|   |   ├── manpage.py
|   |   ├── singlehtml.py
|   |   ├── texinfo.py
|   |   ├── text.py
|   |   └── xml.py
|   ├── cmd
|   |   ├── __init__.py
|   |   ├── build.py
|   |   ├── make_mode.py
|   |   └── quickstart.py
|   ├── config.py
|   ├── deprecation.py
|   ├── directives
|   |   ├── __init__.py
|   |   ├── code.py
|   |   ├── other.py
|   |   └── patches.py
|   ├── domains
|   |   ├── __init__.py
|   |   ├── c.py
|   |   ├── changeset.py
|   |   ├── citation.py
|   |   ├── cpp.py
|   |   ├── index.py
|   |   ├── javascript.py
|   |   ├── math.py
|   |   ├── python.py
|   |   ├── rst.py
|   |   └── std.py
|   ├── environment
|   |   ├── __init__.py
|   |   ├── adapters
|   |   |   ├── __init__.py
|   |   |   ├── asset.py
|   |   |   ├── indexentries.py
|   |   |   └── toctree.py
|   |   └── collectors
|   |       ├── __init__.py
|   |       ├── asset.py
|   |       ├── dependencies.py
|   |       ├── metadata.py
|   |       ├── title.py
|   |       └── toctree.py
|   ├── errors.py
|   ├── events.py
|   ├── ext
|   |   ├── __init__.py
|   |   ├── apidoc.py
|   |   ├── autodoc
|   |   |   ├── __init__.py
|   |   |   ├── deprecated.py
|   |   |   ├── directive.py
|   |   |   ├── importer.py
|   |   |   ├── mock.py
|   |   |   ├── preserve_defaults.py
|   |   |   ├── type_comment.py
|   |   |   └── typehints.py
|   |   ├── autosectionlabel.py
|   |   ├── autosummary
|   |   |   ├── __init__.py
|   |   |   ├── generate.py
|   |   |   └── templates
|   |   |       └── autosummary
|   |   ├── coverage.py
|   |   ├── doctest.py
|   |   ├── duration.py
|   |   ├── extlinks.py
|   |   ├── githubpages.py
|   |   ├── graphviz.py
|   |   ├── ifconfig.py
|   |   ├── imgconverter.py
|   |   ├── imgmath.py
|   |   ├── inheritance_diagram.py
|   |   ├── intersphinx.py
|   |   ├── linkcode.py
|   |   ├── mathjax.py
|   |   ├── napoleon
|   |   |   ├── __init__.py
|   |   |   ├── docstring.py
|   |   |   └── iterators.py
|   |   ├── todo.py
|   |   └── viewcode.py
|   ├── extension.py
|   ├── highlighting.py
|   ├── io.py
|   ├── jinja2glue.py
|   ├── locale
|   |   ├── __init__.py
|   |   ├── ar
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bg
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bn
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ca
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cak
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cs
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cy
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── da
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── de
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── el
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eo
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── es
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── et
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fa
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── he
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi_IN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── id
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── it
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ja
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ko
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── mk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nb_NO
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ne
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_BR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_PT
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ro
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ru
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── si
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sq
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr@latin
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr_RS
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ta
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── te
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── tr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── uk_UA
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ur
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── vi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_CN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   └── zh_TW
|   |       └── LC_MESSAGES
|   |           └── sphinx.js
|   ├── parsers.py
|   ├── project.py
|   ├── pycode
|   |   ├── __init__.py
|   |   ├── ast.py
|   |   └── parser.py
|   ├── pygments_styles.py
|   ├── registry.py
|   ├── roles.py
|   ├── search
|   |   ├── __init__.py
|   |   ├── da.py
|   |   ├── de.py
|   |   ├── en.py
|   |   ├── es.py
|   |   ├── fi.py
|   |   ├── fr.py
|   |   ├── hu.py
|   |   ├── it.py
|   |   ├── ja.py
|   |   ├── jssplitter.py
|   |   ├── minified-js
|   |   |   ├── base-stemmer.js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── nl.py
|   |   ├── no.py
|   |   ├── non-minified-js
|   |   |   ├── base-stemmer.js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── pt.py
|   |   ├── ro.py
|   |   ├── ru.py
|   |   ├── sv.py
|   |   ├── tr.py
|   |   └── zh.py
|   ├── setup_command.py
|   ├── templates
|   |   ├── apidoc
|   |   ├── epub3
|   |   |   └── container.xml
|   |   ├── gettext
|   |   ├── graphviz
|   |   |   └── graphviz.css
|   |   ├── htmlhelp
|   |   ├── imgmath
|   |   ├── latex
|   |   ├── quickstart
|   |   └── texinfo
|   ├── testing
|   |   ├── __init__.py
|   |   ├── comparer.py
|   |   ├── fixtures.py
|   |   ├── path.py
|   |   ├── restructuredtext.py
|   |   └── util.py
|   ├── texinputs
|   ├── texinputs_win
|   ├── themes
|   |   ├── agogo
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── basic
|   |   |   ├── changes
|   |   |   |   ├── frameset.html
|   |   |   |   ├── rstsource.html
|   |   |   |   └── versionchanges.html
|   |   |   ├── defindex.html
|   |   |   ├── domainindex.html
|   |   |   ├── genindex-single.html
|   |   |   ├── genindex-split.html
|   |   |   ├── genindex.html
|   |   |   ├── globaltoc.html
|   |   |   ├── layout.html
|   |   |   ├── localtoc.html
|   |   |   ├── opensearch.xml
|   |   |   ├── page.html
|   |   |   ├── relations.html
|   |   |   ├── search.html
|   |   |   ├── searchbox.html
|   |   |   ├── sourcelink.html
|   |   |   └── static
|   |   |       ├── doctools.js
|   |   |       ├── jquery-3.5.1.js
|   |   |       ├── jquery.js
|   |   |       ├── searchtools.js
|   |   |       ├── underscore-1.13.1.js
|   |   |       └── underscore.js
|   |   ├── bizstyle
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── css3-mediaqueries.js
|   |   |       └── css3-mediaqueries_src.js
|   |   ├── classic
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── default
|   |   |   └── static
|   |   |       └── default.css
|   |   ├── epub
|   |   |   ├── epub-cover.html
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── haiku
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── nature
|   |   |   └── static
|   |   ├── nonav
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       └── nonav.css
|   |   ├── pyramid
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── epub.css
|   |   |       └── ie6.css
|   |   ├── scrolls
|   |   |   ├── artwork
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── print.css
|   |   |       └── theme_extras.js
|   |   ├── sphinxdoc
|   |   |   └── static
|   |   └── traditional
|   |       └── static
|   ├── theming.py
|   ├── transforms
|   |   ├── __init__.py
|   |   ├── compact_bullet_list.py
|   |   ├── i18n.py
|   |   ├── post_transforms
|   |   |   ├── __init__.py
|   |   |   ├── code.py
|   |   |   └── images.py
|   |   └── references.py
|   ├── util
|   |   ├── __init__.py
|   |   ├── build_phase.py
|   |   ├── cfamily.py
|   |   ├── compat.py
|   |   ├── console.py
|   |   ├── docfields.py
|   |   ├── docstrings.py
|   |   ├── docutils.py
|   |   ├── fileutil.py
|   |   ├── i18n.py
|   |   ├── images.py
|   |   ├── inspect.py
|   |   ├── inventory.py
|   |   ├── jsdump.py
|   |   ├── logging.py
|   |   ├── matching.py
|   |   ├── math.py
|   |   ├── nodes.py
|   |   ├── osutil.py
|   |   ├── parallel.py
|   |   ├── png.py
|   |   ├── pycompat.py
|   |   ├── requests.py
|   |   ├── rst.py
|   |   ├── smartypants.py
|   |   ├── stemmer
|   |   |   ├── __init__.py
|   |   |   └── porter.py
|   |   ├── tags.py
|   |   ├── template.py
|   |   ├── texescape.py
|   |   └── typing.py
|   ├── versioning.py
|   └── writers
|       ├── __init__.py
|       ├── html.py
|       ├── html5.py
|       ├── latex.py
|       ├── manpage.py
|       ├── texinfo.py
|       ├── text.py
|       └── xml.py
├── tests
|   ├── __init__.py
|   ├── certs
|   ├── conftest.py
|   ├── ext_napoleon_pep526_data_google.py
|   ├── ext_napoleon_pep526_data_numpy.py
|   ├── js
|   |   ├── doctools.js
|   |   └── searchtools.js
|   ├── roots
|   |   ├── test-add_enumerable_node
|   |   |   ├── conf.py
|   |   |   ├── enumerable_node.py
|   |   |   └── index.rst
|   |   ├── test-add_source_parser
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-add_source_parser-conflicts-with-users-setting
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-api-set-translator
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nonext
|   |   |   |   └── conf.py
|   |   |   └── translator.py
|   |   ├── test-apidoc-pep420
|   |   |   └── a
|   |   |       └── b
|   |   ├── test-apidoc-subpackage-in-toc
|   |   |   └── parent
|   |   |       ├── __init__.py
|   |   |       └── child
|   |   ├── test-apidoc-toc
|   |   |   └── mypackage
|   |   |       ├── __init__.py
|   |   |       ├── main.py
|   |   |       ├── no_init
|   |   |       ├── resource
|   |   |       └── something
|   |   ├── test-apidoc-trailing-underscore
|   |   |   └── package_
|   |   |       ├── __init__.py
|   |   |       └── module_.py
|   |   ├── test-autosummary
|   |   |   ├── conf.py
|   |   |   ├── dummy_module.py
|   |   |   ├── index.rst
|   |   |   ├── sphinx.rst
|   |   |   └── underscore_module_.py
|   |   ├── test-basic
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-html-translator
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-text
|   |   |   ├── conf.py
|   |   |   ├── doc1.txt
|   |   |   ├── doc2.txt
|   |   |   ├── index.txt
|   |   |   ├── lineblock.txt
|   |   |   ├── listitems.txt
|   |   |   ├── maxwidth.txt
|   |   |   ├── nonascii_maxwidth.txt
|   |   |   ├── nonascii_table.txt
|   |   |   ├── nonascii_title.txt
|   |   |   ├── table.txt
|   |   |   ├── table_colspan.txt
|   |   |   ├── table_colspan_and_rowspan.txt
|   |   |   ├── table_colspan_left.txt
|   |   |   └── table_rowspan.txt
|   |   ├── test-builder-dirhtml
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo
|   |   |   |   ├── foo_1.rst
|   |   |   |   ├── foo_2.rst
|   |   |   |   └── index.rst
|   |   |   └── index.rst
|   |   ├── test-builder-gettext-dont-rebuild-mo
|   |   |   ├── bom.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-changes
|   |   |   ├── base.rst
|   |   |   ├── c-api.rst
|   |   |   ├── conf.py
|   |   |   ├── contents.rst
|   |   |   └── library
|   |   |       └── utils.rst
|   |   ├── test-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-config
|   |   |   └── conf.py
|   |   ├── test-correct-year
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-default_role
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-directive-code
|   |   |   ├── caption.rst
|   |   |   ├── classes.rst
|   |   |   ├── conf.py
|   |   |   ├── emphasize.rst
|   |   |   ├── force.rst
|   |   |   ├── highlight.rst
|   |   |   ├── index.rst
|   |   |   ├── linenos.rst
|   |   |   ├── linenothreshold.rst
|   |   |   ├── namedblocks.rst
|   |   |   ├── py-decorators.rst
|   |   |   ├── python.rst
|   |   |   └── target.py
|   |   ├── test-directive-csv-table
|   |   |   ├── conf.py
|   |   |   └── subdir
|   |   ├── test-directive-only
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── only.rst
|   |   ├── test-directives-raw
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-docutilsconf
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-c
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── conf.py
|   |   |   ├── function_param_target.rst
|   |   |   ├── index.rst
|   |   |   ├── namespace.rst
|   |   |   └── ns_lookup.rst
|   |   ├── test-domain-c-intersphinx
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-cpp
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── any-role.rst
|   |   |   ├── backslash.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── lookup-key-overload.rst
|   |   |   ├── multi-decl-lookup.rst
|   |   |   ├── roles-targets-ok.rst
|   |   |   ├── roles-targets-warn.rst
|   |   |   ├── roles.rst
|   |   |   ├── roles2.rst
|   |   |   ├── semicolon.rst
|   |   |   ├── warn-template-param-qualified-name.rst
|   |   |   └── xref_consistency.rst
|   |   ├── test-domain-cpp-intersphinx
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-js
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py
|   |   |   ├── abbr.rst
|   |   |   ├── canonical.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   ├── module_option.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py-python_use_unqualified_type_names
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-py-xref-warning
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-double-inheriting-theme
|   |   |   ├── base_themes_dir
|   |   |   |   ├── base_theme1
|   |   |   |   └── base_theme2
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-epub-anchor-id
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autodoc
|   |   |   ├── autodoc_dummy_bar.py
|   |   |   ├── autodoc_dummy_module.py
|   |   |   ├── bug2437
|   |   |   |   ├── __init__.py
|   |   |   |   └── autodoc_dummy_foo.py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target
|   |   |       ├── TYPE_CHECKING.py
|   |   |       ├── __init__.py
|   |   |       ├── abstractmethods.py
|   |   |       ├── annotated.py
|   |   |       ├── autoclass_content.py
|   |   |       ├── autodoc_type_aliases.py
|   |   |       ├── bound_method.py
|   |   |       ├── cached_property.py
|   |   |       ├── callable.py
|   |   |       ├── canonical
|   |   |       ├── classes.py
|   |   |       ├── coroutine.py
|   |   |       ├── decorator.py
|   |   |       ├── descriptor.py
|   |   |       ├── docstring_signature.py
|   |   |       ├── empty_all.py
|   |   |       ├── enums.py
|   |   |       ├── final.py
|   |   |       ├── functions.py
|   |   |       ├── generic_class.py
|   |   |       ├── genericalias.py
|   |   |       ├── hide_value.py
|   |   |       ├── imported_members.py
|   |   |       ├── inheritance.py
|   |   |       ├── instance_variable.py
|   |   |       ├── metadata.py
|   |   |       ├── methods.py
|   |   |       ├── module.py
|   |   |       ├── name_conflict
|   |   |       ├── name_mangling.py
|   |   |       ├── need_mocks.py
|   |   |       ├── overload.py
|   |   |       ├── overload2.py
|   |   |       ├── partialfunction.py
|   |   |       ├── partialmethod.py
|   |   |       ├── pep570.py
|   |   |       ├── pep604.py
|   |   |       ├── preserve_defaults.py
|   |   |       ├── private.py
|   |   |       ├── process_docstring.py
|   |   |       ├── properties.py
|   |   |       ├── singledispatch.py
|   |   |       ├── singledispatchmethod.py
|   |   |       ├── slots.py
|   |   |       ├── sort_by_all.py
|   |   |       ├── typed_vars.py
|   |   |       ├── typehints.py
|   |   |       ├── typevar.py
|   |   |       ├── uninitialized_attributes.py
|   |   |       └── wrappedfunction.py
|   |   ├── test-ext-autosectionlabel
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosectionlabel-prefix-document
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── autosummary_importfail.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-filename-map
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-imported_members
|   |   |   ├── autosummary_dummy_package
|   |   |   |   ├── __init__.py
|   |   |   |   └── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-mock_imports
|   |   |   ├── conf.py
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-recursive
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── package
|   |   |   |   ├── __init__.py
|   |   |   |   ├── module.py
|   |   |   |   ├── module_importfail.py
|   |   |   |   └── package
|   |   |   └── package2
|   |   |       ├── __init__.py
|   |   |       └── module.py
|   |   ├── test-ext-autosummary-skip-member
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-autosummary-template
|   |   |   ├── _templates
|   |   |   |   └── empty.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-coverage
|   |   |   ├── conf.py
|   |   |   ├── coverage_ignored.py
|   |   |   ├── coverage_not_ignored.py
|   |   |   └── index.rst
|   |   ├── test-ext-doctest
|   |   |   ├── conf.py
|   |   |   └── doctest.txt
|   |   ├── test-ext-doctest-skipif
|   |   |   ├── conf.py
|   |   |   └── skipif.txt
|   |   ├── test-ext-doctest-with-autodoc
|   |   |   ├── conf.py
|   |   |   ├── dir
|   |   |   |   ├── __init__.py
|   |   |   |   ├── bar.py
|   |   |   |   └── inner.rst
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-githubpages
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-graphviz
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-ifconfig
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-imgconverter
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-inheritance_diagram
|   |   |   ├── conf.py
|   |   |   ├── example
|   |   |   |   ├── __init__.py
|   |   |   |   └── sphinx.py
|   |   |   ├── index.rst
|   |   |   └── test.py
|   |   ├── test-ext-intersphinx-cppdomain
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── math.rst
|   |   |   ├── nomath.rst
|   |   |   └── page.rst
|   |   ├── test-ext-math-compat
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math-simple
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-todo
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-ext-viewcode
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── objects.rst
|   |   |   └── spam
|   |   |       ├── __init__.py
|   |   |       ├── mod1.py
|   |   |       ├── mod2.py
|   |   |       └── mod3.py
|   |   ├── test-ext-viewcode-find
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── not_a_package
|   |   |       ├── __init__.py
|   |   |       └── submodule.py
|   |   ├── test-extensions
|   |   |   ├── conf.py
|   |   |   ├── read_parallel.py
|   |   |   ├── read_serial.py
|   |   |   ├── write_parallel.py
|   |   |   └── write_serial.py
|   |   ├── test-footnotes
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-gettext-template
|   |   |   ├── _templates
|   |   |   |   ├── template1.html
|   |   |   |   └── template2.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-glossary
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-highlight_options
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_assets
|   |   |   ├── conf.py
|   |   |   ├── extra
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   └── subdir
|   |   |   ├── index.rst
|   |   |   ├── static
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   ├── js
|   |   |   |   └── subdir
|   |   |   └── subdir
|   |   |       └── _build
|   |   ├── test-html_entity
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_scaled_image_link
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_style
|   |   |   ├── _static
|   |   |   |   └── default.css
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-parsed-literal
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-section
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-images
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── subdir
|   |   |       └── index.rst
|   |   ├── test-index_on_title
|   |   |   ├── conf.py
|   |   |   └── contents.rst
|   |   ├── test-inheritance
|   |   |   ├── basic_diagram.rst
|   |   |   ├── conf.py
|   |   |   ├── diagram_module_w_2_top_classes.rst
|   |   |   ├── diagram_w_1_top_class.rst
|   |   |   ├── diagram_w_2_top_classes.rst
|   |   |   ├── diagram_w_nested_classes.rst
|   |   |   ├── diagram_w_parts.rst
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── test.py
|   |   |   |   └── test_nested.py
|   |   |   └── index.rst
|   |   ├── test-intl
|   |   |   ├── _templates
|   |   |   |   └── contents.html
|   |   |   ├── admonitions.txt
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── definition_terms.txt
|   |   |   ├── docfields.txt
|   |   |   ├── external_links.txt
|   |   |   ├── figure.txt
|   |   |   ├── footnote.txt
|   |   |   ├── glossary_terms.txt
|   |   |   ├── glossary_terms_inconsistency.txt
|   |   |   ├── index.txt
|   |   |   ├── index_entries.txt
|   |   |   ├── label_target.txt
|   |   |   ├── literalblock.txt
|   |   |   ├── only.txt
|   |   |   ├── raw.txt
|   |   |   ├── refs.txt
|   |   |   ├── refs_inconsistency.txt
|   |   |   ├── refs_python_domain.txt
|   |   |   ├── role_xref.txt
|   |   |   ├── rubric.txt
|   |   |   ├── section.txt
|   |   |   ├── seealso.txt
|   |   |   ├── subdir
|   |   |   |   └── index.txt
|   |   |   ├── table.txt
|   |   |   ├── toctree.txt
|   |   |   ├── topic.txt
|   |   |   ├── versionchange.txt
|   |   |   ├── warnings.txt
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-keep_warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-babel
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-latex-equations
|   |   |   ├── conf.py
|   |   |   ├── equations.rst
|   |   |   └── expects
|   |   ├── test-latex-figure-in-admonition
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-includegraphics
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-index
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-labels
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── otherdoc.rst
|   |   ├── test-latex-numfig
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── indexhowto.rst
|   |   |   └── indexmanual.rst
|   |   ├── test-latex-table
|   |   |   ├── _mytemplates
|   |   |   |   └── latex
|   |   |   ├── complex.rst
|   |   |   ├── conf.py
|   |   |   ├── expects
|   |   |   ├── index.rst
|   |   |   ├── longtable.rst
|   |   |   └── tabular.rst
|   |   ├── test-latex-theme
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── theme
|   |   |       └── custom
|   |   ├── test-latex-title
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-unicode
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck
|   |   |   ├── conf.py
|   |   |   └── links.txt
|   |   ├── test-linkcheck-localserver
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-anchor
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-https
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-locale
|   |   |   ├── locale1
|   |   |   |   └── en
|   |   |   └── locale2
|   |   |       └── en
|   |   ├── test-manpage_url
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-citation
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-rubric
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-maxlistdepth
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-metadata
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-need-escaped
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux.rst
|   |   ├── test-nested-enumerated-list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nested-tables
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nitpicky-warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-numbered-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-numfig
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-productionlist
|   |   |   ├── Bare.rst
|   |   |   ├── Dup1.rst
|   |   |   ├── Dup2.rst
|   |   |   ├── LineContinuation.rst
|   |   |   ├── P1.rst
|   |   |   ├── P2.rst
|   |   |   ├── conf.py
|   |   |   ├── firstLineRule.rst
|   |   |   └── index.rst
|   |   ├── test-prolog
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── markdown.md
|   |   |   ├── prolog_markdown_parser.py
|   |   |   └── restructuredtext.rst
|   |   ├── test-pycode
|   |   |   └── cp_1251_coded.py
|   |   ├── test-pycode-egg
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── src
|   |   |       ├── sample.py
|   |   |       └── setup.py
|   |   ├── test-reST-code-block
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-refonly_bullet_list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-roles-download
|   |   |   ├── another
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-root
|   |   |   ├── _templates
|   |   |   |   ├── contentssb.html
|   |   |   |   ├── customsb.html
|   |   |   |   └── layout.html
|   |   |   ├── autodoc.txt
|   |   |   ├── autodoc_target.py
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── extapi.txt
|   |   |   ├── extensions.txt
|   |   |   ├── footnote.txt
|   |   |   ├── images.txt
|   |   |   ├── includes.txt
|   |   |   ├── index.txt
|   |   |   ├── lists.txt
|   |   |   ├── markup.txt
|   |   |   ├── math.txt
|   |   |   ├── objects.txt
|   |   |   ├── parsermod.py
|   |   |   ├── special
|   |   |   |   └── code.py
|   |   |   └── subdir
|   |   |       ├── excluded.txt
|   |   |       ├── images.txt
|   |   |       └── includes.txt
|   |   ├── test-search
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nosearch.rst
|   |   |   └── tocitem.rst
|   |   ├── test-setup
|   |   |   ├── doc
|   |   |   |   ├── conf.py
|   |   |   |   └── index.txt
|   |   |   └── setup.py
|   |   ├── test-smartquotes
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-stylesheets
|   |   |   ├── _templates
|   |   |   |   └── layout.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-templating
|   |   |   ├── _templates
|   |   |   |   ├── autosummary
|   |   |   |   └── layout.html
|   |   |   ├── autosummary_templating.txt
|   |   |   ├── conf.py
|   |   |   └── index.txt
|   |   ├── test-theming
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── setup.py
|   |   |   └── test_theme
|   |   |       ├── __init__.py
|   |   |       ├── staticfiles
|   |   |       └── test-theme
|   |   ├── test-tocdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   ├── qux.rst
|   |   |   └── tocdepth.rst
|   |   ├── test-toctree-duplicated
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree-empty
|   |   |   ├── _templates
|   |   |   |   └── localtoc.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-toctree-glob
|   |   |   ├── bar
|   |   |   |   ├── bar_1.rst
|   |   |   |   ├── bar_2.rst
|   |   |   |   ├── bar_3.rst
|   |   |   |   ├── bar_4
|   |   |   |   └── index.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux
|   |   |       ├── index.rst
|   |   |       ├── qux_1.rst
|   |   |       └── qux_2.rst
|   |   ├── test-toctree-maxdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   └── qux.rst
|   |   ├── test-transforms-post_transforms-missing-reference
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-trim_doctest_flags
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-versioning
|   |   |   ├── added.txt
|   |   |   ├── conf.py
|   |   |   ├── deleted.txt
|   |   |   ├── deleted_end.txt
|   |   |   ├── index.txt
|   |   |   ├── insert.txt
|   |   |   ├── insert_beginning.txt
|   |   |   ├── insert_similar.txt
|   |   |   ├── modified.txt
|   |   |   └── original.txt
|   |   └── test-warnings
|   |       ├── autodoc_fodder.py
|   |       ├── conf.py
|   |       ├── index.rst
|   |       └── undecodable.rst
|   ├── test_api_translator.py
|   ├── test_application.py
|   ├── test_build.py
|   ├── test_build_changes.py
|   ├── test_build_dirhtml.py
|   ├── test_build_epub.py
|   ├── test_build_gettext.py
|   ├── test_build_html.py
|   ├── test_build_latex.py
|   ├── test_build_linkcheck.py
|   ├── test_build_manpage.py
|   ├── test_build_texinfo.py
|   ├── test_build_text.py
|   ├── test_builder.py
|   ├── test_catalogs.py
|   ├── test_config.py
|   ├── test_correct_year.py
|   ├── test_directive_code.py
|   ├── test_directive_only.py
|   ├── test_directive_other.py
|   ├── test_directive_patch.py
|   ├── test_docutilsconf.py
|   ├── test_domain_c.py
|   ├── test_domain_cpp.py
|   ├── test_domain_js.py
|   ├── test_domain_py.py
|   ├── test_domain_rst.py
|   ├── test_domain_std.py
|   ├── test_environment.py
|   ├── test_environment_indexentries.py
|   ├── test_environment_toctree.py
|   ├── test_errors.py
|   ├── test_events.py
|   ├── test_ext_apidoc.py
|   ├── test_ext_autodoc.py
|   ├── test_ext_autodoc_autoattribute.py
|   ├── test_ext_autodoc_autoclass.py
|   ├── test_ext_autodoc_autodata.py
|   ├── test_ext_autodoc_autofunction.py
|   ├── test_ext_autodoc_automodule.py
|   ├── test_ext_autodoc_autoproperty.py
|   ├── test_ext_autodoc_configs.py
|   ├── test_ext_autodoc_events.py
|   ├── test_ext_autodoc_mock.py
|   ├── test_ext_autodoc_preserve_defaults.py
|   ├── test_ext_autodoc_private_members.py
|   ├── test_ext_autosectionlabel.py
|   ├── test_ext_autosummary.py
|   ├── test_ext_coverage.py
|   ├── test_ext_doctest.py
|   ├── test_ext_duration.py
|   ├── test_ext_githubpages.py
|   ├── test_ext_graphviz.py
|   ├── test_ext_ifconfig.py
|   ├── test_ext_imgconverter.py
|   ├── test_ext_inheritance_diagram.py
|   ├── test_ext_intersphinx.py
|   ├── test_ext_math.py
|   ├── test_ext_napoleon.py
|   ├── test_ext_napoleon_docstring.py
|   ├── test_ext_napoleon_iterators.py
|   ├── test_ext_todo.py
|   ├── test_ext_viewcode.py
|   ├── test_highlighting.py
|   ├── test_intl.py
|   ├── test_locale.py
|   ├── test_markup.py
|   ├── test_metadata.py
|   ├── test_parser.py
|   ├── test_project.py
|   ├── test_pycode.py
|   ├── test_pycode_ast.py
|   ├── test_pycode_parser.py
|   ├── test_quickstart.py
|   ├── test_roles.py
|   ├── test_search.py
|   ├── test_setup_command.py
|   ├── test_smartquotes.py
|   ├── test_templating.py
|   ├── test_theming.py
|   ├── test_toctree.py
|   ├── test_transforms_post_transforms.py
|   ├── test_transforms_post_transforms_code.py
|   ├── test_util.py
|   ├── test_util_docstrings.py
|   ├── test_util_docutils.py
|   ├── test_util_fileutil.py
|   ├── test_util_i18n.py
|   ├── test_util_images.py
|   ├── test_util_inspect.py
|   ├── test_util_inventory.py
|   ├── test_util_jsdump.py
|   ├── test_util_logging.py
|   ├── test_util_matching.py
|   ├── test_util_nodes.py
|   ├── test_util_rst.py
|   ├── test_util_template.py
|   ├── test_util_typing.py
|   ├── test_versioning.py
|   ├── test_writer_latex.py
|   ├── typing_test_data.py
|   └── utils.py
└── utils
    ├── __init__.py
    ├── bump_docker.sh
    ├── bump_version.py
    ├── checks.py
    ├── doclinter.py
    └── jssplitter_generator.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Doc rendering is incorrect when :param has datatype dict(str,str)

Description: **Describe the bug**
I have a parameter defined under docstring of a method as:-
:param dict(str, str) opc_meta: (optional)

Which is being incorrectly rendered in the generated docs as:-
str) opc_meta (dict(str,) –(optional) 

**To Reproduce**
Create any method with the docstring containg the above param

**Expected behavior**
The param should be rendered in the generated docs as:-
opc_meta (dict(str,str)) – (optional) 

**Your project**
[sphinxTest.zip](https://github.com/sphinx-doc/sphinx/files/6468074/sphinxTest.zip)


**Screenshots**
<img width="612" alt="Screen Shot 2021-05-12 at 12 30 50 PM" src="https://user-images.githubusercontent.com/8617566/118020143-5f59a280-b31f-11eb-8dc2-5280d5c4896b.png">
<img width="681" alt="Screen Shot 2021-05-12 at 12 32 25 PM" src="https://user-images.githubusercontent.com/8617566/118020154-62549300-b31f-11eb-953d-9287f9cc27ff.png">


**Environment info**
- OS: Mac
- Python version: 3.9.0
- Sphinx version: 4.0.1
- Sphinx extensions:  ["sphinx.ext.autodoc", "sphinx.ext.autosummary", "sphinx.ext.intersphinx", "autodocsumm"]
- Extra tools: Browser Firefox.

**Additional context**
N/A



Patch information:
diff --git a/sphinx/util/docfields.py b/sphinx/util/docfields.py
index 3a3367ebe..6d48e910c 100644
--- a/sphinx/util/docfields.py
+++ b/sphinx/util/docfields.py
@@ -298,7 +298,7 @@ class DocFieldTransformer:
             # also support syntax like ``:param type name:``
             if typedesc.is_typed:
                 try:
-                    argtype, argname = fieldarg.split(None, 1)
+                    argtype, argname = fieldarg.rsplit(None, 1)
                 except ValueError:
                     pass
                 else:


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `tests/test_util_docfields.py`, `tests/test_domain_py.py`, and `tests/test_ext_autodoc.py`.
Extra Requirements: 
Purpose: I need to analyze these test files to find at least three existing test cases that cover the parsing of complex parameter types in docstrings, which will help in understanding how this functionality is currently tested and to find tests similar to the bug report.

Previous refined query 2:
Essential Query: Please provide the content of `tests/roots/test-ext-autodoc/target/typehints.py`, `tests/roots/test-ext-autodoc/index.rst`, and `tests/test_util_docutils.py`.
Extra Requirements: If providing all files is not possible, please prioritize `tests/roots/test-ext-autodoc/target/typehints.py` and `tests/test_util_docutils.py`.
Purpose: These files are needed to find existing test cases that cover the parsing of complex data types in docstring parameter fields, which is central to the reported bug.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: tests/roots/test-ext-autodoc/index.rst
Line number range: 1 - 15
Content:
1. 
2. .. automodule:: autodoc_dummy_module
3.    :members:
4. 
5. .. automodule:: bug2437.autodoc_dummy_foo
6.    :members:
7. 
8. .. automodule:: autodoc_dummy_bar
9.    :members:
10. 
11. .. autofunction:: target.typehints.incr
12. 
13. .. autofunction:: target.overload.sum
14. 
15. .. autofunction:: target.typehints.tuple_args


File: tests/roots/test-ext-autodoc/target/typehints.py
Line number range: 1 - 80
Content:
1. from typing import Any, Tuple, Union
2. 
3. 
4. def incr(a: int, b: int = 1) -> int:
5.     return a + b
6. 
7. 
8. def decr(a, b = 1):
9.     # type: (int, int) -> int
10.     return a - b
11. 
12. 
13. class Math:
14.     def __init__(self, s: str, o: Any = None) -> None:
15.         pass
16. 
17.     def incr(self, a: int, b: int = 1) -> int:
18.         return a + b
19. 
20.     def decr(self, a, b = 1):
21.         # type: (int, int) -> int
22.         return a - b
23. 
24.     def nothing(self):
25.         # type: () -> None
26.         pass
27. 
28.     def horse(self,
29.               a,  # type: str
30.               b,  # type: int
31.               ):
32.         # type: (...) -> None
33.         return
34. 
35. 
36. def tuple_args(x: Tuple[int, Union[int, str]]) -> Tuple[int, int]:
37.     pass
38. 
39. 
40. class NewAnnotation:
41.     def __new__(cls, i: int) -> 'NewAnnotation':
42.         pass
43. 
44. 
45. class NewComment:
46.     def __new__(cls, i):
47.         # type: (int) -> NewComment
48.         pass
49. 
50. 
51. class _MetaclassWithCall(type):
52.     def __call__(cls, a: int):
53.         pass
54. 
55. 
56. class SignatureFromMetaclass(metaclass=_MetaclassWithCall):
57.     pass
58. 
59. 
60. def complex_func(arg1, arg2, arg3=None, *args, **kwargs):
61.     # type: (str, List[int], Tuple[int, Union[str, Unknown]], *str, **str) -> None
62.     pass
63. 
64. 
65. def missing_attr(c,
66.                  a,  # type: str
67.                  b=None  # type: Optional[str]
68.                  ):
69.     # type: (...) -> str
70.     return a + (b or "")
71. 
72. 
73. class _ClassWithDocumentedInit:
74.     """Class docstring."""
75. 
76.     def __init__(self, x: int) -> None:
77.         """Init docstring.
78. 
79.         :param x: Some integer
80.         """


File: tests/test_domain_py.py
Line number range: 1 - 500
Content:
1. """
2.     test_domain_py
3.     ~~~~~~~~~~~~~~
4. 
5.     Tests the Python Domain
6. 
7.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import re
12. import sys
13. from unittest.mock import Mock
14. 
15. import pytest
16. from docutils import nodes
17. 
18. from sphinx import addnodes
19. from sphinx.addnodes import (desc, desc_addname, desc_annotation, desc_content, desc_name,
20.                              desc_optional, desc_parameter, desc_parameterlist, desc_returns,
21.                              desc_sig_name, desc_sig_operator, desc_sig_punctuation,
22.                              desc_signature, pending_xref)
23. from sphinx.domains import IndexEntry
24. from sphinx.domains.python import (PythonDomain, PythonModuleIndex, _parse_annotation,
25.                                    _pseudo_parse_arglist, py_sig_re)
26. from sphinx.testing import restructuredtext
27. from sphinx.testing.util import assert_node
28. 
29. 
30. def parse(sig):
31.     m = py_sig_re.match(sig)
32.     if m is None:
33.         raise ValueError
34.     name_prefix, name, arglist, retann = m.groups()
35.     signode = addnodes.desc_signature(sig, '')
36.     _pseudo_parse_arglist(signode, arglist)
37.     return signode.astext()
38. 
39. 
40. def test_function_signatures():
41.     rv = parse('func(a=1) -> int object')
42.     assert rv == '(a=1)'
43. 
44.     rv = parse('func(a=1, [b=None])')
45.     assert rv == '(a=1, [b=None])'
46. 
47.     rv = parse('func(a=1[, b=None])')
48.     assert rv == '(a=1, [b=None])'
49. 
50.     rv = parse("compile(source : string, filename, symbol='file')")
51.     assert rv == "(source : string, filename, symbol='file')"
52. 
53.     rv = parse('func(a=[], [b=None])')
54.     assert rv == '(a=[], [b=None])'
55. 
56.     rv = parse('func(a=[][, b=None])')
57.     assert rv == '(a=[], [b=None])'
58. 
59. 
60. @pytest.mark.sphinx('dummy', testroot='domain-py')
61. def test_domain_py_xrefs(app, status, warning):
62.     """Domain objects have correct prefixes when looking up xrefs"""
63.     app.builder.build_all()
64. 
65.     def assert_refnode(node, module_name, class_name, target, reftype=None,
66.                        domain='py'):
67.         attributes = {
68.             'refdomain': domain,
69.             'reftarget': target,
70.         }
71.         if reftype is not None:
72.             attributes['reftype'] = reftype
73.         if module_name is not False:
74.             attributes['py:module'] = module_name
75.         if class_name is not False:
76.             attributes['py:class'] = class_name
77.         assert_node(node, **attributes)
78. 
79.     doctree = app.env.get_doctree('roles')
80.     refnodes = list(doctree.traverse(pending_xref))
81.     assert_refnode(refnodes[0], None, None, 'TopLevel', 'class')
82.     assert_refnode(refnodes[1], None, None, 'top_level', 'meth')
83.     assert_refnode(refnodes[2], None, 'NestedParentA', 'child_1', 'meth')
84.     assert_refnode(refnodes[3], None, 'NestedParentA', 'NestedChildA.subchild_2', 'meth')
85.     assert_refnode(refnodes[4], None, 'NestedParentA', 'child_2', 'meth')
86.     assert_refnode(refnodes[5], False, 'NestedParentA', 'any_child', domain='')
87.     assert_refnode(refnodes[6], None, 'NestedParentA', 'NestedChildA', 'class')
88.     assert_refnode(refnodes[7], None, 'NestedParentA.NestedChildA', 'subchild_2', 'meth')
89.     assert_refnode(refnodes[8], None, 'NestedParentA.NestedChildA',
90.                    'NestedParentA.child_1', 'meth')
91.     assert_refnode(refnodes[9], None, 'NestedParentA', 'NestedChildA.subchild_1', 'meth')
92.     assert_refnode(refnodes[10], None, 'NestedParentB', 'child_1', 'meth')
93.     assert_refnode(refnodes[11], None, 'NestedParentB', 'NestedParentB', 'class')
94.     assert_refnode(refnodes[12], None, None, 'NestedParentA.NestedChildA', 'class')
95.     assert len(refnodes) == 13
96. 
97.     doctree = app.env.get_doctree('module')
98.     refnodes = list(doctree.traverse(pending_xref))
99.     assert_refnode(refnodes[0], 'module_a.submodule', None,
100.                    'ModTopLevel', 'class')
101.     assert_refnode(refnodes[1], 'module_a.submodule', 'ModTopLevel',
102.                    'mod_child_1', 'meth')
103.     assert_refnode(refnodes[2], 'module_a.submodule', 'ModTopLevel',
104.                    'ModTopLevel.mod_child_1', 'meth')
105.     assert_refnode(refnodes[3], 'module_a.submodule', 'ModTopLevel',
106.                    'mod_child_2', 'meth')
107.     assert_refnode(refnodes[4], 'module_a.submodule', 'ModTopLevel',
108.                    'module_a.submodule.ModTopLevel.mod_child_1', 'meth')
109.     assert_refnode(refnodes[5], 'module_a.submodule', 'ModTopLevel',
110.                    'prop', 'attr')
111.     assert_refnode(refnodes[6], 'module_a.submodule', 'ModTopLevel',
112.                    'prop', 'meth')
113.     assert_refnode(refnodes[7], 'module_b.submodule', None,
114.                    'ModTopLevel', 'class')
115.     assert_refnode(refnodes[8], 'module_b.submodule', 'ModTopLevel',
116.                    'ModNoModule', 'class')
117.     assert_refnode(refnodes[9], False, False, 'int', 'class')
118.     assert_refnode(refnodes[10], False, False, 'tuple', 'class')
119.     assert_refnode(refnodes[11], False, False, 'str', 'class')
120.     assert_refnode(refnodes[12], False, False, 'float', 'class')
121.     assert_refnode(refnodes[13], False, False, 'list', 'class')
122.     assert_refnode(refnodes[14], False, False, 'ModTopLevel', 'class')
123.     assert_refnode(refnodes[15], False, False, 'index', 'doc', domain='std')
124.     assert len(refnodes) == 16
125. 
126.     doctree = app.env.get_doctree('module_option')
127.     refnodes = list(doctree.traverse(pending_xref))
128.     print(refnodes)
129.     print(refnodes[0])
130.     print(refnodes[1])
131.     assert_refnode(refnodes[0], 'test.extra', 'B', 'foo', 'meth')
132.     assert_refnode(refnodes[1], 'test.extra', 'B', 'foo', 'meth')
133.     assert len(refnodes) == 2
134. 
135. 
136. @pytest.mark.sphinx('html', testroot='domain-py')
137. def test_domain_py_xrefs_abbreviations(app, status, warning):
138.     app.builder.build_all()
139. 
140.     content = (app.outdir / 'abbr.html').read_text()
141.     assert re.search(r'normal: <a .* href="module.html#module_a.submodule.ModTopLevel.'
142.                      r'mod_child_1" .*><.*>module_a.submodule.ModTopLevel.mod_child_1\(\)'
143.                      r'<.*></a>',
144.                      content)
145.     assert re.search(r'relative: <a .* href="module.html#module_a.submodule.ModTopLevel.'
146.                      r'mod_child_1" .*><.*>ModTopLevel.mod_child_1\(\)<.*></a>',
147.                      content)
148.     assert re.search(r'short name: <a .* href="module.html#module_a.submodule.ModTopLevel.'
149.                      r'mod_child_1" .*><.*>mod_child_1\(\)<.*></a>',
150.                      content)
151.     assert re.search(r'relative \+ short name: <a .* href="module.html#module_a.submodule.'
152.                      r'ModTopLevel.mod_child_1" .*><.*>mod_child_1\(\)<.*></a>',
153.                      content)
154.     assert re.search(r'short name \+ relative: <a .* href="module.html#module_a.submodule.'
155.                      r'ModTopLevel.mod_child_1" .*><.*>mod_child_1\(\)<.*></a>',
156.                      content)
157. 
158. 
159. @pytest.mark.sphinx('dummy', testroot='domain-py')
160. def test_domain_py_objects(app, status, warning):
161.     app.builder.build_all()
162. 
163.     modules = app.env.domains['py'].data['modules']
164.     objects = app.env.domains['py'].data['objects']
165. 
166.     assert 'module_a.submodule' in modules
167.     assert 'module_a.submodule' in objects
168.     assert 'module_b.submodule' in modules
169.     assert 'module_b.submodule' in objects
170. 
171.     assert objects['module_a.submodule.ModTopLevel'][2] == 'class'
172.     assert objects['module_a.submodule.ModTopLevel.mod_child_1'][2] == 'method'
173.     assert objects['module_a.submodule.ModTopLevel.mod_child_2'][2] == 'method'
174.     assert 'ModTopLevel.ModNoModule' not in objects
175.     assert objects['ModNoModule'][2] == 'class'
176.     assert objects['module_b.submodule.ModTopLevel'][2] == 'class'
177. 
178.     assert objects['TopLevel'][2] == 'class'
179.     assert objects['top_level'][2] == 'method'
180.     assert objects['NestedParentA'][2] == 'class'
181.     assert objects['NestedParentA.child_1'][2] == 'method'
182.     assert objects['NestedParentA.any_child'][2] == 'method'
183.     assert objects['NestedParentA.NestedChildA'][2] == 'class'
184.     assert objects['NestedParentA.NestedChildA.subchild_1'][2] == 'method'
185.     assert objects['NestedParentA.NestedChildA.subchild_2'][2] == 'method'
186.     assert objects['NestedParentA.child_2'][2] == 'method'
187.     assert objects['NestedParentB'][2] == 'class'
188.     assert objects['NestedParentB.child_1'][2] == 'method'
189. 
190. 
191. @pytest.mark.sphinx('html', testroot='domain-py')
192. def test_resolve_xref_for_properties(app, status, warning):
193.     app.builder.build_all()
194. 
195.     content = (app.outdir / 'module.html').read_text()
196.     assert ('Link to <a class="reference internal" href="#module_a.submodule.ModTopLevel.prop"'
197.             ' title="module_a.submodule.ModTopLevel.prop">'
198.             '<code class="xref py py-attr docutils literal notranslate"><span class="pre">'
199.             'prop</span> <span class="pre">attribute</span></code></a>' in content)
200.     assert ('Link to <a class="reference internal" href="#module_a.submodule.ModTopLevel.prop"'
201.             ' title="module_a.submodule.ModTopLevel.prop">'
202.             '<code class="xref py py-meth docutils literal notranslate"><span class="pre">'
203.             'prop</span> <span class="pre">method</span></code></a>' in content)
204.     assert ('Link to <a class="reference internal" href="#module_a.submodule.ModTopLevel.prop"'
205.             ' title="module_a.submodule.ModTopLevel.prop">'
206.             '<code class="xref py py-attr docutils literal notranslate"><span class="pre">'
207.             'prop</span> <span class="pre">attribute</span></code></a>' in content)
208. 
209. 
210. @pytest.mark.sphinx('dummy', testroot='domain-py')
211. def test_domain_py_find_obj(app, status, warning):
212. 
213.     def find_obj(modname, prefix, obj_name, obj_type, searchmode=0):
214.         return app.env.domains['py'].find_obj(
215.             app.env, modname, prefix, obj_name, obj_type, searchmode)
216. 
217.     app.builder.build_all()
218. 
219.     assert (find_obj(None, None, 'NONEXISTANT', 'class') == [])
220.     assert (find_obj(None, None, 'NestedParentA', 'class') ==
221.             [('NestedParentA', ('roles', 'NestedParentA', 'class', False))])
222.     assert (find_obj(None, None, 'NestedParentA.NestedChildA', 'class') ==
223.             [('NestedParentA.NestedChildA',
224.               ('roles', 'NestedParentA.NestedChildA', 'class', False))])
225.     assert (find_obj(None, 'NestedParentA', 'NestedChildA', 'class') ==
226.             [('NestedParentA.NestedChildA',
227.               ('roles', 'NestedParentA.NestedChildA', 'class', False))])
228.     assert (find_obj(None, None, 'NestedParentA.NestedChildA.subchild_1', 'meth') ==
229.             [('NestedParentA.NestedChildA.subchild_1',
230.               ('roles', 'NestedParentA.NestedChildA.subchild_1', 'method', False))])
231.     assert (find_obj(None, 'NestedParentA', 'NestedChildA.subchild_1', 'meth') ==
232.             [('NestedParentA.NestedChildA.subchild_1',
233.               ('roles', 'NestedParentA.NestedChildA.subchild_1', 'method', False))])
234.     assert (find_obj(None, 'NestedParentA.NestedChildA', 'subchild_1', 'meth') ==
235.             [('NestedParentA.NestedChildA.subchild_1',
236.               ('roles', 'NestedParentA.NestedChildA.subchild_1', 'method', False))])
237. 
238. 
239. @pytest.mark.sphinx('html', testroot='domain-py', freshenv=True)
240. def test_domain_py_canonical(app, status, warning):
241.     app.builder.build_all()
242. 
243.     content = (app.outdir / 'canonical.html').read_text()
244.     assert ('<a class="reference internal" href="#canonical.Foo" title="canonical.Foo">'
245.             '<code class="xref py py-class docutils literal notranslate">'
246.             '<span class="pre">Foo</span></code></a>' in content)
247.     assert warning.getvalue() == ''
248. 
249. 
250. def test_get_full_qualified_name():
251.     env = Mock(domaindata={})
252.     domain = PythonDomain(env)
253. 
254.     # non-python references
255.     node = nodes.reference()
256.     assert domain.get_full_qualified_name(node) is None
257. 
258.     # simple reference
259.     node = nodes.reference(reftarget='func')
260.     assert domain.get_full_qualified_name(node) == 'func'
261. 
262.     # with py:module context
263.     kwargs = {'py:module': 'module1'}
264.     node = nodes.reference(reftarget='func', **kwargs)
265.     assert domain.get_full_qualified_name(node) == 'module1.func'
266. 
267.     # with py:class context
268.     kwargs = {'py:class': 'Class'}
269.     node = nodes.reference(reftarget='func', **kwargs)
270.     assert domain.get_full_qualified_name(node) == 'Class.func'
271. 
272.     # with both py:module and py:class context
273.     kwargs = {'py:module': 'module1', 'py:class': 'Class'}
274.     node = nodes.reference(reftarget='func', **kwargs)
275.     assert domain.get_full_qualified_name(node) == 'module1.Class.func'
276. 
277. 
278. def test_parse_annotation(app):
279.     doctree = _parse_annotation("int", app.env)
280.     assert_node(doctree, ([pending_xref, "int"],))
281.     assert_node(doctree[0], pending_xref, refdomain="py", reftype="class", reftarget="int")
282. 
283.     doctree = _parse_annotation("List[int]", app.env)
284.     assert_node(doctree, ([pending_xref, "List"],
285.                           [desc_sig_punctuation, "["],
286.                           [pending_xref, "int"],
287.                           [desc_sig_punctuation, "]"]))
288. 
289.     doctree = _parse_annotation("Tuple[int, int]", app.env)
290.     assert_node(doctree, ([pending_xref, "Tuple"],
291.                           [desc_sig_punctuation, "["],
292.                           [pending_xref, "int"],
293.                           [desc_sig_punctuation, ", "],
294.                           [pending_xref, "int"],
295.                           [desc_sig_punctuation, "]"]))
296. 
297.     doctree = _parse_annotation("Tuple[()]", app.env)
298.     assert_node(doctree, ([pending_xref, "Tuple"],
299.                           [desc_sig_punctuation, "["],
300.                           [desc_sig_punctuation, "("],
301.                           [desc_sig_punctuation, ")"],
302.                           [desc_sig_punctuation, "]"]))
303. 
304.     doctree = _parse_annotation("Tuple[int, ...]", app.env)
305.     assert_node(doctree, ([pending_xref, "Tuple"],
306.                           [desc_sig_punctuation, "["],
307.                           [pending_xref, "int"],
308.                           [desc_sig_punctuation, ", "],
309.                           [desc_sig_punctuation, "..."],
310.                           [desc_sig_punctuation, "]"]))
311. 
312.     doctree = _parse_annotation("Callable[[int, int], int]", app.env)
313.     assert_node(doctree, ([pending_xref, "Callable"],
314.                           [desc_sig_punctuation, "["],
315.                           [desc_sig_punctuation, "["],
316.                           [pending_xref, "int"],
317.                           [desc_sig_punctuation, ", "],
318.                           [pending_xref, "int"],
319.                           [desc_sig_punctuation, "]"],
320.                           [desc_sig_punctuation, ", "],
321.                           [pending_xref, "int"],
322.                           [desc_sig_punctuation, "]"]))
323. 
324.     doctree = _parse_annotation("List[None]", app.env)
325.     assert_node(doctree, ([pending_xref, "List"],
326.                           [desc_sig_punctuation, "["],
327.                           [pending_xref, "None"],
328.                           [desc_sig_punctuation, "]"]))
329. 
330.     # None type makes an object-reference (not a class reference)
331.     doctree = _parse_annotation("None", app.env)
332.     assert_node(doctree, ([pending_xref, "None"],))
333.     assert_node(doctree[0], pending_xref, refdomain="py", reftype="obj", reftarget="None")
334. 
335. 
336. def test_pyfunction_signature(app):
337.     text = ".. py:function:: hello(name: str) -> str"
338.     doctree = restructuredtext.parse(app, text)
339.     assert_node(doctree, (addnodes.index,
340.                           [desc, ([desc_signature, ([desc_name, "hello"],
341.                                                     desc_parameterlist,
342.                                                     [desc_returns, pending_xref, "str"])],
343.                                   desc_content)]))
344.     assert_node(doctree[1], addnodes.desc, desctype="function",
345.                 domain="py", objtype="function", noindex=False)
346.     assert_node(doctree[1][0][1],
347.                 [desc_parameterlist, desc_parameter, ([desc_sig_name, "name"],
348.                                                       [desc_sig_punctuation, ":"],
349.                                                       " ",
350.                                                       [nodes.inline, pending_xref, "str"])])
351. 
352. 
353. def test_pyfunction_signature_full(app):
354.     text = (".. py:function:: hello(a: str, b = 1, *args: str, "
355.             "c: bool = True, d: tuple = (1, 2), **kwargs: str) -> str")
356.     doctree = restructuredtext.parse(app, text)
357.     assert_node(doctree, (addnodes.index,
358.                           [desc, ([desc_signature, ([desc_name, "hello"],
359.                                                     desc_parameterlist,
360.                                                     [desc_returns, pending_xref, "str"])],
361.                                   desc_content)]))
362.     assert_node(doctree[1], addnodes.desc, desctype="function",
363.                 domain="py", objtype="function", noindex=False)
364.     assert_node(doctree[1][0][1],
365.                 [desc_parameterlist, ([desc_parameter, ([desc_sig_name, "a"],
366.                                                         [desc_sig_punctuation, ":"],
367.                                                         " ",
368.                                                         [desc_sig_name, pending_xref, "str"])],
369.                                       [desc_parameter, ([desc_sig_name, "b"],
370.                                                         [desc_sig_operator, "="],
371.                                                         [nodes.inline, "1"])],
372.                                       [desc_parameter, ([desc_sig_operator, "*"],
373.                                                         [desc_sig_name, "args"],
374.                                                         [desc_sig_punctuation, ":"],
375.                                                         " ",
376.                                                         [desc_sig_name, pending_xref, "str"])],
377.                                       [desc_parameter, ([desc_sig_name, "c"],
378.                                                         [desc_sig_punctuation, ":"],
379.                                                         " ",
380.                                                         [desc_sig_name, pending_xref, "bool"],
381.                                                         " ",
382.                                                         [desc_sig_operator, "="],
383.                                                         " ",
384.                                                         [nodes.inline, "True"])],
385.                                       [desc_parameter, ([desc_sig_name, "d"],
386.                                                         [desc_sig_punctuation, ":"],
387.                                                         " ",
388.                                                         [desc_sig_name, pending_xref, "tuple"],
389.                                                         " ",
390.                                                         [desc_sig_operator, "="],
391.                                                         " ",
392.                                                         [nodes.inline, "(1, 2)"])],
393.                                       [desc_parameter, ([desc_sig_operator, "**"],
394.                                                         [desc_sig_name, "kwargs"],
395.                                                         [desc_sig_punctuation, ":"],
396.                                                         " ",
397.                                                         [desc_sig_name, pending_xref, "str"])])])
398. 
399. 
400. @pytest.mark.skipif(sys.version_info < (3, 8), reason='python 3.8+ is required.')
401. def test_pyfunction_signature_full_py38(app):
402.     # case: separator at head
403.     text = ".. py:function:: hello(*, a)"
404.     doctree = restructuredtext.parse(app, text)
405.     assert_node(doctree[1][0][1],
406.                 [desc_parameterlist, ([desc_parameter, nodes.inline, "*"],
407.                                       [desc_parameter, desc_sig_name, "a"])])
408. 
409.     # case: separator in the middle
410.     text = ".. py:function:: hello(a, /, b, *, c)"
411.     doctree = restructuredtext.parse(app, text)
412.     assert_node(doctree[1][0][1],
413.                 [desc_parameterlist, ([desc_parameter, desc_sig_name, "a"],
414.                                       [desc_parameter, desc_sig_operator, "/"],
415.                                       [desc_parameter, desc_sig_name, "b"],
416.                                       [desc_parameter, desc_sig_operator, "*"],
417.                                       [desc_parameter, desc_sig_name, "c"])])
418. 
419.     # case: separator in the middle (2)
420.     text = ".. py:function:: hello(a, /, *, b)"
421.     doctree = restructuredtext.parse(app, text)
422.     assert_node(doctree[1][0][1],
423.                 [desc_parameterlist, ([desc_parameter, desc_sig_name, "a"],
424.                                       [desc_parameter, desc_sig_operator, "/"],
425.                                       [desc_parameter, desc_sig_operator, "*"],
426.                                       [desc_parameter, desc_sig_name, "b"])])
427. 
428.     # case: separator at tail
429.     text = ".. py:function:: hello(a, /)"
430.     doctree = restructuredtext.parse(app, text)
431.     assert_node(doctree[1][0][1],
432.                 [desc_parameterlist, ([desc_parameter, desc_sig_name, "a"],
433.                                       [desc_parameter, desc_sig_operator, "/"])])
434. 
435. 
436. @pytest.mark.skipif(sys.version_info < (3, 8), reason='python 3.8+ is required.')
437. def test_pyfunction_with_number_literals(app):
438.     text = ".. py:function:: hello(age=0x10, height=1_6_0)"
439.     doctree = restructuredtext.parse(app, text)
440.     assert_node(doctree[1][0][1],
441.                 [desc_parameterlist, ([desc_parameter, ([desc_sig_name, "age"],
442.                                                         [desc_sig_operator, "="],
443.                                                         [nodes.inline, "0x10"])],
444.                                       [desc_parameter, ([desc_sig_name, "height"],
445.                                                         [desc_sig_operator, "="],
446.                                                         [nodes.inline, "1_6_0"])])])
447. 
448. 
449. def test_pyfunction_with_union_type_operator(app):
450.     text = ".. py:function:: hello(age: int | None)"
451.     doctree = restructuredtext.parse(app, text)
452.     assert_node(doctree[1][0][1],
453.                 [desc_parameterlist, ([desc_parameter, ([desc_sig_name, "age"],
454.                                                         [desc_sig_punctuation, ":"],
455.                                                         " ",
456.                                                         [desc_sig_name, ([pending_xref, "int"],
457.                                                                          " ",
458.                                                                          [desc_sig_punctuation, "|"],
459.                                                                          " ",
460.                                                                          [pending_xref, "None"])])])])
461. 
462. 
463. def test_optional_pyfunction_signature(app):
464.     text = ".. py:function:: compile(source [, filename [, symbol]]) -> ast object"
465.     doctree = restructuredtext.parse(app, text)
466.     assert_node(doctree, (addnodes.index,
467.                           [desc, ([desc_signature, ([desc_name, "compile"],
468.                                                     desc_parameterlist,
469.                                                     [desc_returns, pending_xref, "ast object"])],
470.                                   desc_content)]))
471.     assert_node(doctree[1], addnodes.desc, desctype="function",
472.                 domain="py", objtype="function", noindex=False)
473.     assert_node(doctree[1][0][1],
474.                 ([desc_parameter, "source"],
475.                  [desc_optional, ([desc_parameter, "filename"],
476.                                   [desc_optional, desc_parameter, "symbol"])]))
477. 
478. 
479. def test_pyexception_signature(app):
480.     text = ".. py:exception:: exceptions.IOError"
481.     doctree = restructuredtext.parse(app, text)
482.     assert_node(doctree, (addnodes.index,
483.                           [desc, ([desc_signature, ([desc_annotation, "exception "],
484.                                                     [desc_addname, "exceptions."],
485.                                                     [desc_name, "IOError"])],
486.                                   desc_content)]))
487.     assert_node(doctree[1], desc, desctype="exception",
488.                 domain="py", objtype="exception", noindex=False)
489. 
490. 
491. def test_exceptions_module_is_ignored(app):
492.     text = (".. py:exception:: IOError\n"
493.             "   :module: exceptions\n")
494.     doctree = restructuredtext.parse(app, text)
495.     assert_node(doctree, (addnodes.index,
496.                           [desc, ([desc_signature, ([desc_annotation, "exception "],
497.                                                     [desc_name, "IOError"])],
498.                                   desc_content)]))
499.     assert_node(doctree[1], desc, desctype="exception",
500.                 domain="py", objtype="exception", noindex=False)


File: tests/test_ext_autodoc.py
Line number range: 1 - 500
Content:
1. """
2.     test_ext_autodoc
3.     ~~~~~~~~~~~~~~~~
4. 
5.     Test the autodoc extension.  This tests mainly the Documenters; the auto
6.     directives are tested in a test source file translated by test_build.
7. 
8.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
9.     :license: BSD, see LICENSE for details.
10. """
11. 
12. import sys
13. from unittest.mock import Mock
14. from warnings import catch_warnings
15. 
16. import pytest
17. from docutils.statemachine import ViewList
18. 
19. from sphinx import addnodes
20. from sphinx.ext.autodoc import ALL, ModuleLevelDocumenter, Options
21. from sphinx.ext.autodoc.directive import DocumenterBridge, process_documenter_options
22. from sphinx.testing.util import SphinxTestApp, Struct  # NOQA
23. from sphinx.util.docutils import LoggingReporter
24. 
25. try:
26.     # Enable pyximport to test cython module
27.     import pyximport
28.     pyximport.install()
29. except ImportError:
30.     pyximport = None
31. 
32. 
33. def do_autodoc(app, objtype, name, options=None):
34.     if options is None:
35.         options = {}
36.     app.env.temp_data.setdefault('docname', 'index')  # set dummy docname
37.     doccls = app.registry.documenters[objtype]
38.     docoptions = process_documenter_options(doccls, app.config, options)
39.     state = Mock()
40.     state.document.settings.tab_width = 8
41.     bridge = DocumenterBridge(app.env, LoggingReporter(''), docoptions, 1, state)
42.     documenter = doccls(bridge, name)
43.     documenter.generate()
44. 
45.     return bridge.result
46. 
47. 
48. def make_directive_bridge(env):
49.     options = Options(
50.         inherited_members = False,
51.         undoc_members = False,
52.         private_members = False,
53.         special_members = False,
54.         imported_members = False,
55.         show_inheritance = False,
56.         noindex = False,
57.         annotation = None,
58.         synopsis = '',
59.         platform = '',
60.         deprecated = False,
61.         members = [],
62.         member_order = 'alphabetical',
63.         exclude_members = set(),
64.         ignore_module_all = False,
65.     )
66. 
67.     directive = Struct(
68.         env = env,
69.         genopt = options,
70.         result = ViewList(),
71.         record_dependencies = set(),
72.         state = Mock(),
73.     )
74.     directive.state.document.settings.tab_width = 8
75. 
76.     return directive
77. 
78. 
79. processed_signatures = []
80. 
81. 
82. def process_signature(app, what, name, obj, options, args, retann):
83.     processed_signatures.append((what, name))
84.     if name == 'bar':
85.         return '42', None
86. 
87. 
88. def skip_member(app, what, name, obj, skip, options):
89.     if name in ('__special1__', '__special2__'):
90.         return skip
91.     if name.startswith('__'):
92.         return True
93.     if name == 'skipmeth':
94.         return True
95. 
96. 
97. def test_parse_name(app):
98.     def verify(objtype, name, result):
99.         inst = app.registry.documenters[objtype](directive, name)
100.         assert inst.parse_name()
101.         assert (inst.modname, inst.objpath, inst.args, inst.retann) == result
102. 
103.     directive = make_directive_bridge(app.env)
104. 
105.     # for modules
106.     verify('module', 'test_ext_autodoc', ('test_ext_autodoc', [], None, None))
107.     verify('module', 'test.test_ext_autodoc', ('test.test_ext_autodoc', [], None, None))
108.     verify('module', 'test(arg)', ('test', [], 'arg', None))
109.     assert 'signature arguments' in app._warning.getvalue()
110. 
111.     # for functions/classes
112.     verify('function', 'test_ext_autodoc.raises',
113.            ('test_ext_autodoc', ['raises'], None, None))
114.     verify('function', 'test_ext_autodoc.raises(exc) -> None',
115.            ('test_ext_autodoc', ['raises'], 'exc', 'None'))
116.     directive.env.temp_data['autodoc:module'] = 'test_ext_autodoc'
117.     verify('function', 'raises', ('test_ext_autodoc', ['raises'], None, None))
118.     del directive.env.temp_data['autodoc:module']
119.     directive.env.ref_context['py:module'] = 'test_ext_autodoc'
120.     verify('function', 'raises', ('test_ext_autodoc', ['raises'], None, None))
121.     verify('class', 'Base', ('test_ext_autodoc', ['Base'], None, None))
122. 
123.     # for members
124.     directive.env.ref_context['py:module'] = 'sphinx.testing.util'
125.     verify('method', 'SphinxTestApp.cleanup',
126.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
127.     directive.env.ref_context['py:module'] = 'sphinx.testing.util'
128.     directive.env.ref_context['py:class'] = 'Foo'
129.     directive.env.temp_data['autodoc:class'] = 'SphinxTestApp'
130.     verify('method', 'cleanup',
131.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
132.     verify('method', 'SphinxTestApp.cleanup',
133.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
134. 
135. 
136. def test_format_signature(app):
137.     app.connect('autodoc-process-signature', process_signature)
138.     app.connect('autodoc-skip-member', skip_member)
139. 
140.     directive = make_directive_bridge(app.env)
141. 
142.     def formatsig(objtype, name, obj, args, retann):
143.         inst = app.registry.documenters[objtype](directive, name)
144.         inst.fullname = name
145.         inst.doc_as_attr = False  # for class objtype
146.         inst.parent = object  # dummy
147.         inst.object = obj
148.         inst.objpath = [name]
149.         inst.args = args
150.         inst.retann = retann
151.         res = inst.format_signature()
152.         print(res)
153.         return res
154. 
155.     # no signatures for modules
156.     assert formatsig('module', 'test', None, None, None) == ''
157. 
158.     # test for functions
159.     def f(a, b, c=1, **d):
160.         pass
161. 
162.     def g(a='\n'):
163.         pass
164.     assert formatsig('function', 'f', f, None, None) == '(a, b, c=1, **d)'
165.     assert formatsig('function', 'f', f, 'a, b, c, d', None) == '(a, b, c, d)'
166.     assert formatsig('function', 'g', g, None, None) == r"(a='\n')"
167. 
168.     # test for classes
169.     class D:
170.         pass
171. 
172.     class E:
173.         def __init__(self):
174.             pass
175. 
176.     # an empty init and no init are the same
177.     for C in (D, E):
178.         assert formatsig('class', 'D', C, None, None) == '()'
179. 
180.     class SomeMeta(type):
181.         def __call__(cls, a, b=None):
182.             return type.__call__(cls, a, b)
183. 
184.     # these three are all equivalent
185.     class F:
186.         def __init__(self, a, b=None):
187.             pass
188. 
189.     class FNew:
190.         def __new__(cls, a, b=None):
191.             return super().__new__(cls)
192. 
193.     class FMeta(metaclass=SomeMeta):
194.         pass
195. 
196.     # and subclasses should always inherit
197.     class G(F):
198.         pass
199. 
200.     class GNew(FNew):
201.         pass
202. 
203.     class GMeta(FMeta):
204.         pass
205. 
206.     # subclasses inherit
207.     for C in (F, FNew, FMeta, G, GNew, GMeta):
208.         assert formatsig('class', 'C', C, None, None) == '(a, b=None)'
209.     assert formatsig('class', 'C', D, 'a, b', 'X') == '(a, b) -> X'
210. 
211.     class ListSubclass(list):
212.         pass
213. 
214.     # only supported if the python implementation decides to document it
215.     if getattr(list, '__text_signature__', None) is not None:
216.         assert formatsig('class', 'C', ListSubclass, None, None) == '(iterable=(), /)'
217.     else:
218.         assert formatsig('class', 'C', ListSubclass, None, None) == ''
219. 
220.     class ExceptionSubclass(Exception):
221.         pass
222. 
223.     # Exception has no __text_signature__ at least in Python 3.8
224.     if getattr(Exception, '__text_signature__', None) is None:
225.         assert formatsig('class', 'C', ExceptionSubclass, None, None) == ''
226. 
227.     # __init__ have signature at first line of docstring
228.     directive.env.config.autoclass_content = 'both'
229. 
230.     class F2:
231.         '''some docstring for F2.'''
232.         def __init__(self, *args, **kw):
233.             '''
234.             __init__(a1, a2, kw1=True, kw2=False)
235. 
236.             some docstring for __init__.
237.             '''
238.     class G2(F2):
239.         pass
240. 
241.     assert formatsig('class', 'F2', F2, None, None) == \
242.         '(a1, a2, kw1=True, kw2=False)'
243.     assert formatsig('class', 'G2', G2, None, None) == \
244.         '(a1, a2, kw1=True, kw2=False)'
245. 
246.     # test for methods
247.     class H:
248.         def foo1(self, b, *c):
249.             pass
250. 
251.         def foo2(b, *c):
252.             pass
253. 
254.         def foo3(self, d='\n'):
255.             pass
256.     assert formatsig('method', 'H.foo', H.foo1, None, None) == '(b, *c)'
257.     assert formatsig('method', 'H.foo', H.foo1, 'a', None) == '(a)'
258.     assert formatsig('method', 'H.foo', H.foo2, None, None) == '(*c)'
259.     assert formatsig('method', 'H.foo', H.foo3, None, None) == r"(d='\n')"
260. 
261.     # test bound methods interpreted as functions
262.     assert formatsig('function', 'foo', H().foo1, None, None) == '(b, *c)'
263.     assert formatsig('function', 'foo', H().foo2, None, None) == '(*c)'
264.     assert formatsig('function', 'foo', H().foo3, None, None) == r"(d='\n')"
265. 
266.     # test exception handling (exception is caught and args is '')
267.     directive.env.config.autodoc_docstring_signature = False
268.     assert formatsig('function', 'int', int, None, None) == ''
269. 
270.     # test processing by event handler
271.     assert formatsig('method', 'bar', H.foo1, None, None) == '42'
272. 
273.     # test functions created via functools.partial
274.     from functools import partial
275.     curried1 = partial(lambda a, b, c: None, 'A')
276.     assert formatsig('function', 'curried1', curried1, None, None) == \
277.         '(b, c)'
278.     curried2 = partial(lambda a, b, c=42: None, 'A')
279.     assert formatsig('function', 'curried2', curried2, None, None) == \
280.         '(b, c=42)'
281.     curried3 = partial(lambda a, b, *c: None, 'A')
282.     assert formatsig('function', 'curried3', curried3, None, None) == \
283.         '(b, *c)'
284.     curried4 = partial(lambda a, b, c=42, *d, **e: None, 'A')
285.     assert formatsig('function', 'curried4', curried4, None, None) == \
286.         '(b, c=42, *d, **e)'
287. 
288. 
289. @pytest.mark.sphinx('html', testroot='ext-autodoc')
290. def test_autodoc_process_signature_typing_generic(app):
291.     actual = do_autodoc(app, 'class', 'target.generic_class.A', {})
292. 
293.     assert list(actual) == [
294.         '',
295.         '.. py:class:: A(a, b=None)',
296.         '   :module: target.generic_class',
297.         '',
298.         '   docstring for A',
299.         '',
300.     ]
301. 
302. 
303. def test_autodoc_process_signature_typehints(app):
304.     captured = []
305. 
306.     def process_signature(*args):
307.         captured.append(args)
308. 
309.     app.connect('autodoc-process-signature', process_signature)
310. 
311.     def func(x: int, y: int) -> int:
312.         pass
313. 
314.     directive = make_directive_bridge(app.env)
315.     inst = app.registry.documenters['function'](directive, 'func')
316.     inst.fullname = 'func'
317.     inst.object = func
318.     inst.objpath = ['func']
319.     inst.format_signature()
320.     assert captured == [(app, 'function', 'func', func,
321.                          directive.genopt, '(x: int, y: int)', 'int')]
322. 
323. 
324. def test_get_doc(app):
325.     directive = make_directive_bridge(app.env)
326. 
327.     def getdocl(objtype, obj):
328.         inst = app.registry.documenters[objtype](directive, 'tmp')
329.         inst.parent = object  # dummy
330.         inst.object = obj
331.         inst.objpath = [obj.__name__]
332.         inst.doc_as_attr = False
333.         inst.format_signature()  # handle docstring signatures!
334.         ds = inst.get_doc()
335.         # for testing purposes, concat them and strip the empty line at the end
336.         res = sum(ds, [])[:-1]
337.         print(res)
338.         return res
339. 
340.     # objects without docstring
341.     def f():
342.         pass
343.     assert getdocl('function', f) == []
344. 
345.     # standard function, diverse docstring styles...
346.     def f():
347.         """Docstring"""
348.     def g():
349.         """
350.         Docstring
351.         """
352.     for func in (f, g):
353.         assert getdocl('function', func) == ['Docstring']
354. 
355.     # first line vs. other lines indentation
356.     def f():
357.         """First line
358. 
359.         Other
360.           lines
361.         """
362.     assert getdocl('function', f) == ['First line', '', 'Other', '  lines']
363. 
364.     # charset guessing (this module is encoded in utf-8)
365.     def f():
366.         """Döcstring"""
367.     assert getdocl('function', f) == ['Döcstring']
368. 
369.     # verify that method docstrings get extracted in both normal case
370.     # and in case of bound method posing as a function
371.     class J:  # NOQA
372.         def foo(self):
373.             """Method docstring"""
374.     assert getdocl('method', J.foo) == ['Method docstring']
375.     assert getdocl('function', J().foo) == ['Method docstring']
376. 
377. 
378. @pytest.mark.sphinx('html', testroot='ext-autodoc')
379. def test_new_documenter(app):
380.     class MyDocumenter(ModuleLevelDocumenter):
381.         objtype = 'integer'
382.         directivetype = 'integer'
383.         priority = 100
384. 
385.         @classmethod
386.         def can_document_member(cls, member, membername, isattr, parent):
387.             return isinstance(member, int)
388. 
389.         def document_members(self, all_members=False):
390.             return
391. 
392.     app.add_autodocumenter(MyDocumenter)
393. 
394.     options = {"members": 'integer'}
395.     actual = do_autodoc(app, 'module', 'target', options)
396.     assert list(actual) == [
397.         '',
398.         '.. py:module:: target',
399.         '',
400.         '',
401.         '.. py:integer:: integer',
402.         '   :module: target',
403.         '',
404.         '   documentation for the integer',
405.         '',
406.     ]
407. 
408. 
409. def test_attrgetter_using(app):
410.     from target import Class
411.     from target.inheritance import Derived
412. 
413.     directive = make_directive_bridge(app.env)
414. 
415.     def assert_getter_works(objtype, name, obj, attrs=[], **kw):
416.         getattr_spy = []
417. 
418.         def special_getattr(obj, name, *defargs):
419.             if name in attrs:
420.                 getattr_spy.append((obj, name))
421.                 return None
422.             return getattr(obj, name, *defargs)
423.         app.add_autodoc_attrgetter(type, special_getattr)
424. 
425.         del getattr_spy[:]
426.         inst = app.registry.documenters[objtype](directive, name)
427.         inst.generate(**kw)
428. 
429.         hooked_members = [s[1] for s in getattr_spy]
430.         documented_members = [s[1] for s in processed_signatures]
431.         for attr in attrs:
432.             fullname = '.'.join((name, attr))
433.             assert attr in hooked_members
434.             assert fullname not in documented_members, \
435.                 '%r was not hooked by special_attrgetter function' % fullname
436. 
437.     with catch_warnings(record=True):
438.         directive.genopt['members'] = ALL
439.         directive.genopt['inherited_members'] = False
440.         print(directive.genopt)
441.         assert_getter_works('class', 'target.Class', Class, ['meth'])
442. 
443.         directive.genopt['inherited_members'] = True
444.         assert_getter_works('class', 'target.inheritance.Derived', Derived, ['inheritedmeth'])
445. 
446. 
447. @pytest.mark.sphinx('html', testroot='ext-autodoc')
448. def test_py_module(app, warning):
449.     # without py:module
450.     actual = do_autodoc(app, 'method', 'Class.meth')
451.     assert list(actual) == []
452.     assert ("don't know which module to import for autodocumenting 'Class.meth'"
453.             in warning.getvalue())
454. 
455.     # with py:module
456.     app.env.ref_context['py:module'] = 'target'
457.     warning.truncate(0)
458. 
459.     actual = do_autodoc(app, 'method', 'Class.meth')
460.     assert list(actual) == [
461.         '',
462.         '.. py:method:: Class.meth()',
463.         '   :module: target',
464.         '',
465.         '   Function.',
466.         '',
467.     ]
468.     assert ("don't know which module to import for autodocumenting 'Class.meth'"
469.             not in warning.getvalue())
470. 
471. 
472. @pytest.mark.sphinx('html', testroot='ext-autodoc')
473. def test_autodoc_decorator(app):
474.     actual = do_autodoc(app, 'decorator', 'target.decorator.deco1')
475.     assert list(actual) == [
476.         '',
477.         '.. py:decorator:: deco1',
478.         '   :module: target.decorator',
479.         '',
480.         '   docstring for deco1',
481.         '',
482.     ]
483. 
484.     actual = do_autodoc(app, 'decorator', 'target.decorator.deco2')
485.     assert list(actual) == [
486.         '',
487.         '.. py:decorator:: deco2(condition, message)',
488.         '   :module: target.decorator',
489.         '',
490.         '   docstring for deco2',
491.         '',
492.     ]
493. 
494. 
495. @pytest.mark.sphinx('html', testroot='ext-autodoc')
496. def test_autodoc_exception(app):
497.     actual = do_autodoc(app, 'exception', 'target.CustomEx')
498.     assert list(actual) == [
499.         '',
500.         '.. py:exception:: CustomEx',


File: tests/test_util_docutils.py
Line number range: 1 - 95
Content:
1. """
2.     test_util_docutils
3.     ~~~~~~~~~~~~~~~~~~
4. 
5.     Tests util.utils functions.
6. 
7.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import os
12. 
13. from docutils import nodes
14. 
15. from sphinx.util.docutils import (SphinxFileOutput, SphinxTranslator, docutils_namespace,
16.                                   new_document, register_node)
17. 
18. 
19. def test_register_node():
20.     class custom_node(nodes.Element):
21.         pass
22. 
23.     with docutils_namespace():
24.         register_node(custom_node)
25. 
26.         # check registered
27.         assert hasattr(nodes.GenericNodeVisitor, 'visit_custom_node')
28.         assert hasattr(nodes.GenericNodeVisitor, 'depart_custom_node')
29.         assert hasattr(nodes.SparseNodeVisitor, 'visit_custom_node')
30.         assert hasattr(nodes.SparseNodeVisitor, 'depart_custom_node')
31. 
32.     # check unregistered outside namespace
33.     assert not hasattr(nodes.GenericNodeVisitor, 'visit_custom_node')
34.     assert not hasattr(nodes.GenericNodeVisitor, 'depart_custom_node')
35.     assert not hasattr(nodes.SparseNodeVisitor, 'visit_custom_node')
36.     assert not hasattr(nodes.SparseNodeVisitor, 'depart_custom_node')
37. 
38. 
39. def test_SphinxFileOutput(tmpdir):
40.     content = 'Hello Sphinx World'
41. 
42.     # write test.txt at first
43.     filename = str(tmpdir / 'test.txt')
44.     output = SphinxFileOutput(destination_path=filename)
45.     output.write(content)
46.     os.utime(filename, (0, 0))
47. 
48.     # overrite it again
49.     output.write(content)
50.     assert os.stat(filename).st_mtime != 0  # updated
51. 
52.     # write test2.txt at first
53.     filename = str(tmpdir / 'test2.txt')
54.     output = SphinxFileOutput(destination_path=filename, overwrite_if_changed=True)
55.     output.write(content)
56.     os.utime(filename, (0, 0))
57. 
58.     # overrite it again
59.     output.write(content)
60.     assert os.stat(filename).st_mtime == 0  # not updated
61. 
62.     # overrite it again (content changed)
63.     output.write(content + "; content change")
64.     assert os.stat(filename).st_mtime != 0  # updated
65. 
66. 
67. def test_SphinxTranslator(app):
68.     class CustomNode(nodes.inline):
69.         pass
70. 
71.     class MyTranslator(SphinxTranslator):
72.         def __init__(self, *args):
73.             self.called = []
74.             super().__init__(*args)
75. 
76.         def visit_document(self, node):
77.             pass
78. 
79.         def depart_document(self, node):
80.             pass
81. 
82.         def visit_inline(self, node):
83.             self.called.append('visit_inline')
84. 
85.         def depart_inline(self, node):
86.             self.called.append('depart_inline')
87. 
88.     document = new_document('')
89.     document += CustomNode()
90. 
91.     translator = MyTranslator(document, app.builder)
92.     document.walkabout(translator)
93. 
94.     # MyTranslator does not have visit_CustomNode. But it calls visit_inline instead.
95.     assert translator.called == ['visit_inline', 'depart_inline']

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 02:26:37,105 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find test cases related to a bug in parsing `:param` fields with complex types like `dict(str,str)`. The patch for this bug is in `sphinx/util/docfields.py`. The previously provided context from `tests/test_domain_py.py` and `tests/test_ext_autodoc.py` primarily contains tests for parsing type hints from directive signatures, not from `:param` fields within docstrings. The most relevant test file, `tests/test_util_docfields.py`, was requested previously but does not exist. Therefore, it is highly likely the relevant tests are in `tests/test_util.py` or `tests/test_markup.py`. Access to `sphinx/util/docfields.py` is also necessary to understand the context of the patched code.' query='Please provide the full content of `tests/test_util.py`, `tests/test_markup.py`, and `sphinx/util/docfields.py`.' extra_requirements='' purpose='These files are needed to find test cases for parsing complex types in docstring parameter fields, as the existing context lacks specific tests for the patched functionality in `sphinx/util/docfields.py`.'
2025-12-21 02:26:37,106 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `tests/test_util.py`, `tests/test_markup.py`, and `sphinx/util/docfields.py`.
2025-12-21 02:26:37,106 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-21 02:26:37,107 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-21 02:26:37,107 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-21 02:26:37,107 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `tests/test_util.py`, `tests/test_markup.py`, and `sphinx/util/docfields.py`.
Purpose: These files are needed to find test cases for parsing complex types in docstring parameter fields, as the existing context lacks specific tests for the patched functionality in `sphinx/util/docfields.py`.
2025-12-21 02:26:39,491 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have been asked to provide the full content of `tests/test_util.py`, `tests/test_markup.py`, and `sphinx/util/docfields.py`. I will now read and display the contents of these three files as requested.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "sphinx/util/docfields.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2111, 'candidates_token_count': 118, 'total_token_count': 2308, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2111}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 118}], 'thoughts_token_count': 79, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.07556602510355287, 'model_name': 'gemini-2.5-pro'} id='run--e220a1bc-094f-4914-8e55-5c6877d92b97-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/test_util.py'}, 'id': 'e4071490-7181-4c9e-8495-f23a4c8ab820', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/test_markup.py'}, 'id': '928f52c5-5343-4b90-b59e-4095ff434fdd', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'sphinx/util/docfields.py'}, 'id': 'c767affe-af65-4587-80c1-d4924cc21753', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2111, 'output_tokens': 118, 'total_tokens': 2308, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 79}}
2025-12-21 02:26:41,686 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have successfully retrieved the full contents of `tests/test_util.py`, `tests/test_markup.py`, and `sphinx/util/docfields.py`. This provides the necessary context for understanding the existing test cases and the implementation of docstring parameter field parsing. I can now proceed to analyze these files to find relevant examples and inform the creation of new tests for complex type parsing.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 18446, 'candidates_token_count': 82, 'total_token_count': 18576, 'cached_content_token_count': 1873, 'prompt_tokens_details': [{'modality': 1, 'token_count': 18446}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1873}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 82}], 'thoughts_token_count': 48}, 'finish_reason': 'STOP', 'avg_logprobs': -0.16734383745891293, 'model_name': 'gemini-2.5-pro'} id='run--fd226865-25d9-42d7-bff8-8ed499ca351f-0' usage_metadata={'input_tokens': 18446, 'output_tokens': 82, 'total_tokens': 18576, 'input_token_details': {'cache_read': 1873}, 'output_token_details': {'reasoning': 48}}
2025-12-21 02:26:41,688 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `tests/test_util.py`, `tests/test_markup.py`, and `sphinx/util/docfields.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
These files are needed to find test cases for parsing complex types in docstring parameter fields, as the existing context lacks specific tests for the patched functionality in `sphinx/util/docfields.py`.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: sphinx/util/docfields.py
Line number range: 1 - 344
Content:
1. """
2.     sphinx.util.docfields
3.     ~~~~~~~~~~~~~~~~~~~~~
4. 
5.     "Doc fields" are reST field lists in object descriptions that will
6.     be domain-specifically transformed to a more appealing presentation.
7. 
8.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
9.     :license: BSD, see LICENSE for details.
10. """
11. 
12. from typing import TYPE_CHECKING, Any, Dict, List, Tuple, Type, Union, cast
13. 
14. from docutils import nodes
15. from docutils.nodes import Node
16. 
17. from sphinx import addnodes
18. from sphinx.environment import BuildEnvironment
19. from sphinx.util.typing import TextlikeNode
20. 
21. if TYPE_CHECKING:
22.     from sphinx.directive import ObjectDescription
23. 
24. 
25. def _is_single_paragraph(node: nodes.field_body) -> bool:
26.     """True if the node only contains one paragraph (and system messages)."""
27.     if len(node) == 0:
28.         return False
29.     elif len(node) > 1:
30.         for subnode in node[1:]:  # type: Node
31.             if not isinstance(subnode, nodes.system_message):
32.                 return False
33.     if isinstance(node[0], nodes.paragraph):
34.         return True
35.     return False
36. 
37. 
38. class Field:
39.     """A doc field that is never grouped.  It can have an argument or not, the
40.     argument can be linked using a specified *rolename*.  Field should be used
41.     for doc fields that usually don't occur more than once.
42. 
43.     The body can be linked using a specified *bodyrolename* if the content is
44.     just a single inline or text node.
45. 
46.     Example::
47. 
48.        :returns: description of the return value
49.        :rtype: description of the return type
50.     """
51.     is_grouped = False
52.     is_typed = False
53. 
54.     def __init__(self, name: str, names: Tuple[str, ...] = (), label: str = None,
55.                  has_arg: bool = True, rolename: str = None, bodyrolename: str = None) -> None:
56.         self.name = name
57.         self.names = names
58.         self.label = label
59.         self.has_arg = has_arg
60.         self.rolename = rolename
61.         self.bodyrolename = bodyrolename
62. 
63.     def make_xref(self, rolename: str, domain: str, target: str,
64.                   innernode: Type[TextlikeNode] = addnodes.literal_emphasis,
65.                   contnode: Node = None, env: BuildEnvironment = None) -> Node:
66.         if not rolename:
67.             return contnode or innernode(target, target)
68.         refnode = addnodes.pending_xref('', refdomain=domain, refexplicit=False,
69.                                         reftype=rolename, reftarget=target)
70.         refnode += contnode or innernode(target, target)
71.         if env:
72.             env.get_domain(domain).process_field_xref(refnode)
73.         return refnode
74. 
75.     def make_xrefs(self, rolename: str, domain: str, target: str,
76.                    innernode: Type[TextlikeNode] = addnodes.literal_emphasis,
77.                    contnode: Node = None, env: BuildEnvironment = None) -> List[Node]:
78.         return [self.make_xref(rolename, domain, target, innernode, contnode, env)]
79. 
80.     def make_entry(self, fieldarg: str, content: List[Node]) -> Tuple[str, List[Node]]:
81.         return (fieldarg, content)
82. 
83.     def make_field(self, types: Dict[str, List[Node]], domain: str,
84.                    item: Tuple, env: BuildEnvironment = None) -> nodes.field:
85.         fieldarg, content = item
86.         fieldname = nodes.field_name('', self.label)
87.         if fieldarg:
88.             fieldname += nodes.Text(' ')
89.             fieldname.extend(self.make_xrefs(self.rolename, domain,
90.                                              fieldarg, nodes.Text, env=env))
91. 
92.         if len(content) == 1 and (
93.                 isinstance(content[0], nodes.Text) or
94.                 (isinstance(content[0], nodes.inline) and len(content[0]) == 1 and
95.                  isinstance(content[0][0], nodes.Text))):
96.             content = self.make_xrefs(self.bodyrolename, domain,
97.                                       content[0].astext(), contnode=content[0], env=env)
98.         fieldbody = nodes.field_body('', nodes.paragraph('', '', *content))
99.         return nodes.field('', fieldname, fieldbody)
100. 
101. 
102. class GroupedField(Field):
103.     """
104.     A doc field that is grouped; i.e., all fields of that type will be
105.     transformed into one field with its body being a bulleted list.  It always
106.     has an argument.  The argument can be linked using the given *rolename*.
107.     GroupedField should be used for doc fields that can occur more than once.
108.     If *can_collapse* is true, this field will revert to a Field if only used
109.     once.
110. 
111.     Example::
112. 
113.        :raises ErrorClass: description when it is raised
114.     """
115.     is_grouped = True
116.     list_type = nodes.bullet_list
117. 
118.     def __init__(self, name: str, names: Tuple[str, ...] = (), label: str = None,
119.                  rolename: str = None, can_collapse: bool = False) -> None:
120.         super().__init__(name, names, label, True, rolename)
121.         self.can_collapse = can_collapse
122. 
123.     def make_field(self, types: Dict[str, List[Node]], domain: str,
124.                    items: Tuple, env: BuildEnvironment = None) -> nodes.field:
125.         fieldname = nodes.field_name('', self.label)
126.         listnode = self.list_type()
127.         for fieldarg, content in items:
128.             par = nodes.paragraph()
129.             par.extend(self.make_xrefs(self.rolename, domain, fieldarg,
130.                                        addnodes.literal_strong, env=env))
131.             par += nodes.Text(' -- ')
132.             par += content
133.             listnode += nodes.list_item('', par)
134. 
135.         if len(items) == 1 and self.can_collapse:
136.             list_item = cast(nodes.list_item, listnode[0])
137.             fieldbody = nodes.field_body('', list_item[0])
138.             return nodes.field('', fieldname, fieldbody)
139. 
140.         fieldbody = nodes.field_body('', listnode)
141.         return nodes.field('', fieldname, fieldbody)
142. 
143. 
144. class TypedField(GroupedField):
145.     """
146.     A doc field that is grouped and has type information for the arguments.  It
147.     always has an argument.  The argument can be linked using the given
148.     *rolename*, the type using the given *typerolename*.
149. 
150.     Two uses are possible: either parameter and type description are given
151.     separately, using a field from *names* and one from *typenames*,
152.     respectively, or both are given using a field from *names*, see the example.
153. 
154.     Example::
155. 
156.        :param foo: description of parameter foo
157.        :type foo:  SomeClass
158. 
159.        -- or --
160. 
161.        :param SomeClass foo: description of parameter foo
162.     """
163.     is_typed = True
164. 
165.     def __init__(self, name: str, names: Tuple[str, ...] = (), typenames: Tuple[str, ...] = (),
166.                  label: str = None, rolename: str = None, typerolename: str = None,
167.                  can_collapse: bool = False) -> None:
168.         super().__init__(name, names, label, rolename, can_collapse)
169.         self.typenames = typenames
170.         self.typerolename = typerolename
171. 
172.     def make_field(self, types: Dict[str, List[Node]], domain: str,
173.                    items: Tuple, env: BuildEnvironment = None) -> nodes.field:
174.         def handle_item(fieldarg: str, content: str) -> nodes.paragraph:
175.             par = nodes.paragraph()
176.             par.extend(self.make_xrefs(self.rolename, domain, fieldarg,
177.                                        addnodes.literal_strong, env=env))
178.             if fieldarg in types:
179.                 par += nodes.Text(' (')
180.                 # NOTE: using .pop() here to prevent a single type node to be
181.                 # inserted twice into the doctree, which leads to
182.                 # inconsistencies later when references are resolved
183.                 fieldtype = types.pop(fieldarg)
184.                 if len(fieldtype) == 1 and isinstance(fieldtype[0], nodes.Text):
185.                     typename = fieldtype[0].astext()
186.                     par.extend(self.make_xrefs(self.typerolename, domain, typename,
187.                                                addnodes.literal_emphasis, env=env))
188.                 else:
189.                     par += fieldtype
190.                 par += nodes.Text(')')
191.             par += nodes.Text(' -- ')
192.             par += content
193.             return par
194. 
195.         fieldname = nodes.field_name('', self.label)
196.         if len(items) == 1 and self.can_collapse:
197.             fieldarg, content = items[0]
198.             bodynode: Node = handle_item(fieldarg, content)
199.         else:
200.             bodynode = self.list_type()
201.             for fieldarg, content in items:
202.                 bodynode += nodes.list_item('', handle_item(fieldarg, content))
203.         fieldbody = nodes.field_body('', bodynode)
204.         return nodes.field('', fieldname, fieldbody)
205. 
206. 
207. class DocFieldTransformer:
208.     """
209.     Transforms field lists in "doc field" syntax into better-looking
210.     equivalents, using the field type definitions given on a domain.
211.     """
212.     typemap: Dict[str, Tuple[Field, bool]]
213. 
214.     def __init__(self, directive: "ObjectDescription") -> None:
215.         self.directive = directive
216. 
217.         self.typemap = directive.get_field_type_map()
218. 
219.     def transform_all(self, node: addnodes.desc_content) -> None:
220.         """Transform all field list children of a node."""
221.         # don't traverse, only handle field lists that are immediate children
222.         for child in node:
223.             if isinstance(child, nodes.field_list):
224.                 self.transform(child)
225. 
226.     def transform(self, node: nodes.field_list) -> None:
227.         """Transform a single field list *node*."""
228.         typemap = self.typemap
229. 
230.         entries: List[Union[nodes.field, Tuple[Field, Any]]] = []
231.         groupindices: Dict[str, int] = {}
232.         types: Dict[str, Dict] = {}
233. 
234.         # step 1: traverse all fields and collect field types and content
235.         for field in cast(List[nodes.field], node):
236.             assert len(field) == 2
237.             field_name = cast(nodes.field_name, field[0])
238.             field_body = cast(nodes.field_body, field[1])
239.             try:
240.                 # split into field type and argument
241.                 fieldtype_name, fieldarg = field_name.astext().split(None, 1)
242.             except ValueError:
243.                 # maybe an argument-less field type?
244.                 fieldtype_name, fieldarg = field_name.astext(), ''
245.             typedesc, is_typefield = typemap.get(fieldtype_name, (None, None))
246. 
247.             # collect the content, trying not to keep unnecessary paragraphs
248.             if _is_single_paragraph(field_body):
249.                 paragraph = cast(nodes.paragraph, field_body[0])
250.                 content = paragraph.children
251.             else:
252.                 content = field_body.children
253. 
254.             # sort out unknown fields
255.             if typedesc is None or typedesc.has_arg != bool(fieldarg):
256.                 # either the field name is unknown, or the argument doesn't
257.                 # match the spec; capitalize field name and be done with it
258.                 new_fieldname = fieldtype_name[0:1].upper() + fieldtype_name[1:]
259.                 if fieldarg:
260.                     new_fieldname += ' ' + fieldarg
261.                 field_name[0] = nodes.Text(new_fieldname)
262.                 entries.append(field)
263. 
264.                 # but if this has a type then we can at least link it
265.                 if (typedesc and is_typefield and content and
266.                         len(content) == 1 and isinstance(content[0], nodes.Text)):
267.                     typed_field = cast(TypedField, typedesc)
268.                     target = content[0].astext()
269.                     xrefs = typed_field.make_xrefs(
270.                         typed_field.typerolename,
271.                         self.directive.domain,
272.                         target,
273.                         contnode=content[0],
274.                         env=self.directive.state.document.settings.env
275.                     )
276.                     if _is_single_paragraph(field_body):
277.                         paragraph = cast(nodes.paragraph, field_body[0])
278.                         paragraph.clear()
279.                         paragraph.extend(xrefs)
280.                     else:
281.                         field_body.clear()
282.                         field_body += nodes.paragraph('', '', *xrefs)
283. 
284.                 continue
285. 
286.             typename = typedesc.name
287. 
288.             # if the field specifies a type, put it in the types collection
289.             if is_typefield:
290.                 # filter out only inline nodes; others will result in invalid
291.                 # markup being written out
292.                 content = [n for n in content if isinstance(n, nodes.Inline) or
293.                            isinstance(n, nodes.Text)]
294.                 if content:
295.                     types.setdefault(typename, {})[fieldarg] = content
296.                 continue
297. 
298.             # also support syntax like ``:param type name:``
299.             if typedesc.is_typed:
300.                 try:
301.                     argtype, argname = fieldarg.split(None, 1)
302.                 except ValueError:
303.                     pass
304.                 else:
305.                     types.setdefault(typename, {})[argname] = \
306.                         [nodes.Text(argtype)]
307.                     fieldarg = argname
308. 
309.             translatable_content = nodes.inline(field_body.rawsource,
310.                                                 translatable=True)
311.             translatable_content.document = field_body.parent.document
312.             translatable_content.source = field_body.parent.source
313.             translatable_content.line = field_body.parent.line
314.             translatable_content += content
315. 
316.             # grouped entries need to be collected in one entry, while others
317.             # get one entry per field
318.             if typedesc.is_grouped:
319.                 if typename in groupindices:
320.                     group = cast(Tuple[Field, List], entries[groupindices[typename]])
321.                 else:
322.                     groupindices[typename] = len(entries)
323.                     group = (typedesc, [])
324.                     entries.append(group)
325.                 new_entry = typedesc.make_entry(fieldarg, [translatable_content])
326.                 group[1].append(new_entry)
327.             else:
328.                 new_entry = typedesc.make_entry(fieldarg, [translatable_content])
329.                 entries.append((typedesc, new_entry))
330. 
331.         # step 2: all entries are collected, construct the new field list
332.         new_list = nodes.field_list()
333.         for entry in entries:
334.             if isinstance(entry, nodes.field):
335.                 # pass-through old field
336.                 new_list += entry
337.             else:
338.                 fieldtype, items = entry
339.                 fieldtypes = types.get(fieldtype.name, {})
340.                 env = self.directive.state.document.settings.env
341.                 new_list += fieldtype.make_field(fieldtypes, self.directive.domain,
342.                                                  items, env=env)
343. 
344.         node.replace_self(new_list)


File: tests/test_markup.py
Line number range: 1 - 500
Content:
1. """
2.     test_markup
3.     ~~~~~~~~~~~
4. 
5.     Test various Sphinx-specific markup extensions.
6. 
7.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import re
12. 
13. import pytest
14. from docutils import frontend, nodes, utils
15. from docutils.parsers.rst import Parser as RstParser
16. 
17. from sphinx import addnodes
18. from sphinx.builders.html.transforms import KeyboardTransform
19. from sphinx.builders.latex import LaTeXBuilder
20. from sphinx.roles import XRefRole
21. from sphinx.testing.util import Struct, assert_node
22. from sphinx.transforms import SphinxSmartQuotes
23. from sphinx.util import docutils, texescape
24. from sphinx.util.docutils import sphinx_domains
25. from sphinx.writers.html import HTMLTranslator, HTMLWriter
26. from sphinx.writers.latex import LaTeXTranslator, LaTeXWriter
27. 
28. 
29. @pytest.fixture
30. def settings(app):
31.     texescape.init()  # otherwise done by the latex builder
32.     optparser = frontend.OptionParser(
33.         components=(RstParser, HTMLWriter, LaTeXWriter))
34.     settings = optparser.get_default_values()
35.     settings.smart_quotes = True
36.     settings.env = app.builder.env
37.     settings.env.temp_data['docname'] = 'dummy'
38.     settings.contentsname = 'dummy'
39.     settings.rfc_base_url = 'http://tools.ietf.org/html/'
40.     domain_context = sphinx_domains(settings.env)
41.     domain_context.enable()
42.     yield settings
43.     domain_context.disable()
44. 
45. 
46. @pytest.fixture
47. def new_document(settings):
48.     def create():
49.         document = utils.new_document('test data', settings)
50.         document['file'] = 'dummy'
51.         return document
52. 
53.     return create
54. 
55. 
56. @pytest.fixture
57. def inliner(new_document):
58.     document = new_document()
59.     document.reporter.get_source_and_line = lambda line=1: ('dummy.rst', line)
60.     return Struct(document=document, reporter=document.reporter)
61. 
62. 
63. @pytest.fixture
64. def parse(new_document):
65.     def parse_(rst):
66.         document = new_document()
67.         parser = RstParser()
68.         parser.parse(rst, document)
69.         SphinxSmartQuotes(document, startnode=None).apply()
70.         for msg in document.traverse(nodes.system_message):
71.             if msg['level'] == 1:
72.                 msg.replace_self([])
73.         return document
74.     return parse_
75. 
76. 
77. # since we're not resolving the markup afterwards, these nodes may remain
78. class ForgivingTranslator:
79.     def visit_pending_xref(self, node):
80.         pass
81. 
82.     def depart_pending_xref(self, node):
83.         pass
84. 
85. 
86. class ForgivingHTMLTranslator(HTMLTranslator, ForgivingTranslator):
87.     pass
88. 
89. 
90. class ForgivingLaTeXTranslator(LaTeXTranslator, ForgivingTranslator):
91.     pass
92. 
93. 
94. @pytest.fixture
95. def verify_re_html(app, parse):
96.     def verify(rst, html_expected):
97.         document = parse(rst)
98.         KeyboardTransform(document).apply()
99.         html_translator = ForgivingHTMLTranslator(document, app.builder)
100.         document.walkabout(html_translator)
101.         html_translated = ''.join(html_translator.fragment).strip()
102.         assert re.match(html_expected, html_translated), 'from ' + rst
103.     return verify
104. 
105. 
106. @pytest.fixture
107. def verify_re_latex(app, parse):
108.     def verify(rst, latex_expected):
109.         document = parse(rst)
110.         app.builder = LaTeXBuilder(app)
111.         app.builder.set_environment(app.env)
112.         app.builder.init()
113.         theme = app.builder.themes.get('manual')
114.         latex_translator = ForgivingLaTeXTranslator(document, app.builder, theme)
115.         latex_translator.first_document = -1  # don't write \begin{document}
116.         document.walkabout(latex_translator)
117.         latex_translated = ''.join(latex_translator.body).strip()
118.         assert re.match(latex_expected, latex_translated), 'from ' + repr(rst)
119.     return verify
120. 
121. 
122. @pytest.fixture
123. def verify_re(verify_re_html, verify_re_latex):
124.     def verify_re_(rst, html_expected, latex_expected):
125.         if html_expected:
126.             verify_re_html(rst, html_expected)
127.         if latex_expected:
128.             verify_re_latex(rst, latex_expected)
129.     return verify_re_
130. 
131. 
132. @pytest.fixture
133. def verify(verify_re_html, verify_re_latex):
134.     def verify_(rst, html_expected, latex_expected):
135.         if html_expected:
136.             verify_re_html(rst, re.escape(html_expected) + '$')
137.         if latex_expected:
138.             verify_re_latex(rst, re.escape(latex_expected) + '$')
139.     return verify_
140. 
141. 
142. @pytest.fixture
143. def get_verifier(verify, verify_re):
144.     v = {
145.         'verify': verify,
146.         'verify_re': verify_re,
147.     }
148. 
149.     def get(name):
150.         return v[name]
151.     return get
152. 
153. 
154. @pytest.mark.parametrize('type,rst,html_expected,latex_expected', [
155.     (
156.         # pep role
157.         'verify',
158.         ':pep:`8`',
159.         ('<p><span class="target" id="index-0"></span><a class="pep reference external" '
160.          'href="http://www.python.org/dev/peps/pep-0008"><strong>PEP 8</strong></a></p>'),
161.         ('\\sphinxAtStartPar\n'
162.          '\\index{Python Enhancement Proposals@\\spxentry{Python Enhancement Proposals}'
163.          '!PEP 8@\\spxentry{PEP 8}}\\sphinxhref{http://www.python.org/dev/peps/pep-0008}'
164.          '{\\sphinxstylestrong{PEP 8}}')
165.     ),
166.     (
167.         # pep role with anchor
168.         'verify',
169.         ':pep:`8#id1`',
170.         ('<p><span class="target" id="index-0"></span><a class="pep reference external" '
171.          'href="http://www.python.org/dev/peps/pep-0008#id1">'
172.          '<strong>PEP 8#id1</strong></a></p>'),
173.         ('\\sphinxAtStartPar\n'
174.          '\\index{Python Enhancement Proposals@\\spxentry{Python Enhancement Proposals}'
175.          '!PEP 8\\#id1@\\spxentry{PEP 8\\#id1}}\\sphinxhref'
176.          '{http://www.python.org/dev/peps/pep-0008\\#id1}'
177.          '{\\sphinxstylestrong{PEP 8\\#id1}}')
178.     ),
179.     (
180.         # rfc role
181.         'verify',
182.         ':rfc:`2324`',
183.         ('<p><span class="target" id="index-0"></span><a class="rfc reference external" '
184.          'href="http://tools.ietf.org/html/rfc2324.html"><strong>RFC 2324</strong></a></p>'),
185.         ('\\sphinxAtStartPar\n'
186.          '\\index{RFC@\\spxentry{RFC}!RFC 2324@\\spxentry{RFC 2324}}'
187.          '\\sphinxhref{http://tools.ietf.org/html/rfc2324.html}'
188.          '{\\sphinxstylestrong{RFC 2324}}')
189.     ),
190.     (
191.         # rfc role with anchor
192.         'verify',
193.         ':rfc:`2324#id1`',
194.         ('<p><span class="target" id="index-0"></span><a class="rfc reference external" '
195.          'href="http://tools.ietf.org/html/rfc2324.html#id1">'
196.          '<strong>RFC 2324#id1</strong></a></p>'),
197.         ('\\sphinxAtStartPar\n'
198.          '\\index{RFC@\\spxentry{RFC}!RFC 2324\\#id1@\\spxentry{RFC 2324\\#id1}}'
199.          '\\sphinxhref{http://tools.ietf.org/html/rfc2324.html\\#id1}'
200.          '{\\sphinxstylestrong{RFC 2324\\#id1}}')
201.     ),
202.     (
203.         # correct interpretation of code with whitespace
204.         'verify_re',
205.         '``code   sample``',
206.         ('<p><code class="(samp )?docutils literal notranslate"><span class="pre">'
207.          'code</span>&#160;&#160; <span class="pre">sample</span></code></p>'),
208.         r'\\sphinxAtStartPar\n\\sphinxcode{\\sphinxupquote{code   sample}}',
209.     ),
210.     (
211.         # interpolation of arrows in menuselection
212.         'verify',
213.         ':menuselection:`a --> b`',
214.         ('<p><span class="menuselection">a \N{TRIANGULAR BULLET} b</span></p>'),
215.         '\\sphinxAtStartPar\n\\sphinxmenuselection{a \\(\\rightarrow\\) b}',
216.     ),
217.     (
218.         # interpolation of ampersands in menuselection
219.         'verify',
220.         ':menuselection:`&Foo -&&- &Bar`',
221.         ('<p><span class="menuselection"><span class="accelerator">F</span>oo '
222.          '-&amp;- <span class="accelerator">B</span>ar</span></p>'),
223.         ('\\sphinxAtStartPar\n'
224.          r'\sphinxmenuselection{\sphinxaccelerator{F}oo \sphinxhyphen{}'
225.          r'\&\sphinxhyphen{} \sphinxaccelerator{B}ar}'),
226.     ),
227.     (
228.         # interpolation of ampersands in guilabel
229.         'verify',
230.         ':guilabel:`&Foo -&&- &Bar`',
231.         ('<p><span class="guilabel"><span class="accelerator">F</span>oo '
232.          '-&amp;- <span class="accelerator">B</span>ar</span></p>'),
233.         ('\\sphinxAtStartPar\n'
234.          r'\sphinxguilabel{\sphinxaccelerator{F}oo \sphinxhyphen{}\&\sphinxhyphen{} \sphinxaccelerator{B}ar}'),
235.     ),
236.     (
237.         # no ampersands in guilabel
238.         'verify',
239.         ':guilabel:`Foo`',
240.         '<p><span class="guilabel">Foo</span></p>',
241.         '\\sphinxAtStartPar\n\\sphinxguilabel{Foo}',
242.     ),
243.     (
244.         # kbd role
245.         'verify',
246.         ':kbd:`space`',
247.         '<p><kbd class="kbd docutils literal notranslate">space</kbd></p>',
248.         '\\sphinxAtStartPar\n\\sphinxkeyboard{\\sphinxupquote{space}}',
249.     ),
250.     (
251.         # kbd role
252.         'verify',
253.         ':kbd:`Control+X`',
254.         ('<p><kbd class="kbd compound docutils literal notranslate">'
255.          '<kbd class="kbd docutils literal notranslate">Control</kbd>'
256.          '+'
257.          '<kbd class="kbd docutils literal notranslate">X</kbd>'
258.          '</kbd></p>'),
259.         '\\sphinxAtStartPar\n\\sphinxkeyboard{\\sphinxupquote{Control+X}}',
260.     ),
261.     (
262.         # kbd role
263.         'verify',
264.         ':kbd:`Alt+^`',
265.         ('<p><kbd class="kbd compound docutils literal notranslate">'
266.          '<kbd class="kbd docutils literal notranslate">Alt</kbd>'
267.          '+'
268.          '<kbd class="kbd docutils literal notranslate">^</kbd>'
269.          '</kbd></p>'),
270.         ('\\sphinxAtStartPar\n'
271.          '\\sphinxkeyboard{\\sphinxupquote{Alt+\\textasciicircum{}}}'),
272.     ),
273.     (
274.         # kbd role
275.         'verify',
276.         ':kbd:`M-x  M-s`',
277.         ('<p><kbd class="kbd compound docutils literal notranslate">'
278.          '<kbd class="kbd docutils literal notranslate">M</kbd>'
279.          '-'
280.          '<kbd class="kbd docutils literal notranslate">x</kbd>'
281.          '  '
282.          '<kbd class="kbd docutils literal notranslate">M</kbd>'
283.          '-'
284.          '<kbd class="kbd docutils literal notranslate">s</kbd>'
285.          '</kbd></p>'),
286.         ('\\sphinxAtStartPar\n'
287.          '\\sphinxkeyboard{\\sphinxupquote{M\\sphinxhyphen{}x  M\\sphinxhyphen{}s}}'),
288.     ),
289.     (
290.         # kbd role
291.         'verify',
292.         ':kbd:`-`',
293.         '<p><kbd class="kbd docutils literal notranslate">-</kbd></p>',
294.         ('\\sphinxAtStartPar\n'
295.          '\\sphinxkeyboard{\\sphinxupquote{\\sphinxhyphen{}}}'),
296.     ),
297.     (
298.         # kbd role
299.         'verify',
300.         ':kbd:`Caps Lock`',
301.         '<p><kbd class="kbd docutils literal notranslate">Caps Lock</kbd></p>',
302.         ('\\sphinxAtStartPar\n'
303.          '\\sphinxkeyboard{\\sphinxupquote{Caps Lock}}'),
304.     ),
305.     (
306.         # non-interpolation of dashes in option role
307.         'verify_re',
308.         ':option:`--with-option`',
309.         ('<p><code( class="xref std std-option docutils literal notranslate")?>'
310.          '<span class="pre">--with-option</span></code></p>$'),
311.         (r'\\sphinxAtStartPar\n'
312.          r'\\sphinxcode{\\sphinxupquote{\\sphinxhyphen{}\\sphinxhyphen{}with\\sphinxhyphen{}option}}$'),
313.     ),
314.     (
315.         # verify smarty-pants quotes
316.         'verify',
317.         '"John"',
318.         '<p>“John”</p>',
319.         "\\sphinxAtStartPar\n“John”",
320.     ),
321.     (
322.         # ... but not in literal text
323.         'verify',
324.         '``"John"``',
325.         ('<p><code class="docutils literal notranslate"><span class="pre">'
326.          '&quot;John&quot;</span></code></p>'),
327.         '\\sphinxAtStartPar\n\\sphinxcode{\\sphinxupquote{"John"}}',
328.     ),
329.     (
330.         # verify classes for inline roles
331.         'verify',
332.         ':manpage:`mp(1)`',
333.         '<p><em class="manpage">mp(1)</em></p>',
334.         '\\sphinxAtStartPar\n\\sphinxstyleliteralemphasis{\\sphinxupquote{mp(1)}}',
335.     ),
336.     (
337.         # correct escaping in normal mode
338.         'verify',
339.         'Γ\\\\∞$',
340.         None,
341.         '\\sphinxAtStartPar\nΓ\\textbackslash{}\\(\\infty\\)\\$',
342.     ),
343.     (
344.         # in verbatim code fragments
345.         'verify',
346.         '::\n\n @Γ\\∞${}',
347.         None,
348.         ('\\begin{sphinxVerbatim}[commandchars=\\\\\\{\\}]\n'
349.          '@Γ\\PYGZbs{}\\(\\infty\\)\\PYGZdl{}\\PYGZob{}\\PYGZcb{}\n'
350.          '\\end{sphinxVerbatim}'),
351.     ),
352.     (
353.         # in URIs
354.         'verify_re',
355.         '`test <https://www.google.com/~me/>`_',
356.         None,
357.         r'\\sphinxAtStartPar\n\\sphinxhref{https://www.google.com/~me/}{test}.*',
358.     ),
359.     (
360.         # description list: simple
361.         'verify',
362.         'term\n    description',
363.         '<dl class="docutils">\n<dt>term</dt><dd>description</dd>\n</dl>',
364.         None,
365.     ),
366.     (
367.         # description list: with classifiers
368.         'verify',
369.         'term : class1 : class2\n    description',
370.         ('<dl class="docutils">\n<dt>term<span class="classifier">class1</span>'
371.          '<span class="classifier">class2</span></dt><dd>description</dd>\n</dl>'),
372.         None,
373.     ),
374.     (
375.         # glossary (description list): multiple terms
376.         'verify',
377.         '.. glossary::\n\n   term1\n   term2\n       description',
378.         ('<dl class="glossary docutils">\n'
379.          '<dt id="term-term1">term1<a class="headerlink" href="#term-term1"'
380.          ' title="Permalink to this term">¶</a></dt>'
381.          '<dt id="term-term2">term2<a class="headerlink" href="#term-term2"'
382.          ' title="Permalink to this term">¶</a></dt>'
383.          '<dd>description</dd>\n</dl>'),
384.         None,
385.     ),
386. ])
387. def test_inline(get_verifier, type, rst, html_expected, latex_expected):
388.     verifier = get_verifier(type)
389.     verifier(rst, html_expected, latex_expected)
390. 
391. 
392. @pytest.mark.parametrize('type,rst,html_expected,latex_expected', [
393.     (
394.         'verify',
395.         r'4 backslashes \\\\',
396.         r'<p>4 backslashes \\</p>',
397.         None,
398.     ),
399. ])
400. @pytest.mark.skipif(docutils.__version_info__ < (0, 16),
401.                     reason='docutils-0.16 or above is required')
402. def test_inline_docutils16(get_verifier, type, rst, html_expected, latex_expected):
403.     verifier = get_verifier(type)
404.     verifier(rst, html_expected, latex_expected)
405. 
406. 
407. @pytest.mark.sphinx(confoverrides={'latex_engine': 'xelatex'})
408. @pytest.mark.parametrize('type,rst,html_expected,latex_expected', [
409.     (
410.         # in verbatim code fragments
411.         'verify',
412.         '::\n\n @Γ\\∞${}',
413.         None,
414.         ('\\begin{sphinxVerbatim}[commandchars=\\\\\\{\\}]\n'
415.          '@Γ\\PYGZbs{}∞\\PYGZdl{}\\PYGZob{}\\PYGZcb{}\n'
416.          '\\end{sphinxVerbatim}'),
417.     ),
418. ])
419. def test_inline_for_unicode_latex_engine(get_verifier, type, rst,
420.                                          html_expected, latex_expected):
421.     verifier = get_verifier(type)
422.     verifier(rst, html_expected, latex_expected)
423. 
424. 
425. def test_samp_role(parse):
426.     # no braces
427.     text = ':samp:`a{b}c`'
428.     doctree = parse(text)
429.     assert_node(doctree[0], [nodes.paragraph, nodes.literal, ("a",
430.                                                               [nodes.emphasis, "b"],
431.                                                               "c")])
432.     # nested braces
433.     text = ':samp:`a{{b}}c`'
434.     doctree = parse(text)
435.     assert_node(doctree[0], [nodes.paragraph, nodes.literal, ("a",
436.                                                               [nodes.emphasis, "{b"],
437.                                                               "}c")])
438. 
439.     # half-opened braces
440.     text = ':samp:`a{bc`'
441.     doctree = parse(text)
442.     assert_node(doctree[0], [nodes.paragraph, nodes.literal, "a{bc"])
443. 
444.     # escaped braces
445.     text = ':samp:`a\\\\{b}c`'
446.     doctree = parse(text)
447.     assert_node(doctree[0], [nodes.paragraph, nodes.literal, "a{b}c"])
448. 
449.     # no braces (whitespaces are keeped as is)
450.     text = ':samp:`code   sample`'
451.     doctree = parse(text)
452.     assert_node(doctree[0], [nodes.paragraph, nodes.literal, "code   sample"])
453. 
454. 
455. def test_download_role(parse):
456.     # implicit
457.     text = ':download:`sphinx.rst`'
458.     doctree = parse(text)
459.     assert_node(doctree[0], [nodes.paragraph, addnodes.download_reference,
460.                              nodes.literal, "sphinx.rst"])
461.     assert_node(doctree[0][0], refdoc='dummy', refdomain='', reftype='download',
462.                 refexplicit=False, reftarget='sphinx.rst', refwarn=False)
463.     assert_node(doctree[0][0][0], classes=['xref', 'download'])
464. 
465.     # explicit
466.     text = ':download:`reftitle <sphinx.rst>`'
467.     doctree = parse(text)
468.     assert_node(doctree[0], [nodes.paragraph, addnodes.download_reference,
469.                              nodes.literal, "reftitle"])
470.     assert_node(doctree[0][0], refdoc='dummy', refdomain='', reftype='download',
471.                 refexplicit=True, reftarget='sphinx.rst', refwarn=False)
472.     assert_node(doctree[0][0][0], classes=['xref', 'download'])
473. 
474. 
475. def test_XRefRole(inliner):
476.     role = XRefRole()
477. 
478.     # implicit
479.     doctrees, errors = role('ref', 'rawtext', 'text', 5, inliner, {}, [])
480.     assert len(doctrees) == 1
481.     assert_node(doctrees[0], [addnodes.pending_xref, nodes.literal, 'text'])
482.     assert_node(doctrees[0], refdoc='dummy', refdomain='', reftype='ref', reftarget='text',
483.                 refexplicit=False, refwarn=False)
484.     assert errors == []
485. 
486.     # explicit
487.     doctrees, errors = role('ref', 'rawtext', 'title <target>', 5, inliner, {}, [])
488.     assert_node(doctrees[0], [addnodes.pending_xref, nodes.literal, 'title'])
489.     assert_node(doctrees[0], refdoc='dummy', refdomain='', reftype='ref', reftarget='target',
490.                 refexplicit=True, refwarn=False)
491. 
492.     # bang
493.     doctrees, errors = role('ref', 'rawtext', '!title <target>', 5, inliner, {}, [])
494.     assert_node(doctrees[0], [nodes.literal, 'title <target>'])
495. 
496.     # refdomain
497.     doctrees, errors = role('test:doc', 'rawtext', 'text', 5, inliner, {}, [])
498.     assert_node(doctrees[0], [addnodes.pending_xref, nodes.literal, 'text'])
499.     assert_node(doctrees[0], refdoc='dummy', refdomain='test', reftype='doc', reftarget='text',
500.                 refexplicit=False, refwarn=False)


File: tests/test_util.py
Line number range: 1 - 175
Content:
1. """
2.     test_util
3.     ~~~~~~~~~~~~~~~
4. 
5.     Tests util functions.
6. 
7.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import os
12. import tempfile
13. from unittest.mock import patch
14. 
15. import pytest
16. 
17. from sphinx.errors import ExtensionError
18. from sphinx.testing.util import strip_escseq
19. from sphinx.util import (SkipProgressMessage, display_chunk, encode_uri, ensuredir,
20.                          import_object, logging, parselinenos, progress_message,
21.                          status_iterator, xmlname_checker)
22. 
23. 
24. def test_encode_uri():
25.     expected = ('https://ru.wikipedia.org/wiki/%D0%A1%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0_'
26.                 '%D1%83%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F_'
27.                 '%D0%B1%D0%B0%D0%B7%D0%B0%D0%BC%D0%B8_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85')
28.     uri = ('https://ru.wikipedia.org/wiki'
29.            '/Система_управления_базами_данных')
30.     assert expected == encode_uri(uri)
31. 
32.     expected = ('https://github.com/search?utf8=%E2%9C%93&q=is%3Aissue+is%3Aopen+is%3A'
33.                 'sprint-friendly+user%3Ajupyter&type=Issues&ref=searchresults')
34.     uri = ('https://github.com/search?utf8=✓&q=is%3Aissue+is%3Aopen+is%3A'
35.            'sprint-friendly+user%3Ajupyter&type=Issues&ref=searchresults')
36.     assert expected == encode_uri(uri)
37. 
38. 
39. def test_ensuredir():
40.     with tempfile.TemporaryDirectory() as tmp_path:
41.         # Does not raise an exception for an existing directory.
42.         ensuredir(tmp_path)
43. 
44.         path = os.path.join(tmp_path, 'a', 'b', 'c')
45.         ensuredir(path)
46.         assert os.path.isdir(path)
47. 
48.     with tempfile.NamedTemporaryFile() as tmp:
49.         with pytest.raises(OSError):
50.             ensuredir(tmp.name)
51. 
52. 
53. def test_display_chunk():
54.     assert display_chunk('hello') == 'hello'
55.     assert display_chunk(['hello']) == 'hello'
56.     assert display_chunk(['hello', 'sphinx', 'world']) == 'hello .. world'
57.     assert display_chunk(('hello',)) == 'hello'
58.     assert display_chunk(('hello', 'sphinx', 'world')) == 'hello .. world'
59. 
60. 
61. def test_import_object():
62.     module = import_object('sphinx')
63.     assert module.__name__ == 'sphinx'
64. 
65.     module = import_object('sphinx.application')
66.     assert module.__name__ == 'sphinx.application'
67. 
68.     obj = import_object('sphinx.application.Sphinx')
69.     assert obj.__name__ == 'Sphinx'
70. 
71.     with pytest.raises(ExtensionError) as exc:
72.         import_object('sphinx.unknown_module')
73.     assert exc.value.args[0] == 'Could not import sphinx.unknown_module'
74. 
75.     with pytest.raises(ExtensionError) as exc:
76.         import_object('sphinx.unknown_module', 'my extension')
77.     assert exc.value.args[0] == ('Could not import sphinx.unknown_module '
78.                                  '(needed for my extension)')
79. 
80. 
81. @pytest.mark.sphinx('dummy')
82. @patch('sphinx.util.console._tw', 40)  # terminal width = 40
83. def test_status_iterator(app, status, warning):
84.     logging.setup(app, status, warning)
85. 
86.     # test for old_status_iterator
87.     status.truncate(0)
88.     yields = list(status_iterator(['hello', 'sphinx', 'world'], 'testing ... '))
89.     output = strip_escseq(status.getvalue())
90.     assert 'testing ... hello sphinx world \n' in output
91.     assert yields == ['hello', 'sphinx', 'world']
92. 
93.     # test for status_iterator (verbosity=0)
94.     status.truncate(0)
95.     yields = list(status_iterator(['hello', 'sphinx', 'world'], 'testing ... ',
96.                                   length=3, verbosity=0))
97.     output = strip_escseq(status.getvalue())
98.     assert 'testing ... [ 33%] hello                \r' in output
99.     assert 'testing ... [ 66%] sphinx               \r' in output
100.     assert 'testing ... [100%] world                \r\n' in output
101.     assert yields == ['hello', 'sphinx', 'world']
102. 
103.     # test for status_iterator (verbosity=1)
104.     status.truncate(0)
105.     yields = list(status_iterator(['hello', 'sphinx', 'world'], 'testing ... ',
106.                                   length=3, verbosity=1))
107.     output = strip_escseq(status.getvalue())
108.     assert 'testing ... [ 33%] hello\n' in output
109.     assert 'testing ... [ 66%] sphinx\n' in output
110.     assert 'testing ... [100%] world\n\n' in output
111.     assert yields == ['hello', 'sphinx', 'world']
112. 
113. 
114. def test_parselinenos():
115.     assert parselinenos('1,2,3', 10) == [0, 1, 2]
116.     assert parselinenos('4, 5, 6', 10) == [3, 4, 5]
117.     assert parselinenos('-4', 10) == [0, 1, 2, 3]
118.     assert parselinenos('7-9', 10) == [6, 7, 8]
119.     assert parselinenos('7-', 10) == [6, 7, 8, 9]
120.     assert parselinenos('1,7-', 10) == [0, 6, 7, 8, 9]
121.     assert parselinenos('7-7', 10) == [6]
122.     assert parselinenos('11-', 10) == [10]
123.     with pytest.raises(ValueError):
124.         parselinenos('1-2-3', 10)
125.     with pytest.raises(ValueError):
126.         parselinenos('abc-def', 10)
127.     with pytest.raises(ValueError):
128.         parselinenos('-', 10)
129.     with pytest.raises(ValueError):
130.         parselinenos('3-1', 10)
131. 
132. 
133. def test_progress_message(app, status, warning):
134.     logging.setup(app, status, warning)
135.     logger = logging.getLogger(__name__)
136. 
137.     # standard case
138.     with progress_message('testing'):
139.         logger.info('blah ', nonl=True)
140. 
141.     output = strip_escseq(status.getvalue())
142.     assert 'testing... blah done\n' in output
143. 
144.     # skipping case
145.     with progress_message('testing'):
146.         raise SkipProgressMessage('Reason: %s', 'error')
147. 
148.     output = strip_escseq(status.getvalue())
149.     assert 'testing... skipped\nReason: error\n' in output
150. 
151.     # error case
152.     try:
153.         with progress_message('testing'):
154.             raise
155.     except Exception:
156.         pass
157. 
158.     output = strip_escseq(status.getvalue())
159.     assert 'testing... failed\n' in output
160. 
161.     # decorator
162.     @progress_message('testing')
163.     def func():
164.         logger.info('in func ', nonl=True)
165. 
166.     func()
167.     output = strip_escseq(status.getvalue())
168.     assert 'testing... in func done\n' in output
169. 
170. 
171. def test_xmlname_check():
172.     checker = xmlname_checker()
173.     assert checker.match('id-pub')
174.     assert checker.match('webpage')
175.     assert not checker.match('1bfda21')

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-21 02:26:45,721 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='The user explicitly requested the full content of this file.', relative_path='sphinx/util/docfields.py', start_line=1, end_line=344), ContextOutput(reasoning='The user explicitly requested the full content of this file.', relative_path='tests/test_markup.py', start_line=1, end_line=500), ContextOutput(reasoning='The user explicitly requested the full content of this file.', relative_path='tests/test_util.py', start_line=1, end_line=175)]
2025-12-21 02:26:45,723 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 3 contexts to memory for query: Please provide the full content of `tests/test_util.py`, `tests/test_markup.py`, and `sphinx/util/docfields.py`.
2025-12-21 02:26:45,724 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-21 02:26:45,724 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-21 02:26:45,724 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 3 new contexts to 5 existing contexts
2025-12-21 02:26:45,724 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 8 total contexts (removed 0 duplicates)
2025-12-21 02:26:45,725 - thread-126362081822400.prometheus_context_collector.lang_graph.nodes.context_refine_node - INFO - Reached max_refined_query_loop, not asking for more context
2025-12-21 02:26:45,725 - thread-126362081822400.prometheus_context_collector - INFO - Successfully retrieved 8 context snippets
