2025-12-24 03:09:01,444 - thread-125239516182208.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: [Bug]: get_backend() clears figures from Gcf.figs if they were created under rc_context

Description: ### Bug summary

calling `matplotlib.get_backend()` removes all figures from `Gcf` if the *first* figure in `Gcf.figs` was created in an `rc_context`.

### Code for reproduction

```python
import matplotlib.pyplot as plt
from matplotlib import get_backend, rc_context

# fig1 = plt.figure()  # <- UNCOMMENT THIS LINE AND IT WILL WORK
# plt.ion()            # <- ALTERNATIVELY, UNCOMMENT THIS LINE AND IT WILL ALSO WORK
with rc_context():
    fig2 = plt.figure()
before = f'{id(plt._pylab_helpers.Gcf)} {plt._pylab_helpers.Gcf.figs!r}'
get_backend()
after = f'{id(plt._pylab_helpers.Gcf)} {plt._pylab_helpers.Gcf.figs!r}'

assert before == after, '\n' + before + '\n' + after
```


### Actual outcome

```
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
<ipython-input-1-fa4d099aa289> in <cell line: 11>()
      9 after = f'{id(plt._pylab_helpers.Gcf)} {plt._pylab_helpers.Gcf.figs!r}'
     10 
---> 11 assert before == after, '\n' + before + '\n' + after
     12 

AssertionError: 
94453354309744 OrderedDict([(1, <matplotlib.backends.backend_qt.FigureManagerQT object at 0x7fb33e26c220>)])
94453354309744 OrderedDict()
```

### Expected outcome

The figure should not be missing from `Gcf`.  Consequences of this are, e.g, `plt.close(fig2)` doesn't work because `Gcf.destroy_fig()` can't find it.

### Additional information

_No response_

### Operating system

Xubuntu

### Matplotlib Version

3.5.2

### Matplotlib Backend

QtAgg

### Python version

Python 3.10.4

### Jupyter version

n/a

### Installation

conda

Patch information:
diff --git a/lib/matplotlib/__init__.py b/lib/matplotlib/__init__.py
index c268a56724..c5c1a8e71a 100644
--- a/lib/matplotlib/__init__.py
+++ b/lib/matplotlib/__init__.py
@@ -1095,7 +1095,19 @@ def rc_context(rc=None, fname=None):
             rcParams.update(rc)
         yield
     finally:
-        dict.update(rcParams, orig)  # Revert to the original rcs.
+        # Revert to the original rcs, but preserve a resolved backend if the
+        # original value was the auto backend sentinel.
+        try:
+            original_backend = dict.__getitem__(orig, "backend")
+        except KeyError:
+            original_backend = None
+        if original_backend is rcsetup._auto_backend_sentinel:
+            # Get current backend without triggering resolution.
+            current_backend = dict.__getitem__(rcParams, "backend")
+            if current_backend is not rcsetup._auto_backend_sentinel:
+                # Preserve the resolved backend selected during the context.
+                dict.__setitem__(orig, "backend", current_backend)
+        dict.update(rcParams, orig)
 
 
 def use(backend, *, force=True):


Find all relevant source code context needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

2025-12-24 03:09:01,525 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
matplotlib
├── .appveyor.yml
├── .circleci
|   ├── config.yml
|   └── deploy-docs.sh
├── .git_archival.txt
├── .github
|   ├── CONTRIBUTING.md
|   ├── FUNDING.yml
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.yml
|   |   ├── config.yml
|   |   ├── documentation.yml
|   |   ├── feature_request.yml
|   |   └── maintenance.yml
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── codecov.yml
|   ├── dependabot.yml
|   └── workflows
|       ├── cibuildwheel.yml
|       ├── circleci.yml
|       ├── clean_pr.yml
|       ├── nightlies.yml
|       ├── pr_welcome.yml
|       ├── reviewdog.yml
|       └── tests.yml
├── .lgtm.yml
├── .meeseeksdev.yml
├── .pre-commit-config.yaml
├── CODE_OF_CONDUCT.md
├── INSTALL.rst
├── LICENSE
├── README.rst
├── SECURITY.md
├── azure-pipelines.yml
├── ci
|   ├── check_wheel_licenses.py
|   └── codespell-ignore-words.txt
├── doc
|   ├── README.txt
|   ├── _static
|   |   ├── fa
|   |   ├── markers
|   |   ├── mpl.css
|   |   └── zenodo_cache
|   ├── _templates
|   |   ├── autofunctions.rst
|   |   ├── automodule.rst
|   |   ├── autosummary.rst
|   |   ├── cheatsheet_sidebar.html
|   |   ├── donate_sidebar.html
|   |   ├── function.rst
|   |   ├── pagesource.html
|   |   ├── search.html
|   |   ├── sidebar_announcement.html
|   |   └── sidebar_versions.html
|   ├── api
|   |   ├── _api_api.rst
|   |   ├── _enums_api.rst
|   |   ├── afm_api.rst
|   |   ├── animation_api.rst
|   |   ├── artist_api.rst
|   |   ├── axes_api.rst
|   |   ├── axis_api.rst
|   |   ├── backend_agg_api.rst
|   |   ├── backend_bases_api.rst
|   |   ├── backend_cairo_api.rst
|   |   ├── backend_gtk3_api.rst
|   |   ├── backend_gtk4_api.rst
|   |   ├── backend_managers_api.rst
|   |   ├── backend_mixed_api.rst
|   |   ├── backend_nbagg_api.rst
|   |   ├── backend_pdf_api.rst
|   |   ├── backend_pgf_api.rst
|   |   ├── backend_ps_api.rst
|   |   ├── backend_qt_api.rst
|   |   ├── backend_svg_api.rst
|   |   ├── backend_template_api.rst
|   |   ├── backend_tk_api.rst
|   |   ├── backend_tools_api.rst
|   |   ├── backend_webagg_api.rst
|   |   ├── backend_wx_api.rst
|   |   ├── bezier_api.rst
|   |   ├── blocking_input_api.rst
|   |   ├── category_api.rst
|   |   ├── cbook_api.rst
|   |   ├── cm_api.rst
|   |   ├── collections_api.rst
|   |   ├── colorbar_api.rst
|   |   ├── colors_api.rst
|   |   ├── container_api.rst
|   |   ├── contour_api.rst
|   |   ├── dates_api.rst
|   |   ├── docstring_api.rst
|   |   ├── dviread.rst
|   |   ├── figure_api.rst
|   |   ├── font_manager_api.rst
|   |   ├── fontconfig_pattern_api.rst
|   |   ├── gridspec_api.rst
|   |   ├── hatch_api.rst
|   |   ├── image_api.rst
|   |   ├── index.rst
|   |   ├── index_backend_api.rst
|   |   ├── layout_engine_api.rst
|   |   ├── legend_api.rst
|   |   ├── legend_handler_api.rst
|   |   ├── lines_api.rst
|   |   ├── markers_api.rst
|   |   ├── mathtext_api.rst
|   |   ├── matplotlib_configuration_api.rst
|   |   ├── mlab_api.rst
|   |   ├── next_api_changes
|   |   |   ├── README.rst
|   |   |   ├── behavior
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 19214-DS.rst
|   |   |   |   ├── 19368-DS.rst
|   |   |   |   ├── 20426-JK.rst
|   |   |   |   ├── 20715-JKS.rst
|   |   |   |   ├── 21026-DS.rst
|   |   |   |   ├── 21042-AL.rst
|   |   |   |   ├── 21238-AL.rst
|   |   |   |   ├── 21983-AL.rst
|   |   |   |   ├── 22013-AL.rst
|   |   |   |   ├── 22063-SR.rst
|   |   |   |   ├── 22204-AL.rst
|   |   |   |   ├── 22229-TAC.rst
|   |   |   |   ├── 22485-TH.rst
|   |   |   |   ├── 22567-IT.rst
|   |   |   |   ├── 22639-RA.rst
|   |   |   |   ├── 22691-JMK.rst
|   |   |   |   ├── 22745-JMK.rst
|   |   |   |   ├── 23031-AL.rst
|   |   |   |   ├── 23170-JMK.rst
|   |   |   |   ├── 23188-JMK.rst
|   |   |   |   └── 23270-AL.rst
|   |   |   ├── deprecations
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 20071-AL.rst
|   |   |   |   ├── 20839-EP.rst
|   |   |   |   ├── 20995-AL.rst
|   |   |   |   ├── 21056-AL.rst
|   |   |   |   ├── 21187-AL.rst
|   |   |   |   ├── 21356-AL.rst
|   |   |   |   ├── 21412-AL.rst
|   |   |   |   ├── 21425-AL.rst
|   |   |   |   ├── 21584-AL.rst
|   |   |   |   ├── 21962-AL.rst
|   |   |   |   ├── 21965-AL.rst
|   |   |   |   ├── 21981-AL.rst
|   |   |   |   ├── 21982-AL.rst
|   |   |   |   ├── 21992-AL.rst
|   |   |   |   ├── 21995-AL.rst
|   |   |   |   ├── 22021-AL.rst
|   |   |   |   ├── 22025-AL.rst
|   |   |   |   ├── 22050-AL.rst
|   |   |   |   ├── 22051-AL.rst
|   |   |   |   ├── 22084-SS.rst
|   |   |   |   ├── 22097-AL.rst
|   |   |   |   ├── 22098-AL.rst
|   |   |   |   ├── 22123-TH.rst
|   |   |   |   ├── 22133-OG.rst
|   |   |   |   ├── 22134-OG.rst
|   |   |   |   ├── 22148-OG.rst
|   |   |   |   ├── 22167-EP.rst
|   |   |   |   ├── 22245-AL.rst
|   |   |   |   ├── 22268-OG.rst
|   |   |   |   ├── 22298-GL.rst
|   |   |   |   ├── 22317-AL.rst
|   |   |   |   ├── 22323-GL.rst
|   |   |   |   ├── 22345-JK.rst
|   |   |   |   ├── 22415-AL.rst
|   |   |   |   ├── 22418-AL.rst
|   |   |   |   ├── 22421-AL.rst
|   |   |   |   ├── 22422-AL.rst
|   |   |   |   ├── 22490-AL.rst
|   |   |   |   ├── 22503-AL.rst
|   |   |   |   ├── 22509-AL.rst
|   |   |   |   ├── 22539-AL.rst
|   |   |   |   ├── 22547-AL.rst
|   |   |   |   ├── 22554-AL.rst
|   |   |   |   ├── 22697-OG.rst
|   |   |   |   ├── 22725-AL.rst
|   |   |   |   ├── 22797-OG.rst
|   |   |   |   ├── 22813-GL.rst
|   |   |   |   ├── 22883-AL.rst
|   |   |   |   ├── 22885-AL.rst
|   |   |   |   ├── 23014-OG.rst
|   |   |   |   ├── 23045-OG.rst
|   |   |   |   ├── 23081-OG.rst
|   |   |   |   ├── 23166-ES.rst
|   |   |   |   ├── 23190-OG.rst
|   |   |   |   ├── 23232-TH.rst
|   |   |   |   ├── 23289-AL.rst
|   |   |   |   ├── 23302-TH.rst
|   |   |   |   └── ZZZZZ-AL.rst
|   |   |   ├── development
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 21415-AL.rst
|   |   |   |   ├── 22205-ES.rst
|   |   |   |   └── 22550-AL.rst
|   |   |   └── removals
|   |   |       ├── 00001-ABC.rst
|   |   |       ├── 00001-DS.rst
|   |   |       ├── 20990-AL.rst
|   |   |       ├── 21395-AL.rst
|   |   |       ├── 21591-AL.rst
|   |   |       ├── 21980-CC.rst
|   |   |       ├── 22081-AL.rst
|   |   |       ├── 22107-OG.rst
|   |   |       ├── 22365-OG.rst
|   |   |       ├── 22465-AL.rst
|   |   |       ├── 22486-OG.rst
|   |   |       ├── 22514-OG.rst
|   |   |       ├── 22516-OG.rst
|   |   |       ├── 22738-JL.rst
|   |   |       ├── 22886-OG.rst
|   |   |       ├── 22952-TH.rst
|   |   |       ├── 23076-GL.rst
|   |   |       ├── 23077-GL.rst
|   |   |       ├── 23078-GL.rst
|   |   |       ├── 23079-GL.rst
|   |   |       ├── 23093-GL.rst
|   |   |       └── 23237-AL.rst
|   |   ├── next_api_changes.rst
|   |   ├── offsetbox_api.rst
|   |   ├── patches_api.rst
|   |   ├── path_api.rst
|   |   ├── patheffects_api.rst
|   |   ├── prev_api_changes
|   |   |   ├── api_changes_0.40.rst
|   |   |   ├── api_changes_0.42.rst
|   |   |   ├── api_changes_0.50.rst
|   |   |   ├── api_changes_0.54.3.rst
|   |   |   ├── api_changes_0.54.rst
|   |   |   ├── api_changes_0.60.rst
|   |   |   ├── api_changes_0.61.rst
|   |   |   ├── api_changes_0.63.rst
|   |   |   ├── api_changes_0.65.1.rst
|   |   |   ├── api_changes_0.65.rst
|   |   |   ├── api_changes_0.70.rst
|   |   |   ├── api_changes_0.71.rst
|   |   |   ├── api_changes_0.72.rst
|   |   |   ├── api_changes_0.73.rst
|   |   |   ├── api_changes_0.80.rst
|   |   |   ├── api_changes_0.81.rst
|   |   |   ├── api_changes_0.82.rst
|   |   |   ├── api_changes_0.83.rst
|   |   |   ├── api_changes_0.84.rst
|   |   |   ├── api_changes_0.85.rst
|   |   |   ├── api_changes_0.86.rst
|   |   |   ├── api_changes_0.87.7.rst
|   |   |   ├── api_changes_0.90.0.rst
|   |   |   ├── api_changes_0.90.1.rst
|   |   |   ├── api_changes_0.91.0.rst
|   |   |   ├── api_changes_0.91.2.rst
|   |   |   ├── api_changes_0.98.0.rst
|   |   |   ├── api_changes_0.98.1.rst
|   |   |   ├── api_changes_0.98.x.rst
|   |   |   ├── api_changes_0.99.rst
|   |   |   ├── api_changes_0.99.x.rst
|   |   |   ├── api_changes_1.1.x.rst
|   |   |   ├── api_changes_1.2.x.rst
|   |   |   ├── api_changes_1.3.x.rst
|   |   |   ├── api_changes_1.4.x.rst
|   |   |   ├── api_changes_1.5.0.rst
|   |   |   ├── api_changes_1.5.2.rst
|   |   |   ├── api_changes_1.5.3.rst
|   |   |   ├── api_changes_2.0.0.rst
|   |   |   ├── api_changes_2.0.1.rst
|   |   |   ├── api_changes_2.1.0.rst
|   |   |   ├── api_changes_2.1.1.rst
|   |   |   ├── api_changes_2.1.2.rst
|   |   |   ├── api_changes_2.2.0.rst
|   |   |   ├── api_changes_3.0.0.rst
|   |   |   ├── api_changes_3.0.1.rst
|   |   |   ├── api_changes_3.1.0.rst
|   |   |   ├── api_changes_3.1.1.rst
|   |   |   ├── api_changes_3.2.0
|   |   |   |   ├── behavior.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.2.0.rst
|   |   |   ├── api_changes_3.3.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.3.0.rst
|   |   |   ├── api_changes_3.3.1.rst
|   |   |   ├── api_changes_3.4.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.4.0.rst
|   |   |   ├── api_changes_3.4.2.rst
|   |   |   ├── api_changes_3.5.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.5.0.rst
|   |   |   └── api_changes_3.5.2.rst
|   |   ├── projections_api.rst
|   |   ├── pyplot_summary.rst
|   |   ├── quiver_api.rst
|   |   ├── rcsetup_api.rst
|   |   ├── sankey_api.rst
|   |   ├── scale_api.rst
|   |   ├── sphinxext_mathmpl_api.rst
|   |   ├── sphinxext_plot_directive_api.rst
|   |   ├── spines_api.rst
|   |   ├── style_api.rst
|   |   ├── table_api.rst
|   |   ├── testing_api.rst
|   |   ├── texmanager_api.rst
|   |   ├── text_api.rst
|   |   ├── textpath_api.rst
|   |   ├── ticker_api.rst
|   |   ├── tight_bbox_api.rst
|   |   ├── tight_layout_api.rst
|   |   ├── toolkits
|   |   |   ├── axes_grid.rst
|   |   |   ├── axes_grid1.rst
|   |   |   ├── axisartist.rst
|   |   |   ├── mplot3d
|   |   |   |   └── faq.rst
|   |   |   └── mplot3d.rst
|   |   ├── transformations.rst
|   |   ├── tri_api.rst
|   |   ├── type1font.rst
|   |   ├── units_api.rst
|   |   └── widgets_api.rst
|   ├── conf.py
|   ├── devel
|   |   ├── MEP
|   |   |   ├── MEP08.rst
|   |   |   ├── MEP09.rst
|   |   |   ├── MEP10.rst
|   |   |   ├── MEP11.rst
|   |   |   ├── MEP12.rst
|   |   |   ├── MEP13.rst
|   |   |   ├── MEP14.rst
|   |   |   ├── MEP15.rst
|   |   |   ├── MEP19.rst
|   |   |   ├── MEP21.rst
|   |   |   ├── MEP22.rst
|   |   |   ├── MEP23.rst
|   |   |   ├── MEP24.rst
|   |   |   ├── MEP25.rst
|   |   |   ├── MEP26.rst
|   |   |   ├── MEP27.rst
|   |   |   ├── MEP28.rst
|   |   |   ├── MEP29.rst
|   |   |   ├── README.rst
|   |   |   ├── index.rst
|   |   |   └── template.rst
|   |   ├── README.txt
|   |   ├── coding_guide.rst
|   |   ├── color_changes.rst
|   |   ├── contributing.rst
|   |   ├── dependencies.rst
|   |   ├── development_setup.rst
|   |   ├── documenting_mpl.rst
|   |   ├── gitwash
|   |   |   ├── configure_git.rst
|   |   |   ├── development_workflow.rst
|   |   |   ├── dot2_dot3.rst
|   |   |   ├── following_latest.rst
|   |   |   ├── forking_hell.rst
|   |   |   ├── git_development.rst
|   |   |   ├── git_install.rst
|   |   |   ├── git_intro.rst
|   |   |   ├── git_resources.rst
|   |   |   ├── index.rst
|   |   |   ├── maintainer_workflow.rst
|   |   |   ├── patching.rst
|   |   |   └── set_up_fork.rst
|   |   ├── index.rst
|   |   ├── license.rst
|   |   ├── min_dep_policy.rst
|   |   ├── release_guide.rst
|   |   ├── style_guide.rst
|   |   ├── testing.rst
|   |   └── triage.rst
|   ├── index.rst
|   ├── sphinxext
|   |   ├── __init__.py
|   |   ├── custom_roles.py
|   |   ├── gallery_order.py
|   |   ├── github.py
|   |   ├── math_symbol_table.py
|   |   ├── missing_references.py
|   |   ├── mock_gui_toolkits.py
|   |   ├── redirect_from.py
|   |   └── skip_deprecated.py
|   ├── thirdpartypackages
|   |   └── index.rst
|   └── users
|       ├── explain
|       |   ├── api_interfaces.rst
|       |   ├── backends.rst
|       |   ├── event_handling.rst
|       |   ├── fonts.rst
|       |   ├── index.rst
|       |   ├── interactive.rst
|       |   ├── interactive_guide.rst
|       |   └── performance.rst
|       ├── faq
|       |   ├── environment_variables_faq.rst
|       |   ├── howto_faq.rst
|       |   ├── index.rst
|       |   └── troubleshooting_faq.rst
|       ├── generate_credits.py
|       ├── getting_started
|       |   └── index.rst
|       ├── github_stats.rst
|       ├── index.rst
|       ├── installing
|       |   └── index.rst
|       ├── next_whats_new
|       |   ├── 3d_plot_focal_length.rst
|       |   ├── 3d_plot_roll_angle.rst
|       |   ├── README.rst
|       |   ├── asinh_scale.rst
|       |   ├── color_support_for_math_to_image.rst
|       |   ├── custom_cap_widths.rst
|       |   ├── double_quotes_matplolibrc.rst
|       |   ├── extending_MarkerStyle.rst
|       |   ├── inset_axes_improvements.rst
|       |   ├── layout_engine.rst
|       |   ├── list_font_names.rst
|       |   ├── marker_none.rst
|       |   ├── min_macos_version.rst
|       |   ├── modify_stairs_fill_edge_behaviour.rst
|       |   ├── no_broken_streamlines.rst
|       |   ├── polygon_selector_box.rst
|       |   ├── polygon_vert_setter.rst
|       |   ├── rectangle_patch_rotation.rst
|       |   ├── rename_ncol_keyword_in_legend.rst
|       |   ├── selector_improvement.rst
|       |   ├── snap_selector.rst
|       |   ├── striped_lines.rst
|       |   ├── url_active_areas_rotate.rst
|       |   ├── use_contourpy.rst
|       |   └── windows_arm64.rst
|       ├── next_whats_new.rst
|       ├── prev_whats_new
|       |   ├── changelog.rst
|       |   ├── dflt_style_changes.rst
|       |   ├── github_stats_3.0.0.rst
|       |   ├── github_stats_3.0.1.rst
|       |   ├── github_stats_3.0.2.rst
|       |   ├── github_stats_3.0.3.rst
|       |   ├── github_stats_3.1.0.rst
|       |   ├── github_stats_3.1.1.rst
|       |   ├── github_stats_3.1.2.rst
|       |   ├── github_stats_3.1.3.rst
|       |   ├── github_stats_3.2.0.rst
|       |   ├── github_stats_3.2.1.rst
|       |   ├── github_stats_3.2.2.rst
|       |   ├── github_stats_3.3.0.rst
|       |   ├── github_stats_3.3.1.rst
|       |   ├── github_stats_3.3.2.rst
|       |   ├── github_stats_3.3.3.rst
|       |   ├── github_stats_3.3.4.rst
|       |   ├── github_stats_3.4.0.rst
|       |   ├── github_stats_3.4.1.rst
|       |   ├── github_stats_3.4.2.rst
|       |   ├── github_stats_3.4.3.rst
|       |   ├── github_stats_3.5.0.rst
|       |   ├── github_stats_3.5.1.rst
|       |   ├── whats_new_0.98.4.rst
|       |   ├── whats_new_0.99.rst
|       |   ├── whats_new_1.0.rst
|       |   ├── whats_new_1.1.rst
|       |   ├── whats_new_1.2.2.rst
|       |   ├── whats_new_1.2.rst
|       |   ├── whats_new_1.3.rst
|       |   ├── whats_new_1.4.rst
|       |   ├── whats_new_1.5.rst
|       |   ├── whats_new_2.0.0.rst
|       |   ├── whats_new_2.1.0.rst
|       |   ├── whats_new_2.2.rst
|       |   ├── whats_new_3.0.rst
|       |   ├── whats_new_3.1.0.rst
|       |   ├── whats_new_3.2.0.rst
|       |   ├── whats_new_3.3.0.rst
|       |   ├── whats_new_3.4.0.rst
|       |   ├── whats_new_3.5.0.rst
|       |   └── whats_new_3.5.2.rst
|       ├── project
|       |   ├── citing.rst
|       |   ├── credits.rst
|       |   ├── history.rst
|       |   ├── index.rst
|       |   └── license.rst
|       ├── release_notes.rst
|       ├── release_notes_next.rst
|       └── resources
|           └── index.rst
├── environment.yml
├── examples
|   ├── README.txt
|   ├── animation
|   |   ├── README.txt
|   |   ├── animate_decay.py
|   |   ├── animated_histogram.py
|   |   ├── animation_demo.py
|   |   ├── bayes_update.py
|   |   ├── double_pendulum.py
|   |   ├── dynamic_image.py
|   |   ├── frame_grabbing_sgskip.py
|   |   ├── pause_resume.py
|   |   ├── rain.py
|   |   ├── random_walk.py
|   |   ├── simple_anim.py
|   |   ├── strip_chart.py
|   |   └── unchained.py
|   ├── axes_grid1
|   |   ├── README.txt
|   |   ├── demo_anchored_direction_arrows.py
|   |   ├── demo_axes_divider.py
|   |   ├── demo_axes_grid.py
|   |   ├── demo_axes_grid2.py
|   |   ├── demo_axes_hbox_divider.py
|   |   ├── demo_axes_rgb.py
|   |   ├── demo_colorbar_of_inset_axes.py
|   |   ├── demo_colorbar_with_axes_divider.py
|   |   ├── demo_colorbar_with_inset_locator.py
|   |   ├── demo_edge_colorbar.py
|   |   ├── demo_fixed_size_axes.py
|   |   ├── demo_imagegrid_aspect.py
|   |   ├── inset_locator_demo.py
|   |   ├── inset_locator_demo2.py
|   |   ├── make_room_for_ylabel_using_axesgrid.py
|   |   ├── parasite_simple.py
|   |   ├── parasite_simple2.py
|   |   ├── scatter_hist_locatable_axes.py
|   |   ├── simple_anchored_artists.py
|   |   ├── simple_axes_divider1.py
|   |   ├── simple_axes_divider3.py
|   |   ├── simple_axesgrid.py
|   |   ├── simple_axesgrid2.py
|   |   ├── simple_axisline4.py
|   |   └── simple_colorbar.py
|   ├── axisartist
|   |   ├── README.txt
|   |   ├── axis_direction.py
|   |   ├── demo_axis_direction.py
|   |   ├── demo_axisline_style.py
|   |   ├── demo_curvelinear_grid.py
|   |   ├── demo_curvelinear_grid2.py
|   |   ├── demo_floating_axes.py
|   |   ├── demo_floating_axis.py
|   |   ├── demo_parasite_axes.py
|   |   ├── demo_parasite_axes2.py
|   |   ├── demo_ticklabel_alignment.py
|   |   ├── demo_ticklabel_direction.py
|   |   ├── simple_axis_direction01.py
|   |   ├── simple_axis_direction03.py
|   |   ├── simple_axis_pad.py
|   |   ├── simple_axisartist1.py
|   |   ├── simple_axisline.py
|   |   └── simple_axisline3.py
|   ├── color
|   |   ├── README.txt
|   |   ├── color_by_yvalue.py
|   |   ├── color_cycle_default.py
|   |   ├── color_demo.py
|   |   ├── colorbar_basics.py
|   |   ├── colormap_reference.py
|   |   ├── custom_cmap.py
|   |   └── named_colors.py
|   ├── event_handling
|   |   ├── README.txt
|   |   ├── close_event.py
|   |   ├── coords_demo.py
|   |   ├── cursor_demo.py
|   |   ├── data_browser.py
|   |   ├── figure_axes_enter_leave.py
|   |   ├── ginput_manual_clabel_sgskip.py
|   |   ├── image_slices_viewer.py
|   |   ├── keypress_demo.py
|   |   ├── lasso_demo.py
|   |   ├── legend_picking.py
|   |   ├── looking_glass.py
|   |   ├── path_editor.py
|   |   ├── pick_event_demo.py
|   |   ├── pick_event_demo2.py
|   |   ├── poly_editor.py
|   |   ├── pong_sgskip.py
|   |   ├── resample.py
|   |   ├── timers.py
|   |   ├── trifinder_event_demo.py
|   |   ├── viewlims.py
|   |   └── zoom_window.py
|   ├── images_contours_and_fields
|   |   ├── README.txt
|   |   ├── affine_image.py
|   |   ├── barb_demo.py
|   |   ├── barcode_demo.py
|   |   ├── colormap_interactive_adjustment.py
|   |   ├── colormap_normalizations.py
|   |   ├── colormap_normalizations_symlognorm.py
|   |   ├── contour_corner_mask.py
|   |   ├── contour_demo.py
|   |   ├── contour_image.py
|   |   ├── contour_label_demo.py
|   |   ├── contourf_demo.py
|   |   ├── contourf_hatching.py
|   |   ├── contourf_log.py
|   |   ├── contours_in_optimization_demo.py
|   |   ├── demo_bboximage.py
|   |   ├── figimage_demo.py
|   |   ├── image_annotated_heatmap.py
|   |   ├── image_antialiasing.py
|   |   ├── image_clip_path.py
|   |   ├── image_demo.py
|   |   ├── image_masked.py
|   |   ├── image_nonuniform.py
|   |   ├── image_transparency_blend.py
|   |   ├── image_zcoord.py
|   |   ├── interpolation_methods.py
|   |   ├── irregulardatagrid.py
|   |   ├── layer_images.py
|   |   ├── matshow.py
|   |   ├── multi_image.py
|   |   ├── pcolor_demo.py
|   |   ├── pcolormesh_grids.py
|   |   ├── pcolormesh_levels.py
|   |   ├── plot_streamplot.py
|   |   ├── quadmesh_demo.py
|   |   ├── quiver_demo.py
|   |   ├── quiver_simple_demo.py
|   |   ├── shading_example.py
|   |   ├── specgram_demo.py
|   |   ├── spy_demos.py
|   |   ├── tricontour_demo.py
|   |   ├── tricontour_smooth_delaunay.py
|   |   ├── tricontour_smooth_user.py
|   |   ├── trigradient_demo.py
|   |   ├── triinterp_demo.py
|   |   ├── tripcolor_demo.py
|   |   ├── triplot_demo.py
|   |   └── watermark_image.py
|   ├── lines_bars_and_markers
|   |   ├── README.txt
|   |   ├── bar_label_demo.py
|   |   ├── bar_stacked.py
|   |   ├── barchart.py
|   |   ├── barh.py
|   |   ├── broken_barh.py
|   |   ├── capstyle.py
|   |   ├── categorical_variables.py
|   |   ├── cohere.py
|   |   ├── csd_demo.py
|   |   ├── curve_error_band.py
|   |   ├── errorbar_limits_simple.py
|   |   ├── errorbar_subsample.py
|   |   ├── eventcollection_demo.py
|   |   ├── eventplot_demo.py
|   |   ├── fill.py
|   |   ├── fill_between_alpha.py
|   |   ├── fill_between_demo.py
|   |   ├── fill_betweenx_demo.py
|   |   ├── filled_step.py
|   |   ├── gradient_bar.py
|   |   ├── hat_graph.py
|   |   ├── horizontal_barchart_distribution.py
|   |   ├── joinstyle.py
|   |   ├── line_demo_dash_control.py
|   |   ├── lines_with_ticks_demo.py
|   |   ├── linestyles.py
|   |   ├── marker_reference.py
|   |   ├── markevery_demo.py
|   |   ├── masked_demo.py
|   |   ├── multicolored_line.py
|   |   ├── multivariate_marker_plot.py
|   |   ├── psd_demo.py
|   |   ├── scatter_custom_symbol.py
|   |   ├── scatter_demo2.py
|   |   ├── scatter_hist.py
|   |   ├── scatter_masked.py
|   |   ├── scatter_star_poly.py
|   |   ├── scatter_with_legend.py
|   |   ├── simple_plot.py
|   |   ├── span_regions.py
|   |   ├── spectrum_demo.py
|   |   ├── stackplot_demo.py
|   |   ├── stairs_demo.py
|   |   ├── stem_plot.py
|   |   ├── step_demo.py
|   |   ├── timeline.py
|   |   ├── vline_hline_demo.py
|   |   └── xcorr_acorr_demo.py
|   ├── misc
|   |   ├── README.txt
|   |   ├── anchored_artists.py
|   |   ├── bbox_intersect.py
|   |   ├── contour_manual.py
|   |   ├── coords_report.py
|   |   ├── custom_projection.py
|   |   ├── customize_rc.py
|   |   ├── demo_agg_filter.py
|   |   ├── demo_ribbon_box.py
|   |   ├── fill_spiral.py
|   |   ├── findobj_demo.py
|   |   ├── font_indexing.py
|   |   ├── ftface_props.py
|   |   ├── histogram_path.py
|   |   ├── hyperlinks_sgskip.py
|   |   ├── image_thumbnail_sgskip.py
|   |   ├── keyword_plotting.py
|   |   ├── logos2.py
|   |   ├── multipage_pdf.py
|   |   ├── multiprocess_sgskip.py
|   |   ├── packed_bubbles.py
|   |   ├── patheffect_demo.py
|   |   ├── print_stdout_sgskip.py
|   |   ├── pythonic_matplotlib.py
|   |   ├── rasterization_demo.py
|   |   ├── set_and_get.py
|   |   ├── svg_filter_line.py
|   |   ├── svg_filter_pie.py
|   |   ├── table_demo.py
|   |   ├── tickedstroke_demo.py
|   |   ├── transoffset.py
|   |   └── zorder_demo.py
|   ├── mplot3d
|   |   ├── 2dcollections3d.py
|   |   ├── 3d_bars.py
|   |   ├── README.txt
|   |   ├── bars3d.py
|   |   ├── box3d.py
|   |   ├── contour3d.py
|   |   ├── contour3d_2.py
|   |   ├── contour3d_3.py
|   |   ├── contourf3d.py
|   |   ├── contourf3d_2.py
|   |   ├── custom_shaded_3d_surface.py
|   |   ├── errorbar3d.py
|   |   ├── hist3d.py
|   |   ├── lines3d.py
|   |   ├── lorenz_attractor.py
|   |   ├── mixed_subplots.py
|   |   ├── offset.py
|   |   ├── pathpatch3d.py
|   |   ├── polys3d.py
|   |   ├── projections.py
|   |   ├── quiver3d.py
|   |   ├── rotate_axes3d_sgskip.py
|   |   ├── scatter3d.py
|   |   ├── stem3d_demo.py
|   |   ├── subplot3d.py
|   |   ├── surface3d.py
|   |   ├── surface3d_2.py
|   |   ├── surface3d_3.py
|   |   ├── surface3d_radial.py
|   |   ├── text3d.py
|   |   ├── tricontour3d.py
|   |   ├── tricontourf3d.py
|   |   ├── trisurf3d.py
|   |   ├── trisurf3d_2.py
|   |   ├── voxels.py
|   |   ├── voxels_numpy_logo.py
|   |   ├── voxels_rgb.py
|   |   ├── voxels_torus.py
|   |   ├── wire3d.py
|   |   ├── wire3d_animation_sgskip.py
|   |   └── wire3d_zero_stride.py
|   ├── pie_and_polar_charts
|   |   ├── README.txt
|   |   ├── bar_of_pie.py
|   |   ├── nested_pie.py
|   |   ├── pie_and_donut_labels.py
|   |   ├── pie_demo2.py
|   |   ├── pie_features.py
|   |   ├── polar_bar.py
|   |   ├── polar_demo.py
|   |   ├── polar_legend.py
|   |   └── polar_scatter.py
|   ├── pyplots
|   |   ├── README.txt
|   |   ├── align_ylabels.py
|   |   ├── annotate_transform.py
|   |   ├── annotation_basic.py
|   |   ├── annotation_polar.py
|   |   ├── auto_subplots_adjust.py
|   |   ├── axline.py
|   |   ├── boxplot_demo_pyplot.py
|   |   ├── dollar_ticks.py
|   |   ├── fig_axes_customize_simple.py
|   |   ├── fig_axes_labels_simple.py
|   |   ├── fig_x.py
|   |   ├── pyplot_formatstr.py
|   |   ├── pyplot_mathtext.py
|   |   ├── pyplot_simple.py
|   |   ├── pyplot_text.py
|   |   ├── pyplot_three.py
|   |   ├── pyplot_two_subplots.py
|   |   ├── text_commands.py
|   |   └── text_layout.py
|   ├── scales
|   |   ├── README.txt
|   |   ├── asinh_demo.py
|   |   ├── aspect_loglog.py
|   |   ├── custom_scale.py
|   |   ├── log_bar.py
|   |   ├── log_demo.py
|   |   ├── logit_demo.py
|   |   ├── power_norm.py
|   |   ├── scales.py
|   |   ├── semilogx_demo.py
|   |   └── symlog_demo.py
|   ├── shapes_and_collections
|   |   ├── README.txt
|   |   ├── arrow_guide.py
|   |   ├── artist_reference.py
|   |   ├── collections.py
|   |   ├── compound_path.py
|   |   ├── dolphin.py
|   |   ├── donut.py
|   |   ├── ellipse_collection.py
|   |   ├── ellipse_demo.py
|   |   ├── fancybox_demo.py
|   |   ├── hatch_demo.py
|   |   ├── hatch_style_reference.py
|   |   ├── line_collection.py
|   |   ├── patch_collection.py
|   |   ├── path_patch.py
|   |   ├── quad_bezier.py
|   |   └── scatter.py
|   ├── showcase
|   |   ├── README.txt
|   |   ├── anatomy.py
|   |   ├── bachelors_degrees_by_gender.py
|   |   ├── firefox.py
|   |   ├── integral.py
|   |   ├── mandelbrot.py
|   |   └── xkcd.py
|   ├── specialty_plots
|   |   ├── README.txt
|   |   ├── advanced_hillshading.py
|   |   ├── anscombe.py
|   |   ├── hinton_demo.py
|   |   ├── leftventricle_bulleye.py
|   |   ├── mri_demo.py
|   |   ├── mri_with_eeg.py
|   |   ├── radar_chart.py
|   |   ├── sankey_basics.py
|   |   ├── sankey_links.py
|   |   ├── sankey_rankine.py
|   |   ├── skewt.py
|   |   └── topographic_hillshading.py
|   ├── spines
|   |   ├── README.txt
|   |   ├── centered_spines_with_arrows.py
|   |   ├── multiple_yaxis_with_spines.py
|   |   ├── spine_placement_demo.py
|   |   ├── spines.py
|   |   ├── spines_bounds.py
|   |   └── spines_dropped.py
|   ├── statistics
|   |   ├── README.txt
|   |   ├── barchart_demo.py
|   |   ├── boxplot.py
|   |   ├── boxplot_color.py
|   |   ├── boxplot_demo.py
|   |   ├── boxplot_vs_violin.py
|   |   ├── bxp.py
|   |   ├── confidence_ellipse.py
|   |   ├── customized_violin.py
|   |   ├── errorbar.py
|   |   ├── errorbar_features.py
|   |   ├── errorbar_limits.py
|   |   ├── errorbars_and_boxes.py
|   |   ├── hexbin_demo.py
|   |   ├── hist.py
|   |   ├── histogram_cumulative.py
|   |   ├── histogram_features.py
|   |   ├── histogram_histtypes.py
|   |   ├── histogram_multihist.py
|   |   ├── multiple_histograms_side_by_side.py
|   |   ├── time_series_histogram.py
|   |   └── violinplot.py
|   ├── style_sheets
|   |   ├── README.txt
|   |   ├── bmh.py
|   |   ├── dark_background.py
|   |   ├── fivethirtyeight.py
|   |   ├── ggplot.py
|   |   ├── grayscale.py
|   |   ├── plot_solarizedlight2.py
|   |   └── style_sheets_reference.py
|   ├── subplots_axes_and_figures
|   |   ├── README.txt
|   |   ├── align_labels_demo.py
|   |   ├── axes_box_aspect.py
|   |   ├── axes_demo.py
|   |   ├── axes_margins.py
|   |   ├── axes_props.py
|   |   ├── axes_zoom_effect.py
|   |   ├── axhspan_demo.py
|   |   ├── axis_equal_demo.py
|   |   ├── axis_labels_demo.py
|   |   ├── broken_axis.py
|   |   ├── colorbar_placement.py
|   |   ├── custom_figure_class.py
|   |   ├── demo_constrained_layout.py
|   |   ├── demo_tight_layout.py
|   |   ├── fahrenheit_celsius_scales.py
|   |   ├── figure_size_units.py
|   |   ├── figure_title.py
|   |   ├── ganged_plots.py
|   |   ├── geo_demo.py
|   |   ├── gridspec_and_subplots.py
|   |   ├── gridspec_multicolumn.py
|   |   ├── gridspec_nested.py
|   |   ├── invert_axes.py
|   |   ├── multiple_figs_demo.py
|   |   ├── secondary_axis.py
|   |   ├── share_axis_lims_views.py
|   |   ├── shared_axis_demo.py
|   |   ├── subfigures.py
|   |   ├── subplot.py
|   |   ├── subplots_adjust.py
|   |   ├── subplots_demo.py
|   |   ├── two_scales.py
|   |   └── zoom_inset_axes.py
|   ├── text_labels_and_annotations
|   |   ├── README.txt
|   |   ├── accented_text.py
|   |   ├── angle_annotation.py
|   |   ├── annotation_demo.py
|   |   ├── arrow_demo.py
|   |   ├── autowrap.py
|   |   ├── custom_legends.py
|   |   ├── date.py
|   |   ├── demo_annotation_box.py
|   |   ├── demo_text_path.py
|   |   ├── demo_text_rotation_mode.py
|   |   ├── dfrac_demo.py
|   |   ├── engineering_formatter.py
|   |   ├── fancyarrow_demo.py
|   |   ├── fancytextbox_demo.py
|   |   ├── figlegend_demo.py
|   |   ├── font_family_rc.py
|   |   ├── font_file.py
|   |   ├── font_table.py
|   |   ├── fonts_demo.py
|   |   ├── fonts_demo_kw.py
|   |   ├── label_subplots.py
|   |   ├── legend.py
|   |   ├── legend_demo.py
|   |   ├── line_with_text.py
|   |   ├── mathtext_asarray.py
|   |   ├── mathtext_demo.py
|   |   ├── mathtext_examples.py
|   |   ├── mathtext_fontfamily_example.py
|   |   ├── multiline.py
|   |   ├── placing_text_boxes.py
|   |   ├── rainbow_text.py
|   |   ├── stix_fonts_demo.py
|   |   ├── tex_demo.py
|   |   ├── text_alignment.py
|   |   ├── text_fontdict.py
|   |   ├── text_rotation.py
|   |   ├── text_rotation_relative_to_line.py
|   |   ├── titles_demo.py
|   |   ├── unicode_minus.py
|   |   ├── usetex_baseline_test.py
|   |   ├── usetex_fonteffects.py
|   |   └── watermark_text.py
|   ├── ticks
|   |   ├── README.txt
|   |   ├── auto_ticks.py
|   |   ├── centered_ticklabels.py
|   |   ├── colorbar_tick_labelling_demo.py
|   |   ├── custom_ticker1.py
|   |   ├── date_concise_formatter.py
|   |   ├── date_demo_convert.py
|   |   ├── date_demo_rrule.py
|   |   ├── date_formatters_locators.py
|   |   ├── date_index_formatter.py
|   |   ├── date_precision_and_epochs.py
|   |   ├── major_minor_demo.py
|   |   ├── scalarformatter.py
|   |   ├── tick-formatters.py
|   |   ├── tick-locators.py
|   |   ├── tick_label_right.py
|   |   ├── tick_labels_from_values.py
|   |   ├── tick_xlabel_top.py
|   |   ├── ticklabels_rotation.py
|   |   └── ticks_too_many.py
|   ├── units
|   |   ├── README.txt
|   |   ├── annotate_with_units.py
|   |   ├── artist_tests.py
|   |   ├── bar_demo2.py
|   |   ├── bar_unit_demo.py
|   |   ├── basic_units.py
|   |   ├── ellipse_with_units.py
|   |   ├── evans_test.py
|   |   ├── radian_demo.py
|   |   ├── units_sample.py
|   |   └── units_scatter.py
|   ├── user_interfaces
|   |   ├── README.txt
|   |   ├── canvasagg.py
|   |   ├── embedding_in_gtk3_panzoom_sgskip.py
|   |   ├── embedding_in_gtk3_sgskip.py
|   |   ├── embedding_in_gtk4_panzoom_sgskip.py
|   |   ├── embedding_in_gtk4_sgskip.py
|   |   ├── embedding_in_qt_sgskip.py
|   |   ├── embedding_in_tk_sgskip.py
|   |   ├── embedding_in_wx2_sgskip.py
|   |   ├── embedding_in_wx3_sgskip.py
|   |   ├── embedding_in_wx4_sgskip.py
|   |   ├── embedding_in_wx5_sgskip.py
|   |   ├── embedding_webagg_sgskip.py
|   |   ├── fourier_demo_wx_sgskip.py
|   |   ├── gtk3_spreadsheet_sgskip.py
|   |   ├── gtk4_spreadsheet_sgskip.py
|   |   ├── mathtext_wx_sgskip.py
|   |   ├── mpl_with_glade3_sgskip.py
|   |   ├── pylab_with_gtk3_sgskip.py
|   |   ├── pylab_with_gtk4_sgskip.py
|   |   ├── svg_histogram_sgskip.py
|   |   ├── svg_tooltip_sgskip.py
|   |   ├── toolmanager_sgskip.py
|   |   ├── web_application_server_sgskip.py
|   |   └── wxcursor_demo_sgskip.py
|   ├── userdemo
|   |   ├── README.txt
|   |   ├── anchored_box04.py
|   |   ├── annotate_explain.py
|   |   ├── annotate_simple01.py
|   |   ├── annotate_simple02.py
|   |   ├── annotate_simple03.py
|   |   ├── annotate_simple04.py
|   |   ├── annotate_simple_coord01.py
|   |   ├── annotate_simple_coord02.py
|   |   ├── annotate_simple_coord03.py
|   |   ├── annotate_text_arrow.py
|   |   ├── connect_simple01.py
|   |   ├── connectionstyle_demo.py
|   |   ├── custom_boxstyle01.py
|   |   ├── demo_gridspec01.py
|   |   ├── demo_gridspec03.py
|   |   ├── demo_gridspec06.py
|   |   ├── pgf_fonts.py
|   |   ├── pgf_preamble_sgskip.py
|   |   ├── pgf_texsystem.py
|   |   ├── simple_annotate01.py
|   |   ├── simple_legend01.py
|   |   └── simple_legend02.py
|   └── widgets
|       ├── README.txt
|       ├── annotated_cursor.py
|       ├── buttons.py
|       ├── check_buttons.py
|       ├── cursor.py
|       ├── lasso_selector_demo_sgskip.py
|       ├── menu.py
|       ├── mouse_cursor.py
|       ├── multicursor.py
|       ├── polygon_selector_demo.py
|       ├── polygon_selector_simple.py
|       ├── radio_buttons.py
|       ├── range_slider.py
|       ├── rectangle_selector.py
|       ├── slider_demo.py
|       ├── slider_snap_demo.py
|       ├── span_selector.py
|       └── textbox.py
├── extern
|   ├── agg24-svn
|   |   ├── include
|   |   |   ├── ctrl
|   |   |   ├── platform
|   |   |   |   ├── mac
|   |   |   |   └── win32
|   |   |   └── util
|   |   └── src
|   |       ├── agg_arc.cpp
|   |       ├── agg_arrowhead.cpp
|   |       ├── agg_bezier_arc.cpp
|   |       ├── agg_bspline.cpp
|   |       ├── agg_color_rgba.cpp
|   |       ├── agg_curves.cpp
|   |       ├── agg_embedded_raster_fonts.cpp
|   |       ├── agg_gsv_text.cpp
|   |       ├── agg_image_filters.cpp
|   |       ├── agg_line_aa_basics.cpp
|   |       ├── agg_line_profile_aa.cpp
|   |       ├── agg_rounded_rect.cpp
|   |       ├── agg_sqrt_tables.cpp
|   |       ├── agg_trans_affine.cpp
|   |       ├── agg_trans_double_path.cpp
|   |       ├── agg_trans_single_path.cpp
|   |       ├── agg_trans_warp_magnifier.cpp
|   |       ├── agg_vcgen_bspline.cpp
|   |       ├── agg_vcgen_contour.cpp
|   |       ├── agg_vcgen_dash.cpp
|   |       ├── agg_vcgen_markers_term.cpp
|   |       ├── agg_vcgen_smooth_poly1.cpp
|   |       ├── agg_vcgen_stroke.cpp
|   |       ├── agg_vpgen_clip_polygon.cpp
|   |       ├── agg_vpgen_clip_polyline.cpp
|   |       ├── agg_vpgen_segmentator.cpp
|   |       ├── ctrl
|   |       |   ├── agg_bezier_ctrl.cpp
|   |       |   ├── agg_cbox_ctrl.cpp
|   |       |   ├── agg_gamma_ctrl.cpp
|   |       |   ├── agg_gamma_spline.cpp
|   |       |   ├── agg_polygon_ctrl.cpp
|   |       |   ├── agg_rbox_ctrl.cpp
|   |       |   ├── agg_scale_ctrl.cpp
|   |       |   ├── agg_slider_ctrl.cpp
|   |       |   └── agg_spline_ctrl.cpp
|   |       └── platform
|   |           ├── AmigaOS
|   |           ├── BeOS
|   |           ├── X11
|   |           ├── mac
|   |           ├── sdl
|   |           └── win32
|   └── ttconv
|       ├── pprdrv_tt.cpp
|       ├── pprdrv_tt2.cpp
|       └── ttutil.cpp
├── lib
|   ├── matplotlib
|   |   ├── __init__.py
|   |   ├── _afm.py
|   |   ├── _animation_data.py
|   |   ├── _api
|   |   |   ├── __init__.py
|   |   |   └── deprecation.py
|   |   ├── _blocking_input.py
|   |   ├── _cm.py
|   |   ├── _cm_listed.py
|   |   ├── _color_data.py
|   |   ├── _constrained_layout.py
|   |   ├── _docstring.py
|   |   ├── _enums.py
|   |   ├── _fontconfig_pattern.py
|   |   ├── _internal_utils.py
|   |   ├── _layoutgrid.py
|   |   ├── _mathtext.py
|   |   ├── _mathtext_data.py
|   |   ├── _pylab_helpers.py
|   |   ├── _text_helpers.py
|   |   ├── _tight_bbox.py
|   |   ├── _tight_layout.py
|   |   ├── _type1font.py
|   |   ├── afm.py
|   |   ├── animation.py
|   |   ├── artist.py
|   |   ├── axes
|   |   |   ├── __init__.py
|   |   |   ├── _axes.py
|   |   |   ├── _base.py
|   |   |   ├── _secondary_axes.py
|   |   |   └── _subplots.py
|   |   ├── axis.py
|   |   ├── backend_bases.py
|   |   ├── backend_managers.py
|   |   ├── backend_tools.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── _backend_gtk.py
|   |   |   ├── _backend_pdf_ps.py
|   |   |   ├── _backend_tk.py
|   |   |   ├── backend_agg.py
|   |   |   ├── backend_cairo.py
|   |   |   ├── backend_gtk3.py
|   |   |   ├── backend_gtk3agg.py
|   |   |   ├── backend_gtk3cairo.py
|   |   |   ├── backend_gtk4.py
|   |   |   ├── backend_gtk4agg.py
|   |   |   ├── backend_gtk4cairo.py
|   |   |   ├── backend_macosx.py
|   |   |   ├── backend_mixed.py
|   |   |   ├── backend_nbagg.py
|   |   |   ├── backend_pdf.py
|   |   |   ├── backend_pgf.py
|   |   |   ├── backend_ps.py
|   |   |   ├── backend_qt.py
|   |   |   ├── backend_qt5.py
|   |   |   ├── backend_qt5agg.py
|   |   |   ├── backend_qt5cairo.py
|   |   |   ├── backend_qtagg.py
|   |   |   ├── backend_qtcairo.py
|   |   |   ├── backend_svg.py
|   |   |   ├── backend_template.py
|   |   |   ├── backend_tkagg.py
|   |   |   ├── backend_tkcairo.py
|   |   |   ├── backend_webagg.py
|   |   |   ├── backend_webagg_core.py
|   |   |   ├── backend_wx.py
|   |   |   ├── backend_wxagg.py
|   |   |   ├── backend_wxcairo.py
|   |   |   ├── qt_compat.py
|   |   |   ├── qt_editor
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _formlayout.py
|   |   |   |   └── figureoptions.py
|   |   |   └── web_backend
|   |   |       ├── .eslintrc.js
|   |   |       ├── all_figures.html
|   |   |       ├── css
|   |   |       ├── ipython_inline_figure.html
|   |   |       ├── js
|   |   |       └── single_figure.html
|   |   ├── bezier.py
|   |   ├── blocking_input.py
|   |   ├── category.py
|   |   ├── cbook
|   |   |   └── __init__.py
|   |   ├── cm.py
|   |   ├── collections.py
|   |   ├── colorbar.py
|   |   ├── colors.py
|   |   ├── container.py
|   |   ├── contour.py
|   |   ├── dates.py
|   |   ├── docstring.py
|   |   ├── dviread.py
|   |   ├── figure.py
|   |   ├── font_manager.py
|   |   ├── fontconfig_pattern.py
|   |   ├── gridspec.py
|   |   ├── hatch.py
|   |   ├── image.py
|   |   ├── layout_engine.py
|   |   ├── legend.py
|   |   ├── legend_handler.py
|   |   ├── lines.py
|   |   ├── markers.py
|   |   ├── mathtext.py
|   |   ├── mlab.py
|   |   ├── mpl-data
|   |   |   ├── fonts
|   |   |   |   ├── afm
|   |   |   |   ├── pdfcorefonts
|   |   |   |   └── ttf
|   |   |   ├── images
|   |   |   ├── plot_directive
|   |   |   |   └── plot_directive.css
|   |   |   ├── sample_data
|   |   |   |   ├── README.txt
|   |   |   |   └── axes_grid
|   |   |   └── stylelib
|   |   ├── offsetbox.py
|   |   ├── patches.py
|   |   ├── path.py
|   |   ├── patheffects.py
|   |   ├── projections
|   |   |   ├── __init__.py
|   |   |   ├── geo.py
|   |   |   └── polar.py
|   |   ├── pylab.py
|   |   ├── pyplot.py
|   |   ├── quiver.py
|   |   ├── rcsetup.py
|   |   ├── sankey.py
|   |   ├── scale.py
|   |   ├── sphinxext
|   |   |   ├── __init__.py
|   |   |   ├── mathmpl.py
|   |   |   └── plot_directive.py
|   |   ├── spines.py
|   |   ├── stackplot.py
|   |   ├── streamplot.py
|   |   ├── style
|   |   |   ├── __init__.py
|   |   |   └── core.py
|   |   ├── table.py
|   |   ├── testing
|   |   |   ├── __init__.py
|   |   |   ├── _markers.py
|   |   |   ├── compare.py
|   |   |   ├── conftest.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── jpl_units
|   |   |   |   ├── Duration.py
|   |   |   |   ├── Epoch.py
|   |   |   |   ├── EpochConverter.py
|   |   |   |   ├── StrConverter.py
|   |   |   |   ├── UnitDbl.py
|   |   |   |   ├── UnitDblConverter.py
|   |   |   |   ├── UnitDblFormatter.py
|   |   |   |   └── __init__.py
|   |   |   └── widgets.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── baseline_images
|   |   |   |   ├── dviread
|   |   |   |   ├── pngsuite
|   |   |   |   ├── test_agg
|   |   |   |   ├── test_agg_filter
|   |   |   |   ├── test_arrow_patches
|   |   |   |   ├── test_artist
|   |   |   |   ├── test_axes
|   |   |   |   ├── test_backend_pdf
|   |   |   |   ├── test_backend_pgf
|   |   |   |   ├── test_backend_ps
|   |   |   |   ├── test_backend_svg
|   |   |   |   ├── test_bbox_tight
|   |   |   |   ├── test_collections
|   |   |   |   ├── test_colorbar
|   |   |   |   ├── test_colors
|   |   |   |   ├── test_compare_images
|   |   |   |   ├── test_constrainedlayout
|   |   |   |   ├── test_contour
|   |   |   |   ├── test_dates
|   |   |   |   ├── test_figure
|   |   |   |   ├── test_image
|   |   |   |   ├── test_legend
|   |   |   |   ├── test_lines
|   |   |   |   ├── test_mathtext
|   |   |   |   ├── test_offsetbox
|   |   |   |   ├── test_patches
|   |   |   |   ├── test_path
|   |   |   |   ├── test_patheffects
|   |   |   |   ├── test_png
|   |   |   |   ├── test_polar
|   |   |   |   ├── test_quiver
|   |   |   |   ├── test_scale
|   |   |   |   ├── test_simplification
|   |   |   |   ├── test_skew
|   |   |   |   ├── test_spines
|   |   |   |   ├── test_streamplot
|   |   |   |   ├── test_subplots
|   |   |   |   ├── test_table
|   |   |   |   ├── test_text
|   |   |   |   ├── test_tightlayout
|   |   |   |   ├── test_transforms
|   |   |   |   ├── test_triangulation
|   |   |   |   ├── test_ttconv
|   |   |   |   ├── test_units
|   |   |   |   ├── test_usetex
|   |   |   |   └── test_widgets
|   |   |   ├── conftest.py
|   |   |   ├── test_afm.py
|   |   |   ├── test_agg.py
|   |   |   ├── test_agg_filter.py
|   |   |   ├── test_animation.py
|   |   |   ├── test_api.py
|   |   |   ├── test_arrow_patches.py
|   |   |   ├── test_artist.py
|   |   |   ├── test_axes.py
|   |   |   ├── test_backend_bases.py
|   |   |   ├── test_backend_cairo.py
|   |   |   ├── test_backend_gtk3.py
|   |   |   ├── test_backend_macosx.py
|   |   |   ├── test_backend_nbagg.py
|   |   |   ├── test_backend_pdf.py
|   |   |   ├── test_backend_pgf.py
|   |   |   ├── test_backend_ps.py
|   |   |   ├── test_backend_qt.py
|   |   |   ├── test_backend_svg.py
|   |   |   ├── test_backend_template.py
|   |   |   ├── test_backend_tk.py
|   |   |   ├── test_backend_tools.py
|   |   |   ├── test_backend_webagg.py
|   |   |   ├── test_backends_interactive.py
|   |   |   ├── test_basic.py
|   |   |   ├── test_bbox_tight.py
|   |   |   ├── test_category.py
|   |   |   ├── test_cbook.py
|   |   |   ├── test_collections.py
|   |   |   ├── test_colorbar.py
|   |   |   ├── test_colors.py
|   |   |   ├── test_compare_images.py
|   |   |   ├── test_constrainedlayout.py
|   |   |   ├── test_container.py
|   |   |   ├── test_contour.py
|   |   |   ├── test_cycles.py
|   |   |   ├── test_dates.py
|   |   |   ├── test_determinism.py
|   |   |   ├── test_doc.py
|   |   |   ├── test_dviread.py
|   |   |   ├── test_figure.py
|   |   |   ├── test_font_manager.py
|   |   |   ├── test_fontconfig_pattern.py
|   |   |   ├── test_getattr.py
|   |   |   ├── test_gridspec.py
|   |   |   ├── test_image.py
|   |   |   ├── test_legend.py
|   |   |   ├── test_lines.py
|   |   |   ├── test_marker.py
|   |   |   ├── test_mathtext.py
|   |   |   ├── test_matplotlib.py
|   |   |   ├── test_mlab.py
|   |   |   ├── test_offsetbox.py
|   |   |   ├── test_patches.py
|   |   |   ├── test_path.py
|   |   |   ├── test_patheffects.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_png.py
|   |   |   ├── test_polar.py
|   |   |   ├── test_preprocess_data.py
|   |   |   ├── test_pyplot.py
|   |   |   ├── test_quiver.py
|   |   |   ├── test_rcparams.py
|   |   |   ├── test_sankey.py
|   |   |   ├── test_scale.py
|   |   |   ├── test_simplification.py
|   |   |   ├── test_skew.py
|   |   |   ├── test_sphinxext.py
|   |   |   ├── test_spines.py
|   |   |   ├── test_streamplot.py
|   |   |   ├── test_style.py
|   |   |   ├── test_subplots.py
|   |   |   ├── test_table.py
|   |   |   ├── test_testing.py
|   |   |   ├── test_texmanager.py
|   |   |   ├── test_text.py
|   |   |   ├── test_textpath.py
|   |   |   ├── test_ticker.py
|   |   |   ├── test_tightlayout.py
|   |   |   ├── test_transforms.py
|   |   |   ├── test_triangulation.py
|   |   |   ├── test_ttconv.py
|   |   |   ├── test_type1font.py
|   |   |   ├── test_units.py
|   |   |   ├── test_usetex.py
|   |   |   ├── test_widgets.py
|   |   |   └── tinypages
|   |   |       ├── README.md
|   |   |       ├── _static
|   |   |       ├── conf.py
|   |   |       ├── included_plot_21.rst
|   |   |       ├── index.rst
|   |   |       ├── range4.py
|   |   |       ├── range6.py
|   |   |       └── some_plots.rst
|   |   ├── texmanager.py
|   |   ├── text.py
|   |   ├── textpath.py
|   |   ├── ticker.py
|   |   ├── tight_bbox.py
|   |   ├── tight_layout.py
|   |   ├── transforms.py
|   |   ├── tri
|   |   |   ├── __init__.py
|   |   |   ├── triangulation.py
|   |   |   ├── tricontour.py
|   |   |   ├── trifinder.py
|   |   |   ├── triinterpolate.py
|   |   |   ├── tripcolor.py
|   |   |   ├── triplot.py
|   |   |   ├── trirefine.py
|   |   |   └── tritools.py
|   |   ├── type1font.py
|   |   ├── units.py
|   |   └── widgets.py
|   ├── mpl_toolkits
|   |   ├── __init__.py
|   |   ├── axes_grid1
|   |   |   ├── __init__.py
|   |   |   ├── anchored_artists.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axes_size.py
|   |   |   ├── inset_locator.py
|   |   |   ├── mpl_axes.py
|   |   |   └── parasite_axes.py
|   |   ├── axisartist
|   |   |   ├── __init__.py
|   |   |   ├── angle_helper.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axis_artist.py
|   |   |   ├── axisline_style.py
|   |   |   ├── axislines.py
|   |   |   ├── clip_path.py
|   |   |   ├── floating_axes.py
|   |   |   ├── grid_finder.py
|   |   |   ├── grid_helper_curvelinear.py
|   |   |   └── parasite_axes.py
|   |   ├── mplot3d
|   |   |   ├── __init__.py
|   |   |   ├── art3d.py
|   |   |   ├── axes3d.py
|   |   |   ├── axis3d.py
|   |   |   └── proj3d.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── baseline_images
|   |       |   ├── test_axes_grid
|   |       |   ├── test_axes_grid1
|   |       |   ├── test_axisartist_axis_artist
|   |       |   ├── test_axisartist_axislines
|   |       |   ├── test_axisartist_clip_path
|   |       |   ├── test_axisartist_floating_axes
|   |       |   ├── test_axisartist_grid_helper_curvelinear
|   |       |   └── test_mplot3d
|   |       ├── conftest.py
|   |       ├── test_axes_grid.py
|   |       ├── test_axes_grid1.py
|   |       ├── test_axisartist_angle_helper.py
|   |       ├── test_axisartist_axis_artist.py
|   |       ├── test_axisartist_axislines.py
|   |       ├── test_axisartist_clip_path.py
|   |       ├── test_axisartist_floating_axes.py
|   |       ├── test_axisartist_grid_finder.py
|   |       ├── test_axisartist_grid_helper_curvelinear.py
|   |       └── test_mplot3d.py
|   └── pylab.py
├── plot_types
|   ├── README.rst
|   ├── arrays
|   |   ├── README.rst
|   |   ├── barbs.py
|   |   ├── contour.py
|   |   ├── contourf.py
|   |   ├── imshow.py
|   |   ├── pcolormesh.py
|   |   ├── quiver.py
|   |   └── streamplot.py
|   ├── basic
|   |   ├── README.rst
|   |   ├── bar.py
|   |   ├── fill_between.py
|   |   ├── plot.py
|   |   ├── scatter_plot.py
|   |   ├── stackplot.py
|   |   ├── stem.py
|   |   └── step.py
|   ├── stats
|   |   ├── README.rst
|   |   ├── boxplot_plot.py
|   |   ├── errorbar_plot.py
|   |   ├── eventplot.py
|   |   ├── hexbin.py
|   |   ├── hist2d.py
|   |   ├── hist_plot.py
|   |   ├── pie.py
|   |   └── violin.py
|   └── unstructured
|       ├── README.rst
|       ├── tricontour.py
|       ├── tricontourf.py
|       ├── tripcolor.py
|       └── triplot.py
├── requirements
|   ├── dev
|   |   └── dev-requirements.txt
|   ├── doc
|   |   └── doc-requirements.txt
|   └── testing
|       ├── all.txt
|       ├── extra.txt
|       ├── flake8.txt
|       └── minver.txt
├── setup.py
├── setupext.py
├── src
|   ├── _backend_agg.cpp
|   ├── _backend_agg_wrapper.cpp
|   ├── _c_internal_utils.c
|   ├── _image_wrapper.cpp
|   ├── _path_wrapper.cpp
|   ├── _qhull_wrapper.cpp
|   ├── _tkagg.cpp
|   ├── _ttconv.cpp
|   ├── checkdep_freetype2.c
|   ├── doc
|   ├── ft2font.cpp
|   ├── ft2font_wrapper.cpp
|   ├── py_converters.cpp
|   └── tri
|       ├── _tri.cpp
|       └── _tri_wrapper.cpp
├── tests.py
├── tools
|   ├── README.txt
|   ├── boilerplate.py
|   ├── cache_zenodo_svg.py
|   ├── create_DejaVuDisplay.sh
|   ├── embed_js.py
|   ├── gh_api.py
|   ├── github_stats.py
|   ├── make_icons.py
|   ├── memleak.py
|   ├── run_examples.py
|   ├── subset.py
|   ├── triage_tests.py
|   └── visualize_tests.py
└── tutorials
    ├── README.txt
    ├── advanced
    |   ├── README.txt
    |   ├── blitting.py
    |   ├── path_tutorial.py
    |   ├── patheffects_guide.py
    |   └── transforms_tutorial.py
    ├── colors
    |   ├── README.txt
    |   ├── colorbar_only.py
    |   ├── colormap-manipulation.py
    |   ├── colormapnorms.py
    |   ├── colormaps.py
    |   └── colors.py
    ├── intermediate
    |   ├── README.txt
    |   ├── arranging_axes.py
    |   ├── artists.py
    |   ├── autoscale.py
    |   ├── color_cycle.py
    |   ├── constrainedlayout_guide.py
    |   ├── imshow_extent.py
    |   ├── legend_guide.py
    |   └── tight_layout_guide.py
    ├── introductory
    |   ├── README.txt
    |   ├── customizing.py
    |   ├── images.py
    |   ├── lifecycle.py
    |   ├── pyplot.py
    |   └── quick_start.py
    ├── provisional
    |   ├── README.txt
    |   └── mosaic.py
    ├── text
    |   ├── README.txt
    |   ├── annotations.py
    |   ├── mathtext.py
    |   ├── pgf.py
    |   ├── text_intro.py
    |   ├── text_props.py
    |   └── usetex.py
    └── toolkits
        ├── README.txt
        ├── axes_grid.py
        ├── axisartist.py
        └── mplot3d.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: [Bug]: get_backend() clears figures from Gcf.figs if they were created under rc_context

Description: ### Bug summary

calling `matplotlib.get_backend()` removes all figures from `Gcf` if the *first* figure in `Gcf.figs` was created in an `rc_context`.

### Code for reproduction

```python
import matplotlib.pyplot as plt
from matplotlib import get_backend, rc_context

# fig1 = plt.figure()  # <- UNCOMMENT THIS LINE AND IT WILL WORK
# plt.ion()            # <- ALTERNATIVELY, UNCOMMENT THIS LINE AND IT WILL ALSO WORK
with rc_context():
    fig2 = plt.figure()
before = f'{id(plt._pylab_helpers.Gcf)} {plt._pylab_helpers.Gcf.figs!r}'
get_backend()
after = f'{id(plt._pylab_helpers.Gcf)} {plt._pylab_helpers.Gcf.figs!r}'

assert before == after, '\n' + before + '\n' + after
```


### Actual outcome

```
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
<ipython-input-1-fa4d099aa289> in <cell line: 11>()
      9 after = f'{id(plt._pylab_helpers.Gcf)} {plt._pylab_helpers.Gcf.figs!r}'
     10 
---> 11 assert before == after, '\n' + before + '\n' + after
     12 

AssertionError: 
94453354309744 OrderedDict([(1, <matplotlib.backends.backend_qt.FigureManagerQT object at 0x7fb33e26c220>)])
94453354309744 OrderedDict()
```

### Expected outcome

The figure should not be missing from `Gcf`.  Consequences of this are, e.g, `plt.close(fig2)` doesn't work because `Gcf.destroy_fig()` can't find it.

### Additional information

_No response_

### Operating system

Xubuntu

### Matplotlib Version

3.5.2

### Matplotlib Backend

QtAgg

### Python version

Python 3.10.4

### Jupyter version

n/a

### Installation

conda

Patch information:
diff --git a/lib/matplotlib/__init__.py b/lib/matplotlib/__init__.py
index c268a56724..c5c1a8e71a 100644
--- a/lib/matplotlib/__init__.py
+++ b/lib/matplotlib/__init__.py
@@ -1095,7 +1095,19 @@ def rc_context(rc=None, fname=None):
             rcParams.update(rc)
         yield
     finally:
-        dict.update(rcParams, orig)  # Revert to the original rcs.
+        # Revert to the original rcs, but preserve a resolved backend if the
+        # original value was the auto backend sentinel.
+        try:
+            original_backend = dict.__getitem__(orig, "backend")
+        except KeyError:
+            original_backend = None
+        if original_backend is rcsetup._auto_backend_sentinel:
+            # Get current backend without triggering resolution.
+            current_backend = dict.__getitem__(rcParams, "backend")
+            if current_backend is not rcsetup._auto_backend_sentinel:
+                # Preserve the resolved backend selected during the context.
+                dict.__setitem__(orig, "backend", current_backend)
+        dict.update(rcParams, orig)
 
 
 def use(backend, *, force=True):


Find all relevant source code context needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-24 03:09:21,420 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user is reporting a bug where figures created in an `rc_context` are cleared by `get_backend()`. To understand this, I need to examine the implementation of `get_backend`, `rc_context`, `pyplot.figure`, and the `Gcf` helper class that manages figures. The provided patch also points to `rcsetup` being relevant as it is referenced in the patch.' query='Please provide the full content of `lib/matplotlib/__init__.py`, `lib/matplotlib/pyplot.py`, `lib/matplotlib/_pylab_helpers.py`, and `lib/matplotlib/rcsetup.py`.' extra_requirements='' purpose='This will allow me to trace the creation of the figure, its registration, and the mechanism by which `get_backend` might be clearing it, focusing on the backend selection logic within `rc_context`.'
2025-12-24 03:09:21,421 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `lib/matplotlib/__init__.py`, `lib/matplotlib/pyplot.py`, `lib/matplotlib/_pylab_helpers.py`, and `lib/matplotlib/rcsetup.py`.
2025-12-24 03:09:21,421 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-24 03:09:21,421 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-24 03:09:21,422 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-24 03:09:21,422 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `lib/matplotlib/__init__.py`, `lib/matplotlib/pyplot.py`, `lib/matplotlib/_pylab_helpers.py`, and `lib/matplotlib/rcsetup.py`.
Purpose: This will allow me to trace the creation of the figure, its registration, and the mechanism by which `get_backend` might be clearing it, focusing on the backend selection logic within `rc_context`.
2025-12-24 03:09:24,726 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have read the full content of the four requested files: `lib/matplotlib/__init__.py`, `lib/matplotlib/pyplot.py`, `lib/matplotlib/_pylab_helpers.py`, and `lib/matplotlib/rcsetup.py`. This will allow for a comprehensive trace of the figure creation process, its registration, and the backend selection logic.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "lib/matplotlib/rcsetup.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2174, 'candidates_token_count': 163, 'total_token_count': 2428, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2174}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 163}], 'thoughts_token_count': 91, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.05912177548086717, 'model_name': 'gemini-2.5-pro'} id='run--399d823f-124b-43ac-9db3-bbe17d53f6bf-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'lib/matplotlib/__init__.py'}, 'id': '9791144c-7bb9-4a3a-850a-12a3cd8f857b', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'lib/matplotlib/pyplot.py'}, 'id': '899736a1-dc1a-44fa-ae3a-040f1c459268', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'lib/matplotlib/_pylab_helpers.py'}, 'id': '63f1bc24-7412-4608-ba73-8866b929ef72', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'lib/matplotlib/rcsetup.py'}, 'id': '2dd3738a-8fab-40e8-9dc7-fadfdb0e5b7c', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2174, 'output_tokens': 163, 'total_tokens': 2428, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 91}}
2025-12-24 03:09:28,127 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have read the full content of `lib/matplotlib/__init__.py`, `lib/matplotlib/pyplot.py`, `lib/matplotlib/_pylab_helpers.py`, and `lib/matplotlib/rcsetup.py`. These files provide the necessary context to trace figure creation, registration, and backend selection logic. I can now analyze how `get_backend` and `rc_context` might interact to affect figure management.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 25051, 'candidates_token_count': 89, 'total_token_count': 25262, 'cached_content_token_count': 1916, 'prompt_tokens_details': [{'modality': 1, 'token_count': 25051}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1916}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 89}], 'thoughts_token_count': 122}, 'finish_reason': 'STOP', 'avg_logprobs': -0.13741674316063357, 'model_name': 'gemini-2.5-pro'} id='run--c87a6ea1-c326-49cd-ba2d-92009361fa74-0' usage_metadata={'input_tokens': 25051, 'output_tokens': 89, 'total_tokens': 25262, 'input_token_details': {'cache_read': 1916}, 'output_token_details': {'reasoning': 122}}
2025-12-24 03:09:28,129 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `lib/matplotlib/__init__.py`, `lib/matplotlib/pyplot.py`, `lib/matplotlib/_pylab_helpers.py`, and `lib/matplotlib/rcsetup.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
This will allow me to trace the creation of the figure, its registration, and the mechanism by which `get_backend` might be clearing it, focusing on the backend selection logic within `rc_context`.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: lib/matplotlib/__init__.py
Line number range: 1 - 500
Content:
1. """
2. An object-oriented plotting library.
3. 
4. A procedural interface is provided by the companion pyplot module,
5. which may be imported directly, e.g.::
6. 
7.     import matplotlib.pyplot as plt
8. 
9. or using ipython::
10. 
11.     ipython
12. 
13. at your terminal, followed by::
14. 
15.     In [1]: %matplotlib
16.     In [2]: import matplotlib.pyplot as plt
17. 
18. at the ipython shell prompt.
19. 
20. For the most part, direct use of the explicit object-oriented library is
21. encouraged when programming; the implicit pyplot interface is primarily for
22. working interactively. The exceptions to this suggestion are the pyplot
23. functions `.pyplot.figure`, `.pyplot.subplot`, `.pyplot.subplots`, and
24. `.pyplot.savefig`, which can greatly simplify scripting.  See
25. :ref:`api_interfaces` for an explanation of the tradeoffs between the implicit
26. and explicit interfaces.
27. 
28. Modules include:
29. 
30.     :mod:`matplotlib.axes`
31.         The `~.axes.Axes` class.  Most pyplot functions are wrappers for
32.         `~.axes.Axes` methods.  The axes module is the highest level of OO
33.         access to the library.
34. 
35.     :mod:`matplotlib.figure`
36.         The `.Figure` class.
37. 
38.     :mod:`matplotlib.artist`
39.         The `.Artist` base class for all classes that draw things.
40. 
41.     :mod:`matplotlib.lines`
42.         The `.Line2D` class for drawing lines and markers.
43. 
44.     :mod:`matplotlib.patches`
45.         Classes for drawing polygons.
46. 
47.     :mod:`matplotlib.text`
48.         The `.Text` and `.Annotation` classes.
49. 
50.     :mod:`matplotlib.image`
51.         The `.AxesImage` and `.FigureImage` classes.
52. 
53.     :mod:`matplotlib.collections`
54.         Classes for efficient drawing of groups of lines or polygons.
55. 
56.     :mod:`matplotlib.colors`
57.         Color specifications and making colormaps.
58. 
59.     :mod:`matplotlib.cm`
60.         Colormaps, and the `.ScalarMappable` mixin class for providing color
61.         mapping functionality to other classes.
62. 
63.     :mod:`matplotlib.ticker`
64.         Calculation of tick mark locations and formatting of tick labels.
65. 
66.     :mod:`matplotlib.backends`
67.         A subpackage with modules for various GUI libraries and output formats.
68. 
69. The base matplotlib namespace includes:
70. 
71.     `~matplotlib.rcParams`
72.         Default configuration settings; their defaults may be overridden using
73.         a :file:`matplotlibrc` file.
74. 
75.     `~matplotlib.use`
76.         Setting the Matplotlib backend.  This should be called before any
77.         figure is created, because it is not possible to switch between
78.         different GUI backends after that.
79. 
80. Matplotlib was initially written by John D. Hunter (1968-2012) and is now
81. developed and maintained by a host of others.
82. 
83. Occasionally the internal documentation (python docstrings) will refer
84. to MATLAB&reg;, a registered trademark of The MathWorks, Inc.
85. 
86. """
87. 
88. import atexit
89. from collections import namedtuple
90. from collections.abc import MutableMapping
91. import contextlib
92. import functools
93. import importlib
94. import inspect
95. from inspect import Parameter
96. import locale
97. import logging
98. import os
99. from pathlib import Path
100. import pprint
101. import re
102. import shutil
103. import subprocess
104. import sys
105. import tempfile
106. import warnings
107. 
108. import numpy
109. from packaging.version import parse as parse_version
110. 
111. # cbook must import matplotlib only within function
112. # definitions, so it is safe to import from it here.
113. from . import _api, _version, cbook, _docstring, rcsetup
114. from matplotlib.cbook import sanitize_sequence
115. from matplotlib._api import MatplotlibDeprecationWarning
116. from matplotlib.rcsetup import validate_backend, cycler
117. 
118. 
119. _log = logging.getLogger(__name__)
120. 
121. __bibtex__ = r"""@Article{Hunter:2007,
122.   Author    = {Hunter, J. D.},
123.   Title     = {Matplotlib: A 2D graphics environment},
124.   Journal   = {Computing in Science \& Engineering},
125.   Volume    = {9},
126.   Number    = {3},
127.   Pages     = {90--95},
128.   abstract  = {Matplotlib is a 2D graphics package used for Python
129.   for application development, interactive scripting, and
130.   publication-quality image generation across user
131.   interfaces and operating systems.},
132.   publisher = {IEEE COMPUTER SOC},
133.   year      = 2007
134. }"""
135. 
136. # modelled after sys.version_info
137. _VersionInfo = namedtuple('_VersionInfo',
138.                           'major, minor, micro, releaselevel, serial')
139. 
140. 
141. def _parse_to_version_info(version_str):
142.     """
143.     Parse a version string to a namedtuple analogous to sys.version_info.
144. 
145.     See:
146.     https://packaging.pypa.io/en/latest/version.html#packaging.version.parse
147.     https://docs.python.org/3/library/sys.html#sys.version_info
148.     """
149.     v = parse_version(version_str)
150.     if v.pre is None and v.post is None and v.dev is None:
151.         return _VersionInfo(v.major, v.minor, v.micro, 'final', 0)
152.     elif v.dev is not None:
153.         return _VersionInfo(v.major, v.minor, v.micro, 'alpha', v.dev)
154.     elif v.pre is not None:
155.         releaselevel = {
156.             'a': 'alpha',
157.             'b': 'beta',
158.             'rc': 'candidate'}.get(v.pre[0], 'alpha')
159.         return _VersionInfo(v.major, v.minor, v.micro, releaselevel, v.pre[1])
160.     else:
161.         # fallback for v.post: guess-next-dev scheme from setuptools_scm
162.         return _VersionInfo(v.major, v.minor, v.micro + 1, 'alpha', v.post)
163. 
164. 
165. def _get_version():
166.     """Return the version string used for __version__."""
167.     # Only shell out to a git subprocess if really needed, i.e. when we are in
168.     # a matplotlib git repo but not in a shallow clone, such as those used by
169.     # CI, as the latter would trigger a warning from setuptools_scm.
170.     root = Path(__file__).resolve().parents[2]
171.     if ((root / ".matplotlib-repo").exists()
172.             and (root / ".git").exists()
173.             and not (root / ".git/shallow").exists()):
174.         import setuptools_scm
175.         return setuptools_scm.get_version(
176.             root=root,
177.             version_scheme="release-branch-semver",
178.             local_scheme="node-and-date",
179.             fallback_version=_version.version,
180.         )
181.     else:  # Get the version from the _version.py setuptools_scm file.
182.         return _version.version
183. 
184. 
185. @_api.caching_module_getattr
186. class __getattr__:
187.     __version__ = property(lambda self: _get_version())
188.     __version_info__ = property(
189.         lambda self: _parse_to_version_info(self.__version__))
190.     # module-level deprecations
191.     URL_REGEX = _api.deprecated("3.5", obj_type="")(property(
192.         lambda self: re.compile(r'^http://|^https://|^ftp://|^file:')))
193. 
194. 
195. def _check_versions():
196. 
197.     # Quickfix to ensure Microsoft Visual C++ redistributable
198.     # DLLs are loaded before importing kiwisolver
199.     from . import ft2font
200. 
201.     for modname, minver in [
202.             ("cycler", "0.10"),
203.             ("dateutil", "2.7"),
204.             ("kiwisolver", "1.0.1"),
205.             ("numpy", "1.19"),
206.             ("pyparsing", "2.2.1"),
207.     ]:
208.         module = importlib.import_module(modname)
209.         if parse_version(module.__version__) < parse_version(minver):
210.             raise ImportError(f"Matplotlib requires {modname}>={minver}; "
211.                               f"you have {module.__version__}")
212. 
213. 
214. _check_versions()
215. 
216. 
217. # The decorator ensures this always returns the same handler (and it is only
218. # attached once).
219. @functools.lru_cache()
220. def _ensure_handler():
221.     """
222.     The first time this function is called, attach a `StreamHandler` using the
223.     same format as `logging.basicConfig` to the Matplotlib root logger.
224. 
225.     Return this handler every time this function is called.
226.     """
227.     handler = logging.StreamHandler()
228.     handler.setFormatter(logging.Formatter(logging.BASIC_FORMAT))
229.     _log.addHandler(handler)
230.     return handler
231. 
232. 
233. def set_loglevel(level):
234.     """
235.     Set Matplotlib's root logger and root logger handler level, creating
236.     the handler if it does not exist yet.
237. 
238.     Typically, one should call ``set_loglevel("info")`` or
239.     ``set_loglevel("debug")`` to get additional debugging information.
240. 
241.     Parameters
242.     ----------
243.     level : {"notset", "debug", "info", "warning", "error", "critical"}
244.         The log level of the handler.
245. 
246.     Notes
247.     -----
248.     The first time this function is called, an additional handler is attached
249.     to Matplotlib's root handler; this handler is reused every time and this
250.     function simply manipulates the logger and handler's level.
251.     """
252.     _log.setLevel(level.upper())
253.     _ensure_handler().setLevel(level.upper())
254. 
255. 
256. def _logged_cached(fmt, func=None):
257.     """
258.     Decorator that logs a function's return value, and memoizes that value.
259. 
260.     After ::
261. 
262.         @_logged_cached(fmt)
263.         def func(): ...
264. 
265.     the first call to *func* will log its return value at the DEBUG level using
266.     %-format string *fmt*, and memoize it; later calls to *func* will directly
267.     return that value.
268.     """
269.     if func is None:  # Return the actual decorator.
270.         return functools.partial(_logged_cached, fmt)
271. 
272.     called = False
273.     ret = None
274. 
275.     @functools.wraps(func)
276.     def wrapper(**kwargs):
277.         nonlocal called, ret
278.         if not called:
279.             ret = func(**kwargs)
280.             called = True
281.             _log.debug(fmt, ret)
282.         return ret
283. 
284.     return wrapper
285. 
286. 
287. _ExecInfo = namedtuple("_ExecInfo", "executable raw_version version")
288. 
289. 
290. class ExecutableNotFoundError(FileNotFoundError):
291.     """
292.     Error raised when an executable that Matplotlib optionally
293.     depends on can't be found.
294.     """
295.     pass
296. 
297. 
298. @functools.lru_cache()
299. def _get_executable_info(name):
300.     """
301.     Get the version of some executable that Matplotlib optionally depends on.
302. 
303.     .. warning::
304.        The list of executables that this function supports is set according to
305.        Matplotlib's internal needs, and may change without notice.
306. 
307.     Parameters
308.     ----------
309.     name : str
310.         The executable to query.  The following values are currently supported:
311.         "dvipng", "gs", "inkscape", "magick", "pdftocairo", "pdftops".  This
312.         list is subject to change without notice.
313. 
314.     Returns
315.     -------
316.     tuple
317.         A namedtuple with fields ``executable`` (`str`) and ``version``
318.         (`packaging.Version`, or ``None`` if the version cannot be determined).
319. 
320.     Raises
321.     ------
322.     ExecutableNotFoundError
323.         If the executable is not found or older than the oldest version
324.         supported by Matplotlib.  For debugging purposes, it is also
325.         possible to "hide" an executable from Matplotlib by adding it to the
326.         :envvar:`_MPLHIDEEXECUTABLES` environment variable (a comma-separated
327.         list), which must be set prior to any calls to this function.
328.     ValueError
329.         If the executable is not one that we know how to query.
330.     """
331. 
332.     def impl(args, regex, min_ver=None, ignore_exit_code=False):
333.         # Execute the subprocess specified by args; capture stdout and stderr.
334.         # Search for a regex match in the output; if the match succeeds, the
335.         # first group of the match is the version.
336.         # Return an _ExecInfo if the executable exists, and has a version of
337.         # at least min_ver (if set); else, raise ExecutableNotFoundError.
338.         try:
339.             output = subprocess.check_output(
340.                 args, stderr=subprocess.STDOUT,
341.                 universal_newlines=True, errors="replace")
342.         except subprocess.CalledProcessError as _cpe:
343.             if ignore_exit_code:
344.                 output = _cpe.output
345.             else:
346.                 raise ExecutableNotFoundError(str(_cpe)) from _cpe
347.         except OSError as _ose:
348.             raise ExecutableNotFoundError(str(_ose)) from _ose
349.         match = re.search(regex, output)
350.         if match:
351.             raw_version = match.group(1)
352.             version = parse_version(raw_version)
353.             if min_ver is not None and version < parse_version(min_ver):
354.                 raise ExecutableNotFoundError(
355.                     f"You have {args[0]} version {version} but the minimum "
356.                     f"version supported by Matplotlib is {min_ver}")
357.             return _ExecInfo(args[0], raw_version, version)
358.         else:
359.             raise ExecutableNotFoundError(
360.                 f"Failed to determine the version of {args[0]} from "
361.                 f"{' '.join(args)}, which output {output}")
362. 
363.     if name in os.environ.get("_MPLHIDEEXECUTABLES", "").split(","):
364.         raise ExecutableNotFoundError(f"{name} was hidden")
365. 
366.     if name == "dvipng":
367.         return impl(["dvipng", "-version"], "(?m)^dvipng(?: .*)? (.+)", "1.6")
368.     elif name == "gs":
369.         execs = (["gswin32c", "gswin64c", "mgs", "gs"]  # "mgs" for miktex.
370.                  if sys.platform == "win32" else
371.                  ["gs"])
372.         for e in execs:
373.             try:
374.                 return impl([e, "--version"], "(.*)", "9")
375.             except ExecutableNotFoundError:
376.                 pass
377.         message = "Failed to find a Ghostscript installation"
378.         raise ExecutableNotFoundError(message)
379.     elif name == "inkscape":
380.         try:
381.             # Try headless option first (needed for Inkscape version < 1.0):
382.             return impl(["inkscape", "--without-gui", "-V"],
383.                         "Inkscape ([^ ]*)")
384.         except ExecutableNotFoundError:
385.             pass  # Suppress exception chaining.
386.         # If --without-gui is not accepted, we may be using Inkscape >= 1.0 so
387.         # try without it:
388.         return impl(["inkscape", "-V"], "Inkscape ([^ ]*)")
389.     elif name == "magick":
390.         if sys.platform == "win32":
391.             # Check the registry to avoid confusing ImageMagick's convert with
392.             # Windows's builtin convert.exe.
393.             import winreg
394.             binpath = ""
395.             for flag in [0, winreg.KEY_WOW64_32KEY, winreg.KEY_WOW64_64KEY]:
396.                 try:
397.                     with winreg.OpenKeyEx(
398.                             winreg.HKEY_LOCAL_MACHINE,
399.                             r"Software\Imagemagick\Current",
400.                             0, winreg.KEY_QUERY_VALUE | flag) as hkey:
401.                         binpath = winreg.QueryValueEx(hkey, "BinPath")[0]
402.                 except OSError:
403.                     pass
404.             path = None
405.             if binpath:
406.                 for name in ["convert.exe", "magick.exe"]:
407.                     candidate = Path(binpath, name)
408.                     if candidate.exists():
409.                         path = str(candidate)
410.                         break
411.             if path is None:
412.                 raise ExecutableNotFoundError(
413.                     "Failed to find an ImageMagick installation")
414.         else:
415.             path = "convert"
416.         info = impl([path, "--version"], r"^Version: ImageMagick (\S*)")
417.         if info.raw_version == "7.0.10-34":
418.             # https://github.com/ImageMagick/ImageMagick/issues/2720
419.             raise ExecutableNotFoundError(
420.                 f"You have ImageMagick {info.version}, which is unsupported")
421.         return info
422.     elif name == "pdftocairo":
423.         return impl(["pdftocairo", "-v"], "pdftocairo version (.*)")
424.     elif name == "pdftops":
425.         info = impl(["pdftops", "-v"], "^pdftops version (.*)",
426.                     ignore_exit_code=True)
427.         if info and not (
428.                 3 <= info.version.major or
429.                 # poppler version numbers.
430.                 parse_version("0.9") <= info.version < parse_version("1.0")):
431.             raise ExecutableNotFoundError(
432.                 f"You have pdftops version {info.version} but the minimum "
433.                 f"version supported by Matplotlib is 3.0")
434.         return info
435.     else:
436.         raise ValueError("Unknown executable: {!r}".format(name))
437. 
438. 
439. @_api.deprecated("3.6", alternative="Vendor the code")
440. def checkdep_usetex(s):
441.     if not s:
442.         return False
443.     if not shutil.which("tex"):
444.         _log.warning("usetex mode requires TeX.")
445.         return False
446.     try:
447.         _get_executable_info("dvipng")
448.     except ExecutableNotFoundError:
449.         _log.warning("usetex mode requires dvipng.")
450.         return False
451.     try:
452.         _get_executable_info("gs")
453.     except ExecutableNotFoundError:
454.         _log.warning("usetex mode requires ghostscript.")
455.         return False
456.     return True
457. 
458. 
459. def _get_xdg_config_dir():
460.     """
461.     Return the XDG configuration directory, according to the XDG base
462.     directory spec:
463. 
464.     https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html
465.     """
466.     return os.environ.get('XDG_CONFIG_HOME') or str(Path.home() / ".config")
467. 
468. 
469. def _get_xdg_cache_dir():
470.     """
471.     Return the XDG cache directory, according to the XDG base directory spec:
472. 
473.     https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html
474.     """
475.     return os.environ.get('XDG_CACHE_HOME') or str(Path.home() / ".cache")
476. 
477. 
478. def _get_config_or_cache_dir(xdg_base_getter):
479.     configdir = os.environ.get('MPLCONFIGDIR')
480.     if configdir:
481.         configdir = Path(configdir).resolve()
482.     elif sys.platform.startswith(('linux', 'freebsd')):
483.         # Only call _xdg_base_getter here so that MPLCONFIGDIR is tried first,
484.         # as _xdg_base_getter can throw.
485.         configdir = Path(xdg_base_getter(), "matplotlib")
486.     else:
487.         configdir = Path.home() / ".matplotlib"
488.     try:
489.         configdir.mkdir(parents=True, exist_ok=True)
490.     except OSError:
491.         pass
492.     else:
493.         if os.access(str(configdir), os.W_OK) and configdir.is_dir():
494.             return str(configdir)
495.     # If the config or cache directory cannot be created or is not a writable
496.     # directory, create a temporary one.
497.     tmpdir = os.environ["MPLCONFIGDIR"] = \
498.         tempfile.mkdtemp(prefix="matplotlib-")
499.     atexit.register(shutil.rmtree, tmpdir)
500.     _log.warning(


File: lib/matplotlib/_pylab_helpers.py
Line number range: 1 - 144
Content:
1. """
2. Manage figures for the pyplot interface.
3. """
4. 
5. import atexit
6. from collections import OrderedDict
7. import gc
8. 
9. 
10. class Gcf:
11.     """
12.     Singleton to maintain the relation between figures and their managers, and
13.     keep track of and "active" figure and manager.
14. 
15.     The canvas of a figure created through pyplot is associated with a figure
16.     manager, which handles the interaction between the figure and the backend.
17.     pyplot keeps track of figure managers using an identifier, the "figure
18.     number" or "manager number" (which can actually be any hashable value);
19.     this number is available as the :attr:`number` attribute of the manager.
20. 
21.     This class is never instantiated; it consists of an `OrderedDict` mapping
22.     figure/manager numbers to managers, and a set of class methods that
23.     manipulate this `OrderedDict`.
24. 
25.     Attributes
26.     ----------
27.     figs : OrderedDict
28.         `OrderedDict` mapping numbers to managers; the active manager is at the
29.         end.
30.     """
31. 
32.     figs = OrderedDict()
33. 
34.     @classmethod
35.     def get_fig_manager(cls, num):
36.         """
37.         If manager number *num* exists, make it the active one and return it;
38.         otherwise return *None*.
39.         """
40.         manager = cls.figs.get(num, None)
41.         if manager is not None:
42.             cls.set_active(manager)
43.         return manager
44. 
45.     @classmethod
46.     def destroy(cls, num):
47.         """
48.         Destroy manager *num* -- either a manager instance or a manager number.
49. 
50.         In the interactive backends, this is bound to the window "destroy" and
51.         "delete" events.
52. 
53.         It is recommended to pass a manager instance, to avoid confusion when
54.         two managers share the same number.
55.         """
56.         if all(hasattr(num, attr) for attr in ["num", "destroy"]):
57.             manager = num
58.             if cls.figs.get(manager.num) is manager:
59.                 cls.figs.pop(manager.num)
60.         else:
61.             try:
62.                 manager = cls.figs.pop(num)
63.             except KeyError:
64.                 return
65.         if hasattr(manager, "_cidgcf"):
66.             manager.canvas.mpl_disconnect(manager._cidgcf)
67.         manager.destroy()
68.         del manager, num
69.         # Full cyclic garbage collection may be too expensive to do on every
70.         # figure destruction, so we collect only the youngest two generations.
71.         # see: https://github.com/matplotlib/matplotlib/pull/3045
72.         gc.collect(1)
73. 
74.     @classmethod
75.     def destroy_fig(cls, fig):
76.         """Destroy figure *fig*."""
77.         num = next((manager.num for manager in cls.figs.values()
78.                     if manager.canvas.figure == fig), None)
79.         if num is not None:
80.             cls.destroy(num)
81. 
82.     @classmethod
83.     def destroy_all(cls):
84.         """Destroy all figures."""
85.         # Reimport gc in case the module globals have already been removed
86.         # during interpreter shutdown.
87.         import gc
88.         for manager in list(cls.figs.values()):
89.             manager.canvas.mpl_disconnect(manager._cidgcf)
90.             manager.destroy()
91.         cls.figs.clear()
92.         gc.collect(1)
93. 
94.     @classmethod
95.     def has_fignum(cls, num):
96.         """Return whether figure number *num* exists."""
97.         return num in cls.figs
98. 
99.     @classmethod
100.     def get_all_fig_managers(cls):
101.         """Return a list of figure managers."""
102.         return list(cls.figs.values())
103. 
104.     @classmethod
105.     def get_num_fig_managers(cls):
106.         """Return the number of figures being managed."""
107.         return len(cls.figs)
108. 
109.     @classmethod
110.     def get_active(cls):
111.         """Return the active manager, or *None* if there is no manager."""
112.         return next(reversed(cls.figs.values())) if cls.figs else None
113. 
114.     @classmethod
115.     def _set_new_active_manager(cls, manager):
116.         """Adopt *manager* into pyplot and make it the active manager."""
117.         if not hasattr(manager, "_cidgcf"):
118.             manager._cidgcf = manager.canvas.mpl_connect(
119.                 "button_press_event", lambda event: cls.set_active(manager))
120.         fig = manager.canvas.figure
121.         fig.number = manager.num
122.         label = fig.get_label()
123.         if label:
124.             manager.set_window_title(label)
125.         cls.set_active(manager)
126. 
127.     @classmethod
128.     def set_active(cls, manager):
129.         """Make *manager* the active manager."""
130.         cls.figs[manager.num] = manager
131.         cls.figs.move_to_end(manager.num)
132. 
133.     @classmethod
134.     def draw_all(cls, force=False):
135.         """
136.         Redraw all stale managed figures, or, if *force* is True, all managed
137.         figures.
138.         """
139.         for manager in cls.get_all_fig_managers():
140.             if force or manager.canvas.figure.stale:
141.                 manager.canvas.draw_idle()
142. 
143. 
144. atexit.register(Gcf.destroy_all)


File: lib/matplotlib/pyplot.py
Line number range: 1 - 500
Content:
1. # Note: The first part of this file can be modified in place, but the latter
2. # part is autogenerated by the boilerplate.py script.
3. 
4. """
5. `matplotlib.pyplot` is a state-based interface to matplotlib. It provides
6. an implicit,  MATLAB-like, way of plotting.  It also opens figures on your
7. screen, and acts as the figure GUI manager.
8. 
9. pyplot is mainly intended for interactive plots and simple cases of
10. programmatic plot generation::
11. 
12.     import numpy as np
13.     import matplotlib.pyplot as plt
14. 
15.     x = np.arange(0, 5, 0.1)
16.     y = np.sin(x)
17.     plt.plot(x, y)
18. 
19. The explicit object-oriented API is recommended for complex plots, though
20. pyplot is still usually used to create the figure and often the axes in the
21. figure. See `.pyplot.figure`, `.pyplot.subplots`, and
22. `.pyplot.subplot_mosaic` to create figures, and
23. :doc:`Axes API </api/axes_api>` for the plotting methods on an Axes::
24. 
25.     import numpy as np
26.     import matplotlib.pyplot as plt
27. 
28.     x = np.arange(0, 5, 0.1)
29.     y = np.sin(x)
30.     fig, ax = plt.subplots()
31.     ax.plot(x, y)
32. 
33. 
34. See :ref:`api_interfaces` for an explanation of the tradeoffs between the
35. implicit and explicit interfaces.
36. """
37. 
38. from enum import Enum
39. import functools
40. import importlib
41. import inspect
42. import logging
43. from numbers import Number
44. import re
45. import sys
46. import threading
47. import time
48. 
49. from cycler import cycler
50. import matplotlib
51. import matplotlib.colorbar
52. import matplotlib.image
53. from matplotlib import _api
54. from matplotlib import rcsetup, style
55. from matplotlib import _pylab_helpers, interactive
56. from matplotlib import cbook
57. from matplotlib import _docstring
58. from matplotlib.backend_bases import FigureCanvasBase, MouseButton
59. from matplotlib.figure import Figure, FigureBase, figaspect
60. from matplotlib.gridspec import GridSpec, SubplotSpec
61. from matplotlib import rcParams, rcParamsDefault, get_backend, rcParamsOrig
62. from matplotlib.rcsetup import interactive_bk as _interactive_bk
63. from matplotlib.artist import Artist
64. from matplotlib.axes import Axes, Subplot
65. from matplotlib.projections import PolarAxes
66. from matplotlib import mlab  # for detrend_none, window_hanning
67. from matplotlib.scale import get_scale_names
68. 
69. from matplotlib import cm
70. from matplotlib.cm import _colormaps as colormaps, get_cmap, register_cmap
71. from matplotlib.colors import _color_sequences as color_sequences
72. 
73. import numpy as np
74. 
75. # We may not need the following imports here:
76. from matplotlib.colors import Normalize
77. from matplotlib.lines import Line2D
78. from matplotlib.text import Text, Annotation
79. from matplotlib.patches import Polygon, Rectangle, Circle, Arrow
80. from matplotlib.widgets import Button, Slider, Widget
81. 
82. from .ticker import (
83.     TickHelper, Formatter, FixedFormatter, NullFormatter, FuncFormatter,
84.     FormatStrFormatter, ScalarFormatter, LogFormatter, LogFormatterExponent,
85.     LogFormatterMathtext, Locator, IndexLocator, FixedLocator, NullLocator,
86.     LinearLocator, LogLocator, AutoLocator, MultipleLocator, MaxNLocator)
87. 
88. _log = logging.getLogger(__name__)
89. 
90. 
91. def _copy_docstring_and_deprecators(method, func=None):
92.     if func is None:
93.         return functools.partial(_copy_docstring_and_deprecators, method)
94.     decorators = [_docstring.copy(method)]
95.     # Check whether the definition of *method* includes @_api.rename_parameter
96.     # or @_api.make_keyword_only decorators; if so, propagate them to the
97.     # pyplot wrapper as well.
98.     while getattr(method, "__wrapped__", None) is not None:
99.         decorator = _api.deprecation.DECORATORS.get(method)
100.         if decorator:
101.             decorators.append(decorator)
102.         method = method.__wrapped__
103.     for decorator in decorators[::-1]:
104.         func = decorator(func)
105.     return func
106. 
107. 
108. ## Global ##
109. 
110. 
111. # The state controlled by {,un}install_repl_displayhook().
112. _ReplDisplayHook = Enum("_ReplDisplayHook", ["NONE", "PLAIN", "IPYTHON"])
113. _REPL_DISPLAYHOOK = _ReplDisplayHook.NONE
114. 
115. 
116. def _draw_all_if_interactive():
117.     if matplotlib.is_interactive():
118.         draw_all()
119. 
120. 
121. def install_repl_displayhook():
122.     """
123.     Connect to the display hook of the current shell.
124. 
125.     The display hook gets called when the read-evaluate-print-loop (REPL) of
126.     the shell has finished the execution of a command. We use this callback
127.     to be able to automatically update a figure in interactive mode.
128. 
129.     This works both with IPython and with vanilla python shells.
130.     """
131.     global _REPL_DISPLAYHOOK
132. 
133.     if _REPL_DISPLAYHOOK is _ReplDisplayHook.IPYTHON:
134.         return
135. 
136.     # See if we have IPython hooks around, if so use them.
137.     # Use ``sys.modules.get(name)`` rather than ``name in sys.modules`` as
138.     # entries can also have been explicitly set to None.
139.     mod_ipython = sys.modules.get("IPython")
140.     if not mod_ipython:
141.         _REPL_DISPLAYHOOK = _ReplDisplayHook.PLAIN
142.         return
143.     ip = mod_ipython.get_ipython()
144.     if not ip:
145.         _REPL_DISPLAYHOOK = _ReplDisplayHook.PLAIN
146.         return
147. 
148.     ip.events.register("post_execute", _draw_all_if_interactive)
149.     _REPL_DISPLAYHOOK = _ReplDisplayHook.IPYTHON
150. 
151.     from IPython.core.pylabtools import backend2gui
152.     # trigger IPython's eventloop integration, if available
153.     ipython_gui_name = backend2gui.get(get_backend())
154.     if ipython_gui_name:
155.         ip.enable_gui(ipython_gui_name)
156. 
157. 
158. def uninstall_repl_displayhook():
159.     """Disconnect from the display hook of the current shell."""
160.     global _REPL_DISPLAYHOOK
161.     if _REPL_DISPLAYHOOK is _ReplDisplayHook.IPYTHON:
162.         from IPython import get_ipython
163.         ip = get_ipython()
164.         ip.events.unregister("post_execute", _draw_all_if_interactive)
165.     _REPL_DISPLAYHOOK = _ReplDisplayHook.NONE
166. 
167. 
168. draw_all = _pylab_helpers.Gcf.draw_all
169. 
170. 
171. @_copy_docstring_and_deprecators(matplotlib.set_loglevel)
172. def set_loglevel(*args, **kwargs):  # Ensure this appears in the pyplot docs.
173.     return matplotlib.set_loglevel(*args, **kwargs)
174. 
175. 
176. @_copy_docstring_and_deprecators(Artist.findobj)
177. def findobj(o=None, match=None, include_self=True):
178.     if o is None:
179.         o = gcf()
180.     return o.findobj(match, include_self=include_self)
181. 
182. 
183. def _get_required_interactive_framework(backend_mod):
184.     if not hasattr(backend_mod.FigureCanvas, "required_interactive_framework"):
185.         _api.warn_deprecated(
186.             "3.6", name="Support for FigureCanvases without a "
187.             "required_interactive_framework attribute")
188.         return None
189.     # Inline this once the deprecation elapses.
190.     return backend_mod.FigureCanvas.required_interactive_framework
191. 
192. _backend_mod = None
193. 
194. 
195. def _get_backend_mod():
196.     """
197.     Ensure that a backend is selected and return it.
198. 
199.     This is currently private, but may be made public in the future.
200.     """
201.     if _backend_mod is None:
202.         # Use __getitem__ here to avoid going through the fallback logic (which
203.         # will (re)import pyplot and then call switch_backend if we need to
204.         # resolve the auto sentinel)
205.         switch_backend(dict.__getitem__(rcParams, "backend"))
206.     return _backend_mod
207. 
208. 
209. def switch_backend(newbackend):
210.     """
211.     Close all open figures and set the Matplotlib backend.
212. 
213.     The argument is case-insensitive.  Switching to an interactive backend is
214.     possible only if no event loop for another interactive backend has started.
215.     Switching to and from non-interactive backends is always possible.
216. 
217.     Parameters
218.     ----------
219.     newbackend : str
220.         The name of the backend to use.
221.     """
222.     global _backend_mod
223.     # make sure the init is pulled up so we can assign to it later
224.     import matplotlib.backends
225.     close("all")
226. 
227.     if newbackend is rcsetup._auto_backend_sentinel:
228.         current_framework = cbook._get_running_interactive_framework()
229.         mapping = {'qt': 'qtagg',
230.                    'gtk3': 'gtk3agg',
231.                    'gtk4': 'gtk4agg',
232.                    'wx': 'wxagg',
233.                    'tk': 'tkagg',
234.                    'macosx': 'macosx',
235.                    'headless': 'agg'}
236. 
237.         best_guess = mapping.get(current_framework, None)
238.         if best_guess is not None:
239.             candidates = [best_guess]
240.         else:
241.             candidates = []
242.         candidates += [
243.             "macosx", "qtagg", "gtk4agg", "gtk3agg", "tkagg", "wxagg"]
244. 
245.         # Don't try to fallback on the cairo-based backends as they each have
246.         # an additional dependency (pycairo) over the agg-based backend, and
247.         # are of worse quality.
248.         for candidate in candidates:
249.             try:
250.                 switch_backend(candidate)
251.             except ImportError:
252.                 continue
253.             else:
254.                 rcParamsOrig['backend'] = candidate
255.                 return
256.         else:
257.             # Switching to Agg should always succeed; if it doesn't, let the
258.             # exception propagate out.
259.             switch_backend("agg")
260.             rcParamsOrig["backend"] = "agg"
261.             return
262. 
263.     backend_mod = importlib.import_module(
264.         cbook._backend_module_name(newbackend))
265.     canvas_class = backend_mod.FigureCanvas
266. 
267.     required_framework = _get_required_interactive_framework(backend_mod)
268.     if required_framework is not None:
269.         current_framework = cbook._get_running_interactive_framework()
270.         if (current_framework and required_framework
271.                 and current_framework != required_framework):
272.             raise ImportError(
273.                 "Cannot load backend {!r} which requires the {!r} interactive "
274.                 "framework, as {!r} is currently running".format(
275.                     newbackend, required_framework, current_framework))
276. 
277.     # Load the new_figure_manager(), draw_if_interactive(), and show()
278.     # functions from the backend.
279. 
280.     # Classically, backends can directly export these functions.  This should
281.     # keep working for backcompat.
282.     new_figure_manager = getattr(backend_mod, "new_figure_manager", None)
283.     # draw_if_interactive = getattr(backend_mod, "draw_if_interactive", None)
284.     # show = getattr(backend_mod, "show", None)
285.     # In that classical approach, backends are implemented as modules, but
286.     # "inherit" default method implementations from backend_bases._Backend.
287.     # This is achieved by creating a "class" that inherits from
288.     # backend_bases._Backend and whose body is filled with the module globals.
289.     class backend_mod(matplotlib.backend_bases._Backend):
290.         locals().update(vars(backend_mod))
291. 
292.     # However, the newer approach for defining new_figure_manager (and, in
293.     # the future, draw_if_interactive and show) is to derive them from canvas
294.     # methods.  In that case, also update backend_mod accordingly.
295.     if new_figure_manager is None:
296.         def new_figure_manager_given_figure(num, figure):
297.             return canvas_class.new_manager(figure, num)
298. 
299.         def new_figure_manager(num, *args, FigureClass=Figure, **kwargs):
300.             fig = FigureClass(*args, **kwargs)
301.             return new_figure_manager_given_figure(num, fig)
302. 
303.         backend_mod.new_figure_manager_given_figure = \
304.             new_figure_manager_given_figure
305.         backend_mod.new_figure_manager = new_figure_manager
306. 
307.     _log.debug("Loaded backend %s version %s.",
308.                newbackend, backend_mod.backend_version)
309. 
310.     rcParams['backend'] = rcParamsDefault['backend'] = newbackend
311.     _backend_mod = backend_mod
312.     for func_name in ["new_figure_manager", "draw_if_interactive", "show"]:
313.         globals()[func_name].__signature__ = inspect.signature(
314.             getattr(backend_mod, func_name))
315. 
316.     # Need to keep a global reference to the backend for compatibility reasons.
317.     # See https://github.com/matplotlib/matplotlib/issues/6092
318.     matplotlib.backends.backend = newbackend
319. 
320.     # make sure the repl display hook is installed in case we become
321.     # interactive
322.     install_repl_displayhook()
323. 
324. 
325. def _warn_if_gui_out_of_main_thread():
326.     if (_get_required_interactive_framework(_get_backend_mod())
327.             and threading.current_thread() is not threading.main_thread()):
328.         _api.warn_external(
329.             "Starting a Matplotlib GUI outside of the main thread will likely "
330.             "fail.")
331. 
332. 
333. # This function's signature is rewritten upon backend-load by switch_backend.
334. def new_figure_manager(*args, **kwargs):
335.     """Create a new figure manager instance."""
336.     _warn_if_gui_out_of_main_thread()
337.     return _get_backend_mod().new_figure_manager(*args, **kwargs)
338. 
339. 
340. # This function's signature is rewritten upon backend-load by switch_backend.
341. def draw_if_interactive(*args, **kwargs):
342.     """
343.     Redraw the current figure if in interactive mode.
344. 
345.     .. warning::
346. 
347.         End users will typically not have to call this function because the
348.         the interactive mode takes care of this.
349.     """
350.     return _get_backend_mod().draw_if_interactive(*args, **kwargs)
351. 
352. 
353. # This function's signature is rewritten upon backend-load by switch_backend.
354. def show(*args, **kwargs):
355.     """
356.     Display all open figures.
357. 
358.     Parameters
359.     ----------
360.     block : bool, optional
361.         Whether to wait for all figures to be closed before returning.
362. 
363.         If `True` block and run the GUI main loop until all figure windows
364.         are closed.
365. 
366.         If `False` ensure that all figure windows are displayed and return
367.         immediately.  In this case, you are responsible for ensuring
368.         that the event loop is running to have responsive figures.
369. 
370.         Defaults to True in non-interactive mode and to False in interactive
371.         mode (see `.pyplot.isinteractive`).
372. 
373.     See Also
374.     --------
375.     ion : Enable interactive mode, which shows / updates the figure after
376.           every plotting command, so that calling ``show()`` is not necessary.
377.     ioff : Disable interactive mode.
378.     savefig : Save the figure to an image file instead of showing it on screen.
379. 
380.     Notes
381.     -----
382.     **Saving figures to file and showing a window at the same time**
383. 
384.     If you want an image file as well as a user interface window, use
385.     `.pyplot.savefig` before `.pyplot.show`. At the end of (a blocking)
386.     ``show()`` the figure is closed and thus unregistered from pyplot. Calling
387.     `.pyplot.savefig` afterwards would save a new and thus empty figure. This
388.     limitation of command order does not apply if the show is non-blocking or
389.     if you keep a reference to the figure and use `.Figure.savefig`.
390. 
391.     **Auto-show in jupyter notebooks**
392. 
393.     The jupyter backends (activated via ``%matplotlib inline``,
394.     ``%matplotlib notebook``, or ``%matplotlib widget``), call ``show()`` at
395.     the end of every cell by default. Thus, you usually don't have to call it
396.     explicitly there.
397.     """
398.     _warn_if_gui_out_of_main_thread()
399.     return _get_backend_mod().show(*args, **kwargs)
400. 
401. 
402. def isinteractive():
403.     """
404.     Return whether plots are updated after every plotting command.
405. 
406.     The interactive mode is mainly useful if you build plots from the command
407.     line and want to see the effect of each command while you are building the
408.     figure.
409. 
410.     In interactive mode:
411. 
412.     - newly created figures will be shown immediately;
413.     - figures will automatically redraw on change;
414.     - `.pyplot.show` will not block by default.
415. 
416.     In non-interactive mode:
417. 
418.     - newly created figures and changes to figures will not be reflected until
419.       explicitly asked to be;
420.     - `.pyplot.show` will block by default.
421. 
422.     See Also
423.     --------
424.     ion : Enable interactive mode.
425.     ioff : Disable interactive mode.
426.     show : Show all figures (and maybe block).
427.     pause : Show all figures, and block for a time.
428.     """
429.     return matplotlib.is_interactive()
430. 
431. 
432. class _IoffContext:
433.     """
434.     Context manager for `.ioff`.
435. 
436.     The state is changed in ``__init__()`` instead of ``__enter__()``. The
437.     latter is a no-op. This allows using `.ioff` both as a function and
438.     as a context.
439.     """
440. 
441.     def __init__(self):
442.         self.wasinteractive = isinteractive()
443.         matplotlib.interactive(False)
444.         uninstall_repl_displayhook()
445. 
446.     def __enter__(self):
447.         pass
448. 
449.     def __exit__(self, exc_type, exc_value, traceback):
450.         if self.wasinteractive:
451.             matplotlib.interactive(True)
452.             install_repl_displayhook()
453.         else:
454.             matplotlib.interactive(False)
455.             uninstall_repl_displayhook()
456. 
457. 
458. class _IonContext:
459.     """
460.     Context manager for `.ion`.
461. 
462.     The state is changed in ``__init__()`` instead of ``__enter__()``. The
463.     latter is a no-op. This allows using `.ion` both as a function and
464.     as a context.
465.     """
466. 
467.     def __init__(self):
468.         self.wasinteractive = isinteractive()
469.         matplotlib.interactive(True)
470.         install_repl_displayhook()
471. 
472.     def __enter__(self):
473.         pass
474. 
475.     def __exit__(self, exc_type, exc_value, traceback):
476.         if not self.wasinteractive:
477.             matplotlib.interactive(False)
478.             uninstall_repl_displayhook()
479.         else:
480.             matplotlib.interactive(True)
481.             install_repl_displayhook()
482. 
483. 
484. def ioff():
485.     """
486.     Disable interactive mode.
487. 
488.     See `.pyplot.isinteractive` for more details.
489. 
490.     See Also
491.     --------
492.     ion : Enable interactive mode.
493.     isinteractive : Whether interactive mode is enabled.
494.     show : Show all figures (and maybe block).
495.     pause : Show all figures, and block for a time.
496. 
497.     Notes
498.     -----
499.     For a temporary change, this can be used as a context manager::
500.


File: lib/matplotlib/rcsetup.py
Line number range: 1 - 500
Content:
1. """
2. The rcsetup module contains the validation code for customization using
3. Matplotlib's rc settings.
4. 
5. Each rc setting is assigned a function used to validate any attempted changes
6. to that setting.  The validation functions are defined in the rcsetup module,
7. and are used to construct the rcParams global object which stores the settings
8. and is referenced throughout Matplotlib.
9. 
10. The default values of the rc settings are set in the default matplotlibrc file.
11. Any additions or deletions to the parameter set listed here should also be
12. propagated to the :file:`matplotlibrc.template` in Matplotlib's root source
13. directory.
14. """
15. 
16. import ast
17. from functools import lru_cache, reduce
18. from numbers import Number
19. import operator
20. import os
21. import re
22. 
23. import numpy as np
24. 
25. from matplotlib import _api, cbook
26. from matplotlib.cbook import ls_mapper
27. from matplotlib.colors import Colormap, is_color_like
28. from matplotlib._fontconfig_pattern import parse_fontconfig_pattern
29. from matplotlib._enums import JoinStyle, CapStyle
30. 
31. # Don't let the original cycler collide with our validating cycler
32. from cycler import Cycler, cycler as ccycler
33. 
34. 
35. # The capitalized forms are needed for ipython at present; this may
36. # change for later versions.
37. interactive_bk = [
38.     'GTK3Agg', 'GTK3Cairo', 'GTK4Agg', 'GTK4Cairo',
39.     'MacOSX',
40.     'nbAgg',
41.     'QtAgg', 'QtCairo', 'Qt5Agg', 'Qt5Cairo',
42.     'TkAgg', 'TkCairo',
43.     'WebAgg',
44.     'WX', 'WXAgg', 'WXCairo',
45. ]
46. non_interactive_bk = ['agg', 'cairo',
47.                       'pdf', 'pgf', 'ps', 'svg', 'template']
48. all_backends = interactive_bk + non_interactive_bk
49. 
50. 
51. class ValidateInStrings:
52.     def __init__(self, key, valid, ignorecase=False, *,
53.                  _deprecated_since=None):
54.         """*valid* is a list of legal strings."""
55.         self.key = key
56.         self.ignorecase = ignorecase
57.         self._deprecated_since = _deprecated_since
58. 
59.         def func(s):
60.             if ignorecase:
61.                 return s.lower()
62.             else:
63.                 return s
64.         self.valid = {func(k): k for k in valid}
65. 
66.     def __call__(self, s):
67.         if self._deprecated_since:
68.             name, = (k for k, v in globals().items() if v is self)
69.             _api.warn_deprecated(
70.                 self._deprecated_since, name=name, obj_type="function")
71.         if self.ignorecase:
72.             s = s.lower()
73.         if s in self.valid:
74.             return self.valid[s]
75.         msg = (f"{s!r} is not a valid value for {self.key}; supported values "
76.                f"are {[*self.valid.values()]}")
77.         if (isinstance(s, str)
78.                 and (s.startswith('"') and s.endswith('"')
79.                      or s.startswith("'") and s.endswith("'"))
80.                 and s[1:-1] in self.valid):
81.             msg += "; remove quotes surrounding your string"
82.         raise ValueError(msg)
83. 
84. 
85. @lru_cache()
86. def _listify_validator(scalar_validator, allow_stringlist=False, *,
87.                        n=None, doc=None):
88.     def f(s):
89.         if isinstance(s, str):
90.             try:
91.                 val = [scalar_validator(v.strip()) for v in s.split(',')
92.                        if v.strip()]
93.             except Exception:
94.                 if allow_stringlist:
95.                     # Sometimes, a list of colors might be a single string
96.                     # of single-letter colornames. So give that a shot.
97.                     val = [scalar_validator(v.strip()) for v in s if v.strip()]
98.                 else:
99.                     raise
100.         # Allow any ordered sequence type -- generators, np.ndarray, pd.Series
101.         # -- but not sets, whose iteration order is non-deterministic.
102.         elif np.iterable(s) and not isinstance(s, (set, frozenset)):
103.             # The condition on this list comprehension will preserve the
104.             # behavior of filtering out any empty strings (behavior was
105.             # from the original validate_stringlist()), while allowing
106.             # any non-string/text scalar values such as numbers and arrays.
107.             val = [scalar_validator(v) for v in s
108.                    if not isinstance(v, str) or v]
109.         else:
110.             raise ValueError(
111.                 f"Expected str or other non-set iterable, but got {s}")
112.         if n is not None and len(val) != n:
113.             raise ValueError(
114.                 f"Expected {n} values, but there are {len(val)} values in {s}")
115.         return val
116. 
117.     try:
118.         f.__name__ = "{}list".format(scalar_validator.__name__)
119.     except AttributeError:  # class instance.
120.         f.__name__ = "{}List".format(type(scalar_validator).__name__)
121.     f.__qualname__ = f.__qualname__.rsplit(".", 1)[0] + "." + f.__name__
122.     f.__doc__ = doc if doc is not None else scalar_validator.__doc__
123.     return f
124. 
125. 
126. def validate_any(s):
127.     return s
128. validate_anylist = _listify_validator(validate_any)
129. 
130. 
131. def _validate_date(s):
132.     try:
133.         np.datetime64(s)
134.         return s
135.     except ValueError:
136.         raise ValueError(
137.             f'{s!r} should be a string that can be parsed by numpy.datetime64')
138. 
139. 
140. def validate_bool(b):
141.     """Convert b to ``bool`` or raise."""
142.     if isinstance(b, str):
143.         b = b.lower()
144.     if b in ('t', 'y', 'yes', 'on', 'true', '1', 1, True):
145.         return True
146.     elif b in ('f', 'n', 'no', 'off', 'false', '0', 0, False):
147.         return False
148.     else:
149.         raise ValueError(f'Cannot convert {b!r} to bool')
150. 
151. 
152. def validate_axisbelow(s):
153.     try:
154.         return validate_bool(s)
155.     except ValueError:
156.         if isinstance(s, str):
157.             if s == 'line':
158.                 return 'line'
159.     raise ValueError(f'{s!r} cannot be interpreted as'
160.                      ' True, False, or "line"')
161. 
162. 
163. def validate_dpi(s):
164.     """Confirm s is string 'figure' or convert s to float or raise."""
165.     if s == 'figure':
166.         return s
167.     try:
168.         return float(s)
169.     except ValueError as e:
170.         raise ValueError(f'{s!r} is not string "figure" and '
171.                          f'could not convert {s!r} to float') from e
172. 
173. 
174. def _make_type_validator(cls, *, allow_none=False):
175.     """
176.     Return a validator that converts inputs to *cls* or raises (and possibly
177.     allows ``None`` as well).
178.     """
179. 
180.     def validator(s):
181.         if (allow_none and
182.                 (s is None or isinstance(s, str) and s.lower() == "none")):
183.             return None
184.         if cls is str and not isinstance(s, str):
185.             _api.warn_deprecated(
186.                 "3.5", message="Support for setting an rcParam that expects a "
187.                 "str value to a non-str value is deprecated since %(since)s "
188.                 "and support will be removed %(removal)s.")
189.         try:
190.             return cls(s)
191.         except (TypeError, ValueError) as e:
192.             raise ValueError(
193.                 f'Could not convert {s!r} to {cls.__name__}') from e
194. 
195.     validator.__name__ = f"validate_{cls.__name__}"
196.     if allow_none:
197.         validator.__name__ += "_or_None"
198.     validator.__qualname__ = (
199.         validator.__qualname__.rsplit(".", 1)[0] + "." + validator.__name__)
200.     return validator
201. 
202. 
203. validate_string = _make_type_validator(str)
204. validate_string_or_None = _make_type_validator(str, allow_none=True)
205. validate_stringlist = _listify_validator(
206.     validate_string, doc='return a list of strings')
207. validate_int = _make_type_validator(int)
208. validate_int_or_None = _make_type_validator(int, allow_none=True)
209. validate_float = _make_type_validator(float)
210. validate_float_or_None = _make_type_validator(float, allow_none=True)
211. validate_floatlist = _listify_validator(
212.     validate_float, doc='return a list of floats')
213. 
214. 
215. def _validate_pathlike(s):
216.     if isinstance(s, (str, os.PathLike)):
217.         # Store value as str because savefig.directory needs to distinguish
218.         # between "" (cwd) and "." (cwd, but gets updated by user selections).
219.         return os.fsdecode(s)
220.     else:
221.         return validate_string(s)  # Emit deprecation warning.
222. 
223. 
224. def validate_fonttype(s):
225.     """
226.     Confirm that this is a Postscript or PDF font type that we know how to
227.     convert to.
228.     """
229.     fonttypes = {'type3':    3,
230.                  'truetype': 42}
231.     try:
232.         fonttype = validate_int(s)
233.     except ValueError:
234.         try:
235.             return fonttypes[s.lower()]
236.         except KeyError as e:
237.             raise ValueError('Supported Postscript/PDF font types are %s'
238.                              % list(fonttypes)) from e
239.     else:
240.         if fonttype not in fonttypes.values():
241.             raise ValueError(
242.                 'Supported Postscript/PDF font types are %s' %
243.                 list(fonttypes.values()))
244.         return fonttype
245. 
246. 
247. _validate_standard_backends = ValidateInStrings(
248.     'backend', all_backends, ignorecase=True)
249. _auto_backend_sentinel = object()
250. 
251. 
252. def validate_backend(s):
253.     backend = (
254.         s if s is _auto_backend_sentinel or s.startswith("module://")
255.         else _validate_standard_backends(s))
256.     return backend
257. 
258. 
259. def _validate_toolbar(s):
260.     s = ValidateInStrings(
261.         'toolbar', ['None', 'toolbar2', 'toolmanager'], ignorecase=True)(s)
262.     if s == 'toolmanager':
263.         _api.warn_external(
264.             "Treat the new Tool classes introduced in v1.5 as experimental "
265.             "for now; the API and rcParam may change in future versions.")
266.     return s
267. 
268. 
269. def validate_color_or_inherit(s):
270.     """Return a valid color arg."""
271.     if cbook._str_equal(s, 'inherit'):
272.         return s
273.     return validate_color(s)
274. 
275. 
276. def validate_color_or_auto(s):
277.     if cbook._str_equal(s, 'auto'):
278.         return s
279.     return validate_color(s)
280. 
281. 
282. def validate_color_for_prop_cycle(s):
283.     # N-th color cycle syntax can't go into the color cycle.
284.     if isinstance(s, str) and re.match("^C[0-9]$", s):
285.         raise ValueError(f"Cannot put cycle reference ({s!r}) in prop_cycler")
286.     return validate_color(s)
287. 
288. 
289. def _validate_color_or_linecolor(s):
290.     if cbook._str_equal(s, 'linecolor'):
291.         return s
292.     elif cbook._str_equal(s, 'mfc') or cbook._str_equal(s, 'markerfacecolor'):
293.         return 'markerfacecolor'
294.     elif cbook._str_equal(s, 'mec') or cbook._str_equal(s, 'markeredgecolor'):
295.         return 'markeredgecolor'
296.     elif s is None:
297.         return None
298.     elif isinstance(s, str) and len(s) == 6 or len(s) == 8:
299.         stmp = '#' + s
300.         if is_color_like(stmp):
301.             return stmp
302.         if s.lower() == 'none':
303.             return None
304.     elif is_color_like(s):
305.         return s
306. 
307.     raise ValueError(f'{s!r} does not look like a color arg')
308. 
309. 
310. def validate_color(s):
311.     """Return a valid color arg."""
312.     if isinstance(s, str):
313.         if s.lower() == 'none':
314.             return 'none'
315.         if len(s) == 6 or len(s) == 8:
316.             stmp = '#' + s
317.             if is_color_like(stmp):
318.                 return stmp
319. 
320.     if is_color_like(s):
321.         return s
322. 
323.     # If it is still valid, it must be a tuple (as a string from matplotlibrc).
324.     try:
325.         color = ast.literal_eval(s)
326.     except (SyntaxError, ValueError):
327.         pass
328.     else:
329.         if is_color_like(color):
330.             return color
331. 
332.     raise ValueError(f'{s!r} does not look like a color arg')
333. 
334. 
335. validate_colorlist = _listify_validator(
336.     validate_color, allow_stringlist=True, doc='return a list of colorspecs')
337. 
338. 
339. def _validate_cmap(s):
340.     _api.check_isinstance((str, Colormap), cmap=s)
341.     return s
342. 
343. 
344. def validate_aspect(s):
345.     if s in ('auto', 'equal'):
346.         return s
347.     try:
348.         return float(s)
349.     except ValueError as e:
350.         raise ValueError('not a valid aspect specification') from e
351. 
352. 
353. def validate_fontsize_None(s):
354.     if s is None or s == 'None':
355.         return None
356.     else:
357.         return validate_fontsize(s)
358. 
359. 
360. def validate_fontsize(s):
361.     fontsizes = ['xx-small', 'x-small', 'small', 'medium', 'large',
362.                  'x-large', 'xx-large', 'smaller', 'larger']
363.     if isinstance(s, str):
364.         s = s.lower()
365.     if s in fontsizes:
366.         return s
367.     try:
368.         return float(s)
369.     except ValueError as e:
370.         raise ValueError("%s is not a valid font size. Valid font sizes "
371.                          "are %s." % (s, ", ".join(fontsizes))) from e
372. 
373. 
374. validate_fontsizelist = _listify_validator(validate_fontsize)
375. 
376. 
377. def validate_fontweight(s):
378.     weights = [
379.         'ultralight', 'light', 'normal', 'regular', 'book', 'medium', 'roman',
380.         'semibold', 'demibold', 'demi', 'bold', 'heavy', 'extra bold', 'black']
381.     # Note: Historically, weights have been case-sensitive in Matplotlib
382.     if s in weights:
383.         return s
384.     try:
385.         return int(s)
386.     except (ValueError, TypeError) as e:
387.         raise ValueError(f'{s} is not a valid font weight.') from e
388. 
389. 
390. def validate_fontstretch(s):
391.     stretchvalues = [
392.         'ultra-condensed', 'extra-condensed', 'condensed', 'semi-condensed',
393.         'normal', 'semi-expanded', 'expanded', 'extra-expanded',
394.         'ultra-expanded']
395.     # Note: Historically, stretchvalues have been case-sensitive in Matplotlib
396.     if s in stretchvalues:
397.         return s
398.     try:
399.         return int(s)
400.     except (ValueError, TypeError) as e:
401.         raise ValueError(f'{s} is not a valid font stretch.') from e
402. 
403. 
404. def validate_font_properties(s):
405.     parse_fontconfig_pattern(s)
406.     return s
407. 
408. 
409. def _validate_mathtext_fallback(s):
410.     _fallback_fonts = ['cm', 'stix', 'stixsans']
411.     if isinstance(s, str):
412.         s = s.lower()
413.     if s is None or s == 'none':
414.         return None
415.     elif s.lower() in _fallback_fonts:
416.         return s
417.     else:
418.         raise ValueError(
419.             f"{s} is not a valid fallback font name. Valid fallback font "
420.             f"names are {','.join(_fallback_fonts)}. Passing 'None' will turn "
421.             "fallback off.")
422. 
423. 
424. def validate_whiskers(s):
425.     try:
426.         return _listify_validator(validate_float, n=2)(s)
427.     except (TypeError, ValueError):
428.         try:
429.             return float(s)
430.         except ValueError as e:
431.             raise ValueError("Not a valid whisker value [float, "
432.                              "(float, float)]") from e
433. 
434. 
435. def validate_ps_distiller(s):
436.     if isinstance(s, str):
437.         s = s.lower()
438.     if s in ('none', None, 'false', False):
439.         return None
440.     else:
441.         return ValidateInStrings('ps.usedistiller', ['ghostscript', 'xpdf'])(s)
442. 
443. 
444. # A validator dedicated to the named line styles, based on the items in
445. # ls_mapper, and a list of possible strings read from Line2D.set_linestyle
446. _validate_named_linestyle = ValidateInStrings(
447.     'linestyle',
448.     [*ls_mapper.keys(), *ls_mapper.values(), 'None', 'none', ' ', ''],
449.     ignorecase=True)
450. 
451. 
452. def _validate_linestyle(ls):
453.     """
454.     A validator for all possible line styles, the named ones *and*
455.     the on-off ink sequences.
456.     """
457.     if isinstance(ls, str):
458.         try:  # Look first for a valid named line style, like '--' or 'solid'.
459.             return _validate_named_linestyle(ls)
460.         except ValueError:
461.             pass
462.         try:
463.             ls = ast.literal_eval(ls)  # Parsing matplotlibrc.
464.         except (SyntaxError, ValueError):
465.             pass  # Will error with the ValueError at the end.
466. 
467.     def _is_iterable_not_string_like(x):
468.         # Explicitly exclude bytes/bytearrays so that they are not
469.         # nonsensically interpreted as sequences of numbers (codepoints).
470.         return np.iterable(x) and not isinstance(x, (str, bytes, bytearray))
471. 
472.     if _is_iterable_not_string_like(ls):
473.         if len(ls) == 2 and _is_iterable_not_string_like(ls[1]):
474.             # (offset, (on, off, on, off, ...))
475.             offset, onoff = ls
476.         else:
477.             # For backcompat: (on, off, on, off, ...); the offset is implicit.
478.             offset = 0
479.             onoff = ls
480. 
481.         if (isinstance(offset, Number)
482.                 and len(onoff) % 2 == 0
483.                 and all(isinstance(elem, Number) for elem in onoff)):
484.             return (offset, onoff)
485. 
486.     raise ValueError(f"linestyle {ls!r} is not a valid on-off ink sequence.")
487. 
488. 
489. validate_fillstyle = ValidateInStrings(
490.     'markers.fillstyle', ['full', 'left', 'right', 'bottom', 'top', 'none'])
491. 
492. 
493. validate_fillstylelist = _listify_validator(validate_fillstyle)
494. 
495. 
496. def validate_markevery(s):
497.     """
498.     Validate the markevery property of a Line2D object.
499. 
500.     Parameters

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-24 03:09:40,064 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="1. Query requirement analysis:\n   - The user explicitly requested the full content of `lib/matplotlib/__init__.py`.\n\n2. Extended relevance:\n   - This file is the main package file for matplotlib, containing initial setup, version information, and configuration directory functions. The user's purpose of tracing figure creation and backend selection starts here.", relative_path='lib/matplotlib/__init__.py', start_line=1, end_line=500), ContextOutput(reasoning="1. Query requirement analysis:\n   - The user explicitly requested the full content of `lib/matplotlib/_pylab_helpers.py`.\n\n2. Extended relevance:\n   - This file contains the `Gcf` class, which manages figure managers. This is critical to the user's purpose of understanding how figures are registered and managed within pyplot.", relative_path='lib/matplotlib/_pylab_helpers.py', start_line=1, end_line=144), ContextOutput(reasoning="1. Query requirement analysis:\n   - The user explicitly requested the full content of `lib/matplotlib/pyplot.py`.\n\n2. Extended relevance:\n   - This file is the core of the state-based `pyplot` interface. It includes functions for creating figures (`figure`, `subplots`), managing backends (`switch_backend`), and showing plots (`show`). This is directly relevant to the user's purpose of tracing figure creation and backend logic.", relative_path='lib/matplotlib/pyplot.py', start_line=1, end_line=500), ContextOutput(reasoning="1. Query requirement analysis:\n   - The user explicitly requested the full content of `lib/matplotlib/rcsetup.py`.\n\n2. Extended relevance:\n   - This file contains the validation logic for `rcParams`, including the `validate_backend` function. The user's purpose mentions focusing on the backend selection logic, making this file essential.", relative_path='lib/matplotlib/rcsetup.py', start_line=1, end_line=500)]
2025-12-24 03:09:40,068 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 4 contexts to memory for query: Please provide the full content of `lib/matplotlib/__init__.py`, `lib/matplotlib/pyplot.py`, `lib/matplotlib/_pylab_helpers.py`, and `lib/matplotlib/rcsetup.py`.
2025-12-24 03:09:40,068 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-24 03:09:40,068 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-24 03:09:40,069 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 4 new contexts to 0 existing contexts
2025-12-24 03:09:40,069 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 4 total contexts (removed 0 duplicates)
2025-12-24 03:09:40,070 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
matplotlib
├── .appveyor.yml
├── .circleci
|   ├── config.yml
|   └── deploy-docs.sh
├── .git_archival.txt
├── .github
|   ├── CONTRIBUTING.md
|   ├── FUNDING.yml
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.yml
|   |   ├── config.yml
|   |   ├── documentation.yml
|   |   ├── feature_request.yml
|   |   └── maintenance.yml
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── codecov.yml
|   ├── dependabot.yml
|   └── workflows
|       ├── cibuildwheel.yml
|       ├── circleci.yml
|       ├── clean_pr.yml
|       ├── nightlies.yml
|       ├── pr_welcome.yml
|       ├── reviewdog.yml
|       └── tests.yml
├── .lgtm.yml
├── .meeseeksdev.yml
├── .pre-commit-config.yaml
├── CODE_OF_CONDUCT.md
├── INSTALL.rst
├── LICENSE
├── README.rst
├── SECURITY.md
├── azure-pipelines.yml
├── ci
|   ├── check_wheel_licenses.py
|   └── codespell-ignore-words.txt
├── doc
|   ├── README.txt
|   ├── _static
|   |   ├── fa
|   |   ├── markers
|   |   ├── mpl.css
|   |   └── zenodo_cache
|   ├── _templates
|   |   ├── autofunctions.rst
|   |   ├── automodule.rst
|   |   ├── autosummary.rst
|   |   ├── cheatsheet_sidebar.html
|   |   ├── donate_sidebar.html
|   |   ├── function.rst
|   |   ├── pagesource.html
|   |   ├── search.html
|   |   ├── sidebar_announcement.html
|   |   └── sidebar_versions.html
|   ├── api
|   |   ├── _api_api.rst
|   |   ├── _enums_api.rst
|   |   ├── afm_api.rst
|   |   ├── animation_api.rst
|   |   ├── artist_api.rst
|   |   ├── axes_api.rst
|   |   ├── axis_api.rst
|   |   ├── backend_agg_api.rst
|   |   ├── backend_bases_api.rst
|   |   ├── backend_cairo_api.rst
|   |   ├── backend_gtk3_api.rst
|   |   ├── backend_gtk4_api.rst
|   |   ├── backend_managers_api.rst
|   |   ├── backend_mixed_api.rst
|   |   ├── backend_nbagg_api.rst
|   |   ├── backend_pdf_api.rst
|   |   ├── backend_pgf_api.rst
|   |   ├── backend_ps_api.rst
|   |   ├── backend_qt_api.rst
|   |   ├── backend_svg_api.rst
|   |   ├── backend_template_api.rst
|   |   ├── backend_tk_api.rst
|   |   ├── backend_tools_api.rst
|   |   ├── backend_webagg_api.rst
|   |   ├── backend_wx_api.rst
|   |   ├── bezier_api.rst
|   |   ├── blocking_input_api.rst
|   |   ├── category_api.rst
|   |   ├── cbook_api.rst
|   |   ├── cm_api.rst
|   |   ├── collections_api.rst
|   |   ├── colorbar_api.rst
|   |   ├── colors_api.rst
|   |   ├── container_api.rst
|   |   ├── contour_api.rst
|   |   ├── dates_api.rst
|   |   ├── docstring_api.rst
|   |   ├── dviread.rst
|   |   ├── figure_api.rst
|   |   ├── font_manager_api.rst
|   |   ├── fontconfig_pattern_api.rst
|   |   ├── gridspec_api.rst
|   |   ├── hatch_api.rst
|   |   ├── image_api.rst
|   |   ├── index.rst
|   |   ├── index_backend_api.rst
|   |   ├── layout_engine_api.rst
|   |   ├── legend_api.rst
|   |   ├── legend_handler_api.rst
|   |   ├── lines_api.rst
|   |   ├── markers_api.rst
|   |   ├── mathtext_api.rst
|   |   ├── matplotlib_configuration_api.rst
|   |   ├── mlab_api.rst
|   |   ├── next_api_changes
|   |   |   ├── README.rst
|   |   |   ├── behavior
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 19214-DS.rst
|   |   |   |   ├── 19368-DS.rst
|   |   |   |   ├── 20426-JK.rst
|   |   |   |   ├── 20715-JKS.rst
|   |   |   |   ├── 21026-DS.rst
|   |   |   |   ├── 21042-AL.rst
|   |   |   |   ├── 21238-AL.rst
|   |   |   |   ├── 21983-AL.rst
|   |   |   |   ├── 22013-AL.rst
|   |   |   |   ├── 22063-SR.rst
|   |   |   |   ├── 22204-AL.rst
|   |   |   |   ├── 22229-TAC.rst
|   |   |   |   ├── 22485-TH.rst
|   |   |   |   ├── 22567-IT.rst
|   |   |   |   ├── 22639-RA.rst
|   |   |   |   ├── 22691-JMK.rst
|   |   |   |   ├── 22745-JMK.rst
|   |   |   |   ├── 23031-AL.rst
|   |   |   |   ├── 23170-JMK.rst
|   |   |   |   ├── 23188-JMK.rst
|   |   |   |   └── 23270-AL.rst
|   |   |   ├── deprecations
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 20071-AL.rst
|   |   |   |   ├── 20839-EP.rst
|   |   |   |   ├── 20995-AL.rst
|   |   |   |   ├── 21056-AL.rst
|   |   |   |   ├── 21187-AL.rst
|   |   |   |   ├── 21356-AL.rst
|   |   |   |   ├── 21412-AL.rst
|   |   |   |   ├── 21425-AL.rst
|   |   |   |   ├── 21584-AL.rst
|   |   |   |   ├── 21962-AL.rst
|   |   |   |   ├── 21965-AL.rst
|   |   |   |   ├── 21981-AL.rst
|   |   |   |   ├── 21982-AL.rst
|   |   |   |   ├── 21992-AL.rst
|   |   |   |   ├── 21995-AL.rst
|   |   |   |   ├── 22021-AL.rst
|   |   |   |   ├── 22025-AL.rst
|   |   |   |   ├── 22050-AL.rst
|   |   |   |   ├── 22051-AL.rst
|   |   |   |   ├── 22084-SS.rst
|   |   |   |   ├── 22097-AL.rst
|   |   |   |   ├── 22098-AL.rst
|   |   |   |   ├── 22123-TH.rst
|   |   |   |   ├── 22133-OG.rst
|   |   |   |   ├── 22134-OG.rst
|   |   |   |   ├── 22148-OG.rst
|   |   |   |   ├── 22167-EP.rst
|   |   |   |   ├── 22245-AL.rst
|   |   |   |   ├── 22268-OG.rst
|   |   |   |   ├── 22298-GL.rst
|   |   |   |   ├── 22317-AL.rst
|   |   |   |   ├── 22323-GL.rst
|   |   |   |   ├── 22345-JK.rst
|   |   |   |   ├── 22415-AL.rst
|   |   |   |   ├── 22418-AL.rst
|   |   |   |   ├── 22421-AL.rst
|   |   |   |   ├── 22422-AL.rst
|   |   |   |   ├── 22490-AL.rst
|   |   |   |   ├── 22503-AL.rst
|   |   |   |   ├── 22509-AL.rst
|   |   |   |   ├── 22539-AL.rst
|   |   |   |   ├── 22547-AL.rst
|   |   |   |   ├── 22554-AL.rst
|   |   |   |   ├── 22697-OG.rst
|   |   |   |   ├── 22725-AL.rst
|   |   |   |   ├── 22797-OG.rst
|   |   |   |   ├── 22813-GL.rst
|   |   |   |   ├── 22883-AL.rst
|   |   |   |   ├── 22885-AL.rst
|   |   |   |   ├── 23014-OG.rst
|   |   |   |   ├── 23045-OG.rst
|   |   |   |   ├── 23081-OG.rst
|   |   |   |   ├── 23166-ES.rst
|   |   |   |   ├── 23190-OG.rst
|   |   |   |   ├── 23232-TH.rst
|   |   |   |   ├── 23289-AL.rst
|   |   |   |   ├── 23302-TH.rst
|   |   |   |   └── ZZZZZ-AL.rst
|   |   |   ├── development
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 21415-AL.rst
|   |   |   |   ├── 22205-ES.rst
|   |   |   |   └── 22550-AL.rst
|   |   |   └── removals
|   |   |       ├── 00001-ABC.rst
|   |   |       ├── 00001-DS.rst
|   |   |       ├── 20990-AL.rst
|   |   |       ├── 21395-AL.rst
|   |   |       ├── 21591-AL.rst
|   |   |       ├── 21980-CC.rst
|   |   |       ├── 22081-AL.rst
|   |   |       ├── 22107-OG.rst
|   |   |       ├── 22365-OG.rst
|   |   |       ├── 22465-AL.rst
|   |   |       ├── 22486-OG.rst
|   |   |       ├── 22514-OG.rst
|   |   |       ├── 22516-OG.rst
|   |   |       ├── 22738-JL.rst
|   |   |       ├── 22886-OG.rst
|   |   |       ├── 22952-TH.rst
|   |   |       ├── 23076-GL.rst
|   |   |       ├── 23077-GL.rst
|   |   |       ├── 23078-GL.rst
|   |   |       ├── 23079-GL.rst
|   |   |       ├── 23093-GL.rst
|   |   |       └── 23237-AL.rst
|   |   ├── next_api_changes.rst
|   |   ├── offsetbox_api.rst
|   |   ├── patches_api.rst
|   |   ├── path_api.rst
|   |   ├── patheffects_api.rst
|   |   ├── prev_api_changes
|   |   |   ├── api_changes_0.40.rst
|   |   |   ├── api_changes_0.42.rst
|   |   |   ├── api_changes_0.50.rst
|   |   |   ├── api_changes_0.54.3.rst
|   |   |   ├── api_changes_0.54.rst
|   |   |   ├── api_changes_0.60.rst
|   |   |   ├── api_changes_0.61.rst
|   |   |   ├── api_changes_0.63.rst
|   |   |   ├── api_changes_0.65.1.rst
|   |   |   ├── api_changes_0.65.rst
|   |   |   ├── api_changes_0.70.rst
|   |   |   ├── api_changes_0.71.rst
|   |   |   ├── api_changes_0.72.rst
|   |   |   ├── api_changes_0.73.rst
|   |   |   ├── api_changes_0.80.rst
|   |   |   ├── api_changes_0.81.rst
|   |   |   ├── api_changes_0.82.rst
|   |   |   ├── api_changes_0.83.rst
|   |   |   ├── api_changes_0.84.rst
|   |   |   ├── api_changes_0.85.rst
|   |   |   ├── api_changes_0.86.rst
|   |   |   ├── api_changes_0.87.7.rst
|   |   |   ├── api_changes_0.90.0.rst
|   |   |   ├── api_changes_0.90.1.rst
|   |   |   ├── api_changes_0.91.0.rst
|   |   |   ├── api_changes_0.91.2.rst
|   |   |   ├── api_changes_0.98.0.rst
|   |   |   ├── api_changes_0.98.1.rst
|   |   |   ├── api_changes_0.98.x.rst
|   |   |   ├── api_changes_0.99.rst
|   |   |   ├── api_changes_0.99.x.rst
|   |   |   ├── api_changes_1.1.x.rst
|   |   |   ├── api_changes_1.2.x.rst
|   |   |   ├── api_changes_1.3.x.rst
|   |   |   ├── api_changes_1.4.x.rst
|   |   |   ├── api_changes_1.5.0.rst
|   |   |   ├── api_changes_1.5.2.rst
|   |   |   ├── api_changes_1.5.3.rst
|   |   |   ├── api_changes_2.0.0.rst
|   |   |   ├── api_changes_2.0.1.rst
|   |   |   ├── api_changes_2.1.0.rst
|   |   |   ├── api_changes_2.1.1.rst
|   |   |   ├── api_changes_2.1.2.rst
|   |   |   ├── api_changes_2.2.0.rst
|   |   |   ├── api_changes_3.0.0.rst
|   |   |   ├── api_changes_3.0.1.rst
|   |   |   ├── api_changes_3.1.0.rst
|   |   |   ├── api_changes_3.1.1.rst
|   |   |   ├── api_changes_3.2.0
|   |   |   |   ├── behavior.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.2.0.rst
|   |   |   ├── api_changes_3.3.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.3.0.rst
|   |   |   ├── api_changes_3.3.1.rst
|   |   |   ├── api_changes_3.4.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.4.0.rst
|   |   |   ├── api_changes_3.4.2.rst
|   |   |   ├── api_changes_3.5.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.5.0.rst
|   |   |   └── api_changes_3.5.2.rst
|   |   ├── projections_api.rst
|   |   ├── pyplot_summary.rst
|   |   ├── quiver_api.rst
|   |   ├── rcsetup_api.rst
|   |   ├── sankey_api.rst
|   |   ├── scale_api.rst
|   |   ├── sphinxext_mathmpl_api.rst
|   |   ├── sphinxext_plot_directive_api.rst
|   |   ├── spines_api.rst
|   |   ├── style_api.rst
|   |   ├── table_api.rst
|   |   ├── testing_api.rst
|   |   ├── texmanager_api.rst
|   |   ├── text_api.rst
|   |   ├── textpath_api.rst
|   |   ├── ticker_api.rst
|   |   ├── tight_bbox_api.rst
|   |   ├── tight_layout_api.rst
|   |   ├── toolkits
|   |   |   ├── axes_grid.rst
|   |   |   ├── axes_grid1.rst
|   |   |   ├── axisartist.rst
|   |   |   ├── mplot3d
|   |   |   |   └── faq.rst
|   |   |   └── mplot3d.rst
|   |   ├── transformations.rst
|   |   ├── tri_api.rst
|   |   ├── type1font.rst
|   |   ├── units_api.rst
|   |   └── widgets_api.rst
|   ├── conf.py
|   ├── devel
|   |   ├── MEP
|   |   |   ├── MEP08.rst
|   |   |   ├── MEP09.rst
|   |   |   ├── MEP10.rst
|   |   |   ├── MEP11.rst
|   |   |   ├── MEP12.rst
|   |   |   ├── MEP13.rst
|   |   |   ├── MEP14.rst
|   |   |   ├── MEP15.rst
|   |   |   ├── MEP19.rst
|   |   |   ├── MEP21.rst
|   |   |   ├── MEP22.rst
|   |   |   ├── MEP23.rst
|   |   |   ├── MEP24.rst
|   |   |   ├── MEP25.rst
|   |   |   ├── MEP26.rst
|   |   |   ├── MEP27.rst
|   |   |   ├── MEP28.rst
|   |   |   ├── MEP29.rst
|   |   |   ├── README.rst
|   |   |   ├── index.rst
|   |   |   └── template.rst
|   |   ├── README.txt
|   |   ├── coding_guide.rst
|   |   ├── color_changes.rst
|   |   ├── contributing.rst
|   |   ├── dependencies.rst
|   |   ├── development_setup.rst
|   |   ├── documenting_mpl.rst
|   |   ├── gitwash
|   |   |   ├── configure_git.rst
|   |   |   ├── development_workflow.rst
|   |   |   ├── dot2_dot3.rst
|   |   |   ├── following_latest.rst
|   |   |   ├── forking_hell.rst
|   |   |   ├── git_development.rst
|   |   |   ├── git_install.rst
|   |   |   ├── git_intro.rst
|   |   |   ├── git_resources.rst
|   |   |   ├── index.rst
|   |   |   ├── maintainer_workflow.rst
|   |   |   ├── patching.rst
|   |   |   └── set_up_fork.rst
|   |   ├── index.rst
|   |   ├── license.rst
|   |   ├── min_dep_policy.rst
|   |   ├── release_guide.rst
|   |   ├── style_guide.rst
|   |   ├── testing.rst
|   |   └── triage.rst
|   ├── index.rst
|   ├── sphinxext
|   |   ├── __init__.py
|   |   ├── custom_roles.py
|   |   ├── gallery_order.py
|   |   ├── github.py
|   |   ├── math_symbol_table.py
|   |   ├── missing_references.py
|   |   ├── mock_gui_toolkits.py
|   |   ├── redirect_from.py
|   |   └── skip_deprecated.py
|   ├── thirdpartypackages
|   |   └── index.rst
|   └── users
|       ├── explain
|       |   ├── api_interfaces.rst
|       |   ├── backends.rst
|       |   ├── event_handling.rst
|       |   ├── fonts.rst
|       |   ├── index.rst
|       |   ├── interactive.rst
|       |   ├── interactive_guide.rst
|       |   └── performance.rst
|       ├── faq
|       |   ├── environment_variables_faq.rst
|       |   ├── howto_faq.rst
|       |   ├── index.rst
|       |   └── troubleshooting_faq.rst
|       ├── generate_credits.py
|       ├── getting_started
|       |   └── index.rst
|       ├── github_stats.rst
|       ├── index.rst
|       ├── installing
|       |   └── index.rst
|       ├── next_whats_new
|       |   ├── 3d_plot_focal_length.rst
|       |   ├── 3d_plot_roll_angle.rst
|       |   ├── README.rst
|       |   ├── asinh_scale.rst
|       |   ├── color_support_for_math_to_image.rst
|       |   ├── custom_cap_widths.rst
|       |   ├── double_quotes_matplolibrc.rst
|       |   ├── extending_MarkerStyle.rst
|       |   ├── inset_axes_improvements.rst
|       |   ├── layout_engine.rst
|       |   ├── list_font_names.rst
|       |   ├── marker_none.rst
|       |   ├── min_macos_version.rst
|       |   ├── modify_stairs_fill_edge_behaviour.rst
|       |   ├── no_broken_streamlines.rst
|       |   ├── polygon_selector_box.rst
|       |   ├── polygon_vert_setter.rst
|       |   ├── rectangle_patch_rotation.rst
|       |   ├── rename_ncol_keyword_in_legend.rst
|       |   ├── selector_improvement.rst
|       |   ├── snap_selector.rst
|       |   ├── striped_lines.rst
|       |   ├── url_active_areas_rotate.rst
|       |   ├── use_contourpy.rst
|       |   └── windows_arm64.rst
|       ├── next_whats_new.rst
|       ├── prev_whats_new
|       |   ├── changelog.rst
|       |   ├── dflt_style_changes.rst
|       |   ├── github_stats_3.0.0.rst
|       |   ├── github_stats_3.0.1.rst
|       |   ├── github_stats_3.0.2.rst
|       |   ├── github_stats_3.0.3.rst
|       |   ├── github_stats_3.1.0.rst
|       |   ├── github_stats_3.1.1.rst
|       |   ├── github_stats_3.1.2.rst
|       |   ├── github_stats_3.1.3.rst
|       |   ├── github_stats_3.2.0.rst
|       |   ├── github_stats_3.2.1.rst
|       |   ├── github_stats_3.2.2.rst
|       |   ├── github_stats_3.3.0.rst
|       |   ├── github_stats_3.3.1.rst
|       |   ├── github_stats_3.3.2.rst
|       |   ├── github_stats_3.3.3.rst
|       |   ├── github_stats_3.3.4.rst
|       |   ├── github_stats_3.4.0.rst
|       |   ├── github_stats_3.4.1.rst
|       |   ├── github_stats_3.4.2.rst
|       |   ├── github_stats_3.4.3.rst
|       |   ├── github_stats_3.5.0.rst
|       |   ├── github_stats_3.5.1.rst
|       |   ├── whats_new_0.98.4.rst
|       |   ├── whats_new_0.99.rst
|       |   ├── whats_new_1.0.rst
|       |   ├── whats_new_1.1.rst
|       |   ├── whats_new_1.2.2.rst
|       |   ├── whats_new_1.2.rst
|       |   ├── whats_new_1.3.rst
|       |   ├── whats_new_1.4.rst
|       |   ├── whats_new_1.5.rst
|       |   ├── whats_new_2.0.0.rst
|       |   ├── whats_new_2.1.0.rst
|       |   ├── whats_new_2.2.rst
|       |   ├── whats_new_3.0.rst
|       |   ├── whats_new_3.1.0.rst
|       |   ├── whats_new_3.2.0.rst
|       |   ├── whats_new_3.3.0.rst
|       |   ├── whats_new_3.4.0.rst
|       |   ├── whats_new_3.5.0.rst
|       |   └── whats_new_3.5.2.rst
|       ├── project
|       |   ├── citing.rst
|       |   ├── credits.rst
|       |   ├── history.rst
|       |   ├── index.rst
|       |   └── license.rst
|       ├── release_notes.rst
|       ├── release_notes_next.rst
|       └── resources
|           └── index.rst
├── environment.yml
├── examples
|   ├── README.txt
|   ├── animation
|   |   ├── README.txt
|   |   ├── animate_decay.py
|   |   ├── animated_histogram.py
|   |   ├── animation_demo.py
|   |   ├── bayes_update.py
|   |   ├── double_pendulum.py
|   |   ├── dynamic_image.py
|   |   ├── frame_grabbing_sgskip.py
|   |   ├── pause_resume.py
|   |   ├── rain.py
|   |   ├── random_walk.py
|   |   ├── simple_anim.py
|   |   ├── strip_chart.py
|   |   └── unchained.py
|   ├── axes_grid1
|   |   ├── README.txt
|   |   ├── demo_anchored_direction_arrows.py
|   |   ├── demo_axes_divider.py
|   |   ├── demo_axes_grid.py
|   |   ├── demo_axes_grid2.py
|   |   ├── demo_axes_hbox_divider.py
|   |   ├── demo_axes_rgb.py
|   |   ├── demo_colorbar_of_inset_axes.py
|   |   ├── demo_colorbar_with_axes_divider.py
|   |   ├── demo_colorbar_with_inset_locator.py
|   |   ├── demo_edge_colorbar.py
|   |   ├── demo_fixed_size_axes.py
|   |   ├── demo_imagegrid_aspect.py
|   |   ├── inset_locator_demo.py
|   |   ├── inset_locator_demo2.py
|   |   ├── make_room_for_ylabel_using_axesgrid.py
|   |   ├── parasite_simple.py
|   |   ├── parasite_simple2.py
|   |   ├── scatter_hist_locatable_axes.py
|   |   ├── simple_anchored_artists.py
|   |   ├── simple_axes_divider1.py
|   |   ├── simple_axes_divider3.py
|   |   ├── simple_axesgrid.py
|   |   ├── simple_axesgrid2.py
|   |   ├── simple_axisline4.py
|   |   └── simple_colorbar.py
|   ├── axisartist
|   |   ├── README.txt
|   |   ├── axis_direction.py
|   |   ├── demo_axis_direction.py
|   |   ├── demo_axisline_style.py
|   |   ├── demo_curvelinear_grid.py
|   |   ├── demo_curvelinear_grid2.py
|   |   ├── demo_floating_axes.py
|   |   ├── demo_floating_axis.py
|   |   ├── demo_parasite_axes.py
|   |   ├── demo_parasite_axes2.py
|   |   ├── demo_ticklabel_alignment.py
|   |   ├── demo_ticklabel_direction.py
|   |   ├── simple_axis_direction01.py
|   |   ├── simple_axis_direction03.py
|   |   ├── simple_axis_pad.py
|   |   ├── simple_axisartist1.py
|   |   ├── simple_axisline.py
|   |   └── simple_axisline3.py
|   ├── color
|   |   ├── README.txt
|   |   ├── color_by_yvalue.py
|   |   ├── color_cycle_default.py
|   |   ├── color_demo.py
|   |   ├── colorbar_basics.py
|   |   ├── colormap_reference.py
|   |   ├── custom_cmap.py
|   |   └── named_colors.py
|   ├── event_handling
|   |   ├── README.txt
|   |   ├── close_event.py
|   |   ├── coords_demo.py
|   |   ├── cursor_demo.py
|   |   ├── data_browser.py
|   |   ├── figure_axes_enter_leave.py
|   |   ├── ginput_manual_clabel_sgskip.py
|   |   ├── image_slices_viewer.py
|   |   ├── keypress_demo.py
|   |   ├── lasso_demo.py
|   |   ├── legend_picking.py
|   |   ├── looking_glass.py
|   |   ├── path_editor.py
|   |   ├── pick_event_demo.py
|   |   ├── pick_event_demo2.py
|   |   ├── poly_editor.py
|   |   ├── pong_sgskip.py
|   |   ├── resample.py
|   |   ├── timers.py
|   |   ├── trifinder_event_demo.py
|   |   ├── viewlims.py
|   |   └── zoom_window.py
|   ├── images_contours_and_fields
|   |   ├── README.txt
|   |   ├── affine_image.py
|   |   ├── barb_demo.py
|   |   ├── barcode_demo.py
|   |   ├── colormap_interactive_adjustment.py
|   |   ├── colormap_normalizations.py
|   |   ├── colormap_normalizations_symlognorm.py
|   |   ├── contour_corner_mask.py
|   |   ├── contour_demo.py
|   |   ├── contour_image.py
|   |   ├── contour_label_demo.py
|   |   ├── contourf_demo.py
|   |   ├── contourf_hatching.py
|   |   ├── contourf_log.py
|   |   ├── contours_in_optimization_demo.py
|   |   ├── demo_bboximage.py
|   |   ├── figimage_demo.py
|   |   ├── image_annotated_heatmap.py
|   |   ├── image_antialiasing.py
|   |   ├── image_clip_path.py
|   |   ├── image_demo.py
|   |   ├── image_masked.py
|   |   ├── image_nonuniform.py
|   |   ├── image_transparency_blend.py
|   |   ├── image_zcoord.py
|   |   ├── interpolation_methods.py
|   |   ├── irregulardatagrid.py
|   |   ├── layer_images.py
|   |   ├── matshow.py
|   |   ├── multi_image.py
|   |   ├── pcolor_demo.py
|   |   ├── pcolormesh_grids.py
|   |   ├── pcolormesh_levels.py
|   |   ├── plot_streamplot.py
|   |   ├── quadmesh_demo.py
|   |   ├── quiver_demo.py
|   |   ├── quiver_simple_demo.py
|   |   ├── shading_example.py
|   |   ├── specgram_demo.py
|   |   ├── spy_demos.py
|   |   ├── tricontour_demo.py
|   |   ├── tricontour_smooth_delaunay.py
|   |   ├── tricontour_smooth_user.py
|   |   ├── trigradient_demo.py
|   |   ├── triinterp_demo.py
|   |   ├── tripcolor_demo.py
|   |   ├── triplot_demo.py
|   |   └── watermark_image.py
|   ├── lines_bars_and_markers
|   |   ├── README.txt
|   |   ├── bar_label_demo.py
|   |   ├── bar_stacked.py
|   |   ├── barchart.py
|   |   ├── barh.py
|   |   ├── broken_barh.py
|   |   ├── capstyle.py
|   |   ├── categorical_variables.py
|   |   ├── cohere.py
|   |   ├── csd_demo.py
|   |   ├── curve_error_band.py
|   |   ├── errorbar_limits_simple.py
|   |   ├── errorbar_subsample.py
|   |   ├── eventcollection_demo.py
|   |   ├── eventplot_demo.py
|   |   ├── fill.py
|   |   ├── fill_between_alpha.py
|   |   ├── fill_between_demo.py
|   |   ├── fill_betweenx_demo.py
|   |   ├── filled_step.py
|   |   ├── gradient_bar.py
|   |   ├── hat_graph.py
|   |   ├── horizontal_barchart_distribution.py
|   |   ├── joinstyle.py
|   |   ├── line_demo_dash_control.py
|   |   ├── lines_with_ticks_demo.py
|   |   ├── linestyles.py
|   |   ├── marker_reference.py
|   |   ├── markevery_demo.py
|   |   ├── masked_demo.py
|   |   ├── multicolored_line.py
|   |   ├── multivariate_marker_plot.py
|   |   ├── psd_demo.py
|   |   ├── scatter_custom_symbol.py
|   |   ├── scatter_demo2.py
|   |   ├── scatter_hist.py
|   |   ├── scatter_masked.py
|   |   ├── scatter_star_poly.py
|   |   ├── scatter_with_legend.py
|   |   ├── simple_plot.py
|   |   ├── span_regions.py
|   |   ├── spectrum_demo.py
|   |   ├── stackplot_demo.py
|   |   ├── stairs_demo.py
|   |   ├── stem_plot.py
|   |   ├── step_demo.py
|   |   ├── timeline.py
|   |   ├── vline_hline_demo.py
|   |   └── xcorr_acorr_demo.py
|   ├── misc
|   |   ├── README.txt
|   |   ├── anchored_artists.py
|   |   ├── bbox_intersect.py
|   |   ├── contour_manual.py
|   |   ├── coords_report.py
|   |   ├── custom_projection.py
|   |   ├── customize_rc.py
|   |   ├── demo_agg_filter.py
|   |   ├── demo_ribbon_box.py
|   |   ├── fill_spiral.py
|   |   ├── findobj_demo.py
|   |   ├── font_indexing.py
|   |   ├── ftface_props.py
|   |   ├── histogram_path.py
|   |   ├── hyperlinks_sgskip.py
|   |   ├── image_thumbnail_sgskip.py
|   |   ├── keyword_plotting.py
|   |   ├── logos2.py
|   |   ├── multipage_pdf.py
|   |   ├── multiprocess_sgskip.py
|   |   ├── packed_bubbles.py
|   |   ├── patheffect_demo.py
|   |   ├── print_stdout_sgskip.py
|   |   ├── pythonic_matplotlib.py
|   |   ├── rasterization_demo.py
|   |   ├── set_and_get.py
|   |   ├── svg_filter_line.py
|   |   ├── svg_filter_pie.py
|   |   ├── table_demo.py
|   |   ├── tickedstroke_demo.py
|   |   ├── transoffset.py
|   |   └── zorder_demo.py
|   ├── mplot3d
|   |   ├── 2dcollections3d.py
|   |   ├── 3d_bars.py
|   |   ├── README.txt
|   |   ├── bars3d.py
|   |   ├── box3d.py
|   |   ├── contour3d.py
|   |   ├── contour3d_2.py
|   |   ├── contour3d_3.py
|   |   ├── contourf3d.py
|   |   ├── contourf3d_2.py
|   |   ├── custom_shaded_3d_surface.py
|   |   ├── errorbar3d.py
|   |   ├── hist3d.py
|   |   ├── lines3d.py
|   |   ├── lorenz_attractor.py
|   |   ├── mixed_subplots.py
|   |   ├── offset.py
|   |   ├── pathpatch3d.py
|   |   ├── polys3d.py
|   |   ├── projections.py
|   |   ├── quiver3d.py
|   |   ├── rotate_axes3d_sgskip.py
|   |   ├── scatter3d.py
|   |   ├── stem3d_demo.py
|   |   ├── subplot3d.py
|   |   ├── surface3d.py
|   |   ├── surface3d_2.py
|   |   ├── surface3d_3.py
|   |   ├── surface3d_radial.py
|   |   ├── text3d.py
|   |   ├── tricontour3d.py
|   |   ├── tricontourf3d.py
|   |   ├── trisurf3d.py
|   |   ├── trisurf3d_2.py
|   |   ├── voxels.py
|   |   ├── voxels_numpy_logo.py
|   |   ├── voxels_rgb.py
|   |   ├── voxels_torus.py
|   |   ├── wire3d.py
|   |   ├── wire3d_animation_sgskip.py
|   |   └── wire3d_zero_stride.py
|   ├── pie_and_polar_charts
|   |   ├── README.txt
|   |   ├── bar_of_pie.py
|   |   ├── nested_pie.py
|   |   ├── pie_and_donut_labels.py
|   |   ├── pie_demo2.py
|   |   ├── pie_features.py
|   |   ├── polar_bar.py
|   |   ├── polar_demo.py
|   |   ├── polar_legend.py
|   |   └── polar_scatter.py
|   ├── pyplots
|   |   ├── README.txt
|   |   ├── align_ylabels.py
|   |   ├── annotate_transform.py
|   |   ├── annotation_basic.py
|   |   ├── annotation_polar.py
|   |   ├── auto_subplots_adjust.py
|   |   ├── axline.py
|   |   ├── boxplot_demo_pyplot.py
|   |   ├── dollar_ticks.py
|   |   ├── fig_axes_customize_simple.py
|   |   ├── fig_axes_labels_simple.py
|   |   ├── fig_x.py
|   |   ├── pyplot_formatstr.py
|   |   ├── pyplot_mathtext.py
|   |   ├── pyplot_simple.py
|   |   ├── pyplot_text.py
|   |   ├── pyplot_three.py
|   |   ├── pyplot_two_subplots.py
|   |   ├── text_commands.py
|   |   └── text_layout.py
|   ├── scales
|   |   ├── README.txt
|   |   ├── asinh_demo.py
|   |   ├── aspect_loglog.py
|   |   ├── custom_scale.py
|   |   ├── log_bar.py
|   |   ├── log_demo.py
|   |   ├── logit_demo.py
|   |   ├── power_norm.py
|   |   ├── scales.py
|   |   ├── semilogx_demo.py
|   |   └── symlog_demo.py
|   ├── shapes_and_collections
|   |   ├── README.txt
|   |   ├── arrow_guide.py
|   |   ├── artist_reference.py
|   |   ├── collections.py
|   |   ├── compound_path.py
|   |   ├── dolphin.py
|   |   ├── donut.py
|   |   ├── ellipse_collection.py
|   |   ├── ellipse_demo.py
|   |   ├── fancybox_demo.py
|   |   ├── hatch_demo.py
|   |   ├── hatch_style_reference.py
|   |   ├── line_collection.py
|   |   ├── patch_collection.py
|   |   ├── path_patch.py
|   |   ├── quad_bezier.py
|   |   └── scatter.py
|   ├── showcase
|   |   ├── README.txt
|   |   ├── anatomy.py
|   |   ├── bachelors_degrees_by_gender.py
|   |   ├── firefox.py
|   |   ├── integral.py
|   |   ├── mandelbrot.py
|   |   └── xkcd.py
|   ├── specialty_plots
|   |   ├── README.txt
|   |   ├── advanced_hillshading.py
|   |   ├── anscombe.py
|   |   ├── hinton_demo.py
|   |   ├── leftventricle_bulleye.py
|   |   ├── mri_demo.py
|   |   ├── mri_with_eeg.py
|   |   ├── radar_chart.py
|   |   ├── sankey_basics.py
|   |   ├── sankey_links.py
|   |   ├── sankey_rankine.py
|   |   ├── skewt.py
|   |   └── topographic_hillshading.py
|   ├── spines
|   |   ├── README.txt
|   |   ├── centered_spines_with_arrows.py
|   |   ├── multiple_yaxis_with_spines.py
|   |   ├── spine_placement_demo.py
|   |   ├── spines.py
|   |   ├── spines_bounds.py
|   |   └── spines_dropped.py
|   ├── statistics
|   |   ├── README.txt
|   |   ├── barchart_demo.py
|   |   ├── boxplot.py
|   |   ├── boxplot_color.py
|   |   ├── boxplot_demo.py
|   |   ├── boxplot_vs_violin.py
|   |   ├── bxp.py
|   |   ├── confidence_ellipse.py
|   |   ├── customized_violin.py
|   |   ├── errorbar.py
|   |   ├── errorbar_features.py
|   |   ├── errorbar_limits.py
|   |   ├── errorbars_and_boxes.py
|   |   ├── hexbin_demo.py
|   |   ├── hist.py
|   |   ├── histogram_cumulative.py
|   |   ├── histogram_features.py
|   |   ├── histogram_histtypes.py
|   |   ├── histogram_multihist.py
|   |   ├── multiple_histograms_side_by_side.py
|   |   ├── time_series_histogram.py
|   |   └── violinplot.py
|   ├── style_sheets
|   |   ├── README.txt
|   |   ├── bmh.py
|   |   ├── dark_background.py
|   |   ├── fivethirtyeight.py
|   |   ├── ggplot.py
|   |   ├── grayscale.py
|   |   ├── plot_solarizedlight2.py
|   |   └── style_sheets_reference.py
|   ├── subplots_axes_and_figures
|   |   ├── README.txt
|   |   ├── align_labels_demo.py
|   |   ├── axes_box_aspect.py
|   |   ├── axes_demo.py
|   |   ├── axes_margins.py
|   |   ├── axes_props.py
|   |   ├── axes_zoom_effect.py
|   |   ├── axhspan_demo.py
|   |   ├── axis_equal_demo.py
|   |   ├── axis_labels_demo.py
|   |   ├── broken_axis.py
|   |   ├── colorbar_placement.py
|   |   ├── custom_figure_class.py
|   |   ├── demo_constrained_layout.py
|   |   ├── demo_tight_layout.py
|   |   ├── fahrenheit_celsius_scales.py
|   |   ├── figure_size_units.py
|   |   ├── figure_title.py
|   |   ├── ganged_plots.py
|   |   ├── geo_demo.py
|   |   ├── gridspec_and_subplots.py
|   |   ├── gridspec_multicolumn.py
|   |   ├── gridspec_nested.py
|   |   ├── invert_axes.py
|   |   ├── multiple_figs_demo.py
|   |   ├── secondary_axis.py
|   |   ├── share_axis_lims_views.py
|   |   ├── shared_axis_demo.py
|   |   ├── subfigures.py
|   |   ├── subplot.py
|   |   ├── subplots_adjust.py
|   |   ├── subplots_demo.py
|   |   ├── two_scales.py
|   |   └── zoom_inset_axes.py
|   ├── text_labels_and_annotations
|   |   ├── README.txt
|   |   ├── accented_text.py
|   |   ├── angle_annotation.py
|   |   ├── annotation_demo.py
|   |   ├── arrow_demo.py
|   |   ├── autowrap.py
|   |   ├── custom_legends.py
|   |   ├── date.py
|   |   ├── demo_annotation_box.py
|   |   ├── demo_text_path.py
|   |   ├── demo_text_rotation_mode.py
|   |   ├── dfrac_demo.py
|   |   ├── engineering_formatter.py
|   |   ├── fancyarrow_demo.py
|   |   ├── fancytextbox_demo.py
|   |   ├── figlegend_demo.py
|   |   ├── font_family_rc.py
|   |   ├── font_file.py
|   |   ├── font_table.py
|   |   ├── fonts_demo.py
|   |   ├── fonts_demo_kw.py
|   |   ├── label_subplots.py
|   |   ├── legend.py
|   |   ├── legend_demo.py
|   |   ├── line_with_text.py
|   |   ├── mathtext_asarray.py
|   |   ├── mathtext_demo.py
|   |   ├── mathtext_examples.py
|   |   ├── mathtext_fontfamily_example.py
|   |   ├── multiline.py
|   |   ├── placing_text_boxes.py
|   |   ├── rainbow_text.py
|   |   ├── stix_fonts_demo.py
|   |   ├── tex_demo.py
|   |   ├── text_alignment.py
|   |   ├── text_fontdict.py
|   |   ├── text_rotation.py
|   |   ├── text_rotation_relative_to_line.py
|   |   ├── titles_demo.py
|   |   ├── unicode_minus.py
|   |   ├── usetex_baseline_test.py
|   |   ├── usetex_fonteffects.py
|   |   └── watermark_text.py
|   ├── ticks
|   |   ├── README.txt
|   |   ├── auto_ticks.py
|   |   ├── centered_ticklabels.py
|   |   ├── colorbar_tick_labelling_demo.py
|   |   ├── custom_ticker1.py
|   |   ├── date_concise_formatter.py
|   |   ├── date_demo_convert.py
|   |   ├── date_demo_rrule.py
|   |   ├── date_formatters_locators.py
|   |   ├── date_index_formatter.py
|   |   ├── date_precision_and_epochs.py
|   |   ├── major_minor_demo.py
|   |   ├── scalarformatter.py
|   |   ├── tick-formatters.py
|   |   ├── tick-locators.py
|   |   ├── tick_label_right.py
|   |   ├── tick_labels_from_values.py
|   |   ├── tick_xlabel_top.py
|   |   ├── ticklabels_rotation.py
|   |   └── ticks_too_many.py
|   ├── units
|   |   ├── README.txt
|   |   ├── annotate_with_units.py
|   |   ├── artist_tests.py
|   |   ├── bar_demo2.py
|   |   ├── bar_unit_demo.py
|   |   ├── basic_units.py
|   |   ├── ellipse_with_units.py
|   |   ├── evans_test.py
|   |   ├── radian_demo.py
|   |   ├── units_sample.py
|   |   └── units_scatter.py
|   ├── user_interfaces
|   |   ├── README.txt
|   |   ├── canvasagg.py
|   |   ├── embedding_in_gtk3_panzoom_sgskip.py
|   |   ├── embedding_in_gtk3_sgskip.py
|   |   ├── embedding_in_gtk4_panzoom_sgskip.py
|   |   ├── embedding_in_gtk4_sgskip.py
|   |   ├── embedding_in_qt_sgskip.py
|   |   ├── embedding_in_tk_sgskip.py
|   |   ├── embedding_in_wx2_sgskip.py
|   |   ├── embedding_in_wx3_sgskip.py
|   |   ├── embedding_in_wx4_sgskip.py
|   |   ├── embedding_in_wx5_sgskip.py
|   |   ├── embedding_webagg_sgskip.py
|   |   ├── fourier_demo_wx_sgskip.py
|   |   ├── gtk3_spreadsheet_sgskip.py
|   |   ├── gtk4_spreadsheet_sgskip.py
|   |   ├── mathtext_wx_sgskip.py
|   |   ├── mpl_with_glade3_sgskip.py
|   |   ├── pylab_with_gtk3_sgskip.py
|   |   ├── pylab_with_gtk4_sgskip.py
|   |   ├── svg_histogram_sgskip.py
|   |   ├── svg_tooltip_sgskip.py
|   |   ├── toolmanager_sgskip.py
|   |   ├── web_application_server_sgskip.py
|   |   └── wxcursor_demo_sgskip.py
|   ├── userdemo
|   |   ├── README.txt
|   |   ├── anchored_box04.py
|   |   ├── annotate_explain.py
|   |   ├── annotate_simple01.py
|   |   ├── annotate_simple02.py
|   |   ├── annotate_simple03.py
|   |   ├── annotate_simple04.py
|   |   ├── annotate_simple_coord01.py
|   |   ├── annotate_simple_coord02.py
|   |   ├── annotate_simple_coord03.py
|   |   ├── annotate_text_arrow.py
|   |   ├── connect_simple01.py
|   |   ├── connectionstyle_demo.py
|   |   ├── custom_boxstyle01.py
|   |   ├── demo_gridspec01.py
|   |   ├── demo_gridspec03.py
|   |   ├── demo_gridspec06.py
|   |   ├── pgf_fonts.py
|   |   ├── pgf_preamble_sgskip.py
|   |   ├── pgf_texsystem.py
|   |   ├── simple_annotate01.py
|   |   ├── simple_legend01.py
|   |   └── simple_legend02.py
|   └── widgets
|       ├── README.txt
|       ├── annotated_cursor.py
|       ├── buttons.py
|       ├── check_buttons.py
|       ├── cursor.py
|       ├── lasso_selector_demo_sgskip.py
|       ├── menu.py
|       ├── mouse_cursor.py
|       ├── multicursor.py
|       ├── polygon_selector_demo.py
|       ├── polygon_selector_simple.py
|       ├── radio_buttons.py
|       ├── range_slider.py
|       ├── rectangle_selector.py
|       ├── slider_demo.py
|       ├── slider_snap_demo.py
|       ├── span_selector.py
|       └── textbox.py
├── extern
|   ├── agg24-svn
|   |   ├── include
|   |   |   ├── ctrl
|   |   |   ├── platform
|   |   |   |   ├── mac
|   |   |   |   └── win32
|   |   |   └── util
|   |   └── src
|   |       ├── agg_arc.cpp
|   |       ├── agg_arrowhead.cpp
|   |       ├── agg_bezier_arc.cpp
|   |       ├── agg_bspline.cpp
|   |       ├── agg_color_rgba.cpp
|   |       ├── agg_curves.cpp
|   |       ├── agg_embedded_raster_fonts.cpp
|   |       ├── agg_gsv_text.cpp
|   |       ├── agg_image_filters.cpp
|   |       ├── agg_line_aa_basics.cpp
|   |       ├── agg_line_profile_aa.cpp
|   |       ├── agg_rounded_rect.cpp
|   |       ├── agg_sqrt_tables.cpp
|   |       ├── agg_trans_affine.cpp
|   |       ├── agg_trans_double_path.cpp
|   |       ├── agg_trans_single_path.cpp
|   |       ├── agg_trans_warp_magnifier.cpp
|   |       ├── agg_vcgen_bspline.cpp
|   |       ├── agg_vcgen_contour.cpp
|   |       ├── agg_vcgen_dash.cpp
|   |       ├── agg_vcgen_markers_term.cpp
|   |       ├── agg_vcgen_smooth_poly1.cpp
|   |       ├── agg_vcgen_stroke.cpp
|   |       ├── agg_vpgen_clip_polygon.cpp
|   |       ├── agg_vpgen_clip_polyline.cpp
|   |       ├── agg_vpgen_segmentator.cpp
|   |       ├── ctrl
|   |       |   ├── agg_bezier_ctrl.cpp
|   |       |   ├── agg_cbox_ctrl.cpp
|   |       |   ├── agg_gamma_ctrl.cpp
|   |       |   ├── agg_gamma_spline.cpp
|   |       |   ├── agg_polygon_ctrl.cpp
|   |       |   ├── agg_rbox_ctrl.cpp
|   |       |   ├── agg_scale_ctrl.cpp
|   |       |   ├── agg_slider_ctrl.cpp
|   |       |   └── agg_spline_ctrl.cpp
|   |       └── platform
|   |           ├── AmigaOS
|   |           ├── BeOS
|   |           ├── X11
|   |           ├── mac
|   |           ├── sdl
|   |           └── win32
|   └── ttconv
|       ├── pprdrv_tt.cpp
|       ├── pprdrv_tt2.cpp
|       └── ttutil.cpp
├── lib
|   ├── matplotlib
|   |   ├── __init__.py
|   |   ├── _afm.py
|   |   ├── _animation_data.py
|   |   ├── _api
|   |   |   ├── __init__.py
|   |   |   └── deprecation.py
|   |   ├── _blocking_input.py
|   |   ├── _cm.py
|   |   ├── _cm_listed.py
|   |   ├── _color_data.py
|   |   ├── _constrained_layout.py
|   |   ├── _docstring.py
|   |   ├── _enums.py
|   |   ├── _fontconfig_pattern.py
|   |   ├── _internal_utils.py
|   |   ├── _layoutgrid.py
|   |   ├── _mathtext.py
|   |   ├── _mathtext_data.py
|   |   ├── _pylab_helpers.py
|   |   ├── _text_helpers.py
|   |   ├── _tight_bbox.py
|   |   ├── _tight_layout.py
|   |   ├── _type1font.py
|   |   ├── afm.py
|   |   ├── animation.py
|   |   ├── artist.py
|   |   ├── axes
|   |   |   ├── __init__.py
|   |   |   ├── _axes.py
|   |   |   ├── _base.py
|   |   |   ├── _secondary_axes.py
|   |   |   └── _subplots.py
|   |   ├── axis.py
|   |   ├── backend_bases.py
|   |   ├── backend_managers.py
|   |   ├── backend_tools.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── _backend_gtk.py
|   |   |   ├── _backend_pdf_ps.py
|   |   |   ├── _backend_tk.py
|   |   |   ├── backend_agg.py
|   |   |   ├── backend_cairo.py
|   |   |   ├── backend_gtk3.py
|   |   |   ├── backend_gtk3agg.py
|   |   |   ├── backend_gtk3cairo.py
|   |   |   ├── backend_gtk4.py
|   |   |   ├── backend_gtk4agg.py
|   |   |   ├── backend_gtk4cairo.py
|   |   |   ├── backend_macosx.py
|   |   |   ├── backend_mixed.py
|   |   |   ├── backend_nbagg.py
|   |   |   ├── backend_pdf.py
|   |   |   ├── backend_pgf.py
|   |   |   ├── backend_ps.py
|   |   |   ├── backend_qt.py
|   |   |   ├── backend_qt5.py
|   |   |   ├── backend_qt5agg.py
|   |   |   ├── backend_qt5cairo.py
|   |   |   ├── backend_qtagg.py
|   |   |   ├── backend_qtcairo.py
|   |   |   ├── backend_svg.py
|   |   |   ├── backend_template.py
|   |   |   ├── backend_tkagg.py
|   |   |   ├── backend_tkcairo.py
|   |   |   ├── backend_webagg.py
|   |   |   ├── backend_webagg_core.py
|   |   |   ├── backend_wx.py
|   |   |   ├── backend_wxagg.py
|   |   |   ├── backend_wxcairo.py
|   |   |   ├── qt_compat.py
|   |   |   ├── qt_editor
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _formlayout.py
|   |   |   |   └── figureoptions.py
|   |   |   └── web_backend
|   |   |       ├── .eslintrc.js
|   |   |       ├── all_figures.html
|   |   |       ├── css
|   |   |       ├── ipython_inline_figure.html
|   |   |       ├── js
|   |   |       └── single_figure.html
|   |   ├── bezier.py
|   |   ├── blocking_input.py
|   |   ├── category.py
|   |   ├── cbook
|   |   |   └── __init__.py
|   |   ├── cm.py
|   |   ├── collections.py
|   |   ├── colorbar.py
|   |   ├── colors.py
|   |   ├── container.py
|   |   ├── contour.py
|   |   ├── dates.py
|   |   ├── docstring.py
|   |   ├── dviread.py
|   |   ├── figure.py
|   |   ├── font_manager.py
|   |   ├── fontconfig_pattern.py
|   |   ├── gridspec.py
|   |   ├── hatch.py
|   |   ├── image.py
|   |   ├── layout_engine.py
|   |   ├── legend.py
|   |   ├── legend_handler.py
|   |   ├── lines.py
|   |   ├── markers.py
|   |   ├── mathtext.py
|   |   ├── mlab.py
|   |   ├── mpl-data
|   |   |   ├── fonts
|   |   |   |   ├── afm
|   |   |   |   ├── pdfcorefonts
|   |   |   |   └── ttf
|   |   |   ├── images
|   |   |   ├── plot_directive
|   |   |   |   └── plot_directive.css
|   |   |   ├── sample_data
|   |   |   |   ├── README.txt
|   |   |   |   └── axes_grid
|   |   |   └── stylelib
|   |   ├── offsetbox.py
|   |   ├── patches.py
|   |   ├── path.py
|   |   ├── patheffects.py
|   |   ├── projections
|   |   |   ├── __init__.py
|   |   |   ├── geo.py
|   |   |   └── polar.py
|   |   ├── pylab.py
|   |   ├── pyplot.py
|   |   ├── quiver.py
|   |   ├── rcsetup.py
|   |   ├── sankey.py
|   |   ├── scale.py
|   |   ├── sphinxext
|   |   |   ├── __init__.py
|   |   |   ├── mathmpl.py
|   |   |   └── plot_directive.py
|   |   ├── spines.py
|   |   ├── stackplot.py
|   |   ├── streamplot.py
|   |   ├── style
|   |   |   ├── __init__.py
|   |   |   └── core.py
|   |   ├── table.py
|   |   ├── testing
|   |   |   ├── __init__.py
|   |   |   ├── _markers.py
|   |   |   ├── compare.py
|   |   |   ├── conftest.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── jpl_units
|   |   |   |   ├── Duration.py
|   |   |   |   ├── Epoch.py
|   |   |   |   ├── EpochConverter.py
|   |   |   |   ├── StrConverter.py
|   |   |   |   ├── UnitDbl.py
|   |   |   |   ├── UnitDblConverter.py
|   |   |   |   ├── UnitDblFormatter.py
|   |   |   |   └── __init__.py
|   |   |   └── widgets.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── baseline_images
|   |   |   |   ├── dviread
|   |   |   |   ├── pngsuite
|   |   |   |   ├── test_agg
|   |   |   |   ├── test_agg_filter
|   |   |   |   ├── test_arrow_patches
|   |   |   |   ├── test_artist
|   |   |   |   ├── test_axes
|   |   |   |   ├── test_backend_pdf
|   |   |   |   ├── test_backend_pgf
|   |   |   |   ├── test_backend_ps
|   |   |   |   ├── test_backend_svg
|   |   |   |   ├── test_bbox_tight
|   |   |   |   ├── test_collections
|   |   |   |   ├── test_colorbar
|   |   |   |   ├── test_colors
|   |   |   |   ├── test_compare_images
|   |   |   |   ├── test_constrainedlayout
|   |   |   |   ├── test_contour
|   |   |   |   ├── test_dates
|   |   |   |   ├── test_figure
|   |   |   |   ├── test_image
|   |   |   |   ├── test_legend
|   |   |   |   ├── test_lines
|   |   |   |   ├── test_mathtext
|   |   |   |   ├── test_offsetbox
|   |   |   |   ├── test_patches
|   |   |   |   ├── test_path
|   |   |   |   ├── test_patheffects
|   |   |   |   ├── test_png
|   |   |   |   ├── test_polar
|   |   |   |   ├── test_quiver
|   |   |   |   ├── test_scale
|   |   |   |   ├── test_simplification
|   |   |   |   ├── test_skew
|   |   |   |   ├── test_spines
|   |   |   |   ├── test_streamplot
|   |   |   |   ├── test_subplots
|   |   |   |   ├── test_table
|   |   |   |   ├── test_text
|   |   |   |   ├── test_tightlayout
|   |   |   |   ├── test_transforms
|   |   |   |   ├── test_triangulation
|   |   |   |   ├── test_ttconv
|   |   |   |   ├── test_units
|   |   |   |   ├── test_usetex
|   |   |   |   └── test_widgets
|   |   |   ├── conftest.py
|   |   |   ├── test_afm.py
|   |   |   ├── test_agg.py
|   |   |   ├── test_agg_filter.py
|   |   |   ├── test_animation.py
|   |   |   ├── test_api.py
|   |   |   ├── test_arrow_patches.py
|   |   |   ├── test_artist.py
|   |   |   ├── test_axes.py
|   |   |   ├── test_backend_bases.py
|   |   |   ├── test_backend_cairo.py
|   |   |   ├── test_backend_gtk3.py
|   |   |   ├── test_backend_macosx.py
|   |   |   ├── test_backend_nbagg.py
|   |   |   ├── test_backend_pdf.py
|   |   |   ├── test_backend_pgf.py
|   |   |   ├── test_backend_ps.py
|   |   |   ├── test_backend_qt.py
|   |   |   ├── test_backend_svg.py
|   |   |   ├── test_backend_template.py
|   |   |   ├── test_backend_tk.py
|   |   |   ├── test_backend_tools.py
|   |   |   ├── test_backend_webagg.py
|   |   |   ├── test_backends_interactive.py
|   |   |   ├── test_basic.py
|   |   |   ├── test_bbox_tight.py
|   |   |   ├── test_category.py
|   |   |   ├── test_cbook.py
|   |   |   ├── test_collections.py
|   |   |   ├── test_colorbar.py
|   |   |   ├── test_colors.py
|   |   |   ├── test_compare_images.py
|   |   |   ├── test_constrainedlayout.py
|   |   |   ├── test_container.py
|   |   |   ├── test_contour.py
|   |   |   ├── test_cycles.py
|   |   |   ├── test_dates.py
|   |   |   ├── test_determinism.py
|   |   |   ├── test_doc.py
|   |   |   ├── test_dviread.py
|   |   |   ├── test_figure.py
|   |   |   ├── test_font_manager.py
|   |   |   ├── test_fontconfig_pattern.py
|   |   |   ├── test_getattr.py
|   |   |   ├── test_gridspec.py
|   |   |   ├── test_image.py
|   |   |   ├── test_legend.py
|   |   |   ├── test_lines.py
|   |   |   ├── test_marker.py
|   |   |   ├── test_mathtext.py
|   |   |   ├── test_matplotlib.py
|   |   |   ├── test_mlab.py
|   |   |   ├── test_offsetbox.py
|   |   |   ├── test_patches.py
|   |   |   ├── test_path.py
|   |   |   ├── test_patheffects.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_png.py
|   |   |   ├── test_polar.py
|   |   |   ├── test_preprocess_data.py
|   |   |   ├── test_pyplot.py
|   |   |   ├── test_quiver.py
|   |   |   ├── test_rcparams.py
|   |   |   ├── test_sankey.py
|   |   |   ├── test_scale.py
|   |   |   ├── test_simplification.py
|   |   |   ├── test_skew.py
|   |   |   ├── test_sphinxext.py
|   |   |   ├── test_spines.py
|   |   |   ├── test_streamplot.py
|   |   |   ├── test_style.py
|   |   |   ├── test_subplots.py
|   |   |   ├── test_table.py
|   |   |   ├── test_testing.py
|   |   |   ├── test_texmanager.py
|   |   |   ├── test_text.py
|   |   |   ├── test_textpath.py
|   |   |   ├── test_ticker.py
|   |   |   ├── test_tightlayout.py
|   |   |   ├── test_transforms.py
|   |   |   ├── test_triangulation.py
|   |   |   ├── test_ttconv.py
|   |   |   ├── test_type1font.py
|   |   |   ├── test_units.py
|   |   |   ├── test_usetex.py
|   |   |   ├── test_widgets.py
|   |   |   └── tinypages
|   |   |       ├── README.md
|   |   |       ├── _static
|   |   |       ├── conf.py
|   |   |       ├── included_plot_21.rst
|   |   |       ├── index.rst
|   |   |       ├── range4.py
|   |   |       ├── range6.py
|   |   |       └── some_plots.rst
|   |   ├── texmanager.py
|   |   ├── text.py
|   |   ├── textpath.py
|   |   ├── ticker.py
|   |   ├── tight_bbox.py
|   |   ├── tight_layout.py
|   |   ├── transforms.py
|   |   ├── tri
|   |   |   ├── __init__.py
|   |   |   ├── triangulation.py
|   |   |   ├── tricontour.py
|   |   |   ├── trifinder.py
|   |   |   ├── triinterpolate.py
|   |   |   ├── tripcolor.py
|   |   |   ├── triplot.py
|   |   |   ├── trirefine.py
|   |   |   └── tritools.py
|   |   ├── type1font.py
|   |   ├── units.py
|   |   └── widgets.py
|   ├── mpl_toolkits
|   |   ├── __init__.py
|   |   ├── axes_grid1
|   |   |   ├── __init__.py
|   |   |   ├── anchored_artists.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axes_size.py
|   |   |   ├── inset_locator.py
|   |   |   ├── mpl_axes.py
|   |   |   └── parasite_axes.py
|   |   ├── axisartist
|   |   |   ├── __init__.py
|   |   |   ├── angle_helper.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axis_artist.py
|   |   |   ├── axisline_style.py
|   |   |   ├── axislines.py
|   |   |   ├── clip_path.py
|   |   |   ├── floating_axes.py
|   |   |   ├── grid_finder.py
|   |   |   ├── grid_helper_curvelinear.py
|   |   |   └── parasite_axes.py
|   |   ├── mplot3d
|   |   |   ├── __init__.py
|   |   |   ├── art3d.py
|   |   |   ├── axes3d.py
|   |   |   ├── axis3d.py
|   |   |   └── proj3d.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── baseline_images
|   |       |   ├── test_axes_grid
|   |       |   ├── test_axes_grid1
|   |       |   ├── test_axisartist_axis_artist
|   |       |   ├── test_axisartist_axislines
|   |       |   ├── test_axisartist_clip_path
|   |       |   ├── test_axisartist_floating_axes
|   |       |   ├── test_axisartist_grid_helper_curvelinear
|   |       |   └── test_mplot3d
|   |       ├── conftest.py
|   |       ├── test_axes_grid.py
|   |       ├── test_axes_grid1.py
|   |       ├── test_axisartist_angle_helper.py
|   |       ├── test_axisartist_axis_artist.py
|   |       ├── test_axisartist_axislines.py
|   |       ├── test_axisartist_clip_path.py
|   |       ├── test_axisartist_floating_axes.py
|   |       ├── test_axisartist_grid_finder.py
|   |       ├── test_axisartist_grid_helper_curvelinear.py
|   |       └── test_mplot3d.py
|   └── pylab.py
├── plot_types
|   ├── README.rst
|   ├── arrays
|   |   ├── README.rst
|   |   ├── barbs.py
|   |   ├── contour.py
|   |   ├── contourf.py
|   |   ├── imshow.py
|   |   ├── pcolormesh.py
|   |   ├── quiver.py
|   |   └── streamplot.py
|   ├── basic
|   |   ├── README.rst
|   |   ├── bar.py
|   |   ├── fill_between.py
|   |   ├── plot.py
|   |   ├── scatter_plot.py
|   |   ├── stackplot.py
|   |   ├── stem.py
|   |   └── step.py
|   ├── stats
|   |   ├── README.rst
|   |   ├── boxplot_plot.py
|   |   ├── errorbar_plot.py
|   |   ├── eventplot.py
|   |   ├── hexbin.py
|   |   ├── hist2d.py
|   |   ├── hist_plot.py
|   |   ├── pie.py
|   |   └── violin.py
|   └── unstructured
|       ├── README.rst
|       ├── tricontour.py
|       ├── tricontourf.py
|       ├── tripcolor.py
|       └── triplot.py
├── requirements
|   ├── dev
|   |   └── dev-requirements.txt
|   ├── doc
|   |   └── doc-requirements.txt
|   └── testing
|       ├── all.txt
|       ├── extra.txt
|       ├── flake8.txt
|       └── minver.txt
├── setup.py
├── setupext.py
├── src
|   ├── _backend_agg.cpp
|   ├── _backend_agg_wrapper.cpp
|   ├── _c_internal_utils.c
|   ├── _image_wrapper.cpp
|   ├── _path_wrapper.cpp
|   ├── _qhull_wrapper.cpp
|   ├── _tkagg.cpp
|   ├── _ttconv.cpp
|   ├── checkdep_freetype2.c
|   ├── doc
|   ├── ft2font.cpp
|   ├── ft2font_wrapper.cpp
|   ├── py_converters.cpp
|   └── tri
|       ├── _tri.cpp
|       └── _tri_wrapper.cpp
├── tests.py
├── tools
|   ├── README.txt
|   ├── boilerplate.py
|   ├── cache_zenodo_svg.py
|   ├── create_DejaVuDisplay.sh
|   ├── embed_js.py
|   ├── gh_api.py
|   ├── github_stats.py
|   ├── make_icons.py
|   ├── memleak.py
|   ├── run_examples.py
|   ├── subset.py
|   ├── triage_tests.py
|   └── visualize_tests.py
└── tutorials
    ├── README.txt
    ├── advanced
    |   ├── README.txt
    |   ├── blitting.py
    |   ├── path_tutorial.py
    |   ├── patheffects_guide.py
    |   └── transforms_tutorial.py
    ├── colors
    |   ├── README.txt
    |   ├── colorbar_only.py
    |   ├── colormap-manipulation.py
    |   ├── colormapnorms.py
    |   ├── colormaps.py
    |   └── colors.py
    ├── intermediate
    |   ├── README.txt
    |   ├── arranging_axes.py
    |   ├── artists.py
    |   ├── autoscale.py
    |   ├── color_cycle.py
    |   ├── constrainedlayout_guide.py
    |   ├── imshow_extent.py
    |   ├── legend_guide.py
    |   └── tight_layout_guide.py
    ├── introductory
    |   ├── README.txt
    |   ├── customizing.py
    |   ├── images.py
    |   ├── lifecycle.py
    |   ├── pyplot.py
    |   └── quick_start.py
    ├── provisional
    |   ├── README.txt
    |   └── mosaic.py
    ├── text
    |   ├── README.txt
    |   ├── annotations.py
    |   ├── mathtext.py
    |   ├── pgf.py
    |   ├── text_intro.py
    |   ├── text_props.py
    |   └── usetex.py
    └── toolkits
        ├── README.txt
        ├── axes_grid.py
        ├── axisartist.py
        └── mplot3d.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: [Bug]: get_backend() clears figures from Gcf.figs if they were created under rc_context

Description: ### Bug summary

calling `matplotlib.get_backend()` removes all figures from `Gcf` if the *first* figure in `Gcf.figs` was created in an `rc_context`.

### Code for reproduction

```python
import matplotlib.pyplot as plt
from matplotlib import get_backend, rc_context

# fig1 = plt.figure()  # <- UNCOMMENT THIS LINE AND IT WILL WORK
# plt.ion()            # <- ALTERNATIVELY, UNCOMMENT THIS LINE AND IT WILL ALSO WORK
with rc_context():
    fig2 = plt.figure()
before = f'{id(plt._pylab_helpers.Gcf)} {plt._pylab_helpers.Gcf.figs!r}'
get_backend()
after = f'{id(plt._pylab_helpers.Gcf)} {plt._pylab_helpers.Gcf.figs!r}'

assert before == after, '\n' + before + '\n' + after
```


### Actual outcome

```
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
<ipython-input-1-fa4d099aa289> in <cell line: 11>()
      9 after = f'{id(plt._pylab_helpers.Gcf)} {plt._pylab_helpers.Gcf.figs!r}'
     10 
---> 11 assert before == after, '\n' + before + '\n' + after
     12 

AssertionError: 
94453354309744 OrderedDict([(1, <matplotlib.backends.backend_qt.FigureManagerQT object at 0x7fb33e26c220>)])
94453354309744 OrderedDict()
```

### Expected outcome

The figure should not be missing from `Gcf`.  Consequences of this are, e.g, `plt.close(fig2)` doesn't work because `Gcf.destroy_fig()` can't find it.

### Additional information

_No response_

### Operating system

Xubuntu

### Matplotlib Version

3.5.2

### Matplotlib Backend

QtAgg

### Python version

Python 3.10.4

### Jupyter version

n/a

### Installation

conda

Patch information:
diff --git a/lib/matplotlib/__init__.py b/lib/matplotlib/__init__.py
index c268a56724..c5c1a8e71a 100644
--- a/lib/matplotlib/__init__.py
+++ b/lib/matplotlib/__init__.py
@@ -1095,7 +1095,19 @@ def rc_context(rc=None, fname=None):
             rcParams.update(rc)
         yield
     finally:
-        dict.update(rcParams, orig)  # Revert to the original rcs.
+        # Revert to the original rcs, but preserve a resolved backend if the
+        # original value was the auto backend sentinel.
+        try:
+            original_backend = dict.__getitem__(orig, "backend")
+        except KeyError:
+            original_backend = None
+        if original_backend is rcsetup._auto_backend_sentinel:
+            # Get current backend without triggering resolution.
+            current_backend = dict.__getitem__(rcParams, "backend")
+            if current_backend is not rcsetup._auto_backend_sentinel:
+                # Preserve the resolved backend selected during the context.
+                dict.__setitem__(orig, "backend", current_backend)
+        dict.update(rcParams, orig)
 
 
 def use(backend, *, force=True):


Find all relevant source code context needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `lib/matplotlib/__init__.py`, `lib/matplotlib/pyplot.py`, `lib/matplotlib/_pylab_helpers.py`, and `lib/matplotlib/rcsetup.py`.
Extra Requirements: 
Purpose: This will allow me to trace the creation of the figure, its registration, and the mechanism by which `get_backend` might be clearing it, focusing on the backend selection logic within `rc_context`.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: lib/matplotlib/__init__.py
Line number range: 1 - 500
Content:
1. """
2. An object-oriented plotting library.
3. 
4. A procedural interface is provided by the companion pyplot module,
5. which may be imported directly, e.g.::
6. 
7.     import matplotlib.pyplot as plt
8. 
9. or using ipython::
10. 
11.     ipython
12. 
13. at your terminal, followed by::
14. 
15.     In [1]: %matplotlib
16.     In [2]: import matplotlib.pyplot as plt
17. 
18. at the ipython shell prompt.
19. 
20. For the most part, direct use of the explicit object-oriented library is
21. encouraged when programming; the implicit pyplot interface is primarily for
22. working interactively. The exceptions to this suggestion are the pyplot
23. functions `.pyplot.figure`, `.pyplot.subplot`, `.pyplot.subplots`, and
24. `.pyplot.savefig`, which can greatly simplify scripting.  See
25. :ref:`api_interfaces` for an explanation of the tradeoffs between the implicit
26. and explicit interfaces.
27. 
28. Modules include:
29. 
30.     :mod:`matplotlib.axes`
31.         The `~.axes.Axes` class.  Most pyplot functions are wrappers for
32.         `~.axes.Axes` methods.  The axes module is the highest level of OO
33.         access to the library.
34. 
35.     :mod:`matplotlib.figure`
36.         The `.Figure` class.
37. 
38.     :mod:`matplotlib.artist`
39.         The `.Artist` base class for all classes that draw things.
40. 
41.     :mod:`matplotlib.lines`
42.         The `.Line2D` class for drawing lines and markers.
43. 
44.     :mod:`matplotlib.patches`
45.         Classes for drawing polygons.
46. 
47.     :mod:`matplotlib.text`
48.         The `.Text` and `.Annotation` classes.
49. 
50.     :mod:`matplotlib.image`
51.         The `.AxesImage` and `.FigureImage` classes.
52. 
53.     :mod:`matplotlib.collections`
54.         Classes for efficient drawing of groups of lines or polygons.
55. 
56.     :mod:`matplotlib.colors`
57.         Color specifications and making colormaps.
58. 
59.     :mod:`matplotlib.cm`
60.         Colormaps, and the `.ScalarMappable` mixin class for providing color
61.         mapping functionality to other classes.
62. 
63.     :mod:`matplotlib.ticker`
64.         Calculation of tick mark locations and formatting of tick labels.
65. 
66.     :mod:`matplotlib.backends`
67.         A subpackage with modules for various GUI libraries and output formats.
68. 
69. The base matplotlib namespace includes:
70. 
71.     `~matplotlib.rcParams`
72.         Default configuration settings; their defaults may be overridden using
73.         a :file:`matplotlibrc` file.
74. 
75.     `~matplotlib.use`
76.         Setting the Matplotlib backend.  This should be called before any
77.         figure is created, because it is not possible to switch between
78.         different GUI backends after that.
79. 
80. Matplotlib was initially written by John D. Hunter (1968-2012) and is now
81. developed and maintained by a host of others.
82. 
83. Occasionally the internal documentation (python docstrings) will refer
84. to MATLAB&reg;, a registered trademark of The MathWorks, Inc.
85. 
86. """
87. 
88. import atexit
89. from collections import namedtuple
90. from collections.abc import MutableMapping
91. import contextlib
92. import functools
93. import importlib
94. import inspect
95. from inspect import Parameter
96. import locale
97. import logging
98. import os
99. from pathlib import Path
100. import pprint
101. import re
102. import shutil
103. import subprocess
104. import sys
105. import tempfile
106. import warnings
107. 
108. import numpy
109. from packaging.version import parse as parse_version
110. 
111. # cbook must import matplotlib only within function
112. # definitions, so it is safe to import from it here.
113. from . import _api, _version, cbook, _docstring, rcsetup
114. from matplotlib.cbook import sanitize_sequence
115. from matplotlib._api import MatplotlibDeprecationWarning
116. from matplotlib.rcsetup import validate_backend, cycler
117. 
118. 
119. _log = logging.getLogger(__name__)
120. 
121. __bibtex__ = r"""@Article{Hunter:2007,
122.   Author    = {Hunter, J. D.},
123.   Title     = {Matplotlib: A 2D graphics environment},
124.   Journal   = {Computing in Science \& Engineering},
125.   Volume    = {9},
126.   Number    = {3},
127.   Pages     = {90--95},
128.   abstract  = {Matplotlib is a 2D graphics package used for Python
129.   for application development, interactive scripting, and
130.   publication-quality image generation across user
131.   interfaces and operating systems.},
132.   publisher = {IEEE COMPUTER SOC},
133.   year      = 2007
134. }"""
135. 
136. # modelled after sys.version_info
137. _VersionInfo = namedtuple('_VersionInfo',
138.                           'major, minor, micro, releaselevel, serial')
139. 
140. 
141. def _parse_to_version_info(version_str):
142.     """
143.     Parse a version string to a namedtuple analogous to sys.version_info.
144. 
145.     See:
146.     https://packaging.pypa.io/en/latest/version.html#packaging.version.parse
147.     https://docs.python.org/3/library/sys.html#sys.version_info
148.     """
149.     v = parse_version(version_str)
150.     if v.pre is None and v.post is None and v.dev is None:
151.         return _VersionInfo(v.major, v.minor, v.micro, 'final', 0)
152.     elif v.dev is not None:
153.         return _VersionInfo(v.major, v.minor, v.micro, 'alpha', v.dev)
154.     elif v.pre is not None:
155.         releaselevel = {
156.             'a': 'alpha',
157.             'b': 'beta',
158.             'rc': 'candidate'}.get(v.pre[0], 'alpha')
159.         return _VersionInfo(v.major, v.minor, v.micro, releaselevel, v.pre[1])
160.     else:
161.         # fallback for v.post: guess-next-dev scheme from setuptools_scm
162.         return _VersionInfo(v.major, v.minor, v.micro + 1, 'alpha', v.post)
163. 
164. 
165. def _get_version():
166.     """Return the version string used for __version__."""
167.     # Only shell out to a git subprocess if really needed, i.e. when we are in
168.     # a matplotlib git repo but not in a shallow clone, such as those used by
169.     # CI, as the latter would trigger a warning from setuptools_scm.
170.     root = Path(__file__).resolve().parents[2]
171.     if ((root / ".matplotlib-repo").exists()
172.             and (root / ".git").exists()
173.             and not (root / ".git/shallow").exists()):
174.         import setuptools_scm
175.         return setuptools_scm.get_version(
176.             root=root,
177.             version_scheme="release-branch-semver",
178.             local_scheme="node-and-date",
179.             fallback_version=_version.version,
180.         )
181.     else:  # Get the version from the _version.py setuptools_scm file.
182.         return _version.version
183. 
184. 
185. @_api.caching_module_getattr
186. class __getattr__:
187.     __version__ = property(lambda self: _get_version())
188.     __version_info__ = property(
189.         lambda self: _parse_to_version_info(self.__version__))
190.     # module-level deprecations
191.     URL_REGEX = _api.deprecated("3.5", obj_type="")(property(
192.         lambda self: re.compile(r'^http://|^https://|^ftp://|^file:')))
193. 
194. 
195. def _check_versions():
196. 
197.     # Quickfix to ensure Microsoft Visual C++ redistributable
198.     # DLLs are loaded before importing kiwisolver
199.     from . import ft2font
200. 
201.     for modname, minver in [
202.             ("cycler", "0.10"),
203.             ("dateutil", "2.7"),
204.             ("kiwisolver", "1.0.1"),
205.             ("numpy", "1.19"),
206.             ("pyparsing", "2.2.1"),
207.     ]:
208.         module = importlib.import_module(modname)
209.         if parse_version(module.__version__) < parse_version(minver):
210.             raise ImportError(f"Matplotlib requires {modname}>={minver}; "
211.                               f"you have {module.__version__}")
212. 
213. 
214. _check_versions()
215. 
216. 
217. # The decorator ensures this always returns the same handler (and it is only
218. # attached once).
219. @functools.lru_cache()
220. def _ensure_handler():
221.     """
222.     The first time this function is called, attach a `StreamHandler` using the
223.     same format as `logging.basicConfig` to the Matplotlib root logger.
224. 
225.     Return this handler every time this function is called.
226.     """
227.     handler = logging.StreamHandler()
228.     handler.setFormatter(logging.Formatter(logging.BASIC_FORMAT))
229.     _log.addHandler(handler)
230.     return handler
231. 
232. 
233. def set_loglevel(level):
234.     """
235.     Set Matplotlib's root logger and root logger handler level, creating
236.     the handler if it does not exist yet.
237. 
238.     Typically, one should call ``set_loglevel("info")`` or
239.     ``set_loglevel("debug")`` to get additional debugging information.
240. 
241.     Parameters
242.     ----------
243.     level : {"notset", "debug", "info", "warning", "error", "critical"}
244.         The log level of the handler.
245. 
246.     Notes
247.     -----
248.     The first time this function is called, an additional handler is attached
249.     to Matplotlib's root handler; this handler is reused every time and this
250.     function simply manipulates the logger and handler's level.
251.     """
252.     _log.setLevel(level.upper())
253.     _ensure_handler().setLevel(level.upper())
254. 
255. 
256. def _logged_cached(fmt, func=None):
257.     """
258.     Decorator that logs a function's return value, and memoizes that value.
259. 
260.     After ::
261. 
262.         @_logged_cached(fmt)
263.         def func(): ...
264. 
265.     the first call to *func* will log its return value at the DEBUG level using
266.     %-format string *fmt*, and memoize it; later calls to *func* will directly
267.     return that value.
268.     """
269.     if func is None:  # Return the actual decorator.
270.         return functools.partial(_logged_cached, fmt)
271. 
272.     called = False
273.     ret = None
274. 
275.     @functools.wraps(func)
276.     def wrapper(**kwargs):
277.         nonlocal called, ret
278.         if not called:
279.             ret = func(**kwargs)
280.             called = True
281.             _log.debug(fmt, ret)
282.         return ret
283. 
284.     return wrapper
285. 
286. 
287. _ExecInfo = namedtuple("_ExecInfo", "executable raw_version version")
288. 
289. 
290. class ExecutableNotFoundError(FileNotFoundError):
291.     """
292.     Error raised when an executable that Matplotlib optionally
293.     depends on can't be found.
294.     """
295.     pass
296. 
297. 
298. @functools.lru_cache()
299. def _get_executable_info(name):
300.     """
301.     Get the version of some executable that Matplotlib optionally depends on.
302. 
303.     .. warning::
304.        The list of executables that this function supports is set according to
305.        Matplotlib's internal needs, and may change without notice.
306. 
307.     Parameters
308.     ----------
309.     name : str
310.         The executable to query.  The following values are currently supported:
311.         "dvipng", "gs", "inkscape", "magick", "pdftocairo", "pdftops".  This
312.         list is subject to change without notice.
313. 
314.     Returns
315.     -------
316.     tuple
317.         A namedtuple with fields ``executable`` (`str`) and ``version``
318.         (`packaging.Version`, or ``None`` if the version cannot be determined).
319. 
320.     Raises
321.     ------
322.     ExecutableNotFoundError
323.         If the executable is not found or older than the oldest version
324.         supported by Matplotlib.  For debugging purposes, it is also
325.         possible to "hide" an executable from Matplotlib by adding it to the
326.         :envvar:`_MPLHIDEEXECUTABLES` environment variable (a comma-separated
327.         list), which must be set prior to any calls to this function.
328.     ValueError
329.         If the executable is not one that we know how to query.
330.     """
331. 
332.     def impl(args, regex, min_ver=None, ignore_exit_code=False):
333.         # Execute the subprocess specified by args; capture stdout and stderr.
334.         # Search for a regex match in the output; if the match succeeds, the
335.         # first group of the match is the version.
336.         # Return an _ExecInfo if the executable exists, and has a version of
337.         # at least min_ver (if set); else, raise ExecutableNotFoundError.
338.         try:
339.             output = subprocess.check_output(
340.                 args, stderr=subprocess.STDOUT,
341.                 universal_newlines=True, errors="replace")
342.         except subprocess.CalledProcessError as _cpe:
343.             if ignore_exit_code:
344.                 output = _cpe.output
345.             else:
346.                 raise ExecutableNotFoundError(str(_cpe)) from _cpe
347.         except OSError as _ose:
348.             raise ExecutableNotFoundError(str(_ose)) from _ose
349.         match = re.search(regex, output)
350.         if match:
351.             raw_version = match.group(1)
352.             version = parse_version(raw_version)
353.             if min_ver is not None and version < parse_version(min_ver):
354.                 raise ExecutableNotFoundError(
355.                     f"You have {args[0]} version {version} but the minimum "
356.                     f"version supported by Matplotlib is {min_ver}")
357.             return _ExecInfo(args[0], raw_version, version)
358.         else:
359.             raise ExecutableNotFoundError(
360.                 f"Failed to determine the version of {args[0]} from "
361.                 f"{' '.join(args)}, which output {output}")
362. 
363.     if name in os.environ.get("_MPLHIDEEXECUTABLES", "").split(","):
364.         raise ExecutableNotFoundError(f"{name} was hidden")
365. 
366.     if name == "dvipng":
367.         return impl(["dvipng", "-version"], "(?m)^dvipng(?: .*)? (.+)", "1.6")
368.     elif name == "gs":
369.         execs = (["gswin32c", "gswin64c", "mgs", "gs"]  # "mgs" for miktex.
370.                  if sys.platform == "win32" else
371.                  ["gs"])
372.         for e in execs:
373.             try:
374.                 return impl([e, "--version"], "(.*)", "9")
375.             except ExecutableNotFoundError:
376.                 pass
377.         message = "Failed to find a Ghostscript installation"
378.         raise ExecutableNotFoundError(message)
379.     elif name == "inkscape":
380.         try:
381.             # Try headless option first (needed for Inkscape version < 1.0):
382.             return impl(["inkscape", "--without-gui", "-V"],
383.                         "Inkscape ([^ ]*)")
384.         except ExecutableNotFoundError:
385.             pass  # Suppress exception chaining.
386.         # If --without-gui is not accepted, we may be using Inkscape >= 1.0 so
387.         # try without it:
388.         return impl(["inkscape", "-V"], "Inkscape ([^ ]*)")
389.     elif name == "magick":
390.         if sys.platform == "win32":
391.             # Check the registry to avoid confusing ImageMagick's convert with
392.             # Windows's builtin convert.exe.
393.             import winreg
394.             binpath = ""
395.             for flag in [0, winreg.KEY_WOW64_32KEY, winreg.KEY_WOW64_64KEY]:
396.                 try:
397.                     with winreg.OpenKeyEx(
398.                             winreg.HKEY_LOCAL_MACHINE,
399.                             r"Software\Imagemagick\Current",
400.                             0, winreg.KEY_QUERY_VALUE | flag) as hkey:
401.                         binpath = winreg.QueryValueEx(hkey, "BinPath")[0]
402.                 except OSError:
403.                     pass
404.             path = None
405.             if binpath:
406.                 for name in ["convert.exe", "magick.exe"]:
407.                     candidate = Path(binpath, name)
408.                     if candidate.exists():
409.                         path = str(candidate)
410.                         break
411.             if path is None:
412.                 raise ExecutableNotFoundError(
413.                     "Failed to find an ImageMagick installation")
414.         else:
415.             path = "convert"
416.         info = impl([path, "--version"], r"^Version: ImageMagick (\S*)")
417.         if info.raw_version == "7.0.10-34":
418.             # https://github.com/ImageMagick/ImageMagick/issues/2720
419.             raise ExecutableNotFoundError(
420.                 f"You have ImageMagick {info.version}, which is unsupported")
421.         return info
422.     elif name == "pdftocairo":
423.         return impl(["pdftocairo", "-v"], "pdftocairo version (.*)")
424.     elif name == "pdftops":
425.         info = impl(["pdftops", "-v"], "^pdftops version (.*)",
426.                     ignore_exit_code=True)
427.         if info and not (
428.                 3 <= info.version.major or
429.                 # poppler version numbers.
430.                 parse_version("0.9") <= info.version < parse_version("1.0")):
431.             raise ExecutableNotFoundError(
432.                 f"You have pdftops version {info.version} but the minimum "
433.                 f"version supported by Matplotlib is 3.0")
434.         return info
435.     else:
436.         raise ValueError("Unknown executable: {!r}".format(name))
437. 
438. 
439. @_api.deprecated("3.6", alternative="Vendor the code")
440. def checkdep_usetex(s):
441.     if not s:
442.         return False
443.     if not shutil.which("tex"):
444.         _log.warning("usetex mode requires TeX.")
445.         return False
446.     try:
447.         _get_executable_info("dvipng")
448.     except ExecutableNotFoundError:
449.         _log.warning("usetex mode requires dvipng.")
450.         return False
451.     try:
452.         _get_executable_info("gs")
453.     except ExecutableNotFoundError:
454.         _log.warning("usetex mode requires ghostscript.")
455.         return False
456.     return True
457. 
458. 
459. def _get_xdg_config_dir():
460.     """
461.     Return the XDG configuration directory, according to the XDG base
462.     directory spec:
463. 
464.     https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html
465.     """
466.     return os.environ.get('XDG_CONFIG_HOME') or str(Path.home() / ".config")
467. 
468. 
469. def _get_xdg_cache_dir():
470.     """
471.     Return the XDG cache directory, according to the XDG base directory spec:
472. 
473.     https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html
474.     """
475.     return os.environ.get('XDG_CACHE_HOME') or str(Path.home() / ".cache")
476. 
477. 
478. def _get_config_or_cache_dir(xdg_base_getter):
479.     configdir = os.environ.get('MPLCONFIGDIR')
480.     if configdir:
481.         configdir = Path(configdir).resolve()
482.     elif sys.platform.startswith(('linux', 'freebsd')):
483.         # Only call _xdg_base_getter here so that MPLCONFIGDIR is tried first,
484.         # as _xdg_base_getter can throw.
485.         configdir = Path(xdg_base_getter(), "matplotlib")
486.     else:
487.         configdir = Path.home() / ".matplotlib"
488.     try:
489.         configdir.mkdir(parents=True, exist_ok=True)
490.     except OSError:
491.         pass
492.     else:
493.         if os.access(str(configdir), os.W_OK) and configdir.is_dir():
494.             return str(configdir)
495.     # If the config or cache directory cannot be created or is not a writable
496.     # directory, create a temporary one.
497.     tmpdir = os.environ["MPLCONFIGDIR"] = \
498.         tempfile.mkdtemp(prefix="matplotlib-")
499.     atexit.register(shutil.rmtree, tmpdir)
500.     _log.warning(


File: lib/matplotlib/_pylab_helpers.py
Line number range: 1 - 144
Content:
1. """
2. Manage figures for the pyplot interface.
3. """
4. 
5. import atexit
6. from collections import OrderedDict
7. import gc
8. 
9. 
10. class Gcf:
11.     """
12.     Singleton to maintain the relation between figures and their managers, and
13.     keep track of and "active" figure and manager.
14. 
15.     The canvas of a figure created through pyplot is associated with a figure
16.     manager, which handles the interaction between the figure and the backend.
17.     pyplot keeps track of figure managers using an identifier, the "figure
18.     number" or "manager number" (which can actually be any hashable value);
19.     this number is available as the :attr:`number` attribute of the manager.
20. 
21.     This class is never instantiated; it consists of an `OrderedDict` mapping
22.     figure/manager numbers to managers, and a set of class methods that
23.     manipulate this `OrderedDict`.
24. 
25.     Attributes
26.     ----------
27.     figs : OrderedDict
28.         `OrderedDict` mapping numbers to managers; the active manager is at the
29.         end.
30.     """
31. 
32.     figs = OrderedDict()
33. 
34.     @classmethod
35.     def get_fig_manager(cls, num):
36.         """
37.         If manager number *num* exists, make it the active one and return it;
38.         otherwise return *None*.
39.         """
40.         manager = cls.figs.get(num, None)
41.         if manager is not None:
42.             cls.set_active(manager)
43.         return manager
44. 
45.     @classmethod
46.     def destroy(cls, num):
47.         """
48.         Destroy manager *num* -- either a manager instance or a manager number.
49. 
50.         In the interactive backends, this is bound to the window "destroy" and
51.         "delete" events.
52. 
53.         It is recommended to pass a manager instance, to avoid confusion when
54.         two managers share the same number.
55.         """
56.         if all(hasattr(num, attr) for attr in ["num", "destroy"]):
57.             manager = num
58.             if cls.figs.get(manager.num) is manager:
59.                 cls.figs.pop(manager.num)
60.         else:
61.             try:
62.                 manager = cls.figs.pop(num)
63.             except KeyError:
64.                 return
65.         if hasattr(manager, "_cidgcf"):
66.             manager.canvas.mpl_disconnect(manager._cidgcf)
67.         manager.destroy()
68.         del manager, num
69.         # Full cyclic garbage collection may be too expensive to do on every
70.         # figure destruction, so we collect only the youngest two generations.
71.         # see: https://github.com/matplotlib/matplotlib/pull/3045
72.         gc.collect(1)
73. 
74.     @classmethod
75.     def destroy_fig(cls, fig):
76.         """Destroy figure *fig*."""
77.         num = next((manager.num for manager in cls.figs.values()
78.                     if manager.canvas.figure == fig), None)
79.         if num is not None:
80.             cls.destroy(num)
81. 
82.     @classmethod
83.     def destroy_all(cls):
84.         """Destroy all figures."""
85.         # Reimport gc in case the module globals have already been removed
86.         # during interpreter shutdown.
87.         import gc
88.         for manager in list(cls.figs.values()):
89.             manager.canvas.mpl_disconnect(manager._cidgcf)
90.             manager.destroy()
91.         cls.figs.clear()
92.         gc.collect(1)
93. 
94.     @classmethod
95.     def has_fignum(cls, num):
96.         """Return whether figure number *num* exists."""
97.         return num in cls.figs
98. 
99.     @classmethod
100.     def get_all_fig_managers(cls):
101.         """Return a list of figure managers."""
102.         return list(cls.figs.values())
103. 
104.     @classmethod
105.     def get_num_fig_managers(cls):
106.         """Return the number of figures being managed."""
107.         return len(cls.figs)
108. 
109.     @classmethod
110.     def get_active(cls):
111.         """Return the active manager, or *None* if there is no manager."""
112.         return next(reversed(cls.figs.values())) if cls.figs else None
113. 
114.     @classmethod
115.     def _set_new_active_manager(cls, manager):
116.         """Adopt *manager* into pyplot and make it the active manager."""
117.         if not hasattr(manager, "_cidgcf"):
118.             manager._cidgcf = manager.canvas.mpl_connect(
119.                 "button_press_event", lambda event: cls.set_active(manager))
120.         fig = manager.canvas.figure
121.         fig.number = manager.num
122.         label = fig.get_label()
123.         if label:
124.             manager.set_window_title(label)
125.         cls.set_active(manager)
126. 
127.     @classmethod
128.     def set_active(cls, manager):
129.         """Make *manager* the active manager."""
130.         cls.figs[manager.num] = manager
131.         cls.figs.move_to_end(manager.num)
132. 
133.     @classmethod
134.     def draw_all(cls, force=False):
135.         """
136.         Redraw all stale managed figures, or, if *force* is True, all managed
137.         figures.
138.         """
139.         for manager in cls.get_all_fig_managers():
140.             if force or manager.canvas.figure.stale:
141.                 manager.canvas.draw_idle()
142. 
143. 
144. atexit.register(Gcf.destroy_all)


File: lib/matplotlib/pyplot.py
Line number range: 1 - 500
Content:
1. # Note: The first part of this file can be modified in place, but the latter
2. # part is autogenerated by the boilerplate.py script.
3. 
4. """
5. `matplotlib.pyplot` is a state-based interface to matplotlib. It provides
6. an implicit,  MATLAB-like, way of plotting.  It also opens figures on your
7. screen, and acts as the figure GUI manager.
8. 
9. pyplot is mainly intended for interactive plots and simple cases of
10. programmatic plot generation::
11. 
12.     import numpy as np
13.     import matplotlib.pyplot as plt
14. 
15.     x = np.arange(0, 5, 0.1)
16.     y = np.sin(x)
17.     plt.plot(x, y)
18. 
19. The explicit object-oriented API is recommended for complex plots, though
20. pyplot is still usually used to create the figure and often the axes in the
21. figure. See `.pyplot.figure`, `.pyplot.subplots`, and
22. `.pyplot.subplot_mosaic` to create figures, and
23. :doc:`Axes API </api/axes_api>` for the plotting methods on an Axes::
24. 
25.     import numpy as np
26.     import matplotlib.pyplot as plt
27. 
28.     x = np.arange(0, 5, 0.1)
29.     y = np.sin(x)
30.     fig, ax = plt.subplots()
31.     ax.plot(x, y)
32. 
33. 
34. See :ref:`api_interfaces` for an explanation of the tradeoffs between the
35. implicit and explicit interfaces.
36. """
37. 
38. from enum import Enum
39. import functools
40. import importlib
41. import inspect
42. import logging
43. from numbers import Number
44. import re
45. import sys
46. import threading
47. import time
48. 
49. from cycler import cycler
50. import matplotlib
51. import matplotlib.colorbar
52. import matplotlib.image
53. from matplotlib import _api
54. from matplotlib import rcsetup, style
55. from matplotlib import _pylab_helpers, interactive
56. from matplotlib import cbook
57. from matplotlib import _docstring
58. from matplotlib.backend_bases import FigureCanvasBase, MouseButton
59. from matplotlib.figure import Figure, FigureBase, figaspect
60. from matplotlib.gridspec import GridSpec, SubplotSpec
61. from matplotlib import rcParams, rcParamsDefault, get_backend, rcParamsOrig
62. from matplotlib.rcsetup import interactive_bk as _interactive_bk
63. from matplotlib.artist import Artist
64. from matplotlib.axes import Axes, Subplot
65. from matplotlib.projections import PolarAxes
66. from matplotlib import mlab  # for detrend_none, window_hanning
67. from matplotlib.scale import get_scale_names
68. 
69. from matplotlib import cm
70. from matplotlib.cm import _colormaps as colormaps, get_cmap, register_cmap
71. from matplotlib.colors import _color_sequences as color_sequences
72. 
73. import numpy as np
74. 
75. # We may not need the following imports here:
76. from matplotlib.colors import Normalize
77. from matplotlib.lines import Line2D
78. from matplotlib.text import Text, Annotation
79. from matplotlib.patches import Polygon, Rectangle, Circle, Arrow
80. from matplotlib.widgets import Button, Slider, Widget
81. 
82. from .ticker import (
83.     TickHelper, Formatter, FixedFormatter, NullFormatter, FuncFormatter,
84.     FormatStrFormatter, ScalarFormatter, LogFormatter, LogFormatterExponent,
85.     LogFormatterMathtext, Locator, IndexLocator, FixedLocator, NullLocator,
86.     LinearLocator, LogLocator, AutoLocator, MultipleLocator, MaxNLocator)
87. 
88. _log = logging.getLogger(__name__)
89. 
90. 
91. def _copy_docstring_and_deprecators(method, func=None):
92.     if func is None:
93.         return functools.partial(_copy_docstring_and_deprecators, method)
94.     decorators = [_docstring.copy(method)]
95.     # Check whether the definition of *method* includes @_api.rename_parameter
96.     # or @_api.make_keyword_only decorators; if so, propagate them to the
97.     # pyplot wrapper as well.
98.     while getattr(method, "__wrapped__", None) is not None:
99.         decorator = _api.deprecation.DECORATORS.get(method)
100.         if decorator:
101.             decorators.append(decorator)
102.         method = method.__wrapped__
103.     for decorator in decorators[::-1]:
104.         func = decorator(func)
105.     return func
106. 
107. 
108. ## Global ##
109. 
110. 
111. # The state controlled by {,un}install_repl_displayhook().
112. _ReplDisplayHook = Enum("_ReplDisplayHook", ["NONE", "PLAIN", "IPYTHON"])
113. _REPL_DISPLAYHOOK = _ReplDisplayHook.NONE
114. 
115. 
116. def _draw_all_if_interactive():
117.     if matplotlib.is_interactive():
118.         draw_all()
119. 
120. 
121. def install_repl_displayhook():
122.     """
123.     Connect to the display hook of the current shell.
124. 
125.     The display hook gets called when the read-evaluate-print-loop (REPL) of
126.     the shell has finished the execution of a command. We use this callback
127.     to be able to automatically update a figure in interactive mode.
128. 
129.     This works both with IPython and with vanilla python shells.
130.     """
131.     global _REPL_DISPLAYHOOK
132. 
133.     if _REPL_DISPLAYHOOK is _ReplDisplayHook.IPYTHON:
134.         return
135. 
136.     # See if we have IPython hooks around, if so use them.
137.     # Use ``sys.modules.get(name)`` rather than ``name in sys.modules`` as
138.     # entries can also have been explicitly set to None.
139.     mod_ipython = sys.modules.get("IPython")
140.     if not mod_ipython:
141.         _REPL_DISPLAYHOOK = _ReplDisplayHook.PLAIN
142.         return
143.     ip = mod_ipython.get_ipython()
144.     if not ip:
145.         _REPL_DISPLAYHOOK = _ReplDisplayHook.PLAIN
146.         return
147. 
148.     ip.events.register("post_execute", _draw_all_if_interactive)
149.     _REPL_DISPLAYHOOK = _ReplDisplayHook.IPYTHON
150. 
151.     from IPython.core.pylabtools import backend2gui
152.     # trigger IPython's eventloop integration, if available
153.     ipython_gui_name = backend2gui.get(get_backend())
154.     if ipython_gui_name:
155.         ip.enable_gui(ipython_gui_name)
156. 
157. 
158. def uninstall_repl_displayhook():
159.     """Disconnect from the display hook of the current shell."""
160.     global _REPL_DISPLAYHOOK
161.     if _REPL_DISPLAYHOOK is _ReplDisplayHook.IPYTHON:
162.         from IPython import get_ipython
163.         ip = get_ipython()
164.         ip.events.unregister("post_execute", _draw_all_if_interactive)
165.     _REPL_DISPLAYHOOK = _ReplDisplayHook.NONE
166. 
167. 
168. draw_all = _pylab_helpers.Gcf.draw_all
169. 
170. 
171. @_copy_docstring_and_deprecators(matplotlib.set_loglevel)
172. def set_loglevel(*args, **kwargs):  # Ensure this appears in the pyplot docs.
173.     return matplotlib.set_loglevel(*args, **kwargs)
174. 
175. 
176. @_copy_docstring_and_deprecators(Artist.findobj)
177. def findobj(o=None, match=None, include_self=True):
178.     if o is None:
179.         o = gcf()
180.     return o.findobj(match, include_self=include_self)
181. 
182. 
183. def _get_required_interactive_framework(backend_mod):
184.     if not hasattr(backend_mod.FigureCanvas, "required_interactive_framework"):
185.         _api.warn_deprecated(
186.             "3.6", name="Support for FigureCanvases without a "
187.             "required_interactive_framework attribute")
188.         return None
189.     # Inline this once the deprecation elapses.
190.     return backend_mod.FigureCanvas.required_interactive_framework
191. 
192. _backend_mod = None
193. 
194. 
195. def _get_backend_mod():
196.     """
197.     Ensure that a backend is selected and return it.
198. 
199.     This is currently private, but may be made public in the future.
200.     """
201.     if _backend_mod is None:
202.         # Use __getitem__ here to avoid going through the fallback logic (which
203.         # will (re)import pyplot and then call switch_backend if we need to
204.         # resolve the auto sentinel)
205.         switch_backend(dict.__getitem__(rcParams, "backend"))
206.     return _backend_mod
207. 
208. 
209. def switch_backend(newbackend):
210.     """
211.     Close all open figures and set the Matplotlib backend.
212. 
213.     The argument is case-insensitive.  Switching to an interactive backend is
214.     possible only if no event loop for another interactive backend has started.
215.     Switching to and from non-interactive backends is always possible.
216. 
217.     Parameters
218.     ----------
219.     newbackend : str
220.         The name of the backend to use.
221.     """
222.     global _backend_mod
223.     # make sure the init is pulled up so we can assign to it later
224.     import matplotlib.backends
225.     close("all")
226. 
227.     if newbackend is rcsetup._auto_backend_sentinel:
228.         current_framework = cbook._get_running_interactive_framework()
229.         mapping = {'qt': 'qtagg',
230.                    'gtk3': 'gtk3agg',
231.                    'gtk4': 'gtk4agg',
232.                    'wx': 'wxagg',
233.                    'tk': 'tkagg',
234.                    'macosx': 'macosx',
235.                    'headless': 'agg'}
236. 
237.         best_guess = mapping.get(current_framework, None)
238.         if best_guess is not None:
239.             candidates = [best_guess]
240.         else:
241.             candidates = []
242.         candidates += [
243.             "macosx", "qtagg", "gtk4agg", "gtk3agg", "tkagg", "wxagg"]
244. 
245.         # Don't try to fallback on the cairo-based backends as they each have
246.         # an additional dependency (pycairo) over the agg-based backend, and
247.         # are of worse quality.
248.         for candidate in candidates:
249.             try:
250.                 switch_backend(candidate)
251.             except ImportError:
252.                 continue
253.             else:
254.                 rcParamsOrig['backend'] = candidate
255.                 return
256.         else:
257.             # Switching to Agg should always succeed; if it doesn't, let the
258.             # exception propagate out.
259.             switch_backend("agg")
260.             rcParamsOrig["backend"] = "agg"
261.             return
262. 
263.     backend_mod = importlib.import_module(
264.         cbook._backend_module_name(newbackend))
265.     canvas_class = backend_mod.FigureCanvas
266. 
267.     required_framework = _get_required_interactive_framework(backend_mod)
268.     if required_framework is not None:
269.         current_framework = cbook._get_running_interactive_framework()
270.         if (current_framework and required_framework
271.                 and current_framework != required_framework):
272.             raise ImportError(
273.                 "Cannot load backend {!r} which requires the {!r} interactive "
274.                 "framework, as {!r} is currently running".format(
275.                     newbackend, required_framework, current_framework))
276. 
277.     # Load the new_figure_manager(), draw_if_interactive(), and show()
278.     # functions from the backend.
279. 
280.     # Classically, backends can directly export these functions.  This should
281.     # keep working for backcompat.
282.     new_figure_manager = getattr(backend_mod, "new_figure_manager", None)
283.     # draw_if_interactive = getattr(backend_mod, "draw_if_interactive", None)
284.     # show = getattr(backend_mod, "show", None)
285.     # In that classical approach, backends are implemented as modules, but
286.     # "inherit" default method implementations from backend_bases._Backend.
287.     # This is achieved by creating a "class" that inherits from
288.     # backend_bases._Backend and whose body is filled with the module globals.
289.     class backend_mod(matplotlib.backend_bases._Backend):
290.         locals().update(vars(backend_mod))
291. 
292.     # However, the newer approach for defining new_figure_manager (and, in
293.     # the future, draw_if_interactive and show) is to derive them from canvas
294.     # methods.  In that case, also update backend_mod accordingly.
295.     if new_figure_manager is None:
296.         def new_figure_manager_given_figure(num, figure):
297.             return canvas_class.new_manager(figure, num)
298. 
299.         def new_figure_manager(num, *args, FigureClass=Figure, **kwargs):
300.             fig = FigureClass(*args, **kwargs)
301.             return new_figure_manager_given_figure(num, fig)
302. 
303.         backend_mod.new_figure_manager_given_figure = \
304.             new_figure_manager_given_figure
305.         backend_mod.new_figure_manager = new_figure_manager
306. 
307.     _log.debug("Loaded backend %s version %s.",
308.                newbackend, backend_mod.backend_version)
309. 
310.     rcParams['backend'] = rcParamsDefault['backend'] = newbackend
311.     _backend_mod = backend_mod
312.     for func_name in ["new_figure_manager", "draw_if_interactive", "show"]:
313.         globals()[func_name].__signature__ = inspect.signature(
314.             getattr(backend_mod, func_name))
315. 
316.     # Need to keep a global reference to the backend for compatibility reasons.
317.     # See https://github.com/matplotlib/matplotlib/issues/6092
318.     matplotlib.backends.backend = newbackend
319. 
320.     # make sure the repl display hook is installed in case we become
321.     # interactive
322.     install_repl_displayhook()
323. 
324. 
325. def _warn_if_gui_out_of_main_thread():
326.     if (_get_required_interactive_framework(_get_backend_mod())
327.             and threading.current_thread() is not threading.main_thread()):
328.         _api.warn_external(
329.             "Starting a Matplotlib GUI outside of the main thread will likely "
330.             "fail.")
331. 
332. 
333. # This function's signature is rewritten upon backend-load by switch_backend.
334. def new_figure_manager(*args, **kwargs):
335.     """Create a new figure manager instance."""
336.     _warn_if_gui_out_of_main_thread()
337.     return _get_backend_mod().new_figure_manager(*args, **kwargs)
338. 
339. 
340. # This function's signature is rewritten upon backend-load by switch_backend.
341. def draw_if_interactive(*args, **kwargs):
342.     """
343.     Redraw the current figure if in interactive mode.
344. 
345.     .. warning::
346. 
347.         End users will typically not have to call this function because the
348.         the interactive mode takes care of this.
349.     """
350.     return _get_backend_mod().draw_if_interactive(*args, **kwargs)
351. 
352. 
353. # This function's signature is rewritten upon backend-load by switch_backend.
354. def show(*args, **kwargs):
355.     """
356.     Display all open figures.
357. 
358.     Parameters
359.     ----------
360.     block : bool, optional
361.         Whether to wait for all figures to be closed before returning.
362. 
363.         If `True` block and run the GUI main loop until all figure windows
364.         are closed.
365. 
366.         If `False` ensure that all figure windows are displayed and return
367.         immediately.  In this case, you are responsible for ensuring
368.         that the event loop is running to have responsive figures.
369. 
370.         Defaults to True in non-interactive mode and to False in interactive
371.         mode (see `.pyplot.isinteractive`).
372. 
373.     See Also
374.     --------
375.     ion : Enable interactive mode, which shows / updates the figure after
376.           every plotting command, so that calling ``show()`` is not necessary.
377.     ioff : Disable interactive mode.
378.     savefig : Save the figure to an image file instead of showing it on screen.
379. 
380.     Notes
381.     -----
382.     **Saving figures to file and showing a window at the same time**
383. 
384.     If you want an image file as well as a user interface window, use
385.     `.pyplot.savefig` before `.pyplot.show`. At the end of (a blocking)
386.     ``show()`` the figure is closed and thus unregistered from pyplot. Calling
387.     `.pyplot.savefig` afterwards would save a new and thus empty figure. This
388.     limitation of command order does not apply if the show is non-blocking or
389.     if you keep a reference to the figure and use `.Figure.savefig`.
390. 
391.     **Auto-show in jupyter notebooks**
392. 
393.     The jupyter backends (activated via ``%matplotlib inline``,
394.     ``%matplotlib notebook``, or ``%matplotlib widget``), call ``show()`` at
395.     the end of every cell by default. Thus, you usually don't have to call it
396.     explicitly there.
397.     """
398.     _warn_if_gui_out_of_main_thread()
399.     return _get_backend_mod().show(*args, **kwargs)
400. 
401. 
402. def isinteractive():
403.     """
404.     Return whether plots are updated after every plotting command.
405. 
406.     The interactive mode is mainly useful if you build plots from the command
407.     line and want to see the effect of each command while you are building the
408.     figure.
409. 
410.     In interactive mode:
411. 
412.     - newly created figures will be shown immediately;
413.     - figures will automatically redraw on change;
414.     - `.pyplot.show` will not block by default.
415. 
416.     In non-interactive mode:
417. 
418.     - newly created figures and changes to figures will not be reflected until
419.       explicitly asked to be;
420.     - `.pyplot.show` will block by default.
421. 
422.     See Also
423.     --------
424.     ion : Enable interactive mode.
425.     ioff : Disable interactive mode.
426.     show : Show all figures (and maybe block).
427.     pause : Show all figures, and block for a time.
428.     """
429.     return matplotlib.is_interactive()
430. 
431. 
432. class _IoffContext:
433.     """
434.     Context manager for `.ioff`.
435. 
436.     The state is changed in ``__init__()`` instead of ``__enter__()``. The
437.     latter is a no-op. This allows using `.ioff` both as a function and
438.     as a context.
439.     """
440. 
441.     def __init__(self):
442.         self.wasinteractive = isinteractive()
443.         matplotlib.interactive(False)
444.         uninstall_repl_displayhook()
445. 
446.     def __enter__(self):
447.         pass
448. 
449.     def __exit__(self, exc_type, exc_value, traceback):
450.         if self.wasinteractive:
451.             matplotlib.interactive(True)
452.             install_repl_displayhook()
453.         else:
454.             matplotlib.interactive(False)
455.             uninstall_repl_displayhook()
456. 
457. 
458. class _IonContext:
459.     """
460.     Context manager for `.ion`.
461. 
462.     The state is changed in ``__init__()`` instead of ``__enter__()``. The
463.     latter is a no-op. This allows using `.ion` both as a function and
464.     as a context.
465.     """
466. 
467.     def __init__(self):
468.         self.wasinteractive = isinteractive()
469.         matplotlib.interactive(True)
470.         install_repl_displayhook()
471. 
472.     def __enter__(self):
473.         pass
474. 
475.     def __exit__(self, exc_type, exc_value, traceback):
476.         if not self.wasinteractive:
477.             matplotlib.interactive(False)
478.             uninstall_repl_displayhook()
479.         else:
480.             matplotlib.interactive(True)
481.             install_repl_displayhook()
482. 
483. 
484. def ioff():
485.     """
486.     Disable interactive mode.
487. 
488.     See `.pyplot.isinteractive` for more details.
489. 
490.     See Also
491.     --------
492.     ion : Enable interactive mode.
493.     isinteractive : Whether interactive mode is enabled.
494.     show : Show all figures (and maybe block).
495.     pause : Show all figures, and block for a time.
496. 
497.     Notes
498.     -----
499.     For a temporary change, this can be used as a context manager::
500. 


File: lib/matplotlib/rcsetup.py
Line number range: 1 - 500
Content:
1. """
2. The rcsetup module contains the validation code for customization using
3. Matplotlib's rc settings.
4. 
5. Each rc setting is assigned a function used to validate any attempted changes
6. to that setting.  The validation functions are defined in the rcsetup module,
7. and are used to construct the rcParams global object which stores the settings
8. and is referenced throughout Matplotlib.
9. 
10. The default values of the rc settings are set in the default matplotlibrc file.
11. Any additions or deletions to the parameter set listed here should also be
12. propagated to the :file:`matplotlibrc.template` in Matplotlib's root source
13. directory.
14. """
15. 
16. import ast
17. from functools import lru_cache, reduce
18. from numbers import Number
19. import operator
20. import os
21. import re
22. 
23. import numpy as np
24. 
25. from matplotlib import _api, cbook
26. from matplotlib.cbook import ls_mapper
27. from matplotlib.colors import Colormap, is_color_like
28. from matplotlib._fontconfig_pattern import parse_fontconfig_pattern
29. from matplotlib._enums import JoinStyle, CapStyle
30. 
31. # Don't let the original cycler collide with our validating cycler
32. from cycler import Cycler, cycler as ccycler
33. 
34. 
35. # The capitalized forms are needed for ipython at present; this may
36. # change for later versions.
37. interactive_bk = [
38.     'GTK3Agg', 'GTK3Cairo', 'GTK4Agg', 'GTK4Cairo',
39.     'MacOSX',
40.     'nbAgg',
41.     'QtAgg', 'QtCairo', 'Qt5Agg', 'Qt5Cairo',
42.     'TkAgg', 'TkCairo',
43.     'WebAgg',
44.     'WX', 'WXAgg', 'WXCairo',
45. ]
46. non_interactive_bk = ['agg', 'cairo',
47.                       'pdf', 'pgf', 'ps', 'svg', 'template']
48. all_backends = interactive_bk + non_interactive_bk
49. 
50. 
51. class ValidateInStrings:
52.     def __init__(self, key, valid, ignorecase=False, *,
53.                  _deprecated_since=None):
54.         """*valid* is a list of legal strings."""
55.         self.key = key
56.         self.ignorecase = ignorecase
57.         self._deprecated_since = _deprecated_since
58. 
59.         def func(s):
60.             if ignorecase:
61.                 return s.lower()
62.             else:
63.                 return s
64.         self.valid = {func(k): k for k in valid}
65. 
66.     def __call__(self, s):
67.         if self._deprecated_since:
68.             name, = (k for k, v in globals().items() if v is self)
69.             _api.warn_deprecated(
70.                 self._deprecated_since, name=name, obj_type="function")
71.         if self.ignorecase:
72.             s = s.lower()
73.         if s in self.valid:
74.             return self.valid[s]
75.         msg = (f"{s!r} is not a valid value for {self.key}; supported values "
76.                f"are {[*self.valid.values()]}")
77.         if (isinstance(s, str)
78.                 and (s.startswith('"') and s.endswith('"')
79.                      or s.startswith("'") and s.endswith("'"))
80.                 and s[1:-1] in self.valid):
81.             msg += "; remove quotes surrounding your string"
82.         raise ValueError(msg)
83. 
84. 
85. @lru_cache()
86. def _listify_validator(scalar_validator, allow_stringlist=False, *,
87.                        n=None, doc=None):
88.     def f(s):
89.         if isinstance(s, str):
90.             try:
91.                 val = [scalar_validator(v.strip()) for v in s.split(',')
92.                        if v.strip()]
93.             except Exception:
94.                 if allow_stringlist:
95.                     # Sometimes, a list of colors might be a single string
96.                     # of single-letter colornames. So give that a shot.
97.                     val = [scalar_validator(v.strip()) for v in s if v.strip()]
98.                 else:
99.                     raise
100.         # Allow any ordered sequence type -- generators, np.ndarray, pd.Series
101.         # -- but not sets, whose iteration order is non-deterministic.
102.         elif np.iterable(s) and not isinstance(s, (set, frozenset)):
103.             # The condition on this list comprehension will preserve the
104.             # behavior of filtering out any empty strings (behavior was
105.             # from the original validate_stringlist()), while allowing
106.             # any non-string/text scalar values such as numbers and arrays.
107.             val = [scalar_validator(v) for v in s
108.                    if not isinstance(v, str) or v]
109.         else:
110.             raise ValueError(
111.                 f"Expected str or other non-set iterable, but got {s}")
112.         if n is not None and len(val) != n:
113.             raise ValueError(
114.                 f"Expected {n} values, but there are {len(val)} values in {s}")
115.         return val
116. 
117.     try:
118.         f.__name__ = "{}list".format(scalar_validator.__name__)
119.     except AttributeError:  # class instance.
120.         f.__name__ = "{}List".format(type(scalar_validator).__name__)
121.     f.__qualname__ = f.__qualname__.rsplit(".", 1)[0] + "." + f.__name__
122.     f.__doc__ = doc if doc is not None else scalar_validator.__doc__
123.     return f
124. 
125. 
126. def validate_any(s):
127.     return s
128. validate_anylist = _listify_validator(validate_any)
129. 
130. 
131. def _validate_date(s):
132.     try:
133.         np.datetime64(s)
134.         return s
135.     except ValueError:
136.         raise ValueError(
137.             f'{s!r} should be a string that can be parsed by numpy.datetime64')
138. 
139. 
140. def validate_bool(b):
141.     """Convert b to ``bool`` or raise."""
142.     if isinstance(b, str):
143.         b = b.lower()
144.     if b in ('t', 'y', 'yes', 'on', 'true', '1', 1, True):
145.         return True
146.     elif b in ('f', 'n', 'no', 'off', 'false', '0', 0, False):
147.         return False
148.     else:
149.         raise ValueError(f'Cannot convert {b!r} to bool')
150. 
151. 
152. def validate_axisbelow(s):
153.     try:
154.         return validate_bool(s)
155.     except ValueError:
156.         if isinstance(s, str):
157.             if s == 'line':
158.                 return 'line'
159.     raise ValueError(f'{s!r} cannot be interpreted as'
160.                      ' True, False, or "line"')
161. 
162. 
163. def validate_dpi(s):
164.     """Confirm s is string 'figure' or convert s to float or raise."""
165.     if s == 'figure':
166.         return s
167.     try:
168.         return float(s)
169.     except ValueError as e:
170.         raise ValueError(f'{s!r} is not string "figure" and '
171.                          f'could not convert {s!r} to float') from e
172. 
173. 
174. def _make_type_validator(cls, *, allow_none=False):
175.     """
176.     Return a validator that converts inputs to *cls* or raises (and possibly
177.     allows ``None`` as well).
178.     """
179. 
180.     def validator(s):
181.         if (allow_none and
182.                 (s is None or isinstance(s, str) and s.lower() == "none")):
183.             return None
184.         if cls is str and not isinstance(s, str):
185.             _api.warn_deprecated(
186.                 "3.5", message="Support for setting an rcParam that expects a "
187.                 "str value to a non-str value is deprecated since %(since)s "
188.                 "and support will be removed %(removal)s.")
189.         try:
190.             return cls(s)
191.         except (TypeError, ValueError) as e:
192.             raise ValueError(
193.                 f'Could not convert {s!r} to {cls.__name__}') from e
194. 
195.     validator.__name__ = f"validate_{cls.__name__}"
196.     if allow_none:
197.         validator.__name__ += "_or_None"
198.     validator.__qualname__ = (
199.         validator.__qualname__.rsplit(".", 1)[0] + "." + validator.__name__)
200.     return validator
201. 
202. 
203. validate_string = _make_type_validator(str)
204. validate_string_or_None = _make_type_validator(str, allow_none=True)
205. validate_stringlist = _listify_validator(
206.     validate_string, doc='return a list of strings')
207. validate_int = _make_type_validator(int)
208. validate_int_or_None = _make_type_validator(int, allow_none=True)
209. validate_float = _make_type_validator(float)
210. validate_float_or_None = _make_type_validator(float, allow_none=True)
211. validate_floatlist = _listify_validator(
212.     validate_float, doc='return a list of floats')
213. 
214. 
215. def _validate_pathlike(s):
216.     if isinstance(s, (str, os.PathLike)):
217.         # Store value as str because savefig.directory needs to distinguish
218.         # between "" (cwd) and "." (cwd, but gets updated by user selections).
219.         return os.fsdecode(s)
220.     else:
221.         return validate_string(s)  # Emit deprecation warning.
222. 
223. 
224. def validate_fonttype(s):
225.     """
226.     Confirm that this is a Postscript or PDF font type that we know how to
227.     convert to.
228.     """
229.     fonttypes = {'type3':    3,
230.                  'truetype': 42}
231.     try:
232.         fonttype = validate_int(s)
233.     except ValueError:
234.         try:
235.             return fonttypes[s.lower()]
236.         except KeyError as e:
237.             raise ValueError('Supported Postscript/PDF font types are %s'
238.                              % list(fonttypes)) from e
239.     else:
240.         if fonttype not in fonttypes.values():
241.             raise ValueError(
242.                 'Supported Postscript/PDF font types are %s' %
243.                 list(fonttypes.values()))
244.         return fonttype
245. 
246. 
247. _validate_standard_backends = ValidateInStrings(
248.     'backend', all_backends, ignorecase=True)
249. _auto_backend_sentinel = object()
250. 
251. 
252. def validate_backend(s):
253.     backend = (
254.         s if s is _auto_backend_sentinel or s.startswith("module://")
255.         else _validate_standard_backends(s))
256.     return backend
257. 
258. 
259. def _validate_toolbar(s):
260.     s = ValidateInStrings(
261.         'toolbar', ['None', 'toolbar2', 'toolmanager'], ignorecase=True)(s)
262.     if s == 'toolmanager':
263.         _api.warn_external(
264.             "Treat the new Tool classes introduced in v1.5 as experimental "
265.             "for now; the API and rcParam may change in future versions.")
266.     return s
267. 
268. 
269. def validate_color_or_inherit(s):
270.     """Return a valid color arg."""
271.     if cbook._str_equal(s, 'inherit'):
272.         return s
273.     return validate_color(s)
274. 
275. 
276. def validate_color_or_auto(s):
277.     if cbook._str_equal(s, 'auto'):
278.         return s
279.     return validate_color(s)
280. 
281. 
282. def validate_color_for_prop_cycle(s):
283.     # N-th color cycle syntax can't go into the color cycle.
284.     if isinstance(s, str) and re.match("^C[0-9]$", s):
285.         raise ValueError(f"Cannot put cycle reference ({s!r}) in prop_cycler")
286.     return validate_color(s)
287. 
288. 
289. def _validate_color_or_linecolor(s):
290.     if cbook._str_equal(s, 'linecolor'):
291.         return s
292.     elif cbook._str_equal(s, 'mfc') or cbook._str_equal(s, 'markerfacecolor'):
293.         return 'markerfacecolor'
294.     elif cbook._str_equal(s, 'mec') or cbook._str_equal(s, 'markeredgecolor'):
295.         return 'markeredgecolor'
296.     elif s is None:
297.         return None
298.     elif isinstance(s, str) and len(s) == 6 or len(s) == 8:
299.         stmp = '#' + s
300.         if is_color_like(stmp):
301.             return stmp
302.         if s.lower() == 'none':
303.             return None
304.     elif is_color_like(s):
305.         return s
306. 
307.     raise ValueError(f'{s!r} does not look like a color arg')
308. 
309. 
310. def validate_color(s):
311.     """Return a valid color arg."""
312.     if isinstance(s, str):
313.         if s.lower() == 'none':
314.             return 'none'
315.         if len(s) == 6 or len(s) == 8:
316.             stmp = '#' + s
317.             if is_color_like(stmp):
318.                 return stmp
319. 
320.     if is_color_like(s):
321.         return s
322. 
323.     # If it is still valid, it must be a tuple (as a string from matplotlibrc).
324.     try:
325.         color = ast.literal_eval(s)
326.     except (SyntaxError, ValueError):
327.         pass
328.     else:
329.         if is_color_like(color):
330.             return color
331. 
332.     raise ValueError(f'{s!r} does not look like a color arg')
333. 
334. 
335. validate_colorlist = _listify_validator(
336.     validate_color, allow_stringlist=True, doc='return a list of colorspecs')
337. 
338. 
339. def _validate_cmap(s):
340.     _api.check_isinstance((str, Colormap), cmap=s)
341.     return s
342. 
343. 
344. def validate_aspect(s):
345.     if s in ('auto', 'equal'):
346.         return s
347.     try:
348.         return float(s)
349.     except ValueError as e:
350.         raise ValueError('not a valid aspect specification') from e
351. 
352. 
353. def validate_fontsize_None(s):
354.     if s is None or s == 'None':
355.         return None
356.     else:
357.         return validate_fontsize(s)
358. 
359. 
360. def validate_fontsize(s):
361.     fontsizes = ['xx-small', 'x-small', 'small', 'medium', 'large',
362.                  'x-large', 'xx-large', 'smaller', 'larger']
363.     if isinstance(s, str):
364.         s = s.lower()
365.     if s in fontsizes:
366.         return s
367.     try:
368.         return float(s)
369.     except ValueError as e:
370.         raise ValueError("%s is not a valid font size. Valid font sizes "
371.                          "are %s." % (s, ", ".join(fontsizes))) from e
372. 
373. 
374. validate_fontsizelist = _listify_validator(validate_fontsize)
375. 
376. 
377. def validate_fontweight(s):
378.     weights = [
379.         'ultralight', 'light', 'normal', 'regular', 'book', 'medium', 'roman',
380.         'semibold', 'demibold', 'demi', 'bold', 'heavy', 'extra bold', 'black']
381.     # Note: Historically, weights have been case-sensitive in Matplotlib
382.     if s in weights:
383.         return s
384.     try:
385.         return int(s)
386.     except (ValueError, TypeError) as e:
387.         raise ValueError(f'{s} is not a valid font weight.') from e
388. 
389. 
390. def validate_fontstretch(s):
391.     stretchvalues = [
392.         'ultra-condensed', 'extra-condensed', 'condensed', 'semi-condensed',
393.         'normal', 'semi-expanded', 'expanded', 'extra-expanded',
394.         'ultra-expanded']
395.     # Note: Historically, stretchvalues have been case-sensitive in Matplotlib
396.     if s in stretchvalues:
397.         return s
398.     try:
399.         return int(s)
400.     except (ValueError, TypeError) as e:
401.         raise ValueError(f'{s} is not a valid font stretch.') from e
402. 
403. 
404. def validate_font_properties(s):
405.     parse_fontconfig_pattern(s)
406.     return s
407. 
408. 
409. def _validate_mathtext_fallback(s):
410.     _fallback_fonts = ['cm', 'stix', 'stixsans']
411.     if isinstance(s, str):
412.         s = s.lower()
413.     if s is None or s == 'none':
414.         return None
415.     elif s.lower() in _fallback_fonts:
416.         return s
417.     else:
418.         raise ValueError(
419.             f"{s} is not a valid fallback font name. Valid fallback font "
420.             f"names are {','.join(_fallback_fonts)}. Passing 'None' will turn "
421.             "fallback off.")
422. 
423. 
424. def validate_whiskers(s):
425.     try:
426.         return _listify_validator(validate_float, n=2)(s)
427.     except (TypeError, ValueError):
428.         try:
429.             return float(s)
430.         except ValueError as e:
431.             raise ValueError("Not a valid whisker value [float, "
432.                              "(float, float)]") from e
433. 
434. 
435. def validate_ps_distiller(s):
436.     if isinstance(s, str):
437.         s = s.lower()
438.     if s in ('none', None, 'false', False):
439.         return None
440.     else:
441.         return ValidateInStrings('ps.usedistiller', ['ghostscript', 'xpdf'])(s)
442. 
443. 
444. # A validator dedicated to the named line styles, based on the items in
445. # ls_mapper, and a list of possible strings read from Line2D.set_linestyle
446. _validate_named_linestyle = ValidateInStrings(
447.     'linestyle',
448.     [*ls_mapper.keys(), *ls_mapper.values(), 'None', 'none', ' ', ''],
449.     ignorecase=True)
450. 
451. 
452. def _validate_linestyle(ls):
453.     """
454.     A validator for all possible line styles, the named ones *and*
455.     the on-off ink sequences.
456.     """
457.     if isinstance(ls, str):
458.         try:  # Look first for a valid named line style, like '--' or 'solid'.
459.             return _validate_named_linestyle(ls)
460.         except ValueError:
461.             pass
462.         try:
463.             ls = ast.literal_eval(ls)  # Parsing matplotlibrc.
464.         except (SyntaxError, ValueError):
465.             pass  # Will error with the ValueError at the end.
466. 
467.     def _is_iterable_not_string_like(x):
468.         # Explicitly exclude bytes/bytearrays so that they are not
469.         # nonsensically interpreted as sequences of numbers (codepoints).
470.         return np.iterable(x) and not isinstance(x, (str, bytes, bytearray))
471. 
472.     if _is_iterable_not_string_like(ls):
473.         if len(ls) == 2 and _is_iterable_not_string_like(ls[1]):
474.             # (offset, (on, off, on, off, ...))
475.             offset, onoff = ls
476.         else:
477.             # For backcompat: (on, off, on, off, ...); the offset is implicit.
478.             offset = 0
479.             onoff = ls
480. 
481.         if (isinstance(offset, Number)
482.                 and len(onoff) % 2 == 0
483.                 and all(isinstance(elem, Number) for elem in onoff)):
484.             return (offset, onoff)
485. 
486.     raise ValueError(f"linestyle {ls!r} is not a valid on-off ink sequence.")
487. 
488. 
489. validate_fillstyle = ValidateInStrings(
490.     'markers.fillstyle', ['full', 'left', 'right', 'bottom', 'top', 'none'])
491. 
492. 
493. validate_fillstylelist = _listify_validator(validate_fillstyle)
494. 
495. 
496. def validate_markevery(s):
497.     """
498.     Validate the markevery property of a Line2D object.
499. 
500.     Parameters

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-24 03:11:05,922 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The analysis of the bug depends on the implementation of `RcParams.__getitem__`, `get_backend`, and `rc_context`, which are all located in `lib/matplotlib/__init__.py`. The previously provided context for this file was truncated and did not include these critical components. Therefore, the full content of this file is necessary to understand the root cause of the issue and validate the provided patch.' query='Please provide the full content of `lib/matplotlib/__init__.py`.' extra_requirements='If the full file is too large, please provide at least the complete class definition for `RcParams`, and the full function definitions for `get_backend` and `rc_context`.' purpose='To examine the interaction between `rc_context`, `rcParams`, and `get_backend` that leads to the erroneous clearing of figures.'
2025-12-24 03:11:05,923 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `lib/matplotlib/__init__.py`.
2025-12-24 03:11:05,923 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-24 03:11:05,924 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-24 03:11:05,925 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-24 03:11:05,925 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `lib/matplotlib/__init__.py`.
Extra requirements: If the full file is too large, please provide at least the complete class definition for `RcParams`, and the full function definitions for `get_backend` and `rc_context`.
Purpose: To examine the interaction between `rc_context`, `rcParams`, and `get_backend` that leads to the erroneous clearing of figures.
2025-12-24 03:11:10,476 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have started by reading the entire content of the file `lib/matplotlib/__init__.py` to provide you with the full context of the code. This will help in understanding the interactions between different components within the file.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "lib/matplotlib/__init__.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2170, 'candidates_token_count': 66, 'total_token_count': 2573, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2170}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 66}], 'thoughts_token_count': 337, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.3106323010993726, 'model_name': 'gemini-2.5-pro'} id='run--66356c0b-64bd-461d-b518-701af0990f15-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'lib/matplotlib/__init__.py'}, 'id': '652b373d-9614-471b-bcc8-aed3e957f538', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2170, 'output_tokens': 66, 'total_tokens': 2573, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 337}}
2025-12-24 03:11:14,084 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I was able to read the first 500 lines of the file `lib/matplotlib/__init__.py`. Since the file is larger than that, I will now read the remaining lines to provide you with the complete content.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 501.0, "relative_path": "lib/matplotlib/__init__.py", "end_line": 5000.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 9234, 'candidates_token_count': 74, 'total_token_count': 9496, 'cached_content_token_count': 1834, 'prompt_tokens_details': [{'modality': 1, 'token_count': 9234}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1834}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 74}], 'thoughts_token_count': 188}, 'finish_reason': 'STOP', 'avg_logprobs': -0.3980493803282042, 'model_name': 'gemini-2.5-pro'} id='run--df551315-9645-483a-b138-a497c85825cb-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 501.0, 'relative_path': 'lib/matplotlib/__init__.py', 'end_line': 5000.0}, 'id': 'dd88f0a6-e5d0-4bbd-82c4-7cb1ef8d32d7', 'type': 'tool_call'}] usage_metadata={'input_tokens': 9234, 'output_tokens': 74, 'total_tokens': 9496, 'input_token_details': {'cache_read': 1834}, 'output_token_details': {'reasoning': 188}}
2025-12-24 03:11:33,805 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have successfully retrieved the entire content of `lib/matplotlib/__init__.py` for you. The file was read in two parts, both of which are available for your review in the previous steps. I have also extracted the specific definitions for the `RcParams` class, and the `get_backend` and `rc_context` functions as you requested to help you analyze the interactions between them.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'citation_metadata': {'citations': [{'start_index': 1363, 'end_index': 1703, 'uri': 'https://github.com/matplotlib/matplotlib', 'title': '', 'license_': ''}, {'start_index': 2452, 'end_index': 3284, 'uri': 'https://matplotlib.org/3.3.0/_modules/matplotlib.html', 'title': '', 'license_': ''}, {'start_index': 3716, 'end_index': 3990, 'uri': 'https://github.com/matplotlib/matplotlib', 'title': '', 'license_': ''}, {'start_index': 4395, 'end_index': 4800, 'uri': 'https://github.com/matplotlib/matplotlib', 'title': '', 'license_': ''}, {'start_index': 4608, 'end_index': 5085, 'uri': 'https://matplotlib.org/3.3.0/_modules/matplotlib.html', 'title': '', 'license_': ''}, {'start_index': 5093, 'end_index': 5401, 'uri': 'https://github.com/matplotlib/matplotlib', 'title': '', 'license_': ''}, {'start_index': 5250, 'end_index': 5604, 'uri': 'https://matplotlib.org/2.2.4/_modules/matplotlib.html', 'title': '', 'license_': ''}, {'start_index': 5451, 'end_index': 5767, 'uri': 'https://arviz-devs.github.io/arviz/_modules/arviz/rcparams.html', 'title': '', 'license_': ''}, {'start_index': 6207, 'end_index': 7278, 'uri': 'https://matplotlib.org/3.3.0/_modules/matplotlib.html', 'title': '', 'license_': ''}]}, 'usage_metadata': {'prompt_token_count': 23721, 'candidates_token_count': 82, 'total_token_count': 25997, 'cached_content_token_count': 9621, 'prompt_tokens_details': [{'modality': 1, 'token_count': 23721}], 'cache_tokens_details': [{'modality': 1, 'token_count': 9621}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 82}], 'thoughts_token_count': 2194}, 'finish_reason': 'STOP', 'avg_logprobs': -1.3745980611661586, 'model_name': 'gemini-2.5-pro'} id='run--6b04167f-66f2-4a17-b587-5328c3e7a7bd-0' usage_metadata={'input_tokens': 23721, 'output_tokens': 82, 'total_tokens': 25997, 'input_token_details': {'cache_read': 9621}, 'output_token_details': {'reasoning': 2194}}
2025-12-24 03:11:33,807 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `lib/matplotlib/__init__.py`.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If the full file is too large, please provide at least the complete class definition for `RcParams`, and the full function definitions for `get_backend` and `rc_context`.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
To examine the interaction between `rc_context`, `rcParams`, and `get_backend` that leads to the erroneous clearing of figures.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: lib/matplotlib/__init__.py
Line number range: 1 - 500
Content:
1. """
2. An object-oriented plotting library.
3. 
4. A procedural interface is provided by the companion pyplot module,
5. which may be imported directly, e.g.::
6. 
7.     import matplotlib.pyplot as plt
8. 
9. or using ipython::
10. 
11.     ipython
12. 
13. at your terminal, followed by::
14. 
15.     In [1]: %matplotlib
16.     In [2]: import matplotlib.pyplot as plt
17. 
18. at the ipython shell prompt.
19. 
20. For the most part, direct use of the explicit object-oriented library is
21. encouraged when programming; the implicit pyplot interface is primarily for
22. working interactively. The exceptions to this suggestion are the pyplot
23. functions `.pyplot.figure`, `.pyplot.subplot`, `.pyplot.subplots`, and
24. `.pyplot.savefig`, which can greatly simplify scripting.  See
25. :ref:`api_interfaces` for an explanation of the tradeoffs between the implicit
26. and explicit interfaces.
27. 
28. Modules include:
29. 
30.     :mod:`matplotlib.axes`
31.         The `~.axes.Axes` class.  Most pyplot functions are wrappers for
32.         `~.axes.Axes` methods.  The axes module is the highest level of OO
33.         access to the library.
34. 
35.     :mod:`matplotlib.figure`
36.         The `.Figure` class.
37. 
38.     :mod:`matplotlib.artist`
39.         The `.Artist` base class for all classes that draw things.
40. 
41.     :mod:`matplotlib.lines`
42.         The `.Line2D` class for drawing lines and markers.
43. 
44.     :mod:`matplotlib.patches`
45.         Classes for drawing polygons.
46. 
47.     :mod:`matplotlib.text`
48.         The `.Text` and `.Annotation` classes.
49. 
50.     :mod:`matplotlib.image`
51.         The `.AxesImage` and `.FigureImage` classes.
52. 
53.     :mod:`matplotlib.collections`
54.         Classes for efficient drawing of groups of lines or polygons.
55. 
56.     :mod:`matplotlib.colors`
57.         Color specifications and making colormaps.
58. 
59.     :mod:`matplotlib.cm`
60.         Colormaps, and the `.ScalarMappable` mixin class for providing color
61.         mapping functionality to other classes.
62. 
63.     :mod:`matplotlib.ticker`
64.         Calculation of tick mark locations and formatting of tick labels.
65. 
66.     :mod:`matplotlib.backends`
67.         A subpackage with modules for various GUI libraries and output formats.
68. 
69. The base matplotlib namespace includes:
70. 
71.     `~matplotlib.rcParams`
72.         Default configuration settings; their defaults may be overridden using
73.         a :file:`matplotlibrc` file.
74. 
75.     `~matplotlib.use`
76.         Setting the Matplotlib backend.  This should be called before any
77.         figure is created, because it is not possible to switch between
78.         different GUI backends after that.
79. 
80. Matplotlib was initially written by John D. Hunter (1968-2012) and is now
81. developed and maintained by a host of others.
82. 
83. Occasionally the internal documentation (python docstrings) will refer
84. to MATLAB&reg;, a registered trademark of The MathWorks, Inc.
85. 
86. """
87. 
88. import atexit
89. from collections import namedtuple
90. from collections.abc import MutableMapping
91. import contextlib
92. import functools
93. import importlib
94. import inspect
95. from inspect import Parameter
96. import locale
97. import logging
98. import os
99. from pathlib import Path
100. import pprint
101. import re
102. import shutil
103. import subprocess
104. import sys
105. import tempfile
106. import warnings
107. 
108. import numpy
109. from packaging.version import parse as parse_version
110. 
111. # cbook must import matplotlib only within function
112. # definitions, so it is safe to import from it here.
113. from . import _api, _version, cbook, _docstring, rcsetup
114. from matplotlib.cbook import sanitize_sequence
115. from matplotlib._api import MatplotlibDeprecationWarning
116. from matplotlib.rcsetup import validate_backend, cycler
117. 
118. 
119. _log = logging.getLogger(__name__)
120. 
121. __bibtex__ = r"""@Article{Hunter:2007,
122.   Author    = {Hunter, J. D.},
123.   Title     = {Matplotlib: A 2D graphics environment},
124.   Journal   = {Computing in Science \& Engineering},
125.   Volume    = {9},
126.   Number    = {3},
127.   Pages     = {90--95},
128.   abstract  = {Matplotlib is a 2D graphics package used for Python
129.   for application development, interactive scripting, and
130.   publication-quality image generation across user
131.   interfaces and operating systems.},
132.   publisher = {IEEE COMPUTER SOC},
133.   year      = 2007
134. }"""
135. 
136. # modelled after sys.version_info
137. _VersionInfo = namedtuple('_VersionInfo',
138.                           'major, minor, micro, releaselevel, serial')
139. 
140. 
141. def _parse_to_version_info(version_str):
142.     """
143.     Parse a version string to a namedtuple analogous to sys.version_info.
144. 
145.     See:
146.     https://packaging.pypa.io/en/latest/version.html#packaging.version.parse
147.     https://docs.python.org/3/library/sys.html#sys.version_info
148.     """
149.     v = parse_version(version_str)
150.     if v.pre is None and v.post is None and v.dev is None:
151.         return _VersionInfo(v.major, v.minor, v.micro, 'final', 0)
152.     elif v.dev is not None:
153.         return _VersionInfo(v.major, v.minor, v.micro, 'alpha', v.dev)
154.     elif v.pre is not None:
155.         releaselevel = {
156.             'a': 'alpha',
157.             'b': 'beta',
158.             'rc': 'candidate'}.get(v.pre[0], 'alpha')
159.         return _VersionInfo(v.major, v.minor, v.micro, releaselevel, v.pre[1])
160.     else:
161.         # fallback for v.post: guess-next-dev scheme from setuptools_scm
162.         return _VersionInfo(v.major, v.minor, v.micro + 1, 'alpha', v.post)
163. 
164. 
165. def _get_version():
166.     """Return the version string used for __version__."""
167.     # Only shell out to a git subprocess if really needed, i.e. when we are in
168.     # a matplotlib git repo but not in a shallow clone, such as those used by
169.     # CI, as the latter would trigger a warning from setuptools_scm.
170.     root = Path(__file__).resolve().parents[2]
171.     if ((root / ".matplotlib-repo").exists()
172.             and (root / ".git").exists()
173.             and not (root / ".git/shallow").exists()):
174.         import setuptools_scm
175.         return setuptools_scm.get_version(
176.             root=root,
177.             version_scheme="release-branch-semver",
178.             local_scheme="node-and-date",
179.             fallback_version=_version.version,
180.         )
181.     else:  # Get the version from the _version.py setuptools_scm file.
182.         return _version.version
183. 
184. 
185. @_api.caching_module_getattr
186. class __getattr__:
187.     __version__ = property(lambda self: _get_version())
188.     __version_info__ = property(
189.         lambda self: _parse_to_version_info(self.__version__))
190.     # module-level deprecations
191.     URL_REGEX = _api.deprecated("3.5", obj_type="")(property(
192.         lambda self: re.compile(r'^http://|^https://|^ftp://|^file:')))
193. 
194. 
195. def _check_versions():
196. 
197.     # Quickfix to ensure Microsoft Visual C++ redistributable
198.     # DLLs are loaded before importing kiwisolver
199.     from . import ft2font
200. 
201.     for modname, minver in [
202.             ("cycler", "0.10"),
203.             ("dateutil", "2.7"),
204.             ("kiwisolver", "1.0.1"),
205.             ("numpy", "1.19"),
206.             ("pyparsing", "2.2.1"),
207.     ]:
208.         module = importlib.import_module(modname)
209.         if parse_version(module.__version__) < parse_version(minver):
210.             raise ImportError(f"Matplotlib requires {modname}>={minver}; "
211.                               f"you have {module.__version__}")
212. 
213. 
214. _check_versions()
215. 
216. 
217. # The decorator ensures this always returns the same handler (and it is only
218. # attached once).
219. @functools.lru_cache()
220. def _ensure_handler():
221.     """
222.     The first time this function is called, attach a `StreamHandler` using the
223.     same format as `logging.basicConfig` to the Matplotlib root logger.
224. 
225.     Return this handler every time this function is called.
226.     """
227.     handler = logging.StreamHandler()
228.     handler.setFormatter(logging.Formatter(logging.BASIC_FORMAT))
229.     _log.addHandler(handler)
230.     return handler
231. 
232. 
233. def set_loglevel(level):
234.     """
235.     Set Matplotlib's root logger and root logger handler level, creating
236.     the handler if it does not exist yet.
237. 
238.     Typically, one should call ``set_loglevel("info")`` or
239.     ``set_loglevel("debug")`` to get additional debugging information.
240. 
241.     Parameters
242.     ----------
243.     level : {"notset", "debug", "info", "warning", "error", "critical"}
244.         The log level of the handler.
245. 
246.     Notes
247.     -----
248.     The first time this function is called, an additional handler is attached
249.     to Matplotlib's root handler; this handler is reused every time and this
250.     function simply manipulates the logger and handler's level.
251.     """
252.     _log.setLevel(level.upper())
253.     _ensure_handler().setLevel(level.upper())
254. 
255. 
256. def _logged_cached(fmt, func=None):
257.     """
258.     Decorator that logs a function's return value, and memoizes that value.
259. 
260.     After ::
261. 
262.         @_logged_cached(fmt)
263.         def func(): ...
264. 
265.     the first call to *func* will log its return value at the DEBUG level using
266.     %-format string *fmt*, and memoize it; later calls to *func* will directly
267.     return that value.
268.     """
269.     if func is None:  # Return the actual decorator.
270.         return functools.partial(_logged_cached, fmt)
271. 
272.     called = False
273.     ret = None
274. 
275.     @functools.wraps(func)
276.     def wrapper(**kwargs):
277.         nonlocal called, ret
278.         if not called:
279.             ret = func(**kwargs)
280.             called = True
281.             _log.debug(fmt, ret)
282.         return ret
283. 
284.     return wrapper
285. 
286. 
287. _ExecInfo = namedtuple("_ExecInfo", "executable raw_version version")
288. 
289. 
290. class ExecutableNotFoundError(FileNotFoundError):
291.     """
292.     Error raised when an executable that Matplotlib optionally
293.     depends on can't be found.
294.     """
295.     pass
296. 
297. 
298. @functools.lru_cache()
299. def _get_executable_info(name):
300.     """
301.     Get the version of some executable that Matplotlib optionally depends on.
302. 
303.     .. warning::
304.        The list of executables that this function supports is set according to
305.        Matplotlib's internal needs, and may change without notice.
306. 
307.     Parameters
308.     ----------
309.     name : str
310.         The executable to query.  The following values are currently supported:
311.         "dvipng", "gs", "inkscape", "magick", "pdftocairo", "pdftops".  This
312.         list is subject to change without notice.
313. 
314.     Returns
315.     -------
316.     tuple
317.         A namedtuple with fields ``executable`` (`str`) and ``version``
318.         (`packaging.Version`, or ``None`` if the version cannot be determined).
319. 
320.     Raises
321.     ------
322.     ExecutableNotFoundError
323.         If the executable is not found or older than the oldest version
324.         supported by Matplotlib.  For debugging purposes, it is also
325.         possible to "hide" an executable from Matplotlib by adding it to the
326.         :envvar:`_MPLHIDEEXECUTABLES` environment variable (a comma-separated
327.         list), which must be set prior to any calls to this function.
328.     ValueError
329.         If the executable is not one that we know how to query.
330.     """
331. 
332.     def impl(args, regex, min_ver=None, ignore_exit_code=False):
333.         # Execute the subprocess specified by args; capture stdout and stderr.
334.         # Search for a regex match in the output; if the match succeeds, the
335.         # first group of the match is the version.
336.         # Return an _ExecInfo if the executable exists, and has a version of
337.         # at least min_ver (if set); else, raise ExecutableNotFoundError.
338.         try:
339.             output = subprocess.check_output(
340.                 args, stderr=subprocess.STDOUT,
341.                 universal_newlines=True, errors="replace")
342.         except subprocess.CalledProcessError as _cpe:
343.             if ignore_exit_code:
344.                 output = _cpe.output
345.             else:
346.                 raise ExecutableNotFoundError(str(_cpe)) from _cpe
347.         except OSError as _ose:
348.             raise ExecutableNotFoundError(str(_ose)) from _ose
349.         match = re.search(regex, output)
350.         if match:
351.             raw_version = match.group(1)
352.             version = parse_version(raw_version)
353.             if min_ver is not None and version < parse_version(min_ver):
354.                 raise ExecutableNotFoundError(
355.                     f"You have {args[0]} version {version} but the minimum "
356.                     f"version supported by Matplotlib is {min_ver}")
357.             return _ExecInfo(args[0], raw_version, version)
358.         else:
359.             raise ExecutableNotFoundError(
360.                 f"Failed to determine the version of {args[0]} from "
361.                 f"{' '.join(args)}, which output {output}")
362. 
363.     if name in os.environ.get("_MPLHIDEEXECUTABLES", "").split(","):
364.         raise ExecutableNotFoundError(f"{name} was hidden")
365. 
366.     if name == "dvipng":
367.         return impl(["dvipng", "-version"], "(?m)^dvipng(?: .*)? (.+)", "1.6")
368.     elif name == "gs":
369.         execs = (["gswin32c", "gswin64c", "mgs", "gs"]  # "mgs" for miktex.
370.                  if sys.platform == "win32" else
371.                  ["gs"])
372.         for e in execs:
373.             try:
374.                 return impl([e, "--version"], "(.*)", "9")
375.             except ExecutableNotFoundError:
376.                 pass
377.         message = "Failed to find a Ghostscript installation"
378.         raise ExecutableNotFoundError(message)
379.     elif name == "inkscape":
380.         try:
381.             # Try headless option first (needed for Inkscape version < 1.0):
382.             return impl(["inkscape", "--without-gui", "-V"],
383.                         "Inkscape ([^ ]*)")
384.         except ExecutableNotFoundError:
385.             pass  # Suppress exception chaining.
386.         # If --without-gui is not accepted, we may be using Inkscape >= 1.0 so
387.         # try without it:
388.         return impl(["inkscape", "-V"], "Inkscape ([^ ]*)")
389.     elif name == "magick":
390.         if sys.platform == "win32":
391.             # Check the registry to avoid confusing ImageMagick's convert with
392.             # Windows's builtin convert.exe.
393.             import winreg
394.             binpath = ""
395.             for flag in [0, winreg.KEY_WOW64_32KEY, winreg.KEY_WOW64_64KEY]:
396.                 try:
397.                     with winreg.OpenKeyEx(
398.                             winreg.HKEY_LOCAL_MACHINE,
399.                             r"Software\Imagemagick\Current",
400.                             0, winreg.KEY_QUERY_VALUE | flag) as hkey:
401.                         binpath = winreg.QueryValueEx(hkey, "BinPath")[0]
402.                 except OSError:
403.                     pass
404.             path = None
405.             if binpath:
406.                 for name in ["convert.exe", "magick.exe"]:
407.                     candidate = Path(binpath, name)
408.                     if candidate.exists():
409.                         path = str(candidate)
410.                         break
411.             if path is None:
412.                 raise ExecutableNotFoundError(
413.                     "Failed to find an ImageMagick installation")
414.         else:
415.             path = "convert"
416.         info = impl([path, "--version"], r"^Version: ImageMagick (\S*)")
417.         if info.raw_version == "7.0.10-34":
418.             # https://github.com/ImageMagick/ImageMagick/issues/2720
419.             raise ExecutableNotFoundError(
420.                 f"You have ImageMagick {info.version}, which is unsupported")
421.         return info
422.     elif name == "pdftocairo":
423.         return impl(["pdftocairo", "-v"], "pdftocairo version (.*)")
424.     elif name == "pdftops":
425.         info = impl(["pdftops", "-v"], "^pdftops version (.*)",
426.                     ignore_exit_code=True)
427.         if info and not (
428.                 3 <= info.version.major or
429.                 # poppler version numbers.
430.                 parse_version("0.9") <= info.version < parse_version("1.0")):
431.             raise ExecutableNotFoundError(
432.                 f"You have pdftops version {info.version} but the minimum "
433.                 f"version supported by Matplotlib is 3.0")
434.         return info
435.     else:
436.         raise ValueError("Unknown executable: {!r}".format(name))
437. 
438. 
439. @_api.deprecated("3.6", alternative="Vendor the code")
440. def checkdep_usetex(s):
441.     if not s:
442.         return False
443.     if not shutil.which("tex"):
444.         _log.warning("usetex mode requires TeX.")
445.         return False
446.     try:
447.         _get_executable_info("dvipng")
448.     except ExecutableNotFoundError:
449.         _log.warning("usetex mode requires dvipng.")
450.         return False
451.     try:
452.         _get_executable_info("gs")
453.     except ExecutableNotFoundError:
454.         _log.warning("usetex mode requires ghostscript.")
455.         return False
456.     return True
457. 
458. 
459. def _get_xdg_config_dir():
460.     """
461.     Return the XDG configuration directory, according to the XDG base
462.     directory spec:
463. 
464.     https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html
465.     """
466.     return os.environ.get('XDG_CONFIG_HOME') or str(Path.home() / ".config")
467. 
468. 
469. def _get_xdg_cache_dir():
470.     """
471.     Return the XDG cache directory, according to the XDG base directory spec:
472. 
473.     https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html
474.     """
475.     return os.environ.get('XDG_CACHE_HOME') or str(Path.home() / ".cache")
476. 
477. 
478. def _get_config_or_cache_dir(xdg_base_getter):
479.     configdir = os.environ.get('MPLCONFIGDIR')
480.     if configdir:
481.         configdir = Path(configdir).resolve()
482.     elif sys.platform.startswith(('linux', 'freebsd')):
483.         # Only call _xdg_base_getter here so that MPLCONFIGDIR is tried first,
484.         # as _xdg_base_getter can throw.
485.         configdir = Path(xdg_base_getter(), "matplotlib")
486.     else:
487.         configdir = Path.home() / ".matplotlib"
488.     try:
489.         configdir.mkdir(parents=True, exist_ok=True)
490.     except OSError:
491.         pass
492.     else:
493.         if os.access(str(configdir), os.W_OK) and configdir.is_dir():
494.             return str(configdir)
495.     # If the config or cache directory cannot be created or is not a writable
496.     # directory, create a temporary one.
497.     tmpdir = os.environ["MPLCONFIGDIR"] = \
498.         tempfile.mkdtemp(prefix="matplotlib-")
499.     atexit.register(shutil.rmtree, tmpdir)
500.     _log.warning(


File: lib/matplotlib/__init__.py
Line number range: 501 - 5000
Content:
501.         "Matplotlib created a temporary config/cache directory at %s because "
502.         "the default path (%s) is not a writable directory; it is highly "
503.         "recommended to set the MPLCONFIGDIR environment variable to a "
504.         "writable directory, in particular to speed up the import of "
505.         "Matplotlib and to better support multiprocessing.",
506.         tmpdir, configdir)
507.     return tmpdir
508. 
509. 
510. @_logged_cached('CONFIGDIR=%s')
511. def get_configdir():
512.     """
513.     Return the string path of the configuration directory.
514. 
515.     The directory is chosen as follows:
516. 
517.     1. If the MPLCONFIGDIR environment variable is supplied, choose that.
518.     2. On Linux, follow the XDG specification and look first in
519.        ``$XDG_CONFIG_HOME``, if defined, or ``$HOME/.config``.  On other
520.        platforms, choose ``$HOME/.matplotlib``.
521.     3. If the chosen directory exists and is writable, use that as the
522.        configuration directory.
523.     4. Else, create a temporary directory, and use it as the configuration
524.        directory.
525.     """
526.     return _get_config_or_cache_dir(_get_xdg_config_dir)
527. 
528. 
529. @_logged_cached('CACHEDIR=%s')
530. def get_cachedir():
531.     """
532.     Return the string path of the cache directory.
533. 
534.     The procedure used to find the directory is the same as for
535.     _get_config_dir, except using ``$XDG_CACHE_HOME``/``$HOME/.cache`` instead.
536.     """
537.     return _get_config_or_cache_dir(_get_xdg_cache_dir)
538. 
539. 
540. @_logged_cached('matplotlib data path: %s')
541. def get_data_path():
542.     """Return the path to Matplotlib data."""
543.     return str(Path(__file__).with_name("mpl-data"))
544. 
545. 
546. def matplotlib_fname():
547.     """
548.     Get the location of the config file.
549. 
550.     The file location is determined in the following order
551. 
552.     - ``$PWD/matplotlibrc``
553.     - ``$MATPLOTLIBRC`` if it is not a directory
554.     - ``$MATPLOTLIBRC/matplotlibrc``
555.     - ``$MPLCONFIGDIR/matplotlibrc``
556.     - On Linux,
557.         - ``$XDG_CONFIG_HOME/matplotlib/matplotlibrc`` (if ``$XDG_CONFIG_HOME``
558.           is defined)
559.         - or ``$HOME/.config/matplotlib/matplotlibrc`` (if ``$XDG_CONFIG_HOME``
560.           is not defined)
561.     - On other platforms,
562.       - ``$HOME/.matplotlib/matplotlibrc`` if ``$HOME`` is defined
563.     - Lastly, it looks in ``$MATPLOTLIBDATA/matplotlibrc``, which should always
564.       exist.
565.     """
566. 
567.     def gen_candidates():
568.         # rely on down-stream code to make absolute.  This protects us
569.         # from having to directly get the current working directory
570.         # which can fail if the user has ended up with a cwd that is
571.         # non-existent.
572.         yield 'matplotlibrc'
573.         try:
574.             matplotlibrc = os.environ['MATPLOTLIBRC']
575.         except KeyError:
576.             pass
577.         else:
578.             yield matplotlibrc
579.             yield os.path.join(matplotlibrc, 'matplotlibrc')
580.         yield os.path.join(get_configdir(), 'matplotlibrc')
581.         yield os.path.join(get_data_path(), 'matplotlibrc')
582. 
583.     for fname in gen_candidates():
584.         if os.path.exists(fname) and not os.path.isdir(fname):
585.             return fname
586. 
587.     raise RuntimeError("Could not find matplotlibrc file; your Matplotlib "
588.                        "install is broken")
589. 
590. 
591. # rcParams deprecated and automatically mapped to another key.
592. # Values are tuples of (version, new_name, f_old2new, f_new2old).
593. _deprecated_map = {}
594. # rcParams deprecated; some can manually be mapped to another key.
595. # Values are tuples of (version, new_name_or_None).
596. _deprecated_ignore_map = {}
597. # rcParams deprecated; can use None to suppress warnings; remain actually
598. # listed in the rcParams.
599. # Values are tuples of (version,)
600. _deprecated_remain_as_none = {}
601. 
602. 
603. @_docstring.Substitution(
604.     "\n".join(map("- {}".format, sorted(rcsetup._validators, key=str.lower)))
605. )
606. class RcParams(MutableMapping, dict):
607.     """
608.     A dictionary object including validation.
609. 
610.     Validating functions are defined and associated with rc parameters in
611.     :mod:`matplotlib.rcsetup`.
612. 
613.     The list of rcParams is:
614. 
615.     %s
616. 
617.     See Also
618.     --------
619.     :ref:`customizing-with-matplotlibrc-files`
620.     """
621. 
622.     validate = rcsetup._validators
623. 
624.     # validate values on the way in
625.     def __init__(self, *args, **kwargs):
626.         self.update(*args, **kwargs)
627. 
628.     def __setitem__(self, key, val):
629.         try:
630.             if key in _deprecated_map:
631.                 version, alt_key, alt_val, inverse_alt = _deprecated_map[key]
632.                 _api.warn_deprecated(
633.                     version, name=key, obj_type="rcparam", alternative=alt_key)
634.                 key = alt_key
635.                 val = alt_val(val)
636.             elif key in _deprecated_remain_as_none and val is not None:
637.                 version, = _deprecated_remain_as_none[key]
638.                 _api.warn_deprecated(version, name=key, obj_type="rcparam")
639.             elif key in _deprecated_ignore_map:
640.                 version, alt_key = _deprecated_ignore_map[key]
641.                 _api.warn_deprecated(
642.                     version, name=key, obj_type="rcparam", alternative=alt_key)
643.                 return
644.             elif key == 'backend':
645.                 if val is rcsetup._auto_backend_sentinel:
646.                     if 'backend' in self:
647.                         return
648.             try:
649.                 cval = self.validate[key](val)
650.             except ValueError as ve:
651.                 raise ValueError(f"Key {key}: {ve}") from None
652.             dict.__setitem__(self, key, cval)
653.         except KeyError as err:
654.             raise KeyError(
655.                 f"{key} is not a valid rc parameter (see rcParams.keys() for "
656.                 f"a list of valid parameters)") from err
657. 
658.     def __getitem__(self, key):
659.         if key in _deprecated_map:
660.             version, alt_key, alt_val, inverse_alt = _deprecated_map[key]
661.             _api.warn_deprecated(
662.                 version, name=key, obj_type="rcparam", alternative=alt_key)
663.             return inverse_alt(dict.__getitem__(self, alt_key))
664. 
665.         elif key in _deprecated_ignore_map:
666.             version, alt_key = _deprecated_ignore_map[key]
667.             _api.warn_deprecated(
668.                 version, name=key, obj_type="rcparam", alternative=alt_key)
669.             return dict.__getitem__(self, alt_key) if alt_key else None
670. 
671.         # In theory, this should only ever be used after the global rcParams
672.         # has been set up, but better be safe e.g. in presence of breakpoints.
673.         elif key == "backend" and self is globals().get("rcParams"):
674.             val = dict.__getitem__(self, key)
675.             if val is rcsetup._auto_backend_sentinel:
676.                 from matplotlib import pyplot as plt
677.                 plt.switch_backend(rcsetup._auto_backend_sentinel)
678. 
679.         return dict.__getitem__(self, key)
680. 
681.     def _get_backend_or_none(self):
682.         """Get the requested backend, if any, without triggering resolution."""
683.         backend = dict.__getitem__(self, "backend")
684.         return None if backend is rcsetup._auto_backend_sentinel else backend
685. 
686.     def __repr__(self):
687.         class_name = self.__class__.__name__
688.         indent = len(class_name) + 1
689.         with _api.suppress_matplotlib_deprecation_warning():
690.             repr_split = pprint.pformat(dict(self), indent=1,
691.                                         width=80 - indent).split('\n')
692.         repr_indented = ('\n' + ' ' * indent).join(repr_split)
693.         return '{}({})'.format(class_name, repr_indented)
694. 
695.     def __str__(self):
696.         return '\n'.join(map('{0[0]}: {0[1]}'.format, sorted(self.items())))
697. 
698.     def __iter__(self):
699.         """Yield sorted list of keys."""
700.         with _api.suppress_matplotlib_deprecation_warning():
701.             yield from sorted(dict.__iter__(self))
702. 
703.     def __len__(self):
704.         return dict.__len__(self)
705. 
706.     def find_all(self, pattern):
707.         """
708.         Return the subset of this RcParams dictionary whose keys match,
709.         using :func:`re.search`, the given ``pattern``.
710. 
711.         .. note::
712. 
713.             Changes to the returned dictionary are *not* propagated to
714.             the parent RcParams dictionary.
715. 
716.         """
717.         pattern_re = re.compile(pattern)
718.         return RcParams((key, value)
719.                         for key, value in self.items()
720.                         if pattern_re.search(key))
721. 
722.     def copy(self):
723.         rccopy = RcParams()
724.         for k in self:  # Skip deprecations and revalidation.
725.             dict.__setitem__(rccopy, k, dict.__getitem__(self, k))
726.         return rccopy
727. 
728. 
729. def rc_params(fail_on_error=False):
730.     """Construct a `RcParams` instance from the default Matplotlib rc file."""
731.     return rc_params_from_file(matplotlib_fname(), fail_on_error)
732. 
733. 
734. @_api.deprecated("3.5")
735. def is_url(filename):
736.     """Return whether *filename* is an http, https, ftp, or file URL path."""
737.     return __getattr__("URL_REGEX").match(filename) is not None
738. 
739. 
740. @functools.lru_cache()
741. def _get_ssl_context():
742.     try:
743.         import certifi
744.     except ImportError:
745.         _log.debug("Could not import certifi.")
746.         return None
747.     import ssl
748.     return ssl.create_default_context(cafile=certifi.where())
749. 
750. 
751. @contextlib.contextmanager
752. def _open_file_or_url(fname):
753.     if (isinstance(fname, str)
754.             and fname.startswith(('http://', 'https://', 'ftp://', 'file:'))):
755.         import urllib.request
756.         ssl_ctx = _get_ssl_context()
757.         if ssl_ctx is None:
758.             _log.debug(
759.                 "Could not get certifi ssl context, https may not work."
760.             )
761.         with urllib.request.urlopen(fname, context=ssl_ctx) as f:
762.             yield (line.decode('utf-8') for line in f)
763.     else:
764.         fname = os.path.expanduser(fname)
765.         with open(fname, encoding='utf-8') as f:
766.             yield f
767. 
768. 
769. def _rc_params_in_file(fname, transform=lambda x: x, fail_on_error=False):
770.     """
771.     Construct a `RcParams` instance from file *fname*.
772. 
773.     Unlike `rc_params_from_file`, the configuration class only contains the
774.     parameters specified in the file (i.e. default values are not filled in).
775. 
776.     Parameters
777.     ----------
778.     fname : path-like
779.         The loaded file.
780.     transform : callable, default: the identity function
781.         A function called on each individual line of the file to transform it,
782.         before further parsing.
783.     fail_on_error : bool, default: False
784.         Whether invalid entries should result in an exception or a warning.
785.     """
786.     import matplotlib as mpl
787.     rc_temp = {}
788.     with _open_file_or_url(fname) as fd:
789.         try:
790.             for line_no, line in enumerate(fd, 1):
791.                 line = transform(line)
792.                 strippedline = cbook._strip_comment(line)
793.                 if not strippedline:
794.                     continue
795.                 tup = strippedline.split(':', 1)
796.                 if len(tup) != 2:
797.                     _log.warning('Missing colon in file %r, line %d (%r)',
798.                                  fname, line_no, line.rstrip('\n'))
799.                     continue
800.                 key, val = tup
801.                 key = key.strip()
802.                 val = val.strip()
803.                 if val.startswith('"') and val.endswith('"'):
804.                     val = val[1:-1]  # strip double quotes
805.                 if key in rc_temp:
806.                     _log.warning('Duplicate key in file %r, line %d (%r)',
807.                                  fname, line_no, line.rstrip('\n'))
808.                 rc_temp[key] = (val, line, line_no)
809.         except UnicodeDecodeError:
810.             _log.warning('Cannot decode configuration file %r as utf-8.',
811.                          fname)
812.             raise
813. 
814.     config = RcParams()
815. 
816.     for key, (val, line, line_no) in rc_temp.items():
817.         if key in rcsetup._validators:
818.             if fail_on_error:
819.                 config[key] = val  # try to convert to proper type or raise
820.             else:
821.                 try:
822.                     config[key] = val  # try to convert to proper type or skip
823.                 except Exception as msg:
824.                     _log.warning('Bad value in file %r, line %d (%r): %s',
825.                                  fname, line_no, line.rstrip('\n'), msg)
826.         elif key in _deprecated_ignore_map:
827.             version, alt_key = _deprecated_ignore_map[key]
828.             _api.warn_deprecated(
829.                 version, name=key, alternative=alt_key, obj_type='rcparam',
830.                 addendum="Please update your matplotlibrc.")
831.         else:
832.             # __version__ must be looked up as an attribute to trigger the
833.             # module-level __getattr__.
834.             version = ('main' if '.post' in mpl.__version__
835.                        else f'v{mpl.__version__}')
836.             _log.warning("""
837. Bad key %(key)s in file %(fname)s, line %(line_no)s (%(line)r)
838. You probably need to get an updated matplotlibrc file from
839. https://github.com/matplotlib/matplotlib/blob/%(version)s/matplotlibrc.template
840. or from the matplotlib source distribution""",
841.                          dict(key=key, fname=fname, line_no=line_no,
842.                               line=line.rstrip('\n'), version=version))
843.     return config
844. 
845. 
846. def rc_params_from_file(fname, fail_on_error=False, use_default_template=True):
847.     """
848.     Construct a `RcParams` from file *fname*.
849. 
850.     Parameters
851.     ----------
852.     fname : str or path-like
853.         A file with Matplotlib rc settings.
854.     fail_on_error : bool
855.         If True, raise an error when the parser fails to convert a parameter.
856.     use_default_template : bool
857.         If True, initialize with default parameters before updating with those
858.         in the given file. If False, the configuration class only contains the
859.         parameters specified in the file. (Useful for updating dicts.)
860.     """
861.     config_from_file = _rc_params_in_file(fname, fail_on_error=fail_on_error)
862. 
863.     if not use_default_template:
864.         return config_from_file
865. 
866.     with _api.suppress_matplotlib_deprecation_warning():
867.         config = RcParams({**rcParamsDefault, **config_from_file})
868. 
869.     if "".join(config['text.latex.preamble']):
870.         _log.info("""
871. *****************************************************************
872. You have the following UNSUPPORTED LaTeX preamble customizations:
873. %s
874. Please do not ask for support with these customizations active.
875. *****************************************************************
876. """, '\n'.join(config['text.latex.preamble']))
877.     _log.debug('loaded rc file %s', fname)
878. 
879.     return config
880. 
881. 
882. # When constructing the global instances, we need to perform certain updates
883. # by explicitly calling the superclass (dict.update, dict.items) to avoid
884. # triggering resolution of _auto_backend_sentinel.
885. rcParamsDefault = _rc_params_in_file(
886.     cbook._get_data_path("matplotlibrc"),
887.     # Strip leading comment.
888.     transform=lambda line: line[1:] if line.startswith("#") else line,
889.     fail_on_error=True)
890. dict.update(rcParamsDefault, rcsetup._hardcoded_defaults)
891. # Normally, the default matplotlibrc file contains *no* entry for backend (the
892. # corresponding line starts with ##, not #; we fill on _auto_backend_sentinel
893. # in that case.  However, packagers can set a different default backend
894. # (resulting in a normal `#backend: foo` line) in which case we should *not*
895. # fill in _auto_backend_sentinel.
896. dict.setdefault(rcParamsDefault, "backend", rcsetup._auto_backend_sentinel)
897. rcParams = RcParams()  # The global instance.
898. dict.update(rcParams, dict.items(rcParamsDefault))
899. dict.update(rcParams, _rc_params_in_file(matplotlib_fname()))
900. rcParamsOrig = rcParams.copy()
901. with _api.suppress_matplotlib_deprecation_warning():
902.     # This also checks that all rcParams are indeed listed in the template.
903.     # Assigning to rcsetup.defaultParams is left only for backcompat.
904.     defaultParams = rcsetup.defaultParams = {
905.         # We want to resolve deprecated rcParams, but not backend...
906.         key: [(rcsetup._auto_backend_sentinel if key == "backend" else
907.                rcParamsDefault[key]),
908.               validator]
909.         for key, validator in rcsetup._validators.items()}
910. if rcParams['axes.formatter.use_locale']:
911.     locale.setlocale(locale.LC_ALL, '')
912. 
913. 
914. def rc(group, **kwargs):
915.     """
916.     Set the current `.rcParams`.  *group* is the grouping for the rc, e.g.,
917.     for ``lines.linewidth`` the group is ``lines``, for
918.     ``axes.facecolor``, the group is ``axes``, and so on.  Group may
919.     also be a list or tuple of group names, e.g., (*xtick*, *ytick*).
920.     *kwargs* is a dictionary attribute name/value pairs, e.g.,::
921. 
922.       rc('lines', linewidth=2, color='r')
923. 
924.     sets the current `.rcParams` and is equivalent to::
925. 
926.       rcParams['lines.linewidth'] = 2
927.       rcParams['lines.color'] = 'r'
928. 
929.     The following aliases are available to save typing for interactive users:
930. 
931.     =====   =================
932.     Alias   Property
933.     =====   =================
934.     'lw'    'linewidth'
935.     'ls'    'linestyle'
936.     'c'     'color'
937.     'fc'    'facecolor'
938.     'ec'    'edgecolor'
939.     'mew'   'markeredgewidth'
940.     'aa'    'antialiased'
941.     =====   =================
942. 
943.     Thus you could abbreviate the above call as::
944. 
945.           rc('lines', lw=2, c='r')
946. 
947.     Note you can use python's kwargs dictionary facility to store
948.     dictionaries of default parameters.  e.g., you can customize the
949.     font rc as follows::
950. 
951.       font = {'family' : 'monospace',
952.               'weight' : 'bold',
953.               'size'   : 'larger'}
954.       rc('font', **font)  # pass in the font dict as kwargs
955. 
956.     This enables you to easily switch between several configurations.  Use
957.     ``matplotlib.style.use('default')`` or :func:`~matplotlib.rcdefaults` to
958.     restore the default `.rcParams` after changes.
959. 
960.     Notes
961.     -----
962.     Similar functionality is available by using the normal dict interface, i.e.
963.     ``rcParams.update({"lines.linewidth": 2, ...})`` (but ``rcParams.update``
964.     does not support abbreviations or grouping).
965.     """
966. 
967.     aliases = {
968.         'lw':  'linewidth',
969.         'ls':  'linestyle',
970.         'c':   'color',
971.         'fc':  'facecolor',
972.         'ec':  'edgecolor',
973.         'mew': 'markeredgewidth',
974.         'aa':  'antialiased',
975.         }
976. 
977.     if isinstance(group, str):
978.         group = (group,)
979.     for g in group:
980.         for k, v in kwargs.items():
981.             name = aliases.get(k) or k
982.             key = '%s.%s' % (g, name)
983.             try:
984.                 rcParams[key] = v
985.             except KeyError as err:
986.                 raise KeyError(('Unrecognized key "%s" for group "%s" and '
987.                                 'name "%s"') % (key, g, name)) from err
988. 
989. 
990. def rcdefaults():
991.     """
992.     Restore the `.rcParams` from Matplotlib's internal default style.
993. 
994.     Style-blacklisted `.rcParams` (defined in
995.     ``matplotlib.style.core.STYLE_BLACKLIST``) are not updated.
996. 
997.     See Also
998.     --------
999.     matplotlib.rc_file_defaults
1000.         Restore the `.rcParams` from the rc file originally loaded by
1001.         Matplotlib.
1002.     matplotlib.style.use
1003.         Use a specific style file.  Call ``style.use('default')`` to restore
1004.         the default style.
1005.     """
1006.     # Deprecation warnings were already handled when creating rcParamsDefault,
1007.     # no need to reemit them here.
1008.     with _api.suppress_matplotlib_deprecation_warning():
1009.         from .style.core import STYLE_BLACKLIST
1010.         rcParams.clear()
1011.         rcParams.update({k: v for k, v in rcParamsDefault.items()
1012.                          if k not in STYLE_BLACKLIST})
1013. 
1014. 
1015. def rc_file_defaults():
1016.     """
1017.     Restore the `.rcParams` from the original rc file loaded by Matplotlib.
1018. 
1019.     Style-blacklisted `.rcParams` (defined in
1020.     ``matplotlib.style.core.STYLE_BLACKLIST``) are not updated.
1021.     """
1022.     # Deprecation warnings were already handled when creating rcParamsOrig, no
1023.     # need to reemit them here.
1024.     with _api.suppress_matplotlib_deprecation_warning():
1025.         from .style.core import STYLE_BLACKLIST
1026.         rcParams.update({k: rcParamsOrig[k] for k in rcParamsOrig
1027.                          if k not in STYLE_BLACKLIST})
1028. 
1029. 
1030. def rc_file(fname, *, use_default_template=True):
1031.     """
1032.     Update `.rcParams` from file.
1033. 
1034.     Style-blacklisted `.rcParams` (defined in
1035.     ``matplotlib.style.core.STYLE_BLACKLIST``) are not updated.
1036. 
1037.     Parameters
1038.     ----------
1039.     fname : str or path-like
1040.         A file with Matplotlib rc settings.
1041. 
1042.     use_default_template : bool
1043.         If True, initialize with default parameters before updating with those
1044.         in the given file. If False, the current configuration persists
1045.         and only the parameters specified in the file are updated.
1046.     """
1047.     # Deprecation warnings were already handled in rc_params_from_file, no need
1048.     # to reemit them here.
1049.     with _api.suppress_matplotlib_deprecation_warning():
1050.         from .style.core import STYLE_BLACKLIST
1051.         rc_from_file = rc_params_from_file(
1052.             fname, use_default_template=use_default_template)
1053.         rcParams.update({k: rc_from_file[k] for k in rc_from_file
1054.                          if k not in STYLE_BLACKLIST})
1055. 
1056. 
1057. @contextlib.contextmanager
1058. def rc_context(rc=None, fname=None):
1059.     """
1060.     Return a context manager for temporarily changing rcParams.
1061. 
1062.     Parameters
1063.     ----------
1064.     rc : dict
1065.         The rcParams to temporarily set.
1066.     fname : str or path-like
1067.         A file with Matplotlib rc settings. If both *fname* and *rc* are given,
1068.         settings from *rc* take precedence.
1069. 
1070.     See Also
1071.     --------
1072.     :ref:`customizing-with-matplotlibrc-files`
1073. 
1074.     Examples
1075.     --------
1076.     Passing explicit values via a dict::
1077. 
1078.         with mpl.rc_context({'interactive': False}):
1079.             fig, ax = plt.subplots()
1080.             ax.plot(range(3), range(3))
1081.             fig.savefig('example.png')
1082.             plt.close(fig)
1083. 
1084.     Loading settings from a file::
1085. 
1086.          with mpl.rc_context(fname='print.rc'):
1087.              plt.plot(x, y)  # uses 'print.rc'
1088. 
1089.     """
1090.     orig = rcParams.copy()
1091.     try:
1092.         if fname:
1093.             rc_file(fname)
1094.         if rc:
1095.             rcParams.update(rc)
1096.         yield
1097.     finally:
1098.         dict.update(rcParams, orig)  # Revert to the original rcs.
1099. 
1100. 
1101. def use(backend, *, force=True):
1102.     """
1103.     Select the backend used for rendering and GUI integration.
1104. 
1105.     Parameters
1106.     ----------
1107.     backend : str
1108.         The backend to switch to.  This can either be one of the standard
1109.         backend names, which are case-insensitive:
1110. 
1111.         - interactive backends:
1112.           GTK3Agg, GTK3Cairo, GTK4Agg, GTK4Cairo, MacOSX, nbAgg, QtAgg,
1113.           QtCairo, TkAgg, TkCairo, WebAgg, WX, WXAgg, WXCairo, Qt5Agg, Qt5Cairo
1114. 
1115.         - non-interactive backends:
1116.           agg, cairo, pdf, pgf, ps, svg, template
1117. 
1118.         or a string of the form: ``module://my.module.name``.
1119. 
1120.         Switching to an interactive backend is not possible if an unrelated
1121.         event loop has already been started (e.g., switching to GTK3Agg if a
1122.         TkAgg window has already been opened).  Switching to a non-interactive
1123.         backend is always possible.
1124. 
1125.     force : bool, default: True
1126.         If True (the default), raise an `ImportError` if the backend cannot be
1127.         set up (either because it fails to import, or because an incompatible
1128.         GUI interactive framework is already running); if False, silently
1129.         ignore the failure.
1130. 
1131.     See Also
1132.     --------
1133.     :ref:`backends`
1134.     matplotlib.get_backend
1135.     """
1136.     name = validate_backend(backend)
1137.     # don't (prematurely) resolve the "auto" backend setting
1138.     if rcParams._get_backend_or_none() == name:
1139.         # Nothing to do if the requested backend is already set
1140.         pass
1141.     else:
1142.         # if pyplot is not already imported, do not import it.  Doing
1143.         # so may trigger a `plt.switch_backend` to the _default_ backend
1144.         # before we get a chance to change to the one the user just requested
1145.         plt = sys.modules.get('matplotlib.pyplot')
1146.         # if pyplot is imported, then try to change backends
1147.         if plt is not None:
1148.             try:
1149.                 # we need this import check here to re-raise if the
1150.                 # user does not have the libraries to support their
1151.                 # chosen backend installed.
1152.                 plt.switch_backend(name)
1153.             except ImportError:
1154.                 if force:
1155.                     raise
1156.         # if we have not imported pyplot, then we can set the rcParam
1157.         # value which will be respected when the user finally imports
1158.         # pyplot
1159.         else:
1160.             rcParams['backend'] = backend
1161.     # if the user has asked for a given backend, do not helpfully
1162.     # fallback
1163.     rcParams['backend_fallback'] = False
1164. 
1165. 
1166. if os.environ.get('MPLBACKEND'):
1167.     rcParams['backend'] = os.environ.get('MPLBACKEND')
1168. 
1169. 
1170. def get_backend():
1171.     """
1172.     Return the name of the current backend.
1173. 
1174.     See Also
1175.     --------
1176.     matplotlib.use
1177.     """
1178.     return rcParams['backend']
1179. 
1180. 
1181. def interactive(b):
1182.     """
1183.     Set whether to redraw after every plotting command (e.g. `.pyplot.xlabel`).
1184.     """
1185.     rcParams['interactive'] = b
1186. 
1187. 
1188. def is_interactive():
1189.     """
1190.     Return whether to redraw after every plotting command.
1191. 
1192.     .. note::
1193. 
1194.         This function is only intended for use in backends. End users should
1195.         use `.pyplot.isinteractive` instead.
1196.     """
1197.     return rcParams['interactive']
1198. 
1199. 
1200. default_test_modules = [
1201.     'matplotlib.tests',
1202.     'mpl_toolkits.tests',
1203. ]
1204. 
1205. 
1206. def _init_tests():
1207.     # The version of FreeType to install locally for running the
1208.     # tests.  This must match the value in `setupext.py`
1209.     LOCAL_FREETYPE_VERSION = '2.6.1'
1210. 
1211.     from matplotlib import ft2font
1212.     if (ft2font.__freetype_version__ != LOCAL_FREETYPE_VERSION or
1213.             ft2font.__freetype_build_type__ != 'local'):
1214.         _log.warning(
1215.             f"Matplotlib is not built with the correct FreeType version to "
1216.             f"run tests.  Rebuild without setting system_freetype=1 in "
1217.             f"mplsetup.cfg.  Expect many image comparison failures below.  "
1218.             f"Expected freetype version {LOCAL_FREETYPE_VERSION}.  "
1219.             f"Found freetype version {ft2font.__freetype_version__}.  "
1220.             "Freetype build type is {}local".format(
1221.                 "" if ft2font.__freetype_build_type__ == 'local' else "not "))
1222. 
1223. 
1224. @_api.deprecated("3.5", alternative='pytest')
1225. def test(verbosity=None, coverage=False, **kwargs):
1226.     """Run the matplotlib test suite."""
1227. 
1228.     try:
1229.         import pytest
1230.     except ImportError:
1231.         print("matplotlib.test requires pytest to run.")
1232.         return -1
1233. 
1234.     if not os.path.isdir(os.path.join(os.path.dirname(__file__), 'tests')):
1235.         print("Matplotlib test data is not installed")
1236.         return -1
1237. 
1238.     old_backend = get_backend()
1239.     try:
1240.         use('agg')
1241. 
1242.         args = kwargs.pop('argv', [])
1243.         provide_default_modules = True
1244.         use_pyargs = True
1245.         for arg in args:
1246.             if any(arg.startswith(module_path)
1247.                    for module_path in default_test_modules):
1248.                 provide_default_modules = False
1249.                 break
1250.             if os.path.exists(arg):
1251.                 provide_default_modules = False
1252.                 use_pyargs = False
1253.                 break
1254.         if use_pyargs:
1255.             args += ['--pyargs']
1256.         if provide_default_modules:
1257.             args += default_test_modules
1258. 
1259.         if coverage:
1260.             args += ['--cov']
1261. 
1262.         if verbosity:
1263.             args += ['-' + 'v' * verbosity]
1264. 
1265.         retcode = pytest.main(args, **kwargs)
1266.     finally:
1267.         if old_backend.lower() != 'agg':
1268.             use(old_backend)
1269. 
1270.     return retcode
1271. 
1272. 
1273. test.__test__ = False  # pytest: this function is not a test
1274. 
1275. 
1276. def _replacer(data, value):
1277.     """
1278.     Either returns ``data[value]`` or passes ``data`` back, converts either to
1279.     a sequence.
1280.     """
1281.     try:
1282.         # if key isn't a string don't bother
1283.         if isinstance(value, str):
1284.             # try to use __getitem__
1285.             value = data[value]
1286.     except Exception:
1287.         # key does not exist, silently fall back to key
1288.         pass
1289.     return sanitize_sequence(value)
1290. 
1291. 
1292. def _label_from_arg(y, default_name):
1293.     try:
1294.         return y.name
1295.     except AttributeError:
1296.         if isinstance(default_name, str):
1297.             return default_name
1298.     return None
1299. 
1300. 
1301. def _add_data_doc(docstring, replace_names):
1302.     """
1303.     Add documentation for a *data* field to the given docstring.
1304. 
1305.     Parameters
1306.     ----------
1307.     docstring : str
1308.         The input docstring.
1309.     replace_names : list of str or None
1310.         The list of parameter names which arguments should be replaced by
1311.         ``data[name]`` (if ``data[name]`` does not throw an exception).  If
1312.         None, replacement is attempted for all arguments.
1313. 
1314.     Returns
1315.     -------
1316.     str
1317.         The augmented docstring.
1318.     """
1319.     if (docstring is None
1320.             or replace_names is not None and len(replace_names) == 0):
1321.         return docstring
1322.     docstring = inspect.cleandoc(docstring)
1323. 
1324.     data_doc = ("""\
1325.     If given, all parameters also accept a string ``s``, which is
1326.     interpreted as ``data[s]`` (unless this raises an exception)."""
1327.                 if replace_names is None else f"""\
1328.     If given, the following parameters also accept a string ``s``, which is
1329.     interpreted as ``data[s]`` (unless this raises an exception):
1330. 
1331.     {', '.join(map('*{}*'.format, replace_names))}""")
1332.     # using string replacement instead of formatting has the advantages
1333.     # 1) simpler indent handling
1334.     # 2) prevent problems with formatting characters '{', '%' in the docstring
1335.     if _log.level <= logging.DEBUG:
1336.         # test_data_parameter_replacement() tests against these log messages
1337.         # make sure to keep message and test in sync
1338.         if "data : indexable object, optional" not in docstring:
1339.             _log.debug("data parameter docstring error: no data parameter")
1340.         if 'DATA_PARAMETER_PLACEHOLDER' not in docstring:
1341.             _log.debug("data parameter docstring error: missing placeholder")
1342.     return docstring.replace('    DATA_PARAMETER_PLACEHOLDER', data_doc)
1343. 
1344. 
1345. def _preprocess_data(func=None, *, replace_names=None, label_namer=None):
1346.     """
1347.     A decorator to add a 'data' kwarg to a function.
1348. 
1349.     When applied::
1350. 
1351.         @_preprocess_data()
1352.         def func(ax, *args, **kwargs): ...
1353. 
1354.     the signature is modified to ``decorated(ax, *args, data=None, **kwargs)``
1355.     with the following behavior:
1356. 
1357.     - if called with ``data=None``, forward the other arguments to ``func``;
1358.     - otherwise, *data* must be a mapping; for any argument passed in as a
1359.       string ``name``, replace the argument by ``data[name]`` (if this does not
1360.       throw an exception), then forward the arguments to ``func``.
1361. 
1362.     In either case, any argument that is a `MappingView` is also converted to a
1363.     list.
1364. 
1365.     Parameters
1366.     ----------
1367.     replace_names : list of str or None, default: None
1368.         The list of parameter names for which lookup into *data* should be
1369.         attempted. If None, replacement is attempted for all arguments.
1370.     label_namer : str, default: None
1371.         If set e.g. to "namer" (which must be a kwarg in the function's
1372.         signature -- not as ``**kwargs``), if the *namer* argument passed in is
1373.         a (string) key of *data* and no *label* kwarg is passed, then use the
1374.         (string) value of the *namer* as *label*. ::
1375. 
1376.             @_preprocess_data(label_namer="foo")
1377.             def func(foo, label=None): ...
1378. 
1379.             func("key", data={"key": value})
1380.             # is equivalent to
1381.             func.__wrapped__(value, label="key")
1382.     """
1383. 
1384.     if func is None:  # Return the actual decorator.
1385.         return functools.partial(
1386.             _preprocess_data,
1387.             replace_names=replace_names, label_namer=label_namer)
1388. 
1389.     sig = inspect.signature(func)
1390.     varargs_name = None
1391.     varkwargs_name = None
1392.     arg_names = []
1393.     params = list(sig.parameters.values())
1394.     for p in params:
1395.         if p.kind is Parameter.VAR_POSITIONAL:
1396.             varargs_name = p.name
1397.         elif p.kind is Parameter.VAR_KEYWORD:
1398.             varkwargs_name = p.name
1399.         else:
1400.             arg_names.append(p.name)
1401.     data_param = Parameter("data", Parameter.KEYWORD_ONLY, default=None)
1402.     if varkwargs_name:
1403.         params.insert(-1, data_param)
1404.     else:
1405.         params.append(data_param)
1406.     new_sig = sig.replace(parameters=params)
1407.     arg_names = arg_names[1:]  # remove the first "ax" / self arg
1408. 
1409.     assert {*arg_names}.issuperset(replace_names or []) or varkwargs_name, (
1410.         "Matplotlib internal error: invalid replace_names ({!r}) for {!r}"
1411.         .format(replace_names, func.__name__))
1412.     assert label_namer is None or label_namer in arg_names, (
1413.         "Matplotlib internal error: invalid label_namer ({!r}) for {!r}"
1414.         .format(label_namer, func.__name__))
1415. 
1416.     @functools.wraps(func)
1417.     def inner(ax, *args, data=None, **kwargs):
1418.         if data is None:
1419.             return func(ax, *map(sanitize_sequence, args), **kwargs)
1420. 
1421.         bound = new_sig.bind(ax, *args, **kwargs)
1422.         auto_label = (bound.arguments.get(label_namer)
1423.                       or bound.kwargs.get(label_namer))
1424. 
1425.         for k, v in bound.arguments.items():
1426.             if k == varkwargs_name:
1427.                 for k1, v1 in v.items():
1428.                     if replace_names is None or k1 in replace_names:
1429.                         v[k1] = _replacer(data, v1)
1430.             elif k == varargs_name:
1431.                 if replace_names is None:
1432.                     bound.arguments[k] = tuple(_replacer(data, v1) for v1 in v)
1433.             else:
1434.                 if replace_names is None or k in replace_names:
1435.                     bound.arguments[k] = _replacer(data, v)
1436. 
1437.         new_args = bound.args
1438.         new_kwargs = bound.kwargs
1439. 
1440.         args_and_kwargs = {**bound.arguments, **bound.kwargs}
1441.         if label_namer and "label" not in args_and_kwargs:
1442.             new_kwargs["label"] = _label_from_arg(
1443.                 args_and_kwargs.get(label_namer), auto_label)
1444. 
1445.         return func(*new_args, **new_kwargs)
1446. 
1447.     inner.__doc__ = _add_data_doc(inner.__doc__, replace_names)
1448.     inner.__signature__ = new_sig
1449.     return inner
1450. 
1451. 
1452. _log.debug('interactive is %s', is_interactive())
1453. _log.debug('platform is %s', sys.platform)
1454. 
1455. 
1456. # workaround: we must defer colormaps import to after loading rcParams, because
1457. # colormap creation depends on rcParams
1458. from matplotlib.cm import _colormaps as colormaps
1459. from matplotlib.colors import _color_sequences as color_sequences

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-24 03:12:36,987 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="1. Query requirement analysis:\n   - The user's extra requirements specifically ask for the `RcParams` class definition.\n   - The purpose is to examine its interaction with `rc_context` and `get_backend`.\n2. Extended relevance:\n   - This class defines the behavior of `rcParams` objects, including validation and special handling for certain keys like 'backend', which is crucial for understanding the issue.", relative_path='lib/matplotlib/__init__.py', start_line=603, end_line=727), ContextOutput(reasoning="1. Query requirement analysis:\n   - While not explicitly requested, understanding how the global `rcParams` object is created is fundamental to the query's purpose.\n2. Extended relevance:\n   - This context shows the initialization process of the global `rcParams` instance, including loading defaults and rc files. This is essential context for understanding the state of `rcParams` before `rc_context` is used.", relative_path='lib/matplotlib/__init__.py', start_line=882, end_line=912), ContextOutput(reasoning="1. Query requirement analysis:\n   - The user's extra requirements specifically ask for the `rc_context` function definition.\n   - The purpose is to examine its interaction with `RcParams` and `get_backend`.\n2. Extended relevance:\n   - This function is a context manager for temporarily modifying `rcParams`. Its implementation, especially how it saves and restores `rcParams`, is central to the user's investigation.", relative_path='lib/matplotlib/__init__.py', start_line=1057, end_line=1099), ContextOutput(reasoning="1. Query requirement analysis:\n   - The user's extra requirements specifically ask for the `get_backend` function definition.\n   - The purpose is to examine its interaction with `RcParams` and `rc_context`.\n2. Extended relevance:\n   - This function shows how the current backend is retrieved from `rcParams`, which is a key part of the interaction the user wants to examine.", relative_path='lib/matplotlib/__init__.py', start_line=1170, end_line=1179)]
2025-12-24 03:12:36,989 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 4 contexts to memory for query: Please provide the full content of `lib/matplotlib/__init__.py`.
2025-12-24 03:12:36,990 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-24 03:12:36,990 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-24 03:12:36,990 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 4 new contexts to 4 existing contexts
2025-12-24 03:12:36,990 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 8 total contexts (removed 0 duplicates)
2025-12-24 03:12:36,991 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
matplotlib
├── .appveyor.yml
├── .circleci
|   ├── config.yml
|   └── deploy-docs.sh
├── .git_archival.txt
├── .github
|   ├── CONTRIBUTING.md
|   ├── FUNDING.yml
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.yml
|   |   ├── config.yml
|   |   ├── documentation.yml
|   |   ├── feature_request.yml
|   |   └── maintenance.yml
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── codecov.yml
|   ├── dependabot.yml
|   └── workflows
|       ├── cibuildwheel.yml
|       ├── circleci.yml
|       ├── clean_pr.yml
|       ├── nightlies.yml
|       ├── pr_welcome.yml
|       ├── reviewdog.yml
|       └── tests.yml
├── .lgtm.yml
├── .meeseeksdev.yml
├── .pre-commit-config.yaml
├── CODE_OF_CONDUCT.md
├── INSTALL.rst
├── LICENSE
├── README.rst
├── SECURITY.md
├── azure-pipelines.yml
├── ci
|   ├── check_wheel_licenses.py
|   └── codespell-ignore-words.txt
├── doc
|   ├── README.txt
|   ├── _static
|   |   ├── fa
|   |   ├── markers
|   |   ├── mpl.css
|   |   └── zenodo_cache
|   ├── _templates
|   |   ├── autofunctions.rst
|   |   ├── automodule.rst
|   |   ├── autosummary.rst
|   |   ├── cheatsheet_sidebar.html
|   |   ├── donate_sidebar.html
|   |   ├── function.rst
|   |   ├── pagesource.html
|   |   ├── search.html
|   |   ├── sidebar_announcement.html
|   |   └── sidebar_versions.html
|   ├── api
|   |   ├── _api_api.rst
|   |   ├── _enums_api.rst
|   |   ├── afm_api.rst
|   |   ├── animation_api.rst
|   |   ├── artist_api.rst
|   |   ├── axes_api.rst
|   |   ├── axis_api.rst
|   |   ├── backend_agg_api.rst
|   |   ├── backend_bases_api.rst
|   |   ├── backend_cairo_api.rst
|   |   ├── backend_gtk3_api.rst
|   |   ├── backend_gtk4_api.rst
|   |   ├── backend_managers_api.rst
|   |   ├── backend_mixed_api.rst
|   |   ├── backend_nbagg_api.rst
|   |   ├── backend_pdf_api.rst
|   |   ├── backend_pgf_api.rst
|   |   ├── backend_ps_api.rst
|   |   ├── backend_qt_api.rst
|   |   ├── backend_svg_api.rst
|   |   ├── backend_template_api.rst
|   |   ├── backend_tk_api.rst
|   |   ├── backend_tools_api.rst
|   |   ├── backend_webagg_api.rst
|   |   ├── backend_wx_api.rst
|   |   ├── bezier_api.rst
|   |   ├── blocking_input_api.rst
|   |   ├── category_api.rst
|   |   ├── cbook_api.rst
|   |   ├── cm_api.rst
|   |   ├── collections_api.rst
|   |   ├── colorbar_api.rst
|   |   ├── colors_api.rst
|   |   ├── container_api.rst
|   |   ├── contour_api.rst
|   |   ├── dates_api.rst
|   |   ├── docstring_api.rst
|   |   ├── dviread.rst
|   |   ├── figure_api.rst
|   |   ├── font_manager_api.rst
|   |   ├── fontconfig_pattern_api.rst
|   |   ├── gridspec_api.rst
|   |   ├── hatch_api.rst
|   |   ├── image_api.rst
|   |   ├── index.rst
|   |   ├── index_backend_api.rst
|   |   ├── layout_engine_api.rst
|   |   ├── legend_api.rst
|   |   ├── legend_handler_api.rst
|   |   ├── lines_api.rst
|   |   ├── markers_api.rst
|   |   ├── mathtext_api.rst
|   |   ├── matplotlib_configuration_api.rst
|   |   ├── mlab_api.rst
|   |   ├── next_api_changes
|   |   |   ├── README.rst
|   |   |   ├── behavior
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 19214-DS.rst
|   |   |   |   ├── 19368-DS.rst
|   |   |   |   ├── 20426-JK.rst
|   |   |   |   ├── 20715-JKS.rst
|   |   |   |   ├── 21026-DS.rst
|   |   |   |   ├── 21042-AL.rst
|   |   |   |   ├── 21238-AL.rst
|   |   |   |   ├── 21983-AL.rst
|   |   |   |   ├── 22013-AL.rst
|   |   |   |   ├── 22063-SR.rst
|   |   |   |   ├── 22204-AL.rst
|   |   |   |   ├── 22229-TAC.rst
|   |   |   |   ├── 22485-TH.rst
|   |   |   |   ├── 22567-IT.rst
|   |   |   |   ├── 22639-RA.rst
|   |   |   |   ├── 22691-JMK.rst
|   |   |   |   ├── 22745-JMK.rst
|   |   |   |   ├── 23031-AL.rst
|   |   |   |   ├── 23170-JMK.rst
|   |   |   |   ├── 23188-JMK.rst
|   |   |   |   └── 23270-AL.rst
|   |   |   ├── deprecations
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 20071-AL.rst
|   |   |   |   ├── 20839-EP.rst
|   |   |   |   ├── 20995-AL.rst
|   |   |   |   ├── 21056-AL.rst
|   |   |   |   ├── 21187-AL.rst
|   |   |   |   ├── 21356-AL.rst
|   |   |   |   ├── 21412-AL.rst
|   |   |   |   ├── 21425-AL.rst
|   |   |   |   ├── 21584-AL.rst
|   |   |   |   ├── 21962-AL.rst
|   |   |   |   ├── 21965-AL.rst
|   |   |   |   ├── 21981-AL.rst
|   |   |   |   ├── 21982-AL.rst
|   |   |   |   ├── 21992-AL.rst
|   |   |   |   ├── 21995-AL.rst
|   |   |   |   ├── 22021-AL.rst
|   |   |   |   ├── 22025-AL.rst
|   |   |   |   ├── 22050-AL.rst
|   |   |   |   ├── 22051-AL.rst
|   |   |   |   ├── 22084-SS.rst
|   |   |   |   ├── 22097-AL.rst
|   |   |   |   ├── 22098-AL.rst
|   |   |   |   ├── 22123-TH.rst
|   |   |   |   ├── 22133-OG.rst
|   |   |   |   ├── 22134-OG.rst
|   |   |   |   ├── 22148-OG.rst
|   |   |   |   ├── 22167-EP.rst
|   |   |   |   ├── 22245-AL.rst
|   |   |   |   ├── 22268-OG.rst
|   |   |   |   ├── 22298-GL.rst
|   |   |   |   ├── 22317-AL.rst
|   |   |   |   ├── 22323-GL.rst
|   |   |   |   ├── 22345-JK.rst
|   |   |   |   ├── 22415-AL.rst
|   |   |   |   ├── 22418-AL.rst
|   |   |   |   ├── 22421-AL.rst
|   |   |   |   ├── 22422-AL.rst
|   |   |   |   ├── 22490-AL.rst
|   |   |   |   ├── 22503-AL.rst
|   |   |   |   ├── 22509-AL.rst
|   |   |   |   ├── 22539-AL.rst
|   |   |   |   ├── 22547-AL.rst
|   |   |   |   ├── 22554-AL.rst
|   |   |   |   ├── 22697-OG.rst
|   |   |   |   ├── 22725-AL.rst
|   |   |   |   ├── 22797-OG.rst
|   |   |   |   ├── 22813-GL.rst
|   |   |   |   ├── 22883-AL.rst
|   |   |   |   ├── 22885-AL.rst
|   |   |   |   ├── 23014-OG.rst
|   |   |   |   ├── 23045-OG.rst
|   |   |   |   ├── 23081-OG.rst
|   |   |   |   ├── 23166-ES.rst
|   |   |   |   ├── 23190-OG.rst
|   |   |   |   ├── 23232-TH.rst
|   |   |   |   ├── 23289-AL.rst
|   |   |   |   ├── 23302-TH.rst
|   |   |   |   └── ZZZZZ-AL.rst
|   |   |   ├── development
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 21415-AL.rst
|   |   |   |   ├── 22205-ES.rst
|   |   |   |   └── 22550-AL.rst
|   |   |   └── removals
|   |   |       ├── 00001-ABC.rst
|   |   |       ├── 00001-DS.rst
|   |   |       ├── 20990-AL.rst
|   |   |       ├── 21395-AL.rst
|   |   |       ├── 21591-AL.rst
|   |   |       ├── 21980-CC.rst
|   |   |       ├── 22081-AL.rst
|   |   |       ├── 22107-OG.rst
|   |   |       ├── 22365-OG.rst
|   |   |       ├── 22465-AL.rst
|   |   |       ├── 22486-OG.rst
|   |   |       ├── 22514-OG.rst
|   |   |       ├── 22516-OG.rst
|   |   |       ├── 22738-JL.rst
|   |   |       ├── 22886-OG.rst
|   |   |       ├── 22952-TH.rst
|   |   |       ├── 23076-GL.rst
|   |   |       ├── 23077-GL.rst
|   |   |       ├── 23078-GL.rst
|   |   |       ├── 23079-GL.rst
|   |   |       ├── 23093-GL.rst
|   |   |       └── 23237-AL.rst
|   |   ├── next_api_changes.rst
|   |   ├── offsetbox_api.rst
|   |   ├── patches_api.rst
|   |   ├── path_api.rst
|   |   ├── patheffects_api.rst
|   |   ├── prev_api_changes
|   |   |   ├── api_changes_0.40.rst
|   |   |   ├── api_changes_0.42.rst
|   |   |   ├── api_changes_0.50.rst
|   |   |   ├── api_changes_0.54.3.rst
|   |   |   ├── api_changes_0.54.rst
|   |   |   ├── api_changes_0.60.rst
|   |   |   ├── api_changes_0.61.rst
|   |   |   ├── api_changes_0.63.rst
|   |   |   ├── api_changes_0.65.1.rst
|   |   |   ├── api_changes_0.65.rst
|   |   |   ├── api_changes_0.70.rst
|   |   |   ├── api_changes_0.71.rst
|   |   |   ├── api_changes_0.72.rst
|   |   |   ├── api_changes_0.73.rst
|   |   |   ├── api_changes_0.80.rst
|   |   |   ├── api_changes_0.81.rst
|   |   |   ├── api_changes_0.82.rst
|   |   |   ├── api_changes_0.83.rst
|   |   |   ├── api_changes_0.84.rst
|   |   |   ├── api_changes_0.85.rst
|   |   |   ├── api_changes_0.86.rst
|   |   |   ├── api_changes_0.87.7.rst
|   |   |   ├── api_changes_0.90.0.rst
|   |   |   ├── api_changes_0.90.1.rst
|   |   |   ├── api_changes_0.91.0.rst
|   |   |   ├── api_changes_0.91.2.rst
|   |   |   ├── api_changes_0.98.0.rst
|   |   |   ├── api_changes_0.98.1.rst
|   |   |   ├── api_changes_0.98.x.rst
|   |   |   ├── api_changes_0.99.rst
|   |   |   ├── api_changes_0.99.x.rst
|   |   |   ├── api_changes_1.1.x.rst
|   |   |   ├── api_changes_1.2.x.rst
|   |   |   ├── api_changes_1.3.x.rst
|   |   |   ├── api_changes_1.4.x.rst
|   |   |   ├── api_changes_1.5.0.rst
|   |   |   ├── api_changes_1.5.2.rst
|   |   |   ├── api_changes_1.5.3.rst
|   |   |   ├── api_changes_2.0.0.rst
|   |   |   ├── api_changes_2.0.1.rst
|   |   |   ├── api_changes_2.1.0.rst
|   |   |   ├── api_changes_2.1.1.rst
|   |   |   ├── api_changes_2.1.2.rst
|   |   |   ├── api_changes_2.2.0.rst
|   |   |   ├── api_changes_3.0.0.rst
|   |   |   ├── api_changes_3.0.1.rst
|   |   |   ├── api_changes_3.1.0.rst
|   |   |   ├── api_changes_3.1.1.rst
|   |   |   ├── api_changes_3.2.0
|   |   |   |   ├── behavior.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.2.0.rst
|   |   |   ├── api_changes_3.3.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.3.0.rst
|   |   |   ├── api_changes_3.3.1.rst
|   |   |   ├── api_changes_3.4.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.4.0.rst
|   |   |   ├── api_changes_3.4.2.rst
|   |   |   ├── api_changes_3.5.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.5.0.rst
|   |   |   └── api_changes_3.5.2.rst
|   |   ├── projections_api.rst
|   |   ├── pyplot_summary.rst
|   |   ├── quiver_api.rst
|   |   ├── rcsetup_api.rst
|   |   ├── sankey_api.rst
|   |   ├── scale_api.rst
|   |   ├── sphinxext_mathmpl_api.rst
|   |   ├── sphinxext_plot_directive_api.rst
|   |   ├── spines_api.rst
|   |   ├── style_api.rst
|   |   ├── table_api.rst
|   |   ├── testing_api.rst
|   |   ├── texmanager_api.rst
|   |   ├── text_api.rst
|   |   ├── textpath_api.rst
|   |   ├── ticker_api.rst
|   |   ├── tight_bbox_api.rst
|   |   ├── tight_layout_api.rst
|   |   ├── toolkits
|   |   |   ├── axes_grid.rst
|   |   |   ├── axes_grid1.rst
|   |   |   ├── axisartist.rst
|   |   |   ├── mplot3d
|   |   |   |   └── faq.rst
|   |   |   └── mplot3d.rst
|   |   ├── transformations.rst
|   |   ├── tri_api.rst
|   |   ├── type1font.rst
|   |   ├── units_api.rst
|   |   └── widgets_api.rst
|   ├── conf.py
|   ├── devel
|   |   ├── MEP
|   |   |   ├── MEP08.rst
|   |   |   ├── MEP09.rst
|   |   |   ├── MEP10.rst
|   |   |   ├── MEP11.rst
|   |   |   ├── MEP12.rst
|   |   |   ├── MEP13.rst
|   |   |   ├── MEP14.rst
|   |   |   ├── MEP15.rst
|   |   |   ├── MEP19.rst
|   |   |   ├── MEP21.rst
|   |   |   ├── MEP22.rst
|   |   |   ├── MEP23.rst
|   |   |   ├── MEP24.rst
|   |   |   ├── MEP25.rst
|   |   |   ├── MEP26.rst
|   |   |   ├── MEP27.rst
|   |   |   ├── MEP28.rst
|   |   |   ├── MEP29.rst
|   |   |   ├── README.rst
|   |   |   ├── index.rst
|   |   |   └── template.rst
|   |   ├── README.txt
|   |   ├── coding_guide.rst
|   |   ├── color_changes.rst
|   |   ├── contributing.rst
|   |   ├── dependencies.rst
|   |   ├── development_setup.rst
|   |   ├── documenting_mpl.rst
|   |   ├── gitwash
|   |   |   ├── configure_git.rst
|   |   |   ├── development_workflow.rst
|   |   |   ├── dot2_dot3.rst
|   |   |   ├── following_latest.rst
|   |   |   ├── forking_hell.rst
|   |   |   ├── git_development.rst
|   |   |   ├── git_install.rst
|   |   |   ├── git_intro.rst
|   |   |   ├── git_resources.rst
|   |   |   ├── index.rst
|   |   |   ├── maintainer_workflow.rst
|   |   |   ├── patching.rst
|   |   |   └── set_up_fork.rst
|   |   ├── index.rst
|   |   ├── license.rst
|   |   ├── min_dep_policy.rst
|   |   ├── release_guide.rst
|   |   ├── style_guide.rst
|   |   ├── testing.rst
|   |   └── triage.rst
|   ├── index.rst
|   ├── sphinxext
|   |   ├── __init__.py
|   |   ├── custom_roles.py
|   |   ├── gallery_order.py
|   |   ├── github.py
|   |   ├── math_symbol_table.py
|   |   ├── missing_references.py
|   |   ├── mock_gui_toolkits.py
|   |   ├── redirect_from.py
|   |   └── skip_deprecated.py
|   ├── thirdpartypackages
|   |   └── index.rst
|   └── users
|       ├── explain
|       |   ├── api_interfaces.rst
|       |   ├── backends.rst
|       |   ├── event_handling.rst
|       |   ├── fonts.rst
|       |   ├── index.rst
|       |   ├── interactive.rst
|       |   ├── interactive_guide.rst
|       |   └── performance.rst
|       ├── faq
|       |   ├── environment_variables_faq.rst
|       |   ├── howto_faq.rst
|       |   ├── index.rst
|       |   └── troubleshooting_faq.rst
|       ├── generate_credits.py
|       ├── getting_started
|       |   └── index.rst
|       ├── github_stats.rst
|       ├── index.rst
|       ├── installing
|       |   └── index.rst
|       ├── next_whats_new
|       |   ├── 3d_plot_focal_length.rst
|       |   ├── 3d_plot_roll_angle.rst
|       |   ├── README.rst
|       |   ├── asinh_scale.rst
|       |   ├── color_support_for_math_to_image.rst
|       |   ├── custom_cap_widths.rst
|       |   ├── double_quotes_matplolibrc.rst
|       |   ├── extending_MarkerStyle.rst
|       |   ├── inset_axes_improvements.rst
|       |   ├── layout_engine.rst
|       |   ├── list_font_names.rst
|       |   ├── marker_none.rst
|       |   ├── min_macos_version.rst
|       |   ├── modify_stairs_fill_edge_behaviour.rst
|       |   ├── no_broken_streamlines.rst
|       |   ├── polygon_selector_box.rst
|       |   ├── polygon_vert_setter.rst
|       |   ├── rectangle_patch_rotation.rst
|       |   ├── rename_ncol_keyword_in_legend.rst
|       |   ├── selector_improvement.rst
|       |   ├── snap_selector.rst
|       |   ├── striped_lines.rst
|       |   ├── url_active_areas_rotate.rst
|       |   ├── use_contourpy.rst
|       |   └── windows_arm64.rst
|       ├── next_whats_new.rst
|       ├── prev_whats_new
|       |   ├── changelog.rst
|       |   ├── dflt_style_changes.rst
|       |   ├── github_stats_3.0.0.rst
|       |   ├── github_stats_3.0.1.rst
|       |   ├── github_stats_3.0.2.rst
|       |   ├── github_stats_3.0.3.rst
|       |   ├── github_stats_3.1.0.rst
|       |   ├── github_stats_3.1.1.rst
|       |   ├── github_stats_3.1.2.rst
|       |   ├── github_stats_3.1.3.rst
|       |   ├── github_stats_3.2.0.rst
|       |   ├── github_stats_3.2.1.rst
|       |   ├── github_stats_3.2.2.rst
|       |   ├── github_stats_3.3.0.rst
|       |   ├── github_stats_3.3.1.rst
|       |   ├── github_stats_3.3.2.rst
|       |   ├── github_stats_3.3.3.rst
|       |   ├── github_stats_3.3.4.rst
|       |   ├── github_stats_3.4.0.rst
|       |   ├── github_stats_3.4.1.rst
|       |   ├── github_stats_3.4.2.rst
|       |   ├── github_stats_3.4.3.rst
|       |   ├── github_stats_3.5.0.rst
|       |   ├── github_stats_3.5.1.rst
|       |   ├── whats_new_0.98.4.rst
|       |   ├── whats_new_0.99.rst
|       |   ├── whats_new_1.0.rst
|       |   ├── whats_new_1.1.rst
|       |   ├── whats_new_1.2.2.rst
|       |   ├── whats_new_1.2.rst
|       |   ├── whats_new_1.3.rst
|       |   ├── whats_new_1.4.rst
|       |   ├── whats_new_1.5.rst
|       |   ├── whats_new_2.0.0.rst
|       |   ├── whats_new_2.1.0.rst
|       |   ├── whats_new_2.2.rst
|       |   ├── whats_new_3.0.rst
|       |   ├── whats_new_3.1.0.rst
|       |   ├── whats_new_3.2.0.rst
|       |   ├── whats_new_3.3.0.rst
|       |   ├── whats_new_3.4.0.rst
|       |   ├── whats_new_3.5.0.rst
|       |   └── whats_new_3.5.2.rst
|       ├── project
|       |   ├── citing.rst
|       |   ├── credits.rst
|       |   ├── history.rst
|       |   ├── index.rst
|       |   └── license.rst
|       ├── release_notes.rst
|       ├── release_notes_next.rst
|       └── resources
|           └── index.rst
├── environment.yml
├── examples
|   ├── README.txt
|   ├── animation
|   |   ├── README.txt
|   |   ├── animate_decay.py
|   |   ├── animated_histogram.py
|   |   ├── animation_demo.py
|   |   ├── bayes_update.py
|   |   ├── double_pendulum.py
|   |   ├── dynamic_image.py
|   |   ├── frame_grabbing_sgskip.py
|   |   ├── pause_resume.py
|   |   ├── rain.py
|   |   ├── random_walk.py
|   |   ├── simple_anim.py
|   |   ├── strip_chart.py
|   |   └── unchained.py
|   ├── axes_grid1
|   |   ├── README.txt
|   |   ├── demo_anchored_direction_arrows.py
|   |   ├── demo_axes_divider.py
|   |   ├── demo_axes_grid.py
|   |   ├── demo_axes_grid2.py
|   |   ├── demo_axes_hbox_divider.py
|   |   ├── demo_axes_rgb.py
|   |   ├── demo_colorbar_of_inset_axes.py
|   |   ├── demo_colorbar_with_axes_divider.py
|   |   ├── demo_colorbar_with_inset_locator.py
|   |   ├── demo_edge_colorbar.py
|   |   ├── demo_fixed_size_axes.py
|   |   ├── demo_imagegrid_aspect.py
|   |   ├── inset_locator_demo.py
|   |   ├── inset_locator_demo2.py
|   |   ├── make_room_for_ylabel_using_axesgrid.py
|   |   ├── parasite_simple.py
|   |   ├── parasite_simple2.py
|   |   ├── scatter_hist_locatable_axes.py
|   |   ├── simple_anchored_artists.py
|   |   ├── simple_axes_divider1.py
|   |   ├── simple_axes_divider3.py
|   |   ├── simple_axesgrid.py
|   |   ├── simple_axesgrid2.py
|   |   ├── simple_axisline4.py
|   |   └── simple_colorbar.py
|   ├── axisartist
|   |   ├── README.txt
|   |   ├── axis_direction.py
|   |   ├── demo_axis_direction.py
|   |   ├── demo_axisline_style.py
|   |   ├── demo_curvelinear_grid.py
|   |   ├── demo_curvelinear_grid2.py
|   |   ├── demo_floating_axes.py
|   |   ├── demo_floating_axis.py
|   |   ├── demo_parasite_axes.py
|   |   ├── demo_parasite_axes2.py
|   |   ├── demo_ticklabel_alignment.py
|   |   ├── demo_ticklabel_direction.py
|   |   ├── simple_axis_direction01.py
|   |   ├── simple_axis_direction03.py
|   |   ├── simple_axis_pad.py
|   |   ├── simple_axisartist1.py
|   |   ├── simple_axisline.py
|   |   └── simple_axisline3.py
|   ├── color
|   |   ├── README.txt
|   |   ├── color_by_yvalue.py
|   |   ├── color_cycle_default.py
|   |   ├── color_demo.py
|   |   ├── colorbar_basics.py
|   |   ├── colormap_reference.py
|   |   ├── custom_cmap.py
|   |   └── named_colors.py
|   ├── event_handling
|   |   ├── README.txt
|   |   ├── close_event.py
|   |   ├── coords_demo.py
|   |   ├── cursor_demo.py
|   |   ├── data_browser.py
|   |   ├── figure_axes_enter_leave.py
|   |   ├── ginput_manual_clabel_sgskip.py
|   |   ├── image_slices_viewer.py
|   |   ├── keypress_demo.py
|   |   ├── lasso_demo.py
|   |   ├── legend_picking.py
|   |   ├── looking_glass.py
|   |   ├── path_editor.py
|   |   ├── pick_event_demo.py
|   |   ├── pick_event_demo2.py
|   |   ├── poly_editor.py
|   |   ├── pong_sgskip.py
|   |   ├── resample.py
|   |   ├── timers.py
|   |   ├── trifinder_event_demo.py
|   |   ├── viewlims.py
|   |   └── zoom_window.py
|   ├── images_contours_and_fields
|   |   ├── README.txt
|   |   ├── affine_image.py
|   |   ├── barb_demo.py
|   |   ├── barcode_demo.py
|   |   ├── colormap_interactive_adjustment.py
|   |   ├── colormap_normalizations.py
|   |   ├── colormap_normalizations_symlognorm.py
|   |   ├── contour_corner_mask.py
|   |   ├── contour_demo.py
|   |   ├── contour_image.py
|   |   ├── contour_label_demo.py
|   |   ├── contourf_demo.py
|   |   ├── contourf_hatching.py
|   |   ├── contourf_log.py
|   |   ├── contours_in_optimization_demo.py
|   |   ├── demo_bboximage.py
|   |   ├── figimage_demo.py
|   |   ├── image_annotated_heatmap.py
|   |   ├── image_antialiasing.py
|   |   ├── image_clip_path.py
|   |   ├── image_demo.py
|   |   ├── image_masked.py
|   |   ├── image_nonuniform.py
|   |   ├── image_transparency_blend.py
|   |   ├── image_zcoord.py
|   |   ├── interpolation_methods.py
|   |   ├── irregulardatagrid.py
|   |   ├── layer_images.py
|   |   ├── matshow.py
|   |   ├── multi_image.py
|   |   ├── pcolor_demo.py
|   |   ├── pcolormesh_grids.py
|   |   ├── pcolormesh_levels.py
|   |   ├── plot_streamplot.py
|   |   ├── quadmesh_demo.py
|   |   ├── quiver_demo.py
|   |   ├── quiver_simple_demo.py
|   |   ├── shading_example.py
|   |   ├── specgram_demo.py
|   |   ├── spy_demos.py
|   |   ├── tricontour_demo.py
|   |   ├── tricontour_smooth_delaunay.py
|   |   ├── tricontour_smooth_user.py
|   |   ├── trigradient_demo.py
|   |   ├── triinterp_demo.py
|   |   ├── tripcolor_demo.py
|   |   ├── triplot_demo.py
|   |   └── watermark_image.py
|   ├── lines_bars_and_markers
|   |   ├── README.txt
|   |   ├── bar_label_demo.py
|   |   ├── bar_stacked.py
|   |   ├── barchart.py
|   |   ├── barh.py
|   |   ├── broken_barh.py
|   |   ├── capstyle.py
|   |   ├── categorical_variables.py
|   |   ├── cohere.py
|   |   ├── csd_demo.py
|   |   ├── curve_error_band.py
|   |   ├── errorbar_limits_simple.py
|   |   ├── errorbar_subsample.py
|   |   ├── eventcollection_demo.py
|   |   ├── eventplot_demo.py
|   |   ├── fill.py
|   |   ├── fill_between_alpha.py
|   |   ├── fill_between_demo.py
|   |   ├── fill_betweenx_demo.py
|   |   ├── filled_step.py
|   |   ├── gradient_bar.py
|   |   ├── hat_graph.py
|   |   ├── horizontal_barchart_distribution.py
|   |   ├── joinstyle.py
|   |   ├── line_demo_dash_control.py
|   |   ├── lines_with_ticks_demo.py
|   |   ├── linestyles.py
|   |   ├── marker_reference.py
|   |   ├── markevery_demo.py
|   |   ├── masked_demo.py
|   |   ├── multicolored_line.py
|   |   ├── multivariate_marker_plot.py
|   |   ├── psd_demo.py
|   |   ├── scatter_custom_symbol.py
|   |   ├── scatter_demo2.py
|   |   ├── scatter_hist.py
|   |   ├── scatter_masked.py
|   |   ├── scatter_star_poly.py
|   |   ├── scatter_with_legend.py
|   |   ├── simple_plot.py
|   |   ├── span_regions.py
|   |   ├── spectrum_demo.py
|   |   ├── stackplot_demo.py
|   |   ├── stairs_demo.py
|   |   ├── stem_plot.py
|   |   ├── step_demo.py
|   |   ├── timeline.py
|   |   ├── vline_hline_demo.py
|   |   └── xcorr_acorr_demo.py
|   ├── misc
|   |   ├── README.txt
|   |   ├── anchored_artists.py
|   |   ├── bbox_intersect.py
|   |   ├── contour_manual.py
|   |   ├── coords_report.py
|   |   ├── custom_projection.py
|   |   ├── customize_rc.py
|   |   ├── demo_agg_filter.py
|   |   ├── demo_ribbon_box.py
|   |   ├── fill_spiral.py
|   |   ├── findobj_demo.py
|   |   ├── font_indexing.py
|   |   ├── ftface_props.py
|   |   ├── histogram_path.py
|   |   ├── hyperlinks_sgskip.py
|   |   ├── image_thumbnail_sgskip.py
|   |   ├── keyword_plotting.py
|   |   ├── logos2.py
|   |   ├── multipage_pdf.py
|   |   ├── multiprocess_sgskip.py
|   |   ├── packed_bubbles.py
|   |   ├── patheffect_demo.py
|   |   ├── print_stdout_sgskip.py
|   |   ├── pythonic_matplotlib.py
|   |   ├── rasterization_demo.py
|   |   ├── set_and_get.py
|   |   ├── svg_filter_line.py
|   |   ├── svg_filter_pie.py
|   |   ├── table_demo.py
|   |   ├── tickedstroke_demo.py
|   |   ├── transoffset.py
|   |   └── zorder_demo.py
|   ├── mplot3d
|   |   ├── 2dcollections3d.py
|   |   ├── 3d_bars.py
|   |   ├── README.txt
|   |   ├── bars3d.py
|   |   ├── box3d.py
|   |   ├── contour3d.py
|   |   ├── contour3d_2.py
|   |   ├── contour3d_3.py
|   |   ├── contourf3d.py
|   |   ├── contourf3d_2.py
|   |   ├── custom_shaded_3d_surface.py
|   |   ├── errorbar3d.py
|   |   ├── hist3d.py
|   |   ├── lines3d.py
|   |   ├── lorenz_attractor.py
|   |   ├── mixed_subplots.py
|   |   ├── offset.py
|   |   ├── pathpatch3d.py
|   |   ├── polys3d.py
|   |   ├── projections.py
|   |   ├── quiver3d.py
|   |   ├── rotate_axes3d_sgskip.py
|   |   ├── scatter3d.py
|   |   ├── stem3d_demo.py
|   |   ├── subplot3d.py
|   |   ├── surface3d.py
|   |   ├── surface3d_2.py
|   |   ├── surface3d_3.py
|   |   ├── surface3d_radial.py
|   |   ├── text3d.py
|   |   ├── tricontour3d.py
|   |   ├── tricontourf3d.py
|   |   ├── trisurf3d.py
|   |   ├── trisurf3d_2.py
|   |   ├── voxels.py
|   |   ├── voxels_numpy_logo.py
|   |   ├── voxels_rgb.py
|   |   ├── voxels_torus.py
|   |   ├── wire3d.py
|   |   ├── wire3d_animation_sgskip.py
|   |   └── wire3d_zero_stride.py
|   ├── pie_and_polar_charts
|   |   ├── README.txt
|   |   ├── bar_of_pie.py
|   |   ├── nested_pie.py
|   |   ├── pie_and_donut_labels.py
|   |   ├── pie_demo2.py
|   |   ├── pie_features.py
|   |   ├── polar_bar.py
|   |   ├── polar_demo.py
|   |   ├── polar_legend.py
|   |   └── polar_scatter.py
|   ├── pyplots
|   |   ├── README.txt
|   |   ├── align_ylabels.py
|   |   ├── annotate_transform.py
|   |   ├── annotation_basic.py
|   |   ├── annotation_polar.py
|   |   ├── auto_subplots_adjust.py
|   |   ├── axline.py
|   |   ├── boxplot_demo_pyplot.py
|   |   ├── dollar_ticks.py
|   |   ├── fig_axes_customize_simple.py
|   |   ├── fig_axes_labels_simple.py
|   |   ├── fig_x.py
|   |   ├── pyplot_formatstr.py
|   |   ├── pyplot_mathtext.py
|   |   ├── pyplot_simple.py
|   |   ├── pyplot_text.py
|   |   ├── pyplot_three.py
|   |   ├── pyplot_two_subplots.py
|   |   ├── text_commands.py
|   |   └── text_layout.py
|   ├── scales
|   |   ├── README.txt
|   |   ├── asinh_demo.py
|   |   ├── aspect_loglog.py
|   |   ├── custom_scale.py
|   |   ├── log_bar.py
|   |   ├── log_demo.py
|   |   ├── logit_demo.py
|   |   ├── power_norm.py
|   |   ├── scales.py
|   |   ├── semilogx_demo.py
|   |   └── symlog_demo.py
|   ├── shapes_and_collections
|   |   ├── README.txt
|   |   ├── arrow_guide.py
|   |   ├── artist_reference.py
|   |   ├── collections.py
|   |   ├── compound_path.py
|   |   ├── dolphin.py
|   |   ├── donut.py
|   |   ├── ellipse_collection.py
|   |   ├── ellipse_demo.py
|   |   ├── fancybox_demo.py
|   |   ├── hatch_demo.py
|   |   ├── hatch_style_reference.py
|   |   ├── line_collection.py
|   |   ├── patch_collection.py
|   |   ├── path_patch.py
|   |   ├── quad_bezier.py
|   |   └── scatter.py
|   ├── showcase
|   |   ├── README.txt
|   |   ├── anatomy.py
|   |   ├── bachelors_degrees_by_gender.py
|   |   ├── firefox.py
|   |   ├── integral.py
|   |   ├── mandelbrot.py
|   |   └── xkcd.py
|   ├── specialty_plots
|   |   ├── README.txt
|   |   ├── advanced_hillshading.py
|   |   ├── anscombe.py
|   |   ├── hinton_demo.py
|   |   ├── leftventricle_bulleye.py
|   |   ├── mri_demo.py
|   |   ├── mri_with_eeg.py
|   |   ├── radar_chart.py
|   |   ├── sankey_basics.py
|   |   ├── sankey_links.py
|   |   ├── sankey_rankine.py
|   |   ├── skewt.py
|   |   └── topographic_hillshading.py
|   ├── spines
|   |   ├── README.txt
|   |   ├── centered_spines_with_arrows.py
|   |   ├── multiple_yaxis_with_spines.py
|   |   ├── spine_placement_demo.py
|   |   ├── spines.py
|   |   ├── spines_bounds.py
|   |   └── spines_dropped.py
|   ├── statistics
|   |   ├── README.txt
|   |   ├── barchart_demo.py
|   |   ├── boxplot.py
|   |   ├── boxplot_color.py
|   |   ├── boxplot_demo.py
|   |   ├── boxplot_vs_violin.py
|   |   ├── bxp.py
|   |   ├── confidence_ellipse.py
|   |   ├── customized_violin.py
|   |   ├── errorbar.py
|   |   ├── errorbar_features.py
|   |   ├── errorbar_limits.py
|   |   ├── errorbars_and_boxes.py
|   |   ├── hexbin_demo.py
|   |   ├── hist.py
|   |   ├── histogram_cumulative.py
|   |   ├── histogram_features.py
|   |   ├── histogram_histtypes.py
|   |   ├── histogram_multihist.py
|   |   ├── multiple_histograms_side_by_side.py
|   |   ├── time_series_histogram.py
|   |   └── violinplot.py
|   ├── style_sheets
|   |   ├── README.txt
|   |   ├── bmh.py
|   |   ├── dark_background.py
|   |   ├── fivethirtyeight.py
|   |   ├── ggplot.py
|   |   ├── grayscale.py
|   |   ├── plot_solarizedlight2.py
|   |   └── style_sheets_reference.py
|   ├── subplots_axes_and_figures
|   |   ├── README.txt
|   |   ├── align_labels_demo.py
|   |   ├── axes_box_aspect.py
|   |   ├── axes_demo.py
|   |   ├── axes_margins.py
|   |   ├── axes_props.py
|   |   ├── axes_zoom_effect.py
|   |   ├── axhspan_demo.py
|   |   ├── axis_equal_demo.py
|   |   ├── axis_labels_demo.py
|   |   ├── broken_axis.py
|   |   ├── colorbar_placement.py
|   |   ├── custom_figure_class.py
|   |   ├── demo_constrained_layout.py
|   |   ├── demo_tight_layout.py
|   |   ├── fahrenheit_celsius_scales.py
|   |   ├── figure_size_units.py
|   |   ├── figure_title.py
|   |   ├── ganged_plots.py
|   |   ├── geo_demo.py
|   |   ├── gridspec_and_subplots.py
|   |   ├── gridspec_multicolumn.py
|   |   ├── gridspec_nested.py
|   |   ├── invert_axes.py
|   |   ├── multiple_figs_demo.py
|   |   ├── secondary_axis.py
|   |   ├── share_axis_lims_views.py
|   |   ├── shared_axis_demo.py
|   |   ├── subfigures.py
|   |   ├── subplot.py
|   |   ├── subplots_adjust.py
|   |   ├── subplots_demo.py
|   |   ├── two_scales.py
|   |   └── zoom_inset_axes.py
|   ├── text_labels_and_annotations
|   |   ├── README.txt
|   |   ├── accented_text.py
|   |   ├── angle_annotation.py
|   |   ├── annotation_demo.py
|   |   ├── arrow_demo.py
|   |   ├── autowrap.py
|   |   ├── custom_legends.py
|   |   ├── date.py
|   |   ├── demo_annotation_box.py
|   |   ├── demo_text_path.py
|   |   ├── demo_text_rotation_mode.py
|   |   ├── dfrac_demo.py
|   |   ├── engineering_formatter.py
|   |   ├── fancyarrow_demo.py
|   |   ├── fancytextbox_demo.py
|   |   ├── figlegend_demo.py
|   |   ├── font_family_rc.py
|   |   ├── font_file.py
|   |   ├── font_table.py
|   |   ├── fonts_demo.py
|   |   ├── fonts_demo_kw.py
|   |   ├── label_subplots.py
|   |   ├── legend.py
|   |   ├── legend_demo.py
|   |   ├── line_with_text.py
|   |   ├── mathtext_asarray.py
|   |   ├── mathtext_demo.py
|   |   ├── mathtext_examples.py
|   |   ├── mathtext_fontfamily_example.py
|   |   ├── multiline.py
|   |   ├── placing_text_boxes.py
|   |   ├── rainbow_text.py
|   |   ├── stix_fonts_demo.py
|   |   ├── tex_demo.py
|   |   ├── text_alignment.py
|   |   ├── text_fontdict.py
|   |   ├── text_rotation.py
|   |   ├── text_rotation_relative_to_line.py
|   |   ├── titles_demo.py
|   |   ├── unicode_minus.py
|   |   ├── usetex_baseline_test.py
|   |   ├── usetex_fonteffects.py
|   |   └── watermark_text.py
|   ├── ticks
|   |   ├── README.txt
|   |   ├── auto_ticks.py
|   |   ├── centered_ticklabels.py
|   |   ├── colorbar_tick_labelling_demo.py
|   |   ├── custom_ticker1.py
|   |   ├── date_concise_formatter.py
|   |   ├── date_demo_convert.py
|   |   ├── date_demo_rrule.py
|   |   ├── date_formatters_locators.py
|   |   ├── date_index_formatter.py
|   |   ├── date_precision_and_epochs.py
|   |   ├── major_minor_demo.py
|   |   ├── scalarformatter.py
|   |   ├── tick-formatters.py
|   |   ├── tick-locators.py
|   |   ├── tick_label_right.py
|   |   ├── tick_labels_from_values.py
|   |   ├── tick_xlabel_top.py
|   |   ├── ticklabels_rotation.py
|   |   └── ticks_too_many.py
|   ├── units
|   |   ├── README.txt
|   |   ├── annotate_with_units.py
|   |   ├── artist_tests.py
|   |   ├── bar_demo2.py
|   |   ├── bar_unit_demo.py
|   |   ├── basic_units.py
|   |   ├── ellipse_with_units.py
|   |   ├── evans_test.py
|   |   ├── radian_demo.py
|   |   ├── units_sample.py
|   |   └── units_scatter.py
|   ├── user_interfaces
|   |   ├── README.txt
|   |   ├── canvasagg.py
|   |   ├── embedding_in_gtk3_panzoom_sgskip.py
|   |   ├── embedding_in_gtk3_sgskip.py
|   |   ├── embedding_in_gtk4_panzoom_sgskip.py
|   |   ├── embedding_in_gtk4_sgskip.py
|   |   ├── embedding_in_qt_sgskip.py
|   |   ├── embedding_in_tk_sgskip.py
|   |   ├── embedding_in_wx2_sgskip.py
|   |   ├── embedding_in_wx3_sgskip.py
|   |   ├── embedding_in_wx4_sgskip.py
|   |   ├── embedding_in_wx5_sgskip.py
|   |   ├── embedding_webagg_sgskip.py
|   |   ├── fourier_demo_wx_sgskip.py
|   |   ├── gtk3_spreadsheet_sgskip.py
|   |   ├── gtk4_spreadsheet_sgskip.py
|   |   ├── mathtext_wx_sgskip.py
|   |   ├── mpl_with_glade3_sgskip.py
|   |   ├── pylab_with_gtk3_sgskip.py
|   |   ├── pylab_with_gtk4_sgskip.py
|   |   ├── svg_histogram_sgskip.py
|   |   ├── svg_tooltip_sgskip.py
|   |   ├── toolmanager_sgskip.py
|   |   ├── web_application_server_sgskip.py
|   |   └── wxcursor_demo_sgskip.py
|   ├── userdemo
|   |   ├── README.txt
|   |   ├── anchored_box04.py
|   |   ├── annotate_explain.py
|   |   ├── annotate_simple01.py
|   |   ├── annotate_simple02.py
|   |   ├── annotate_simple03.py
|   |   ├── annotate_simple04.py
|   |   ├── annotate_simple_coord01.py
|   |   ├── annotate_simple_coord02.py
|   |   ├── annotate_simple_coord03.py
|   |   ├── annotate_text_arrow.py
|   |   ├── connect_simple01.py
|   |   ├── connectionstyle_demo.py
|   |   ├── custom_boxstyle01.py
|   |   ├── demo_gridspec01.py
|   |   ├── demo_gridspec03.py
|   |   ├── demo_gridspec06.py
|   |   ├── pgf_fonts.py
|   |   ├── pgf_preamble_sgskip.py
|   |   ├── pgf_texsystem.py
|   |   ├── simple_annotate01.py
|   |   ├── simple_legend01.py
|   |   └── simple_legend02.py
|   └── widgets
|       ├── README.txt
|       ├── annotated_cursor.py
|       ├── buttons.py
|       ├── check_buttons.py
|       ├── cursor.py
|       ├── lasso_selector_demo_sgskip.py
|       ├── menu.py
|       ├── mouse_cursor.py
|       ├── multicursor.py
|       ├── polygon_selector_demo.py
|       ├── polygon_selector_simple.py
|       ├── radio_buttons.py
|       ├── range_slider.py
|       ├── rectangle_selector.py
|       ├── slider_demo.py
|       ├── slider_snap_demo.py
|       ├── span_selector.py
|       └── textbox.py
├── extern
|   ├── agg24-svn
|   |   ├── include
|   |   |   ├── ctrl
|   |   |   ├── platform
|   |   |   |   ├── mac
|   |   |   |   └── win32
|   |   |   └── util
|   |   └── src
|   |       ├── agg_arc.cpp
|   |       ├── agg_arrowhead.cpp
|   |       ├── agg_bezier_arc.cpp
|   |       ├── agg_bspline.cpp
|   |       ├── agg_color_rgba.cpp
|   |       ├── agg_curves.cpp
|   |       ├── agg_embedded_raster_fonts.cpp
|   |       ├── agg_gsv_text.cpp
|   |       ├── agg_image_filters.cpp
|   |       ├── agg_line_aa_basics.cpp
|   |       ├── agg_line_profile_aa.cpp
|   |       ├── agg_rounded_rect.cpp
|   |       ├── agg_sqrt_tables.cpp
|   |       ├── agg_trans_affine.cpp
|   |       ├── agg_trans_double_path.cpp
|   |       ├── agg_trans_single_path.cpp
|   |       ├── agg_trans_warp_magnifier.cpp
|   |       ├── agg_vcgen_bspline.cpp
|   |       ├── agg_vcgen_contour.cpp
|   |       ├── agg_vcgen_dash.cpp
|   |       ├── agg_vcgen_markers_term.cpp
|   |       ├── agg_vcgen_smooth_poly1.cpp
|   |       ├── agg_vcgen_stroke.cpp
|   |       ├── agg_vpgen_clip_polygon.cpp
|   |       ├── agg_vpgen_clip_polyline.cpp
|   |       ├── agg_vpgen_segmentator.cpp
|   |       ├── ctrl
|   |       |   ├── agg_bezier_ctrl.cpp
|   |       |   ├── agg_cbox_ctrl.cpp
|   |       |   ├── agg_gamma_ctrl.cpp
|   |       |   ├── agg_gamma_spline.cpp
|   |       |   ├── agg_polygon_ctrl.cpp
|   |       |   ├── agg_rbox_ctrl.cpp
|   |       |   ├── agg_scale_ctrl.cpp
|   |       |   ├── agg_slider_ctrl.cpp
|   |       |   └── agg_spline_ctrl.cpp
|   |       └── platform
|   |           ├── AmigaOS
|   |           ├── BeOS
|   |           ├── X11
|   |           ├── mac
|   |           ├── sdl
|   |           └── win32
|   └── ttconv
|       ├── pprdrv_tt.cpp
|       ├── pprdrv_tt2.cpp
|       └── ttutil.cpp
├── lib
|   ├── matplotlib
|   |   ├── __init__.py
|   |   ├── _afm.py
|   |   ├── _animation_data.py
|   |   ├── _api
|   |   |   ├── __init__.py
|   |   |   └── deprecation.py
|   |   ├── _blocking_input.py
|   |   ├── _cm.py
|   |   ├── _cm_listed.py
|   |   ├── _color_data.py
|   |   ├── _constrained_layout.py
|   |   ├── _docstring.py
|   |   ├── _enums.py
|   |   ├── _fontconfig_pattern.py
|   |   ├── _internal_utils.py
|   |   ├── _layoutgrid.py
|   |   ├── _mathtext.py
|   |   ├── _mathtext_data.py
|   |   ├── _pylab_helpers.py
|   |   ├── _text_helpers.py
|   |   ├── _tight_bbox.py
|   |   ├── _tight_layout.py
|   |   ├── _type1font.py
|   |   ├── afm.py
|   |   ├── animation.py
|   |   ├── artist.py
|   |   ├── axes
|   |   |   ├── __init__.py
|   |   |   ├── _axes.py
|   |   |   ├── _base.py
|   |   |   ├── _secondary_axes.py
|   |   |   └── _subplots.py
|   |   ├── axis.py
|   |   ├── backend_bases.py
|   |   ├── backend_managers.py
|   |   ├── backend_tools.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── _backend_gtk.py
|   |   |   ├── _backend_pdf_ps.py
|   |   |   ├── _backend_tk.py
|   |   |   ├── backend_agg.py
|   |   |   ├── backend_cairo.py
|   |   |   ├── backend_gtk3.py
|   |   |   ├── backend_gtk3agg.py
|   |   |   ├── backend_gtk3cairo.py
|   |   |   ├── backend_gtk4.py
|   |   |   ├── backend_gtk4agg.py
|   |   |   ├── backend_gtk4cairo.py
|   |   |   ├── backend_macosx.py
|   |   |   ├── backend_mixed.py
|   |   |   ├── backend_nbagg.py
|   |   |   ├── backend_pdf.py
|   |   |   ├── backend_pgf.py
|   |   |   ├── backend_ps.py
|   |   |   ├── backend_qt.py
|   |   |   ├── backend_qt5.py
|   |   |   ├── backend_qt5agg.py
|   |   |   ├── backend_qt5cairo.py
|   |   |   ├── backend_qtagg.py
|   |   |   ├── backend_qtcairo.py
|   |   |   ├── backend_svg.py
|   |   |   ├── backend_template.py
|   |   |   ├── backend_tkagg.py
|   |   |   ├── backend_tkcairo.py
|   |   |   ├── backend_webagg.py
|   |   |   ├── backend_webagg_core.py
|   |   |   ├── backend_wx.py
|   |   |   ├── backend_wxagg.py
|   |   |   ├── backend_wxcairo.py
|   |   |   ├── qt_compat.py
|   |   |   ├── qt_editor
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _formlayout.py
|   |   |   |   └── figureoptions.py
|   |   |   └── web_backend
|   |   |       ├── .eslintrc.js
|   |   |       ├── all_figures.html
|   |   |       ├── css
|   |   |       ├── ipython_inline_figure.html
|   |   |       ├── js
|   |   |       └── single_figure.html
|   |   ├── bezier.py
|   |   ├── blocking_input.py
|   |   ├── category.py
|   |   ├── cbook
|   |   |   └── __init__.py
|   |   ├── cm.py
|   |   ├── collections.py
|   |   ├── colorbar.py
|   |   ├── colors.py
|   |   ├── container.py
|   |   ├── contour.py
|   |   ├── dates.py
|   |   ├── docstring.py
|   |   ├── dviread.py
|   |   ├── figure.py
|   |   ├── font_manager.py
|   |   ├── fontconfig_pattern.py
|   |   ├── gridspec.py
|   |   ├── hatch.py
|   |   ├── image.py
|   |   ├── layout_engine.py
|   |   ├── legend.py
|   |   ├── legend_handler.py
|   |   ├── lines.py
|   |   ├── markers.py
|   |   ├── mathtext.py
|   |   ├── mlab.py
|   |   ├── mpl-data
|   |   |   ├── fonts
|   |   |   |   ├── afm
|   |   |   |   ├── pdfcorefonts
|   |   |   |   └── ttf
|   |   |   ├── images
|   |   |   ├── plot_directive
|   |   |   |   └── plot_directive.css
|   |   |   ├── sample_data
|   |   |   |   ├── README.txt
|   |   |   |   └── axes_grid
|   |   |   └── stylelib
|   |   ├── offsetbox.py
|   |   ├── patches.py
|   |   ├── path.py
|   |   ├── patheffects.py
|   |   ├── projections
|   |   |   ├── __init__.py
|   |   |   ├── geo.py
|   |   |   └── polar.py
|   |   ├── pylab.py
|   |   ├── pyplot.py
|   |   ├── quiver.py
|   |   ├── rcsetup.py
|   |   ├── sankey.py
|   |   ├── scale.py
|   |   ├── sphinxext
|   |   |   ├── __init__.py
|   |   |   ├── mathmpl.py
|   |   |   └── plot_directive.py
|   |   ├── spines.py
|   |   ├── stackplot.py
|   |   ├── streamplot.py
|   |   ├── style
|   |   |   ├── __init__.py
|   |   |   └── core.py
|   |   ├── table.py
|   |   ├── testing
|   |   |   ├── __init__.py
|   |   |   ├── _markers.py
|   |   |   ├── compare.py
|   |   |   ├── conftest.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── jpl_units
|   |   |   |   ├── Duration.py
|   |   |   |   ├── Epoch.py
|   |   |   |   ├── EpochConverter.py
|   |   |   |   ├── StrConverter.py
|   |   |   |   ├── UnitDbl.py
|   |   |   |   ├── UnitDblConverter.py
|   |   |   |   ├── UnitDblFormatter.py
|   |   |   |   └── __init__.py
|   |   |   └── widgets.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── baseline_images
|   |   |   |   ├── dviread
|   |   |   |   ├── pngsuite
|   |   |   |   ├── test_agg
|   |   |   |   ├── test_agg_filter
|   |   |   |   ├── test_arrow_patches
|   |   |   |   ├── test_artist
|   |   |   |   ├── test_axes
|   |   |   |   ├── test_backend_pdf
|   |   |   |   ├── test_backend_pgf
|   |   |   |   ├── test_backend_ps
|   |   |   |   ├── test_backend_svg
|   |   |   |   ├── test_bbox_tight
|   |   |   |   ├── test_collections
|   |   |   |   ├── test_colorbar
|   |   |   |   ├── test_colors
|   |   |   |   ├── test_compare_images
|   |   |   |   ├── test_constrainedlayout
|   |   |   |   ├── test_contour
|   |   |   |   ├── test_dates
|   |   |   |   ├── test_figure
|   |   |   |   ├── test_image
|   |   |   |   ├── test_legend
|   |   |   |   ├── test_lines
|   |   |   |   ├── test_mathtext
|   |   |   |   ├── test_offsetbox
|   |   |   |   ├── test_patches
|   |   |   |   ├── test_path
|   |   |   |   ├── test_patheffects
|   |   |   |   ├── test_png
|   |   |   |   ├── test_polar
|   |   |   |   ├── test_quiver
|   |   |   |   ├── test_scale
|   |   |   |   ├── test_simplification
|   |   |   |   ├── test_skew
|   |   |   |   ├── test_spines
|   |   |   |   ├── test_streamplot
|   |   |   |   ├── test_subplots
|   |   |   |   ├── test_table
|   |   |   |   ├── test_text
|   |   |   |   ├── test_tightlayout
|   |   |   |   ├── test_transforms
|   |   |   |   ├── test_triangulation
|   |   |   |   ├── test_ttconv
|   |   |   |   ├── test_units
|   |   |   |   ├── test_usetex
|   |   |   |   └── test_widgets
|   |   |   ├── conftest.py
|   |   |   ├── test_afm.py
|   |   |   ├── test_agg.py
|   |   |   ├── test_agg_filter.py
|   |   |   ├── test_animation.py
|   |   |   ├── test_api.py
|   |   |   ├── test_arrow_patches.py
|   |   |   ├── test_artist.py
|   |   |   ├── test_axes.py
|   |   |   ├── test_backend_bases.py
|   |   |   ├── test_backend_cairo.py
|   |   |   ├── test_backend_gtk3.py
|   |   |   ├── test_backend_macosx.py
|   |   |   ├── test_backend_nbagg.py
|   |   |   ├── test_backend_pdf.py
|   |   |   ├── test_backend_pgf.py
|   |   |   ├── test_backend_ps.py
|   |   |   ├── test_backend_qt.py
|   |   |   ├── test_backend_svg.py
|   |   |   ├── test_backend_template.py
|   |   |   ├── test_backend_tk.py
|   |   |   ├── test_backend_tools.py
|   |   |   ├── test_backend_webagg.py
|   |   |   ├── test_backends_interactive.py
|   |   |   ├── test_basic.py
|   |   |   ├── test_bbox_tight.py
|   |   |   ├── test_category.py
|   |   |   ├── test_cbook.py
|   |   |   ├── test_collections.py
|   |   |   ├── test_colorbar.py
|   |   |   ├── test_colors.py
|   |   |   ├── test_compare_images.py
|   |   |   ├── test_constrainedlayout.py
|   |   |   ├── test_container.py
|   |   |   ├── test_contour.py
|   |   |   ├── test_cycles.py
|   |   |   ├── test_dates.py
|   |   |   ├── test_determinism.py
|   |   |   ├── test_doc.py
|   |   |   ├── test_dviread.py
|   |   |   ├── test_figure.py
|   |   |   ├── test_font_manager.py
|   |   |   ├── test_fontconfig_pattern.py
|   |   |   ├── test_getattr.py
|   |   |   ├── test_gridspec.py
|   |   |   ├── test_image.py
|   |   |   ├── test_legend.py
|   |   |   ├── test_lines.py
|   |   |   ├── test_marker.py
|   |   |   ├── test_mathtext.py
|   |   |   ├── test_matplotlib.py
|   |   |   ├── test_mlab.py
|   |   |   ├── test_offsetbox.py
|   |   |   ├── test_patches.py
|   |   |   ├── test_path.py
|   |   |   ├── test_patheffects.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_png.py
|   |   |   ├── test_polar.py
|   |   |   ├── test_preprocess_data.py
|   |   |   ├── test_pyplot.py
|   |   |   ├── test_quiver.py
|   |   |   ├── test_rcparams.py
|   |   |   ├── test_sankey.py
|   |   |   ├── test_scale.py
|   |   |   ├── test_simplification.py
|   |   |   ├── test_skew.py
|   |   |   ├── test_sphinxext.py
|   |   |   ├── test_spines.py
|   |   |   ├── test_streamplot.py
|   |   |   ├── test_style.py
|   |   |   ├── test_subplots.py
|   |   |   ├── test_table.py
|   |   |   ├── test_testing.py
|   |   |   ├── test_texmanager.py
|   |   |   ├── test_text.py
|   |   |   ├── test_textpath.py
|   |   |   ├── test_ticker.py
|   |   |   ├── test_tightlayout.py
|   |   |   ├── test_transforms.py
|   |   |   ├── test_triangulation.py
|   |   |   ├── test_ttconv.py
|   |   |   ├── test_type1font.py
|   |   |   ├── test_units.py
|   |   |   ├── test_usetex.py
|   |   |   ├── test_widgets.py
|   |   |   └── tinypages
|   |   |       ├── README.md
|   |   |       ├── _static
|   |   |       ├── conf.py
|   |   |       ├── included_plot_21.rst
|   |   |       ├── index.rst
|   |   |       ├── range4.py
|   |   |       ├── range6.py
|   |   |       └── some_plots.rst
|   |   ├── texmanager.py
|   |   ├── text.py
|   |   ├── textpath.py
|   |   ├── ticker.py
|   |   ├── tight_bbox.py
|   |   ├── tight_layout.py
|   |   ├── transforms.py
|   |   ├── tri
|   |   |   ├── __init__.py
|   |   |   ├── triangulation.py
|   |   |   ├── tricontour.py
|   |   |   ├── trifinder.py
|   |   |   ├── triinterpolate.py
|   |   |   ├── tripcolor.py
|   |   |   ├── triplot.py
|   |   |   ├── trirefine.py
|   |   |   └── tritools.py
|   |   ├── type1font.py
|   |   ├── units.py
|   |   └── widgets.py
|   ├── mpl_toolkits
|   |   ├── __init__.py
|   |   ├── axes_grid1
|   |   |   ├── __init__.py
|   |   |   ├── anchored_artists.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axes_size.py
|   |   |   ├── inset_locator.py
|   |   |   ├── mpl_axes.py
|   |   |   └── parasite_axes.py
|   |   ├── axisartist
|   |   |   ├── __init__.py
|   |   |   ├── angle_helper.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axis_artist.py
|   |   |   ├── axisline_style.py
|   |   |   ├── axislines.py
|   |   |   ├── clip_path.py
|   |   |   ├── floating_axes.py
|   |   |   ├── grid_finder.py
|   |   |   ├── grid_helper_curvelinear.py
|   |   |   └── parasite_axes.py
|   |   ├── mplot3d
|   |   |   ├── __init__.py
|   |   |   ├── art3d.py
|   |   |   ├── axes3d.py
|   |   |   ├── axis3d.py
|   |   |   └── proj3d.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── baseline_images
|   |       |   ├── test_axes_grid
|   |       |   ├── test_axes_grid1
|   |       |   ├── test_axisartist_axis_artist
|   |       |   ├── test_axisartist_axislines
|   |       |   ├── test_axisartist_clip_path
|   |       |   ├── test_axisartist_floating_axes
|   |       |   ├── test_axisartist_grid_helper_curvelinear
|   |       |   └── test_mplot3d
|   |       ├── conftest.py
|   |       ├── test_axes_grid.py
|   |       ├── test_axes_grid1.py
|   |       ├── test_axisartist_angle_helper.py
|   |       ├── test_axisartist_axis_artist.py
|   |       ├── test_axisartist_axislines.py
|   |       ├── test_axisartist_clip_path.py
|   |       ├── test_axisartist_floating_axes.py
|   |       ├── test_axisartist_grid_finder.py
|   |       ├── test_axisartist_grid_helper_curvelinear.py
|   |       └── test_mplot3d.py
|   └── pylab.py
├── plot_types
|   ├── README.rst
|   ├── arrays
|   |   ├── README.rst
|   |   ├── barbs.py
|   |   ├── contour.py
|   |   ├── contourf.py
|   |   ├── imshow.py
|   |   ├── pcolormesh.py
|   |   ├── quiver.py
|   |   └── streamplot.py
|   ├── basic
|   |   ├── README.rst
|   |   ├── bar.py
|   |   ├── fill_between.py
|   |   ├── plot.py
|   |   ├── scatter_plot.py
|   |   ├── stackplot.py
|   |   ├── stem.py
|   |   └── step.py
|   ├── stats
|   |   ├── README.rst
|   |   ├── boxplot_plot.py
|   |   ├── errorbar_plot.py
|   |   ├── eventplot.py
|   |   ├── hexbin.py
|   |   ├── hist2d.py
|   |   ├── hist_plot.py
|   |   ├── pie.py
|   |   └── violin.py
|   └── unstructured
|       ├── README.rst
|       ├── tricontour.py
|       ├── tricontourf.py
|       ├── tripcolor.py
|       └── triplot.py
├── requirements
|   ├── dev
|   |   └── dev-requirements.txt
|   ├── doc
|   |   └── doc-requirements.txt
|   └── testing
|       ├── all.txt
|       ├── extra.txt
|       ├── flake8.txt
|       └── minver.txt
├── setup.py
├── setupext.py
├── src
|   ├── _backend_agg.cpp
|   ├── _backend_agg_wrapper.cpp
|   ├── _c_internal_utils.c
|   ├── _image_wrapper.cpp
|   ├── _path_wrapper.cpp
|   ├── _qhull_wrapper.cpp
|   ├── _tkagg.cpp
|   ├── _ttconv.cpp
|   ├── checkdep_freetype2.c
|   ├── doc
|   ├── ft2font.cpp
|   ├── ft2font_wrapper.cpp
|   ├── py_converters.cpp
|   └── tri
|       ├── _tri.cpp
|       └── _tri_wrapper.cpp
├── tests.py
├── tools
|   ├── README.txt
|   ├── boilerplate.py
|   ├── cache_zenodo_svg.py
|   ├── create_DejaVuDisplay.sh
|   ├── embed_js.py
|   ├── gh_api.py
|   ├── github_stats.py
|   ├── make_icons.py
|   ├── memleak.py
|   ├── run_examples.py
|   ├── subset.py
|   ├── triage_tests.py
|   └── visualize_tests.py
└── tutorials
    ├── README.txt
    ├── advanced
    |   ├── README.txt
    |   ├── blitting.py
    |   ├── path_tutorial.py
    |   ├── patheffects_guide.py
    |   └── transforms_tutorial.py
    ├── colors
    |   ├── README.txt
    |   ├── colorbar_only.py
    |   ├── colormap-manipulation.py
    |   ├── colormapnorms.py
    |   ├── colormaps.py
    |   └── colors.py
    ├── intermediate
    |   ├── README.txt
    |   ├── arranging_axes.py
    |   ├── artists.py
    |   ├── autoscale.py
    |   ├── color_cycle.py
    |   ├── constrainedlayout_guide.py
    |   ├── imshow_extent.py
    |   ├── legend_guide.py
    |   └── tight_layout_guide.py
    ├── introductory
    |   ├── README.txt
    |   ├── customizing.py
    |   ├── images.py
    |   ├── lifecycle.py
    |   ├── pyplot.py
    |   └── quick_start.py
    ├── provisional
    |   ├── README.txt
    |   └── mosaic.py
    ├── text
    |   ├── README.txt
    |   ├── annotations.py
    |   ├── mathtext.py
    |   ├── pgf.py
    |   ├── text_intro.py
    |   ├── text_props.py
    |   └── usetex.py
    └── toolkits
        ├── README.txt
        ├── axes_grid.py
        ├── axisartist.py
        └── mplot3d.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: [Bug]: get_backend() clears figures from Gcf.figs if they were created under rc_context

Description: ### Bug summary

calling `matplotlib.get_backend()` removes all figures from `Gcf` if the *first* figure in `Gcf.figs` was created in an `rc_context`.

### Code for reproduction

```python
import matplotlib.pyplot as plt
from matplotlib import get_backend, rc_context

# fig1 = plt.figure()  # <- UNCOMMENT THIS LINE AND IT WILL WORK
# plt.ion()            # <- ALTERNATIVELY, UNCOMMENT THIS LINE AND IT WILL ALSO WORK
with rc_context():
    fig2 = plt.figure()
before = f'{id(plt._pylab_helpers.Gcf)} {plt._pylab_helpers.Gcf.figs!r}'
get_backend()
after = f'{id(plt._pylab_helpers.Gcf)} {plt._pylab_helpers.Gcf.figs!r}'

assert before == after, '\n' + before + '\n' + after
```


### Actual outcome

```
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
<ipython-input-1-fa4d099aa289> in <cell line: 11>()
      9 after = f'{id(plt._pylab_helpers.Gcf)} {plt._pylab_helpers.Gcf.figs!r}'
     10 
---> 11 assert before == after, '\n' + before + '\n' + after
     12 

AssertionError: 
94453354309744 OrderedDict([(1, <matplotlib.backends.backend_qt.FigureManagerQT object at 0x7fb33e26c220>)])
94453354309744 OrderedDict()
```

### Expected outcome

The figure should not be missing from `Gcf`.  Consequences of this are, e.g, `plt.close(fig2)` doesn't work because `Gcf.destroy_fig()` can't find it.

### Additional information

_No response_

### Operating system

Xubuntu

### Matplotlib Version

3.5.2

### Matplotlib Backend

QtAgg

### Python version

Python 3.10.4

### Jupyter version

n/a

### Installation

conda

Patch information:
diff --git a/lib/matplotlib/__init__.py b/lib/matplotlib/__init__.py
index c268a56724..c5c1a8e71a 100644
--- a/lib/matplotlib/__init__.py
+++ b/lib/matplotlib/__init__.py
@@ -1095,7 +1095,19 @@ def rc_context(rc=None, fname=None):
             rcParams.update(rc)
         yield
     finally:
-        dict.update(rcParams, orig)  # Revert to the original rcs.
+        # Revert to the original rcs, but preserve a resolved backend if the
+        # original value was the auto backend sentinel.
+        try:
+            original_backend = dict.__getitem__(orig, "backend")
+        except KeyError:
+            original_backend = None
+        if original_backend is rcsetup._auto_backend_sentinel:
+            # Get current backend without triggering resolution.
+            current_backend = dict.__getitem__(rcParams, "backend")
+            if current_backend is not rcsetup._auto_backend_sentinel:
+                # Preserve the resolved backend selected during the context.
+                dict.__setitem__(orig, "backend", current_backend)
+        dict.update(rcParams, orig)
 
 
 def use(backend, *, force=True):


Find all relevant source code context needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `lib/matplotlib/__init__.py`, `lib/matplotlib/pyplot.py`, `lib/matplotlib/_pylab_helpers.py`, and `lib/matplotlib/rcsetup.py`.
Extra Requirements: 
Purpose: This will allow me to trace the creation of the figure, its registration, and the mechanism by which `get_backend` might be clearing it, focusing on the backend selection logic within `rc_context`.

Previous refined query 2:
Essential Query: Please provide the full content of `lib/matplotlib/__init__.py`.
Extra Requirements: If the full file is too large, please provide at least the complete class definition for `RcParams`, and the full function definitions for `get_backend` and `rc_context`.
Purpose: To examine the interaction between `rc_context`, `rcParams`, and `get_backend` that leads to the erroneous clearing of figures.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: lib/matplotlib/__init__.py
Line number range: 1 - 500
Content:
1. """
2. An object-oriented plotting library.
3. 
4. A procedural interface is provided by the companion pyplot module,
5. which may be imported directly, e.g.::
6. 
7.     import matplotlib.pyplot as plt
8. 
9. or using ipython::
10. 
11.     ipython
12. 
13. at your terminal, followed by::
14. 
15.     In [1]: %matplotlib
16.     In [2]: import matplotlib.pyplot as plt
17. 
18. at the ipython shell prompt.
19. 
20. For the most part, direct use of the explicit object-oriented library is
21. encouraged when programming; the implicit pyplot interface is primarily for
22. working interactively. The exceptions to this suggestion are the pyplot
23. functions `.pyplot.figure`, `.pyplot.subplot`, `.pyplot.subplots`, and
24. `.pyplot.savefig`, which can greatly simplify scripting.  See
25. :ref:`api_interfaces` for an explanation of the tradeoffs between the implicit
26. and explicit interfaces.
27. 
28. Modules include:
29. 
30.     :mod:`matplotlib.axes`
31.         The `~.axes.Axes` class.  Most pyplot functions are wrappers for
32.         `~.axes.Axes` methods.  The axes module is the highest level of OO
33.         access to the library.
34. 
35.     :mod:`matplotlib.figure`
36.         The `.Figure` class.
37. 
38.     :mod:`matplotlib.artist`
39.         The `.Artist` base class for all classes that draw things.
40. 
41.     :mod:`matplotlib.lines`
42.         The `.Line2D` class for drawing lines and markers.
43. 
44.     :mod:`matplotlib.patches`
45.         Classes for drawing polygons.
46. 
47.     :mod:`matplotlib.text`
48.         The `.Text` and `.Annotation` classes.
49. 
50.     :mod:`matplotlib.image`
51.         The `.AxesImage` and `.FigureImage` classes.
52. 
53.     :mod:`matplotlib.collections`
54.         Classes for efficient drawing of groups of lines or polygons.
55. 
56.     :mod:`matplotlib.colors`
57.         Color specifications and making colormaps.
58. 
59.     :mod:`matplotlib.cm`
60.         Colormaps, and the `.ScalarMappable` mixin class for providing color
61.         mapping functionality to other classes.
62. 
63.     :mod:`matplotlib.ticker`
64.         Calculation of tick mark locations and formatting of tick labels.
65. 
66.     :mod:`matplotlib.backends`
67.         A subpackage with modules for various GUI libraries and output formats.
68. 
69. The base matplotlib namespace includes:
70. 
71.     `~matplotlib.rcParams`
72.         Default configuration settings; their defaults may be overridden using
73.         a :file:`matplotlibrc` file.
74. 
75.     `~matplotlib.use`
76.         Setting the Matplotlib backend.  This should be called before any
77.         figure is created, because it is not possible to switch between
78.         different GUI backends after that.
79. 
80. Matplotlib was initially written by John D. Hunter (1968-2012) and is now
81. developed and maintained by a host of others.
82. 
83. Occasionally the internal documentation (python docstrings) will refer
84. to MATLAB&reg;, a registered trademark of The MathWorks, Inc.
85. 
86. """
87. 
88. import atexit
89. from collections import namedtuple
90. from collections.abc import MutableMapping
91. import contextlib
92. import functools
93. import importlib
94. import inspect
95. from inspect import Parameter
96. import locale
97. import logging
98. import os
99. from pathlib import Path
100. import pprint
101. import re
102. import shutil
103. import subprocess
104. import sys
105. import tempfile
106. import warnings
107. 
108. import numpy
109. from packaging.version import parse as parse_version
110. 
111. # cbook must import matplotlib only within function
112. # definitions, so it is safe to import from it here.
113. from . import _api, _version, cbook, _docstring, rcsetup
114. from matplotlib.cbook import sanitize_sequence
115. from matplotlib._api import MatplotlibDeprecationWarning
116. from matplotlib.rcsetup import validate_backend, cycler
117. 
118. 
119. _log = logging.getLogger(__name__)
120. 
121. __bibtex__ = r"""@Article{Hunter:2007,
122.   Author    = {Hunter, J. D.},
123.   Title     = {Matplotlib: A 2D graphics environment},
124.   Journal   = {Computing in Science \& Engineering},
125.   Volume    = {9},
126.   Number    = {3},
127.   Pages     = {90--95},
128.   abstract  = {Matplotlib is a 2D graphics package used for Python
129.   for application development, interactive scripting, and
130.   publication-quality image generation across user
131.   interfaces and operating systems.},
132.   publisher = {IEEE COMPUTER SOC},
133.   year      = 2007
134. }"""
135. 
136. # modelled after sys.version_info
137. _VersionInfo = namedtuple('_VersionInfo',
138.                           'major, minor, micro, releaselevel, serial')
139. 
140. 
141. def _parse_to_version_info(version_str):
142.     """
143.     Parse a version string to a namedtuple analogous to sys.version_info.
144. 
145.     See:
146.     https://packaging.pypa.io/en/latest/version.html#packaging.version.parse
147.     https://docs.python.org/3/library/sys.html#sys.version_info
148.     """
149.     v = parse_version(version_str)
150.     if v.pre is None and v.post is None and v.dev is None:
151.         return _VersionInfo(v.major, v.minor, v.micro, 'final', 0)
152.     elif v.dev is not None:
153.         return _VersionInfo(v.major, v.minor, v.micro, 'alpha', v.dev)
154.     elif v.pre is not None:
155.         releaselevel = {
156.             'a': 'alpha',
157.             'b': 'beta',
158.             'rc': 'candidate'}.get(v.pre[0], 'alpha')
159.         return _VersionInfo(v.major, v.minor, v.micro, releaselevel, v.pre[1])
160.     else:
161.         # fallback for v.post: guess-next-dev scheme from setuptools_scm
162.         return _VersionInfo(v.major, v.minor, v.micro + 1, 'alpha', v.post)
163. 
164. 
165. def _get_version():
166.     """Return the version string used for __version__."""
167.     # Only shell out to a git subprocess if really needed, i.e. when we are in
168.     # a matplotlib git repo but not in a shallow clone, such as those used by
169.     # CI, as the latter would trigger a warning from setuptools_scm.
170.     root = Path(__file__).resolve().parents[2]
171.     if ((root / ".matplotlib-repo").exists()
172.             and (root / ".git").exists()
173.             and not (root / ".git/shallow").exists()):
174.         import setuptools_scm
175.         return setuptools_scm.get_version(
176.             root=root,
177.             version_scheme="release-branch-semver",
178.             local_scheme="node-and-date",
179.             fallback_version=_version.version,
180.         )
181.     else:  # Get the version from the _version.py setuptools_scm file.
182.         return _version.version
183. 
184. 
185. @_api.caching_module_getattr
186. class __getattr__:
187.     __version__ = property(lambda self: _get_version())
188.     __version_info__ = property(
189.         lambda self: _parse_to_version_info(self.__version__))
190.     # module-level deprecations
191.     URL_REGEX = _api.deprecated("3.5", obj_type="")(property(
192.         lambda self: re.compile(r'^http://|^https://|^ftp://|^file:')))
193. 
194. 
195. def _check_versions():
196. 
197.     # Quickfix to ensure Microsoft Visual C++ redistributable
198.     # DLLs are loaded before importing kiwisolver
199.     from . import ft2font
200. 
201.     for modname, minver in [
202.             ("cycler", "0.10"),
203.             ("dateutil", "2.7"),
204.             ("kiwisolver", "1.0.1"),
205.             ("numpy", "1.19"),
206.             ("pyparsing", "2.2.1"),
207.     ]:
208.         module = importlib.import_module(modname)
209.         if parse_version(module.__version__) < parse_version(minver):
210.             raise ImportError(f"Matplotlib requires {modname}>={minver}; "
211.                               f"you have {module.__version__}")
212. 
213. 
214. _check_versions()
215. 
216. 
217. # The decorator ensures this always returns the same handler (and it is only
218. # attached once).
219. @functools.lru_cache()
220. def _ensure_handler():
221.     """
222.     The first time this function is called, attach a `StreamHandler` using the
223.     same format as `logging.basicConfig` to the Matplotlib root logger.
224. 
225.     Return this handler every time this function is called.
226.     """
227.     handler = logging.StreamHandler()
228.     handler.setFormatter(logging.Formatter(logging.BASIC_FORMAT))
229.     _log.addHandler(handler)
230.     return handler
231. 
232. 
233. def set_loglevel(level):
234.     """
235.     Set Matplotlib's root logger and root logger handler level, creating
236.     the handler if it does not exist yet.
237. 
238.     Typically, one should call ``set_loglevel("info")`` or
239.     ``set_loglevel("debug")`` to get additional debugging information.
240. 
241.     Parameters
242.     ----------
243.     level : {"notset", "debug", "info", "warning", "error", "critical"}
244.         The log level of the handler.
245. 
246.     Notes
247.     -----
248.     The first time this function is called, an additional handler is attached
249.     to Matplotlib's root handler; this handler is reused every time and this
250.     function simply manipulates the logger and handler's level.
251.     """
252.     _log.setLevel(level.upper())
253.     _ensure_handler().setLevel(level.upper())
254. 
255. 
256. def _logged_cached(fmt, func=None):
257.     """
258.     Decorator that logs a function's return value, and memoizes that value.
259. 
260.     After ::
261. 
262.         @_logged_cached(fmt)
263.         def func(): ...
264. 
265.     the first call to *func* will log its return value at the DEBUG level using
266.     %-format string *fmt*, and memoize it; later calls to *func* will directly
267.     return that value.
268.     """
269.     if func is None:  # Return the actual decorator.
270.         return functools.partial(_logged_cached, fmt)
271. 
272.     called = False
273.     ret = None
274. 
275.     @functools.wraps(func)
276.     def wrapper(**kwargs):
277.         nonlocal called, ret
278.         if not called:
279.             ret = func(**kwargs)
280.             called = True
281.             _log.debug(fmt, ret)
282.         return ret
283. 
284.     return wrapper
285. 
286. 
287. _ExecInfo = namedtuple("_ExecInfo", "executable raw_version version")
288. 
289. 
290. class ExecutableNotFoundError(FileNotFoundError):
291.     """
292.     Error raised when an executable that Matplotlib optionally
293.     depends on can't be found.
294.     """
295.     pass
296. 
297. 
298. @functools.lru_cache()
299. def _get_executable_info(name):
300.     """
301.     Get the version of some executable that Matplotlib optionally depends on.
302. 
303.     .. warning::
304.        The list of executables that this function supports is set according to
305.        Matplotlib's internal needs, and may change without notice.
306. 
307.     Parameters
308.     ----------
309.     name : str
310.         The executable to query.  The following values are currently supported:
311.         "dvipng", "gs", "inkscape", "magick", "pdftocairo", "pdftops".  This
312.         list is subject to change without notice.
313. 
314.     Returns
315.     -------
316.     tuple
317.         A namedtuple with fields ``executable`` (`str`) and ``version``
318.         (`packaging.Version`, or ``None`` if the version cannot be determined).
319. 
320.     Raises
321.     ------
322.     ExecutableNotFoundError
323.         If the executable is not found or older than the oldest version
324.         supported by Matplotlib.  For debugging purposes, it is also
325.         possible to "hide" an executable from Matplotlib by adding it to the
326.         :envvar:`_MPLHIDEEXECUTABLES` environment variable (a comma-separated
327.         list), which must be set prior to any calls to this function.
328.     ValueError
329.         If the executable is not one that we know how to query.
330.     """
331. 
332.     def impl(args, regex, min_ver=None, ignore_exit_code=False):
333.         # Execute the subprocess specified by args; capture stdout and stderr.
334.         # Search for a regex match in the output; if the match succeeds, the
335.         # first group of the match is the version.
336.         # Return an _ExecInfo if the executable exists, and has a version of
337.         # at least min_ver (if set); else, raise ExecutableNotFoundError.
338.         try:
339.             output = subprocess.check_output(
340.                 args, stderr=subprocess.STDOUT,
341.                 universal_newlines=True, errors="replace")
342.         except subprocess.CalledProcessError as _cpe:
343.             if ignore_exit_code:
344.                 output = _cpe.output
345.             else:
346.                 raise ExecutableNotFoundError(str(_cpe)) from _cpe
347.         except OSError as _ose:
348.             raise ExecutableNotFoundError(str(_ose)) from _ose
349.         match = re.search(regex, output)
350.         if match:
351.             raw_version = match.group(1)
352.             version = parse_version(raw_version)
353.             if min_ver is not None and version < parse_version(min_ver):
354.                 raise ExecutableNotFoundError(
355.                     f"You have {args[0]} version {version} but the minimum "
356.                     f"version supported by Matplotlib is {min_ver}")
357.             return _ExecInfo(args[0], raw_version, version)
358.         else:
359.             raise ExecutableNotFoundError(
360.                 f"Failed to determine the version of {args[0]} from "
361.                 f"{' '.join(args)}, which output {output}")
362. 
363.     if name in os.environ.get("_MPLHIDEEXECUTABLES", "").split(","):
364.         raise ExecutableNotFoundError(f"{name} was hidden")
365. 
366.     if name == "dvipng":
367.         return impl(["dvipng", "-version"], "(?m)^dvipng(?: .*)? (.+)", "1.6")
368.     elif name == "gs":
369.         execs = (["gswin32c", "gswin64c", "mgs", "gs"]  # "mgs" for miktex.
370.                  if sys.platform == "win32" else
371.                  ["gs"])
372.         for e in execs:
373.             try:
374.                 return impl([e, "--version"], "(.*)", "9")
375.             except ExecutableNotFoundError:
376.                 pass
377.         message = "Failed to find a Ghostscript installation"
378.         raise ExecutableNotFoundError(message)
379.     elif name == "inkscape":
380.         try:
381.             # Try headless option first (needed for Inkscape version < 1.0):
382.             return impl(["inkscape", "--without-gui", "-V"],
383.                         "Inkscape ([^ ]*)")
384.         except ExecutableNotFoundError:
385.             pass  # Suppress exception chaining.
386.         # If --without-gui is not accepted, we may be using Inkscape >= 1.0 so
387.         # try without it:
388.         return impl(["inkscape", "-V"], "Inkscape ([^ ]*)")
389.     elif name == "magick":
390.         if sys.platform == "win32":
391.             # Check the registry to avoid confusing ImageMagick's convert with
392.             # Windows's builtin convert.exe.
393.             import winreg
394.             binpath = ""
395.             for flag in [0, winreg.KEY_WOW64_32KEY, winreg.KEY_WOW64_64KEY]:
396.                 try:
397.                     with winreg.OpenKeyEx(
398.                             winreg.HKEY_LOCAL_MACHINE,
399.                             r"Software\Imagemagick\Current",
400.                             0, winreg.KEY_QUERY_VALUE | flag) as hkey:
401.                         binpath = winreg.QueryValueEx(hkey, "BinPath")[0]
402.                 except OSError:
403.                     pass
404.             path = None
405.             if binpath:
406.                 for name in ["convert.exe", "magick.exe"]:
407.                     candidate = Path(binpath, name)
408.                     if candidate.exists():
409.                         path = str(candidate)
410.                         break
411.             if path is None:
412.                 raise ExecutableNotFoundError(
413.                     "Failed to find an ImageMagick installation")
414.         else:
415.             path = "convert"
416.         info = impl([path, "--version"], r"^Version: ImageMagick (\S*)")
417.         if info.raw_version == "7.0.10-34":
418.             # https://github.com/ImageMagick/ImageMagick/issues/2720
419.             raise ExecutableNotFoundError(
420.                 f"You have ImageMagick {info.version}, which is unsupported")
421.         return info
422.     elif name == "pdftocairo":
423.         return impl(["pdftocairo", "-v"], "pdftocairo version (.*)")
424.     elif name == "pdftops":
425.         info = impl(["pdftops", "-v"], "^pdftops version (.*)",
426.                     ignore_exit_code=True)
427.         if info and not (
428.                 3 <= info.version.major or
429.                 # poppler version numbers.
430.                 parse_version("0.9") <= info.version < parse_version("1.0")):
431.             raise ExecutableNotFoundError(
432.                 f"You have pdftops version {info.version} but the minimum "
433.                 f"version supported by Matplotlib is 3.0")
434.         return info
435.     else:
436.         raise ValueError("Unknown executable: {!r}".format(name))
437. 
438. 
439. @_api.deprecated("3.6", alternative="Vendor the code")
440. def checkdep_usetex(s):
441.     if not s:
442.         return False
443.     if not shutil.which("tex"):
444.         _log.warning("usetex mode requires TeX.")
445.         return False
446.     try:
447.         _get_executable_info("dvipng")
448.     except ExecutableNotFoundError:
449.         _log.warning("usetex mode requires dvipng.")
450.         return False
451.     try:
452.         _get_executable_info("gs")
453.     except ExecutableNotFoundError:
454.         _log.warning("usetex mode requires ghostscript.")
455.         return False
456.     return True
457. 
458. 
459. def _get_xdg_config_dir():
460.     """
461.     Return the XDG configuration directory, according to the XDG base
462.     directory spec:
463. 
464.     https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html
465.     """
466.     return os.environ.get('XDG_CONFIG_HOME') or str(Path.home() / ".config")
467. 
468. 
469. def _get_xdg_cache_dir():
470.     """
471.     Return the XDG cache directory, according to the XDG base directory spec:
472. 
473.     https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html
474.     """
475.     return os.environ.get('XDG_CACHE_HOME') or str(Path.home() / ".cache")
476. 
477. 
478. def _get_config_or_cache_dir(xdg_base_getter):
479.     configdir = os.environ.get('MPLCONFIGDIR')
480.     if configdir:
481.         configdir = Path(configdir).resolve()
482.     elif sys.platform.startswith(('linux', 'freebsd')):
483.         # Only call _xdg_base_getter here so that MPLCONFIGDIR is tried first,
484.         # as _xdg_base_getter can throw.
485.         configdir = Path(xdg_base_getter(), "matplotlib")
486.     else:
487.         configdir = Path.home() / ".matplotlib"
488.     try:
489.         configdir.mkdir(parents=True, exist_ok=True)
490.     except OSError:
491.         pass
492.     else:
493.         if os.access(str(configdir), os.W_OK) and configdir.is_dir():
494.             return str(configdir)
495.     # If the config or cache directory cannot be created or is not a writable
496.     # directory, create a temporary one.
497.     tmpdir = os.environ["MPLCONFIGDIR"] = \
498.         tempfile.mkdtemp(prefix="matplotlib-")
499.     atexit.register(shutil.rmtree, tmpdir)
500.     _log.warning(


File: lib/matplotlib/__init__.py
Line number range: 603 - 727
Content:
603. @_docstring.Substitution(
604.     "\n".join(map("- {}".format, sorted(rcsetup._validators, key=str.lower)))
605. )
606. class RcParams(MutableMapping, dict):
607.     """
608.     A dictionary object including validation.
609. 
610.     Validating functions are defined and associated with rc parameters in
611.     :mod:`matplotlib.rcsetup`.
612. 
613.     The list of rcParams is:
614. 
615.     %s
616. 
617.     See Also
618.     --------
619.     :ref:`customizing-with-matplotlibrc-files`
620.     """
621. 
622.     validate = rcsetup._validators
623. 
624.     # validate values on the way in
625.     def __init__(self, *args, **kwargs):
626.         self.update(*args, **kwargs)
627. 
628.     def __setitem__(self, key, val):
629.         try:
630.             if key in _deprecated_map:
631.                 version, alt_key, alt_val, inverse_alt = _deprecated_map[key]
632.                 _api.warn_deprecated(
633.                     version, name=key, obj_type="rcparam", alternative=alt_key)
634.                 key = alt_key
635.                 val = alt_val(val)
636.             elif key in _deprecated_remain_as_none and val is not None:
637.                 version, = _deprecated_remain_as_none[key]
638.                 _api.warn_deprecated(version, name=key, obj_type="rcparam")
639.             elif key in _deprecated_ignore_map:
640.                 version, alt_key = _deprecated_ignore_map[key]
641.                 _api.warn_deprecated(
642.                     version, name=key, obj_type="rcparam", alternative=alt_key)
643.                 return
644.             elif key == 'backend':
645.                 if val is rcsetup._auto_backend_sentinel:
646.                     if 'backend' in self:
647.                         return
648.             try:
649.                 cval = self.validate[key](val)
650.             except ValueError as ve:
651.                 raise ValueError(f"Key {key}: {ve}") from None
652.             dict.__setitem__(self, key, cval)
653.         except KeyError as err:
654.             raise KeyError(
655.                 f"{key} is not a valid rc parameter (see rcParams.keys() for "
656.                 f"a list of valid parameters)") from err
657. 
658.     def __getitem__(self, key):
659.         if key in _deprecated_map:
660.             version, alt_key, alt_val, inverse_alt = _deprecated_map[key]
661.             _api.warn_deprecated(
662.                 version, name=key, obj_type="rcparam", alternative=alt_key)
663.             return inverse_alt(dict.__getitem__(self, alt_key))
664. 
665.         elif key in _deprecated_ignore_map:
666.             version, alt_key = _deprecated_ignore_map[key]
667.             _api.warn_deprecated(
668.                 version, name=key, obj_type="rcparam", alternative=alt_key)
669.             return dict.__getitem__(self, alt_key) if alt_key else None
670. 
671.         # In theory, this should only ever be used after the global rcParams
672.         # has been set up, but better be safe e.g. in presence of breakpoints.
673.         elif key == "backend" and self is globals().get("rcParams"):
674.             val = dict.__getitem__(self, key)
675.             if val is rcsetup._auto_backend_sentinel:
676.                 from matplotlib import pyplot as plt
677.                 plt.switch_backend(rcsetup._auto_backend_sentinel)
678. 
679.         return dict.__getitem__(self, key)
680. 
681.     def _get_backend_or_none(self):
682.         """Get the requested backend, if any, without triggering resolution."""
683.         backend = dict.__getitem__(self, "backend")
684.         return None if backend is rcsetup._auto_backend_sentinel else backend
685. 
686.     def __repr__(self):
687.         class_name = self.__class__.__name__
688.         indent = len(class_name) + 1
689.         with _api.suppress_matplotlib_deprecation_warning():
690.             repr_split = pprint.pformat(dict(self), indent=1,
691.                                         width=80 - indent).split('\n')
692.         repr_indented = ('\n' + ' ' * indent).join(repr_split)
693.         return '{}({})'.format(class_name, repr_indented)
694. 
695.     def __str__(self):
696.         return '\n'.join(map('{0[0]}: {0[1]}'.format, sorted(self.items())))
697. 
698.     def __iter__(self):
699.         """Yield sorted list of keys."""
700.         with _api.suppress_matplotlib_deprecation_warning():
701.             yield from sorted(dict.__iter__(self))
702. 
703.     def __len__(self):
704.         return dict.__len__(self)
705. 
706.     def find_all(self, pattern):
707.         """
708.         Return the subset of this RcParams dictionary whose keys match,
709.         using :func:`re.search`, the given ``pattern``.
710. 
711.         .. note::
712. 
713.             Changes to the returned dictionary are *not* propagated to
714.             the parent RcParams dictionary.
715. 
716.         """
717.         pattern_re = re.compile(pattern)
718.         return RcParams((key, value)
719.                         for key, value in self.items()
720.                         if pattern_re.search(key))
721. 
722.     def copy(self):
723.         rccopy = RcParams()
724.         for k in self:  # Skip deprecations and revalidation.
725.             dict.__setitem__(rccopy, k, dict.__getitem__(self, k))
726.         return rccopy
727. 


File: lib/matplotlib/__init__.py
Line number range: 882 - 912
Content:
882. # When constructing the global instances, we need to perform certain updates
883. # by explicitly calling the superclass (dict.update, dict.items) to avoid
884. # triggering resolution of _auto_backend_sentinel.
885. rcParamsDefault = _rc_params_in_file(
886.     cbook._get_data_path("matplotlibrc"),
887.     # Strip leading comment.
888.     transform=lambda line: line[1:] if line.startswith("#") else line,
889.     fail_on_error=True)
890. dict.update(rcParamsDefault, rcsetup._hardcoded_defaults)
891. # Normally, the default matplotlibrc file contains *no* entry for backend (the
892. # corresponding line starts with ##, not #; we fill on _auto_backend_sentinel
893. # in that case.  However, packagers can set a different default backend
894. # (resulting in a normal `#backend: foo` line) in which case we should *not*
895. # fill in _auto_backend_sentinel.
896. dict.setdefault(rcParamsDefault, "backend", rcsetup._auto_backend_sentinel)
897. rcParams = RcParams()  # The global instance.
898. dict.update(rcParams, dict.items(rcParamsDefault))
899. dict.update(rcParams, _rc_params_in_file(matplotlib_fname()))
900. rcParamsOrig = rcParams.copy()
901. with _api.suppress_matplotlib_deprecation_warning():
902.     # This also checks that all rcParams are indeed listed in the template.
903.     # Assigning to rcsetup.defaultParams is left only for backcompat.
904.     defaultParams = rcsetup.defaultParams = {
905.         # We want to resolve deprecated rcParams, but not backend...
906.         key: [(rcsetup._auto_backend_sentinel if key == "backend" else
907.                rcParamsDefault[key]),
908.               validator]
909.         for key, validator in rcsetup._validators.items()}
910. if rcParams['axes.formatter.use_locale']:
911.     locale.setlocale(locale.LC_ALL, '')
912. 


File: lib/matplotlib/__init__.py
Line number range: 1057 - 1099
Content:
1057. @contextlib.contextmanager
1058. def rc_context(rc=None, fname=None):
1059.     """
1060.     Return a context manager for temporarily changing rcParams.
1061. 
1062.     Parameters
1063.     ----------
1064.     rc : dict
1065.         The rcParams to temporarily set.
1066.     fname : str or path-like
1067.         A file with Matplotlib rc settings. If both *fname* and *rc* are given,
1068.         settings from *rc* take precedence.
1069. 
1070.     See Also
1071.     --------
1072.     :ref:`customizing-with-matplotlibrc-files`
1073. 
1074.     Examples
1075.     --------
1076.     Passing explicit values via a dict::
1077. 
1078.         with mpl.rc_context({'interactive': False}):
1079.             fig, ax = plt.subplots()
1080.             ax.plot(range(3), range(3))
1081.             fig.savefig('example.png')
1082.             plt.close(fig)
1083. 
1084.     Loading settings from a file::
1085. 
1086.          with mpl.rc_context(fname='print.rc'):
1087.              plt.plot(x, y)  # uses 'print.rc'
1088. 
1089.     """
1090.     orig = rcParams.copy()
1091.     try:
1092.         if fname:
1093.             rc_file(fname)
1094.         if rc:
1095.             rcParams.update(rc)
1096.         yield
1097.     finally:
1098.         dict.update(rcParams, orig)  # Revert to the original rcs.
1099. 


File: lib/matplotlib/__init__.py
Line number range: 1170 - 1179
Content:
1170. def get_backend():
1171.     """
1172.     Return the name of the current backend.
1173. 
1174.     See Also
1175.     --------
1176.     matplotlib.use
1177.     """
1178.     return rcParams['backend']
1179. 


File: lib/matplotlib/_pylab_helpers.py
Line number range: 1 - 144
Content:
1. """
2. Manage figures for the pyplot interface.
3. """
4. 
5. import atexit
6. from collections import OrderedDict
7. import gc
8. 
9. 
10. class Gcf:
11.     """
12.     Singleton to maintain the relation between figures and their managers, and
13.     keep track of and "active" figure and manager.
14. 
15.     The canvas of a figure created through pyplot is associated with a figure
16.     manager, which handles the interaction between the figure and the backend.
17.     pyplot keeps track of figure managers using an identifier, the "figure
18.     number" or "manager number" (which can actually be any hashable value);
19.     this number is available as the :attr:`number` attribute of the manager.
20. 
21.     This class is never instantiated; it consists of an `OrderedDict` mapping
22.     figure/manager numbers to managers, and a set of class methods that
23.     manipulate this `OrderedDict`.
24. 
25.     Attributes
26.     ----------
27.     figs : OrderedDict
28.         `OrderedDict` mapping numbers to managers; the active manager is at the
29.         end.
30.     """
31. 
32.     figs = OrderedDict()
33. 
34.     @classmethod
35.     def get_fig_manager(cls, num):
36.         """
37.         If manager number *num* exists, make it the active one and return it;
38.         otherwise return *None*.
39.         """
40.         manager = cls.figs.get(num, None)
41.         if manager is not None:
42.             cls.set_active(manager)
43.         return manager
44. 
45.     @classmethod
46.     def destroy(cls, num):
47.         """
48.         Destroy manager *num* -- either a manager instance or a manager number.
49. 
50.         In the interactive backends, this is bound to the window "destroy" and
51.         "delete" events.
52. 
53.         It is recommended to pass a manager instance, to avoid confusion when
54.         two managers share the same number.
55.         """
56.         if all(hasattr(num, attr) for attr in ["num", "destroy"]):
57.             manager = num
58.             if cls.figs.get(manager.num) is manager:
59.                 cls.figs.pop(manager.num)
60.         else:
61.             try:
62.                 manager = cls.figs.pop(num)
63.             except KeyError:
64.                 return
65.         if hasattr(manager, "_cidgcf"):
66.             manager.canvas.mpl_disconnect(manager._cidgcf)
67.         manager.destroy()
68.         del manager, num
69.         # Full cyclic garbage collection may be too expensive to do on every
70.         # figure destruction, so we collect only the youngest two generations.
71.         # see: https://github.com/matplotlib/matplotlib/pull/3045
72.         gc.collect(1)
73. 
74.     @classmethod
75.     def destroy_fig(cls, fig):
76.         """Destroy figure *fig*."""
77.         num = next((manager.num for manager in cls.figs.values()
78.                     if manager.canvas.figure == fig), None)
79.         if num is not None:
80.             cls.destroy(num)
81. 
82.     @classmethod
83.     def destroy_all(cls):
84.         """Destroy all figures."""
85.         # Reimport gc in case the module globals have already been removed
86.         # during interpreter shutdown.
87.         import gc
88.         for manager in list(cls.figs.values()):
89.             manager.canvas.mpl_disconnect(manager._cidgcf)
90.             manager.destroy()
91.         cls.figs.clear()
92.         gc.collect(1)
93. 
94.     @classmethod
95.     def has_fignum(cls, num):
96.         """Return whether figure number *num* exists."""
97.         return num in cls.figs
98. 
99.     @classmethod
100.     def get_all_fig_managers(cls):
101.         """Return a list of figure managers."""
102.         return list(cls.figs.values())
103. 
104.     @classmethod
105.     def get_num_fig_managers(cls):
106.         """Return the number of figures being managed."""
107.         return len(cls.figs)
108. 
109.     @classmethod
110.     def get_active(cls):
111.         """Return the active manager, or *None* if there is no manager."""
112.         return next(reversed(cls.figs.values())) if cls.figs else None
113. 
114.     @classmethod
115.     def _set_new_active_manager(cls, manager):
116.         """Adopt *manager* into pyplot and make it the active manager."""
117.         if not hasattr(manager, "_cidgcf"):
118.             manager._cidgcf = manager.canvas.mpl_connect(
119.                 "button_press_event", lambda event: cls.set_active(manager))
120.         fig = manager.canvas.figure
121.         fig.number = manager.num
122.         label = fig.get_label()
123.         if label:
124.             manager.set_window_title(label)
125.         cls.set_active(manager)
126. 
127.     @classmethod
128.     def set_active(cls, manager):
129.         """Make *manager* the active manager."""
130.         cls.figs[manager.num] = manager
131.         cls.figs.move_to_end(manager.num)
132. 
133.     @classmethod
134.     def draw_all(cls, force=False):
135.         """
136.         Redraw all stale managed figures, or, if *force* is True, all managed
137.         figures.
138.         """
139.         for manager in cls.get_all_fig_managers():
140.             if force or manager.canvas.figure.stale:
141.                 manager.canvas.draw_idle()
142. 
143. 
144. atexit.register(Gcf.destroy_all)


File: lib/matplotlib/pyplot.py
Line number range: 1 - 500
Content:
1. # Note: The first part of this file can be modified in place, but the latter
2. # part is autogenerated by the boilerplate.py script.
3. 
4. """
5. `matplotlib.pyplot` is a state-based interface to matplotlib. It provides
6. an implicit,  MATLAB-like, way of plotting.  It also opens figures on your
7. screen, and acts as the figure GUI manager.
8. 
9. pyplot is mainly intended for interactive plots and simple cases of
10. programmatic plot generation::
11. 
12.     import numpy as np
13.     import matplotlib.pyplot as plt
14. 
15.     x = np.arange(0, 5, 0.1)
16.     y = np.sin(x)
17.     plt.plot(x, y)
18. 
19. The explicit object-oriented API is recommended for complex plots, though
20. pyplot is still usually used to create the figure and often the axes in the
21. figure. See `.pyplot.figure`, `.pyplot.subplots`, and
22. `.pyplot.subplot_mosaic` to create figures, and
23. :doc:`Axes API </api/axes_api>` for the plotting methods on an Axes::
24. 
25.     import numpy as np
26.     import matplotlib.pyplot as plt
27. 
28.     x = np.arange(0, 5, 0.1)
29.     y = np.sin(x)
30.     fig, ax = plt.subplots()
31.     ax.plot(x, y)
32. 
33. 
34. See :ref:`api_interfaces` for an explanation of the tradeoffs between the
35. implicit and explicit interfaces.
36. """
37. 
38. from enum import Enum
39. import functools
40. import importlib
41. import inspect
42. import logging
43. from numbers import Number
44. import re
45. import sys
46. import threading
47. import time
48. 
49. from cycler import cycler
50. import matplotlib
51. import matplotlib.colorbar
52. import matplotlib.image
53. from matplotlib import _api
54. from matplotlib import rcsetup, style
55. from matplotlib import _pylab_helpers, interactive
56. from matplotlib import cbook
57. from matplotlib import _docstring
58. from matplotlib.backend_bases import FigureCanvasBase, MouseButton
59. from matplotlib.figure import Figure, FigureBase, figaspect
60. from matplotlib.gridspec import GridSpec, SubplotSpec
61. from matplotlib import rcParams, rcParamsDefault, get_backend, rcParamsOrig
62. from matplotlib.rcsetup import interactive_bk as _interactive_bk
63. from matplotlib.artist import Artist
64. from matplotlib.axes import Axes, Subplot
65. from matplotlib.projections import PolarAxes
66. from matplotlib import mlab  # for detrend_none, window_hanning
67. from matplotlib.scale import get_scale_names
68. 
69. from matplotlib import cm
70. from matplotlib.cm import _colormaps as colormaps, get_cmap, register_cmap
71. from matplotlib.colors import _color_sequences as color_sequences
72. 
73. import numpy as np
74. 
75. # We may not need the following imports here:
76. from matplotlib.colors import Normalize
77. from matplotlib.lines import Line2D
78. from matplotlib.text import Text, Annotation
79. from matplotlib.patches import Polygon, Rectangle, Circle, Arrow
80. from matplotlib.widgets import Button, Slider, Widget
81. 
82. from .ticker import (
83.     TickHelper, Formatter, FixedFormatter, NullFormatter, FuncFormatter,
84.     FormatStrFormatter, ScalarFormatter, LogFormatter, LogFormatterExponent,
85.     LogFormatterMathtext, Locator, IndexLocator, FixedLocator, NullLocator,
86.     LinearLocator, LogLocator, AutoLocator, MultipleLocator, MaxNLocator)
87. 
88. _log = logging.getLogger(__name__)
89. 
90. 
91. def _copy_docstring_and_deprecators(method, func=None):
92.     if func is None:
93.         return functools.partial(_copy_docstring_and_deprecators, method)
94.     decorators = [_docstring.copy(method)]
95.     # Check whether the definition of *method* includes @_api.rename_parameter
96.     # or @_api.make_keyword_only decorators; if so, propagate them to the
97.     # pyplot wrapper as well.
98.     while getattr(method, "__wrapped__", None) is not None:
99.         decorator = _api.deprecation.DECORATORS.get(method)
100.         if decorator:
101.             decorators.append(decorator)
102.         method = method.__wrapped__
103.     for decorator in decorators[::-1]:
104.         func = decorator(func)
105.     return func
106. 
107. 
108. ## Global ##
109. 
110. 
111. # The state controlled by {,un}install_repl_displayhook().
112. _ReplDisplayHook = Enum("_ReplDisplayHook", ["NONE", "PLAIN", "IPYTHON"])
113. _REPL_DISPLAYHOOK = _ReplDisplayHook.NONE
114. 
115. 
116. def _draw_all_if_interactive():
117.     if matplotlib.is_interactive():
118.         draw_all()
119. 
120. 
121. def install_repl_displayhook():
122.     """
123.     Connect to the display hook of the current shell.
124. 
125.     The display hook gets called when the read-evaluate-print-loop (REPL) of
126.     the shell has finished the execution of a command. We use this callback
127.     to be able to automatically update a figure in interactive mode.
128. 
129.     This works both with IPython and with vanilla python shells.
130.     """
131.     global _REPL_DISPLAYHOOK
132. 
133.     if _REPL_DISPLAYHOOK is _ReplDisplayHook.IPYTHON:
134.         return
135. 
136.     # See if we have IPython hooks around, if so use them.
137.     # Use ``sys.modules.get(name)`` rather than ``name in sys.modules`` as
138.     # entries can also have been explicitly set to None.
139.     mod_ipython = sys.modules.get("IPython")
140.     if not mod_ipython:
141.         _REPL_DISPLAYHOOK = _ReplDisplayHook.PLAIN
142.         return
143.     ip = mod_ipython.get_ipython()
144.     if not ip:
145.         _REPL_DISPLAYHOOK = _ReplDisplayHook.PLAIN
146.         return
147. 
148.     ip.events.register("post_execute", _draw_all_if_interactive)
149.     _REPL_DISPLAYHOOK = _ReplDisplayHook.IPYTHON
150. 
151.     from IPython.core.pylabtools import backend2gui
152.     # trigger IPython's eventloop integration, if available
153.     ipython_gui_name = backend2gui.get(get_backend())
154.     if ipython_gui_name:
155.         ip.enable_gui(ipython_gui_name)
156. 
157. 
158. def uninstall_repl_displayhook():
159.     """Disconnect from the display hook of the current shell."""
160.     global _REPL_DISPLAYHOOK
161.     if _REPL_DISPLAYHOOK is _ReplDisplayHook.IPYTHON:
162.         from IPython import get_ipython
163.         ip = get_ipython()
164.         ip.events.unregister("post_execute", _draw_all_if_interactive)
165.     _REPL_DISPLAYHOOK = _ReplDisplayHook.NONE
166. 
167. 
168. draw_all = _pylab_helpers.Gcf.draw_all
169. 
170. 
171. @_copy_docstring_and_deprecators(matplotlib.set_loglevel)
172. def set_loglevel(*args, **kwargs):  # Ensure this appears in the pyplot docs.
173.     return matplotlib.set_loglevel(*args, **kwargs)
174. 
175. 
176. @_copy_docstring_and_deprecators(Artist.findobj)
177. def findobj(o=None, match=None, include_self=True):
178.     if o is None:
179.         o = gcf()
180.     return o.findobj(match, include_self=include_self)
181. 
182. 
183. def _get_required_interactive_framework(backend_mod):
184.     if not hasattr(backend_mod.FigureCanvas, "required_interactive_framework"):
185.         _api.warn_deprecated(
186.             "3.6", name="Support for FigureCanvases without a "
187.             "required_interactive_framework attribute")
188.         return None
189.     # Inline this once the deprecation elapses.
190.     return backend_mod.FigureCanvas.required_interactive_framework
191. 
192. _backend_mod = None
193. 
194. 
195. def _get_backend_mod():
196.     """
197.     Ensure that a backend is selected and return it.
198. 
199.     This is currently private, but may be made public in the future.
200.     """
201.     if _backend_mod is None:
202.         # Use __getitem__ here to avoid going through the fallback logic (which
203.         # will (re)import pyplot and then call switch_backend if we need to
204.         # resolve the auto sentinel)
205.         switch_backend(dict.__getitem__(rcParams, "backend"))
206.     return _backend_mod
207. 
208. 
209. def switch_backend(newbackend):
210.     """
211.     Close all open figures and set the Matplotlib backend.
212. 
213.     The argument is case-insensitive.  Switching to an interactive backend is
214.     possible only if no event loop for another interactive backend has started.
215.     Switching to and from non-interactive backends is always possible.
216. 
217.     Parameters
218.     ----------
219.     newbackend : str
220.         The name of the backend to use.
221.     """
222.     global _backend_mod
223.     # make sure the init is pulled up so we can assign to it later
224.     import matplotlib.backends
225.     close("all")
226. 
227.     if newbackend is rcsetup._auto_backend_sentinel:
228.         current_framework = cbook._get_running_interactive_framework()
229.         mapping = {'qt': 'qtagg',
230.                    'gtk3': 'gtk3agg',
231.                    'gtk4': 'gtk4agg',
232.                    'wx': 'wxagg',
233.                    'tk': 'tkagg',
234.                    'macosx': 'macosx',
235.                    'headless': 'agg'}
236. 
237.         best_guess = mapping.get(current_framework, None)
238.         if best_guess is not None:
239.             candidates = [best_guess]
240.         else:
241.             candidates = []
242.         candidates += [
243.             "macosx", "qtagg", "gtk4agg", "gtk3agg", "tkagg", "wxagg"]
244. 
245.         # Don't try to fallback on the cairo-based backends as they each have
246.         # an additional dependency (pycairo) over the agg-based backend, and
247.         # are of worse quality.
248.         for candidate in candidates:
249.             try:
250.                 switch_backend(candidate)
251.             except ImportError:
252.                 continue
253.             else:
254.                 rcParamsOrig['backend'] = candidate
255.                 return
256.         else:
257.             # Switching to Agg should always succeed; if it doesn't, let the
258.             # exception propagate out.
259.             switch_backend("agg")
260.             rcParamsOrig["backend"] = "agg"
261.             return
262. 
263.     backend_mod = importlib.import_module(
264.         cbook._backend_module_name(newbackend))
265.     canvas_class = backend_mod.FigureCanvas
266. 
267.     required_framework = _get_required_interactive_framework(backend_mod)
268.     if required_framework is not None:
269.         current_framework = cbook._get_running_interactive_framework()
270.         if (current_framework and required_framework
271.                 and current_framework != required_framework):
272.             raise ImportError(
273.                 "Cannot load backend {!r} which requires the {!r} interactive "
274.                 "framework, as {!r} is currently running".format(
275.                     newbackend, required_framework, current_framework))
276. 
277.     # Load the new_figure_manager(), draw_if_interactive(), and show()
278.     # functions from the backend.
279. 
280.     # Classically, backends can directly export these functions.  This should
281.     # keep working for backcompat.
282.     new_figure_manager = getattr(backend_mod, "new_figure_manager", None)
283.     # draw_if_interactive = getattr(backend_mod, "draw_if_interactive", None)
284.     # show = getattr(backend_mod, "show", None)
285.     # In that classical approach, backends are implemented as modules, but
286.     # "inherit" default method implementations from backend_bases._Backend.
287.     # This is achieved by creating a "class" that inherits from
288.     # backend_bases._Backend and whose body is filled with the module globals.
289.     class backend_mod(matplotlib.backend_bases._Backend):
290.         locals().update(vars(backend_mod))
291. 
292.     # However, the newer approach for defining new_figure_manager (and, in
293.     # the future, draw_if_interactive and show) is to derive them from canvas
294.     # methods.  In that case, also update backend_mod accordingly.
295.     if new_figure_manager is None:
296.         def new_figure_manager_given_figure(num, figure):
297.             return canvas_class.new_manager(figure, num)
298. 
299.         def new_figure_manager(num, *args, FigureClass=Figure, **kwargs):
300.             fig = FigureClass(*args, **kwargs)
301.             return new_figure_manager_given_figure(num, fig)
302. 
303.         backend_mod.new_figure_manager_given_figure = \
304.             new_figure_manager_given_figure
305.         backend_mod.new_figure_manager = new_figure_manager
306. 
307.     _log.debug("Loaded backend %s version %s.",
308.                newbackend, backend_mod.backend_version)
309. 
310.     rcParams['backend'] = rcParamsDefault['backend'] = newbackend
311.     _backend_mod = backend_mod
312.     for func_name in ["new_figure_manager", "draw_if_interactive", "show"]:
313.         globals()[func_name].__signature__ = inspect.signature(
314.             getattr(backend_mod, func_name))
315. 
316.     # Need to keep a global reference to the backend for compatibility reasons.
317.     # See https://github.com/matplotlib/matplotlib/issues/6092
318.     matplotlib.backends.backend = newbackend
319. 
320.     # make sure the repl display hook is installed in case we become
321.     # interactive
322.     install_repl_displayhook()
323. 
324. 
325. def _warn_if_gui_out_of_main_thread():
326.     if (_get_required_interactive_framework(_get_backend_mod())
327.             and threading.current_thread() is not threading.main_thread()):
328.         _api.warn_external(
329.             "Starting a Matplotlib GUI outside of the main thread will likely "
330.             "fail.")
331. 
332. 
333. # This function's signature is rewritten upon backend-load by switch_backend.
334. def new_figure_manager(*args, **kwargs):
335.     """Create a new figure manager instance."""
336.     _warn_if_gui_out_of_main_thread()
337.     return _get_backend_mod().new_figure_manager(*args, **kwargs)
338. 
339. 
340. # This function's signature is rewritten upon backend-load by switch_backend.
341. def draw_if_interactive(*args, **kwargs):
342.     """
343.     Redraw the current figure if in interactive mode.
344. 
345.     .. warning::
346. 
347.         End users will typically not have to call this function because the
348.         the interactive mode takes care of this.
349.     """
350.     return _get_backend_mod().draw_if_interactive(*args, **kwargs)
351. 
352. 
353. # This function's signature is rewritten upon backend-load by switch_backend.
354. def show(*args, **kwargs):
355.     """
356.     Display all open figures.
357. 
358.     Parameters
359.     ----------
360.     block : bool, optional
361.         Whether to wait for all figures to be closed before returning.
362. 
363.         If `True` block and run the GUI main loop until all figure windows
364.         are closed.
365. 
366.         If `False` ensure that all figure windows are displayed and return
367.         immediately.  In this case, you are responsible for ensuring
368.         that the event loop is running to have responsive figures.
369. 
370.         Defaults to True in non-interactive mode and to False in interactive
371.         mode (see `.pyplot.isinteractive`).
372. 
373.     See Also
374.     --------
375.     ion : Enable interactive mode, which shows / updates the figure after
376.           every plotting command, so that calling ``show()`` is not necessary.
377.     ioff : Disable interactive mode.
378.     savefig : Save the figure to an image file instead of showing it on screen.
379. 
380.     Notes
381.     -----
382.     **Saving figures to file and showing a window at the same time**
383. 
384.     If you want an image file as well as a user interface window, use
385.     `.pyplot.savefig` before `.pyplot.show`. At the end of (a blocking)
386.     ``show()`` the figure is closed and thus unregistered from pyplot. Calling
387.     `.pyplot.savefig` afterwards would save a new and thus empty figure. This
388.     limitation of command order does not apply if the show is non-blocking or
389.     if you keep a reference to the figure and use `.Figure.savefig`.
390. 
391.     **Auto-show in jupyter notebooks**
392. 
393.     The jupyter backends (activated via ``%matplotlib inline``,
394.     ``%matplotlib notebook``, or ``%matplotlib widget``), call ``show()`` at
395.     the end of every cell by default. Thus, you usually don't have to call it
396.     explicitly there.
397.     """
398.     _warn_if_gui_out_of_main_thread()
399.     return _get_backend_mod().show(*args, **kwargs)
400. 
401. 
402. def isinteractive():
403.     """
404.     Return whether plots are updated after every plotting command.
405. 
406.     The interactive mode is mainly useful if you build plots from the command
407.     line and want to see the effect of each command while you are building the
408.     figure.
409. 
410.     In interactive mode:
411. 
412.     - newly created figures will be shown immediately;
413.     - figures will automatically redraw on change;
414.     - `.pyplot.show` will not block by default.
415. 
416.     In non-interactive mode:
417. 
418.     - newly created figures and changes to figures will not be reflected until
419.       explicitly asked to be;
420.     - `.pyplot.show` will block by default.
421. 
422.     See Also
423.     --------
424.     ion : Enable interactive mode.
425.     ioff : Disable interactive mode.
426.     show : Show all figures (and maybe block).
427.     pause : Show all figures, and block for a time.
428.     """
429.     return matplotlib.is_interactive()
430. 
431. 
432. class _IoffContext:
433.     """
434.     Context manager for `.ioff`.
435. 
436.     The state is changed in ``__init__()`` instead of ``__enter__()``. The
437.     latter is a no-op. This allows using `.ioff` both as a function and
438.     as a context.
439.     """
440. 
441.     def __init__(self):
442.         self.wasinteractive = isinteractive()
443.         matplotlib.interactive(False)
444.         uninstall_repl_displayhook()
445. 
446.     def __enter__(self):
447.         pass
448. 
449.     def __exit__(self, exc_type, exc_value, traceback):
450.         if self.wasinteractive:
451.             matplotlib.interactive(True)
452.             install_repl_displayhook()
453.         else:
454.             matplotlib.interactive(False)
455.             uninstall_repl_displayhook()
456. 
457. 
458. class _IonContext:
459.     """
460.     Context manager for `.ion`.
461. 
462.     The state is changed in ``__init__()`` instead of ``__enter__()``. The
463.     latter is a no-op. This allows using `.ion` both as a function and
464.     as a context.
465.     """
466. 
467.     def __init__(self):
468.         self.wasinteractive = isinteractive()
469.         matplotlib.interactive(True)
470.         install_repl_displayhook()
471. 
472.     def __enter__(self):
473.         pass
474. 
475.     def __exit__(self, exc_type, exc_value, traceback):
476.         if not self.wasinteractive:
477.             matplotlib.interactive(False)
478.             uninstall_repl_displayhook()
479.         else:
480.             matplotlib.interactive(True)
481.             install_repl_displayhook()
482. 
483. 
484. def ioff():
485.     """
486.     Disable interactive mode.
487. 
488.     See `.pyplot.isinteractive` for more details.
489. 
490.     See Also
491.     --------
492.     ion : Enable interactive mode.
493.     isinteractive : Whether interactive mode is enabled.
494.     show : Show all figures (and maybe block).
495.     pause : Show all figures, and block for a time.
496. 
497.     Notes
498.     -----
499.     For a temporary change, this can be used as a context manager::
500. 


File: lib/matplotlib/rcsetup.py
Line number range: 1 - 500
Content:
1. """
2. The rcsetup module contains the validation code for customization using
3. Matplotlib's rc settings.
4. 
5. Each rc setting is assigned a function used to validate any attempted changes
6. to that setting.  The validation functions are defined in the rcsetup module,
7. and are used to construct the rcParams global object which stores the settings
8. and is referenced throughout Matplotlib.
9. 
10. The default values of the rc settings are set in the default matplotlibrc file.
11. Any additions or deletions to the parameter set listed here should also be
12. propagated to the :file:`matplotlibrc.template` in Matplotlib's root source
13. directory.
14. """
15. 
16. import ast
17. from functools import lru_cache, reduce
18. from numbers import Number
19. import operator
20. import os
21. import re
22. 
23. import numpy as np
24. 
25. from matplotlib import _api, cbook
26. from matplotlib.cbook import ls_mapper
27. from matplotlib.colors import Colormap, is_color_like
28. from matplotlib._fontconfig_pattern import parse_fontconfig_pattern
29. from matplotlib._enums import JoinStyle, CapStyle
30. 
31. # Don't let the original cycler collide with our validating cycler
32. from cycler import Cycler, cycler as ccycler
33. 
34. 
35. # The capitalized forms are needed for ipython at present; this may
36. # change for later versions.
37. interactive_bk = [
38.     'GTK3Agg', 'GTK3Cairo', 'GTK4Agg', 'GTK4Cairo',
39.     'MacOSX',
40.     'nbAgg',
41.     'QtAgg', 'QtCairo', 'Qt5Agg', 'Qt5Cairo',
42.     'TkAgg', 'TkCairo',
43.     'WebAgg',
44.     'WX', 'WXAgg', 'WXCairo',
45. ]
46. non_interactive_bk = ['agg', 'cairo',
47.                       'pdf', 'pgf', 'ps', 'svg', 'template']
48. all_backends = interactive_bk + non_interactive_bk
49. 
50. 
51. class ValidateInStrings:
52.     def __init__(self, key, valid, ignorecase=False, *,
53.                  _deprecated_since=None):
54.         """*valid* is a list of legal strings."""
55.         self.key = key
56.         self.ignorecase = ignorecase
57.         self._deprecated_since = _deprecated_since
58. 
59.         def func(s):
60.             if ignorecase:
61.                 return s.lower()
62.             else:
63.                 return s
64.         self.valid = {func(k): k for k in valid}
65. 
66.     def __call__(self, s):
67.         if self._deprecated_since:
68.             name, = (k for k, v in globals().items() if v is self)
69.             _api.warn_deprecated(
70.                 self._deprecated_since, name=name, obj_type="function")
71.         if self.ignorecase:
72.             s = s.lower()
73.         if s in self.valid:
74.             return self.valid[s]
75.         msg = (f"{s!r} is not a valid value for {self.key}; supported values "
76.                f"are {[*self.valid.values()]}")
77.         if (isinstance(s, str)
78.                 and (s.startswith('"') and s.endswith('"')
79.                      or s.startswith("'") and s.endswith("'"))
80.                 and s[1:-1] in self.valid):
81.             msg += "; remove quotes surrounding your string"
82.         raise ValueError(msg)
83. 
84. 
85. @lru_cache()
86. def _listify_validator(scalar_validator, allow_stringlist=False, *,
87.                        n=None, doc=None):
88.     def f(s):
89.         if isinstance(s, str):
90.             try:
91.                 val = [scalar_validator(v.strip()) for v in s.split(',')
92.                        if v.strip()]
93.             except Exception:
94.                 if allow_stringlist:
95.                     # Sometimes, a list of colors might be a single string
96.                     # of single-letter colornames. So give that a shot.
97.                     val = [scalar_validator(v.strip()) for v in s if v.strip()]
98.                 else:
99.                     raise
100.         # Allow any ordered sequence type -- generators, np.ndarray, pd.Series
101.         # -- but not sets, whose iteration order is non-deterministic.
102.         elif np.iterable(s) and not isinstance(s, (set, frozenset)):
103.             # The condition on this list comprehension will preserve the
104.             # behavior of filtering out any empty strings (behavior was
105.             # from the original validate_stringlist()), while allowing
106.             # any non-string/text scalar values such as numbers and arrays.
107.             val = [scalar_validator(v) for v in s
108.                    if not isinstance(v, str) or v]
109.         else:
110.             raise ValueError(
111.                 f"Expected str or other non-set iterable, but got {s}")
112.         if n is not None and len(val) != n:
113.             raise ValueError(
114.                 f"Expected {n} values, but there are {len(val)} values in {s}")
115.         return val
116. 
117.     try:
118.         f.__name__ = "{}list".format(scalar_validator.__name__)
119.     except AttributeError:  # class instance.
120.         f.__name__ = "{}List".format(type(scalar_validator).__name__)
121.     f.__qualname__ = f.__qualname__.rsplit(".", 1)[0] + "." + f.__name__
122.     f.__doc__ = doc if doc is not None else scalar_validator.__doc__
123.     return f
124. 
125. 
126. def validate_any(s):
127.     return s
128. validate_anylist = _listify_validator(validate_any)
129. 
130. 
131. def _validate_date(s):
132.     try:
133.         np.datetime64(s)
134.         return s
135.     except ValueError:
136.         raise ValueError(
137.             f'{s!r} should be a string that can be parsed by numpy.datetime64')
138. 
139. 
140. def validate_bool(b):
141.     """Convert b to ``bool`` or raise."""
142.     if isinstance(b, str):
143.         b = b.lower()
144.     if b in ('t', 'y', 'yes', 'on', 'true', '1', 1, True):
145.         return True
146.     elif b in ('f', 'n', 'no', 'off', 'false', '0', 0, False):
147.         return False
148.     else:
149.         raise ValueError(f'Cannot convert {b!r} to bool')
150. 
151. 
152. def validate_axisbelow(s):
153.     try:
154.         return validate_bool(s)
155.     except ValueError:
156.         if isinstance(s, str):
157.             if s == 'line':
158.                 return 'line'
159.     raise ValueError(f'{s!r} cannot be interpreted as'
160.                      ' True, False, or "line"')
161. 
162. 
163. def validate_dpi(s):
164.     """Confirm s is string 'figure' or convert s to float or raise."""
165.     if s == 'figure':
166.         return s
167.     try:
168.         return float(s)
169.     except ValueError as e:
170.         raise ValueError(f'{s!r} is not string "figure" and '
171.                          f'could not convert {s!r} to float') from e
172. 
173. 
174. def _make_type_validator(cls, *, allow_none=False):
175.     """
176.     Return a validator that converts inputs to *cls* or raises (and possibly
177.     allows ``None`` as well).
178.     """
179. 
180.     def validator(s):
181.         if (allow_none and
182.                 (s is None or isinstance(s, str) and s.lower() == "none")):
183.             return None
184.         if cls is str and not isinstance(s, str):
185.             _api.warn_deprecated(
186.                 "3.5", message="Support for setting an rcParam that expects a "
187.                 "str value to a non-str value is deprecated since %(since)s "
188.                 "and support will be removed %(removal)s.")
189.         try:
190.             return cls(s)
191.         except (TypeError, ValueError) as e:
192.             raise ValueError(
193.                 f'Could not convert {s!r} to {cls.__name__}') from e
194. 
195.     validator.__name__ = f"validate_{cls.__name__}"
196.     if allow_none:
197.         validator.__name__ += "_or_None"
198.     validator.__qualname__ = (
199.         validator.__qualname__.rsplit(".", 1)[0] + "." + validator.__name__)
200.     return validator
201. 
202. 
203. validate_string = _make_type_validator(str)
204. validate_string_or_None = _make_type_validator(str, allow_none=True)
205. validate_stringlist = _listify_validator(
206.     validate_string, doc='return a list of strings')
207. validate_int = _make_type_validator(int)
208. validate_int_or_None = _make_type_validator(int, allow_none=True)
209. validate_float = _make_type_validator(float)
210. validate_float_or_None = _make_type_validator(float, allow_none=True)
211. validate_floatlist = _listify_validator(
212.     validate_float, doc='return a list of floats')
213. 
214. 
215. def _validate_pathlike(s):
216.     if isinstance(s, (str, os.PathLike)):
217.         # Store value as str because savefig.directory needs to distinguish
218.         # between "" (cwd) and "." (cwd, but gets updated by user selections).
219.         return os.fsdecode(s)
220.     else:
221.         return validate_string(s)  # Emit deprecation warning.
222. 
223. 
224. def validate_fonttype(s):
225.     """
226.     Confirm that this is a Postscript or PDF font type that we know how to
227.     convert to.
228.     """
229.     fonttypes = {'type3':    3,
230.                  'truetype': 42}
231.     try:
232.         fonttype = validate_int(s)
233.     except ValueError:
234.         try:
235.             return fonttypes[s.lower()]
236.         except KeyError as e:
237.             raise ValueError('Supported Postscript/PDF font types are %s'
238.                              % list(fonttypes)) from e
239.     else:
240.         if fonttype not in fonttypes.values():
241.             raise ValueError(
242.                 'Supported Postscript/PDF font types are %s' %
243.                 list(fonttypes.values()))
244.         return fonttype
245. 
246. 
247. _validate_standard_backends = ValidateInStrings(
248.     'backend', all_backends, ignorecase=True)
249. _auto_backend_sentinel = object()
250. 
251. 
252. def validate_backend(s):
253.     backend = (
254.         s if s is _auto_backend_sentinel or s.startswith("module://")
255.         else _validate_standard_backends(s))
256.     return backend
257. 
258. 
259. def _validate_toolbar(s):
260.     s = ValidateInStrings(
261.         'toolbar', ['None', 'toolbar2', 'toolmanager'], ignorecase=True)(s)
262.     if s == 'toolmanager':
263.         _api.warn_external(
264.             "Treat the new Tool classes introduced in v1.5 as experimental "
265.             "for now; the API and rcParam may change in future versions.")
266.     return s
267. 
268. 
269. def validate_color_or_inherit(s):
270.     """Return a valid color arg."""
271.     if cbook._str_equal(s, 'inherit'):
272.         return s
273.     return validate_color(s)
274. 
275. 
276. def validate_color_or_auto(s):
277.     if cbook._str_equal(s, 'auto'):
278.         return s
279.     return validate_color(s)
280. 
281. 
282. def validate_color_for_prop_cycle(s):
283.     # N-th color cycle syntax can't go into the color cycle.
284.     if isinstance(s, str) and re.match("^C[0-9]$", s):
285.         raise ValueError(f"Cannot put cycle reference ({s!r}) in prop_cycler")
286.     return validate_color(s)
287. 
288. 
289. def _validate_color_or_linecolor(s):
290.     if cbook._str_equal(s, 'linecolor'):
291.         return s
292.     elif cbook._str_equal(s, 'mfc') or cbook._str_equal(s, 'markerfacecolor'):
293.         return 'markerfacecolor'
294.     elif cbook._str_equal(s, 'mec') or cbook._str_equal(s, 'markeredgecolor'):
295.         return 'markeredgecolor'
296.     elif s is None:
297.         return None
298.     elif isinstance(s, str) and len(s) == 6 or len(s) == 8:
299.         stmp = '#' + s
300.         if is_color_like(stmp):
301.             return stmp
302.         if s.lower() == 'none':
303.             return None
304.     elif is_color_like(s):
305.         return s
306. 
307.     raise ValueError(f'{s!r} does not look like a color arg')
308. 
309. 
310. def validate_color(s):
311.     """Return a valid color arg."""
312.     if isinstance(s, str):
313.         if s.lower() == 'none':
314.             return 'none'
315.         if len(s) == 6 or len(s) == 8:
316.             stmp = '#' + s
317.             if is_color_like(stmp):
318.                 return stmp
319. 
320.     if is_color_like(s):
321.         return s
322. 
323.     # If it is still valid, it must be a tuple (as a string from matplotlibrc).
324.     try:
325.         color = ast.literal_eval(s)
326.     except (SyntaxError, ValueError):
327.         pass
328.     else:
329.         if is_color_like(color):
330.             return color
331. 
332.     raise ValueError(f'{s!r} does not look like a color arg')
333. 
334. 
335. validate_colorlist = _listify_validator(
336.     validate_color, allow_stringlist=True, doc='return a list of colorspecs')
337. 
338. 
339. def _validate_cmap(s):
340.     _api.check_isinstance((str, Colormap), cmap=s)
341.     return s
342. 
343. 
344. def validate_aspect(s):
345.     if s in ('auto', 'equal'):
346.         return s
347.     try:
348.         return float(s)
349.     except ValueError as e:
350.         raise ValueError('not a valid aspect specification') from e
351. 
352. 
353. def validate_fontsize_None(s):
354.     if s is None or s == 'None':
355.         return None
356.     else:
357.         return validate_fontsize(s)
358. 
359. 
360. def validate_fontsize(s):
361.     fontsizes = ['xx-small', 'x-small', 'small', 'medium', 'large',
362.                  'x-large', 'xx-large', 'smaller', 'larger']
363.     if isinstance(s, str):
364.         s = s.lower()
365.     if s in fontsizes:
366.         return s
367.     try:
368.         return float(s)
369.     except ValueError as e:
370.         raise ValueError("%s is not a valid font size. Valid font sizes "
371.                          "are %s." % (s, ", ".join(fontsizes))) from e
372. 
373. 
374. validate_fontsizelist = _listify_validator(validate_fontsize)
375. 
376. 
377. def validate_fontweight(s):
378.     weights = [
379.         'ultralight', 'light', 'normal', 'regular', 'book', 'medium', 'roman',
380.         'semibold', 'demibold', 'demi', 'bold', 'heavy', 'extra bold', 'black']
381.     # Note: Historically, weights have been case-sensitive in Matplotlib
382.     if s in weights:
383.         return s
384.     try:
385.         return int(s)
386.     except (ValueError, TypeError) as e:
387.         raise ValueError(f'{s} is not a valid font weight.') from e
388. 
389. 
390. def validate_fontstretch(s):
391.     stretchvalues = [
392.         'ultra-condensed', 'extra-condensed', 'condensed', 'semi-condensed',
393.         'normal', 'semi-expanded', 'expanded', 'extra-expanded',
394.         'ultra-expanded']
395.     # Note: Historically, stretchvalues have been case-sensitive in Matplotlib
396.     if s in stretchvalues:
397.         return s
398.     try:
399.         return int(s)
400.     except (ValueError, TypeError) as e:
401.         raise ValueError(f'{s} is not a valid font stretch.') from e
402. 
403. 
404. def validate_font_properties(s):
405.     parse_fontconfig_pattern(s)
406.     return s
407. 
408. 
409. def _validate_mathtext_fallback(s):
410.     _fallback_fonts = ['cm', 'stix', 'stixsans']
411.     if isinstance(s, str):
412.         s = s.lower()
413.     if s is None or s == 'none':
414.         return None
415.     elif s.lower() in _fallback_fonts:
416.         return s
417.     else:
418.         raise ValueError(
419.             f"{s} is not a valid fallback font name. Valid fallback font "
420.             f"names are {','.join(_fallback_fonts)}. Passing 'None' will turn "
421.             "fallback off.")
422. 
423. 
424. def validate_whiskers(s):
425.     try:
426.         return _listify_validator(validate_float, n=2)(s)
427.     except (TypeError, ValueError):
428.         try:
429.             return float(s)
430.         except ValueError as e:
431.             raise ValueError("Not a valid whisker value [float, "
432.                              "(float, float)]") from e
433. 
434. 
435. def validate_ps_distiller(s):
436.     if isinstance(s, str):
437.         s = s.lower()
438.     if s in ('none', None, 'false', False):
439.         return None
440.     else:
441.         return ValidateInStrings('ps.usedistiller', ['ghostscript', 'xpdf'])(s)
442. 
443. 
444. # A validator dedicated to the named line styles, based on the items in
445. # ls_mapper, and a list of possible strings read from Line2D.set_linestyle
446. _validate_named_linestyle = ValidateInStrings(
447.     'linestyle',
448.     [*ls_mapper.keys(), *ls_mapper.values(), 'None', 'none', ' ', ''],
449.     ignorecase=True)
450. 
451. 
452. def _validate_linestyle(ls):
453.     """
454.     A validator for all possible line styles, the named ones *and*
455.     the on-off ink sequences.
456.     """
457.     if isinstance(ls, str):
458.         try:  # Look first for a valid named line style, like '--' or 'solid'.
459.             return _validate_named_linestyle(ls)
460.         except ValueError:
461.             pass
462.         try:
463.             ls = ast.literal_eval(ls)  # Parsing matplotlibrc.
464.         except (SyntaxError, ValueError):
465.             pass  # Will error with the ValueError at the end.
466. 
467.     def _is_iterable_not_string_like(x):
468.         # Explicitly exclude bytes/bytearrays so that they are not
469.         # nonsensically interpreted as sequences of numbers (codepoints).
470.         return np.iterable(x) and not isinstance(x, (str, bytes, bytearray))
471. 
472.     if _is_iterable_not_string_like(ls):
473.         if len(ls) == 2 and _is_iterable_not_string_like(ls[1]):
474.             # (offset, (on, off, on, off, ...))
475.             offset, onoff = ls
476.         else:
477.             # For backcompat: (on, off, on, off, ...); the offset is implicit.
478.             offset = 0
479.             onoff = ls
480. 
481.         if (isinstance(offset, Number)
482.                 and len(onoff) % 2 == 0
483.                 and all(isinstance(elem, Number) for elem in onoff)):
484.             return (offset, onoff)
485. 
486.     raise ValueError(f"linestyle {ls!r} is not a valid on-off ink sequence.")
487. 
488. 
489. validate_fillstyle = ValidateInStrings(
490.     'markers.fillstyle', ['full', 'left', 'right', 'bottom', 'top', 'none'])
491. 
492. 
493. validate_fillstylelist = _listify_validator(validate_fillstyle)
494. 
495. 
496. def validate_markevery(s):
497.     """
498.     Validate the markevery property of a Line2D object.
499. 
500.     Parameters

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-24 03:14:25,762 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="The provided context is sufficient. The user's query and the associated patch describe a bug related to how `rc_context` handles backend resolution in Matplotlib. I have the source code for `rc_context` (`lib/matplotlib/__init__.py`), `rcParams` (`lib/matplotlib/__init__.py`), `get_backend` (`lib/matplotlib/__init__.py`), `plt.figure` and `switch_backend` (`lib/matplotlib/pyplot.py`), `Gcf` (`lib/matplotlib/_pylab_helpers.py`), and `rcsetup.py`. This set of files allows me to trace the entire execution flow: the creation of a figure within an `rc_context`, the resolution of the backend, the incorrect state restoration upon exiting the context (which the patch fixes), and the subsequent destructive call to `switch_backend` that clears the figures. No more information is needed to understand the problem and the provided solution." query='' extra_requirements='' purpose=''
2025-12-24 03:14:25,764 - thread-125239516182208.prometheus_context_collector - INFO - Successfully retrieved 8 context snippets
