2025-12-21 20:05:43,705 - thread-128098171356864.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: Management command subparsers don’t retain error formatting

Description: Description
	
Django management commands use a subclass of argparse.ArgumentParser, CommandParser, that takes some extra arguments to improve error formatting. These arguments are not copied into subparsers, created via CommandParser.add_subparsers().add_parser(). Missing arguments to subparsers thus end as stack traces on the CLI, rather than human-facing usage messages.
For example take this command with a subparser:
from django.core.management.base import BaseCommand
class Command(BaseCommand):
	def add_arguments(self, parser):
		subparsers = parser.add_subparsers(required=True)
		create = subparsers.add_parser("create")
		create.add_argument("name")
	def handle(self, *args, **options):
		pass
Missing the required subparser name argument gives the usage message, as for any normal argument:
$ ./manage.py cheeses
usage: manage.py cheeses [-h] [--version] [-v {0,1,2,3}] [--settings SETTINGS] [--pythonpath PYTHONPATH] [--traceback] [--no-color] [--force-color] [--skip-checks] {create} ...
manage.py cheeses: error: the following arguments are required: {create}
But missing the name argument to create fails with a stacktrace:
$ ./manage.py cheeses create
Traceback (most recent call last):
 File "/Users/chainz/tmp/subparserstest/./manage.py", line 21, in <module>
	main()
...
 File "/Users/chainz/.pyenv/versions/3.11.0/lib/python3.11/argparse.py", line 2131, in _parse_known_args
	self.error(_('the following arguments are required: %s') %
 File "/Users/chainz/Documents/Projects/django/django/core/management/base.py", line 72, in error
	raise CommandError("Error: %s" % message)
django.core.management.base.CommandError: Error: the following arguments are required: name
We can correct this by ensuring that the subparser action returned by add_subparsers() copies the relevant arguments through to constructed subparsers.
(Originally reported by Mark Gregson on django-developers: ​https://groups.google.com/g/django-developers/c/oWcaxkxQ-KI/m/4NUhLjddBwAJ )

Patch information:
diff --git a/django/core/management/base.py b/django/core/management/base.py
index abc6f79a15..ad698bfd7d 100644
--- a/django/core/management/base.py
+++ b/django/core/management/base.py
@@ -71,6 +71,52 @@ class CommandParser(ArgumentParser):
         else:
             raise CommandError("Error: %s" % message)
 
+    def add_subparsers(self, **kwargs):
+        """
+        Add subparsers that inherit relevant settings from this CommandParser so
+        that subparsers retain Django's error formatting and behavior.
+        """
+        # Ensure subparsers use the same parser class by default.
+        kwargs.setdefault("parser_class", type(self))
+        subparsers = super().add_subparsers(**kwargs)
+
+        parent_called_from_command_line = self.called_from_command_line
+        parent_missing_args_message = self.missing_args_message
+        parent_formatter_class = getattr(self, "formatter_class", None)
+        parent_allow_abbrev = getattr(self, "allow_abbrev", None)
+
+        original_add_parser = subparsers.add_parser
+
+        def add_parser(name, **kw):
+            # Determine the parser class that will be used for this subparser.
+            parser_class = kw.get("parser_class", getattr(subparsers, "parser_class", None))
+
+            # Propagate generic argparse settings if not explicitly provided.
+            if parent_formatter_class is not None and "formatter_class" not in kw:
+                kw["formatter_class"] = parent_formatter_class
+            if parent_allow_abbrev is not None and "allow_abbrev" not in kw:
+                kw["allow_abbrev"] = parent_allow_abbrev
+
+            # Only pass Django-specific kwargs when the target parser class
+            # understands them (i.e., is a subclass of CommandParser).
+            try:
+                if parser_class is None:
+                    parser_class = type(self)
+                if issubclass(parser_class, CommandParser):
+                    kw.setdefault("missing_args_message", parent_missing_args_message)
+                    kw.setdefault("called_from_command_line", parent_called_from_command_line)
+            except Exception:
+                # If we can't determine the parser class safely, don't inject
+                # Django-specific kwargs to avoid unexpected TypeErrors.
+                pass
+
+            return original_add_parser(name, **kw)
+
+        # Monkey-patch the returned action to inject our defaults whenever
+        # a new subparser is added.
+        subparsers.add_parser = add_parser
+        return subparsers
+
 
 def handle_default_options(options):
     """


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-12-21 20:05:43,800 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .github
|   ├── CODE_OF_CONDUCT.md
|   ├── FUNDING.yml
|   ├── SECURITY.md
|   └── workflows
|       ├── benchmark.yml
|       ├── docs.yml
|       ├── linters.yml
|       ├── new_contributor_pr.yml
|       ├── schedule_tests.yml
|       ├── schedules.yml
|       └── tests.yml
├── .pre-commit-config.yaml
├── .readthedocs.yml
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ar_DZ
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ckb
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ig
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ky
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ms
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uz
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   ├── 0012_alter_user_first_name_max_length.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   └── options.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── constraints.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── ms
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── tg
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── uz
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_redirect_new_path_help_text.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── templates
|   |   |   |   ├── sitemap.xml
|   |   |   |   └── sitemap_index.xml
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── asgi.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   ├── memcached.py
|   |   |   |   └── redis.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── async_checks.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   ├── __init__.py
|   |   |   |   └── django_4_0.py
|   |   |   ├── database.py
|   |   |   ├── files.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── filesystem.py
|   |   |   |   ├── handler.py
|   |   |   |   ├── memory.py
|   |   |   |   └── mixins.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── asgi.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── __init__.py
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── optimizemigration.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── jsonl.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── psycopg_any.py
|   |   |   |   └── schema.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _functions.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   └── special.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── enums.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── json.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── autoreload.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── asyncio.py
|   |   ├── autoreload.py
|   |   ├── cache.py
|   |   ├── connection.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── common.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           ├── default_urlconf.html
|           ├── technical_404.html
|           ├── technical_500.html
|           └── technical_500.txt
├── docs
|   ├── README.rst
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   ├── genindex.html
|   |   |   ├── layout.html
|   |   |   ├── modindex.html
|   |   |   ├── search.html
|   |   |   └── static
|   |   |       ├── console-tabs.css
|   |   |       ├── default.css
|   |   |       ├── djangodocs.css
|   |   |       ├── fontawesome
|   |   |       ├── homepage.css
|   |   |       └── reset-fonts-grids.css
|   |   └── djangodocs-epub
|   |       ├── epub-cover.html
|   |       └── static
|   |           └── epub.css
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── _images
|   |   ├── auth-remote-user.txt
|   |   ├── csrf.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-backend.txt
|   |   ├── custom-template-tags.txt
|   |   ├── deployment
|   |   |   ├── asgi
|   |   |   |   ├── daphne.txt
|   |   |   |   ├── hypercorn.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── uvicorn.txt
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── legacy-databases.txt
|   |   ├── logging.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── filters.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── constraints.txt
|   |   |   |   ├── expressions.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── logging.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── paginator.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.19.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.20.txt
|   |   ├── 1.11.21.txt
|   |   ├── 1.11.22.txt
|   |   ├── 1.11.23.txt
|   |   ├── 1.11.24.txt
|   |   ├── 1.11.25.txt
|   |   ├── 1.11.26.txt
|   |   ├── 1.11.27.txt
|   |   ├── 1.11.28.txt
|   |   ├── 1.11.29.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.11.txt
|   |   ├── 2.0.12.txt
|   |   ├── 2.0.13.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.10.txt
|   |   ├── 2.1.11.txt
|   |   ├── 2.1.12.txt
|   |   ├── 2.1.13.txt
|   |   ├── 2.1.14.txt
|   |   ├── 2.1.15.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.7.txt
|   |   ├── 2.1.8.txt
|   |   ├── 2.1.9.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.1.txt
|   |   ├── 2.2.10.txt
|   |   ├── 2.2.11.txt
|   |   ├── 2.2.12.txt
|   |   ├── 2.2.13.txt
|   |   ├── 2.2.14.txt
|   |   ├── 2.2.15.txt
|   |   ├── 2.2.16.txt
|   |   ├── 2.2.17.txt
|   |   ├── 2.2.18.txt
|   |   ├── 2.2.19.txt
|   |   ├── 2.2.2.txt
|   |   ├── 2.2.20.txt
|   |   ├── 2.2.21.txt
|   |   ├── 2.2.22.txt
|   |   ├── 2.2.23.txt
|   |   ├── 2.2.24.txt
|   |   ├── 2.2.25.txt
|   |   ├── 2.2.26.txt
|   |   ├── 2.2.27.txt
|   |   ├── 2.2.28.txt
|   |   ├── 2.2.3.txt
|   |   ├── 2.2.4.txt
|   |   ├── 2.2.5.txt
|   |   ├── 2.2.6.txt
|   |   ├── 2.2.7.txt
|   |   ├── 2.2.8.txt
|   |   ├── 2.2.9.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.1.txt
|   |   ├── 3.0.10.txt
|   |   ├── 3.0.11.txt
|   |   ├── 3.0.12.txt
|   |   ├── 3.0.13.txt
|   |   ├── 3.0.14.txt
|   |   ├── 3.0.2.txt
|   |   ├── 3.0.3.txt
|   |   ├── 3.0.4.txt
|   |   ├── 3.0.5.txt
|   |   ├── 3.0.6.txt
|   |   ├── 3.0.7.txt
|   |   ├── 3.0.8.txt
|   |   ├── 3.0.9.txt
|   |   ├── 3.0.txt
|   |   ├── 3.1.1.txt
|   |   ├── 3.1.10.txt
|   |   ├── 3.1.11.txt
|   |   ├── 3.1.12.txt
|   |   ├── 3.1.13.txt
|   |   ├── 3.1.14.txt
|   |   ├── 3.1.2.txt
|   |   ├── 3.1.3.txt
|   |   ├── 3.1.4.txt
|   |   ├── 3.1.5.txt
|   |   ├── 3.1.6.txt
|   |   ├── 3.1.7.txt
|   |   ├── 3.1.8.txt
|   |   ├── 3.1.9.txt
|   |   ├── 3.1.txt
|   |   ├── 3.2.1.txt
|   |   ├── 3.2.10.txt
|   |   ├── 3.2.11.txt
|   |   ├── 3.2.12.txt
|   |   ├── 3.2.13.txt
|   |   ├── 3.2.14.txt
|   |   ├── 3.2.15.txt
|   |   ├── 3.2.16.txt
|   |   ├── 3.2.17.txt
|   |   ├── 3.2.2.txt
|   |   ├── 3.2.3.txt
|   |   ├── 3.2.4.txt
|   |   ├── 3.2.5.txt
|   |   ├── 3.2.6.txt
|   |   ├── 3.2.7.txt
|   |   ├── 3.2.8.txt
|   |   ├── 3.2.9.txt
|   |   ├── 3.2.txt
|   |   ├── 4.0.1.txt
|   |   ├── 4.0.2.txt
|   |   ├── 4.0.3.txt
|   |   ├── 4.0.4.txt
|   |   ├── 4.0.5.txt
|   |   ├── 4.0.6.txt
|   |   ├── 4.0.7.txt
|   |   ├── 4.0.8.txt
|   |   ├── 4.0.9.txt
|   |   ├── 4.0.txt
|   |   ├── 4.1.1.txt
|   |   ├── 4.1.2.txt
|   |   ├── 4.1.3.txt
|   |   ├── 4.1.4.txt
|   |   ├── 4.1.5.txt
|   |   ├── 4.1.6.txt
|   |   ├── 4.1.7.txt
|   |   ├── 4.1.txt
|   |   ├── 4.2.txt
|   |   ├── 5.0.txt
|   |   ├── index.txt
|   |   └── security.txt
|   ├── requirements.txt
|   └── topics
|       ├── async.txt
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── fixtures.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   ├── jsi18n-mocks.test.js
|   |   └── navigation.test.js
|   ├── gis
|   |   └── mapwidget.test.js
|   └── tests.html
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_dynamic_settings_manage.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── .hidden
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       ├── noargs_command.py
    |   |       └── suppress_base_options_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── admin
    |   |   |   ├── admin_views
    |   |   |   └── base_site.html
    |   |   └── custom_filter_template.html
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_breadcrumbs.py
    |   ├── test_forms.py
    |   ├── test_history_view.py
    |   ├── test_multidb.py
    |   ├── test_nav_sidebar.py
    |   ├── test_skip_link_to_content.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   ├── no_config_app
    |   |   └── __init__.py
    |   ├── one_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── tests.py
    |   ├── two_configs_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── two_configs_one_default_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   └── two_default_configs_app
    |       ├── __init__.py
    |       └── apps.py
    ├── asgi
    |   ├── __init__.py
    |   ├── project
    |   |   └── static
    |   |       └── file.txt
    |   ├── tests.py
    |   └── urls.py
    ├── async
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_async_model_methods.py
    |   ├── test_async_queryset.py
    |   ├── test_async_related_managers.py
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   ├── with_last_login_attr.py
    |   |   ├── with_many_to_many.py
    |   |   └── with_unique_constraint.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   |   ├── auth_attrs_access.html
    |   |   |   ├── auth_attrs_messages.html
    |   |   |   ├── auth_attrs_no_access.html
    |   |   |   ├── auth_attrs_perm_in_perms.html
    |   |   |   ├── auth_attrs_perms.html
    |   |   |   ├── auth_attrs_test_access.html
    |   |   |   └── auth_attrs_user.html
    |   |   └── registration
    |   |       ├── html_password_reset_email.html
    |   |       ├── logged_out.html
    |   |       ├── login.html
    |   |       ├── password_change_form.html
    |   |       ├── password_reset_complete.html
    |   |       ├── password_reset_confirm.html
    |   |       ├── password_reset_done.html
    |   |       ├── password_reset_email.html
    |   |       ├── password_reset_form.html
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_remote_user.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── app_unmigrated
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── test_base.py
    |   |   ├── test_client.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_functions.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   ├── tests.py
    |   └── tests_async.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── template_test_apps
    |   |   ├── __init__.py
    |   |   ├── different_tags_app
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   ├── same_tags_app_1
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   └── same_tags_app_2
    |   |       ├── __init__.py
    |   |       ├── apps.py
    |   |       └── templatetags
    |   ├── test_4_0_compatibility.py
    |   ├── test_async_checks.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_files.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_class_based_error_handlers.py
    |       ├── bad_error_handlers_invalid_path.py
    |       ├── bad_function_based_error_handlers.py
    |       ├── beginning_with_slash.py
    |       ├── cbv_as_view.py
    |       ├── contains_tuple.py
    |       ├── good_class_based_error_handlers.py
    |       ├── good_function_based_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   └── ending_with_dollar.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_migrations.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   |       ├── debug.html
    |   |       └── request_attrs.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_collate.py
    |   |   ├── test_greatest.py
    |   |   ├── test_json_object.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_random.py
    |   |   ├── test_round.py
    |   |   ├── test_sign.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_md5.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_sha1.py
    |   |   ├── test_sha224.py
    |   |   ├── test_sha256.py
    |   |   ├── test_sha384.py
    |   |   ├── test_sha512.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── fake_client.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   ├── test_postgresql.py
    |   ├── test_sqlite.py
    |   └── tests.py
    ├── decorators
    |   ├── __init__.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   ├── test_middleware_mixin.py
    |   ├── test_storages.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── empty_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── test_commands.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── test_inmemory_storage.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── fixture2.xml
    |   |   ├── fixture3.xml
    |   |   ├── fixture7.xml
    |   |   └── fixture9.xml
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── animal.xml
    |   |   ├── bad_fixture2.xml
    |   |   ├── nk-inheritance2.xml
    |   |   ├── non_natural_2.xml
    |   |   ├── pretty.xml
    |   |   └── sequence_extra_xml.xml
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── absolute_urls.py
    |   ├── no_slash_urls.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   |   └── default.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_jsonfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   |       └── custom_widget.html
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   |       ├── article_form.html
    |   |       ├── custom_widget.html
    |   |       ├── cyclic_context_boundfield_render.html
    |   |       ├── error.html
    |   |       ├── form_snippet.html
    |   |       ├── legend_test.html
    |   |       └── use_fieldset.html
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   └── tags.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   |       └── using.html
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   ├── about.html
    |   |   |   ├── apple_detail.html
    |   |   |   ├── artist_detail.html
    |   |   |   ├── artist_form.html
    |   |   |   ├── author_confirm_delete.html
    |   |   |   ├── author_detail.html
    |   |   |   ├── author_form.html
    |   |   |   ├── author_list.html
    |   |   |   ├── author_objects.html
    |   |   |   ├── author_view.html
    |   |   |   ├── book_archive.html
    |   |   |   ├── book_archive_day.html
    |   |   |   ├── book_archive_month.html
    |   |   |   ├── book_archive_week.html
    |   |   |   ├── book_archive_year.html
    |   |   |   ├── book_detail.html
    |   |   |   ├── book_list.html
    |   |   |   ├── confirm_delete.html
    |   |   |   ├── detail.html
    |   |   |   ├── form.html
    |   |   |   ├── list.html
    |   |   |   ├── page_template.html
    |   |   |   ├── robots.txt
    |   |   |   └── using.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── has_nulls
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   ├── test_srs.py
    |   |   └── tests.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_indexes.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_create_models.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_rastermodels.py
    |   |   |   └── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   |   └── test_handler.html
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   |   └── ignored.html
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   |   └── media_ignored.html
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   ├── javascript_ignored.js
    |   |   |   └── static_ignored.html
    |   |   └── templates
    |   |       ├── empty.html
    |   |       ├── subdir
    |   |       ├── test.html
    |   |       └── xxx_ignored.html
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── loading
    |   |   ├── en
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_AU
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_CA
    |   |   |   └── LC_MESSAGES
    |   |   └── en_NZ
    |   |       └── LC_MESSAGES
    |   ├── loading_app
    |   |   ├── __init__.py
    |   |   ├── apps.py
    |   |   └── locale
    |   |       └── en
    |   ├── models.py
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   |   ├── 404.html
    |   |   |   └── dummy.html
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── models.py
    |   |   |   └── test.html
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   |   └── percents.html
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── unchanged
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   ├── tests.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_fake_initial_case_insensitive
    |   |   ├── fake_initial
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── initial
    |   |       ├── 0001_initial.py
    |   |       └── __init__.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_conflict_long_name
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second_migration_with_long_name.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_manual_porting
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   └── __init__.py
    |   ├── test_migrations_namespace_package
    |   |   └── 0001_initial.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_no_operations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_noop
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   ├── 0005_fifth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_no_replaces
    |   |   ├── 0001_squashed_0002.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_enums
    |   ├── __init__.py
    |   └── tests.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autofield.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_filepathfield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_jsonfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_pk.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── model_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── integration_settings.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_constraints.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_integration.py
    |   ├── test_introspection.py
    |   ├── test_operations.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_contains.py
    |   ├── test_db_returning.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   ├── test_sqlcompiler.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests_tests
    |   ├── __init__.py
    |   ├── test_accept_header.py
    |   ├── test_data_upload_settings.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_jsonl.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_clear_expired.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   |       └── using.html
    |   ├── templates
    |   |   └── shortcuts
    |   |       ├── render_test.html
    |   |       └── using.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── custom_sitemap.xml
    |   |   └── custom_sitemap_lastmod_index.xml
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   ├── test_management.py
    |   ├── test_utils.py
    |   └── urls
    |       ├── __init__.py
    |       ├── empty.py
    |       ├── http.py
    |       ├── https.py
    |       ├── index_only.py
    |       └── sitemap_only.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── absolute_root.css
    |   |   |   ├── absolute_root.js
    |   |   |   ├── cached
    |   |   |   ├── nested
    |   |   |   ├── styles_root.css
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   |   └── faulty.css
    |   |   ├── loop
    |   |   |   ├── bar.css
    |   |   |   └── foo.css
    |   |   ├── pathlib
    |   |   |   └── pathlib.txt
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   |       ├── description.html
    |   |       ├── description_context.html
    |   |       ├── title.html
    |   |       └── title_context.html
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   |       └── hello.html
    |   ├── jinja2
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       ├── syntax_error.html
    |   |       ├── syntax_error2.html
    |   |       └── syntax_error_include.html
    |   ├── template_strings
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       └── syntax_error.html
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_loader
    |   |       ├── goodbye.html
    |   |       ├── hello.html
    |   |       └── request.html
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   |       └── using.html
    |   ├── other_templates
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   └── test_dirs.html
    |   ├── recursive_templates
    |   |   ├── fs
    |   |   |   ├── extend-missing.html
    |   |   |   ├── one.html
    |   |   |   ├── other-recursive.html
    |   |   |   ├── recursive.html
    |   |   |   ├── self.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── fs2
    |   |   |   └── recursive.html
    |   |   └── fs3
    |   |       └── recursive.html
    |   ├── relative_templates
    |   |   ├── dir1
    |   |   |   ├── dir2
    |   |   |   ├── looped.html
    |   |   |   ├── one.html
    |   |   |   ├── one1.html
    |   |   |   ├── one2.html
    |   |   |   ├── one3.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── error_extends.html
    |   |   ├── error_include.html
    |   |   ├── one.html
    |   |   ├── one_var.html
    |   |   ├── three.html
    |   |   └── two.html
    |   ├── syntax_tests
    |   |   ├── __init__.py
    |   |   ├── i18n
    |   |   |   ├── __init__.py
    |   |   |   ├── base.py
    |   |   |   ├── test_blocktranslate.py
    |   |   |   ├── test_filters.py
    |   |   |   ├── test_get_available_languages.py
    |   |   |   ├── test_get_current_language.py
    |   |   |   ├── test_get_current_language_bidi.py
    |   |   |   ├── test_get_language_info.py
    |   |   |   ├── test_get_language_info_list.py
    |   |   |   ├── test_language.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Management command subparsers don’t retain error formatting

Description: Description
	
Django management commands use a subclass of argparse.ArgumentParser, CommandParser, that takes some extra arguments to improve error formatting. These arguments are not copied into subparsers, created via CommandParser.add_subparsers().add_parser(). Missing arguments to subparsers thus end as stack traces on the CLI, rather than human-facing usage messages.
For example take this command with a subparser:
from django.core.management.base import BaseCommand
class Command(BaseCommand):
	def add_arguments(self, parser):
		subparsers = parser.add_subparsers(required=True)
		create = subparsers.add_parser("create")
		create.add_argument("name")
	def handle(self, *args, **options):
		pass
Missing the required subparser name argument gives the usage message, as for any normal argument:
$ ./manage.py cheeses
usage: manage.py cheeses [-h] [--version] [-v {0,1,2,3}] [--settings SETTINGS] [--pythonpath PYTHONPATH] [--traceback] [--no-color] [--force-color] [--skip-checks] {create} ...
manage.py cheeses: error: the following arguments are required: {create}
But missing the name argument to create fails with a stacktrace:
$ ./manage.py cheeses create
Traceback (most recent call last):
 File "/Users/chainz/tmp/subparserstest/./manage.py", line 21, in <module>
	main()
...
 File "/Users/chainz/.pyenv/versions/3.11.0/lib/python3.11/argparse.py", line 2131, in _parse_known_args
	self.error(_('the following arguments are required: %s') %
 File "/Users/chainz/Documents/Projects/django/django/core/management/base.py", line 72, in error
	raise CommandError("Error: %s" % message)
django.core.management.base.CommandError: Error: the following arguments are required: name
We can correct this by ensuring that the subparser action returned by add_subparsers() copies the relevant arguments through to constructed subparsers.
(Originally reported by Mark Gregson on django-developers: ​https://groups.google.com/g/django-developers/c/oWcaxkxQ-KI/m/4NUhLjddBwAJ )

Patch information:
diff --git a/django/core/management/base.py b/django/core/management/base.py
index abc6f79a15..ad698bfd7d 100644
--- a/django/core/management/base.py
+++ b/django/core/management/base.py
@@ -71,6 +71,52 @@ class CommandParser(ArgumentParser):
         else:
             raise CommandError("Error: %s" % message)
 
+    def add_subparsers(self, **kwargs):
+        """
+        Add subparsers that inherit relevant settings from this CommandParser so
+        that subparsers retain Django's error formatting and behavior.
+        """
+        # Ensure subparsers use the same parser class by default.
+        kwargs.setdefault("parser_class", type(self))
+        subparsers = super().add_subparsers(**kwargs)
+
+        parent_called_from_command_line = self.called_from_command_line
+        parent_missing_args_message = self.missing_args_message
+        parent_formatter_class = getattr(self, "formatter_class", None)
+        parent_allow_abbrev = getattr(self, "allow_abbrev", None)
+
+        original_add_parser = subparsers.add_parser
+
+        def add_parser(name, **kw):
+            # Determine the parser class that will be used for this subparser.
+            parser_class = kw.get("parser_class", getattr(subparsers, "parser_class", None))
+
+            # Propagate generic argparse settings if not explicitly provided.
+            if parent_formatter_class is not None and "formatter_class" not in kw:
+                kw["formatter_class"] = parent_formatter_class
+            if parent_allow_abbrev is not None and "allow_abbrev" not in kw:
+                kw["allow_abbrev"] = parent_allow_abbrev
+
+            # Only pass Django-specific kwargs when the target parser class
+            # understands them (i.e., is a subclass of CommandParser).
+            try:
+                if parser_class is None:
+                    parser_class = type(self)
+                if issubclass(parser_class, CommandParser):
+                    kw.setdefault("missing_args_message", parent_missing_args_message)
+                    kw.setdefault("called_from_command_line", parent_called_from_command_line)
+            except Exception:
+                # If we can't determine the parser class safely, don't inject
+                # Django-specific kwargs to avoid unexpected TypeErrors.
+                pass
+
+            return original_add_parser(name, **kw)
+
+        # Monkey-patch the returned action to inject our defaults whenever
+        # a new subparser is added.
+        subparsers.add_parser = add_parser
+        return subparsers
+
 
 def handle_default_options(options):
     """


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 20:06:33,444 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="The user wants to find test cases for a bug in management command subparser error handling. I need to inspect tests that define and execute management commands with subparsers and check for correct error handling. The `tests/admin_scripts/` directory is likely to contain such tests, as it's designed for testing management script execution." query='Please provide the full content of `tests/admin_scripts/tests.py` and all Python files inside `tests/admin_scripts/management/commands/`.' extra_requirements='' purpose='This will provide the necessary context to find test cases that cover command-line argument parsing with subparsers and their error handling.'
2025-12-21 20:06:33,446 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `tests/admin_scripts/tests.py` and all Python files inside `tests/admin_scripts/management/commands/`.
2025-12-21 20:06:33,446 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-21 20:06:33,446 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-21 20:06:33,447 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-21 20:06:33,447 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `tests/admin_scripts/tests.py` and all Python files inside `tests/admin_scripts/management/commands/`.
Purpose: This will provide the necessary context to find test cases that cover command-line argument parsing with subparsers and their error handling.
2025-12-21 20:06:43,048 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'find_file_node_with_relative_path', 'arguments': '{"relative_path": "tests/admin_scripts/management/commands/"}'}, '__gemini_function_call_thought_signatures__': {'4ecaf682-a3e0-4f8c-b71e-b67667c5a2fc': 'CrQJAY89a1/O8UD4GU+H/iMaALruHZ7wBL0i2MLVvKiN3YEfPMEkNUhiwpZHuh+AST7nAKOz8EIyjbBfpK3Vyuda1h0Ngj13ZUKnspg3hTyrL06EMLpJtRUi4TVAjLtjSuEQOifAZgn3y6H0ZaraaSFnHW22vlmHuPNn9hVqCI8KlcWFLhtIhkx24gswSRsoBCiPhPWa0GXIJ92N5h6Qm8kU1q8eVbBBd06JExZer3EgGSXpe94+JGlT3x+Iu+SR51/23axTyPjapDTnMkGwexo/oCiNahI827Oi7OqKYSzWM/RuorwVD2Iz8MT6U0YV4/HiN2OPPZw2j9NbG/Nlb12AZUdLToScLEHqJoYpaeZ3fFoGOY5OHowDI5Yp+3TdlxhOyvL8k4hOh7DVeg9Kyc8aT2BOVNotbyHsNxdsdS8ePd4w0HMUhSPyUaa3CrwAAFm6QFa5uRCSjHlxUr60/Ck97NWsFHt+WUzp3+j5NXl4oUHSrIBc5IE8LjFAnfXh+pl6Vny963tWDLVziw7vJIVw2RBAAlJHgHbhUGjOqPymnqmvgVkN5PxNNge5RJf1RWupFROLzhgU183FnFT8XSUjc5FxEYmRi4W4FG2dTip9GhjDYIxi+QGih1ThV8c52mHRuwnLepuw4jRpa8kmWavoSUk/viUQK5CLCGKCarzHdGYThnop2+NOSFhTtumEk8AUGJqIW1V8bM0LURj0YdkqZwayyQTYS40GxqSATlMYdnLmsEHlQTZXPBp7dxRyp/ZhB8XaPKZX7Cj/nPtKi3SNFfMCm+Tj0yfmbnDggQU5FACoQF2BQ+OgQV6jvV0RsIezw3UOiI3CzVPcyIl0mBUf4f3ybFaiBQiS7EsvV7TchdHD9P8wE5ZSKI2b3eN9jl5emyCiDdwUHiNcGYX26nN1ZE28HdLFk2Z4z/45hBFbqXpT01xzts997xjbcwvRNanMKfk1ZmhanRJu0iq2+ZHy+Ri2C4M1fJUYVOXzb9gs9FV15XMkZsJZw9qfi67MeKtlQW4vK2PB/gpk5+xpc7SEmjKNzUFSQu6uvEG8Liw/RPFKPswuSYTk0X9IiNF2S6N4T0WtXgIcOGykUh8LLgKLdZG7vmTZHaEFERZNAe0+m0khbMtNWPGFfNufzyiBW8A/mpGxdyaiIHhtpB+fU1UcTuAJ0LR85zFHfUHLb5SzXFySUDuZFXQHfQ+33guiceANrVznfI5pBpkLs/U2KTtZ04vpnwRfNP7qKHB8nGs4Y55uewv835zk+ooFWmeaWRFILEeji6MBQNuLUo6G/BukOWulX5rrfDxpSPzHG1NUAjt4O3FnPtMneuSrLoU7jjB0tXLExfPkLaxH+rJ/n1zlh5PeKyIG4qru8rJ2Uj8pGurM1CzhBu8olxnw6uazpyLo2aJiNKu7d9UBP7IqaLWnUufVmPDc7/W/jpPQqR6BZc8pjSYN0v+mXNBg4BOuP2SjAtSAyx9vqH/NUPCUVnBClzBQ2mm1O6s4W4tbH0O71n+DFwsmR9Iims/3lrZiWYLHfHEXkmCv4a3Jum9X+iTwesx+IC1ck3Esp4ZiAdRKSACzOK9CUAYJPOv8oEc7cPAWiXOvOA=='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2119, 'candidates_token_count': 47, 'total_token_count': 3199, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2119}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 47}], 'thoughts_token_count': 1033, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -1.0924744301653924, 'model_name': 'gemini-2.5-pro'} id='run--9dc26b86-80c2-4470-9020-e113ce8c46e5-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/admin_scripts/tests.py'}, 'id': '4ecaf682-a3e0-4f8c-b71e-b67667c5a2fc', 'type': 'tool_call'}, {'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'tests/admin_scripts/management/commands/'}, 'id': '6f8969a1-44da-45ff-af15-b09f9338abce', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2119, 'output_tokens': 47, 'total_tokens': 3199, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 1033}}
2025-12-21 20:06:46,396 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'find_file_node_with_relative_path', 'arguments': '{"relative_path": "tests/admin_scripts/management/"}'}, '__gemini_function_call_thought_signatures__': {'598b5ee1-a7a5-4c6d-968f-d035fd110673': 'CtoGAY89a19aycc20XO+J02hiDn6/mLp2Lk8CLD7IhhA4foNCZP7Igv/7LghrjgOUnYEO+keVWIDY3DW7f2Scjr56/XUBU4tFJS0Nj1rYWx6gz7n//CZvgskj73h/LXLcQsOH+bDM5EXpkDGuUSYvT3ZGrbvwrpB7++XmUj2oe1GYzkfPkWAVcpGgTRLr1NTeD4k6E36wrkKbg7OwXhs24zidh4rkXlFQ7UBYxK3rUfu+vODOZieBvt56JH7VOFWUyl9hXLSYR2+QwmDQTaQ21TBLPSF3imG/UFcSHybRxo5vn3lFQ2aypWb8fKeetiDoSfnWjlQBMENswPIf4GxhpeHTjdgcjrkFHwj0cTgXtr0dvgM517+VhM3b4oRgEdp/g74lCrx6hPQIgaTc/KPPWfglg6tsg9bXcTuIz4w/mV8S8xyXVdSHFw5UddF3EDSLGiZWPbVS+IAocAY9J/Js/SeMYs4tOaCf0xHyKPzUijFWtap2yVxP3aS5AQb2Db+MWX+KV74CriZYaCN5ob0ZmgZn1A9rAZygMs70dzuIyFVE9OZTBbXcTCPDtXE5Nawc/iD+cUz32GhoZTKjMVVVcaranPze0/qKAxukK3KrO+8wh4mDCNAGLlHzOcwQ7xpYGr0bSaC9sW9BQ+CcsreJ/oJNsnwhqVN43aDSmGNr5qPZZDv8K5RY69dXZjX/yl0yd/K/D/RudfYIjUTya00gQC6DW4BMtjEZ2hwystUI+VnJZW/qhGBmnLeLDDMIYSu9JtOJV0gXIjZmc1sI4bMt4LLtnM1vC0MCfj/C267hZ940B8hgvZEifAc3CQcdT3rsDswuw8dCMpZQxKqICC/zFhSQwdJ+s7svxqV1z4+h1t067s+OEb6zNZm+z3RgUs/AMgEIBFaRNS5x+5yaLHoDuH+uj8A9GQy+p1+H5UWtvS+gHkp1cPjnSsk3GzJuIApWpF1C74FPhWCJzkxpvV1eDZAvnFj82va3MADbyIhfsS72k9DSVl5bWXYStiHRndyN7te61cBtrSSZuXUfUKGYLAQNkJH6QaUOdHl9N8qErWe/554539DrXSvLMotz3aO8/HrrU/uP40guLADqj6hzKZkDU3Uh7Y1QnEIKyPwUGjeiPkUAvJI/TwXlP0t'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 9419, 'candidates_token_count': 51, 'total_token_count': 9692, 'cached_content_token_count': 1820, 'prompt_tokens_details': [{'modality': 1, 'token_count': 9740}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1820}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 51}], 'thoughts_token_count': 222}, 'finish_reason': 'STOP', 'avg_logprobs': -0.32243047976026346, 'model_name': 'gemini-2.5-pro'} id='run--da14bfeb-19ed-4aa9-8216-38ac187fcfcd-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'end_line': 1001.0, 'start_line': 501.0, 'relative_path': 'tests/admin_scripts/tests.py'}, 'id': '598b5ee1-a7a5-4c6d-968f-d035fd110673', 'type': 'tool_call'}, {'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'tests/admin_scripts/management/'}, 'id': '2e3afa6d-4d69-4fe0-9a9b-2eab132fe565', 'type': 'tool_call'}] usage_metadata={'input_tokens': 9419, 'output_tokens': 51, 'total_tokens': 9692, 'input_token_details': {'cache_read': 1820}, 'output_token_details': {'reasoning': 222}}
2025-12-21 20:06:49,460 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'find_file_node_with_relative_path', 'arguments': '{"relative_path": "tests/admin_scripts/"}'}, '__gemini_function_call_thought_signatures__': {'2ce9c0d9-5310-4538-a218-cce0d9fb6ad3': 'CpEHAY89a1/nDvz8K/qKoWxOxeIx7qP5rxSFo7un90YH6LLuIck1HGQZyWItnzBFjLn5Ez+awqjKPPBmpbtqua56VNvRqR1sobUheynbbUzEygZmTTyX9X2SghTq7+SMgCGE0lq+8tqREUzu2VReGStqFuHyEpiDrWdiYbBjWhAs5Ov+kcZimHilS/WLJoPBKxj32KPSkcGAxc1hk2/AourM3x5XV4JxZBB8UDB96aW90+kYCPjHd4eehB5NBv7T9n5LLb4Y3PVwC8LDv278Ho9tClLiyTmspJCY68g3/cUR7GR9/UpNDBL06NSt6P78JmTM0ZBj/oBZv3l5tlLBEJLZF0wgxCmsil5sPJdjV5XFwHNbxSqpvsobq2XNSqY0R5rUW/6SrSGInVa0VL2LXcFIAjuc09+Ma1xdnApWyQo6aRDlC+L/7ZaYEFiFVBbVH8qUWbayH6cIA9eB1acJFHZbj7Gr8PD9Dx5t6PxFJknVSWvlfGJYIRsOY1xOCVXRY0LGLXVOr+EzAm5C9v910IaEkDxQ8qxPiDO5DoFiAbg88woIAoPhVJIbyhVx+JiFOiEhKDMgjtds9IvGXmTpL2kTwnBjq6LyGoUbEkYF4gWvkZj8Ku6q3sljrOPj4hepu8ZWXaRZP4ME4xCP+zkyG/Qd+SUKu9+kB5XLS0fuEEvcLYCmPZjXVnLPnqf7GZ+dPjk9u3WuH/TkkJUYFxDpZPJZ0Kt8RvPtN1Alyo/gThehYEcAjzO6d0LLTIRYIDY/G3N/zo4yhKe3VZi3FQDJ2Ff26zVIA2dwMkEgvSXVL+dKlq4QKoVh3lWznzlpEahcrRRSF89bL8Dee6hYvLTjluURWPMZ2c4APb0I0JY4Q0X47zyte5b5K87o3pMOj7DUkk4wC4dEsxcDiDTfxup1In8drOWhBfYGlSF//hPAK7cqZb20KI3IAiB7K/Nf02iaIXaQIafYB3SLNdsZvHFEJtzjpvJbx/cSJ3TYdcCZ6Ep5h+PVhVaemx1RPRr/L+0LS/n3msMQ3jXmHDjSkJtS5+M0N0+NA73bBg57Z344qvN544/HvsvsaibSGUFuEs63opWxpg9QRSNa7rB2rVEOR7mNWCI26g0vO1Yi3L7dmNm2GqzirYI16PqRztKmkV65U8oj6WSFhLX2g3LiYjDn//pI9JFa+bIiKlGWcsqVgVk2LtKP8+hJUQ7/3k/qhnPfl0nXDg=='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 17018, 'candidates_token_count': 49, 'total_token_count': 17305, 'cached_content_token_count': 9343, 'prompt_tokens_details': [{'modality': 1, 'token_count': 17561}], 'cache_tokens_details': [{'modality': 1, 'token_count': 9343}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 49}], 'thoughts_token_count': 238}, 'finish_reason': 'STOP', 'avg_logprobs': -0.22894565426573463, 'model_name': 'gemini-2.5-pro'} id='run--97465f99-3690-42d7-939b-652d11a33b7e-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/admin_scripts/tests.py', 'start_line': 1002.0, 'end_line': 1502.0}, 'id': '2ce9c0d9-5310-4538-a218-cce0d9fb6ad3', 'type': 'tool_call'}, {'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'tests/admin_scripts/'}, 'id': 'f8919b81-1cf8-4786-9b0c-a4c26e9f0cfe', 'type': 'tool_call'}] usage_metadata={'input_tokens': 17018, 'output_tokens': 49, 'total_tokens': 17305, 'input_token_details': {'cache_read': 9343}, 'output_token_details': {'reasoning': 238}}
2025-12-21 20:06:52,909 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'find_file_node_with_relative_path', 'arguments': '{"relative_path": "tests/"}'}, '__gemini_function_call_thought_signatures__': {'435f2997-7900-4fd5-9664-79e3b6b69b77': 'CtIHAY89a19u9+wiPCXYnbmNZm+7P6KP3wXFsbI/wzN7YR3mDNjYj1dGur9QyQ6dpBZrzzygdqscjQ7xDzZSAVpOkA1lPKgVY/wELryTODZFNP8XiWikz7P1tkKVSDEy+v/g9IJkps0t+LykLIpaDqVwMePHxwWg946myEYsDXw0YXaXX+3CBzTqDqhlmHYb7M7tCRalQ7wHKT2WzabNVGqBRau/Ypcl5SeLQsR1m0y8DqnaIheI0wFLywoYeG0kbJxuMrizHa0OY9gRmTlkvFf51dWSCZHFOo5yaqt0nh7ZatvPyIDyLFc0P3oCV4CZ9ORcYMZqBQy/ti/d/vyDdbYTBfF/PaWqJL7l4qJmvF/GjSj7RRllUER2YxuydfwPzOxjwtFyUJXbeBPELb1XmN8AxVt7IKgvOPVeViFTDS2Gh90L3W/ISBIjSiEwIUdxL8d+GxOs2O84zRbsU2i/pA7h6ohEihtvGQon+gpMW3fGxeyM9n3Pl1maXaMtuIIO+eM9CF6SiZHbzeE5LrbxuxZsBzVhDp4Cftgdo/qRGo4w0nAhbBd41hqShq9Dz4fF2gP8oZPgNb7bM8risYshrjF+kUgUQelkTwgyFq2HfLhhECOxWX4GEfaoG7FcarmB0KWwgQWhhj/hncHLyKdRxy05fiC2Llth96wRrVXslUsygahLTpOu/Bg98wW8qJuJB/k3WHlMM8atbQj9Q7aqLDXw7Ked8DPVU0c5qa7rIDIWm4QBCDnWsRXQbOMsE4mbUWjyx4dfiXsNiGMjL3O22A59/MgiwNP4KnTRInBO4u7dqVuKG7HJ+aTxkPJCVaPnRfrmi7z1pqbx2h+KgmlDnZFTimB/9m3II+Ma9D2kbgFszEcAxqxInbGIQVXuoW1nsdh1LAAVQIMXsa1J95JilkZQpG5lW2pGpsLVer5MuPenfXWN2xrBxLjDMbhVN1a4woXkgR4Rbx/29R1x9X3Fu0zuVX5wEFAAyU2NumgTavbatvis3BpqvIcMZ7xxWhkD2WX7WJ3cKgdPeXDGUZ5NLUqYLMxRFUQpJV9P4vG1MV2EzHmBySbH+Ge/9FSH8gvn92nQtHFkiFnRjPriPnVan+A7eOjd4XJTRS4xZ/dYlRwDHyNpU5B1IVxdLi/8vUq9Gh7uierKiEXNKwnugOOTGeK/FgW6FamYci8rrgcFCn0Udhi7H5DTRrXrw2perj+vHip2Iv8QwPNtb6mOE+Mzdz8A7hmdWvYl24GVNThEoM7YiSGztXTqhMirZbyyctcA3bzBYMnsXcxxzN2/BeN9jsBnGLbd'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 25073, 'candidates_token_count': 45, 'total_token_count': 25372, 'cached_content_token_count': 17018, 'prompt_tokens_details': [{'modality': 1, 'token_count': 25854}], 'cache_tokens_details': [{'modality': 1, 'token_count': 17018}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 45}], 'thoughts_token_count': 254}, 'finish_reason': 'STOP', 'avg_logprobs': -0.4674132453070747, 'model_name': 'gemini-2.5-pro'} id='run--acde5b65-c385-4daf-9073-b1d5c3c35b8a-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/admin_scripts/tests.py', 'start_line': 1503.0, 'end_line': 2003.0}, 'id': '435f2997-7900-4fd5-9664-79e3b6b69b77', 'type': 'tool_call'}, {'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'tests/'}, 'id': '784d263b-bb76-4bb3-9491-52bb3eed3a16', 'type': 'tool_call'}] usage_metadata={'input_tokens': 25073, 'output_tokens': 45, 'total_tokens': 25372, 'input_token_details': {'cache_read': 17018}, 'output_token_details': {'reasoning': 254}}
2025-12-21 20:06:56,152 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'find_file_node_with_relative_path', 'arguments': '{"relative_path": "/"}'}, '__gemini_function_call_thought_signatures__': {'43ff41f5-104a-4dc5-baf6-367c052195e0': 'CpEIAY89a18/QIg0/rFwrg9iSoYDwy2u17JvvMUsESqIlTvrNWQDd3dJc/+Q7FLg6XcJIMhxl+2HYgr4LzvlALwjZXlIjokannVSACPy2wvHoybXlETLT6lBgY+E5CIKPSicbaVDEYxAtbCcX5N1QTAmQfe2H/z/wvNrHevM9uTx1K5nM5e21mbKUzKCmkOPb3KJcVtQHuTiXB8Zh537zhN9xN+3UrED4M2RrDmMG9aLH+Zbub4BQekLLpm+58R6NJomgZ6zg7wEnKbSwsK6CnxOsPW5MbZonRfGZOHnoln5Gsr2LRZWN939UdU1+P8L3zNgQ9K6ziKVnyKdZcNtP7ClRWDo4oLSJQz5a+LmfGPoWhS678cRQ+mE3CZpYLyhRkM/QFtgiCO8UK8WF8AnctO6ebi5AEMF+cmBTELYBJYzTYVhmY3CH/TGkALW8lTVstfc1GVixuWqmIRtOxPVlA+WG6LrgWznqwg+pzHE4R8wdqCZ8yoyLwNpd5FIBYuwyk3rE9J2/T9Rb1zSIgM75CTlOQLfTru0K0KADaV0SSujiyYoiFfIU4kPJR6beo6ARhv5qvQQ3HYlcreFICRGeXwAak2Se4ZzQWXx5SLex2+ztXtU6XCoMWc88nX7u2/JBtN7eCu2PBX8/Jx9V6ejHOpIRANRin+X70q/9k9H8sn+z3e5QfAgd0N7Wfq3jj+x9GGKfAsvnD8EyKuNlFGAALZNxzxWsP9y16Q/OELxn30Xz0kptDHMpyDg+mQRh6W0SgdmqWlhCSCnBOyxqWwWVjBAgNG/+NpnDe0s9VAuwli3/rQxAi2jMHeUTCWKqMkHVYprKMzA6UTtUROPC++q+HhxAzdKdgzZOOBha435/TPdJZx5zs9IUsRfkpL628GeDN4Th9uVrbH4r/4XRpK1T6fZ5fLsuX5TnPDSxr1m1Diu8x6FzQeoxpqzTau8CS3I6n7jDaT4wPz1suxWdgc0E6BXaRG/+rKvAhjEn4gMW6CXEWFOgp0zfA7jvbhRFhIRq3g29FPtn5jwUDUZ0iJnCfPQVBu98r5w4/0L7+fU6AOKI6FxbNGt8F+fpdD1aYIjA/E+F+hHAGjgBjPi0iUtzXEL9EFfOzL1isjvkHs5bQORxduwvJjbTVp13MZVQp7n5S5YP+XvZe+rf3GoOg2rDrMdYFIU4RpsoVn+JbZOHC8fx4fZVbMRQ7YYyVTcogT2U7rsG5GugKWdCdlXdvoowpXe5jSNFuBUeaBj5u4jm9kXaa7pkcDz1Z3HoJF/BtWhb+S9CiJvORn1Ru79Wqm+hZ7+zR1m9Zh1VccLLk2p4h1AMCmm+trcqAZKhafWXa56anTPKPtCnv9ts4c2p55pVKVhlzYyvyWAHykTnXF6Cdwe8sRS'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 33469, 'candidates_token_count': 44, 'total_token_count': 33780, 'cached_content_token_count': 24805, 'prompt_tokens_details': [{'modality': 1, 'token_count': 34504}], 'cache_tokens_details': [{'modality': 1, 'token_count': 24805}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 44}], 'thoughts_token_count': 267}, 'finish_reason': 'STOP', 'avg_logprobs': -0.2826853665438565, 'model_name': 'gemini-2.5-pro'} id='run--8ccbc42e-f83a-4871-b8ee-0d701a988074-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'end_line': 2504.0, 'start_line': 2004.0, 'relative_path': 'tests/admin_scripts/tests.py'}, 'id': '43ff41f5-104a-4dc5-baf6-367c052195e0', 'type': 'tool_call'}, {'name': 'find_file_node_with_relative_path', 'args': {'relative_path': '/'}, 'id': 'b8708919-6465-4c0d-9164-eaaaf372de32', 'type': 'tool_call'}] usage_metadata={'input_tokens': 33469, 'output_tokens': 44, 'total_tokens': 33780, 'input_token_details': {'cache_read': 24805}, 'output_token_details': {'reasoning': 267}}
2025-12-21 20:06:59,709 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'find_file_node_with_relative_path', 'arguments': '{"relative_path": "./"}'}, '__gemini_function_call_thought_signatures__': {'f77093fc-e308-43ae-ab4d-2f17d0878462': 'CqsIAY89a1+OkgRMvgUqD6J1OughKPbgqR5fKEyeJBbIiINN0E+pZnmb1WVRkS2xZugkvrUniNWIiBSfFklop7BvXzFry0rzcrstu91bIXfz7W2oWJLMdNt0BNATkmbN1OPnwegNZEHgiyIFqA8CVL3JpO2tJm2m+KHYIhxCgmkQIKk2QUR6N/NP3Q8cWfk5bZ6Jk4PNH1n7fHScjfJR7vDkBoloWToUfiaD5KO0TIOWIdMKwdx8NgcS/Rl6GdIMf+UXntR94btEX9rbqYncct94ofNvmUzAoWu5lLIw0zOdUGPvte84TV3/LjUstb99rBs/KpunlG2QkLRNshPRmWjGBp5Q9dE2OYjZmzrzt6X+1lpx+cftALcMPmXh81jyy7RTUoNnwifzmqzIYt+6tk/uSFLgJjC+NrBKl/KdafjOkY1xce49fNspjho1Npe+o9F/YtJt48U1xR/+qdQYMalNUcumdt4gFLyFQ7njW3iwJzUXg1E2H/5LlCHq0SvRZlKUWBh2CoOeemxrpK4jd6WBqVMfrVZOnG/+j8p6w6xuwGkipEG86OTf7k6knh8NJIWcQJQLjdVuMdwxve2VeOIfSbxExGs10E1mPb3yKQLNPA2WOCqmFWuy6XZK1hvnKeM7OOF3AFdbSHVwb15ZBa5szcmDJa49F0jMPApO5zGT58byAIBiE1VoKJcjyEe1YiPMi2WXHbWo4z6RO6V3wQ8DcoAMJssZ33QDWRJ9JJdO2nxzqTXBT+uBWdB44uq+I5pi2U7S3W4KE2VzNv1olXSd9dpTGDOjbanSj7SUE+0eJq0H9+bxrXLzG7O1Ys6CKnqzuV59iu0RZ/Pq1DPRbywpCgEM09Yf59Qkt6z8MaXbP/7Sr2EzPhSUPOXsZhsWBF49DNdC0tbO6Xx0YqpRS8pKUReHiAn6xmFgt33UftRBBQc441WBCPihn7UZ86oMCpqUagOqPnWm87yZ8Up8WVb5iygB85GVWmcqRTlJMe979t9X8tnLLHMn6hAkm7SECkDsCS/rcwkoMaHPpXr5Cq+Z8OJ7EC7pvudp9eCwPEXqfZFnYDz5qbuNON00G4OsIGU75ZMJqZjpDfdaAms+0VthjX5DM31CoSnrngQijGKiZV3kEOJnNWrYDVo+QtOr/yGivBhxahvr63biRvAMLDw45wsagh/4foh6uZYZQDN5wIE/2PQ1m4bwdlGiapUcqqpAIf92OrlGXSKdqpOCUAlputGeKk1V8Cg2tyxyc1BmLd/7ixyPcOnDWyZY0qiOSXOFsgtPBGb101JLJBKIQC2QA5qdeWiAl/DZeiJ5DOBVBW6jM1LC1nga2FQikhH0K/C9Rfw7CPdXcSjdHAYHN4mEX9jcXW7hdijI0ij4J5A7KoQ8EZVcZuRT3NTbPdeL/9Yggn9pAC70dOvjrS4='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 42046, 'candidates_token_count': 44, 'total_token_count': 42363, 'cached_content_token_count': 34505, 'prompt_tokens_details': [{'modality': 1, 'token_count': 43348}], 'cache_tokens_details': [{'modality': 1, 'token_count': 34505}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 44}], 'thoughts_token_count': 273}, 'finish_reason': 'STOP', 'avg_logprobs': -0.3540656566619873, 'model_name': 'gemini-2.5-pro'} id='run--67ec20f5-7d00-4ad6-9a4b-2c6fa95472f3-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/admin_scripts/tests.py', 'start_line': 2505.0, 'end_line': 3005.0}, 'id': 'f77093fc-e308-43ae-ab4d-2f17d0878462', 'type': 'tool_call'}, {'name': 'find_file_node_with_relative_path', 'args': {'relative_path': './'}, 'id': 'cb601b97-c587-40fc-9616-cf4ce9557dd2', 'type': 'tool_call'}] usage_metadata={'input_tokens': 42046, 'output_tokens': 44, 'total_tokens': 42363, 'input_token_details': {'cache_read': 34505}, 'output_token_details': {'reasoning': 273}}
2025-12-21 20:07:02,587 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"end_line": 3506.0, "start_line": 3006.0, "relative_path": "tests/admin_scripts/tests.py"}'}, '__gemini_function_call_thought_signatures__': {'fc59c4a8-0723-4960-9e57-b04617c345da': 'CpgGAY89a1/HidGh5xUFA1rdVpl4UqBiNW+gtsuywqdv5moXyXXl2K5VUyGgPqXVVe+mle4BLwd+ZP0Kex52eJpBSoVu7ezDHkBBudyBA1YmdgQQcDH4+Sbq4M13UXeGLkAycwFxwomQSOKa5zctP3LhV/UkkDk/RFgeXzmQKT7FNYi7nJJgj0iDRmnW+H0G2ecsvaXIXdlzq0CsOGUtIL3hg0qjBBaY/1QPUOB8xWz+UWWp7cxudRl7nsy0MlcvfaC/zRDOKShivBn1HZhNM8G/gL1L2cOGfmszbg+IWC1IsWAtv13shwbS0EOEp+tFWw/RC/tY3JMiXWDzsOirPk2JAfZL7hJAc5KKBgpfIZVR+rXkrawuhjNJWSEZW3OBVEYdbK01xC8yMc3RUDUcYY9DgIFP4tQNBLgm3m3pj5XUkBmWGTw4/cTsvF6hNCwVHmsLPHL72EeGmHI+X9pm3JJ5U3RasS77fhJ3jnekDY91GTjTDrnYA7iNZfOY26aQ7z4xgJt2FkRxPPqOZ7HgiNHIjuEKwhSbShApOY36X6m8owLgCZY1R0jBXYcYwCrIge6/JkDlFYgjxBj3GgMEAuf2krXh4cp5bmpY6+fi1cY6einG95z7vKJwG3iCqVM7pRljxUO7gSR5/qmirgJM+2/9RYTNfYl5UqtNZ5r3X3ZXaos88H+m6eqhOVNig3M1DY6yAHSrKLaCUhbPwILK7fQtnh7ZEoeRONqJCDrSrxhPeFSvvnSBHZY7PW85I6b9qjLwwVrCaC3bQ0LPifwChjNAjn32OUd0kA6dGIvmt6N1h7xCz4GgmSc+ZSRTRs1jAo5Q5e4o4DNLVUBrYa13PqAwv4U83Xag+W8BcpNTg/oGIRYT14tEQmeI7LXD78D4/wt8t877DpthfTqaaM8PtvRm074MXbLAc8h+cJ8B6r4fvBggoWcJu+VE91CFYTWiYAdKAiAzAc3eQYjhBeN6JjXZHQTu9Sw9O6s0P3bLctdTO5GhNnp31bIpZasIpzxYPustNe5xjirnO9wsaUTuEUaUsUKGoPPXwwmn'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 50488, 'candidates_token_count': 29, 'total_token_count': 50709, 'cached_content_token_count': 42329, 'prompt_tokens_details': [{'modality': 1, 'token_count': 52063}], 'cache_tokens_details': [{'modality': 1, 'token_count': 42329}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 29}], 'thoughts_token_count': 192}, 'finish_reason': 'STOP', 'avg_logprobs': -0.560971029873552, 'model_name': 'gemini-2.5-pro'} id='run--a59006bf-d18c-49f5-bf35-4bdbbb0306b7-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'end_line': 3506.0, 'start_line': 3006.0, 'relative_path': 'tests/admin_scripts/tests.py'}, 'id': 'fc59c4a8-0723-4960-9e57-b04617c345da', 'type': 'tool_call'}] usage_metadata={'input_tokens': 50488, 'output_tokens': 29, 'total_tokens': 50709, 'input_token_details': {'cache_read': 42329}, 'output_token_details': {'reasoning': 192}}
2025-12-21 20:07:06,866 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the full content of `tests/admin_scripts/tests.py` as requested. I was unable to find any Python files in the `tests/admin_scripts/management/commands/` directory. It appears that this directory may be empty or does not exist in the provided codebase.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 51453, 'candidates_token_count': 62, 'total_token_count': 51789, 'cached_content_token_count': 51919, 'prompt_tokens_details': [{'modality': 1, 'token_count': 53220}], 'cache_tokens_details': [{'modality': 1, 'token_count': 51919}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 62}], 'thoughts_token_count': 274}, 'finish_reason': 'STOP', 'avg_logprobs': -0.5438601586126512, 'model_name': 'gemini-2.5-pro'} id='run--ba26d7d0-5332-4d57-86a0-06ba79126afa-0' usage_metadata={'input_tokens': 51453, 'output_tokens': 62, 'total_tokens': 51789, 'input_token_details': {'cache_read': 51919}, 'output_token_details': {'reasoning': 274}}
2025-12-21 20:07:06,870 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `tests/admin_scripts/tests.py` and all Python files inside `tests/admin_scripts/management/commands/`.
--- END QUERY ---



--- BEGIN PURPOSE ---
This will provide the necessary context to find test cases that cover command-line argument parsing with subparsers and their error handling.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/admin_scripts/tests.py
Line number range: 1 - 500
Content:
1. """
2. A series of tests to establish that the command-line management tools work as
3. advertised - especially with regards to the handling of the
4. DJANGO_SETTINGS_MODULE and default settings.py files.
5. """
6. import os
7. import re
8. import shutil
9. import socket
10. import stat
11. import subprocess
12. import sys
13. import tempfile
14. import unittest
15. from io import StringIO
16. from unittest import mock
17. 
18. from django import conf, get_version
19. from django.conf import settings
20. from django.core.management import (
21.     BaseCommand,
22.     CommandError,
23.     call_command,
24.     color,
25.     execute_from_command_line,
26. )
27. from django.core.management.commands.loaddata import Command as LoaddataCommand
28. from django.core.management.commands.runserver import Command as RunserverCommand
29. from django.core.management.commands.testserver import Command as TestserverCommand
30. from django.db import ConnectionHandler, connection
31. from django.db.migrations.recorder import MigrationRecorder
32. from django.test import LiveServerTestCase, SimpleTestCase, TestCase, override_settings
33. from django.test.utils import captured_stderr, captured_stdout
34. from django.urls import path
35. from django.views.static import serve
36. 
37. from . import urls
38. 
39. custom_templates_dir = os.path.join(os.path.dirname(__file__), "custom_templates")
40. 
41. SYSTEM_CHECK_MSG = "System check identified no issues"
42. 
43. HAS_BLACK = shutil.which("black")
44. 
45. 
46. class AdminScriptTestCase(SimpleTestCase):
47.     def setUp(self):
48.         tmpdir = tempfile.TemporaryDirectory()
49.         self.addCleanup(tmpdir.cleanup)
50.         # os.path.realpath() is required for temporary directories on macOS,
51.         # where `/var` is a symlink to `/private/var`.
52.         self.test_dir = os.path.realpath(os.path.join(tmpdir.name, "test_project"))
53.         os.mkdir(self.test_dir)
54. 
55.     def write_settings(self, filename, apps=None, is_dir=False, sdict=None, extra=None):
56.         if is_dir:
57.             settings_dir = os.path.join(self.test_dir, filename)
58.             os.mkdir(settings_dir)
59.             settings_file_path = os.path.join(settings_dir, "__init__.py")
60.         else:
61.             settings_file_path = os.path.join(self.test_dir, filename)
62. 
63.         with open(settings_file_path, "w") as settings_file:
64.             settings_file.write(
65.                 "# Settings file automatically generated by admin_scripts test case\n"
66.             )
67.             if extra:
68.                 settings_file.write("%s\n" % extra)
69.             exports = [
70.                 "DATABASES",
71.                 "DEFAULT_AUTO_FIELD",
72.                 "ROOT_URLCONF",
73.                 "SECRET_KEY",
74.                 "USE_TZ",
75.             ]
76.             for s in exports:
77.                 if hasattr(settings, s):
78.                     o = getattr(settings, s)
79.                     if not isinstance(o, (dict, tuple, list)):
80.                         o = "'%s'" % o
81.                     settings_file.write("%s = %s\n" % (s, o))
82. 
83.             if apps is None:
84.                 apps = [
85.                     "django.contrib.auth",
86.                     "django.contrib.contenttypes",
87.                     "admin_scripts",
88.                 ]
89. 
90.             settings_file.write("INSTALLED_APPS = %s\n" % apps)
91. 
92.             if sdict:
93.                 for k, v in sdict.items():
94.                     settings_file.write("%s = %s\n" % (k, v))
95. 
96.     def _ext_backend_paths(self):
97.         """
98.         Returns the paths for any external backend packages.
99.         """
100.         paths = []
101.         for backend in settings.DATABASES.values():
102.             package = backend["ENGINE"].split(".")[0]
103.             if package != "django":
104.                 backend_pkg = __import__(package)
105.                 backend_dir = os.path.dirname(backend_pkg.__file__)
106.                 paths.append(os.path.dirname(backend_dir))
107.         return paths
108. 
109.     def run_test(self, args, settings_file=None, apps=None, umask=-1):
110.         base_dir = os.path.dirname(self.test_dir)
111.         # The base dir for Django's tests is one level up.
112.         tests_dir = os.path.dirname(os.path.dirname(__file__))
113.         # The base dir for Django is one level above the test dir. We don't use
114.         # `import django` to figure that out, so we don't pick up a Django
115.         # from site-packages or similar.
116.         django_dir = os.path.dirname(tests_dir)
117.         ext_backend_base_dirs = self._ext_backend_paths()
118. 
119.         # Define a temporary environment for the subprocess
120.         test_environ = os.environ.copy()
121. 
122.         # Set the test environment
123.         if settings_file:
124.             test_environ["DJANGO_SETTINGS_MODULE"] = settings_file
125.         elif "DJANGO_SETTINGS_MODULE" in test_environ:
126.             del test_environ["DJANGO_SETTINGS_MODULE"]
127.         python_path = [base_dir, django_dir, tests_dir]
128.         python_path.extend(ext_backend_base_dirs)
129.         test_environ["PYTHONPATH"] = os.pathsep.join(python_path)
130.         test_environ["PYTHONWARNINGS"] = ""
131. 
132.         p = subprocess.run(
133.             [sys.executable, *args],
134.             capture_output=True,
135.             cwd=self.test_dir,
136.             env=test_environ,
137.             text=True,
138.             umask=umask,
139.         )
140.         return p.stdout, p.stderr
141. 
142.     def run_django_admin(self, args, settings_file=None, umask=-1):
143.         return self.run_test(["-m", "django", *args], settings_file, umask=umask)
144. 
145.     def run_manage(self, args, settings_file=None, manage_py=None):
146.         template_manage_py = (
147.             os.path.join(os.path.dirname(__file__), manage_py)
148.             if manage_py
149.             else os.path.join(
150.                 os.path.dirname(conf.__file__), "project_template", "manage.py-tpl"
151.             )
152.         )
153.         test_manage_py = os.path.join(self.test_dir, "manage.py")
154.         shutil.copyfile(template_manage_py, test_manage_py)
155. 
156.         with open(test_manage_py) as fp:
157.             manage_py_contents = fp.read()
158.         manage_py_contents = manage_py_contents.replace(
159.             "{{ project_name }}", "test_project"
160.         )
161.         with open(test_manage_py, "w") as fp:
162.             fp.write(manage_py_contents)
163. 
164.         return self.run_test(["./manage.py", *args], settings_file)
165. 
166.     def assertNoOutput(self, stream):
167.         "Utility assertion: assert that the given stream is empty"
168.         self.assertEqual(
169.             len(stream), 0, "Stream should be empty: actually contains '%s'" % stream
170.         )
171. 
172.     def assertOutput(self, stream, msg, regex=False):
173.         "Utility assertion: assert that the given message exists in the output"
174.         if regex:
175.             self.assertIsNotNone(
176.                 re.search(msg, stream),
177.                 "'%s' does not match actual output text '%s'" % (msg, stream),
178.             )
179.         else:
180.             self.assertIn(
181.                 msg,
182.                 stream,
183.                 "'%s' does not match actual output text '%s'" % (msg, stream),
184.             )
185. 
186.     def assertNotInOutput(self, stream, msg):
187.         "Utility assertion: assert that the given message doesn't exist in the output"
188.         self.assertNotIn(
189.             msg, stream, "'%s' matches actual output text '%s'" % (msg, stream)
190.         )
191. 
192. 
193. ##########################################################################
194. # DJANGO ADMIN TESTS
195. # This first series of test classes checks the environment processing
196. # of the django-admin.
197. ##########################################################################
198. 
199. 
200. class DjangoAdminNoSettings(AdminScriptTestCase):
201.     "A series of tests for django-admin when there is no settings.py file."
202. 
203.     def test_builtin_command(self):
204.         """
205.         no settings: django-admin builtin commands fail with an error when no
206.         settings provided.
207.         """
208.         args = ["check", "admin_scripts"]
209.         out, err = self.run_django_admin(args)
210.         self.assertNoOutput(out)
211.         self.assertOutput(err, "settings are not configured")
212. 
213.     def test_builtin_with_bad_settings(self):
214.         """
215.         no settings: django-admin builtin commands fail if settings file (from
216.         argument) doesn't exist.
217.         """
218.         args = ["check", "--settings=bad_settings", "admin_scripts"]
219.         out, err = self.run_django_admin(args)
220.         self.assertNoOutput(out)
221.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
222. 
223.     def test_builtin_with_bad_environment(self):
224.         """
225.         no settings: django-admin builtin commands fail if settings file (from
226.         environment) doesn't exist.
227.         """
228.         args = ["check", "admin_scripts"]
229.         out, err = self.run_django_admin(args, "bad_settings")
230.         self.assertNoOutput(out)
231.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
232. 
233.     def test_commands_with_invalid_settings(self):
234.         """
235.         Commands that don't require settings succeed if the settings file
236.         doesn't exist.
237.         """
238.         args = ["startproject"]
239.         out, err = self.run_django_admin(args, settings_file="bad_settings")
240.         self.assertNoOutput(out)
241.         self.assertOutput(err, "You must provide a project name", regex=True)
242. 
243. 
244. class DjangoAdminDefaultSettings(AdminScriptTestCase):
245.     """
246.     A series of tests for django-admin when using a settings.py file that
247.     contains the test application.
248.     """
249. 
250.     def setUp(self):
251.         super().setUp()
252.         self.write_settings("settings.py")
253. 
254.     def test_builtin_command(self):
255.         """
256.         default: django-admin builtin commands fail with an error when no
257.         settings provided.
258.         """
259.         args = ["check", "admin_scripts"]
260.         out, err = self.run_django_admin(args)
261.         self.assertNoOutput(out)
262.         self.assertOutput(err, "settings are not configured")
263. 
264.     def test_builtin_with_settings(self):
265.         """
266.         default: django-admin builtin commands succeed if settings are provided
267.         as argument.
268.         """
269.         args = ["check", "--settings=test_project.settings", "admin_scripts"]
270.         out, err = self.run_django_admin(args)
271.         self.assertNoOutput(err)
272.         self.assertOutput(out, SYSTEM_CHECK_MSG)
273. 
274.     def test_builtin_with_environment(self):
275.         """
276.         default: django-admin builtin commands succeed if settings are provided
277.         in the environment.
278.         """
279.         args = ["check", "admin_scripts"]
280.         out, err = self.run_django_admin(args, "test_project.settings")
281.         self.assertNoOutput(err)
282.         self.assertOutput(out, SYSTEM_CHECK_MSG)
283. 
284.     def test_builtin_with_bad_settings(self):
285.         """
286.         default: django-admin builtin commands fail if settings file (from
287.         argument) doesn't exist.
288.         """
289.         args = ["check", "--settings=bad_settings", "admin_scripts"]
290.         out, err = self.run_django_admin(args)
291.         self.assertNoOutput(out)
292.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
293. 
294.     def test_builtin_with_bad_environment(self):
295.         """
296.         default: django-admin builtin commands fail if settings file (from
297.         environment) doesn't exist.
298.         """
299.         args = ["check", "admin_scripts"]
300.         out, err = self.run_django_admin(args, "bad_settings")
301.         self.assertNoOutput(out)
302.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
303. 
304.     def test_custom_command(self):
305.         """
306.         default: django-admin can't execute user commands if it isn't provided
307.         settings.
308.         """
309.         args = ["noargs_command"]
310.         out, err = self.run_django_admin(args)
311.         self.assertNoOutput(out)
312.         self.assertOutput(err, "No Django settings specified")
313.         self.assertOutput(err, "Unknown command: 'noargs_command'")
314. 
315.     def test_custom_command_with_settings(self):
316.         """
317.         default: django-admin can execute user commands if settings are
318.         provided as argument.
319.         """
320.         args = ["noargs_command", "--settings=test_project.settings"]
321.         out, err = self.run_django_admin(args)
322.         self.assertNoOutput(err)
323.         self.assertOutput(out, "EXECUTE: noargs_command")
324. 
325.     def test_custom_command_with_environment(self):
326.         """
327.         default: django-admin can execute user commands if settings are
328.         provided in environment.
329.         """
330.         args = ["noargs_command"]
331.         out, err = self.run_django_admin(args, "test_project.settings")
332.         self.assertNoOutput(err)
333.         self.assertOutput(out, "EXECUTE: noargs_command")
334. 
335. 
336. class DjangoAdminFullPathDefaultSettings(AdminScriptTestCase):
337.     """
338.     A series of tests for django-admin when using a settings.py file that
339.     contains the test application specified using a full path.
340.     """
341. 
342.     def setUp(self):
343.         super().setUp()
344.         self.write_settings(
345.             "settings.py",
346.             [
347.                 "django.contrib.auth",
348.                 "django.contrib.contenttypes",
349.                 "admin_scripts",
350.                 "admin_scripts.complex_app",
351.             ],
352.         )
353. 
354.     def test_builtin_command(self):
355.         """
356.         fulldefault: django-admin builtin commands fail with an error when no
357.         settings provided.
358.         """
359.         args = ["check", "admin_scripts"]
360.         out, err = self.run_django_admin(args)
361.         self.assertNoOutput(out)
362.         self.assertOutput(err, "settings are not configured")
363. 
364.     def test_builtin_with_settings(self):
365.         """
366.         fulldefault: django-admin builtin commands succeed if a settings file
367.         is provided.
368.         """
369.         args = ["check", "--settings=test_project.settings", "admin_scripts"]
370.         out, err = self.run_django_admin(args)
371.         self.assertNoOutput(err)
372.         self.assertOutput(out, SYSTEM_CHECK_MSG)
373. 
374.     def test_builtin_with_environment(self):
375.         """
376.         fulldefault: django-admin builtin commands succeed if the environment
377.         contains settings.
378.         """
379.         args = ["check", "admin_scripts"]
380.         out, err = self.run_django_admin(args, "test_project.settings")
381.         self.assertNoOutput(err)
382.         self.assertOutput(out, SYSTEM_CHECK_MSG)
383. 
384.     def test_builtin_with_bad_settings(self):
385.         """
386.         fulldefault: django-admin builtin commands fail if settings file (from
387.         argument) doesn't exist.
388.         """
389.         args = ["check", "--settings=bad_settings", "admin_scripts"]
390.         out, err = self.run_django_admin(args)
391.         self.assertNoOutput(out)
392.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
393. 
394.     def test_builtin_with_bad_environment(self):
395.         """
396.         fulldefault: django-admin builtin commands fail if settings file (from
397.         environment) doesn't exist.
398.         """
399.         args = ["check", "admin_scripts"]
400.         out, err = self.run_django_admin(args, "bad_settings")
401.         self.assertNoOutput(out)
402.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
403. 
404.     def test_custom_command(self):
405.         """
406.         fulldefault: django-admin can't execute user commands unless settings
407.         are provided.
408.         """
409.         args = ["noargs_command"]
410.         out, err = self.run_django_admin(args)
411.         self.assertNoOutput(out)
412.         self.assertOutput(err, "No Django settings specified")
413.         self.assertOutput(err, "Unknown command: 'noargs_command'")
414. 
415.     def test_custom_command_with_settings(self):
416.         """
417.         fulldefault: django-admin can execute user commands if settings are
418.         provided as argument.
419.         """
420.         args = ["noargs_command", "--settings=test_project.settings"]
421.         out, err = self.run_django_admin(args)
422.         self.assertNoOutput(err)
423.         self.assertOutput(out, "EXECUTE: noargs_command")
424. 
425.     def test_custom_command_with_environment(self):
426.         """
427.         fulldefault: django-admin can execute user commands if settings are
428.         provided in environment.
429.         """
430.         args = ["noargs_command"]
431.         out, err = self.run_django_admin(args, "test_project.settings")
432.         self.assertNoOutput(err)
433.         self.assertOutput(out, "EXECUTE: noargs_command")
434. 
435. 
436. class DjangoAdminMinimalSettings(AdminScriptTestCase):
437.     """
438.     A series of tests for django-admin when using a settings.py file that
439.     doesn't contain the test application.
440.     """
441. 
442.     def setUp(self):
443.         super().setUp()
444.         self.write_settings(
445.             "settings.py", apps=["django.contrib.auth", "django.contrib.contenttypes"]
446.         )
447. 
448.     def test_builtin_command(self):
449.         """
450.         minimal: django-admin builtin commands fail with an error when no
451.         settings provided.
452.         """
453.         args = ["check", "admin_scripts"]
454.         out, err = self.run_django_admin(args)
455.         self.assertNoOutput(out)
456.         self.assertOutput(err, "settings are not configured")
457. 
458.     def test_builtin_with_settings(self):
459.         """
460.         minimal: django-admin builtin commands fail if settings are provided as
461.         argument.
462.         """
463.         args = ["check", "--settings=test_project.settings", "admin_scripts"]
464.         out, err = self.run_django_admin(args)
465.         self.assertNoOutput(out)
466.         self.assertOutput(err, "No installed app with label 'admin_scripts'.")
467. 
468.     def test_builtin_with_environment(self):
469.         """
470.         minimal: django-admin builtin commands fail if settings are provided in
471.         the environment.
472.         """
473.         args = ["check", "admin_scripts"]
474.         out, err = self.run_django_admin(args, "test_project.settings")
475.         self.assertNoOutput(out)
476.         self.assertOutput(err, "No installed app with label 'admin_scripts'.")
477. 
478.     def test_builtin_with_bad_settings(self):
479.         """
480.         minimal: django-admin builtin commands fail if settings file (from
481.         argument) doesn't exist.
482.         """
483.         args = ["check", "--settings=bad_settings", "admin_scripts"]
484.         out, err = self.run_django_admin(args)
485.         self.assertNoOutput(out)
486.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
487. 
488.     def test_builtin_with_bad_environment(self):
489.         """
490.         minimal: django-admin builtin commands fail if settings file (from
491.         environment) doesn't exist.
492.         """
493.         args = ["check", "admin_scripts"]
494.         out, err = self.run_django_admin(args, "bad_settings")
495.         self.assertNoOutput(out)
496.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
497. 
498.     def test_custom_command(self):
499.         "minimal: django-admin can't execute user commands unless settings are provided"
500.         args = ["noargs_command"]


File: tests/admin_scripts/tests.py
Line number range: 501 - 1001
Content:
501.         out, err = self.run_django_admin(args)
502.         self.assertNoOutput(out)
503.         self.assertOutput(err, "No Django settings specified")
504.         self.assertOutput(err, "Unknown command: 'noargs_command'")
505. 
506.     def test_custom_command_with_settings(self):
507.         """
508.         minimal: django-admin can't execute user commands, even if settings are
509.         provided as argument.
510.         """
511.         args = ["noargs_command", "--settings=test_project.settings"]
512.         out, err = self.run_django_admin(args)
513.         self.assertNoOutput(out)
514.         self.assertOutput(err, "Unknown command: 'noargs_command'")
515. 
516.     def test_custom_command_with_environment(self):
517.         """
518.         minimal: django-admin can't execute user commands, even if settings are
519.         provided in environment.
520.         """
521.         args = ["noargs_command"]
522.         out, err = self.run_django_admin(args, "test_project.settings")
523.         self.assertNoOutput(out)
524.         self.assertOutput(err, "Unknown command: 'noargs_command'")
525. 
526. 
527. class DjangoAdminAlternateSettings(AdminScriptTestCase):
528.     """
529.     A series of tests for django-admin when using a settings file with a name
530.     other than 'settings.py'.
531.     """
532. 
533.     def setUp(self):
534.         super().setUp()
535.         self.write_settings("alternate_settings.py")
536. 
537.     def test_builtin_command(self):
538.         """
539.         alternate: django-admin builtin commands fail with an error when no
540.         settings provided.
541.         """
542.         args = ["check", "admin_scripts"]
543.         out, err = self.run_django_admin(args)
544.         self.assertNoOutput(out)
545.         self.assertOutput(err, "settings are not configured")
546. 
547.     def test_builtin_with_settings(self):
548.         """
549.         alternate: django-admin builtin commands succeed if settings are
550.         provided as argument.
551.         """
552.         args = ["check", "--settings=test_project.alternate_settings", "admin_scripts"]
553.         out, err = self.run_django_admin(args)
554.         self.assertNoOutput(err)
555.         self.assertOutput(out, SYSTEM_CHECK_MSG)
556. 
557.     def test_builtin_with_environment(self):
558.         """
559.         alternate: django-admin builtin commands succeed if settings are
560.         provided in the environment.
561.         """
562.         args = ["check", "admin_scripts"]
563.         out, err = self.run_django_admin(args, "test_project.alternate_settings")
564.         self.assertNoOutput(err)
565.         self.assertOutput(out, SYSTEM_CHECK_MSG)
566. 
567.     def test_builtin_with_bad_settings(self):
568.         """
569.         alternate: django-admin builtin commands fail if settings file (from
570.         argument) doesn't exist.
571.         """
572.         args = ["check", "--settings=bad_settings", "admin_scripts"]
573.         out, err = self.run_django_admin(args)
574.         self.assertNoOutput(out)
575.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
576. 
577.     def test_builtin_with_bad_environment(self):
578.         """
579.         alternate: django-admin builtin commands fail if settings file (from
580.         environment) doesn't exist.
581.         """
582.         args = ["check", "admin_scripts"]
583.         out, err = self.run_django_admin(args, "bad_settings")
584.         self.assertNoOutput(out)
585.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
586. 
587.     def test_custom_command(self):
588.         """
589.         alternate: django-admin can't execute user commands unless settings
590.         are provided.
591.         """
592.         args = ["noargs_command"]
593.         out, err = self.run_django_admin(args)
594.         self.assertNoOutput(out)
595.         self.assertOutput(err, "No Django settings specified")
596.         self.assertOutput(err, "Unknown command: 'noargs_command'")
597. 
598.     def test_custom_command_with_settings(self):
599.         """
600.         alternate: django-admin can execute user commands if settings are
601.         provided as argument.
602.         """
603.         args = ["noargs_command", "--settings=test_project.alternate_settings"]
604.         out, err = self.run_django_admin(args)
605.         self.assertNoOutput(err)
606.         self.assertOutput(out, "EXECUTE: noargs_command")
607. 
608.     def test_custom_command_with_environment(self):
609.         """
610.         alternate: django-admin can execute user commands if settings are
611.         provided in environment.
612.         """
613.         args = ["noargs_command"]
614.         out, err = self.run_django_admin(args, "test_project.alternate_settings")
615.         self.assertNoOutput(err)
616.         self.assertOutput(out, "EXECUTE: noargs_command")
617. 
618. 
619. class DjangoAdminMultipleSettings(AdminScriptTestCase):
620.     """
621.     A series of tests for django-admin when multiple settings files
622.     (including the default 'settings.py') are available. The default settings
623.     file is insufficient for performing the operations described, so the
624.     alternate settings must be used by the running script.
625.     """
626. 
627.     def setUp(self):
628.         super().setUp()
629.         self.write_settings(
630.             "settings.py", apps=["django.contrib.auth", "django.contrib.contenttypes"]
631.         )
632.         self.write_settings("alternate_settings.py")
633. 
634.     def test_builtin_command(self):
635.         """
636.         alternate: django-admin builtin commands fail with an error when no
637.         settings provided.
638.         """
639.         args = ["check", "admin_scripts"]
640.         out, err = self.run_django_admin(args)
641.         self.assertNoOutput(out)
642.         self.assertOutput(err, "settings are not configured")
643. 
644.     def test_builtin_with_settings(self):
645.         """
646.         alternate: django-admin builtin commands succeed if settings are
647.         provided as argument.
648.         """
649.         args = ["check", "--settings=test_project.alternate_settings", "admin_scripts"]
650.         out, err = self.run_django_admin(args)
651.         self.assertNoOutput(err)
652.         self.assertOutput(out, SYSTEM_CHECK_MSG)
653. 
654.     def test_builtin_with_environment(self):
655.         """
656.         alternate: django-admin builtin commands succeed if settings are
657.         provided in the environment.
658.         """
659.         args = ["check", "admin_scripts"]
660.         out, err = self.run_django_admin(args, "test_project.alternate_settings")
661.         self.assertNoOutput(err)
662.         self.assertOutput(out, SYSTEM_CHECK_MSG)
663. 
664.     def test_builtin_with_bad_settings(self):
665.         """
666.         alternate: django-admin builtin commands fail if settings file (from
667.         argument) doesn't exist.
668.         """
669.         args = ["check", "--settings=bad_settings", "admin_scripts"]
670.         out, err = self.run_django_admin(args)
671.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
672. 
673.     def test_builtin_with_bad_environment(self):
674.         """
675.         alternate: django-admin builtin commands fail if settings file (from
676.         environment) doesn't exist.
677.         """
678.         args = ["check", "admin_scripts"]
679.         out, err = self.run_django_admin(args, "bad_settings")
680.         self.assertNoOutput(out)
681.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
682. 
683.     def test_custom_command(self):
684.         """
685.         alternate: django-admin can't execute user commands unless settings are
686.         provided.
687.         """
688.         args = ["noargs_command"]
689.         out, err = self.run_django_admin(args)
690.         self.assertNoOutput(out)
691.         self.assertOutput(err, "No Django settings specified")
692.         self.assertOutput(err, "Unknown command: 'noargs_command'")
693. 
694.     def test_custom_command_with_settings(self):
695.         """
696.         alternate: django-admin can execute user commands if settings are
697.         provided as argument.
698.         """
699.         args = ["noargs_command", "--settings=test_project.alternate_settings"]
700.         out, err = self.run_django_admin(args)
701.         self.assertNoOutput(err)
702.         self.assertOutput(out, "EXECUTE: noargs_command")
703. 
704.     def test_custom_command_with_environment(self):
705.         """
706.         alternate: django-admin can execute user commands if settings are
707.         provided in environment.
708.         """
709.         args = ["noargs_command"]
710.         out, err = self.run_django_admin(args, "test_project.alternate_settings")
711.         self.assertNoOutput(err)
712.         self.assertOutput(out, "EXECUTE: noargs_command")
713. 
714. 
715. class DjangoAdminSettingsDirectory(AdminScriptTestCase):
716.     """
717.     A series of tests for django-admin when the settings file is in a
718.     directory. (see #9751).
719.     """
720. 
721.     def setUp(self):
722.         super().setUp()
723.         self.write_settings("settings", is_dir=True)
724. 
725.     def test_setup_environ(self):
726.         "directory: startapp creates the correct directory"
727.         args = ["startapp", "settings_test"]
728.         app_path = os.path.join(self.test_dir, "settings_test")
729.         out, err = self.run_django_admin(args, "test_project.settings")
730.         self.assertNoOutput(err)
731.         self.assertTrue(os.path.exists(app_path))
732.         with open(os.path.join(app_path, "apps.py")) as f:
733.             content = f.read()
734.             self.assertIn("class SettingsTestConfig(AppConfig)", content)
735.             self.assertIn(
736.                 'name = "settings_test"' if HAS_BLACK else "name = 'settings_test'",
737.                 content,
738.             )
739. 
740.     def test_setup_environ_custom_template(self):
741.         "directory: startapp creates the correct directory with a custom template"
742.         template_path = os.path.join(custom_templates_dir, "app_template")
743.         args = ["startapp", "--template", template_path, "custom_settings_test"]
744.         app_path = os.path.join(self.test_dir, "custom_settings_test")
745.         out, err = self.run_django_admin(args, "test_project.settings")
746.         self.assertNoOutput(err)
747.         self.assertTrue(os.path.exists(app_path))
748.         self.assertTrue(os.path.exists(os.path.join(app_path, "api.py")))
749. 
750.     def test_startapp_unicode_name(self):
751.         """startapp creates the correct directory with Unicode characters."""
752.         args = ["startapp", "こんにちは"]
753.         app_path = os.path.join(self.test_dir, "こんにちは")
754.         out, err = self.run_django_admin(args, "test_project.settings")
755.         self.assertNoOutput(err)
756.         self.assertTrue(os.path.exists(app_path))
757.         with open(os.path.join(app_path, "apps.py"), encoding="utf8") as f:
758.             content = f.read()
759.             self.assertIn("class こんにちはConfig(AppConfig)", content)
760.             self.assertIn('name = "こんにちは"' if HAS_BLACK else "name = 'こんにちは'", content)
761. 
762.     def test_builtin_command(self):
763.         """
764.         directory: django-admin builtin commands fail with an error when no
765.         settings provided.
766.         """
767.         args = ["check", "admin_scripts"]
768.         out, err = self.run_django_admin(args)
769.         self.assertNoOutput(out)
770.         self.assertOutput(err, "settings are not configured")
771. 
772.     def test_builtin_with_bad_settings(self):
773.         """
774.         directory: django-admin builtin commands fail if settings file (from
775.         argument) doesn't exist.
776.         """
777.         args = ["check", "--settings=bad_settings", "admin_scripts"]
778.         out, err = self.run_django_admin(args)
779.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
780. 
781.     def test_builtin_with_bad_environment(self):
782.         """
783.         directory: django-admin builtin commands fail if settings file (from
784.         environment) doesn't exist.
785.         """
786.         args = ["check", "admin_scripts"]
787.         out, err = self.run_django_admin(args, "bad_settings")
788.         self.assertNoOutput(out)
789.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
790. 
791.     def test_custom_command(self):
792.         """
793.         directory: django-admin can't execute user commands unless settings are
794.         provided.
795.         """
796.         args = ["noargs_command"]
797.         out, err = self.run_django_admin(args)
798.         self.assertNoOutput(out)
799.         self.assertOutput(err, "No Django settings specified")
800.         self.assertOutput(err, "Unknown command: 'noargs_command'")
801. 
802.     def test_builtin_with_settings(self):
803.         """
804.         directory: django-admin builtin commands succeed if settings are
805.         provided as argument.
806.         """
807.         args = ["check", "--settings=test_project.settings", "admin_scripts"]
808.         out, err = self.run_django_admin(args)
809.         self.assertNoOutput(err)
810.         self.assertOutput(out, SYSTEM_CHECK_MSG)
811. 
812.     def test_builtin_with_environment(self):
813.         """
814.         directory: django-admin builtin commands succeed if settings are
815.         provided in the environment.
816.         """
817.         args = ["check", "admin_scripts"]
818.         out, err = self.run_django_admin(args, "test_project.settings")
819.         self.assertNoOutput(err)
820.         self.assertOutput(out, SYSTEM_CHECK_MSG)
821. 
822. 
823. ##########################################################################
824. # MANAGE.PY TESTS
825. # This next series of test classes checks the environment processing
826. # of the generated manage.py script
827. ##########################################################################
828. 
829. 
830. class ManageManuallyConfiguredSettings(AdminScriptTestCase):
831.     """Customized manage.py calling settings.configure()."""
832. 
833.     def test_non_existent_command_output(self):
834.         out, err = self.run_manage(
835.             ["invalid_command"], manage_py="configured_settings_manage.py"
836.         )
837.         self.assertNoOutput(out)
838.         self.assertOutput(err, "Unknown command: 'invalid_command'")
839.         self.assertNotInOutput(err, "No Django settings specified")
840. 
841. 
842. class ManageNoSettings(AdminScriptTestCase):
843.     "A series of tests for manage.py when there is no settings.py file."
844. 
845.     def test_builtin_command(self):
846.         """
847.         no settings: manage.py builtin commands fail with an error when no
848.         settings provided.
849.         """
850.         args = ["check", "admin_scripts"]
851.         out, err = self.run_manage(args)
852.         self.assertNoOutput(out)
853.         self.assertOutput(
854.             err, r"No module named '?(test_project\.)?settings'?", regex=True
855.         )
856. 
857.     def test_builtin_with_bad_settings(self):
858.         """
859.         no settings: manage.py builtin commands fail if settings file (from
860.         argument) doesn't exist.
861.         """
862.         args = ["check", "--settings=bad_settings", "admin_scripts"]
863.         out, err = self.run_manage(args)
864.         self.assertNoOutput(out)
865.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
866. 
867.     def test_builtin_with_bad_environment(self):
868.         """
869.         no settings: manage.py builtin commands fail if settings file (from
870.         environment) doesn't exist.
871.         """
872.         args = ["check", "admin_scripts"]
873.         out, err = self.run_manage(args, "bad_settings")
874.         self.assertNoOutput(out)
875.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
876. 
877. 
878. class ManageDefaultSettings(AdminScriptTestCase):
879.     """A series of tests for manage.py when using a settings.py file that
880.     contains the test application.
881.     """
882. 
883.     def setUp(self):
884.         super().setUp()
885.         self.write_settings("settings.py")
886. 
887.     def test_builtin_command(self):
888.         """
889.         default: manage.py builtin commands succeed when default settings are
890.         appropriate.
891.         """
892.         args = ["check", "admin_scripts"]
893.         out, err = self.run_manage(args)
894.         self.assertNoOutput(err)
895.         self.assertOutput(out, SYSTEM_CHECK_MSG)
896. 
897.     def test_builtin_with_settings(self):
898.         """
899.         default: manage.py builtin commands succeed if settings are provided as
900.         argument.
901.         """
902.         args = ["check", "--settings=test_project.settings", "admin_scripts"]
903.         out, err = self.run_manage(args)
904.         self.assertNoOutput(err)
905.         self.assertOutput(out, SYSTEM_CHECK_MSG)
906. 
907.     def test_builtin_with_environment(self):
908.         """
909.         default: manage.py builtin commands succeed if settings are provided in
910.         the environment.
911.         """
912.         args = ["check", "admin_scripts"]
913.         out, err = self.run_manage(args, "test_project.settings")
914.         self.assertNoOutput(err)
915.         self.assertOutput(out, SYSTEM_CHECK_MSG)
916. 
917.     def test_builtin_with_bad_settings(self):
918.         """
919.         default: manage.py builtin commands succeed if settings file (from
920.         argument) doesn't exist.
921.         """
922.         args = ["check", "--settings=bad_settings", "admin_scripts"]
923.         out, err = self.run_manage(args)
924.         self.assertNoOutput(out)
925.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
926. 
927.     def test_builtin_with_bad_environment(self):
928.         """
929.         default: manage.py builtin commands fail if settings file (from
930.         environment) doesn't exist.
931.         """
932.         args = ["check", "admin_scripts"]
933.         out, err = self.run_manage(args, "bad_settings")
934.         self.assertNoOutput(out)
935.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
936. 
937.     def test_custom_command(self):
938.         """
939.         default: manage.py can execute user commands when default settings are
940.         appropriate.
941.         """
942.         args = ["noargs_command"]
943.         out, err = self.run_manage(args)
944.         self.assertNoOutput(err)
945.         self.assertOutput(out, "EXECUTE: noargs_command")
946. 
947.     def test_custom_command_with_settings(self):
948.         """
949.         default: manage.py can execute user commands when settings are provided
950.         as argument.
951.         """
952.         args = ["noargs_command", "--settings=test_project.settings"]
953.         out, err = self.run_manage(args)
954.         self.assertNoOutput(err)
955.         self.assertOutput(out, "EXECUTE: noargs_command")
956. 
957.     def test_custom_command_with_environment(self):
958.         """
959.         default: manage.py can execute user commands when settings are provided
960.         in environment.
961.         """
962.         args = ["noargs_command"]
963.         out, err = self.run_manage(args, "test_project.settings")
964.         self.assertNoOutput(err)
965.         self.assertOutput(out, "EXECUTE: noargs_command")
966. 
967. 
968. class ManageFullPathDefaultSettings(AdminScriptTestCase):
969.     """A series of tests for manage.py when using a settings.py file that
970.     contains the test application specified using a full path.
971.     """
972. 
973.     def setUp(self):
974.         super().setUp()
975.         self.write_settings(
976.             "settings.py",
977.             ["django.contrib.auth", "django.contrib.contenttypes", "admin_scripts"],
978.         )
979. 
980.     def test_builtin_command(self):
981.         """
982.         fulldefault: manage.py builtin commands succeed when default settings
983.         are appropriate.
984.         """
985.         args = ["check", "admin_scripts"]
986.         out, err = self.run_manage(args)
987.         self.assertNoOutput(err)
988.         self.assertOutput(out, SYSTEM_CHECK_MSG)
989. 
990.     def test_builtin_with_settings(self):
991.         """
992.         fulldefault: manage.py builtin commands succeed if settings are
993.         provided as argument.
994.         """
995.         args = ["check", "--settings=test_project.settings", "admin_scripts"]
996.         out, err = self.run_manage(args)
997.         self.assertNoOutput(err)
998.         self.assertOutput(out, SYSTEM_CHECK_MSG)
999. 
1000.     def test_builtin_with_environment(self):
1001.         """


File: tests/admin_scripts/tests.py
Line number range: 1002 - 1502
Content:
1002.         fulldefault: manage.py builtin commands succeed if settings are
1003.         provided in the environment.
1004.         """
1005.         args = ["check", "admin_scripts"]
1006.         out, err = self.run_manage(args, "test_project.settings")
1007.         self.assertNoOutput(err)
1008.         self.assertOutput(out, SYSTEM_CHECK_MSG)
1009. 
1010.     def test_builtin_with_bad_settings(self):
1011.         """
1012.         fulldefault: manage.py builtin commands succeed if settings file (from
1013.         argument) doesn't exist.
1014.         """
1015.         args = ["check", "--settings=bad_settings", "admin_scripts"]
1016.         out, err = self.run_manage(args)
1017.         self.assertNoOutput(out)
1018.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
1019. 
1020.     def test_builtin_with_bad_environment(self):
1021.         """
1022.         fulldefault: manage.py builtin commands fail if settings file (from
1023.         environment) doesn't exist.
1024.         """
1025.         args = ["check", "admin_scripts"]
1026.         out, err = self.run_manage(args, "bad_settings")
1027.         self.assertNoOutput(out)
1028.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
1029. 
1030.     def test_custom_command(self):
1031.         """
1032.         fulldefault: manage.py can execute user commands when default settings
1033.         are appropriate.
1034.         """
1035.         args = ["noargs_command"]
1036.         out, err = self.run_manage(args)
1037.         self.assertNoOutput(err)
1038.         self.assertOutput(out, "EXECUTE: noargs_command")
1039. 
1040.     def test_custom_command_with_settings(self):
1041.         """
1042.         fulldefault: manage.py can execute user commands when settings are
1043.         provided as argument.
1044.         """
1045.         args = ["noargs_command", "--settings=test_project.settings"]
1046.         out, err = self.run_manage(args)
1047.         self.assertNoOutput(err)
1048.         self.assertOutput(out, "EXECUTE: noargs_command")
1049. 
1050.     def test_custom_command_with_environment(self):
1051.         """
1052.         fulldefault: manage.py can execute user commands when settings are
1053.         provided in environment.
1054.         """
1055.         args = ["noargs_command"]
1056.         out, err = self.run_manage(args, "test_project.settings")
1057.         self.assertNoOutput(err)
1058.         self.assertOutput(out, "EXECUTE: noargs_command")
1059. 
1060. 
1061. class ManageMinimalSettings(AdminScriptTestCase):
1062.     """A series of tests for manage.py when using a settings.py file that
1063.     doesn't contain the test application.
1064.     """
1065. 
1066.     def setUp(self):
1067.         super().setUp()
1068.         self.write_settings(
1069.             "settings.py", apps=["django.contrib.auth", "django.contrib.contenttypes"]
1070.         )
1071. 
1072.     def test_builtin_command(self):
1073.         """
1074.         minimal: manage.py builtin commands fail with an error when no settings
1075.         provided.
1076.         """
1077.         args = ["check", "admin_scripts"]
1078.         out, err = self.run_manage(args)
1079.         self.assertNoOutput(out)
1080.         self.assertOutput(err, "No installed app with label 'admin_scripts'.")
1081. 
1082.     def test_builtin_with_settings(self):
1083.         "minimal: manage.py builtin commands fail if settings are provided as argument"
1084.         args = ["check", "--settings=test_project.settings", "admin_scripts"]
1085.         out, err = self.run_manage(args)
1086.         self.assertNoOutput(out)
1087.         self.assertOutput(err, "No installed app with label 'admin_scripts'.")
1088. 
1089.     def test_builtin_with_environment(self):
1090.         """
1091.         minimal: manage.py builtin commands fail if settings are provided in
1092.         the environment.
1093.         """
1094.         args = ["check", "admin_scripts"]
1095.         out, err = self.run_manage(args, "test_project.settings")
1096.         self.assertNoOutput(out)
1097.         self.assertOutput(err, "No installed app with label 'admin_scripts'.")
1098. 
1099.     def test_builtin_with_bad_settings(self):
1100.         """
1101.         minimal: manage.py builtin commands fail if settings file (from
1102.         argument) doesn't exist.
1103.         """
1104.         args = ["check", "--settings=bad_settings", "admin_scripts"]
1105.         out, err = self.run_manage(args)
1106.         self.assertNoOutput(out)
1107.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
1108. 
1109.     def test_builtin_with_bad_environment(self):
1110.         """
1111.         minimal: manage.py builtin commands fail if settings file (from
1112.         environment) doesn't exist.
1113.         """
1114.         args = ["check", "admin_scripts"]
1115.         out, err = self.run_manage(args, "bad_settings")
1116.         self.assertNoOutput(out)
1117.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
1118. 
1119.     def test_custom_command(self):
1120.         "minimal: manage.py can't execute user commands without appropriate settings"
1121.         args = ["noargs_command"]
1122.         out, err = self.run_manage(args)
1123.         self.assertNoOutput(out)
1124.         self.assertOutput(err, "Unknown command: 'noargs_command'")
1125. 
1126.     def test_custom_command_with_settings(self):
1127.         """
1128.         minimal: manage.py can't execute user commands, even if settings are
1129.         provided as argument.
1130.         """
1131.         args = ["noargs_command", "--settings=test_project.settings"]
1132.         out, err = self.run_manage(args)
1133.         self.assertNoOutput(out)
1134.         self.assertOutput(err, "Unknown command: 'noargs_command'")
1135. 
1136.     def test_custom_command_with_environment(self):
1137.         """
1138.         minimal: manage.py can't execute user commands, even if settings are
1139.         provided in environment.
1140.         """
1141.         args = ["noargs_command"]
1142.         out, err = self.run_manage(args, "test_project.settings")
1143.         self.assertNoOutput(out)
1144.         self.assertOutput(err, "Unknown command: 'noargs_command'")
1145. 
1146. 
1147. class ManageAlternateSettings(AdminScriptTestCase):
1148.     """A series of tests for manage.py when using a settings file
1149.     with a name other than 'settings.py'.
1150.     """
1151. 
1152.     def setUp(self):
1153.         super().setUp()
1154.         self.write_settings("alternate_settings.py")
1155. 
1156.     def test_builtin_command(self):
1157.         """
1158.         alternate: manage.py builtin commands fail with an error when no
1159.         default settings provided.
1160.         """
1161.         args = ["check", "admin_scripts"]
1162.         out, err = self.run_manage(args)
1163.         self.assertNoOutput(out)
1164.         self.assertOutput(
1165.             err, r"No module named '?(test_project\.)?settings'?", regex=True
1166.         )
1167. 
1168.     def test_builtin_with_settings(self):
1169.         "alternate: manage.py builtin commands work with settings provided as argument"
1170.         args = ["check", "--settings=alternate_settings", "admin_scripts"]
1171.         out, err = self.run_manage(args)
1172.         self.assertOutput(out, SYSTEM_CHECK_MSG)
1173.         self.assertNoOutput(err)
1174. 
1175.     def test_builtin_with_environment(self):
1176.         """
1177.         alternate: manage.py builtin commands work if settings are provided in
1178.         the environment
1179.         """
1180.         args = ["check", "admin_scripts"]
1181.         out, err = self.run_manage(args, "alternate_settings")
1182.         self.assertOutput(out, SYSTEM_CHECK_MSG)
1183.         self.assertNoOutput(err)
1184. 
1185.     def test_builtin_with_bad_settings(self):
1186.         """
1187.         alternate: manage.py builtin commands fail if settings file (from
1188.         argument) doesn't exist.
1189.         """
1190.         args = ["check", "--settings=bad_settings", "admin_scripts"]
1191.         out, err = self.run_manage(args)
1192.         self.assertNoOutput(out)
1193.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
1194. 
1195.     def test_builtin_with_bad_environment(self):
1196.         """
1197.         alternate: manage.py builtin commands fail if settings file (from
1198.         environment) doesn't exist
1199.         """
1200.         args = ["check", "admin_scripts"]
1201.         out, err = self.run_manage(args, "bad_settings")
1202.         self.assertNoOutput(out)
1203.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
1204. 
1205.     def test_custom_command(self):
1206.         "alternate: manage.py can't execute user commands without settings"
1207.         args = ["noargs_command"]
1208.         out, err = self.run_manage(args)
1209.         self.assertNoOutput(out)
1210.         self.assertOutput(
1211.             err, r"No module named '?(test_project\.)?settings'?", regex=True
1212.         )
1213. 
1214.     def test_custom_command_with_settings(self):
1215.         """
1216.         alternate: manage.py can execute user commands if settings are provided
1217.         as argument
1218.         """
1219.         args = ["noargs_command", "--settings=alternate_settings"]
1220.         out, err = self.run_manage(args)
1221.         self.assertOutput(
1222.             out,
1223.             "EXECUTE: noargs_command options=[('force_color', False), "
1224.             "('no_color', False), ('pythonpath', None), ('settings', "
1225.             "'alternate_settings'), ('traceback', False), ('verbosity', 1)]",
1226.         )
1227.         self.assertNoOutput(err)
1228. 
1229.     def test_custom_command_with_environment(self):
1230.         """
1231.         alternate: manage.py can execute user commands if settings are provided
1232.         in environment.
1233.         """
1234.         args = ["noargs_command"]
1235.         out, err = self.run_manage(args, "alternate_settings")
1236.         self.assertOutput(
1237.             out,
1238.             "EXECUTE: noargs_command options=[('force_color', False), "
1239.             "('no_color', False), ('pythonpath', None), ('settings', None), "
1240.             "('traceback', False), ('verbosity', 1)]",
1241.         )
1242.         self.assertNoOutput(err)
1243. 
1244.     def test_custom_command_output_color(self):
1245.         """
1246.         alternate: manage.py output syntax color can be deactivated with the
1247.         `--no-color` option.
1248.         """
1249.         args = ["noargs_command", "--no-color", "--settings=alternate_settings"]
1250.         out, err = self.run_manage(args)
1251.         self.assertOutput(
1252.             out,
1253.             "EXECUTE: noargs_command options=[('force_color', False), "
1254.             "('no_color', True), ('pythonpath', None), ('settings', "
1255.             "'alternate_settings'), ('traceback', False), ('verbosity', 1)]",
1256.         )
1257.         self.assertNoOutput(err)
1258. 
1259. 
1260. class ManageMultipleSettings(AdminScriptTestCase):
1261.     """A series of tests for manage.py when multiple settings files
1262.     (including the default 'settings.py') are available. The default settings
1263.     file is insufficient for performing the operations described, so the
1264.     alternate settings must be used by the running script.
1265.     """
1266. 
1267.     def setUp(self):
1268.         super().setUp()
1269.         self.write_settings(
1270.             "settings.py", apps=["django.contrib.auth", "django.contrib.contenttypes"]
1271.         )
1272.         self.write_settings("alternate_settings.py")
1273. 
1274.     def test_builtin_command(self):
1275.         """
1276.         multiple: manage.py builtin commands fail with an error when no
1277.         settings provided.
1278.         """
1279.         args = ["check", "admin_scripts"]
1280.         out, err = self.run_manage(args)
1281.         self.assertNoOutput(out)
1282.         self.assertOutput(err, "No installed app with label 'admin_scripts'.")
1283. 
1284.     def test_builtin_with_settings(self):
1285.         """
1286.         multiple: manage.py builtin commands succeed if settings are provided
1287.         as argument.
1288.         """
1289.         args = ["check", "--settings=alternate_settings", "admin_scripts"]
1290.         out, err = self.run_manage(args)
1291.         self.assertNoOutput(err)
1292.         self.assertOutput(out, SYSTEM_CHECK_MSG)
1293. 
1294.     def test_builtin_with_environment(self):
1295.         """
1296.         multiple: manage.py can execute builtin commands if settings are
1297.         provided in the environment.
1298.         """
1299.         args = ["check", "admin_scripts"]
1300.         out, err = self.run_manage(args, "alternate_settings")
1301.         self.assertNoOutput(err)
1302.         self.assertOutput(out, SYSTEM_CHECK_MSG)
1303. 
1304.     def test_builtin_with_bad_settings(self):
1305.         """
1306.         multiple: manage.py builtin commands fail if settings file (from
1307.         argument) doesn't exist.
1308.         """
1309.         args = ["check", "--settings=bad_settings", "admin_scripts"]
1310.         out, err = self.run_manage(args)
1311.         self.assertNoOutput(out)
1312.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
1313. 
1314.     def test_builtin_with_bad_environment(self):
1315.         """
1316.         multiple: manage.py builtin commands fail if settings file (from
1317.         environment) doesn't exist.
1318.         """
1319.         args = ["check", "admin_scripts"]
1320.         out, err = self.run_manage(args, "bad_settings")
1321.         self.assertNoOutput(out)
1322.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
1323. 
1324.     def test_custom_command(self):
1325.         "multiple: manage.py can't execute user commands using default settings"
1326.         args = ["noargs_command"]
1327.         out, err = self.run_manage(args)
1328.         self.assertNoOutput(out)
1329.         self.assertOutput(err, "Unknown command: 'noargs_command'")
1330. 
1331.     def test_custom_command_with_settings(self):
1332.         """
1333.         multiple: manage.py can execute user commands if settings are provided
1334.         as argument.
1335.         """
1336.         args = ["noargs_command", "--settings=alternate_settings"]
1337.         out, err = self.run_manage(args)
1338.         self.assertNoOutput(err)
1339.         self.assertOutput(out, "EXECUTE: noargs_command")
1340. 
1341.     def test_custom_command_with_environment(self):
1342.         """
1343.         multiple: manage.py can execute user commands if settings are provided
1344.         in environment.
1345.         """
1346.         args = ["noargs_command"]
1347.         out, err = self.run_manage(args, "alternate_settings")
1348.         self.assertNoOutput(err)
1349.         self.assertOutput(out, "EXECUTE: noargs_command")
1350. 
1351. 
1352. class ManageSettingsWithSettingsErrors(AdminScriptTestCase):
1353.     """
1354.     Tests for manage.py when using the default settings.py file containing
1355.     runtime errors.
1356.     """
1357. 
1358.     def write_settings_with_import_error(self, filename):
1359.         settings_file_path = os.path.join(self.test_dir, filename)
1360.         with open(settings_file_path, "w") as settings_file:
1361.             settings_file.write(
1362.                 "# Settings file automatically generated by admin_scripts test case\n"
1363.             )
1364.             settings_file.write(
1365.                 "# The next line will cause an import error:\nimport foo42bar\n"
1366.             )
1367. 
1368.     def test_import_error(self):
1369.         """
1370.         import error: manage.py builtin commands shows useful diagnostic info
1371.         when settings with import errors is provided (#14130).
1372.         """
1373.         self.write_settings_with_import_error("settings.py")
1374.         args = ["check", "admin_scripts"]
1375.         out, err = self.run_manage(args)
1376.         self.assertNoOutput(out)
1377.         self.assertOutput(err, "No module named")
1378.         self.assertOutput(err, "foo42bar")
1379. 
1380.     def test_attribute_error(self):
1381.         """
1382.         manage.py builtin commands does not swallow attribute error due to bad
1383.         settings (#18845).
1384.         """
1385.         self.write_settings("settings.py", sdict={"BAD_VAR": "INSTALLED_APPS.crash"})
1386.         args = ["collectstatic", "admin_scripts"]
1387.         out, err = self.run_manage(args)
1388.         self.assertNoOutput(out)
1389.         self.assertOutput(err, "AttributeError: 'list' object has no attribute 'crash'")
1390. 
1391.     def test_key_error(self):
1392.         self.write_settings("settings.py", sdict={"BAD_VAR": 'DATABASES["blah"]'})
1393.         args = ["collectstatic", "admin_scripts"]
1394.         out, err = self.run_manage(args)
1395.         self.assertNoOutput(out)
1396.         self.assertOutput(err, "KeyError: 'blah'")
1397. 
1398.     def test_help(self):
1399.         """
1400.         Test listing available commands output note when only core commands are
1401.         available.
1402.         """
1403.         self.write_settings(
1404.             "settings.py",
1405.             extra="from django.core.exceptions import ImproperlyConfigured\n"
1406.             "raise ImproperlyConfigured()",
1407.         )
1408.         args = ["help"]
1409.         out, err = self.run_manage(args)
1410.         self.assertOutput(out, "only Django core commands are listed")
1411.         self.assertNoOutput(err)
1412. 
1413. 
1414. class ManageCheck(AdminScriptTestCase):
1415.     def test_nonexistent_app(self):
1416.         """check reports an error on a nonexistent app in INSTALLED_APPS."""
1417.         self.write_settings(
1418.             "settings.py",
1419.             apps=["admin_scriptz.broken_app"],
1420.             sdict={"USE_I18N": False},
1421.         )
1422.         args = ["check"]
1423.         out, err = self.run_manage(args)
1424.         self.assertNoOutput(out)
1425.         self.assertOutput(err, "ModuleNotFoundError")
1426.         self.assertOutput(err, "No module named")
1427.         self.assertOutput(err, "admin_scriptz")
1428. 
1429.     def test_broken_app(self):
1430.         """manage.py check reports an ImportError if an app's models.py
1431.         raises one on import"""
1432. 
1433.         self.write_settings("settings.py", apps=["admin_scripts.broken_app"])
1434.         args = ["check"]
1435.         out, err = self.run_manage(args)
1436.         self.assertNoOutput(out)
1437.         self.assertOutput(err, "ImportError")
1438. 
1439.     def test_complex_app(self):
1440.         """manage.py check does not raise an ImportError validating a
1441.         complex app with nested calls to load_app"""
1442. 
1443.         self.write_settings(
1444.             "settings.py",
1445.             apps=[
1446.                 "admin_scripts.complex_app",
1447.                 "admin_scripts.simple_app",
1448.                 "django.contrib.admin.apps.SimpleAdminConfig",
1449.                 "django.contrib.auth",
1450.                 "django.contrib.contenttypes",
1451.                 "django.contrib.messages",
1452.             ],
1453.             sdict={
1454.                 "DEBUG": True,
1455.                 "MIDDLEWARE": [
1456.                     "django.contrib.messages.middleware.MessageMiddleware",
1457.                     "django.contrib.auth.middleware.AuthenticationMiddleware",
1458.                     "django.contrib.sessions.middleware.SessionMiddleware",
1459.                 ],
1460.                 "TEMPLATES": [
1461.                     {
1462.                         "BACKEND": "django.template.backends.django.DjangoTemplates",
1463.                         "DIRS": [],
1464.                         "APP_DIRS": True,
1465.                         "OPTIONS": {
1466.                             "context_processors": [
1467.                                 "django.template.context_processors.request",
1468.                                 "django.contrib.auth.context_processors.auth",
1469.                                 "django.contrib.messages.context_processors.messages",
1470.                             ],
1471.                         },
1472.                     },
1473.                 ],
1474.             },
1475.         )
1476.         args = ["check"]
1477.         out, err = self.run_manage(args)
1478.         self.assertNoOutput(err)
1479.         self.assertEqual(out, "System check identified no issues (0 silenced).\n")
1480. 
1481.     def test_app_with_import(self):
1482.         """manage.py check does not raise errors when an app imports a base
1483.         class that itself has an abstract base."""
1484. 
1485.         self.write_settings(
1486.             "settings.py",
1487.             apps=[
1488.                 "admin_scripts.app_with_import",
1489.                 "django.contrib.auth",
1490.                 "django.contrib.contenttypes",
1491.                 "django.contrib.sites",
1492.             ],
1493.             sdict={"DEBUG": True},
1494.         )
1495.         args = ["check"]
1496.         out, err = self.run_manage(args)
1497.         self.assertNoOutput(err)
1498.         self.assertEqual(out, "System check identified no issues (0 silenced).\n")
1499. 
1500.     def test_output_format(self):
1501.         """All errors/warnings should be sorted by level and by message."""


File: tests/admin_scripts/tests.py
Line number range: 1503 - 2003
Content:
1503.         self.write_settings(
1504.             "settings.py",
1505.             apps=[
1506.                 "admin_scripts.app_raising_messages",
1507.                 "django.contrib.auth",
1508.                 "django.contrib.contenttypes",
1509.             ],
1510.             sdict={"DEBUG": True},
1511.         )
1512.         args = ["check"]
1513.         out, err = self.run_manage(args)
1514.         expected_err = (
1515.             "SystemCheckError: System check identified some issues:\n"
1516.             "\n"
1517.             "ERRORS:\n"
1518.             "?: An error\n"
1519.             "\tHINT: Error hint\n"
1520.             "\n"
1521.             "WARNINGS:\n"
1522.             "a: Second warning\n"
1523.             "obj: First warning\n"
1524.             "\tHINT: Hint\n"
1525.             "\n"
1526.             "System check identified 3 issues (0 silenced).\n"
1527.         )
1528.         self.assertEqual(err, expected_err)
1529.         self.assertNoOutput(out)
1530. 
1531.     def test_warning_does_not_halt(self):
1532.         """
1533.         When there are only warnings or less serious messages, then Django
1534.         should not prevent user from launching their project, so `check`
1535.         command should not raise `CommandError` exception.
1536. 
1537.         In this test we also test output format.
1538.         """
1539. 
1540.         self.write_settings(
1541.             "settings.py",
1542.             apps=[
1543.                 "admin_scripts.app_raising_warning",
1544.                 "django.contrib.auth",
1545.                 "django.contrib.contenttypes",
1546.             ],
1547.             sdict={"DEBUG": True},
1548.         )
1549.         args = ["check"]
1550.         out, err = self.run_manage(args)
1551.         expected_err = (
1552.             "System check identified some issues:\n"  # No "CommandError: " part
1553.             "\n"
1554.             "WARNINGS:\n"
1555.             "?: A warning\n"
1556.             "\n"
1557.             "System check identified 1 issue (0 silenced).\n"
1558.         )
1559.         self.assertEqual(err, expected_err)
1560.         self.assertNoOutput(out)
1561. 
1562. 
1563. class ManageRunserver(SimpleTestCase):
1564.     def setUp(self):
1565.         def monkey_run(*args, **options):
1566.             return
1567. 
1568.         self.output = StringIO()
1569.         self.cmd = RunserverCommand(stdout=self.output)
1570.         self.cmd.run = monkey_run
1571. 
1572.     def assertServerSettings(self, addr, port, ipv6=False, raw_ipv6=False):
1573.         self.assertEqual(self.cmd.addr, addr)
1574.         self.assertEqual(self.cmd.port, port)
1575.         self.assertEqual(self.cmd.use_ipv6, ipv6)
1576.         self.assertEqual(self.cmd._raw_ipv6, raw_ipv6)
1577. 
1578.     def test_runserver_addrport(self):
1579.         call_command(self.cmd)
1580.         self.assertServerSettings("127.0.0.1", "8000")
1581. 
1582.         call_command(self.cmd, addrport="1.2.3.4:8000")
1583.         self.assertServerSettings("1.2.3.4", "8000")
1584. 
1585.         call_command(self.cmd, addrport="7000")
1586.         self.assertServerSettings("127.0.0.1", "7000")
1587. 
1588.     @mock.patch("django.core.management.commands.runserver.run")
1589.     @mock.patch("django.core.management.base.BaseCommand.check_migrations")
1590.     def test_zero_ip_addr(self, *mocked_objects):
1591.         call_command(
1592.             "runserver",
1593.             addrport="0:8000",
1594.             use_reloader=False,
1595.             skip_checks=True,
1596.             stdout=self.output,
1597.         )
1598.         self.assertIn(
1599.             "Starting development server at http://0.0.0.0:8000/",
1600.             self.output.getvalue(),
1601.         )
1602. 
1603.     @unittest.skipUnless(socket.has_ipv6, "platform doesn't support IPv6")
1604.     def test_runner_addrport_ipv6(self):
1605.         call_command(self.cmd, addrport="", use_ipv6=True)
1606.         self.assertServerSettings("::1", "8000", ipv6=True, raw_ipv6=True)
1607. 
1608.         call_command(self.cmd, addrport="7000", use_ipv6=True)
1609.         self.assertServerSettings("::1", "7000", ipv6=True, raw_ipv6=True)
1610. 
1611.         call_command(self.cmd, addrport="[2001:0db8:1234:5678::9]:7000")
1612.         self.assertServerSettings(
1613.             "2001:0db8:1234:5678::9", "7000", ipv6=True, raw_ipv6=True
1614.         )
1615. 
1616.     def test_runner_hostname(self):
1617.         call_command(self.cmd, addrport="localhost:8000")
1618.         self.assertServerSettings("localhost", "8000")
1619. 
1620.         call_command(self.cmd, addrport="test.domain.local:7000")
1621.         self.assertServerSettings("test.domain.local", "7000")
1622. 
1623.     @unittest.skipUnless(socket.has_ipv6, "platform doesn't support IPv6")
1624.     def test_runner_hostname_ipv6(self):
1625.         call_command(self.cmd, addrport="test.domain.local:7000", use_ipv6=True)
1626.         self.assertServerSettings("test.domain.local", "7000", ipv6=True)
1627. 
1628.     def test_runner_custom_defaults(self):
1629.         self.cmd.default_addr = "0.0.0.0"
1630.         self.cmd.default_port = "5000"
1631.         call_command(self.cmd)
1632.         self.assertServerSettings("0.0.0.0", "5000")
1633. 
1634.     @unittest.skipUnless(socket.has_ipv6, "platform doesn't support IPv6")
1635.     def test_runner_custom_defaults_ipv6(self):
1636.         self.cmd.default_addr_ipv6 = "::"
1637.         call_command(self.cmd, use_ipv6=True)
1638.         self.assertServerSettings("::", "8000", ipv6=True, raw_ipv6=True)
1639. 
1640.     def test_runner_ambiguous(self):
1641.         # Only 4 characters, all of which could be in an ipv6 address
1642.         call_command(self.cmd, addrport="beef:7654")
1643.         self.assertServerSettings("beef", "7654")
1644. 
1645.         # Uses only characters that could be in an ipv6 address
1646.         call_command(self.cmd, addrport="deadbeef:7654")
1647.         self.assertServerSettings("deadbeef", "7654")
1648. 
1649.     def test_no_database(self):
1650.         """
1651.         Ensure runserver.check_migrations doesn't choke on empty DATABASES.
1652.         """
1653.         tested_connections = ConnectionHandler({})
1654.         with mock.patch(
1655.             "django.core.management.base.connections", new=tested_connections
1656.         ):
1657.             self.cmd.check_migrations()
1658. 
1659.     def test_readonly_database(self):
1660.         """
1661.         runserver.check_migrations() doesn't choke when a database is read-only.
1662.         """
1663.         with mock.patch.object(MigrationRecorder, "has_table", return_value=False):
1664.             self.cmd.check_migrations()
1665.         # You have # ...
1666.         self.assertIn("unapplied migration(s)", self.output.getvalue())
1667. 
1668.     @mock.patch("django.core.management.commands.runserver.run")
1669.     @mock.patch("django.core.management.base.BaseCommand.check_migrations")
1670.     @mock.patch("django.core.management.base.BaseCommand.check")
1671.     def test_skip_checks(self, mocked_check, *mocked_objects):
1672.         call_command(
1673.             "runserver",
1674.             use_reloader=False,
1675.             skip_checks=True,
1676.             stdout=self.output,
1677.         )
1678.         self.assertNotIn("Performing system checks...", self.output.getvalue())
1679.         mocked_check.assert_not_called()
1680. 
1681.         self.output.truncate(0)
1682.         call_command(
1683.             "runserver",
1684.             use_reloader=False,
1685.             skip_checks=False,
1686.             stdout=self.output,
1687.         )
1688.         self.assertIn("Performing system checks...", self.output.getvalue())
1689.         mocked_check.assert_called()
1690. 
1691. 
1692. class ManageRunserverMigrationWarning(TestCase):
1693.     def setUp(self):
1694.         self.stdout = StringIO()
1695.         self.runserver_command = RunserverCommand(stdout=self.stdout)
1696. 
1697.     @override_settings(INSTALLED_APPS=["admin_scripts.app_waiting_migration"])
1698.     def test_migration_warning_one_app(self):
1699.         self.runserver_command.check_migrations()
1700.         output = self.stdout.getvalue()
1701.         self.assertIn("You have 1 unapplied migration(s)", output)
1702.         self.assertIn("apply the migrations for app(s): app_waiting_migration.", output)
1703. 
1704.     @override_settings(
1705.         INSTALLED_APPS=[
1706.             "admin_scripts.app_waiting_migration",
1707.             "admin_scripts.another_app_waiting_migration",
1708.         ],
1709.     )
1710.     def test_migration_warning_multiple_apps(self):
1711.         self.runserver_command.check_migrations()
1712.         output = self.stdout.getvalue()
1713.         self.assertIn("You have 2 unapplied migration(s)", output)
1714.         self.assertIn(
1715.             "apply the migrations for app(s): another_app_waiting_migration, "
1716.             "app_waiting_migration.",
1717.             output,
1718.         )
1719. 
1720. 
1721. class ManageRunserverEmptyAllowedHosts(AdminScriptTestCase):
1722.     def setUp(self):
1723.         super().setUp()
1724.         self.write_settings(
1725.             "settings.py",
1726.             sdict={
1727.                 "ALLOWED_HOSTS": [],
1728.                 "DEBUG": False,
1729.             },
1730.         )
1731. 
1732.     def test_empty_allowed_hosts_error(self):
1733.         out, err = self.run_manage(["runserver"])
1734.         self.assertNoOutput(out)
1735.         self.assertOutput(
1736.             err, "CommandError: You must set settings.ALLOWED_HOSTS if DEBUG is False."
1737.         )
1738. 
1739. 
1740. class ManageRunserverHelpOutput(AdminScriptTestCase):
1741.     def test_suppressed_options(self):
1742.         """runserver doesn't support --verbosity and --trackback options."""
1743.         out, err = self.run_manage(["runserver", "--help"])
1744.         self.assertNotInOutput(out, "--verbosity")
1745.         self.assertNotInOutput(out, "--trackback")
1746.         self.assertOutput(out, "--settings")
1747. 
1748. 
1749. class ManageTestserver(SimpleTestCase):
1750.     @mock.patch.object(TestserverCommand, "handle", return_value="")
1751.     def test_testserver_handle_params(self, mock_handle):
1752.         out = StringIO()
1753.         call_command("testserver", "blah.json", stdout=out)
1754.         mock_handle.assert_called_with(
1755.             "blah.json",
1756.             stdout=out,
1757.             settings=None,
1758.             pythonpath=None,
1759.             verbosity=1,
1760.             traceback=False,
1761.             addrport="",
1762.             no_color=False,
1763.             use_ipv6=False,
1764.             skip_checks=True,
1765.             interactive=True,
1766.             force_color=False,
1767.         )
1768. 
1769.     @mock.patch("django.db.connection.creation.create_test_db", return_value="test_db")
1770.     @mock.patch.object(LoaddataCommand, "handle", return_value="")
1771.     @mock.patch.object(RunserverCommand, "handle", return_value="")
1772.     def test_params_to_runserver(
1773.         self, mock_runserver_handle, mock_loaddata_handle, mock_create_test_db
1774.     ):
1775.         call_command("testserver", "blah.json")
1776.         mock_runserver_handle.assert_called_with(
1777.             addrport="",
1778.             force_color=False,
1779.             insecure_serving=False,
1780.             no_color=False,
1781.             pythonpath=None,
1782.             settings=None,
1783.             shutdown_message=(
1784.                 "\nServer stopped.\nNote that the test database, 'test_db', "
1785.                 "has not been deleted. You can explore it on your own."
1786.             ),
1787.             skip_checks=True,
1788.             traceback=False,
1789.             use_ipv6=False,
1790.             use_reloader=False,
1791.             use_static_handler=True,
1792.             use_threading=connection.features.test_db_allows_multiple_connections,
1793.             verbosity=1,
1794.         )
1795. 
1796. 
1797. ##########################################################################
1798. # COMMAND PROCESSING TESTS
1799. # user-space commands are correctly handled - in particular, arguments to
1800. # the commands are correctly parsed and processed.
1801. ##########################################################################
1802. class ColorCommand(BaseCommand):
1803.     requires_system_checks = []
1804. 
1805.     def handle(self, *args, **options):
1806.         self.stdout.write("Hello, world!", self.style.ERROR)
1807.         self.stderr.write("Hello, world!", self.style.ERROR)
1808. 
1809. 
1810. class CommandTypes(AdminScriptTestCase):
1811.     "Tests for the various types of base command types that can be defined."
1812. 
1813.     def setUp(self):
1814.         super().setUp()
1815.         self.write_settings("settings.py")
1816. 
1817.     def test_version(self):
1818.         "version is handled as a special case"
1819.         args = ["version"]
1820.         out, err = self.run_manage(args)
1821.         self.assertNoOutput(err)
1822.         self.assertOutput(out, get_version())
1823. 
1824.     def test_version_alternative(self):
1825.         "--version is equivalent to version"
1826.         args1, args2 = ["version"], ["--version"]
1827.         # It's possible one outputs on stderr and the other on stdout, hence the set
1828.         self.assertEqual(set(self.run_manage(args1)), set(self.run_manage(args2)))
1829. 
1830.     def test_help(self):
1831.         "help is handled as a special case"
1832.         args = ["help"]
1833.         out, err = self.run_manage(args)
1834.         self.assertOutput(
1835.             out, "Type 'manage.py help <subcommand>' for help on a specific subcommand."
1836.         )
1837.         self.assertOutput(out, "[django]")
1838.         self.assertOutput(out, "startapp")
1839.         self.assertOutput(out, "startproject")
1840. 
1841.     def test_help_commands(self):
1842.         "help --commands shows the list of all available commands"
1843.         args = ["help", "--commands"]
1844.         out, err = self.run_manage(args)
1845.         self.assertNotInOutput(out, "usage:")
1846.         self.assertNotInOutput(out, "Options:")
1847.         self.assertNotInOutput(out, "[django]")
1848.         self.assertOutput(out, "startapp")
1849.         self.assertOutput(out, "startproject")
1850.         self.assertNotInOutput(out, "\n\n")
1851. 
1852.     def test_help_alternative(self):
1853.         "--help is equivalent to help"
1854.         args1, args2 = ["help"], ["--help"]
1855.         self.assertEqual(self.run_manage(args1), self.run_manage(args2))
1856. 
1857.     def test_help_short_altert(self):
1858.         "-h is handled as a short form of --help"
1859.         args1, args2 = ["--help"], ["-h"]
1860.         self.assertEqual(self.run_manage(args1), self.run_manage(args2))
1861. 
1862.     def test_specific_help(self):
1863.         "--help can be used on a specific command"
1864.         args = ["check", "--help"]
1865.         out, err = self.run_manage(args)
1866.         self.assertNoOutput(err)
1867.         # Command-specific options like --tag appear before options common to
1868.         # all commands like --version.
1869.         tag_location = out.find("--tag")
1870.         version_location = out.find("--version")
1871.         self.assertNotEqual(tag_location, -1)
1872.         self.assertNotEqual(version_location, -1)
1873.         self.assertLess(tag_location, version_location)
1874.         self.assertOutput(
1875.             out, "Checks the entire Django project for potential problems."
1876.         )
1877. 
1878.     def test_help_default_options_with_custom_arguments(self):
1879.         args = ["base_command", "--help"]
1880.         out, err = self.run_manage(args)
1881.         self.assertNoOutput(err)
1882.         expected_options = [
1883.             "-h",
1884.             "--option_a OPTION_A",
1885.             "--option_b OPTION_B",
1886.             "--option_c OPTION_C",
1887.             "--version",
1888.             "-v {0,1,2,3}",
1889.             "--settings SETTINGS",
1890.             "--pythonpath PYTHONPATH",
1891.             "--traceback",
1892.             "--no-color",
1893.             "--force-color",
1894.             "args ...",
1895.         ]
1896.         for option in expected_options:
1897.             self.assertOutput(out, f"[{option}]")
1898.         self.assertOutput(out, "--option_a OPTION_A, -a OPTION_A")
1899.         self.assertOutput(out, "--option_b OPTION_B, -b OPTION_B")
1900.         self.assertOutput(out, "--option_c OPTION_C, -c OPTION_C")
1901.         self.assertOutput(out, "-v {0,1,2,3}, --verbosity {0,1,2,3}")
1902. 
1903.     def test_color_style(self):
1904.         style = color.no_style()
1905.         self.assertEqual(style.ERROR("Hello, world!"), "Hello, world!")
1906. 
1907.         style = color.make_style("nocolor")
1908.         self.assertEqual(style.ERROR("Hello, world!"), "Hello, world!")
1909. 
1910.         style = color.make_style("dark")
1911.         self.assertIn("Hello, world!", style.ERROR("Hello, world!"))
1912.         self.assertNotEqual(style.ERROR("Hello, world!"), "Hello, world!")
1913. 
1914.         # Default palette has color.
1915.         style = color.make_style("")
1916.         self.assertIn("Hello, world!", style.ERROR("Hello, world!"))
1917.         self.assertNotEqual(style.ERROR("Hello, world!"), "Hello, world!")
1918. 
1919.     def test_command_color(self):
1920.         out = StringIO()
1921.         err = StringIO()
1922.         command = ColorCommand(stdout=out, stderr=err)
1923.         call_command(command)
1924.         if color.supports_color():
1925.             self.assertIn("Hello, world!\n", out.getvalue())
1926.             self.assertIn("Hello, world!\n", err.getvalue())
1927.             self.assertNotEqual(out.getvalue(), "Hello, world!\n")
1928.             self.assertNotEqual(err.getvalue(), "Hello, world!\n")
1929.         else:
1930.             self.assertEqual(out.getvalue(), "Hello, world!\n")
1931.             self.assertEqual(err.getvalue(), "Hello, world!\n")
1932. 
1933.     def test_command_no_color(self):
1934.         "--no-color prevent colorization of the output"
1935.         out = StringIO()
1936.         err = StringIO()
1937.         command = ColorCommand(stdout=out, stderr=err, no_color=True)
1938.         call_command(command)
1939.         self.assertEqual(out.getvalue(), "Hello, world!\n")
1940.         self.assertEqual(err.getvalue(), "Hello, world!\n")
1941. 
1942.         out = StringIO()
1943.         err = StringIO()
1944.         command = ColorCommand(stdout=out, stderr=err)
1945.         call_command(command, no_color=True)
1946.         self.assertEqual(out.getvalue(), "Hello, world!\n")
1947.         self.assertEqual(err.getvalue(), "Hello, world!\n")
1948. 
1949.     def test_force_color_execute(self):
1950.         out = StringIO()
1951.         err = StringIO()
1952.         with mock.patch.object(sys.stdout, "isatty", lambda: False):
1953.             command = ColorCommand(stdout=out, stderr=err)
1954.             call_command(command, force_color=True)
1955.         self.assertEqual(out.getvalue(), "\x1b[31;1mHello, world!\n\x1b[0m")
1956.         self.assertEqual(err.getvalue(), "\x1b[31;1mHello, world!\n\x1b[0m")
1957. 
1958.     def test_force_color_command_init(self):
1959.         out = StringIO()
1960.         err = StringIO()
1961.         with mock.patch.object(sys.stdout, "isatty", lambda: False):
1962.             command = ColorCommand(stdout=out, stderr=err, force_color=True)
1963.             call_command(command)
1964.         self.assertEqual(out.getvalue(), "\x1b[31;1mHello, world!\n\x1b[0m")
1965.         self.assertEqual(err.getvalue(), "\x1b[31;1mHello, world!\n\x1b[0m")
1966. 
1967.     def test_no_color_force_color_mutually_exclusive_execute(self):
1968.         msg = "The --no-color and --force-color options can't be used together."
1969.         with self.assertRaisesMessage(CommandError, msg):
1970.             call_command(BaseCommand(), no_color=True, force_color=True)
1971. 
1972.     def test_no_color_force_color_mutually_exclusive_command_init(self):
1973.         msg = "'no_color' and 'force_color' can't be used together."
1974.         with self.assertRaisesMessage(CommandError, msg):
1975.             call_command(BaseCommand(no_color=True, force_color=True))
1976. 
1977.     def test_custom_stdout(self):
1978.         class Command(BaseCommand):
1979.             requires_system_checks = []
1980. 
1981.             def handle(self, *args, **options):
1982.                 self.stdout.write("Hello, World!")
1983. 
1984.         out = StringIO()
1985.         command = Command(stdout=out)
1986.         call_command(command)
1987.         self.assertEqual(out.getvalue(), "Hello, World!\n")
1988.         out.truncate(0)
1989.         new_out = StringIO()
1990.         call_command(command, stdout=new_out)
1991.         self.assertEqual(out.getvalue(), "")
1992.         self.assertEqual(new_out.getvalue(), "Hello, World!\n")
1993. 
1994.     def test_custom_stderr(self):
1995.         class Command(BaseCommand):
1996.             requires_system_checks = []
1997. 
1998.             def handle(self, *args, **options):
1999.                 self.stderr.write("Hello, World!")
2000. 
2001.         err = StringIO()
2002.         command = Command(stderr=err)
2003.         call_command(command)


File: tests/admin_scripts/tests.py
Line number range: 2004 - 2504
Content:
2004.         self.assertEqual(err.getvalue(), "Hello, World!\n")
2005.         err.truncate(0)
2006.         new_err = StringIO()
2007.         call_command(command, stderr=new_err)
2008.         self.assertEqual(err.getvalue(), "")
2009.         self.assertEqual(new_err.getvalue(), "Hello, World!\n")
2010. 
2011.     def test_base_command(self):
2012.         "User BaseCommands can execute when a label is provided"
2013.         args = ["base_command", "testlabel"]
2014.         expected_labels = "('testlabel',)"
2015.         self._test_base_command(args, expected_labels)
2016. 
2017.     def test_base_command_no_label(self):
2018.         "User BaseCommands can execute when no labels are provided"
2019.         args = ["base_command"]
2020.         expected_labels = "()"
2021.         self._test_base_command(args, expected_labels)
2022. 
2023.     def test_base_command_multiple_label(self):
2024.         "User BaseCommands can execute when no labels are provided"
2025.         args = ["base_command", "testlabel", "anotherlabel"]
2026.         expected_labels = "('testlabel', 'anotherlabel')"
2027.         self._test_base_command(args, expected_labels)
2028. 
2029.     def test_base_command_with_option(self):
2030.         "User BaseCommands can execute with options when a label is provided"
2031.         args = ["base_command", "testlabel", "--option_a=x"]
2032.         expected_labels = "('testlabel',)"
2033.         self._test_base_command(args, expected_labels, option_a="'x'")
2034. 
2035.     def test_base_command_with_options(self):
2036.         "User BaseCommands can execute with multiple options when a label is provided"
2037.         args = ["base_command", "testlabel", "-a", "x", "--option_b=y"]
2038.         expected_labels = "('testlabel',)"
2039.         self._test_base_command(args, expected_labels, option_a="'x'", option_b="'y'")
2040. 
2041.     def test_base_command_with_wrong_option(self):
2042.         "User BaseCommands outputs command usage when wrong option is specified"
2043.         args = ["base_command", "--invalid"]
2044.         out, err = self.run_manage(args)
2045.         self.assertNoOutput(out)
2046.         self.assertOutput(err, "usage: manage.py base_command")
2047.         self.assertOutput(err, "error: unrecognized arguments: --invalid")
2048. 
2049.     def _test_base_command(self, args, labels, option_a="'1'", option_b="'2'"):
2050.         out, err = self.run_manage(args)
2051. 
2052.         expected_out = (
2053.             "EXECUTE:BaseCommand labels=%s, "
2054.             "options=[('force_color', False), ('no_color', False), "
2055.             "('option_a', %s), ('option_b', %s), ('option_c', '3'), "
2056.             "('pythonpath', None), ('settings', None), ('traceback', False), "
2057.             "('verbosity', 1)]"
2058.         ) % (labels, option_a, option_b)
2059.         self.assertNoOutput(err)
2060.         self.assertOutput(out, expected_out)
2061. 
2062.     def test_base_run_from_argv(self):
2063.         """
2064.         Test run_from_argv properly terminates even with custom execute() (#19665)
2065.         Also test proper traceback display.
2066.         """
2067.         err = StringIO()
2068.         command = BaseCommand(stderr=err)
2069. 
2070.         def raise_command_error(*args, **kwargs):
2071.             raise CommandError("Custom error")
2072. 
2073.         command.execute = lambda args: args  # This will trigger TypeError
2074. 
2075.         # If the Exception is not CommandError it should always
2076.         # raise the original exception.
2077.         with self.assertRaises(TypeError):
2078.             command.run_from_argv(["", ""])
2079. 
2080.         # If the Exception is CommandError and --traceback is not present
2081.         # this command should raise a SystemExit and don't print any
2082.         # traceback to the stderr.
2083.         command.execute = raise_command_error
2084.         err.truncate(0)
2085.         with self.assertRaises(SystemExit):
2086.             command.run_from_argv(["", ""])
2087.         err_message = err.getvalue()
2088.         self.assertNotIn("Traceback", err_message)
2089.         self.assertIn("CommandError", err_message)
2090. 
2091.         # If the Exception is CommandError and --traceback is present
2092.         # this command should raise the original CommandError as if it
2093.         # were not a CommandError.
2094.         err.truncate(0)
2095.         with self.assertRaises(CommandError):
2096.             command.run_from_argv(["", "", "--traceback"])
2097. 
2098.     def test_run_from_argv_non_ascii_error(self):
2099.         """
2100.         Non-ASCII message of CommandError does not raise any
2101.         UnicodeDecodeError in run_from_argv.
2102.         """
2103. 
2104.         def raise_command_error(*args, **kwargs):
2105.             raise CommandError("Erreur personnalisée")
2106. 
2107.         command = BaseCommand(stderr=StringIO())
2108.         command.execute = raise_command_error
2109. 
2110.         with self.assertRaises(SystemExit):
2111.             command.run_from_argv(["", ""])
2112. 
2113.     def test_run_from_argv_closes_connections(self):
2114.         """
2115.         A command called from the command line should close connections after
2116.         being executed (#21255).
2117.         """
2118.         command = BaseCommand()
2119.         command.check = lambda: []
2120.         command.handle = lambda *args, **kwargs: args
2121.         with mock.patch("django.core.management.base.connections") as mock_connections:
2122.             command.run_from_argv(["", ""])
2123.         # Test connections have been closed
2124.         self.assertTrue(mock_connections.close_all.called)
2125. 
2126.     def test_noargs(self):
2127.         "NoArg Commands can be executed"
2128.         args = ["noargs_command"]
2129.         out, err = self.run_manage(args)
2130.         self.assertNoOutput(err)
2131.         self.assertOutput(
2132.             out,
2133.             "EXECUTE: noargs_command options=[('force_color', False), "
2134.             "('no_color', False), ('pythonpath', None), ('settings', None), "
2135.             "('traceback', False), ('verbosity', 1)]",
2136.         )
2137. 
2138.     def test_noargs_with_args(self):
2139.         "NoArg Commands raise an error if an argument is provided"
2140.         args = ["noargs_command", "argument"]
2141.         out, err = self.run_manage(args)
2142.         self.assertOutput(err, "error: unrecognized arguments: argument")
2143. 
2144.     def test_app_command(self):
2145.         "User AppCommands can execute when a single app name is provided"
2146.         args = ["app_command", "auth"]
2147.         out, err = self.run_manage(args)
2148.         self.assertNoOutput(err)
2149.         self.assertOutput(out, "EXECUTE:AppCommand name=django.contrib.auth, options=")
2150.         self.assertOutput(
2151.             out,
2152.             ", options=[('force_color', False), ('no_color', False), "
2153.             "('pythonpath', None), ('settings', None), ('traceback', False), "
2154.             "('verbosity', 1)]",
2155.         )
2156. 
2157.     def test_app_command_no_apps(self):
2158.         "User AppCommands raise an error when no app name is provided"
2159.         args = ["app_command"]
2160.         out, err = self.run_manage(args)
2161.         self.assertOutput(err, "error: Enter at least one application label.")
2162. 
2163.     def test_app_command_multiple_apps(self):
2164.         "User AppCommands raise an error when multiple app names are provided"
2165.         args = ["app_command", "auth", "contenttypes"]
2166.         out, err = self.run_manage(args)
2167.         self.assertNoOutput(err)
2168.         self.assertOutput(out, "EXECUTE:AppCommand name=django.contrib.auth, options=")
2169.         self.assertOutput(
2170.             out,
2171.             ", options=[('force_color', False), ('no_color', False), "
2172.             "('pythonpath', None), ('settings', None), ('traceback', False), "
2173.             "('verbosity', 1)]",
2174.         )
2175.         self.assertOutput(
2176.             out, "EXECUTE:AppCommand name=django.contrib.contenttypes, options="
2177.         )
2178.         self.assertOutput(
2179.             out,
2180.             ", options=[('force_color', False), ('no_color', False), "
2181.             "('pythonpath', None), ('settings', None), ('traceback', False), "
2182.             "('verbosity', 1)]",
2183.         )
2184. 
2185.     def test_app_command_invalid_app_label(self):
2186.         "User AppCommands can execute when a single app name is provided"
2187.         args = ["app_command", "NOT_AN_APP"]
2188.         out, err = self.run_manage(args)
2189.         self.assertOutput(err, "No installed app with label 'NOT_AN_APP'.")
2190. 
2191.     def test_app_command_some_invalid_app_labels(self):
2192.         "User AppCommands can execute when some of the provided app names are invalid"
2193.         args = ["app_command", "auth", "NOT_AN_APP"]
2194.         out, err = self.run_manage(args)
2195.         self.assertOutput(err, "No installed app with label 'NOT_AN_APP'.")
2196. 
2197.     def test_label_command(self):
2198.         "User LabelCommands can execute when a label is provided"
2199.         args = ["label_command", "testlabel"]
2200.         out, err = self.run_manage(args)
2201.         self.assertNoOutput(err)
2202.         self.assertOutput(
2203.             out,
2204.             "EXECUTE:LabelCommand label=testlabel, options=[('force_color', "
2205.             "False), ('no_color', False), ('pythonpath', None), ('settings', "
2206.             "None), ('traceback', False), ('verbosity', 1)]",
2207.         )
2208. 
2209.     def test_label_command_no_label(self):
2210.         "User LabelCommands raise an error if no label is provided"
2211.         args = ["label_command"]
2212.         out, err = self.run_manage(args)
2213.         self.assertOutput(err, "Enter at least one label")
2214. 
2215.     def test_label_command_multiple_label(self):
2216.         "User LabelCommands are executed multiple times if multiple labels are provided"
2217.         args = ["label_command", "testlabel", "anotherlabel"]
2218.         out, err = self.run_manage(args)
2219.         self.assertNoOutput(err)
2220.         self.assertOutput(
2221.             out,
2222.             "EXECUTE:LabelCommand label=testlabel, options=[('force_color', "
2223.             "False), ('no_color', False), ('pythonpath', None), "
2224.             "('settings', None), ('traceback', False), ('verbosity', 1)]",
2225.         )
2226.         self.assertOutput(
2227.             out,
2228.             "EXECUTE:LabelCommand label=anotherlabel, options=[('force_color', "
2229.             "False), ('no_color', False), ('pythonpath', None), "
2230.             "('settings', None), ('traceback', False), ('verbosity', 1)]",
2231.         )
2232. 
2233.     def test_suppress_base_options_command_help(self):
2234.         args = ["suppress_base_options_command", "--help"]
2235.         out, err = self.run_manage(args)
2236.         self.assertNoOutput(err)
2237.         self.assertOutput(out, "Test suppress base options command.")
2238.         self.assertNotInOutput(out, "input file")
2239.         self.assertOutput(out, "-h, --help")
2240.         self.assertNotInOutput(out, "--version")
2241.         self.assertNotInOutput(out, "--verbosity")
2242.         self.assertNotInOutput(out, "-v {0,1,2,3}")
2243.         self.assertNotInOutput(out, "--settings")
2244.         self.assertNotInOutput(out, "--pythonpath")
2245.         self.assertNotInOutput(out, "--traceback")
2246.         self.assertNotInOutput(out, "--no-color")
2247.         self.assertNotInOutput(out, "--force-color")
2248. 
2249.     def test_suppress_base_options_command_defaults(self):
2250.         args = ["suppress_base_options_command"]
2251.         out, err = self.run_manage(args)
2252.         self.assertNoOutput(err)
2253.         self.assertOutput(
2254.             out,
2255.             "EXECUTE:SuppressBaseOptionsCommand options=[('file', None), "
2256.             "('force_color', False), ('no_color', False), "
2257.             "('pythonpath', None), ('settings', None), "
2258.             "('traceback', False), ('verbosity', 1)]",
2259.         )
2260. 
2261. 
2262. class Discovery(SimpleTestCase):
2263.     def test_precedence(self):
2264.         """
2265.         Apps listed first in INSTALLED_APPS have precedence.
2266.         """
2267.         with self.settings(
2268.             INSTALLED_APPS=[
2269.                 "admin_scripts.complex_app",
2270.                 "admin_scripts.simple_app",
2271.                 "django.contrib.auth",
2272.                 "django.contrib.contenttypes",
2273.             ]
2274.         ):
2275.             out = StringIO()
2276.             call_command("duplicate", stdout=out)
2277.             self.assertEqual(out.getvalue().strip(), "complex_app")
2278.         with self.settings(
2279.             INSTALLED_APPS=[
2280.                 "admin_scripts.simple_app",
2281.                 "admin_scripts.complex_app",
2282.                 "django.contrib.auth",
2283.                 "django.contrib.contenttypes",
2284.             ]
2285.         ):
2286.             out = StringIO()
2287.             call_command("duplicate", stdout=out)
2288.             self.assertEqual(out.getvalue().strip(), "simple_app")
2289. 
2290. 
2291. class ArgumentOrder(AdminScriptTestCase):
2292.     """Tests for 2-stage argument parsing scheme.
2293. 
2294.     django-admin command arguments are parsed in 2 parts; the core arguments
2295.     (--settings, --traceback and --pythonpath) are parsed using a basic parser,
2296.     ignoring any unknown options. Then the full settings are
2297.     passed to the command parser, which extracts commands of interest to the
2298.     individual command.
2299.     """
2300. 
2301.     def setUp(self):
2302.         super().setUp()
2303.         self.write_settings(
2304.             "settings.py", apps=["django.contrib.auth", "django.contrib.contenttypes"]
2305.         )
2306.         self.write_settings("alternate_settings.py")
2307. 
2308.     def test_setting_then_option(self):
2309.         """Options passed after settings are correctly handled."""
2310.         args = [
2311.             "base_command",
2312.             "testlabel",
2313.             "--settings=alternate_settings",
2314.             "--option_a=x",
2315.         ]
2316.         self._test(args)
2317. 
2318.     def test_setting_then_short_option(self):
2319.         """Short options passed after settings are correctly handled."""
2320.         args = ["base_command", "testlabel", "--settings=alternate_settings", "-a", "x"]
2321.         self._test(args)
2322. 
2323.     def test_option_then_setting(self):
2324.         """Options passed before settings are correctly handled."""
2325.         args = [
2326.             "base_command",
2327.             "testlabel",
2328.             "--option_a=x",
2329.             "--settings=alternate_settings",
2330.         ]
2331.         self._test(args)
2332. 
2333.     def test_short_option_then_setting(self):
2334.         """Short options passed before settings are correctly handled."""
2335.         args = ["base_command", "testlabel", "-a", "x", "--settings=alternate_settings"]
2336.         self._test(args)
2337. 
2338.     def test_option_then_setting_then_option(self):
2339.         """Options are correctly handled when they are passed before and after
2340.         a setting."""
2341.         args = [
2342.             "base_command",
2343.             "testlabel",
2344.             "--option_a=x",
2345.             "--settings=alternate_settings",
2346.             "--option_b=y",
2347.         ]
2348.         self._test(args, option_b="'y'")
2349. 
2350.     def _test(self, args, option_b="'2'"):
2351.         out, err = self.run_manage(args)
2352.         self.assertNoOutput(err)
2353.         self.assertOutput(
2354.             out,
2355.             "EXECUTE:BaseCommand labels=('testlabel',), options=["
2356.             "('force_color', False), ('no_color', False), ('option_a', 'x'), "
2357.             "('option_b', %s), ('option_c', '3'), ('pythonpath', None), "
2358.             "('settings', 'alternate_settings'), ('traceback', False), "
2359.             "('verbosity', 1)]" % option_b,
2360.         )
2361. 
2362. 
2363. class ExecuteFromCommandLine(SimpleTestCase):
2364.     def test_program_name_from_argv(self):
2365.         """
2366.         Program name is computed from the execute_from_command_line()'s argv
2367.         argument, not sys.argv.
2368.         """
2369.         args = ["help", "shell"]
2370.         with captured_stdout() as out, captured_stderr() as err:
2371.             with mock.patch("sys.argv", [None] + args):
2372.                 execute_from_command_line(["django-admin"] + args)
2373.         self.assertIn("usage: django-admin shell", out.getvalue())
2374.         self.assertEqual(err.getvalue(), "")
2375. 
2376. 
2377. @override_settings(ROOT_URLCONF="admin_scripts.urls")
2378. class StartProject(LiveServerTestCase, AdminScriptTestCase):
2379.     available_apps = [
2380.         "admin_scripts",
2381.         "django.contrib.auth",
2382.         "django.contrib.contenttypes",
2383.         "django.contrib.sessions",
2384.     ]
2385. 
2386.     def test_wrong_args(self):
2387.         """
2388.         Passing the wrong kinds of arguments outputs an error and prints usage.
2389.         """
2390.         out, err = self.run_django_admin(["startproject"])
2391.         self.assertNoOutput(out)
2392.         self.assertOutput(err, "usage:")
2393.         self.assertOutput(err, "You must provide a project name.")
2394. 
2395.     def test_simple_project(self):
2396.         "Make sure the startproject management command creates a project"
2397.         args = ["startproject", "testproject"]
2398.         testproject_dir = os.path.join(self.test_dir, "testproject")
2399. 
2400.         out, err = self.run_django_admin(args)
2401.         self.assertNoOutput(err)
2402.         self.assertTrue(os.path.isdir(testproject_dir))
2403. 
2404.         # running again..
2405.         out, err = self.run_django_admin(args)
2406.         self.assertNoOutput(out)
2407.         self.assertOutput(
2408.             err,
2409.             "CommandError: 'testproject' conflicts with the name of an "
2410.             "existing Python module and cannot be used as a project name. "
2411.             "Please try another name.",
2412.         )
2413. 
2414.     def test_invalid_project_name(self):
2415.         "Make sure the startproject management command validates a project name"
2416.         for bad_name in ("7testproject", "../testproject"):
2417.             with self.subTest(project_name=bad_name):
2418.                 args = ["startproject", bad_name]
2419.                 testproject_dir = os.path.join(self.test_dir, bad_name)
2420. 
2421.                 out, err = self.run_django_admin(args)
2422.                 self.assertOutput(
2423.                     err,
2424.                     "Error: '%s' is not a valid project name. Please make "
2425.                     "sure the name is a valid identifier." % bad_name,
2426.                 )
2427.                 self.assertFalse(os.path.exists(testproject_dir))
2428. 
2429.     def test_importable_project_name(self):
2430.         """
2431.         startproject validates that project name doesn't clash with existing
2432.         Python modules.
2433.         """
2434.         bad_name = "os"
2435.         args = ["startproject", bad_name]
2436.         testproject_dir = os.path.join(self.test_dir, bad_name)
2437. 
2438.         out, err = self.run_django_admin(args)
2439.         self.assertOutput(
2440.             err,
2441.             "CommandError: 'os' conflicts with the name of an existing "
2442.             "Python module and cannot be used as a project name. Please try "
2443.             "another name.",
2444.         )
2445.         self.assertFalse(os.path.exists(testproject_dir))
2446. 
2447.     def test_simple_project_different_directory(self):
2448.         """
2449.         The startproject management command creates a project in a specific
2450.         directory.
2451.         """
2452.         args = ["startproject", "testproject", "othertestproject"]
2453.         testproject_dir = os.path.join(self.test_dir, "othertestproject")
2454.         os.mkdir(testproject_dir)
2455. 
2456.         out, err = self.run_django_admin(args)
2457.         self.assertNoOutput(err)
2458.         self.assertTrue(os.path.exists(os.path.join(testproject_dir, "manage.py")))
2459. 
2460.         # running again..
2461.         out, err = self.run_django_admin(args)
2462.         self.assertNoOutput(out)
2463.         self.assertOutput(
2464.             err,
2465.             "already exists. Overlaying a project into an existing directory "
2466.             "won't replace conflicting files.",
2467.         )
2468. 
2469.     def test_custom_project_template(self):
2470.         """
2471.         The startproject management command is able to use a different project
2472.         template.
2473.         """
2474.         template_path = os.path.join(custom_templates_dir, "project_template")
2475.         args = ["startproject", "--template", template_path, "customtestproject"]
2476.         testproject_dir = os.path.join(self.test_dir, "customtestproject")
2477. 
2478.         out, err = self.run_django_admin(args)
2479.         self.assertNoOutput(err)
2480.         self.assertTrue(os.path.isdir(testproject_dir))
2481.         self.assertTrue(os.path.exists(os.path.join(testproject_dir, "additional_dir")))
2482. 
2483.     def test_custom_project_template_non_python_files_not_formatted(self):
2484.         template_path = os.path.join(custom_templates_dir, "project_template")
2485.         args = ["startproject", "--template", template_path, "customtestproject"]
2486.         testproject_dir = os.path.join(self.test_dir, "customtestproject")
2487. 
2488.         _, err = self.run_django_admin(args)
2489.         self.assertNoOutput(err)
2490.         with open(
2491.             os.path.join(template_path, "additional_dir", "requirements.in")
2492.         ) as f:
2493.             expected = f.read()
2494.         with open(
2495.             os.path.join(testproject_dir, "additional_dir", "requirements.in")
2496.         ) as f:
2497.             result = f.read()
2498.         self.assertEqual(expected, result)
2499. 
2500.     def test_template_dir_with_trailing_slash(self):
2501.         "Ticket 17475: Template dir passed has a trailing path separator"
2502.         template_path = os.path.join(custom_templates_dir, "project_template" + os.sep)
2503.         args = ["startproject", "--template", template_path, "customtestproject"]
2504.         testproject_dir = os.path.join(self.test_dir, "customtestproject")


File: tests/admin_scripts/tests.py
Line number range: 2505 - 3005
Content:
2505. 
2506.         out, err = self.run_django_admin(args)
2507.         self.assertNoOutput(err)
2508.         self.assertTrue(os.path.isdir(testproject_dir))
2509.         self.assertTrue(os.path.exists(os.path.join(testproject_dir, "additional_dir")))
2510. 
2511.     def test_custom_project_template_from_tarball_by_path(self):
2512.         """
2513.         The startproject management command is able to use a different project
2514.         template from a tarball.
2515.         """
2516.         template_path = os.path.join(custom_templates_dir, "project_template.tgz")
2517.         args = ["startproject", "--template", template_path, "tarballtestproject"]
2518.         testproject_dir = os.path.join(self.test_dir, "tarballtestproject")
2519. 
2520.         out, err = self.run_django_admin(args)
2521.         self.assertNoOutput(err)
2522.         self.assertTrue(os.path.isdir(testproject_dir))
2523.         self.assertTrue(os.path.exists(os.path.join(testproject_dir, "run.py")))
2524. 
2525.     def test_custom_project_template_from_tarball_to_alternative_location(self):
2526.         """
2527.         Startproject can use a project template from a tarball and create it in
2528.         a specified location.
2529.         """
2530.         template_path = os.path.join(custom_templates_dir, "project_template.tgz")
2531.         args = [
2532.             "startproject",
2533.             "--template",
2534.             template_path,
2535.             "tarballtestproject",
2536.             "altlocation",
2537.         ]
2538.         testproject_dir = os.path.join(self.test_dir, "altlocation")
2539.         os.mkdir(testproject_dir)
2540. 
2541.         out, err = self.run_django_admin(args)
2542.         self.assertNoOutput(err)
2543.         self.assertTrue(os.path.isdir(testproject_dir))
2544.         self.assertTrue(os.path.exists(os.path.join(testproject_dir, "run.py")))
2545. 
2546.     def test_custom_project_template_from_tarball_by_url(self):
2547.         """
2548.         The startproject management command is able to use a different project
2549.         template from a tarball via a URL.
2550.         """
2551.         template_url = "%s/custom_templates/project_template.tgz" % self.live_server_url
2552. 
2553.         args = ["startproject", "--template", template_url, "urltestproject"]
2554.         testproject_dir = os.path.join(self.test_dir, "urltestproject")
2555. 
2556.         out, err = self.run_django_admin(args)
2557.         self.assertNoOutput(err)
2558.         self.assertTrue(os.path.isdir(testproject_dir))
2559.         self.assertTrue(os.path.exists(os.path.join(testproject_dir, "run.py")))
2560. 
2561.     def test_custom_project_template_from_tarball_by_url_django_user_agent(self):
2562.         user_agent = None
2563. 
2564.         def serve_template(request, *args, **kwargs):
2565.             nonlocal user_agent
2566.             user_agent = request.headers["User-Agent"]
2567.             return serve(request, *args, **kwargs)
2568. 
2569.         old_urlpatterns = urls.urlpatterns[:]
2570.         try:
2571.             urls.urlpatterns += [
2572.                 path(
2573.                     "user_agent_check/<path:path>",
2574.                     serve_template,
2575.                     {"document_root": os.path.join(urls.here, "custom_templates")},
2576.                 ),
2577.             ]
2578. 
2579.             template_url = (
2580.                 f"{self.live_server_url}/user_agent_check/project_template.tgz"
2581.             )
2582.             args = ["startproject", "--template", template_url, "urltestproject"]
2583.             _, err = self.run_django_admin(args)
2584. 
2585.             self.assertNoOutput(err)
2586.             self.assertIn("Django/%s" % get_version(), user_agent)
2587.         finally:
2588.             urls.urlpatterns = old_urlpatterns
2589. 
2590.     def test_project_template_tarball_url(self):
2591.         """ "
2592.         Startproject management command handles project template tar/zip balls
2593.         from non-canonical urls.
2594.         """
2595.         template_url = (
2596.             "%s/custom_templates/project_template.tgz/" % self.live_server_url
2597.         )
2598. 
2599.         args = ["startproject", "--template", template_url, "urltestproject"]
2600.         testproject_dir = os.path.join(self.test_dir, "urltestproject")
2601. 
2602.         out, err = self.run_django_admin(args)
2603.         self.assertNoOutput(err)
2604.         self.assertTrue(os.path.isdir(testproject_dir))
2605.         self.assertTrue(os.path.exists(os.path.join(testproject_dir, "run.py")))
2606. 
2607.     def test_file_without_extension(self):
2608.         "Make sure the startproject management command is able to render custom files"
2609.         template_path = os.path.join(custom_templates_dir, "project_template")
2610.         args = [
2611.             "startproject",
2612.             "--template",
2613.             template_path,
2614.             "customtestproject",
2615.             "-e",
2616.             "txt",
2617.             "-n",
2618.             "Procfile",
2619.         ]
2620.         testproject_dir = os.path.join(self.test_dir, "customtestproject")
2621. 
2622.         out, err = self.run_django_admin(args)
2623.         self.assertNoOutput(err)
2624.         self.assertTrue(os.path.isdir(testproject_dir))
2625.         self.assertTrue(os.path.exists(os.path.join(testproject_dir, "additional_dir")))
2626.         base_path = os.path.join(testproject_dir, "additional_dir")
2627.         for f in ("Procfile", "additional_file.py", "requirements.txt"):
2628.             self.assertTrue(os.path.exists(os.path.join(base_path, f)))
2629.             with open(os.path.join(base_path, f)) as fh:
2630.                 self.assertEqual(
2631.                     fh.read().strip(), "# some file for customtestproject test project"
2632.                 )
2633. 
2634.     def test_custom_project_template_context_variables(self):
2635.         "Make sure template context variables are rendered with proper values"
2636.         template_path = os.path.join(custom_templates_dir, "project_template")
2637.         args = [
2638.             "startproject",
2639.             "--template",
2640.             template_path,
2641.             "another_project",
2642.             "project_dir",
2643.         ]
2644.         testproject_dir = os.path.join(self.test_dir, "project_dir")
2645.         os.mkdir(testproject_dir)
2646.         out, err = self.run_django_admin(args)
2647.         self.assertNoOutput(err)
2648.         test_manage_py = os.path.join(testproject_dir, "manage.py")
2649.         with open(test_manage_py) as fp:
2650.             content = fp.read()
2651.             self.assertIn('project_name = "another_project"', content)
2652.             self.assertIn('project_directory = "%s"' % testproject_dir, content)
2653. 
2654.     def test_no_escaping_of_project_variables(self):
2655.         "Make sure template context variables are not html escaped"
2656.         # We're using a custom command so we need the alternate settings
2657.         self.write_settings("alternate_settings.py")
2658.         template_path = os.path.join(custom_templates_dir, "project_template")
2659.         args = [
2660.             "custom_startproject",
2661.             "--template",
2662.             template_path,
2663.             "another_project",
2664.             "project_dir",
2665.             "--extra",
2666.             "<&>",
2667.             "--settings=alternate_settings",
2668.         ]
2669.         testproject_dir = os.path.join(self.test_dir, "project_dir")
2670.         os.mkdir(testproject_dir)
2671.         out, err = self.run_manage(args)
2672.         self.assertNoOutput(err)
2673.         test_manage_py = os.path.join(testproject_dir, "additional_dir", "extra.py")
2674.         with open(test_manage_py) as fp:
2675.             content = fp.read()
2676.             self.assertIn("<&>", content)
2677. 
2678.     def test_custom_project_destination_missing(self):
2679.         """
2680.         Make sure an exception is raised when the provided
2681.         destination directory doesn't exist
2682.         """
2683.         template_path = os.path.join(custom_templates_dir, "project_template")
2684.         args = [
2685.             "startproject",
2686.             "--template",
2687.             template_path,
2688.             "yet_another_project",
2689.             "project_dir2",
2690.         ]
2691.         testproject_dir = os.path.join(self.test_dir, "project_dir2")
2692.         out, err = self.run_django_admin(args)
2693.         self.assertNoOutput(out)
2694.         self.assertOutput(
2695.             err,
2696.             "Destination directory '%s' does not exist, please create it first."
2697.             % testproject_dir,
2698.         )
2699.         self.assertFalse(os.path.exists(testproject_dir))
2700. 
2701.     def test_custom_project_template_with_non_ascii_templates(self):
2702.         """
2703.         The startproject management command is able to render templates with
2704.         non-ASCII content.
2705.         """
2706.         template_path = os.path.join(custom_templates_dir, "project_template")
2707.         args = [
2708.             "startproject",
2709.             "--template",
2710.             template_path,
2711.             "--extension=txt",
2712.             "customtestproject",
2713.         ]
2714.         testproject_dir = os.path.join(self.test_dir, "customtestproject")
2715. 
2716.         out, err = self.run_django_admin(args)
2717.         self.assertNoOutput(err)
2718.         self.assertTrue(os.path.isdir(testproject_dir))
2719.         path = os.path.join(testproject_dir, "ticket-18091-non-ascii-template.txt")
2720.         with open(path, encoding="utf-8") as f:
2721.             self.assertEqual(
2722.                 f.read().splitlines(False),
2723.                 ["Some non-ASCII text for testing ticket #18091:", "üäö €"],
2724.             )
2725. 
2726.     def test_custom_project_template_hidden_directory_default_excluded(self):
2727.         """Hidden directories are excluded by default."""
2728.         template_path = os.path.join(custom_templates_dir, "project_template")
2729.         args = [
2730.             "startproject",
2731.             "--template",
2732.             template_path,
2733.             "custom_project_template_hidden_directories",
2734.             "project_dir",
2735.         ]
2736.         testproject_dir = os.path.join(self.test_dir, "project_dir")
2737.         os.mkdir(testproject_dir)
2738. 
2739.         _, err = self.run_django_admin(args)
2740.         self.assertNoOutput(err)
2741.         hidden_dir = os.path.join(testproject_dir, ".hidden")
2742.         self.assertIs(os.path.exists(hidden_dir), False)
2743. 
2744.     def test_custom_project_template_hidden_directory_included(self):
2745.         """
2746.         Template context variables in hidden directories are rendered, if not
2747.         excluded.
2748.         """
2749.         template_path = os.path.join(custom_templates_dir, "project_template")
2750.         project_name = "custom_project_template_hidden_directories_included"
2751.         args = [
2752.             "startproject",
2753.             "--template",
2754.             template_path,
2755.             project_name,
2756.             "project_dir",
2757.             "--exclude",
2758.         ]
2759.         testproject_dir = os.path.join(self.test_dir, "project_dir")
2760.         os.mkdir(testproject_dir)
2761. 
2762.         _, err = self.run_django_admin(args)
2763.         self.assertNoOutput(err)
2764.         render_py_path = os.path.join(testproject_dir, ".hidden", "render.py")
2765.         with open(render_py_path) as fp:
2766.             self.assertIn(
2767.                 f"# The {project_name} should be rendered.",
2768.                 fp.read(),
2769.             )
2770. 
2771.     def test_custom_project_template_exclude_directory(self):
2772.         """
2773.         Excluded directories (in addition to .git and __pycache__) are not
2774.         included in the project.
2775.         """
2776.         template_path = os.path.join(custom_templates_dir, "project_template")
2777.         project_name = "custom_project_with_excluded_directories"
2778.         args = [
2779.             "startproject",
2780.             "--template",
2781.             template_path,
2782.             project_name,
2783.             "project_dir",
2784.             "--exclude",
2785.             "additional_dir",
2786.             "-x",
2787.             ".hidden",
2788.         ]
2789.         testproject_dir = os.path.join(self.test_dir, "project_dir")
2790.         os.mkdir(testproject_dir)
2791. 
2792.         _, err = self.run_django_admin(args)
2793.         self.assertNoOutput(err)
2794.         excluded_directories = [
2795.             ".hidden",
2796.             "additional_dir",
2797.             ".git",
2798.             "__pycache__",
2799.         ]
2800.         for directory in excluded_directories:
2801.             self.assertIs(
2802.                 os.path.exists(os.path.join(testproject_dir, directory)),
2803.                 False,
2804.             )
2805.         not_excluded = os.path.join(testproject_dir, project_name)
2806.         self.assertIs(os.path.exists(not_excluded), True)
2807. 
2808.     @unittest.skipIf(
2809.         sys.platform == "win32",
2810.         "Windows only partially supports umasks and chmod.",
2811.     )
2812.     def test_honor_umask(self):
2813.         _, err = self.run_django_admin(["startproject", "testproject"], umask=0o077)
2814.         self.assertNoOutput(err)
2815.         testproject_dir = os.path.join(self.test_dir, "testproject")
2816.         self.assertIs(os.path.isdir(testproject_dir), True)
2817.         tests = [
2818.             (["manage.py"], 0o700),
2819.             (["testproject"], 0o700),
2820.             (["testproject", "settings.py"], 0o600),
2821.         ]
2822.         for paths, expected_mode in tests:
2823.             file_path = os.path.join(testproject_dir, *paths)
2824.             with self.subTest(paths[-1]):
2825.                 self.assertEqual(
2826.                     stat.S_IMODE(os.stat(file_path).st_mode),
2827.                     expected_mode,
2828.                 )
2829. 
2830. 
2831. class StartApp(AdminScriptTestCase):
2832.     def test_invalid_name(self):
2833.         """startapp validates that app name is a valid Python identifier."""
2834.         for bad_name in ("7testproject", "../testproject"):
2835.             with self.subTest(app_name=bad_name):
2836.                 args = ["startapp", bad_name]
2837.                 testproject_dir = os.path.join(self.test_dir, bad_name)
2838. 
2839.                 out, err = self.run_django_admin(args)
2840.                 self.assertOutput(
2841.                     err,
2842.                     "CommandError: '{}' is not a valid app name. Please make "
2843.                     "sure the name is a valid identifier.".format(bad_name),
2844.                 )
2845.                 self.assertFalse(os.path.exists(testproject_dir))
2846. 
2847.     def test_importable_name(self):
2848.         """
2849.         startapp validates that app name doesn't clash with existing Python
2850.         modules.
2851.         """
2852.         bad_name = "os"
2853.         args = ["startapp", bad_name]
2854.         testproject_dir = os.path.join(self.test_dir, bad_name)
2855. 
2856.         out, err = self.run_django_admin(args)
2857.         self.assertOutput(
2858.             err,
2859.             "CommandError: 'os' conflicts with the name of an existing "
2860.             "Python module and cannot be used as an app name. Please try "
2861.             "another name.",
2862.         )
2863.         self.assertFalse(os.path.exists(testproject_dir))
2864. 
2865.     def test_invalid_target_name(self):
2866.         for bad_target in (
2867.             "invalid.dir_name",
2868.             "7invalid_dir_name",
2869.             ".invalid_dir_name",
2870.         ):
2871.             with self.subTest(bad_target):
2872.                 _, err = self.run_django_admin(["startapp", "app", bad_target])
2873.                 self.assertOutput(
2874.                     err,
2875.                     "CommandError: '%s' is not a valid app directory. Please "
2876.                     "make sure the directory is a valid identifier." % bad_target,
2877.                 )
2878. 
2879.     def test_importable_target_name(self):
2880.         _, err = self.run_django_admin(["startapp", "app", "os"])
2881.         self.assertOutput(
2882.             err,
2883.             "CommandError: 'os' conflicts with the name of an existing Python "
2884.             "module and cannot be used as an app directory. Please try "
2885.             "another directory.",
2886.         )
2887. 
2888.     def test_trailing_slash_in_target_app_directory_name(self):
2889.         app_dir = os.path.join(self.test_dir, "apps", "app1")
2890.         os.makedirs(app_dir)
2891.         _, err = self.run_django_admin(
2892.             ["startapp", "app", os.path.join("apps", "app1", "")]
2893.         )
2894.         self.assertNoOutput(err)
2895.         self.assertIs(os.path.exists(os.path.join(app_dir, "apps.py")), True)
2896. 
2897.     def test_overlaying_app(self):
2898.         # Use a subdirectory so it is outside the PYTHONPATH.
2899.         os.makedirs(os.path.join(self.test_dir, "apps/app1"))
2900.         self.run_django_admin(["startapp", "app1", "apps/app1"])
2901.         out, err = self.run_django_admin(["startapp", "app2", "apps/app1"])
2902.         self.assertOutput(
2903.             err,
2904.             "already exists. Overlaying an app into an existing directory "
2905.             "won't replace conflicting files.",
2906.         )
2907. 
2908.     def test_template(self):
2909.         out, err = self.run_django_admin(["startapp", "new_app"])
2910.         self.assertNoOutput(err)
2911.         app_path = os.path.join(self.test_dir, "new_app")
2912.         self.assertIs(os.path.exists(app_path), True)
2913.         with open(os.path.join(app_path, "apps.py")) as f:
2914.             content = f.read()
2915.             self.assertIn("class NewAppConfig(AppConfig)", content)
2916.             if HAS_BLACK:
2917.                 test_str = 'default_auto_field = "django.db.models.BigAutoField"'
2918.             else:
2919.                 test_str = "default_auto_field = 'django.db.models.BigAutoField'"
2920.             self.assertIn(test_str, content)
2921.             self.assertIn(
2922.                 'name = "new_app"' if HAS_BLACK else "name = 'new_app'",
2923.                 content,
2924.             )
2925. 
2926. 
2927. class DiffSettings(AdminScriptTestCase):
2928.     """Tests for diffsettings management command."""
2929. 
2930.     def test_basic(self):
2931.         """Runs without error and emits settings diff."""
2932.         self.write_settings("settings_to_diff.py", sdict={"FOO": '"bar"'})
2933.         args = ["diffsettings", "--settings=settings_to_diff"]
2934.         out, err = self.run_manage(args)
2935.         self.assertNoOutput(err)
2936.         self.assertOutput(out, "FOO = 'bar'  ###")
2937.         # Attributes from django.conf.Settings don't appear.
2938.         self.assertNotInOutput(out, "is_overridden = ")
2939. 
2940.     def test_settings_configured(self):
2941.         out, err = self.run_manage(
2942.             ["diffsettings"], manage_py="configured_settings_manage.py"
2943.         )
2944.         self.assertNoOutput(err)
2945.         self.assertOutput(out, "CUSTOM = 1  ###\nDEBUG = True")
2946.         # Attributes from django.conf.UserSettingsHolder don't appear.
2947.         self.assertNotInOutput(out, "default_settings = ")
2948. 
2949.     def test_dynamic_settings_configured(self):
2950.         # Custom default settings appear.
2951.         out, err = self.run_manage(
2952.             ["diffsettings"], manage_py="configured_dynamic_settings_manage.py"
2953.         )
2954.         self.assertNoOutput(err)
2955.         self.assertOutput(out, "FOO = 'bar'  ###")
2956. 
2957.     def test_all(self):
2958.         """The all option also shows settings with the default value."""
2959.         self.write_settings("settings_to_diff.py", sdict={"STATIC_URL": "None"})
2960.         args = ["diffsettings", "--settings=settings_to_diff", "--all"]
2961.         out, err = self.run_manage(args)
2962.         self.assertNoOutput(err)
2963.         self.assertOutput(out, "### STATIC_URL = None")
2964. 
2965.     def test_custom_default(self):
2966.         """
2967.         The --default option specifies an alternate settings module for
2968.         comparison.
2969.         """
2970.         self.write_settings(
2971.             "settings_default.py", sdict={"FOO": '"foo"', "BAR": '"bar1"'}
2972.         )
2973.         self.write_settings(
2974.             "settings_to_diff.py", sdict={"FOO": '"foo"', "BAR": '"bar2"'}
2975.         )
2976.         out, err = self.run_manage(
2977.             [
2978.                 "diffsettings",
2979.                 "--settings=settings_to_diff",
2980.                 "--default=settings_default",
2981.             ]
2982.         )
2983.         self.assertNoOutput(err)
2984.         self.assertNotInOutput(out, "FOO")
2985.         self.assertOutput(out, "BAR = 'bar2'")
2986. 
2987.     def test_unified(self):
2988.         """--output=unified emits settings diff in unified mode."""
2989.         self.write_settings("settings_to_diff.py", sdict={"FOO": '"bar"'})
2990.         args = ["diffsettings", "--settings=settings_to_diff", "--output=unified"]
2991.         out, err = self.run_manage(args)
2992.         self.assertNoOutput(err)
2993.         self.assertOutput(out, "+ FOO = 'bar'")
2994.         self.assertOutput(out, "- SECRET_KEY = ''")
2995.         self.assertOutput(out, "+ SECRET_KEY = 'django_tests_secret_key'")
2996.         self.assertNotInOutput(out, "  APPEND_SLASH = True")
2997. 
2998.     def test_unified_all(self):
2999.         """
3000.         --output=unified --all emits settings diff in unified mode and includes
3001.         settings with the default value.
3002.         """
3003.         self.write_settings("settings_to_diff.py", sdict={"FOO": '"bar"'})
3004.         args = [
3005.             "diffsettings",


File: tests/admin_scripts/tests.py
Line number range: 3006 - 3506
Content:
3006.             "--settings=settings_to_diff",
3007.             "--output=unified",
3008.             "--all",
3009.         ]
3010.         out, err = self.run_manage(args)
3011.         self.assertNoOutput(err)
3012.         self.assertOutput(out, "  APPEND_SLASH = True")
3013.         self.assertOutput(out, "+ FOO = 'bar'")
3014.         self.assertOutput(out, "- SECRET_KEY = ''")
3015. 
3016. 
3017. class Dumpdata(AdminScriptTestCase):
3018.     """Tests for dumpdata management command."""
3019. 
3020.     def setUp(self):
3021.         super().setUp()
3022.         self.write_settings("settings.py")
3023. 
3024.     def test_pks_parsing(self):
3025.         """Regression for #20509
3026. 
3027.         Test would raise an exception rather than printing an error message.
3028.         """
3029.         args = ["dumpdata", "--pks=1"]
3030.         out, err = self.run_manage(args)
3031.         self.assertOutput(err, "You can only use --pks option with one model")
3032.         self.assertNoOutput(out)
3033. 
3034. 
3035. class MainModule(AdminScriptTestCase):
3036.     """python -m django works like django-admin."""
3037. 
3038.     def test_program_name_in_help(self):
3039.         out, err = self.run_test(["-m", "django", "help"])
3040.         self.assertOutput(
3041.             out,
3042.             "Type 'python -m django help <subcommand>' for help on a specific "
3043.             "subcommand.",
3044.         )
3045. 
3046. 
3047. class DjangoAdminSuggestions(AdminScriptTestCase):
3048.     def setUp(self):
3049.         super().setUp()
3050.         self.write_settings("settings.py")
3051. 
3052.     def test_suggestions(self):
3053.         args = ["rnserver", "--settings=test_project.settings"]
3054.         out, err = self.run_django_admin(args)
3055.         self.assertNoOutput(out)
3056.         self.assertOutput(err, "Unknown command: 'rnserver'. Did you mean runserver?")
3057. 
3058.     def test_no_suggestions(self):
3059.         args = ["abcdef", "--settings=test_project.settings"]
3060.         out, err = self.run_django_admin(args)
3061.         self.assertNoOutput(out)
3062.         self.assertNotInOutput(err, "Did you mean")

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-21 20:07:15,152 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="1. Query requirement analysis:\n   - The user explicitly asked for the full content of `tests/admin_scripts/tests.py`.\n   - The provided context contains the content of this file.\n2. Extended relevance:\n   - Providing the entire file content as requested is necessary to fulfill the user's query.", relative_path='tests/admin_scripts/tests.py', start_line=1, end_line=3062)]
2025-12-21 20:07:15,158 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of `tests/admin_scripts/tests.py` and all Python files inside `tests/admin_scripts/management/commands/`.
2025-12-21 20:07:15,158 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-21 20:07:15,158 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-21 20:07:15,158 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 0 existing contexts
2025-12-21 20:07:15,158 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 1 total contexts (removed 0 duplicates)
2025-12-21 20:07:15,160 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .github
|   ├── CODE_OF_CONDUCT.md
|   ├── FUNDING.yml
|   ├── SECURITY.md
|   └── workflows
|       ├── benchmark.yml
|       ├── docs.yml
|       ├── linters.yml
|       ├── new_contributor_pr.yml
|       ├── schedule_tests.yml
|       ├── schedules.yml
|       └── tests.yml
├── .pre-commit-config.yaml
├── .readthedocs.yml
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ar_DZ
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ckb
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ig
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ky
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ms
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uz
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   ├── 0012_alter_user_first_name_max_length.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   └── options.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── constraints.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── ms
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── tg
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── uz
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_redirect_new_path_help_text.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── templates
|   |   |   |   ├── sitemap.xml
|   |   |   |   └── sitemap_index.xml
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── asgi.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   ├── memcached.py
|   |   |   |   └── redis.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── async_checks.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   ├── __init__.py
|   |   |   |   └── django_4_0.py
|   |   |   ├── database.py
|   |   |   ├── files.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── filesystem.py
|   |   |   |   ├── handler.py
|   |   |   |   ├── memory.py
|   |   |   |   └── mixins.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── asgi.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── __init__.py
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── optimizemigration.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── jsonl.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── psycopg_any.py
|   |   |   |   └── schema.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _functions.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   └── special.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── enums.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── json.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── autoreload.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── asyncio.py
|   |   ├── autoreload.py
|   |   ├── cache.py
|   |   ├── connection.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── common.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           ├── default_urlconf.html
|           ├── technical_404.html
|           ├── technical_500.html
|           └── technical_500.txt
├── docs
|   ├── README.rst
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   ├── genindex.html
|   |   |   ├── layout.html
|   |   |   ├── modindex.html
|   |   |   ├── search.html
|   |   |   └── static
|   |   |       ├── console-tabs.css
|   |   |       ├── default.css
|   |   |       ├── djangodocs.css
|   |   |       ├── fontawesome
|   |   |       ├── homepage.css
|   |   |       └── reset-fonts-grids.css
|   |   └── djangodocs-epub
|   |       ├── epub-cover.html
|   |       └── static
|   |           └── epub.css
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── _images
|   |   ├── auth-remote-user.txt
|   |   ├── csrf.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-backend.txt
|   |   ├── custom-template-tags.txt
|   |   ├── deployment
|   |   |   ├── asgi
|   |   |   |   ├── daphne.txt
|   |   |   |   ├── hypercorn.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── uvicorn.txt
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── legacy-databases.txt
|   |   ├── logging.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── filters.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── constraints.txt
|   |   |   |   ├── expressions.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── logging.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── paginator.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.19.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.20.txt
|   |   ├── 1.11.21.txt
|   |   ├── 1.11.22.txt
|   |   ├── 1.11.23.txt
|   |   ├── 1.11.24.txt
|   |   ├── 1.11.25.txt
|   |   ├── 1.11.26.txt
|   |   ├── 1.11.27.txt
|   |   ├── 1.11.28.txt
|   |   ├── 1.11.29.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.11.txt
|   |   ├── 2.0.12.txt
|   |   ├── 2.0.13.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.10.txt
|   |   ├── 2.1.11.txt
|   |   ├── 2.1.12.txt
|   |   ├── 2.1.13.txt
|   |   ├── 2.1.14.txt
|   |   ├── 2.1.15.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.7.txt
|   |   ├── 2.1.8.txt
|   |   ├── 2.1.9.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.1.txt
|   |   ├── 2.2.10.txt
|   |   ├── 2.2.11.txt
|   |   ├── 2.2.12.txt
|   |   ├── 2.2.13.txt
|   |   ├── 2.2.14.txt
|   |   ├── 2.2.15.txt
|   |   ├── 2.2.16.txt
|   |   ├── 2.2.17.txt
|   |   ├── 2.2.18.txt
|   |   ├── 2.2.19.txt
|   |   ├── 2.2.2.txt
|   |   ├── 2.2.20.txt
|   |   ├── 2.2.21.txt
|   |   ├── 2.2.22.txt
|   |   ├── 2.2.23.txt
|   |   ├── 2.2.24.txt
|   |   ├── 2.2.25.txt
|   |   ├── 2.2.26.txt
|   |   ├── 2.2.27.txt
|   |   ├── 2.2.28.txt
|   |   ├── 2.2.3.txt
|   |   ├── 2.2.4.txt
|   |   ├── 2.2.5.txt
|   |   ├── 2.2.6.txt
|   |   ├── 2.2.7.txt
|   |   ├── 2.2.8.txt
|   |   ├── 2.2.9.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.1.txt
|   |   ├── 3.0.10.txt
|   |   ├── 3.0.11.txt
|   |   ├── 3.0.12.txt
|   |   ├── 3.0.13.txt
|   |   ├── 3.0.14.txt
|   |   ├── 3.0.2.txt
|   |   ├── 3.0.3.txt
|   |   ├── 3.0.4.txt
|   |   ├── 3.0.5.txt
|   |   ├── 3.0.6.txt
|   |   ├── 3.0.7.txt
|   |   ├── 3.0.8.txt
|   |   ├── 3.0.9.txt
|   |   ├── 3.0.txt
|   |   ├── 3.1.1.txt
|   |   ├── 3.1.10.txt
|   |   ├── 3.1.11.txt
|   |   ├── 3.1.12.txt
|   |   ├── 3.1.13.txt
|   |   ├── 3.1.14.txt
|   |   ├── 3.1.2.txt
|   |   ├── 3.1.3.txt
|   |   ├── 3.1.4.txt
|   |   ├── 3.1.5.txt
|   |   ├── 3.1.6.txt
|   |   ├── 3.1.7.txt
|   |   ├── 3.1.8.txt
|   |   ├── 3.1.9.txt
|   |   ├── 3.1.txt
|   |   ├── 3.2.1.txt
|   |   ├── 3.2.10.txt
|   |   ├── 3.2.11.txt
|   |   ├── 3.2.12.txt
|   |   ├── 3.2.13.txt
|   |   ├── 3.2.14.txt
|   |   ├── 3.2.15.txt
|   |   ├── 3.2.16.txt
|   |   ├── 3.2.17.txt
|   |   ├── 3.2.2.txt
|   |   ├── 3.2.3.txt
|   |   ├── 3.2.4.txt
|   |   ├── 3.2.5.txt
|   |   ├── 3.2.6.txt
|   |   ├── 3.2.7.txt
|   |   ├── 3.2.8.txt
|   |   ├── 3.2.9.txt
|   |   ├── 3.2.txt
|   |   ├── 4.0.1.txt
|   |   ├── 4.0.2.txt
|   |   ├── 4.0.3.txt
|   |   ├── 4.0.4.txt
|   |   ├── 4.0.5.txt
|   |   ├── 4.0.6.txt
|   |   ├── 4.0.7.txt
|   |   ├── 4.0.8.txt
|   |   ├── 4.0.9.txt
|   |   ├── 4.0.txt
|   |   ├── 4.1.1.txt
|   |   ├── 4.1.2.txt
|   |   ├── 4.1.3.txt
|   |   ├── 4.1.4.txt
|   |   ├── 4.1.5.txt
|   |   ├── 4.1.6.txt
|   |   ├── 4.1.7.txt
|   |   ├── 4.1.txt
|   |   ├── 4.2.txt
|   |   ├── 5.0.txt
|   |   ├── index.txt
|   |   └── security.txt
|   ├── requirements.txt
|   └── topics
|       ├── async.txt
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── fixtures.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   ├── jsi18n-mocks.test.js
|   |   └── navigation.test.js
|   ├── gis
|   |   └── mapwidget.test.js
|   └── tests.html
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_dynamic_settings_manage.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── .hidden
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       ├── noargs_command.py
    |   |       └── suppress_base_options_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── admin
    |   |   |   ├── admin_views
    |   |   |   └── base_site.html
    |   |   └── custom_filter_template.html
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_breadcrumbs.py
    |   ├── test_forms.py
    |   ├── test_history_view.py
    |   ├── test_multidb.py
    |   ├── test_nav_sidebar.py
    |   ├── test_skip_link_to_content.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   ├── no_config_app
    |   |   └── __init__.py
    |   ├── one_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── tests.py
    |   ├── two_configs_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── two_configs_one_default_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   └── two_default_configs_app
    |       ├── __init__.py
    |       └── apps.py
    ├── asgi
    |   ├── __init__.py
    |   ├── project
    |   |   └── static
    |   |       └── file.txt
    |   ├── tests.py
    |   └── urls.py
    ├── async
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_async_model_methods.py
    |   ├── test_async_queryset.py
    |   ├── test_async_related_managers.py
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   ├── with_last_login_attr.py
    |   |   ├── with_many_to_many.py
    |   |   └── with_unique_constraint.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   |   ├── auth_attrs_access.html
    |   |   |   ├── auth_attrs_messages.html
    |   |   |   ├── auth_attrs_no_access.html
    |   |   |   ├── auth_attrs_perm_in_perms.html
    |   |   |   ├── auth_attrs_perms.html
    |   |   |   ├── auth_attrs_test_access.html
    |   |   |   └── auth_attrs_user.html
    |   |   └── registration
    |   |       ├── html_password_reset_email.html
    |   |       ├── logged_out.html
    |   |       ├── login.html
    |   |       ├── password_change_form.html
    |   |       ├── password_reset_complete.html
    |   |       ├── password_reset_confirm.html
    |   |       ├── password_reset_done.html
    |   |       ├── password_reset_email.html
    |   |       ├── password_reset_form.html
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_remote_user.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── app_unmigrated
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── test_base.py
    |   |   ├── test_client.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_functions.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   ├── tests.py
    |   └── tests_async.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── template_test_apps
    |   |   ├── __init__.py
    |   |   ├── different_tags_app
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   ├── same_tags_app_1
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   └── same_tags_app_2
    |   |       ├── __init__.py
    |   |       ├── apps.py
    |   |       └── templatetags
    |   ├── test_4_0_compatibility.py
    |   ├── test_async_checks.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_files.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_class_based_error_handlers.py
    |       ├── bad_error_handlers_invalid_path.py
    |       ├── bad_function_based_error_handlers.py
    |       ├── beginning_with_slash.py
    |       ├── cbv_as_view.py
    |       ├── contains_tuple.py
    |       ├── good_class_based_error_handlers.py
    |       ├── good_function_based_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   └── ending_with_dollar.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_migrations.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   |       ├── debug.html
    |   |       └── request_attrs.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_collate.py
    |   |   ├── test_greatest.py
    |   |   ├── test_json_object.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_random.py
    |   |   ├── test_round.py
    |   |   ├── test_sign.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_md5.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_sha1.py
    |   |   ├── test_sha224.py
    |   |   ├── test_sha256.py
    |   |   ├── test_sha384.py
    |   |   ├── test_sha512.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── fake_client.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   ├── test_postgresql.py
    |   ├── test_sqlite.py
    |   └── tests.py
    ├── decorators
    |   ├── __init__.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   ├── test_middleware_mixin.py
    |   ├── test_storages.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── empty_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── test_commands.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── test_inmemory_storage.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── fixture2.xml
    |   |   ├── fixture3.xml
    |   |   ├── fixture7.xml
    |   |   └── fixture9.xml
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── animal.xml
    |   |   ├── bad_fixture2.xml
    |   |   ├── nk-inheritance2.xml
    |   |   ├── non_natural_2.xml
    |   |   ├── pretty.xml
    |   |   └── sequence_extra_xml.xml
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── absolute_urls.py
    |   ├── no_slash_urls.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   |   └── default.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_jsonfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   |       └── custom_widget.html
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   |       ├── article_form.html
    |   |       ├── custom_widget.html
    |   |       ├── cyclic_context_boundfield_render.html
    |   |       ├── error.html
    |   |       ├── form_snippet.html
    |   |       ├── legend_test.html
    |   |       └── use_fieldset.html
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   └── tags.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   |       └── using.html
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   ├── about.html
    |   |   |   ├── apple_detail.html
    |   |   |   ├── artist_detail.html
    |   |   |   ├── artist_form.html
    |   |   |   ├── author_confirm_delete.html
    |   |   |   ├── author_detail.html
    |   |   |   ├── author_form.html
    |   |   |   ├── author_list.html
    |   |   |   ├── author_objects.html
    |   |   |   ├── author_view.html
    |   |   |   ├── book_archive.html
    |   |   |   ├── book_archive_day.html
    |   |   |   ├── book_archive_month.html
    |   |   |   ├── book_archive_week.html
    |   |   |   ├── book_archive_year.html
    |   |   |   ├── book_detail.html
    |   |   |   ├── book_list.html
    |   |   |   ├── confirm_delete.html
    |   |   |   ├── detail.html
    |   |   |   ├── form.html
    |   |   |   ├── list.html
    |   |   |   ├── page_template.html
    |   |   |   ├── robots.txt
    |   |   |   └── using.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── has_nulls
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   ├── test_srs.py
    |   |   └── tests.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_indexes.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_create_models.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_rastermodels.py
    |   |   |   └── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   |   └── test_handler.html
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   |   └── ignored.html
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   |   └── media_ignored.html
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   ├── javascript_ignored.js
    |   |   |   └── static_ignored.html
    |   |   └── templates
    |   |       ├── empty.html
    |   |       ├── subdir
    |   |       ├── test.html
    |   |       └── xxx_ignored.html
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── loading
    |   |   ├── en
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_AU
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_CA
    |   |   |   └── LC_MESSAGES
    |   |   └── en_NZ
    |   |       └── LC_MESSAGES
    |   ├── loading_app
    |   |   ├── __init__.py
    |   |   ├── apps.py
    |   |   └── locale
    |   |       └── en
    |   ├── models.py
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   |   ├── 404.html
    |   |   |   └── dummy.html
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── models.py
    |   |   |   └── test.html
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   |   └── percents.html
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── unchanged
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   ├── tests.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_fake_initial_case_insensitive
    |   |   ├── fake_initial
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── initial
    |   |       ├── 0001_initial.py
    |   |       └── __init__.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_conflict_long_name
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second_migration_with_long_name.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_manual_porting
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   └── __init__.py
    |   ├── test_migrations_namespace_package
    |   |   └── 0001_initial.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_no_operations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_noop
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   ├── 0005_fifth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_no_replaces
    |   |   ├── 0001_squashed_0002.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_enums
    |   ├── __init__.py
    |   └── tests.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autofield.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_filepathfield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_jsonfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_pk.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── model_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── integration_settings.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_constraints.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_integration.py
    |   ├── test_introspection.py
    |   ├── test_operations.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_contains.py
    |   ├── test_db_returning.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   ├── test_sqlcompiler.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests_tests
    |   ├── __init__.py
    |   ├── test_accept_header.py
    |   ├── test_data_upload_settings.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_jsonl.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_clear_expired.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   |       └── using.html
    |   ├── templates
    |   |   └── shortcuts
    |   |       ├── render_test.html
    |   |       └── using.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── custom_sitemap.xml
    |   |   └── custom_sitemap_lastmod_index.xml
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   ├── test_management.py
    |   ├── test_utils.py
    |   └── urls
    |       ├── __init__.py
    |       ├── empty.py
    |       ├── http.py
    |       ├── https.py
    |       ├── index_only.py
    |       └── sitemap_only.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── absolute_root.css
    |   |   |   ├── absolute_root.js
    |   |   |   ├── cached
    |   |   |   ├── nested
    |   |   |   ├── styles_root.css
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   |   └── faulty.css
    |   |   ├── loop
    |   |   |   ├── bar.css
    |   |   |   └── foo.css
    |   |   ├── pathlib
    |   |   |   └── pathlib.txt
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   |       ├── description.html
    |   |       ├── description_context.html
    |   |       ├── title.html
    |   |       └── title_context.html
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   |       └── hello.html
    |   ├── jinja2
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       ├── syntax_error.html
    |   |       ├── syntax_error2.html
    |   |       └── syntax_error_include.html
    |   ├── template_strings
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       └── syntax_error.html
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_loader
    |   |       ├── goodbye.html
    |   |       ├── hello.html
    |   |       └── request.html
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   |       └── using.html
    |   ├── other_templates
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   └── test_dirs.html
    |   ├── recursive_templates
    |   |   ├── fs
    |   |   |   ├── extend-missing.html
    |   |   |   ├── one.html
    |   |   |   ├── other-recursive.html
    |   |   |   ├── recursive.html
    |   |   |   ├── self.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── fs2
    |   |   |   └── recursive.html
    |   |   └── fs3
    |   |       └── recursive.html
    |   ├── relative_templates
    |   |   ├── dir1
    |   |   |   ├── dir2
    |   |   |   ├── looped.html
    |   |   |   ├── one.html
    |   |   |   ├── one1.html
    |   |   |   ├── one2.html
    |   |   |   ├── one3.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── error_extends.html
    |   |   ├── error_include.html
    |   |   ├── one.html
    |   |   ├── one_var.html
    |   |   ├── three.html
    |   |   └── two.html
    |   ├── syntax_tests
    |   |   ├── __init__.py
    |   |   ├── i18n
    |   |   |   ├── __init__.py
    |   |   |   ├── base.py
    |   |   |   ├── test_blocktranslate.py
    |   |   |   ├── test_filters.py
    |   |   |   ├── test_get_available_languages.py
    |   |   |   ├── test_get_current_language.py
    |   |   |   ├── test_get_current_language_bidi.py
    |   |   |   ├── test_get_language_info.py
    |   |   |   ├── test_get_language_info_list.py
    |   |   |   ├── test_language.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Management command subparsers don’t retain error formatting

Description: Description
	
Django management commands use a subclass of argparse.ArgumentParser, CommandParser, that takes some extra arguments to improve error formatting. These arguments are not copied into subparsers, created via CommandParser.add_subparsers().add_parser(). Missing arguments to subparsers thus end as stack traces on the CLI, rather than human-facing usage messages.
For example take this command with a subparser:
from django.core.management.base import BaseCommand
class Command(BaseCommand):
	def add_arguments(self, parser):
		subparsers = parser.add_subparsers(required=True)
		create = subparsers.add_parser("create")
		create.add_argument("name")
	def handle(self, *args, **options):
		pass
Missing the required subparser name argument gives the usage message, as for any normal argument:
$ ./manage.py cheeses
usage: manage.py cheeses [-h] [--version] [-v {0,1,2,3}] [--settings SETTINGS] [--pythonpath PYTHONPATH] [--traceback] [--no-color] [--force-color] [--skip-checks] {create} ...
manage.py cheeses: error: the following arguments are required: {create}
But missing the name argument to create fails with a stacktrace:
$ ./manage.py cheeses create
Traceback (most recent call last):
 File "/Users/chainz/tmp/subparserstest/./manage.py", line 21, in <module>
	main()
...
 File "/Users/chainz/.pyenv/versions/3.11.0/lib/python3.11/argparse.py", line 2131, in _parse_known_args
	self.error(_('the following arguments are required: %s') %
 File "/Users/chainz/Documents/Projects/django/django/core/management/base.py", line 72, in error
	raise CommandError("Error: %s" % message)
django.core.management.base.CommandError: Error: the following arguments are required: name
We can correct this by ensuring that the subparser action returned by add_subparsers() copies the relevant arguments through to constructed subparsers.
(Originally reported by Mark Gregson on django-developers: ​https://groups.google.com/g/django-developers/c/oWcaxkxQ-KI/m/4NUhLjddBwAJ )

Patch information:
diff --git a/django/core/management/base.py b/django/core/management/base.py
index abc6f79a15..ad698bfd7d 100644
--- a/django/core/management/base.py
+++ b/django/core/management/base.py
@@ -71,6 +71,52 @@ class CommandParser(ArgumentParser):
         else:
             raise CommandError("Error: %s" % message)
 
+    def add_subparsers(self, **kwargs):
+        """
+        Add subparsers that inherit relevant settings from this CommandParser so
+        that subparsers retain Django's error formatting and behavior.
+        """
+        # Ensure subparsers use the same parser class by default.
+        kwargs.setdefault("parser_class", type(self))
+        subparsers = super().add_subparsers(**kwargs)
+
+        parent_called_from_command_line = self.called_from_command_line
+        parent_missing_args_message = self.missing_args_message
+        parent_formatter_class = getattr(self, "formatter_class", None)
+        parent_allow_abbrev = getattr(self, "allow_abbrev", None)
+
+        original_add_parser = subparsers.add_parser
+
+        def add_parser(name, **kw):
+            # Determine the parser class that will be used for this subparser.
+            parser_class = kw.get("parser_class", getattr(subparsers, "parser_class", None))
+
+            # Propagate generic argparse settings if not explicitly provided.
+            if parent_formatter_class is not None and "formatter_class" not in kw:
+                kw["formatter_class"] = parent_formatter_class
+            if parent_allow_abbrev is not None and "allow_abbrev" not in kw:
+                kw["allow_abbrev"] = parent_allow_abbrev
+
+            # Only pass Django-specific kwargs when the target parser class
+            # understands them (i.e., is a subclass of CommandParser).
+            try:
+                if parser_class is None:
+                    parser_class = type(self)
+                if issubclass(parser_class, CommandParser):
+                    kw.setdefault("missing_args_message", parent_missing_args_message)
+                    kw.setdefault("called_from_command_line", parent_called_from_command_line)
+            except Exception:
+                # If we can't determine the parser class safely, don't inject
+                # Django-specific kwargs to avoid unexpected TypeErrors.
+                pass
+
+            return original_add_parser(name, **kw)
+
+        # Monkey-patch the returned action to inject our defaults whenever
+        # a new subparser is added.
+        subparsers.add_parser = add_parser
+        return subparsers
+
 
 def handle_default_options(options):
     """


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `tests/admin_scripts/tests.py` and all Python files inside `tests/admin_scripts/management/commands/`.
Extra Requirements: 
Purpose: This will provide the necessary context to find test cases that cover command-line argument parsing with subparsers and their error handling.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: tests/admin_scripts/tests.py
Line number range: 1 - 3062
Content:
1. """
2. A series of tests to establish that the command-line management tools work as
3. advertised - especially with regards to the handling of the
4. DJANGO_SETTINGS_MODULE and default settings.py files.
5. """
6. import os
7. import re
8. import shutil
9. import socket
10. import stat
11. import subprocess
12. import sys
13. import tempfile
14. import unittest
15. from io import StringIO
16. from unittest import mock
17. 
18. from django import conf, get_version
19. from django.conf import settings
20. from django.core.management import (
21.     BaseCommand,
22.     CommandError,
23.     call_command,
24.     color,
25.     execute_from_command_line,
26. )
27. from django.core.management.commands.loaddata import Command as LoaddataCommand
28. from django.core.management.commands.runserver import Command as RunserverCommand
29. from django.core.management.commands.testserver import Command as TestserverCommand
30. from django.db import ConnectionHandler, connection
31. from django.db.migrations.recorder import MigrationRecorder
32. from django.test import LiveServerTestCase, SimpleTestCase, TestCase, override_settings
33. from django.test.utils import captured_stderr, captured_stdout
34. from django.urls import path
35. from django.views.static import serve
36. 
37. from . import urls
38. 
39. custom_templates_dir = os.path.join(os.path.dirname(__file__), "custom_templates")
40. 
41. SYSTEM_CHECK_MSG = "System check identified no issues"
42. 
43. HAS_BLACK = shutil.which("black")
44. 
45. 
46. class AdminScriptTestCase(SimpleTestCase):
47.     def setUp(self):
48.         tmpdir = tempfile.TemporaryDirectory()
49.         self.addCleanup(tmpdir.cleanup)
50.         # os.path.realpath() is required for temporary directories on macOS,
51.         # where `/var` is a symlink to `/private/var`.
52.         self.test_dir = os.path.realpath(os.path.join(tmpdir.name, "test_project"))
53.         os.mkdir(self.test_dir)
54. 
55.     def write_settings(self, filename, apps=None, is_dir=False, sdict=None, extra=None):
56.         if is_dir:
57.             settings_dir = os.path.join(self.test_dir, filename)
58.             os.mkdir(settings_dir)
59.             settings_file_path = os.path.join(settings_dir, "__init__.py")
60.         else:
61.             settings_file_path = os.path.join(self.test_dir, filename)
62. 
63.         with open(settings_file_path, "w") as settings_file:
64.             settings_file.write(
65.                 "# Settings file automatically generated by admin_scripts test case\n"
66.             )
67.             if extra:
68.                 settings_file.write("%s\n" % extra)
69.             exports = [
70.                 "DATABASES",
71.                 "DEFAULT_AUTO_FIELD",
72.                 "ROOT_URLCONF",
73.                 "SECRET_KEY",
74.                 "USE_TZ",
75.             ]
76.             for s in exports:
77.                 if hasattr(settings, s):
78.                     o = getattr(settings, s)
79.                     if not isinstance(o, (dict, tuple, list)):
80.                         o = "'%s'" % o
81.                     settings_file.write("%s = %s\n" % (s, o))
82. 
83.             if apps is None:
84.                 apps = [
85.                     "django.contrib.auth",
86.                     "django.contrib.contenttypes",
87.                     "admin_scripts",
88.                 ]
89. 
90.             settings_file.write("INSTALLED_APPS = %s\n" % apps)
91. 
92.             if sdict:
93.                 for k, v in sdict.items():
94.                     settings_file.write("%s = %s\n" % (k, v))
95. 
96.     def _ext_backend_paths(self):
97.         """
98.         Returns the paths for any external backend packages.
99.         """
100.         paths = []
101.         for backend in settings.DATABASES.values():
102.             package = backend["ENGINE"].split(".")[0]
103.             if package != "django":
104.                 backend_pkg = __import__(package)
105.                 backend_dir = os.path.dirname(backend_pkg.__file__)
106.                 paths.append(os.path.dirname(backend_dir))
107.         return paths
108. 
109.     def run_test(self, args, settings_file=None, apps=None, umask=-1):
110.         base_dir = os.path.dirname(self.test_dir)
111.         # The base dir for Django's tests is one level up.
112.         tests_dir = os.path.dirname(os.path.dirname(__file__))
113.         # The base dir for Django is one level above the test dir. We don't use
114.         # `import django` to figure that out, so we don't pick up a Django
115.         # from site-packages or similar.
116.         django_dir = os.path.dirname(tests_dir)
117.         ext_backend_base_dirs = self._ext_backend_paths()
118. 
119.         # Define a temporary environment for the subprocess
120.         test_environ = os.environ.copy()
121. 
122.         # Set the test environment
123.         if settings_file:
124.             test_environ["DJANGO_SETTINGS_MODULE"] = settings_file
125.         elif "DJANGO_SETTINGS_MODULE" in test_environ:
126.             del test_environ["DJANGO_SETTINGS_MODULE"]
127.         python_path = [base_dir, django_dir, tests_dir]
128.         python_path.extend(ext_backend_base_dirs)
129.         test_environ["PYTHONPATH"] = os.pathsep.join(python_path)
130.         test_environ["PYTHONWARNINGS"] = ""
131. 
132.         p = subprocess.run(
133.             [sys.executable, *args],
134.             capture_output=True,
135.             cwd=self.test_dir,
136.             env=test_environ,
137.             text=True,
138.             umask=umask,
139.         )
140.         return p.stdout, p.stderr
141. 
142.     def run_django_admin(self, args, settings_file=None, umask=-1):
143.         return self.run_test(["-m", "django", *args], settings_file, umask=umask)
144. 
145.     def run_manage(self, args, settings_file=None, manage_py=None):
146.         template_manage_py = (
147.             os.path.join(os.path.dirname(__file__), manage_py)
148.             if manage_py
149.             else os.path.join(
150.                 os.path.dirname(conf.__file__), "project_template", "manage.py-tpl"
151.             )
152.         )
153.         test_manage_py = os.path.join(self.test_dir, "manage.py")
154.         shutil.copyfile(template_manage_py, test_manage_py)
155. 
156.         with open(test_manage_py) as fp:
157.             manage_py_contents = fp.read()
158.         manage_py_contents = manage_py_contents.replace(
159.             "{{ project_name }}", "test_project"
160.         )
161.         with open(test_manage_py, "w") as fp:
162.             fp.write(manage_py_contents)
163. 
164.         return self.run_test(["./manage.py", *args], settings_file)
165. 
166.     def assertNoOutput(self, stream):
167.         "Utility assertion: assert that the given stream is empty"
168.         self.assertEqual(
169.             len(stream), 0, "Stream should be empty: actually contains '%s'" % stream
170.         )
171. 
172.     def assertOutput(self, stream, msg, regex=False):
173.         "Utility assertion: assert that the given message exists in the output"
174.         if regex:
175.             self.assertIsNotNone(
176.                 re.search(msg, stream),
177.                 "'%s' does not match actual output text '%s'" % (msg, stream),
178.             )
179.         else:
180.             self.assertIn(
181.                 msg,
182.                 stream,
183.                 "'%s' does not match actual output text '%s'" % (msg, stream),
184.             )
185. 
186.     def assertNotInOutput(self, stream, msg):
187.         "Utility assertion: assert that the given message doesn't exist in the output"
188.         self.assertNotIn(
189.             msg, stream, "'%s' matches actual output text '%s'" % (msg, stream)
190.         )
191. 
192. 
193. ##########################################################################
194. # DJANGO ADMIN TESTS
195. # This first series of test classes checks the environment processing
196. # of the django-admin.
197. ##########################################################################
198. 
199. 
200. class DjangoAdminNoSettings(AdminScriptTestCase):
201.     "A series of tests for django-admin when there is no settings.py file."
202. 
203.     def test_builtin_command(self):
204.         """
205.         no settings: django-admin builtin commands fail with an error when no
206.         settings provided.
207.         """
208.         args = ["check", "admin_scripts"]
209.         out, err = self.run_django_admin(args)
210.         self.assertNoOutput(out)
211.         self.assertOutput(err, "settings are not configured")
212. 
213.     def test_builtin_with_bad_settings(self):
214.         """
215.         no settings: django-admin builtin commands fail if settings file (from
216.         argument) doesn't exist.
217.         """
218.         args = ["check", "--settings=bad_settings", "admin_scripts"]
219.         out, err = self.run_django_admin(args)
220.         self.assertNoOutput(out)
221.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
222. 
223.     def test_builtin_with_bad_environment(self):
224.         """
225.         no settings: django-admin builtin commands fail if settings file (from
226.         environment) doesn't exist.
227.         """
228.         args = ["check", "admin_scripts"]
229.         out, err = self.run_django_admin(args, "bad_settings")
230.         self.assertNoOutput(out)
231.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
232. 
233.     def test_commands_with_invalid_settings(self):
234.         """
235.         Commands that don't require settings succeed if the settings file
236.         doesn't exist.
237.         """
238.         args = ["startproject"]
239.         out, err = self.run_django_admin(args, settings_file="bad_settings")
240.         self.assertNoOutput(out)
241.         self.assertOutput(err, "You must provide a project name", regex=True)
242. 
243. 
244. class DjangoAdminDefaultSettings(AdminScriptTestCase):
245.     """
246.     A series of tests for django-admin when using a settings.py file that
247.     contains the test application.
248.     """
249. 
250.     def setUp(self):
251.         super().setUp()
252.         self.write_settings("settings.py")
253. 
254.     def test_builtin_command(self):
255.         """
256.         default: django-admin builtin commands fail with an error when no
257.         settings provided.
258.         """
259.         args = ["check", "admin_scripts"]
260.         out, err = self.run_django_admin(args)
261.         self.assertNoOutput(out)
262.         self.assertOutput(err, "settings are not configured")
263. 
264.     def test_builtin_with_settings(self):
265.         """
266.         default: django-admin builtin commands succeed if settings are provided
267.         as argument.
268.         """
269.         args = ["check", "--settings=test_project.settings", "admin_scripts"]
270.         out, err = self.run_django_admin(args)
271.         self.assertNoOutput(err)
272.         self.assertOutput(out, SYSTEM_CHECK_MSG)
273. 
274.     def test_builtin_with_environment(self):
275.         """
276.         default: django-admin builtin commands succeed if settings are provided
277.         in the environment.
278.         """
279.         args = ["check", "admin_scripts"]
280.         out, err = self.run_django_admin(args, "test_project.settings")
281.         self.assertNoOutput(err)
282.         self.assertOutput(out, SYSTEM_CHECK_MSG)
283. 
284.     def test_builtin_with_bad_settings(self):
285.         """
286.         default: django-admin builtin commands fail if settings file (from
287.         argument) doesn't exist.
288.         """
289.         args = ["check", "--settings=bad_settings", "admin_scripts"]
290.         out, err = self.run_django_admin(args)
291.         self.assertNoOutput(out)
292.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
293. 
294.     def test_builtin_with_bad_environment(self):
295.         """
296.         default: django-admin builtin commands fail if settings file (from
297.         environment) doesn't exist.
298.         """
299.         args = ["check", "admin_scripts"]
300.         out, err = self.run_django_admin(args, "bad_settings")
301.         self.assertNoOutput(out)
302.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
303. 
304.     def test_custom_command(self):
305.         """
306.         default: django-admin can't execute user commands if it isn't provided
307.         settings.
308.         """
309.         args = ["noargs_command"]
310.         out, err = self.run_django_admin(args)
311.         self.assertNoOutput(out)
312.         self.assertOutput(err, "No Django settings specified")
313.         self.assertOutput(err, "Unknown command: 'noargs_command'")
314. 
315.     def test_custom_command_with_settings(self):
316.         """
317.         default: django-admin can execute user commands if settings are
318.         provided as argument.
319.         """
320.         args = ["noargs_command", "--settings=test_project.settings"]
321.         out, err = self.run_django_admin(args)
322.         self.assertNoOutput(err)
323.         self.assertOutput(out, "EXECUTE: noargs_command")
324. 
325.     def test_custom_command_with_environment(self):
326.         """
327.         default: django-admin can execute user commands if settings are
328.         provided in environment.
329.         """
330.         args = ["noargs_command"]
331.         out, err = self.run_django_admin(args, "test_project.settings")
332.         self.assertNoOutput(err)
333.         self.assertOutput(out, "EXECUTE: noargs_command")
334. 
335. 
336. class DjangoAdminFullPathDefaultSettings(AdminScriptTestCase):
337.     """
338.     A series of tests for django-admin when using a settings.py file that
339.     contains the test application specified using a full path.
340.     """
341. 
342.     def setUp(self):
343.         super().setUp()
344.         self.write_settings(
345.             "settings.py",
346.             [
347.                 "django.contrib.auth",
348.                 "django.contrib.contenttypes",
349.                 "admin_scripts",
350.                 "admin_scripts.complex_app",
351.             ],
352.         )
353. 
354.     def test_builtin_command(self):
355.         """
356.         fulldefault: django-admin builtin commands fail with an error when no
357.         settings provided.
358.         """
359.         args = ["check", "admin_scripts"]
360.         out, err = self.run_django_admin(args)
361.         self.assertNoOutput(out)
362.         self.assertOutput(err, "settings are not configured")
363. 
364.     def test_builtin_with_settings(self):
365.         """
366.         fulldefault: django-admin builtin commands succeed if a settings file
367.         is provided.
368.         """
369.         args = ["check", "--settings=test_project.settings", "admin_scripts"]
370.         out, err = self.run_django_admin(args)
371.         self.assertNoOutput(err)
372.         self.assertOutput(out, SYSTEM_CHECK_MSG)
373. 
374.     def test_builtin_with_environment(self):
375.         """
376.         fulldefault: django-admin builtin commands succeed if the environment
377.         contains settings.
378.         """
379.         args = ["check", "admin_scripts"]
380.         out, err = self.run_django_admin(args, "test_project.settings")
381.         self.assertNoOutput(err)
382.         self.assertOutput(out, SYSTEM_CHECK_MSG)
383. 
384.     def test_builtin_with_bad_settings(self):
385.         """
386.         fulldefault: django-admin builtin commands fail if settings file (from
387.         argument) doesn't exist.
388.         """
389.         args = ["check", "--settings=bad_settings", "admin_scripts"]
390.         out, err = self.run_django_admin(args)
391.         self.assertNoOutput(out)
392.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
393. 
394.     def test_builtin_with_bad_environment(self):
395.         """
396.         fulldefault: django-admin builtin commands fail if settings file (from
397.         environment) doesn't exist.
398.         """
399.         args = ["check", "admin_scripts"]
400.         out, err = self.run_django_admin(args, "bad_settings")
401.         self.assertNoOutput(out)
402.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
403. 
404.     def test_custom_command(self):
405.         """
406.         fulldefault: django-admin can't execute user commands unless settings
407.         are provided.
408.         """
409.         args = ["noargs_command"]
410.         out, err = self.run_django_admin(args)
411.         self.assertNoOutput(out)
412.         self.assertOutput(err, "No Django settings specified")
413.         self.assertOutput(err, "Unknown command: 'noargs_command'")
414. 
415.     def test_custom_command_with_settings(self):
416.         """
417.         fulldefault: django-admin can execute user commands if settings are
418.         provided as argument.
419.         """
420.         args = ["noargs_command", "--settings=test_project.settings"]
421.         out, err = self.run_django_admin(args)
422.         self.assertNoOutput(err)
423.         self.assertOutput(out, "EXECUTE: noargs_command")
424. 
425.     def test_custom_command_with_environment(self):
426.         """
427.         fulldefault: django-admin can execute user commands if settings are
428.         provided in environment.
429.         """
430.         args = ["noargs_command"]
431.         out, err = self.run_django_admin(args, "test_project.settings")
432.         self.assertNoOutput(err)
433.         self.assertOutput(out, "EXECUTE: noargs_command")
434. 
435. 
436. class DjangoAdminMinimalSettings(AdminScriptTestCase):
437.     """
438.     A series of tests for django-admin when using a settings.py file that
439.     doesn't contain the test application.
440.     """
441. 
442.     def setUp(self):
443.         super().setUp()
444.         self.write_settings(
445.             "settings.py", apps=["django.contrib.auth", "django.contrib.contenttypes"]
446.         )
447. 
448.     def test_builtin_command(self):
449.         """
450.         minimal: django-admin builtin commands fail with an error when no
451.         settings provided.
452.         """
453.         args = ["check", "admin_scripts"]
454.         out, err = self.run_django_admin(args)
455.         self.assertNoOutput(out)
456.         self.assertOutput(err, "settings are not configured")
457. 
458.     def test_builtin_with_settings(self):
459.         """
460.         minimal: django-admin builtin commands fail if settings are provided as
461.         argument.
462.         """
463.         args = ["check", "--settings=test_project.settings", "admin_scripts"]
464.         out, err = self.run_django_admin(args)
465.         self.assertNoOutput(out)
466.         self.assertOutput(err, "No installed app with label 'admin_scripts'.")
467. 
468.     def test_builtin_with_environment(self):
469.         """
470.         minimal: django-admin builtin commands fail if settings are provided in
471.         the environment.
472.         """
473.         args = ["check", "admin_scripts"]
474.         out, err = self.run_django_admin(args, "test_project.settings")
475.         self.assertNoOutput(out)
476.         self.assertOutput(err, "No installed app with label 'admin_scripts'.")
477. 
478.     def test_builtin_with_bad_settings(self):
479.         """
480.         minimal: django-admin builtin commands fail if settings file (from
481.         argument) doesn't exist.
482.         """
483.         args = ["check", "--settings=bad_settings", "admin_scripts"]
484.         out, err = self.run_django_admin(args)
485.         self.assertNoOutput(out)
486.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
487. 
488.     def test_builtin_with_bad_environment(self):
489.         """
490.         minimal: django-admin builtin commands fail if settings file (from
491.         environment) doesn't exist.
492.         """
493.         args = ["check", "admin_scripts"]
494.         out, err = self.run_django_admin(args, "bad_settings")
495.         self.assertNoOutput(out)
496.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
497. 
498.     def test_custom_command(self):
499.         "minimal: django-admin can't execute user commands unless settings are provided"
500.         args = ["noargs_command"]
501.         out, err = self.run_django_admin(args)
502.         self.assertNoOutput(out)
503.         self.assertOutput(err, "No Django settings specified")
504.         self.assertOutput(err, "Unknown command: 'noargs_command'")
505. 
506.     def test_custom_command_with_settings(self):
507.         """
508.         minimal: django-admin can't execute user commands, even if settings are
509.         provided as argument.
510.         """
511.         args = ["noargs_command", "--settings=test_project.settings"]
512.         out, err = self.run_django_admin(args)
513.         self.assertNoOutput(out)
514.         self.assertOutput(err, "Unknown command: 'noargs_command'")
515. 
516.     def test_custom_command_with_environment(self):
517.         """
518.         minimal: django-admin can't execute user commands, even if settings are
519.         provided in environment.
520.         """
521.         args = ["noargs_command"]
522.         out, err = self.run_django_admin(args, "test_project.settings")
523.         self.assertNoOutput(out)
524.         self.assertOutput(err, "Unknown command: 'noargs_command'")
525. 
526. 
527. class DjangoAdminAlternateSettings(AdminScriptTestCase):
528.     """
529.     A series of tests for django-admin when using a settings file with a name
530.     other than 'settings.py'.
531.     """
532. 
533.     def setUp(self):
534.         super().setUp()
535.         self.write_settings("alternate_settings.py")
536. 
537.     def test_builtin_command(self):
538.         """
539.         alternate: django-admin builtin commands fail with an error when no
540.         settings provided.
541.         """
542.         args = ["check", "admin_scripts"]
543.         out, err = self.run_django_admin(args)
544.         self.assertNoOutput(out)
545.         self.assertOutput(err, "settings are not configured")
546. 
547.     def test_builtin_with_settings(self):
548.         """
549.         alternate: django-admin builtin commands succeed if settings are
550.         provided as argument.
551.         """
552.         args = ["check", "--settings=test_project.alternate_settings", "admin_scripts"]
553.         out, err = self.run_django_admin(args)
554.         self.assertNoOutput(err)
555.         self.assertOutput(out, SYSTEM_CHECK_MSG)
556. 
557.     def test_builtin_with_environment(self):
558.         """
559.         alternate: django-admin builtin commands succeed if settings are
560.         provided in the environment.
561.         """
562.         args = ["check", "admin_scripts"]
563.         out, err = self.run_django_admin(args, "test_project.alternate_settings")
564.         self.assertNoOutput(err)
565.         self.assertOutput(out, SYSTEM_CHECK_MSG)
566. 
567.     def test_builtin_with_bad_settings(self):
568.         """
569.         alternate: django-admin builtin commands fail if settings file (from
570.         argument) doesn't exist.
571.         """
572.         args = ["check", "--settings=bad_settings", "admin_scripts"]
573.         out, err = self.run_django_admin(args)
574.         self.assertNoOutput(out)
575.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
576. 
577.     def test_builtin_with_bad_environment(self):
578.         """
579.         alternate: django-admin builtin commands fail if settings file (from
580.         environment) doesn't exist.
581.         """
582.         args = ["check", "admin_scripts"]
583.         out, err = self.run_django_admin(args, "bad_settings")
584.         self.assertNoOutput(out)
585.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
586. 
587.     def test_custom_command(self):
588.         """
589.         alternate: django-admin can't execute user commands unless settings
590.         are provided.
591.         """
592.         args = ["noargs_command"]
593.         out, err = self.run_django_admin(args)
594.         self.assertNoOutput(out)
595.         self.assertOutput(err, "No Django settings specified")
596.         self.assertOutput(err, "Unknown command: 'noargs_command'")
597. 
598.     def test_custom_command_with_settings(self):
599.         """
600.         alternate: django-admin can execute user commands if settings are
601.         provided as argument.
602.         """
603.         args = ["noargs_command", "--settings=test_project.alternate_settings"]
604.         out, err = self.run_django_admin(args)
605.         self.assertNoOutput(err)
606.         self.assertOutput(out, "EXECUTE: noargs_command")
607. 
608.     def test_custom_command_with_environment(self):
609.         """
610.         alternate: django-admin can execute user commands if settings are
611.         provided in environment.
612.         """
613.         args = ["noargs_command"]
614.         out, err = self.run_django_admin(args, "test_project.alternate_settings")
615.         self.assertNoOutput(err)
616.         self.assertOutput(out, "EXECUTE: noargs_command")
617. 
618. 
619. class DjangoAdminMultipleSettings(AdminScriptTestCase):
620.     """
621.     A series of tests for django-admin when multiple settings files
622.     (including the default 'settings.py') are available. The default settings
623.     file is insufficient for performing the operations described, so the
624.     alternate settings must be used by the running script.
625.     """
626. 
627.     def setUp(self):
628.         super().setUp()
629.         self.write_settings(
630.             "settings.py", apps=["django.contrib.auth", "django.contrib.contenttypes"]
631.         )
632.         self.write_settings("alternate_settings.py")
633. 
634.     def test_builtin_command(self):
635.         """
636.         alternate: django-admin builtin commands fail with an error when no
637.         settings provided.
638.         """
639.         args = ["check", "admin_scripts"]
640.         out, err = self.run_django_admin(args)
641.         self.assertNoOutput(out)
642.         self.assertOutput(err, "settings are not configured")
643. 
644.     def test_builtin_with_settings(self):
645.         """
646.         alternate: django-admin builtin commands succeed if settings are
647.         provided as argument.
648.         """
649.         args = ["check", "--settings=test_project.alternate_settings", "admin_scripts"]
650.         out, err = self.run_django_admin(args)
651.         self.assertNoOutput(err)
652.         self.assertOutput(out, SYSTEM_CHECK_MSG)
653. 
654.     def test_builtin_with_environment(self):
655.         """
656.         alternate: django-admin builtin commands succeed if settings are
657.         provided in the environment.
658.         """
659.         args = ["check", "admin_scripts"]
660.         out, err = self.run_django_admin(args, "test_project.alternate_settings")
661.         self.assertNoOutput(err)
662.         self.assertOutput(out, SYSTEM_CHECK_MSG)
663. 
664.     def test_builtin_with_bad_settings(self):
665.         """
666.         alternate: django-admin builtin commands fail if settings file (from
667.         argument) doesn't exist.
668.         """
669.         args = ["check", "--settings=bad_settings", "admin_scripts"]
670.         out, err = self.run_django_admin(args)
671.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
672. 
673.     def test_builtin_with_bad_environment(self):
674.         """
675.         alternate: django-admin builtin commands fail if settings file (from
676.         environment) doesn't exist.
677.         """
678.         args = ["check", "admin_scripts"]
679.         out, err = self.run_django_admin(args, "bad_settings")
680.         self.assertNoOutput(out)
681.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
682. 
683.     def test_custom_command(self):
684.         """
685.         alternate: django-admin can't execute user commands unless settings are
686.         provided.
687.         """
688.         args = ["noargs_command"]
689.         out, err = self.run_django_admin(args)
690.         self.assertNoOutput(out)
691.         self.assertOutput(err, "No Django settings specified")
692.         self.assertOutput(err, "Unknown command: 'noargs_command'")
693. 
694.     def test_custom_command_with_settings(self):
695.         """
696.         alternate: django-admin can execute user commands if settings are
697.         provided as argument.
698.         """
699.         args = ["noargs_command", "--settings=test_project.alternate_settings"]
700.         out, err = self.run_django_admin(args)
701.         self.assertNoOutput(err)
702.         self.assertOutput(out, "EXECUTE: noargs_command")
703. 
704.     def test_custom_command_with_environment(self):
705.         """
706.         alternate: django-admin can execute user commands if settings are
707.         provided in environment.
708.         """
709.         args = ["noargs_command"]
710.         out, err = self.run_django_admin(args, "test_project.alternate_settings")
711.         self.assertNoOutput(err)
712.         self.assertOutput(out, "EXECUTE: noargs_command")
713. 
714. 
715. class DjangoAdminSettingsDirectory(AdminScriptTestCase):
716.     """
717.     A series of tests for django-admin when the settings file is in a
718.     directory. (see #9751).
719.     """
720. 
721.     def setUp(self):
722.         super().setUp()
723.         self.write_settings("settings", is_dir=True)
724. 
725.     def test_setup_environ(self):
726.         "directory: startapp creates the correct directory"
727.         args = ["startapp", "settings_test"]
728.         app_path = os.path.join(self.test_dir, "settings_test")
729.         out, err = self.run_django_admin(args, "test_project.settings")
730.         self.assertNoOutput(err)
731.         self.assertTrue(os.path.exists(app_path))
732.         with open(os.path.join(app_path, "apps.py")) as f:
733.             content = f.read()
734.             self.assertIn("class SettingsTestConfig(AppConfig)", content)
735.             self.assertIn(
736.                 'name = "settings_test"' if HAS_BLACK else "name = 'settings_test'",
737.                 content,
738.             )
739. 
740.     def test_setup_environ_custom_template(self):
741.         "directory: startapp creates the correct directory with a custom template"
742.         template_path = os.path.join(custom_templates_dir, "app_template")
743.         args = ["startapp", "--template", template_path, "custom_settings_test"]
744.         app_path = os.path.join(self.test_dir, "custom_settings_test")
745.         out, err = self.run_django_admin(args, "test_project.settings")
746.         self.assertNoOutput(err)
747.         self.assertTrue(os.path.exists(app_path))
748.         self.assertTrue(os.path.exists(os.path.join(app_path, "api.py")))
749. 
750.     def test_startapp_unicode_name(self):
751.         """startapp creates the correct directory with Unicode characters."""
752.         args = ["startapp", "こんにちは"]
753.         app_path = os.path.join(self.test_dir, "こんにちは")
754.         out, err = self.run_django_admin(args, "test_project.settings")
755.         self.assertNoOutput(err)
756.         self.assertTrue(os.path.exists(app_path))
757.         with open(os.path.join(app_path, "apps.py"), encoding="utf8") as f:
758.             content = f.read()
759.             self.assertIn("class こんにちはConfig(AppConfig)", content)
760.             self.assertIn('name = "こんにちは"' if HAS_BLACK else "name = 'こんにちは'", content)
761. 
762.     def test_builtin_command(self):
763.         """
764.         directory: django-admin builtin commands fail with an error when no
765.         settings provided.
766.         """
767.         args = ["check", "admin_scripts"]
768.         out, err = self.run_django_admin(args)
769.         self.assertNoOutput(out)
770.         self.assertOutput(err, "settings are not configured")
771. 
772.     def test_builtin_with_bad_settings(self):
773.         """
774.         directory: django-admin builtin commands fail if settings file (from
775.         argument) doesn't exist.
776.         """
777.         args = ["check", "--settings=bad_settings", "admin_scripts"]
778.         out, err = self.run_django_admin(args)
779.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
780. 
781.     def test_builtin_with_bad_environment(self):
782.         """
783.         directory: django-admin builtin commands fail if settings file (from
784.         environment) doesn't exist.
785.         """
786.         args = ["check", "admin_scripts"]
787.         out, err = self.run_django_admin(args, "bad_settings")
788.         self.assertNoOutput(out)
789.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
790. 
791.     def test_custom_command(self):
792.         """
793.         directory: django-admin can't execute user commands unless settings are
794.         provided.
795.         """
796.         args = ["noargs_command"]
797.         out, err = self.run_django_admin(args)
798.         self.assertNoOutput(out)
799.         self.assertOutput(err, "No Django settings specified")
800.         self.assertOutput(err, "Unknown command: 'noargs_command'")
801. 
802.     def test_builtin_with_settings(self):
803.         """
804.         directory: django-admin builtin commands succeed if settings are
805.         provided as argument.
806.         """
807.         args = ["check", "--settings=test_project.settings", "admin_scripts"]
808.         out, err = self.run_django_admin(args)
809.         self.assertNoOutput(err)
810.         self.assertOutput(out, SYSTEM_CHECK_MSG)
811. 
812.     def test_builtin_with_environment(self):
813.         """
814.         directory: django-admin builtin commands succeed if settings are
815.         provided in the environment.
816.         """
817.         args = ["check", "admin_scripts"]
818.         out, err = self.run_django_admin(args, "test_project.settings")
819.         self.assertNoOutput(err)
820.         self.assertOutput(out, SYSTEM_CHECK_MSG)
821. 
822. 
823. ##########################################################################
824. # MANAGE.PY TESTS
825. # This next series of test classes checks the environment processing
826. # of the generated manage.py script
827. ##########################################################################
828. 
829. 
830. class ManageManuallyConfiguredSettings(AdminScriptTestCase):
831.     """Customized manage.py calling settings.configure()."""
832. 
833.     def test_non_existent_command_output(self):
834.         out, err = self.run_manage(
835.             ["invalid_command"], manage_py="configured_settings_manage.py"
836.         )
837.         self.assertNoOutput(out)
838.         self.assertOutput(err, "Unknown command: 'invalid_command'")
839.         self.assertNotInOutput(err, "No Django settings specified")
840. 
841. 
842. class ManageNoSettings(AdminScriptTestCase):
843.     "A series of tests for manage.py when there is no settings.py file."
844. 
845.     def test_builtin_command(self):
846.         """
847.         no settings: manage.py builtin commands fail with an error when no
848.         settings provided.
849.         """
850.         args = ["check", "admin_scripts"]
851.         out, err = self.run_manage(args)
852.         self.assertNoOutput(out)
853.         self.assertOutput(
854.             err, r"No module named '?(test_project\.)?settings'?", regex=True
855.         )
856. 
857.     def test_builtin_with_bad_settings(self):
858.         """
859.         no settings: manage.py builtin commands fail if settings file (from
860.         argument) doesn't exist.
861.         """
862.         args = ["check", "--settings=bad_settings", "admin_scripts"]
863.         out, err = self.run_manage(args)
864.         self.assertNoOutput(out)
865.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
866. 
867.     def test_builtin_with_bad_environment(self):
868.         """
869.         no settings: manage.py builtin commands fail if settings file (from
870.         environment) doesn't exist.
871.         """
872.         args = ["check", "admin_scripts"]
873.         out, err = self.run_manage(args, "bad_settings")
874.         self.assertNoOutput(out)
875.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
876. 
877. 
878. class ManageDefaultSettings(AdminScriptTestCase):
879.     """A series of tests for manage.py when using a settings.py file that
880.     contains the test application.
881.     """
882. 
883.     def setUp(self):
884.         super().setUp()
885.         self.write_settings("settings.py")
886. 
887.     def test_builtin_command(self):
888.         """
889.         default: manage.py builtin commands succeed when default settings are
890.         appropriate.
891.         """
892.         args = ["check", "admin_scripts"]
893.         out, err = self.run_manage(args)
894.         self.assertNoOutput(err)
895.         self.assertOutput(out, SYSTEM_CHECK_MSG)
896. 
897.     def test_builtin_with_settings(self):
898.         """
899.         default: manage.py builtin commands succeed if settings are provided as
900.         argument.
901.         """
902.         args = ["check", "--settings=test_project.settings", "admin_scripts"]
903.         out, err = self.run_manage(args)
904.         self.assertNoOutput(err)
905.         self.assertOutput(out, SYSTEM_CHECK_MSG)
906. 
907.     def test_builtin_with_environment(self):
908.         """
909.         default: manage.py builtin commands succeed if settings are provided in
910.         the environment.
911.         """
912.         args = ["check", "admin_scripts"]
913.         out, err = self.run_manage(args, "test_project.settings")
914.         self.assertNoOutput(err)
915.         self.assertOutput(out, SYSTEM_CHECK_MSG)
916. 
917.     def test_builtin_with_bad_settings(self):
918.         """
919.         default: manage.py builtin commands succeed if settings file (from
920.         argument) doesn't exist.
921.         """
922.         args = ["check", "--settings=bad_settings", "admin_scripts"]
923.         out, err = self.run_manage(args)
924.         self.assertNoOutput(out)
925.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
926. 
927.     def test_builtin_with_bad_environment(self):
928.         """
929.         default: manage.py builtin commands fail if settings file (from
930.         environment) doesn't exist.
931.         """
932.         args = ["check", "admin_scripts"]
933.         out, err = self.run_manage(args, "bad_settings")
934.         self.assertNoOutput(out)
935.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
936. 
937.     def test_custom_command(self):
938.         """
939.         default: manage.py can execute user commands when default settings are
940.         appropriate.
941.         """
942.         args = ["noargs_command"]
943.         out, err = self.run_manage(args)
944.         self.assertNoOutput(err)
945.         self.assertOutput(out, "EXECUTE: noargs_command")
946. 
947.     def test_custom_command_with_settings(self):
948.         """
949.         default: manage.py can execute user commands when settings are provided
950.         as argument.
951.         """
952.         args = ["noargs_command", "--settings=test_project.settings"]
953.         out, err = self.run_manage(args)
954.         self.assertNoOutput(err)
955.         self.assertOutput(out, "EXECUTE: noargs_command")
956. 
957.     def test_custom_command_with_environment(self):
958.         """
959.         default: manage.py can execute user commands when settings are provided
960.         in environment.
961.         """
962.         args = ["noargs_command"]
963.         out, err = self.run_manage(args, "test_project.settings")
964.         self.assertNoOutput(err)
965.         self.assertOutput(out, "EXECUTE: noargs_command")
966. 
967. 
968. class ManageFullPathDefaultSettings(AdminScriptTestCase):
969.     """A series of tests for manage.py when using a settings.py file that
970.     contains the test application specified using a full path.
971.     """
972. 
973.     def setUp(self):
974.         super().setUp()
975.         self.write_settings(
976.             "settings.py",
977.             ["django.contrib.auth", "django.contrib.contenttypes", "admin_scripts"],
978.         )
979. 
980.     def test_builtin_command(self):
981.         """
982.         fulldefault: manage.py builtin commands succeed when default settings
983.         are appropriate.
984.         """
985.         args = ["check", "admin_scripts"]
986.         out, err = self.run_manage(args)
987.         self.assertNoOutput(err)
988.         self.assertOutput(out, SYSTEM_CHECK_MSG)
989. 
990.     def test_builtin_with_settings(self):
991.         """
992.         fulldefault: manage.py builtin commands succeed if settings are
993.         provided as argument.
994.         """
995.         args = ["check", "--settings=test_project.settings", "admin_scripts"]
996.         out, err = self.run_manage(args)
997.         self.assertNoOutput(err)
998.         self.assertOutput(out, SYSTEM_CHECK_MSG)
999. 
1000.     def test_builtin_with_environment(self):
1001.         """
1002.         fulldefault: manage.py builtin commands succeed if settings are
1003.         provided in the environment.
1004.         """
1005.         args = ["check", "admin_scripts"]
1006.         out, err = self.run_manage(args, "test_project.settings")
1007.         self.assertNoOutput(err)
1008.         self.assertOutput(out, SYSTEM_CHECK_MSG)
1009. 
1010.     def test_builtin_with_bad_settings(self):
1011.         """
1012.         fulldefault: manage.py builtin commands succeed if settings file (from
1013.         argument) doesn't exist.
1014.         """
1015.         args = ["check", "--settings=bad_settings", "admin_scripts"]
1016.         out, err = self.run_manage(args)
1017.         self.assertNoOutput(out)
1018.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
1019. 
1020.     def test_builtin_with_bad_environment(self):
1021.         """
1022.         fulldefault: manage.py builtin commands fail if settings file (from
1023.         environment) doesn't exist.
1024.         """
1025.         args = ["check", "admin_scripts"]
1026.         out, err = self.run_manage(args, "bad_settings")
1027.         self.assertNoOutput(out)
1028.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
1029. 
1030.     def test_custom_command(self):
1031.         """
1032.         fulldefault: manage.py can execute user commands when default settings
1033.         are appropriate.
1034.         """
1035.         args = ["noargs_command"]
1036.         out, err = self.run_manage(args)
1037.         self.assertNoOutput(err)
1038.         self.assertOutput(out, "EXECUTE: noargs_command")
1039. 
1040.     def test_custom_command_with_settings(self):
1041.         """
1042.         fulldefault: manage.py can execute user commands when settings are
1043.         provided as argument.
1044.         """
1045.         args = ["noargs_command", "--settings=test_project.settings"]
1046.         out, err = self.run_manage(args)
1047.         self.assertNoOutput(err)
1048.         self.assertOutput(out, "EXECUTE: noargs_command")
1049. 
1050.     def test_custom_command_with_environment(self):
1051.         """
1052.         fulldefault: manage.py can execute user commands when settings are
1053.         provided in environment.
1054.         """
1055.         args = ["noargs_command"]
1056.         out, err = self.run_manage(args, "test_project.settings")
1057.         self.assertNoOutput(err)
1058.         self.assertOutput(out, "EXECUTE: noargs_command")
1059. 
1060. 
1061. class ManageMinimalSettings(AdminScriptTestCase):
1062.     """A series of tests for manage.py when using a settings.py file that
1063.     doesn't contain the test application.
1064.     """
1065. 
1066.     def setUp(self):
1067.         super().setUp()
1068.         self.write_settings(
1069.             "settings.py", apps=["django.contrib.auth", "django.contrib.contenttypes"]
1070.         )
1071. 
1072.     def test_builtin_command(self):
1073.         """
1074.         minimal: manage.py builtin commands fail with an error when no settings
1075.         provided.
1076.         """
1077.         args = ["check", "admin_scripts"]
1078.         out, err = self.run_manage(args)
1079.         self.assertNoOutput(out)
1080.         self.assertOutput(err, "No installed app with label 'admin_scripts'.")
1081. 
1082.     def test_builtin_with_settings(self):
1083.         "minimal: manage.py builtin commands fail if settings are provided as argument"
1084.         args = ["check", "--settings=test_project.settings", "admin_scripts"]
1085.         out, err = self.run_manage(args)
1086.         self.assertNoOutput(out)
1087.         self.assertOutput(err, "No installed app with label 'admin_scripts'.")
1088. 
1089.     def test_builtin_with_environment(self):
1090.         """
1091.         minimal: manage.py builtin commands fail if settings are provided in
1092.         the environment.
1093.         """
1094.         args = ["check", "admin_scripts"]
1095.         out, err = self.run_manage(args, "test_project.settings")
1096.         self.assertNoOutput(out)
1097.         self.assertOutput(err, "No installed app with label 'admin_scripts'.")
1098. 
1099.     def test_builtin_with_bad_settings(self):
1100.         """
1101.         minimal: manage.py builtin commands fail if settings file (from
1102.         argument) doesn't exist.
1103.         """
1104.         args = ["check", "--settings=bad_settings", "admin_scripts"]
1105.         out, err = self.run_manage(args)
1106.         self.assertNoOutput(out)
1107.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
1108. 
1109.     def test_builtin_with_bad_environment(self):
1110.         """
1111.         minimal: manage.py builtin commands fail if settings file (from
1112.         environment) doesn't exist.
1113.         """
1114.         args = ["check", "admin_scripts"]
1115.         out, err = self.run_manage(args, "bad_settings")
1116.         self.assertNoOutput(out)
1117.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
1118. 
1119.     def test_custom_command(self):
1120.         "minimal: manage.py can't execute user commands without appropriate settings"
1121.         args = ["noargs_command"]
1122.         out, err = self.run_manage(args)
1123.         self.assertNoOutput(out)
1124.         self.assertOutput(err, "Unknown command: 'noargs_command'")
1125. 
1126.     def test_custom_command_with_settings(self):
1127.         """
1128.         minimal: manage.py can't execute user commands, even if settings are
1129.         provided as argument.
1130.         """
1131.         args = ["noargs_command", "--settings=test_project.settings"]
1132.         out, err = self.run_manage(args)
1133.         self.assertNoOutput(out)
1134.         self.assertOutput(err, "Unknown command: 'noargs_command'")
1135. 
1136.     def test_custom_command_with_environment(self):
1137.         """
1138.         minimal: manage.py can't execute user commands, even if settings are
1139.         provided in environment.
1140.         """
1141.         args = ["noargs_command"]
1142.         out, err = self.run_manage(args, "test_project.settings")
1143.         self.assertNoOutput(out)
1144.         self.assertOutput(err, "Unknown command: 'noargs_command'")
1145. 
1146. 
1147. class ManageAlternateSettings(AdminScriptTestCase):
1148.     """A series of tests for manage.py when using a settings file
1149.     with a name other than 'settings.py'.
1150.     """
1151. 
1152.     def setUp(self):
1153.         super().setUp()
1154.         self.write_settings("alternate_settings.py")
1155. 
1156.     def test_builtin_command(self):
1157.         """
1158.         alternate: manage.py builtin commands fail with an error when no
1159.         default settings provided.
1160.         """
1161.         args = ["check", "admin_scripts"]
1162.         out, err = self.run_manage(args)
1163.         self.assertNoOutput(out)
1164.         self.assertOutput(
1165.             err, r"No module named '?(test_project\.)?settings'?", regex=True
1166.         )
1167. 
1168.     def test_builtin_with_settings(self):
1169.         "alternate: manage.py builtin commands work with settings provided as argument"
1170.         args = ["check", "--settings=alternate_settings", "admin_scripts"]
1171.         out, err = self.run_manage(args)
1172.         self.assertOutput(out, SYSTEM_CHECK_MSG)
1173.         self.assertNoOutput(err)
1174. 
1175.     def test_builtin_with_environment(self):
1176.         """
1177.         alternate: manage.py builtin commands work if settings are provided in
1178.         the environment
1179.         """
1180.         args = ["check", "admin_scripts"]
1181.         out, err = self.run_manage(args, "alternate_settings")
1182.         self.assertOutput(out, SYSTEM_CHECK_MSG)
1183.         self.assertNoOutput(err)
1184. 
1185.     def test_builtin_with_bad_settings(self):
1186.         """
1187.         alternate: manage.py builtin commands fail if settings file (from
1188.         argument) doesn't exist.
1189.         """
1190.         args = ["check", "--settings=bad_settings", "admin_scripts"]
1191.         out, err = self.run_manage(args)
1192.         self.assertNoOutput(out)
1193.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
1194. 
1195.     def test_builtin_with_bad_environment(self):
1196.         """
1197.         alternate: manage.py builtin commands fail if settings file (from
1198.         environment) doesn't exist
1199.         """
1200.         args = ["check", "admin_scripts"]
1201.         out, err = self.run_manage(args, "bad_settings")
1202.         self.assertNoOutput(out)
1203.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
1204. 
1205.     def test_custom_command(self):
1206.         "alternate: manage.py can't execute user commands without settings"
1207.         args = ["noargs_command"]
1208.         out, err = self.run_manage(args)
1209.         self.assertNoOutput(out)
1210.         self.assertOutput(
1211.             err, r"No module named '?(test_project\.)?settings'?", regex=True
1212.         )
1213. 
1214.     def test_custom_command_with_settings(self):
1215.         """
1216.         alternate: manage.py can execute user commands if settings are provided
1217.         as argument
1218.         """
1219.         args = ["noargs_command", "--settings=alternate_settings"]
1220.         out, err = self.run_manage(args)
1221.         self.assertOutput(
1222.             out,
1223.             "EXECUTE: noargs_command options=[('force_color', False), "
1224.             "('no_color', False), ('pythonpath', None), ('settings', "
1225.             "'alternate_settings'), ('traceback', False), ('verbosity', 1)]",
1226.         )
1227.         self.assertNoOutput(err)
1228. 
1229.     def test_custom_command_with_environment(self):
1230.         """
1231.         alternate: manage.py can execute user commands if settings are provided
1232.         in environment.
1233.         """
1234.         args = ["noargs_command"]
1235.         out, err = self.run_manage(args, "alternate_settings")
1236.         self.assertOutput(
1237.             out,
1238.             "EXECUTE: noargs_command options=[('force_color', False), "
1239.             "('no_color', False), ('pythonpath', None), ('settings', None), "
1240.             "('traceback', False), ('verbosity', 1)]",
1241.         )
1242.         self.assertNoOutput(err)
1243. 
1244.     def test_custom_command_output_color(self):
1245.         """
1246.         alternate: manage.py output syntax color can be deactivated with the
1247.         `--no-color` option.
1248.         """
1249.         args = ["noargs_command", "--no-color", "--settings=alternate_settings"]
1250.         out, err = self.run_manage(args)
1251.         self.assertOutput(
1252.             out,
1253.             "EXECUTE: noargs_command options=[('force_color', False), "
1254.             "('no_color', True), ('pythonpath', None), ('settings', "
1255.             "'alternate_settings'), ('traceback', False), ('verbosity', 1)]",
1256.         )
1257.         self.assertNoOutput(err)
1258. 
1259. 
1260. class ManageMultipleSettings(AdminScriptTestCase):
1261.     """A series of tests for manage.py when multiple settings files
1262.     (including the default 'settings.py') are available. The default settings
1263.     file is insufficient for performing the operations described, so the
1264.     alternate settings must be used by the running script.
1265.     """
1266. 
1267.     def setUp(self):
1268.         super().setUp()
1269.         self.write_settings(
1270.             "settings.py", apps=["django.contrib.auth", "django.contrib.contenttypes"]
1271.         )
1272.         self.write_settings("alternate_settings.py")
1273. 
1274.     def test_builtin_command(self):
1275.         """
1276.         multiple: manage.py builtin commands fail with an error when no
1277.         settings provided.
1278.         """
1279.         args = ["check", "admin_scripts"]
1280.         out, err = self.run_manage(args)
1281.         self.assertNoOutput(out)
1282.         self.assertOutput(err, "No installed app with label 'admin_scripts'.")
1283. 
1284.     def test_builtin_with_settings(self):
1285.         """
1286.         multiple: manage.py builtin commands succeed if settings are provided
1287.         as argument.
1288.         """
1289.         args = ["check", "--settings=alternate_settings", "admin_scripts"]
1290.         out, err = self.run_manage(args)
1291.         self.assertNoOutput(err)
1292.         self.assertOutput(out, SYSTEM_CHECK_MSG)
1293. 
1294.     def test_builtin_with_environment(self):
1295.         """
1296.         multiple: manage.py can execute builtin commands if settings are
1297.         provided in the environment.
1298.         """
1299.         args = ["check", "admin_scripts"]
1300.         out, err = self.run_manage(args, "alternate_settings")
1301.         self.assertNoOutput(err)
1302.         self.assertOutput(out, SYSTEM_CHECK_MSG)
1303. 
1304.     def test_builtin_with_bad_settings(self):
1305.         """
1306.         multiple: manage.py builtin commands fail if settings file (from
1307.         argument) doesn't exist.
1308.         """
1309.         args = ["check", "--settings=bad_settings", "admin_scripts"]
1310.         out, err = self.run_manage(args)
1311.         self.assertNoOutput(out)
1312.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
1313. 
1314.     def test_builtin_with_bad_environment(self):
1315.         """
1316.         multiple: manage.py builtin commands fail if settings file (from
1317.         environment) doesn't exist.
1318.         """
1319.         args = ["check", "admin_scripts"]
1320.         out, err = self.run_manage(args, "bad_settings")
1321.         self.assertNoOutput(out)
1322.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
1323. 
1324.     def test_custom_command(self):
1325.         "multiple: manage.py can't execute user commands using default settings"
1326.         args = ["noargs_command"]
1327.         out, err = self.run_manage(args)
1328.         self.assertNoOutput(out)
1329.         self.assertOutput(err, "Unknown command: 'noargs_command'")
1330. 
1331.     def test_custom_command_with_settings(self):
1332.         """
1333.         multiple: manage.py can execute user commands if settings are provided
1334.         as argument.
1335.         """
1336.         args = ["noargs_command", "--settings=alternate_settings"]
1337.         out, err = self.run_manage(args)
1338.         self.assertNoOutput(err)
1339.         self.assertOutput(out, "EXECUTE: noargs_command")
1340. 
1341.     def test_custom_command_with_environment(self):
1342.         """
1343.         multiple: manage.py can execute user commands if settings are provided
1344.         in environment.
1345.         """
1346.         args = ["noargs_command"]
1347.         out, err = self.run_manage(args, "alternate_settings")
1348.         self.assertNoOutput(err)
1349.         self.assertOutput(out, "EXECUTE: noargs_command")
1350. 
1351. 
1352. class ManageSettingsWithSettingsErrors(AdminScriptTestCase):
1353.     """
1354.     Tests for manage.py when using the default settings.py file containing
1355.     runtime errors.
1356.     """
1357. 
1358.     def write_settings_with_import_error(self, filename):
1359.         settings_file_path = os.path.join(self.test_dir, filename)
1360.         with open(settings_file_path, "w") as settings_file:
1361.             settings_file.write(
1362.                 "# Settings file automatically generated by admin_scripts test case\n"
1363.             )
1364.             settings_file.write(
1365.                 "# The next line will cause an import error:\nimport foo42bar\n"
1366.             )
1367. 
1368.     def test_import_error(self):
1369.         """
1370.         import error: manage.py builtin commands shows useful diagnostic info
1371.         when settings with import errors is provided (#14130).
1372.         """
1373.         self.write_settings_with_import_error("settings.py")
1374.         args = ["check", "admin_scripts"]
1375.         out, err = self.run_manage(args)
1376.         self.assertNoOutput(out)
1377.         self.assertOutput(err, "No module named")
1378.         self.assertOutput(err, "foo42bar")
1379. 
1380.     def test_attribute_error(self):
1381.         """
1382.         manage.py builtin commands does not swallow attribute error due to bad
1383.         settings (#18845).
1384.         """
1385.         self.write_settings("settings.py", sdict={"BAD_VAR": "INSTALLED_APPS.crash"})
1386.         args = ["collectstatic", "admin_scripts"]
1387.         out, err = self.run_manage(args)
1388.         self.assertNoOutput(out)
1389.         self.assertOutput(err, "AttributeError: 'list' object has no attribute 'crash'")
1390. 
1391.     def test_key_error(self):
1392.         self.write_settings("settings.py", sdict={"BAD_VAR": 'DATABASES["blah"]'})
1393.         args = ["collectstatic", "admin_scripts"]
1394.         out, err = self.run_manage(args)
1395.         self.assertNoOutput(out)
1396.         self.assertOutput(err, "KeyError: 'blah'")
1397. 
1398.     def test_help(self):
1399.         """
1400.         Test listing available commands output note when only core commands are
1401.         available.
1402.         """
1403.         self.write_settings(
1404.             "settings.py",
1405.             extra="from django.core.exceptions import ImproperlyConfigured\n"
1406.             "raise ImproperlyConfigured()",
1407.         )
1408.         args = ["help"]
1409.         out, err = self.run_manage(args)
1410.         self.assertOutput(out, "only Django core commands are listed")
1411.         self.assertNoOutput(err)
1412. 
1413. 
1414. class ManageCheck(AdminScriptTestCase):
1415.     def test_nonexistent_app(self):
1416.         """check reports an error on a nonexistent app in INSTALLED_APPS."""
1417.         self.write_settings(
1418.             "settings.py",
1419.             apps=["admin_scriptz.broken_app"],
1420.             sdict={"USE_I18N": False},
1421.         )
1422.         args = ["check"]
1423.         out, err = self.run_manage(args)
1424.         self.assertNoOutput(out)
1425.         self.assertOutput(err, "ModuleNotFoundError")
1426.         self.assertOutput(err, "No module named")
1427.         self.assertOutput(err, "admin_scriptz")
1428. 
1429.     def test_broken_app(self):
1430.         """manage.py check reports an ImportError if an app's models.py
1431.         raises one on import"""
1432. 
1433.         self.write_settings("settings.py", apps=["admin_scripts.broken_app"])
1434.         args = ["check"]
1435.         out, err = self.run_manage(args)
1436.         self.assertNoOutput(out)
1437.         self.assertOutput(err, "ImportError")
1438. 
1439.     def test_complex_app(self):
1440.         """manage.py check does not raise an ImportError validating a
1441.         complex app with nested calls to load_app"""
1442. 
1443.         self.write_settings(
1444.             "settings.py",
1445.             apps=[
1446.                 "admin_scripts.complex_app",
1447.                 "admin_scripts.simple_app",
1448.                 "django.contrib.admin.apps.SimpleAdminConfig",
1449.                 "django.contrib.auth",
1450.                 "django.contrib.contenttypes",
1451.                 "django.contrib.messages",
1452.             ],
1453.             sdict={
1454.                 "DEBUG": True,
1455.                 "MIDDLEWARE": [
1456.                     "django.contrib.messages.middleware.MessageMiddleware",
1457.                     "django.contrib.auth.middleware.AuthenticationMiddleware",
1458.                     "django.contrib.sessions.middleware.SessionMiddleware",
1459.                 ],
1460.                 "TEMPLATES": [
1461.                     {
1462.                         "BACKEND": "django.template.backends.django.DjangoTemplates",
1463.                         "DIRS": [],
1464.                         "APP_DIRS": True,
1465.                         "OPTIONS": {
1466.                             "context_processors": [
1467.                                 "django.template.context_processors.request",
1468.                                 "django.contrib.auth.context_processors.auth",
1469.                                 "django.contrib.messages.context_processors.messages",
1470.                             ],
1471.                         },
1472.                     },
1473.                 ],
1474.             },
1475.         )
1476.         args = ["check"]
1477.         out, err = self.run_manage(args)
1478.         self.assertNoOutput(err)
1479.         self.assertEqual(out, "System check identified no issues (0 silenced).\n")
1480. 
1481.     def test_app_with_import(self):
1482.         """manage.py check does not raise errors when an app imports a base
1483.         class that itself has an abstract base."""
1484. 
1485.         self.write_settings(
1486.             "settings.py",
1487.             apps=[
1488.                 "admin_scripts.app_with_import",
1489.                 "django.contrib.auth",
1490.                 "django.contrib.contenttypes",
1491.                 "django.contrib.sites",
1492.             ],
1493.             sdict={"DEBUG": True},
1494.         )
1495.         args = ["check"]
1496.         out, err = self.run_manage(args)
1497.         self.assertNoOutput(err)
1498.         self.assertEqual(out, "System check identified no issues (0 silenced).\n")
1499. 
1500.     def test_output_format(self):
1501.         """All errors/warnings should be sorted by level and by message."""
1502. 
1503.         self.write_settings(
1504.             "settings.py",
1505.             apps=[
1506.                 "admin_scripts.app_raising_messages",
1507.                 "django.contrib.auth",
1508.                 "django.contrib.contenttypes",
1509.             ],
1510.             sdict={"DEBUG": True},
1511.         )
1512.         args = ["check"]
1513.         out, err = self.run_manage(args)
1514.         expected_err = (
1515.             "SystemCheckError: System check identified some issues:\n"
1516.             "\n"
1517.             "ERRORS:\n"
1518.             "?: An error\n"
1519.             "\tHINT: Error hint\n"
1520.             "\n"
1521.             "WARNINGS:\n"
1522.             "a: Second warning\n"
1523.             "obj: First warning\n"
1524.             "\tHINT: Hint\n"
1525.             "\n"
1526.             "System check identified 3 issues (0 silenced).\n"
1527.         )
1528.         self.assertEqual(err, expected_err)
1529.         self.assertNoOutput(out)
1530. 
1531.     def test_warning_does_not_halt(self):
1532.         """
1533.         When there are only warnings or less serious messages, then Django
1534.         should not prevent user from launching their project, so `check`
1535.         command should not raise `CommandError` exception.
1536. 
1537.         In this test we also test output format.
1538.         """
1539. 
1540.         self.write_settings(
1541.             "settings.py",
1542.             apps=[
1543.                 "admin_scripts.app_raising_warning",
1544.                 "django.contrib.auth",
1545.                 "django.contrib.contenttypes",
1546.             ],
1547.             sdict={"DEBUG": True},
1548.         )
1549.         args = ["check"]
1550.         out, err = self.run_manage(args)
1551.         expected_err = (
1552.             "System check identified some issues:\n"  # No "CommandError: " part
1553.             "\n"
1554.             "WARNINGS:\n"
1555.             "?: A warning\n"
1556.             "\n"
1557.             "System check identified 1 issue (0 silenced).\n"
1558.         )
1559.         self.assertEqual(err, expected_err)
1560.         self.assertNoOutput(out)
1561. 
1562. 
1563. class ManageRunserver(SimpleTestCase):
1564.     def setUp(self):
1565.         def monkey_run(*args, **options):
1566.             return
1567. 
1568.         self.output = StringIO()
1569.         self.cmd = RunserverCommand(stdout=self.output)
1570.         self.cmd.run = monkey_run
1571. 
1572.     def assertServerSettings(self, addr, port, ipv6=False, raw_ipv6=False):
1573.         self.assertEqual(self.cmd.addr, addr)
1574.         self.assertEqual(self.cmd.port, port)
1575.         self.assertEqual(self.cmd.use_ipv6, ipv6)
1576.         self.assertEqual(self.cmd._raw_ipv6, raw_ipv6)
1577. 
1578.     def test_runserver_addrport(self):
1579.         call_command(self.cmd)
1580.         self.assertServerSettings("127.0.0.1", "8000")
1581. 
1582.         call_command(self.cmd, addrport="1.2.3.4:8000")
1583.         self.assertServerSettings("1.2.3.4", "8000")
1584. 
1585.         call_command(self.cmd, addrport="7000")
1586.         self.assertServerSettings("127.0.0.1", "7000")
1587. 
1588.     @mock.patch("django.core.management.commands.runserver.run")
1589.     @mock.patch("django.core.management.base.BaseCommand.check_migrations")
1590.     def test_zero_ip_addr(self, *mocked_objects):
1591.         call_command(
1592.             "runserver",
1593.             addrport="0:8000",
1594.             use_reloader=False,
1595.             skip_checks=True,
1596.             stdout=self.output,
1597.         )
1598.         self.assertIn(
1599.             "Starting development server at http://0.0.0.0:8000/",
1600.             self.output.getvalue(),
1601.         )
1602. 
1603.     @unittest.skipUnless(socket.has_ipv6, "platform doesn't support IPv6")
1604.     def test_runner_addrport_ipv6(self):
1605.         call_command(self.cmd, addrport="", use_ipv6=True)
1606.         self.assertServerSettings("::1", "8000", ipv6=True, raw_ipv6=True)
1607. 
1608.         call_command(self.cmd, addrport="7000", use_ipv6=True)
1609.         self.assertServerSettings("::1", "7000", ipv6=True, raw_ipv6=True)
1610. 
1611.         call_command(self.cmd, addrport="[2001:0db8:1234:5678::9]:7000")
1612.         self.assertServerSettings(
1613.             "2001:0db8:1234:5678::9", "7000", ipv6=True, raw_ipv6=True
1614.         )
1615. 
1616.     def test_runner_hostname(self):
1617.         call_command(self.cmd, addrport="localhost:8000")
1618.         self.assertServerSettings("localhost", "8000")
1619. 
1620.         call_command(self.cmd, addrport="test.domain.local:7000")
1621.         self.assertServerSettings("test.domain.local", "7000")
1622. 
1623.     @unittest.skipUnless(socket.has_ipv6, "platform doesn't support IPv6")
1624.     def test_runner_hostname_ipv6(self):
1625.         call_command(self.cmd, addrport="test.domain.local:7000", use_ipv6=True)
1626.         self.assertServerSettings("test.domain.local", "7000", ipv6=True)
1627. 
1628.     def test_runner_custom_defaults(self):
1629.         self.cmd.default_addr = "0.0.0.0"
1630.         self.cmd.default_port = "5000"
1631.         call_command(self.cmd)
1632.         self.assertServerSettings("0.0.0.0", "5000")
1633. 
1634.     @unittest.skipUnless(socket.has_ipv6, "platform doesn't support IPv6")
1635.     def test_runner_custom_defaults_ipv6(self):
1636.         self.cmd.default_addr_ipv6 = "::"
1637.         call_command(self.cmd, use_ipv6=True)
1638.         self.assertServerSettings("::", "8000", ipv6=True, raw_ipv6=True)
1639. 
1640.     def test_runner_ambiguous(self):
1641.         # Only 4 characters, all of which could be in an ipv6 address
1642.         call_command(self.cmd, addrport="beef:7654")
1643.         self.assertServerSettings("beef", "7654")
1644. 
1645.         # Uses only characters that could be in an ipv6 address
1646.         call_command(self.cmd, addrport="deadbeef:7654")
1647.         self.assertServerSettings("deadbeef", "7654")
1648. 
1649.     def test_no_database(self):
1650.         """
1651.         Ensure runserver.check_migrations doesn't choke on empty DATABASES.
1652.         """
1653.         tested_connections = ConnectionHandler({})
1654.         with mock.patch(
1655.             "django.core.management.base.connections", new=tested_connections
1656.         ):
1657.             self.cmd.check_migrations()
1658. 
1659.     def test_readonly_database(self):
1660.         """
1661.         runserver.check_migrations() doesn't choke when a database is read-only.
1662.         """
1663.         with mock.patch.object(MigrationRecorder, "has_table", return_value=False):
1664.             self.cmd.check_migrations()
1665.         # You have # ...
1666.         self.assertIn("unapplied migration(s)", self.output.getvalue())
1667. 
1668.     @mock.patch("django.core.management.commands.runserver.run")
1669.     @mock.patch("django.core.management.base.BaseCommand.check_migrations")
1670.     @mock.patch("django.core.management.base.BaseCommand.check")
1671.     def test_skip_checks(self, mocked_check, *mocked_objects):
1672.         call_command(
1673.             "runserver",
1674.             use_reloader=False,
1675.             skip_checks=True,
1676.             stdout=self.output,
1677.         )
1678.         self.assertNotIn("Performing system checks...", self.output.getvalue())
1679.         mocked_check.assert_not_called()
1680. 
1681.         self.output.truncate(0)
1682.         call_command(
1683.             "runserver",
1684.             use_reloader=False,
1685.             skip_checks=False,
1686.             stdout=self.output,
1687.         )
1688.         self.assertIn("Performing system checks...", self.output.getvalue())
1689.         mocked_check.assert_called()
1690. 
1691. 
1692. class ManageRunserverMigrationWarning(TestCase):
1693.     def setUp(self):
1694.         self.stdout = StringIO()
1695.         self.runserver_command = RunserverCommand(stdout=self.stdout)
1696. 
1697.     @override_settings(INSTALLED_APPS=["admin_scripts.app_waiting_migration"])
1698.     def test_migration_warning_one_app(self):
1699.         self.runserver_command.check_migrations()
1700.         output = self.stdout.getvalue()
1701.         self.assertIn("You have 1 unapplied migration(s)", output)
1702.         self.assertIn("apply the migrations for app(s): app_waiting_migration.", output)
1703. 
1704.     @override_settings(
1705.         INSTALLED_APPS=[
1706.             "admin_scripts.app_waiting_migration",
1707.             "admin_scripts.another_app_waiting_migration",
1708.         ],
1709.     )
1710.     def test_migration_warning_multiple_apps(self):
1711.         self.runserver_command.check_migrations()
1712.         output = self.stdout.getvalue()
1713.         self.assertIn("You have 2 unapplied migration(s)", output)
1714.         self.assertIn(
1715.             "apply the migrations for app(s): another_app_waiting_migration, "
1716.             "app_waiting_migration.",
1717.             output,
1718.         )
1719. 
1720. 
1721. class ManageRunserverEmptyAllowedHosts(AdminScriptTestCase):
1722.     def setUp(self):
1723.         super().setUp()
1724.         self.write_settings(
1725.             "settings.py",
1726.             sdict={
1727.                 "ALLOWED_HOSTS": [],
1728.                 "DEBUG": False,
1729.             },
1730.         )
1731. 
1732.     def test_empty_allowed_hosts_error(self):
1733.         out, err = self.run_manage(["runserver"])
1734.         self.assertNoOutput(out)
1735.         self.assertOutput(
1736.             err, "CommandError: You must set settings.ALLOWED_HOSTS if DEBUG is False."
1737.         )
1738. 
1739. 
1740. class ManageRunserverHelpOutput(AdminScriptTestCase):
1741.     def test_suppressed_options(self):
1742.         """runserver doesn't support --verbosity and --trackback options."""
1743.         out, err = self.run_manage(["runserver", "--help"])
1744.         self.assertNotInOutput(out, "--verbosity")
1745.         self.assertNotInOutput(out, "--trackback")
1746.         self.assertOutput(out, "--settings")
1747. 
1748. 
1749. class ManageTestserver(SimpleTestCase):
1750.     @mock.patch.object(TestserverCommand, "handle", return_value="")
1751.     def test_testserver_handle_params(self, mock_handle):
1752.         out = StringIO()
1753.         call_command("testserver", "blah.json", stdout=out)
1754.         mock_handle.assert_called_with(
1755.             "blah.json",
1756.             stdout=out,
1757.             settings=None,
1758.             pythonpath=None,
1759.             verbosity=1,
1760.             traceback=False,
1761.             addrport="",
1762.             no_color=False,
1763.             use_ipv6=False,
1764.             skip_checks=True,
1765.             interactive=True,
1766.             force_color=False,
1767.         )
1768. 
1769.     @mock.patch("django.db.connection.creation.create_test_db", return_value="test_db")
1770.     @mock.patch.object(LoaddataCommand, "handle", return_value="")
1771.     @mock.patch.object(RunserverCommand, "handle", return_value="")
1772.     def test_params_to_runserver(
1773.         self, mock_runserver_handle, mock_loaddata_handle, mock_create_test_db
1774.     ):
1775.         call_command("testserver", "blah.json")
1776.         mock_runserver_handle.assert_called_with(
1777.             addrport="",
1778.             force_color=False,
1779.             insecure_serving=False,
1780.             no_color=False,
1781.             pythonpath=None,
1782.             settings=None,
1783.             shutdown_message=(
1784.                 "\nServer stopped.\nNote that the test database, 'test_db', "
1785.                 "has not been deleted. You can explore it on your own."
1786.             ),
1787.             skip_checks=True,
1788.             traceback=False,
1789.             use_ipv6=False,
1790.             use_reloader=False,
1791.             use_static_handler=True,
1792.             use_threading=connection.features.test_db_allows_multiple_connections,
1793.             verbosity=1,
1794.         )
1795. 
1796. 
1797. ##########################################################################
1798. # COMMAND PROCESSING TESTS
1799. # user-space commands are correctly handled - in particular, arguments to
1800. # the commands are correctly parsed and processed.
1801. ##########################################################################
1802. class ColorCommand(BaseCommand):
1803.     requires_system_checks = []
1804. 
1805.     def handle(self, *args, **options):
1806.         self.stdout.write("Hello, world!", self.style.ERROR)
1807.         self.stderr.write("Hello, world!", self.style.ERROR)
1808. 
1809. 
1810. class CommandTypes(AdminScriptTestCase):
1811.     "Tests for the various types of base command types that can be defined."
1812. 
1813.     def setUp(self):
1814.         super().setUp()
1815.         self.write_settings("settings.py")
1816. 
1817.     def test_version(self):
1818.         "version is handled as a special case"
1819.         args = ["version"]
1820.         out, err = self.run_manage(args)
1821.         self.assertNoOutput(err)
1822.         self.assertOutput(out, get_version())
1823. 
1824.     def test_version_alternative(self):
1825.         "--version is equivalent to version"
1826.         args1, args2 = ["version"], ["--version"]
1827.         # It's possible one outputs on stderr and the other on stdout, hence the set
1828.         self.assertEqual(set(self.run_manage(args1)), set(self.run_manage(args2)))
1829. 
1830.     def test_help(self):
1831.         "help is handled as a special case"
1832.         args = ["help"]
1833.         out, err = self.run_manage(args)
1834.         self.assertOutput(
1835.             out, "Type 'manage.py help <subcommand>' for help on a specific subcommand."
1836.         )
1837.         self.assertOutput(out, "[django]")
1838.         self.assertOutput(out, "startapp")
1839.         self.assertOutput(out, "startproject")
1840. 
1841.     def test_help_commands(self):
1842.         "help --commands shows the list of all available commands"
1843.         args = ["help", "--commands"]
1844.         out, err = self.run_manage(args)
1845.         self.assertNotInOutput(out, "usage:")
1846.         self.assertNotInOutput(out, "Options:")
1847.         self.assertNotInOutput(out, "[django]")
1848.         self.assertOutput(out, "startapp")
1849.         self.assertOutput(out, "startproject")
1850.         self.assertNotInOutput(out, "\n\n")
1851. 
1852.     def test_help_alternative(self):
1853.         "--help is equivalent to help"
1854.         args1, args2 = ["help"], ["--help"]
1855.         self.assertEqual(self.run_manage(args1), self.run_manage(args2))
1856. 
1857.     def test_help_short_altert(self):
1858.         "-h is handled as a short form of --help"
1859.         args1, args2 = ["--help"], ["-h"]
1860.         self.assertEqual(self.run_manage(args1), self.run_manage(args2))
1861. 
1862.     def test_specific_help(self):
1863.         "--help can be used on a specific command"
1864.         args = ["check", "--help"]
1865.         out, err = self.run_manage(args)
1866.         self.assertNoOutput(err)
1867.         # Command-specific options like --tag appear before options common to
1868.         # all commands like --version.
1869.         tag_location = out.find("--tag")
1870.         version_location = out.find("--version")
1871.         self.assertNotEqual(tag_location, -1)
1872.         self.assertNotEqual(version_location, -1)
1873.         self.assertLess(tag_location, version_location)
1874.         self.assertOutput(
1875.             out, "Checks the entire Django project for potential problems."
1876.         )
1877. 
1878.     def test_help_default_options_with_custom_arguments(self):
1879.         args = ["base_command", "--help"]
1880.         out, err = self.run_manage(args)
1881.         self.assertNoOutput(err)
1882.         expected_options = [
1883.             "-h",
1884.             "--option_a OPTION_A",
1885.             "--option_b OPTION_B",
1886.             "--option_c OPTION_C",
1887.             "--version",
1888.             "-v {0,1,2,3}",
1889.             "--settings SETTINGS",
1890.             "--pythonpath PYTHONPATH",
1891.             "--traceback",
1892.             "--no-color",
1893.             "--force-color",
1894.             "args ...",
1895.         ]
1896.         for option in expected_options:
1897.             self.assertOutput(out, f"[{option}]")
1898.         self.assertOutput(out, "--option_a OPTION_A, -a OPTION_A")
1899.         self.assertOutput(out, "--option_b OPTION_B, -b OPTION_B")
1900.         self.assertOutput(out, "--option_c OPTION_C, -c OPTION_C")
1901.         self.assertOutput(out, "-v {0,1,2,3}, --verbosity {0,1,2,3}")
1902. 
1903.     def test_color_style(self):
1904.         style = color.no_style()
1905.         self.assertEqual(style.ERROR("Hello, world!"), "Hello, world!")
1906. 
1907.         style = color.make_style("nocolor")
1908.         self.assertEqual(style.ERROR("Hello, world!"), "Hello, world!")
1909. 
1910.         style = color.make_style("dark")
1911.         self.assertIn("Hello, world!", style.ERROR("Hello, world!"))
1912.         self.assertNotEqual(style.ERROR("Hello, world!"), "Hello, world!")
1913. 
1914.         # Default palette has color.
1915.         style = color.make_style("")
1916.         self.assertIn("Hello, world!", style.ERROR("Hello, world!"))
1917.         self.assertNotEqual(style.ERROR("Hello, world!"), "Hello, world!")
1918. 
1919.     def test_command_color(self):
1920.         out = StringIO()
1921.         err = StringIO()
1922.         command = ColorCommand(stdout=out, stderr=err)
1923.         call_command(command)
1924.         if color.supports_color():
1925.             self.assertIn("Hello, world!\n", out.getvalue())
1926.             self.assertIn("Hello, world!\n", err.getvalue())
1927.             self.assertNotEqual(out.getvalue(), "Hello, world!\n")
1928.             self.assertNotEqual(err.getvalue(), "Hello, world!\n")
1929.         else:
1930.             self.assertEqual(out.getvalue(), "Hello, world!\n")
1931.             self.assertEqual(err.getvalue(), "Hello, world!\n")
1932. 
1933.     def test_command_no_color(self):
1934.         "--no-color prevent colorization of the output"
1935.         out = StringIO()
1936.         err = StringIO()
1937.         command = ColorCommand(stdout=out, stderr=err, no_color=True)
1938.         call_command(command)
1939.         self.assertEqual(out.getvalue(), "Hello, world!\n")
1940.         self.assertEqual(err.getvalue(), "Hello, world!\n")
1941. 
1942.         out = StringIO()
1943.         err = StringIO()
1944.         command = ColorCommand(stdout=out, stderr=err)
1945.         call_command(command, no_color=True)
1946.         self.assertEqual(out.getvalue(), "Hello, world!\n")
1947.         self.assertEqual(err.getvalue(), "Hello, world!\n")
1948. 
1949.     def test_force_color_execute(self):
1950.         out = StringIO()
1951.         err = StringIO()
1952.         with mock.patch.object(sys.stdout, "isatty", lambda: False):
1953.             command = ColorCommand(stdout=out, stderr=err)
1954.             call_command(command, force_color=True)
1955.         self.assertEqual(out.getvalue(), "\x1b[31;1mHello, world!\n\x1b[0m")
1956.         self.assertEqual(err.getvalue(), "\x1b[31;1mHello, world!\n\x1b[0m")
1957. 
1958.     def test_force_color_command_init(self):
1959.         out = StringIO()
1960.         err = StringIO()
1961.         with mock.patch.object(sys.stdout, "isatty", lambda: False):
1962.             command = ColorCommand(stdout=out, stderr=err, force_color=True)
1963.             call_command(command)
1964.         self.assertEqual(out.getvalue(), "\x1b[31;1mHello, world!\n\x1b[0m")
1965.         self.assertEqual(err.getvalue(), "\x1b[31;1mHello, world!\n\x1b[0m")
1966. 
1967.     def test_no_color_force_color_mutually_exclusive_execute(self):
1968.         msg = "The --no-color and --force-color options can't be used together."
1969.         with self.assertRaisesMessage(CommandError, msg):
1970.             call_command(BaseCommand(), no_color=True, force_color=True)
1971. 
1972.     def test_no_color_force_color_mutually_exclusive_command_init(self):
1973.         msg = "'no_color' and 'force_color' can't be used together."
1974.         with self.assertRaisesMessage(CommandError, msg):
1975.             call_command(BaseCommand(no_color=True, force_color=True))
1976. 
1977.     def test_custom_stdout(self):
1978.         class Command(BaseCommand):
1979.             requires_system_checks = []
1980. 
1981.             def handle(self, *args, **options):
1982.                 self.stdout.write("Hello, World!")
1983. 
1984.         out = StringIO()
1985.         command = Command(stdout=out)
1986.         call_command(command)
1987.         self.assertEqual(out.getvalue(), "Hello, World!\n")
1988.         out.truncate(0)
1989.         new_out = StringIO()
1990.         call_command(command, stdout=new_out)
1991.         self.assertEqual(out.getvalue(), "")
1992.         self.assertEqual(new_out.getvalue(), "Hello, World!\n")
1993. 
1994.     def test_custom_stderr(self):
1995.         class Command(BaseCommand):
1996.             requires_system_checks = []
1997. 
1998.             def handle(self, *args, **options):
1999.                 self.stderr.write("Hello, World!")
2000. 
2001.         err = StringIO()
2002.         command = Command(stderr=err)
2003.         call_command(command)
2004.         self.assertEqual(err.getvalue(), "Hello, World!\n")
2005.         err.truncate(0)
2006.         new_err = StringIO()
2007.         call_command(command, stderr=new_err)
2008.         self.assertEqual(err.getvalue(), "")
2009.         self.assertEqual(new_err.getvalue(), "Hello, World!\n")
2010. 
2011.     def test_base_command(self):
2012.         "User BaseCommands can execute when a label is provided"
2013.         args = ["base_command", "testlabel"]
2014.         expected_labels = "('testlabel',)"
2015.         self._test_base_command(args, expected_labels)
2016. 
2017.     def test_base_command_no_label(self):
2018.         "User BaseCommands can execute when no labels are provided"
2019.         args = ["base_command"]
2020.         expected_labels = "()"
2021.         self._test_base_command(args, expected_labels)
2022. 
2023.     def test_base_command_multiple_label(self):
2024.         "User BaseCommands can execute when no labels are provided"
2025.         args = ["base_command", "testlabel", "anotherlabel"]
2026.         expected_labels = "('testlabel', 'anotherlabel')"
2027.         self._test_base_command(args, expected_labels)
2028. 
2029.     def test_base_command_with_option(self):
2030.         "User BaseCommands can execute with options when a label is provided"
2031.         args = ["base_command", "testlabel", "--option_a=x"]
2032.         expected_labels = "('testlabel',)"
2033.         self._test_base_command(args, expected_labels, option_a="'x'")
2034. 
2035.     def test_base_command_with_options(self):
2036.         "User BaseCommands can execute with multiple options when a label is provided"
2037.         args = ["base_command", "testlabel", "-a", "x", "--option_b=y"]
2038.         expected_labels = "('testlabel',)"
2039.         self._test_base_command(args, expected_labels, option_a="'x'", option_b="'y'")
2040. 
2041.     def test_base_command_with_wrong_option(self):
2042.         "User BaseCommands outputs command usage when wrong option is specified"
2043.         args = ["base_command", "--invalid"]
2044.         out, err = self.run_manage(args)
2045.         self.assertNoOutput(out)
2046.         self.assertOutput(err, "usage: manage.py base_command")
2047.         self.assertOutput(err, "error: unrecognized arguments: --invalid")
2048. 
2049.     def _test_base_command(self, args, labels, option_a="'1'", option_b="'2'"):
2050.         out, err = self.run_manage(args)
2051. 
2052.         expected_out = (
2053.             "EXECUTE:BaseCommand labels=%s, "
2054.             "options=[('force_color', False), ('no_color', False), "
2055.             "('option_a', %s), ('option_b', %s), ('option_c', '3'), "
2056.             "('pythonpath', None), ('settings', None), ('traceback', False), "
2057.             "('verbosity', 1)]"
2058.         ) % (labels, option_a, option_b)
2059.         self.assertNoOutput(err)
2060.         self.assertOutput(out, expected_out)
2061. 
2062.     def test_base_run_from_argv(self):
2063.         """
2064.         Test run_from_argv properly terminates even with custom execute() (#19665)
2065.         Also test proper traceback display.
2066.         """
2067.         err = StringIO()
2068.         command = BaseCommand(stderr=err)
2069. 
2070.         def raise_command_error(*args, **kwargs):
2071.             raise CommandError("Custom error")
2072. 
2073.         command.execute = lambda args: args  # This will trigger TypeError
2074. 
2075.         # If the Exception is not CommandError it should always
2076.         # raise the original exception.
2077.         with self.assertRaises(TypeError):
2078.             command.run_from_argv(["", ""])
2079. 
2080.         # If the Exception is CommandError and --traceback is not present
2081.         # this command should raise a SystemExit and don't print any
2082.         # traceback to the stderr.
2083.         command.execute = raise_command_error
2084.         err.truncate(0)
2085.         with self.assertRaises(SystemExit):
2086.             command.run_from_argv(["", ""])
2087.         err_message = err.getvalue()
2088.         self.assertNotIn("Traceback", err_message)
2089.         self.assertIn("CommandError", err_message)
2090. 
2091.         # If the Exception is CommandError and --traceback is present
2092.         # this command should raise the original CommandError as if it
2093.         # were not a CommandError.
2094.         err.truncate(0)
2095.         with self.assertRaises(CommandError):
2096.             command.run_from_argv(["", "", "--traceback"])
2097. 
2098.     def test_run_from_argv_non_ascii_error(self):
2099.         """
2100.         Non-ASCII message of CommandError does not raise any
2101.         UnicodeDecodeError in run_from_argv.
2102.         """
2103. 
2104.         def raise_command_error(*args, **kwargs):
2105.             raise CommandError("Erreur personnalisée")
2106. 
2107.         command = BaseCommand(stderr=StringIO())
2108.         command.execute = raise_command_error
2109. 
2110.         with self.assertRaises(SystemExit):
2111.             command.run_from_argv(["", ""])
2112. 
2113.     def test_run_from_argv_closes_connections(self):
2114.         """
2115.         A command called from the command line should close connections after
2116.         being executed (#21255).
2117.         """
2118.         command = BaseCommand()
2119.         command.check = lambda: []
2120.         command.handle = lambda *args, **kwargs: args
2121.         with mock.patch("django.core.management.base.connections") as mock_connections:
2122.             command.run_from_argv(["", ""])
2123.         # Test connections have been closed
2124.         self.assertTrue(mock_connections.close_all.called)
2125. 
2126.     def test_noargs(self):
2127.         "NoArg Commands can be executed"
2128.         args = ["noargs_command"]
2129.         out, err = self.run_manage(args)
2130.         self.assertNoOutput(err)
2131.         self.assertOutput(
2132.             out,
2133.             "EXECUTE: noargs_command options=[('force_color', False), "
2134.             "('no_color', False), ('pythonpath', None), ('settings', None), "
2135.             "('traceback', False), ('verbosity', 1)]",
2136.         )
2137. 
2138.     def test_noargs_with_args(self):
2139.         "NoArg Commands raise an error if an argument is provided"
2140.         args = ["noargs_command", "argument"]
2141.         out, err = self.run_manage(args)
2142.         self.assertOutput(err, "error: unrecognized arguments: argument")
2143. 
2144.     def test_app_command(self):
2145.         "User AppCommands can execute when a single app name is provided"
2146.         args = ["app_command", "auth"]
2147.         out, err = self.run_manage(args)
2148.         self.assertNoOutput(err)
2149.         self.assertOutput(out, "EXECUTE:AppCommand name=django.contrib.auth, options=")
2150.         self.assertOutput(
2151.             out,
2152.             ", options=[('force_color', False), ('no_color', False), "
2153.             "('pythonpath', None), ('settings', None), ('traceback', False), "
2154.             "('verbosity', 1)]",
2155.         )
2156. 
2157.     def test_app_command_no_apps(self):
2158.         "User AppCommands raise an error when no app name is provided"
2159.         args = ["app_command"]
2160.         out, err = self.run_manage(args)
2161.         self.assertOutput(err, "error: Enter at least one application label.")
2162. 
2163.     def test_app_command_multiple_apps(self):
2164.         "User AppCommands raise an error when multiple app names are provided"
2165.         args = ["app_command", "auth", "contenttypes"]
2166.         out, err = self.run_manage(args)
2167.         self.assertNoOutput(err)
2168.         self.assertOutput(out, "EXECUTE:AppCommand name=django.contrib.auth, options=")
2169.         self.assertOutput(
2170.             out,
2171.             ", options=[('force_color', False), ('no_color', False), "
2172.             "('pythonpath', None), ('settings', None), ('traceback', False), "
2173.             "('verbosity', 1)]",
2174.         )
2175.         self.assertOutput(
2176.             out, "EXECUTE:AppCommand name=django.contrib.contenttypes, options="
2177.         )
2178.         self.assertOutput(
2179.             out,
2180.             ", options=[('force_color', False), ('no_color', False), "
2181.             "('pythonpath', None), ('settings', None), ('traceback', False), "
2182.             "('verbosity', 1)]",
2183.         )
2184. 
2185.     def test_app_command_invalid_app_label(self):
2186.         "User AppCommands can execute when a single app name is provided"
2187.         args = ["app_command", "NOT_AN_APP"]
2188.         out, err = self.run_manage(args)
2189.         self.assertOutput(err, "No installed app with label 'NOT_AN_APP'.")
2190. 
2191.     def test_app_command_some_invalid_app_labels(self):
2192.         "User AppCommands can execute when some of the provided app names are invalid"
2193.         args = ["app_command", "auth", "NOT_AN_APP"]
2194.         out, err = self.run_manage(args)
2195.         self.assertOutput(err, "No installed app with label 'NOT_AN_APP'.")
2196. 
2197.     def test_label_command(self):
2198.         "User LabelCommands can execute when a label is provided"
2199.         args = ["label_command", "testlabel"]
2200.         out, err = self.run_manage(args)
2201.         self.assertNoOutput(err)
2202.         self.assertOutput(
2203.             out,
2204.             "EXECUTE:LabelCommand label=testlabel, options=[('force_color', "
2205.             "False), ('no_color', False), ('pythonpath', None), ('settings', "
2206.             "None), ('traceback', False), ('verbosity', 1)]",
2207.         )
2208. 
2209.     def test_label_command_no_label(self):
2210.         "User LabelCommands raise an error if no label is provided"
2211.         args = ["label_command"]
2212.         out, err = self.run_manage(args)
2213.         self.assertOutput(err, "Enter at least one label")
2214. 
2215.     def test_label_command_multiple_label(self):
2216.         "User LabelCommands are executed multiple times if multiple labels are provided"
2217.         args = ["label_command", "testlabel", "anotherlabel"]
2218.         out, err = self.run_manage(args)
2219.         self.assertNoOutput(err)
2220.         self.assertOutput(
2221.             out,
2222.             "EXECUTE:LabelCommand label=testlabel, options=[('force_color', "
2223.             "False), ('no_color', False), ('pythonpath', None), "
2224.             "('settings', None), ('traceback', False), ('verbosity', 1)]",
2225.         )
2226.         self.assertOutput(
2227.             out,
2228.             "EXECUTE:LabelCommand label=anotherlabel, options=[('force_color', "
2229.             "False), ('no_color', False), ('pythonpath', None), "
2230.             "('settings', None), ('traceback', False), ('verbosity', 1)]",
2231.         )
2232. 
2233.     def test_suppress_base_options_command_help(self):
2234.         args = ["suppress_base_options_command", "--help"]
2235.         out, err = self.run_manage(args)
2236.         self.assertNoOutput(err)
2237.         self.assertOutput(out, "Test suppress base options command.")
2238.         self.assertNotInOutput(out, "input file")
2239.         self.assertOutput(out, "-h, --help")
2240.         self.assertNotInOutput(out, "--version")
2241.         self.assertNotInOutput(out, "--verbosity")
2242.         self.assertNotInOutput(out, "-v {0,1,2,3}")
2243.         self.assertNotInOutput(out, "--settings")
2244.         self.assertNotInOutput(out, "--pythonpath")
2245.         self.assertNotInOutput(out, "--traceback")
2246.         self.assertNotInOutput(out, "--no-color")
2247.         self.assertNotInOutput(out, "--force-color")
2248. 
2249.     def test_suppress_base_options_command_defaults(self):
2250.         args = ["suppress_base_options_command"]
2251.         out, err = self.run_manage(args)
2252.         self.assertNoOutput(err)
2253.         self.assertOutput(
2254.             out,
2255.             "EXECUTE:SuppressBaseOptionsCommand options=[('file', None), "
2256.             "('force_color', False), ('no_color', False), "
2257.             "('pythonpath', None), ('settings', None), "
2258.             "('traceback', False), ('verbosity', 1)]",
2259.         )
2260. 
2261. 
2262. class Discovery(SimpleTestCase):
2263.     def test_precedence(self):
2264.         """
2265.         Apps listed first in INSTALLED_APPS have precedence.
2266.         """
2267.         with self.settings(
2268.             INSTALLED_APPS=[
2269.                 "admin_scripts.complex_app",
2270.                 "admin_scripts.simple_app",
2271.                 "django.contrib.auth",
2272.                 "django.contrib.contenttypes",
2273.             ]
2274.         ):
2275.             out = StringIO()
2276.             call_command("duplicate", stdout=out)
2277.             self.assertEqual(out.getvalue().strip(), "complex_app")
2278.         with self.settings(
2279.             INSTALLED_APPS=[
2280.                 "admin_scripts.simple_app",
2281.                 "admin_scripts.complex_app",
2282.                 "django.contrib.auth",
2283.                 "django.contrib.contenttypes",
2284.             ]
2285.         ):
2286.             out = StringIO()
2287.             call_command("duplicate", stdout=out)
2288.             self.assertEqual(out.getvalue().strip(), "simple_app")
2289. 
2290. 
2291. class ArgumentOrder(AdminScriptTestCase):
2292.     """Tests for 2-stage argument parsing scheme.
2293. 
2294.     django-admin command arguments are parsed in 2 parts; the core arguments
2295.     (--settings, --traceback and --pythonpath) are parsed using a basic parser,
2296.     ignoring any unknown options. Then the full settings are
2297.     passed to the command parser, which extracts commands of interest to the
2298.     individual command.
2299.     """
2300. 
2301.     def setUp(self):
2302.         super().setUp()
2303.         self.write_settings(
2304.             "settings.py", apps=["django.contrib.auth", "django.contrib.contenttypes"]
2305.         )
2306.         self.write_settings("alternate_settings.py")
2307. 
2308.     def test_setting_then_option(self):
2309.         """Options passed after settings are correctly handled."""
2310.         args = [
2311.             "base_command",
2312.             "testlabel",
2313.             "--settings=alternate_settings",
2314.             "--option_a=x",
2315.         ]
2316.         self._test(args)
2317. 
2318.     def test_setting_then_short_option(self):
2319.         """Short options passed after settings are correctly handled."""
2320.         args = ["base_command", "testlabel", "--settings=alternate_settings", "-a", "x"]
2321.         self._test(args)
2322. 
2323.     def test_option_then_setting(self):
2324.         """Options passed before settings are correctly handled."""
2325.         args = [
2326.             "base_command",
2327.             "testlabel",
2328.             "--option_a=x",
2329.             "--settings=alternate_settings",
2330.         ]
2331.         self._test(args)
2332. 
2333.     def test_short_option_then_setting(self):
2334.         """Short options passed before settings are correctly handled."""
2335.         args = ["base_command", "testlabel", "-a", "x", "--settings=alternate_settings"]
2336.         self._test(args)
2337. 
2338.     def test_option_then_setting_then_option(self):
2339.         """Options are correctly handled when they are passed before and after
2340.         a setting."""
2341.         args = [
2342.             "base_command",
2343.             "testlabel",
2344.             "--option_a=x",
2345.             "--settings=alternate_settings",
2346.             "--option_b=y",
2347.         ]
2348.         self._test(args, option_b="'y'")
2349. 
2350.     def _test(self, args, option_b="'2'"):
2351.         out, err = self.run_manage(args)
2352.         self.assertNoOutput(err)
2353.         self.assertOutput(
2354.             out,
2355.             "EXECUTE:BaseCommand labels=('testlabel',), options=["
2356.             "('force_color', False), ('no_color', False), ('option_a', 'x'), "
2357.             "('option_b', %s), ('option_c', '3'), ('pythonpath', None), "
2358.             "('settings', 'alternate_settings'), ('traceback', False), "
2359.             "('verbosity', 1)]" % option_b,
2360.         )
2361. 
2362. 
2363. class ExecuteFromCommandLine(SimpleTestCase):
2364.     def test_program_name_from_argv(self):
2365.         """
2366.         Program name is computed from the execute_from_command_line()'s argv
2367.         argument, not sys.argv.
2368.         """
2369.         args = ["help", "shell"]
2370.         with captured_stdout() as out, captured_stderr() as err:
2371.             with mock.patch("sys.argv", [None] + args):
2372.                 execute_from_command_line(["django-admin"] + args)
2373.         self.assertIn("usage: django-admin shell", out.getvalue())
2374.         self.assertEqual(err.getvalue(), "")
2375. 
2376. 
2377. @override_settings(ROOT_URLCONF="admin_scripts.urls")
2378. class StartProject(LiveServerTestCase, AdminScriptTestCase):
2379.     available_apps = [
2380.         "admin_scripts",
2381.         "django.contrib.auth",
2382.         "django.contrib.contenttypes",
2383.         "django.contrib.sessions",
2384.     ]
2385. 
2386.     def test_wrong_args(self):
2387.         """
2388.         Passing the wrong kinds of arguments outputs an error and prints usage.
2389.         """
2390.         out, err = self.run_django_admin(["startproject"])
2391.         self.assertNoOutput(out)
2392.         self.assertOutput(err, "usage:")
2393.         self.assertOutput(err, "You must provide a project name.")
2394. 
2395.     def test_simple_project(self):
2396.         "Make sure the startproject management command creates a project"
2397.         args = ["startproject", "testproject"]
2398.         testproject_dir = os.path.join(self.test_dir, "testproject")
2399. 
2400.         out, err = self.run_django_admin(args)
2401.         self.assertNoOutput(err)
2402.         self.assertTrue(os.path.isdir(testproject_dir))
2403. 
2404.         # running again..
2405.         out, err = self.run_django_admin(args)
2406.         self.assertNoOutput(out)
2407.         self.assertOutput(
2408.             err,
2409.             "CommandError: 'testproject' conflicts with the name of an "
2410.             "existing Python module and cannot be used as a project name. "
2411.             "Please try another name.",
2412.         )
2413. 
2414.     def test_invalid_project_name(self):
2415.         "Make sure the startproject management command validates a project name"
2416.         for bad_name in ("7testproject", "../testproject"):
2417.             with self.subTest(project_name=bad_name):
2418.                 args = ["startproject", bad_name]
2419.                 testproject_dir = os.path.join(self.test_dir, bad_name)
2420. 
2421.                 out, err = self.run_django_admin(args)
2422.                 self.assertOutput(
2423.                     err,
2424.                     "Error: '%s' is not a valid project name. Please make "
2425.                     "sure the name is a valid identifier." % bad_name,
2426.                 )
2427.                 self.assertFalse(os.path.exists(testproject_dir))
2428. 
2429.     def test_importable_project_name(self):
2430.         """
2431.         startproject validates that project name doesn't clash with existing
2432.         Python modules.
2433.         """
2434.         bad_name = "os"
2435.         args = ["startproject", bad_name]
2436.         testproject_dir = os.path.join(self.test_dir, bad_name)
2437. 
2438.         out, err = self.run_django_admin(args)
2439.         self.assertOutput(
2440.             err,
2441.             "CommandError: 'os' conflicts with the name of an existing "
2442.             "Python module and cannot be used as a project name. Please try "
2443.             "another name.",
2444.         )
2445.         self.assertFalse(os.path.exists(testproject_dir))
2446. 
2447.     def test_simple_project_different_directory(self):
2448.         """
2449.         The startproject management command creates a project in a specific
2450.         directory.
2451.         """
2452.         args = ["startproject", "testproject", "othertestproject"]
2453.         testproject_dir = os.path.join(self.test_dir, "othertestproject")
2454.         os.mkdir(testproject_dir)
2455. 
2456.         out, err = self.run_django_admin(args)
2457.         self.assertNoOutput(err)
2458.         self.assertTrue(os.path.exists(os.path.join(testproject_dir, "manage.py")))
2459. 
2460.         # running again..
2461.         out, err = self.run_django_admin(args)
2462.         self.assertNoOutput(out)
2463.         self.assertOutput(
2464.             err,
2465.             "already exists. Overlaying a project into an existing directory "
2466.             "won't replace conflicting files.",
2467.         )
2468. 
2469.     def test_custom_project_template(self):
2470.         """
2471.         The startproject management command is able to use a different project
2472.         template.
2473.         """
2474.         template_path = os.path.join(custom_templates_dir, "project_template")
2475.         args = ["startproject", "--template", template_path, "customtestproject"]
2476.         testproject_dir = os.path.join(self.test_dir, "customtestproject")
2477. 
2478.         out, err = self.run_django_admin(args)
2479.         self.assertNoOutput(err)
2480.         self.assertTrue(os.path.isdir(testproject_dir))
2481.         self.assertTrue(os.path.exists(os.path.join(testproject_dir, "additional_dir")))
2482. 
2483.     def test_custom_project_template_non_python_files_not_formatted(self):
2484.         template_path = os.path.join(custom_templates_dir, "project_template")
2485.         args = ["startproject", "--template", template_path, "customtestproject"]
2486.         testproject_dir = os.path.join(self.test_dir, "customtestproject")
2487. 
2488.         _, err = self.run_django_admin(args)
2489.         self.assertNoOutput(err)
2490.         with open(
2491.             os.path.join(template_path, "additional_dir", "requirements.in")
2492.         ) as f:
2493.             expected = f.read()
2494.         with open(
2495.             os.path.join(testproject_dir, "additional_dir", "requirements.in")
2496.         ) as f:
2497.             result = f.read()
2498.         self.assertEqual(expected, result)
2499. 
2500.     def test_template_dir_with_trailing_slash(self):
2501.         "Ticket 17475: Template dir passed has a trailing path separator"
2502.         template_path = os.path.join(custom_templates_dir, "project_template" + os.sep)
2503.         args = ["startproject", "--template", template_path, "customtestproject"]
2504.         testproject_dir = os.path.join(self.test_dir, "customtestproject")
2505. 
2506.         out, err = self.run_django_admin(args)
2507.         self.assertNoOutput(err)
2508.         self.assertTrue(os.path.isdir(testproject_dir))
2509.         self.assertTrue(os.path.exists(os.path.join(testproject_dir, "additional_dir")))
2510. 
2511.     def test_custom_project_template_from_tarball_by_path(self):
2512.         """
2513.         The startproject management command is able to use a different project
2514.         template from a tarball.
2515.         """
2516.         template_path = os.path.join(custom_templates_dir, "project_template.tgz")
2517.         args = ["startproject", "--template", template_path, "tarballtestproject"]
2518.         testproject_dir = os.path.join(self.test_dir, "tarballtestproject")
2519. 
2520.         out, err = self.run_django_admin(args)
2521.         self.assertNoOutput(err)
2522.         self.assertTrue(os.path.isdir(testproject_dir))
2523.         self.assertTrue(os.path.exists(os.path.join(testproject_dir, "run.py")))
2524. 
2525.     def test_custom_project_template_from_tarball_to_alternative_location(self):
2526.         """
2527.         Startproject can use a project template from a tarball and create it in
2528.         a specified location.
2529.         """
2530.         template_path = os.path.join(custom_templates_dir, "project_template.tgz")
2531.         args = [
2532.             "startproject",
2533.             "--template",
2534.             template_path,
2535.             "tarballtestproject",
2536.             "altlocation",
2537.         ]
2538.         testproject_dir = os.path.join(self.test_dir, "altlocation")
2539.         os.mkdir(testproject_dir)
2540. 
2541.         out, err = self.run_django_admin(args)
2542.         self.assertNoOutput(err)
2543.         self.assertTrue(os.path.isdir(testproject_dir))
2544.         self.assertTrue(os.path.exists(os.path.join(testproject_dir, "run.py")))
2545. 
2546.     def test_custom_project_template_from_tarball_by_url(self):
2547.         """
2548.         The startproject management command is able to use a different project
2549.         template from a tarball via a URL.
2550.         """
2551.         template_url = "%s/custom_templates/project_template.tgz" % self.live_server_url
2552. 
2553.         args = ["startproject", "--template", template_url, "urltestproject"]
2554.         testproject_dir = os.path.join(self.test_dir, "urltestproject")
2555. 
2556.         out, err = self.run_django_admin(args)
2557.         self.assertNoOutput(err)
2558.         self.assertTrue(os.path.isdir(testproject_dir))
2559.         self.assertTrue(os.path.exists(os.path.join(testproject_dir, "run.py")))
2560. 
2561.     def test_custom_project_template_from_tarball_by_url_django_user_agent(self):
2562.         user_agent = None
2563. 
2564.         def serve_template(request, *args, **kwargs):
2565.             nonlocal user_agent
2566.             user_agent = request.headers["User-Agent"]
2567.             return serve(request, *args, **kwargs)
2568. 
2569.         old_urlpatterns = urls.urlpatterns[:]
2570.         try:
2571.             urls.urlpatterns += [
2572.                 path(
2573.                     "user_agent_check/<path:path>",
2574.                     serve_template,
2575.                     {"document_root": os.path.join(urls.here, "custom_templates")},
2576.                 ),
2577.             ]
2578. 
2579.             template_url = (
2580.                 f"{self.live_server_url}/user_agent_check/project_template.tgz"
2581.             )
2582.             args = ["startproject", "--template", template_url, "urltestproject"]
2583.             _, err = self.run_django_admin(args)
2584. 
2585.             self.assertNoOutput(err)
2586.             self.assertIn("Django/%s" % get_version(), user_agent)
2587.         finally:
2588.             urls.urlpatterns = old_urlpatterns
2589. 
2590.     def test_project_template_tarball_url(self):
2591.         """ "
2592.         Startproject management command handles project template tar/zip balls
2593.         from non-canonical urls.
2594.         """
2595.         template_url = (
2596.             "%s/custom_templates/project_template.tgz/" % self.live_server_url
2597.         )
2598. 
2599.         args = ["startproject", "--template", template_url, "urltestproject"]
2600.         testproject_dir = os.path.join(self.test_dir, "urltestproject")
2601. 
2602.         out, err = self.run_django_admin(args)
2603.         self.assertNoOutput(err)
2604.         self.assertTrue(os.path.isdir(testproject_dir))
2605.         self.assertTrue(os.path.exists(os.path.join(testproject_dir, "run.py")))
2606. 
2607.     def test_file_without_extension(self):
2608.         "Make sure the startproject management command is able to render custom files"
2609.         template_path = os.path.join(custom_templates_dir, "project_template")
2610.         args = [
2611.             "startproject",
2612.             "--template",
2613.             template_path,
2614.             "customtestproject",
2615.             "-e",
2616.             "txt",
2617.             "-n",
2618.             "Procfile",
2619.         ]
2620.         testproject_dir = os.path.join(self.test_dir, "customtestproject")
2621. 
2622.         out, err = self.run_django_admin(args)
2623.         self.assertNoOutput(err)
2624.         self.assertTrue(os.path.isdir(testproject_dir))
2625.         self.assertTrue(os.path.exists(os.path.join(testproject_dir, "additional_dir")))
2626.         base_path = os.path.join(testproject_dir, "additional_dir")
2627.         for f in ("Procfile", "additional_file.py", "requirements.txt"):
2628.             self.assertTrue(os.path.exists(os.path.join(base_path, f)))
2629.             with open(os.path.join(base_path, f)) as fh:
2630.                 self.assertEqual(
2631.                     fh.read().strip(), "# some file for customtestproject test project"
2632.                 )
2633. 
2634.     def test_custom_project_template_context_variables(self):
2635.         "Make sure template context variables are rendered with proper values"
2636.         template_path = os.path.join(custom_templates_dir, "project_template")
2637.         args = [
2638.             "startproject",
2639.             "--template",
2640.             template_path,
2641.             "another_project",
2642.             "project_dir",
2643.         ]
2644.         testproject_dir = os.path.join(self.test_dir, "project_dir")
2645.         os.mkdir(testproject_dir)
2646.         out, err = self.run_django_admin(args)
2647.         self.assertNoOutput(err)
2648.         test_manage_py = os.path.join(testproject_dir, "manage.py")
2649.         with open(test_manage_py) as fp:
2650.             content = fp.read()
2651.             self.assertIn('project_name = "another_project"', content)
2652.             self.assertIn('project_directory = "%s"' % testproject_dir, content)
2653. 
2654.     def test_no_escaping_of_project_variables(self):
2655.         "Make sure template context variables are not html escaped"
2656.         # We're using a custom command so we need the alternate settings
2657.         self.write_settings("alternate_settings.py")
2658.         template_path = os.path.join(custom_templates_dir, "project_template")
2659.         args = [
2660.             "custom_startproject",
2661.             "--template",
2662.             template_path,
2663.             "another_project",
2664.             "project_dir",
2665.             "--extra",
2666.             "<&>",
2667.             "--settings=alternate_settings",
2668.         ]
2669.         testproject_dir = os.path.join(self.test_dir, "project_dir")
2670.         os.mkdir(testproject_dir)
2671.         out, err = self.run_manage(args)
2672.         self.assertNoOutput(err)
2673.         test_manage_py = os.path.join(testproject_dir, "additional_dir", "extra.py")
2674.         with open(test_manage_py) as fp:
2675.             content = fp.read()
2676.             self.assertIn("<&>", content)
2677. 
2678.     def test_custom_project_destination_missing(self):
2679.         """
2680.         Make sure an exception is raised when the provided
2681.         destination directory doesn't exist
2682.         """
2683.         template_path = os.path.join(custom_templates_dir, "project_template")
2684.         args = [
2685.             "startproject",
2686.             "--template",
2687.             template_path,
2688.             "yet_another_project",
2689.             "project_dir2",
2690.         ]
2691.         testproject_dir = os.path.join(self.test_dir, "project_dir2")
2692.         out, err = self.run_django_admin(args)
2693.         self.assertNoOutput(out)
2694.         self.assertOutput(
2695.             err,
2696.             "Destination directory '%s' does not exist, please create it first."
2697.             % testproject_dir,
2698.         )
2699.         self.assertFalse(os.path.exists(testproject_dir))
2700. 
2701.     def test_custom_project_template_with_non_ascii_templates(self):
2702.         """
2703.         The startproject management command is able to render templates with
2704.         non-ASCII content.
2705.         """
2706.         template_path = os.path.join(custom_templates_dir, "project_template")
2707.         args = [
2708.             "startproject",
2709.             "--template",
2710.             template_path,
2711.             "--extension=txt",
2712.             "customtestproject",
2713.         ]
2714.         testproject_dir = os.path.join(self.test_dir, "customtestproject")
2715. 
2716.         out, err = self.run_django_admin(args)
2717.         self.assertNoOutput(err)
2718.         self.assertTrue(os.path.isdir(testproject_dir))
2719.         path = os.path.join(testproject_dir, "ticket-18091-non-ascii-template.txt")
2720.         with open(path, encoding="utf-8") as f:
2721.             self.assertEqual(
2722.                 f.read().splitlines(False),
2723.                 ["Some non-ASCII text for testing ticket #18091:", "üäö €"],
2724.             )
2725. 
2726.     def test_custom_project_template_hidden_directory_default_excluded(self):
2727.         """Hidden directories are excluded by default."""
2728.         template_path = os.path.join(custom_templates_dir, "project_template")
2729.         args = [
2730.             "startproject",
2731.             "--template",
2732.             template_path,
2733.             "custom_project_template_hidden_directories",
2734.             "project_dir",
2735.         ]
2736.         testproject_dir = os.path.join(self.test_dir, "project_dir")
2737.         os.mkdir(testproject_dir)
2738. 
2739.         _, err = self.run_django_admin(args)
2740.         self.assertNoOutput(err)
2741.         hidden_dir = os.path.join(testproject_dir, ".hidden")
2742.         self.assertIs(os.path.exists(hidden_dir), False)
2743. 
2744.     def test_custom_project_template_hidden_directory_included(self):
2745.         """
2746.         Template context variables in hidden directories are rendered, if not
2747.         excluded.
2748.         """
2749.         template_path = os.path.join(custom_templates_dir, "project_template")
2750.         project_name = "custom_project_template_hidden_directories_included"
2751.         args = [
2752.             "startproject",
2753.             "--template",
2754.             template_path,
2755.             project_name,
2756.             "project_dir",
2757.             "--exclude",
2758.         ]
2759.         testproject_dir = os.path.join(self.test_dir, "project_dir")
2760.         os.mkdir(testproject_dir)
2761. 
2762.         _, err = self.run_django_admin(args)
2763.         self.assertNoOutput(err)
2764.         render_py_path = os.path.join(testproject_dir, ".hidden", "render.py")
2765.         with open(render_py_path) as fp:
2766.             self.assertIn(
2767.                 f"# The {project_name} should be rendered.",
2768.                 fp.read(),
2769.             )
2770. 
2771.     def test_custom_project_template_exclude_directory(self):
2772.         """
2773.         Excluded directories (in addition to .git and __pycache__) are not
2774.         included in the project.
2775.         """
2776.         template_path = os.path.join(custom_templates_dir, "project_template")
2777.         project_name = "custom_project_with_excluded_directories"
2778.         args = [
2779.             "startproject",
2780.             "--template",
2781.             template_path,
2782.             project_name,
2783.             "project_dir",
2784.             "--exclude",
2785.             "additional_dir",
2786.             "-x",
2787.             ".hidden",
2788.         ]
2789.         testproject_dir = os.path.join(self.test_dir, "project_dir")
2790.         os.mkdir(testproject_dir)
2791. 
2792.         _, err = self.run_django_admin(args)
2793.         self.assertNoOutput(err)
2794.         excluded_directories = [
2795.             ".hidden",
2796.             "additional_dir",
2797.             ".git",
2798.             "__pycache__",
2799.         ]
2800.         for directory in excluded_directories:
2801.             self.assertIs(
2802.                 os.path.exists(os.path.join(testproject_dir, directory)),
2803.                 False,
2804.             )
2805.         not_excluded = os.path.join(testproject_dir, project_name)
2806.         self.assertIs(os.path.exists(not_excluded), True)
2807. 
2808.     @unittest.skipIf(
2809.         sys.platform == "win32",
2810.         "Windows only partially supports umasks and chmod.",
2811.     )
2812.     def test_honor_umask(self):
2813.         _, err = self.run_django_admin(["startproject", "testproject"], umask=0o077)
2814.         self.assertNoOutput(err)
2815.         testproject_dir = os.path.join(self.test_dir, "testproject")
2816.         self.assertIs(os.path.isdir(testproject_dir), True)
2817.         tests = [
2818.             (["manage.py"], 0o700),
2819.             (["testproject"], 0o700),
2820.             (["testproject", "settings.py"], 0o600),
2821.         ]
2822.         for paths, expected_mode in tests:
2823.             file_path = os.path.join(testproject_dir, *paths)
2824.             with self.subTest(paths[-1]):
2825.                 self.assertEqual(
2826.                     stat.S_IMODE(os.stat(file_path).st_mode),
2827.                     expected_mode,
2828.                 )
2829. 
2830. 
2831. class StartApp(AdminScriptTestCase):
2832.     def test_invalid_name(self):
2833.         """startapp validates that app name is a valid Python identifier."""
2834.         for bad_name in ("7testproject", "../testproject"):
2835.             with self.subTest(app_name=bad_name):
2836.                 args = ["startapp", bad_name]
2837.                 testproject_dir = os.path.join(self.test_dir, bad_name)
2838. 
2839.                 out, err = self.run_django_admin(args)
2840.                 self.assertOutput(
2841.                     err,
2842.                     "CommandError: '{}' is not a valid app name. Please make "
2843.                     "sure the name is a valid identifier.".format(bad_name),
2844.                 )
2845.                 self.assertFalse(os.path.exists(testproject_dir))
2846. 
2847.     def test_importable_name(self):
2848.         """
2849.         startapp validates that app name doesn't clash with existing Python
2850.         modules.
2851.         """
2852.         bad_name = "os"
2853.         args = ["startapp", bad_name]
2854.         testproject_dir = os.path.join(self.test_dir, bad_name)
2855. 
2856.         out, err = self.run_django_admin(args)
2857.         self.assertOutput(
2858.             err,
2859.             "CommandError: 'os' conflicts with the name of an existing "
2860.             "Python module and cannot be used as an app name. Please try "
2861.             "another name.",
2862.         )
2863.         self.assertFalse(os.path.exists(testproject_dir))
2864. 
2865.     def test_invalid_target_name(self):
2866.         for bad_target in (
2867.             "invalid.dir_name",
2868.             "7invalid_dir_name",
2869.             ".invalid_dir_name",
2870.         ):
2871.             with self.subTest(bad_target):
2872.                 _, err = self.run_django_admin(["startapp", "app", bad_target])
2873.                 self.assertOutput(
2874.                     err,
2875.                     "CommandError: '%s' is not a valid app directory. Please "
2876.                     "make sure the directory is a valid identifier." % bad_target,
2877.                 )
2878. 
2879.     def test_importable_target_name(self):
2880.         _, err = self.run_django_admin(["startapp", "app", "os"])
2881.         self.assertOutput(
2882.             err,
2883.             "CommandError: 'os' conflicts with the name of an existing Python "
2884.             "module and cannot be used as an app directory. Please try "
2885.             "another directory.",
2886.         )
2887. 
2888.     def test_trailing_slash_in_target_app_directory_name(self):
2889.         app_dir = os.path.join(self.test_dir, "apps", "app1")
2890.         os.makedirs(app_dir)
2891.         _, err = self.run_django_admin(
2892.             ["startapp", "app", os.path.join("apps", "app1", "")]
2893.         )
2894.         self.assertNoOutput(err)
2895.         self.assertIs(os.path.exists(os.path.join(app_dir, "apps.py")), True)
2896. 
2897.     def test_overlaying_app(self):
2898.         # Use a subdirectory so it is outside the PYTHONPATH.
2899.         os.makedirs(os.path.join(self.test_dir, "apps/app1"))
2900.         self.run_django_admin(["startapp", "app1", "apps/app1"])
2901.         out, err = self.run_django_admin(["startapp", "app2", "apps/app1"])
2902.         self.assertOutput(
2903.             err,
2904.             "already exists. Overlaying an app into an existing directory "
2905.             "won't replace conflicting files.",
2906.         )
2907. 
2908.     def test_template(self):
2909.         out, err = self.run_django_admin(["startapp", "new_app"])
2910.         self.assertNoOutput(err)
2911.         app_path = os.path.join(self.test_dir, "new_app")
2912.         self.assertIs(os.path.exists(app_path), True)
2913.         with open(os.path.join(app_path, "apps.py")) as f:
2914.             content = f.read()
2915.             self.assertIn("class NewAppConfig(AppConfig)", content)
2916.             if HAS_BLACK:
2917.                 test_str = 'default_auto_field = "django.db.models.BigAutoField"'
2918.             else:
2919.                 test_str = "default_auto_field = 'django.db.models.BigAutoField'"
2920.             self.assertIn(test_str, content)
2921.             self.assertIn(
2922.                 'name = "new_app"' if HAS_BLACK else "name = 'new_app'",
2923.                 content,
2924.             )
2925. 
2926. 
2927. class DiffSettings(AdminScriptTestCase):
2928.     """Tests for diffsettings management command."""
2929. 
2930.     def test_basic(self):
2931.         """Runs without error and emits settings diff."""
2932.         self.write_settings("settings_to_diff.py", sdict={"FOO": '"bar"'})
2933.         args = ["diffsettings", "--settings=settings_to_diff"]
2934.         out, err = self.run_manage(args)
2935.         self.assertNoOutput(err)
2936.         self.assertOutput(out, "FOO = 'bar'  ###")
2937.         # Attributes from django.conf.Settings don't appear.
2938.         self.assertNotInOutput(out, "is_overridden = ")
2939. 
2940.     def test_settings_configured(self):
2941.         out, err = self.run_manage(
2942.             ["diffsettings"], manage_py="configured_settings_manage.py"
2943.         )
2944.         self.assertNoOutput(err)
2945.         self.assertOutput(out, "CUSTOM = 1  ###\nDEBUG = True")
2946.         # Attributes from django.conf.UserSettingsHolder don't appear.
2947.         self.assertNotInOutput(out, "default_settings = ")
2948. 
2949.     def test_dynamic_settings_configured(self):
2950.         # Custom default settings appear.
2951.         out, err = self.run_manage(
2952.             ["diffsettings"], manage_py="configured_dynamic_settings_manage.py"
2953.         )
2954.         self.assertNoOutput(err)
2955.         self.assertOutput(out, "FOO = 'bar'  ###")
2956. 
2957.     def test_all(self):
2958.         """The all option also shows settings with the default value."""
2959.         self.write_settings("settings_to_diff.py", sdict={"STATIC_URL": "None"})
2960.         args = ["diffsettings", "--settings=settings_to_diff", "--all"]
2961.         out, err = self.run_manage(args)
2962.         self.assertNoOutput(err)
2963.         self.assertOutput(out, "### STATIC_URL = None")
2964. 
2965.     def test_custom_default(self):
2966.         """
2967.         The --default option specifies an alternate settings module for
2968.         comparison.
2969.         """
2970.         self.write_settings(
2971.             "settings_default.py", sdict={"FOO": '"foo"', "BAR": '"bar1"'}
2972.         )
2973.         self.write_settings(
2974.             "settings_to_diff.py", sdict={"FOO": '"foo"', "BAR": '"bar2"'}
2975.         )
2976.         out, err = self.run_manage(
2977.             [
2978.                 "diffsettings",
2979.                 "--settings=settings_to_diff",
2980.                 "--default=settings_default",
2981.             ]
2982.         )
2983.         self.assertNoOutput(err)
2984.         self.assertNotInOutput(out, "FOO")
2985.         self.assertOutput(out, "BAR = 'bar2'")
2986. 
2987.     def test_unified(self):
2988.         """--output=unified emits settings diff in unified mode."""
2989.         self.write_settings("settings_to_diff.py", sdict={"FOO": '"bar"'})
2990.         args = ["diffsettings", "--settings=settings_to_diff", "--output=unified"]
2991.         out, err = self.run_manage(args)
2992.         self.assertNoOutput(err)
2993.         self.assertOutput(out, "+ FOO = 'bar'")
2994.         self.assertOutput(out, "- SECRET_KEY = ''")
2995.         self.assertOutput(out, "+ SECRET_KEY = 'django_tests_secret_key'")
2996.         self.assertNotInOutput(out, "  APPEND_SLASH = True")
2997. 
2998.     def test_unified_all(self):
2999.         """
3000.         --output=unified --all emits settings diff in unified mode and includes
3001.         settings with the default value.
3002.         """
3003.         self.write_settings("settings_to_diff.py", sdict={"FOO": '"bar"'})
3004.         args = [
3005.             "diffsettings",
3006.             "--settings=settings_to_diff",
3007.             "--output=unified",
3008.             "--all",
3009.         ]
3010.         out, err = self.run_manage(args)
3011.         self.assertNoOutput(err)
3012.         self.assertOutput(out, "  APPEND_SLASH = True")
3013.         self.assertOutput(out, "+ FOO = 'bar'")
3014.         self.assertOutput(out, "- SECRET_KEY = ''")
3015. 
3016. 
3017. class Dumpdata(AdminScriptTestCase):
3018.     """Tests for dumpdata management command."""
3019. 
3020.     def setUp(self):
3021.         super().setUp()
3022.         self.write_settings("settings.py")
3023. 
3024.     def test_pks_parsing(self):
3025.         """Regression for #20509
3026. 
3027.         Test would raise an exception rather than printing an error message.
3028.         """
3029.         args = ["dumpdata", "--pks=1"]
3030.         out, err = self.run_manage(args)
3031.         self.assertOutput(err, "You can only use --pks option with one model")
3032.         self.assertNoOutput(out)
3033. 
3034. 
3035. class MainModule(AdminScriptTestCase):
3036.     """python -m django works like django-admin."""
3037. 
3038.     def test_program_name_in_help(self):
3039.         out, err = self.run_test(["-m", "django", "help"])
3040.         self.assertOutput(
3041.             out,
3042.             "Type 'python -m django help <subcommand>' for help on a specific "
3043.             "subcommand.",
3044.         )
3045. 
3046. 
3047. class DjangoAdminSuggestions(AdminScriptTestCase):
3048.     def setUp(self):
3049.         super().setUp()
3050.         self.write_settings("settings.py")
3051. 
3052.     def test_suggestions(self):
3053.         args = ["rnserver", "--settings=test_project.settings"]
3054.         out, err = self.run_django_admin(args)
3055.         self.assertNoOutput(out)
3056.         self.assertOutput(err, "Unknown command: 'rnserver'. Did you mean runserver?")
3057. 
3058.     def test_no_suggestions(self):
3059.         args = ["abcdef", "--settings=test_project.settings"]
3060.         out, err = self.run_django_admin(args)
3061.         self.assertNoOutput(out)
3062.         self.assertNotInOutput(err, "Did you mean")

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 20:08:35,187 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find test cases related to argument parsing in management commands, specifically for commands that use subparsers. The provided context from `tests/admin_scripts/tests.py` shows how argument parsing errors are tested, but it does not seem to cover subparsers. The commands that might use subparsers are likely defined elsewhere. The `migrate` command is a complex built-in command that could potentially use subparsers for its various options and arguments. Its tests are located in `tests/migrations/test_commands.py`, which makes this file a promising place to find relevant examples of testing complex command-line argument parsing and error handling.' query='Please provide the full content of `tests/migrations/test_commands.py`.' extra_requirements='' purpose='I need to examine the tests for the `migrate` command to find examples of how complex argument parsing, especially with subparsers, is tested in Django, or could be, tested.'
2025-12-21 20:08:35,188 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `tests/migrations/test_commands.py`.
2025-12-21 20:08:35,188 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-21 20:08:35,189 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-21 20:08:35,190 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-21 20:08:35,190 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `tests/migrations/test_commands.py`.
Purpose: I need to examine the tests for the `migrate` command to find examples of how complex argument parsing, especially with subparsers, is tested in Django, or could be, tested.
2025-12-21 20:08:39,113 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have fetched the entire content of `tests/migrations/test_commands.py` for you to examine. This will allow you to analyze the tests for the `migrate` command and understand how complex argument parsing is handled within the Django testing framework.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/migrations/test_commands.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2114, 'candidates_token_count': 74, 'total_token_count': 2434, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2114}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 74}], 'thoughts_token_count': 246, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.38588766149572423, 'model_name': 'gemini-2.5-pro'} id='run--06c2be91-84bd-4655-9028-2414c26247af-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/migrations/test_commands.py'}, 'id': 'd4edce85-217c-420c-94ea-70190e772936', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2114, 'output_tokens': 74, 'total_tokens': 2434, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 246}}
2025-12-21 20:08:41,227 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the first 500 lines of `tests/migrations/test_commands.py` as requested. I will now fetch the remaining content of the file to provide you with the complete code.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/migrations/test_commands.py", "start_line": 501.0, "end_line": 1000.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 9327, 'candidates_token_count': 72, 'total_token_count': 9447, 'cached_content_token_count': 1828, 'prompt_tokens_details': [{'modality': 1, 'token_count': 9327}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1828}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 72}], 'thoughts_token_count': 48}, 'finish_reason': 'STOP', 'avg_logprobs': -0.09756704833772448, 'model_name': 'gemini-2.5-pro'} id='run--c843b6e9-30ec-4d7f-aa71-665ef4c09c15-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/migrations/test_commands.py', 'start_line': 501.0, 'end_line': 1000.0}, 'id': '6dc23f63-2b98-4b3d-b57b-418505281f07', 'type': 'tool_call'}] usage_metadata={'input_tokens': 9327, 'output_tokens': 72, 'total_tokens': 9447, 'input_token_details': {'cache_read': 1828}, 'output_token_details': {'reasoning': 48}}
2025-12-21 20:08:45,907 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have now retrieved the entire content of `tests/migrations/test_commands.py`. You can now examine the file to find examples of how complex argument parsing is tested in Django.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"end_line": 1500.0, "start_line": 1001.0, "relative_path": "tests/migrations/test_commands.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 16953, 'candidates_token_count': 67, 'total_token_count': 17299, 'cached_content_token_count': 9392, 'prompt_tokens_details': [{'modality': 1, 'token_count': 16953}], 'cache_tokens_details': [{'modality': 1, 'token_count': 9392}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 67}], 'thoughts_token_count': 279}, 'finish_reason': 'STOP', 'avg_logprobs': -0.7108518685867538, 'model_name': 'gemini-2.5-pro'} id='run--73071386-f7ae-4343-bb17-41f160a57548-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'end_line': 1500.0, 'start_line': 1001.0, 'relative_path': 'tests/migrations/test_commands.py'}, 'id': '4fcee867-f6d2-4960-9608-46e0b54c5347', 'type': 'tool_call'}] usage_metadata={'input_tokens': 16953, 'output_tokens': 67, 'total_tokens': 17299, 'input_token_details': {'cache_read': 9392}, 'output_token_details': {'reasoning': 279}}
2025-12-21 20:08:47,623 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have fetched the complete content of `tests/migrations/test_commands.py`. You can now review the file to analyze the tests for the `migrate` command and understand how argument parsing is tested.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/migrations/test_commands.py", "start_line": 1501.0, "end_line": 2000.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 25340, 'candidates_token_count': 71, 'total_token_count': 25411, 'cached_content_token_count': 17146, 'prompt_tokens_details': [{'modality': 1, 'token_count': 25340}], 'cache_tokens_details': [{'modality': 1, 'token_count': 17146}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 71}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.13205898983377806, 'model_name': 'gemini-2.5-pro'} id='run--2c64c04a-4caa-468f-a272-9393e697aee3-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/migrations/test_commands.py', 'start_line': 1501.0, 'end_line': 2000.0}, 'id': '5129d7a5-357a-43d6-b07b-0a174f61a38b', 'type': 'tool_call'}] usage_metadata={'input_tokens': 25340, 'output_tokens': 71, 'total_tokens': 25411, 'input_token_details': {'cache_read': 17146}}
2025-12-21 20:08:49,311 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have now provided the full content of `tests/migrations/test_commands.py`. You can proceed with your analysis of the test file.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"end_line": 2500.0, "start_line": 2001.0, "relative_path": "tests/migrations/test_commands.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 33606, 'candidates_token_count': 59, 'total_token_count': 33665, 'cached_content_token_count': 24912, 'prompt_tokens_details': [{'modality': 1, 'token_count': 33606}], 'cache_tokens_details': [{'modality': 1, 'token_count': 24912}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 59}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.11066339783749338, 'model_name': 'gemini-2.5-pro'} id='run--5593c06d-8d4c-46df-b38d-9c01cfaed7d4-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'end_line': 2500.0, 'start_line': 2001.0, 'relative_path': 'tests/migrations/test_commands.py'}, 'id': '8b482386-d6cd-43ef-a3f8-672a3d137fa3', 'type': 'tool_call'}] usage_metadata={'input_tokens': 33606, 'output_tokens': 59, 'total_tokens': 33665, 'input_token_details': {'cache_read': 24912}}
2025-12-21 20:08:51,148 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have now retrieved all the content from `tests/migrations/test_commands.py`. You have the complete file for your analysis. Let me know if you need anything else.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/migrations/test_commands.py", "start_line": 2501.0, "end_line": 3000.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 41755, 'candidates_token_count': 66, 'total_token_count': 41821, 'cached_content_token_count': 32732, 'prompt_tokens_details': [{'modality': 1, 'token_count': 41755}], 'cache_tokens_details': [{'modality': 1, 'token_count': 32732}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 66}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.14626692280624853, 'model_name': 'gemini-2.5-pro'} id='run--48241326-cd2b-45a8-8f9a-9be60f0b6a81-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/migrations/test_commands.py', 'start_line': 2501.0, 'end_line': 3000.0}, 'id': 'b8f5fcaa-db77-4cba-8bf2-b3e9ce9d2259', 'type': 'tool_call'}] usage_metadata={'input_tokens': 41755, 'output_tokens': 66, 'total_tokens': 41821, 'input_token_details': {'cache_read': 32732}}
2025-12-21 20:08:55,615 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have now retrieved all of the content from `tests/migrations/test_commands.py`. You have the complete file for your analysis. Let me know if you need anything else.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/migrations/test_commands.py", "start_line": 3001.0, "end_line": 3500.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 49977, 'candidates_token_count': 67, 'total_token_count': 50329, 'cached_content_token_count': 40561, 'prompt_tokens_details': [{'modality': 1, 'token_count': 49977}], 'cache_tokens_details': [{'modality': 1, 'token_count': 40561}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 67}], 'thoughts_token_count': 285}, 'finish_reason': 'STOP', 'avg_logprobs': -0.6479427280710705, 'model_name': 'gemini-2.5-pro'} id='run--9d3fedb4-f1be-4ce3-8bb8-01075fb0c82c-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/migrations/test_commands.py', 'start_line': 3001.0, 'end_line': 3500.0}, 'id': '2782bc1b-cbe0-4ddc-be25-65839b451064', 'type': 'tool_call'}] usage_metadata={'input_tokens': 49977, 'output_tokens': 67, 'total_tokens': 50329, 'input_token_details': {'cache_read': 40561}, 'output_token_details': {'reasoning': 285}}
2025-12-21 20:08:57,927 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have now retrieved all of the content from `tests/migrations/test_commands.py`. You have the complete file for your analysis. Let me know if you need anything else.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 53137, 'candidates_token_count': 38, 'total_token_count': 53264, 'cached_content_token_count': 48302, 'prompt_tokens_details': [{'modality': 1, 'token_count': 53137}], 'cache_tokens_details': [{'modality': 1, 'token_count': 48302}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 38}], 'thoughts_token_count': 89}, 'finish_reason': 'STOP', 'avg_logprobs': -0.5020906046817177, 'model_name': 'gemini-2.5-pro'} id='run--9eefdd24-e8c1-4647-a48e-237cd6adf1de-0' usage_metadata={'input_tokens': 53137, 'output_tokens': 38, 'total_tokens': 53264, 'input_token_details': {'cache_read': 48302}, 'output_token_details': {'reasoning': 89}}
2025-12-21 20:08:57,932 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `tests/migrations/test_commands.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
I need to examine the tests for the `migrate` command to find examples of how complex argument parsing, especially with subparsers, is tested in Django, or could be, tested.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/migrations/test_commands.py
Line number range: 1 - 500
Content:
1. import datetime
2. import importlib
3. import io
4. import os
5. import shutil
6. import sys
7. from unittest import mock
8. 
9. from django.apps import apps
10. from django.core.management import CommandError, call_command
11. from django.db import (
12.     ConnectionHandler,
13.     DatabaseError,
14.     OperationalError,
15.     connection,
16.     connections,
17.     models,
18. )
19. from django.db.backends.base.schema import BaseDatabaseSchemaEditor
20. from django.db.backends.utils import truncate_name
21. from django.db.migrations.exceptions import InconsistentMigrationHistory
22. from django.db.migrations.recorder import MigrationRecorder
23. from django.test import TestCase, override_settings, skipUnlessDBFeature
24. from django.test.utils import captured_stdout
25. from django.utils import timezone
26. from django.utils.version import get_docs_version
27. 
28. from .models import UnicodeModel, UnserializableModel
29. from .routers import TestRouter
30. from .test_base import MigrationTestBase
31. 
32. HAS_BLACK = shutil.which("black")
33. 
34. 
35. class MigrateTests(MigrationTestBase):
36.     """
37.     Tests running the migrate command.
38.     """
39. 
40.     databases = {"default", "other"}
41. 
42.     @override_settings(MIGRATION_MODULES={"migrations": "migrations.test_migrations"})
43.     def test_migrate(self):
44.         """
45.         Tests basic usage of the migrate command.
46.         """
47.         # No tables are created
48.         self.assertTableNotExists("migrations_author")
49.         self.assertTableNotExists("migrations_tribble")
50.         self.assertTableNotExists("migrations_book")
51.         # Run the migrations to 0001 only
52.         stdout = io.StringIO()
53.         call_command(
54.             "migrate", "migrations", "0001", verbosity=2, stdout=stdout, no_color=True
55.         )
56.         stdout = stdout.getvalue()
57.         self.assertIn(
58.             "Target specific migration: 0001_initial, from migrations", stdout
59.         )
60.         self.assertIn("Applying migrations.0001_initial... OK", stdout)
61.         self.assertIn("Running pre-migrate handlers for application migrations", stdout)
62.         self.assertIn(
63.             "Running post-migrate handlers for application migrations", stdout
64.         )
65.         # The correct tables exist
66.         self.assertTableExists("migrations_author")
67.         self.assertTableExists("migrations_tribble")
68.         self.assertTableNotExists("migrations_book")
69.         # Run migrations all the way
70.         call_command("migrate", verbosity=0)
71.         # The correct tables exist
72.         self.assertTableExists("migrations_author")
73.         self.assertTableNotExists("migrations_tribble")
74.         self.assertTableExists("migrations_book")
75.         # Unmigrate everything
76.         stdout = io.StringIO()
77.         call_command(
78.             "migrate", "migrations", "zero", verbosity=2, stdout=stdout, no_color=True
79.         )
80.         stdout = stdout.getvalue()
81.         self.assertIn("Unapply all migrations: migrations", stdout)
82.         self.assertIn("Unapplying migrations.0002_second... OK", stdout)
83.         self.assertIn("Running pre-migrate handlers for application migrations", stdout)
84.         self.assertIn(
85.             "Running post-migrate handlers for application migrations", stdout
86.         )
87.         # Tables are gone
88.         self.assertTableNotExists("migrations_author")
89.         self.assertTableNotExists("migrations_tribble")
90.         self.assertTableNotExists("migrations_book")
91. 
92.     @override_settings(
93.         INSTALLED_APPS=[
94.             "django.contrib.auth",
95.             "django.contrib.contenttypes",
96.             "migrations.migrations_test_apps.migrated_app",
97.         ]
98.     )
99.     def test_migrate_with_system_checks(self):
100.         out = io.StringIO()
101.         call_command("migrate", skip_checks=False, no_color=True, stdout=out)
102.         self.assertIn("Apply all migrations: migrated_app", out.getvalue())
103. 
104.     @override_settings(
105.         INSTALLED_APPS=[
106.             "migrations",
107.             "migrations.migrations_test_apps.unmigrated_app_syncdb",
108.         ]
109.     )
110.     def test_app_without_migrations(self):
111.         msg = "App 'unmigrated_app_syncdb' does not have migrations."
112.         with self.assertRaisesMessage(CommandError, msg):
113.             call_command("migrate", app_label="unmigrated_app_syncdb")
114. 
115.     @override_settings(
116.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_clashing_prefix"}
117.     )
118.     def test_ambiguous_prefix(self):
119.         msg = (
120.             "More than one migration matches 'a' in app 'migrations'. Please "
121.             "be more specific."
122.         )
123.         with self.assertRaisesMessage(CommandError, msg):
124.             call_command("migrate", app_label="migrations", migration_name="a")
125. 
126.     @override_settings(MIGRATION_MODULES={"migrations": "migrations.test_migrations"})
127.     def test_unknown_prefix(self):
128.         msg = "Cannot find a migration matching 'nonexistent' from app 'migrations'."
129.         with self.assertRaisesMessage(CommandError, msg):
130.             call_command(
131.                 "migrate", app_label="migrations", migration_name="nonexistent"
132.             )
133. 
134.     @override_settings(
135.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_initial_false"}
136.     )
137.     def test_migrate_initial_false(self):
138.         """
139.         `Migration.initial = False` skips fake-initial detection.
140.         """
141.         # Make sure no tables are created
142.         self.assertTableNotExists("migrations_author")
143.         self.assertTableNotExists("migrations_tribble")
144.         # Run the migrations to 0001 only
145.         call_command("migrate", "migrations", "0001", verbosity=0)
146.         # Fake rollback
147.         call_command("migrate", "migrations", "zero", fake=True, verbosity=0)
148.         # Make sure fake-initial detection does not run
149.         with self.assertRaises(DatabaseError):
150.             call_command(
151.                 "migrate", "migrations", "0001", fake_initial=True, verbosity=0
152.             )
153. 
154.         call_command("migrate", "migrations", "0001", fake=True, verbosity=0)
155.         # Real rollback
156.         call_command("migrate", "migrations", "zero", verbosity=0)
157.         # Make sure it's all gone
158.         self.assertTableNotExists("migrations_author")
159.         self.assertTableNotExists("migrations_tribble")
160.         self.assertTableNotExists("migrations_book")
161. 
162.     @override_settings(
163.         MIGRATION_MODULES={"migrations": "migrations.test_migrations"},
164.         DATABASE_ROUTERS=["migrations.routers.TestRouter"],
165.     )
166.     def test_migrate_fake_initial(self):
167.         """
168.         --fake-initial only works if all tables created in the initial
169.         migration of an app exists. Database routers must be obeyed when doing
170.         that check.
171.         """
172.         # Make sure no tables are created
173.         for db in self.databases:
174.             self.assertTableNotExists("migrations_author", using=db)
175.             self.assertTableNotExists("migrations_tribble", using=db)
176.         # Run the migrations to 0001 only
177.         call_command("migrate", "migrations", "0001", verbosity=0)
178.         call_command("migrate", "migrations", "0001", verbosity=0, database="other")
179.         # Make sure the right tables exist
180.         self.assertTableExists("migrations_author")
181.         self.assertTableNotExists("migrations_tribble")
182.         # Also check the "other" database
183.         self.assertTableNotExists("migrations_author", using="other")
184.         self.assertTableExists("migrations_tribble", using="other")
185. 
186.         # Fake a roll-back
187.         call_command("migrate", "migrations", "zero", fake=True, verbosity=0)
188.         call_command(
189.             "migrate", "migrations", "zero", fake=True, verbosity=0, database="other"
190.         )
191.         # Make sure the tables still exist
192.         self.assertTableExists("migrations_author")
193.         self.assertTableExists("migrations_tribble", using="other")
194.         # Try to run initial migration
195.         with self.assertRaises(DatabaseError):
196.             call_command("migrate", "migrations", "0001", verbosity=0)
197.         # Run initial migration with an explicit --fake-initial
198.         out = io.StringIO()
199.         with mock.patch(
200.             "django.core.management.color.supports_color", lambda *args: False
201.         ):
202.             call_command(
203.                 "migrate",
204.                 "migrations",
205.                 "0001",
206.                 fake_initial=True,
207.                 stdout=out,
208.                 verbosity=1,
209.             )
210.             call_command(
211.                 "migrate",
212.                 "migrations",
213.                 "0001",
214.                 fake_initial=True,
215.                 verbosity=0,
216.                 database="other",
217.             )
218.         self.assertIn("migrations.0001_initial... faked", out.getvalue().lower())
219.         try:
220.             # Run migrations all the way.
221.             call_command("migrate", verbosity=0)
222.             call_command("migrate", verbosity=0, database="other")
223.             self.assertTableExists("migrations_author")
224.             self.assertTableNotExists("migrations_tribble")
225.             self.assertTableExists("migrations_book")
226.             self.assertTableNotExists("migrations_author", using="other")
227.             self.assertTableNotExists("migrations_tribble", using="other")
228.             self.assertTableNotExists("migrations_book", using="other")
229.             # Fake a roll-back.
230.             call_command("migrate", "migrations", "zero", fake=True, verbosity=0)
231.             call_command(
232.                 "migrate",
233.                 "migrations",
234.                 "zero",
235.                 fake=True,
236.                 verbosity=0,
237.                 database="other",
238.             )
239.             self.assertTableExists("migrations_author")
240.             self.assertTableNotExists("migrations_tribble")
241.             self.assertTableExists("migrations_book")
242.             # Run initial migration.
243.             with self.assertRaises(DatabaseError):
244.                 call_command("migrate", "migrations", verbosity=0)
245.             # Run initial migration with an explicit --fake-initial.
246.             with self.assertRaises(DatabaseError):
247.                 # Fails because "migrations_tribble" does not exist but needs
248.                 # to in order to make --fake-initial work.
249.                 call_command("migrate", "migrations", fake_initial=True, verbosity=0)
250.             # Fake an apply.
251.             call_command("migrate", "migrations", fake=True, verbosity=0)
252.             call_command(
253.                 "migrate", "migrations", fake=True, verbosity=0, database="other"
254.             )
255.         finally:
256.             # Unmigrate everything.
257.             call_command("migrate", "migrations", "zero", verbosity=0)
258.             call_command("migrate", "migrations", "zero", verbosity=0, database="other")
259.         # Make sure it's all gone
260.         for db in self.databases:
261.             self.assertTableNotExists("migrations_author", using=db)
262.             self.assertTableNotExists("migrations_tribble", using=db)
263.             self.assertTableNotExists("migrations_book", using=db)
264. 
265.     @skipUnlessDBFeature("ignores_table_name_case")
266.     def test_migrate_fake_initial_case_insensitive(self):
267.         with override_settings(
268.             MIGRATION_MODULES={
269.                 "migrations": "migrations.test_fake_initial_case_insensitive.initial",
270.             }
271.         ):
272.             call_command("migrate", "migrations", "0001", verbosity=0)
273.             call_command("migrate", "migrations", "zero", fake=True, verbosity=0)
274. 
275.         with override_settings(
276.             MIGRATION_MODULES={
277.                 "migrations": (
278.                     "migrations.test_fake_initial_case_insensitive.fake_initial"
279.                 ),
280.             }
281.         ):
282.             out = io.StringIO()
283.             call_command(
284.                 "migrate",
285.                 "migrations",
286.                 "0001",
287.                 fake_initial=True,
288.                 stdout=out,
289.                 verbosity=1,
290.                 no_color=True,
291.             )
292.             self.assertIn(
293.                 "migrations.0001_initial... faked",
294.                 out.getvalue().lower(),
295.             )
296. 
297.     @override_settings(
298.         MIGRATION_MODULES={
299.             "migrations": "migrations.test_migrations_fake_split_initial"
300.         }
301.     )
302.     def test_migrate_fake_split_initial(self):
303.         """
304.         Split initial migrations can be faked with --fake-initial.
305.         """
306.         try:
307.             call_command("migrate", "migrations", "0002", verbosity=0)
308.             call_command("migrate", "migrations", "zero", fake=True, verbosity=0)
309.             out = io.StringIO()
310.             with mock.patch(
311.                 "django.core.management.color.supports_color", lambda *args: False
312.             ):
313.                 call_command(
314.                     "migrate",
315.                     "migrations",
316.                     "0002",
317.                     fake_initial=True,
318.                     stdout=out,
319.                     verbosity=1,
320.                 )
321.             value = out.getvalue().lower()
322.             self.assertIn("migrations.0001_initial... faked", value)
323.             self.assertIn("migrations.0002_second... faked", value)
324.         finally:
325.             # Fake an apply.
326.             call_command("migrate", "migrations", fake=True, verbosity=0)
327.             # Unmigrate everything.
328.             call_command("migrate", "migrations", "zero", verbosity=0)
329. 
330.     @override_settings(
331.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_conflict"}
332.     )
333.     def test_migrate_conflict_exit(self):
334.         """
335.         migrate exits if it detects a conflict.
336.         """
337.         msg = (
338.             "Conflicting migrations detected; multiple leaf nodes in the "
339.             "migration graph: (0002_conflicting_second, 0002_second in "
340.             "migrations).\n"
341.             "To fix them run 'python manage.py makemigrations --merge'"
342.         )
343.         with self.assertRaisesMessage(CommandError, msg):
344.             call_command("migrate", "migrations")
345. 
346.     @override_settings(
347.         MIGRATION_MODULES={
348.             "migrations": "migrations.test_migrations",
349.         }
350.     )
351.     def test_migrate_check(self):
352.         with self.assertRaises(SystemExit):
353.             call_command("migrate", "migrations", "0001", check_unapplied=True)
354.         self.assertTableNotExists("migrations_author")
355.         self.assertTableNotExists("migrations_tribble")
356.         self.assertTableNotExists("migrations_book")
357. 
358.     @override_settings(
359.         INSTALLED_APPS=[
360.             "migrations.migrations_test_apps.migrated_app",
361.         ]
362.     )
363.     def test_migrate_check_migrated_app(self):
364.         out = io.StringIO()
365.         try:
366.             call_command("migrate", "migrated_app", verbosity=0)
367.             call_command(
368.                 "migrate",
369.                 "migrated_app",
370.                 stdout=out,
371.                 check_unapplied=True,
372.             )
373.             self.assertEqual(out.getvalue(), "")
374.         finally:
375.             # Unmigrate everything.
376.             call_command("migrate", "migrated_app", "zero", verbosity=0)
377. 
378.     @override_settings(
379.         MIGRATION_MODULES={
380.             "migrations": "migrations.test_migrations_plan",
381.         }
382.     )
383.     def test_migrate_check_plan(self):
384.         out = io.StringIO()
385.         with self.assertRaises(SystemExit):
386.             call_command(
387.                 "migrate",
388.                 "migrations",
389.                 "0001",
390.                 check_unapplied=True,
391.                 plan=True,
392.                 stdout=out,
393.                 no_color=True,
394.             )
395.         self.assertEqual(
396.             "Planned operations:\n"
397.             "migrations.0001_initial\n"
398.             "    Create model Salamander\n"
399.             "    Raw Python operation -> Grow salamander tail.\n",
400.             out.getvalue(),
401.         )
402. 
403.     @override_settings(MIGRATION_MODULES={"migrations": "migrations.test_migrations"})
404.     def test_showmigrations_list(self):
405.         """
406.         showmigrations --list  displays migrations and whether or not they're
407.         applied.
408.         """
409.         out = io.StringIO()
410.         with mock.patch(
411.             "django.core.management.color.supports_color", lambda *args: True
412.         ):
413.             call_command(
414.                 "showmigrations", format="list", stdout=out, verbosity=0, no_color=False
415.             )
416.         self.assertEqual(
417.             "\x1b[1mmigrations\n\x1b[0m [ ] 0001_initial\n [ ] 0002_second\n",
418.             out.getvalue().lower(),
419.         )
420. 
421.         call_command("migrate", "migrations", "0001", verbosity=0)
422. 
423.         out = io.StringIO()
424.         # Giving the explicit app_label tests for selective `show_list` in the command
425.         call_command(
426.             "showmigrations",
427.             "migrations",
428.             format="list",
429.             stdout=out,
430.             verbosity=0,
431.             no_color=True,
432.         )
433.         self.assertEqual(
434.             "migrations\n [x] 0001_initial\n [ ] 0002_second\n", out.getvalue().lower()
435.         )
436.         out = io.StringIO()
437.         # Applied datetimes are displayed at verbosity 2+.
438.         call_command(
439.             "showmigrations", "migrations", stdout=out, verbosity=2, no_color=True
440.         )
441.         migration1 = MigrationRecorder(connection).migration_qs.get(
442.             app="migrations", name="0001_initial"
443.         )
444.         self.assertEqual(
445.             "migrations\n"
446.             " [x] 0001_initial (applied at %s)\n"
447.             " [ ] 0002_second\n" % migration1.applied.strftime("%Y-%m-%d %H:%M:%S"),
448.             out.getvalue().lower(),
449.         )
450.         # Cleanup by unmigrating everything
451.         call_command("migrate", "migrations", "zero", verbosity=0)
452. 
453.     @override_settings(
454.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_squashed"}
455.     )
456.     def test_showmigrations_list_squashed(self):
457.         out = io.StringIO()
458.         call_command(
459.             "showmigrations", format="list", stdout=out, verbosity=2, no_color=True
460.         )
461.         self.assertEqual(
462.             "migrations\n [ ] 0001_squashed_0002 (2 squashed migrations)\n",
463.             out.getvalue().lower(),
464.         )
465.         out = io.StringIO()
466.         call_command(
467.             "migrate",
468.             "migrations",
469.             "0001_squashed_0002",
470.             stdout=out,
471.             verbosity=2,
472.             no_color=True,
473.         )
474.         try:
475.             self.assertIn(
476.                 "operations to perform:\n"
477.                 "  target specific migration: 0001_squashed_0002, from migrations\n"
478.                 "running pre-migrate handlers for application migrations\n"
479.                 "running migrations:\n"
480.                 "  applying migrations.0001_squashed_0002... ok (",
481.                 out.getvalue().lower(),
482.             )
483.             out = io.StringIO()
484.             call_command(
485.                 "showmigrations", format="list", stdout=out, verbosity=2, no_color=True
486.             )
487.             self.assertEqual(
488.                 "migrations\n [x] 0001_squashed_0002 (2 squashed migrations)\n",
489.                 out.getvalue().lower(),
490.             )
491.         finally:
492.             # Unmigrate everything.
493.             call_command("migrate", "migrations", "zero", verbosity=0)
494. 
495.     @override_settings(
496.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_run_before"}
497.     )
498.     def test_showmigrations_plan(self):
499.         """
500.         Tests --plan output of showmigrations command


File: tests/migrations/test_commands.py
Line number range: 501 - 1000
Content:
501.         """
502.         out = io.StringIO()
503.         call_command("showmigrations", format="plan", stdout=out)
504.         self.assertEqual(
505.             "[ ]  migrations.0001_initial\n"
506.             "[ ]  migrations.0003_third\n"
507.             "[ ]  migrations.0002_second\n",
508.             out.getvalue().lower(),
509.         )
510. 
511.         out = io.StringIO()
512.         call_command("showmigrations", format="plan", stdout=out, verbosity=2)
513.         self.assertEqual(
514.             "[ ]  migrations.0001_initial\n"
515.             "[ ]  migrations.0003_third ... (migrations.0001_initial)\n"
516.             "[ ]  migrations.0002_second ... (migrations.0001_initial, "
517.             "migrations.0003_third)\n",
518.             out.getvalue().lower(),
519.         )
520.         call_command("migrate", "migrations", "0003", verbosity=0)
521. 
522.         out = io.StringIO()
523.         call_command("showmigrations", format="plan", stdout=out)
524.         self.assertEqual(
525.             "[x]  migrations.0001_initial\n"
526.             "[x]  migrations.0003_third\n"
527.             "[ ]  migrations.0002_second\n",
528.             out.getvalue().lower(),
529.         )
530. 
531.         out = io.StringIO()
532.         call_command("showmigrations", format="plan", stdout=out, verbosity=2)
533.         self.assertEqual(
534.             "[x]  migrations.0001_initial\n"
535.             "[x]  migrations.0003_third ... (migrations.0001_initial)\n"
536.             "[ ]  migrations.0002_second ... (migrations.0001_initial, "
537.             "migrations.0003_third)\n",
538.             out.getvalue().lower(),
539.         )
540. 
541.         # Cleanup by unmigrating everything
542.         call_command("migrate", "migrations", "zero", verbosity=0)
543. 
544.     @override_settings(
545.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_plan"}
546.     )
547.     def test_migrate_plan(self):
548.         """Tests migrate --plan output."""
549.         out = io.StringIO()
550.         # Show the plan up to the third migration.
551.         call_command(
552.             "migrate", "migrations", "0003", plan=True, stdout=out, no_color=True
553.         )
554.         self.assertEqual(
555.             "Planned operations:\n"
556.             "migrations.0001_initial\n"
557.             "    Create model Salamander\n"
558.             "    Raw Python operation -> Grow salamander tail.\n"
559.             "migrations.0002_second\n"
560.             "    Create model Book\n"
561.             "    Raw SQL operation -> ['SELECT * FROM migrations_book']\n"
562.             "migrations.0003_third\n"
563.             "    Create model Author\n"
564.             "    Raw SQL operation -> ['SELECT * FROM migrations_author']\n",
565.             out.getvalue(),
566.         )
567.         try:
568.             # Migrate to the third migration.
569.             call_command("migrate", "migrations", "0003", verbosity=0)
570.             out = io.StringIO()
571.             # Show the plan for when there is nothing to apply.
572.             call_command(
573.                 "migrate", "migrations", "0003", plan=True, stdout=out, no_color=True
574.             )
575.             self.assertEqual(
576.                 "Planned operations:\n  No planned migration operations.\n",
577.                 out.getvalue(),
578.             )
579.             out = io.StringIO()
580.             # Show the plan for reverse migration back to 0001.
581.             call_command(
582.                 "migrate", "migrations", "0001", plan=True, stdout=out, no_color=True
583.             )
584.             self.assertEqual(
585.                 "Planned operations:\n"
586.                 "migrations.0003_third\n"
587.                 "    Undo Create model Author\n"
588.                 "    Raw SQL operation -> ['SELECT * FROM migrations_book']\n"
589.                 "migrations.0002_second\n"
590.                 "    Undo Create model Book\n"
591.                 "    Raw SQL operation -> ['SELECT * FROM migrations_salamand…\n",
592.                 out.getvalue(),
593.             )
594.             out = io.StringIO()
595.             # Show the migration plan to fourth, with truncated details.
596.             call_command(
597.                 "migrate", "migrations", "0004", plan=True, stdout=out, no_color=True
598.             )
599.             self.assertEqual(
600.                 "Planned operations:\n"
601.                 "migrations.0004_fourth\n"
602.                 "    Raw SQL operation -> SELECT * FROM migrations_author WHE…\n",
603.                 out.getvalue(),
604.             )
605.             # Show the plan when an operation is irreversible.
606.             # Migrate to the fourth migration.
607.             call_command("migrate", "migrations", "0004", verbosity=0)
608.             out = io.StringIO()
609.             call_command(
610.                 "migrate", "migrations", "0003", plan=True, stdout=out, no_color=True
611.             )
612.             self.assertEqual(
613.                 "Planned operations:\n"
614.                 "migrations.0004_fourth\n"
615.                 "    Raw SQL operation -> IRREVERSIBLE\n",
616.                 out.getvalue(),
617.             )
618.             out = io.StringIO()
619.             call_command(
620.                 "migrate", "migrations", "0005", plan=True, stdout=out, no_color=True
621.             )
622.             # Operation is marked as irreversible only in the revert plan.
623.             self.assertEqual(
624.                 "Planned operations:\n"
625.                 "migrations.0005_fifth\n"
626.                 "    Raw Python operation\n"
627.                 "    Raw Python operation\n"
628.                 "    Raw Python operation -> Feed salamander.\n",
629.                 out.getvalue(),
630.             )
631.             call_command("migrate", "migrations", "0005", verbosity=0)
632.             out = io.StringIO()
633.             call_command(
634.                 "migrate", "migrations", "0004", plan=True, stdout=out, no_color=True
635.             )
636.             self.assertEqual(
637.                 "Planned operations:\n"
638.                 "migrations.0005_fifth\n"
639.                 "    Raw Python operation -> IRREVERSIBLE\n"
640.                 "    Raw Python operation -> IRREVERSIBLE\n"
641.                 "    Raw Python operation\n",
642.                 out.getvalue(),
643.             )
644.         finally:
645.             # Cleanup by unmigrating everything: fake the irreversible, then
646.             # migrate all to zero.
647.             call_command("migrate", "migrations", "0003", fake=True, verbosity=0)
648.             call_command("migrate", "migrations", "zero", verbosity=0)
649. 
650.     @override_settings(
651.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_empty"}
652.     )
653.     def test_showmigrations_no_migrations(self):
654.         out = io.StringIO()
655.         call_command("showmigrations", stdout=out, no_color=True)
656.         self.assertEqual("migrations\n (no migrations)\n", out.getvalue().lower())
657. 
658.     @override_settings(
659.         INSTALLED_APPS=["migrations.migrations_test_apps.unmigrated_app"]
660.     )
661.     def test_showmigrations_unmigrated_app(self):
662.         out = io.StringIO()
663.         call_command("showmigrations", "unmigrated_app", stdout=out, no_color=True)
664.         try:
665.             self.assertEqual(
666.                 "unmigrated_app\n (no migrations)\n", out.getvalue().lower()
667.             )
668.         finally:
669.             # unmigrated_app.SillyModel has a foreign key to
670.             # 'migrations.Tribble', but that model is only defined in a
671.             # migration, so the global app registry never sees it and the
672.             # reference is left dangling. Remove it to avoid problems in
673.             # subsequent tests.
674.             apps._pending_operations.pop(("migrations", "tribble"), None)
675. 
676.     @override_settings(
677.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_empty"}
678.     )
679.     def test_showmigrations_plan_no_migrations(self):
680.         """
681.         Tests --plan output of showmigrations command without migrations
682.         """
683.         out = io.StringIO()
684.         call_command("showmigrations", format="plan", stdout=out, no_color=True)
685.         self.assertEqual("(no migrations)\n", out.getvalue().lower())
686. 
687.         out = io.StringIO()
688.         call_command(
689.             "showmigrations", format="plan", stdout=out, verbosity=2, no_color=True
690.         )
691.         self.assertEqual("(no migrations)\n", out.getvalue().lower())
692. 
693.     @override_settings(
694.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_squashed_complex"}
695.     )
696.     def test_showmigrations_plan_squashed(self):
697.         """
698.         Tests --plan output of showmigrations command with squashed migrations.
699.         """
700.         out = io.StringIO()
701.         call_command("showmigrations", format="plan", stdout=out)
702.         self.assertEqual(
703.             "[ ]  migrations.1_auto\n"
704.             "[ ]  migrations.2_auto\n"
705.             "[ ]  migrations.3_squashed_5\n"
706.             "[ ]  migrations.6_auto\n"
707.             "[ ]  migrations.7_auto\n",
708.             out.getvalue().lower(),
709.         )
710. 
711.         out = io.StringIO()
712.         call_command("showmigrations", format="plan", stdout=out, verbosity=2)
713.         self.assertEqual(
714.             "[ ]  migrations.1_auto\n"
715.             "[ ]  migrations.2_auto ... (migrations.1_auto)\n"
716.             "[ ]  migrations.3_squashed_5 ... (migrations.2_auto)\n"
717.             "[ ]  migrations.6_auto ... (migrations.3_squashed_5)\n"
718.             "[ ]  migrations.7_auto ... (migrations.6_auto)\n",
719.             out.getvalue().lower(),
720.         )
721. 
722.         call_command("migrate", "migrations", "3_squashed_5", verbosity=0)
723. 
724.         out = io.StringIO()
725.         call_command("showmigrations", format="plan", stdout=out)
726.         self.assertEqual(
727.             "[x]  migrations.1_auto\n"
728.             "[x]  migrations.2_auto\n"
729.             "[x]  migrations.3_squashed_5\n"
730.             "[ ]  migrations.6_auto\n"
731.             "[ ]  migrations.7_auto\n",
732.             out.getvalue().lower(),
733.         )
734. 
735.         out = io.StringIO()
736.         call_command("showmigrations", format="plan", stdout=out, verbosity=2)
737.         self.assertEqual(
738.             "[x]  migrations.1_auto\n"
739.             "[x]  migrations.2_auto ... (migrations.1_auto)\n"
740.             "[x]  migrations.3_squashed_5 ... (migrations.2_auto)\n"
741.             "[ ]  migrations.6_auto ... (migrations.3_squashed_5)\n"
742.             "[ ]  migrations.7_auto ... (migrations.6_auto)\n",
743.             out.getvalue().lower(),
744.         )
745. 
746.     @override_settings(
747.         INSTALLED_APPS=[
748.             "migrations.migrations_test_apps.mutate_state_b",
749.             "migrations.migrations_test_apps.alter_fk.author_app",
750.             "migrations.migrations_test_apps.alter_fk.book_app",
751.         ]
752.     )
753.     def test_showmigrations_plan_single_app_label(self):
754.         """
755.         `showmigrations --plan app_label` output with a single app_label.
756.         """
757.         # Single app with no dependencies on other apps.
758.         out = io.StringIO()
759.         call_command("showmigrations", "mutate_state_b", format="plan", stdout=out)
760.         self.assertEqual(
761.             "[ ]  mutate_state_b.0001_initial\n[ ]  mutate_state_b.0002_add_field\n",
762.             out.getvalue(),
763.         )
764.         # Single app with dependencies.
765.         out = io.StringIO()
766.         call_command("showmigrations", "author_app", format="plan", stdout=out)
767.         self.assertEqual(
768.             "[ ]  author_app.0001_initial\n"
769.             "[ ]  book_app.0001_initial\n"
770.             "[ ]  author_app.0002_alter_id\n",
771.             out.getvalue(),
772.         )
773.         # Some migrations already applied.
774.         call_command("migrate", "author_app", "0001", verbosity=0)
775.         out = io.StringIO()
776.         call_command("showmigrations", "author_app", format="plan", stdout=out)
777.         self.assertEqual(
778.             "[X]  author_app.0001_initial\n"
779.             "[ ]  book_app.0001_initial\n"
780.             "[ ]  author_app.0002_alter_id\n",
781.             out.getvalue(),
782.         )
783.         # Cleanup by unmigrating author_app.
784.         call_command("migrate", "author_app", "zero", verbosity=0)
785. 
786.     @override_settings(
787.         INSTALLED_APPS=[
788.             "migrations.migrations_test_apps.mutate_state_b",
789.             "migrations.migrations_test_apps.alter_fk.author_app",
790.             "migrations.migrations_test_apps.alter_fk.book_app",
791.         ]
792.     )
793.     def test_showmigrations_plan_multiple_app_labels(self):
794.         """
795.         `showmigrations --plan app_label` output with multiple app_labels.
796.         """
797.         # Multiple apps: author_app depends on book_app; mutate_state_b doesn't
798.         # depend on other apps.
799.         out = io.StringIO()
800.         call_command(
801.             "showmigrations", "mutate_state_b", "author_app", format="plan", stdout=out
802.         )
803.         self.assertEqual(
804.             "[ ]  author_app.0001_initial\n"
805.             "[ ]  book_app.0001_initial\n"
806.             "[ ]  author_app.0002_alter_id\n"
807.             "[ ]  mutate_state_b.0001_initial\n"
808.             "[ ]  mutate_state_b.0002_add_field\n",
809.             out.getvalue(),
810.         )
811.         # Multiple apps: args order shouldn't matter (the same result is
812.         # expected as above).
813.         out = io.StringIO()
814.         call_command(
815.             "showmigrations", "author_app", "mutate_state_b", format="plan", stdout=out
816.         )
817.         self.assertEqual(
818.             "[ ]  author_app.0001_initial\n"
819.             "[ ]  book_app.0001_initial\n"
820.             "[ ]  author_app.0002_alter_id\n"
821.             "[ ]  mutate_state_b.0001_initial\n"
822.             "[ ]  mutate_state_b.0002_add_field\n",
823.             out.getvalue(),
824.         )
825. 
826.     @override_settings(
827.         INSTALLED_APPS=["migrations.migrations_test_apps.unmigrated_app"]
828.     )
829.     def test_showmigrations_plan_app_label_no_migrations(self):
830.         out = io.StringIO()
831.         call_command(
832.             "showmigrations", "unmigrated_app", format="plan", stdout=out, no_color=True
833.         )
834.         try:
835.             self.assertEqual("(no migrations)\n", out.getvalue())
836.         finally:
837.             # unmigrated_app.SillyModel has a foreign key to
838.             # 'migrations.Tribble', but that model is only defined in a
839.             # migration, so the global app registry never sees it and the
840.             # reference is left dangling. Remove it to avoid problems in
841.             # subsequent tests.
842.             apps._pending_operations.pop(("migrations", "tribble"), None)
843. 
844.     @override_settings(MIGRATION_MODULES={"migrations": "migrations.test_migrations"})
845.     def test_sqlmigrate_forwards(self):
846.         """
847.         sqlmigrate outputs forward looking SQL.
848.         """
849.         out = io.StringIO()
850.         call_command("sqlmigrate", "migrations", "0001", stdout=out)
851. 
852.         lines = out.getvalue().splitlines()
853. 
854.         if connection.features.can_rollback_ddl:
855.             self.assertEqual(lines[0], connection.ops.start_transaction_sql())
856.             self.assertEqual(lines[-1], connection.ops.end_transaction_sql())
857.             lines = lines[1:-1]
858. 
859.         self.assertEqual(
860.             lines[:3],
861.             [
862.                 "--",
863.                 "-- Create model Author",
864.                 "--",
865.             ],
866.         )
867.         self.assertIn(
868.             "create table %s" % connection.ops.quote_name("migrations_author").lower(),
869.             lines[3].lower(),
870.         )
871.         pos = lines.index("--", 3)
872.         self.assertEqual(
873.             lines[pos : pos + 3],
874.             [
875.                 "--",
876.                 "-- Create model Tribble",
877.                 "--",
878.             ],
879.         )
880.         self.assertIn(
881.             "create table %s" % connection.ops.quote_name("migrations_tribble").lower(),
882.             lines[pos + 3].lower(),
883.         )
884.         pos = lines.index("--", pos + 3)
885.         self.assertEqual(
886.             lines[pos : pos + 3],
887.             [
888.                 "--",
889.                 "-- Add field bool to tribble",
890.                 "--",
891.             ],
892.         )
893.         pos = lines.index("--", pos + 3)
894.         self.assertEqual(
895.             lines[pos : pos + 3],
896.             [
897.                 "--",
898.                 "-- Alter unique_together for author (1 constraint(s))",
899.                 "--",
900.             ],
901.         )
902. 
903.     @override_settings(MIGRATION_MODULES={"migrations": "migrations.test_migrations"})
904.     def test_sqlmigrate_backwards(self):
905.         """
906.         sqlmigrate outputs reverse looking SQL.
907.         """
908.         # Cannot generate the reverse SQL unless we've applied the migration.
909.         call_command("migrate", "migrations", verbosity=0)
910. 
911.         out = io.StringIO()
912.         call_command("sqlmigrate", "migrations", "0001", stdout=out, backwards=True)
913. 
914.         lines = out.getvalue().splitlines()
915.         try:
916.             if connection.features.can_rollback_ddl:
917.                 self.assertEqual(lines[0], connection.ops.start_transaction_sql())
918.                 self.assertEqual(lines[-1], connection.ops.end_transaction_sql())
919.                 lines = lines[1:-1]
920. 
921.             self.assertEqual(
922.                 lines[:3],
923.                 [
924.                     "--",
925.                     "-- Alter unique_together for author (1 constraint(s))",
926.                     "--",
927.                 ],
928.             )
929.             pos = lines.index("--", 3)
930.             self.assertEqual(
931.                 lines[pos : pos + 3],
932.                 [
933.                     "--",
934.                     "-- Add field bool to tribble",
935.                     "--",
936.                 ],
937.             )
938.             pos = lines.index("--", pos + 3)
939.             self.assertEqual(
940.                 lines[pos : pos + 3],
941.                 [
942.                     "--",
943.                     "-- Create model Tribble",
944.                     "--",
945.                 ],
946.             )
947.             next_pos = lines.index("--", pos + 3)
948.             drop_table_sql = (
949.                 "drop table %s"
950.                 % connection.ops.quote_name("migrations_tribble").lower()
951.             )
952.             for line in lines[pos + 3 : next_pos]:
953.                 if drop_table_sql in line.lower():
954.                     break
955.             else:
956.                 self.fail("DROP TABLE (tribble) not found.")
957.             pos = next_pos
958.             self.assertEqual(
959.                 lines[pos : pos + 3],
960.                 [
961.                     "--",
962.                     "-- Create model Author",
963.                     "--",
964.                 ],
965.             )
966.             drop_table_sql = (
967.                 "drop table %s" % connection.ops.quote_name("migrations_author").lower()
968.             )
969.             for line in lines[pos + 3 :]:
970.                 if drop_table_sql in line.lower():
971.                     break
972.             else:
973.                 self.fail("DROP TABLE (author) not found.")
974.         finally:
975.             # Unmigrate everything.
976.             call_command("migrate", "migrations", "zero", verbosity=0)
977. 
978.     @override_settings(
979.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_non_atomic"}
980.     )
981.     def test_sqlmigrate_for_non_atomic_migration(self):
982.         """
983.         Transaction wrappers aren't shown for non-atomic migrations.
984.         """
985.         out = io.StringIO()
986.         call_command("sqlmigrate", "migrations", "0001", stdout=out)
987.         output = out.getvalue().lower()
988.         queries = [q.strip() for q in output.splitlines()]
989.         if connection.ops.start_transaction_sql():
990.             self.assertNotIn(connection.ops.start_transaction_sql().lower(), queries)
991.         self.assertNotIn(connection.ops.end_transaction_sql().lower(), queries)
992. 
993.     @override_settings(MIGRATION_MODULES={"migrations": "migrations.test_migrations"})
994.     def test_sqlmigrate_for_non_transactional_databases(self):
995.         """
996.         Transaction wrappers aren't shown for databases that don't support
997.         transactional DDL.
998.         """
999.         out = io.StringIO()
1000.         with mock.patch.object(connection.features, "can_rollback_ddl", False):


File: tests/migrations/test_commands.py
Line number range: 1001 - 1500
Content:
1001.             call_command("sqlmigrate", "migrations", "0001", stdout=out)
1002.         output = out.getvalue().lower()
1003.         queries = [q.strip() for q in output.splitlines()]
1004.         start_transaction_sql = connection.ops.start_transaction_sql()
1005.         if start_transaction_sql:
1006.             self.assertNotIn(start_transaction_sql.lower(), queries)
1007.         self.assertNotIn(connection.ops.end_transaction_sql().lower(), queries)
1008. 
1009.     @override_settings(
1010.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_squashed"}
1011.     )
1012.     def test_sqlmigrate_ambiguous_prefix_squashed_migrations(self):
1013.         msg = (
1014.             "More than one migration matches '0001' in app 'migrations'. "
1015.             "Please be more specific."
1016.         )
1017.         with self.assertRaisesMessage(CommandError, msg):
1018.             call_command("sqlmigrate", "migrations", "0001")
1019. 
1020.     @override_settings(
1021.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_squashed"}
1022.     )
1023.     def test_sqlmigrate_squashed_migration(self):
1024.         out = io.StringIO()
1025.         call_command("sqlmigrate", "migrations", "0001_squashed_0002", stdout=out)
1026.         output = out.getvalue().lower()
1027.         self.assertIn("-- create model author", output)
1028.         self.assertIn("-- create model book", output)
1029.         self.assertNotIn("-- create model tribble", output)
1030. 
1031.     @override_settings(
1032.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_squashed"}
1033.     )
1034.     def test_sqlmigrate_replaced_migration(self):
1035.         out = io.StringIO()
1036.         call_command("sqlmigrate", "migrations", "0001_initial", stdout=out)
1037.         output = out.getvalue().lower()
1038.         self.assertIn("-- create model author", output)
1039.         self.assertIn("-- create model tribble", output)
1040. 
1041.     @override_settings(
1042.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_no_operations"}
1043.     )
1044.     def test_sqlmigrate_no_operations(self):
1045.         err = io.StringIO()
1046.         call_command("sqlmigrate", "migrations", "0001_initial", stderr=err)
1047.         self.assertEqual(err.getvalue(), "No operations found.\n")
1048. 
1049.     @override_settings(
1050.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_noop"}
1051.     )
1052.     def test_sqlmigrate_noop(self):
1053.         out = io.StringIO()
1054.         call_command("sqlmigrate", "migrations", "0001", stdout=out)
1055.         lines = out.getvalue().splitlines()
1056. 
1057.         if connection.features.can_rollback_ddl:
1058.             lines = lines[1:-1]
1059.         self.assertEqual(
1060.             lines,
1061.             [
1062.                 "--",
1063.                 "-- Raw SQL operation",
1064.                 "--",
1065.                 "-- (no-op)",
1066.             ],
1067.         )
1068. 
1069.     @override_settings(
1070.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_manual_porting"}
1071.     )
1072.     def test_sqlmigrate_unrepresentable(self):
1073.         out = io.StringIO()
1074.         call_command("sqlmigrate", "migrations", "0002", stdout=out)
1075.         lines = out.getvalue().splitlines()
1076. 
1077.         if connection.features.can_rollback_ddl:
1078.             lines = lines[1:-1]
1079.         self.assertEqual(
1080.             lines,
1081.             [
1082.                 "--",
1083.                 "-- Raw Python operation",
1084.                 "--",
1085.                 "-- THIS OPERATION CANNOT BE WRITTEN AS SQL",
1086.             ],
1087.         )
1088. 
1089.     @override_settings(
1090.         INSTALLED_APPS=[
1091.             "migrations.migrations_test_apps.migrated_app",
1092.             "migrations.migrations_test_apps.migrated_unapplied_app",
1093.             "migrations.migrations_test_apps.unmigrated_app",
1094.         ],
1095.     )
1096.     def test_regression_22823_unmigrated_fk_to_migrated_model(self):
1097.         """
1098.         Assuming you have 3 apps, `A`, `B`, and `C`, such that:
1099. 
1100.         * `A` has migrations
1101.         * `B` has a migration we want to apply
1102.         * `C` has no migrations, but has an FK to `A`
1103. 
1104.         When we try to migrate "B", an exception occurs because the
1105.         "B" was not included in the ProjectState that is used to detect
1106.         soft-applied migrations (#22823).
1107.         """
1108.         call_command("migrate", "migrated_unapplied_app", verbosity=0)
1109. 
1110.         # unmigrated_app.SillyModel has a foreign key to 'migrations.Tribble',
1111.         # but that model is only defined in a migration, so the global app
1112.         # registry never sees it and the reference is left dangling. Remove it
1113.         # to avoid problems in subsequent tests.
1114.         apps._pending_operations.pop(("migrations", "tribble"), None)
1115. 
1116.     @override_settings(
1117.         INSTALLED_APPS=["migrations.migrations_test_apps.unmigrated_app_syncdb"]
1118.     )
1119.     def test_migrate_syncdb_deferred_sql_executed_with_schemaeditor(self):
1120.         """
1121.         For an app without migrations, editor.execute() is used for executing
1122.         the syncdb deferred SQL.
1123.         """
1124.         stdout = io.StringIO()
1125.         with mock.patch.object(BaseDatabaseSchemaEditor, "execute") as execute:
1126.             call_command(
1127.                 "migrate", run_syncdb=True, verbosity=1, stdout=stdout, no_color=True
1128.             )
1129.             create_table_count = len(
1130.                 [call for call in execute.mock_calls if "CREATE TABLE" in str(call)]
1131.             )
1132.             self.assertEqual(create_table_count, 2)
1133.             # There's at least one deferred SQL for creating the foreign key
1134.             # index.
1135.             self.assertGreater(len(execute.mock_calls), 2)
1136.         stdout = stdout.getvalue()
1137.         self.assertIn("Synchronize unmigrated apps: unmigrated_app_syncdb", stdout)
1138.         self.assertIn("Creating tables...", stdout)
1139.         table_name = truncate_name(
1140.             "unmigrated_app_syncdb_classroom", connection.ops.max_name_length()
1141.         )
1142.         self.assertIn("Creating table %s" % table_name, stdout)
1143. 
1144.     @override_settings(MIGRATION_MODULES={"migrations": "migrations.test_migrations"})
1145.     def test_migrate_syncdb_app_with_migrations(self):
1146.         msg = "Can't use run_syncdb with app 'migrations' as it has migrations."
1147.         with self.assertRaisesMessage(CommandError, msg):
1148.             call_command("migrate", "migrations", run_syncdb=True, verbosity=0)
1149. 
1150.     @override_settings(
1151.         INSTALLED_APPS=[
1152.             "migrations.migrations_test_apps.unmigrated_app_syncdb",
1153.             "migrations.migrations_test_apps.unmigrated_app_simple",
1154.         ]
1155.     )
1156.     def test_migrate_syncdb_app_label(self):
1157.         """
1158.         Running migrate --run-syncdb with an app_label only creates tables for
1159.         the specified app.
1160.         """
1161.         stdout = io.StringIO()
1162.         with mock.patch.object(BaseDatabaseSchemaEditor, "execute") as execute:
1163.             call_command(
1164.                 "migrate", "unmigrated_app_syncdb", run_syncdb=True, stdout=stdout
1165.             )
1166.             create_table_count = len(
1167.                 [call for call in execute.mock_calls if "CREATE TABLE" in str(call)]
1168.             )
1169.             self.assertEqual(create_table_count, 2)
1170.             self.assertGreater(len(execute.mock_calls), 2)
1171.             self.assertIn(
1172.                 "Synchronize unmigrated app: unmigrated_app_syncdb", stdout.getvalue()
1173.             )
1174. 
1175.     @override_settings(
1176.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_squashed"}
1177.     )
1178.     def test_migrate_record_replaced(self):
1179.         """
1180.         Running a single squashed migration should record all of the original
1181.         replaced migrations as run.
1182.         """
1183.         recorder = MigrationRecorder(connection)
1184.         out = io.StringIO()
1185.         call_command("migrate", "migrations", verbosity=0)
1186.         call_command("showmigrations", "migrations", stdout=out, no_color=True)
1187.         self.assertEqual(
1188.             "migrations\n [x] 0001_squashed_0002 (2 squashed migrations)\n",
1189.             out.getvalue().lower(),
1190.         )
1191.         applied_migrations = recorder.applied_migrations()
1192.         self.assertIn(("migrations", "0001_initial"), applied_migrations)
1193.         self.assertIn(("migrations", "0002_second"), applied_migrations)
1194.         self.assertIn(("migrations", "0001_squashed_0002"), applied_migrations)
1195.         # Rollback changes
1196.         call_command("migrate", "migrations", "zero", verbosity=0)
1197. 
1198.     @override_settings(
1199.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_squashed"}
1200.     )
1201.     def test_migrate_record_squashed(self):
1202.         """
1203.         Running migrate for a squashed migration should record as run
1204.         if all of the replaced migrations have been run (#25231).
1205.         """
1206.         recorder = MigrationRecorder(connection)
1207.         recorder.record_applied("migrations", "0001_initial")
1208.         recorder.record_applied("migrations", "0002_second")
1209.         out = io.StringIO()
1210.         call_command("showmigrations", "migrations", stdout=out, no_color=True)
1211.         self.assertEqual(
1212.             "migrations\n"
1213.             " [-] 0001_squashed_0002 (2 squashed migrations) "
1214.             "run 'manage.py migrate' to finish recording.\n",
1215.             out.getvalue().lower(),
1216.         )
1217. 
1218.         out = io.StringIO()
1219.         call_command("migrate", "migrations", verbosity=0)
1220.         call_command("showmigrations", "migrations", stdout=out, no_color=True)
1221.         self.assertEqual(
1222.             "migrations\n [x] 0001_squashed_0002 (2 squashed migrations)\n",
1223.             out.getvalue().lower(),
1224.         )
1225.         self.assertIn(
1226.             ("migrations", "0001_squashed_0002"), recorder.applied_migrations()
1227.         )
1228.         # No changes were actually applied so there is nothing to rollback
1229. 
1230.     def test_migrate_partially_applied_squashed_migration(self):
1231.         """
1232.         Migrating to a squashed migration specified by name should succeed
1233.         even if it is partially applied.
1234.         """
1235.         with self.temporary_migration_module(module="migrations.test_migrations"):
1236.             recorder = MigrationRecorder(connection)
1237.             try:
1238.                 call_command("migrate", "migrations", "0001_initial", verbosity=0)
1239.                 call_command(
1240.                     "squashmigrations",
1241.                     "migrations",
1242.                     "0002",
1243.                     interactive=False,
1244.                     verbosity=0,
1245.                 )
1246.                 call_command(
1247.                     "migrate",
1248.                     "migrations",
1249.                     "0001_squashed_0002_second",
1250.                     verbosity=0,
1251.                 )
1252.                 applied_migrations = recorder.applied_migrations()
1253.                 self.assertIn(("migrations", "0002_second"), applied_migrations)
1254.             finally:
1255.                 # Unmigrate everything.
1256.                 call_command("migrate", "migrations", "zero", verbosity=0)
1257. 
1258.     @override_settings(
1259.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_squashed"}
1260.     )
1261.     def test_migrate_backward_to_squashed_migration(self):
1262.         try:
1263.             call_command("migrate", "migrations", "0001_squashed_0002", verbosity=0)
1264.             self.assertTableExists("migrations_author")
1265.             self.assertTableExists("migrations_book")
1266.             call_command("migrate", "migrations", "0001_initial", verbosity=0)
1267.             self.assertTableExists("migrations_author")
1268.             self.assertTableNotExists("migrations_book")
1269.         finally:
1270.             # Unmigrate everything.
1271.             call_command("migrate", "migrations", "zero", verbosity=0)
1272. 
1273.     @override_settings(MIGRATION_MODULES={"migrations": "migrations.test_migrations"})
1274.     def test_migrate_inconsistent_history(self):
1275.         """
1276.         Running migrate with some migrations applied before their dependencies
1277.         should not be allowed.
1278.         """
1279.         recorder = MigrationRecorder(connection)
1280.         recorder.record_applied("migrations", "0002_second")
1281.         msg = (
1282.             "Migration migrations.0002_second is applied before its dependency "
1283.             "migrations.0001_initial"
1284.         )
1285.         with self.assertRaisesMessage(InconsistentMigrationHistory, msg):
1286.             call_command("migrate")
1287.         applied_migrations = recorder.applied_migrations()
1288.         self.assertNotIn(("migrations", "0001_initial"), applied_migrations)
1289. 
1290.     @override_settings(
1291.         INSTALLED_APPS=[
1292.             "migrations.migrations_test_apps.migrated_unapplied_app",
1293.             "migrations.migrations_test_apps.migrated_app",
1294.         ]
1295.     )
1296.     def test_migrate_not_reflected_changes(self):
1297.         class NewModel1(models.Model):
1298.             class Meta:
1299.                 app_label = "migrated_app"
1300. 
1301.         class NewModel2(models.Model):
1302.             class Meta:
1303.                 app_label = "migrated_unapplied_app"
1304. 
1305.         out = io.StringIO()
1306.         try:
1307.             call_command("migrate", verbosity=0)
1308.             call_command("migrate", stdout=out, no_color=True)
1309.             self.assertEqual(
1310.                 "operations to perform:\n"
1311.                 "  apply all migrations: migrated_app, migrated_unapplied_app\n"
1312.                 "running migrations:\n"
1313.                 "  no migrations to apply.\n"
1314.                 "  your models in app(s): 'migrated_app', "
1315.                 "'migrated_unapplied_app' have changes that are not yet "
1316.                 "reflected in a migration, and so won't be applied.\n"
1317.                 "  run 'manage.py makemigrations' to make new migrations, and "
1318.                 "then re-run 'manage.py migrate' to apply them.\n",
1319.                 out.getvalue().lower(),
1320.             )
1321.         finally:
1322.             # Unmigrate everything.
1323.             call_command("migrate", "migrated_app", "zero", verbosity=0)
1324.             call_command("migrate", "migrated_unapplied_app", "zero", verbosity=0)
1325. 
1326.     @override_settings(
1327.         MIGRATION_MODULES={
1328.             "migrations": "migrations.test_migrations_squashed_no_replaces",
1329.         }
1330.     )
1331.     def test_migrate_prune(self):
1332.         """
1333.         With prune=True, references to migration files deleted from the
1334.         migrations module (such as after being squashed) are removed from the
1335.         django_migrations table.
1336.         """
1337.         recorder = MigrationRecorder(connection)
1338.         recorder.record_applied("migrations", "0001_initial")
1339.         recorder.record_applied("migrations", "0002_second")
1340.         recorder.record_applied("migrations", "0001_squashed_0002")
1341.         out = io.StringIO()
1342.         try:
1343.             call_command("migrate", "migrations", prune=True, stdout=out, no_color=True)
1344.             self.assertEqual(
1345.                 out.getvalue(),
1346.                 "Pruning migrations:\n"
1347.                 "  Pruning migrations.0001_initial OK\n"
1348.                 "  Pruning migrations.0002_second OK\n",
1349.             )
1350.             applied_migrations = [
1351.                 migration
1352.                 for migration in recorder.applied_migrations()
1353.                 if migration[0] == "migrations"
1354.             ]
1355.             self.assertEqual(applied_migrations, [("migrations", "0001_squashed_0002")])
1356.         finally:
1357.             recorder.record_unapplied("migrations", "0001_initial")
1358.             recorder.record_unapplied("migrations", "0001_second")
1359.             recorder.record_unapplied("migrations", "0001_squashed_0002")
1360. 
1361.     @override_settings(
1362.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_squashed"}
1363.     )
1364.     def test_prune_deleted_squashed_migrations_in_replaces(self):
1365.         out = io.StringIO()
1366.         with self.temporary_migration_module(
1367.             module="migrations.test_migrations_squashed"
1368.         ) as migration_dir:
1369.             try:
1370.                 call_command("migrate", "migrations", verbosity=0)
1371.                 # Delete the replaced migrations.
1372.                 os.remove(os.path.join(migration_dir, "0001_initial.py"))
1373.                 os.remove(os.path.join(migration_dir, "0002_second.py"))
1374.                 # --prune cannot be used before removing the "replaces"
1375.                 # attribute.
1376.                 call_command(
1377.                     "migrate",
1378.                     "migrations",
1379.                     prune=True,
1380.                     stdout=out,
1381.                     no_color=True,
1382.                 )
1383.                 self.assertEqual(
1384.                     out.getvalue(),
1385.                     "Pruning migrations:\n"
1386.                     "  Cannot use --prune because the following squashed "
1387.                     "migrations have their 'replaces' attributes and may not "
1388.                     "be recorded as applied:\n"
1389.                     "    migrations.0001_squashed_0002\n"
1390.                     "  Re-run 'manage.py migrate' if they are not marked as "
1391.                     "applied, and remove 'replaces' attributes in their "
1392.                     "Migration classes.\n",
1393.                 )
1394.             finally:
1395.                 # Unmigrate everything.
1396.                 call_command("migrate", "migrations", "zero", verbosity=0)
1397. 
1398.     @override_settings(
1399.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_squashed"}
1400.     )
1401.     def test_prune_no_migrations_to_prune(self):
1402.         out = io.StringIO()
1403.         call_command("migrate", "migrations", prune=True, stdout=out, no_color=True)
1404.         self.assertEqual(
1405.             out.getvalue(),
1406.             "Pruning migrations:\n  No migrations to prune.\n",
1407.         )
1408.         out = io.StringIO()
1409.         call_command(
1410.             "migrate",
1411.             "migrations",
1412.             prune=True,
1413.             stdout=out,
1414.             no_color=True,
1415.             verbosity=0,
1416.         )
1417.         self.assertEqual(out.getvalue(), "")
1418. 
1419.     def test_prune_no_app_label(self):
1420.         msg = "Migrations can be pruned only when an app is specified."
1421.         with self.assertRaisesMessage(CommandError, msg):
1422.             call_command("migrate", prune=True)
1423. 
1424. 
1425. class MakeMigrationsTests(MigrationTestBase):
1426.     """
1427.     Tests running the makemigrations command.
1428.     """
1429. 
1430.     def setUp(self):
1431.         super().setUp()
1432.         self._old_models = apps.app_configs["migrations"].models.copy()
1433. 
1434.     def tearDown(self):
1435.         apps.app_configs["migrations"].models = self._old_models
1436.         apps.all_models["migrations"] = self._old_models
1437.         apps.clear_cache()
1438.         super().tearDown()
1439. 
1440.     def test_files_content(self):
1441.         self.assertTableNotExists("migrations_unicodemodel")
1442.         apps.register_model("migrations", UnicodeModel)
1443.         with self.temporary_migration_module() as migration_dir:
1444.             call_command("makemigrations", "migrations", verbosity=0)
1445. 
1446.             # Check for empty __init__.py file in migrations folder
1447.             init_file = os.path.join(migration_dir, "__init__.py")
1448.             self.assertTrue(os.path.exists(init_file))
1449. 
1450.             with open(init_file) as fp:
1451.                 content = fp.read()
1452.             self.assertEqual(content, "")
1453. 
1454.             # Check for existing 0001_initial.py file in migration folder
1455.             initial_file = os.path.join(migration_dir, "0001_initial.py")
1456.             self.assertTrue(os.path.exists(initial_file))
1457. 
1458.             with open(initial_file, encoding="utf-8") as fp:
1459.                 content = fp.read()
1460.                 self.assertIn("migrations.CreateModel", content)
1461.                 self.assertIn("initial = True", content)
1462. 
1463.                 self.assertIn("úñí©óðé µóðéø", content)  # Meta.verbose_name
1464.                 self.assertIn("úñí©óðé µóðéøß", content)  # Meta.verbose_name_plural
1465.                 self.assertIn("ÚÑÍ¢ÓÐÉ", content)  # title.verbose_name
1466.                 self.assertIn("“Ðjáñgó”", content)  # title.default
1467. 
1468.     def test_makemigrations_order(self):
1469.         """
1470.         makemigrations should recognize number-only migrations (0001.py).
1471.         """
1472.         module = "migrations.test_migrations_order"
1473.         with self.temporary_migration_module(module=module) as migration_dir:
1474.             if hasattr(importlib, "invalidate_caches"):
1475.                 # importlib caches os.listdir() on some platforms like macOS
1476.                 # (#23850).
1477.                 importlib.invalidate_caches()
1478.             call_command(
1479.                 "makemigrations", "migrations", "--empty", "-n", "a", "-v", "0"
1480.             )
1481.             self.assertTrue(os.path.exists(os.path.join(migration_dir, "0002_a.py")))
1482. 
1483.     def test_makemigrations_empty_connections(self):
1484.         empty_connections = ConnectionHandler({"default": {}})
1485.         with mock.patch(
1486.             "django.core.management.commands.makemigrations.connections",
1487.             new=empty_connections,
1488.         ):
1489.             # with no apps
1490.             out = io.StringIO()
1491.             call_command("makemigrations", stdout=out)
1492.             self.assertIn("No changes detected", out.getvalue())
1493.             # with an app
1494.             with self.temporary_migration_module() as migration_dir:
1495.                 call_command("makemigrations", "migrations", verbosity=0)
1496.                 init_file = os.path.join(migration_dir, "__init__.py")
1497.                 self.assertTrue(os.path.exists(init_file))
1498. 
1499.     @override_settings(INSTALLED_APPS=["migrations", "migrations2"])
1500.     def test_makemigrations_consistency_checks_respect_routers(self):


File: tests/migrations/test_commands.py
Line number range: 1501 - 2000
Content:
1501.         """
1502.         The history consistency checks in makemigrations respect
1503.         settings.DATABASE_ROUTERS.
1504.         """
1505. 
1506.         def patched_has_table(migration_recorder):
1507.             if migration_recorder.connection is connections["other"]:
1508.                 raise Exception("Other connection")
1509.             else:
1510.                 return mock.DEFAULT
1511. 
1512.         self.assertTableNotExists("migrations_unicodemodel")
1513.         apps.register_model("migrations", UnicodeModel)
1514.         with mock.patch.object(
1515.             MigrationRecorder, "has_table", autospec=True, side_effect=patched_has_table
1516.         ) as has_table:
1517.             with self.temporary_migration_module() as migration_dir:
1518.                 call_command("makemigrations", "migrations", verbosity=0)
1519.                 initial_file = os.path.join(migration_dir, "0001_initial.py")
1520.                 self.assertTrue(os.path.exists(initial_file))
1521.                 self.assertEqual(has_table.call_count, 1)  # 'default' is checked
1522. 
1523.                 # Router says not to migrate 'other' so consistency shouldn't
1524.                 # be checked.
1525.                 with self.settings(DATABASE_ROUTERS=["migrations.routers.TestRouter"]):
1526.                     call_command("makemigrations", "migrations", verbosity=0)
1527.                 self.assertEqual(has_table.call_count, 2)  # 'default' again
1528. 
1529.                 # With a router that doesn't prohibit migrating 'other',
1530.                 # consistency is checked.
1531.                 with self.settings(
1532.                     DATABASE_ROUTERS=["migrations.routers.DefaultOtherRouter"]
1533.                 ):
1534.                     with self.assertRaisesMessage(Exception, "Other connection"):
1535.                         call_command("makemigrations", "migrations", verbosity=0)
1536.                 self.assertEqual(has_table.call_count, 4)  # 'default' and 'other'
1537. 
1538.                 # With a router that doesn't allow migrating on any database,
1539.                 # no consistency checks are made.
1540.                 with self.settings(DATABASE_ROUTERS=["migrations.routers.TestRouter"]):
1541.                     with mock.patch.object(
1542.                         TestRouter, "allow_migrate", return_value=False
1543.                     ) as allow_migrate:
1544.                         call_command("makemigrations", "migrations", verbosity=0)
1545.                 allow_migrate.assert_any_call(
1546.                     "other", "migrations", model_name="UnicodeModel"
1547.                 )
1548.                 # allow_migrate() is called with the correct arguments.
1549.                 self.assertGreater(len(allow_migrate.mock_calls), 0)
1550.                 called_aliases = set()
1551.                 for mock_call in allow_migrate.mock_calls:
1552.                     _, call_args, call_kwargs = mock_call
1553.                     connection_alias, app_name = call_args
1554.                     called_aliases.add(connection_alias)
1555.                     # Raises an error if invalid app_name/model_name occurs.
1556.                     apps.get_app_config(app_name).get_model(call_kwargs["model_name"])
1557.                 self.assertEqual(called_aliases, set(connections))
1558.                 self.assertEqual(has_table.call_count, 4)
1559. 
1560.     def test_failing_migration(self):
1561.         # If a migration fails to serialize, it shouldn't generate an empty file. #21280
1562.         apps.register_model("migrations", UnserializableModel)
1563. 
1564.         with self.temporary_migration_module() as migration_dir:
1565.             with self.assertRaisesMessage(ValueError, "Cannot serialize"):
1566.                 call_command("makemigrations", "migrations", verbosity=0)
1567. 
1568.             initial_file = os.path.join(migration_dir, "0001_initial.py")
1569.             self.assertFalse(os.path.exists(initial_file))
1570. 
1571.     def test_makemigrations_conflict_exit(self):
1572.         """
1573.         makemigrations exits if it detects a conflict.
1574.         """
1575.         with self.temporary_migration_module(
1576.             module="migrations.test_migrations_conflict"
1577.         ):
1578.             with self.assertRaises(CommandError) as context:
1579.                 call_command("makemigrations")
1580.         self.assertEqual(
1581.             str(context.exception),
1582.             "Conflicting migrations detected; multiple leaf nodes in the "
1583.             "migration graph: (0002_conflicting_second, 0002_second in "
1584.             "migrations).\n"
1585.             "To fix them run 'python manage.py makemigrations --merge'",
1586.         )
1587. 
1588.     def test_makemigrations_merge_no_conflict(self):
1589.         """
1590.         makemigrations exits if in merge mode with no conflicts.
1591.         """
1592.         out = io.StringIO()
1593.         with self.temporary_migration_module(module="migrations.test_migrations"):
1594.             call_command("makemigrations", merge=True, stdout=out)
1595.         self.assertIn("No conflicts detected to merge.", out.getvalue())
1596. 
1597.     def test_makemigrations_empty_no_app_specified(self):
1598.         """
1599.         makemigrations exits if no app is specified with 'empty' mode.
1600.         """
1601.         msg = "You must supply at least one app label when using --empty."
1602.         with self.assertRaisesMessage(CommandError, msg):
1603.             call_command("makemigrations", empty=True)
1604. 
1605.     def test_makemigrations_empty_migration(self):
1606.         """
1607.         makemigrations properly constructs an empty migration.
1608.         """
1609.         with self.temporary_migration_module() as migration_dir:
1610.             call_command("makemigrations", "migrations", empty=True, verbosity=0)
1611. 
1612.             # Check for existing 0001_initial.py file in migration folder
1613.             initial_file = os.path.join(migration_dir, "0001_initial.py")
1614.             self.assertTrue(os.path.exists(initial_file))
1615. 
1616.             with open(initial_file, encoding="utf-8") as fp:
1617.                 content = fp.read()
1618. 
1619.                 # Remove all whitespace to check for empty dependencies and operations
1620.                 content = content.replace(" ", "")
1621.                 self.assertIn(
1622.                     "dependencies=[]" if HAS_BLACK else "dependencies=[\n]", content
1623.                 )
1624.                 self.assertIn(
1625.                     "operations=[]" if HAS_BLACK else "operations=[\n]", content
1626.                 )
1627. 
1628.     @override_settings(MIGRATION_MODULES={"migrations": None})
1629.     def test_makemigrations_disabled_migrations_for_app(self):
1630.         """
1631.         makemigrations raises a nice error when migrations are disabled for an
1632.         app.
1633.         """
1634.         msg = (
1635.             "Django can't create migrations for app 'migrations' because migrations "
1636.             "have been disabled via the MIGRATION_MODULES setting."
1637.         )
1638.         with self.assertRaisesMessage(ValueError, msg):
1639.             call_command("makemigrations", "migrations", empty=True, verbosity=0)
1640. 
1641.     def test_makemigrations_no_changes_no_apps(self):
1642.         """
1643.         makemigrations exits when there are no changes and no apps are specified.
1644.         """
1645.         out = io.StringIO()
1646.         call_command("makemigrations", stdout=out)
1647.         self.assertIn("No changes detected", out.getvalue())
1648. 
1649.     def test_makemigrations_no_changes(self):
1650.         """
1651.         makemigrations exits when there are no changes to an app.
1652.         """
1653.         out = io.StringIO()
1654.         with self.temporary_migration_module(
1655.             module="migrations.test_migrations_no_changes"
1656.         ):
1657.             call_command("makemigrations", "migrations", stdout=out)
1658.         self.assertIn("No changes detected in app 'migrations'", out.getvalue())
1659. 
1660.     def test_makemigrations_no_apps_initial(self):
1661.         """
1662.         makemigrations should detect initial is needed on empty migration
1663.         modules if no app provided.
1664.         """
1665.         out = io.StringIO()
1666.         with self.temporary_migration_module(module="migrations.test_migrations_empty"):
1667.             call_command("makemigrations", stdout=out)
1668.         self.assertIn("0001_initial.py", out.getvalue())
1669. 
1670.     def test_makemigrations_no_init(self):
1671.         """Migration directories without an __init__.py file are allowed."""
1672.         out = io.StringIO()
1673.         with self.temporary_migration_module(
1674.             module="migrations.test_migrations_no_init"
1675.         ):
1676.             call_command("makemigrations", stdout=out)
1677.         self.assertIn("0001_initial.py", out.getvalue())
1678. 
1679.     def test_makemigrations_migrations_announce(self):
1680.         """
1681.         makemigrations announces the migration at the default verbosity level.
1682.         """
1683.         out = io.StringIO()
1684.         with self.temporary_migration_module():
1685.             call_command("makemigrations", "migrations", stdout=out)
1686.         self.assertIn("Migrations for 'migrations'", out.getvalue())
1687. 
1688.     def test_makemigrations_no_common_ancestor(self):
1689.         """
1690.         makemigrations fails to merge migrations with no common ancestor.
1691.         """
1692.         with self.assertRaises(ValueError) as context:
1693.             with self.temporary_migration_module(
1694.                 module="migrations.test_migrations_no_ancestor"
1695.             ):
1696.                 call_command("makemigrations", "migrations", merge=True)
1697.         exception_message = str(context.exception)
1698.         self.assertIn("Could not find common ancestor of", exception_message)
1699.         self.assertIn("0002_second", exception_message)
1700.         self.assertIn("0002_conflicting_second", exception_message)
1701. 
1702.     def test_makemigrations_interactive_reject(self):
1703.         """
1704.         makemigrations enters and exits interactive mode properly.
1705.         """
1706.         # Monkeypatch interactive questioner to auto reject
1707.         with mock.patch("builtins.input", mock.Mock(return_value="N")):
1708.             with self.temporary_migration_module(
1709.                 module="migrations.test_migrations_conflict"
1710.             ) as migration_dir:
1711.                 with captured_stdout():
1712.                     call_command(
1713.                         "makemigrations",
1714.                         "migrations",
1715.                         name="merge",
1716.                         merge=True,
1717.                         interactive=True,
1718.                         verbosity=0,
1719.                     )
1720.                 merge_file = os.path.join(migration_dir, "0003_merge.py")
1721.                 self.assertFalse(os.path.exists(merge_file))
1722. 
1723.     def test_makemigrations_interactive_accept(self):
1724.         """
1725.         makemigrations enters interactive mode and merges properly.
1726.         """
1727.         # Monkeypatch interactive questioner to auto accept
1728.         with mock.patch("builtins.input", mock.Mock(return_value="y")):
1729.             out = io.StringIO()
1730.             with self.temporary_migration_module(
1731.                 module="migrations.test_migrations_conflict"
1732.             ) as migration_dir:
1733.                 call_command(
1734.                     "makemigrations",
1735.                     "migrations",
1736.                     name="merge",
1737.                     merge=True,
1738.                     interactive=True,
1739.                     stdout=out,
1740.                 )
1741.                 merge_file = os.path.join(migration_dir, "0003_merge.py")
1742.                 self.assertTrue(os.path.exists(merge_file))
1743.             self.assertIn("Created new merge migration", out.getvalue())
1744. 
1745.     def test_makemigrations_default_merge_name(self):
1746.         out = io.StringIO()
1747.         with self.temporary_migration_module(
1748.             module="migrations.test_migrations_conflict"
1749.         ) as migration_dir:
1750.             call_command(
1751.                 "makemigrations",
1752.                 "migrations",
1753.                 merge=True,
1754.                 interactive=False,
1755.                 stdout=out,
1756.             )
1757.             merge_file = os.path.join(
1758.                 migration_dir,
1759.                 "0003_merge_0002_conflicting_second_0002_second.py",
1760.             )
1761.             self.assertIs(os.path.exists(merge_file), True)
1762.             with open(merge_file, encoding="utf-8") as fp:
1763.                 content = fp.read()
1764.             if HAS_BLACK:
1765.                 target_str = '("migrations", "0002_conflicting_second")'
1766.             else:
1767.                 target_str = "('migrations', '0002_conflicting_second')"
1768.             self.assertIn(target_str, content)
1769.         self.assertIn("Created new merge migration %s" % merge_file, out.getvalue())
1770. 
1771.     @mock.patch("django.db.migrations.utils.datetime")
1772.     def test_makemigrations_auto_merge_name(self, mock_datetime):
1773.         mock_datetime.datetime.now.return_value = datetime.datetime(2016, 1, 2, 3, 4)
1774.         with mock.patch("builtins.input", mock.Mock(return_value="y")):
1775.             out = io.StringIO()
1776.             with self.temporary_migration_module(
1777.                 module="migrations.test_migrations_conflict_long_name"
1778.             ) as migration_dir:
1779.                 call_command(
1780.                     "makemigrations",
1781.                     "migrations",
1782.                     merge=True,
1783.                     interactive=True,
1784.                     stdout=out,
1785.                 )
1786.                 merge_file = os.path.join(migration_dir, "0003_merge_20160102_0304.py")
1787.                 self.assertTrue(os.path.exists(merge_file))
1788.             self.assertIn("Created new merge migration", out.getvalue())
1789. 
1790.     def test_makemigrations_non_interactive_not_null_addition(self):
1791.         """
1792.         Non-interactive makemigrations fails when a default is missing on a
1793.         new not-null field.
1794.         """
1795. 
1796.         class SillyModel(models.Model):
1797.             silly_field = models.BooleanField(default=False)
1798.             silly_int = models.IntegerField()
1799. 
1800.             class Meta:
1801.                 app_label = "migrations"
1802. 
1803.         with self.assertRaises(SystemExit):
1804.             with self.temporary_migration_module(
1805.                 module="migrations.test_migrations_no_default"
1806.             ):
1807.                 with captured_stdout() as out:
1808.                     call_command("makemigrations", "migrations", interactive=False)
1809.         self.assertIn(
1810.             "Field 'silly_int' on model 'sillymodel' not migrated: it is "
1811.             "impossible to add a non-nullable field without specifying a "
1812.             "default.",
1813.             out.getvalue(),
1814.         )
1815. 
1816.     def test_makemigrations_interactive_not_null_addition(self):
1817.         """
1818.         makemigrations messages when adding a NOT NULL field in interactive
1819.         mode.
1820.         """
1821. 
1822.         class Author(models.Model):
1823.             silly_field = models.BooleanField(null=False)
1824. 
1825.             class Meta:
1826.                 app_label = "migrations"
1827. 
1828.         input_msg = (
1829.             "It is impossible to add a non-nullable field 'silly_field' to "
1830.             "author without specifying a default. This is because the "
1831.             "database needs something to populate existing rows.\n"
1832.             "Please select a fix:\n"
1833.             " 1) Provide a one-off default now (will be set on all existing "
1834.             "rows with a null value for this column)\n"
1835.             " 2) Quit and manually define a default value in models.py."
1836.         )
1837.         with self.temporary_migration_module(module="migrations.test_migrations"):
1838.             # 2 - quit.
1839.             with mock.patch("builtins.input", return_value="2"):
1840.                 with captured_stdout() as out, self.assertRaises(SystemExit):
1841.                     call_command("makemigrations", "migrations", interactive=True)
1842.             self.assertIn(input_msg, out.getvalue())
1843.             # 1 - provide a default.
1844.             with mock.patch("builtins.input", return_value="1"):
1845.                 with captured_stdout() as out:
1846.                     call_command("makemigrations", "migrations", interactive=True)
1847.             output = out.getvalue()
1848.             self.assertIn(input_msg, output)
1849.             self.assertIn("Please enter the default value as valid Python.", output)
1850.             self.assertIn(
1851.                 "The datetime and django.utils.timezone modules are "
1852.                 "available, so it is possible to provide e.g. timezone.now as "
1853.                 "a value",
1854.                 output,
1855.             )
1856.             self.assertIn("Type 'exit' to exit this prompt", output)
1857. 
1858.     def test_makemigrations_non_interactive_not_null_alteration(self):
1859.         """
1860.         Non-interactive makemigrations fails when a default is missing on a
1861.         field changed to not-null.
1862.         """
1863. 
1864.         class Author(models.Model):
1865.             name = models.CharField(max_length=255)
1866.             slug = models.SlugField()
1867.             age = models.IntegerField(default=0)
1868. 
1869.             class Meta:
1870.                 app_label = "migrations"
1871. 
1872.         with self.temporary_migration_module(module="migrations.test_migrations"):
1873.             with captured_stdout() as out:
1874.                 call_command("makemigrations", "migrations", interactive=False)
1875.         self.assertIn("Alter field slug on author", out.getvalue())
1876.         self.assertIn(
1877.             "Field 'slug' on model 'author' given a default of NOT PROVIDED "
1878.             "and must be corrected.",
1879.             out.getvalue(),
1880.         )
1881. 
1882.     def test_makemigrations_interactive_not_null_alteration(self):
1883.         """
1884.         makemigrations messages when changing a NULL field to NOT NULL in
1885.         interactive mode.
1886.         """
1887. 
1888.         class Author(models.Model):
1889.             slug = models.SlugField(null=False)
1890. 
1891.             class Meta:
1892.                 app_label = "migrations"
1893. 
1894.         input_msg = (
1895.             "It is impossible to change a nullable field 'slug' on author to "
1896.             "non-nullable without providing a default. This is because the "
1897.             "database needs something to populate existing rows.\n"
1898.             "Please select a fix:\n"
1899.             " 1) Provide a one-off default now (will be set on all existing "
1900.             "rows with a null value for this column)\n"
1901.             " 2) Ignore for now. Existing rows that contain NULL values will "
1902.             "have to be handled manually, for example with a RunPython or "
1903.             "RunSQL operation.\n"
1904.             " 3) Quit and manually define a default value in models.py."
1905.         )
1906.         with self.temporary_migration_module(module="migrations.test_migrations"):
1907.             # No message appears if --dry-run.
1908.             with captured_stdout() as out:
1909.                 call_command(
1910.                     "makemigrations",
1911.                     "migrations",
1912.                     interactive=True,
1913.                     dry_run=True,
1914.                 )
1915.             self.assertNotIn(input_msg, out.getvalue())
1916.             # 3 - quit.
1917.             with mock.patch("builtins.input", return_value="3"):
1918.                 with captured_stdout() as out, self.assertRaises(SystemExit):
1919.                     call_command("makemigrations", "migrations", interactive=True)
1920.             self.assertIn(input_msg, out.getvalue())
1921.             # 1 - provide a default.
1922.             with mock.patch("builtins.input", return_value="1"):
1923.                 with captured_stdout() as out:
1924.                     call_command("makemigrations", "migrations", interactive=True)
1925.             output = out.getvalue()
1926.             self.assertIn(input_msg, output)
1927.             self.assertIn("Please enter the default value as valid Python.", output)
1928.             self.assertIn(
1929.                 "The datetime and django.utils.timezone modules are "
1930.                 "available, so it is possible to provide e.g. timezone.now as "
1931.                 "a value",
1932.                 output,
1933.             )
1934.             self.assertIn("Type 'exit' to exit this prompt", output)
1935. 
1936.     def test_makemigrations_non_interactive_no_model_rename(self):
1937.         """
1938.         makemigrations adds and removes a possible model rename in
1939.         non-interactive mode.
1940.         """
1941. 
1942.         class RenamedModel(models.Model):
1943.             silly_field = models.BooleanField(default=False)
1944. 
1945.             class Meta:
1946.                 app_label = "migrations"
1947. 
1948.         out = io.StringIO()
1949.         with self.temporary_migration_module(
1950.             module="migrations.test_migrations_no_default"
1951.         ):
1952.             call_command("makemigrations", "migrations", interactive=False, stdout=out)
1953.         self.assertIn("Delete model SillyModel", out.getvalue())
1954.         self.assertIn("Create model RenamedModel", out.getvalue())
1955. 
1956.     def test_makemigrations_non_interactive_no_field_rename(self):
1957.         """
1958.         makemigrations adds and removes a possible field rename in
1959.         non-interactive mode.
1960.         """
1961. 
1962.         class SillyModel(models.Model):
1963.             silly_rename = models.BooleanField(default=False)
1964. 
1965.             class Meta:
1966.                 app_label = "migrations"
1967. 
1968.         out = io.StringIO()
1969.         with self.temporary_migration_module(
1970.             module="migrations.test_migrations_no_default"
1971.         ):
1972.             call_command("makemigrations", "migrations", interactive=False, stdout=out)
1973.         self.assertIn("Remove field silly_field from sillymodel", out.getvalue())
1974.         self.assertIn("Add field silly_rename to sillymodel", out.getvalue())
1975. 
1976.     @mock.patch("builtins.input", return_value="Y")
1977.     def test_makemigrations_model_rename_interactive(self, mock_input):
1978.         class RenamedModel(models.Model):
1979.             silly_field = models.BooleanField(default=False)
1980. 
1981.             class Meta:
1982.                 app_label = "migrations"
1983. 
1984.         with self.temporary_migration_module(
1985.             module="migrations.test_migrations_no_default",
1986.         ):
1987.             with captured_stdout() as out:
1988.                 call_command("makemigrations", "migrations", interactive=True)
1989.         self.assertIn("Rename model SillyModel to RenamedModel", out.getvalue())
1990. 
1991.     @mock.patch("builtins.input", return_value="Y")
1992.     def test_makemigrations_field_rename_interactive(self, mock_input):
1993.         class SillyModel(models.Model):
1994.             silly_rename = models.BooleanField(default=False)
1995. 
1996.             class Meta:
1997.                 app_label = "migrations"
1998. 
1999.         with self.temporary_migration_module(
2000.             module="migrations.test_migrations_no_default",


File: tests/migrations/test_commands.py
Line number range: 2001 - 2500
Content:
2001.         ):
2002.             with captured_stdout() as out:
2003.                 call_command("makemigrations", "migrations", interactive=True)
2004.         self.assertIn(
2005.             "Rename field silly_field on sillymodel to silly_rename",
2006.             out.getvalue(),
2007.         )
2008. 
2009.     def test_makemigrations_handle_merge(self):
2010.         """
2011.         makemigrations properly merges the conflicting migrations with --noinput.
2012.         """
2013.         out = io.StringIO()
2014.         with self.temporary_migration_module(
2015.             module="migrations.test_migrations_conflict"
2016.         ) as migration_dir:
2017.             call_command(
2018.                 "makemigrations",
2019.                 "migrations",
2020.                 name="merge",
2021.                 merge=True,
2022.                 interactive=False,
2023.                 stdout=out,
2024.             )
2025.             merge_file = os.path.join(migration_dir, "0003_merge.py")
2026.             self.assertTrue(os.path.exists(merge_file))
2027.         output = out.getvalue()
2028.         self.assertIn("Merging migrations", output)
2029.         self.assertIn("Branch 0002_second", output)
2030.         self.assertIn("Branch 0002_conflicting_second", output)
2031.         self.assertIn("Created new merge migration", output)
2032. 
2033.     def test_makemigration_merge_dry_run(self):
2034.         """
2035.         makemigrations respects --dry-run option when fixing migration
2036.         conflicts (#24427).
2037.         """
2038.         out = io.StringIO()
2039.         with self.temporary_migration_module(
2040.             module="migrations.test_migrations_conflict"
2041.         ) as migration_dir:
2042.             call_command(
2043.                 "makemigrations",
2044.                 "migrations",
2045.                 name="merge",
2046.                 dry_run=True,
2047.                 merge=True,
2048.                 interactive=False,
2049.                 stdout=out,
2050.             )
2051.             merge_file = os.path.join(migration_dir, "0003_merge.py")
2052.             self.assertFalse(os.path.exists(merge_file))
2053.         output = out.getvalue()
2054.         self.assertIn("Merging migrations", output)
2055.         self.assertIn("Branch 0002_second", output)
2056.         self.assertIn("Branch 0002_conflicting_second", output)
2057.         self.assertNotIn("Created new merge migration", output)
2058. 
2059.     def test_makemigration_merge_dry_run_verbosity_3(self):
2060.         """
2061.         `makemigrations --merge --dry-run` writes the merge migration file to
2062.         stdout with `verbosity == 3` (#24427).
2063.         """
2064.         out = io.StringIO()
2065.         with self.temporary_migration_module(
2066.             module="migrations.test_migrations_conflict"
2067.         ) as migration_dir:
2068.             call_command(
2069.                 "makemigrations",
2070.                 "migrations",
2071.                 name="merge",
2072.                 dry_run=True,
2073.                 merge=True,
2074.                 interactive=False,
2075.                 stdout=out,
2076.                 verbosity=3,
2077.             )
2078.             merge_file = os.path.join(migration_dir, "0003_merge.py")
2079.             self.assertFalse(os.path.exists(merge_file))
2080.         output = out.getvalue()
2081.         self.assertIn("Merging migrations", output)
2082.         self.assertIn("Branch 0002_second", output)
2083.         self.assertIn("Branch 0002_conflicting_second", output)
2084.         self.assertNotIn("Created new merge migration", output)
2085. 
2086.         # Additional output caused by verbosity 3
2087.         # The complete merge migration file that would be written
2088.         self.assertIn("class Migration(migrations.Migration):", output)
2089.         self.assertIn("dependencies = [", output)
2090.         self.assertIn("('migrations', '0002_second')", output)
2091.         self.assertIn("('migrations', '0002_conflicting_second')", output)
2092.         self.assertIn("operations = [", output)
2093.         self.assertIn("]", output)
2094. 
2095.     def test_makemigrations_dry_run(self):
2096.         """
2097.         `makemigrations --dry-run` should not ask for defaults.
2098.         """
2099. 
2100.         class SillyModel(models.Model):
2101.             silly_field = models.BooleanField(default=False)
2102.             silly_date = models.DateField()  # Added field without a default
2103.             silly_auto_now = models.DateTimeField(auto_now_add=True)
2104. 
2105.             class Meta:
2106.                 app_label = "migrations"
2107. 
2108.         out = io.StringIO()
2109.         with self.temporary_migration_module(
2110.             module="migrations.test_migrations_no_default"
2111.         ):
2112.             call_command("makemigrations", "migrations", dry_run=True, stdout=out)
2113.         # Output the expected changes directly, without asking for defaults
2114.         self.assertIn("Add field silly_date to sillymodel", out.getvalue())
2115. 
2116.     def test_makemigrations_dry_run_verbosity_3(self):
2117.         """
2118.         Allow `makemigrations --dry-run` to output the migrations file to
2119.         stdout (with verbosity == 3).
2120.         """
2121. 
2122.         class SillyModel(models.Model):
2123.             silly_field = models.BooleanField(default=False)
2124.             silly_char = models.CharField(default="")
2125. 
2126.             class Meta:
2127.                 app_label = "migrations"
2128. 
2129.         out = io.StringIO()
2130.         with self.temporary_migration_module(
2131.             module="migrations.test_migrations_no_default"
2132.         ):
2133.             call_command(
2134.                 "makemigrations", "migrations", dry_run=True, stdout=out, verbosity=3
2135.             )
2136. 
2137.         # Normal --dry-run output
2138.         self.assertIn("- Add field silly_char to sillymodel", out.getvalue())
2139. 
2140.         # Additional output caused by verbosity 3
2141.         # The complete migrations file that would be written
2142.         self.assertIn("class Migration(migrations.Migration):", out.getvalue())
2143.         self.assertIn("dependencies = [", out.getvalue())
2144.         self.assertIn("('migrations', '0001_initial'),", out.getvalue())
2145.         self.assertIn("migrations.AddField(", out.getvalue())
2146.         self.assertIn("model_name='sillymodel',", out.getvalue())
2147.         self.assertIn("name='silly_char',", out.getvalue())
2148. 
2149.     def test_makemigrations_scriptable(self):
2150.         """
2151.         With scriptable=True, log output is diverted to stderr, and only the
2152.         paths of generated migration files are written to stdout.
2153.         """
2154.         out = io.StringIO()
2155.         err = io.StringIO()
2156.         with self.temporary_migration_module(
2157.             module="migrations.migrations.test_migrations",
2158.         ) as migration_dir:
2159.             call_command(
2160.                 "makemigrations",
2161.                 "migrations",
2162.                 scriptable=True,
2163.                 stdout=out,
2164.                 stderr=err,
2165.             )
2166.         initial_file = os.path.join(migration_dir, "0001_initial.py")
2167.         self.assertEqual(out.getvalue(), f"{initial_file}\n")
2168.         self.assertIn("    - Create model ModelWithCustomBase\n", err.getvalue())
2169. 
2170.     @mock.patch("builtins.input", return_value="Y")
2171.     def test_makemigrations_scriptable_merge(self, mock_input):
2172.         out = io.StringIO()
2173.         err = io.StringIO()
2174.         with self.temporary_migration_module(
2175.             module="migrations.test_migrations_conflict",
2176.         ) as migration_dir:
2177.             call_command(
2178.                 "makemigrations",
2179.                 "migrations",
2180.                 merge=True,
2181.                 name="merge",
2182.                 scriptable=True,
2183.                 stdout=out,
2184.                 stderr=err,
2185.             )
2186.         merge_file = os.path.join(migration_dir, "0003_merge.py")
2187.         self.assertEqual(out.getvalue(), f"{merge_file}\n")
2188.         self.assertIn(f"Created new merge migration {merge_file}", err.getvalue())
2189. 
2190.     def test_makemigrations_migrations_modules_path_not_exist(self):
2191.         """
2192.         makemigrations creates migrations when specifying a custom location
2193.         for migration files using MIGRATION_MODULES if the custom path
2194.         doesn't already exist.
2195.         """
2196. 
2197.         class SillyModel(models.Model):
2198.             silly_field = models.BooleanField(default=False)
2199. 
2200.             class Meta:
2201.                 app_label = "migrations"
2202. 
2203.         out = io.StringIO()
2204.         migration_module = "migrations.test_migrations_path_doesnt_exist.foo.bar"
2205.         with self.temporary_migration_module(module=migration_module) as migration_dir:
2206.             call_command("makemigrations", "migrations", stdout=out)
2207. 
2208.             # Migrations file is actually created in the expected path.
2209.             initial_file = os.path.join(migration_dir, "0001_initial.py")
2210.             self.assertTrue(os.path.exists(initial_file))
2211. 
2212.         # Command output indicates the migration is created.
2213.         self.assertIn(" - Create model SillyModel", out.getvalue())
2214. 
2215.     @override_settings(MIGRATION_MODULES={"migrations": "some.nonexistent.path"})
2216.     def test_makemigrations_migrations_modules_nonexistent_toplevel_package(self):
2217.         msg = (
2218.             "Could not locate an appropriate location to create migrations "
2219.             "package some.nonexistent.path. Make sure the toplevel package "
2220.             "exists and can be imported."
2221.         )
2222.         with self.assertRaisesMessage(ValueError, msg):
2223.             call_command("makemigrations", "migrations", empty=True, verbosity=0)
2224. 
2225.     def test_makemigrations_interactive_by_default(self):
2226.         """
2227.         The user is prompted to merge by default if there are conflicts and
2228.         merge is True. Answer negative to differentiate it from behavior when
2229.         --noinput is specified.
2230.         """
2231.         # Monkeypatch interactive questioner to auto reject
2232.         out = io.StringIO()
2233.         with mock.patch("builtins.input", mock.Mock(return_value="N")):
2234.             with self.temporary_migration_module(
2235.                 module="migrations.test_migrations_conflict"
2236.             ) as migration_dir:
2237.                 call_command(
2238.                     "makemigrations", "migrations", name="merge", merge=True, stdout=out
2239.                 )
2240.                 merge_file = os.path.join(migration_dir, "0003_merge.py")
2241.                 # This will fail if interactive is False by default
2242.                 self.assertFalse(os.path.exists(merge_file))
2243.             self.assertNotIn("Created new merge migration", out.getvalue())
2244. 
2245.     @override_settings(
2246.         INSTALLED_APPS=[
2247.             "migrations",
2248.             "migrations.migrations_test_apps.unspecified_app_with_conflict",
2249.         ]
2250.     )
2251.     def test_makemigrations_unspecified_app_with_conflict_no_merge(self):
2252.         """
2253.         makemigrations does not raise a CommandError when an unspecified app
2254.         has conflicting migrations.
2255.         """
2256.         with self.temporary_migration_module(
2257.             module="migrations.test_migrations_no_changes"
2258.         ):
2259.             call_command("makemigrations", "migrations", merge=False, verbosity=0)
2260. 
2261.     @override_settings(
2262.         INSTALLED_APPS=[
2263.             "migrations.migrations_test_apps.migrated_app",
2264.             "migrations.migrations_test_apps.unspecified_app_with_conflict",
2265.         ]
2266.     )
2267.     def test_makemigrations_unspecified_app_with_conflict_merge(self):
2268.         """
2269.         makemigrations does not create a merge for an unspecified app even if
2270.         it has conflicting migrations.
2271.         """
2272.         # Monkeypatch interactive questioner to auto accept
2273.         with mock.patch("builtins.input", mock.Mock(return_value="y")):
2274.             out = io.StringIO()
2275.             with self.temporary_migration_module(
2276.                 app_label="migrated_app"
2277.             ) as migration_dir:
2278.                 call_command(
2279.                     "makemigrations",
2280.                     "migrated_app",
2281.                     name="merge",
2282.                     merge=True,
2283.                     interactive=True,
2284.                     stdout=out,
2285.                 )
2286.                 merge_file = os.path.join(migration_dir, "0003_merge.py")
2287.                 self.assertFalse(os.path.exists(merge_file))
2288.             self.assertIn("No conflicts detected to merge.", out.getvalue())
2289. 
2290.     @override_settings(
2291.         INSTALLED_APPS=[
2292.             "migrations.migrations_test_apps.migrated_app",
2293.             "migrations.migrations_test_apps.conflicting_app_with_dependencies",
2294.         ]
2295.     )
2296.     def test_makemigrations_merge_dont_output_dependency_operations(self):
2297.         """
2298.         makemigrations --merge does not output any operations from apps that
2299.         don't belong to a given app.
2300.         """
2301.         # Monkeypatch interactive questioner to auto accept
2302.         with mock.patch("builtins.input", mock.Mock(return_value="N")):
2303.             out = io.StringIO()
2304.             with mock.patch(
2305.                 "django.core.management.color.supports_color", lambda *args: False
2306.             ):
2307.                 call_command(
2308.                     "makemigrations",
2309.                     "conflicting_app_with_dependencies",
2310.                     merge=True,
2311.                     interactive=True,
2312.                     stdout=out,
2313.                 )
2314.             self.assertEqual(
2315.                 out.getvalue().lower(),
2316.                 "merging conflicting_app_with_dependencies\n"
2317.                 "  branch 0002_conflicting_second\n"
2318.                 "    - create model something\n"
2319.                 "  branch 0002_second\n"
2320.                 "    - delete model tribble\n"
2321.                 "    - remove field silly_field from author\n"
2322.                 "    - add field rating to author\n"
2323.                 "    - create model book\n"
2324.                 "\n"
2325.                 "merging will only work if the operations printed above do not "
2326.                 "conflict\n"
2327.                 "with each other (working on different fields or models)\n"
2328.                 "should these migration branches be merged? [y/n] ",
2329.             )
2330. 
2331.     def test_makemigrations_with_custom_name(self):
2332.         """
2333.         makemigrations --name generate a custom migration name.
2334.         """
2335.         with self.temporary_migration_module() as migration_dir:
2336. 
2337.             def cmd(migration_count, migration_name, *args):
2338.                 call_command(
2339.                     "makemigrations",
2340.                     "migrations",
2341.                     "--verbosity",
2342.                     "0",
2343.                     "--name",
2344.                     migration_name,
2345.                     *args,
2346.                 )
2347.                 migration_file = os.path.join(
2348.                     migration_dir, "%s_%s.py" % (migration_count, migration_name)
2349.                 )
2350.                 # Check for existing migration file in migration folder
2351.                 self.assertTrue(os.path.exists(migration_file))
2352.                 with open(migration_file, encoding="utf-8") as fp:
2353.                     content = fp.read()
2354.                     content = content.replace(" ", "")
2355.                 return content
2356. 
2357.             # generate an initial migration
2358.             migration_name_0001 = "my_initial_migration"
2359.             content = cmd("0001", migration_name_0001)
2360.             self.assertIn(
2361.                 "dependencies=[]" if HAS_BLACK else "dependencies=[\n]", content
2362.             )
2363. 
2364.             # importlib caches os.listdir() on some platforms like macOS
2365.             # (#23850).
2366.             if hasattr(importlib, "invalidate_caches"):
2367.                 importlib.invalidate_caches()
2368. 
2369.             # generate an empty migration
2370.             migration_name_0002 = "my_custom_migration"
2371.             content = cmd("0002", migration_name_0002, "--empty")
2372.             if HAS_BLACK:
2373.                 template_str = 'dependencies=[\n("migrations","0001_%s"),\n]'
2374.             else:
2375.                 template_str = "dependencies=[\n('migrations','0001_%s'),\n]"
2376.             self.assertIn(
2377.                 template_str % migration_name_0001,
2378.                 content,
2379.             )
2380.             self.assertIn("operations=[]" if HAS_BLACK else "operations=[\n]", content)
2381. 
2382.     def test_makemigrations_with_invalid_custom_name(self):
2383.         msg = "The migration name must be a valid Python identifier."
2384.         with self.assertRaisesMessage(CommandError, msg):
2385.             call_command(
2386.                 "makemigrations", "migrations", "--name", "invalid name", "--empty"
2387.             )
2388. 
2389.     def test_makemigrations_check(self):
2390.         """
2391.         makemigrations --check should exit with a non-zero status when
2392.         there are changes to an app requiring migrations.
2393.         """
2394.         with self.temporary_migration_module() as tmpdir:
2395.             with self.assertRaises(SystemExit):
2396.                 call_command("makemigrations", "--check", "migrations", verbosity=0)
2397.             self.assertFalse(os.path.exists(tmpdir))
2398. 
2399.         with self.temporary_migration_module(
2400.             module="migrations.test_migrations_no_changes"
2401.         ):
2402.             call_command("makemigrations", "--check", "migrations", verbosity=0)
2403. 
2404.     def test_makemigrations_migration_path_output(self):
2405.         """
2406.         makemigrations should print the relative paths to the migrations unless
2407.         they are outside of the current tree, in which case the absolute path
2408.         should be shown.
2409.         """
2410.         out = io.StringIO()
2411.         apps.register_model("migrations", UnicodeModel)
2412.         with self.temporary_migration_module() as migration_dir:
2413.             call_command("makemigrations", "migrations", stdout=out)
2414.             self.assertIn(
2415.                 os.path.join(migration_dir, "0001_initial.py"), out.getvalue()
2416.             )
2417. 
2418.     def test_makemigrations_migration_path_output_valueerror(self):
2419.         """
2420.         makemigrations prints the absolute path if os.path.relpath() raises a
2421.         ValueError when it's impossible to obtain a relative path, e.g. on
2422.         Windows if Django is installed on a different drive than where the
2423.         migration files are created.
2424.         """
2425.         out = io.StringIO()
2426.         with self.temporary_migration_module() as migration_dir:
2427.             with mock.patch("os.path.relpath", side_effect=ValueError):
2428.                 call_command("makemigrations", "migrations", stdout=out)
2429.         self.assertIn(os.path.join(migration_dir, "0001_initial.py"), out.getvalue())
2430. 
2431.     def test_makemigrations_inconsistent_history(self):
2432.         """
2433.         makemigrations should raise InconsistentMigrationHistory exception if
2434.         there are some migrations applied before their dependencies.
2435.         """
2436.         recorder = MigrationRecorder(connection)
2437.         recorder.record_applied("migrations", "0002_second")
2438.         msg = (
2439.             "Migration migrations.0002_second is applied before its dependency "
2440.             "migrations.0001_initial"
2441.         )
2442.         with self.temporary_migration_module(module="migrations.test_migrations"):
2443.             with self.assertRaisesMessage(InconsistentMigrationHistory, msg):
2444.                 call_command("makemigrations")
2445. 
2446.     def test_makemigrations_inconsistent_history_db_failure(self):
2447.         msg = (
2448.             "Got an error checking a consistent migration history performed "
2449.             "for database connection 'default': could not connect to server"
2450.         )
2451.         with mock.patch(
2452.             "django.db.migrations.loader.MigrationLoader.check_consistent_history",
2453.             side_effect=OperationalError("could not connect to server"),
2454.         ):
2455.             with self.temporary_migration_module():
2456.                 with self.assertWarns(RuntimeWarning) as cm:
2457.                     call_command("makemigrations", verbosity=0)
2458.                 self.assertEqual(str(cm.warning), msg)
2459. 
2460.     @mock.patch("builtins.input", return_value="1")
2461.     @mock.patch(
2462.         "django.db.migrations.questioner.sys.stdin",
2463.         mock.MagicMock(encoding=sys.getdefaultencoding()),
2464.     )
2465.     def test_makemigrations_auto_now_add_interactive(self, *args):
2466.         """
2467.         makemigrations prompts the user when adding auto_now_add to an existing
2468.         model.
2469.         """
2470. 
2471.         class Entry(models.Model):
2472.             title = models.CharField(max_length=255)
2473.             creation_date = models.DateTimeField(auto_now_add=True)
2474. 
2475.             class Meta:
2476.                 app_label = "migrations"
2477. 
2478.         input_msg = (
2479.             "It is impossible to add the field 'creation_date' with "
2480.             "'auto_now_add=True' to entry without providing a default. This "
2481.             "is because the database needs something to populate existing "
2482.             "rows.\n"
2483.             " 1) Provide a one-off default now which will be set on all "
2484.             "existing rows\n"
2485.             " 2) Quit and manually define a default value in models.py."
2486.         )
2487.         # Monkeypatch interactive questioner to auto accept
2488.         prompt_stdout = io.StringIO()
2489.         with self.temporary_migration_module(module="migrations.test_auto_now_add"):
2490.             call_command(
2491.                 "makemigrations", "migrations", interactive=True, stdout=prompt_stdout
2492.             )
2493.         prompt_output = prompt_stdout.getvalue()
2494.         self.assertIn(input_msg, prompt_output)
2495.         self.assertIn("Please enter the default value as valid Python.", prompt_output)
2496.         self.assertIn(
2497.             "Accept the default 'timezone.now' by pressing 'Enter' or provide "
2498.             "another value.",
2499.             prompt_output,
2500.         )


File: tests/migrations/test_commands.py
Line number range: 2501 - 3000
Content:
2501.         self.assertIn("Type 'exit' to exit this prompt", prompt_output)
2502.         self.assertIn("Add field creation_date to entry", prompt_output)
2503. 
2504.     @mock.patch("builtins.input", return_value="2")
2505.     def test_makemigrations_auto_now_add_interactive_quit(self, mock_input):
2506.         class Author(models.Model):
2507.             publishing_date = models.DateField(auto_now_add=True)
2508. 
2509.             class Meta:
2510.                 app_label = "migrations"
2511. 
2512.         with self.temporary_migration_module(module="migrations.test_migrations"):
2513.             with captured_stdout():
2514.                 with self.assertRaises(SystemExit):
2515.                     call_command("makemigrations", "migrations", interactive=True)
2516. 
2517.     def test_makemigrations_non_interactive_auto_now_add_addition(self):
2518.         """
2519.         Non-interactive makemigrations fails when a default is missing on a
2520.         new field when auto_now_add=True.
2521.         """
2522. 
2523.         class Entry(models.Model):
2524.             creation_date = models.DateTimeField(auto_now_add=True)
2525. 
2526.             class Meta:
2527.                 app_label = "migrations"
2528. 
2529.         with self.temporary_migration_module(module="migrations.test_auto_now_add"):
2530.             with self.assertRaises(SystemExit), captured_stdout() as out:
2531.                 call_command("makemigrations", "migrations", interactive=False)
2532.         self.assertIn(
2533.             "Field 'creation_date' on model 'entry' not migrated: it is "
2534.             "impossible to add a field with 'auto_now_add=True' without "
2535.             "specifying a default.",
2536.             out.getvalue(),
2537.         )
2538. 
2539.     def test_makemigrations_interactive_unique_callable_default_addition(self):
2540.         """
2541.         makemigrations prompts the user when adding a unique field with
2542.         a callable default.
2543.         """
2544. 
2545.         class Book(models.Model):
2546.             created = models.DateTimeField(unique=True, default=timezone.now)
2547. 
2548.             class Meta:
2549.                 app_label = "migrations"
2550. 
2551.         version = get_docs_version()
2552.         input_msg = (
2553.             f"Callable default on unique field book.created will not generate "
2554.             f"unique values upon migrating.\n"
2555.             f"Please choose how to proceed:\n"
2556.             f" 1) Continue making this migration as the first step in writing "
2557.             f"a manual migration to generate unique values described here: "
2558.             f"https://docs.djangoproject.com/en/{version}/howto/"
2559.             f"writing-migrations/#migrations-that-add-unique-fields.\n"
2560.             f" 2) Quit and edit field options in models.py.\n"
2561.         )
2562.         with self.temporary_migration_module(module="migrations.test_migrations"):
2563.             # 2 - quit.
2564.             with mock.patch("builtins.input", return_value="2"):
2565.                 with captured_stdout() as out, self.assertRaises(SystemExit):
2566.                     call_command("makemigrations", "migrations", interactive=True)
2567.             out_value = out.getvalue()
2568.             self.assertIn(input_msg, out_value)
2569.             self.assertNotIn("Add field created to book", out_value)
2570.             # 1 - continue.
2571.             with mock.patch("builtins.input", return_value="1"):
2572.                 with captured_stdout() as out:
2573.                     call_command("makemigrations", "migrations", interactive=True)
2574.             out_value = out.getvalue()
2575.             self.assertIn(input_msg, out_value)
2576.             self.assertIn("Add field created to book", out_value)
2577. 
2578.     def test_makemigrations_non_interactive_unique_callable_default_addition(self):
2579.         class Book(models.Model):
2580.             created = models.DateTimeField(unique=True, default=timezone.now)
2581. 
2582.             class Meta:
2583.                 app_label = "migrations"
2584. 
2585.         with self.temporary_migration_module(module="migrations.test_migrations"):
2586.             with captured_stdout() as out:
2587.                 call_command("makemigrations", "migrations", interactive=False)
2588.             out_value = out.getvalue()
2589.             self.assertIn("Add field created to book", out_value)
2590. 
2591.     @override_settings(
2592.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_squashed"},
2593.     )
2594.     def test_makemigrations_continues_number_sequence_after_squash(self):
2595.         with self.temporary_migration_module(
2596.             module="migrations.test_migrations_squashed"
2597.         ):
2598.             with captured_stdout() as out:
2599.                 call_command(
2600.                     "makemigrations",
2601.                     "migrations",
2602.                     interactive=False,
2603.                     empty=True,
2604.                 )
2605.             out_value = out.getvalue()
2606.             self.assertIn("0003_auto", out_value)
2607. 
2608.     def test_makemigrations_update(self):
2609.         with self.temporary_migration_module(
2610.             module="migrations.test_migrations"
2611.         ) as migration_dir:
2612.             migration_file = os.path.join(migration_dir, "0002_second.py")
2613.             with open(migration_file) as fp:
2614.                 initial_content = fp.read()
2615. 
2616.             with captured_stdout() as out:
2617.                 call_command("makemigrations", "migrations", update=True)
2618.             self.assertFalse(
2619.                 any(
2620.                     filename.startswith("0003")
2621.                     for filename in os.listdir(migration_dir)
2622.                 )
2623.             )
2624.             self.assertIs(os.path.exists(migration_file), False)
2625.             new_migration_file = os.path.join(
2626.                 migration_dir,
2627.                 "0002_delete_tribble_author_rating_modelwithcustombase_and_more.py",
2628.             )
2629.             with open(new_migration_file) as fp:
2630.                 self.assertNotEqual(initial_content, fp.read())
2631.             self.assertIn(f"Deleted {migration_file}", out.getvalue())
2632. 
2633.     def test_makemigrations_update_existing_name(self):
2634.         with self.temporary_migration_module(
2635.             module="migrations.test_auto_now_add"
2636.         ) as migration_dir:
2637.             migration_file = os.path.join(migration_dir, "0001_initial.py")
2638.             with open(migration_file) as fp:
2639.                 initial_content = fp.read()
2640. 
2641.             with captured_stdout() as out:
2642.                 call_command("makemigrations", "migrations", update=True)
2643.             self.assertIs(os.path.exists(migration_file), False)
2644.             new_migration_file = os.path.join(
2645.                 migration_dir,
2646.                 "0001_initial_updated.py",
2647.             )
2648.             with open(new_migration_file) as fp:
2649.                 self.assertNotEqual(initial_content, fp.read())
2650.             self.assertIn(f"Deleted {migration_file}", out.getvalue())
2651. 
2652.     def test_makemigrations_update_applied_migration(self):
2653.         recorder = MigrationRecorder(connection)
2654.         recorder.record_applied("migrations", "0001_initial")
2655.         recorder.record_applied("migrations", "0002_second")
2656.         with self.temporary_migration_module(module="migrations.test_migrations"):
2657.             msg = "Cannot update applied migration 'migrations.0002_second'."
2658.             with self.assertRaisesMessage(CommandError, msg):
2659.                 call_command("makemigrations", "migrations", update=True)
2660. 
2661.     def test_makemigrations_update_no_migration(self):
2662.         with self.temporary_migration_module(module="migrations.test_migrations_empty"):
2663.             msg = "App migrations has no migration, cannot update last migration."
2664.             with self.assertRaisesMessage(CommandError, msg):
2665.                 call_command("makemigrations", "migrations", update=True)
2666. 
2667.     def test_makemigrations_update_squash_migration(self):
2668.         with self.temporary_migration_module(
2669.             module="migrations.test_migrations_squashed"
2670.         ):
2671.             msg = "Cannot update squash migration 'migrations.0001_squashed_0002'."
2672.             with self.assertRaisesMessage(CommandError, msg):
2673.                 call_command("makemigrations", "migrations", update=True)
2674. 
2675.     def test_makemigrations_update_manual_porting(self):
2676.         with self.temporary_migration_module(
2677.             module="migrations.test_migrations_plan"
2678.         ) as migration_dir:
2679.             with captured_stdout() as out:
2680.                 call_command("makemigrations", "migrations", update=True)
2681.             # Previous migration exists.
2682.             previous_migration_file = os.path.join(migration_dir, "0005_fifth.py")
2683.             self.assertIs(os.path.exists(previous_migration_file), True)
2684.             # New updated migration exists.
2685.             files = [f for f in os.listdir(migration_dir) if f.startswith("0005_auto")]
2686.             updated_migration_file = os.path.join(migration_dir, files[0])
2687.             self.assertIs(os.path.exists(updated_migration_file), True)
2688.             self.assertIn(
2689.                 f"Updated migration {updated_migration_file} requires manual porting.\n"
2690.                 f"Previous migration {previous_migration_file} was kept and must be "
2691.                 f"deleted after porting functions manually.",
2692.                 out.getvalue(),
2693.             )
2694. 
2695.     @override_settings(
2696.         INSTALLED_APPS=[
2697.             "migrations.migrations_test_apps.alter_fk.author_app",
2698.             "migrations.migrations_test_apps.alter_fk.book_app",
2699.         ]
2700.     )
2701.     def test_makemigrations_update_dependency_migration(self):
2702.         with self.temporary_migration_module(app_label="book_app"):
2703.             msg = (
2704.                 "Cannot update migration 'book_app.0001_initial' that migrations "
2705.                 "'author_app.0002_alter_id' depend on."
2706.             )
2707.             with self.assertRaisesMessage(CommandError, msg):
2708.                 call_command("makemigrations", "book_app", update=True)
2709. 
2710. 
2711. class SquashMigrationsTests(MigrationTestBase):
2712.     """
2713.     Tests running the squashmigrations command.
2714.     """
2715. 
2716.     def test_squashmigrations_squashes(self):
2717.         """
2718.         squashmigrations squashes migrations.
2719.         """
2720.         out = io.StringIO()
2721.         with self.temporary_migration_module(
2722.             module="migrations.test_migrations"
2723.         ) as migration_dir:
2724.             call_command(
2725.                 "squashmigrations",
2726.                 "migrations",
2727.                 "0002",
2728.                 interactive=False,
2729.                 stdout=out,
2730.                 no_color=True,
2731.             )
2732. 
2733.             squashed_migration_file = os.path.join(
2734.                 migration_dir, "0001_squashed_0002_second.py"
2735.             )
2736.             self.assertTrue(os.path.exists(squashed_migration_file))
2737.         self.assertEqual(
2738.             out.getvalue(),
2739.             "Will squash the following migrations:\n"
2740.             " - 0001_initial\n"
2741.             " - 0002_second\n"
2742.             "Optimizing...\n"
2743.             "  Optimized from 8 operations to 2 operations.\n"
2744.             "Created new squashed migration %s\n"
2745.             "  You should commit this migration but leave the old ones in place;\n"
2746.             "  the new migration will be used for new installs. Once you are sure\n"
2747.             "  all instances of the codebase have applied the migrations you "
2748.             "squashed,\n"
2749.             "  you can delete them.\n" % squashed_migration_file,
2750.         )
2751. 
2752.     def test_squashmigrations_initial_attribute(self):
2753.         with self.temporary_migration_module(
2754.             module="migrations.test_migrations"
2755.         ) as migration_dir:
2756.             call_command(
2757.                 "squashmigrations", "migrations", "0002", interactive=False, verbosity=0
2758.             )
2759. 
2760.             squashed_migration_file = os.path.join(
2761.                 migration_dir, "0001_squashed_0002_second.py"
2762.             )
2763.             with open(squashed_migration_file, encoding="utf-8") as fp:
2764.                 content = fp.read()
2765.                 self.assertIn("initial = True", content)
2766. 
2767.     def test_squashmigrations_optimizes(self):
2768.         """
2769.         squashmigrations optimizes operations.
2770.         """
2771.         out = io.StringIO()
2772.         with self.temporary_migration_module(module="migrations.test_migrations"):
2773.             call_command(
2774.                 "squashmigrations",
2775.                 "migrations",
2776.                 "0002",
2777.                 interactive=False,
2778.                 verbosity=1,
2779.                 stdout=out,
2780.             )
2781.         self.assertIn("Optimized from 8 operations to 2 operations.", out.getvalue())
2782. 
2783.     def test_ticket_23799_squashmigrations_no_optimize(self):
2784.         """
2785.         squashmigrations --no-optimize doesn't optimize operations.
2786.         """
2787.         out = io.StringIO()
2788.         with self.temporary_migration_module(module="migrations.test_migrations"):
2789.             call_command(
2790.                 "squashmigrations",
2791.                 "migrations",
2792.                 "0002",
2793.                 interactive=False,
2794.                 verbosity=1,
2795.                 no_optimize=True,
2796.                 stdout=out,
2797.             )
2798.         self.assertIn("Skipping optimization", out.getvalue())
2799. 
2800.     def test_squashmigrations_valid_start(self):
2801.         """
2802.         squashmigrations accepts a starting migration.
2803.         """
2804.         out = io.StringIO()
2805.         with self.temporary_migration_module(
2806.             module="migrations.test_migrations_no_changes"
2807.         ) as migration_dir:
2808.             call_command(
2809.                 "squashmigrations",
2810.                 "migrations",
2811.                 "0002",
2812.                 "0003",
2813.                 interactive=False,
2814.                 verbosity=1,
2815.                 stdout=out,
2816.             )
2817. 
2818.             squashed_migration_file = os.path.join(
2819.                 migration_dir, "0002_second_squashed_0003_third.py"
2820.             )
2821.             with open(squashed_migration_file, encoding="utf-8") as fp:
2822.                 content = fp.read()
2823.                 if HAS_BLACK:
2824.                     test_str = '        ("migrations", "0001_initial")'
2825.                 else:
2826.                     test_str = "        ('migrations', '0001_initial')"
2827.                 self.assertIn(test_str, content)
2828.                 self.assertNotIn("initial = True", content)
2829.         out = out.getvalue()
2830.         self.assertNotIn(" - 0001_initial", out)
2831.         self.assertIn(" - 0002_second", out)
2832.         self.assertIn(" - 0003_third", out)
2833. 
2834.     def test_squashmigrations_invalid_start(self):
2835.         """
2836.         squashmigrations doesn't accept a starting migration after the ending migration.
2837.         """
2838.         with self.temporary_migration_module(
2839.             module="migrations.test_migrations_no_changes"
2840.         ):
2841.             msg = (
2842.                 "The migration 'migrations.0003_third' cannot be found. Maybe "
2843.                 "it comes after the migration 'migrations.0002_second'"
2844.             )
2845.             with self.assertRaisesMessage(CommandError, msg):
2846.                 call_command(
2847.                     "squashmigrations",
2848.                     "migrations",
2849.                     "0003",
2850.                     "0002",
2851.                     interactive=False,
2852.                     verbosity=0,
2853.                 )
2854. 
2855.     def test_squashed_name_with_start_migration_name(self):
2856.         """--squashed-name specifies the new migration's name."""
2857.         squashed_name = "squashed_name"
2858.         with self.temporary_migration_module(
2859.             module="migrations.test_migrations"
2860.         ) as migration_dir:
2861.             call_command(
2862.                 "squashmigrations",
2863.                 "migrations",
2864.                 "0001",
2865.                 "0002",
2866.                 squashed_name=squashed_name,
2867.                 interactive=False,
2868.                 verbosity=0,
2869.             )
2870.             squashed_migration_file = os.path.join(
2871.                 migration_dir, "0001_%s.py" % squashed_name
2872.             )
2873.             self.assertTrue(os.path.exists(squashed_migration_file))
2874. 
2875.     def test_squashed_name_without_start_migration_name(self):
2876.         """--squashed-name also works if a start migration is omitted."""
2877.         squashed_name = "squashed_name"
2878.         with self.temporary_migration_module(
2879.             module="migrations.test_migrations"
2880.         ) as migration_dir:
2881.             call_command(
2882.                 "squashmigrations",
2883.                 "migrations",
2884.                 "0001",
2885.                 squashed_name=squashed_name,
2886.                 interactive=False,
2887.                 verbosity=0,
2888.             )
2889.             squashed_migration_file = os.path.join(
2890.                 migration_dir, "0001_%s.py" % squashed_name
2891.             )
2892.             self.assertTrue(os.path.exists(squashed_migration_file))
2893. 
2894.     def test_squashed_name_exists(self):
2895.         msg = "Migration 0001_initial already exists. Use a different name."
2896.         with self.temporary_migration_module(module="migrations.test_migrations"):
2897.             with self.assertRaisesMessage(CommandError, msg):
2898.                 call_command(
2899.                     "squashmigrations",
2900.                     "migrations",
2901.                     "0001",
2902.                     "0002",
2903.                     squashed_name="initial",
2904.                     interactive=False,
2905.                     verbosity=0,
2906.                 )
2907. 
2908.     def test_squashmigrations_manual_porting(self):
2909.         out = io.StringIO()
2910.         with self.temporary_migration_module(
2911.             module="migrations.test_migrations_manual_porting",
2912.         ) as migration_dir:
2913.             call_command(
2914.                 "squashmigrations",
2915.                 "migrations",
2916.                 "0002",
2917.                 interactive=False,
2918.                 stdout=out,
2919.                 no_color=True,
2920.             )
2921.             squashed_migration_file = os.path.join(
2922.                 migration_dir,
2923.                 "0001_squashed_0002_second.py",
2924.             )
2925.             self.assertTrue(os.path.exists(squashed_migration_file))
2926.         black_warning = ""
2927.         if HAS_BLACK:
2928.             black_warning = (
2929.                 "Squashed migration couldn't be formatted using the "
2930.                 '"black" command. You can call it manually.\n'
2931.             )
2932.         self.assertEqual(
2933.             out.getvalue(),
2934.             f"Will squash the following migrations:\n"
2935.             f" - 0001_initial\n"
2936.             f" - 0002_second\n"
2937.             f"Optimizing...\n"
2938.             f"  No optimizations possible.\n"
2939.             f"Created new squashed migration {squashed_migration_file}\n"
2940.             f"  You should commit this migration but leave the old ones in place;\n"
2941.             f"  the new migration will be used for new installs. Once you are sure\n"
2942.             f"  all instances of the codebase have applied the migrations you "
2943.             f"squashed,\n"
2944.             f"  you can delete them.\n"
2945.             f"Manual porting required\n"
2946.             f"  Your migrations contained functions that must be manually copied "
2947.             f"over,\n"
2948.             f"  as we could not safely copy their implementation.\n"
2949.             f"  See the comment at the top of the squashed migration for details.\n"
2950.             + black_warning,
2951.         )
2952. 
2953. 
2954. class AppLabelErrorTests(TestCase):
2955.     """
2956.     This class inherits TestCase because MigrationTestBase uses
2957.     `available_apps = ['migrations']` which means that it's the only installed
2958.     app. 'django.contrib.auth' must be in INSTALLED_APPS for some of these
2959.     tests.
2960.     """
2961. 
2962.     nonexistent_app_error = "No installed app with label 'nonexistent_app'."
2963.     did_you_mean_auth_error = (
2964.         "No installed app with label 'django.contrib.auth'. Did you mean 'auth'?"
2965.     )
2966. 
2967.     def test_makemigrations_nonexistent_app_label(self):
2968.         err = io.StringIO()
2969.         with self.assertRaises(SystemExit):
2970.             call_command("makemigrations", "nonexistent_app", stderr=err)
2971.         self.assertIn(self.nonexistent_app_error, err.getvalue())
2972. 
2973.     def test_makemigrations_app_name_specified_as_label(self):
2974.         err = io.StringIO()
2975.         with self.assertRaises(SystemExit):
2976.             call_command("makemigrations", "django.contrib.auth", stderr=err)
2977.         self.assertIn(self.did_you_mean_auth_error, err.getvalue())
2978. 
2979.     def test_migrate_nonexistent_app_label(self):
2980.         with self.assertRaisesMessage(CommandError, self.nonexistent_app_error):
2981.             call_command("migrate", "nonexistent_app")
2982. 
2983.     def test_migrate_app_name_specified_as_label(self):
2984.         with self.assertRaisesMessage(CommandError, self.did_you_mean_auth_error):
2985.             call_command("migrate", "django.contrib.auth")
2986. 
2987.     def test_showmigrations_nonexistent_app_label(self):
2988.         err = io.StringIO()
2989.         with self.assertRaises(SystemExit):
2990.             call_command("showmigrations", "nonexistent_app", stderr=err)
2991.         self.assertIn(self.nonexistent_app_error, err.getvalue())
2992. 
2993.     def test_showmigrations_app_name_specified_as_label(self):
2994.         err = io.StringIO()
2995.         with self.assertRaises(SystemExit):
2996.             call_command("showmigrations", "django.contrib.auth", stderr=err)
2997.         self.assertIn(self.did_you_mean_auth_error, err.getvalue())
2998. 
2999.     def test_sqlmigrate_nonexistent_app_label(self):
3000.         with self.assertRaisesMessage(CommandError, self.nonexistent_app_error):


File: tests/migrations/test_commands.py
Line number range: 3001 - 3500
Content:
3001.             call_command("sqlmigrate", "nonexistent_app", "0002")
3002. 
3003.     def test_sqlmigrate_app_name_specified_as_label(self):
3004.         with self.assertRaisesMessage(CommandError, self.did_you_mean_auth_error):
3005.             call_command("sqlmigrate", "django.contrib.auth", "0002")
3006. 
3007.     def test_squashmigrations_nonexistent_app_label(self):
3008.         with self.assertRaisesMessage(CommandError, self.nonexistent_app_error):
3009.             call_command("squashmigrations", "nonexistent_app", "0002")
3010. 
3011.     def test_squashmigrations_app_name_specified_as_label(self):
3012.         with self.assertRaisesMessage(CommandError, self.did_you_mean_auth_error):
3013.             call_command("squashmigrations", "django.contrib.auth", "0002")
3014. 
3015.     def test_optimizemigration_nonexistent_app_label(self):
3016.         with self.assertRaisesMessage(CommandError, self.nonexistent_app_error):
3017.             call_command("optimizemigration", "nonexistent_app", "0002")
3018. 
3019.     def test_optimizemigration_app_name_specified_as_label(self):
3020.         with self.assertRaisesMessage(CommandError, self.did_you_mean_auth_error):
3021.             call_command("optimizemigration", "django.contrib.auth", "0002")
3022. 
3023. 
3024. class OptimizeMigrationTests(MigrationTestBase):
3025.     def test_no_optimization_possible(self):
3026.         out = io.StringIO()
3027.         with self.temporary_migration_module(
3028.             module="migrations.test_migrations"
3029.         ) as migration_dir:
3030.             call_command(
3031.                 "optimizemigration", "migrations", "0002", stdout=out, no_color=True
3032.             )
3033.             migration_file = os.path.join(migration_dir, "0002_second.py")
3034.             self.assertTrue(os.path.exists(migration_file))
3035.             call_command(
3036.                 "optimizemigration",
3037.                 "migrations",
3038.                 "0002",
3039.                 stdout=out,
3040.                 no_color=True,
3041.                 verbosity=0,
3042.             )
3043.         self.assertEqual(out.getvalue(), "No optimizations possible.\n")
3044. 
3045.     def test_optimization(self):
3046.         out = io.StringIO()
3047.         with self.temporary_migration_module(
3048.             module="migrations.test_migrations"
3049.         ) as migration_dir:
3050.             call_command(
3051.                 "optimizemigration", "migrations", "0001", stdout=out, no_color=True
3052.             )
3053.             initial_migration_file = os.path.join(migration_dir, "0001_initial.py")
3054.             self.assertTrue(os.path.exists(initial_migration_file))
3055.             with open(initial_migration_file) as fp:
3056.                 content = fp.read()
3057.                 self.assertIn(
3058.                     '("bool", models.BooleanField'
3059.                     if HAS_BLACK
3060.                     else "('bool', models.BooleanField",
3061.                     content,
3062.                 )
3063.         self.assertEqual(
3064.             out.getvalue(),
3065.             f"Optimizing from 4 operations to 2 operations.\n"
3066.             f"Optimized migration {initial_migration_file}\n",
3067.         )
3068. 
3069.     def test_optimization_no_verbosity(self):
3070.         out = io.StringIO()
3071.         with self.temporary_migration_module(
3072.             module="migrations.test_migrations"
3073.         ) as migration_dir:
3074.             call_command(
3075.                 "optimizemigration",
3076.                 "migrations",
3077.                 "0001",
3078.                 stdout=out,
3079.                 no_color=True,
3080.                 verbosity=0,
3081.             )
3082.             initial_migration_file = os.path.join(migration_dir, "0001_initial.py")
3083.             self.assertTrue(os.path.exists(initial_migration_file))
3084.             with open(initial_migration_file) as fp:
3085.                 content = fp.read()
3086.                 self.assertIn(
3087.                     '("bool", models.BooleanField'
3088.                     if HAS_BLACK
3089.                     else "('bool', models.BooleanField",
3090.                     content,
3091.                 )
3092.         self.assertEqual(out.getvalue(), "")
3093. 
3094.     def test_creates_replace_migration_manual_porting(self):
3095.         out = io.StringIO()
3096.         with self.temporary_migration_module(
3097.             module="migrations.test_migrations_manual_porting"
3098.         ) as migration_dir:
3099.             call_command(
3100.                 "optimizemigration", "migrations", "0003", stdout=out, no_color=True
3101.             )
3102.             optimized_migration_file = os.path.join(
3103.                 migration_dir, "0003_third_optimized.py"
3104.             )
3105.             self.assertTrue(os.path.exists(optimized_migration_file))
3106.             with open(optimized_migration_file) as fp:
3107.                 content = fp.read()
3108.                 self.assertIn("replaces = [", content)
3109.         black_warning = ""
3110.         if HAS_BLACK:
3111.             black_warning = (
3112.                 "Optimized migration couldn't be formatted using the "
3113.                 '"black" command. You can call it manually.\n'
3114.             )
3115.         self.assertEqual(
3116.             out.getvalue(),
3117.             "Optimizing from 3 operations to 2 operations.\n"
3118.             "Manual porting required\n"
3119.             "  Your migrations contained functions that must be manually copied over,\n"
3120.             "  as we could not safely copy their implementation.\n"
3121.             "  See the comment at the top of the optimized migration for details.\n"
3122.             + black_warning
3123.             + f"Optimized migration {optimized_migration_file}\n",
3124.         )
3125. 
3126.     def test_fails_squash_migration_manual_porting(self):
3127.         out = io.StringIO()
3128.         with self.temporary_migration_module(
3129.             module="migrations.test_migrations_manual_porting"
3130.         ) as migration_dir:
3131.             version = get_docs_version()
3132.             msg = (
3133.                 f"Migration will require manual porting but is already a squashed "
3134.                 f"migration.\nTransition to a normal migration first: "
3135.                 f"https://docs.djangoproject.com/en/{version}/topics/migrations/"
3136.                 f"#squashing-migrations"
3137.             )
3138.             with self.assertRaisesMessage(CommandError, msg):
3139.                 call_command("optimizemigration", "migrations", "0004", stdout=out)
3140.             optimized_migration_file = os.path.join(
3141.                 migration_dir, "0004_fourth_optimized.py"
3142.             )
3143.             self.assertFalse(os.path.exists(optimized_migration_file))
3144.         self.assertEqual(
3145.             out.getvalue(), "Optimizing from 3 operations to 2 operations.\n"
3146.         )
3147. 
3148.     @override_settings(MIGRATION_MODULES={"migrations": "migrations.test_migrations"})
3149.     def test_optimizemigration_check(self):
3150.         with self.assertRaises(SystemExit):
3151.             call_command(
3152.                 "optimizemigration", "--check", "migrations", "0001", verbosity=0
3153.             )
3154. 
3155.         call_command("optimizemigration", "--check", "migrations", "0002", verbosity=0)
3156. 
3157.     @override_settings(
3158.         INSTALLED_APPS=["migrations.migrations_test_apps.unmigrated_app_simple"],
3159.     )
3160.     def test_app_without_migrations(self):
3161.         msg = "App 'unmigrated_app_simple' does not have migrations."
3162.         with self.assertRaisesMessage(CommandError, msg):
3163.             call_command("optimizemigration", "unmigrated_app_simple", "0001")
3164. 
3165.     @override_settings(
3166.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_clashing_prefix"},
3167.     )
3168.     def test_ambigious_prefix(self):
3169.         msg = (
3170.             "More than one migration matches 'a' in app 'migrations'. Please "
3171.             "be more specific."
3172.         )
3173.         with self.assertRaisesMessage(CommandError, msg):
3174.             call_command("optimizemigration", "migrations", "a")
3175. 
3176.     @override_settings(MIGRATION_MODULES={"migrations": "migrations.test_migrations"})
3177.     def test_unknown_prefix(self):
3178.         msg = "Cannot find a migration matching 'nonexistent' from app 'migrations'."
3179.         with self.assertRaisesMessage(CommandError, msg):
3180.             call_command("optimizemigration", "migrations", "nonexistent")

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-21 20:09:04,219 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='The user requested the full content of `tests/migrations/test_commands.py`. This context provides the entire content of the file as requested.', relative_path='tests/migrations/test_commands.py', start_line=1, end_line=3180)]
2025-12-21 20:09:04,225 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of `tests/migrations/test_commands.py`.
2025-12-21 20:09:04,225 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-21 20:09:04,225 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-21 20:09:04,225 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 1 existing contexts
2025-12-21 20:09:04,225 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 2 total contexts (removed 0 duplicates)
2025-12-21 20:09:04,226 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .github
|   ├── CODE_OF_CONDUCT.md
|   ├── FUNDING.yml
|   ├── SECURITY.md
|   └── workflows
|       ├── benchmark.yml
|       ├── docs.yml
|       ├── linters.yml
|       ├── new_contributor_pr.yml
|       ├── schedule_tests.yml
|       ├── schedules.yml
|       └── tests.yml
├── .pre-commit-config.yaml
├── .readthedocs.yml
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ar_DZ
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ckb
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ig
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ky
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ms
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uz
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   ├── 0012_alter_user_first_name_max_length.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   └── options.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── constraints.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── ms
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── tg
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── uz
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_redirect_new_path_help_text.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── templates
|   |   |   |   ├── sitemap.xml
|   |   |   |   └── sitemap_index.xml
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── asgi.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   ├── memcached.py
|   |   |   |   └── redis.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── async_checks.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   ├── __init__.py
|   |   |   |   └── django_4_0.py
|   |   |   ├── database.py
|   |   |   ├── files.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── filesystem.py
|   |   |   |   ├── handler.py
|   |   |   |   ├── memory.py
|   |   |   |   └── mixins.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── asgi.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── __init__.py
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── optimizemigration.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── jsonl.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── psycopg_any.py
|   |   |   |   └── schema.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _functions.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   └── special.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── enums.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── json.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── autoreload.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── asyncio.py
|   |   ├── autoreload.py
|   |   ├── cache.py
|   |   ├── connection.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── common.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           ├── default_urlconf.html
|           ├── technical_404.html
|           ├── technical_500.html
|           └── technical_500.txt
├── docs
|   ├── README.rst
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   ├── genindex.html
|   |   |   ├── layout.html
|   |   |   ├── modindex.html
|   |   |   ├── search.html
|   |   |   └── static
|   |   |       ├── console-tabs.css
|   |   |       ├── default.css
|   |   |       ├── djangodocs.css
|   |   |       ├── fontawesome
|   |   |       ├── homepage.css
|   |   |       └── reset-fonts-grids.css
|   |   └── djangodocs-epub
|   |       ├── epub-cover.html
|   |       └── static
|   |           └── epub.css
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── _images
|   |   ├── auth-remote-user.txt
|   |   ├── csrf.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-backend.txt
|   |   ├── custom-template-tags.txt
|   |   ├── deployment
|   |   |   ├── asgi
|   |   |   |   ├── daphne.txt
|   |   |   |   ├── hypercorn.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── uvicorn.txt
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── legacy-databases.txt
|   |   ├── logging.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── filters.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── constraints.txt
|   |   |   |   ├── expressions.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── logging.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── paginator.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.19.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.20.txt
|   |   ├── 1.11.21.txt
|   |   ├── 1.11.22.txt
|   |   ├── 1.11.23.txt
|   |   ├── 1.11.24.txt
|   |   ├── 1.11.25.txt
|   |   ├── 1.11.26.txt
|   |   ├── 1.11.27.txt
|   |   ├── 1.11.28.txt
|   |   ├── 1.11.29.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.11.txt
|   |   ├── 2.0.12.txt
|   |   ├── 2.0.13.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.10.txt
|   |   ├── 2.1.11.txt
|   |   ├── 2.1.12.txt
|   |   ├── 2.1.13.txt
|   |   ├── 2.1.14.txt
|   |   ├── 2.1.15.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.7.txt
|   |   ├── 2.1.8.txt
|   |   ├── 2.1.9.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.1.txt
|   |   ├── 2.2.10.txt
|   |   ├── 2.2.11.txt
|   |   ├── 2.2.12.txt
|   |   ├── 2.2.13.txt
|   |   ├── 2.2.14.txt
|   |   ├── 2.2.15.txt
|   |   ├── 2.2.16.txt
|   |   ├── 2.2.17.txt
|   |   ├── 2.2.18.txt
|   |   ├── 2.2.19.txt
|   |   ├── 2.2.2.txt
|   |   ├── 2.2.20.txt
|   |   ├── 2.2.21.txt
|   |   ├── 2.2.22.txt
|   |   ├── 2.2.23.txt
|   |   ├── 2.2.24.txt
|   |   ├── 2.2.25.txt
|   |   ├── 2.2.26.txt
|   |   ├── 2.2.27.txt
|   |   ├── 2.2.28.txt
|   |   ├── 2.2.3.txt
|   |   ├── 2.2.4.txt
|   |   ├── 2.2.5.txt
|   |   ├── 2.2.6.txt
|   |   ├── 2.2.7.txt
|   |   ├── 2.2.8.txt
|   |   ├── 2.2.9.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.1.txt
|   |   ├── 3.0.10.txt
|   |   ├── 3.0.11.txt
|   |   ├── 3.0.12.txt
|   |   ├── 3.0.13.txt
|   |   ├── 3.0.14.txt
|   |   ├── 3.0.2.txt
|   |   ├── 3.0.3.txt
|   |   ├── 3.0.4.txt
|   |   ├── 3.0.5.txt
|   |   ├── 3.0.6.txt
|   |   ├── 3.0.7.txt
|   |   ├── 3.0.8.txt
|   |   ├── 3.0.9.txt
|   |   ├── 3.0.txt
|   |   ├── 3.1.1.txt
|   |   ├── 3.1.10.txt
|   |   ├── 3.1.11.txt
|   |   ├── 3.1.12.txt
|   |   ├── 3.1.13.txt
|   |   ├── 3.1.14.txt
|   |   ├── 3.1.2.txt
|   |   ├── 3.1.3.txt
|   |   ├── 3.1.4.txt
|   |   ├── 3.1.5.txt
|   |   ├── 3.1.6.txt
|   |   ├── 3.1.7.txt
|   |   ├── 3.1.8.txt
|   |   ├── 3.1.9.txt
|   |   ├── 3.1.txt
|   |   ├── 3.2.1.txt
|   |   ├── 3.2.10.txt
|   |   ├── 3.2.11.txt
|   |   ├── 3.2.12.txt
|   |   ├── 3.2.13.txt
|   |   ├── 3.2.14.txt
|   |   ├── 3.2.15.txt
|   |   ├── 3.2.16.txt
|   |   ├── 3.2.17.txt
|   |   ├── 3.2.2.txt
|   |   ├── 3.2.3.txt
|   |   ├── 3.2.4.txt
|   |   ├── 3.2.5.txt
|   |   ├── 3.2.6.txt
|   |   ├── 3.2.7.txt
|   |   ├── 3.2.8.txt
|   |   ├── 3.2.9.txt
|   |   ├── 3.2.txt
|   |   ├── 4.0.1.txt
|   |   ├── 4.0.2.txt
|   |   ├── 4.0.3.txt
|   |   ├── 4.0.4.txt
|   |   ├── 4.0.5.txt
|   |   ├── 4.0.6.txt
|   |   ├── 4.0.7.txt
|   |   ├── 4.0.8.txt
|   |   ├── 4.0.9.txt
|   |   ├── 4.0.txt
|   |   ├── 4.1.1.txt
|   |   ├── 4.1.2.txt
|   |   ├── 4.1.3.txt
|   |   ├── 4.1.4.txt
|   |   ├── 4.1.5.txt
|   |   ├── 4.1.6.txt
|   |   ├── 4.1.7.txt
|   |   ├── 4.1.txt
|   |   ├── 4.2.txt
|   |   ├── 5.0.txt
|   |   ├── index.txt
|   |   └── security.txt
|   ├── requirements.txt
|   └── topics
|       ├── async.txt
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── fixtures.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   ├── jsi18n-mocks.test.js
|   |   └── navigation.test.js
|   ├── gis
|   |   └── mapwidget.test.js
|   └── tests.html
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_dynamic_settings_manage.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── .hidden
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       ├── noargs_command.py
    |   |       └── suppress_base_options_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── admin
    |   |   |   ├── admin_views
    |   |   |   └── base_site.html
    |   |   └── custom_filter_template.html
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_breadcrumbs.py
    |   ├── test_forms.py
    |   ├── test_history_view.py
    |   ├── test_multidb.py
    |   ├── test_nav_sidebar.py
    |   ├── test_skip_link_to_content.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   ├── no_config_app
    |   |   └── __init__.py
    |   ├── one_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── tests.py
    |   ├── two_configs_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── two_configs_one_default_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   └── two_default_configs_app
    |       ├── __init__.py
    |       └── apps.py
    ├── asgi
    |   ├── __init__.py
    |   ├── project
    |   |   └── static
    |   |       └── file.txt
    |   ├── tests.py
    |   └── urls.py
    ├── async
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_async_model_methods.py
    |   ├── test_async_queryset.py
    |   ├── test_async_related_managers.py
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   ├── with_last_login_attr.py
    |   |   ├── with_many_to_many.py
    |   |   └── with_unique_constraint.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   |   ├── auth_attrs_access.html
    |   |   |   ├── auth_attrs_messages.html
    |   |   |   ├── auth_attrs_no_access.html
    |   |   |   ├── auth_attrs_perm_in_perms.html
    |   |   |   ├── auth_attrs_perms.html
    |   |   |   ├── auth_attrs_test_access.html
    |   |   |   └── auth_attrs_user.html
    |   |   └── registration
    |   |       ├── html_password_reset_email.html
    |   |       ├── logged_out.html
    |   |       ├── login.html
    |   |       ├── password_change_form.html
    |   |       ├── password_reset_complete.html
    |   |       ├── password_reset_confirm.html
    |   |       ├── password_reset_done.html
    |   |       ├── password_reset_email.html
    |   |       ├── password_reset_form.html
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_remote_user.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── app_unmigrated
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── test_base.py
    |   |   ├── test_client.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_functions.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   ├── tests.py
    |   └── tests_async.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── template_test_apps
    |   |   ├── __init__.py
    |   |   ├── different_tags_app
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   ├── same_tags_app_1
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   └── same_tags_app_2
    |   |       ├── __init__.py
    |   |       ├── apps.py
    |   |       └── templatetags
    |   ├── test_4_0_compatibility.py
    |   ├── test_async_checks.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_files.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_class_based_error_handlers.py
    |       ├── bad_error_handlers_invalid_path.py
    |       ├── bad_function_based_error_handlers.py
    |       ├── beginning_with_slash.py
    |       ├── cbv_as_view.py
    |       ├── contains_tuple.py
    |       ├── good_class_based_error_handlers.py
    |       ├── good_function_based_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   └── ending_with_dollar.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_migrations.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   |       ├── debug.html
    |   |       └── request_attrs.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_collate.py
    |   |   ├── test_greatest.py
    |   |   ├── test_json_object.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_random.py
    |   |   ├── test_round.py
    |   |   ├── test_sign.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_md5.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_sha1.py
    |   |   ├── test_sha224.py
    |   |   ├── test_sha256.py
    |   |   ├── test_sha384.py
    |   |   ├── test_sha512.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── fake_client.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   ├── test_postgresql.py
    |   ├── test_sqlite.py
    |   └── tests.py
    ├── decorators
    |   ├── __init__.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   ├── test_middleware_mixin.py
    |   ├── test_storages.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── empty_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── test_commands.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── test_inmemory_storage.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── fixture2.xml
    |   |   ├── fixture3.xml
    |   |   ├── fixture7.xml
    |   |   └── fixture9.xml
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── animal.xml
    |   |   ├── bad_fixture2.xml
    |   |   ├── nk-inheritance2.xml
    |   |   ├── non_natural_2.xml
    |   |   ├── pretty.xml
    |   |   └── sequence_extra_xml.xml
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── absolute_urls.py
    |   ├── no_slash_urls.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   |   └── default.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_jsonfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   |       └── custom_widget.html
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   |       ├── article_form.html
    |   |       ├── custom_widget.html
    |   |       ├── cyclic_context_boundfield_render.html
    |   |       ├── error.html
    |   |       ├── form_snippet.html
    |   |       ├── legend_test.html
    |   |       └── use_fieldset.html
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   └── tags.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   |       └── using.html
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   ├── about.html
    |   |   |   ├── apple_detail.html
    |   |   |   ├── artist_detail.html
    |   |   |   ├── artist_form.html
    |   |   |   ├── author_confirm_delete.html
    |   |   |   ├── author_detail.html
    |   |   |   ├── author_form.html
    |   |   |   ├── author_list.html
    |   |   |   ├── author_objects.html
    |   |   |   ├── author_view.html
    |   |   |   ├── book_archive.html
    |   |   |   ├── book_archive_day.html
    |   |   |   ├── book_archive_month.html
    |   |   |   ├── book_archive_week.html
    |   |   |   ├── book_archive_year.html
    |   |   |   ├── book_detail.html
    |   |   |   ├── book_list.html
    |   |   |   ├── confirm_delete.html
    |   |   |   ├── detail.html
    |   |   |   ├── form.html
    |   |   |   ├── list.html
    |   |   |   ├── page_template.html
    |   |   |   ├── robots.txt
    |   |   |   └── using.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── has_nulls
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   ├── test_srs.py
    |   |   └── tests.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_indexes.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_create_models.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_rastermodels.py
    |   |   |   └── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   |   └── test_handler.html
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   |   └── ignored.html
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   |   └── media_ignored.html
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   ├── javascript_ignored.js
    |   |   |   └── static_ignored.html
    |   |   └── templates
    |   |       ├── empty.html
    |   |       ├── subdir
    |   |       ├── test.html
    |   |       └── xxx_ignored.html
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── loading
    |   |   ├── en
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_AU
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_CA
    |   |   |   └── LC_MESSAGES
    |   |   └── en_NZ
    |   |       └── LC_MESSAGES
    |   ├── loading_app
    |   |   ├── __init__.py
    |   |   ├── apps.py
    |   |   └── locale
    |   |       └── en
    |   ├── models.py
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   |   ├── 404.html
    |   |   |   └── dummy.html
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── models.py
    |   |   |   └── test.html
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   |   └── percents.html
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── unchanged
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   ├── tests.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_fake_initial_case_insensitive
    |   |   ├── fake_initial
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── initial
    |   |       ├── 0001_initial.py
    |   |       └── __init__.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_conflict_long_name
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second_migration_with_long_name.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_manual_porting
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   └── __init__.py
    |   ├── test_migrations_namespace_package
    |   |   └── 0001_initial.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_no_operations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_noop
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   ├── 0005_fifth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_no_replaces
    |   |   ├── 0001_squashed_0002.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_enums
    |   ├── __init__.py
    |   └── tests.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autofield.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_filepathfield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_jsonfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_pk.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── model_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── integration_settings.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_constraints.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_integration.py
    |   ├── test_introspection.py
    |   ├── test_operations.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_contains.py
    |   ├── test_db_returning.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   ├── test_sqlcompiler.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests_tests
    |   ├── __init__.py
    |   ├── test_accept_header.py
    |   ├── test_data_upload_settings.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_jsonl.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_clear_expired.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   |       └── using.html
    |   ├── templates
    |   |   └── shortcuts
    |   |       ├── render_test.html
    |   |       └── using.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── custom_sitemap.xml
    |   |   └── custom_sitemap_lastmod_index.xml
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   ├── test_management.py
    |   ├── test_utils.py
    |   └── urls
    |       ├── __init__.py
    |       ├── empty.py
    |       ├── http.py
    |       ├── https.py
    |       ├── index_only.py
    |       └── sitemap_only.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── absolute_root.css
    |   |   |   ├── absolute_root.js
    |   |   |   ├── cached
    |   |   |   ├── nested
    |   |   |   ├── styles_root.css
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   |   └── faulty.css
    |   |   ├── loop
    |   |   |   ├── bar.css
    |   |   |   └── foo.css
    |   |   ├── pathlib
    |   |   |   └── pathlib.txt
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   |       ├── description.html
    |   |       ├── description_context.html
    |   |       ├── title.html
    |   |       └── title_context.html
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   |       └── hello.html
    |   ├── jinja2
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       ├── syntax_error.html
    |   |       ├── syntax_error2.html
    |   |       └── syntax_error_include.html
    |   ├── template_strings
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       └── syntax_error.html
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_loader
    |   |       ├── goodbye.html
    |   |       ├── hello.html
    |   |       └── request.html
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   |       └── using.html
    |   ├── other_templates
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   └── test_dirs.html
    |   ├── recursive_templates
    |   |   ├── fs
    |   |   |   ├── extend-missing.html
    |   |   |   ├── one.html
    |   |   |   ├── other-recursive.html
    |   |   |   ├── recursive.html
    |   |   |   ├── self.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── fs2
    |   |   |   └── recursive.html
    |   |   └── fs3
    |   |       └── recursive.html
    |   ├── relative_templates
    |   |   ├── dir1
    |   |   |   ├── dir2
    |   |   |   ├── looped.html
    |   |   |   ├── one.html
    |   |   |   ├── one1.html
    |   |   |   ├── one2.html
    |   |   |   ├── one3.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── error_extends.html
    |   |   ├── error_include.html
    |   |   ├── one.html
    |   |   ├── one_var.html
    |   |   ├── three.html
    |   |   └── two.html
    |   ├── syntax_tests
    |   |   ├── __init__.py
    |   |   ├── i18n
    |   |   |   ├── __init__.py
    |   |   |   ├── base.py
    |   |   |   ├── test_blocktranslate.py
    |   |   |   ├── test_filters.py
    |   |   |   ├── test_get_available_languages.py
    |   |   |   ├── test_get_current_language.py
    |   |   |   ├── test_get_current_language_bidi.py
    |   |   |   ├── test_get_language_info.py
    |   |   |   ├── test_get_language_info_list.py
    |   |   |   ├── test_language.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Management command subparsers don’t retain error formatting

Description: Description
	
Django management commands use a subclass of argparse.ArgumentParser, CommandParser, that takes some extra arguments to improve error formatting. These arguments are not copied into subparsers, created via CommandParser.add_subparsers().add_parser(). Missing arguments to subparsers thus end as stack traces on the CLI, rather than human-facing usage messages.
For example take this command with a subparser:
from django.core.management.base import BaseCommand
class Command(BaseCommand):
	def add_arguments(self, parser):
		subparsers = parser.add_subparsers(required=True)
		create = subparsers.add_parser("create")
		create.add_argument("name")
	def handle(self, *args, **options):
		pass
Missing the required subparser name argument gives the usage message, as for any normal argument:
$ ./manage.py cheeses
usage: manage.py cheeses [-h] [--version] [-v {0,1,2,3}] [--settings SETTINGS] [--pythonpath PYTHONPATH] [--traceback] [--no-color] [--force-color] [--skip-checks] {create} ...
manage.py cheeses: error: the following arguments are required: {create}
But missing the name argument to create fails with a stacktrace:
$ ./manage.py cheeses create
Traceback (most recent call last):
 File "/Users/chainz/tmp/subparserstest/./manage.py", line 21, in <module>
	main()
...
 File "/Users/chainz/.pyenv/versions/3.11.0/lib/python3.11/argparse.py", line 2131, in _parse_known_args
	self.error(_('the following arguments are required: %s') %
 File "/Users/chainz/Documents/Projects/django/django/core/management/base.py", line 72, in error
	raise CommandError("Error: %s" % message)
django.core.management.base.CommandError: Error: the following arguments are required: name
We can correct this by ensuring that the subparser action returned by add_subparsers() copies the relevant arguments through to constructed subparsers.
(Originally reported by Mark Gregson on django-developers: ​https://groups.google.com/g/django-developers/c/oWcaxkxQ-KI/m/4NUhLjddBwAJ )

Patch information:
diff --git a/django/core/management/base.py b/django/core/management/base.py
index abc6f79a15..ad698bfd7d 100644
--- a/django/core/management/base.py
+++ b/django/core/management/base.py
@@ -71,6 +71,52 @@ class CommandParser(ArgumentParser):
         else:
             raise CommandError("Error: %s" % message)
 
+    def add_subparsers(self, **kwargs):
+        """
+        Add subparsers that inherit relevant settings from this CommandParser so
+        that subparsers retain Django's error formatting and behavior.
+        """
+        # Ensure subparsers use the same parser class by default.
+        kwargs.setdefault("parser_class", type(self))
+        subparsers = super().add_subparsers(**kwargs)
+
+        parent_called_from_command_line = self.called_from_command_line
+        parent_missing_args_message = self.missing_args_message
+        parent_formatter_class = getattr(self, "formatter_class", None)
+        parent_allow_abbrev = getattr(self, "allow_abbrev", None)
+
+        original_add_parser = subparsers.add_parser
+
+        def add_parser(name, **kw):
+            # Determine the parser class that will be used for this subparser.
+            parser_class = kw.get("parser_class", getattr(subparsers, "parser_class", None))
+
+            # Propagate generic argparse settings if not explicitly provided.
+            if parent_formatter_class is not None and "formatter_class" not in kw:
+                kw["formatter_class"] = parent_formatter_class
+            if parent_allow_abbrev is not None and "allow_abbrev" not in kw:
+                kw["allow_abbrev"] = parent_allow_abbrev
+
+            # Only pass Django-specific kwargs when the target parser class
+            # understands them (i.e., is a subclass of CommandParser).
+            try:
+                if parser_class is None:
+                    parser_class = type(self)
+                if issubclass(parser_class, CommandParser):
+                    kw.setdefault("missing_args_message", parent_missing_args_message)
+                    kw.setdefault("called_from_command_line", parent_called_from_command_line)
+            except Exception:
+                # If we can't determine the parser class safely, don't inject
+                # Django-specific kwargs to avoid unexpected TypeErrors.
+                pass
+
+            return original_add_parser(name, **kw)
+
+        # Monkey-patch the returned action to inject our defaults whenever
+        # a new subparser is added.
+        subparsers.add_parser = add_parser
+        return subparsers
+
 
 def handle_default_options(options):
     """


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `tests/admin_scripts/tests.py` and all Python files inside `tests/admin_scripts/management/commands/`.
Extra Requirements: 
Purpose: This will provide the necessary context to find test cases that cover command-line argument parsing with subparsers and their error handling.

Previous refined query 2:
Essential Query: Please provide the full content of `tests/migrations/test_commands.py`.
Extra Requirements: 
Purpose: I need to examine the tests for the `migrate` command to find examples of how complex argument parsing, especially with subparsers, is tested in Django, or could be, tested.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: tests/admin_scripts/tests.py
Line number range: 1 - 3062
Content:
1. """
2. A series of tests to establish that the command-line management tools work as
3. advertised - especially with regards to the handling of the
4. DJANGO_SETTINGS_MODULE and default settings.py files.
5. """
6. import os
7. import re
8. import shutil
9. import socket
10. import stat
11. import subprocess
12. import sys
13. import tempfile
14. import unittest
15. from io import StringIO
16. from unittest import mock
17. 
18. from django import conf, get_version
19. from django.conf import settings
20. from django.core.management import (
21.     BaseCommand,
22.     CommandError,
23.     call_command,
24.     color,
25.     execute_from_command_line,
26. )
27. from django.core.management.commands.loaddata import Command as LoaddataCommand
28. from django.core.management.commands.runserver import Command as RunserverCommand
29. from django.core.management.commands.testserver import Command as TestserverCommand
30. from django.db import ConnectionHandler, connection
31. from django.db.migrations.recorder import MigrationRecorder
32. from django.test import LiveServerTestCase, SimpleTestCase, TestCase, override_settings
33. from django.test.utils import captured_stderr, captured_stdout
34. from django.urls import path
35. from django.views.static import serve
36. 
37. from . import urls
38. 
39. custom_templates_dir = os.path.join(os.path.dirname(__file__), "custom_templates")
40. 
41. SYSTEM_CHECK_MSG = "System check identified no issues"
42. 
43. HAS_BLACK = shutil.which("black")
44. 
45. 
46. class AdminScriptTestCase(SimpleTestCase):
47.     def setUp(self):
48.         tmpdir = tempfile.TemporaryDirectory()
49.         self.addCleanup(tmpdir.cleanup)
50.         # os.path.realpath() is required for temporary directories on macOS,
51.         # where `/var` is a symlink to `/private/var`.
52.         self.test_dir = os.path.realpath(os.path.join(tmpdir.name, "test_project"))
53.         os.mkdir(self.test_dir)
54. 
55.     def write_settings(self, filename, apps=None, is_dir=False, sdict=None, extra=None):
56.         if is_dir:
57.             settings_dir = os.path.join(self.test_dir, filename)
58.             os.mkdir(settings_dir)
59.             settings_file_path = os.path.join(settings_dir, "__init__.py")
60.         else:
61.             settings_file_path = os.path.join(self.test_dir, filename)
62. 
63.         with open(settings_file_path, "w") as settings_file:
64.             settings_file.write(
65.                 "# Settings file automatically generated by admin_scripts test case\n"
66.             )
67.             if extra:
68.                 settings_file.write("%s\n" % extra)
69.             exports = [
70.                 "DATABASES",
71.                 "DEFAULT_AUTO_FIELD",
72.                 "ROOT_URLCONF",
73.                 "SECRET_KEY",
74.                 "USE_TZ",
75.             ]
76.             for s in exports:
77.                 if hasattr(settings, s):
78.                     o = getattr(settings, s)
79.                     if not isinstance(o, (dict, tuple, list)):
80.                         o = "'%s'" % o
81.                     settings_file.write("%s = %s\n" % (s, o))
82. 
83.             if apps is None:
84.                 apps = [
85.                     "django.contrib.auth",
86.                     "django.contrib.contenttypes",
87.                     "admin_scripts",
88.                 ]
89. 
90.             settings_file.write("INSTALLED_APPS = %s\n" % apps)
91. 
92.             if sdict:
93.                 for k, v in sdict.items():
94.                     settings_file.write("%s = %s\n" % (k, v))
95. 
96.     def _ext_backend_paths(self):
97.         """
98.         Returns the paths for any external backend packages.
99.         """
100.         paths = []
101.         for backend in settings.DATABASES.values():
102.             package = backend["ENGINE"].split(".")[0]
103.             if package != "django":
104.                 backend_pkg = __import__(package)
105.                 backend_dir = os.path.dirname(backend_pkg.__file__)
106.                 paths.append(os.path.dirname(backend_dir))
107.         return paths
108. 
109.     def run_test(self, args, settings_file=None, apps=None, umask=-1):
110.         base_dir = os.path.dirname(self.test_dir)
111.         # The base dir for Django's tests is one level up.
112.         tests_dir = os.path.dirname(os.path.dirname(__file__))
113.         # The base dir for Django is one level above the test dir. We don't use
114.         # `import django` to figure that out, so we don't pick up a Django
115.         # from site-packages or similar.
116.         django_dir = os.path.dirname(tests_dir)
117.         ext_backend_base_dirs = self._ext_backend_paths()
118. 
119.         # Define a temporary environment for the subprocess
120.         test_environ = os.environ.copy()
121. 
122.         # Set the test environment
123.         if settings_file:
124.             test_environ["DJANGO_SETTINGS_MODULE"] = settings_file
125.         elif "DJANGO_SETTINGS_MODULE" in test_environ:
126.             del test_environ["DJANGO_SETTINGS_MODULE"]
127.         python_path = [base_dir, django_dir, tests_dir]
128.         python_path.extend(ext_backend_base_dirs)
129.         test_environ["PYTHONPATH"] = os.pathsep.join(python_path)
130.         test_environ["PYTHONWARNINGS"] = ""
131. 
132.         p = subprocess.run(
133.             [sys.executable, *args],
134.             capture_output=True,
135.             cwd=self.test_dir,
136.             env=test_environ,
137.             text=True,
138.             umask=umask,
139.         )
140.         return p.stdout, p.stderr
141. 
142.     def run_django_admin(self, args, settings_file=None, umask=-1):
143.         return self.run_test(["-m", "django", *args], settings_file, umask=umask)
144. 
145.     def run_manage(self, args, settings_file=None, manage_py=None):
146.         template_manage_py = (
147.             os.path.join(os.path.dirname(__file__), manage_py)
148.             if manage_py
149.             else os.path.join(
150.                 os.path.dirname(conf.__file__), "project_template", "manage.py-tpl"
151.             )
152.         )
153.         test_manage_py = os.path.join(self.test_dir, "manage.py")
154.         shutil.copyfile(template_manage_py, test_manage_py)
155. 
156.         with open(test_manage_py) as fp:
157.             manage_py_contents = fp.read()
158.         manage_py_contents = manage_py_contents.replace(
159.             "{{ project_name }}", "test_project"
160.         )
161.         with open(test_manage_py, "w") as fp:
162.             fp.write(manage_py_contents)
163. 
164.         return self.run_test(["./manage.py", *args], settings_file)
165. 
166.     def assertNoOutput(self, stream):
167.         "Utility assertion: assert that the given stream is empty"
168.         self.assertEqual(
169.             len(stream), 0, "Stream should be empty: actually contains '%s'" % stream
170.         )
171. 
172.     def assertOutput(self, stream, msg, regex=False):
173.         "Utility assertion: assert that the given message exists in the output"
174.         if regex:
175.             self.assertIsNotNone(
176.                 re.search(msg, stream),
177.                 "'%s' does not match actual output text '%s'" % (msg, stream),
178.             )
179.         else:
180.             self.assertIn(
181.                 msg,
182.                 stream,
183.                 "'%s' does not match actual output text '%s'" % (msg, stream),
184.             )
185. 
186.     def assertNotInOutput(self, stream, msg):
187.         "Utility assertion: assert that the given message doesn't exist in the output"
188.         self.assertNotIn(
189.             msg, stream, "'%s' matches actual output text '%s'" % (msg, stream)
190.         )
191. 
192. 
193. ##########################################################################
194. # DJANGO ADMIN TESTS
195. # This first series of test classes checks the environment processing
196. # of the django-admin.
197. ##########################################################################
198. 
199. 
200. class DjangoAdminNoSettings(AdminScriptTestCase):
201.     "A series of tests for django-admin when there is no settings.py file."
202. 
203.     def test_builtin_command(self):
204.         """
205.         no settings: django-admin builtin commands fail with an error when no
206.         settings provided.
207.         """
208.         args = ["check", "admin_scripts"]
209.         out, err = self.run_django_admin(args)
210.         self.assertNoOutput(out)
211.         self.assertOutput(err, "settings are not configured")
212. 
213.     def test_builtin_with_bad_settings(self):
214.         """
215.         no settings: django-admin builtin commands fail if settings file (from
216.         argument) doesn't exist.
217.         """
218.         args = ["check", "--settings=bad_settings", "admin_scripts"]
219.         out, err = self.run_django_admin(args)
220.         self.assertNoOutput(out)
221.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
222. 
223.     def test_builtin_with_bad_environment(self):
224.         """
225.         no settings: django-admin builtin commands fail if settings file (from
226.         environment) doesn't exist.
227.         """
228.         args = ["check", "admin_scripts"]
229.         out, err = self.run_django_admin(args, "bad_settings")
230.         self.assertNoOutput(out)
231.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
232. 
233.     def test_commands_with_invalid_settings(self):
234.         """
235.         Commands that don't require settings succeed if the settings file
236.         doesn't exist.
237.         """
238.         args = ["startproject"]
239.         out, err = self.run_django_admin(args, settings_file="bad_settings")
240.         self.assertNoOutput(out)
241.         self.assertOutput(err, "You must provide a project name", regex=True)
242. 
243. 
244. class DjangoAdminDefaultSettings(AdminScriptTestCase):
245.     """
246.     A series of tests for django-admin when using a settings.py file that
247.     contains the test application.
248.     """
249. 
250.     def setUp(self):
251.         super().setUp()
252.         self.write_settings("settings.py")
253. 
254.     def test_builtin_command(self):
255.         """
256.         default: django-admin builtin commands fail with an error when no
257.         settings provided.
258.         """
259.         args = ["check", "admin_scripts"]
260.         out, err = self.run_django_admin(args)
261.         self.assertNoOutput(out)
262.         self.assertOutput(err, "settings are not configured")
263. 
264.     def test_builtin_with_settings(self):
265.         """
266.         default: django-admin builtin commands succeed if settings are provided
267.         as argument.
268.         """
269.         args = ["check", "--settings=test_project.settings", "admin_scripts"]
270.         out, err = self.run_django_admin(args)
271.         self.assertNoOutput(err)
272.         self.assertOutput(out, SYSTEM_CHECK_MSG)
273. 
274.     def test_builtin_with_environment(self):
275.         """
276.         default: django-admin builtin commands succeed if settings are provided
277.         in the environment.
278.         """
279.         args = ["check", "admin_scripts"]
280.         out, err = self.run_django_admin(args, "test_project.settings")
281.         self.assertNoOutput(err)
282.         self.assertOutput(out, SYSTEM_CHECK_MSG)
283. 
284.     def test_builtin_with_bad_settings(self):
285.         """
286.         default: django-admin builtin commands fail if settings file (from
287.         argument) doesn't exist.
288.         """
289.         args = ["check", "--settings=bad_settings", "admin_scripts"]
290.         out, err = self.run_django_admin(args)
291.         self.assertNoOutput(out)
292.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
293. 
294.     def test_builtin_with_bad_environment(self):
295.         """
296.         default: django-admin builtin commands fail if settings file (from
297.         environment) doesn't exist.
298.         """
299.         args = ["check", "admin_scripts"]
300.         out, err = self.run_django_admin(args, "bad_settings")
301.         self.assertNoOutput(out)
302.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
303. 
304.     def test_custom_command(self):
305.         """
306.         default: django-admin can't execute user commands if it isn't provided
307.         settings.
308.         """
309.         args = ["noargs_command"]
310.         out, err = self.run_django_admin(args)
311.         self.assertNoOutput(out)
312.         self.assertOutput(err, "No Django settings specified")
313.         self.assertOutput(err, "Unknown command: 'noargs_command'")
314. 
315.     def test_custom_command_with_settings(self):
316.         """
317.         default: django-admin can execute user commands if settings are
318.         provided as argument.
319.         """
320.         args = ["noargs_command", "--settings=test_project.settings"]
321.         out, err = self.run_django_admin(args)
322.         self.assertNoOutput(err)
323.         self.assertOutput(out, "EXECUTE: noargs_command")
324. 
325.     def test_custom_command_with_environment(self):
326.         """
327.         default: django-admin can execute user commands if settings are
328.         provided in environment.
329.         """
330.         args = ["noargs_command"]
331.         out, err = self.run_django_admin(args, "test_project.settings")
332.         self.assertNoOutput(err)
333.         self.assertOutput(out, "EXECUTE: noargs_command")
334. 
335. 
336. class DjangoAdminFullPathDefaultSettings(AdminScriptTestCase):
337.     """
338.     A series of tests for django-admin when using a settings.py file that
339.     contains the test application specified using a full path.
340.     """
341. 
342.     def setUp(self):
343.         super().setUp()
344.         self.write_settings(
345.             "settings.py",
346.             [
347.                 "django.contrib.auth",
348.                 "django.contrib.contenttypes",
349.                 "admin_scripts",
350.                 "admin_scripts.complex_app",
351.             ],
352.         )
353. 
354.     def test_builtin_command(self):
355.         """
356.         fulldefault: django-admin builtin commands fail with an error when no
357.         settings provided.
358.         """
359.         args = ["check", "admin_scripts"]
360.         out, err = self.run_django_admin(args)
361.         self.assertNoOutput(out)
362.         self.assertOutput(err, "settings are not configured")
363. 
364.     def test_builtin_with_settings(self):
365.         """
366.         fulldefault: django-admin builtin commands succeed if a settings file
367.         is provided.
368.         """
369.         args = ["check", "--settings=test_project.settings", "admin_scripts"]
370.         out, err = self.run_django_admin(args)
371.         self.assertNoOutput(err)
372.         self.assertOutput(out, SYSTEM_CHECK_MSG)
373. 
374.     def test_builtin_with_environment(self):
375.         """
376.         fulldefault: django-admin builtin commands succeed if the environment
377.         contains settings.
378.         """
379.         args = ["check", "admin_scripts"]
380.         out, err = self.run_django_admin(args, "test_project.settings")
381.         self.assertNoOutput(err)
382.         self.assertOutput(out, SYSTEM_CHECK_MSG)
383. 
384.     def test_builtin_with_bad_settings(self):
385.         """
386.         fulldefault: django-admin builtin commands fail if settings file (from
387.         argument) doesn't exist.
388.         """
389.         args = ["check", "--settings=bad_settings", "admin_scripts"]
390.         out, err = self.run_django_admin(args)
391.         self.assertNoOutput(out)
392.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
393. 
394.     def test_builtin_with_bad_environment(self):
395.         """
396.         fulldefault: django-admin builtin commands fail if settings file (from
397.         environment) doesn't exist.
398.         """
399.         args = ["check", "admin_scripts"]
400.         out, err = self.run_django_admin(args, "bad_settings")
401.         self.assertNoOutput(out)
402.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
403. 
404.     def test_custom_command(self):
405.         """
406.         fulldefault: django-admin can't execute user commands unless settings
407.         are provided.
408.         """
409.         args = ["noargs_command"]
410.         out, err = self.run_django_admin(args)
411.         self.assertNoOutput(out)
412.         self.assertOutput(err, "No Django settings specified")
413.         self.assertOutput(err, "Unknown command: 'noargs_command'")
414. 
415.     def test_custom_command_with_settings(self):
416.         """
417.         fulldefault: django-admin can execute user commands if settings are
418.         provided as argument.
419.         """
420.         args = ["noargs_command", "--settings=test_project.settings"]
421.         out, err = self.run_django_admin(args)
422.         self.assertNoOutput(err)
423.         self.assertOutput(out, "EXECUTE: noargs_command")
424. 
425.     def test_custom_command_with_environment(self):
426.         """
427.         fulldefault: django-admin can execute user commands if settings are
428.         provided in environment.
429.         """
430.         args = ["noargs_command"]
431.         out, err = self.run_django_admin(args, "test_project.settings")
432.         self.assertNoOutput(err)
433.         self.assertOutput(out, "EXECUTE: noargs_command")
434. 
435. 
436. class DjangoAdminMinimalSettings(AdminScriptTestCase):
437.     """
438.     A series of tests for django-admin when using a settings.py file that
439.     doesn't contain the test application.
440.     """
441. 
442.     def setUp(self):
443.         super().setUp()
444.         self.write_settings(
445.             "settings.py", apps=["django.contrib.auth", "django.contrib.contenttypes"]
446.         )
447. 
448.     def test_builtin_command(self):
449.         """
450.         minimal: django-admin builtin commands fail with an error when no
451.         settings provided.
452.         """
453.         args = ["check", "admin_scripts"]
454.         out, err = self.run_django_admin(args)
455.         self.assertNoOutput(out)
456.         self.assertOutput(err, "settings are not configured")
457. 
458.     def test_builtin_with_settings(self):
459.         """
460.         minimal: django-admin builtin commands fail if settings are provided as
461.         argument.
462.         """
463.         args = ["check", "--settings=test_project.settings", "admin_scripts"]
464.         out, err = self.run_django_admin(args)
465.         self.assertNoOutput(out)
466.         self.assertOutput(err, "No installed app with label 'admin_scripts'.")
467. 
468.     def test_builtin_with_environment(self):
469.         """
470.         minimal: django-admin builtin commands fail if settings are provided in
471.         the environment.
472.         """
473.         args = ["check", "admin_scripts"]
474.         out, err = self.run_django_admin(args, "test_project.settings")
475.         self.assertNoOutput(out)
476.         self.assertOutput(err, "No installed app with label 'admin_scripts'.")
477. 
478.     def test_builtin_with_bad_settings(self):
479.         """
480.         minimal: django-admin builtin commands fail if settings file (from
481.         argument) doesn't exist.
482.         """
483.         args = ["check", "--settings=bad_settings", "admin_scripts"]
484.         out, err = self.run_django_admin(args)
485.         self.assertNoOutput(out)
486.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
487. 
488.     def test_builtin_with_bad_environment(self):
489.         """
490.         minimal: django-admin builtin commands fail if settings file (from
491.         environment) doesn't exist.
492.         """
493.         args = ["check", "admin_scripts"]
494.         out, err = self.run_django_admin(args, "bad_settings")
495.         self.assertNoOutput(out)
496.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
497. 
498.     def test_custom_command(self):
499.         "minimal: django-admin can't execute user commands unless settings are provided"
500.         args = ["noargs_command"]
501.         out, err = self.run_django_admin(args)
502.         self.assertNoOutput(out)
503.         self.assertOutput(err, "No Django settings specified")
504.         self.assertOutput(err, "Unknown command: 'noargs_command'")
505. 
506.     def test_custom_command_with_settings(self):
507.         """
508.         minimal: django-admin can't execute user commands, even if settings are
509.         provided as argument.
510.         """
511.         args = ["noargs_command", "--settings=test_project.settings"]
512.         out, err = self.run_django_admin(args)
513.         self.assertNoOutput(out)
514.         self.assertOutput(err, "Unknown command: 'noargs_command'")
515. 
516.     def test_custom_command_with_environment(self):
517.         """
518.         minimal: django-admin can't execute user commands, even if settings are
519.         provided in environment.
520.         """
521.         args = ["noargs_command"]
522.         out, err = self.run_django_admin(args, "test_project.settings")
523.         self.assertNoOutput(out)
524.         self.assertOutput(err, "Unknown command: 'noargs_command'")
525. 
526. 
527. class DjangoAdminAlternateSettings(AdminScriptTestCase):
528.     """
529.     A series of tests for django-admin when using a settings file with a name
530.     other than 'settings.py'.
531.     """
532. 
533.     def setUp(self):
534.         super().setUp()
535.         self.write_settings("alternate_settings.py")
536. 
537.     def test_builtin_command(self):
538.         """
539.         alternate: django-admin builtin commands fail with an error when no
540.         settings provided.
541.         """
542.         args = ["check", "admin_scripts"]
543.         out, err = self.run_django_admin(args)
544.         self.assertNoOutput(out)
545.         self.assertOutput(err, "settings are not configured")
546. 
547.     def test_builtin_with_settings(self):
548.         """
549.         alternate: django-admin builtin commands succeed if settings are
550.         provided as argument.
551.         """
552.         args = ["check", "--settings=test_project.alternate_settings", "admin_scripts"]
553.         out, err = self.run_django_admin(args)
554.         self.assertNoOutput(err)
555.         self.assertOutput(out, SYSTEM_CHECK_MSG)
556. 
557.     def test_builtin_with_environment(self):
558.         """
559.         alternate: django-admin builtin commands succeed if settings are
560.         provided in the environment.
561.         """
562.         args = ["check", "admin_scripts"]
563.         out, err = self.run_django_admin(args, "test_project.alternate_settings")
564.         self.assertNoOutput(err)
565.         self.assertOutput(out, SYSTEM_CHECK_MSG)
566. 
567.     def test_builtin_with_bad_settings(self):
568.         """
569.         alternate: django-admin builtin commands fail if settings file (from
570.         argument) doesn't exist.
571.         """
572.         args = ["check", "--settings=bad_settings", "admin_scripts"]
573.         out, err = self.run_django_admin(args)
574.         self.assertNoOutput(out)
575.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
576. 
577.     def test_builtin_with_bad_environment(self):
578.         """
579.         alternate: django-admin builtin commands fail if settings file (from
580.         environment) doesn't exist.
581.         """
582.         args = ["check", "admin_scripts"]
583.         out, err = self.run_django_admin(args, "bad_settings")
584.         self.assertNoOutput(out)
585.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
586. 
587.     def test_custom_command(self):
588.         """
589.         alternate: django-admin can't execute user commands unless settings
590.         are provided.
591.         """
592.         args = ["noargs_command"]
593.         out, err = self.run_django_admin(args)
594.         self.assertNoOutput(out)
595.         self.assertOutput(err, "No Django settings specified")
596.         self.assertOutput(err, "Unknown command: 'noargs_command'")
597. 
598.     def test_custom_command_with_settings(self):
599.         """
600.         alternate: django-admin can execute user commands if settings are
601.         provided as argument.
602.         """
603.         args = ["noargs_command", "--settings=test_project.alternate_settings"]
604.         out, err = self.run_django_admin(args)
605.         self.assertNoOutput(err)
606.         self.assertOutput(out, "EXECUTE: noargs_command")
607. 
608.     def test_custom_command_with_environment(self):
609.         """
610.         alternate: django-admin can execute user commands if settings are
611.         provided in environment.
612.         """
613.         args = ["noargs_command"]
614.         out, err = self.run_django_admin(args, "test_project.alternate_settings")
615.         self.assertNoOutput(err)
616.         self.assertOutput(out, "EXECUTE: noargs_command")
617. 
618. 
619. class DjangoAdminMultipleSettings(AdminScriptTestCase):
620.     """
621.     A series of tests for django-admin when multiple settings files
622.     (including the default 'settings.py') are available. The default settings
623.     file is insufficient for performing the operations described, so the
624.     alternate settings must be used by the running script.
625.     """
626. 
627.     def setUp(self):
628.         super().setUp()
629.         self.write_settings(
630.             "settings.py", apps=["django.contrib.auth", "django.contrib.contenttypes"]
631.         )
632.         self.write_settings("alternate_settings.py")
633. 
634.     def test_builtin_command(self):
635.         """
636.         alternate: django-admin builtin commands fail with an error when no
637.         settings provided.
638.         """
639.         args = ["check", "admin_scripts"]
640.         out, err = self.run_django_admin(args)
641.         self.assertNoOutput(out)
642.         self.assertOutput(err, "settings are not configured")
643. 
644.     def test_builtin_with_settings(self):
645.         """
646.         alternate: django-admin builtin commands succeed if settings are
647.         provided as argument.
648.         """
649.         args = ["check", "--settings=test_project.alternate_settings", "admin_scripts"]
650.         out, err = self.run_django_admin(args)
651.         self.assertNoOutput(err)
652.         self.assertOutput(out, SYSTEM_CHECK_MSG)
653. 
654.     def test_builtin_with_environment(self):
655.         """
656.         alternate: django-admin builtin commands succeed if settings are
657.         provided in the environment.
658.         """
659.         args = ["check", "admin_scripts"]
660.         out, err = self.run_django_admin(args, "test_project.alternate_settings")
661.         self.assertNoOutput(err)
662.         self.assertOutput(out, SYSTEM_CHECK_MSG)
663. 
664.     def test_builtin_with_bad_settings(self):
665.         """
666.         alternate: django-admin builtin commands fail if settings file (from
667.         argument) doesn't exist.
668.         """
669.         args = ["check", "--settings=bad_settings", "admin_scripts"]
670.         out, err = self.run_django_admin(args)
671.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
672. 
673.     def test_builtin_with_bad_environment(self):
674.         """
675.         alternate: django-admin builtin commands fail if settings file (from
676.         environment) doesn't exist.
677.         """
678.         args = ["check", "admin_scripts"]
679.         out, err = self.run_django_admin(args, "bad_settings")
680.         self.assertNoOutput(out)
681.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
682. 
683.     def test_custom_command(self):
684.         """
685.         alternate: django-admin can't execute user commands unless settings are
686.         provided.
687.         """
688.         args = ["noargs_command"]
689.         out, err = self.run_django_admin(args)
690.         self.assertNoOutput(out)
691.         self.assertOutput(err, "No Django settings specified")
692.         self.assertOutput(err, "Unknown command: 'noargs_command'")
693. 
694.     def test_custom_command_with_settings(self):
695.         """
696.         alternate: django-admin can execute user commands if settings are
697.         provided as argument.
698.         """
699.         args = ["noargs_command", "--settings=test_project.alternate_settings"]
700.         out, err = self.run_django_admin(args)
701.         self.assertNoOutput(err)
702.         self.assertOutput(out, "EXECUTE: noargs_command")
703. 
704.     def test_custom_command_with_environment(self):
705.         """
706.         alternate: django-admin can execute user commands if settings are
707.         provided in environment.
708.         """
709.         args = ["noargs_command"]
710.         out, err = self.run_django_admin(args, "test_project.alternate_settings")
711.         self.assertNoOutput(err)
712.         self.assertOutput(out, "EXECUTE: noargs_command")
713. 
714. 
715. class DjangoAdminSettingsDirectory(AdminScriptTestCase):
716.     """
717.     A series of tests for django-admin when the settings file is in a
718.     directory. (see #9751).
719.     """
720. 
721.     def setUp(self):
722.         super().setUp()
723.         self.write_settings("settings", is_dir=True)
724. 
725.     def test_setup_environ(self):
726.         "directory: startapp creates the correct directory"
727.         args = ["startapp", "settings_test"]
728.         app_path = os.path.join(self.test_dir, "settings_test")
729.         out, err = self.run_django_admin(args, "test_project.settings")
730.         self.assertNoOutput(err)
731.         self.assertTrue(os.path.exists(app_path))
732.         with open(os.path.join(app_path, "apps.py")) as f:
733.             content = f.read()
734.             self.assertIn("class SettingsTestConfig(AppConfig)", content)
735.             self.assertIn(
736.                 'name = "settings_test"' if HAS_BLACK else "name = 'settings_test'",
737.                 content,
738.             )
739. 
740.     def test_setup_environ_custom_template(self):
741.         "directory: startapp creates the correct directory with a custom template"
742.         template_path = os.path.join(custom_templates_dir, "app_template")
743.         args = ["startapp", "--template", template_path, "custom_settings_test"]
744.         app_path = os.path.join(self.test_dir, "custom_settings_test")
745.         out, err = self.run_django_admin(args, "test_project.settings")
746.         self.assertNoOutput(err)
747.         self.assertTrue(os.path.exists(app_path))
748.         self.assertTrue(os.path.exists(os.path.join(app_path, "api.py")))
749. 
750.     def test_startapp_unicode_name(self):
751.         """startapp creates the correct directory with Unicode characters."""
752.         args = ["startapp", "こんにちは"]
753.         app_path = os.path.join(self.test_dir, "こんにちは")
754.         out, err = self.run_django_admin(args, "test_project.settings")
755.         self.assertNoOutput(err)
756.         self.assertTrue(os.path.exists(app_path))
757.         with open(os.path.join(app_path, "apps.py"), encoding="utf8") as f:
758.             content = f.read()
759.             self.assertIn("class こんにちはConfig(AppConfig)", content)
760.             self.assertIn('name = "こんにちは"' if HAS_BLACK else "name = 'こんにちは'", content)
761. 
762.     def test_builtin_command(self):
763.         """
764.         directory: django-admin builtin commands fail with an error when no
765.         settings provided.
766.         """
767.         args = ["check", "admin_scripts"]
768.         out, err = self.run_django_admin(args)
769.         self.assertNoOutput(out)
770.         self.assertOutput(err, "settings are not configured")
771. 
772.     def test_builtin_with_bad_settings(self):
773.         """
774.         directory: django-admin builtin commands fail if settings file (from
775.         argument) doesn't exist.
776.         """
777.         args = ["check", "--settings=bad_settings", "admin_scripts"]
778.         out, err = self.run_django_admin(args)
779.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
780. 
781.     def test_builtin_with_bad_environment(self):
782.         """
783.         directory: django-admin builtin commands fail if settings file (from
784.         environment) doesn't exist.
785.         """
786.         args = ["check", "admin_scripts"]
787.         out, err = self.run_django_admin(args, "bad_settings")
788.         self.assertNoOutput(out)
789.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
790. 
791.     def test_custom_command(self):
792.         """
793.         directory: django-admin can't execute user commands unless settings are
794.         provided.
795.         """
796.         args = ["noargs_command"]
797.         out, err = self.run_django_admin(args)
798.         self.assertNoOutput(out)
799.         self.assertOutput(err, "No Django settings specified")
800.         self.assertOutput(err, "Unknown command: 'noargs_command'")
801. 
802.     def test_builtin_with_settings(self):
803.         """
804.         directory: django-admin builtin commands succeed if settings are
805.         provided as argument.
806.         """
807.         args = ["check", "--settings=test_project.settings", "admin_scripts"]
808.         out, err = self.run_django_admin(args)
809.         self.assertNoOutput(err)
810.         self.assertOutput(out, SYSTEM_CHECK_MSG)
811. 
812.     def test_builtin_with_environment(self):
813.         """
814.         directory: django-admin builtin commands succeed if settings are
815.         provided in the environment.
816.         """
817.         args = ["check", "admin_scripts"]
818.         out, err = self.run_django_admin(args, "test_project.settings")
819.         self.assertNoOutput(err)
820.         self.assertOutput(out, SYSTEM_CHECK_MSG)
821. 
822. 
823. ##########################################################################
824. # MANAGE.PY TESTS
825. # This next series of test classes checks the environment processing
826. # of the generated manage.py script
827. ##########################################################################
828. 
829. 
830. class ManageManuallyConfiguredSettings(AdminScriptTestCase):
831.     """Customized manage.py calling settings.configure()."""
832. 
833.     def test_non_existent_command_output(self):
834.         out, err = self.run_manage(
835.             ["invalid_command"], manage_py="configured_settings_manage.py"
836.         )
837.         self.assertNoOutput(out)
838.         self.assertOutput(err, "Unknown command: 'invalid_command'")
839.         self.assertNotInOutput(err, "No Django settings specified")
840. 
841. 
842. class ManageNoSettings(AdminScriptTestCase):
843.     "A series of tests for manage.py when there is no settings.py file."
844. 
845.     def test_builtin_command(self):
846.         """
847.         no settings: manage.py builtin commands fail with an error when no
848.         settings provided.
849.         """
850.         args = ["check", "admin_scripts"]
851.         out, err = self.run_manage(args)
852.         self.assertNoOutput(out)
853.         self.assertOutput(
854.             err, r"No module named '?(test_project\.)?settings'?", regex=True
855.         )
856. 
857.     def test_builtin_with_bad_settings(self):
858.         """
859.         no settings: manage.py builtin commands fail if settings file (from
860.         argument) doesn't exist.
861.         """
862.         args = ["check", "--settings=bad_settings", "admin_scripts"]
863.         out, err = self.run_manage(args)
864.         self.assertNoOutput(out)
865.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
866. 
867.     def test_builtin_with_bad_environment(self):
868.         """
869.         no settings: manage.py builtin commands fail if settings file (from
870.         environment) doesn't exist.
871.         """
872.         args = ["check", "admin_scripts"]
873.         out, err = self.run_manage(args, "bad_settings")
874.         self.assertNoOutput(out)
875.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
876. 
877. 
878. class ManageDefaultSettings(AdminScriptTestCase):
879.     """A series of tests for manage.py when using a settings.py file that
880.     contains the test application.
881.     """
882. 
883.     def setUp(self):
884.         super().setUp()
885.         self.write_settings("settings.py")
886. 
887.     def test_builtin_command(self):
888.         """
889.         default: manage.py builtin commands succeed when default settings are
890.         appropriate.
891.         """
892.         args = ["check", "admin_scripts"]
893.         out, err = self.run_manage(args)
894.         self.assertNoOutput(err)
895.         self.assertOutput(out, SYSTEM_CHECK_MSG)
896. 
897.     def test_builtin_with_settings(self):
898.         """
899.         default: manage.py builtin commands succeed if settings are provided as
900.         argument.
901.         """
902.         args = ["check", "--settings=test_project.settings", "admin_scripts"]
903.         out, err = self.run_manage(args)
904.         self.assertNoOutput(err)
905.         self.assertOutput(out, SYSTEM_CHECK_MSG)
906. 
907.     def test_builtin_with_environment(self):
908.         """
909.         default: manage.py builtin commands succeed if settings are provided in
910.         the environment.
911.         """
912.         args = ["check", "admin_scripts"]
913.         out, err = self.run_manage(args, "test_project.settings")
914.         self.assertNoOutput(err)
915.         self.assertOutput(out, SYSTEM_CHECK_MSG)
916. 
917.     def test_builtin_with_bad_settings(self):
918.         """
919.         default: manage.py builtin commands succeed if settings file (from
920.         argument) doesn't exist.
921.         """
922.         args = ["check", "--settings=bad_settings", "admin_scripts"]
923.         out, err = self.run_manage(args)
924.         self.assertNoOutput(out)
925.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
926. 
927.     def test_builtin_with_bad_environment(self):
928.         """
929.         default: manage.py builtin commands fail if settings file (from
930.         environment) doesn't exist.
931.         """
932.         args = ["check", "admin_scripts"]
933.         out, err = self.run_manage(args, "bad_settings")
934.         self.assertNoOutput(out)
935.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
936. 
937.     def test_custom_command(self):
938.         """
939.         default: manage.py can execute user commands when default settings are
940.         appropriate.
941.         """
942.         args = ["noargs_command"]
943.         out, err = self.run_manage(args)
944.         self.assertNoOutput(err)
945.         self.assertOutput(out, "EXECUTE: noargs_command")
946. 
947.     def test_custom_command_with_settings(self):
948.         """
949.         default: manage.py can execute user commands when settings are provided
950.         as argument.
951.         """
952.         args = ["noargs_command", "--settings=test_project.settings"]
953.         out, err = self.run_manage(args)
954.         self.assertNoOutput(err)
955.         self.assertOutput(out, "EXECUTE: noargs_command")
956. 
957.     def test_custom_command_with_environment(self):
958.         """
959.         default: manage.py can execute user commands when settings are provided
960.         in environment.
961.         """
962.         args = ["noargs_command"]
963.         out, err = self.run_manage(args, "test_project.settings")
964.         self.assertNoOutput(err)
965.         self.assertOutput(out, "EXECUTE: noargs_command")
966. 
967. 
968. class ManageFullPathDefaultSettings(AdminScriptTestCase):
969.     """A series of tests for manage.py when using a settings.py file that
970.     contains the test application specified using a full path.
971.     """
972. 
973.     def setUp(self):
974.         super().setUp()
975.         self.write_settings(
976.             "settings.py",
977.             ["django.contrib.auth", "django.contrib.contenttypes", "admin_scripts"],
978.         )
979. 
980.     def test_builtin_command(self):
981.         """
982.         fulldefault: manage.py builtin commands succeed when default settings
983.         are appropriate.
984.         """
985.         args = ["check", "admin_scripts"]
986.         out, err = self.run_manage(args)
987.         self.assertNoOutput(err)
988.         self.assertOutput(out, SYSTEM_CHECK_MSG)
989. 
990.     def test_builtin_with_settings(self):
991.         """
992.         fulldefault: manage.py builtin commands succeed if settings are
993.         provided as argument.
994.         """
995.         args = ["check", "--settings=test_project.settings", "admin_scripts"]
996.         out, err = self.run_manage(args)
997.         self.assertNoOutput(err)
998.         self.assertOutput(out, SYSTEM_CHECK_MSG)
999. 
1000.     def test_builtin_with_environment(self):
1001.         """
1002.         fulldefault: manage.py builtin commands succeed if settings are
1003.         provided in the environment.
1004.         """
1005.         args = ["check", "admin_scripts"]
1006.         out, err = self.run_manage(args, "test_project.settings")
1007.         self.assertNoOutput(err)
1008.         self.assertOutput(out, SYSTEM_CHECK_MSG)
1009. 
1010.     def test_builtin_with_bad_settings(self):
1011.         """
1012.         fulldefault: manage.py builtin commands succeed if settings file (from
1013.         argument) doesn't exist.
1014.         """
1015.         args = ["check", "--settings=bad_settings", "admin_scripts"]
1016.         out, err = self.run_manage(args)
1017.         self.assertNoOutput(out)
1018.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
1019. 
1020.     def test_builtin_with_bad_environment(self):
1021.         """
1022.         fulldefault: manage.py builtin commands fail if settings file (from
1023.         environment) doesn't exist.
1024.         """
1025.         args = ["check", "admin_scripts"]
1026.         out, err = self.run_manage(args, "bad_settings")
1027.         self.assertNoOutput(out)
1028.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
1029. 
1030.     def test_custom_command(self):
1031.         """
1032.         fulldefault: manage.py can execute user commands when default settings
1033.         are appropriate.
1034.         """
1035.         args = ["noargs_command"]
1036.         out, err = self.run_manage(args)
1037.         self.assertNoOutput(err)
1038.         self.assertOutput(out, "EXECUTE: noargs_command")
1039. 
1040.     def test_custom_command_with_settings(self):
1041.         """
1042.         fulldefault: manage.py can execute user commands when settings are
1043.         provided as argument.
1044.         """
1045.         args = ["noargs_command", "--settings=test_project.settings"]
1046.         out, err = self.run_manage(args)
1047.         self.assertNoOutput(err)
1048.         self.assertOutput(out, "EXECUTE: noargs_command")
1049. 
1050.     def test_custom_command_with_environment(self):
1051.         """
1052.         fulldefault: manage.py can execute user commands when settings are
1053.         provided in environment.
1054.         """
1055.         args = ["noargs_command"]
1056.         out, err = self.run_manage(args, "test_project.settings")
1057.         self.assertNoOutput(err)
1058.         self.assertOutput(out, "EXECUTE: noargs_command")
1059. 
1060. 
1061. class ManageMinimalSettings(AdminScriptTestCase):
1062.     """A series of tests for manage.py when using a settings.py file that
1063.     doesn't contain the test application.
1064.     """
1065. 
1066.     def setUp(self):
1067.         super().setUp()
1068.         self.write_settings(
1069.             "settings.py", apps=["django.contrib.auth", "django.contrib.contenttypes"]
1070.         )
1071. 
1072.     def test_builtin_command(self):
1073.         """
1074.         minimal: manage.py builtin commands fail with an error when no settings
1075.         provided.
1076.         """
1077.         args = ["check", "admin_scripts"]
1078.         out, err = self.run_manage(args)
1079.         self.assertNoOutput(out)
1080.         self.assertOutput(err, "No installed app with label 'admin_scripts'.")
1081. 
1082.     def test_builtin_with_settings(self):
1083.         "minimal: manage.py builtin commands fail if settings are provided as argument"
1084.         args = ["check", "--settings=test_project.settings", "admin_scripts"]
1085.         out, err = self.run_manage(args)
1086.         self.assertNoOutput(out)
1087.         self.assertOutput(err, "No installed app with label 'admin_scripts'.")
1088. 
1089.     def test_builtin_with_environment(self):
1090.         """
1091.         minimal: manage.py builtin commands fail if settings are provided in
1092.         the environment.
1093.         """
1094.         args = ["check", "admin_scripts"]
1095.         out, err = self.run_manage(args, "test_project.settings")
1096.         self.assertNoOutput(out)
1097.         self.assertOutput(err, "No installed app with label 'admin_scripts'.")
1098. 
1099.     def test_builtin_with_bad_settings(self):
1100.         """
1101.         minimal: manage.py builtin commands fail if settings file (from
1102.         argument) doesn't exist.
1103.         """
1104.         args = ["check", "--settings=bad_settings", "admin_scripts"]
1105.         out, err = self.run_manage(args)
1106.         self.assertNoOutput(out)
1107.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
1108. 
1109.     def test_builtin_with_bad_environment(self):
1110.         """
1111.         minimal: manage.py builtin commands fail if settings file (from
1112.         environment) doesn't exist.
1113.         """
1114.         args = ["check", "admin_scripts"]
1115.         out, err = self.run_manage(args, "bad_settings")
1116.         self.assertNoOutput(out)
1117.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
1118. 
1119.     def test_custom_command(self):
1120.         "minimal: manage.py can't execute user commands without appropriate settings"
1121.         args = ["noargs_command"]
1122.         out, err = self.run_manage(args)
1123.         self.assertNoOutput(out)
1124.         self.assertOutput(err, "Unknown command: 'noargs_command'")
1125. 
1126.     def test_custom_command_with_settings(self):
1127.         """
1128.         minimal: manage.py can't execute user commands, even if settings are
1129.         provided as argument.
1130.         """
1131.         args = ["noargs_command", "--settings=test_project.settings"]
1132.         out, err = self.run_manage(args)
1133.         self.assertNoOutput(out)
1134.         self.assertOutput(err, "Unknown command: 'noargs_command'")
1135. 
1136.     def test_custom_command_with_environment(self):
1137.         """
1138.         minimal: manage.py can't execute user commands, even if settings are
1139.         provided in environment.
1140.         """
1141.         args = ["noargs_command"]
1142.         out, err = self.run_manage(args, "test_project.settings")
1143.         self.assertNoOutput(out)
1144.         self.assertOutput(err, "Unknown command: 'noargs_command'")
1145. 
1146. 
1147. class ManageAlternateSettings(AdminScriptTestCase):
1148.     """A series of tests for manage.py when using a settings file
1149.     with a name other than 'settings.py'.
1150.     """
1151. 
1152.     def setUp(self):
1153.         super().setUp()
1154.         self.write_settings("alternate_settings.py")
1155. 
1156.     def test_builtin_command(self):
1157.         """
1158.         alternate: manage.py builtin commands fail with an error when no
1159.         default settings provided.
1160.         """
1161.         args = ["check", "admin_scripts"]
1162.         out, err = self.run_manage(args)
1163.         self.assertNoOutput(out)
1164.         self.assertOutput(
1165.             err, r"No module named '?(test_project\.)?settings'?", regex=True
1166.         )
1167. 
1168.     def test_builtin_with_settings(self):
1169.         "alternate: manage.py builtin commands work with settings provided as argument"
1170.         args = ["check", "--settings=alternate_settings", "admin_scripts"]
1171.         out, err = self.run_manage(args)
1172.         self.assertOutput(out, SYSTEM_CHECK_MSG)
1173.         self.assertNoOutput(err)
1174. 
1175.     def test_builtin_with_environment(self):
1176.         """
1177.         alternate: manage.py builtin commands work if settings are provided in
1178.         the environment
1179.         """
1180.         args = ["check", "admin_scripts"]
1181.         out, err = self.run_manage(args, "alternate_settings")
1182.         self.assertOutput(out, SYSTEM_CHECK_MSG)
1183.         self.assertNoOutput(err)
1184. 
1185.     def test_builtin_with_bad_settings(self):
1186.         """
1187.         alternate: manage.py builtin commands fail if settings file (from
1188.         argument) doesn't exist.
1189.         """
1190.         args = ["check", "--settings=bad_settings", "admin_scripts"]
1191.         out, err = self.run_manage(args)
1192.         self.assertNoOutput(out)
1193.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
1194. 
1195.     def test_builtin_with_bad_environment(self):
1196.         """
1197.         alternate: manage.py builtin commands fail if settings file (from
1198.         environment) doesn't exist
1199.         """
1200.         args = ["check", "admin_scripts"]
1201.         out, err = self.run_manage(args, "bad_settings")
1202.         self.assertNoOutput(out)
1203.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
1204. 
1205.     def test_custom_command(self):
1206.         "alternate: manage.py can't execute user commands without settings"
1207.         args = ["noargs_command"]
1208.         out, err = self.run_manage(args)
1209.         self.assertNoOutput(out)
1210.         self.assertOutput(
1211.             err, r"No module named '?(test_project\.)?settings'?", regex=True
1212.         )
1213. 
1214.     def test_custom_command_with_settings(self):
1215.         """
1216.         alternate: manage.py can execute user commands if settings are provided
1217.         as argument
1218.         """
1219.         args = ["noargs_command", "--settings=alternate_settings"]
1220.         out, err = self.run_manage(args)
1221.         self.assertOutput(
1222.             out,
1223.             "EXECUTE: noargs_command options=[('force_color', False), "
1224.             "('no_color', False), ('pythonpath', None), ('settings', "
1225.             "'alternate_settings'), ('traceback', False), ('verbosity', 1)]",
1226.         )
1227.         self.assertNoOutput(err)
1228. 
1229.     def test_custom_command_with_environment(self):
1230.         """
1231.         alternate: manage.py can execute user commands if settings are provided
1232.         in environment.
1233.         """
1234.         args = ["noargs_command"]
1235.         out, err = self.run_manage(args, "alternate_settings")
1236.         self.assertOutput(
1237.             out,
1238.             "EXECUTE: noargs_command options=[('force_color', False), "
1239.             "('no_color', False), ('pythonpath', None), ('settings', None), "
1240.             "('traceback', False), ('verbosity', 1)]",
1241.         )
1242.         self.assertNoOutput(err)
1243. 
1244.     def test_custom_command_output_color(self):
1245.         """
1246.         alternate: manage.py output syntax color can be deactivated with the
1247.         `--no-color` option.
1248.         """
1249.         args = ["noargs_command", "--no-color", "--settings=alternate_settings"]
1250.         out, err = self.run_manage(args)
1251.         self.assertOutput(
1252.             out,
1253.             "EXECUTE: noargs_command options=[('force_color', False), "
1254.             "('no_color', True), ('pythonpath', None), ('settings', "
1255.             "'alternate_settings'), ('traceback', False), ('verbosity', 1)]",
1256.         )
1257.         self.assertNoOutput(err)
1258. 
1259. 
1260. class ManageMultipleSettings(AdminScriptTestCase):
1261.     """A series of tests for manage.py when multiple settings files
1262.     (including the default 'settings.py') are available. The default settings
1263.     file is insufficient for performing the operations described, so the
1264.     alternate settings must be used by the running script.
1265.     """
1266. 
1267.     def setUp(self):
1268.         super().setUp()
1269.         self.write_settings(
1270.             "settings.py", apps=["django.contrib.auth", "django.contrib.contenttypes"]
1271.         )
1272.         self.write_settings("alternate_settings.py")
1273. 
1274.     def test_builtin_command(self):
1275.         """
1276.         multiple: manage.py builtin commands fail with an error when no
1277.         settings provided.
1278.         """
1279.         args = ["check", "admin_scripts"]
1280.         out, err = self.run_manage(args)
1281.         self.assertNoOutput(out)
1282.         self.assertOutput(err, "No installed app with label 'admin_scripts'.")
1283. 
1284.     def test_builtin_with_settings(self):
1285.         """
1286.         multiple: manage.py builtin commands succeed if settings are provided
1287.         as argument.
1288.         """
1289.         args = ["check", "--settings=alternate_settings", "admin_scripts"]
1290.         out, err = self.run_manage(args)
1291.         self.assertNoOutput(err)
1292.         self.assertOutput(out, SYSTEM_CHECK_MSG)
1293. 
1294.     def test_builtin_with_environment(self):
1295.         """
1296.         multiple: manage.py can execute builtin commands if settings are
1297.         provided in the environment.
1298.         """
1299.         args = ["check", "admin_scripts"]
1300.         out, err = self.run_manage(args, "alternate_settings")
1301.         self.assertNoOutput(err)
1302.         self.assertOutput(out, SYSTEM_CHECK_MSG)
1303. 
1304.     def test_builtin_with_bad_settings(self):
1305.         """
1306.         multiple: manage.py builtin commands fail if settings file (from
1307.         argument) doesn't exist.
1308.         """
1309.         args = ["check", "--settings=bad_settings", "admin_scripts"]
1310.         out, err = self.run_manage(args)
1311.         self.assertNoOutput(out)
1312.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
1313. 
1314.     def test_builtin_with_bad_environment(self):
1315.         """
1316.         multiple: manage.py builtin commands fail if settings file (from
1317.         environment) doesn't exist.
1318.         """
1319.         args = ["check", "admin_scripts"]
1320.         out, err = self.run_manage(args, "bad_settings")
1321.         self.assertNoOutput(out)
1322.         self.assertOutput(err, "No module named '?bad_settings'?", regex=True)
1323. 
1324.     def test_custom_command(self):
1325.         "multiple: manage.py can't execute user commands using default settings"
1326.         args = ["noargs_command"]
1327.         out, err = self.run_manage(args)
1328.         self.assertNoOutput(out)
1329.         self.assertOutput(err, "Unknown command: 'noargs_command'")
1330. 
1331.     def test_custom_command_with_settings(self):
1332.         """
1333.         multiple: manage.py can execute user commands if settings are provided
1334.         as argument.
1335.         """
1336.         args = ["noargs_command", "--settings=alternate_settings"]
1337.         out, err = self.run_manage(args)
1338.         self.assertNoOutput(err)
1339.         self.assertOutput(out, "EXECUTE: noargs_command")
1340. 
1341.     def test_custom_command_with_environment(self):
1342.         """
1343.         multiple: manage.py can execute user commands if settings are provided
1344.         in environment.
1345.         """
1346.         args = ["noargs_command"]
1347.         out, err = self.run_manage(args, "alternate_settings")
1348.         self.assertNoOutput(err)
1349.         self.assertOutput(out, "EXECUTE: noargs_command")
1350. 
1351. 
1352. class ManageSettingsWithSettingsErrors(AdminScriptTestCase):
1353.     """
1354.     Tests for manage.py when using the default settings.py file containing
1355.     runtime errors.
1356.     """
1357. 
1358.     def write_settings_with_import_error(self, filename):
1359.         settings_file_path = os.path.join(self.test_dir, filename)
1360.         with open(settings_file_path, "w") as settings_file:
1361.             settings_file.write(
1362.                 "# Settings file automatically generated by admin_scripts test case\n"
1363.             )
1364.             settings_file.write(
1365.                 "# The next line will cause an import error:\nimport foo42bar\n"
1366.             )
1367. 
1368.     def test_import_error(self):
1369.         """
1370.         import error: manage.py builtin commands shows useful diagnostic info
1371.         when settings with import errors is provided (#14130).
1372.         """
1373.         self.write_settings_with_import_error("settings.py")
1374.         args = ["check", "admin_scripts"]
1375.         out, err = self.run_manage(args)
1376.         self.assertNoOutput(out)
1377.         self.assertOutput(err, "No module named")
1378.         self.assertOutput(err, "foo42bar")
1379. 
1380.     def test_attribute_error(self):
1381.         """
1382.         manage.py builtin commands does not swallow attribute error due to bad
1383.         settings (#18845).
1384.         """
1385.         self.write_settings("settings.py", sdict={"BAD_VAR": "INSTALLED_APPS.crash"})
1386.         args = ["collectstatic", "admin_scripts"]
1387.         out, err = self.run_manage(args)
1388.         self.assertNoOutput(out)
1389.         self.assertOutput(err, "AttributeError: 'list' object has no attribute 'crash'")
1390. 
1391.     def test_key_error(self):
1392.         self.write_settings("settings.py", sdict={"BAD_VAR": 'DATABASES["blah"]'})
1393.         args = ["collectstatic", "admin_scripts"]
1394.         out, err = self.run_manage(args)
1395.         self.assertNoOutput(out)
1396.         self.assertOutput(err, "KeyError: 'blah'")
1397. 
1398.     def test_help(self):
1399.         """
1400.         Test listing available commands output note when only core commands are
1401.         available.
1402.         """
1403.         self.write_settings(
1404.             "settings.py",
1405.             extra="from django.core.exceptions import ImproperlyConfigured\n"
1406.             "raise ImproperlyConfigured()",
1407.         )
1408.         args = ["help"]
1409.         out, err = self.run_manage(args)
1410.         self.assertOutput(out, "only Django core commands are listed")
1411.         self.assertNoOutput(err)
1412. 
1413. 
1414. class ManageCheck(AdminScriptTestCase):
1415.     def test_nonexistent_app(self):
1416.         """check reports an error on a nonexistent app in INSTALLED_APPS."""
1417.         self.write_settings(
1418.             "settings.py",
1419.             apps=["admin_scriptz.broken_app"],
1420.             sdict={"USE_I18N": False},
1421.         )
1422.         args = ["check"]
1423.         out, err = self.run_manage(args)
1424.         self.assertNoOutput(out)
1425.         self.assertOutput(err, "ModuleNotFoundError")
1426.         self.assertOutput(err, "No module named")
1427.         self.assertOutput(err, "admin_scriptz")
1428. 
1429.     def test_broken_app(self):
1430.         """manage.py check reports an ImportError if an app's models.py
1431.         raises one on import"""
1432. 
1433.         self.write_settings("settings.py", apps=["admin_scripts.broken_app"])
1434.         args = ["check"]
1435.         out, err = self.run_manage(args)
1436.         self.assertNoOutput(out)
1437.         self.assertOutput(err, "ImportError")
1438. 
1439.     def test_complex_app(self):
1440.         """manage.py check does not raise an ImportError validating a
1441.         complex app with nested calls to load_app"""
1442. 
1443.         self.write_settings(
1444.             "settings.py",
1445.             apps=[
1446.                 "admin_scripts.complex_app",
1447.                 "admin_scripts.simple_app",
1448.                 "django.contrib.admin.apps.SimpleAdminConfig",
1449.                 "django.contrib.auth",
1450.                 "django.contrib.contenttypes",
1451.                 "django.contrib.messages",
1452.             ],
1453.             sdict={
1454.                 "DEBUG": True,
1455.                 "MIDDLEWARE": [
1456.                     "django.contrib.messages.middleware.MessageMiddleware",
1457.                     "django.contrib.auth.middleware.AuthenticationMiddleware",
1458.                     "django.contrib.sessions.middleware.SessionMiddleware",
1459.                 ],
1460.                 "TEMPLATES": [
1461.                     {
1462.                         "BACKEND": "django.template.backends.django.DjangoTemplates",
1463.                         "DIRS": [],
1464.                         "APP_DIRS": True,
1465.                         "OPTIONS": {
1466.                             "context_processors": [
1467.                                 "django.template.context_processors.request",
1468.                                 "django.contrib.auth.context_processors.auth",
1469.                                 "django.contrib.messages.context_processors.messages",
1470.                             ],
1471.                         },
1472.                     },
1473.                 ],
1474.             },
1475.         )
1476.         args = ["check"]
1477.         out, err = self.run_manage(args)
1478.         self.assertNoOutput(err)
1479.         self.assertEqual(out, "System check identified no issues (0 silenced).\n")
1480. 
1481.     def test_app_with_import(self):
1482.         """manage.py check does not raise errors when an app imports a base
1483.         class that itself has an abstract base."""
1484. 
1485.         self.write_settings(
1486.             "settings.py",
1487.             apps=[
1488.                 "admin_scripts.app_with_import",
1489.                 "django.contrib.auth",
1490.                 "django.contrib.contenttypes",
1491.                 "django.contrib.sites",
1492.             ],
1493.             sdict={"DEBUG": True},
1494.         )
1495.         args = ["check"]
1496.         out, err = self.run_manage(args)
1497.         self.assertNoOutput(err)
1498.         self.assertEqual(out, "System check identified no issues (0 silenced).\n")
1499. 
1500.     def test_output_format(self):
1501.         """All errors/warnings should be sorted by level and by message."""
1502. 
1503.         self.write_settings(
1504.             "settings.py",
1505.             apps=[
1506.                 "admin_scripts.app_raising_messages",
1507.                 "django.contrib.auth",
1508.                 "django.contrib.contenttypes",
1509.             ],
1510.             sdict={"DEBUG": True},
1511.         )
1512.         args = ["check"]
1513.         out, err = self.run_manage(args)
1514.         expected_err = (
1515.             "SystemCheckError: System check identified some issues:\n"
1516.             "\n"
1517.             "ERRORS:\n"
1518.             "?: An error\n"
1519.             "\tHINT: Error hint\n"
1520.             "\n"
1521.             "WARNINGS:\n"
1522.             "a: Second warning\n"
1523.             "obj: First warning\n"
1524.             "\tHINT: Hint\n"
1525.             "\n"
1526.             "System check identified 3 issues (0 silenced).\n"
1527.         )
1528.         self.assertEqual(err, expected_err)
1529.         self.assertNoOutput(out)
1530. 
1531.     def test_warning_does_not_halt(self):
1532.         """
1533.         When there are only warnings or less serious messages, then Django
1534.         should not prevent user from launching their project, so `check`
1535.         command should not raise `CommandError` exception.
1536. 
1537.         In this test we also test output format.
1538.         """
1539. 
1540.         self.write_settings(
1541.             "settings.py",
1542.             apps=[
1543.                 "admin_scripts.app_raising_warning",
1544.                 "django.contrib.auth",
1545.                 "django.contrib.contenttypes",
1546.             ],
1547.             sdict={"DEBUG": True},
1548.         )
1549.         args = ["check"]
1550.         out, err = self.run_manage(args)
1551.         expected_err = (
1552.             "System check identified some issues:\n"  # No "CommandError: " part
1553.             "\n"
1554.             "WARNINGS:\n"
1555.             "?: A warning\n"
1556.             "\n"
1557.             "System check identified 1 issue (0 silenced).\n"
1558.         )
1559.         self.assertEqual(err, expected_err)
1560.         self.assertNoOutput(out)
1561. 
1562. 
1563. class ManageRunserver(SimpleTestCase):
1564.     def setUp(self):
1565.         def monkey_run(*args, **options):
1566.             return
1567. 
1568.         self.output = StringIO()
1569.         self.cmd = RunserverCommand(stdout=self.output)
1570.         self.cmd.run = monkey_run
1571. 
1572.     def assertServerSettings(self, addr, port, ipv6=False, raw_ipv6=False):
1573.         self.assertEqual(self.cmd.addr, addr)
1574.         self.assertEqual(self.cmd.port, port)
1575.         self.assertEqual(self.cmd.use_ipv6, ipv6)
1576.         self.assertEqual(self.cmd._raw_ipv6, raw_ipv6)
1577. 
1578.     def test_runserver_addrport(self):
1579.         call_command(self.cmd)
1580.         self.assertServerSettings("127.0.0.1", "8000")
1581. 
1582.         call_command(self.cmd, addrport="1.2.3.4:8000")
1583.         self.assertServerSettings("1.2.3.4", "8000")
1584. 
1585.         call_command(self.cmd, addrport="7000")
1586.         self.assertServerSettings("127.0.0.1", "7000")
1587. 
1588.     @mock.patch("django.core.management.commands.runserver.run")
1589.     @mock.patch("django.core.management.base.BaseCommand.check_migrations")
1590.     def test_zero_ip_addr(self, *mocked_objects):
1591.         call_command(
1592.             "runserver",
1593.             addrport="0:8000",
1594.             use_reloader=False,
1595.             skip_checks=True,
1596.             stdout=self.output,
1597.         )
1598.         self.assertIn(
1599.             "Starting development server at http://0.0.0.0:8000/",
1600.             self.output.getvalue(),
1601.         )
1602. 
1603.     @unittest.skipUnless(socket.has_ipv6, "platform doesn't support IPv6")
1604.     def test_runner_addrport_ipv6(self):
1605.         call_command(self.cmd, addrport="", use_ipv6=True)
1606.         self.assertServerSettings("::1", "8000", ipv6=True, raw_ipv6=True)
1607. 
1608.         call_command(self.cmd, addrport="7000", use_ipv6=True)
1609.         self.assertServerSettings("::1", "7000", ipv6=True, raw_ipv6=True)
1610. 
1611.         call_command(self.cmd, addrport="[2001:0db8:1234:5678::9]:7000")
1612.         self.assertServerSettings(
1613.             "2001:0db8:1234:5678::9", "7000", ipv6=True, raw_ipv6=True
1614.         )
1615. 
1616.     def test_runner_hostname(self):
1617.         call_command(self.cmd, addrport="localhost:8000")
1618.         self.assertServerSettings("localhost", "8000")
1619. 
1620.         call_command(self.cmd, addrport="test.domain.local:7000")
1621.         self.assertServerSettings("test.domain.local", "7000")
1622. 
1623.     @unittest.skipUnless(socket.has_ipv6, "platform doesn't support IPv6")
1624.     def test_runner_hostname_ipv6(self):
1625.         call_command(self.cmd, addrport="test.domain.local:7000", use_ipv6=True)
1626.         self.assertServerSettings("test.domain.local", "7000", ipv6=True)
1627. 
1628.     def test_runner_custom_defaults(self):
1629.         self.cmd.default_addr = "0.0.0.0"
1630.         self.cmd.default_port = "5000"
1631.         call_command(self.cmd)
1632.         self.assertServerSettings("0.0.0.0", "5000")
1633. 
1634.     @unittest.skipUnless(socket.has_ipv6, "platform doesn't support IPv6")
1635.     def test_runner_custom_defaults_ipv6(self):
1636.         self.cmd.default_addr_ipv6 = "::"
1637.         call_command(self.cmd, use_ipv6=True)
1638.         self.assertServerSettings("::", "8000", ipv6=True, raw_ipv6=True)
1639. 
1640.     def test_runner_ambiguous(self):
1641.         # Only 4 characters, all of which could be in an ipv6 address
1642.         call_command(self.cmd, addrport="beef:7654")
1643.         self.assertServerSettings("beef", "7654")
1644. 
1645.         # Uses only characters that could be in an ipv6 address
1646.         call_command(self.cmd, addrport="deadbeef:7654")
1647.         self.assertServerSettings("deadbeef", "7654")
1648. 
1649.     def test_no_database(self):
1650.         """
1651.         Ensure runserver.check_migrations doesn't choke on empty DATABASES.
1652.         """
1653.         tested_connections = ConnectionHandler({})
1654.         with mock.patch(
1655.             "django.core.management.base.connections", new=tested_connections
1656.         ):
1657.             self.cmd.check_migrations()
1658. 
1659.     def test_readonly_database(self):
1660.         """
1661.         runserver.check_migrations() doesn't choke when a database is read-only.
1662.         """
1663.         with mock.patch.object(MigrationRecorder, "has_table", return_value=False):
1664.             self.cmd.check_migrations()
1665.         # You have # ...
1666.         self.assertIn("unapplied migration(s)", self.output.getvalue())
1667. 
1668.     @mock.patch("django.core.management.commands.runserver.run")
1669.     @mock.patch("django.core.management.base.BaseCommand.check_migrations")
1670.     @mock.patch("django.core.management.base.BaseCommand.check")
1671.     def test_skip_checks(self, mocked_check, *mocked_objects):
1672.         call_command(
1673.             "runserver",
1674.             use_reloader=False,
1675.             skip_checks=True,
1676.             stdout=self.output,
1677.         )
1678.         self.assertNotIn("Performing system checks...", self.output.getvalue())
1679.         mocked_check.assert_not_called()
1680. 
1681.         self.output.truncate(0)
1682.         call_command(
1683.             "runserver",
1684.             use_reloader=False,
1685.             skip_checks=False,
1686.             stdout=self.output,
1687.         )
1688.         self.assertIn("Performing system checks...", self.output.getvalue())
1689.         mocked_check.assert_called()
1690. 
1691. 
1692. class ManageRunserverMigrationWarning(TestCase):
1693.     def setUp(self):
1694.         self.stdout = StringIO()
1695.         self.runserver_command = RunserverCommand(stdout=self.stdout)
1696. 
1697.     @override_settings(INSTALLED_APPS=["admin_scripts.app_waiting_migration"])
1698.     def test_migration_warning_one_app(self):
1699.         self.runserver_command.check_migrations()
1700.         output = self.stdout.getvalue()
1701.         self.assertIn("You have 1 unapplied migration(s)", output)
1702.         self.assertIn("apply the migrations for app(s): app_waiting_migration.", output)
1703. 
1704.     @override_settings(
1705.         INSTALLED_APPS=[
1706.             "admin_scripts.app_waiting_migration",
1707.             "admin_scripts.another_app_waiting_migration",
1708.         ],
1709.     )
1710.     def test_migration_warning_multiple_apps(self):
1711.         self.runserver_command.check_migrations()
1712.         output = self.stdout.getvalue()
1713.         self.assertIn("You have 2 unapplied migration(s)", output)
1714.         self.assertIn(
1715.             "apply the migrations for app(s): another_app_waiting_migration, "
1716.             "app_waiting_migration.",
1717.             output,
1718.         )
1719. 
1720. 
1721. class ManageRunserverEmptyAllowedHosts(AdminScriptTestCase):
1722.     def setUp(self):
1723.         super().setUp()
1724.         self.write_settings(
1725.             "settings.py",
1726.             sdict={
1727.                 "ALLOWED_HOSTS": [],
1728.                 "DEBUG": False,
1729.             },
1730.         )
1731. 
1732.     def test_empty_allowed_hosts_error(self):
1733.         out, err = self.run_manage(["runserver"])
1734.         self.assertNoOutput(out)
1735.         self.assertOutput(
1736.             err, "CommandError: You must set settings.ALLOWED_HOSTS if DEBUG is False."
1737.         )
1738. 
1739. 
1740. class ManageRunserverHelpOutput(AdminScriptTestCase):
1741.     def test_suppressed_options(self):
1742.         """runserver doesn't support --verbosity and --trackback options."""
1743.         out, err = self.run_manage(["runserver", "--help"])
1744.         self.assertNotInOutput(out, "--verbosity")
1745.         self.assertNotInOutput(out, "--trackback")
1746.         self.assertOutput(out, "--settings")
1747. 
1748. 
1749. class ManageTestserver(SimpleTestCase):
1750.     @mock.patch.object(TestserverCommand, "handle", return_value="")
1751.     def test_testserver_handle_params(self, mock_handle):
1752.         out = StringIO()
1753.         call_command("testserver", "blah.json", stdout=out)
1754.         mock_handle.assert_called_with(
1755.             "blah.json",
1756.             stdout=out,
1757.             settings=None,
1758.             pythonpath=None,
1759.             verbosity=1,
1760.             traceback=False,
1761.             addrport="",
1762.             no_color=False,
1763.             use_ipv6=False,
1764.             skip_checks=True,
1765.             interactive=True,
1766.             force_color=False,
1767.         )
1768. 
1769.     @mock.patch("django.db.connection.creation.create_test_db", return_value="test_db")
1770.     @mock.patch.object(LoaddataCommand, "handle", return_value="")
1771.     @mock.patch.object(RunserverCommand, "handle", return_value="")
1772.     def test_params_to_runserver(
1773.         self, mock_runserver_handle, mock_loaddata_handle, mock_create_test_db
1774.     ):
1775.         call_command("testserver", "blah.json")
1776.         mock_runserver_handle.assert_called_with(
1777.             addrport="",
1778.             force_color=False,
1779.             insecure_serving=False,
1780.             no_color=False,
1781.             pythonpath=None,
1782.             settings=None,
1783.             shutdown_message=(
1784.                 "\nServer stopped.\nNote that the test database, 'test_db', "
1785.                 "has not been deleted. You can explore it on your own."
1786.             ),
1787.             skip_checks=True,
1788.             traceback=False,
1789.             use_ipv6=False,
1790.             use_reloader=False,
1791.             use_static_handler=True,
1792.             use_threading=connection.features.test_db_allows_multiple_connections,
1793.             verbosity=1,
1794.         )
1795. 
1796. 
1797. ##########################################################################
1798. # COMMAND PROCESSING TESTS
1799. # user-space commands are correctly handled - in particular, arguments to
1800. # the commands are correctly parsed and processed.
1801. ##########################################################################
1802. class ColorCommand(BaseCommand):
1803.     requires_system_checks = []
1804. 
1805.     def handle(self, *args, **options):
1806.         self.stdout.write("Hello, world!", self.style.ERROR)
1807.         self.stderr.write("Hello, world!", self.style.ERROR)
1808. 
1809. 
1810. class CommandTypes(AdminScriptTestCase):
1811.     "Tests for the various types of base command types that can be defined."
1812. 
1813.     def setUp(self):
1814.         super().setUp()
1815.         self.write_settings("settings.py")
1816. 
1817.     def test_version(self):
1818.         "version is handled as a special case"
1819.         args = ["version"]
1820.         out, err = self.run_manage(args)
1821.         self.assertNoOutput(err)
1822.         self.assertOutput(out, get_version())
1823. 
1824.     def test_version_alternative(self):
1825.         "--version is equivalent to version"
1826.         args1, args2 = ["version"], ["--version"]
1827.         # It's possible one outputs on stderr and the other on stdout, hence the set
1828.         self.assertEqual(set(self.run_manage(args1)), set(self.run_manage(args2)))
1829. 
1830.     def test_help(self):
1831.         "help is handled as a special case"
1832.         args = ["help"]
1833.         out, err = self.run_manage(args)
1834.         self.assertOutput(
1835.             out, "Type 'manage.py help <subcommand>' for help on a specific subcommand."
1836.         )
1837.         self.assertOutput(out, "[django]")
1838.         self.assertOutput(out, "startapp")
1839.         self.assertOutput(out, "startproject")
1840. 
1841.     def test_help_commands(self):
1842.         "help --commands shows the list of all available commands"
1843.         args = ["help", "--commands"]
1844.         out, err = self.run_manage(args)
1845.         self.assertNotInOutput(out, "usage:")
1846.         self.assertNotInOutput(out, "Options:")
1847.         self.assertNotInOutput(out, "[django]")
1848.         self.assertOutput(out, "startapp")
1849.         self.assertOutput(out, "startproject")
1850.         self.assertNotInOutput(out, "\n\n")
1851. 
1852.     def test_help_alternative(self):
1853.         "--help is equivalent to help"
1854.         args1, args2 = ["help"], ["--help"]
1855.         self.assertEqual(self.run_manage(args1), self.run_manage(args2))
1856. 
1857.     def test_help_short_altert(self):
1858.         "-h is handled as a short form of --help"
1859.         args1, args2 = ["--help"], ["-h"]
1860.         self.assertEqual(self.run_manage(args1), self.run_manage(args2))
1861. 
1862.     def test_specific_help(self):
1863.         "--help can be used on a specific command"
1864.         args = ["check", "--help"]
1865.         out, err = self.run_manage(args)
1866.         self.assertNoOutput(err)
1867.         # Command-specific options like --tag appear before options common to
1868.         # all commands like --version.
1869.         tag_location = out.find("--tag")
1870.         version_location = out.find("--version")
1871.         self.assertNotEqual(tag_location, -1)
1872.         self.assertNotEqual(version_location, -1)
1873.         self.assertLess(tag_location, version_location)
1874.         self.assertOutput(
1875.             out, "Checks the entire Django project for potential problems."
1876.         )
1877. 
1878.     def test_help_default_options_with_custom_arguments(self):
1879.         args = ["base_command", "--help"]
1880.         out, err = self.run_manage(args)
1881.         self.assertNoOutput(err)
1882.         expected_options = [
1883.             "-h",
1884.             "--option_a OPTION_A",
1885.             "--option_b OPTION_B",
1886.             "--option_c OPTION_C",
1887.             "--version",
1888.             "-v {0,1,2,3}",
1889.             "--settings SETTINGS",
1890.             "--pythonpath PYTHONPATH",
1891.             "--traceback",
1892.             "--no-color",
1893.             "--force-color",
1894.             "args ...",
1895.         ]
1896.         for option in expected_options:
1897.             self.assertOutput(out, f"[{option}]")
1898.         self.assertOutput(out, "--option_a OPTION_A, -a OPTION_A")
1899.         self.assertOutput(out, "--option_b OPTION_B, -b OPTION_B")
1900.         self.assertOutput(out, "--option_c OPTION_C, -c OPTION_C")
1901.         self.assertOutput(out, "-v {0,1,2,3}, --verbosity {0,1,2,3}")
1902. 
1903.     def test_color_style(self):
1904.         style = color.no_style()
1905.         self.assertEqual(style.ERROR("Hello, world!"), "Hello, world!")
1906. 
1907.         style = color.make_style("nocolor")
1908.         self.assertEqual(style.ERROR("Hello, world!"), "Hello, world!")
1909. 
1910.         style = color.make_style("dark")
1911.         self.assertIn("Hello, world!", style.ERROR("Hello, world!"))
1912.         self.assertNotEqual(style.ERROR("Hello, world!"), "Hello, world!")
1913. 
1914.         # Default palette has color.
1915.         style = color.make_style("")
1916.         self.assertIn("Hello, world!", style.ERROR("Hello, world!"))
1917.         self.assertNotEqual(style.ERROR("Hello, world!"), "Hello, world!")
1918. 
1919.     def test_command_color(self):
1920.         out = StringIO()
1921.         err = StringIO()
1922.         command = ColorCommand(stdout=out, stderr=err)
1923.         call_command(command)
1924.         if color.supports_color():
1925.             self.assertIn("Hello, world!\n", out.getvalue())
1926.             self.assertIn("Hello, world!\n", err.getvalue())
1927.             self.assertNotEqual(out.getvalue(), "Hello, world!\n")
1928.             self.assertNotEqual(err.getvalue(), "Hello, world!\n")
1929.         else:
1930.             self.assertEqual(out.getvalue(), "Hello, world!\n")
1931.             self.assertEqual(err.getvalue(), "Hello, world!\n")
1932. 
1933.     def test_command_no_color(self):
1934.         "--no-color prevent colorization of the output"
1935.         out = StringIO()
1936.         err = StringIO()
1937.         command = ColorCommand(stdout=out, stderr=err, no_color=True)
1938.         call_command(command)
1939.         self.assertEqual(out.getvalue(), "Hello, world!\n")
1940.         self.assertEqual(err.getvalue(), "Hello, world!\n")
1941. 
1942.         out = StringIO()
1943.         err = StringIO()
1944.         command = ColorCommand(stdout=out, stderr=err)
1945.         call_command(command, no_color=True)
1946.         self.assertEqual(out.getvalue(), "Hello, world!\n")
1947.         self.assertEqual(err.getvalue(), "Hello, world!\n")
1948. 
1949.     def test_force_color_execute(self):
1950.         out = StringIO()
1951.         err = StringIO()
1952.         with mock.patch.object(sys.stdout, "isatty", lambda: False):
1953.             command = ColorCommand(stdout=out, stderr=err)
1954.             call_command(command, force_color=True)
1955.         self.assertEqual(out.getvalue(), "\x1b[31;1mHello, world!\n\x1b[0m")
1956.         self.assertEqual(err.getvalue(), "\x1b[31;1mHello, world!\n\x1b[0m")
1957. 
1958.     def test_force_color_command_init(self):
1959.         out = StringIO()
1960.         err = StringIO()
1961.         with mock.patch.object(sys.stdout, "isatty", lambda: False):
1962.             command = ColorCommand(stdout=out, stderr=err, force_color=True)
1963.             call_command(command)
1964.         self.assertEqual(out.getvalue(), "\x1b[31;1mHello, world!\n\x1b[0m")
1965.         self.assertEqual(err.getvalue(), "\x1b[31;1mHello, world!\n\x1b[0m")
1966. 
1967.     def test_no_color_force_color_mutually_exclusive_execute(self):
1968.         msg = "The --no-color and --force-color options can't be used together."
1969.         with self.assertRaisesMessage(CommandError, msg):
1970.             call_command(BaseCommand(), no_color=True, force_color=True)
1971. 
1972.     def test_no_color_force_color_mutually_exclusive_command_init(self):
1973.         msg = "'no_color' and 'force_color' can't be used together."
1974.         with self.assertRaisesMessage(CommandError, msg):
1975.             call_command(BaseCommand(no_color=True, force_color=True))
1976. 
1977.     def test_custom_stdout(self):
1978.         class Command(BaseCommand):
1979.             requires_system_checks = []
1980. 
1981.             def handle(self, *args, **options):
1982.                 self.stdout.write("Hello, World!")
1983. 
1984.         out = StringIO()
1985.         command = Command(stdout=out)
1986.         call_command(command)
1987.         self.assertEqual(out.getvalue(), "Hello, World!\n")
1988.         out.truncate(0)
1989.         new_out = StringIO()
1990.         call_command(command, stdout=new_out)
1991.         self.assertEqual(out.getvalue(), "")
1992.         self.assertEqual(new_out.getvalue(), "Hello, World!\n")
1993. 
1994.     def test_custom_stderr(self):
1995.         class Command(BaseCommand):
1996.             requires_system_checks = []
1997. 
1998.             def handle(self, *args, **options):
1999.                 self.stderr.write("Hello, World!")
2000. 
2001.         err = StringIO()
2002.         command = Command(stderr=err)
2003.         call_command(command)
2004.         self.assertEqual(err.getvalue(), "Hello, World!\n")
2005.         err.truncate(0)
2006.         new_err = StringIO()
2007.         call_command(command, stderr=new_err)
2008.         self.assertEqual(err.getvalue(), "")
2009.         self.assertEqual(new_err.getvalue(), "Hello, World!\n")
2010. 
2011.     def test_base_command(self):
2012.         "User BaseCommands can execute when a label is provided"
2013.         args = ["base_command", "testlabel"]
2014.         expected_labels = "('testlabel',)"
2015.         self._test_base_command(args, expected_labels)
2016. 
2017.     def test_base_command_no_label(self):
2018.         "User BaseCommands can execute when no labels are provided"
2019.         args = ["base_command"]
2020.         expected_labels = "()"
2021.         self._test_base_command(args, expected_labels)
2022. 
2023.     def test_base_command_multiple_label(self):
2024.         "User BaseCommands can execute when no labels are provided"
2025.         args = ["base_command", "testlabel", "anotherlabel"]
2026.         expected_labels = "('testlabel', 'anotherlabel')"
2027.         self._test_base_command(args, expected_labels)
2028. 
2029.     def test_base_command_with_option(self):
2030.         "User BaseCommands can execute with options when a label is provided"
2031.         args = ["base_command", "testlabel", "--option_a=x"]
2032.         expected_labels = "('testlabel',)"
2033.         self._test_base_command(args, expected_labels, option_a="'x'")
2034. 
2035.     def test_base_command_with_options(self):
2036.         "User BaseCommands can execute with multiple options when a label is provided"
2037.         args = ["base_command", "testlabel", "-a", "x", "--option_b=y"]
2038.         expected_labels = "('testlabel',)"
2039.         self._test_base_command(args, expected_labels, option_a="'x'", option_b="'y'")
2040. 
2041.     def test_base_command_with_wrong_option(self):
2042.         "User BaseCommands outputs command usage when wrong option is specified"
2043.         args = ["base_command", "--invalid"]
2044.         out, err = self.run_manage(args)
2045.         self.assertNoOutput(out)
2046.         self.assertOutput(err, "usage: manage.py base_command")
2047.         self.assertOutput(err, "error: unrecognized arguments: --invalid")
2048. 
2049.     def _test_base_command(self, args, labels, option_a="'1'", option_b="'2'"):
2050.         out, err = self.run_manage(args)
2051. 
2052.         expected_out = (
2053.             "EXECUTE:BaseCommand labels=%s, "
2054.             "options=[('force_color', False), ('no_color', False), "
2055.             "('option_a', %s), ('option_b', %s), ('option_c', '3'), "
2056.             "('pythonpath', None), ('settings', None), ('traceback', False), "
2057.             "('verbosity', 1)]"
2058.         ) % (labels, option_a, option_b)
2059.         self.assertNoOutput(err)
2060.         self.assertOutput(out, expected_out)
2061. 
2062.     def test_base_run_from_argv(self):
2063.         """
2064.         Test run_from_argv properly terminates even with custom execute() (#19665)
2065.         Also test proper traceback display.
2066.         """
2067.         err = StringIO()
2068.         command = BaseCommand(stderr=err)
2069. 
2070.         def raise_command_error(*args, **kwargs):
2071.             raise CommandError("Custom error")
2072. 
2073.         command.execute = lambda args: args  # This will trigger TypeError
2074. 
2075.         # If the Exception is not CommandError it should always
2076.         # raise the original exception.
2077.         with self.assertRaises(TypeError):
2078.             command.run_from_argv(["", ""])
2079. 
2080.         # If the Exception is CommandError and --traceback is not present
2081.         # this command should raise a SystemExit and don't print any
2082.         # traceback to the stderr.
2083.         command.execute = raise_command_error
2084.         err.truncate(0)
2085.         with self.assertRaises(SystemExit):
2086.             command.run_from_argv(["", ""])
2087.         err_message = err.getvalue()
2088.         self.assertNotIn("Traceback", err_message)
2089.         self.assertIn("CommandError", err_message)
2090. 
2091.         # If the Exception is CommandError and --traceback is present
2092.         # this command should raise the original CommandError as if it
2093.         # were not a CommandError.
2094.         err.truncate(0)
2095.         with self.assertRaises(CommandError):
2096.             command.run_from_argv(["", "", "--traceback"])
2097. 
2098.     def test_run_from_argv_non_ascii_error(self):
2099.         """
2100.         Non-ASCII message of CommandError does not raise any
2101.         UnicodeDecodeError in run_from_argv.
2102.         """
2103. 
2104.         def raise_command_error(*args, **kwargs):
2105.             raise CommandError("Erreur personnalisée")
2106. 
2107.         command = BaseCommand(stderr=StringIO())
2108.         command.execute = raise_command_error
2109. 
2110.         with self.assertRaises(SystemExit):
2111.             command.run_from_argv(["", ""])
2112. 
2113.     def test_run_from_argv_closes_connections(self):
2114.         """
2115.         A command called from the command line should close connections after
2116.         being executed (#21255).
2117.         """
2118.         command = BaseCommand()
2119.         command.check = lambda: []
2120.         command.handle = lambda *args, **kwargs: args
2121.         with mock.patch("django.core.management.base.connections") as mock_connections:
2122.             command.run_from_argv(["", ""])
2123.         # Test connections have been closed
2124.         self.assertTrue(mock_connections.close_all.called)
2125. 
2126.     def test_noargs(self):
2127.         "NoArg Commands can be executed"
2128.         args = ["noargs_command"]
2129.         out, err = self.run_manage(args)
2130.         self.assertNoOutput(err)
2131.         self.assertOutput(
2132.             out,
2133.             "EXECUTE: noargs_command options=[('force_color', False), "
2134.             "('no_color', False), ('pythonpath', None), ('settings', None), "
2135.             "('traceback', False), ('verbosity', 1)]",
2136.         )
2137. 
2138.     def test_noargs_with_args(self):
2139.         "NoArg Commands raise an error if an argument is provided"
2140.         args = ["noargs_command", "argument"]
2141.         out, err = self.run_manage(args)
2142.         self.assertOutput(err, "error: unrecognized arguments: argument")
2143. 
2144.     def test_app_command(self):
2145.         "User AppCommands can execute when a single app name is provided"
2146.         args = ["app_command", "auth"]
2147.         out, err = self.run_manage(args)
2148.         self.assertNoOutput(err)
2149.         self.assertOutput(out, "EXECUTE:AppCommand name=django.contrib.auth, options=")
2150.         self.assertOutput(
2151.             out,
2152.             ", options=[('force_color', False), ('no_color', False), "
2153.             "('pythonpath', None), ('settings', None), ('traceback', False), "
2154.             "('verbosity', 1)]",
2155.         )
2156. 
2157.     def test_app_command_no_apps(self):
2158.         "User AppCommands raise an error when no app name is provided"
2159.         args = ["app_command"]
2160.         out, err = self.run_manage(args)
2161.         self.assertOutput(err, "error: Enter at least one application label.")
2162. 
2163.     def test_app_command_multiple_apps(self):
2164.         "User AppCommands raise an error when multiple app names are provided"
2165.         args = ["app_command", "auth", "contenttypes"]
2166.         out, err = self.run_manage(args)
2167.         self.assertNoOutput(err)
2168.         self.assertOutput(out, "EXECUTE:AppCommand name=django.contrib.auth, options=")
2169.         self.assertOutput(
2170.             out,
2171.             ", options=[('force_color', False), ('no_color', False), "
2172.             "('pythonpath', None), ('settings', None), ('traceback', False), "
2173.             "('verbosity', 1)]",
2174.         )
2175.         self.assertOutput(
2176.             out, "EXECUTE:AppCommand name=django.contrib.contenttypes, options="
2177.         )
2178.         self.assertOutput(
2179.             out,
2180.             ", options=[('force_color', False), ('no_color', False), "
2181.             "('pythonpath', None), ('settings', None), ('traceback', False), "
2182.             "('verbosity', 1)]",
2183.         )
2184. 
2185.     def test_app_command_invalid_app_label(self):
2186.         "User AppCommands can execute when a single app name is provided"
2187.         args = ["app_command", "NOT_AN_APP"]
2188.         out, err = self.run_manage(args)
2189.         self.assertOutput(err, "No installed app with label 'NOT_AN_APP'.")
2190. 
2191.     def test_app_command_some_invalid_app_labels(self):
2192.         "User AppCommands can execute when some of the provided app names are invalid"
2193.         args = ["app_command", "auth", "NOT_AN_APP"]
2194.         out, err = self.run_manage(args)
2195.         self.assertOutput(err, "No installed app with label 'NOT_AN_APP'.")
2196. 
2197.     def test_label_command(self):
2198.         "User LabelCommands can execute when a label is provided"
2199.         args = ["label_command", "testlabel"]
2200.         out, err = self.run_manage(args)
2201.         self.assertNoOutput(err)
2202.         self.assertOutput(
2203.             out,
2204.             "EXECUTE:LabelCommand label=testlabel, options=[('force_color', "
2205.             "False), ('no_color', False), ('pythonpath', None), ('settings', "
2206.             "None), ('traceback', False), ('verbosity', 1)]",
2207.         )
2208. 
2209.     def test_label_command_no_label(self):
2210.         "User LabelCommands raise an error if no label is provided"
2211.         args = ["label_command"]
2212.         out, err = self.run_manage(args)
2213.         self.assertOutput(err, "Enter at least one label")
2214. 
2215.     def test_label_command_multiple_label(self):
2216.         "User LabelCommands are executed multiple times if multiple labels are provided"
2217.         args = ["label_command", "testlabel", "anotherlabel"]
2218.         out, err = self.run_manage(args)
2219.         self.assertNoOutput(err)
2220.         self.assertOutput(
2221.             out,
2222.             "EXECUTE:LabelCommand label=testlabel, options=[('force_color', "
2223.             "False), ('no_color', False), ('pythonpath', None), "
2224.             "('settings', None), ('traceback', False), ('verbosity', 1)]",
2225.         )
2226.         self.assertOutput(
2227.             out,
2228.             "EXECUTE:LabelCommand label=anotherlabel, options=[('force_color', "
2229.             "False), ('no_color', False), ('pythonpath', None), "
2230.             "('settings', None), ('traceback', False), ('verbosity', 1)]",
2231.         )
2232. 
2233.     def test_suppress_base_options_command_help(self):
2234.         args = ["suppress_base_options_command", "--help"]
2235.         out, err = self.run_manage(args)
2236.         self.assertNoOutput(err)
2237.         self.assertOutput(out, "Test suppress base options command.")
2238.         self.assertNotInOutput(out, "input file")
2239.         self.assertOutput(out, "-h, --help")
2240.         self.assertNotInOutput(out, "--version")
2241.         self.assertNotInOutput(out, "--verbosity")
2242.         self.assertNotInOutput(out, "-v {0,1,2,3}")
2243.         self.assertNotInOutput(out, "--settings")
2244.         self.assertNotInOutput(out, "--pythonpath")
2245.         self.assertNotInOutput(out, "--traceback")
2246.         self.assertNotInOutput(out, "--no-color")
2247.         self.assertNotInOutput(out, "--force-color")
2248. 
2249.     def test_suppress_base_options_command_defaults(self):
2250.         args = ["suppress_base_options_command"]
2251.         out, err = self.run_manage(args)
2252.         self.assertNoOutput(err)
2253.         self.assertOutput(
2254.             out,
2255.             "EXECUTE:SuppressBaseOptionsCommand options=[('file', None), "
2256.             "('force_color', False), ('no_color', False), "
2257.             "('pythonpath', None), ('settings', None), "
2258.             "('traceback', False), ('verbosity', 1)]",
2259.         )
2260. 
2261. 
2262. class Discovery(SimpleTestCase):
2263.     def test_precedence(self):
2264.         """
2265.         Apps listed first in INSTALLED_APPS have precedence.
2266.         """
2267.         with self.settings(
2268.             INSTALLED_APPS=[
2269.                 "admin_scripts.complex_app",
2270.                 "admin_scripts.simple_app",
2271.                 "django.contrib.auth",
2272.                 "django.contrib.contenttypes",
2273.             ]
2274.         ):
2275.             out = StringIO()
2276.             call_command("duplicate", stdout=out)
2277.             self.assertEqual(out.getvalue().strip(), "complex_app")
2278.         with self.settings(
2279.             INSTALLED_APPS=[
2280.                 "admin_scripts.simple_app",
2281.                 "admin_scripts.complex_app",
2282.                 "django.contrib.auth",
2283.                 "django.contrib.contenttypes",
2284.             ]
2285.         ):
2286.             out = StringIO()
2287.             call_command("duplicate", stdout=out)
2288.             self.assertEqual(out.getvalue().strip(), "simple_app")
2289. 
2290. 
2291. class ArgumentOrder(AdminScriptTestCase):
2292.     """Tests for 2-stage argument parsing scheme.
2293. 
2294.     django-admin command arguments are parsed in 2 parts; the core arguments
2295.     (--settings, --traceback and --pythonpath) are parsed using a basic parser,
2296.     ignoring any unknown options. Then the full settings are
2297.     passed to the command parser, which extracts commands of interest to the
2298.     individual command.
2299.     """
2300. 
2301.     def setUp(self):
2302.         super().setUp()
2303.         self.write_settings(
2304.             "settings.py", apps=["django.contrib.auth", "django.contrib.contenttypes"]
2305.         )
2306.         self.write_settings("alternate_settings.py")
2307. 
2308.     def test_setting_then_option(self):
2309.         """Options passed after settings are correctly handled."""
2310.         args = [
2311.             "base_command",
2312.             "testlabel",
2313.             "--settings=alternate_settings",
2314.             "--option_a=x",
2315.         ]
2316.         self._test(args)
2317. 
2318.     def test_setting_then_short_option(self):
2319.         """Short options passed after settings are correctly handled."""
2320.         args = ["base_command", "testlabel", "--settings=alternate_settings", "-a", "x"]
2321.         self._test(args)
2322. 
2323.     def test_option_then_setting(self):
2324.         """Options passed before settings are correctly handled."""
2325.         args = [
2326.             "base_command",
2327.             "testlabel",
2328.             "--option_a=x",
2329.             "--settings=alternate_settings",
2330.         ]
2331.         self._test(args)
2332. 
2333.     def test_short_option_then_setting(self):
2334.         """Short options passed before settings are correctly handled."""
2335.         args = ["base_command", "testlabel", "-a", "x", "--settings=alternate_settings"]
2336.         self._test(args)
2337. 
2338.     def test_option_then_setting_then_option(self):
2339.         """Options are correctly handled when they are passed before and after
2340.         a setting."""
2341.         args = [
2342.             "base_command",
2343.             "testlabel",
2344.             "--option_a=x",
2345.             "--settings=alternate_settings",
2346.             "--option_b=y",
2347.         ]
2348.         self._test(args, option_b="'y'")
2349. 
2350.     def _test(self, args, option_b="'2'"):
2351.         out, err = self.run_manage(args)
2352.         self.assertNoOutput(err)
2353.         self.assertOutput(
2354.             out,
2355.             "EXECUTE:BaseCommand labels=('testlabel',), options=["
2356.             "('force_color', False), ('no_color', False), ('option_a', 'x'), "
2357.             "('option_b', %s), ('option_c', '3'), ('pythonpath', None), "
2358.             "('settings', 'alternate_settings'), ('traceback', False), "
2359.             "('verbosity', 1)]" % option_b,
2360.         )
2361. 
2362. 
2363. class ExecuteFromCommandLine(SimpleTestCase):
2364.     def test_program_name_from_argv(self):
2365.         """
2366.         Program name is computed from the execute_from_command_line()'s argv
2367.         argument, not sys.argv.
2368.         """
2369.         args = ["help", "shell"]
2370.         with captured_stdout() as out, captured_stderr() as err:
2371.             with mock.patch("sys.argv", [None] + args):
2372.                 execute_from_command_line(["django-admin"] + args)
2373.         self.assertIn("usage: django-admin shell", out.getvalue())
2374.         self.assertEqual(err.getvalue(), "")
2375. 
2376. 
2377. @override_settings(ROOT_URLCONF="admin_scripts.urls")
2378. class StartProject(LiveServerTestCase, AdminScriptTestCase):
2379.     available_apps = [
2380.         "admin_scripts",
2381.         "django.contrib.auth",
2382.         "django.contrib.contenttypes",
2383.         "django.contrib.sessions",
2384.     ]
2385. 
2386.     def test_wrong_args(self):
2387.         """
2388.         Passing the wrong kinds of arguments outputs an error and prints usage.
2389.         """
2390.         out, err = self.run_django_admin(["startproject"])
2391.         self.assertNoOutput(out)
2392.         self.assertOutput(err, "usage:")
2393.         self.assertOutput(err, "You must provide a project name.")
2394. 
2395.     def test_simple_project(self):
2396.         "Make sure the startproject management command creates a project"
2397.         args = ["startproject", "testproject"]
2398.         testproject_dir = os.path.join(self.test_dir, "testproject")
2399. 
2400.         out, err = self.run_django_admin(args)
2401.         self.assertNoOutput(err)
2402.         self.assertTrue(os.path.isdir(testproject_dir))
2403. 
2404.         # running again..
2405.         out, err = self.run_django_admin(args)
2406.         self.assertNoOutput(out)
2407.         self.assertOutput(
2408.             err,
2409.             "CommandError: 'testproject' conflicts with the name of an "
2410.             "existing Python module and cannot be used as a project name. "
2411.             "Please try another name.",
2412.         )
2413. 
2414.     def test_invalid_project_name(self):
2415.         "Make sure the startproject management command validates a project name"
2416.         for bad_name in ("7testproject", "../testproject"):
2417.             with self.subTest(project_name=bad_name):
2418.                 args = ["startproject", bad_name]
2419.                 testproject_dir = os.path.join(self.test_dir, bad_name)
2420. 
2421.                 out, err = self.run_django_admin(args)
2422.                 self.assertOutput(
2423.                     err,
2424.                     "Error: '%s' is not a valid project name. Please make "
2425.                     "sure the name is a valid identifier." % bad_name,
2426.                 )
2427.                 self.assertFalse(os.path.exists(testproject_dir))
2428. 
2429.     def test_importable_project_name(self):
2430.         """
2431.         startproject validates that project name doesn't clash with existing
2432.         Python modules.
2433.         """
2434.         bad_name = "os"
2435.         args = ["startproject", bad_name]
2436.         testproject_dir = os.path.join(self.test_dir, bad_name)
2437. 
2438.         out, err = self.run_django_admin(args)
2439.         self.assertOutput(
2440.             err,
2441.             "CommandError: 'os' conflicts with the name of an existing "
2442.             "Python module and cannot be used as a project name. Please try "
2443.             "another name.",
2444.         )
2445.         self.assertFalse(os.path.exists(testproject_dir))
2446. 
2447.     def test_simple_project_different_directory(self):
2448.         """
2449.         The startproject management command creates a project in a specific
2450.         directory.
2451.         """
2452.         args = ["startproject", "testproject", "othertestproject"]
2453.         testproject_dir = os.path.join(self.test_dir, "othertestproject")
2454.         os.mkdir(testproject_dir)
2455. 
2456.         out, err = self.run_django_admin(args)
2457.         self.assertNoOutput(err)
2458.         self.assertTrue(os.path.exists(os.path.join(testproject_dir, "manage.py")))
2459. 
2460.         # running again..
2461.         out, err = self.run_django_admin(args)
2462.         self.assertNoOutput(out)
2463.         self.assertOutput(
2464.             err,
2465.             "already exists. Overlaying a project into an existing directory "
2466.             "won't replace conflicting files.",
2467.         )
2468. 
2469.     def test_custom_project_template(self):
2470.         """
2471.         The startproject management command is able to use a different project
2472.         template.
2473.         """
2474.         template_path = os.path.join(custom_templates_dir, "project_template")
2475.         args = ["startproject", "--template", template_path, "customtestproject"]
2476.         testproject_dir = os.path.join(self.test_dir, "customtestproject")
2477. 
2478.         out, err = self.run_django_admin(args)
2479.         self.assertNoOutput(err)
2480.         self.assertTrue(os.path.isdir(testproject_dir))
2481.         self.assertTrue(os.path.exists(os.path.join(testproject_dir, "additional_dir")))
2482. 
2483.     def test_custom_project_template_non_python_files_not_formatted(self):
2484.         template_path = os.path.join(custom_templates_dir, "project_template")
2485.         args = ["startproject", "--template", template_path, "customtestproject"]
2486.         testproject_dir = os.path.join(self.test_dir, "customtestproject")
2487. 
2488.         _, err = self.run_django_admin(args)
2489.         self.assertNoOutput(err)
2490.         with open(
2491.             os.path.join(template_path, "additional_dir", "requirements.in")
2492.         ) as f:
2493.             expected = f.read()
2494.         with open(
2495.             os.path.join(testproject_dir, "additional_dir", "requirements.in")
2496.         ) as f:
2497.             result = f.read()
2498.         self.assertEqual(expected, result)
2499. 
2500.     def test_template_dir_with_trailing_slash(self):
2501.         "Ticket 17475: Template dir passed has a trailing path separator"
2502.         template_path = os.path.join(custom_templates_dir, "project_template" + os.sep)
2503.         args = ["startproject", "--template", template_path, "customtestproject"]
2504.         testproject_dir = os.path.join(self.test_dir, "customtestproject")
2505. 
2506.         out, err = self.run_django_admin(args)
2507.         self.assertNoOutput(err)
2508.         self.assertTrue(os.path.isdir(testproject_dir))
2509.         self.assertTrue(os.path.exists(os.path.join(testproject_dir, "additional_dir")))
2510. 
2511.     def test_custom_project_template_from_tarball_by_path(self):
2512.         """
2513.         The startproject management command is able to use a different project
2514.         template from a tarball.
2515.         """
2516.         template_path = os.path.join(custom_templates_dir, "project_template.tgz")
2517.         args = ["startproject", "--template", template_path, "tarballtestproject"]
2518.         testproject_dir = os.path.join(self.test_dir, "tarballtestproject")
2519. 
2520.         out, err = self.run_django_admin(args)
2521.         self.assertNoOutput(err)
2522.         self.assertTrue(os.path.isdir(testproject_dir))
2523.         self.assertTrue(os.path.exists(os.path.join(testproject_dir, "run.py")))
2524. 
2525.     def test_custom_project_template_from_tarball_to_alternative_location(self):
2526.         """
2527.         Startproject can use a project template from a tarball and create it in
2528.         a specified location.
2529.         """
2530.         template_path = os.path.join(custom_templates_dir, "project_template.tgz")
2531.         args = [
2532.             "startproject",
2533.             "--template",
2534.             template_path,
2535.             "tarballtestproject",
2536.             "altlocation",
2537.         ]
2538.         testproject_dir = os.path.join(self.test_dir, "altlocation")
2539.         os.mkdir(testproject_dir)
2540. 
2541.         out, err = self.run_django_admin(args)
2542.         self.assertNoOutput(err)
2543.         self.assertTrue(os.path.isdir(testproject_dir))
2544.         self.assertTrue(os.path.exists(os.path.join(testproject_dir, "run.py")))
2545. 
2546.     def test_custom_project_template_from_tarball_by_url(self):
2547.         """
2548.         The startproject management command is able to use a different project
2549.         template from a tarball via a URL.
2550.         """
2551.         template_url = "%s/custom_templates/project_template.tgz" % self.live_server_url
2552. 
2553.         args = ["startproject", "--template", template_url, "urltestproject"]
2554.         testproject_dir = os.path.join(self.test_dir, "urltestproject")
2555. 
2556.         out, err = self.run_django_admin(args)
2557.         self.assertNoOutput(err)
2558.         self.assertTrue(os.path.isdir(testproject_dir))
2559.         self.assertTrue(os.path.exists(os.path.join(testproject_dir, "run.py")))
2560. 
2561.     def test_custom_project_template_from_tarball_by_url_django_user_agent(self):
2562.         user_agent = None
2563. 
2564.         def serve_template(request, *args, **kwargs):
2565.             nonlocal user_agent
2566.             user_agent = request.headers["User-Agent"]
2567.             return serve(request, *args, **kwargs)
2568. 
2569.         old_urlpatterns = urls.urlpatterns[:]
2570.         try:
2571.             urls.urlpatterns += [
2572.                 path(
2573.                     "user_agent_check/<path:path>",
2574.                     serve_template,
2575.                     {"document_root": os.path.join(urls.here, "custom_templates")},
2576.                 ),
2577.             ]
2578. 
2579.             template_url = (
2580.                 f"{self.live_server_url}/user_agent_check/project_template.tgz"
2581.             )
2582.             args = ["startproject", "--template", template_url, "urltestproject"]
2583.             _, err = self.run_django_admin(args)
2584. 
2585.             self.assertNoOutput(err)
2586.             self.assertIn("Django/%s" % get_version(), user_agent)
2587.         finally:
2588.             urls.urlpatterns = old_urlpatterns
2589. 
2590.     def test_project_template_tarball_url(self):
2591.         """ "
2592.         Startproject management command handles project template tar/zip balls
2593.         from non-canonical urls.
2594.         """
2595.         template_url = (
2596.             "%s/custom_templates/project_template.tgz/" % self.live_server_url
2597.         )
2598. 
2599.         args = ["startproject", "--template", template_url, "urltestproject"]
2600.         testproject_dir = os.path.join(self.test_dir, "urltestproject")
2601. 
2602.         out, err = self.run_django_admin(args)
2603.         self.assertNoOutput(err)
2604.         self.assertTrue(os.path.isdir(testproject_dir))
2605.         self.assertTrue(os.path.exists(os.path.join(testproject_dir, "run.py")))
2606. 
2607.     def test_file_without_extension(self):
2608.         "Make sure the startproject management command is able to render custom files"
2609.         template_path = os.path.join(custom_templates_dir, "project_template")
2610.         args = [
2611.             "startproject",
2612.             "--template",
2613.             template_path,
2614.             "customtestproject",
2615.             "-e",
2616.             "txt",
2617.             "-n",
2618.             "Procfile",
2619.         ]
2620.         testproject_dir = os.path.join(self.test_dir, "customtestproject")
2621. 
2622.         out, err = self.run_django_admin(args)
2623.         self.assertNoOutput(err)
2624.         self.assertTrue(os.path.isdir(testproject_dir))
2625.         self.assertTrue(os.path.exists(os.path.join(testproject_dir, "additional_dir")))
2626.         base_path = os.path.join(testproject_dir, "additional_dir")
2627.         for f in ("Procfile", "additional_file.py", "requirements.txt"):
2628.             self.assertTrue(os.path.exists(os.path.join(base_path, f)))
2629.             with open(os.path.join(base_path, f)) as fh:
2630.                 self.assertEqual(
2631.                     fh.read().strip(), "# some file for customtestproject test project"
2632.                 )
2633. 
2634.     def test_custom_project_template_context_variables(self):
2635.         "Make sure template context variables are rendered with proper values"
2636.         template_path = os.path.join(custom_templates_dir, "project_template")
2637.         args = [
2638.             "startproject",
2639.             "--template",
2640.             template_path,
2641.             "another_project",
2642.             "project_dir",
2643.         ]
2644.         testproject_dir = os.path.join(self.test_dir, "project_dir")
2645.         os.mkdir(testproject_dir)
2646.         out, err = self.run_django_admin(args)
2647.         self.assertNoOutput(err)
2648.         test_manage_py = os.path.join(testproject_dir, "manage.py")
2649.         with open(test_manage_py) as fp:
2650.             content = fp.read()
2651.             self.assertIn('project_name = "another_project"', content)
2652.             self.assertIn('project_directory = "%s"' % testproject_dir, content)
2653. 
2654.     def test_no_escaping_of_project_variables(self):
2655.         "Make sure template context variables are not html escaped"
2656.         # We're using a custom command so we need the alternate settings
2657.         self.write_settings("alternate_settings.py")
2658.         template_path = os.path.join(custom_templates_dir, "project_template")
2659.         args = [
2660.             "custom_startproject",
2661.             "--template",
2662.             template_path,
2663.             "another_project",
2664.             "project_dir",
2665.             "--extra",
2666.             "<&>",
2667.             "--settings=alternate_settings",
2668.         ]
2669.         testproject_dir = os.path.join(self.test_dir, "project_dir")
2670.         os.mkdir(testproject_dir)
2671.         out, err = self.run_manage(args)
2672.         self.assertNoOutput(err)
2673.         test_manage_py = os.path.join(testproject_dir, "additional_dir", "extra.py")
2674.         with open(test_manage_py) as fp:
2675.             content = fp.read()
2676.             self.assertIn("<&>", content)
2677. 
2678.     def test_custom_project_destination_missing(self):
2679.         """
2680.         Make sure an exception is raised when the provided
2681.         destination directory doesn't exist
2682.         """
2683.         template_path = os.path.join(custom_templates_dir, "project_template")
2684.         args = [
2685.             "startproject",
2686.             "--template",
2687.             template_path,
2688.             "yet_another_project",
2689.             "project_dir2",
2690.         ]
2691.         testproject_dir = os.path.join(self.test_dir, "project_dir2")
2692.         out, err = self.run_django_admin(args)
2693.         self.assertNoOutput(out)
2694.         self.assertOutput(
2695.             err,
2696.             "Destination directory '%s' does not exist, please create it first."
2697.             % testproject_dir,
2698.         )
2699.         self.assertFalse(os.path.exists(testproject_dir))
2700. 
2701.     def test_custom_project_template_with_non_ascii_templates(self):
2702.         """
2703.         The startproject management command is able to render templates with
2704.         non-ASCII content.
2705.         """
2706.         template_path = os.path.join(custom_templates_dir, "project_template")
2707.         args = [
2708.             "startproject",
2709.             "--template",
2710.             template_path,
2711.             "--extension=txt",
2712.             "customtestproject",
2713.         ]
2714.         testproject_dir = os.path.join(self.test_dir, "customtestproject")
2715. 
2716.         out, err = self.run_django_admin(args)
2717.         self.assertNoOutput(err)
2718.         self.assertTrue(os.path.isdir(testproject_dir))
2719.         path = os.path.join(testproject_dir, "ticket-18091-non-ascii-template.txt")
2720.         with open(path, encoding="utf-8") as f:
2721.             self.assertEqual(
2722.                 f.read().splitlines(False),
2723.                 ["Some non-ASCII text for testing ticket #18091:", "üäö €"],
2724.             )
2725. 
2726.     def test_custom_project_template_hidden_directory_default_excluded(self):
2727.         """Hidden directories are excluded by default."""
2728.         template_path = os.path.join(custom_templates_dir, "project_template")
2729.         args = [
2730.             "startproject",
2731.             "--template",
2732.             template_path,
2733.             "custom_project_template_hidden_directories",
2734.             "project_dir",
2735.         ]
2736.         testproject_dir = os.path.join(self.test_dir, "project_dir")
2737.         os.mkdir(testproject_dir)
2738. 
2739.         _, err = self.run_django_admin(args)
2740.         self.assertNoOutput(err)
2741.         hidden_dir = os.path.join(testproject_dir, ".hidden")
2742.         self.assertIs(os.path.exists(hidden_dir), False)
2743. 
2744.     def test_custom_project_template_hidden_directory_included(self):
2745.         """
2746.         Template context variables in hidden directories are rendered, if not
2747.         excluded.
2748.         """
2749.         template_path = os.path.join(custom_templates_dir, "project_template")
2750.         project_name = "custom_project_template_hidden_directories_included"
2751.         args = [
2752.             "startproject",
2753.             "--template",
2754.             template_path,
2755.             project_name,
2756.             "project_dir",
2757.             "--exclude",
2758.         ]
2759.         testproject_dir = os.path.join(self.test_dir, "project_dir")
2760.         os.mkdir(testproject_dir)
2761. 
2762.         _, err = self.run_django_admin(args)
2763.         self.assertNoOutput(err)
2764.         render_py_path = os.path.join(testproject_dir, ".hidden", "render.py")
2765.         with open(render_py_path) as fp:
2766.             self.assertIn(
2767.                 f"# The {project_name} should be rendered.",
2768.                 fp.read(),
2769.             )
2770. 
2771.     def test_custom_project_template_exclude_directory(self):
2772.         """
2773.         Excluded directories (in addition to .git and __pycache__) are not
2774.         included in the project.
2775.         """
2776.         template_path = os.path.join(custom_templates_dir, "project_template")
2777.         project_name = "custom_project_with_excluded_directories"
2778.         args = [
2779.             "startproject",
2780.             "--template",
2781.             template_path,
2782.             project_name,
2783.             "project_dir",
2784.             "--exclude",
2785.             "additional_dir",
2786.             "-x",
2787.             ".hidden",
2788.         ]
2789.         testproject_dir = os.path.join(self.test_dir, "project_dir")
2790.         os.mkdir(testproject_dir)
2791. 
2792.         _, err = self.run_django_admin(args)
2793.         self.assertNoOutput(err)
2794.         excluded_directories = [
2795.             ".hidden",
2796.             "additional_dir",
2797.             ".git",
2798.             "__pycache__",
2799.         ]
2800.         for directory in excluded_directories:
2801.             self.assertIs(
2802.                 os.path.exists(os.path.join(testproject_dir, directory)),
2803.                 False,
2804.             )
2805.         not_excluded = os.path.join(testproject_dir, project_name)
2806.         self.assertIs(os.path.exists(not_excluded), True)
2807. 
2808.     @unittest.skipIf(
2809.         sys.platform == "win32",
2810.         "Windows only partially supports umasks and chmod.",
2811.     )
2812.     def test_honor_umask(self):
2813.         _, err = self.run_django_admin(["startproject", "testproject"], umask=0o077)
2814.         self.assertNoOutput(err)
2815.         testproject_dir = os.path.join(self.test_dir, "testproject")
2816.         self.assertIs(os.path.isdir(testproject_dir), True)
2817.         tests = [
2818.             (["manage.py"], 0o700),
2819.             (["testproject"], 0o700),
2820.             (["testproject", "settings.py"], 0o600),
2821.         ]
2822.         for paths, expected_mode in tests:
2823.             file_path = os.path.join(testproject_dir, *paths)
2824.             with self.subTest(paths[-1]):
2825.                 self.assertEqual(
2826.                     stat.S_IMODE(os.stat(file_path).st_mode),
2827.                     expected_mode,
2828.                 )
2829. 
2830. 
2831. class StartApp(AdminScriptTestCase):
2832.     def test_invalid_name(self):
2833.         """startapp validates that app name is a valid Python identifier."""
2834.         for bad_name in ("7testproject", "../testproject"):
2835.             with self.subTest(app_name=bad_name):
2836.                 args = ["startapp", bad_name]
2837.                 testproject_dir = os.path.join(self.test_dir, bad_name)
2838. 
2839.                 out, err = self.run_django_admin(args)
2840.                 self.assertOutput(
2841.                     err,
2842.                     "CommandError: '{}' is not a valid app name. Please make "
2843.                     "sure the name is a valid identifier.".format(bad_name),
2844.                 )
2845.                 self.assertFalse(os.path.exists(testproject_dir))
2846. 
2847.     def test_importable_name(self):
2848.         """
2849.         startapp validates that app name doesn't clash with existing Python
2850.         modules.
2851.         """
2852.         bad_name = "os"
2853.         args = ["startapp", bad_name]
2854.         testproject_dir = os.path.join(self.test_dir, bad_name)
2855. 
2856.         out, err = self.run_django_admin(args)
2857.         self.assertOutput(
2858.             err,
2859.             "CommandError: 'os' conflicts with the name of an existing "
2860.             "Python module and cannot be used as an app name. Please try "
2861.             "another name.",
2862.         )
2863.         self.assertFalse(os.path.exists(testproject_dir))
2864. 
2865.     def test_invalid_target_name(self):
2866.         for bad_target in (
2867.             "invalid.dir_name",
2868.             "7invalid_dir_name",
2869.             ".invalid_dir_name",
2870.         ):
2871.             with self.subTest(bad_target):
2872.                 _, err = self.run_django_admin(["startapp", "app", bad_target])
2873.                 self.assertOutput(
2874.                     err,
2875.                     "CommandError: '%s' is not a valid app directory. Please "
2876.                     "make sure the directory is a valid identifier." % bad_target,
2877.                 )
2878. 
2879.     def test_importable_target_name(self):
2880.         _, err = self.run_django_admin(["startapp", "app", "os"])
2881.         self.assertOutput(
2882.             err,
2883.             "CommandError: 'os' conflicts with the name of an existing Python "
2884.             "module and cannot be used as an app directory. Please try "
2885.             "another directory.",
2886.         )
2887. 
2888.     def test_trailing_slash_in_target_app_directory_name(self):
2889.         app_dir = os.path.join(self.test_dir, "apps", "app1")
2890.         os.makedirs(app_dir)
2891.         _, err = self.run_django_admin(
2892.             ["startapp", "app", os.path.join("apps", "app1", "")]
2893.         )
2894.         self.assertNoOutput(err)
2895.         self.assertIs(os.path.exists(os.path.join(app_dir, "apps.py")), True)
2896. 
2897.     def test_overlaying_app(self):
2898.         # Use a subdirectory so it is outside the PYTHONPATH.
2899.         os.makedirs(os.path.join(self.test_dir, "apps/app1"))
2900.         self.run_django_admin(["startapp", "app1", "apps/app1"])
2901.         out, err = self.run_django_admin(["startapp", "app2", "apps/app1"])
2902.         self.assertOutput(
2903.             err,
2904.             "already exists. Overlaying an app into an existing directory "
2905.             "won't replace conflicting files.",
2906.         )
2907. 
2908.     def test_template(self):
2909.         out, err = self.run_django_admin(["startapp", "new_app"])
2910.         self.assertNoOutput(err)
2911.         app_path = os.path.join(self.test_dir, "new_app")
2912.         self.assertIs(os.path.exists(app_path), True)
2913.         with open(os.path.join(app_path, "apps.py")) as f:
2914.             content = f.read()
2915.             self.assertIn("class NewAppConfig(AppConfig)", content)
2916.             if HAS_BLACK:
2917.                 test_str = 'default_auto_field = "django.db.models.BigAutoField"'
2918.             else:
2919.                 test_str = "default_auto_field = 'django.db.models.BigAutoField'"
2920.             self.assertIn(test_str, content)
2921.             self.assertIn(
2922.                 'name = "new_app"' if HAS_BLACK else "name = 'new_app'",
2923.                 content,
2924.             )
2925. 
2926. 
2927. class DiffSettings(AdminScriptTestCase):
2928.     """Tests for diffsettings management command."""
2929. 
2930.     def test_basic(self):
2931.         """Runs without error and emits settings diff."""
2932.         self.write_settings("settings_to_diff.py", sdict={"FOO": '"bar"'})
2933.         args = ["diffsettings", "--settings=settings_to_diff"]
2934.         out, err = self.run_manage(args)
2935.         self.assertNoOutput(err)
2936.         self.assertOutput(out, "FOO = 'bar'  ###")
2937.         # Attributes from django.conf.Settings don't appear.
2938.         self.assertNotInOutput(out, "is_overridden = ")
2939. 
2940.     def test_settings_configured(self):
2941.         out, err = self.run_manage(
2942.             ["diffsettings"], manage_py="configured_settings_manage.py"
2943.         )
2944.         self.assertNoOutput(err)
2945.         self.assertOutput(out, "CUSTOM = 1  ###\nDEBUG = True")
2946.         # Attributes from django.conf.UserSettingsHolder don't appear.
2947.         self.assertNotInOutput(out, "default_settings = ")
2948. 
2949.     def test_dynamic_settings_configured(self):
2950.         # Custom default settings appear.
2951.         out, err = self.run_manage(
2952.             ["diffsettings"], manage_py="configured_dynamic_settings_manage.py"
2953.         )
2954.         self.assertNoOutput(err)
2955.         self.assertOutput(out, "FOO = 'bar'  ###")
2956. 
2957.     def test_all(self):
2958.         """The all option also shows settings with the default value."""
2959.         self.write_settings("settings_to_diff.py", sdict={"STATIC_URL": "None"})
2960.         args = ["diffsettings", "--settings=settings_to_diff", "--all"]
2961.         out, err = self.run_manage(args)
2962.         self.assertNoOutput(err)
2963.         self.assertOutput(out, "### STATIC_URL = None")
2964. 
2965.     def test_custom_default(self):
2966.         """
2967.         The --default option specifies an alternate settings module for
2968.         comparison.
2969.         """
2970.         self.write_settings(
2971.             "settings_default.py", sdict={"FOO": '"foo"', "BAR": '"bar1"'}
2972.         )
2973.         self.write_settings(
2974.             "settings_to_diff.py", sdict={"FOO": '"foo"', "BAR": '"bar2"'}
2975.         )
2976.         out, err = self.run_manage(
2977.             [
2978.                 "diffsettings",
2979.                 "--settings=settings_to_diff",
2980.                 "--default=settings_default",
2981.             ]
2982.         )
2983.         self.assertNoOutput(err)
2984.         self.assertNotInOutput(out, "FOO")
2985.         self.assertOutput(out, "BAR = 'bar2'")
2986. 
2987.     def test_unified(self):
2988.         """--output=unified emits settings diff in unified mode."""
2989.         self.write_settings("settings_to_diff.py", sdict={"FOO": '"bar"'})
2990.         args = ["diffsettings", "--settings=settings_to_diff", "--output=unified"]
2991.         out, err = self.run_manage(args)
2992.         self.assertNoOutput(err)
2993.         self.assertOutput(out, "+ FOO = 'bar'")
2994.         self.assertOutput(out, "- SECRET_KEY = ''")
2995.         self.assertOutput(out, "+ SECRET_KEY = 'django_tests_secret_key'")
2996.         self.assertNotInOutput(out, "  APPEND_SLASH = True")
2997. 
2998.     def test_unified_all(self):
2999.         """
3000.         --output=unified --all emits settings diff in unified mode and includes
3001.         settings with the default value.
3002.         """
3003.         self.write_settings("settings_to_diff.py", sdict={"FOO": '"bar"'})
3004.         args = [
3005.             "diffsettings",
3006.             "--settings=settings_to_diff",
3007.             "--output=unified",
3008.             "--all",
3009.         ]
3010.         out, err = self.run_manage(args)
3011.         self.assertNoOutput(err)
3012.         self.assertOutput(out, "  APPEND_SLASH = True")
3013.         self.assertOutput(out, "+ FOO = 'bar'")
3014.         self.assertOutput(out, "- SECRET_KEY = ''")
3015. 
3016. 
3017. class Dumpdata(AdminScriptTestCase):
3018.     """Tests for dumpdata management command."""
3019. 
3020.     def setUp(self):
3021.         super().setUp()
3022.         self.write_settings("settings.py")
3023. 
3024.     def test_pks_parsing(self):
3025.         """Regression for #20509
3026. 
3027.         Test would raise an exception rather than printing an error message.
3028.         """
3029.         args = ["dumpdata", "--pks=1"]
3030.         out, err = self.run_manage(args)
3031.         self.assertOutput(err, "You can only use --pks option with one model")
3032.         self.assertNoOutput(out)
3033. 
3034. 
3035. class MainModule(AdminScriptTestCase):
3036.     """python -m django works like django-admin."""
3037. 
3038.     def test_program_name_in_help(self):
3039.         out, err = self.run_test(["-m", "django", "help"])
3040.         self.assertOutput(
3041.             out,
3042.             "Type 'python -m django help <subcommand>' for help on a specific "
3043.             "subcommand.",
3044.         )
3045. 
3046. 
3047. class DjangoAdminSuggestions(AdminScriptTestCase):
3048.     def setUp(self):
3049.         super().setUp()
3050.         self.write_settings("settings.py")
3051. 
3052.     def test_suggestions(self):
3053.         args = ["rnserver", "--settings=test_project.settings"]
3054.         out, err = self.run_django_admin(args)
3055.         self.assertNoOutput(out)
3056.         self.assertOutput(err, "Unknown command: 'rnserver'. Did you mean runserver?")
3057. 
3058.     def test_no_suggestions(self):
3059.         args = ["abcdef", "--settings=test_project.settings"]
3060.         out, err = self.run_django_admin(args)
3061.         self.assertNoOutput(out)
3062.         self.assertNotInOutput(err, "Did you mean")


File: tests/migrations/test_commands.py
Line number range: 1 - 3180
Content:
1. import datetime
2. import importlib
3. import io
4. import os
5. import shutil
6. import sys
7. from unittest import mock
8. 
9. from django.apps import apps
10. from django.core.management import CommandError, call_command
11. from django.db import (
12.     ConnectionHandler,
13.     DatabaseError,
14.     OperationalError,
15.     connection,
16.     connections,
17.     models,
18. )
19. from django.db.backends.base.schema import BaseDatabaseSchemaEditor
20. from django.db.backends.utils import truncate_name
21. from django.db.migrations.exceptions import InconsistentMigrationHistory
22. from django.db.migrations.recorder import MigrationRecorder
23. from django.test import TestCase, override_settings, skipUnlessDBFeature
24. from django.test.utils import captured_stdout
25. from django.utils import timezone
26. from django.utils.version import get_docs_version
27. 
28. from .models import UnicodeModel, UnserializableModel
29. from .routers import TestRouter
30. from .test_base import MigrationTestBase
31. 
32. HAS_BLACK = shutil.which("black")
33. 
34. 
35. class MigrateTests(MigrationTestBase):
36.     """
37.     Tests running the migrate command.
38.     """
39. 
40.     databases = {"default", "other"}
41. 
42.     @override_settings(MIGRATION_MODULES={"migrations": "migrations.test_migrations"})
43.     def test_migrate(self):
44.         """
45.         Tests basic usage of the migrate command.
46.         """
47.         # No tables are created
48.         self.assertTableNotExists("migrations_author")
49.         self.assertTableNotExists("migrations_tribble")
50.         self.assertTableNotExists("migrations_book")
51.         # Run the migrations to 0001 only
52.         stdout = io.StringIO()
53.         call_command(
54.             "migrate", "migrations", "0001", verbosity=2, stdout=stdout, no_color=True
55.         )
56.         stdout = stdout.getvalue()
57.         self.assertIn(
58.             "Target specific migration: 0001_initial, from migrations", stdout
59.         )
60.         self.assertIn("Applying migrations.0001_initial... OK", stdout)
61.         self.assertIn("Running pre-migrate handlers for application migrations", stdout)
62.         self.assertIn(
63.             "Running post-migrate handlers for application migrations", stdout
64.         )
65.         # The correct tables exist
66.         self.assertTableExists("migrations_author")
67.         self.assertTableExists("migrations_tribble")
68.         self.assertTableNotExists("migrations_book")
69.         # Run migrations all the way
70.         call_command("migrate", verbosity=0)
71.         # The correct tables exist
72.         self.assertTableExists("migrations_author")
73.         self.assertTableNotExists("migrations_tribble")
74.         self.assertTableExists("migrations_book")
75.         # Unmigrate everything
76.         stdout = io.StringIO()
77.         call_command(
78.             "migrate", "migrations", "zero", verbosity=2, stdout=stdout, no_color=True
79.         )
80.         stdout = stdout.getvalue()
81.         self.assertIn("Unapply all migrations: migrations", stdout)
82.         self.assertIn("Unapplying migrations.0002_second... OK", stdout)
83.         self.assertIn("Running pre-migrate handlers for application migrations", stdout)
84.         self.assertIn(
85.             "Running post-migrate handlers for application migrations", stdout
86.         )
87.         # Tables are gone
88.         self.assertTableNotExists("migrations_author")
89.         self.assertTableNotExists("migrations_tribble")
90.         self.assertTableNotExists("migrations_book")
91. 
92.     @override_settings(
93.         INSTALLED_APPS=[
94.             "django.contrib.auth",
95.             "django.contrib.contenttypes",
96.             "migrations.migrations_test_apps.migrated_app",
97.         ]
98.     )
99.     def test_migrate_with_system_checks(self):
100.         out = io.StringIO()
101.         call_command("migrate", skip_checks=False, no_color=True, stdout=out)
102.         self.assertIn("Apply all migrations: migrated_app", out.getvalue())
103. 
104.     @override_settings(
105.         INSTALLED_APPS=[
106.             "migrations",
107.             "migrations.migrations_test_apps.unmigrated_app_syncdb",
108.         ]
109.     )
110.     def test_app_without_migrations(self):
111.         msg = "App 'unmigrated_app_syncdb' does not have migrations."
112.         with self.assertRaisesMessage(CommandError, msg):
113.             call_command("migrate", app_label="unmigrated_app_syncdb")
114. 
115.     @override_settings(
116.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_clashing_prefix"}
117.     )
118.     def test_ambiguous_prefix(self):
119.         msg = (
120.             "More than one migration matches 'a' in app 'migrations'. Please "
121.             "be more specific."
122.         )
123.         with self.assertRaisesMessage(CommandError, msg):
124.             call_command("migrate", app_label="migrations", migration_name="a")
125. 
126.     @override_settings(MIGRATION_MODULES={"migrations": "migrations.test_migrations"})
127.     def test_unknown_prefix(self):
128.         msg = "Cannot find a migration matching 'nonexistent' from app 'migrations'."
129.         with self.assertRaisesMessage(CommandError, msg):
130.             call_command(
131.                 "migrate", app_label="migrations", migration_name="nonexistent"
132.             )
133. 
134.     @override_settings(
135.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_initial_false"}
136.     )
137.     def test_migrate_initial_false(self):
138.         """
139.         `Migration.initial = False` skips fake-initial detection.
140.         """
141.         # Make sure no tables are created
142.         self.assertTableNotExists("migrations_author")
143.         self.assertTableNotExists("migrations_tribble")
144.         # Run the migrations to 0001 only
145.         call_command("migrate", "migrations", "0001", verbosity=0)
146.         # Fake rollback
147.         call_command("migrate", "migrations", "zero", fake=True, verbosity=0)
148.         # Make sure fake-initial detection does not run
149.         with self.assertRaises(DatabaseError):
150.             call_command(
151.                 "migrate", "migrations", "0001", fake_initial=True, verbosity=0
152.             )
153. 
154.         call_command("migrate", "migrations", "0001", fake=True, verbosity=0)
155.         # Real rollback
156.         call_command("migrate", "migrations", "zero", verbosity=0)
157.         # Make sure it's all gone
158.         self.assertTableNotExists("migrations_author")
159.         self.assertTableNotExists("migrations_tribble")
160.         self.assertTableNotExists("migrations_book")
161. 
162.     @override_settings(
163.         MIGRATION_MODULES={"migrations": "migrations.test_migrations"},
164.         DATABASE_ROUTERS=["migrations.routers.TestRouter"],
165.     )
166.     def test_migrate_fake_initial(self):
167.         """
168.         --fake-initial only works if all tables created in the initial
169.         migration of an app exists. Database routers must be obeyed when doing
170.         that check.
171.         """
172.         # Make sure no tables are created
173.         for db in self.databases:
174.             self.assertTableNotExists("migrations_author", using=db)
175.             self.assertTableNotExists("migrations_tribble", using=db)
176.         # Run the migrations to 0001 only
177.         call_command("migrate", "migrations", "0001", verbosity=0)
178.         call_command("migrate", "migrations", "0001", verbosity=0, database="other")
179.         # Make sure the right tables exist
180.         self.assertTableExists("migrations_author")
181.         self.assertTableNotExists("migrations_tribble")
182.         # Also check the "other" database
183.         self.assertTableNotExists("migrations_author", using="other")
184.         self.assertTableExists("migrations_tribble", using="other")
185. 
186.         # Fake a roll-back
187.         call_command("migrate", "migrations", "zero", fake=True, verbosity=0)
188.         call_command(
189.             "migrate", "migrations", "zero", fake=True, verbosity=0, database="other"
190.         )
191.         # Make sure the tables still exist
192.         self.assertTableExists("migrations_author")
193.         self.assertTableExists("migrations_tribble", using="other")
194.         # Try to run initial migration
195.         with self.assertRaises(DatabaseError):
196.             call_command("migrate", "migrations", "0001", verbosity=0)
197.         # Run initial migration with an explicit --fake-initial
198.         out = io.StringIO()
199.         with mock.patch(
200.             "django.core.management.color.supports_color", lambda *args: False
201.         ):
202.             call_command(
203.                 "migrate",
204.                 "migrations",
205.                 "0001",
206.                 fake_initial=True,
207.                 stdout=out,
208.                 verbosity=1,
209.             )
210.             call_command(
211.                 "migrate",
212.                 "migrations",
213.                 "0001",
214.                 fake_initial=True,
215.                 verbosity=0,
216.                 database="other",
217.             )
218.         self.assertIn("migrations.0001_initial... faked", out.getvalue().lower())
219.         try:
220.             # Run migrations all the way.
221.             call_command("migrate", verbosity=0)
222.             call_command("migrate", verbosity=0, database="other")
223.             self.assertTableExists("migrations_author")
224.             self.assertTableNotExists("migrations_tribble")
225.             self.assertTableExists("migrations_book")
226.             self.assertTableNotExists("migrations_author", using="other")
227.             self.assertTableNotExists("migrations_tribble", using="other")
228.             self.assertTableNotExists("migrations_book", using="other")
229.             # Fake a roll-back.
230.             call_command("migrate", "migrations", "zero", fake=True, verbosity=0)
231.             call_command(
232.                 "migrate",
233.                 "migrations",
234.                 "zero",
235.                 fake=True,
236.                 verbosity=0,
237.                 database="other",
238.             )
239.             self.assertTableExists("migrations_author")
240.             self.assertTableNotExists("migrations_tribble")
241.             self.assertTableExists("migrations_book")
242.             # Run initial migration.
243.             with self.assertRaises(DatabaseError):
244.                 call_command("migrate", "migrations", verbosity=0)
245.             # Run initial migration with an explicit --fake-initial.
246.             with self.assertRaises(DatabaseError):
247.                 # Fails because "migrations_tribble" does not exist but needs
248.                 # to in order to make --fake-initial work.
249.                 call_command("migrate", "migrations", fake_initial=True, verbosity=0)
250.             # Fake an apply.
251.             call_command("migrate", "migrations", fake=True, verbosity=0)
252.             call_command(
253.                 "migrate", "migrations", fake=True, verbosity=0, database="other"
254.             )
255.         finally:
256.             # Unmigrate everything.
257.             call_command("migrate", "migrations", "zero", verbosity=0)
258.             call_command("migrate", "migrations", "zero", verbosity=0, database="other")
259.         # Make sure it's all gone
260.         for db in self.databases:
261.             self.assertTableNotExists("migrations_author", using=db)
262.             self.assertTableNotExists("migrations_tribble", using=db)
263.             self.assertTableNotExists("migrations_book", using=db)
264. 
265.     @skipUnlessDBFeature("ignores_table_name_case")
266.     def test_migrate_fake_initial_case_insensitive(self):
267.         with override_settings(
268.             MIGRATION_MODULES={
269.                 "migrations": "migrations.test_fake_initial_case_insensitive.initial",
270.             }
271.         ):
272.             call_command("migrate", "migrations", "0001", verbosity=0)
273.             call_command("migrate", "migrations", "zero", fake=True, verbosity=0)
274. 
275.         with override_settings(
276.             MIGRATION_MODULES={
277.                 "migrations": (
278.                     "migrations.test_fake_initial_case_insensitive.fake_initial"
279.                 ),
280.             }
281.         ):
282.             out = io.StringIO()
283.             call_command(
284.                 "migrate",
285.                 "migrations",
286.                 "0001",
287.                 fake_initial=True,
288.                 stdout=out,
289.                 verbosity=1,
290.                 no_color=True,
291.             )
292.             self.assertIn(
293.                 "migrations.0001_initial... faked",
294.                 out.getvalue().lower(),
295.             )
296. 
297.     @override_settings(
298.         MIGRATION_MODULES={
299.             "migrations": "migrations.test_migrations_fake_split_initial"
300.         }
301.     )
302.     def test_migrate_fake_split_initial(self):
303.         """
304.         Split initial migrations can be faked with --fake-initial.
305.         """
306.         try:
307.             call_command("migrate", "migrations", "0002", verbosity=0)
308.             call_command("migrate", "migrations", "zero", fake=True, verbosity=0)
309.             out = io.StringIO()
310.             with mock.patch(
311.                 "django.core.management.color.supports_color", lambda *args: False
312.             ):
313.                 call_command(
314.                     "migrate",
315.                     "migrations",
316.                     "0002",
317.                     fake_initial=True,
318.                     stdout=out,
319.                     verbosity=1,
320.                 )
321.             value = out.getvalue().lower()
322.             self.assertIn("migrations.0001_initial... faked", value)
323.             self.assertIn("migrations.0002_second... faked", value)
324.         finally:
325.             # Fake an apply.
326.             call_command("migrate", "migrations", fake=True, verbosity=0)
327.             # Unmigrate everything.
328.             call_command("migrate", "migrations", "zero", verbosity=0)
329. 
330.     @override_settings(
331.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_conflict"}
332.     )
333.     def test_migrate_conflict_exit(self):
334.         """
335.         migrate exits if it detects a conflict.
336.         """
337.         msg = (
338.             "Conflicting migrations detected; multiple leaf nodes in the "
339.             "migration graph: (0002_conflicting_second, 0002_second in "
340.             "migrations).\n"
341.             "To fix them run 'python manage.py makemigrations --merge'"
342.         )
343.         with self.assertRaisesMessage(CommandError, msg):
344.             call_command("migrate", "migrations")
345. 
346.     @override_settings(
347.         MIGRATION_MODULES={
348.             "migrations": "migrations.test_migrations",
349.         }
350.     )
351.     def test_migrate_check(self):
352.         with self.assertRaises(SystemExit):
353.             call_command("migrate", "migrations", "0001", check_unapplied=True)
354.         self.assertTableNotExists("migrations_author")
355.         self.assertTableNotExists("migrations_tribble")
356.         self.assertTableNotExists("migrations_book")
357. 
358.     @override_settings(
359.         INSTALLED_APPS=[
360.             "migrations.migrations_test_apps.migrated_app",
361.         ]
362.     )
363.     def test_migrate_check_migrated_app(self):
364.         out = io.StringIO()
365.         try:
366.             call_command("migrate", "migrated_app", verbosity=0)
367.             call_command(
368.                 "migrate",
369.                 "migrated_app",
370.                 stdout=out,
371.                 check_unapplied=True,
372.             )
373.             self.assertEqual(out.getvalue(), "")
374.         finally:
375.             # Unmigrate everything.
376.             call_command("migrate", "migrated_app", "zero", verbosity=0)
377. 
378.     @override_settings(
379.         MIGRATION_MODULES={
380.             "migrations": "migrations.test_migrations_plan",
381.         }
382.     )
383.     def test_migrate_check_plan(self):
384.         out = io.StringIO()
385.         with self.assertRaises(SystemExit):
386.             call_command(
387.                 "migrate",
388.                 "migrations",
389.                 "0001",
390.                 check_unapplied=True,
391.                 plan=True,
392.                 stdout=out,
393.                 no_color=True,
394.             )
395.         self.assertEqual(
396.             "Planned operations:\n"
397.             "migrations.0001_initial\n"
398.             "    Create model Salamander\n"
399.             "    Raw Python operation -> Grow salamander tail.\n",
400.             out.getvalue(),
401.         )
402. 
403.     @override_settings(MIGRATION_MODULES={"migrations": "migrations.test_migrations"})
404.     def test_showmigrations_list(self):
405.         """
406.         showmigrations --list  displays migrations and whether or not they're
407.         applied.
408.         """
409.         out = io.StringIO()
410.         with mock.patch(
411.             "django.core.management.color.supports_color", lambda *args: True
412.         ):
413.             call_command(
414.                 "showmigrations", format="list", stdout=out, verbosity=0, no_color=False
415.             )
416.         self.assertEqual(
417.             "\x1b[1mmigrations\n\x1b[0m [ ] 0001_initial\n [ ] 0002_second\n",
418.             out.getvalue().lower(),
419.         )
420. 
421.         call_command("migrate", "migrations", "0001", verbosity=0)
422. 
423.         out = io.StringIO()
424.         # Giving the explicit app_label tests for selective `show_list` in the command
425.         call_command(
426.             "showmigrations",
427.             "migrations",
428.             format="list",
429.             stdout=out,
430.             verbosity=0,
431.             no_color=True,
432.         )
433.         self.assertEqual(
434.             "migrations\n [x] 0001_initial\n [ ] 0002_second\n", out.getvalue().lower()
435.         )
436.         out = io.StringIO()
437.         # Applied datetimes are displayed at verbosity 2+.
438.         call_command(
439.             "showmigrations", "migrations", stdout=out, verbosity=2, no_color=True
440.         )
441.         migration1 = MigrationRecorder(connection).migration_qs.get(
442.             app="migrations", name="0001_initial"
443.         )
444.         self.assertEqual(
445.             "migrations\n"
446.             " [x] 0001_initial (applied at %s)\n"
447.             " [ ] 0002_second\n" % migration1.applied.strftime("%Y-%m-%d %H:%M:%S"),
448.             out.getvalue().lower(),
449.         )
450.         # Cleanup by unmigrating everything
451.         call_command("migrate", "migrations", "zero", verbosity=0)
452. 
453.     @override_settings(
454.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_squashed"}
455.     )
456.     def test_showmigrations_list_squashed(self):
457.         out = io.StringIO()
458.         call_command(
459.             "showmigrations", format="list", stdout=out, verbosity=2, no_color=True
460.         )
461.         self.assertEqual(
462.             "migrations\n [ ] 0001_squashed_0002 (2 squashed migrations)\n",
463.             out.getvalue().lower(),
464.         )
465.         out = io.StringIO()
466.         call_command(
467.             "migrate",
468.             "migrations",
469.             "0001_squashed_0002",
470.             stdout=out,
471.             verbosity=2,
472.             no_color=True,
473.         )
474.         try:
475.             self.assertIn(
476.                 "operations to perform:\n"
477.                 "  target specific migration: 0001_squashed_0002, from migrations\n"
478.                 "running pre-migrate handlers for application migrations\n"
479.                 "running migrations:\n"
480.                 "  applying migrations.0001_squashed_0002... ok (",
481.                 out.getvalue().lower(),
482.             )
483.             out = io.StringIO()
484.             call_command(
485.                 "showmigrations", format="list", stdout=out, verbosity=2, no_color=True
486.             )
487.             self.assertEqual(
488.                 "migrations\n [x] 0001_squashed_0002 (2 squashed migrations)\n",
489.                 out.getvalue().lower(),
490.             )
491.         finally:
492.             # Unmigrate everything.
493.             call_command("migrate", "migrations", "zero", verbosity=0)
494. 
495.     @override_settings(
496.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_run_before"}
497.     )
498.     def test_showmigrations_plan(self):
499.         """
500.         Tests --plan output of showmigrations command
501.         """
502.         out = io.StringIO()
503.         call_command("showmigrations", format="plan", stdout=out)
504.         self.assertEqual(
505.             "[ ]  migrations.0001_initial\n"
506.             "[ ]  migrations.0003_third\n"
507.             "[ ]  migrations.0002_second\n",
508.             out.getvalue().lower(),
509.         )
510. 
511.         out = io.StringIO()
512.         call_command("showmigrations", format="plan", stdout=out, verbosity=2)
513.         self.assertEqual(
514.             "[ ]  migrations.0001_initial\n"
515.             "[ ]  migrations.0003_third ... (migrations.0001_initial)\n"
516.             "[ ]  migrations.0002_second ... (migrations.0001_initial, "
517.             "migrations.0003_third)\n",
518.             out.getvalue().lower(),
519.         )
520.         call_command("migrate", "migrations", "0003", verbosity=0)
521. 
522.         out = io.StringIO()
523.         call_command("showmigrations", format="plan", stdout=out)
524.         self.assertEqual(
525.             "[x]  migrations.0001_initial\n"
526.             "[x]  migrations.0003_third\n"
527.             "[ ]  migrations.0002_second\n",
528.             out.getvalue().lower(),
529.         )
530. 
531.         out = io.StringIO()
532.         call_command("showmigrations", format="plan", stdout=out, verbosity=2)
533.         self.assertEqual(
534.             "[x]  migrations.0001_initial\n"
535.             "[x]  migrations.0003_third ... (migrations.0001_initial)\n"
536.             "[ ]  migrations.0002_second ... (migrations.0001_initial, "
537.             "migrations.0003_third)\n",
538.             out.getvalue().lower(),
539.         )
540. 
541.         # Cleanup by unmigrating everything
542.         call_command("migrate", "migrations", "zero", verbosity=0)
543. 
544.     @override_settings(
545.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_plan"}
546.     )
547.     def test_migrate_plan(self):
548.         """Tests migrate --plan output."""
549.         out = io.StringIO()
550.         # Show the plan up to the third migration.
551.         call_command(
552.             "migrate", "migrations", "0003", plan=True, stdout=out, no_color=True
553.         )
554.         self.assertEqual(
555.             "Planned operations:\n"
556.             "migrations.0001_initial\n"
557.             "    Create model Salamander\n"
558.             "    Raw Python operation -> Grow salamander tail.\n"
559.             "migrations.0002_second\n"
560.             "    Create model Book\n"
561.             "    Raw SQL operation -> ['SELECT * FROM migrations_book']\n"
562.             "migrations.0003_third\n"
563.             "    Create model Author\n"
564.             "    Raw SQL operation -> ['SELECT * FROM migrations_author']\n",
565.             out.getvalue(),
566.         )
567.         try:
568.             # Migrate to the third migration.
569.             call_command("migrate", "migrations", "0003", verbosity=0)
570.             out = io.StringIO()
571.             # Show the plan for when there is nothing to apply.
572.             call_command(
573.                 "migrate", "migrations", "0003", plan=True, stdout=out, no_color=True
574.             )
575.             self.assertEqual(
576.                 "Planned operations:\n  No planned migration operations.\n",
577.                 out.getvalue(),
578.             )
579.             out = io.StringIO()
580.             # Show the plan for reverse migration back to 0001.
581.             call_command(
582.                 "migrate", "migrations", "0001", plan=True, stdout=out, no_color=True
583.             )
584.             self.assertEqual(
585.                 "Planned operations:\n"
586.                 "migrations.0003_third\n"
587.                 "    Undo Create model Author\n"
588.                 "    Raw SQL operation -> ['SELECT * FROM migrations_book']\n"
589.                 "migrations.0002_second\n"
590.                 "    Undo Create model Book\n"
591.                 "    Raw SQL operation -> ['SELECT * FROM migrations_salamand…\n",
592.                 out.getvalue(),
593.             )
594.             out = io.StringIO()
595.             # Show the migration plan to fourth, with truncated details.
596.             call_command(
597.                 "migrate", "migrations", "0004", plan=True, stdout=out, no_color=True
598.             )
599.             self.assertEqual(
600.                 "Planned operations:\n"
601.                 "migrations.0004_fourth\n"
602.                 "    Raw SQL operation -> SELECT * FROM migrations_author WHE…\n",
603.                 out.getvalue(),
604.             )
605.             # Show the plan when an operation is irreversible.
606.             # Migrate to the fourth migration.
607.             call_command("migrate", "migrations", "0004", verbosity=0)
608.             out = io.StringIO()
609.             call_command(
610.                 "migrate", "migrations", "0003", plan=True, stdout=out, no_color=True
611.             )
612.             self.assertEqual(
613.                 "Planned operations:\n"
614.                 "migrations.0004_fourth\n"
615.                 "    Raw SQL operation -> IRREVERSIBLE\n",
616.                 out.getvalue(),
617.             )
618.             out = io.StringIO()
619.             call_command(
620.                 "migrate", "migrations", "0005", plan=True, stdout=out, no_color=True
621.             )
622.             # Operation is marked as irreversible only in the revert plan.
623.             self.assertEqual(
624.                 "Planned operations:\n"
625.                 "migrations.0005_fifth\n"
626.                 "    Raw Python operation\n"
627.                 "    Raw Python operation\n"
628.                 "    Raw Python operation -> Feed salamander.\n",
629.                 out.getvalue(),
630.             )
631.             call_command("migrate", "migrations", "0005", verbosity=0)
632.             out = io.StringIO()
633.             call_command(
634.                 "migrate", "migrations", "0004", plan=True, stdout=out, no_color=True
635.             )
636.             self.assertEqual(
637.                 "Planned operations:\n"
638.                 "migrations.0005_fifth\n"
639.                 "    Raw Python operation -> IRREVERSIBLE\n"
640.                 "    Raw Python operation -> IRREVERSIBLE\n"
641.                 "    Raw Python operation\n",
642.                 out.getvalue(),
643.             )
644.         finally:
645.             # Cleanup by unmigrating everything: fake the irreversible, then
646.             # migrate all to zero.
647.             call_command("migrate", "migrations", "0003", fake=True, verbosity=0)
648.             call_command("migrate", "migrations", "zero", verbosity=0)
649. 
650.     @override_settings(
651.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_empty"}
652.     )
653.     def test_showmigrations_no_migrations(self):
654.         out = io.StringIO()
655.         call_command("showmigrations", stdout=out, no_color=True)
656.         self.assertEqual("migrations\n (no migrations)\n", out.getvalue().lower())
657. 
658.     @override_settings(
659.         INSTALLED_APPS=["migrations.migrations_test_apps.unmigrated_app"]
660.     )
661.     def test_showmigrations_unmigrated_app(self):
662.         out = io.StringIO()
663.         call_command("showmigrations", "unmigrated_app", stdout=out, no_color=True)
664.         try:
665.             self.assertEqual(
666.                 "unmigrated_app\n (no migrations)\n", out.getvalue().lower()
667.             )
668.         finally:
669.             # unmigrated_app.SillyModel has a foreign key to
670.             # 'migrations.Tribble', but that model is only defined in a
671.             # migration, so the global app registry never sees it and the
672.             # reference is left dangling. Remove it to avoid problems in
673.             # subsequent tests.
674.             apps._pending_operations.pop(("migrations", "tribble"), None)
675. 
676.     @override_settings(
677.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_empty"}
678.     )
679.     def test_showmigrations_plan_no_migrations(self):
680.         """
681.         Tests --plan output of showmigrations command without migrations
682.         """
683.         out = io.StringIO()
684.         call_command("showmigrations", format="plan", stdout=out, no_color=True)
685.         self.assertEqual("(no migrations)\n", out.getvalue().lower())
686. 
687.         out = io.StringIO()
688.         call_command(
689.             "showmigrations", format="plan", stdout=out, verbosity=2, no_color=True
690.         )
691.         self.assertEqual("(no migrations)\n", out.getvalue().lower())
692. 
693.     @override_settings(
694.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_squashed_complex"}
695.     )
696.     def test_showmigrations_plan_squashed(self):
697.         """
698.         Tests --plan output of showmigrations command with squashed migrations.
699.         """
700.         out = io.StringIO()
701.         call_command("showmigrations", format="plan", stdout=out)
702.         self.assertEqual(
703.             "[ ]  migrations.1_auto\n"
704.             "[ ]  migrations.2_auto\n"
705.             "[ ]  migrations.3_squashed_5\n"
706.             "[ ]  migrations.6_auto\n"
707.             "[ ]  migrations.7_auto\n",
708.             out.getvalue().lower(),
709.         )
710. 
711.         out = io.StringIO()
712.         call_command("showmigrations", format="plan", stdout=out, verbosity=2)
713.         self.assertEqual(
714.             "[ ]  migrations.1_auto\n"
715.             "[ ]  migrations.2_auto ... (migrations.1_auto)\n"
716.             "[ ]  migrations.3_squashed_5 ... (migrations.2_auto)\n"
717.             "[ ]  migrations.6_auto ... (migrations.3_squashed_5)\n"
718.             "[ ]  migrations.7_auto ... (migrations.6_auto)\n",
719.             out.getvalue().lower(),
720.         )
721. 
722.         call_command("migrate", "migrations", "3_squashed_5", verbosity=0)
723. 
724.         out = io.StringIO()
725.         call_command("showmigrations", format="plan", stdout=out)
726.         self.assertEqual(
727.             "[x]  migrations.1_auto\n"
728.             "[x]  migrations.2_auto\n"
729.             "[x]  migrations.3_squashed_5\n"
730.             "[ ]  migrations.6_auto\n"
731.             "[ ]  migrations.7_auto\n",
732.             out.getvalue().lower(),
733.         )
734. 
735.         out = io.StringIO()
736.         call_command("showmigrations", format="plan", stdout=out, verbosity=2)
737.         self.assertEqual(
738.             "[x]  migrations.1_auto\n"
739.             "[x]  migrations.2_auto ... (migrations.1_auto)\n"
740.             "[x]  migrations.3_squashed_5 ... (migrations.2_auto)\n"
741.             "[ ]  migrations.6_auto ... (migrations.3_squashed_5)\n"
742.             "[ ]  migrations.7_auto ... (migrations.6_auto)\n",
743.             out.getvalue().lower(),
744.         )
745. 
746.     @override_settings(
747.         INSTALLED_APPS=[
748.             "migrations.migrations_test_apps.mutate_state_b",
749.             "migrations.migrations_test_apps.alter_fk.author_app",
750.             "migrations.migrations_test_apps.alter_fk.book_app",
751.         ]
752.     )
753.     def test_showmigrations_plan_single_app_label(self):
754.         """
755.         `showmigrations --plan app_label` output with a single app_label.
756.         """
757.         # Single app with no dependencies on other apps.
758.         out = io.StringIO()
759.         call_command("showmigrations", "mutate_state_b", format="plan", stdout=out)
760.         self.assertEqual(
761.             "[ ]  mutate_state_b.0001_initial\n[ ]  mutate_state_b.0002_add_field\n",
762.             out.getvalue(),
763.         )
764.         # Single app with dependencies.
765.         out = io.StringIO()
766.         call_command("showmigrations", "author_app", format="plan", stdout=out)
767.         self.assertEqual(
768.             "[ ]  author_app.0001_initial\n"
769.             "[ ]  book_app.0001_initial\n"
770.             "[ ]  author_app.0002_alter_id\n",
771.             out.getvalue(),
772.         )
773.         # Some migrations already applied.
774.         call_command("migrate", "author_app", "0001", verbosity=0)
775.         out = io.StringIO()
776.         call_command("showmigrations", "author_app", format="plan", stdout=out)
777.         self.assertEqual(
778.             "[X]  author_app.0001_initial\n"
779.             "[ ]  book_app.0001_initial\n"
780.             "[ ]  author_app.0002_alter_id\n",
781.             out.getvalue(),
782.         )
783.         # Cleanup by unmigrating author_app.
784.         call_command("migrate", "author_app", "zero", verbosity=0)
785. 
786.     @override_settings(
787.         INSTALLED_APPS=[
788.             "migrations.migrations_test_apps.mutate_state_b",
789.             "migrations.migrations_test_apps.alter_fk.author_app",
790.             "migrations.migrations_test_apps.alter_fk.book_app",
791.         ]
792.     )
793.     def test_showmigrations_plan_multiple_app_labels(self):
794.         """
795.         `showmigrations --plan app_label` output with multiple app_labels.
796.         """
797.         # Multiple apps: author_app depends on book_app; mutate_state_b doesn't
798.         # depend on other apps.
799.         out = io.StringIO()
800.         call_command(
801.             "showmigrations", "mutate_state_b", "author_app", format="plan", stdout=out
802.         )
803.         self.assertEqual(
804.             "[ ]  author_app.0001_initial\n"
805.             "[ ]  book_app.0001_initial\n"
806.             "[ ]  author_app.0002_alter_id\n"
807.             "[ ]  mutate_state_b.0001_initial\n"
808.             "[ ]  mutate_state_b.0002_add_field\n",
809.             out.getvalue(),
810.         )
811.         # Multiple apps: args order shouldn't matter (the same result is
812.         # expected as above).
813.         out = io.StringIO()
814.         call_command(
815.             "showmigrations", "author_app", "mutate_state_b", format="plan", stdout=out
816.         )
817.         self.assertEqual(
818.             "[ ]  author_app.0001_initial\n"
819.             "[ ]  book_app.0001_initial\n"
820.             "[ ]  author_app.0002_alter_id\n"
821.             "[ ]  mutate_state_b.0001_initial\n"
822.             "[ ]  mutate_state_b.0002_add_field\n",
823.             out.getvalue(),
824.         )
825. 
826.     @override_settings(
827.         INSTALLED_APPS=["migrations.migrations_test_apps.unmigrated_app"]
828.     )
829.     def test_showmigrations_plan_app_label_no_migrations(self):
830.         out = io.StringIO()
831.         call_command(
832.             "showmigrations", "unmigrated_app", format="plan", stdout=out, no_color=True
833.         )
834.         try:
835.             self.assertEqual("(no migrations)\n", out.getvalue())
836.         finally:
837.             # unmigrated_app.SillyModel has a foreign key to
838.             # 'migrations.Tribble', but that model is only defined in a
839.             # migration, so the global app registry never sees it and the
840.             # reference is left dangling. Remove it to avoid problems in
841.             # subsequent tests.
842.             apps._pending_operations.pop(("migrations", "tribble"), None)
843. 
844.     @override_settings(MIGRATION_MODULES={"migrations": "migrations.test_migrations"})
845.     def test_sqlmigrate_forwards(self):
846.         """
847.         sqlmigrate outputs forward looking SQL.
848.         """
849.         out = io.StringIO()
850.         call_command("sqlmigrate", "migrations", "0001", stdout=out)
851. 
852.         lines = out.getvalue().splitlines()
853. 
854.         if connection.features.can_rollback_ddl:
855.             self.assertEqual(lines[0], connection.ops.start_transaction_sql())
856.             self.assertEqual(lines[-1], connection.ops.end_transaction_sql())
857.             lines = lines[1:-1]
858. 
859.         self.assertEqual(
860.             lines[:3],
861.             [
862.                 "--",
863.                 "-- Create model Author",
864.                 "--",
865.             ],
866.         )
867.         self.assertIn(
868.             "create table %s" % connection.ops.quote_name("migrations_author").lower(),
869.             lines[3].lower(),
870.         )
871.         pos = lines.index("--", 3)
872.         self.assertEqual(
873.             lines[pos : pos + 3],
874.             [
875.                 "--",
876.                 "-- Create model Tribble",
877.                 "--",
878.             ],
879.         )
880.         self.assertIn(
881.             "create table %s" % connection.ops.quote_name("migrations_tribble").lower(),
882.             lines[pos + 3].lower(),
883.         )
884.         pos = lines.index("--", pos + 3)
885.         self.assertEqual(
886.             lines[pos : pos + 3],
887.             [
888.                 "--",
889.                 "-- Add field bool to tribble",
890.                 "--",
891.             ],
892.         )
893.         pos = lines.index("--", pos + 3)
894.         self.assertEqual(
895.             lines[pos : pos + 3],
896.             [
897.                 "--",
898.                 "-- Alter unique_together for author (1 constraint(s))",
899.                 "--",
900.             ],
901.         )
902. 
903.     @override_settings(MIGRATION_MODULES={"migrations": "migrations.test_migrations"})
904.     def test_sqlmigrate_backwards(self):
905.         """
906.         sqlmigrate outputs reverse looking SQL.
907.         """
908.         # Cannot generate the reverse SQL unless we've applied the migration.
909.         call_command("migrate", "migrations", verbosity=0)
910. 
911.         out = io.StringIO()
912.         call_command("sqlmigrate", "migrations", "0001", stdout=out, backwards=True)
913. 
914.         lines = out.getvalue().splitlines()
915.         try:
916.             if connection.features.can_rollback_ddl:
917.                 self.assertEqual(lines[0], connection.ops.start_transaction_sql())
918.                 self.assertEqual(lines[-1], connection.ops.end_transaction_sql())
919.                 lines = lines[1:-1]
920. 
921.             self.assertEqual(
922.                 lines[:3],
923.                 [
924.                     "--",
925.                     "-- Alter unique_together for author (1 constraint(s))",
926.                     "--",
927.                 ],
928.             )
929.             pos = lines.index("--", 3)
930.             self.assertEqual(
931.                 lines[pos : pos + 3],
932.                 [
933.                     "--",
934.                     "-- Add field bool to tribble",
935.                     "--",
936.                 ],
937.             )
938.             pos = lines.index("--", pos + 3)
939.             self.assertEqual(
940.                 lines[pos : pos + 3],
941.                 [
942.                     "--",
943.                     "-- Create model Tribble",
944.                     "--",
945.                 ],
946.             )
947.             next_pos = lines.index("--", pos + 3)
948.             drop_table_sql = (
949.                 "drop table %s"
950.                 % connection.ops.quote_name("migrations_tribble").lower()
951.             )
952.             for line in lines[pos + 3 : next_pos]:
953.                 if drop_table_sql in line.lower():
954.                     break
955.             else:
956.                 self.fail("DROP TABLE (tribble) not found.")
957.             pos = next_pos
958.             self.assertEqual(
959.                 lines[pos : pos + 3],
960.                 [
961.                     "--",
962.                     "-- Create model Author",
963.                     "--",
964.                 ],
965.             )
966.             drop_table_sql = (
967.                 "drop table %s" % connection.ops.quote_name("migrations_author").lower()
968.             )
969.             for line in lines[pos + 3 :]:
970.                 if drop_table_sql in line.lower():
971.                     break
972.             else:
973.                 self.fail("DROP TABLE (author) not found.")
974.         finally:
975.             # Unmigrate everything.
976.             call_command("migrate", "migrations", "zero", verbosity=0)
977. 
978.     @override_settings(
979.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_non_atomic"}
980.     )
981.     def test_sqlmigrate_for_non_atomic_migration(self):
982.         """
983.         Transaction wrappers aren't shown for non-atomic migrations.
984.         """
985.         out = io.StringIO()
986.         call_command("sqlmigrate", "migrations", "0001", stdout=out)
987.         output = out.getvalue().lower()
988.         queries = [q.strip() for q in output.splitlines()]
989.         if connection.ops.start_transaction_sql():
990.             self.assertNotIn(connection.ops.start_transaction_sql().lower(), queries)
991.         self.assertNotIn(connection.ops.end_transaction_sql().lower(), queries)
992. 
993.     @override_settings(MIGRATION_MODULES={"migrations": "migrations.test_migrations"})
994.     def test_sqlmigrate_for_non_transactional_databases(self):
995.         """
996.         Transaction wrappers aren't shown for databases that don't support
997.         transactional DDL.
998.         """
999.         out = io.StringIO()
1000.         with mock.patch.object(connection.features, "can_rollback_ddl", False):
1001.             call_command("sqlmigrate", "migrations", "0001", stdout=out)
1002.         output = out.getvalue().lower()
1003.         queries = [q.strip() for q in output.splitlines()]
1004.         start_transaction_sql = connection.ops.start_transaction_sql()
1005.         if start_transaction_sql:
1006.             self.assertNotIn(start_transaction_sql.lower(), queries)
1007.         self.assertNotIn(connection.ops.end_transaction_sql().lower(), queries)
1008. 
1009.     @override_settings(
1010.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_squashed"}
1011.     )
1012.     def test_sqlmigrate_ambiguous_prefix_squashed_migrations(self):
1013.         msg = (
1014.             "More than one migration matches '0001' in app 'migrations'. "
1015.             "Please be more specific."
1016.         )
1017.         with self.assertRaisesMessage(CommandError, msg):
1018.             call_command("sqlmigrate", "migrations", "0001")
1019. 
1020.     @override_settings(
1021.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_squashed"}
1022.     )
1023.     def test_sqlmigrate_squashed_migration(self):
1024.         out = io.StringIO()
1025.         call_command("sqlmigrate", "migrations", "0001_squashed_0002", stdout=out)
1026.         output = out.getvalue().lower()
1027.         self.assertIn("-- create model author", output)
1028.         self.assertIn("-- create model book", output)
1029.         self.assertNotIn("-- create model tribble", output)
1030. 
1031.     @override_settings(
1032.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_squashed"}
1033.     )
1034.     def test_sqlmigrate_replaced_migration(self):
1035.         out = io.StringIO()
1036.         call_command("sqlmigrate", "migrations", "0001_initial", stdout=out)
1037.         output = out.getvalue().lower()
1038.         self.assertIn("-- create model author", output)
1039.         self.assertIn("-- create model tribble", output)
1040. 
1041.     @override_settings(
1042.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_no_operations"}
1043.     )
1044.     def test_sqlmigrate_no_operations(self):
1045.         err = io.StringIO()
1046.         call_command("sqlmigrate", "migrations", "0001_initial", stderr=err)
1047.         self.assertEqual(err.getvalue(), "No operations found.\n")
1048. 
1049.     @override_settings(
1050.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_noop"}
1051.     )
1052.     def test_sqlmigrate_noop(self):
1053.         out = io.StringIO()
1054.         call_command("sqlmigrate", "migrations", "0001", stdout=out)
1055.         lines = out.getvalue().splitlines()
1056. 
1057.         if connection.features.can_rollback_ddl:
1058.             lines = lines[1:-1]
1059.         self.assertEqual(
1060.             lines,
1061.             [
1062.                 "--",
1063.                 "-- Raw SQL operation",
1064.                 "--",
1065.                 "-- (no-op)",
1066.             ],
1067.         )
1068. 
1069.     @override_settings(
1070.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_manual_porting"}
1071.     )
1072.     def test_sqlmigrate_unrepresentable(self):
1073.         out = io.StringIO()
1074.         call_command("sqlmigrate", "migrations", "0002", stdout=out)
1075.         lines = out.getvalue().splitlines()
1076. 
1077.         if connection.features.can_rollback_ddl:
1078.             lines = lines[1:-1]
1079.         self.assertEqual(
1080.             lines,
1081.             [
1082.                 "--",
1083.                 "-- Raw Python operation",
1084.                 "--",
1085.                 "-- THIS OPERATION CANNOT BE WRITTEN AS SQL",
1086.             ],
1087.         )
1088. 
1089.     @override_settings(
1090.         INSTALLED_APPS=[
1091.             "migrations.migrations_test_apps.migrated_app",
1092.             "migrations.migrations_test_apps.migrated_unapplied_app",
1093.             "migrations.migrations_test_apps.unmigrated_app",
1094.         ],
1095.     )
1096.     def test_regression_22823_unmigrated_fk_to_migrated_model(self):
1097.         """
1098.         Assuming you have 3 apps, `A`, `B`, and `C`, such that:
1099. 
1100.         * `A` has migrations
1101.         * `B` has a migration we want to apply
1102.         * `C` has no migrations, but has an FK to `A`
1103. 
1104.         When we try to migrate "B", an exception occurs because the
1105.         "B" was not included in the ProjectState that is used to detect
1106.         soft-applied migrations (#22823).
1107.         """
1108.         call_command("migrate", "migrated_unapplied_app", verbosity=0)
1109. 
1110.         # unmigrated_app.SillyModel has a foreign key to 'migrations.Tribble',
1111.         # but that model is only defined in a migration, so the global app
1112.         # registry never sees it and the reference is left dangling. Remove it
1113.         # to avoid problems in subsequent tests.
1114.         apps._pending_operations.pop(("migrations", "tribble"), None)
1115. 
1116.     @override_settings(
1117.         INSTALLED_APPS=["migrations.migrations_test_apps.unmigrated_app_syncdb"]
1118.     )
1119.     def test_migrate_syncdb_deferred_sql_executed_with_schemaeditor(self):
1120.         """
1121.         For an app without migrations, editor.execute() is used for executing
1122.         the syncdb deferred SQL.
1123.         """
1124.         stdout = io.StringIO()
1125.         with mock.patch.object(BaseDatabaseSchemaEditor, "execute") as execute:
1126.             call_command(
1127.                 "migrate", run_syncdb=True, verbosity=1, stdout=stdout, no_color=True
1128.             )
1129.             create_table_count = len(
1130.                 [call for call in execute.mock_calls if "CREATE TABLE" in str(call)]
1131.             )
1132.             self.assertEqual(create_table_count, 2)
1133.             # There's at least one deferred SQL for creating the foreign key
1134.             # index.
1135.             self.assertGreater(len(execute.mock_calls), 2)
1136.         stdout = stdout.getvalue()
1137.         self.assertIn("Synchronize unmigrated apps: unmigrated_app_syncdb", stdout)
1138.         self.assertIn("Creating tables...", stdout)
1139.         table_name = truncate_name(
1140.             "unmigrated_app_syncdb_classroom", connection.ops.max_name_length()
1141.         )
1142.         self.assertIn("Creating table %s" % table_name, stdout)
1143. 
1144.     @override_settings(MIGRATION_MODULES={"migrations": "migrations.test_migrations"})
1145.     def test_migrate_syncdb_app_with_migrations(self):
1146.         msg = "Can't use run_syncdb with app 'migrations' as it has migrations."
1147.         with self.assertRaisesMessage(CommandError, msg):
1148.             call_command("migrate", "migrations", run_syncdb=True, verbosity=0)
1149. 
1150.     @override_settings(
1151.         INSTALLED_APPS=[
1152.             "migrations.migrations_test_apps.unmigrated_app_syncdb",
1153.             "migrations.migrations_test_apps.unmigrated_app_simple",
1154.         ]
1155.     )
1156.     def test_migrate_syncdb_app_label(self):
1157.         """
1158.         Running migrate --run-syncdb with an app_label only creates tables for
1159.         the specified app.
1160.         """
1161.         stdout = io.StringIO()
1162.         with mock.patch.object(BaseDatabaseSchemaEditor, "execute") as execute:
1163.             call_command(
1164.                 "migrate", "unmigrated_app_syncdb", run_syncdb=True, stdout=stdout
1165.             )
1166.             create_table_count = len(
1167.                 [call for call in execute.mock_calls if "CREATE TABLE" in str(call)]
1168.             )
1169.             self.assertEqual(create_table_count, 2)
1170.             self.assertGreater(len(execute.mock_calls), 2)
1171.             self.assertIn(
1172.                 "Synchronize unmigrated app: unmigrated_app_syncdb", stdout.getvalue()
1173.             )
1174. 
1175.     @override_settings(
1176.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_squashed"}
1177.     )
1178.     def test_migrate_record_replaced(self):
1179.         """
1180.         Running a single squashed migration should record all of the original
1181.         replaced migrations as run.
1182.         """
1183.         recorder = MigrationRecorder(connection)
1184.         out = io.StringIO()
1185.         call_command("migrate", "migrations", verbosity=0)
1186.         call_command("showmigrations", "migrations", stdout=out, no_color=True)
1187.         self.assertEqual(
1188.             "migrations\n [x] 0001_squashed_0002 (2 squashed migrations)\n",
1189.             out.getvalue().lower(),
1190.         )
1191.         applied_migrations = recorder.applied_migrations()
1192.         self.assertIn(("migrations", "0001_initial"), applied_migrations)
1193.         self.assertIn(("migrations", "0002_second"), applied_migrations)
1194.         self.assertIn(("migrations", "0001_squashed_0002"), applied_migrations)
1195.         # Rollback changes
1196.         call_command("migrate", "migrations", "zero", verbosity=0)
1197. 
1198.     @override_settings(
1199.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_squashed"}
1200.     )
1201.     def test_migrate_record_squashed(self):
1202.         """
1203.         Running migrate for a squashed migration should record as run
1204.         if all of the replaced migrations have been run (#25231).
1205.         """
1206.         recorder = MigrationRecorder(connection)
1207.         recorder.record_applied("migrations", "0001_initial")
1208.         recorder.record_applied("migrations", "0002_second")
1209.         out = io.StringIO()
1210.         call_command("showmigrations", "migrations", stdout=out, no_color=True)
1211.         self.assertEqual(
1212.             "migrations\n"
1213.             " [-] 0001_squashed_0002 (2 squashed migrations) "
1214.             "run 'manage.py migrate' to finish recording.\n",
1215.             out.getvalue().lower(),
1216.         )
1217. 
1218.         out = io.StringIO()
1219.         call_command("migrate", "migrations", verbosity=0)
1220.         call_command("showmigrations", "migrations", stdout=out, no_color=True)
1221.         self.assertEqual(
1222.             "migrations\n [x] 0001_squashed_0002 (2 squashed migrations)\n",
1223.             out.getvalue().lower(),
1224.         )
1225.         self.assertIn(
1226.             ("migrations", "0001_squashed_0002"), recorder.applied_migrations()
1227.         )
1228.         # No changes were actually applied so there is nothing to rollback
1229. 
1230.     def test_migrate_partially_applied_squashed_migration(self):
1231.         """
1232.         Migrating to a squashed migration specified by name should succeed
1233.         even if it is partially applied.
1234.         """
1235.         with self.temporary_migration_module(module="migrations.test_migrations"):
1236.             recorder = MigrationRecorder(connection)
1237.             try:
1238.                 call_command("migrate", "migrations", "0001_initial", verbosity=0)
1239.                 call_command(
1240.                     "squashmigrations",
1241.                     "migrations",
1242.                     "0002",
1243.                     interactive=False,
1244.                     verbosity=0,
1245.                 )
1246.                 call_command(
1247.                     "migrate",
1248.                     "migrations",
1249.                     "0001_squashed_0002_second",
1250.                     verbosity=0,
1251.                 )
1252.                 applied_migrations = recorder.applied_migrations()
1253.                 self.assertIn(("migrations", "0002_second"), applied_migrations)
1254.             finally:
1255.                 # Unmigrate everything.
1256.                 call_command("migrate", "migrations", "zero", verbosity=0)
1257. 
1258.     @override_settings(
1259.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_squashed"}
1260.     )
1261.     def test_migrate_backward_to_squashed_migration(self):
1262.         try:
1263.             call_command("migrate", "migrations", "0001_squashed_0002", verbosity=0)
1264.             self.assertTableExists("migrations_author")
1265.             self.assertTableExists("migrations_book")
1266.             call_command("migrate", "migrations", "0001_initial", verbosity=0)
1267.             self.assertTableExists("migrations_author")
1268.             self.assertTableNotExists("migrations_book")
1269.         finally:
1270.             # Unmigrate everything.
1271.             call_command("migrate", "migrations", "zero", verbosity=0)
1272. 
1273.     @override_settings(MIGRATION_MODULES={"migrations": "migrations.test_migrations"})
1274.     def test_migrate_inconsistent_history(self):
1275.         """
1276.         Running migrate with some migrations applied before their dependencies
1277.         should not be allowed.
1278.         """
1279.         recorder = MigrationRecorder(connection)
1280.         recorder.record_applied("migrations", "0002_second")
1281.         msg = (
1282.             "Migration migrations.0002_second is applied before its dependency "
1283.             "migrations.0001_initial"
1284.         )
1285.         with self.assertRaisesMessage(InconsistentMigrationHistory, msg):
1286.             call_command("migrate")
1287.         applied_migrations = recorder.applied_migrations()
1288.         self.assertNotIn(("migrations", "0001_initial"), applied_migrations)
1289. 
1290.     @override_settings(
1291.         INSTALLED_APPS=[
1292.             "migrations.migrations_test_apps.migrated_unapplied_app",
1293.             "migrations.migrations_test_apps.migrated_app",
1294.         ]
1295.     )
1296.     def test_migrate_not_reflected_changes(self):
1297.         class NewModel1(models.Model):
1298.             class Meta:
1299.                 app_label = "migrated_app"
1300. 
1301.         class NewModel2(models.Model):
1302.             class Meta:
1303.                 app_label = "migrated_unapplied_app"
1304. 
1305.         out = io.StringIO()
1306.         try:
1307.             call_command("migrate", verbosity=0)
1308.             call_command("migrate", stdout=out, no_color=True)
1309.             self.assertEqual(
1310.                 "operations to perform:\n"
1311.                 "  apply all migrations: migrated_app, migrated_unapplied_app\n"
1312.                 "running migrations:\n"
1313.                 "  no migrations to apply.\n"
1314.                 "  your models in app(s): 'migrated_app', "
1315.                 "'migrated_unapplied_app' have changes that are not yet "
1316.                 "reflected in a migration, and so won't be applied.\n"
1317.                 "  run 'manage.py makemigrations' to make new migrations, and "
1318.                 "then re-run 'manage.py migrate' to apply them.\n",
1319.                 out.getvalue().lower(),
1320.             )
1321.         finally:
1322.             # Unmigrate everything.
1323.             call_command("migrate", "migrated_app", "zero", verbosity=0)
1324.             call_command("migrate", "migrated_unapplied_app", "zero", verbosity=0)
1325. 
1326.     @override_settings(
1327.         MIGRATION_MODULES={
1328.             "migrations": "migrations.test_migrations_squashed_no_replaces",
1329.         }
1330.     )
1331.     def test_migrate_prune(self):
1332.         """
1333.         With prune=True, references to migration files deleted from the
1334.         migrations module (such as after being squashed) are removed from the
1335.         django_migrations table.
1336.         """
1337.         recorder = MigrationRecorder(connection)
1338.         recorder.record_applied("migrations", "0001_initial")
1339.         recorder.record_applied("migrations", "0002_second")
1340.         recorder.record_applied("migrations", "0001_squashed_0002")
1341.         out = io.StringIO()
1342.         try:
1343.             call_command("migrate", "migrations", prune=True, stdout=out, no_color=True)
1344.             self.assertEqual(
1345.                 out.getvalue(),
1346.                 "Pruning migrations:\n"
1347.                 "  Pruning migrations.0001_initial OK\n"
1348.                 "  Pruning migrations.0002_second OK\n",
1349.             )
1350.             applied_migrations = [
1351.                 migration
1352.                 for migration in recorder.applied_migrations()
1353.                 if migration[0] == "migrations"
1354.             ]
1355.             self.assertEqual(applied_migrations, [("migrations", "0001_squashed_0002")])
1356.         finally:
1357.             recorder.record_unapplied("migrations", "0001_initial")
1358.             recorder.record_unapplied("migrations", "0001_second")
1359.             recorder.record_unapplied("migrations", "0001_squashed_0002")
1360. 
1361.     @override_settings(
1362.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_squashed"}
1363.     )
1364.     def test_prune_deleted_squashed_migrations_in_replaces(self):
1365.         out = io.StringIO()
1366.         with self.temporary_migration_module(
1367.             module="migrations.test_migrations_squashed"
1368.         ) as migration_dir:
1369.             try:
1370.                 call_command("migrate", "migrations", verbosity=0)
1371.                 # Delete the replaced migrations.
1372.                 os.remove(os.path.join(migration_dir, "0001_initial.py"))
1373.                 os.remove(os.path.join(migration_dir, "0002_second.py"))
1374.                 # --prune cannot be used before removing the "replaces"
1375.                 # attribute.
1376.                 call_command(
1377.                     "migrate",
1378.                     "migrations",
1379.                     prune=True,
1380.                     stdout=out,
1381.                     no_color=True,
1382.                 )
1383.                 self.assertEqual(
1384.                     out.getvalue(),
1385.                     "Pruning migrations:\n"
1386.                     "  Cannot use --prune because the following squashed "
1387.                     "migrations have their 'replaces' attributes and may not "
1388.                     "be recorded as applied:\n"
1389.                     "    migrations.0001_squashed_0002\n"
1390.                     "  Re-run 'manage.py migrate' if they are not marked as "
1391.                     "applied, and remove 'replaces' attributes in their "
1392.                     "Migration classes.\n",
1393.                 )
1394.             finally:
1395.                 # Unmigrate everything.
1396.                 call_command("migrate", "migrations", "zero", verbosity=0)
1397. 
1398.     @override_settings(
1399.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_squashed"}
1400.     )
1401.     def test_prune_no_migrations_to_prune(self):
1402.         out = io.StringIO()
1403.         call_command("migrate", "migrations", prune=True, stdout=out, no_color=True)
1404.         self.assertEqual(
1405.             out.getvalue(),
1406.             "Pruning migrations:\n  No migrations to prune.\n",
1407.         )
1408.         out = io.StringIO()
1409.         call_command(
1410.             "migrate",
1411.             "migrations",
1412.             prune=True,
1413.             stdout=out,
1414.             no_color=True,
1415.             verbosity=0,
1416.         )
1417.         self.assertEqual(out.getvalue(), "")
1418. 
1419.     def test_prune_no_app_label(self):
1420.         msg = "Migrations can be pruned only when an app is specified."
1421.         with self.assertRaisesMessage(CommandError, msg):
1422.             call_command("migrate", prune=True)
1423. 
1424. 
1425. class MakeMigrationsTests(MigrationTestBase):
1426.     """
1427.     Tests running the makemigrations command.
1428.     """
1429. 
1430.     def setUp(self):
1431.         super().setUp()
1432.         self._old_models = apps.app_configs["migrations"].models.copy()
1433. 
1434.     def tearDown(self):
1435.         apps.app_configs["migrations"].models = self._old_models
1436.         apps.all_models["migrations"] = self._old_models
1437.         apps.clear_cache()
1438.         super().tearDown()
1439. 
1440.     def test_files_content(self):
1441.         self.assertTableNotExists("migrations_unicodemodel")
1442.         apps.register_model("migrations", UnicodeModel)
1443.         with self.temporary_migration_module() as migration_dir:
1444.             call_command("makemigrations", "migrations", verbosity=0)
1445. 
1446.             # Check for empty __init__.py file in migrations folder
1447.             init_file = os.path.join(migration_dir, "__init__.py")
1448.             self.assertTrue(os.path.exists(init_file))
1449. 
1450.             with open(init_file) as fp:
1451.                 content = fp.read()
1452.             self.assertEqual(content, "")
1453. 
1454.             # Check for existing 0001_initial.py file in migration folder
1455.             initial_file = os.path.join(migration_dir, "0001_initial.py")
1456.             self.assertTrue(os.path.exists(initial_file))
1457. 
1458.             with open(initial_file, encoding="utf-8") as fp:
1459.                 content = fp.read()
1460.                 self.assertIn("migrations.CreateModel", content)
1461.                 self.assertIn("initial = True", content)
1462. 
1463.                 self.assertIn("úñí©óðé µóðéø", content)  # Meta.verbose_name
1464.                 self.assertIn("úñí©óðé µóðéøß", content)  # Meta.verbose_name_plural
1465.                 self.assertIn("ÚÑÍ¢ÓÐÉ", content)  # title.verbose_name
1466.                 self.assertIn("“Ðjáñgó”", content)  # title.default
1467. 
1468.     def test_makemigrations_order(self):
1469.         """
1470.         makemigrations should recognize number-only migrations (0001.py).
1471.         """
1472.         module = "migrations.test_migrations_order"
1473.         with self.temporary_migration_module(module=module) as migration_dir:
1474.             if hasattr(importlib, "invalidate_caches"):
1475.                 # importlib caches os.listdir() on some platforms like macOS
1476.                 # (#23850).
1477.                 importlib.invalidate_caches()
1478.             call_command(
1479.                 "makemigrations", "migrations", "--empty", "-n", "a", "-v", "0"
1480.             )
1481.             self.assertTrue(os.path.exists(os.path.join(migration_dir, "0002_a.py")))
1482. 
1483.     def test_makemigrations_empty_connections(self):
1484.         empty_connections = ConnectionHandler({"default": {}})
1485.         with mock.patch(
1486.             "django.core.management.commands.makemigrations.connections",
1487.             new=empty_connections,
1488.         ):
1489.             # with no apps
1490.             out = io.StringIO()
1491.             call_command("makemigrations", stdout=out)
1492.             self.assertIn("No changes detected", out.getvalue())
1493.             # with an app
1494.             with self.temporary_migration_module() as migration_dir:
1495.                 call_command("makemigrations", "migrations", verbosity=0)
1496.                 init_file = os.path.join(migration_dir, "__init__.py")
1497.                 self.assertTrue(os.path.exists(init_file))
1498. 
1499.     @override_settings(INSTALLED_APPS=["migrations", "migrations2"])
1500.     def test_makemigrations_consistency_checks_respect_routers(self):
1501.         """
1502.         The history consistency checks in makemigrations respect
1503.         settings.DATABASE_ROUTERS.
1504.         """
1505. 
1506.         def patched_has_table(migration_recorder):
1507.             if migration_recorder.connection is connections["other"]:
1508.                 raise Exception("Other connection")
1509.             else:
1510.                 return mock.DEFAULT
1511. 
1512.         self.assertTableNotExists("migrations_unicodemodel")
1513.         apps.register_model("migrations", UnicodeModel)
1514.         with mock.patch.object(
1515.             MigrationRecorder, "has_table", autospec=True, side_effect=patched_has_table
1516.         ) as has_table:
1517.             with self.temporary_migration_module() as migration_dir:
1518.                 call_command("makemigrations", "migrations", verbosity=0)
1519.                 initial_file = os.path.join(migration_dir, "0001_initial.py")
1520.                 self.assertTrue(os.path.exists(initial_file))
1521.                 self.assertEqual(has_table.call_count, 1)  # 'default' is checked
1522. 
1523.                 # Router says not to migrate 'other' so consistency shouldn't
1524.                 # be checked.
1525.                 with self.settings(DATABASE_ROUTERS=["migrations.routers.TestRouter"]):
1526.                     call_command("makemigrations", "migrations", verbosity=0)
1527.                 self.assertEqual(has_table.call_count, 2)  # 'default' again
1528. 
1529.                 # With a router that doesn't prohibit migrating 'other',
1530.                 # consistency is checked.
1531.                 with self.settings(
1532.                     DATABASE_ROUTERS=["migrations.routers.DefaultOtherRouter"]
1533.                 ):
1534.                     with self.assertRaisesMessage(Exception, "Other connection"):
1535.                         call_command("makemigrations", "migrations", verbosity=0)
1536.                 self.assertEqual(has_table.call_count, 4)  # 'default' and 'other'
1537. 
1538.                 # With a router that doesn't allow migrating on any database,
1539.                 # no consistency checks are made.
1540.                 with self.settings(DATABASE_ROUTERS=["migrations.routers.TestRouter"]):
1541.                     with mock.patch.object(
1542.                         TestRouter, "allow_migrate", return_value=False
1543.                     ) as allow_migrate:
1544.                         call_command("makemigrations", "migrations", verbosity=0)
1545.                 allow_migrate.assert_any_call(
1546.                     "other", "migrations", model_name="UnicodeModel"
1547.                 )
1548.                 # allow_migrate() is called with the correct arguments.
1549.                 self.assertGreater(len(allow_migrate.mock_calls), 0)
1550.                 called_aliases = set()
1551.                 for mock_call in allow_migrate.mock_calls:
1552.                     _, call_args, call_kwargs = mock_call
1553.                     connection_alias, app_name = call_args
1554.                     called_aliases.add(connection_alias)
1555.                     # Raises an error if invalid app_name/model_name occurs.
1556.                     apps.get_app_config(app_name).get_model(call_kwargs["model_name"])
1557.                 self.assertEqual(called_aliases, set(connections))
1558.                 self.assertEqual(has_table.call_count, 4)
1559. 
1560.     def test_failing_migration(self):
1561.         # If a migration fails to serialize, it shouldn't generate an empty file. #21280
1562.         apps.register_model("migrations", UnserializableModel)
1563. 
1564.         with self.temporary_migration_module() as migration_dir:
1565.             with self.assertRaisesMessage(ValueError, "Cannot serialize"):
1566.                 call_command("makemigrations", "migrations", verbosity=0)
1567. 
1568.             initial_file = os.path.join(migration_dir, "0001_initial.py")
1569.             self.assertFalse(os.path.exists(initial_file))
1570. 
1571.     def test_makemigrations_conflict_exit(self):
1572.         """
1573.         makemigrations exits if it detects a conflict.
1574.         """
1575.         with self.temporary_migration_module(
1576.             module="migrations.test_migrations_conflict"
1577.         ):
1578.             with self.assertRaises(CommandError) as context:
1579.                 call_command("makemigrations")
1580.         self.assertEqual(
1581.             str(context.exception),
1582.             "Conflicting migrations detected; multiple leaf nodes in the "
1583.             "migration graph: (0002_conflicting_second, 0002_second in "
1584.             "migrations).\n"
1585.             "To fix them run 'python manage.py makemigrations --merge'",
1586.         )
1587. 
1588.     def test_makemigrations_merge_no_conflict(self):
1589.         """
1590.         makemigrations exits if in merge mode with no conflicts.
1591.         """
1592.         out = io.StringIO()
1593.         with self.temporary_migration_module(module="migrations.test_migrations"):
1594.             call_command("makemigrations", merge=True, stdout=out)
1595.         self.assertIn("No conflicts detected to merge.", out.getvalue())
1596. 
1597.     def test_makemigrations_empty_no_app_specified(self):
1598.         """
1599.         makemigrations exits if no app is specified with 'empty' mode.
1600.         """
1601.         msg = "You must supply at least one app label when using --empty."
1602.         with self.assertRaisesMessage(CommandError, msg):
1603.             call_command("makemigrations", empty=True)
1604. 
1605.     def test_makemigrations_empty_migration(self):
1606.         """
1607.         makemigrations properly constructs an empty migration.
1608.         """
1609.         with self.temporary_migration_module() as migration_dir:
1610.             call_command("makemigrations", "migrations", empty=True, verbosity=0)
1611. 
1612.             # Check for existing 0001_initial.py file in migration folder
1613.             initial_file = os.path.join(migration_dir, "0001_initial.py")
1614.             self.assertTrue(os.path.exists(initial_file))
1615. 
1616.             with open(initial_file, encoding="utf-8") as fp:
1617.                 content = fp.read()
1618. 
1619.                 # Remove all whitespace to check for empty dependencies and operations
1620.                 content = content.replace(" ", "")
1621.                 self.assertIn(
1622.                     "dependencies=[]" if HAS_BLACK else "dependencies=[\n]", content
1623.                 )
1624.                 self.assertIn(
1625.                     "operations=[]" if HAS_BLACK else "operations=[\n]", content
1626.                 )
1627. 
1628.     @override_settings(MIGRATION_MODULES={"migrations": None})
1629.     def test_makemigrations_disabled_migrations_for_app(self):
1630.         """
1631.         makemigrations raises a nice error when migrations are disabled for an
1632.         app.
1633.         """
1634.         msg = (
1635.             "Django can't create migrations for app 'migrations' because migrations "
1636.             "have been disabled via the MIGRATION_MODULES setting."
1637.         )
1638.         with self.assertRaisesMessage(ValueError, msg):
1639.             call_command("makemigrations", "migrations", empty=True, verbosity=0)
1640. 
1641.     def test_makemigrations_no_changes_no_apps(self):
1642.         """
1643.         makemigrations exits when there are no changes and no apps are specified.
1644.         """
1645.         out = io.StringIO()
1646.         call_command("makemigrations", stdout=out)
1647.         self.assertIn("No changes detected", out.getvalue())
1648. 
1649.     def test_makemigrations_no_changes(self):
1650.         """
1651.         makemigrations exits when there are no changes to an app.
1652.         """
1653.         out = io.StringIO()
1654.         with self.temporary_migration_module(
1655.             module="migrations.test_migrations_no_changes"
1656.         ):
1657.             call_command("makemigrations", "migrations", stdout=out)
1658.         self.assertIn("No changes detected in app 'migrations'", out.getvalue())
1659. 
1660.     def test_makemigrations_no_apps_initial(self):
1661.         """
1662.         makemigrations should detect initial is needed on empty migration
1663.         modules if no app provided.
1664.         """
1665.         out = io.StringIO()
1666.         with self.temporary_migration_module(module="migrations.test_migrations_empty"):
1667.             call_command("makemigrations", stdout=out)
1668.         self.assertIn("0001_initial.py", out.getvalue())
1669. 
1670.     def test_makemigrations_no_init(self):
1671.         """Migration directories without an __init__.py file are allowed."""
1672.         out = io.StringIO()
1673.         with self.temporary_migration_module(
1674.             module="migrations.test_migrations_no_init"
1675.         ):
1676.             call_command("makemigrations", stdout=out)
1677.         self.assertIn("0001_initial.py", out.getvalue())
1678. 
1679.     def test_makemigrations_migrations_announce(self):
1680.         """
1681.         makemigrations announces the migration at the default verbosity level.
1682.         """
1683.         out = io.StringIO()
1684.         with self.temporary_migration_module():
1685.             call_command("makemigrations", "migrations", stdout=out)
1686.         self.assertIn("Migrations for 'migrations'", out.getvalue())
1687. 
1688.     def test_makemigrations_no_common_ancestor(self):
1689.         """
1690.         makemigrations fails to merge migrations with no common ancestor.
1691.         """
1692.         with self.assertRaises(ValueError) as context:
1693.             with self.temporary_migration_module(
1694.                 module="migrations.test_migrations_no_ancestor"
1695.             ):
1696.                 call_command("makemigrations", "migrations", merge=True)
1697.         exception_message = str(context.exception)
1698.         self.assertIn("Could not find common ancestor of", exception_message)
1699.         self.assertIn("0002_second", exception_message)
1700.         self.assertIn("0002_conflicting_second", exception_message)
1701. 
1702.     def test_makemigrations_interactive_reject(self):
1703.         """
1704.         makemigrations enters and exits interactive mode properly.
1705.         """
1706.         # Monkeypatch interactive questioner to auto reject
1707.         with mock.patch("builtins.input", mock.Mock(return_value="N")):
1708.             with self.temporary_migration_module(
1709.                 module="migrations.test_migrations_conflict"
1710.             ) as migration_dir:
1711.                 with captured_stdout():
1712.                     call_command(
1713.                         "makemigrations",
1714.                         "migrations",
1715.                         name="merge",
1716.                         merge=True,
1717.                         interactive=True,
1718.                         verbosity=0,
1719.                     )
1720.                 merge_file = os.path.join(migration_dir, "0003_merge.py")
1721.                 self.assertFalse(os.path.exists(merge_file))
1722. 
1723.     def test_makemigrations_interactive_accept(self):
1724.         """
1725.         makemigrations enters interactive mode and merges properly.
1726.         """
1727.         # Monkeypatch interactive questioner to auto accept
1728.         with mock.patch("builtins.input", mock.Mock(return_value="y")):
1729.             out = io.StringIO()
1730.             with self.temporary_migration_module(
1731.                 module="migrations.test_migrations_conflict"
1732.             ) as migration_dir:
1733.                 call_command(
1734.                     "makemigrations",
1735.                     "migrations",
1736.                     name="merge",
1737.                     merge=True,
1738.                     interactive=True,
1739.                     stdout=out,
1740.                 )
1741.                 merge_file = os.path.join(migration_dir, "0003_merge.py")
1742.                 self.assertTrue(os.path.exists(merge_file))
1743.             self.assertIn("Created new merge migration", out.getvalue())
1744. 
1745.     def test_makemigrations_default_merge_name(self):
1746.         out = io.StringIO()
1747.         with self.temporary_migration_module(
1748.             module="migrations.test_migrations_conflict"
1749.         ) as migration_dir:
1750.             call_command(
1751.                 "makemigrations",
1752.                 "migrations",
1753.                 merge=True,
1754.                 interactive=False,
1755.                 stdout=out,
1756.             )
1757.             merge_file = os.path.join(
1758.                 migration_dir,
1759.                 "0003_merge_0002_conflicting_second_0002_second.py",
1760.             )
1761.             self.assertIs(os.path.exists(merge_file), True)
1762.             with open(merge_file, encoding="utf-8") as fp:
1763.                 content = fp.read()
1764.             if HAS_BLACK:
1765.                 target_str = '("migrations", "0002_conflicting_second")'
1766.             else:
1767.                 target_str = "('migrations', '0002_conflicting_second')"
1768.             self.assertIn(target_str, content)
1769.         self.assertIn("Created new merge migration %s" % merge_file, out.getvalue())
1770. 
1771.     @mock.patch("django.db.migrations.utils.datetime")
1772.     def test_makemigrations_auto_merge_name(self, mock_datetime):
1773.         mock_datetime.datetime.now.return_value = datetime.datetime(2016, 1, 2, 3, 4)
1774.         with mock.patch("builtins.input", mock.Mock(return_value="y")):
1775.             out = io.StringIO()
1776.             with self.temporary_migration_module(
1777.                 module="migrations.test_migrations_conflict_long_name"
1778.             ) as migration_dir:
1779.                 call_command(
1780.                     "makemigrations",
1781.                     "migrations",
1782.                     merge=True,
1783.                     interactive=True,
1784.                     stdout=out,
1785.                 )
1786.                 merge_file = os.path.join(migration_dir, "0003_merge_20160102_0304.py")
1787.                 self.assertTrue(os.path.exists(merge_file))
1788.             self.assertIn("Created new merge migration", out.getvalue())
1789. 
1790.     def test_makemigrations_non_interactive_not_null_addition(self):
1791.         """
1792.         Non-interactive makemigrations fails when a default is missing on a
1793.         new not-null field.
1794.         """
1795. 
1796.         class SillyModel(models.Model):
1797.             silly_field = models.BooleanField(default=False)
1798.             silly_int = models.IntegerField()
1799. 
1800.             class Meta:
1801.                 app_label = "migrations"
1802. 
1803.         with self.assertRaises(SystemExit):
1804.             with self.temporary_migration_module(
1805.                 module="migrations.test_migrations_no_default"
1806.             ):
1807.                 with captured_stdout() as out:
1808.                     call_command("makemigrations", "migrations", interactive=False)
1809.         self.assertIn(
1810.             "Field 'silly_int' on model 'sillymodel' not migrated: it is "
1811.             "impossible to add a non-nullable field without specifying a "
1812.             "default.",
1813.             out.getvalue(),
1814.         )
1815. 
1816.     def test_makemigrations_interactive_not_null_addition(self):
1817.         """
1818.         makemigrations messages when adding a NOT NULL field in interactive
1819.         mode.
1820.         """
1821. 
1822.         class Author(models.Model):
1823.             silly_field = models.BooleanField(null=False)
1824. 
1825.             class Meta:
1826.                 app_label = "migrations"
1827. 
1828.         input_msg = (
1829.             "It is impossible to add a non-nullable field 'silly_field' to "
1830.             "author without specifying a default. This is because the "
1831.             "database needs something to populate existing rows.\n"
1832.             "Please select a fix:\n"
1833.             " 1) Provide a one-off default now (will be set on all existing "
1834.             "rows with a null value for this column)\n"
1835.             " 2) Quit and manually define a default value in models.py."
1836.         )
1837.         with self.temporary_migration_module(module="migrations.test_migrations"):
1838.             # 2 - quit.
1839.             with mock.patch("builtins.input", return_value="2"):
1840.                 with captured_stdout() as out, self.assertRaises(SystemExit):
1841.                     call_command("makemigrations", "migrations", interactive=True)
1842.             self.assertIn(input_msg, out.getvalue())
1843.             # 1 - provide a default.
1844.             with mock.patch("builtins.input", return_value="1"):
1845.                 with captured_stdout() as out:
1846.                     call_command("makemigrations", "migrations", interactive=True)
1847.             output = out.getvalue()
1848.             self.assertIn(input_msg, output)
1849.             self.assertIn("Please enter the default value as valid Python.", output)
1850.             self.assertIn(
1851.                 "The datetime and django.utils.timezone modules are "
1852.                 "available, so it is possible to provide e.g. timezone.now as "
1853.                 "a value",
1854.                 output,
1855.             )
1856.             self.assertIn("Type 'exit' to exit this prompt", output)
1857. 
1858.     def test_makemigrations_non_interactive_not_null_alteration(self):
1859.         """
1860.         Non-interactive makemigrations fails when a default is missing on a
1861.         field changed to not-null.
1862.         """
1863. 
1864.         class Author(models.Model):
1865.             name = models.CharField(max_length=255)
1866.             slug = models.SlugField()
1867.             age = models.IntegerField(default=0)
1868. 
1869.             class Meta:
1870.                 app_label = "migrations"
1871. 
1872.         with self.temporary_migration_module(module="migrations.test_migrations"):
1873.             with captured_stdout() as out:
1874.                 call_command("makemigrations", "migrations", interactive=False)
1875.         self.assertIn("Alter field slug on author", out.getvalue())
1876.         self.assertIn(
1877.             "Field 'slug' on model 'author' given a default of NOT PROVIDED "
1878.             "and must be corrected.",
1879.             out.getvalue(),
1880.         )
1881. 
1882.     def test_makemigrations_interactive_not_null_alteration(self):
1883.         """
1884.         makemigrations messages when changing a NULL field to NOT NULL in
1885.         interactive mode.
1886.         """
1887. 
1888.         class Author(models.Model):
1889.             slug = models.SlugField(null=False)
1890. 
1891.             class Meta:
1892.                 app_label = "migrations"
1893. 
1894.         input_msg = (
1895.             "It is impossible to change a nullable field 'slug' on author to "
1896.             "non-nullable without providing a default. This is because the "
1897.             "database needs something to populate existing rows.\n"
1898.             "Please select a fix:\n"
1899.             " 1) Provide a one-off default now (will be set on all existing "
1900.             "rows with a null value for this column)\n"
1901.             " 2) Ignore for now. Existing rows that contain NULL values will "
1902.             "have to be handled manually, for example with a RunPython or "
1903.             "RunSQL operation.\n"
1904.             " 3) Quit and manually define a default value in models.py."
1905.         )
1906.         with self.temporary_migration_module(module="migrations.test_migrations"):
1907.             # No message appears if --dry-run.
1908.             with captured_stdout() as out:
1909.                 call_command(
1910.                     "makemigrations",
1911.                     "migrations",
1912.                     interactive=True,
1913.                     dry_run=True,
1914.                 )
1915.             self.assertNotIn(input_msg, out.getvalue())
1916.             # 3 - quit.
1917.             with mock.patch("builtins.input", return_value="3"):
1918.                 with captured_stdout() as out, self.assertRaises(SystemExit):
1919.                     call_command("makemigrations", "migrations", interactive=True)
1920.             self.assertIn(input_msg, out.getvalue())
1921.             # 1 - provide a default.
1922.             with mock.patch("builtins.input", return_value="1"):
1923.                 with captured_stdout() as out:
1924.                     call_command("makemigrations", "migrations", interactive=True)
1925.             output = out.getvalue()
1926.             self.assertIn(input_msg, output)
1927.             self.assertIn("Please enter the default value as valid Python.", output)
1928.             self.assertIn(
1929.                 "The datetime and django.utils.timezone modules are "
1930.                 "available, so it is possible to provide e.g. timezone.now as "
1931.                 "a value",
1932.                 output,
1933.             )
1934.             self.assertIn("Type 'exit' to exit this prompt", output)
1935. 
1936.     def test_makemigrations_non_interactive_no_model_rename(self):
1937.         """
1938.         makemigrations adds and removes a possible model rename in
1939.         non-interactive mode.
1940.         """
1941. 
1942.         class RenamedModel(models.Model):
1943.             silly_field = models.BooleanField(default=False)
1944. 
1945.             class Meta:
1946.                 app_label = "migrations"
1947. 
1948.         out = io.StringIO()
1949.         with self.temporary_migration_module(
1950.             module="migrations.test_migrations_no_default"
1951.         ):
1952.             call_command("makemigrations", "migrations", interactive=False, stdout=out)
1953.         self.assertIn("Delete model SillyModel", out.getvalue())
1954.         self.assertIn("Create model RenamedModel", out.getvalue())
1955. 
1956.     def test_makemigrations_non_interactive_no_field_rename(self):
1957.         """
1958.         makemigrations adds and removes a possible field rename in
1959.         non-interactive mode.
1960.         """
1961. 
1962.         class SillyModel(models.Model):
1963.             silly_rename = models.BooleanField(default=False)
1964. 
1965.             class Meta:
1966.                 app_label = "migrations"
1967. 
1968.         out = io.StringIO()
1969.         with self.temporary_migration_module(
1970.             module="migrations.test_migrations_no_default"
1971.         ):
1972.             call_command("makemigrations", "migrations", interactive=False, stdout=out)
1973.         self.assertIn("Remove field silly_field from sillymodel", out.getvalue())
1974.         self.assertIn("Add field silly_rename to sillymodel", out.getvalue())
1975. 
1976.     @mock.patch("builtins.input", return_value="Y")
1977.     def test_makemigrations_model_rename_interactive(self, mock_input):
1978.         class RenamedModel(models.Model):
1979.             silly_field = models.BooleanField(default=False)
1980. 
1981.             class Meta:
1982.                 app_label = "migrations"
1983. 
1984.         with self.temporary_migration_module(
1985.             module="migrations.test_migrations_no_default",
1986.         ):
1987.             with captured_stdout() as out:
1988.                 call_command("makemigrations", "migrations", interactive=True)
1989.         self.assertIn("Rename model SillyModel to RenamedModel", out.getvalue())
1990. 
1991.     @mock.patch("builtins.input", return_value="Y")
1992.     def test_makemigrations_field_rename_interactive(self, mock_input):
1993.         class SillyModel(models.Model):
1994.             silly_rename = models.BooleanField(default=False)
1995. 
1996.             class Meta:
1997.                 app_label = "migrations"
1998. 
1999.         with self.temporary_migration_module(
2000.             module="migrations.test_migrations_no_default",
2001.         ):
2002.             with captured_stdout() as out:
2003.                 call_command("makemigrations", "migrations", interactive=True)
2004.         self.assertIn(
2005.             "Rename field silly_field on sillymodel to silly_rename",
2006.             out.getvalue(),
2007.         )
2008. 
2009.     def test_makemigrations_handle_merge(self):
2010.         """
2011.         makemigrations properly merges the conflicting migrations with --noinput.
2012.         """
2013.         out = io.StringIO()
2014.         with self.temporary_migration_module(
2015.             module="migrations.test_migrations_conflict"
2016.         ) as migration_dir:
2017.             call_command(
2018.                 "makemigrations",
2019.                 "migrations",
2020.                 name="merge",
2021.                 merge=True,
2022.                 interactive=False,
2023.                 stdout=out,
2024.             )
2025.             merge_file = os.path.join(migration_dir, "0003_merge.py")
2026.             self.assertTrue(os.path.exists(merge_file))
2027.         output = out.getvalue()
2028.         self.assertIn("Merging migrations", output)
2029.         self.assertIn("Branch 0002_second", output)
2030.         self.assertIn("Branch 0002_conflicting_second", output)
2031.         self.assertIn("Created new merge migration", output)
2032. 
2033.     def test_makemigration_merge_dry_run(self):
2034.         """
2035.         makemigrations respects --dry-run option when fixing migration
2036.         conflicts (#24427).
2037.         """
2038.         out = io.StringIO()
2039.         with self.temporary_migration_module(
2040.             module="migrations.test_migrations_conflict"
2041.         ) as migration_dir:
2042.             call_command(
2043.                 "makemigrations",
2044.                 "migrations",
2045.                 name="merge",
2046.                 dry_run=True,
2047.                 merge=True,
2048.                 interactive=False,
2049.                 stdout=out,
2050.             )
2051.             merge_file = os.path.join(migration_dir, "0003_merge.py")
2052.             self.assertFalse(os.path.exists(merge_file))
2053.         output = out.getvalue()
2054.         self.assertIn("Merging migrations", output)
2055.         self.assertIn("Branch 0002_second", output)
2056.         self.assertIn("Branch 0002_conflicting_second", output)
2057.         self.assertNotIn("Created new merge migration", output)
2058. 
2059.     def test_makemigration_merge_dry_run_verbosity_3(self):
2060.         """
2061.         `makemigrations --merge --dry-run` writes the merge migration file to
2062.         stdout with `verbosity == 3` (#24427).
2063.         """
2064.         out = io.StringIO()
2065.         with self.temporary_migration_module(
2066.             module="migrations.test_migrations_conflict"
2067.         ) as migration_dir:
2068.             call_command(
2069.                 "makemigrations",
2070.                 "migrations",
2071.                 name="merge",
2072.                 dry_run=True,
2073.                 merge=True,
2074.                 interactive=False,
2075.                 stdout=out,
2076.                 verbosity=3,
2077.             )
2078.             merge_file = os.path.join(migration_dir, "0003_merge.py")
2079.             self.assertFalse(os.path.exists(merge_file))
2080.         output = out.getvalue()
2081.         self.assertIn("Merging migrations", output)
2082.         self.assertIn("Branch 0002_second", output)
2083.         self.assertIn("Branch 0002_conflicting_second", output)
2084.         self.assertNotIn("Created new merge migration", output)
2085. 
2086.         # Additional output caused by verbosity 3
2087.         # The complete merge migration file that would be written
2088.         self.assertIn("class Migration(migrations.Migration):", output)
2089.         self.assertIn("dependencies = [", output)
2090.         self.assertIn("('migrations', '0002_second')", output)
2091.         self.assertIn("('migrations', '0002_conflicting_second')", output)
2092.         self.assertIn("operations = [", output)
2093.         self.assertIn("]", output)
2094. 
2095.     def test_makemigrations_dry_run(self):
2096.         """
2097.         `makemigrations --dry-run` should not ask for defaults.
2098.         """
2099. 
2100.         class SillyModel(models.Model):
2101.             silly_field = models.BooleanField(default=False)
2102.             silly_date = models.DateField()  # Added field without a default
2103.             silly_auto_now = models.DateTimeField(auto_now_add=True)
2104. 
2105.             class Meta:
2106.                 app_label = "migrations"
2107. 
2108.         out = io.StringIO()
2109.         with self.temporary_migration_module(
2110.             module="migrations.test_migrations_no_default"
2111.         ):
2112.             call_command("makemigrations", "migrations", dry_run=True, stdout=out)
2113.         # Output the expected changes directly, without asking for defaults
2114.         self.assertIn("Add field silly_date to sillymodel", out.getvalue())
2115. 
2116.     def test_makemigrations_dry_run_verbosity_3(self):
2117.         """
2118.         Allow `makemigrations --dry-run` to output the migrations file to
2119.         stdout (with verbosity == 3).
2120.         """
2121. 
2122.         class SillyModel(models.Model):
2123.             silly_field = models.BooleanField(default=False)
2124.             silly_char = models.CharField(default="")
2125. 
2126.             class Meta:
2127.                 app_label = "migrations"
2128. 
2129.         out = io.StringIO()
2130.         with self.temporary_migration_module(
2131.             module="migrations.test_migrations_no_default"
2132.         ):
2133.             call_command(
2134.                 "makemigrations", "migrations", dry_run=True, stdout=out, verbosity=3
2135.             )
2136. 
2137.         # Normal --dry-run output
2138.         self.assertIn("- Add field silly_char to sillymodel", out.getvalue())
2139. 
2140.         # Additional output caused by verbosity 3
2141.         # The complete migrations file that would be written
2142.         self.assertIn("class Migration(migrations.Migration):", out.getvalue())
2143.         self.assertIn("dependencies = [", out.getvalue())
2144.         self.assertIn("('migrations', '0001_initial'),", out.getvalue())
2145.         self.assertIn("migrations.AddField(", out.getvalue())
2146.         self.assertIn("model_name='sillymodel',", out.getvalue())
2147.         self.assertIn("name='silly_char',", out.getvalue())
2148. 
2149.     def test_makemigrations_scriptable(self):
2150.         """
2151.         With scriptable=True, log output is diverted to stderr, and only the
2152.         paths of generated migration files are written to stdout.
2153.         """
2154.         out = io.StringIO()
2155.         err = io.StringIO()
2156.         with self.temporary_migration_module(
2157.             module="migrations.migrations.test_migrations",
2158.         ) as migration_dir:
2159.             call_command(
2160.                 "makemigrations",
2161.                 "migrations",
2162.                 scriptable=True,
2163.                 stdout=out,
2164.                 stderr=err,
2165.             )
2166.         initial_file = os.path.join(migration_dir, "0001_initial.py")
2167.         self.assertEqual(out.getvalue(), f"{initial_file}\n")
2168.         self.assertIn("    - Create model ModelWithCustomBase\n", err.getvalue())
2169. 
2170.     @mock.patch("builtins.input", return_value="Y")
2171.     def test_makemigrations_scriptable_merge(self, mock_input):
2172.         out = io.StringIO()
2173.         err = io.StringIO()
2174.         with self.temporary_migration_module(
2175.             module="migrations.test_migrations_conflict",
2176.         ) as migration_dir:
2177.             call_command(
2178.                 "makemigrations",
2179.                 "migrations",
2180.                 merge=True,
2181.                 name="merge",
2182.                 scriptable=True,
2183.                 stdout=out,
2184.                 stderr=err,
2185.             )
2186.         merge_file = os.path.join(migration_dir, "0003_merge.py")
2187.         self.assertEqual(out.getvalue(), f"{merge_file}\n")
2188.         self.assertIn(f"Created new merge migration {merge_file}", err.getvalue())
2189. 
2190.     def test_makemigrations_migrations_modules_path_not_exist(self):
2191.         """
2192.         makemigrations creates migrations when specifying a custom location
2193.         for migration files using MIGRATION_MODULES if the custom path
2194.         doesn't already exist.
2195.         """
2196. 
2197.         class SillyModel(models.Model):
2198.             silly_field = models.BooleanField(default=False)
2199. 
2200.             class Meta:
2201.                 app_label = "migrations"
2202. 
2203.         out = io.StringIO()
2204.         migration_module = "migrations.test_migrations_path_doesnt_exist.foo.bar"
2205.         with self.temporary_migration_module(module=migration_module) as migration_dir:
2206.             call_command("makemigrations", "migrations", stdout=out)
2207. 
2208.             # Migrations file is actually created in the expected path.
2209.             initial_file = os.path.join(migration_dir, "0001_initial.py")
2210.             self.assertTrue(os.path.exists(initial_file))
2211. 
2212.         # Command output indicates the migration is created.
2213.         self.assertIn(" - Create model SillyModel", out.getvalue())
2214. 
2215.     @override_settings(MIGRATION_MODULES={"migrations": "some.nonexistent.path"})
2216.     def test_makemigrations_migrations_modules_nonexistent_toplevel_package(self):
2217.         msg = (
2218.             "Could not locate an appropriate location to create migrations "
2219.             "package some.nonexistent.path. Make sure the toplevel package "
2220.             "exists and can be imported."
2221.         )
2222.         with self.assertRaisesMessage(ValueError, msg):
2223.             call_command("makemigrations", "migrations", empty=True, verbosity=0)
2224. 
2225.     def test_makemigrations_interactive_by_default(self):
2226.         """
2227.         The user is prompted to merge by default if there are conflicts and
2228.         merge is True. Answer negative to differentiate it from behavior when
2229.         --noinput is specified.
2230.         """
2231.         # Monkeypatch interactive questioner to auto reject
2232.         out = io.StringIO()
2233.         with mock.patch("builtins.input", mock.Mock(return_value="N")):
2234.             with self.temporary_migration_module(
2235.                 module="migrations.test_migrations_conflict"
2236.             ) as migration_dir:
2237.                 call_command(
2238.                     "makemigrations", "migrations", name="merge", merge=True, stdout=out
2239.                 )
2240.                 merge_file = os.path.join(migration_dir, "0003_merge.py")
2241.                 # This will fail if interactive is False by default
2242.                 self.assertFalse(os.path.exists(merge_file))
2243.             self.assertNotIn("Created new merge migration", out.getvalue())
2244. 
2245.     @override_settings(
2246.         INSTALLED_APPS=[
2247.             "migrations",
2248.             "migrations.migrations_test_apps.unspecified_app_with_conflict",
2249.         ]
2250.     )
2251.     def test_makemigrations_unspecified_app_with_conflict_no_merge(self):
2252.         """
2253.         makemigrations does not raise a CommandError when an unspecified app
2254.         has conflicting migrations.
2255.         """
2256.         with self.temporary_migration_module(
2257.             module="migrations.test_migrations_no_changes"
2258.         ):
2259.             call_command("makemigrations", "migrations", merge=False, verbosity=0)
2260. 
2261.     @override_settings(
2262.         INSTALLED_APPS=[
2263.             "migrations.migrations_test_apps.migrated_app",
2264.             "migrations.migrations_test_apps.unspecified_app_with_conflict",
2265.         ]
2266.     )
2267.     def test_makemigrations_unspecified_app_with_conflict_merge(self):
2268.         """
2269.         makemigrations does not create a merge for an unspecified app even if
2270.         it has conflicting migrations.
2271.         """
2272.         # Monkeypatch interactive questioner to auto accept
2273.         with mock.patch("builtins.input", mock.Mock(return_value="y")):
2274.             out = io.StringIO()
2275.             with self.temporary_migration_module(
2276.                 app_label="migrated_app"
2277.             ) as migration_dir:
2278.                 call_command(
2279.                     "makemigrations",
2280.                     "migrated_app",
2281.                     name="merge",
2282.                     merge=True,
2283.                     interactive=True,
2284.                     stdout=out,
2285.                 )
2286.                 merge_file = os.path.join(migration_dir, "0003_merge.py")
2287.                 self.assertFalse(os.path.exists(merge_file))
2288.             self.assertIn("No conflicts detected to merge.", out.getvalue())
2289. 
2290.     @override_settings(
2291.         INSTALLED_APPS=[
2292.             "migrations.migrations_test_apps.migrated_app",
2293.             "migrations.migrations_test_apps.conflicting_app_with_dependencies",
2294.         ]
2295.     )
2296.     def test_makemigrations_merge_dont_output_dependency_operations(self):
2297.         """
2298.         makemigrations --merge does not output any operations from apps that
2299.         don't belong to a given app.
2300.         """
2301.         # Monkeypatch interactive questioner to auto accept
2302.         with mock.patch("builtins.input", mock.Mock(return_value="N")):
2303.             out = io.StringIO()
2304.             with mock.patch(
2305.                 "django.core.management.color.supports_color", lambda *args: False
2306.             ):
2307.                 call_command(
2308.                     "makemigrations",
2309.                     "conflicting_app_with_dependencies",
2310.                     merge=True,
2311.                     interactive=True,
2312.                     stdout=out,
2313.                 )
2314.             self.assertEqual(
2315.                 out.getvalue().lower(),
2316.                 "merging conflicting_app_with_dependencies\n"
2317.                 "  branch 0002_conflicting_second\n"
2318.                 "    - create model something\n"
2319.                 "  branch 0002_second\n"
2320.                 "    - delete model tribble\n"
2321.                 "    - remove field silly_field from author\n"
2322.                 "    - add field rating to author\n"
2323.                 "    - create model book\n"
2324.                 "\n"
2325.                 "merging will only work if the operations printed above do not "
2326.                 "conflict\n"
2327.                 "with each other (working on different fields or models)\n"
2328.                 "should these migration branches be merged? [y/n] ",
2329.             )
2330. 
2331.     def test_makemigrations_with_custom_name(self):
2332.         """
2333.         makemigrations --name generate a custom migration name.
2334.         """
2335.         with self.temporary_migration_module() as migration_dir:
2336. 
2337.             def cmd(migration_count, migration_name, *args):
2338.                 call_command(
2339.                     "makemigrations",
2340.                     "migrations",
2341.                     "--verbosity",
2342.                     "0",
2343.                     "--name",
2344.                     migration_name,
2345.                     *args,
2346.                 )
2347.                 migration_file = os.path.join(
2348.                     migration_dir, "%s_%s.py" % (migration_count, migration_name)
2349.                 )
2350.                 # Check for existing migration file in migration folder
2351.                 self.assertTrue(os.path.exists(migration_file))
2352.                 with open(migration_file, encoding="utf-8") as fp:
2353.                     content = fp.read()
2354.                     content = content.replace(" ", "")
2355.                 return content
2356. 
2357.             # generate an initial migration
2358.             migration_name_0001 = "my_initial_migration"
2359.             content = cmd("0001", migration_name_0001)
2360.             self.assertIn(
2361.                 "dependencies=[]" if HAS_BLACK else "dependencies=[\n]", content
2362.             )
2363. 
2364.             # importlib caches os.listdir() on some platforms like macOS
2365.             # (#23850).
2366.             if hasattr(importlib, "invalidate_caches"):
2367.                 importlib.invalidate_caches()
2368. 
2369.             # generate an empty migration
2370.             migration_name_0002 = "my_custom_migration"
2371.             content = cmd("0002", migration_name_0002, "--empty")
2372.             if HAS_BLACK:
2373.                 template_str = 'dependencies=[\n("migrations","0001_%s"),\n]'
2374.             else:
2375.                 template_str = "dependencies=[\n('migrations','0001_%s'),\n]"
2376.             self.assertIn(
2377.                 template_str % migration_name_0001,
2378.                 content,
2379.             )
2380.             self.assertIn("operations=[]" if HAS_BLACK else "operations=[\n]", content)
2381. 
2382.     def test_makemigrations_with_invalid_custom_name(self):
2383.         msg = "The migration name must be a valid Python identifier."
2384.         with self.assertRaisesMessage(CommandError, msg):
2385.             call_command(
2386.                 "makemigrations", "migrations", "--name", "invalid name", "--empty"
2387.             )
2388. 
2389.     def test_makemigrations_check(self):
2390.         """
2391.         makemigrations --check should exit with a non-zero status when
2392.         there are changes to an app requiring migrations.
2393.         """
2394.         with self.temporary_migration_module() as tmpdir:
2395.             with self.assertRaises(SystemExit):
2396.                 call_command("makemigrations", "--check", "migrations", verbosity=0)
2397.             self.assertFalse(os.path.exists(tmpdir))
2398. 
2399.         with self.temporary_migration_module(
2400.             module="migrations.test_migrations_no_changes"
2401.         ):
2402.             call_command("makemigrations", "--check", "migrations", verbosity=0)
2403. 
2404.     def test_makemigrations_migration_path_output(self):
2405.         """
2406.         makemigrations should print the relative paths to the migrations unless
2407.         they are outside of the current tree, in which case the absolute path
2408.         should be shown.
2409.         """
2410.         out = io.StringIO()
2411.         apps.register_model("migrations", UnicodeModel)
2412.         with self.temporary_migration_module() as migration_dir:
2413.             call_command("makemigrations", "migrations", stdout=out)
2414.             self.assertIn(
2415.                 os.path.join(migration_dir, "0001_initial.py"), out.getvalue()
2416.             )
2417. 
2418.     def test_makemigrations_migration_path_output_valueerror(self):
2419.         """
2420.         makemigrations prints the absolute path if os.path.relpath() raises a
2421.         ValueError when it's impossible to obtain a relative path, e.g. on
2422.         Windows if Django is installed on a different drive than where the
2423.         migration files are created.
2424.         """
2425.         out = io.StringIO()
2426.         with self.temporary_migration_module() as migration_dir:
2427.             with mock.patch("os.path.relpath", side_effect=ValueError):
2428.                 call_command("makemigrations", "migrations", stdout=out)
2429.         self.assertIn(os.path.join(migration_dir, "0001_initial.py"), out.getvalue())
2430. 
2431.     def test_makemigrations_inconsistent_history(self):
2432.         """
2433.         makemigrations should raise InconsistentMigrationHistory exception if
2434.         there are some migrations applied before their dependencies.
2435.         """
2436.         recorder = MigrationRecorder(connection)
2437.         recorder.record_applied("migrations", "0002_second")
2438.         msg = (
2439.             "Migration migrations.0002_second is applied before its dependency "
2440.             "migrations.0001_initial"
2441.         )
2442.         with self.temporary_migration_module(module="migrations.test_migrations"):
2443.             with self.assertRaisesMessage(InconsistentMigrationHistory, msg):
2444.                 call_command("makemigrations")
2445. 
2446.     def test_makemigrations_inconsistent_history_db_failure(self):
2447.         msg = (
2448.             "Got an error checking a consistent migration history performed "
2449.             "for database connection 'default': could not connect to server"
2450.         )
2451.         with mock.patch(
2452.             "django.db.migrations.loader.MigrationLoader.check_consistent_history",
2453.             side_effect=OperationalError("could not connect to server"),
2454.         ):
2455.             with self.temporary_migration_module():
2456.                 with self.assertWarns(RuntimeWarning) as cm:
2457.                     call_command("makemigrations", verbosity=0)
2458.                 self.assertEqual(str(cm.warning), msg)
2459. 
2460.     @mock.patch("builtins.input", return_value="1")
2461.     @mock.patch(
2462.         "django.db.migrations.questioner.sys.stdin",
2463.         mock.MagicMock(encoding=sys.getdefaultencoding()),
2464.     )
2465.     def test_makemigrations_auto_now_add_interactive(self, *args):
2466.         """
2467.         makemigrations prompts the user when adding auto_now_add to an existing
2468.         model.
2469.         """
2470. 
2471.         class Entry(models.Model):
2472.             title = models.CharField(max_length=255)
2473.             creation_date = models.DateTimeField(auto_now_add=True)
2474. 
2475.             class Meta:
2476.                 app_label = "migrations"
2477. 
2478.         input_msg = (
2479.             "It is impossible to add the field 'creation_date' with "
2480.             "'auto_now_add=True' to entry without providing a default. This "
2481.             "is because the database needs something to populate existing "
2482.             "rows.\n"
2483.             " 1) Provide a one-off default now which will be set on all "
2484.             "existing rows\n"
2485.             " 2) Quit and manually define a default value in models.py."
2486.         )
2487.         # Monkeypatch interactive questioner to auto accept
2488.         prompt_stdout = io.StringIO()
2489.         with self.temporary_migration_module(module="migrations.test_auto_now_add"):
2490.             call_command(
2491.                 "makemigrations", "migrations", interactive=True, stdout=prompt_stdout
2492.             )
2493.         prompt_output = prompt_stdout.getvalue()
2494.         self.assertIn(input_msg, prompt_output)
2495.         self.assertIn("Please enter the default value as valid Python.", prompt_output)
2496.         self.assertIn(
2497.             "Accept the default 'timezone.now' by pressing 'Enter' or provide "
2498.             "another value.",
2499.             prompt_output,
2500.         )
2501.         self.assertIn("Type 'exit' to exit this prompt", prompt_output)
2502.         self.assertIn("Add field creation_date to entry", prompt_output)
2503. 
2504.     @mock.patch("builtins.input", return_value="2")
2505.     def test_makemigrations_auto_now_add_interactive_quit(self, mock_input):
2506.         class Author(models.Model):
2507.             publishing_date = models.DateField(auto_now_add=True)
2508. 
2509.             class Meta:
2510.                 app_label = "migrations"
2511. 
2512.         with self.temporary_migration_module(module="migrations.test_migrations"):
2513.             with captured_stdout():
2514.                 with self.assertRaises(SystemExit):
2515.                     call_command("makemigrations", "migrations", interactive=True)
2516. 
2517.     def test_makemigrations_non_interactive_auto_now_add_addition(self):
2518.         """
2519.         Non-interactive makemigrations fails when a default is missing on a
2520.         new field when auto_now_add=True.
2521.         """
2522. 
2523.         class Entry(models.Model):
2524.             creation_date = models.DateTimeField(auto_now_add=True)
2525. 
2526.             class Meta:
2527.                 app_label = "migrations"
2528. 
2529.         with self.temporary_migration_module(module="migrations.test_auto_now_add"):
2530.             with self.assertRaises(SystemExit), captured_stdout() as out:
2531.                 call_command("makemigrations", "migrations", interactive=False)
2532.         self.assertIn(
2533.             "Field 'creation_date' on model 'entry' not migrated: it is "
2534.             "impossible to add a field with 'auto_now_add=True' without "
2535.             "specifying a default.",
2536.             out.getvalue(),
2537.         )
2538. 
2539.     def test_makemigrations_interactive_unique_callable_default_addition(self):
2540.         """
2541.         makemigrations prompts the user when adding a unique field with
2542.         a callable default.
2543.         """
2544. 
2545.         class Book(models.Model):
2546.             created = models.DateTimeField(unique=True, default=timezone.now)
2547. 
2548.             class Meta:
2549.                 app_label = "migrations"
2550. 
2551.         version = get_docs_version()
2552.         input_msg = (
2553.             f"Callable default on unique field book.created will not generate "
2554.             f"unique values upon migrating.\n"
2555.             f"Please choose how to proceed:\n"
2556.             f" 1) Continue making this migration as the first step in writing "
2557.             f"a manual migration to generate unique values described here: "
2558.             f"https://docs.djangoproject.com/en/{version}/howto/"
2559.             f"writing-migrations/#migrations-that-add-unique-fields.\n"
2560.             f" 2) Quit and edit field options in models.py.\n"
2561.         )
2562.         with self.temporary_migration_module(module="migrations.test_migrations"):
2563.             # 2 - quit.
2564.             with mock.patch("builtins.input", return_value="2"):
2565.                 with captured_stdout() as out, self.assertRaises(SystemExit):
2566.                     call_command("makemigrations", "migrations", interactive=True)
2567.             out_value = out.getvalue()
2568.             self.assertIn(input_msg, out_value)
2569.             self.assertNotIn("Add field created to book", out_value)
2570.             # 1 - continue.
2571.             with mock.patch("builtins.input", return_value="1"):
2572.                 with captured_stdout() as out:
2573.                     call_command("makemigrations", "migrations", interactive=True)
2574.             out_value = out.getvalue()
2575.             self.assertIn(input_msg, out_value)
2576.             self.assertIn("Add field created to book", out_value)
2577. 
2578.     def test_makemigrations_non_interactive_unique_callable_default_addition(self):
2579.         class Book(models.Model):
2580.             created = models.DateTimeField(unique=True, default=timezone.now)
2581. 
2582.             class Meta:
2583.                 app_label = "migrations"
2584. 
2585.         with self.temporary_migration_module(module="migrations.test_migrations"):
2586.             with captured_stdout() as out:
2587.                 call_command("makemigrations", "migrations", interactive=False)
2588.             out_value = out.getvalue()
2589.             self.assertIn("Add field created to book", out_value)
2590. 
2591.     @override_settings(
2592.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_squashed"},
2593.     )
2594.     def test_makemigrations_continues_number_sequence_after_squash(self):
2595.         with self.temporary_migration_module(
2596.             module="migrations.test_migrations_squashed"
2597.         ):
2598.             with captured_stdout() as out:
2599.                 call_command(
2600.                     "makemigrations",
2601.                     "migrations",
2602.                     interactive=False,
2603.                     empty=True,
2604.                 )
2605.             out_value = out.getvalue()
2606.             self.assertIn("0003_auto", out_value)
2607. 
2608.     def test_makemigrations_update(self):
2609.         with self.temporary_migration_module(
2610.             module="migrations.test_migrations"
2611.         ) as migration_dir:
2612.             migration_file = os.path.join(migration_dir, "0002_second.py")
2613.             with open(migration_file) as fp:
2614.                 initial_content = fp.read()
2615. 
2616.             with captured_stdout() as out:
2617.                 call_command("makemigrations", "migrations", update=True)
2618.             self.assertFalse(
2619.                 any(
2620.                     filename.startswith("0003")
2621.                     for filename in os.listdir(migration_dir)
2622.                 )
2623.             )
2624.             self.assertIs(os.path.exists(migration_file), False)
2625.             new_migration_file = os.path.join(
2626.                 migration_dir,
2627.                 "0002_delete_tribble_author_rating_modelwithcustombase_and_more.py",
2628.             )
2629.             with open(new_migration_file) as fp:
2630.                 self.assertNotEqual(initial_content, fp.read())
2631.             self.assertIn(f"Deleted {migration_file}", out.getvalue())
2632. 
2633.     def test_makemigrations_update_existing_name(self):
2634.         with self.temporary_migration_module(
2635.             module="migrations.test_auto_now_add"
2636.         ) as migration_dir:
2637.             migration_file = os.path.join(migration_dir, "0001_initial.py")
2638.             with open(migration_file) as fp:
2639.                 initial_content = fp.read()
2640. 
2641.             with captured_stdout() as out:
2642.                 call_command("makemigrations", "migrations", update=True)
2643.             self.assertIs(os.path.exists(migration_file), False)
2644.             new_migration_file = os.path.join(
2645.                 migration_dir,
2646.                 "0001_initial_updated.py",
2647.             )
2648.             with open(new_migration_file) as fp:
2649.                 self.assertNotEqual(initial_content, fp.read())
2650.             self.assertIn(f"Deleted {migration_file}", out.getvalue())
2651. 
2652.     def test_makemigrations_update_applied_migration(self):
2653.         recorder = MigrationRecorder(connection)
2654.         recorder.record_applied("migrations", "0001_initial")
2655.         recorder.record_applied("migrations", "0002_second")
2656.         with self.temporary_migration_module(module="migrations.test_migrations"):
2657.             msg = "Cannot update applied migration 'migrations.0002_second'."
2658.             with self.assertRaisesMessage(CommandError, msg):
2659.                 call_command("makemigrations", "migrations", update=True)
2660. 
2661.     def test_makemigrations_update_no_migration(self):
2662.         with self.temporary_migration_module(module="migrations.test_migrations_empty"):
2663.             msg = "App migrations has no migration, cannot update last migration."
2664.             with self.assertRaisesMessage(CommandError, msg):
2665.                 call_command("makemigrations", "migrations", update=True)
2666. 
2667.     def test_makemigrations_update_squash_migration(self):
2668.         with self.temporary_migration_module(
2669.             module="migrations.test_migrations_squashed"
2670.         ):
2671.             msg = "Cannot update squash migration 'migrations.0001_squashed_0002'."
2672.             with self.assertRaisesMessage(CommandError, msg):
2673.                 call_command("makemigrations", "migrations", update=True)
2674. 
2675.     def test_makemigrations_update_manual_porting(self):
2676.         with self.temporary_migration_module(
2677.             module="migrations.test_migrations_plan"
2678.         ) as migration_dir:
2679.             with captured_stdout() as out:
2680.                 call_command("makemigrations", "migrations", update=True)
2681.             # Previous migration exists.
2682.             previous_migration_file = os.path.join(migration_dir, "0005_fifth.py")
2683.             self.assertIs(os.path.exists(previous_migration_file), True)
2684.             # New updated migration exists.
2685.             files = [f for f in os.listdir(migration_dir) if f.startswith("0005_auto")]
2686.             updated_migration_file = os.path.join(migration_dir, files[0])
2687.             self.assertIs(os.path.exists(updated_migration_file), True)
2688.             self.assertIn(
2689.                 f"Updated migration {updated_migration_file} requires manual porting.\n"
2690.                 f"Previous migration {previous_migration_file} was kept and must be "
2691.                 f"deleted after porting functions manually.",
2692.                 out.getvalue(),
2693.             )
2694. 
2695.     @override_settings(
2696.         INSTALLED_APPS=[
2697.             "migrations.migrations_test_apps.alter_fk.author_app",
2698.             "migrations.migrations_test_apps.alter_fk.book_app",
2699.         ]
2700.     )
2701.     def test_makemigrations_update_dependency_migration(self):
2702.         with self.temporary_migration_module(app_label="book_app"):
2703.             msg = (
2704.                 "Cannot update migration 'book_app.0001_initial' that migrations "
2705.                 "'author_app.0002_alter_id' depend on."
2706.             )
2707.             with self.assertRaisesMessage(CommandError, msg):
2708.                 call_command("makemigrations", "book_app", update=True)
2709. 
2710. 
2711. class SquashMigrationsTests(MigrationTestBase):
2712.     """
2713.     Tests running the squashmigrations command.
2714.     """
2715. 
2716.     def test_squashmigrations_squashes(self):
2717.         """
2718.         squashmigrations squashes migrations.
2719.         """
2720.         out = io.StringIO()
2721.         with self.temporary_migration_module(
2722.             module="migrations.test_migrations"
2723.         ) as migration_dir:
2724.             call_command(
2725.                 "squashmigrations",
2726.                 "migrations",
2727.                 "0002",
2728.                 interactive=False,
2729.                 stdout=out,
2730.                 no_color=True,
2731.             )
2732. 
2733.             squashed_migration_file = os.path.join(
2734.                 migration_dir, "0001_squashed_0002_second.py"
2735.             )
2736.             self.assertTrue(os.path.exists(squashed_migration_file))
2737.         self.assertEqual(
2738.             out.getvalue(),
2739.             "Will squash the following migrations:\n"
2740.             " - 0001_initial\n"
2741.             " - 0002_second\n"
2742.             "Optimizing...\n"
2743.             "  Optimized from 8 operations to 2 operations.\n"
2744.             "Created new squashed migration %s\n"
2745.             "  You should commit this migration but leave the old ones in place;\n"
2746.             "  the new migration will be used for new installs. Once you are sure\n"
2747.             "  all instances of the codebase have applied the migrations you "
2748.             "squashed,\n"
2749.             "  you can delete them.\n" % squashed_migration_file,
2750.         )
2751. 
2752.     def test_squashmigrations_initial_attribute(self):
2753.         with self.temporary_migration_module(
2754.             module="migrations.test_migrations"
2755.         ) as migration_dir:
2756.             call_command(
2757.                 "squashmigrations", "migrations", "0002", interactive=False, verbosity=0
2758.             )
2759. 
2760.             squashed_migration_file = os.path.join(
2761.                 migration_dir, "0001_squashed_0002_second.py"
2762.             )
2763.             with open(squashed_migration_file, encoding="utf-8") as fp:
2764.                 content = fp.read()
2765.                 self.assertIn("initial = True", content)
2766. 
2767.     def test_squashmigrations_optimizes(self):
2768.         """
2769.         squashmigrations optimizes operations.
2770.         """
2771.         out = io.StringIO()
2772.         with self.temporary_migration_module(module="migrations.test_migrations"):
2773.             call_command(
2774.                 "squashmigrations",
2775.                 "migrations",
2776.                 "0002",
2777.                 interactive=False,
2778.                 verbosity=1,
2779.                 stdout=out,
2780.             )
2781.         self.assertIn("Optimized from 8 operations to 2 operations.", out.getvalue())
2782. 
2783.     def test_ticket_23799_squashmigrations_no_optimize(self):
2784.         """
2785.         squashmigrations --no-optimize doesn't optimize operations.
2786.         """
2787.         out = io.StringIO()
2788.         with self.temporary_migration_module(module="migrations.test_migrations"):
2789.             call_command(
2790.                 "squashmigrations",
2791.                 "migrations",
2792.                 "0002",
2793.                 interactive=False,
2794.                 verbosity=1,
2795.                 no_optimize=True,
2796.                 stdout=out,
2797.             )
2798.         self.assertIn("Skipping optimization", out.getvalue())
2799. 
2800.     def test_squashmigrations_valid_start(self):
2801.         """
2802.         squashmigrations accepts a starting migration.
2803.         """
2804.         out = io.StringIO()
2805.         with self.temporary_migration_module(
2806.             module="migrations.test_migrations_no_changes"
2807.         ) as migration_dir:
2808.             call_command(
2809.                 "squashmigrations",
2810.                 "migrations",
2811.                 "0002",
2812.                 "0003",
2813.                 interactive=False,
2814.                 verbosity=1,
2815.                 stdout=out,
2816.             )
2817. 
2818.             squashed_migration_file = os.path.join(
2819.                 migration_dir, "0002_second_squashed_0003_third.py"
2820.             )
2821.             with open(squashed_migration_file, encoding="utf-8") as fp:
2822.                 content = fp.read()
2823.                 if HAS_BLACK:
2824.                     test_str = '        ("migrations", "0001_initial")'
2825.                 else:
2826.                     test_str = "        ('migrations', '0001_initial')"
2827.                 self.assertIn(test_str, content)
2828.                 self.assertNotIn("initial = True", content)
2829.         out = out.getvalue()
2830.         self.assertNotIn(" - 0001_initial", out)
2831.         self.assertIn(" - 0002_second", out)
2832.         self.assertIn(" - 0003_third", out)
2833. 
2834.     def test_squashmigrations_invalid_start(self):
2835.         """
2836.         squashmigrations doesn't accept a starting migration after the ending migration.
2837.         """
2838.         with self.temporary_migration_module(
2839.             module="migrations.test_migrations_no_changes"
2840.         ):
2841.             msg = (
2842.                 "The migration 'migrations.0003_third' cannot be found. Maybe "
2843.                 "it comes after the migration 'migrations.0002_second'"
2844.             )
2845.             with self.assertRaisesMessage(CommandError, msg):
2846.                 call_command(
2847.                     "squashmigrations",
2848.                     "migrations",
2849.                     "0003",
2850.                     "0002",
2851.                     interactive=False,
2852.                     verbosity=0,
2853.                 )
2854. 
2855.     def test_squashed_name_with_start_migration_name(self):
2856.         """--squashed-name specifies the new migration's name."""
2857.         squashed_name = "squashed_name"
2858.         with self.temporary_migration_module(
2859.             module="migrations.test_migrations"
2860.         ) as migration_dir:
2861.             call_command(
2862.                 "squashmigrations",
2863.                 "migrations",
2864.                 "0001",
2865.                 "0002",
2866.                 squashed_name=squashed_name,
2867.                 interactive=False,
2868.                 verbosity=0,
2869.             )
2870.             squashed_migration_file = os.path.join(
2871.                 migration_dir, "0001_%s.py" % squashed_name
2872.             )
2873.             self.assertTrue(os.path.exists(squashed_migration_file))
2874. 
2875.     def test_squashed_name_without_start_migration_name(self):
2876.         """--squashed-name also works if a start migration is omitted."""
2877.         squashed_name = "squashed_name"
2878.         with self.temporary_migration_module(
2879.             module="migrations.test_migrations"
2880.         ) as migration_dir:
2881.             call_command(
2882.                 "squashmigrations",
2883.                 "migrations",
2884.                 "0001",
2885.                 squashed_name=squashed_name,
2886.                 interactive=False,
2887.                 verbosity=0,
2888.             )
2889.             squashed_migration_file = os.path.join(
2890.                 migration_dir, "0001_%s.py" % squashed_name
2891.             )
2892.             self.assertTrue(os.path.exists(squashed_migration_file))
2893. 
2894.     def test_squashed_name_exists(self):
2895.         msg = "Migration 0001_initial already exists. Use a different name."
2896.         with self.temporary_migration_module(module="migrations.test_migrations"):
2897.             with self.assertRaisesMessage(CommandError, msg):
2898.                 call_command(
2899.                     "squashmigrations",
2900.                     "migrations",
2901.                     "0001",
2902.                     "0002",
2903.                     squashed_name="initial",
2904.                     interactive=False,
2905.                     verbosity=0,
2906.                 )
2907. 
2908.     def test_squashmigrations_manual_porting(self):
2909.         out = io.StringIO()
2910.         with self.temporary_migration_module(
2911.             module="migrations.test_migrations_manual_porting",
2912.         ) as migration_dir:
2913.             call_command(
2914.                 "squashmigrations",
2915.                 "migrations",
2916.                 "0002",
2917.                 interactive=False,
2918.                 stdout=out,
2919.                 no_color=True,
2920.             )
2921.             squashed_migration_file = os.path.join(
2922.                 migration_dir,
2923.                 "0001_squashed_0002_second.py",
2924.             )
2925.             self.assertTrue(os.path.exists(squashed_migration_file))
2926.         black_warning = ""
2927.         if HAS_BLACK:
2928.             black_warning = (
2929.                 "Squashed migration couldn't be formatted using the "
2930.                 '"black" command. You can call it manually.\n'
2931.             )
2932.         self.assertEqual(
2933.             out.getvalue(),
2934.             f"Will squash the following migrations:\n"
2935.             f" - 0001_initial\n"
2936.             f" - 0002_second\n"
2937.             f"Optimizing...\n"
2938.             f"  No optimizations possible.\n"
2939.             f"Created new squashed migration {squashed_migration_file}\n"
2940.             f"  You should commit this migration but leave the old ones in place;\n"
2941.             f"  the new migration will be used for new installs. Once you are sure\n"
2942.             f"  all instances of the codebase have applied the migrations you "
2943.             f"squashed,\n"
2944.             f"  you can delete them.\n"
2945.             f"Manual porting required\n"
2946.             f"  Your migrations contained functions that must be manually copied "
2947.             f"over,\n"
2948.             f"  as we could not safely copy their implementation.\n"
2949.             f"  See the comment at the top of the squashed migration for details.\n"
2950.             + black_warning,
2951.         )
2952. 
2953. 
2954. class AppLabelErrorTests(TestCase):
2955.     """
2956.     This class inherits TestCase because MigrationTestBase uses
2957.     `available_apps = ['migrations']` which means that it's the only installed
2958.     app. 'django.contrib.auth' must be in INSTALLED_APPS for some of these
2959.     tests.
2960.     """
2961. 
2962.     nonexistent_app_error = "No installed app with label 'nonexistent_app'."
2963.     did_you_mean_auth_error = (
2964.         "No installed app with label 'django.contrib.auth'. Did you mean 'auth'?"
2965.     )
2966. 
2967.     def test_makemigrations_nonexistent_app_label(self):
2968.         err = io.StringIO()
2969.         with self.assertRaises(SystemExit):
2970.             call_command("makemigrations", "nonexistent_app", stderr=err)
2971.         self.assertIn(self.nonexistent_app_error, err.getvalue())
2972. 
2973.     def test_makemigrations_app_name_specified_as_label(self):
2974.         err = io.StringIO()
2975.         with self.assertRaises(SystemExit):
2976.             call_command("makemigrations", "django.contrib.auth", stderr=err)
2977.         self.assertIn(self.did_you_mean_auth_error, err.getvalue())
2978. 
2979.     def test_migrate_nonexistent_app_label(self):
2980.         with self.assertRaisesMessage(CommandError, self.nonexistent_app_error):
2981.             call_command("migrate", "nonexistent_app")
2982. 
2983.     def test_migrate_app_name_specified_as_label(self):
2984.         with self.assertRaisesMessage(CommandError, self.did_you_mean_auth_error):
2985.             call_command("migrate", "django.contrib.auth")
2986. 
2987.     def test_showmigrations_nonexistent_app_label(self):
2988.         err = io.StringIO()
2989.         with self.assertRaises(SystemExit):
2990.             call_command("showmigrations", "nonexistent_app", stderr=err)
2991.         self.assertIn(self.nonexistent_app_error, err.getvalue())
2992. 
2993.     def test_showmigrations_app_name_specified_as_label(self):
2994.         err = io.StringIO()
2995.         with self.assertRaises(SystemExit):
2996.             call_command("showmigrations", "django.contrib.auth", stderr=err)
2997.         self.assertIn(self.did_you_mean_auth_error, err.getvalue())
2998. 
2999.     def test_sqlmigrate_nonexistent_app_label(self):
3000.         with self.assertRaisesMessage(CommandError, self.nonexistent_app_error):
3001.             call_command("sqlmigrate", "nonexistent_app", "0002")
3002. 
3003.     def test_sqlmigrate_app_name_specified_as_label(self):
3004.         with self.assertRaisesMessage(CommandError, self.did_you_mean_auth_error):
3005.             call_command("sqlmigrate", "django.contrib.auth", "0002")
3006. 
3007.     def test_squashmigrations_nonexistent_app_label(self):
3008.         with self.assertRaisesMessage(CommandError, self.nonexistent_app_error):
3009.             call_command("squashmigrations", "nonexistent_app", "0002")
3010. 
3011.     def test_squashmigrations_app_name_specified_as_label(self):
3012.         with self.assertRaisesMessage(CommandError, self.did_you_mean_auth_error):
3013.             call_command("squashmigrations", "django.contrib.auth", "0002")
3014. 
3015.     def test_optimizemigration_nonexistent_app_label(self):
3016.         with self.assertRaisesMessage(CommandError, self.nonexistent_app_error):
3017.             call_command("optimizemigration", "nonexistent_app", "0002")
3018. 
3019.     def test_optimizemigration_app_name_specified_as_label(self):
3020.         with self.assertRaisesMessage(CommandError, self.did_you_mean_auth_error):
3021.             call_command("optimizemigration", "django.contrib.auth", "0002")
3022. 
3023. 
3024. class OptimizeMigrationTests(MigrationTestBase):
3025.     def test_no_optimization_possible(self):
3026.         out = io.StringIO()
3027.         with self.temporary_migration_module(
3028.             module="migrations.test_migrations"
3029.         ) as migration_dir:
3030.             call_command(
3031.                 "optimizemigration", "migrations", "0002", stdout=out, no_color=True
3032.             )
3033.             migration_file = os.path.join(migration_dir, "0002_second.py")
3034.             self.assertTrue(os.path.exists(migration_file))
3035.             call_command(
3036.                 "optimizemigration",
3037.                 "migrations",
3038.                 "0002",
3039.                 stdout=out,
3040.                 no_color=True,
3041.                 verbosity=0,
3042.             )
3043.         self.assertEqual(out.getvalue(), "No optimizations possible.\n")
3044. 
3045.     def test_optimization(self):
3046.         out = io.StringIO()
3047.         with self.temporary_migration_module(
3048.             module="migrations.test_migrations"
3049.         ) as migration_dir:
3050.             call_command(
3051.                 "optimizemigration", "migrations", "0001", stdout=out, no_color=True
3052.             )
3053.             initial_migration_file = os.path.join(migration_dir, "0001_initial.py")
3054.             self.assertTrue(os.path.exists(initial_migration_file))
3055.             with open(initial_migration_file) as fp:
3056.                 content = fp.read()
3057.                 self.assertIn(
3058.                     '("bool", models.BooleanField'
3059.                     if HAS_BLACK
3060.                     else "('bool', models.BooleanField",
3061.                     content,
3062.                 )
3063.         self.assertEqual(
3064.             out.getvalue(),
3065.             f"Optimizing from 4 operations to 2 operations.\n"
3066.             f"Optimized migration {initial_migration_file}\n",
3067.         )
3068. 
3069.     def test_optimization_no_verbosity(self):
3070.         out = io.StringIO()
3071.         with self.temporary_migration_module(
3072.             module="migrations.test_migrations"
3073.         ) as migration_dir:
3074.             call_command(
3075.                 "optimizemigration",
3076.                 "migrations",
3077.                 "0001",
3078.                 stdout=out,
3079.                 no_color=True,
3080.                 verbosity=0,
3081.             )
3082.             initial_migration_file = os.path.join(migration_dir, "0001_initial.py")
3083.             self.assertTrue(os.path.exists(initial_migration_file))
3084.             with open(initial_migration_file) as fp:
3085.                 content = fp.read()
3086.                 self.assertIn(
3087.                     '("bool", models.BooleanField'
3088.                     if HAS_BLACK
3089.                     else "('bool', models.BooleanField",
3090.                     content,
3091.                 )
3092.         self.assertEqual(out.getvalue(), "")
3093. 
3094.     def test_creates_replace_migration_manual_porting(self):
3095.         out = io.StringIO()
3096.         with self.temporary_migration_module(
3097.             module="migrations.test_migrations_manual_porting"
3098.         ) as migration_dir:
3099.             call_command(
3100.                 "optimizemigration", "migrations", "0003", stdout=out, no_color=True
3101.             )
3102.             optimized_migration_file = os.path.join(
3103.                 migration_dir, "0003_third_optimized.py"
3104.             )
3105.             self.assertTrue(os.path.exists(optimized_migration_file))
3106.             with open(optimized_migration_file) as fp:
3107.                 content = fp.read()
3108.                 self.assertIn("replaces = [", content)
3109.         black_warning = ""
3110.         if HAS_BLACK:
3111.             black_warning = (
3112.                 "Optimized migration couldn't be formatted using the "
3113.                 '"black" command. You can call it manually.\n'
3114.             )
3115.         self.assertEqual(
3116.             out.getvalue(),
3117.             "Optimizing from 3 operations to 2 operations.\n"
3118.             "Manual porting required\n"
3119.             "  Your migrations contained functions that must be manually copied over,\n"
3120.             "  as we could not safely copy their implementation.\n"
3121.             "  See the comment at the top of the optimized migration for details.\n"
3122.             + black_warning
3123.             + f"Optimized migration {optimized_migration_file}\n",
3124.         )
3125. 
3126.     def test_fails_squash_migration_manual_porting(self):
3127.         out = io.StringIO()
3128.         with self.temporary_migration_module(
3129.             module="migrations.test_migrations_manual_porting"
3130.         ) as migration_dir:
3131.             version = get_docs_version()
3132.             msg = (
3133.                 f"Migration will require manual porting but is already a squashed "
3134.                 f"migration.\nTransition to a normal migration first: "
3135.                 f"https://docs.djangoproject.com/en/{version}/topics/migrations/"
3136.                 f"#squashing-migrations"
3137.             )
3138.             with self.assertRaisesMessage(CommandError, msg):
3139.                 call_command("optimizemigration", "migrations", "0004", stdout=out)
3140.             optimized_migration_file = os.path.join(
3141.                 migration_dir, "0004_fourth_optimized.py"
3142.             )
3143.             self.assertFalse(os.path.exists(optimized_migration_file))
3144.         self.assertEqual(
3145.             out.getvalue(), "Optimizing from 3 operations to 2 operations.\n"
3146.         )
3147. 
3148.     @override_settings(MIGRATION_MODULES={"migrations": "migrations.test_migrations"})
3149.     def test_optimizemigration_check(self):
3150.         with self.assertRaises(SystemExit):
3151.             call_command(
3152.                 "optimizemigration", "--check", "migrations", "0001", verbosity=0
3153.             )
3154. 
3155.         call_command("optimizemigration", "--check", "migrations", "0002", verbosity=0)
3156. 
3157.     @override_settings(
3158.         INSTALLED_APPS=["migrations.migrations_test_apps.unmigrated_app_simple"],
3159.     )
3160.     def test_app_without_migrations(self):
3161.         msg = "App 'unmigrated_app_simple' does not have migrations."
3162.         with self.assertRaisesMessage(CommandError, msg):
3163.             call_command("optimizemigration", "unmigrated_app_simple", "0001")
3164. 
3165.     @override_settings(
3166.         MIGRATION_MODULES={"migrations": "migrations.test_migrations_clashing_prefix"},
3167.     )
3168.     def test_ambigious_prefix(self):
3169.         msg = (
3170.             "More than one migration matches 'a' in app 'migrations'. Please "
3171.             "be more specific."
3172.         )
3173.         with self.assertRaisesMessage(CommandError, msg):
3174.             call_command("optimizemigration", "migrations", "a")
3175. 
3176.     @override_settings(MIGRATION_MODULES={"migrations": "migrations.test_migrations"})
3177.     def test_unknown_prefix(self):
3178.         msg = "Cannot find a migration matching 'nonexistent' from app 'migrations'."
3179.         with self.assertRaisesMessage(CommandError, msg):
3180.             call_command("optimizemigration", "migrations", "nonexistent")

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 20:10:29,537 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find test cases for a bug in management command subparser argument handling. The provided context from `tests/admin_scripts/tests.py` and `tests/migrations/test_commands.py` does not contain any clear examples of commands using subparsers or tests for their argument parsing error handling. To find relevant examples, I need to look at tests for other parts of the command system. The bash completion feature needs to deeply understand command argument structures, including subparsers, so its tests are a promising place to look for relevant examples of complex commands.' query='Please provide the full content of `tests/bash_completion/tests.py` and `tests/bash_completion/management/commands/test_command.py`.' extra_requirements='' purpose='These files are needed to find test cases that define and exercise management commands with subparsers, which is essential for finding tests relevant to the subparser error handling bug.'
2025-12-21 20:10:29,538 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `tests/bash_completion/tests.py` and `tests/bash_completion/management/commands/test_command.py`.
2025-12-21 20:10:29,538 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-21 20:10:29,538 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-21 20:10:29,539 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-21 20:10:29,539 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `tests/bash_completion/tests.py` and `tests/bash_completion/management/commands/test_command.py`.
Purpose: These files are needed to find test cases that define and exercise management commands with subparsers, which is essential for finding tests relevant to the subparser error handling bug.
2025-12-21 20:10:32,460 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the contents of the two requested files, `tests/bash_completion/tests.py` and `tests/bash_completion/management/commands/test_command.py`, to help find test cases related to management commands with subparsers. This information will be useful for investigating the subparser error handling bug.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/bash_completion/management/commands/test_command.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2128, 'candidates_token_count': 119, 'total_token_count': 2403, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2128}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 119}], 'thoughts_token_count': 156, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.08423725897524537, 'model_name': 'gemini-2.5-pro'} id='run--89305724-77c6-46e8-b2e7-24d8e81caa4b-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/bash_completion/tests.py'}, 'id': '6089518c-f14e-4de4-b395-4ce20089a3c8', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/bash_completion/management/commands/test_command.py'}, 'id': '2d88b554-5b7a-44b2-ad7b-7fc80d2fc07e', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2128, 'output_tokens': 119, 'total_tokens': 2403, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 156}}
2025-12-21 20:10:44,475 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the full contents of `tests/bash_completion/tests.py` and `tests/bash_completion/management/commands/test_command.py`. These files contain test cases for command-line bash completion and a custom management command. This information will allow for a thorough analysis of how management commands with subparsers are defined and tested, which is crucial for addressing the subparser error handling bug.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 3917, 'candidates_token_count': 85, 'total_token_count': 5208, 'cached_content_token_count': 1633, 'prompt_tokens_details': [{'modality': 1, 'token_count': 3917}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1633}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 85}], 'thoughts_token_count': 1206}, 'finish_reason': 'STOP', 'avg_logprobs': -2.0023240033318013, 'model_name': 'gemini-2.5-pro'} id='run--01a3dc7d-0cdc-4e5a-9821-246c735666c1-0' usage_metadata={'input_tokens': 3917, 'output_tokens': 85, 'total_tokens': 5208, 'input_token_details': {'cache_read': 1633}, 'output_token_details': {'reasoning': 1206}}
2025-12-21 20:10:44,476 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `tests/bash_completion/tests.py` and `tests/bash_completion/management/commands/test_command.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
These files are needed to find test cases that define and exercise management commands with subparsers, which is essential for finding tests relevant to the subparser error handling bug.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/bash_completion/management/commands/test_command.py
Line number range: 1 - 9
Content:
1. from django.core.management.base import BaseCommand
2. 
3. 
4. class Command(BaseCommand):
5.     def add_arguments(self, parser):
6.         parser.add_argument("--list", action="store_true", help="Print all options")
7. 
8.     def handle(self, *args, **options):
9.         pass


File: tests/bash_completion/tests.py
Line number range: 1 - 105
Content:
1. """
2. A series of tests to establish that the command-line bash completion works.
3. """
4. import os
5. import sys
6. import unittest
7. 
8. from django.apps import apps
9. from django.core.management import ManagementUtility
10. from django.test.utils import captured_stdout
11. 
12. 
13. class BashCompletionTests(unittest.TestCase):
14.     """
15.     Testing the Python level bash completion code.
16.     This requires setting up the environment as if we got passed data
17.     from bash.
18.     """
19. 
20.     def setUp(self):
21.         self.old_DJANGO_AUTO_COMPLETE = os.environ.get("DJANGO_AUTO_COMPLETE")
22.         os.environ["DJANGO_AUTO_COMPLETE"] = "1"
23. 
24.     def tearDown(self):
25.         if self.old_DJANGO_AUTO_COMPLETE:
26.             os.environ["DJANGO_AUTO_COMPLETE"] = self.old_DJANGO_AUTO_COMPLETE
27.         else:
28.             del os.environ["DJANGO_AUTO_COMPLETE"]
29. 
30.     def _user_input(self, input_str):
31.         """
32.         Set the environment and the list of command line arguments.
33. 
34.         This sets the bash variables $COMP_WORDS and $COMP_CWORD. The former is
35.         an array consisting of the individual words in the current command
36.         line, the latter is the index of the current cursor position, so in
37.         case a word is completed and the cursor is placed after a whitespace,
38.         $COMP_CWORD must be incremented by 1:
39. 
40.           * 'django-admin start' -> COMP_CWORD=1
41.           * 'django-admin startproject' -> COMP_CWORD=1
42.           * 'django-admin startproject ' -> COMP_CWORD=2
43.         """
44.         os.environ["COMP_WORDS"] = input_str
45.         idx = len(input_str.split(" ")) - 1  # Index of the last word
46.         comp_cword = idx + 1 if input_str.endswith(" ") else idx
47.         os.environ["COMP_CWORD"] = str(comp_cword)
48.         sys.argv = input_str.split()
49. 
50.     def _run_autocomplete(self):
51.         util = ManagementUtility(argv=sys.argv)
52.         with captured_stdout() as stdout:
53.             try:
54.                 util.autocomplete()
55.             except SystemExit:
56.                 pass
57.         return stdout.getvalue().strip().split("\n")
58. 
59.     def test_django_admin_py(self):
60.         "django_admin.py will autocomplete option flags"
61.         self._user_input("django-admin sqlmigrate --verb")
62.         output = self._run_autocomplete()
63.         self.assertEqual(output, ["--verbosity="])
64. 
65.     def test_manage_py(self):
66.         "manage.py will autocomplete option flags"
67.         self._user_input("manage.py sqlmigrate --verb")
68.         output = self._run_autocomplete()
69.         self.assertEqual(output, ["--verbosity="])
70. 
71.     def test_custom_command(self):
72.         "A custom command can autocomplete option flags"
73.         self._user_input("django-admin test_command --l")
74.         output = self._run_autocomplete()
75.         self.assertEqual(output, ["--list"])
76. 
77.     def test_subcommands(self):
78.         "Subcommands can be autocompleted"
79.         self._user_input("django-admin sql")
80.         output = self._run_autocomplete()
81.         self.assertEqual(output, ["sqlflush sqlmigrate sqlsequencereset"])
82. 
83.     def test_completed_subcommand(self):
84.         "Show option flags in case a subcommand is completed"
85.         self._user_input("django-admin startproject ")  # Trailing whitespace
86.         output = self._run_autocomplete()
87.         for item in output:
88.             self.assertTrue(item.startswith("--"))
89. 
90.     def test_help(self):
91.         "No errors, just an empty list if there are no autocomplete options"
92.         self._user_input("django-admin help --")
93.         output = self._run_autocomplete()
94.         self.assertEqual(output, [""])
95. 
96.     def test_app_completion(self):
97.         "Application names will be autocompleted for an AppCommand"
98.         self._user_input("django-admin sqlmigrate a")
99.         output = self._run_autocomplete()
100.         a_labels = sorted(
101.             app_config.label
102.             for app_config in apps.get_app_configs()
103.             if app_config.label.startswith("a")
104.         )
105.         self.assertEqual(output, a_labels)

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-21 20:10:49,411 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='The user requested the full content of the file `tests/bash_completion/tests.py`. This context provides the entire content of that file as seen in the input.', relative_path='tests/bash_completion/tests.py', start_line=1, end_line=105), ContextOutput(reasoning='The user requested the full content of the file `tests/bash_completion/management/commands/test_command.py`. This context provides the entire content of that file as seen in the input.', relative_path='tests/bash_completion/management/commands/test_command.py', start_line=1, end_line=9)]
2025-12-21 20:10:49,412 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 2 contexts to memory for query: Please provide the full content of `tests/bash_completion/tests.py` and `tests/bash_completion/management/commands/test_command.py`.
2025-12-21 20:10:49,413 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-21 20:10:49,413 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-21 20:10:49,413 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 2 new contexts to 2 existing contexts
2025-12-21 20:10:49,413 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 4 total contexts (removed 0 duplicates)
2025-12-21 20:10:49,414 - thread-128098171356864.prometheus_context_collector.lang_graph.nodes.context_refine_node - INFO - Reached max_refined_query_loop, not asking for more context
2025-12-21 20:10:49,414 - thread-128098171356864.prometheus_context_collector - INFO - Successfully retrieved 4 context snippets
