2025-12-23 12:32:50,900 - thread-139574441383616.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: docstring default arg is broken

Description: **Describe the bug**
docstring default arg is broken in html.
Python class method
>     def add_lines(self, lines, color=(1, 1, 1), width=5, label=None, name=None):
is rendered as
>    add_lines(lines, color=1, 1, 1, width=5, label=None, name=None)

**To Reproduce**
Steps to reproduce the behavior (Dockerfile):
```
FROM python:3.7-slim
RUN apt update; apt install -y git make python3-vtk7
RUN git clone https://github.com/tkoyama010/pyvista.git
WORKDIR /pyvista
RUN git checkout patch-1
RUN pip install . 
RUN pip install -r requirements_docs.txt
RUN (cd docs; make html)
```

**Expected behavior**
A clear and concise description of what you expected to happen.
Python class method
>     def add_lines(self, lines, color=(1, 1, 1), width=5, label=None, name=None):
is rendered as
>    add_lines(lines, color=(1, 1, 1), width=5, label=None, name=None)

**Your project**
Link to your sphinx project, or attach zipped small project sample.
https://github.com/pyvista/pyvista
https://docs.pyvista.org/plotting/plotting.html#pyvista.BasePlotter.add_lines

**Screenshots**
If applicable, add screenshots to help explain your problem.
![image](https://user-images.githubusercontent.com/7513610/87623793-2e412d80-c761-11ea-8caa-0b8bfcaf56c3.png)

**Environment info**
- OS: [e.g. Unix/Linux/Mac/Win/other with version] Linux
- Python version: [e.g. 3.7.1] 3.7
- Sphinx version: [e.g. 1.8.2] sphinx-build 3.1.1
- Sphinx extensions:  [e.g. sphinx.ext.autodoc, recommonmark] sphinx.ext.autodoc
- Extra tools: [e.g. Browser, tex or something else] None

**Additional context**
Add any other context about the problem here.

- [e.g. URL or Ticket] None



Patch information:
diff --git a/sphinx/util/inspect.py b/sphinx/util/inspect.py
index 378174993..89c148a6e 100644
--- a/sphinx/util/inspect.py
+++ b/sphinx/util/inspect.py
@@ -626,7 +626,14 @@ def signature_from_ast(node: ast.FunctionDef) -> inspect.Signature:
             if defaults[i] is Parameter.empty:
                 default = Parameter.empty
             else:
-                default = ast_unparse(defaults[i])
+                default_node = defaults[i]
+                default = ast_unparse(default_node)
+                if isinstance(default_node, ast.Tuple):
+                    # ensure tuple defaults are parenthesized (and keep singleton comma)
+                    if len(getattr(default_node, 'elts', [])) == 1:
+                        default = f"({default},)"
+                    else:
+                        default = f"({default})"
 
             annotation = ast_unparse(arg.annotation) or Parameter.empty
             params.append(Parameter(arg.arg, Parameter.POSITIONAL_ONLY,
@@ -636,7 +643,14 @@ def signature_from_ast(node: ast.FunctionDef) -> inspect.Signature:
         if defaults[i + posonlyargs] is Parameter.empty:
             default = Parameter.empty
         else:
-            default = ast_unparse(defaults[i + posonlyargs])
+            default_node = defaults[i + posonlyargs]
+            default = ast_unparse(default_node)
+            if isinstance(default_node, ast.Tuple):
+                # ensure tuple defaults are parenthesized (and keep singleton comma)
+                if len(getattr(default_node, 'elts', [])) == 1:
+                    default = f"({default},)"
+                else:
+                    default = f"({default})"
 
         annotation = ast_unparse(arg.annotation) or Parameter.empty
         params.append(Parameter(arg.arg, Parameter.POSITIONAL_OR_KEYWORD,
@@ -649,6 +663,14 @@ def signature_from_ast(node: ast.FunctionDef) -> inspect.Signature:
 
     for i, arg in enumerate(args.kwonlyargs):
         default = ast_unparse(args.kw_defaults[i]) or Parameter.empty
+        if default is not Parameter.empty and args.kw_defaults[i] is not None:
+            default_node = args.kw_defaults[i]
+            if isinstance(default_node, ast.Tuple):
+                # ensure tuple defaults are parenthesized (and keep singleton comma)
+                if len(getattr(default_node, 'elts', [])) == 1:
+                    default = f"({default},)"
+                else:
+                    default = f"({default})"
         annotation = ast_unparse(arg.annotation) or Parameter.empty
         params.append(Parameter(arg.arg, Parameter.KEYWORD_ONLY, default=default,
                                 annotation=annotation))


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-12-23 12:32:50,959 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sphinx
├── .circleci
|   └── config.yml
├── .codecov.yml
├── .github
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.md
|   |   ├── config.yml
|   |   └── feature_request.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   └── workflows
|       ├── builddoc.yml
|       ├── lint.yml
|       └── main.yml
├── .travis.yml
├── CONTRIBUTING.rst
├── README.rst
├── bindep.txt
├── doc
|   ├── _static
|   |   ├── conf.py.txt
|   |   └── themes
|   |       └── fullsize
|   ├── _templates
|   |   ├── index.html
|   |   └── indexsidebar.html
|   ├── _themes
|   |   └── sphinx13
|   |       ├── layout.html
|   |       └── static
|   |           └── sphinx13.css
|   ├── changes.rst
|   ├── conf.py
|   ├── contents.rst
|   ├── develop.rst
|   ├── development
|   |   ├── builders.rst
|   |   ├── index.rst
|   |   ├── overview.rst
|   |   ├── theming.rst
|   |   └── tutorials
|   |       ├── examples
|   |       |   ├── README.rst
|   |       |   ├── helloworld.py
|   |       |   ├── recipe.py
|   |       |   └── todo.py
|   |       ├── helloworld.rst
|   |       ├── index.rst
|   |       ├── recipe.rst
|   |       └── todo.rst
|   ├── examples.rst
|   ├── extdev
|   |   ├── appapi.rst
|   |   ├── builderapi.rst
|   |   ├── collectorapi.rst
|   |   ├── deprecated.rst
|   |   ├── domainapi.rst
|   |   ├── envapi.rst
|   |   ├── i18n.rst
|   |   ├── index.rst
|   |   ├── logging.rst
|   |   ├── markupapi.rst
|   |   ├── nodes.rst
|   |   ├── parserapi.rst
|   |   ├── projectapi.rst
|   |   └── utils.rst
|   ├── faq.rst
|   ├── glossary.rst
|   ├── internals
|   |   ├── authors.rst
|   |   ├── code-of-conduct.rst
|   |   ├── contributing.rst
|   |   ├── index.rst
|   |   ├── organization.rst
|   |   └── release-process.rst
|   ├── latex.rst
|   ├── man
|   |   ├── index.rst
|   |   ├── sphinx-apidoc.rst
|   |   ├── sphinx-autogen.rst
|   |   ├── sphinx-build.rst
|   |   └── sphinx-quickstart.rst
|   ├── templating.rst
|   └── usage
|       ├── advanced
|       |   ├── intl.rst
|       |   ├── setuptools.rst
|       |   └── websupport
|       |       ├── api.rst
|       |       ├── index.rst
|       |       ├── quickstart.rst
|       |       ├── searchadapters.rst
|       |       └── storagebackends.rst
|       ├── builders
|       |   └── index.rst
|       ├── configuration.rst
|       ├── extensions
|       |   ├── autodoc.rst
|       |   ├── autosectionlabel.rst
|       |   ├── autosummary.rst
|       |   ├── coverage.rst
|       |   ├── doctest.rst
|       |   ├── duration.rst
|       |   ├── example_google.py
|       |   ├── example_google.rst
|       |   ├── example_numpy.py
|       |   ├── example_numpy.rst
|       |   ├── extlinks.rst
|       |   ├── githubpages.rst
|       |   ├── graphviz.rst
|       |   ├── ifconfig.rst
|       |   ├── imgconverter.rst
|       |   ├── index.rst
|       |   ├── inheritance.rst
|       |   ├── intersphinx.rst
|       |   ├── linkcode.rst
|       |   ├── math.rst
|       |   ├── napoleon.rst
|       |   ├── todo.rst
|       |   └── viewcode.rst
|       ├── index.rst
|       ├── installation.rst
|       ├── markdown.rst
|       ├── quickstart.rst
|       ├── restructuredtext
|       |   ├── basics.rst
|       |   ├── directives.rst
|       |   ├── domains.rst
|       |   ├── field-lists.rst
|       |   ├── index.rst
|       |   └── roles.rst
|       └── theming.rst
├── karma.conf.js
├── setup.py
├── sphinx
|   ├── __init__.py
|   ├── __main__.py
|   ├── addnodes.py
|   ├── application.py
|   ├── builders
|   |   ├── __init__.py
|   |   ├── _epub_base.py
|   |   ├── applehelp.py
|   |   ├── changes.py
|   |   ├── devhelp.py
|   |   ├── dirhtml.py
|   |   ├── dummy.py
|   |   ├── epub3.py
|   |   ├── gettext.py
|   |   ├── html
|   |   |   ├── __init__.py
|   |   |   └── transforms.py
|   |   ├── htmlhelp.py
|   |   ├── latex
|   |   |   ├── __init__.py
|   |   |   ├── constants.py
|   |   |   ├── nodes.py
|   |   |   ├── theming.py
|   |   |   ├── transforms.py
|   |   |   └── util.py
|   |   ├── linkcheck.py
|   |   ├── manpage.py
|   |   ├── qthelp.py
|   |   ├── singlehtml.py
|   |   ├── texinfo.py
|   |   ├── text.py
|   |   └── xml.py
|   ├── cmd
|   |   ├── __init__.py
|   |   ├── build.py
|   |   ├── make_mode.py
|   |   └── quickstart.py
|   ├── config.py
|   ├── deprecation.py
|   ├── directives
|   |   ├── __init__.py
|   |   ├── code.py
|   |   ├── other.py
|   |   └── patches.py
|   ├── domains
|   |   ├── __init__.py
|   |   ├── c.py
|   |   ├── changeset.py
|   |   ├── citation.py
|   |   ├── cpp.py
|   |   ├── index.py
|   |   ├── javascript.py
|   |   ├── math.py
|   |   ├── python.py
|   |   ├── rst.py
|   |   └── std.py
|   ├── environment
|   |   ├── __init__.py
|   |   ├── adapters
|   |   |   ├── __init__.py
|   |   |   ├── asset.py
|   |   |   ├── indexentries.py
|   |   |   └── toctree.py
|   |   └── collectors
|   |       ├── __init__.py
|   |       ├── asset.py
|   |       ├── dependencies.py
|   |       ├── indexentries.py
|   |       ├── metadata.py
|   |       ├── title.py
|   |       └── toctree.py
|   ├── errors.py
|   ├── events.py
|   ├── ext
|   |   ├── __init__.py
|   |   ├── apidoc.py
|   |   ├── autodoc
|   |   |   ├── __init__.py
|   |   |   ├── directive.py
|   |   |   ├── importer.py
|   |   |   ├── mock.py
|   |   |   ├── type_comment.py
|   |   |   └── typehints.py
|   |   ├── autosectionlabel.py
|   |   ├── autosummary
|   |   |   ├── __init__.py
|   |   |   ├── generate.py
|   |   |   └── templates
|   |   |       └── autosummary
|   |   ├── coverage.py
|   |   ├── doctest.py
|   |   ├── duration.py
|   |   ├── extlinks.py
|   |   ├── githubpages.py
|   |   ├── graphviz.py
|   |   ├── ifconfig.py
|   |   ├── imgconverter.py
|   |   ├── imgmath.py
|   |   ├── inheritance_diagram.py
|   |   ├── intersphinx.py
|   |   ├── jsmath.py
|   |   ├── linkcode.py
|   |   ├── mathjax.py
|   |   ├── napoleon
|   |   |   ├── __init__.py
|   |   |   ├── docstring.py
|   |   |   └── iterators.py
|   |   ├── todo.py
|   |   └── viewcode.py
|   ├── extension.py
|   ├── highlighting.py
|   ├── io.py
|   ├── jinja2glue.py
|   ├── locale
|   |   ├── __init__.py
|   |   ├── ar
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bg
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bn
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ca
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cak
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cs
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cy
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── da
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── de
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── el
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eo
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── es
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── et
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fa
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── he
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi_IN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── id
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── it
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ja
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ko
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── mk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nb_NO
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ne
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_BR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_PT
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ro
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ru
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── si
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sq
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr@latin
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr_RS
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ta
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── te
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── tr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── uk_UA
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ur
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── vi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_CN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   └── zh_TW
|   |       └── LC_MESSAGES
|   |           └── sphinx.js
|   ├── parsers.py
|   ├── project.py
|   ├── pycode
|   |   ├── __init__.py
|   |   ├── ast.py
|   |   └── parser.py
|   ├── pygments_styles.py
|   ├── registry.py
|   ├── roles.py
|   ├── search
|   |   ├── __init__.py
|   |   ├── da.py
|   |   ├── de.py
|   |   ├── en.py
|   |   ├── es.py
|   |   ├── fi.py
|   |   ├── fr.py
|   |   ├── hu.py
|   |   ├── it.py
|   |   ├── ja.py
|   |   ├── jssplitter.py
|   |   ├── nl.py
|   |   ├── no.py
|   |   ├── non-minified-js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── pt.py
|   |   ├── ro.py
|   |   ├── ru.py
|   |   ├── sv.py
|   |   ├── tr.py
|   |   └── zh.py
|   ├── setup_command.py
|   ├── templates
|   |   ├── apidoc
|   |   ├── epub3
|   |   |   └── container.xml
|   |   ├── gettext
|   |   ├── graphviz
|   |   |   └── graphviz.css
|   |   ├── htmlhelp
|   |   ├── imgmath
|   |   ├── latex
|   |   ├── quickstart
|   |   └── texinfo
|   ├── testing
|   |   ├── __init__.py
|   |   ├── comparer.py
|   |   ├── fixtures.py
|   |   ├── path.py
|   |   ├── restructuredtext.py
|   |   └── util.py
|   ├── texinputs
|   ├── texinputs_win
|   ├── themes
|   |   ├── agogo
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── basic
|   |   |   ├── changes
|   |   |   |   ├── frameset.html
|   |   |   |   ├── rstsource.html
|   |   |   |   └── versionchanges.html
|   |   |   ├── defindex.html
|   |   |   ├── domainindex.html
|   |   |   ├── genindex-single.html
|   |   |   ├── genindex-split.html
|   |   |   ├── genindex.html
|   |   |   ├── globaltoc.html
|   |   |   ├── layout.html
|   |   |   ├── localtoc.html
|   |   |   ├── opensearch.xml
|   |   |   ├── page.html
|   |   |   ├── relations.html
|   |   |   ├── search.html
|   |   |   ├── searchbox.html
|   |   |   ├── sourcelink.html
|   |   |   └── static
|   |   |       ├── doctools.js
|   |   |       ├── jquery-3.5.1.js
|   |   |       ├── jquery.js
|   |   |       ├── searchtools.js
|   |   |       ├── underscore-1.3.1.js
|   |   |       └── underscore.js
|   |   ├── bizstyle
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── css3-mediaqueries.js
|   |   |       └── css3-mediaqueries_src.js
|   |   ├── classic
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── default
|   |   |   └── static
|   |   |       └── default.css
|   |   ├── epub
|   |   |   ├── epub-cover.html
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── haiku
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── nature
|   |   |   └── static
|   |   ├── nonav
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       └── nonav.css
|   |   ├── pyramid
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── epub.css
|   |   |       └── ie6.css
|   |   ├── scrolls
|   |   |   ├── artwork
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── print.css
|   |   |       └── theme_extras.js
|   |   ├── sphinxdoc
|   |   |   └── static
|   |   └── traditional
|   |       └── static
|   ├── theming.py
|   ├── transforms
|   |   ├── __init__.py
|   |   ├── compact_bullet_list.py
|   |   ├── i18n.py
|   |   ├── post_transforms
|   |   |   ├── __init__.py
|   |   |   ├── code.py
|   |   |   └── images.py
|   |   └── references.py
|   ├── util
|   |   ├── __init__.py
|   |   ├── build_phase.py
|   |   ├── cfamily.py
|   |   ├── compat.py
|   |   ├── console.py
|   |   ├── docfields.py
|   |   ├── docstrings.py
|   |   ├── docutils.py
|   |   ├── fileutil.py
|   |   ├── i18n.py
|   |   ├── images.py
|   |   ├── inspect.py
|   |   ├── inventory.py
|   |   ├── jsdump.py
|   |   ├── jsonimpl.py
|   |   ├── logging.py
|   |   ├── matching.py
|   |   ├── math.py
|   |   ├── nodes.py
|   |   ├── osutil.py
|   |   ├── parallel.py
|   |   ├── png.py
|   |   ├── pycompat.py
|   |   ├── requests.py
|   |   ├── rst.py
|   |   ├── smartypants.py
|   |   ├── stemmer
|   |   |   ├── __init__.py
|   |   |   └── porter.py
|   |   ├── tags.py
|   |   ├── template.py
|   |   ├── texescape.py
|   |   └── typing.py
|   ├── versioning.py
|   └── writers
|       ├── __init__.py
|       ├── html.py
|       ├── html5.py
|       ├── latex.py
|       ├── manpage.py
|       ├── texinfo.py
|       ├── text.py
|       └── xml.py
├── tests
|   ├── conftest.py
|   ├── js
|   |   └── doctools.js
|   ├── roots
|   |   ├── test-add_enumerable_node
|   |   |   ├── conf.py
|   |   |   ├── enumerable_node.py
|   |   |   └── index.rst
|   |   ├── test-add_source_parser
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-add_source_parser-conflicts-with-users-setting
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-api-set-translator
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nonext
|   |   |   |   └── conf.py
|   |   |   └── translator.py
|   |   ├── test-apidoc-pep420
|   |   |   └── a
|   |   |       └── b
|   |   ├── test-apidoc-subpackage-in-toc
|   |   |   └── parent
|   |   |       ├── __init__.py
|   |   |       └── child
|   |   ├── test-apidoc-toc
|   |   |   └── mypackage
|   |   |       ├── __init__.py
|   |   |       ├── main.py
|   |   |       ├── no_init
|   |   |       ├── resource
|   |   |       └── something
|   |   ├── test-apidoc-trailing-underscore
|   |   |   └── package_
|   |   |       ├── __init__.py
|   |   |       └── module_.py
|   |   ├── test-autosummary
|   |   |   ├── conf.py
|   |   |   ├── dummy_module.py
|   |   |   ├── index.rst
|   |   |   ├── sphinx.rst
|   |   |   └── underscore_module_.py
|   |   ├── test-basic
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-html-translator
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-text
|   |   |   ├── conf.py
|   |   |   ├── doc1.txt
|   |   |   ├── doc2.txt
|   |   |   ├── index.txt
|   |   |   ├── lineblock.txt
|   |   |   ├── listitems.txt
|   |   |   ├── maxwidth.txt
|   |   |   ├── nonascii_maxwidth.txt
|   |   |   ├── nonascii_table.txt
|   |   |   ├── nonascii_title.txt
|   |   |   ├── table.txt
|   |   |   ├── table_colspan.txt
|   |   |   ├── table_colspan_and_rowspan.txt
|   |   |   ├── table_colspan_left.txt
|   |   |   └── table_rowspan.txt
|   |   ├── test-builder-dirhtml
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo
|   |   |   |   ├── foo_1.rst
|   |   |   |   ├── foo_2.rst
|   |   |   |   └── index.rst
|   |   |   └── index.rst
|   |   ├── test-builder-gettext-dont-rebuild-mo
|   |   |   ├── bom.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-changes
|   |   |   ├── base.rst
|   |   |   ├── c-api.rst
|   |   |   ├── conf.py
|   |   |   ├── contents.rst
|   |   |   └── library
|   |   |       └── utils.rst
|   |   ├── test-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-config
|   |   |   └── conf.py
|   |   ├── test-correct-year
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-default_role
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-directive-code
|   |   |   ├── caption.rst
|   |   |   ├── classes.rst
|   |   |   ├── conf.py
|   |   |   ├── emphasize.rst
|   |   |   ├── force.rst
|   |   |   ├── highlight.rst
|   |   |   ├── index.rst
|   |   |   ├── linenos.rst
|   |   |   ├── linenothreshold.rst
|   |   |   ├── namedblocks.rst
|   |   |   ├── py-decorators.rst
|   |   |   ├── python.rst
|   |   |   └── target.py
|   |   ├── test-directive-only
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── only.rst
|   |   ├── test-directives-raw
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-docutilsconf
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-c
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── namespace.rst
|   |   |   └── semicolon.rst
|   |   ├── test-domain-cpp
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── any-role.rst
|   |   |   ├── backslash.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── lookup-key-overload.rst
|   |   |   ├── multi-decl-lookup.rst
|   |   |   ├── roles-targets-ok.rst
|   |   |   ├── roles-targets-warn.rst
|   |   |   ├── roles.rst
|   |   |   ├── roles2.rst
|   |   |   ├── semicolon.rst
|   |   |   ├── warn-template-param-qualified-name.rst
|   |   |   └── xref_consistency.rst
|   |   ├── test-domain-js
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   ├── module_option.rst
|   |   |   └── roles.rst
|   |   ├── test-double-inheriting-theme
|   |   |   ├── base_themes_dir
|   |   |   |   ├── base_theme1
|   |   |   |   └── base_theme2
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-epub-anchor-id
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autodoc
|   |   |   ├── autodoc_dummy_bar.py
|   |   |   ├── autodoc_dummy_module.py
|   |   |   ├── bug2437
|   |   |   |   ├── __init__.py
|   |   |   |   └── autodoc_dummy_foo.py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target
|   |   |       ├── TYPE_CHECKING.py
|   |   |       ├── __init__.py
|   |   |       ├── abstractmethods.py
|   |   |       ├── annotated.py
|   |   |       ├── annotations.py
|   |   |       ├── autoclass_content.py
|   |   |       ├── bound_method.py
|   |   |       ├── cached_property.py
|   |   |       ├── callable.py
|   |   |       ├── classes.py
|   |   |       ├── coroutine.py
|   |   |       ├── decorator.py
|   |   |       ├── descriptor.py
|   |   |       ├── docstring_signature.py
|   |   |       ├── enums.py
|   |   |       ├── final.py
|   |   |       ├── functions.py
|   |   |       ├── generic_class.py
|   |   |       ├── genericalias.py
|   |   |       ├── imported_members.py
|   |   |       ├── inheritance.py
|   |   |       ├── methods.py
|   |   |       ├── name_conflict
|   |   |       ├── name_mangling.py
|   |   |       ├── need_mocks.py
|   |   |       ├── overload.py
|   |   |       ├── partialfunction.py
|   |   |       ├── partialmethod.py
|   |   |       ├── pep570.py
|   |   |       ├── private.py
|   |   |       ├── process_docstring.py
|   |   |       ├── singledispatch.py
|   |   |       ├── singledispatchmethod.py
|   |   |       ├── slots.py
|   |   |       ├── sort_by_all.py
|   |   |       ├── typed_vars.py
|   |   |       ├── typehints.py
|   |   |       ├── typevar.py
|   |   |       └── wrappedfunction.py
|   |   ├── test-ext-autosectionlabel
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosectionlabel-prefix-document
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── autosummary_importfail.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-filename-map
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-imported_members
|   |   |   ├── autosummary_dummy_package
|   |   |   |   ├── __init__.py
|   |   |   |   └── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-mock_imports
|   |   |   ├── conf.py
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-recursive
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── package
|   |   |   |   ├── __init__.py
|   |   |   |   ├── module.py
|   |   |   |   ├── module_importfail.py
|   |   |   |   └── package
|   |   |   └── package2
|   |   |       ├── __init__.py
|   |   |       └── module.py
|   |   ├── test-ext-autosummary-skip-member
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-autosummary-template
|   |   |   ├── _templates
|   |   |   |   └── empty.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-coverage
|   |   |   ├── conf.py
|   |   |   ├── coverage_ignored.py
|   |   |   ├── coverage_not_ignored.py
|   |   |   └── index.rst
|   |   ├── test-ext-doctest
|   |   |   ├── conf.py
|   |   |   └── doctest.txt
|   |   ├── test-ext-doctest-skipif
|   |   |   ├── conf.py
|   |   |   └── skipif.txt
|   |   ├── test-ext-doctest-with-autodoc
|   |   |   ├── conf.py
|   |   |   ├── dir
|   |   |   |   ├── __init__.py
|   |   |   |   ├── bar.py
|   |   |   |   └── inner.rst
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-githubpages
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-graphviz
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-ifconfig
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-imgconverter
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-inheritance_diagram
|   |   |   ├── conf.py
|   |   |   ├── example
|   |   |   |   ├── __init__.py
|   |   |   |   └── sphinx.py
|   |   |   ├── index.rst
|   |   |   └── test.py
|   |   ├── test-ext-intersphinx-cppdomain
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── math.rst
|   |   |   └── page.rst
|   |   ├── test-ext-math-compat
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math-simple
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-todo
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-ext-viewcode
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── objects.rst
|   |   |   └── spam
|   |   |       ├── __init__.py
|   |   |       ├── mod1.py
|   |   |       ├── mod2.py
|   |   |       └── mod3.py
|   |   ├── test-ext-viewcode-find
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── not_a_package
|   |   |       ├── __init__.py
|   |   |       └── submodule.py
|   |   ├── test-extensions
|   |   |   ├── conf.py
|   |   |   ├── read_parallel.py
|   |   |   ├── read_serial.py
|   |   |   ├── write_parallel.py
|   |   |   └── write_serial.py
|   |   ├── test-footnotes
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-gettext-template
|   |   |   ├── _templates
|   |   |   |   ├── template1.html
|   |   |   |   └── template2.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-glossary
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_assets
|   |   |   ├── conf.py
|   |   |   ├── extra
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   └── subdir
|   |   |   ├── index.rst
|   |   |   ├── static
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   ├── js
|   |   |   |   └── subdir
|   |   |   └── subdir
|   |   |       └── _build
|   |   ├── test-html_entity
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_scaled_image_link
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_style
|   |   |   ├── _static
|   |   |   |   └── default.css
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-parsed-literal
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-section
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-images
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── subdir
|   |   |       └── index.rst
|   |   ├── test-index_on_title
|   |   |   ├── conf.py
|   |   |   └── contents.rst
|   |   ├── test-inheritance
|   |   |   ├── basic_diagram.rst
|   |   |   ├── conf.py
|   |   |   ├── diagram_module_w_2_top_classes.rst
|   |   |   ├── diagram_w_1_top_class.rst
|   |   |   ├── diagram_w_2_top_classes.rst
|   |   |   ├── diagram_w_nested_classes.rst
|   |   |   ├── diagram_w_parts.rst
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── test.py
|   |   |   |   └── test_nested.py
|   |   |   └── index.rst
|   |   ├── test-intl
|   |   |   ├── _templates
|   |   |   |   └── contents.html
|   |   |   ├── admonitions.txt
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── definition_terms.txt
|   |   |   ├── docfields.txt
|   |   |   ├── external_links.txt
|   |   |   ├── figure.txt
|   |   |   ├── footnote.txt
|   |   |   ├── glossary_terms.txt
|   |   |   ├── glossary_terms_inconsistency.txt
|   |   |   ├── index.txt
|   |   |   ├── index_entries.txt
|   |   |   ├── label_target.txt
|   |   |   ├── literalblock.txt
|   |   |   ├── only.txt
|   |   |   ├── raw.txt
|   |   |   ├── refs.txt
|   |   |   ├── refs_inconsistency.txt
|   |   |   ├── refs_python_domain.txt
|   |   |   ├── role_xref.txt
|   |   |   ├── rubric.txt
|   |   |   ├── section.txt
|   |   |   ├── seealso.txt
|   |   |   ├── subdir
|   |   |   |   └── index.txt
|   |   |   ├── table.txt
|   |   |   ├── toctree.txt
|   |   |   ├── topic.txt
|   |   |   ├── versionchange.txt
|   |   |   ├── warnings.txt
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-keep_warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-babel
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-latex-equations
|   |   |   ├── conf.py
|   |   |   ├── equations.rst
|   |   |   └── expects
|   |   ├── test-latex-figure-in-admonition
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-includegraphics
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-index
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-labels
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── otherdoc.rst
|   |   ├── test-latex-numfig
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── indexhowto.rst
|   |   |   └── indexmanual.rst
|   |   ├── test-latex-table
|   |   |   ├── _mytemplates
|   |   |   |   └── latex
|   |   |   ├── complex.rst
|   |   |   ├── conf.py
|   |   |   ├── expects
|   |   |   ├── index.rst
|   |   |   ├── longtable.rst
|   |   |   └── tabular.rst
|   |   ├── test-latex-theme
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── theme
|   |   |       └── custom
|   |   ├── test-latex-title
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-unicode
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck
|   |   |   ├── conf.py
|   |   |   └── links.txt
|   |   ├── test-linkcheck-localserver
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-locale
|   |   |   ├── locale1
|   |   |   |   └── en
|   |   |   └── locale2
|   |   |       └── en
|   |   ├── test-manpage_url
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-citation
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-rubric
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-maxlistdepth
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-metadata
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-need-escaped
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux.rst
|   |   ├── test-nested-enumerated-list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nested-tables
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-numbered-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-numfig
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-productionlist
|   |   |   ├── Bare.rst
|   |   |   ├── Dup1.rst
|   |   |   ├── Dup2.rst
|   |   |   ├── LineContinuation.rst
|   |   |   ├── P1.rst
|   |   |   ├── P2.rst
|   |   |   ├── conf.py
|   |   |   ├── firstLineRule.rst
|   |   |   └── index.rst
|   |   ├── test-prolog
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── markdown.md
|   |   |   ├── prolog_markdown_parser.py
|   |   |   └── restructuredtext.rst
|   |   ├── test-pycode
|   |   |   └── cp_1251_coded.py
|   |   ├── test-pycode-egg
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── src
|   |   |       ├── sample.py
|   |   |       └── setup.py
|   |   ├── test-reST-code-block
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-refonly_bullet_list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-roles-download
|   |   |   ├── another
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-root
|   |   |   ├── _templates
|   |   |   |   ├── contentssb.html
|   |   |   |   ├── customsb.html
|   |   |   |   └── layout.html
|   |   |   ├── autodoc.txt
|   |   |   ├── autodoc_target.py
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── extapi.txt
|   |   |   ├── extensions.txt
|   |   |   ├── footnote.txt
|   |   |   ├── images.txt
|   |   |   ├── includes.txt
|   |   |   ├── index.txt
|   |   |   ├── lists.txt
|   |   |   ├── markup.txt
|   |   |   ├── math.txt
|   |   |   ├── objects.txt
|   |   |   ├── parsermod.py
|   |   |   ├── special
|   |   |   |   └── code.py
|   |   |   └── subdir
|   |   |       ├── excluded.txt
|   |   |       ├── images.txt
|   |   |       └── includes.txt
|   |   ├── test-search
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nosearch.rst
|   |   |   └── tocitem.rst
|   |   ├── test-setup
|   |   |   ├── doc
|   |   |   |   ├── conf.py
|   |   |   |   └── index.txt
|   |   |   └── setup.py
|   |   ├── test-smartquotes
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-stylesheets
|   |   |   ├── _templates
|   |   |   |   └── layout.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-templating
|   |   |   ├── _templates
|   |   |   |   ├── autosummary
|   |   |   |   └── layout.html
|   |   |   ├── autosummary_templating.txt
|   |   |   ├── conf.py
|   |   |   └── index.txt
|   |   ├── test-theming
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── setup.py
|   |   |   └── test_theme
|   |   |       ├── __init__.py
|   |   |       ├── staticfiles
|   |   |       └── test-theme
|   |   ├── test-tocdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   ├── qux.rst
|   |   |   └── tocdepth.rst
|   |   ├── test-toctree-duplicated
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree-empty
|   |   |   ├── _templates
|   |   |   |   └── localtoc.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-toctree-glob
|   |   |   ├── bar
|   |   |   |   ├── bar_1.rst
|   |   |   |   ├── bar_2.rst
|   |   |   |   ├── bar_3.rst
|   |   |   |   ├── bar_4
|   |   |   |   └── index.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux
|   |   |       ├── index.rst
|   |   |       ├── qux_1.rst
|   |   |       └── qux_2.rst
|   |   ├── test-toctree-maxdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   └── qux.rst
|   |   ├── test-trim_doctest_flags
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-versioning
|   |   |   ├── added.txt
|   |   |   ├── conf.py
|   |   |   ├── deleted.txt
|   |   |   ├── deleted_end.txt
|   |   |   ├── index.txt
|   |   |   ├── insert.txt
|   |   |   ├── insert_beginning.txt
|   |   |   ├── insert_similar.txt
|   |   |   ├── modified.txt
|   |   |   └── original.txt
|   |   └── test-warnings
|   |       ├── autodoc_fodder.py
|   |       ├── conf.py
|   |       ├── index.rst
|   |       └── undecodable.rst
|   ├── test_api_translator.py
|   ├── test_application.py
|   ├── test_build.py
|   ├── test_build_changes.py
|   ├── test_build_dirhtml.py
|   ├── test_build_epub.py
|   ├── test_build_gettext.py
|   ├── test_build_html.py
|   ├── test_build_latex.py
|   ├── test_build_linkcheck.py
|   ├── test_build_manpage.py
|   ├── test_build_texinfo.py
|   ├── test_build_text.py
|   ├── test_builder.py
|   ├── test_catalogs.py
|   ├── test_config.py
|   ├── test_correct_year.py
|   ├── test_directive_code.py
|   ├── test_directive_only.py
|   ├── test_directive_other.py
|   ├── test_directive_patch.py
|   ├── test_docutilsconf.py
|   ├── test_domain_c.py
|   ├── test_domain_cpp.py
|   ├── test_domain_js.py
|   ├── test_domain_py.py
|   ├── test_domain_rst.py
|   ├── test_domain_std.py
|   ├── test_environment.py
|   ├── test_environment_indexentries.py
|   ├── test_environment_toctree.py
|   ├── test_errors.py
|   ├── test_events.py
|   ├── test_ext_apidoc.py
|   ├── test_ext_autodoc.py
|   ├── test_ext_autodoc_autofunction.py
|   ├── test_ext_autodoc_configs.py
|   ├── test_ext_autodoc_events.py
|   ├── test_ext_autodoc_mock.py
|   ├── test_ext_autodoc_private_members.py
|   ├── test_ext_autosectionlabel.py
|   ├── test_ext_autosummary.py
|   ├── test_ext_coverage.py
|   ├── test_ext_doctest.py
|   ├── test_ext_duration.py
|   ├── test_ext_githubpages.py
|   ├── test_ext_graphviz.py
|   ├── test_ext_ifconfig.py
|   ├── test_ext_imgconverter.py
|   ├── test_ext_inheritance_diagram.py
|   ├── test_ext_intersphinx.py
|   ├── test_ext_math.py
|   ├── test_ext_napoleon.py
|   ├── test_ext_napoleon_docstring.py
|   ├── test_ext_napoleon_iterators.py
|   ├── test_ext_todo.py
|   ├── test_ext_viewcode.py
|   ├── test_highlighting.py
|   ├── test_intl.py
|   ├── test_locale.py
|   ├── test_markup.py
|   ├── test_metadata.py
|   ├── test_parser.py
|   ├── test_project.py
|   ├── test_pycode.py
|   ├── test_pycode_ast.py
|   ├── test_pycode_parser.py
|   ├── test_quickstart.py
|   ├── test_roles.py
|   ├── test_search.py
|   ├── test_setup_command.py
|   ├── test_smartquotes.py
|   ├── test_templating.py
|   ├── test_theming.py
|   ├── test_toctree.py
|   ├── test_transforms_post_transforms_code.py
|   ├── test_util.py
|   ├── test_util_docstrings.py
|   ├── test_util_docutils.py
|   ├── test_util_fileutil.py
|   ├── test_util_i18n.py
|   ├── test_util_images.py
|   ├── test_util_inspect.py
|   ├── test_util_inventory.py
|   ├── test_util_jsdump.py
|   ├── test_util_logging.py
|   ├── test_util_matching.py
|   ├── test_util_nodes.py
|   ├── test_util_pycompat.py
|   ├── test_util_rst.py
|   ├── test_util_template.py
|   ├── test_util_typing.py
|   ├── test_versioning.py
|   ├── test_writer_latex.py
|   └── typing_test_data.py
└── utils
    ├── __init__.py
    ├── bump_docker.sh
    ├── bump_version.py
    ├── checks.py
    ├── doclinter.py
    └── jssplitter_generator.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: docstring default arg is broken

Description: **Describe the bug**
docstring default arg is broken in html.
Python class method
>     def add_lines(self, lines, color=(1, 1, 1), width=5, label=None, name=None):
is rendered as
>    add_lines(lines, color=1, 1, 1, width=5, label=None, name=None)

**To Reproduce**
Steps to reproduce the behavior (Dockerfile):
```
FROM python:3.7-slim
RUN apt update; apt install -y git make python3-vtk7
RUN git clone https://github.com/tkoyama010/pyvista.git
WORKDIR /pyvista
RUN git checkout patch-1
RUN pip install . 
RUN pip install -r requirements_docs.txt
RUN (cd docs; make html)
```

**Expected behavior**
A clear and concise description of what you expected to happen.
Python class method
>     def add_lines(self, lines, color=(1, 1, 1), width=5, label=None, name=None):
is rendered as
>    add_lines(lines, color=(1, 1, 1), width=5, label=None, name=None)

**Your project**
Link to your sphinx project, or attach zipped small project sample.
https://github.com/pyvista/pyvista
https://docs.pyvista.org/plotting/plotting.html#pyvista.BasePlotter.add_lines

**Screenshots**
If applicable, add screenshots to help explain your problem.
![image](https://user-images.githubusercontent.com/7513610/87623793-2e412d80-c761-11ea-8caa-0b8bfcaf56c3.png)

**Environment info**
- OS: [e.g. Unix/Linux/Mac/Win/other with version] Linux
- Python version: [e.g. 3.7.1] 3.7
- Sphinx version: [e.g. 1.8.2] sphinx-build 3.1.1
- Sphinx extensions:  [e.g. sphinx.ext.autodoc, recommonmark] sphinx.ext.autodoc
- Extra tools: [e.g. Browser, tex or something else] None

**Additional context**
Add any other context about the problem here.

- [e.g. URL or Ticket] None



Patch information:
diff --git a/sphinx/util/inspect.py b/sphinx/util/inspect.py
index 378174993..89c148a6e 100644
--- a/sphinx/util/inspect.py
+++ b/sphinx/util/inspect.py
@@ -626,7 +626,14 @@ def signature_from_ast(node: ast.FunctionDef) -> inspect.Signature:
             if defaults[i] is Parameter.empty:
                 default = Parameter.empty
             else:
-                default = ast_unparse(defaults[i])
+                default_node = defaults[i]
+                default = ast_unparse(default_node)
+                if isinstance(default_node, ast.Tuple):
+                    # ensure tuple defaults are parenthesized (and keep singleton comma)
+                    if len(getattr(default_node, 'elts', [])) == 1:
+                        default = f"({default},)"
+                    else:
+                        default = f"({default})"
 
             annotation = ast_unparse(arg.annotation) or Parameter.empty
             params.append(Parameter(arg.arg, Parameter.POSITIONAL_ONLY,
@@ -636,7 +643,14 @@ def signature_from_ast(node: ast.FunctionDef) -> inspect.Signature:
         if defaults[i + posonlyargs] is Parameter.empty:
             default = Parameter.empty
         else:
-            default = ast_unparse(defaults[i + posonlyargs])
+            default_node = defaults[i + posonlyargs]
+            default = ast_unparse(default_node)
+            if isinstance(default_node, ast.Tuple):
+                # ensure tuple defaults are parenthesized (and keep singleton comma)
+                if len(getattr(default_node, 'elts', [])) == 1:
+                    default = f"({default},)"
+                else:
+                    default = f"({default})"
 
         annotation = ast_unparse(arg.annotation) or Parameter.empty
         params.append(Parameter(arg.arg, Parameter.POSITIONAL_OR_KEYWORD,
@@ -649,6 +663,14 @@ def signature_from_ast(node: ast.FunctionDef) -> inspect.Signature:
 
     for i, arg in enumerate(args.kwonlyargs):
         default = ast_unparse(args.kw_defaults[i]) or Parameter.empty
+        if default is not Parameter.empty and args.kw_defaults[i] is not None:
+            default_node = args.kw_defaults[i]
+            if isinstance(default_node, ast.Tuple):
+                # ensure tuple defaults are parenthesized (and keep singleton comma)
+                if len(getattr(default_node, 'elts', [])) == 1:
+                    default = f"({default},)"
+                else:
+                    default = f"({default})"
         annotation = ast_unparse(arg.annotation) or Parameter.empty
         params.append(Parameter(arg.arg, Parameter.KEYWORD_ONLY, default=default,
                                 annotation=annotation))


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-23 12:33:12,860 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find three relevant test cases for a bug concerning the rendering of default arguments in docstrings. The provided patch modifies `sphinx/util/inspect.py`, which is responsible for signature inspection. Therefore, the most relevant test file is likely `tests/test_util_inspect.py`, as it should contain unit tests for the patched functionality. I will start by analyzing this file to find test cases that cover default argument parsing and rendering.' query='Please provide the full content of tests/test_util_inspect.py.' extra_requirements='' purpose='This file is expected to contain unit tests for the patched code in `sphinx/util/inspect.py`, which will help identify test cases related to function signature parsing and default argument handling.'
2025-12-23 12:33:12,861 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of tests/test_util_inspect.py.
2025-12-23 12:33:12,861 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-23 12:33:12,862 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-23 12:33:12,863 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-23 12:33:12,863 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of tests/test_util_inspect.py.
Purpose: This file is expected to contain unit tests for the patched code in `sphinx/util/inspect.py`, which will help identify test cases related to function signature parsing and default argument handling.
2025-12-23 12:33:14,933 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/test_util_inspect.py"}'}, '__gemini_function_call_thought_signatures__': {'eecc413d-7d0f-42c4-b4c8-576b43f5194c': 'CrgDAY89a18SzS+ztpPA6mZ9GCfpFqQwhiMRZH86jhtwvepRHI5XPJ+79B6BNzpPynnmbKt1zl7MHFW1Ah4oyrMusBql/k+g60b3171bbEHZX+GFnOzmj382NfWEdJl3C9O0/ADLEz2EFfOc8EjeYZcy0ERq9c5lS2YMSKhye7Nz1/lGbHrihg7EV4qNMoenbd7aYaK4CxrrO/Xv+N8G7zGYlh7dIdnWZAapUIFJg1g3kWoJZNwYJN318Fyn6PiyHWoj/GuN+cExI3bXaw91tHv4ueB+SE4HjRX/ENrgzB9+2A2zMy1GVsdC2jyzqSjN5rkZ1OfsDT2/p1tdOeigORcHMMyE7HrOBm5f8aDMSVj4Vj9lYdyusbb7Lz10TxNl0HbIFhbzTC8v4X0yEOF5z4QwXAKAig7s6VuGmfWI/c71q0VAhotqcOorua1s60L+uISScKBBD4lv9YCPG17sqpxzZjzrVwrmU+PhoFLPRq+Z4WufsPqmP5cvkSZs1sb4yDAFQYE+lu7sb02lWuDMmQRYSPlS+EHuY9oLMl8Mqc/nvG9kAneWZEI89t93I9zV1es/2Kjih6eM3Mw='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2090, 'candidates_token_count': 23, 'total_token_count': 2231, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2090}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 23}], 'thoughts_token_count': 118, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.1433054364245871, 'model_name': 'gemini-2.5-pro'} id='run--cb7acae5-5b8b-419d-9c14-f80b58be3155-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/test_util_inspect.py'}, 'id': 'eecc413d-7d0f-42c4-b4c8-576b43f5194c', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2090, 'output_tokens': 23, 'total_tokens': 2231, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 118}}
2025-12-23 12:33:17,326 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 501.0, "relative_path": "tests/test_util_inspect.py", "end_line": 1000.0}'}, '__gemini_function_call_thought_signatures__': {'daeb2330-df0c-4ea5-9739-2bba872c3dc1': 'CtsDAY89a1+GMqiO9Rhpd1nmH0JoxhDp73dYbbPsyU03wOn1rMKH6aCTiyuuWRPPpBIm+jCNOQIo9XscKnlzt9TI8r5z7tLtT4GBz/t2W9cQbERC9TuD/PB/Wwr3tS5HCiqwi/midfsvrn8wYPOI1LxJkiXGiVDGDDUOxZqQHcM91VZ3YaYz4CD2tCHx/B+mEBYI2W/rbvj2gg7JY/1gYx7L7oMQG7ldWHk6l1SBE4KtNY9/oyCwug+qVQvxDaBpAEMnOAo0dNwYfCogruxKNoaQujQgcOLThCtjLcwv47SH1CsI9jDL70k1GB9kcHAKCwEwLWjRg+WOCJ2XUwx2/ejptB2TyBPSiavwP2a5QnFwZOaCutHZD73V4cnDzL125QsSCALxzLVM8I/CLAYze5SMn+JrNpSVtLCdujxNWy86i9ar4QvRdzoNTEiAUCsgrqkJcbibc6853QcHuZ/cYhhNruuVMlTAL8JTGngqgWzFJZW1kPbekm4eiJ3fG0Z5+X1on9fg62TxjZC/KS21e7yxpRgg2ZubFW+PDZ34uFmhean1oYt88r/vgM/+sCho272yVBZZ4NgV6ydRAj138qfnRxiewvJelOF0Mf+4SpCWFmGayxgk580PWe44hA=='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 10101, 'candidates_token_count': 29, 'total_token_count': 10251, 'cached_content_token_count': 1824, 'prompt_tokens_details': [{'modality': 1, 'token_count': 10219}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1824}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 29}], 'thoughts_token_count': 121}, 'finish_reason': 'STOP', 'avg_logprobs': -0.422245584685227, 'model_name': 'gemini-2.5-pro'} id='run--043f0be6-7213-4bf0-ba3b-7c788b17b5c4-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 501.0, 'relative_path': 'tests/test_util_inspect.py', 'end_line': 1000.0}, 'id': 'daeb2330-df0c-4ea5-9739-2bba872c3dc1', 'type': 'tool_call'}] usage_metadata={'input_tokens': 10101, 'output_tokens': 29, 'total_tokens': 10251, 'input_token_details': {'cache_read': 1824}, 'output_token_details': {'reasoning': 121}}
2025-12-23 12:33:22,323 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have successfully retrieved the entire content of the `tests/test_util_inspect.py` file. I began by reading the initial 500 lines and then proceeded to read the remaining part of the file to get the complete code. This file contains the unit tests for the `sphinx/util/inspect.py` module, which will be helpful in understanding how function signatures and default arguments are tested.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 12918, 'candidates_token_count': 84, 'total_token_count': 13342, 'cached_content_token_count': 9292, 'prompt_tokens_details': [{'modality': 1, 'token_count': 13157}], 'cache_tokens_details': [{'modality': 1, 'token_count': 9292}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 84}], 'thoughts_token_count': 340}, 'finish_reason': 'STOP', 'avg_logprobs': -0.5118047623407274, 'model_name': 'gemini-2.5-pro'} id='run--64a4e58b-7e19-48bb-91f5-e900e3fb53d9-0' usage_metadata={'input_tokens': 12918, 'output_tokens': 84, 'total_tokens': 13342, 'input_token_details': {'cache_read': 9292}, 'output_token_details': {'reasoning': 340}}
2025-12-23 12:33:22,325 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of tests/test_util_inspect.py.
--- END QUERY ---



--- BEGIN PURPOSE ---
This file is expected to contain unit tests for the patched code in `sphinx/util/inspect.py`, which will help identify test cases related to function signature parsing and default argument handling.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/test_util_inspect.py
Line number range: 1 - 500
Content:
1. """
2.     test_util_inspect
3.     ~~~~~~~~~~~~~~~
4. 
5.     Tests util.inspect functions.
6. 
7.     :copyright: Copyright 2007-2020 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import _testcapi
12. import ast
13. import datetime
14. import functools
15. import sys
16. import types
17. from inspect import Parameter
18. 
19. import pytest
20. 
21. from sphinx.util import inspect
22. from sphinx.util.inspect import stringify_signature, is_builtin_class_method
23. 
24. 
25. def test_signature():
26.     # literals
27.     with pytest.raises(TypeError):
28.         inspect.signature(1)
29. 
30.     with pytest.raises(TypeError):
31.         inspect.signature('')
32. 
33.     # builtins are supported on a case-by-case basis, depending on whether
34.     # they define __text_signature__
35.     if getattr(list, '__text_signature__', None):
36.         sig = inspect.stringify_signature(inspect.signature(list))
37.         assert sig == '(iterable=(), /)'
38.     else:
39.         with pytest.raises(ValueError):
40.             inspect.signature(list)
41. 
42.     # normal function
43.     def func(a, b, c=1, d=2, *e, **f):
44.         pass
45. 
46.     sig = inspect.stringify_signature(inspect.signature(func))
47.     assert sig == '(a, b, c=1, d=2, *e, **f)'
48. 
49. 
50. def test_signature_partial():
51.     def fun(a, b, c=1, d=2):
52.         pass
53.     p = functools.partial(fun, 10, c=11)
54. 
55.     sig = inspect.signature(p)
56.     assert stringify_signature(sig) == '(b, *, c=11, d=2)'
57. 
58. 
59. def test_signature_methods():
60.     class Foo:
61.         def meth1(self, arg1, **kwargs):
62.             pass
63. 
64.         @classmethod
65.         def meth2(cls, arg1, *args, **kwargs):
66.             pass
67. 
68.         @staticmethod
69.         def meth3(arg1, *args, **kwargs):
70.             pass
71. 
72.     @functools.wraps(Foo().meth1)
73.     def wrapped_bound_method(*args, **kwargs):
74.         pass
75. 
76.     # unbound method
77.     sig = inspect.signature(Foo.meth1)
78.     assert stringify_signature(sig) == '(self, arg1, **kwargs)'
79. 
80.     sig = inspect.signature(Foo.meth1, bound_method=True)
81.     assert stringify_signature(sig) == '(arg1, **kwargs)'
82. 
83.     # bound method
84.     sig = inspect.signature(Foo().meth1)
85.     assert stringify_signature(sig) == '(arg1, **kwargs)'
86. 
87.     # class method
88.     sig = inspect.signature(Foo.meth2)
89.     assert stringify_signature(sig) == '(arg1, *args, **kwargs)'
90. 
91.     sig = inspect.signature(Foo().meth2)
92.     assert stringify_signature(sig) == '(arg1, *args, **kwargs)'
93. 
94.     # static method
95.     sig = inspect.signature(Foo.meth3)
96.     assert stringify_signature(sig) == '(arg1, *args, **kwargs)'
97. 
98.     sig = inspect.signature(Foo().meth3)
99.     assert stringify_signature(sig) == '(arg1, *args, **kwargs)'
100. 
101.     # wrapped bound method
102.     sig = inspect.signature(wrapped_bound_method)
103.     assert stringify_signature(sig) == '(*args, **kwargs)'
104. 
105. 
106. def test_signature_partialmethod():
107.     from functools import partialmethod
108. 
109.     class Foo:
110.         def meth1(self, arg1, arg2, arg3=None, arg4=None):
111.             pass
112. 
113.         def meth2(self, arg1, arg2):
114.             pass
115. 
116.         foo = partialmethod(meth1, 1, 2)
117.         bar = partialmethod(meth1, 1, arg3=3)
118.         baz = partialmethod(meth2, 1, 2)
119. 
120.     subject = Foo()
121.     sig = inspect.signature(subject.foo)
122.     assert stringify_signature(sig) == '(arg3=None, arg4=None)'
123. 
124.     sig = inspect.signature(subject.bar)
125.     assert stringify_signature(sig) == '(arg2, *, arg3=3, arg4=None)'
126. 
127.     sig = inspect.signature(subject.baz)
128.     assert stringify_signature(sig) == '()'
129. 
130. 
131. def test_signature_annotations():
132.     from typing_test_data import (f0, f1, f2, f3, f4, f5, f6, f7, f8, f9, f10,
133.                                   f11, f12, f13, f14, f15, f16, f17, f18, f19, f20, f21, Node)
134. 
135.     # Class annotations
136.     sig = inspect.signature(f0)
137.     assert stringify_signature(sig) == '(x: int, y: numbers.Integral) -> None'
138. 
139.     # Generic types with concrete parameters
140.     sig = inspect.signature(f1)
141.     assert stringify_signature(sig) == '(x: List[int]) -> List[int]'
142. 
143.     # TypeVars and generic types with TypeVars
144.     sig = inspect.signature(f2)
145.     assert stringify_signature(sig) == '(x: List[T], y: List[T_co], z: T) -> List[T_contra]'
146. 
147.     # Union types
148.     sig = inspect.signature(f3)
149.     assert stringify_signature(sig) == '(x: Union[str, numbers.Integral]) -> None'
150. 
151.     # Quoted annotations
152.     sig = inspect.signature(f4)
153.     assert stringify_signature(sig) == '(x: str, y: str) -> None'
154. 
155.     # Keyword-only arguments
156.     sig = inspect.signature(f5)
157.     assert stringify_signature(sig) == '(x: int, *, y: str, z: str) -> None'
158. 
159.     # Keyword-only arguments with varargs
160.     sig = inspect.signature(f6)
161.     assert stringify_signature(sig) == '(x: int, *args, y: str, z: str) -> None'
162. 
163.     # Space around '=' for defaults
164.     sig = inspect.signature(f7)
165.     assert stringify_signature(sig) == '(x: int = None, y: dict = {}) -> None'
166. 
167.     # Callable types
168.     sig = inspect.signature(f8)
169.     assert stringify_signature(sig) == '(x: Callable[[int, str], int]) -> None'
170. 
171.     sig = inspect.signature(f9)
172.     assert stringify_signature(sig) == '(x: Callable) -> None'
173. 
174.     # Tuple types
175.     sig = inspect.signature(f10)
176.     assert stringify_signature(sig) == '(x: Tuple[int, str], y: Tuple[int, ...]) -> None'
177. 
178.     # Instance annotations
179.     sig = inspect.signature(f11)
180.     assert stringify_signature(sig) == '(x: CustomAnnotation, y: 123) -> None'
181. 
182.     # tuple with more than two items
183.     sig = inspect.signature(f12)
184.     assert stringify_signature(sig) == '() -> Tuple[int, str, int]'
185. 
186.     # optional
187.     sig = inspect.signature(f13)
188.     assert stringify_signature(sig) == '() -> Optional[str]'
189. 
190.     # optional union
191.     sig = inspect.signature(f20)
192.     assert stringify_signature(sig) == '() -> Optional[Union[int, str]]'
193. 
194.     # Any
195.     sig = inspect.signature(f14)
196.     assert stringify_signature(sig) == '() -> Any'
197. 
198.     # ForwardRef
199.     sig = inspect.signature(f15)
200.     assert stringify_signature(sig) == '(x: Unknown, y: int) -> Any'
201. 
202.     # keyword only arguments (1)
203.     sig = inspect.signature(f16)
204.     assert stringify_signature(sig) == '(arg1, arg2, *, arg3=None, arg4=None)'
205. 
206.     # keyword only arguments (2)
207.     sig = inspect.signature(f17)
208.     assert stringify_signature(sig) == '(*, arg3, arg4)'
209. 
210.     sig = inspect.signature(f18)
211.     assert stringify_signature(sig) == '(self, arg1: Union[int, Tuple] = 10) -> List[Dict]'
212. 
213.     # annotations for variadic and keyword parameters
214.     sig = inspect.signature(f19)
215.     assert stringify_signature(sig) == '(*args: int, **kwargs: str)'
216. 
217.     # default value is inspect.Signature.empty
218.     sig = inspect.signature(f21)
219.     assert stringify_signature(sig) == "(arg1='whatever', arg2)"
220. 
221.     # type hints by string
222.     sig = inspect.signature(Node.children)
223.     if (3, 5, 0) <= sys.version_info < (3, 5, 3):
224.         assert stringify_signature(sig) == '(self) -> List[Node]'
225.     else:
226.         assert stringify_signature(sig) == '(self) -> List[typing_test_data.Node]'
227. 
228.     sig = inspect.signature(Node.__init__)
229.     assert stringify_signature(sig) == '(self, parent: Optional[Node]) -> None'
230. 
231.     # show_annotation is False
232.     sig = inspect.signature(f7)
233.     assert stringify_signature(sig, show_annotation=False) == '(x=None, y={})'
234. 
235.     # show_return_annotation is False
236.     sig = inspect.signature(f7)
237.     assert stringify_signature(sig, show_return_annotation=False) == '(x: int = None, y: dict = {})'
238. 
239. 
240. @pytest.mark.skipif(sys.version_info < (3, 8), reason='python 3.8+ is required.')
241. @pytest.mark.sphinx(testroot='ext-autodoc')
242. def test_signature_annotations_py38(app):
243.     from target.pep570 import foo, bar, baz, qux
244. 
245.     # case: separator at head
246.     sig = inspect.signature(foo)
247.     assert stringify_signature(sig) == '(*, a, b)'
248. 
249.     # case: separator in the middle
250.     sig = inspect.signature(bar)
251.     assert stringify_signature(sig) == '(a, b, /, c, d)'
252. 
253.     sig = inspect.signature(baz)
254.     assert stringify_signature(sig) == '(a, /, *, b)'
255. 
256.     # case: separator at tail
257.     sig = inspect.signature(qux)
258.     assert stringify_signature(sig) == '(a, b, /)'
259. 
260. 
261. def test_signature_from_str_basic():
262.     signature = '(a, b, *args, c=0, d="blah", **kwargs)'
263.     sig = inspect.signature_from_str(signature)
264.     assert list(sig.parameters.keys()) == ['a', 'b', 'args', 'c', 'd', 'kwargs']
265.     assert sig.parameters['a'].name == 'a'
266.     assert sig.parameters['a'].kind == Parameter.POSITIONAL_OR_KEYWORD
267.     assert sig.parameters['a'].default == Parameter.empty
268.     assert sig.parameters['a'].annotation == Parameter.empty
269.     assert sig.parameters['b'].name == 'b'
270.     assert sig.parameters['b'].kind == Parameter.POSITIONAL_OR_KEYWORD
271.     assert sig.parameters['b'].default == Parameter.empty
272.     assert sig.parameters['b'].annotation == Parameter.empty
273.     assert sig.parameters['args'].name == 'args'
274.     assert sig.parameters['args'].kind == Parameter.VAR_POSITIONAL
275.     assert sig.parameters['args'].default == Parameter.empty
276.     assert sig.parameters['args'].annotation == Parameter.empty
277.     assert sig.parameters['c'].name == 'c'
278.     assert sig.parameters['c'].kind == Parameter.KEYWORD_ONLY
279.     assert sig.parameters['c'].default == '0'
280.     assert sig.parameters['c'].annotation == Parameter.empty
281.     assert sig.parameters['d'].name == 'd'
282.     assert sig.parameters['d'].kind == Parameter.KEYWORD_ONLY
283.     assert sig.parameters['d'].default == "'blah'"
284.     assert sig.parameters['d'].annotation == Parameter.empty
285.     assert sig.parameters['kwargs'].name == 'kwargs'
286.     assert sig.parameters['kwargs'].kind == Parameter.VAR_KEYWORD
287.     assert sig.parameters['kwargs'].default == Parameter.empty
288.     assert sig.parameters['kwargs'].annotation == Parameter.empty
289.     assert sig.return_annotation == Parameter.empty
290. 
291. 
292. def test_signature_from_str_default_values():
293.     signature = ('(a=0, b=0.0, c="str", d=b"bytes", e=..., f=True, '
294.                  'g=[1, 2, 3], h={"a": 1}, i={1, 2, 3}, '
295.                  'j=lambda x, y: None, k=None, l=object(), m=foo.bar.CONSTANT)')
296.     sig = inspect.signature_from_str(signature)
297.     assert sig.parameters['a'].default == '0'
298.     assert sig.parameters['b'].default == '0.0'
299.     assert sig.parameters['c'].default == "'str'"
300.     assert sig.parameters['d'].default == "b'bytes'"
301.     assert sig.parameters['e'].default == '...'
302.     assert sig.parameters['f'].default == 'True'
303.     assert sig.parameters['g'].default == '[1, 2, 3]'
304.     assert sig.parameters['h'].default == "{'a': 1}"
305.     assert sig.parameters['i'].default == '{1, 2, 3}'
306.     assert sig.parameters['j'].default == 'lambda x, y: ...'
307.     assert sig.parameters['k'].default == 'None'
308.     assert sig.parameters['l'].default == 'object()'
309.     assert sig.parameters['m'].default == 'foo.bar.CONSTANT'
310. 
311. 
312. def test_signature_from_str_annotations():
313.     signature = '(a: int, *args: bytes, b: str = "blah", **kwargs: float) -> None'
314.     sig = inspect.signature_from_str(signature)
315.     assert list(sig.parameters.keys()) == ['a', 'args', 'b', 'kwargs']
316.     assert sig.parameters['a'].annotation == "int"
317.     assert sig.parameters['args'].annotation == "bytes"
318.     assert sig.parameters['b'].annotation == "str"
319.     assert sig.parameters['kwargs'].annotation == "float"
320.     assert sig.return_annotation == 'None'
321. 
322. 
323. def test_signature_from_str_complex_annotations():
324.     sig = inspect.signature_from_str('() -> Tuple[str, int, ...]')
325.     assert sig.return_annotation == 'Tuple[str, int, ...]'
326. 
327.     sig = inspect.signature_from_str('() -> Callable[[int, int], int]')
328.     assert sig.return_annotation == 'Callable[[int, int], int]'
329. 
330. 
331. def test_signature_from_str_kwonly_args():
332.     sig = inspect.signature_from_str('(a, *, b)')
333.     assert list(sig.parameters.keys()) == ['a', 'b']
334.     assert sig.parameters['a'].kind == Parameter.POSITIONAL_OR_KEYWORD
335.     assert sig.parameters['a'].default == Parameter.empty
336.     assert sig.parameters['b'].kind == Parameter.KEYWORD_ONLY
337.     assert sig.parameters['b'].default == Parameter.empty
338. 
339. 
340. @pytest.mark.skipif(sys.version_info < (3, 8),
341.                     reason='python-3.8 or above is required')
342. def test_signature_from_str_positionaly_only_args():
343.     sig = inspect.signature_from_str('(a, b=0, /, c=1)')
344.     assert list(sig.parameters.keys()) == ['a', 'b', 'c']
345.     assert sig.parameters['a'].kind == Parameter.POSITIONAL_ONLY
346.     assert sig.parameters['a'].default == Parameter.empty
347.     assert sig.parameters['b'].kind == Parameter.POSITIONAL_ONLY
348.     assert sig.parameters['b'].default == '0'
349.     assert sig.parameters['c'].kind == Parameter.POSITIONAL_OR_KEYWORD
350.     assert sig.parameters['c'].default == '1'
351. 
352. 
353. def test_signature_from_str_invalid():
354.     with pytest.raises(SyntaxError):
355.         inspect.signature_from_str('')
356. 
357. 
358. def test_signature_from_ast():
359.     signature = 'def func(a, b, *args, c=0, d="blah", **kwargs): pass'
360.     tree = ast.parse(signature)
361.     sig = inspect.signature_from_ast(tree.body[0])
362.     assert list(sig.parameters.keys()) == ['a', 'b', 'args', 'c', 'd', 'kwargs']
363.     assert sig.parameters['a'].name == 'a'
364.     assert sig.parameters['a'].kind == Parameter.POSITIONAL_OR_KEYWORD
365.     assert sig.parameters['a'].default == Parameter.empty
366.     assert sig.parameters['a'].annotation == Parameter.empty
367.     assert sig.parameters['b'].name == 'b'
368.     assert sig.parameters['b'].kind == Parameter.POSITIONAL_OR_KEYWORD
369.     assert sig.parameters['b'].default == Parameter.empty
370.     assert sig.parameters['b'].annotation == Parameter.empty
371.     assert sig.parameters['args'].name == 'args'
372.     assert sig.parameters['args'].kind == Parameter.VAR_POSITIONAL
373.     assert sig.parameters['args'].default == Parameter.empty
374.     assert sig.parameters['args'].annotation == Parameter.empty
375.     assert sig.parameters['c'].name == 'c'
376.     assert sig.parameters['c'].kind == Parameter.KEYWORD_ONLY
377.     assert sig.parameters['c'].default == '0'
378.     assert sig.parameters['c'].annotation == Parameter.empty
379.     assert sig.parameters['d'].name == 'd'
380.     assert sig.parameters['d'].kind == Parameter.KEYWORD_ONLY
381.     assert sig.parameters['d'].default == "'blah'"
382.     assert sig.parameters['d'].annotation == Parameter.empty
383.     assert sig.parameters['kwargs'].name == 'kwargs'
384.     assert sig.parameters['kwargs'].kind == Parameter.VAR_KEYWORD
385.     assert sig.parameters['kwargs'].default == Parameter.empty
386.     assert sig.parameters['kwargs'].annotation == Parameter.empty
387.     assert sig.return_annotation == Parameter.empty
388. 
389. 
390. def test_safe_getattr_with_default():
391.     class Foo:
392.         def __getattr__(self, item):
393.             raise Exception
394. 
395.     obj = Foo()
396. 
397.     result = inspect.safe_getattr(obj, 'bar', 'baz')
398. 
399.     assert result == 'baz'
400. 
401. 
402. def test_safe_getattr_with_exception():
403.     class Foo:
404.         def __getattr__(self, item):
405.             raise Exception
406. 
407.     obj = Foo()
408. 
409.     try:
410.         inspect.safe_getattr(obj, 'bar')
411.     except AttributeError as exc:
412.         assert exc.args[0] == 'bar'
413.     else:
414.         pytest.fail('AttributeError not raised')
415. 
416. 
417. def test_safe_getattr_with_property_exception():
418.     class Foo:
419.         @property
420.         def bar(self):
421.             raise Exception
422. 
423.     obj = Foo()
424. 
425.     try:
426.         inspect.safe_getattr(obj, 'bar')
427.     except AttributeError as exc:
428.         assert exc.args[0] == 'bar'
429.     else:
430.         pytest.fail('AttributeError not raised')
431. 
432. 
433. def test_safe_getattr_with___dict___override():
434.     class Foo:
435.         @property
436.         def __dict__(self):
437.             raise Exception
438. 
439.     obj = Foo()
440. 
441.     try:
442.         inspect.safe_getattr(obj, 'bar')
443.     except AttributeError as exc:
444.         assert exc.args[0] == 'bar'
445.     else:
446.         pytest.fail('AttributeError not raised')
447. 
448. 
449. def test_dictionary_sorting():
450.     dictionary = {"c": 3, "a": 1, "d": 2, "b": 4}
451.     description = inspect.object_description(dictionary)
452.     assert description == "{'a': 1, 'b': 4, 'c': 3, 'd': 2}"
453. 
454. 
455. def test_set_sorting():
456.     set_ = set("gfedcba")
457.     description = inspect.object_description(set_)
458.     assert description == "{'a', 'b', 'c', 'd', 'e', 'f', 'g'}"
459. 
460. 
461. def test_set_sorting_fallback():
462.     set_ = {None, 1}
463.     description = inspect.object_description(set_)
464.     assert description in ("{1, None}", "{None, 1}")
465. 
466. 
467. def test_frozenset_sorting():
468.     frozenset_ = frozenset("gfedcba")
469.     description = inspect.object_description(frozenset_)
470.     assert description == "frozenset({'a', 'b', 'c', 'd', 'e', 'f', 'g'})"
471. 
472. 
473. def test_frozenset_sorting_fallback():
474.     frozenset_ = frozenset((None, 1))
475.     description = inspect.object_description(frozenset_)
476.     assert description in ("frozenset({1, None})", "frozenset({None, 1})")
477. 
478. 
479. def test_dict_customtype():
480.     class CustomType:
481.         def __init__(self, value):
482.             self._value = value
483. 
484.         def __repr__(self):
485.             return "<CustomType(%r)>" % self._value
486. 
487.     dictionary = {CustomType(2): 2, CustomType(1): 1}
488.     description = inspect.object_description(dictionary)
489.     # Type is unsortable, just check that it does not crash
490.     assert "<CustomType(2)>: 2" in description
491. 
492. 
493. @pytest.mark.sphinx(testroot='ext-autodoc')
494. def test_isclassmethod(app):
495.     from target.methods import Base, Inherited
496. 
497.     assert inspect.isclassmethod(Base.classmeth) is True
498.     assert inspect.isclassmethod(Base.meth) is False
499.     assert inspect.isclassmethod(Inherited.classmeth) is True
500.     assert inspect.isclassmethod(Inherited.meth) is False


File: tests/test_util_inspect.py
Line number range: 501 - 1000
Content:
501. 
502. 
503. @pytest.mark.sphinx(testroot='ext-autodoc')
504. def test_isstaticmethod(app):
505.     from target.methods import Base, Inherited
506. 
507.     assert inspect.isstaticmethod(Base.staticmeth, Base, 'staticmeth') is True
508.     assert inspect.isstaticmethod(Base.meth, Base, 'meth') is False
509.     assert inspect.isstaticmethod(Inherited.staticmeth, Inherited, 'staticmeth') is True
510.     assert inspect.isstaticmethod(Inherited.meth, Inherited, 'meth') is False
511. 
512. 
513. @pytest.mark.sphinx(testroot='ext-autodoc')
514. def test_iscoroutinefunction(app):
515.     from target.functions import coroutinefunc, func, partial_coroutinefunc
516.     from target.methods import Base
517. 
518.     assert inspect.iscoroutinefunction(func) is False                   # function
519.     assert inspect.iscoroutinefunction(coroutinefunc) is True           # coroutine
520.     assert inspect.iscoroutinefunction(partial_coroutinefunc) is True   # partial-ed coroutine
521.     assert inspect.iscoroutinefunction(Base.meth) is False              # method
522.     assert inspect.iscoroutinefunction(Base.coroutinemeth) is True      # coroutine-method
523. 
524.     # partial-ed coroutine-method
525.     partial_coroutinemeth = Base.__dict__['partial_coroutinemeth']
526.     assert inspect.iscoroutinefunction(partial_coroutinemeth) is True
527. 
528. 
529. @pytest.mark.sphinx(testroot='ext-autodoc')
530. def test_isfunction(app):
531.     from target.functions import builtin_func, partial_builtin_func
532.     from target.functions import func, partial_func
533.     from target.methods import Base
534. 
535.     assert inspect.isfunction(func) is True                     # function
536.     assert inspect.isfunction(partial_func) is True             # partial-ed function
537.     assert inspect.isfunction(Base.meth) is True                # method of class
538.     assert inspect.isfunction(Base.partialmeth) is True         # partial-ed method of class
539.     assert inspect.isfunction(Base().meth) is False             # method of instance
540.     assert inspect.isfunction(builtin_func) is False            # builtin function
541.     assert inspect.isfunction(partial_builtin_func) is False    # partial-ed builtin function
542. 
543. 
544. @pytest.mark.sphinx(testroot='ext-autodoc')
545. def test_isbuiltin(app):
546.     from target.functions import builtin_func, partial_builtin_func
547.     from target.functions import func, partial_func
548.     from target.methods import Base
549. 
550.     assert inspect.isbuiltin(builtin_func) is True          # builtin function
551.     assert inspect.isbuiltin(partial_builtin_func) is True  # partial-ed builtin function
552.     assert inspect.isbuiltin(func) is False                 # function
553.     assert inspect.isbuiltin(partial_func) is False         # partial-ed function
554.     assert inspect.isbuiltin(Base.meth) is False            # method of class
555.     assert inspect.isbuiltin(Base().meth) is False          # method of instance
556. 
557. 
558. @pytest.mark.sphinx(testroot='ext-autodoc')
559. def test_isdescriptor(app):
560.     from target.functions import func
561.     from target.methods import Base
562. 
563.     assert inspect.isdescriptor(Base.prop) is True      # property of class
564.     assert inspect.isdescriptor(Base().prop) is False   # property of instance
565.     assert inspect.isdescriptor(Base.meth) is True      # method of class
566.     assert inspect.isdescriptor(Base().meth) is True    # method of instance
567.     assert inspect.isdescriptor(func) is True           # function
568. 
569. 
570. @pytest.mark.sphinx(testroot='ext-autodoc')
571. def test_isattributedescriptor(app):
572.     from target.methods import Base
573. 
574.     class Descriptor:
575.         def __get__(self, obj, typ=None):
576.             pass
577. 
578.     testinstancemethod = _testcapi.instancemethod(str.__repr__)
579. 
580.     assert inspect.isattributedescriptor(Base.prop) is True                    # property
581.     assert inspect.isattributedescriptor(Base.meth) is False                   # method
582.     assert inspect.isattributedescriptor(Base.staticmeth) is False             # staticmethod
583.     assert inspect.isattributedescriptor(Base.classmeth) is False              # classmetho
584.     assert inspect.isattributedescriptor(Descriptor) is False                  # custom descriptor class    # NOQA
585.     assert inspect.isattributedescriptor(str.join) is False                    # MethodDescriptorType       # NOQA
586.     assert inspect.isattributedescriptor(object.__init__) is False             # WrapperDescriptorType      # NOQA
587.     assert inspect.isattributedescriptor(dict.__dict__['fromkeys']) is False   # ClassMethodDescriptorType  # NOQA
588.     assert inspect.isattributedescriptor(types.FrameType.f_locals) is True     # GetSetDescriptorType       # NOQA
589.     assert inspect.isattributedescriptor(datetime.timedelta.days) is True      # MemberDescriptorType       # NOQA
590.     assert inspect.isattributedescriptor(testinstancemethod) is False          # instancemethod (C-API)     # NOQA
591. 
592. 
593. def test_isproperty(app):
594.     from target.functions import func
595.     from target.methods import Base
596. 
597.     assert inspect.isproperty(Base.prop) is True        # property of class
598.     assert inspect.isproperty(Base().prop) is False     # property of instance
599.     assert inspect.isproperty(Base.meth) is False       # method of class
600.     assert inspect.isproperty(Base().meth) is False     # method of instance
601.     assert inspect.isproperty(func) is False            # function
602. 
603. 
604. @pytest.mark.skipif(sys.version_info < (3, 7), reason='python 3.7+ is required.')
605. @pytest.mark.sphinx(testroot='ext-autodoc')
606. def test_isgenericalias(app):
607.     from target.genericalias import C, T
608.     from target.methods import Base
609. 
610.     assert inspect.isgenericalias(C) is True
611.     assert inspect.isgenericalias(T) is True
612.     assert inspect.isgenericalias(object()) is False
613.     assert inspect.isgenericalias(Base) is False
614. 
615. 
616. def test_unpartial():
617.     def func1(a, b, c):
618.         pass
619. 
620.     func2 = functools.partial(func1, 1)
621.     func2.__doc__ = "func2"
622.     func3 = functools.partial(func2, 2)  # nested partial object
623. 
624.     assert inspect.unpartial(func2) is func1
625.     assert inspect.unpartial(func3) is func1
626. 
627. 
628. def test_getdoc_inherited_decorated_method():
629.     class Foo:
630.         def meth(self):
631.             """docstring."""
632. 
633.     class Bar(Foo):
634.         @functools.lru_cache()
635.         def meth(self):
636.             # inherited and decorated method
637.             pass
638. 
639.     assert inspect.getdoc(Bar.meth, getattr, False, Bar, "meth") is None
640.     assert inspect.getdoc(Bar.meth, getattr, True, Bar, "meth") == "docstring."
641. 
642. 
643. def test_is_builtin_class_method():
644.     class MyInt(int):
645.         def my_method(self):
646.             pass
647. 
648.     assert inspect.is_builtin_class_method(MyInt, 'to_bytes')
649.     assert inspect.is_builtin_class_method(MyInt, '__init__')
650.     assert not inspect.is_builtin_class_method(MyInt, 'my_method')
651.     assert not inspect.is_builtin_class_method(MyInt, 'does_not_exist')
652.     assert not inspect.is_builtin_class_method(4, 'still does not crash')
653. 
654.     class ObjectWithMroAttr:
655.         def __init__(self, mro_attr):
656.             self.__mro__ = mro_attr
657. 
658.     assert not inspect.is_builtin_class_method(ObjectWithMroAttr([1, 2, 3]), 'still does not crash')

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-23 12:33:27,363 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='The user has requested the full content of the file `tests/test_util_inspect.py`. The provided context contains the content of this file from line 1 to 658. Therefore, the entire file content is relevant and is being returned.', relative_path='tests/test_util_inspect.py', start_line=1, end_line=658)]
2025-12-23 12:33:27,365 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of tests/test_util_inspect.py.
2025-12-23 12:33:27,365 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-23 12:33:27,365 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-23 12:33:27,366 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 0 existing contexts
2025-12-23 12:33:27,366 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 1 total contexts (removed 0 duplicates)
2025-12-23 12:33:27,366 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sphinx
├── .circleci
|   └── config.yml
├── .codecov.yml
├── .github
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.md
|   |   ├── config.yml
|   |   └── feature_request.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   └── workflows
|       ├── builddoc.yml
|       ├── lint.yml
|       └── main.yml
├── .travis.yml
├── CONTRIBUTING.rst
├── README.rst
├── bindep.txt
├── doc
|   ├── _static
|   |   ├── conf.py.txt
|   |   └── themes
|   |       └── fullsize
|   ├── _templates
|   |   ├── index.html
|   |   └── indexsidebar.html
|   ├── _themes
|   |   └── sphinx13
|   |       ├── layout.html
|   |       └── static
|   |           └── sphinx13.css
|   ├── changes.rst
|   ├── conf.py
|   ├── contents.rst
|   ├── develop.rst
|   ├── development
|   |   ├── builders.rst
|   |   ├── index.rst
|   |   ├── overview.rst
|   |   ├── theming.rst
|   |   └── tutorials
|   |       ├── examples
|   |       |   ├── README.rst
|   |       |   ├── helloworld.py
|   |       |   ├── recipe.py
|   |       |   └── todo.py
|   |       ├── helloworld.rst
|   |       ├── index.rst
|   |       ├── recipe.rst
|   |       └── todo.rst
|   ├── examples.rst
|   ├── extdev
|   |   ├── appapi.rst
|   |   ├── builderapi.rst
|   |   ├── collectorapi.rst
|   |   ├── deprecated.rst
|   |   ├── domainapi.rst
|   |   ├── envapi.rst
|   |   ├── i18n.rst
|   |   ├── index.rst
|   |   ├── logging.rst
|   |   ├── markupapi.rst
|   |   ├── nodes.rst
|   |   ├── parserapi.rst
|   |   ├── projectapi.rst
|   |   └── utils.rst
|   ├── faq.rst
|   ├── glossary.rst
|   ├── internals
|   |   ├── authors.rst
|   |   ├── code-of-conduct.rst
|   |   ├── contributing.rst
|   |   ├── index.rst
|   |   ├── organization.rst
|   |   └── release-process.rst
|   ├── latex.rst
|   ├── man
|   |   ├── index.rst
|   |   ├── sphinx-apidoc.rst
|   |   ├── sphinx-autogen.rst
|   |   ├── sphinx-build.rst
|   |   └── sphinx-quickstart.rst
|   ├── templating.rst
|   └── usage
|       ├── advanced
|       |   ├── intl.rst
|       |   ├── setuptools.rst
|       |   └── websupport
|       |       ├── api.rst
|       |       ├── index.rst
|       |       ├── quickstart.rst
|       |       ├── searchadapters.rst
|       |       └── storagebackends.rst
|       ├── builders
|       |   └── index.rst
|       ├── configuration.rst
|       ├── extensions
|       |   ├── autodoc.rst
|       |   ├── autosectionlabel.rst
|       |   ├── autosummary.rst
|       |   ├── coverage.rst
|       |   ├── doctest.rst
|       |   ├── duration.rst
|       |   ├── example_google.py
|       |   ├── example_google.rst
|       |   ├── example_numpy.py
|       |   ├── example_numpy.rst
|       |   ├── extlinks.rst
|       |   ├── githubpages.rst
|       |   ├── graphviz.rst
|       |   ├── ifconfig.rst
|       |   ├── imgconverter.rst
|       |   ├── index.rst
|       |   ├── inheritance.rst
|       |   ├── intersphinx.rst
|       |   ├── linkcode.rst
|       |   ├── math.rst
|       |   ├── napoleon.rst
|       |   ├── todo.rst
|       |   └── viewcode.rst
|       ├── index.rst
|       ├── installation.rst
|       ├── markdown.rst
|       ├── quickstart.rst
|       ├── restructuredtext
|       |   ├── basics.rst
|       |   ├── directives.rst
|       |   ├── domains.rst
|       |   ├── field-lists.rst
|       |   ├── index.rst
|       |   └── roles.rst
|       └── theming.rst
├── karma.conf.js
├── setup.py
├── sphinx
|   ├── __init__.py
|   ├── __main__.py
|   ├── addnodes.py
|   ├── application.py
|   ├── builders
|   |   ├── __init__.py
|   |   ├── _epub_base.py
|   |   ├── applehelp.py
|   |   ├── changes.py
|   |   ├── devhelp.py
|   |   ├── dirhtml.py
|   |   ├── dummy.py
|   |   ├── epub3.py
|   |   ├── gettext.py
|   |   ├── html
|   |   |   ├── __init__.py
|   |   |   └── transforms.py
|   |   ├── htmlhelp.py
|   |   ├── latex
|   |   |   ├── __init__.py
|   |   |   ├── constants.py
|   |   |   ├── nodes.py
|   |   |   ├── theming.py
|   |   |   ├── transforms.py
|   |   |   └── util.py
|   |   ├── linkcheck.py
|   |   ├── manpage.py
|   |   ├── qthelp.py
|   |   ├── singlehtml.py
|   |   ├── texinfo.py
|   |   ├── text.py
|   |   └── xml.py
|   ├── cmd
|   |   ├── __init__.py
|   |   ├── build.py
|   |   ├── make_mode.py
|   |   └── quickstart.py
|   ├── config.py
|   ├── deprecation.py
|   ├── directives
|   |   ├── __init__.py
|   |   ├── code.py
|   |   ├── other.py
|   |   └── patches.py
|   ├── domains
|   |   ├── __init__.py
|   |   ├── c.py
|   |   ├── changeset.py
|   |   ├── citation.py
|   |   ├── cpp.py
|   |   ├── index.py
|   |   ├── javascript.py
|   |   ├── math.py
|   |   ├── python.py
|   |   ├── rst.py
|   |   └── std.py
|   ├── environment
|   |   ├── __init__.py
|   |   ├── adapters
|   |   |   ├── __init__.py
|   |   |   ├── asset.py
|   |   |   ├── indexentries.py
|   |   |   └── toctree.py
|   |   └── collectors
|   |       ├── __init__.py
|   |       ├── asset.py
|   |       ├── dependencies.py
|   |       ├── indexentries.py
|   |       ├── metadata.py
|   |       ├── title.py
|   |       └── toctree.py
|   ├── errors.py
|   ├── events.py
|   ├── ext
|   |   ├── __init__.py
|   |   ├── apidoc.py
|   |   ├── autodoc
|   |   |   ├── __init__.py
|   |   |   ├── directive.py
|   |   |   ├── importer.py
|   |   |   ├── mock.py
|   |   |   ├── type_comment.py
|   |   |   └── typehints.py
|   |   ├── autosectionlabel.py
|   |   ├── autosummary
|   |   |   ├── __init__.py
|   |   |   ├── generate.py
|   |   |   └── templates
|   |   |       └── autosummary
|   |   ├── coverage.py
|   |   ├── doctest.py
|   |   ├── duration.py
|   |   ├── extlinks.py
|   |   ├── githubpages.py
|   |   ├── graphviz.py
|   |   ├── ifconfig.py
|   |   ├── imgconverter.py
|   |   ├── imgmath.py
|   |   ├── inheritance_diagram.py
|   |   ├── intersphinx.py
|   |   ├── jsmath.py
|   |   ├── linkcode.py
|   |   ├── mathjax.py
|   |   ├── napoleon
|   |   |   ├── __init__.py
|   |   |   ├── docstring.py
|   |   |   └── iterators.py
|   |   ├── todo.py
|   |   └── viewcode.py
|   ├── extension.py
|   ├── highlighting.py
|   ├── io.py
|   ├── jinja2glue.py
|   ├── locale
|   |   ├── __init__.py
|   |   ├── ar
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bg
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bn
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ca
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cak
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cs
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cy
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── da
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── de
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── el
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eo
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── es
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── et
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fa
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── he
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi_IN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── id
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── it
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ja
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ko
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── mk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nb_NO
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ne
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_BR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_PT
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ro
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ru
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── si
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sq
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr@latin
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr_RS
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ta
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── te
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── tr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── uk_UA
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ur
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── vi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_CN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   └── zh_TW
|   |       └── LC_MESSAGES
|   |           └── sphinx.js
|   ├── parsers.py
|   ├── project.py
|   ├── pycode
|   |   ├── __init__.py
|   |   ├── ast.py
|   |   └── parser.py
|   ├── pygments_styles.py
|   ├── registry.py
|   ├── roles.py
|   ├── search
|   |   ├── __init__.py
|   |   ├── da.py
|   |   ├── de.py
|   |   ├── en.py
|   |   ├── es.py
|   |   ├── fi.py
|   |   ├── fr.py
|   |   ├── hu.py
|   |   ├── it.py
|   |   ├── ja.py
|   |   ├── jssplitter.py
|   |   ├── nl.py
|   |   ├── no.py
|   |   ├── non-minified-js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── pt.py
|   |   ├── ro.py
|   |   ├── ru.py
|   |   ├── sv.py
|   |   ├── tr.py
|   |   └── zh.py
|   ├── setup_command.py
|   ├── templates
|   |   ├── apidoc
|   |   ├── epub3
|   |   |   └── container.xml
|   |   ├── gettext
|   |   ├── graphviz
|   |   |   └── graphviz.css
|   |   ├── htmlhelp
|   |   ├── imgmath
|   |   ├── latex
|   |   ├── quickstart
|   |   └── texinfo
|   ├── testing
|   |   ├── __init__.py
|   |   ├── comparer.py
|   |   ├── fixtures.py
|   |   ├── path.py
|   |   ├── restructuredtext.py
|   |   └── util.py
|   ├── texinputs
|   ├── texinputs_win
|   ├── themes
|   |   ├── agogo
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── basic
|   |   |   ├── changes
|   |   |   |   ├── frameset.html
|   |   |   |   ├── rstsource.html
|   |   |   |   └── versionchanges.html
|   |   |   ├── defindex.html
|   |   |   ├── domainindex.html
|   |   |   ├── genindex-single.html
|   |   |   ├── genindex-split.html
|   |   |   ├── genindex.html
|   |   |   ├── globaltoc.html
|   |   |   ├── layout.html
|   |   |   ├── localtoc.html
|   |   |   ├── opensearch.xml
|   |   |   ├── page.html
|   |   |   ├── relations.html
|   |   |   ├── search.html
|   |   |   ├── searchbox.html
|   |   |   ├── sourcelink.html
|   |   |   └── static
|   |   |       ├── doctools.js
|   |   |       ├── jquery-3.5.1.js
|   |   |       ├── jquery.js
|   |   |       ├── searchtools.js
|   |   |       ├── underscore-1.3.1.js
|   |   |       └── underscore.js
|   |   ├── bizstyle
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── css3-mediaqueries.js
|   |   |       └── css3-mediaqueries_src.js
|   |   ├── classic
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── default
|   |   |   └── static
|   |   |       └── default.css
|   |   ├── epub
|   |   |   ├── epub-cover.html
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── haiku
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── nature
|   |   |   └── static
|   |   ├── nonav
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       └── nonav.css
|   |   ├── pyramid
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── epub.css
|   |   |       └── ie6.css
|   |   ├── scrolls
|   |   |   ├── artwork
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── print.css
|   |   |       └── theme_extras.js
|   |   ├── sphinxdoc
|   |   |   └── static
|   |   └── traditional
|   |       └── static
|   ├── theming.py
|   ├── transforms
|   |   ├── __init__.py
|   |   ├── compact_bullet_list.py
|   |   ├── i18n.py
|   |   ├── post_transforms
|   |   |   ├── __init__.py
|   |   |   ├── code.py
|   |   |   └── images.py
|   |   └── references.py
|   ├── util
|   |   ├── __init__.py
|   |   ├── build_phase.py
|   |   ├── cfamily.py
|   |   ├── compat.py
|   |   ├── console.py
|   |   ├── docfields.py
|   |   ├── docstrings.py
|   |   ├── docutils.py
|   |   ├── fileutil.py
|   |   ├── i18n.py
|   |   ├── images.py
|   |   ├── inspect.py
|   |   ├── inventory.py
|   |   ├── jsdump.py
|   |   ├── jsonimpl.py
|   |   ├── logging.py
|   |   ├── matching.py
|   |   ├── math.py
|   |   ├── nodes.py
|   |   ├── osutil.py
|   |   ├── parallel.py
|   |   ├── png.py
|   |   ├── pycompat.py
|   |   ├── requests.py
|   |   ├── rst.py
|   |   ├── smartypants.py
|   |   ├── stemmer
|   |   |   ├── __init__.py
|   |   |   └── porter.py
|   |   ├── tags.py
|   |   ├── template.py
|   |   ├── texescape.py
|   |   └── typing.py
|   ├── versioning.py
|   └── writers
|       ├── __init__.py
|       ├── html.py
|       ├── html5.py
|       ├── latex.py
|       ├── manpage.py
|       ├── texinfo.py
|       ├── text.py
|       └── xml.py
├── tests
|   ├── conftest.py
|   ├── js
|   |   └── doctools.js
|   ├── roots
|   |   ├── test-add_enumerable_node
|   |   |   ├── conf.py
|   |   |   ├── enumerable_node.py
|   |   |   └── index.rst
|   |   ├── test-add_source_parser
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-add_source_parser-conflicts-with-users-setting
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-api-set-translator
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nonext
|   |   |   |   └── conf.py
|   |   |   └── translator.py
|   |   ├── test-apidoc-pep420
|   |   |   └── a
|   |   |       └── b
|   |   ├── test-apidoc-subpackage-in-toc
|   |   |   └── parent
|   |   |       ├── __init__.py
|   |   |       └── child
|   |   ├── test-apidoc-toc
|   |   |   └── mypackage
|   |   |       ├── __init__.py
|   |   |       ├── main.py
|   |   |       ├── no_init
|   |   |       ├── resource
|   |   |       └── something
|   |   ├── test-apidoc-trailing-underscore
|   |   |   └── package_
|   |   |       ├── __init__.py
|   |   |       └── module_.py
|   |   ├── test-autosummary
|   |   |   ├── conf.py
|   |   |   ├── dummy_module.py
|   |   |   ├── index.rst
|   |   |   ├── sphinx.rst
|   |   |   └── underscore_module_.py
|   |   ├── test-basic
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-html-translator
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-text
|   |   |   ├── conf.py
|   |   |   ├── doc1.txt
|   |   |   ├── doc2.txt
|   |   |   ├── index.txt
|   |   |   ├── lineblock.txt
|   |   |   ├── listitems.txt
|   |   |   ├── maxwidth.txt
|   |   |   ├── nonascii_maxwidth.txt
|   |   |   ├── nonascii_table.txt
|   |   |   ├── nonascii_title.txt
|   |   |   ├── table.txt
|   |   |   ├── table_colspan.txt
|   |   |   ├── table_colspan_and_rowspan.txt
|   |   |   ├── table_colspan_left.txt
|   |   |   └── table_rowspan.txt
|   |   ├── test-builder-dirhtml
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo
|   |   |   |   ├── foo_1.rst
|   |   |   |   ├── foo_2.rst
|   |   |   |   └── index.rst
|   |   |   └── index.rst
|   |   ├── test-builder-gettext-dont-rebuild-mo
|   |   |   ├── bom.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-changes
|   |   |   ├── base.rst
|   |   |   ├── c-api.rst
|   |   |   ├── conf.py
|   |   |   ├── contents.rst
|   |   |   └── library
|   |   |       └── utils.rst
|   |   ├── test-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-config
|   |   |   └── conf.py
|   |   ├── test-correct-year
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-default_role
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-directive-code
|   |   |   ├── caption.rst
|   |   |   ├── classes.rst
|   |   |   ├── conf.py
|   |   |   ├── emphasize.rst
|   |   |   ├── force.rst
|   |   |   ├── highlight.rst
|   |   |   ├── index.rst
|   |   |   ├── linenos.rst
|   |   |   ├── linenothreshold.rst
|   |   |   ├── namedblocks.rst
|   |   |   ├── py-decorators.rst
|   |   |   ├── python.rst
|   |   |   └── target.py
|   |   ├── test-directive-only
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── only.rst
|   |   ├── test-directives-raw
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-docutilsconf
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-c
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── namespace.rst
|   |   |   └── semicolon.rst
|   |   ├── test-domain-cpp
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── any-role.rst
|   |   |   ├── backslash.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── lookup-key-overload.rst
|   |   |   ├── multi-decl-lookup.rst
|   |   |   ├── roles-targets-ok.rst
|   |   |   ├── roles-targets-warn.rst
|   |   |   ├── roles.rst
|   |   |   ├── roles2.rst
|   |   |   ├── semicolon.rst
|   |   |   ├── warn-template-param-qualified-name.rst
|   |   |   └── xref_consistency.rst
|   |   ├── test-domain-js
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   ├── module_option.rst
|   |   |   └── roles.rst
|   |   ├── test-double-inheriting-theme
|   |   |   ├── base_themes_dir
|   |   |   |   ├── base_theme1
|   |   |   |   └── base_theme2
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-epub-anchor-id
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autodoc
|   |   |   ├── autodoc_dummy_bar.py
|   |   |   ├── autodoc_dummy_module.py
|   |   |   ├── bug2437
|   |   |   |   ├── __init__.py
|   |   |   |   └── autodoc_dummy_foo.py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target
|   |   |       ├── TYPE_CHECKING.py
|   |   |       ├── __init__.py
|   |   |       ├── abstractmethods.py
|   |   |       ├── annotated.py
|   |   |       ├── annotations.py
|   |   |       ├── autoclass_content.py
|   |   |       ├── bound_method.py
|   |   |       ├── cached_property.py
|   |   |       ├── callable.py
|   |   |       ├── classes.py
|   |   |       ├── coroutine.py
|   |   |       ├── decorator.py
|   |   |       ├── descriptor.py
|   |   |       ├── docstring_signature.py
|   |   |       ├── enums.py
|   |   |       ├── final.py
|   |   |       ├── functions.py
|   |   |       ├── generic_class.py
|   |   |       ├── genericalias.py
|   |   |       ├── imported_members.py
|   |   |       ├── inheritance.py
|   |   |       ├── methods.py
|   |   |       ├── name_conflict
|   |   |       ├── name_mangling.py
|   |   |       ├── need_mocks.py
|   |   |       ├── overload.py
|   |   |       ├── partialfunction.py
|   |   |       ├── partialmethod.py
|   |   |       ├── pep570.py
|   |   |       ├── private.py
|   |   |       ├── process_docstring.py
|   |   |       ├── singledispatch.py
|   |   |       ├── singledispatchmethod.py
|   |   |       ├── slots.py
|   |   |       ├── sort_by_all.py
|   |   |       ├── typed_vars.py
|   |   |       ├── typehints.py
|   |   |       ├── typevar.py
|   |   |       └── wrappedfunction.py
|   |   ├── test-ext-autosectionlabel
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosectionlabel-prefix-document
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── autosummary_importfail.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-filename-map
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-imported_members
|   |   |   ├── autosummary_dummy_package
|   |   |   |   ├── __init__.py
|   |   |   |   └── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-mock_imports
|   |   |   ├── conf.py
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-recursive
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── package
|   |   |   |   ├── __init__.py
|   |   |   |   ├── module.py
|   |   |   |   ├── module_importfail.py
|   |   |   |   └── package
|   |   |   └── package2
|   |   |       ├── __init__.py
|   |   |       └── module.py
|   |   ├── test-ext-autosummary-skip-member
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-autosummary-template
|   |   |   ├── _templates
|   |   |   |   └── empty.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-coverage
|   |   |   ├── conf.py
|   |   |   ├── coverage_ignored.py
|   |   |   ├── coverage_not_ignored.py
|   |   |   └── index.rst
|   |   ├── test-ext-doctest
|   |   |   ├── conf.py
|   |   |   └── doctest.txt
|   |   ├── test-ext-doctest-skipif
|   |   |   ├── conf.py
|   |   |   └── skipif.txt
|   |   ├── test-ext-doctest-with-autodoc
|   |   |   ├── conf.py
|   |   |   ├── dir
|   |   |   |   ├── __init__.py
|   |   |   |   ├── bar.py
|   |   |   |   └── inner.rst
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-githubpages
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-graphviz
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-ifconfig
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-imgconverter
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-inheritance_diagram
|   |   |   ├── conf.py
|   |   |   ├── example
|   |   |   |   ├── __init__.py
|   |   |   |   └── sphinx.py
|   |   |   ├── index.rst
|   |   |   └── test.py
|   |   ├── test-ext-intersphinx-cppdomain
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── math.rst
|   |   |   └── page.rst
|   |   ├── test-ext-math-compat
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math-simple
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-todo
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-ext-viewcode
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── objects.rst
|   |   |   └── spam
|   |   |       ├── __init__.py
|   |   |       ├── mod1.py
|   |   |       ├── mod2.py
|   |   |       └── mod3.py
|   |   ├── test-ext-viewcode-find
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── not_a_package
|   |   |       ├── __init__.py
|   |   |       └── submodule.py
|   |   ├── test-extensions
|   |   |   ├── conf.py
|   |   |   ├── read_parallel.py
|   |   |   ├── read_serial.py
|   |   |   ├── write_parallel.py
|   |   |   └── write_serial.py
|   |   ├── test-footnotes
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-gettext-template
|   |   |   ├── _templates
|   |   |   |   ├── template1.html
|   |   |   |   └── template2.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-glossary
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_assets
|   |   |   ├── conf.py
|   |   |   ├── extra
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   └── subdir
|   |   |   ├── index.rst
|   |   |   ├── static
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   ├── js
|   |   |   |   └── subdir
|   |   |   └── subdir
|   |   |       └── _build
|   |   ├── test-html_entity
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_scaled_image_link
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_style
|   |   |   ├── _static
|   |   |   |   └── default.css
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-parsed-literal
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-section
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-images
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── subdir
|   |   |       └── index.rst
|   |   ├── test-index_on_title
|   |   |   ├── conf.py
|   |   |   └── contents.rst
|   |   ├── test-inheritance
|   |   |   ├── basic_diagram.rst
|   |   |   ├── conf.py
|   |   |   ├── diagram_module_w_2_top_classes.rst
|   |   |   ├── diagram_w_1_top_class.rst
|   |   |   ├── diagram_w_2_top_classes.rst
|   |   |   ├── diagram_w_nested_classes.rst
|   |   |   ├── diagram_w_parts.rst
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── test.py
|   |   |   |   └── test_nested.py
|   |   |   └── index.rst
|   |   ├── test-intl
|   |   |   ├── _templates
|   |   |   |   └── contents.html
|   |   |   ├── admonitions.txt
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── definition_terms.txt
|   |   |   ├── docfields.txt
|   |   |   ├── external_links.txt
|   |   |   ├── figure.txt
|   |   |   ├── footnote.txt
|   |   |   ├── glossary_terms.txt
|   |   |   ├── glossary_terms_inconsistency.txt
|   |   |   ├── index.txt
|   |   |   ├── index_entries.txt
|   |   |   ├── label_target.txt
|   |   |   ├── literalblock.txt
|   |   |   ├── only.txt
|   |   |   ├── raw.txt
|   |   |   ├── refs.txt
|   |   |   ├── refs_inconsistency.txt
|   |   |   ├── refs_python_domain.txt
|   |   |   ├── role_xref.txt
|   |   |   ├── rubric.txt
|   |   |   ├── section.txt
|   |   |   ├── seealso.txt
|   |   |   ├── subdir
|   |   |   |   └── index.txt
|   |   |   ├── table.txt
|   |   |   ├── toctree.txt
|   |   |   ├── topic.txt
|   |   |   ├── versionchange.txt
|   |   |   ├── warnings.txt
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-keep_warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-babel
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-latex-equations
|   |   |   ├── conf.py
|   |   |   ├── equations.rst
|   |   |   └── expects
|   |   ├── test-latex-figure-in-admonition
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-includegraphics
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-index
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-labels
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── otherdoc.rst
|   |   ├── test-latex-numfig
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── indexhowto.rst
|   |   |   └── indexmanual.rst
|   |   ├── test-latex-table
|   |   |   ├── _mytemplates
|   |   |   |   └── latex
|   |   |   ├── complex.rst
|   |   |   ├── conf.py
|   |   |   ├── expects
|   |   |   ├── index.rst
|   |   |   ├── longtable.rst
|   |   |   └── tabular.rst
|   |   ├── test-latex-theme
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── theme
|   |   |       └── custom
|   |   ├── test-latex-title
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-unicode
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck
|   |   |   ├── conf.py
|   |   |   └── links.txt
|   |   ├── test-linkcheck-localserver
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-locale
|   |   |   ├── locale1
|   |   |   |   └── en
|   |   |   └── locale2
|   |   |       └── en
|   |   ├── test-manpage_url
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-citation
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-rubric
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-maxlistdepth
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-metadata
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-need-escaped
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux.rst
|   |   ├── test-nested-enumerated-list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nested-tables
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-numbered-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-numfig
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-productionlist
|   |   |   ├── Bare.rst
|   |   |   ├── Dup1.rst
|   |   |   ├── Dup2.rst
|   |   |   ├── LineContinuation.rst
|   |   |   ├── P1.rst
|   |   |   ├── P2.rst
|   |   |   ├── conf.py
|   |   |   ├── firstLineRule.rst
|   |   |   └── index.rst
|   |   ├── test-prolog
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── markdown.md
|   |   |   ├── prolog_markdown_parser.py
|   |   |   └── restructuredtext.rst
|   |   ├── test-pycode
|   |   |   └── cp_1251_coded.py
|   |   ├── test-pycode-egg
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── src
|   |   |       ├── sample.py
|   |   |       └── setup.py
|   |   ├── test-reST-code-block
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-refonly_bullet_list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-roles-download
|   |   |   ├── another
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-root
|   |   |   ├── _templates
|   |   |   |   ├── contentssb.html
|   |   |   |   ├── customsb.html
|   |   |   |   └── layout.html
|   |   |   ├── autodoc.txt
|   |   |   ├── autodoc_target.py
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── extapi.txt
|   |   |   ├── extensions.txt
|   |   |   ├── footnote.txt
|   |   |   ├── images.txt
|   |   |   ├── includes.txt
|   |   |   ├── index.txt
|   |   |   ├── lists.txt
|   |   |   ├── markup.txt
|   |   |   ├── math.txt
|   |   |   ├── objects.txt
|   |   |   ├── parsermod.py
|   |   |   ├── special
|   |   |   |   └── code.py
|   |   |   └── subdir
|   |   |       ├── excluded.txt
|   |   |       ├── images.txt
|   |   |       └── includes.txt
|   |   ├── test-search
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nosearch.rst
|   |   |   └── tocitem.rst
|   |   ├── test-setup
|   |   |   ├── doc
|   |   |   |   ├── conf.py
|   |   |   |   └── index.txt
|   |   |   └── setup.py
|   |   ├── test-smartquotes
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-stylesheets
|   |   |   ├── _templates
|   |   |   |   └── layout.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-templating
|   |   |   ├── _templates
|   |   |   |   ├── autosummary
|   |   |   |   └── layout.html
|   |   |   ├── autosummary_templating.txt
|   |   |   ├── conf.py
|   |   |   └── index.txt
|   |   ├── test-theming
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── setup.py
|   |   |   └── test_theme
|   |   |       ├── __init__.py
|   |   |       ├── staticfiles
|   |   |       └── test-theme
|   |   ├── test-tocdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   ├── qux.rst
|   |   |   └── tocdepth.rst
|   |   ├── test-toctree-duplicated
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree-empty
|   |   |   ├── _templates
|   |   |   |   └── localtoc.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-toctree-glob
|   |   |   ├── bar
|   |   |   |   ├── bar_1.rst
|   |   |   |   ├── bar_2.rst
|   |   |   |   ├── bar_3.rst
|   |   |   |   ├── bar_4
|   |   |   |   └── index.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux
|   |   |       ├── index.rst
|   |   |       ├── qux_1.rst
|   |   |       └── qux_2.rst
|   |   ├── test-toctree-maxdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   └── qux.rst
|   |   ├── test-trim_doctest_flags
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-versioning
|   |   |   ├── added.txt
|   |   |   ├── conf.py
|   |   |   ├── deleted.txt
|   |   |   ├── deleted_end.txt
|   |   |   ├── index.txt
|   |   |   ├── insert.txt
|   |   |   ├── insert_beginning.txt
|   |   |   ├── insert_similar.txt
|   |   |   ├── modified.txt
|   |   |   └── original.txt
|   |   └── test-warnings
|   |       ├── autodoc_fodder.py
|   |       ├── conf.py
|   |       ├── index.rst
|   |       └── undecodable.rst
|   ├── test_api_translator.py
|   ├── test_application.py
|   ├── test_build.py
|   ├── test_build_changes.py
|   ├── test_build_dirhtml.py
|   ├── test_build_epub.py
|   ├── test_build_gettext.py
|   ├── test_build_html.py
|   ├── test_build_latex.py
|   ├── test_build_linkcheck.py
|   ├── test_build_manpage.py
|   ├── test_build_texinfo.py
|   ├── test_build_text.py
|   ├── test_builder.py
|   ├── test_catalogs.py
|   ├── test_config.py
|   ├── test_correct_year.py
|   ├── test_directive_code.py
|   ├── test_directive_only.py
|   ├── test_directive_other.py
|   ├── test_directive_patch.py
|   ├── test_docutilsconf.py
|   ├── test_domain_c.py
|   ├── test_domain_cpp.py
|   ├── test_domain_js.py
|   ├── test_domain_py.py
|   ├── test_domain_rst.py
|   ├── test_domain_std.py
|   ├── test_environment.py
|   ├── test_environment_indexentries.py
|   ├── test_environment_toctree.py
|   ├── test_errors.py
|   ├── test_events.py
|   ├── test_ext_apidoc.py
|   ├── test_ext_autodoc.py
|   ├── test_ext_autodoc_autofunction.py
|   ├── test_ext_autodoc_configs.py
|   ├── test_ext_autodoc_events.py
|   ├── test_ext_autodoc_mock.py
|   ├── test_ext_autodoc_private_members.py
|   ├── test_ext_autosectionlabel.py
|   ├── test_ext_autosummary.py
|   ├── test_ext_coverage.py
|   ├── test_ext_doctest.py
|   ├── test_ext_duration.py
|   ├── test_ext_githubpages.py
|   ├── test_ext_graphviz.py
|   ├── test_ext_ifconfig.py
|   ├── test_ext_imgconverter.py
|   ├── test_ext_inheritance_diagram.py
|   ├── test_ext_intersphinx.py
|   ├── test_ext_math.py
|   ├── test_ext_napoleon.py
|   ├── test_ext_napoleon_docstring.py
|   ├── test_ext_napoleon_iterators.py
|   ├── test_ext_todo.py
|   ├── test_ext_viewcode.py
|   ├── test_highlighting.py
|   ├── test_intl.py
|   ├── test_locale.py
|   ├── test_markup.py
|   ├── test_metadata.py
|   ├── test_parser.py
|   ├── test_project.py
|   ├── test_pycode.py
|   ├── test_pycode_ast.py
|   ├── test_pycode_parser.py
|   ├── test_quickstart.py
|   ├── test_roles.py
|   ├── test_search.py
|   ├── test_setup_command.py
|   ├── test_smartquotes.py
|   ├── test_templating.py
|   ├── test_theming.py
|   ├── test_toctree.py
|   ├── test_transforms_post_transforms_code.py
|   ├── test_util.py
|   ├── test_util_docstrings.py
|   ├── test_util_docutils.py
|   ├── test_util_fileutil.py
|   ├── test_util_i18n.py
|   ├── test_util_images.py
|   ├── test_util_inspect.py
|   ├── test_util_inventory.py
|   ├── test_util_jsdump.py
|   ├── test_util_logging.py
|   ├── test_util_matching.py
|   ├── test_util_nodes.py
|   ├── test_util_pycompat.py
|   ├── test_util_rst.py
|   ├── test_util_template.py
|   ├── test_util_typing.py
|   ├── test_versioning.py
|   ├── test_writer_latex.py
|   └── typing_test_data.py
└── utils
    ├── __init__.py
    ├── bump_docker.sh
    ├── bump_version.py
    ├── checks.py
    ├── doclinter.py
    └── jssplitter_generator.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: docstring default arg is broken

Description: **Describe the bug**
docstring default arg is broken in html.
Python class method
>     def add_lines(self, lines, color=(1, 1, 1), width=5, label=None, name=None):
is rendered as
>    add_lines(lines, color=1, 1, 1, width=5, label=None, name=None)

**To Reproduce**
Steps to reproduce the behavior (Dockerfile):
```
FROM python:3.7-slim
RUN apt update; apt install -y git make python3-vtk7
RUN git clone https://github.com/tkoyama010/pyvista.git
WORKDIR /pyvista
RUN git checkout patch-1
RUN pip install . 
RUN pip install -r requirements_docs.txt
RUN (cd docs; make html)
```

**Expected behavior**
A clear and concise description of what you expected to happen.
Python class method
>     def add_lines(self, lines, color=(1, 1, 1), width=5, label=None, name=None):
is rendered as
>    add_lines(lines, color=(1, 1, 1), width=5, label=None, name=None)

**Your project**
Link to your sphinx project, or attach zipped small project sample.
https://github.com/pyvista/pyvista
https://docs.pyvista.org/plotting/plotting.html#pyvista.BasePlotter.add_lines

**Screenshots**
If applicable, add screenshots to help explain your problem.
![image](https://user-images.githubusercontent.com/7513610/87623793-2e412d80-c761-11ea-8caa-0b8bfcaf56c3.png)

**Environment info**
- OS: [e.g. Unix/Linux/Mac/Win/other with version] Linux
- Python version: [e.g. 3.7.1] 3.7
- Sphinx version: [e.g. 1.8.2] sphinx-build 3.1.1
- Sphinx extensions:  [e.g. sphinx.ext.autodoc, recommonmark] sphinx.ext.autodoc
- Extra tools: [e.g. Browser, tex or something else] None

**Additional context**
Add any other context about the problem here.

- [e.g. URL or Ticket] None



Patch information:
diff --git a/sphinx/util/inspect.py b/sphinx/util/inspect.py
index 378174993..89c148a6e 100644
--- a/sphinx/util/inspect.py
+++ b/sphinx/util/inspect.py
@@ -626,7 +626,14 @@ def signature_from_ast(node: ast.FunctionDef) -> inspect.Signature:
             if defaults[i] is Parameter.empty:
                 default = Parameter.empty
             else:
-                default = ast_unparse(defaults[i])
+                default_node = defaults[i]
+                default = ast_unparse(default_node)
+                if isinstance(default_node, ast.Tuple):
+                    # ensure tuple defaults are parenthesized (and keep singleton comma)
+                    if len(getattr(default_node, 'elts', [])) == 1:
+                        default = f"({default},)"
+                    else:
+                        default = f"({default})"
 
             annotation = ast_unparse(arg.annotation) or Parameter.empty
             params.append(Parameter(arg.arg, Parameter.POSITIONAL_ONLY,
@@ -636,7 +643,14 @@ def signature_from_ast(node: ast.FunctionDef) -> inspect.Signature:
         if defaults[i + posonlyargs] is Parameter.empty:
             default = Parameter.empty
         else:
-            default = ast_unparse(defaults[i + posonlyargs])
+            default_node = defaults[i + posonlyargs]
+            default = ast_unparse(default_node)
+            if isinstance(default_node, ast.Tuple):
+                # ensure tuple defaults are parenthesized (and keep singleton comma)
+                if len(getattr(default_node, 'elts', [])) == 1:
+                    default = f"({default},)"
+                else:
+                    default = f"({default})"
 
         annotation = ast_unparse(arg.annotation) or Parameter.empty
         params.append(Parameter(arg.arg, Parameter.POSITIONAL_OR_KEYWORD,
@@ -649,6 +663,14 @@ def signature_from_ast(node: ast.FunctionDef) -> inspect.Signature:
 
     for i, arg in enumerate(args.kwonlyargs):
         default = ast_unparse(args.kw_defaults[i]) or Parameter.empty
+        if default is not Parameter.empty and args.kw_defaults[i] is not None:
+            default_node = args.kw_defaults[i]
+            if isinstance(default_node, ast.Tuple):
+                # ensure tuple defaults are parenthesized (and keep singleton comma)
+                if len(getattr(default_node, 'elts', [])) == 1:
+                    default = f"({default},)"
+                else:
+                    default = f"({default})"
         annotation = ast_unparse(arg.annotation) or Parameter.empty
         params.append(Parameter(arg.arg, Parameter.KEYWORD_ONLY, default=default,
                                 annotation=annotation))


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of tests/test_util_inspect.py.
Extra Requirements: 
Purpose: This file is expected to contain unit tests for the patched code in `sphinx/util/inspect.py`, which will help identify test cases related to function signature parsing and default argument handling.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: tests/test_util_inspect.py
Line number range: 1 - 658
Content:
1. """
2.     test_util_inspect
3.     ~~~~~~~~~~~~~~~
4. 
5.     Tests util.inspect functions.
6. 
7.     :copyright: Copyright 2007-2020 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import _testcapi
12. import ast
13. import datetime
14. import functools
15. import sys
16. import types
17. from inspect import Parameter
18. 
19. import pytest
20. 
21. from sphinx.util import inspect
22. from sphinx.util.inspect import stringify_signature, is_builtin_class_method
23. 
24. 
25. def test_signature():
26.     # literals
27.     with pytest.raises(TypeError):
28.         inspect.signature(1)
29. 
30.     with pytest.raises(TypeError):
31.         inspect.signature('')
32. 
33.     # builtins are supported on a case-by-case basis, depending on whether
34.     # they define __text_signature__
35.     if getattr(list, '__text_signature__', None):
36.         sig = inspect.stringify_signature(inspect.signature(list))
37.         assert sig == '(iterable=(), /)'
38.     else:
39.         with pytest.raises(ValueError):
40.             inspect.signature(list)
41. 
42.     # normal function
43.     def func(a, b, c=1, d=2, *e, **f):
44.         pass
45. 
46.     sig = inspect.stringify_signature(inspect.signature(func))
47.     assert sig == '(a, b, c=1, d=2, *e, **f)'
48. 
49. 
50. def test_signature_partial():
51.     def fun(a, b, c=1, d=2):
52.         pass
53.     p = functools.partial(fun, 10, c=11)
54. 
55.     sig = inspect.signature(p)
56.     assert stringify_signature(sig) == '(b, *, c=11, d=2)'
57. 
58. 
59. def test_signature_methods():
60.     class Foo:
61.         def meth1(self, arg1, **kwargs):
62.             pass
63. 
64.         @classmethod
65.         def meth2(cls, arg1, *args, **kwargs):
66.             pass
67. 
68.         @staticmethod
69.         def meth3(arg1, *args, **kwargs):
70.             pass
71. 
72.     @functools.wraps(Foo().meth1)
73.     def wrapped_bound_method(*args, **kwargs):
74.         pass
75. 
76.     # unbound method
77.     sig = inspect.signature(Foo.meth1)
78.     assert stringify_signature(sig) == '(self, arg1, **kwargs)'
79. 
80.     sig = inspect.signature(Foo.meth1, bound_method=True)
81.     assert stringify_signature(sig) == '(arg1, **kwargs)'
82. 
83.     # bound method
84.     sig = inspect.signature(Foo().meth1)
85.     assert stringify_signature(sig) == '(arg1, **kwargs)'
86. 
87.     # class method
88.     sig = inspect.signature(Foo.meth2)
89.     assert stringify_signature(sig) == '(arg1, *args, **kwargs)'
90. 
91.     sig = inspect.signature(Foo().meth2)
92.     assert stringify_signature(sig) == '(arg1, *args, **kwargs)'
93. 
94.     # static method
95.     sig = inspect.signature(Foo.meth3)
96.     assert stringify_signature(sig) == '(arg1, *args, **kwargs)'
97. 
98.     sig = inspect.signature(Foo().meth3)
99.     assert stringify_signature(sig) == '(arg1, *args, **kwargs)'
100. 
101.     # wrapped bound method
102.     sig = inspect.signature(wrapped_bound_method)
103.     assert stringify_signature(sig) == '(*args, **kwargs)'
104. 
105. 
106. def test_signature_partialmethod():
107.     from functools import partialmethod
108. 
109.     class Foo:
110.         def meth1(self, arg1, arg2, arg3=None, arg4=None):
111.             pass
112. 
113.         def meth2(self, arg1, arg2):
114.             pass
115. 
116.         foo = partialmethod(meth1, 1, 2)
117.         bar = partialmethod(meth1, 1, arg3=3)
118.         baz = partialmethod(meth2, 1, 2)
119. 
120.     subject = Foo()
121.     sig = inspect.signature(subject.foo)
122.     assert stringify_signature(sig) == '(arg3=None, arg4=None)'
123. 
124.     sig = inspect.signature(subject.bar)
125.     assert stringify_signature(sig) == '(arg2, *, arg3=3, arg4=None)'
126. 
127.     sig = inspect.signature(subject.baz)
128.     assert stringify_signature(sig) == '()'
129. 
130. 
131. def test_signature_annotations():
132.     from typing_test_data import (f0, f1, f2, f3, f4, f5, f6, f7, f8, f9, f10,
133.                                   f11, f12, f13, f14, f15, f16, f17, f18, f19, f20, f21, Node)
134. 
135.     # Class annotations
136.     sig = inspect.signature(f0)
137.     assert stringify_signature(sig) == '(x: int, y: numbers.Integral) -> None'
138. 
139.     # Generic types with concrete parameters
140.     sig = inspect.signature(f1)
141.     assert stringify_signature(sig) == '(x: List[int]) -> List[int]'
142. 
143.     # TypeVars and generic types with TypeVars
144.     sig = inspect.signature(f2)
145.     assert stringify_signature(sig) == '(x: List[T], y: List[T_co], z: T) -> List[T_contra]'
146. 
147.     # Union types
148.     sig = inspect.signature(f3)
149.     assert stringify_signature(sig) == '(x: Union[str, numbers.Integral]) -> None'
150. 
151.     # Quoted annotations
152.     sig = inspect.signature(f4)
153.     assert stringify_signature(sig) == '(x: str, y: str) -> None'
154. 
155.     # Keyword-only arguments
156.     sig = inspect.signature(f5)
157.     assert stringify_signature(sig) == '(x: int, *, y: str, z: str) -> None'
158. 
159.     # Keyword-only arguments with varargs
160.     sig = inspect.signature(f6)
161.     assert stringify_signature(sig) == '(x: int, *args, y: str, z: str) -> None'
162. 
163.     # Space around '=' for defaults
164.     sig = inspect.signature(f7)
165.     assert stringify_signature(sig) == '(x: int = None, y: dict = {}) -> None'
166. 
167.     # Callable types
168.     sig = inspect.signature(f8)
169.     assert stringify_signature(sig) == '(x: Callable[[int, str], int]) -> None'
170. 
171.     sig = inspect.signature(f9)
172.     assert stringify_signature(sig) == '(x: Callable) -> None'
173. 
174.     # Tuple types
175.     sig = inspect.signature(f10)
176.     assert stringify_signature(sig) == '(x: Tuple[int, str], y: Tuple[int, ...]) -> None'
177. 
178.     # Instance annotations
179.     sig = inspect.signature(f11)
180.     assert stringify_signature(sig) == '(x: CustomAnnotation, y: 123) -> None'
181. 
182.     # tuple with more than two items
183.     sig = inspect.signature(f12)
184.     assert stringify_signature(sig) == '() -> Tuple[int, str, int]'
185. 
186.     # optional
187.     sig = inspect.signature(f13)
188.     assert stringify_signature(sig) == '() -> Optional[str]'
189. 
190.     # optional union
191.     sig = inspect.signature(f20)
192.     assert stringify_signature(sig) == '() -> Optional[Union[int, str]]'
193. 
194.     # Any
195.     sig = inspect.signature(f14)
196.     assert stringify_signature(sig) == '() -> Any'
197. 
198.     # ForwardRef
199.     sig = inspect.signature(f15)
200.     assert stringify_signature(sig) == '(x: Unknown, y: int) -> Any'
201. 
202.     # keyword only arguments (1)
203.     sig = inspect.signature(f16)
204.     assert stringify_signature(sig) == '(arg1, arg2, *, arg3=None, arg4=None)'
205. 
206.     # keyword only arguments (2)
207.     sig = inspect.signature(f17)
208.     assert stringify_signature(sig) == '(*, arg3, arg4)'
209. 
210.     sig = inspect.signature(f18)
211.     assert stringify_signature(sig) == '(self, arg1: Union[int, Tuple] = 10) -> List[Dict]'
212. 
213.     # annotations for variadic and keyword parameters
214.     sig = inspect.signature(f19)
215.     assert stringify_signature(sig) == '(*args: int, **kwargs: str)'
216. 
217.     # default value is inspect.Signature.empty
218.     sig = inspect.signature(f21)
219.     assert stringify_signature(sig) == "(arg1='whatever', arg2)"
220. 
221.     # type hints by string
222.     sig = inspect.signature(Node.children)
223.     if (3, 5, 0) <= sys.version_info < (3, 5, 3):
224.         assert stringify_signature(sig) == '(self) -> List[Node]'
225.     else:
226.         assert stringify_signature(sig) == '(self) -> List[typing_test_data.Node]'
227. 
228.     sig = inspect.signature(Node.__init__)
229.     assert stringify_signature(sig) == '(self, parent: Optional[Node]) -> None'
230. 
231.     # show_annotation is False
232.     sig = inspect.signature(f7)
233.     assert stringify_signature(sig, show_annotation=False) == '(x=None, y={})'
234. 
235.     # show_return_annotation is False
236.     sig = inspect.signature(f7)
237.     assert stringify_signature(sig, show_return_annotation=False) == '(x: int = None, y: dict = {})'
238. 
239. 
240. @pytest.mark.skipif(sys.version_info < (3, 8), reason='python 3.8+ is required.')
241. @pytest.mark.sphinx(testroot='ext-autodoc')
242. def test_signature_annotations_py38(app):
243.     from target.pep570 import foo, bar, baz, qux
244. 
245.     # case: separator at head
246.     sig = inspect.signature(foo)
247.     assert stringify_signature(sig) == '(*, a, b)'
248. 
249.     # case: separator in the middle
250.     sig = inspect.signature(bar)
251.     assert stringify_signature(sig) == '(a, b, /, c, d)'
252. 
253.     sig = inspect.signature(baz)
254.     assert stringify_signature(sig) == '(a, /, *, b)'
255. 
256.     # case: separator at tail
257.     sig = inspect.signature(qux)
258.     assert stringify_signature(sig) == '(a, b, /)'
259. 
260. 
261. def test_signature_from_str_basic():
262.     signature = '(a, b, *args, c=0, d="blah", **kwargs)'
263.     sig = inspect.signature_from_str(signature)
264.     assert list(sig.parameters.keys()) == ['a', 'b', 'args', 'c', 'd', 'kwargs']
265.     assert sig.parameters['a'].name == 'a'
266.     assert sig.parameters['a'].kind == Parameter.POSITIONAL_OR_KEYWORD
267.     assert sig.parameters['a'].default == Parameter.empty
268.     assert sig.parameters['a'].annotation == Parameter.empty
269.     assert sig.parameters['b'].name == 'b'
270.     assert sig.parameters['b'].kind == Parameter.POSITIONAL_OR_KEYWORD
271.     assert sig.parameters['b'].default == Parameter.empty
272.     assert sig.parameters['b'].annotation == Parameter.empty
273.     assert sig.parameters['args'].name == 'args'
274.     assert sig.parameters['args'].kind == Parameter.VAR_POSITIONAL
275.     assert sig.parameters['args'].default == Parameter.empty
276.     assert sig.parameters['args'].annotation == Parameter.empty
277.     assert sig.parameters['c'].name == 'c'
278.     assert sig.parameters['c'].kind == Parameter.KEYWORD_ONLY
279.     assert sig.parameters['c'].default == '0'
280.     assert sig.parameters['c'].annotation == Parameter.empty
281.     assert sig.parameters['d'].name == 'd'
282.     assert sig.parameters['d'].kind == Parameter.KEYWORD_ONLY
283.     assert sig.parameters['d'].default == "'blah'"
284.     assert sig.parameters['d'].annotation == Parameter.empty
285.     assert sig.parameters['kwargs'].name == 'kwargs'
286.     assert sig.parameters['kwargs'].kind == Parameter.VAR_KEYWORD
287.     assert sig.parameters['kwargs'].default == Parameter.empty
288.     assert sig.parameters['kwargs'].annotation == Parameter.empty
289.     assert sig.return_annotation == Parameter.empty
290. 
291. 
292. def test_signature_from_str_default_values():
293.     signature = ('(a=0, b=0.0, c="str", d=b"bytes", e=..., f=True, '
294.                  'g=[1, 2, 3], h={"a": 1}, i={1, 2, 3}, '
295.                  'j=lambda x, y: None, k=None, l=object(), m=foo.bar.CONSTANT)')
296.     sig = inspect.signature_from_str(signature)
297.     assert sig.parameters['a'].default == '0'
298.     assert sig.parameters['b'].default == '0.0'
299.     assert sig.parameters['c'].default == "'str'"
300.     assert sig.parameters['d'].default == "b'bytes'"
301.     assert sig.parameters['e'].default == '...'
302.     assert sig.parameters['f'].default == 'True'
303.     assert sig.parameters['g'].default == '[1, 2, 3]'
304.     assert sig.parameters['h'].default == "{'a': 1}"
305.     assert sig.parameters['i'].default == '{1, 2, 3}'
306.     assert sig.parameters['j'].default == 'lambda x, y: ...'
307.     assert sig.parameters['k'].default == 'None'
308.     assert sig.parameters['l'].default == 'object()'
309.     assert sig.parameters['m'].default == 'foo.bar.CONSTANT'
310. 
311. 
312. def test_signature_from_str_annotations():
313.     signature = '(a: int, *args: bytes, b: str = "blah", **kwargs: float) -> None'
314.     sig = inspect.signature_from_str(signature)
315.     assert list(sig.parameters.keys()) == ['a', 'args', 'b', 'kwargs']
316.     assert sig.parameters['a'].annotation == "int"
317.     assert sig.parameters['args'].annotation == "bytes"
318.     assert sig.parameters['b'].annotation == "str"
319.     assert sig.parameters['kwargs'].annotation == "float"
320.     assert sig.return_annotation == 'None'
321. 
322. 
323. def test_signature_from_str_complex_annotations():
324.     sig = inspect.signature_from_str('() -> Tuple[str, int, ...]')
325.     assert sig.return_annotation == 'Tuple[str, int, ...]'
326. 
327.     sig = inspect.signature_from_str('() -> Callable[[int, int], int]')
328.     assert sig.return_annotation == 'Callable[[int, int], int]'
329. 
330. 
331. def test_signature_from_str_kwonly_args():
332.     sig = inspect.signature_from_str('(a, *, b)')
333.     assert list(sig.parameters.keys()) == ['a', 'b']
334.     assert sig.parameters['a'].kind == Parameter.POSITIONAL_OR_KEYWORD
335.     assert sig.parameters['a'].default == Parameter.empty
336.     assert sig.parameters['b'].kind == Parameter.KEYWORD_ONLY
337.     assert sig.parameters['b'].default == Parameter.empty
338. 
339. 
340. @pytest.mark.skipif(sys.version_info < (3, 8),
341.                     reason='python-3.8 or above is required')
342. def test_signature_from_str_positionaly_only_args():
343.     sig = inspect.signature_from_str('(a, b=0, /, c=1)')
344.     assert list(sig.parameters.keys()) == ['a', 'b', 'c']
345.     assert sig.parameters['a'].kind == Parameter.POSITIONAL_ONLY
346.     assert sig.parameters['a'].default == Parameter.empty
347.     assert sig.parameters['b'].kind == Parameter.POSITIONAL_ONLY
348.     assert sig.parameters['b'].default == '0'
349.     assert sig.parameters['c'].kind == Parameter.POSITIONAL_OR_KEYWORD
350.     assert sig.parameters['c'].default == '1'
351. 
352. 
353. def test_signature_from_str_invalid():
354.     with pytest.raises(SyntaxError):
355.         inspect.signature_from_str('')
356. 
357. 
358. def test_signature_from_ast():
359.     signature = 'def func(a, b, *args, c=0, d="blah", **kwargs): pass'
360.     tree = ast.parse(signature)
361.     sig = inspect.signature_from_ast(tree.body[0])
362.     assert list(sig.parameters.keys()) == ['a', 'b', 'args', 'c', 'd', 'kwargs']
363.     assert sig.parameters['a'].name == 'a'
364.     assert sig.parameters['a'].kind == Parameter.POSITIONAL_OR_KEYWORD
365.     assert sig.parameters['a'].default == Parameter.empty
366.     assert sig.parameters['a'].annotation == Parameter.empty
367.     assert sig.parameters['b'].name == 'b'
368.     assert sig.parameters['b'].kind == Parameter.POSITIONAL_OR_KEYWORD
369.     assert sig.parameters['b'].default == Parameter.empty
370.     assert sig.parameters['b'].annotation == Parameter.empty
371.     assert sig.parameters['args'].name == 'args'
372.     assert sig.parameters['args'].kind == Parameter.VAR_POSITIONAL
373.     assert sig.parameters['args'].default == Parameter.empty
374.     assert sig.parameters['args'].annotation == Parameter.empty
375.     assert sig.parameters['c'].name == 'c'
376.     assert sig.parameters['c'].kind == Parameter.KEYWORD_ONLY
377.     assert sig.parameters['c'].default == '0'
378.     assert sig.parameters['c'].annotation == Parameter.empty
379.     assert sig.parameters['d'].name == 'd'
380.     assert sig.parameters['d'].kind == Parameter.KEYWORD_ONLY
381.     assert sig.parameters['d'].default == "'blah'"
382.     assert sig.parameters['d'].annotation == Parameter.empty
383.     assert sig.parameters['kwargs'].name == 'kwargs'
384.     assert sig.parameters['kwargs'].kind == Parameter.VAR_KEYWORD
385.     assert sig.parameters['kwargs'].default == Parameter.empty
386.     assert sig.parameters['kwargs'].annotation == Parameter.empty
387.     assert sig.return_annotation == Parameter.empty
388. 
389. 
390. def test_safe_getattr_with_default():
391.     class Foo:
392.         def __getattr__(self, item):
393.             raise Exception
394. 
395.     obj = Foo()
396. 
397.     result = inspect.safe_getattr(obj, 'bar', 'baz')
398. 
399.     assert result == 'baz'
400. 
401. 
402. def test_safe_getattr_with_exception():
403.     class Foo:
404.         def __getattr__(self, item):
405.             raise Exception
406. 
407.     obj = Foo()
408. 
409.     try:
410.         inspect.safe_getattr(obj, 'bar')
411.     except AttributeError as exc:
412.         assert exc.args[0] == 'bar'
413.     else:
414.         pytest.fail('AttributeError not raised')
415. 
416. 
417. def test_safe_getattr_with_property_exception():
418.     class Foo:
419.         @property
420.         def bar(self):
421.             raise Exception
422. 
423.     obj = Foo()
424. 
425.     try:
426.         inspect.safe_getattr(obj, 'bar')
427.     except AttributeError as exc:
428.         assert exc.args[0] == 'bar'
429.     else:
430.         pytest.fail('AttributeError not raised')
431. 
432. 
433. def test_safe_getattr_with___dict___override():
434.     class Foo:
435.         @property
436.         def __dict__(self):
437.             raise Exception
438. 
439.     obj = Foo()
440. 
441.     try:
442.         inspect.safe_getattr(obj, 'bar')
443.     except AttributeError as exc:
444.         assert exc.args[0] == 'bar'
445.     else:
446.         pytest.fail('AttributeError not raised')
447. 
448. 
449. def test_dictionary_sorting():
450.     dictionary = {"c": 3, "a": 1, "d": 2, "b": 4}
451.     description = inspect.object_description(dictionary)
452.     assert description == "{'a': 1, 'b': 4, 'c': 3, 'd': 2}"
453. 
454. 
455. def test_set_sorting():
456.     set_ = set("gfedcba")
457.     description = inspect.object_description(set_)
458.     assert description == "{'a', 'b', 'c', 'd', 'e', 'f', 'g'}"
459. 
460. 
461. def test_set_sorting_fallback():
462.     set_ = {None, 1}
463.     description = inspect.object_description(set_)
464.     assert description in ("{1, None}", "{None, 1}")
465. 
466. 
467. def test_frozenset_sorting():
468.     frozenset_ = frozenset("gfedcba")
469.     description = inspect.object_description(frozenset_)
470.     assert description == "frozenset({'a', 'b', 'c', 'd', 'e', 'f', 'g'})"
471. 
472. 
473. def test_frozenset_sorting_fallback():
474.     frozenset_ = frozenset((None, 1))
475.     description = inspect.object_description(frozenset_)
476.     assert description in ("frozenset({1, None})", "frozenset({None, 1})")
477. 
478. 
479. def test_dict_customtype():
480.     class CustomType:
481.         def __init__(self, value):
482.             self._value = value
483. 
484.         def __repr__(self):
485.             return "<CustomType(%r)>" % self._value
486. 
487.     dictionary = {CustomType(2): 2, CustomType(1): 1}
488.     description = inspect.object_description(dictionary)
489.     # Type is unsortable, just check that it does not crash
490.     assert "<CustomType(2)>: 2" in description
491. 
492. 
493. @pytest.mark.sphinx(testroot='ext-autodoc')
494. def test_isclassmethod(app):
495.     from target.methods import Base, Inherited
496. 
497.     assert inspect.isclassmethod(Base.classmeth) is True
498.     assert inspect.isclassmethod(Base.meth) is False
499.     assert inspect.isclassmethod(Inherited.classmeth) is True
500.     assert inspect.isclassmethod(Inherited.meth) is False
501. 
502. 
503. @pytest.mark.sphinx(testroot='ext-autodoc')
504. def test_isstaticmethod(app):
505.     from target.methods import Base, Inherited
506. 
507.     assert inspect.isstaticmethod(Base.staticmeth, Base, 'staticmeth') is True
508.     assert inspect.isstaticmethod(Base.meth, Base, 'meth') is False
509.     assert inspect.isstaticmethod(Inherited.staticmeth, Inherited, 'staticmeth') is True
510.     assert inspect.isstaticmethod(Inherited.meth, Inherited, 'meth') is False
511. 
512. 
513. @pytest.mark.sphinx(testroot='ext-autodoc')
514. def test_iscoroutinefunction(app):
515.     from target.functions import coroutinefunc, func, partial_coroutinefunc
516.     from target.methods import Base
517. 
518.     assert inspect.iscoroutinefunction(func) is False                   # function
519.     assert inspect.iscoroutinefunction(coroutinefunc) is True           # coroutine
520.     assert inspect.iscoroutinefunction(partial_coroutinefunc) is True   # partial-ed coroutine
521.     assert inspect.iscoroutinefunction(Base.meth) is False              # method
522.     assert inspect.iscoroutinefunction(Base.coroutinemeth) is True      # coroutine-method
523. 
524.     # partial-ed coroutine-method
525.     partial_coroutinemeth = Base.__dict__['partial_coroutinemeth']
526.     assert inspect.iscoroutinefunction(partial_coroutinemeth) is True
527. 
528. 
529. @pytest.mark.sphinx(testroot='ext-autodoc')
530. def test_isfunction(app):
531.     from target.functions import builtin_func, partial_builtin_func
532.     from target.functions import func, partial_func
533.     from target.methods import Base
534. 
535.     assert inspect.isfunction(func) is True                     # function
536.     assert inspect.isfunction(partial_func) is True             # partial-ed function
537.     assert inspect.isfunction(Base.meth) is True                # method of class
538.     assert inspect.isfunction(Base.partialmeth) is True         # partial-ed method of class
539.     assert inspect.isfunction(Base().meth) is False             # method of instance
540.     assert inspect.isfunction(builtin_func) is False            # builtin function
541.     assert inspect.isfunction(partial_builtin_func) is False    # partial-ed builtin function
542. 
543. 
544. @pytest.mark.sphinx(testroot='ext-autodoc')
545. def test_isbuiltin(app):
546.     from target.functions import builtin_func, partial_builtin_func
547.     from target.functions import func, partial_func
548.     from target.methods import Base
549. 
550.     assert inspect.isbuiltin(builtin_func) is True          # builtin function
551.     assert inspect.isbuiltin(partial_builtin_func) is True  # partial-ed builtin function
552.     assert inspect.isbuiltin(func) is False                 # function
553.     assert inspect.isbuiltin(partial_func) is False         # partial-ed function
554.     assert inspect.isbuiltin(Base.meth) is False            # method of class
555.     assert inspect.isbuiltin(Base().meth) is False          # method of instance
556. 
557. 
558. @pytest.mark.sphinx(testroot='ext-autodoc')
559. def test_isdescriptor(app):
560.     from target.functions import func
561.     from target.methods import Base
562. 
563.     assert inspect.isdescriptor(Base.prop) is True      # property of class
564.     assert inspect.isdescriptor(Base().prop) is False   # property of instance
565.     assert inspect.isdescriptor(Base.meth) is True      # method of class
566.     assert inspect.isdescriptor(Base().meth) is True    # method of instance
567.     assert inspect.isdescriptor(func) is True           # function
568. 
569. 
570. @pytest.mark.sphinx(testroot='ext-autodoc')
571. def test_isattributedescriptor(app):
572.     from target.methods import Base
573. 
574.     class Descriptor:
575.         def __get__(self, obj, typ=None):
576.             pass
577. 
578.     testinstancemethod = _testcapi.instancemethod(str.__repr__)
579. 
580.     assert inspect.isattributedescriptor(Base.prop) is True                    # property
581.     assert inspect.isattributedescriptor(Base.meth) is False                   # method
582.     assert inspect.isattributedescriptor(Base.staticmeth) is False             # staticmethod
583.     assert inspect.isattributedescriptor(Base.classmeth) is False              # classmetho
584.     assert inspect.isattributedescriptor(Descriptor) is False                  # custom descriptor class    # NOQA
585.     assert inspect.isattributedescriptor(str.join) is False                    # MethodDescriptorType       # NOQA
586.     assert inspect.isattributedescriptor(object.__init__) is False             # WrapperDescriptorType      # NOQA
587.     assert inspect.isattributedescriptor(dict.__dict__['fromkeys']) is False   # ClassMethodDescriptorType  # NOQA
588.     assert inspect.isattributedescriptor(types.FrameType.f_locals) is True     # GetSetDescriptorType       # NOQA
589.     assert inspect.isattributedescriptor(datetime.timedelta.days) is True      # MemberDescriptorType       # NOQA
590.     assert inspect.isattributedescriptor(testinstancemethod) is False          # instancemethod (C-API)     # NOQA
591. 
592. 
593. def test_isproperty(app):
594.     from target.functions import func
595.     from target.methods import Base
596. 
597.     assert inspect.isproperty(Base.prop) is True        # property of class
598.     assert inspect.isproperty(Base().prop) is False     # property of instance
599.     assert inspect.isproperty(Base.meth) is False       # method of class
600.     assert inspect.isproperty(Base().meth) is False     # method of instance
601.     assert inspect.isproperty(func) is False            # function
602. 
603. 
604. @pytest.mark.skipif(sys.version_info < (3, 7), reason='python 3.7+ is required.')
605. @pytest.mark.sphinx(testroot='ext-autodoc')
606. def test_isgenericalias(app):
607.     from target.genericalias import C, T
608.     from target.methods import Base
609. 
610.     assert inspect.isgenericalias(C) is True
611.     assert inspect.isgenericalias(T) is True
612.     assert inspect.isgenericalias(object()) is False
613.     assert inspect.isgenericalias(Base) is False
614. 
615. 
616. def test_unpartial():
617.     def func1(a, b, c):
618.         pass
619. 
620.     func2 = functools.partial(func1, 1)
621.     func2.__doc__ = "func2"
622.     func3 = functools.partial(func2, 2)  # nested partial object
623. 
624.     assert inspect.unpartial(func2) is func1
625.     assert inspect.unpartial(func3) is func1
626. 
627. 
628. def test_getdoc_inherited_decorated_method():
629.     class Foo:
630.         def meth(self):
631.             """docstring."""
632. 
633.     class Bar(Foo):
634.         @functools.lru_cache()
635.         def meth(self):
636.             # inherited and decorated method
637.             pass
638. 
639.     assert inspect.getdoc(Bar.meth, getattr, False, Bar, "meth") is None
640.     assert inspect.getdoc(Bar.meth, getattr, True, Bar, "meth") == "docstring."
641. 
642. 
643. def test_is_builtin_class_method():
644.     class MyInt(int):
645.         def my_method(self):
646.             pass
647. 
648.     assert inspect.is_builtin_class_method(MyInt, 'to_bytes')
649.     assert inspect.is_builtin_class_method(MyInt, '__init__')
650.     assert not inspect.is_builtin_class_method(MyInt, 'my_method')
651.     assert not inspect.is_builtin_class_method(MyInt, 'does_not_exist')
652.     assert not inspect.is_builtin_class_method(4, 'still does not crash')
653. 
654.     class ObjectWithMroAttr:
655.         def __init__(self, mro_attr):
656.             self.__mro__ = mro_attr
657. 
658.     assert not inspect.is_builtin_class_method(ObjectWithMroAttr([1, 2, 3]), 'still does not crash')

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-23 12:33:59,422 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="The current context provides tests for `sphinx.util.inspect`, which is where the patch is located. However, it lacks tests for the specific scenario of a tuple being used as a default argument, which is the root cause of the bug. The bug itself manifests in the `autodoc` extension's output. Therefore, to find relevant test cases that demonstrate the functionality related to the bug, I need to examine the tests for the `autodoc` extension itself." query='Please provide the full content of tests/test_ext_autodoc.py.' extra_requirements='' purpose='This file is expected to contain integration tests for the `autodoc` extension, which will likely have test cases that cover the rendering of function signatures with various kinds of default arguments, including tuples.'
2025-12-23 12:33:59,424 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of tests/test_ext_autodoc.py.
2025-12-23 12:33:59,424 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-23 12:33:59,424 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-23 12:33:59,425 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-23 12:33:59,425 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of tests/test_ext_autodoc.py.
Purpose: This file is expected to contain integration tests for the `autodoc` extension, which will likely have test cases that cover the rendering of function signatures with various kinds of default arguments, including tuples.
2025-12-23 12:34:02,010 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the full content of `tests/test_ext_autodoc.py` as you requested. This file contains a comprehensive set of tests for the `autodoc` extension, including checks for how it handles various function signatures and default argument values. The tests will help ensure that the documentation generated by `autodoc` is accurate and correctly formatted.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/test_ext_autodoc.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2092, 'candidates_token_count': 97, 'total_token_count': 2249, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2092}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 97}], 'thoughts_token_count': 60, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.1158107383963988, 'model_name': 'gemini-2.5-pro'} id='run--15c2b874-c5e8-4e9a-a178-d71011d0914b-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/test_ext_autodoc.py'}, 'id': '8158ec82-10e2-451e-98d8-85af5cd2a694', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2092, 'output_tokens': 97, 'total_tokens': 2249, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 60}}
2025-12-23 12:34:05,583 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have started by reading the initial part of the `tests/test_ext_autodoc.py` file. Since the file is larger than the initial preview, I am now checking its total size to ensure I can retrieve the complete content for you.' additional_kwargs={'function_call': {'name': 'find_file_node_with_relative_path', 'arguments': '{"relative_path": "tests/test_ext_autodoc.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 9623, 'candidates_token_count': 76, 'total_token_count': 9887, 'cached_content_token_count': 1807, 'prompt_tokens_details': [{'modality': 1, 'token_count': 9623}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1807}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 76}], 'thoughts_token_count': 188}, 'finish_reason': 'STOP', 'avg_logprobs': -0.3166850240607011, 'model_name': 'gemini-2.5-pro'} id='run--62f859a3-7e5f-49b8-b3ad-275773ab2121-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'tests/test_ext_autodoc.py'}, 'id': '5fff69d7-ec94-4858-b42a-5a55778b5a1f', 'type': 'tool_call'}] usage_metadata={'input_tokens': 9623, 'output_tokens': 76, 'total_tokens': 9887, 'input_token_details': {'cache_read': 1807}, 'output_token_details': {'reasoning': 188}}
2025-12-23 12:34:09,187 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have now retrieved the remaining content of `tests/test_ext_autodoc.py` for you. The first part of the file was loaded previously, and this second part completes the full file content.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"end_line": 1000.0, "relative_path": "tests/test_ext_autodoc.py", "start_line": 501.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 9763, 'candidates_token_count': 73, 'total_token_count': 9954, 'cached_content_token_count': 9019, 'prompt_tokens_details': [{'modality': 1, 'token_count': 9763}], 'cache_tokens_details': [{'modality': 1, 'token_count': 9019}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 73}], 'thoughts_token_count': 118}, 'finish_reason': 'STOP', 'avg_logprobs': -0.388267699986288, 'model_name': 'gemini-2.5-pro'} id='run--83ba8a9b-153b-45ac-9985-33411106087c-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'end_line': 1000.0, 'relative_path': 'tests/test_ext_autodoc.py', 'start_line': 501.0}, 'id': '3ec1d99b-4aab-4413-8377-d3f677fa2acf', 'type': 'tool_call'}] usage_metadata={'input_tokens': 9763, 'output_tokens': 73, 'total_tokens': 9954, 'input_token_details': {'cache_read': 9019}, 'output_token_details': {'reasoning': 118}}
2025-12-23 12:34:21,605 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have now retrieved the final part of `tests/test_ext_autodoc.py`. This completes the full content of the file, which contains a comprehensive set of integration tests for the `autodoc` extension. These tests cover various aspects of the extension's functionality, ensuring that it correctly renders function signatures, handles different argument types, and generates accurate documentation." additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 1001.0, "relative_path": "tests/test_ext_autodoc.py", "end_line": 1500.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 17915, 'candidates_token_count': 105, 'total_token_count': 19122, 'cached_content_token_count': 9157, 'prompt_tokens_details': [{'modality': 1, 'token_count': 17915}], 'cache_tokens_details': [{'modality': 1, 'token_count': 9157}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 105}], 'thoughts_token_count': 1102}, 'finish_reason': 'STOP', 'avg_logprobs': -1.7157264346168155, 'model_name': 'gemini-2.5-pro'} id='run--cf857432-d199-4201-ab18-60739101d4a6-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 1001.0, 'relative_path': 'tests/test_ext_autodoc.py', 'end_line': 1500.0}, 'id': '6bb26b69-4c0b-4e19-9054-60ab8cecc5a7', 'type': 'tool_call'}] usage_metadata={'input_tokens': 17915, 'output_tokens': 105, 'total_tokens': 19122, 'input_token_details': {'cache_read': 9157}, 'output_token_details': {'reasoning': 1102}}
2025-12-23 12:34:26,640 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have now retrieved the final part of `tests/test_ext_autodoc.py`, which completes the full content of the file. These tests for the `autodoc` extension cover a wide range of cases, including the handling of decorators, exceptions, and various member options, to ensure that the generated documentation is both accurate and comprehensive.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 1501.0, "relative_path": "tests/test_ext_autodoc.py", "end_line": 2000.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 25592, 'candidates_token_count': 100, 'total_token_count': 25965, 'cached_content_token_count': 12811, 'prompt_tokens_details': [{'modality': 1, 'token_count': 25592}], 'cache_tokens_details': [{'modality': 1, 'token_count': 12811}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 100}], 'thoughts_token_count': 273}, 'finish_reason': 'STOP', 'avg_logprobs': -0.34559490203857424, 'model_name': 'gemini-2.5-pro'} id='run--19ab6395-4521-4c86-89cc-c0451b57d045-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 1501.0, 'relative_path': 'tests/test_ext_autodoc.py', 'end_line': 2000.0}, 'id': '0e3c8be2-edf3-48cc-b3dc-c294b55271b9', 'type': 'tool_call'}] usage_metadata={'input_tokens': 25592, 'output_tokens': 100, 'total_tokens': 25965, 'input_token_details': {'cache_read': 12811}, 'output_token_details': {'reasoning': 273}}
2025-12-23 12:34:30,978 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have now retrieved the final part of `tests/test_ext_autodoc.py`, which completes the full content of the file. These tests for the `autodoc` extension cover a wide range of cases, including the handling of decorators, exceptions, and various member options, to ensure that the generated documentation is both accurate and comprehensive.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"end_line": 2500.0, "relative_path": "tests/test_ext_autodoc.py", "start_line": 2001.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 33342, 'candidates_token_count': 100, 'total_token_count': 33654, 'cached_content_token_count': 23814, 'prompt_tokens_details': [{'modality': 1, 'token_count': 33342}], 'cache_tokens_details': [{'modality': 1, 'token_count': 23814}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 100}], 'thoughts_token_count': 212}, 'finish_reason': 'STOP', 'avg_logprobs': -0.19453468322753906, 'model_name': 'gemini-2.5-pro'} id='run--880bf5ae-d33e-47f3-9a3a-90ee45d844c3-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'end_line': 2500.0, 'relative_path': 'tests/test_ext_autodoc.py', 'start_line': 2001.0}, 'id': '3709c539-02ed-47b8-96fa-aaf130766e80', 'type': 'tool_call'}] usage_metadata={'input_tokens': 33342, 'output_tokens': 100, 'total_tokens': 33654, 'input_token_details': {'cache_read': 23814}, 'output_token_details': {'reasoning': 212}}
2025-12-23 12:34:36,095 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have successfully retrieved the entire content of the `tests/test_ext_autodoc.py` file by reading it in several sequential parts. You now have the complete source code for this test file, which includes a wide variety of test cases for the `autodoc` extension, covering everything from basic rendering to more complex scenarios involving inheritance, decorators, and special members.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 35473, 'candidates_token_count': 76, 'total_token_count': 35872, 'cached_content_token_count': 32989, 'prompt_tokens_details': [{'modality': 1, 'token_count': 35473}], 'cache_tokens_details': [{'modality': 1, 'token_count': 32989}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 76}], 'thoughts_token_count': 323}, 'finish_reason': 'STOP', 'avg_logprobs': -0.5187897933156866, 'model_name': 'gemini-2.5-pro'} id='run--4e6061be-4c6d-4c3a-9058-691212d9b6a8-0' usage_metadata={'input_tokens': 35473, 'output_tokens': 76, 'total_tokens': 35872, 'input_token_details': {'cache_read': 32989}, 'output_token_details': {'reasoning': 323}}
2025-12-23 12:34:36,098 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of tests/test_ext_autodoc.py.
--- END QUERY ---



--- BEGIN PURPOSE ---
This file is expected to contain integration tests for the `autodoc` extension, which will likely have test cases that cover the rendering of function signatures with various kinds of default arguments, including tuples.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/test_ext_autodoc.py
Line number range: 1 - 500
Content:
1. """
2.     test_ext_autodoc
3.     ~~~~~~~~~~~~~~~~
4. 
5.     Test the autodoc extension.  This tests mainly the Documenters; the auto
6.     directives are tested in a test source file translated by test_build.
7. 
8.     :copyright: Copyright 2007-2020 by the Sphinx team, see AUTHORS.
9.     :license: BSD, see LICENSE for details.
10. """
11. 
12. import sys
13. from unittest.mock import Mock
14. from warnings import catch_warnings
15. 
16. import pytest
17. from docutils.statemachine import ViewList
18. 
19. from sphinx import addnodes
20. from sphinx.ext.autodoc import ModuleLevelDocumenter, ALL, Options
21. from sphinx.ext.autodoc.directive import DocumenterBridge, process_documenter_options
22. from sphinx.testing.util import SphinxTestApp, Struct  # NOQA
23. from sphinx.util.docutils import LoggingReporter
24. 
25. try:
26.     # Enable pyximport to test cython module
27.     import pyximport
28.     pyximport.install()
29. except ImportError:
30.     pyximport = None
31. 
32. 
33. def do_autodoc(app, objtype, name, options=None):
34.     if options is None:
35.         options = {}
36.     app.env.temp_data.setdefault('docname', 'index')  # set dummy docname
37.     doccls = app.registry.documenters[objtype]
38.     docoptions = process_documenter_options(doccls, app.config, options)
39.     state = Mock()
40.     state.document.settings.tab_width = 8
41.     bridge = DocumenterBridge(app.env, LoggingReporter(''), docoptions, 1, state)
42.     documenter = doccls(bridge, name)
43.     documenter.generate()
44. 
45.     return bridge.result
46. 
47. 
48. def make_directive_bridge(env):
49.     options = Options(
50.         inherited_members = False,
51.         undoc_members = False,
52.         private_members = False,
53.         special_members = False,
54.         imported_members = False,
55.         show_inheritance = False,
56.         noindex = False,
57.         annotation = None,
58.         synopsis = '',
59.         platform = '',
60.         deprecated = False,
61.         members = [],
62.         member_order = 'alphabetical',
63.         exclude_members = set(),
64.         ignore_module_all = False,
65.     )
66. 
67.     directive = Struct(
68.         env = env,
69.         genopt = options,
70.         result = ViewList(),
71.         filename_set = set(),
72.         state = Mock(),
73.     )
74.     directive.state.document.settings.tab_width = 8
75. 
76.     return directive
77. 
78. 
79. processed_signatures = []
80. 
81. 
82. def process_signature(app, what, name, obj, options, args, retann):
83.     processed_signatures.append((what, name))
84.     if name == 'bar':
85.         return '42', None
86. 
87. 
88. def skip_member(app, what, name, obj, skip, options):
89.     if name in ('__special1__', '__special2__'):
90.         return skip
91.     if name.startswith('__'):
92.         return True
93.     if name == 'skipmeth':
94.         return True
95. 
96. 
97. def test_parse_name(app):
98.     def verify(objtype, name, result):
99.         inst = app.registry.documenters[objtype](directive, name)
100.         assert inst.parse_name()
101.         assert (inst.modname, inst.objpath, inst.args, inst.retann) == result
102. 
103.     directive = make_directive_bridge(app.env)
104. 
105.     # for modules
106.     verify('module', 'test_ext_autodoc', ('test_ext_autodoc', [], None, None))
107.     verify('module', 'test.test_ext_autodoc', ('test.test_ext_autodoc', [], None, None))
108.     verify('module', 'test(arg)', ('test', [], 'arg', None))
109.     assert 'signature arguments' in app._warning.getvalue()
110. 
111.     # for functions/classes
112.     verify('function', 'test_ext_autodoc.raises',
113.            ('test_ext_autodoc', ['raises'], None, None))
114.     verify('function', 'test_ext_autodoc.raises(exc) -> None',
115.            ('test_ext_autodoc', ['raises'], 'exc', 'None'))
116.     directive.env.temp_data['autodoc:module'] = 'test_ext_autodoc'
117.     verify('function', 'raises', ('test_ext_autodoc', ['raises'], None, None))
118.     del directive.env.temp_data['autodoc:module']
119.     directive.env.ref_context['py:module'] = 'test_ext_autodoc'
120.     verify('function', 'raises', ('test_ext_autodoc', ['raises'], None, None))
121.     verify('class', 'Base', ('test_ext_autodoc', ['Base'], None, None))
122. 
123.     # for members
124.     directive.env.ref_context['py:module'] = 'sphinx.testing.util'
125.     verify('method', 'SphinxTestApp.cleanup',
126.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
127.     directive.env.ref_context['py:module'] = 'sphinx.testing.util'
128.     directive.env.ref_context['py:class'] = 'Foo'
129.     directive.env.temp_data['autodoc:class'] = 'SphinxTestApp'
130.     verify('method', 'cleanup',
131.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
132.     verify('method', 'SphinxTestApp.cleanup',
133.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
134. 
135. 
136. def test_format_signature(app):
137.     app.connect('autodoc-process-signature', process_signature)
138.     app.connect('autodoc-skip-member', skip_member)
139. 
140.     directive = make_directive_bridge(app.env)
141. 
142.     def formatsig(objtype, name, obj, args, retann):
143.         inst = app.registry.documenters[objtype](directive, name)
144.         inst.fullname = name
145.         inst.doc_as_attr = False  # for class objtype
146.         inst.parent = object  # dummy
147.         inst.object = obj
148.         inst.objpath = [name]
149.         inst.args = args
150.         inst.retann = retann
151.         res = inst.format_signature()
152.         print(res)
153.         return res
154. 
155.     # no signatures for modules
156.     assert formatsig('module', 'test', None, None, None) == ''
157. 
158.     # test for functions
159.     def f(a, b, c=1, **d):
160.         pass
161. 
162.     def g(a='\n'):
163.         pass
164.     assert formatsig('function', 'f', f, None, None) == '(a, b, c=1, **d)'
165.     assert formatsig('function', 'f', f, 'a, b, c, d', None) == '(a, b, c, d)'
166.     assert formatsig('function', 'g', g, None, None) == r"(a='\n')"
167. 
168.     # test for classes
169.     class D:
170.         pass
171. 
172.     class E:
173.         def __init__(self):
174.             pass
175. 
176.     # an empty init and no init are the same
177.     for C in (D, E):
178.         assert formatsig('class', 'D', C, None, None) == '()'
179. 
180. 
181.     class SomeMeta(type):
182.         def __call__(cls, a, b=None):
183.             return type.__call__(cls, a, b)
184. 
185.     # these three are all equivalent
186.     class F:
187.         def __init__(self, a, b=None):
188.             pass
189. 
190.     class FNew:
191.         def __new__(cls, a, b=None):
192.             return super().__new__(cls)
193. 
194.     class FMeta(metaclass=SomeMeta):
195.         pass
196. 
197.     # and subclasses should always inherit
198.     class G(F):
199.         pass
200. 
201.     class GNew(FNew):
202.         pass
203. 
204.     class GMeta(FMeta):
205.         pass
206. 
207.     # subclasses inherit
208.     for C in (F, FNew, FMeta, G, GNew, GMeta):
209.         assert formatsig('class', 'C', C, None, None) == '(a, b=None)'
210.     assert formatsig('class', 'C', D, 'a, b', 'X') == '(a, b) -> X'
211. 
212. 
213.     class ListSubclass(list):
214.         pass
215. 
216.     # only supported if the python implementation decides to document it
217.     if getattr(list, '__text_signature__', None) is not None:
218.         assert formatsig('class', 'C', ListSubclass, None, None) == '(iterable=(), /)'
219.     else:
220.         assert formatsig('class', 'C', ListSubclass, None, None) == ''
221. 
222. 
223.     class ExceptionSubclass(Exception):
224.         pass
225. 
226.     # Exception has no __text_signature__ at least in Python 3.8
227.     if getattr(Exception, '__text_signature__', None) is None:
228.         assert formatsig('class', 'C', ExceptionSubclass, None, None) == ''
229. 
230. 
231.     # __init__ have signature at first line of docstring
232.     directive.env.config.autoclass_content = 'both'
233. 
234.     class F2:
235.         '''some docstring for F2.'''
236.         def __init__(self, *args, **kw):
237.             '''
238.             __init__(a1, a2, kw1=True, kw2=False)
239. 
240.             some docstring for __init__.
241.             '''
242.     class G2(F2):
243.         pass
244. 
245.     assert formatsig('class', 'F2', F2, None, None) == \
246.         '(a1, a2, kw1=True, kw2=False)'
247.     assert formatsig('class', 'G2', G2, None, None) == \
248.         '(a1, a2, kw1=True, kw2=False)'
249. 
250.     # test for methods
251.     class H:
252.         def foo1(self, b, *c):
253.             pass
254. 
255.         def foo2(b, *c):
256.             pass
257. 
258.         def foo3(self, d='\n'):
259.             pass
260.     assert formatsig('method', 'H.foo', H.foo1, None, None) == '(b, *c)'
261.     assert formatsig('method', 'H.foo', H.foo1, 'a', None) == '(a)'
262.     assert formatsig('method', 'H.foo', H.foo2, None, None) == '(*c)'
263.     assert formatsig('method', 'H.foo', H.foo3, None, None) == r"(d='\n')"
264. 
265.     # test bound methods interpreted as functions
266.     assert formatsig('function', 'foo', H().foo1, None, None) == '(b, *c)'
267.     assert formatsig('function', 'foo', H().foo2, None, None) == '(*c)'
268.     assert formatsig('function', 'foo', H().foo3, None, None) == r"(d='\n')"
269. 
270.     # test exception handling (exception is caught and args is '')
271.     directive.env.config.autodoc_docstring_signature = False
272.     assert formatsig('function', 'int', int, None, None) == ''
273. 
274.     # test processing by event handler
275.     assert formatsig('method', 'bar', H.foo1, None, None) == '42'
276. 
277.     # test functions created via functools.partial
278.     from functools import partial
279.     curried1 = partial(lambda a, b, c: None, 'A')
280.     assert formatsig('function', 'curried1', curried1, None, None) == \
281.         '(b, c)'
282.     curried2 = partial(lambda a, b, c=42: None, 'A')
283.     assert formatsig('function', 'curried2', curried2, None, None) == \
284.         '(b, c=42)'
285.     curried3 = partial(lambda a, b, *c: None, 'A')
286.     assert formatsig('function', 'curried3', curried3, None, None) == \
287.         '(b, *c)'
288.     curried4 = partial(lambda a, b, c=42, *d, **e: None, 'A')
289.     assert formatsig('function', 'curried4', curried4, None, None) == \
290.         '(b, c=42, *d, **e)'
291. 
292. 
293. @pytest.mark.skipif(sys.version_info < (3, 5), reason='typing is available since python3.5.')
294. @pytest.mark.sphinx('html', testroot='ext-autodoc')
295. def test_autodoc_process_signature_typing_generic(app):
296.     actual = do_autodoc(app, 'class', 'target.generic_class.A', {})
297. 
298.     assert list(actual) == [
299.         '',
300.         '.. py:class:: A(a, b=None)',
301.         '   :module: target.generic_class',
302.         '',
303.         '   docstring for A',
304.         '',
305.     ]
306. 
307. 
308. def test_autodoc_process_signature_typehints(app):
309.     captured = []
310. 
311.     def process_signature(*args):
312.         captured.append(args)
313. 
314.     app.connect('autodoc-process-signature', process_signature)
315. 
316.     def func(x: int, y: int) -> int:
317.         pass
318. 
319.     directive = make_directive_bridge(app.env)
320.     inst = app.registry.documenters['function'](directive, 'func')
321.     inst.fullname = 'func'
322.     inst.object = func
323.     inst.objpath = ['func']
324.     inst.format_signature()
325.     assert captured == [(app, 'function', 'func', func,
326.                          directive.genopt, '(x: int, y: int)', 'int')]
327. 
328. 
329. def test_get_doc(app):
330.     directive = make_directive_bridge(app.env)
331. 
332.     def getdocl(objtype, obj):
333.         inst = app.registry.documenters[objtype](directive, 'tmp')
334.         inst.parent = object  # dummy
335.         inst.object = obj
336.         inst.objpath = [obj.__name__]
337.         inst.doc_as_attr = False
338.         inst.format_signature()  # handle docstring signatures!
339.         ds = inst.get_doc()
340.         # for testing purposes, concat them and strip the empty line at the end
341.         res = sum(ds, [])[:-1]
342.         print(res)
343.         return res
344. 
345.     # objects without docstring
346.     def f():
347.         pass
348.     assert getdocl('function', f) == []
349. 
350.     # standard function, diverse docstring styles...
351.     def f():
352.         """Docstring"""
353.     def g():
354.         """
355.         Docstring
356.         """
357.     for func in (f, g):
358.         assert getdocl('function', func) == ['Docstring']
359. 
360.     # first line vs. other lines indentation
361.     def f():
362.         """First line
363. 
364.         Other
365.           lines
366.         """
367.     assert getdocl('function', f) == ['First line', '', 'Other', '  lines']
368. 
369.     # charset guessing (this module is encoded in utf-8)
370.     def f():
371.         """Döcstring"""
372.     assert getdocl('function', f) == ['Döcstring']
373. 
374.     # already-unicode docstrings must be taken literally
375.     def f():
376.         """Döcstring"""
377.     assert getdocl('function', f) == ['Döcstring']
378. 
379.     # verify that method docstrings get extracted in both normal case
380.     # and in case of bound method posing as a function
381.     class J:  # NOQA
382.         def foo(self):
383.             """Method docstring"""
384.     assert getdocl('method', J.foo) == ['Method docstring']
385.     assert getdocl('function', J().foo) == ['Method docstring']
386. 
387. 
388. @pytest.mark.sphinx('html', testroot='ext-autodoc')
389. def test_new_documenter(app):
390.     class MyDocumenter(ModuleLevelDocumenter):
391.         objtype = 'integer'
392.         directivetype = 'integer'
393.         priority = 100
394. 
395.         @classmethod
396.         def can_document_member(cls, member, membername, isattr, parent):
397.             return isinstance(member, int)
398. 
399.         def document_members(self, all_members=False):
400.             return
401. 
402.     app.add_autodocumenter(MyDocumenter)
403. 
404.     options = {"members": 'integer'}
405.     actual = do_autodoc(app, 'module', 'target', options)
406.     assert list(actual) == [
407.         '',
408.         '.. py:module:: target',
409.         '',
410.         '',
411.         '.. py:integer:: integer',
412.         '   :module: target',
413.         '',
414.         '   documentation for the integer',
415.         '',
416.     ]
417. 
418. 
419. def test_attrgetter_using(app):
420.     from target import Class
421.     from target.inheritance import Derived
422. 
423.     directive = make_directive_bridge(app.env)
424. 
425.     def assert_getter_works(objtype, name, obj, attrs=[], **kw):
426.         getattr_spy = []
427. 
428.         def special_getattr(obj, name, *defargs):
429.             if name in attrs:
430.                 getattr_spy.append((obj, name))
431.                 return None
432.             return getattr(obj, name, *defargs)
433.         app.add_autodoc_attrgetter(type, special_getattr)
434. 
435.         del getattr_spy[:]
436.         inst = app.registry.documenters[objtype](directive, name)
437.         inst.generate(**kw)
438. 
439.         hooked_members = [s[1] for s in getattr_spy]
440.         documented_members = [s[1] for s in processed_signatures]
441.         for attr in attrs:
442.             fullname = '.'.join((name, attr))
443.             assert attr in hooked_members
444.             assert fullname not in documented_members, \
445.                 '%r was not hooked by special_attrgetter function' % fullname
446. 
447.     with catch_warnings(record=True):
448.         directive.genopt['members'] = ALL
449.         directive.genopt['inherited_members'] = False
450.         print(directive.genopt)
451.         assert_getter_works('class', 'target.Class', Class, ['meth'])
452. 
453.         directive.genopt['inherited_members'] = True
454.         assert_getter_works('class', 'target.inheritance.Derived', Derived, ['inheritedmeth'])
455. 
456. 
457. @pytest.mark.sphinx('html', testroot='ext-autodoc')
458. def test_py_module(app, warning):
459.     # without py:module
460.     actual = do_autodoc(app, 'method', 'Class.meth')
461.     assert list(actual) == []
462.     assert ("don't know which module to import for autodocumenting 'Class.meth'"
463.             in warning.getvalue())
464. 
465.     # with py:module
466.     app.env.ref_context['py:module'] = 'target'
467.     warning.truncate(0)
468. 
469.     actual = do_autodoc(app, 'method', 'Class.meth')
470.     assert list(actual) == [
471.         '',
472.         '.. py:method:: Class.meth()',
473.         '   :module: target',
474.         '',
475.         '   Function.',
476.         '',
477.     ]
478.     assert ("don't know which module to import for autodocumenting 'Class.meth'"
479.             not in warning.getvalue())
480. 
481. 
482. @pytest.mark.sphinx('html', testroot='ext-autodoc')
483. def test_autodoc_decorator(app):
484.     actual = do_autodoc(app, 'decorator', 'target.decorator.deco1')
485.     assert list(actual) == [
486.         '',
487.         '.. py:decorator:: deco1',
488.         '   :module: target.decorator',
489.         '',
490.         '   docstring for deco1',
491.         '',
492.     ]
493. 
494.     actual = do_autodoc(app, 'decorator', 'target.decorator.deco2')
495.     assert list(actual) == [
496.         '',
497.         '.. py:decorator:: deco2(condition, message)',
498.         '   :module: target.decorator',
499.         '',
500.         '   docstring for deco2',


File: tests/test_ext_autodoc.py
Line number range: 501 - 1000
Content:
501.         '',
502.     ]
503. 
504. 
505. @pytest.mark.sphinx('html', testroot='ext-autodoc')
506. def test_autodoc_exception(app):
507.     actual = do_autodoc(app, 'exception', 'target.CustomEx')
508.     assert list(actual) == [
509.         '',
510.         '.. py:exception:: CustomEx',
511.         '   :module: target',
512.         '',
513.         '   My custom exception.',
514.         '',
515.     ]
516. 
517. 
518. @pytest.mark.sphinx('html', testroot='ext-autodoc')
519. def test_autodoc_warnings(app, warning):
520.     app.env.temp_data['docname'] = 'dummy'
521. 
522.     # can't import module
523.     do_autodoc(app, 'module', 'unknown')
524.     assert "failed to import module 'unknown'" in warning.getvalue()
525. 
526.     # missing function
527.     do_autodoc(app, 'function', 'unknown')
528.     assert "import for autodocumenting 'unknown'" in warning.getvalue()
529. 
530.     do_autodoc(app, 'function', 'target.unknown')
531.     assert "failed to import function 'unknown' from module 'target'" in warning.getvalue()
532. 
533.     # missing method
534.     do_autodoc(app, 'method', 'target.Class.unknown')
535.     assert "failed to import method 'Class.unknown' from module 'target'" in warning.getvalue()
536. 
537. 
538. @pytest.mark.sphinx('html', testroot='ext-autodoc')
539. def test_autodoc_attributes(app):
540.     options = {"synopsis": 'Synopsis',
541.                "platform": "Platform",
542.                "deprecated": None}
543.     actual = do_autodoc(app, 'module', 'target', options)
544.     assert list(actual) == [
545.         '',
546.         '.. py:module:: target',
547.         '   :synopsis: Synopsis',
548.         '   :platform: Platform',
549.         '   :deprecated:',
550.         ''
551.     ]
552. 
553. 
554. @pytest.mark.sphinx('html', testroot='ext-autodoc')
555. def test_autodoc_members(app):
556.     # default (no-members)
557.     actual = do_autodoc(app, 'class', 'target.inheritance.Base')
558.     assert list(filter(lambda l: '::' in l, actual)) == [
559.         '.. py:class:: Base()',
560.     ]
561. 
562.     # default ALL-members
563.     options = {"members": None}
564.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
565.     assert list(filter(lambda l: '::' in l, actual)) == [
566.         '.. py:class:: Base()',
567.         '   .. py:method:: Base.inheritedclassmeth()',
568.         '   .. py:method:: Base.inheritedmeth()',
569.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
570.     ]
571. 
572.     # default specific-members
573.     options = {"members": "inheritedmeth,inheritedstaticmeth"}
574.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
575.     assert list(filter(lambda l: '::' in l, actual)) == [
576.         '.. py:class:: Base()',
577.         '   .. py:method:: Base.inheritedmeth()',
578.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
579.     ]
580. 
581. 
582. @pytest.mark.sphinx('html', testroot='ext-autodoc')
583. def test_autodoc_exclude_members(app):
584.     options = {"members": None,
585.                "exclude-members": "inheritedmeth,inheritedstaticmeth"}
586.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
587.     assert list(filter(lambda l: '::' in l, actual)) == [
588.         '.. py:class:: Base()',
589.         '   .. py:method:: Base.inheritedclassmeth()'
590.     ]
591. 
592.     # members vs exclude-members
593.     options = {"members": "inheritedmeth",
594.                "exclude-members": "inheritedmeth"}
595.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
596.     assert list(filter(lambda l: '::' in l, actual)) == [
597.         '.. py:class:: Base()',
598.     ]
599. 
600. 
601. @pytest.mark.sphinx('html', testroot='ext-autodoc')
602. def test_autodoc_undoc_members(app):
603.     options = {"members": None,
604.                "undoc-members": None}
605.     actual = do_autodoc(app, 'class', 'target.Class', options)
606.     assert list(filter(lambda l: '::' in l, actual)) == [
607.         '.. py:class:: Class(arg)',
608.         '   .. py:attribute:: Class.attr',
609.         '   .. py:attribute:: Class.docattr',
610.         '   .. py:method:: Class.excludemeth()',
611.         '   .. py:attribute:: Class.inst_attr_comment',
612.         '   .. py:attribute:: Class.inst_attr_inline',
613.         '   .. py:attribute:: Class.inst_attr_string',
614.         '   .. py:attribute:: Class.mdocattr',
615.         '   .. py:method:: Class.meth()',
616.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
617.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
618.         '   .. py:attribute:: Class.skipattr',
619.         '   .. py:method:: Class.skipmeth()',
620.         '   .. py:attribute:: Class.udocattr',
621.         '   .. py:method:: Class.undocmeth()'
622.     ]
623. 
624. 
625. @pytest.mark.sphinx('html', testroot='ext-autodoc')
626. def test_autodoc_inherited_members(app):
627.     options = {"members": None,
628.                "inherited-members": None}
629.     actual = do_autodoc(app, 'class', 'target.inheritance.Derived', options)
630.     assert list(filter(lambda l: 'method::' in l, actual)) == [
631.         '   .. py:method:: Derived.inheritedclassmeth()',
632.         '   .. py:method:: Derived.inheritedmeth()',
633.         '   .. py:method:: Derived.inheritedstaticmeth(cls)',
634.     ]
635. 
636. 
637. @pytest.mark.sphinx('html', testroot='ext-autodoc')
638. def test_autodoc_inherited_members_Base(app):
639.     options = {"members": None,
640.                "inherited-members": "Base",
641.                "special-members": None}
642. 
643.     # check methods for object class are shown
644.     actual = do_autodoc(app, 'class', 'target.inheritance.Derived', options)
645.     assert '   .. py:method:: Derived.inheritedmeth()' in actual
646.     assert '   .. py:method:: Derived.inheritedclassmeth' not in actual
647. 
648. 
649. @pytest.mark.sphinx('html', testroot='ext-autodoc')
650. def test_autodoc_inherited_members_None(app):
651.     options = {"members": None,
652.                "inherited-members": "None",
653.                "special-members": None}
654. 
655.     # check methods for object class are shown
656.     actual = do_autodoc(app, 'class', 'target.inheritance.Derived', options)
657.     assert '   .. py:method:: Derived.__init__()' in actual
658.     assert '   .. py:method:: Derived.__str__()' in actual
659. 
660. 
661. @pytest.mark.sphinx('html', testroot='ext-autodoc')
662. def test_autodoc_imported_members(app):
663.     options = {"members": None,
664.                "imported-members": None,
665.                "ignore-module-all": None}
666.     actual = do_autodoc(app, 'module', 'target', options)
667.     assert '.. py:function:: save_traceback(app: Sphinx) -> str' in actual
668. 
669. 
670. @pytest.mark.sphinx('html', testroot='ext-autodoc')
671. def test_autodoc_special_members(app):
672.     # specific special methods
673.     options = {"undoc-members": None,
674.                "special-members": "__init__,__special1__"}
675.     actual = do_autodoc(app, 'class', 'target.Class', options)
676.     assert list(filter(lambda l: '::' in l, actual)) == [
677.         '.. py:class:: Class(arg)',
678.         '   .. py:method:: Class.__init__(arg)',
679.         '   .. py:method:: Class.__special1__()',
680.     ]
681. 
682.     # combination with specific members
683.     options = {"members": "attr,docattr",
684.                "undoc-members": None,
685.                "special-members": "__init__,__special1__"}
686.     actual = do_autodoc(app, 'class', 'target.Class', options)
687.     assert list(filter(lambda l: '::' in l, actual)) == [
688.         '.. py:class:: Class(arg)',
689.         '   .. py:method:: Class.__init__(arg)',
690.         '   .. py:method:: Class.__special1__()',
691.         '   .. py:attribute:: Class.attr',
692.         '   .. py:attribute:: Class.docattr',
693.     ]
694. 
695.     # all special methods
696.     options = {"members": None,
697.                "undoc-members": None,
698.                "special-members": None}
699.     actual = do_autodoc(app, 'class', 'target.Class', options)
700.     assert list(filter(lambda l: '::' in l, actual)) == [
701.         '.. py:class:: Class(arg)',
702.         '   .. py:attribute:: Class.__dict__',
703.         '   .. py:method:: Class.__init__(arg)',
704.         '   .. py:attribute:: Class.__module__',
705.         '   .. py:method:: Class.__special1__()',
706.         '   .. py:method:: Class.__special2__()',
707.         '   .. py:attribute:: Class.__weakref__',
708.         '   .. py:attribute:: Class.attr',
709.         '   .. py:attribute:: Class.docattr',
710.         '   .. py:method:: Class.excludemeth()',
711.         '   .. py:attribute:: Class.inst_attr_comment',
712.         '   .. py:attribute:: Class.inst_attr_inline',
713.         '   .. py:attribute:: Class.inst_attr_string',
714.         '   .. py:attribute:: Class.mdocattr',
715.         '   .. py:method:: Class.meth()',
716.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
717.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
718.         '   .. py:attribute:: Class.skipattr',
719.         '   .. py:method:: Class.skipmeth()',
720.         '   .. py:attribute:: Class.udocattr',
721.         '   .. py:method:: Class.undocmeth()'
722.     ]
723. 
724. 
725. @pytest.mark.sphinx('html', testroot='ext-autodoc')
726. def test_autodoc_ignore_module_all(app):
727.     # default (no-ignore-module-all)
728.     options = {"members": None}
729.     actual = do_autodoc(app, 'module', 'target', options)
730.     assert list(filter(lambda l: 'class::' in l, actual)) == [
731.         '.. py:class:: Class(arg)',
732.     ]
733. 
734.     # ignore-module-all
735.     options = {"members": None,
736.                "ignore-module-all": None}
737.     actual = do_autodoc(app, 'module', 'target', options)
738.     assert list(filter(lambda l: 'class::' in l, actual)) == [
739.         '.. py:class:: Class(arg)',
740.         '.. py:class:: CustomDict',
741.         '.. py:class:: InnerChild()',
742.         '.. py:class:: InstAttCls()',
743.         '.. py:class:: Outer()',
744.         '   .. py:class:: Outer.Inner()',
745.         '.. py:class:: StrRepr'
746.     ]
747. 
748. 
749. @pytest.mark.sphinx('html', testroot='ext-autodoc')
750. def test_autodoc_noindex(app):
751.     options = {"noindex": True}
752.     actual = do_autodoc(app, 'module', 'target', options)
753.     assert list(actual) == [
754.         '',
755.         '.. py:module:: target',
756.         '   :noindex:',
757.         ''
758.     ]
759. 
760.     # TODO: :noindex: should be propagated to children of target item.
761. 
762.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
763.     assert list(actual) == [
764.         '',
765.         '.. py:class:: Base()',
766.         '   :noindex:',
767.         '   :module: target.inheritance',
768.         ''
769.     ]
770. 
771. 
772. @pytest.mark.sphinx('html', testroot='ext-autodoc')
773. def test_autodoc_subclass_of_builtin_class(app):
774.     options = {"members": None}
775.     actual = do_autodoc(app, 'class', 'target.CustomDict', options)
776.     assert list(actual) == [
777.         '',
778.         '.. py:class:: CustomDict',
779.         '   :module: target',
780.         '',
781.         '   Docstring.',
782.         '',
783.     ]
784. 
785. 
786. @pytest.mark.sphinx('html', testroot='ext-autodoc')
787. def test_autodoc_inner_class(app):
788.     options = {"members": None}
789.     actual = do_autodoc(app, 'class', 'target.Outer', options)
790.     assert list(actual) == [
791.         '',
792.         '.. py:class:: Outer()',
793.         '   :module: target',
794.         '',
795.         '   Foo',
796.         '',
797.         '',
798.         '   .. py:class:: Outer.Inner()',
799.         '      :module: target',
800.         '',
801.         '      Foo',
802.         '',
803.         '',
804.         '      .. py:method:: Outer.Inner.meth()',
805.         '         :module: target',
806.         '',
807.         '         Foo',
808.         '',
809.         '',
810.         '   .. py:attribute:: Outer.factory',
811.         '      :module: target',
812.         '',
813.         '      alias of :class:`builtins.dict`'
814.     ]
815. 
816.     actual = do_autodoc(app, 'class', 'target.Outer.Inner', options)
817.     assert list(actual) == [
818.         '',
819.         '.. py:class:: Inner()',
820.         '   :module: target.Outer',
821.         '',
822.         '   Foo',
823.         '',
824.         '',
825.         '   .. py:method:: Inner.meth()',
826.         '      :module: target.Outer',
827.         '',
828.         '      Foo',
829.         '',
830.     ]
831. 
832.     options['show-inheritance'] = True
833.     actual = do_autodoc(app, 'class', 'target.InnerChild', options)
834.     assert list(actual) == [
835.         '',
836.         '.. py:class:: InnerChild()',
837.         '   :module: target', '',
838.         '   Bases: :class:`target.Outer.Inner`',
839.         '',
840.         '   InnerChild docstring',
841.         '',
842.     ]
843. 
844. 
845. @pytest.mark.sphinx('html', testroot='ext-autodoc')
846. def test_autodoc_classmethod(app):
847.     actual = do_autodoc(app, 'method', 'target.inheritance.Base.inheritedclassmeth')
848.     assert list(actual) == [
849.         '',
850.         '.. py:method:: Base.inheritedclassmeth()',
851.         '   :module: target.inheritance',
852.         '   :classmethod:',
853.         '',
854.         '   Inherited class method.',
855.         '',
856.     ]
857. 
858. 
859. @pytest.mark.sphinx('html', testroot='ext-autodoc')
860. def test_autodoc_staticmethod(app):
861.     actual = do_autodoc(app, 'method', 'target.inheritance.Base.inheritedstaticmeth')
862.     assert list(actual) == [
863.         '',
864.         '.. py:method:: Base.inheritedstaticmeth(cls)',
865.         '   :module: target.inheritance',
866.         '   :staticmethod:',
867.         '',
868.         '   Inherited static method.',
869.         '',
870.     ]
871. 
872. 
873. @pytest.mark.sphinx('html', testroot='ext-autodoc')
874. def test_autodoc_descriptor(app):
875.     options = {"members": None,
876.                "undoc-members": True}
877.     actual = do_autodoc(app, 'class', 'target.descriptor.Class', options)
878.     assert list(actual) == [
879.         '',
880.         '.. py:class:: Class()',
881.         '   :module: target.descriptor',
882.         '',
883.         '',
884.         '   .. py:attribute:: Class.descr',
885.         '      :module: target.descriptor',
886.         '',
887.         '      Descriptor instance docstring.',
888.         '',
889.         '',
890.         '   .. py:method:: Class.prop',
891.         '      :module: target.descriptor',
892.         '      :property:',
893.         '',
894.         '      Property.',
895.         ''
896.     ]
897. 
898. 
899. @pytest.mark.skipif(sys.version_info < (3, 8),
900.                     reason='cached_property is available since python3.8.')
901. @pytest.mark.sphinx('html', testroot='ext-autodoc')
902. def test_autodoc_cached_property(app):
903.     options = {"members": None,
904.                "undoc-members": True}
905.     actual = do_autodoc(app, 'class', 'target.cached_property.Foo', options)
906.     assert list(actual) == [
907.         '',
908.         '.. py:class:: Foo()',
909.         '   :module: target.cached_property',
910.         '',
911.         '',
912.         '   .. py:method:: Foo.prop',
913.         '      :module: target.cached_property',
914.         '      :property:',
915.         '',
916.     ]
917. 
918. 
919. @pytest.mark.sphinx('html', testroot='ext-autodoc')
920. def test_autodoc_member_order(app):
921.     # case member-order='bysource'
922.     options = {"members": None,
923.                'member-order': 'bysource',
924.                "undoc-members": True,
925.                'private-members': True}
926.     actual = do_autodoc(app, 'class', 'target.Class', options)
927.     assert list(filter(lambda l: '::' in l, actual)) == [
928.         '.. py:class:: Class(arg)',
929.         '   .. py:method:: Class.meth()',
930.         '   .. py:method:: Class.undocmeth()',
931.         '   .. py:method:: Class.skipmeth()',
932.         '   .. py:method:: Class.excludemeth()',
933.         '   .. py:attribute:: Class.skipattr',
934.         '   .. py:attribute:: Class.attr',
935.         '   .. py:attribute:: Class.docattr',
936.         '   .. py:attribute:: Class.udocattr',
937.         '   .. py:attribute:: Class.mdocattr',
938.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
939.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
940.         '   .. py:attribute:: Class.inst_attr_inline',
941.         '   .. py:attribute:: Class.inst_attr_comment',
942.         '   .. py:attribute:: Class.inst_attr_string',
943.         '   .. py:attribute:: Class._private_inst_attr'
944.     ]
945. 
946.     # case member-order='groupwise'
947.     options = {"members": None,
948.                'member-order': 'groupwise',
949.                "undoc-members": True,
950.                'private-members': True}
951.     actual = do_autodoc(app, 'class', 'target.Class', options)
952.     assert list(filter(lambda l: '::' in l, actual)) == [
953.         '.. py:class:: Class(arg)',
954.         '   .. py:method:: Class.excludemeth()',
955.         '   .. py:method:: Class.meth()',
956.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
957.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
958.         '   .. py:method:: Class.skipmeth()',
959.         '   .. py:method:: Class.undocmeth()',
960.         '   .. py:attribute:: Class._private_inst_attr',
961.         '   .. py:attribute:: Class.attr',
962.         '   .. py:attribute:: Class.docattr',
963.         '   .. py:attribute:: Class.inst_attr_comment',
964.         '   .. py:attribute:: Class.inst_attr_inline',
965.         '   .. py:attribute:: Class.inst_attr_string',
966.         '   .. py:attribute:: Class.mdocattr',
967.         '   .. py:attribute:: Class.skipattr',
968.         '   .. py:attribute:: Class.udocattr'
969.     ]
970. 
971.     # case member-order=None
972.     options = {"members": None,
973.                "undoc-members": True,
974.                'private-members': True}
975.     actual = do_autodoc(app, 'class', 'target.Class', options)
976.     assert list(filter(lambda l: '::' in l, actual)) == [
977.         '.. py:class:: Class(arg)',
978.         '   .. py:attribute:: Class._private_inst_attr',
979.         '   .. py:attribute:: Class.attr',
980.         '   .. py:attribute:: Class.docattr',
981.         '   .. py:method:: Class.excludemeth()',
982.         '   .. py:attribute:: Class.inst_attr_comment',
983.         '   .. py:attribute:: Class.inst_attr_inline',
984.         '   .. py:attribute:: Class.inst_attr_string',
985.         '   .. py:attribute:: Class.mdocattr',
986.         '   .. py:method:: Class.meth()',
987.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
988.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
989.         '   .. py:attribute:: Class.skipattr',
990.         '   .. py:method:: Class.skipmeth()',
991.         '   .. py:attribute:: Class.udocattr',
992.         '   .. py:method:: Class.undocmeth()'
993.     ]
994. 
995. 
996. @pytest.mark.sphinx('html', testroot='ext-autodoc')
997. def test_autodoc_module_member_order(app):
998.     # case member-order='bysource'
999.     options = {"members": 'foo, Bar, baz, qux, Quux, foobar',
1000.                'member-order': 'bysource',


File: tests/test_ext_autodoc.py
Line number range: 1001 - 1500
Content:
1001.                "undoc-members": True}
1002.     actual = do_autodoc(app, 'module', 'target.sort_by_all', options)
1003.     assert list(filter(lambda l: '::' in l, actual)) == [
1004.         '.. py:module:: target.sort_by_all',
1005.         '.. py:function:: baz()',
1006.         '.. py:function:: foo()',
1007.         '.. py:class:: Bar()',
1008.         '.. py:class:: Quux()',
1009.         '.. py:function:: foobar()',
1010.         '.. py:function:: qux()',
1011.     ]
1012. 
1013.     # case member-order='bysource' and ignore-module-all
1014.     options = {"members": 'foo, Bar, baz, qux, Quux, foobar',
1015.                'member-order': 'bysource',
1016.                "undoc-members": True,
1017.                "ignore-module-all": True}
1018.     actual = do_autodoc(app, 'module', 'target.sort_by_all', options)
1019.     assert list(filter(lambda l: '::' in l, actual)) == [
1020.         '.. py:module:: target.sort_by_all',
1021.         '.. py:function:: foo()',
1022.         '.. py:class:: Bar()',
1023.         '.. py:function:: baz()',
1024.         '.. py:function:: qux()',
1025.         '.. py:class:: Quux()',
1026.         '.. py:function:: foobar()',
1027.     ]
1028. 
1029. 
1030. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1031. def test_autodoc_module_scope(app):
1032.     app.env.temp_data['autodoc:module'] = 'target'
1033.     actual = do_autodoc(app, 'attribute', 'Class.mdocattr')
1034.     assert list(actual) == [
1035.         '',
1036.         '.. py:attribute:: Class.mdocattr',
1037.         '   :module: target',
1038.         '   :value: <_io.StringIO object>',
1039.         '',
1040.         '   should be documented as well - süß',
1041.         '',
1042.     ]
1043. 
1044. 
1045. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1046. def test_autodoc_class_scope(app):
1047.     app.env.temp_data['autodoc:module'] = 'target'
1048.     app.env.temp_data['autodoc:class'] = 'Class'
1049.     actual = do_autodoc(app, 'attribute', 'mdocattr')
1050.     assert list(actual) == [
1051.         '',
1052.         '.. py:attribute:: Class.mdocattr',
1053.         '   :module: target',
1054.         '   :value: <_io.StringIO object>',
1055.         '',
1056.         '   should be documented as well - süß',
1057.         '',
1058.     ]
1059. 
1060. 
1061. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1062. def test_class_attributes(app):
1063.     options = {"members": None,
1064.                "undoc-members": True}
1065.     actual = do_autodoc(app, 'class', 'target.AttCls', options)
1066.     assert list(actual) == [
1067.         '',
1068.         '.. py:class:: AttCls()',
1069.         '   :module: target',
1070.         '',
1071.         '',
1072.         '   .. py:attribute:: AttCls.a1',
1073.         '      :module: target',
1074.         '      :value: hello world',
1075.         '',
1076.         '',
1077.         '   .. py:attribute:: AttCls.a2',
1078.         '      :module: target',
1079.         '      :value: None',
1080.         ''
1081.     ]
1082. 
1083. 
1084. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1085. def test_autoclass_instance_attributes(app):
1086.     options = {"members": None}
1087.     actual = do_autodoc(app, 'class', 'target.InstAttCls', options)
1088.     assert list(actual) == [
1089.         '',
1090.         '.. py:class:: InstAttCls()',
1091.         '   :module: target',
1092.         '',
1093.         '   Class with documented class and instance attributes.',
1094.         '',
1095.         '',
1096.         '   .. py:attribute:: InstAttCls.ca1',
1097.         '      :module: target',
1098.         "      :value: 'a'",
1099.         '',
1100.         '      Doc comment for class attribute InstAttCls.ca1.',
1101.         '      It can have multiple lines.',
1102.         '',
1103.         '',
1104.         '   .. py:attribute:: InstAttCls.ca2',
1105.         '      :module: target',
1106.         "      :value: 'b'",
1107.         '',
1108.         '      Doc comment for InstAttCls.ca2. One line only.',
1109.         '',
1110.         '',
1111.         '   .. py:attribute:: InstAttCls.ca3',
1112.         '      :module: target',
1113.         "      :value: 'c'",
1114.         '',
1115.         '      Docstring for class attribute InstAttCls.ca3.',
1116.         '',
1117.         '',
1118.         '   .. py:attribute:: InstAttCls.ia1',
1119.         '      :module: target',
1120.         '',
1121.         '      Doc comment for instance attribute InstAttCls.ia1',
1122.         '',
1123.         '',
1124.         '   .. py:attribute:: InstAttCls.ia2',
1125.         '      :module: target',
1126.         '',
1127.         '      Docstring for instance attribute InstAttCls.ia2.',
1128.         ''
1129.     ]
1130. 
1131.     # pick up arbitrary attributes
1132.     options = {"members": 'ca1,ia1'}
1133.     actual = do_autodoc(app, 'class', 'target.InstAttCls', options)
1134.     assert list(actual) == [
1135.         '',
1136.         '.. py:class:: InstAttCls()',
1137.         '   :module: target',
1138.         '',
1139.         '   Class with documented class and instance attributes.',
1140.         '',
1141.         '',
1142.         '   .. py:attribute:: InstAttCls.ca1',
1143.         '      :module: target',
1144.         "      :value: 'a'",
1145.         '',
1146.         '      Doc comment for class attribute InstAttCls.ca1.',
1147.         '      It can have multiple lines.',
1148.         '',
1149.         '',
1150.         '   .. py:attribute:: InstAttCls.ia1',
1151.         '      :module: target',
1152.         '',
1153.         '      Doc comment for instance attribute InstAttCls.ia1',
1154.         ''
1155.     ]
1156. 
1157. 
1158. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1159. def test_autoattribute_instance_attributes(app):
1160.     actual = do_autodoc(app, 'attribute', 'target.InstAttCls.ia1')
1161.     assert list(actual) == [
1162.         '',
1163.         '.. py:attribute:: InstAttCls.ia1',
1164.         '   :module: target',
1165.         '',
1166.         '   Doc comment for instance attribute InstAttCls.ia1',
1167.         ''
1168.     ]
1169. 
1170. 
1171. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1172. def test_slots(app):
1173.     options = {"members": None,
1174.                "undoc-members": True}
1175.     actual = do_autodoc(app, 'module', 'target.slots', options)
1176.     assert list(actual) == [
1177.         '',
1178.         '.. py:module:: target.slots',
1179.         '',
1180.         '',
1181.         '.. py:class:: Bar()',
1182.         '   :module: target.slots',
1183.         '',
1184.         '',
1185.         '   .. py:attribute:: Bar.attr1',
1186.         '      :module: target.slots',
1187.         '',
1188.         '      docstring of attr1',
1189.         '',
1190.         '',
1191.         '   .. py:attribute:: Bar.attr2',
1192.         '      :module: target.slots',
1193.         '',
1194.         '      docstring of instance attr2',
1195.         '',
1196.         '',
1197.         '   .. py:attribute:: Bar.attr3',
1198.         '      :module: target.slots',
1199.         '',
1200.         '',
1201.         '.. py:class:: Foo()',
1202.         '   :module: target.slots',
1203.         '',
1204.         '',
1205.         '   .. py:attribute:: Foo.attr',
1206.         '      :module: target.slots',
1207.         '',
1208.     ]
1209. 
1210. 
1211. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1212. def test_enum_class(app):
1213.     options = {"members": None}
1214.     actual = do_autodoc(app, 'class', 'target.enums.EnumCls', options)
1215.     assert list(actual) == [
1216.         '',
1217.         '.. py:class:: EnumCls(value)',
1218.         '   :module: target.enums',
1219.         '',
1220.         '   this is enum class',
1221.         '',
1222.         '',
1223.         '   .. py:method:: EnumCls.say_goodbye()',
1224.         '      :module: target.enums',
1225.         '      :classmethod:',
1226.         '',
1227.         '      a classmethod says good-bye to you.',
1228.         '',
1229.         '',
1230.         '   .. py:method:: EnumCls.say_hello()',
1231.         '      :module: target.enums',
1232.         '',
1233.         '      a method says hello to you.',
1234.         '',
1235.         '',
1236.         '   .. py:attribute:: EnumCls.val1',
1237.         '      :module: target.enums',
1238.         '      :value: 12',
1239.         '',
1240.         '      doc for val1',
1241.         '',
1242.         '',
1243.         '   .. py:attribute:: EnumCls.val2',
1244.         '      :module: target.enums',
1245.         '      :value: 23',
1246.         '',
1247.         '      doc for val2',
1248.         '',
1249.         '',
1250.         '   .. py:attribute:: EnumCls.val3',
1251.         '      :module: target.enums',
1252.         '      :value: 34',
1253.         '',
1254.         '      doc for val3',
1255.         '',
1256.     ]
1257. 
1258.     # checks for an attribute of EnumClass
1259.     actual = do_autodoc(app, 'attribute', 'target.enums.EnumCls.val1')
1260.     assert list(actual) == [
1261.         '',
1262.         '.. py:attribute:: EnumCls.val1',
1263.         '   :module: target.enums',
1264.         '   :value: 12',
1265.         '',
1266.         '   doc for val1',
1267.         ''
1268.     ]
1269. 
1270. 
1271. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1272. def test_descriptor_class(app):
1273.     options = {"members": 'CustomDataDescriptor,CustomDataDescriptor2'}
1274.     actual = do_autodoc(app, 'module', 'target.descriptor', options)
1275.     assert list(actual) == [
1276.         '',
1277.         '.. py:module:: target.descriptor',
1278.         '',
1279.         '',
1280.         '.. py:class:: CustomDataDescriptor(doc)',
1281.         '   :module: target.descriptor',
1282.         '',
1283.         '   Descriptor class docstring.',
1284.         '',
1285.         '',
1286.         '   .. py:method:: CustomDataDescriptor.meth()',
1287.         '      :module: target.descriptor',
1288.         '',
1289.         '      Function.',
1290.         '',
1291.         '',
1292.         '.. py:class:: CustomDataDescriptor2(doc)',
1293.         '   :module: target.descriptor',
1294.         '',
1295.         '   Descriptor class with custom metaclass docstring.',
1296.         '',
1297.     ]
1298. 
1299. 
1300. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1301. def test_automethod_for_builtin(app):
1302.     actual = do_autodoc(app, 'method', 'builtins.int.__add__')
1303.     assert list(actual) == [
1304.         '',
1305.         '.. py:method:: int.__add__(value, /)',
1306.         '   :module: builtins',
1307.         '',
1308.         '   Return self+value.',
1309.         '',
1310.     ]
1311. 
1312. 
1313. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1314. def test_automethod_for_decorated(app):
1315.     actual = do_autodoc(app, 'method', 'target.decorator.Bar.meth')
1316.     assert list(actual) == [
1317.         '',
1318.         '.. py:method:: Bar.meth(name=None, age=None)',
1319.         '   :module: target.decorator',
1320.         '',
1321.     ]
1322. 
1323. 
1324. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1325. def test_abstractmethods(app):
1326.     options = {"members": None,
1327.                "undoc-members": None}
1328.     actual = do_autodoc(app, 'module', 'target.abstractmethods', options)
1329.     assert list(actual) == [
1330.         '',
1331.         '.. py:module:: target.abstractmethods',
1332.         '',
1333.         '',
1334.         '.. py:class:: Base()',
1335.         '   :module: target.abstractmethods',
1336.         '',
1337.         '',
1338.         '   .. py:method:: Base.abstractmeth()',
1339.         '      :module: target.abstractmethods',
1340.         '      :abstractmethod:',
1341.         '',
1342.         '',
1343.         '   .. py:method:: Base.classmeth()',
1344.         '      :module: target.abstractmethods',
1345.         '      :abstractmethod:',
1346.         '      :classmethod:',
1347.         '',
1348.         '',
1349.         '   .. py:method:: Base.coroutinemeth()',
1350.         '      :module: target.abstractmethods',
1351.         '      :abstractmethod:',
1352.         '      :async:',
1353.         '',
1354.         '',
1355.         '   .. py:method:: Base.meth()',
1356.         '      :module: target.abstractmethods',
1357.         '',
1358.         '',
1359.         '   .. py:method:: Base.prop',
1360.         '      :module: target.abstractmethods',
1361.         '      :abstractmethod:',
1362.         '      :property:',
1363.         '',
1364.         '',
1365.         '   .. py:method:: Base.staticmeth()',
1366.         '      :module: target.abstractmethods',
1367.         '      :abstractmethod:',
1368.         '      :staticmethod:',
1369.         '',
1370.     ]
1371. 
1372. 
1373. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1374. def test_partialfunction(app):
1375.     options = {"members": None}
1376.     actual = do_autodoc(app, 'module', 'target.partialfunction', options)
1377.     assert list(actual) == [
1378.         '',
1379.         '.. py:module:: target.partialfunction',
1380.         '',
1381.         '',
1382.         '.. py:function:: func1(a, b, c)',
1383.         '   :module: target.partialfunction',
1384.         '',
1385.         '   docstring of func1',
1386.         '',
1387.         '',
1388.         '.. py:function:: func2(b, c)',
1389.         '   :module: target.partialfunction',
1390.         '',
1391.         '   docstring of func1',
1392.         '',
1393.         '',
1394.         '.. py:function:: func3(c)',
1395.         '   :module: target.partialfunction',
1396.         '',
1397.         '   docstring of func3',
1398.         '',
1399.         '',
1400.         '.. py:function:: func4()',
1401.         '   :module: target.partialfunction',
1402.         '',
1403.         '   docstring of func3',
1404.         '',
1405.     ]
1406. 
1407. 
1408. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1409. def test_imported_partialfunction_should_not_shown_without_imported_members(app):
1410.     options = {"members": None}
1411.     actual = do_autodoc(app, 'module', 'target.imported_members', options)
1412.     assert list(actual) == [
1413.         '',
1414.         '.. py:module:: target.imported_members',
1415.         ''
1416.     ]
1417. 
1418. 
1419. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1420. def test_bound_method(app):
1421.     options = {"members": None}
1422.     actual = do_autodoc(app, 'module', 'target.bound_method', options)
1423.     assert list(actual) == [
1424.         '',
1425.         '.. py:module:: target.bound_method',
1426.         '',
1427.         '',
1428.         '.. py:function:: bound_method()',
1429.         '   :module: target.bound_method',
1430.         '',
1431.         '   Method docstring',
1432.         '',
1433.     ]
1434. 
1435. 
1436. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1437. def test_coroutine(app):
1438.     actual = do_autodoc(app, 'function', 'target.functions.coroutinefunc')
1439.     assert list(actual) == [
1440.         '',
1441.         '.. py:function:: coroutinefunc()',
1442.         '   :module: target.functions',
1443.         '   :async:',
1444.         '',
1445.     ]
1446. 
1447.     options = {"members": None}
1448.     actual = do_autodoc(app, 'class', 'target.coroutine.AsyncClass', options)
1449.     assert list(actual) == [
1450.         '',
1451.         '.. py:class:: AsyncClass()',
1452.         '   :module: target.coroutine',
1453.         '',
1454.         '',
1455.         '   .. py:method:: AsyncClass.do_coroutine()',
1456.         '      :module: target.coroutine',
1457.         '      :async:',
1458.         '',
1459.         '      A documented coroutine function',
1460.         '',
1461.         '',
1462.         '   .. py:method:: AsyncClass.do_coroutine2()',
1463.         '      :module: target.coroutine',
1464.         '      :async:',
1465.         '      :classmethod:',
1466.         '',
1467.         '      A documented coroutine classmethod',
1468.         '',
1469.         '',
1470.         '   .. py:method:: AsyncClass.do_coroutine3()',
1471.         '      :module: target.coroutine',
1472.         '      :async:',
1473.         '      :staticmethod:',
1474.         '',
1475.         '      A documented coroutine staticmethod',
1476.         '',
1477.     ]
1478. 
1479.     # force-synchronized wrapper
1480.     actual = do_autodoc(app, 'function', 'target.coroutine.sync_func')
1481.     assert list(actual) == [
1482.         '',
1483.         '.. py:function:: sync_func()',
1484.         '   :module: target.coroutine',
1485.         '',
1486.     ]
1487. 
1488. 
1489. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1490. def test_partialmethod(app):
1491.     expected = [
1492.         '',
1493.         '.. py:class:: Cell()',
1494.         '   :module: target.partialmethod',
1495.         '',
1496.         '   An example for partialmethod.',
1497.         '',
1498.         '   refs: https://docs.python.jp/3/library/functools.html#functools.partialmethod',
1499.         '',
1500.         '',


File: tests/test_ext_autodoc.py
Line number range: 1501 - 2000
Content:
1501.         '   .. py:method:: Cell.set_alive()',
1502.         '      :module: target.partialmethod',
1503.         '',
1504.         '      Make a cell alive.',
1505.         '',
1506.         '',
1507.         '   .. py:method:: Cell.set_state(state)',
1508.         '      :module: target.partialmethod',
1509.         '',
1510.         '      Update state of cell to *state*.',
1511.         '',
1512.     ]
1513. 
1514.     options = {"members": None}
1515.     actual = do_autodoc(app, 'class', 'target.partialmethod.Cell', options)
1516.     assert list(actual) == expected
1517. 
1518. 
1519. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1520. def test_partialmethod_undoc_members(app):
1521.     expected = [
1522.         '',
1523.         '.. py:class:: Cell()',
1524.         '   :module: target.partialmethod',
1525.         '',
1526.         '   An example for partialmethod.',
1527.         '',
1528.         '   refs: https://docs.python.jp/3/library/functools.html#functools.partialmethod',
1529.         '',
1530.         '',
1531.         '   .. py:method:: Cell.set_alive()',
1532.         '      :module: target.partialmethod',
1533.         '',
1534.         '      Make a cell alive.',
1535.         '',
1536.         '',
1537.         '   .. py:method:: Cell.set_dead()',
1538.         '      :module: target.partialmethod',
1539.         '',
1540.         '',
1541.         '   .. py:method:: Cell.set_state(state)',
1542.         '      :module: target.partialmethod',
1543.         '',
1544.         '      Update state of cell to *state*.',
1545.         '',
1546.     ]
1547. 
1548.     options = {"members": None,
1549.                "undoc-members": None}
1550.     actual = do_autodoc(app, 'class', 'target.partialmethod.Cell', options)
1551.     assert list(actual) == expected
1552. 
1553. 
1554. @pytest.mark.skipif(sys.version_info < (3, 6), reason='py36+ is available since python3.6.')
1555. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1556. def test_autodoc_typed_instance_variables(app):
1557.     options = {"members": None,
1558.                "undoc-members": True}
1559.     actual = do_autodoc(app, 'module', 'target.typed_vars', options)
1560.     assert list(actual) == [
1561.         '',
1562.         '.. py:module:: target.typed_vars',
1563.         '',
1564.         '',
1565.         '.. py:class:: Class()',
1566.         '   :module: target.typed_vars',
1567.         '',
1568.         '',
1569.         '   .. py:attribute:: Class.attr1',
1570.         '      :module: target.typed_vars',
1571.         '      :type: int',
1572.         '      :value: 0',
1573.         '',
1574.         '',
1575.         '   .. py:attribute:: Class.attr2',
1576.         '      :module: target.typed_vars',
1577.         '      :type: int',
1578.         '',
1579.         '',
1580.         '   .. py:attribute:: Class.attr3',
1581.         '      :module: target.typed_vars',
1582.         '      :type: int',
1583.         '      :value: 0',
1584.         '',
1585.         '',
1586.         '   .. py:attribute:: Class.attr4',
1587.         '      :module: target.typed_vars',
1588.         '      :type: int',
1589.         '',
1590.         '      attr4',
1591.         '',
1592.         '',
1593.         '   .. py:attribute:: Class.attr5',
1594.         '      :module: target.typed_vars',
1595.         '      :type: int',
1596.         '',
1597.         '      attr5',
1598.         '',
1599.         '',
1600.         '   .. py:attribute:: Class.attr6',
1601.         '      :module: target.typed_vars',
1602.         '      :type: int',
1603.         '',
1604.         '      attr6',
1605.         '',
1606.         '',
1607.         '   .. py:attribute:: Class.descr4',
1608.         '      :module: target.typed_vars',
1609.         '      :type: int',
1610.         '',
1611.         '      This is descr4',
1612.         '',
1613.         '',
1614.         '.. py:class:: Derived()',
1615.         '   :module: target.typed_vars',
1616.         '',
1617.         '',
1618.         '   .. py:attribute:: Derived.attr7',
1619.         '      :module: target.typed_vars',
1620.         '      :type: int',
1621.         '',
1622.         '',
1623.         '.. py:data:: attr1',
1624.         '   :module: target.typed_vars',
1625.         '   :type: str',
1626.         "   :value: ''",
1627.         '',
1628.         '   attr1',
1629.         '',
1630.         '',
1631.         '.. py:data:: attr2',
1632.         '   :module: target.typed_vars',
1633.         '   :type: str',
1634.         '',
1635.         '   attr2',
1636.         '',
1637.         '',
1638.         '.. py:data:: attr3',
1639.         '   :module: target.typed_vars',
1640.         '   :type: str',
1641.         "   :value: ''",
1642.         '',
1643.         '   attr3',
1644.         '',
1645.     ]
1646. 
1647. 
1648. @pytest.mark.skipif(sys.version_info < (3, 6), reason='py36+ is available since python3.6.')
1649. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1650. def test_autodoc_typed_inherited_instance_variables(app):
1651.     options = {"members": None,
1652.                "undoc-members": True,
1653.                "inherited-members": True}
1654.     actual = do_autodoc(app, 'class', 'target.typed_vars.Derived', options)
1655.     assert list(actual) == [
1656.         '',
1657.         '.. py:class:: Derived()',
1658.         '   :module: target.typed_vars',
1659.         '',
1660.         '',
1661.         '   .. py:attribute:: Derived.attr1',
1662.         '      :module: target.typed_vars',
1663.         '      :type: int',
1664.         '      :value: 0',
1665.         '',
1666.         '',
1667.         '   .. py:attribute:: Derived.attr2',
1668.         '      :module: target.typed_vars',
1669.         '      :type: int',
1670.         '',
1671.         '',
1672.         '   .. py:attribute:: Derived.attr3',
1673.         '      :module: target.typed_vars',
1674.         '      :value: 0',
1675.         '',
1676.         '',
1677.         '   .. py:attribute:: Derived.attr7',
1678.         '      :module: target.typed_vars',
1679.         '      :type: int',
1680.         '',
1681.         '',
1682.         '   .. py:attribute:: Derived.descr4',
1683.         '      :module: target.typed_vars',
1684.         '      :type: int',
1685.         '',
1686.     ]
1687. 
1688. 
1689. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1690. def test_autodoc_GenericAlias(app):
1691.     options = {"members": None,
1692.                "undoc-members": None}
1693.     actual = do_autodoc(app, 'module', 'target.genericalias', options)
1694.     if sys.version_info < (3, 7):
1695.         assert list(actual) == [
1696.             '',
1697.             '.. py:module:: target.genericalias',
1698.             '',
1699.             '',
1700.             '.. py:attribute:: T',
1701.             '   :module: target.genericalias',
1702.             '',
1703.             '   alias of :class:`typing.List`',
1704.         ]
1705.     else:
1706.         assert list(actual) == [
1707.             '',
1708.             '.. py:module:: target.genericalias',
1709.             '',
1710.             '',
1711.             '.. py:data:: T',
1712.             '   :module: target.genericalias',
1713.             '',
1714.             '   A list of int',
1715.             '',
1716.             '   alias of List[int]',
1717.         ]
1718. 
1719. 
1720. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1721. def test_autodoc_TypeVar(app):
1722.     options = {"members": None,
1723.                "undoc-members": None}
1724.     actual = do_autodoc(app, 'module', 'target.typevar', options)
1725.     assert list(actual) == [
1726.         '',
1727.         '.. py:module:: target.typevar',
1728.         '',
1729.         '',
1730.         '.. py:data:: T1',
1731.         '   :module: target.typevar',
1732.         '',
1733.         '   T1',
1734.         '',
1735.         "   alias of TypeVar('T1')",
1736.         '',
1737.         '.. py:data:: T3',
1738.         '   :module: target.typevar',
1739.         '',
1740.         '   T3',
1741.         '',
1742.         "   alias of TypeVar('T3', int, str)",
1743.         '',
1744.         '.. py:data:: T4',
1745.         '   :module: target.typevar',
1746.         '',
1747.         '   T4',
1748.         '',
1749.         "   alias of TypeVar('T4', covariant=True)",
1750.         '',
1751.         '.. py:data:: T5',
1752.         '   :module: target.typevar',
1753.         '',
1754.         '   T5',
1755.         '',
1756.         "   alias of TypeVar('T5', contravariant=True)",
1757.     ]
1758. 
1759. 
1760. @pytest.mark.skipif(sys.version_info < (3, 9), reason='py39+ is required.')
1761. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1762. def test_autodoc_Annotated(app):
1763.     options = {"members": None}
1764.     actual = do_autodoc(app, 'module', 'target.annotated', options)
1765.     assert list(actual) == [
1766.         '',
1767.         '.. py:module:: target.annotated',
1768.         '',
1769.         '',
1770.         '.. py:function:: hello(name: str) -> None',
1771.         '   :module: target.annotated',
1772.         '',
1773.         '   docstring',
1774.         '',
1775.     ]
1776. 
1777. 
1778. @pytest.mark.skipif(sys.version_info < (3, 6), reason='py36+ is required.')
1779. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1780. def test_autodoc_TYPE_CHECKING(app):
1781.     options = {"members": None,
1782.                "undoc-members": None}
1783.     actual = do_autodoc(app, 'module', 'target.TYPE_CHECKING', options)
1784.     assert list(actual) == [
1785.         '',
1786.         '.. py:module:: target.TYPE_CHECKING',
1787.         '',
1788.         '',
1789.         '.. py:class:: Foo()',
1790.         '   :module: target.TYPE_CHECKING',
1791.         '',
1792.         '',
1793.         '   .. py:attribute:: Foo.attr1',
1794.         '      :module: target.TYPE_CHECKING',
1795.         '      :type: StringIO',
1796.         '',
1797.     ]
1798. 
1799. 
1800. @pytest.mark.sphinx('html', testroot='pycode-egg')
1801. def test_autodoc_for_egged_code(app):
1802.     options = {"members": None,
1803.                "undoc-members": None}
1804.     actual = do_autodoc(app, 'module', 'sample', options)
1805.     assert list(actual) == [
1806.         '',
1807.         '.. py:module:: sample',
1808.         '',
1809.         '',
1810.         '.. py:data:: CONSTANT',
1811.         '   :module: sample',
1812.         '   :value: 1',
1813.         '',
1814.         '   constant on sample.py',
1815.         '',
1816.         '',
1817.         '.. py:function:: hello(s)',
1818.         '   :module: sample',
1819.         ''
1820.     ]
1821. 
1822. 
1823. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1824. def test_singledispatch(app):
1825.     options = {"members": None}
1826.     actual = do_autodoc(app, 'module', 'target.singledispatch', options)
1827.     assert list(actual) == [
1828.         '',
1829.         '.. py:module:: target.singledispatch',
1830.         '',
1831.         '',
1832.         '.. py:function:: func(arg, kwarg=None)',
1833.         '                 func(arg: int, kwarg=None)',
1834.         '                 func(arg: str, kwarg=None)',
1835.         '   :module: target.singledispatch',
1836.         '',
1837.         '   A function for general use.',
1838.         '',
1839.     ]
1840. 
1841. 
1842. @pytest.mark.skipif(sys.version_info < (3, 8),
1843.                     reason='singledispatchmethod is available since python3.8')
1844. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1845. def test_singledispatchmethod(app):
1846.     options = {"members": None}
1847.     actual = do_autodoc(app, 'module', 'target.singledispatchmethod', options)
1848.     assert list(actual) == [
1849.         '',
1850.         '.. py:module:: target.singledispatchmethod',
1851.         '',
1852.         '',
1853.         '.. py:class:: Foo()',
1854.         '   :module: target.singledispatchmethod',
1855.         '',
1856.         '   docstring',
1857.         '',
1858.         '',
1859.         '   .. py:method:: Foo.meth(arg, kwarg=None)',
1860.         '                  Foo.meth(arg: int, kwarg=None)',
1861.         '                  Foo.meth(arg: str, kwarg=None)',
1862.         '      :module: target.singledispatchmethod',
1863.         '',
1864.         '      A method for general use.',
1865.         '',
1866.     ]
1867. 
1868. 
1869. @pytest.mark.skipif(sys.version_info < (3, 8),
1870.                     reason='singledispatchmethod is available since python3.8')
1871. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1872. def test_singledispatchmethod_automethod(app):
1873.     options = {}
1874.     actual = do_autodoc(app, 'method', 'target.singledispatchmethod.Foo.meth', options)
1875.     assert list(actual) == [
1876.         '',
1877.         '.. py:method:: Foo.meth(arg, kwarg=None)',
1878.         '               Foo.meth(arg: int, kwarg=None)',
1879.         '               Foo.meth(arg: str, kwarg=None)',
1880.         '   :module: target.singledispatchmethod',
1881.         '',
1882.         '   A method for general use.',
1883.         '',
1884.     ]
1885. 
1886. 
1887. @pytest.mark.skipif(pyximport is None, reason='cython is not installed')
1888. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1889. def test_cython(app):
1890.     options = {"members": None,
1891.                "undoc-members": None}
1892.     actual = do_autodoc(app, 'module', 'target.cython', options)
1893.     assert list(actual) == [
1894.         '',
1895.         '.. py:module:: target.cython',
1896.         '',
1897.         '',
1898.         '.. py:class:: Class()',
1899.         '   :module: target.cython',
1900.         '',
1901.         '   Docstring.',
1902.         '',
1903.         '',
1904.         '   .. py:method:: Class.meth(name: str, age: int = 0) -> None',
1905.         '      :module: target.cython',
1906.         '',
1907.         '      Docstring.',
1908.         '',
1909.         '',
1910.         '.. py:function:: foo(x: int, *args, y: str, **kwargs)',
1911.         '   :module: target.cython',
1912.         '',
1913.         '   Docstring.',
1914.         '',
1915.     ]
1916. 
1917. 
1918. @pytest.mark.skipif(sys.version_info < (3, 8),
1919.                     reason='typing.final is available since python3.8')
1920. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1921. def test_final(app):
1922.     options = {"members": None}
1923.     actual = do_autodoc(app, 'module', 'target.final', options)
1924.     assert list(actual) == [
1925.         '',
1926.         '.. py:module:: target.final',
1927.         '',
1928.         '',
1929.         '.. py:class:: Class()',
1930.         '   :module: target.final',
1931.         '   :final:',
1932.         '',
1933.         '   docstring',
1934.         '',
1935.         '',
1936.         '   .. py:method:: Class.meth1()',
1937.         '      :module: target.final',
1938.         '      :final:',
1939.         '',
1940.         '      docstring',
1941.         '',
1942.         '',
1943.         '   .. py:method:: Class.meth2()',
1944.         '      :module: target.final',
1945.         '',
1946.         '      docstring',
1947.         '',
1948.     ]
1949. 
1950. 
1951. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1952. def test_overload(app):
1953.     options = {"members": None}
1954.     actual = do_autodoc(app, 'module', 'target.overload', options)
1955.     assert list(actual) == [
1956.         '',
1957.         '.. py:module:: target.overload',
1958.         '',
1959.         '',
1960.         '.. py:class:: Bar(x: int, y: int)',
1961.         '              Bar(x: str, y: str)',
1962.         '   :module: target.overload',
1963.         '',
1964.         '   docstring',
1965.         '',
1966.         '',
1967.         '.. py:class:: Baz(x: int, y: int)',
1968.         '              Baz(x: str, y: str)',
1969.         '   :module: target.overload',
1970.         '',
1971.         '   docstring',
1972.         '',
1973.         '',
1974.         '.. py:class:: Foo(x: int, y: int)',
1975.         '              Foo(x: str, y: str)',
1976.         '   :module: target.overload',
1977.         '',
1978.         '   docstring',
1979.         '',
1980.         '',
1981.         '.. py:class:: Math()',
1982.         '   :module: target.overload',
1983.         '',
1984.         '   docstring',
1985.         '',
1986.         '',
1987.         '   .. py:method:: Math.sum(x: int, y: int) -> int',
1988.         '                  Math.sum(x: float, y: float) -> float',
1989.         '                  Math.sum(x: str, y: str) -> str',
1990.         '      :module: target.overload',
1991.         '',
1992.         '      docstring',
1993.         '',
1994.         '',
1995.         '.. py:function:: sum(x: int, y: int) -> int',
1996.         '                 sum(x: float, y: float) -> float',
1997.         '                 sum(x: str, y: str) -> str',
1998.         '   :module: target.overload',
1999.         '',
2000.         '   docstring',


File: tests/test_ext_autodoc.py
Line number range: 2001 - 2500
Content:
2001.         '',
2002.     ]
2003. 
2004. 
2005. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2006. def test_pymodule_for_ModuleLevelDocumenter(app):
2007.     app.env.ref_context['py:module'] = 'target.classes'
2008.     actual = do_autodoc(app, 'class', 'Foo')
2009.     assert list(actual) == [
2010.         '',
2011.         '.. py:class:: Foo()',
2012.         '   :module: target.classes',
2013.         '',
2014.     ]
2015. 
2016. 
2017. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2018. def test_pymodule_for_ClassLevelDocumenter(app):
2019.     app.env.ref_context['py:module'] = 'target.methods'
2020.     actual = do_autodoc(app, 'method', 'Base.meth')
2021.     assert list(actual) == [
2022.         '',
2023.         '.. py:method:: Base.meth()',
2024.         '   :module: target.methods',
2025.         '',
2026.     ]
2027. 
2028. 
2029. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2030. def test_pyclass_for_ClassLevelDocumenter(app):
2031.     app.env.ref_context['py:module'] = 'target.methods'
2032.     app.env.ref_context['py:class'] = 'Base'
2033.     actual = do_autodoc(app, 'method', 'meth')
2034.     assert list(actual) == [
2035.         '',
2036.         '.. py:method:: Base.meth()',
2037.         '   :module: target.methods',
2038.         '',
2039.     ]
2040. 
2041. 
2042. @pytest.mark.sphinx('dummy', testroot='ext-autodoc')
2043. def test_autodoc(app, status, warning):
2044.     app.builder.build_all()
2045. 
2046.     content = app.env.get_doctree('index')
2047.     assert isinstance(content[3], addnodes.desc)
2048.     assert content[3][0].astext() == 'autodoc_dummy_module.test()'
2049.     assert content[3][1].astext() == 'Dummy function using dummy.*'
2050. 
2051.     # issue sphinx-doc/sphinx#2437
2052.     assert content[11][-1].astext() == """Dummy class Bar with alias.
2053. 
2054. 
2055. 
2056. my_name
2057. 
2058. alias of bug2437.autodoc_dummy_foo.Foo"""
2059.     assert warning.getvalue() == ''
2060. 
2061. 
2062. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2063. def test_name_conflict(app):
2064.     actual = do_autodoc(app, 'class', 'target.name_conflict.foo')
2065.     assert list(actual) == [
2066.         '',
2067.         '.. py:class:: foo()',
2068.         '   :module: target.name_conflict',
2069.         '',
2070.         '   docstring of target.name_conflict::foo.',
2071.         '',
2072.     ]
2073. 
2074.     actual = do_autodoc(app, 'class', 'target.name_conflict.foo.bar')
2075.     assert list(actual) == [
2076.         '',
2077.         '.. py:class:: bar()',
2078.         '   :module: target.name_conflict.foo',
2079.         '',
2080.         '   docstring of target.name_conflict.foo::bar.',
2081.         '',
2082.     ]
2083. 
2084. 
2085. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2086. def test_name_mangling(app):
2087.     options = {"members": None,
2088.                "undoc-members": None,
2089.                "private-members": None}
2090.     actual = do_autodoc(app, 'module', 'target.name_mangling', options)
2091.     assert list(actual) == [
2092.         '',
2093.         '.. py:module:: target.name_mangling',
2094.         '',
2095.         '',
2096.         '.. py:class:: Bar()',
2097.         '   :module: target.name_mangling',
2098.         '',
2099.         '',
2100.         '   .. py:attribute:: Bar._Baz__email',
2101.         '      :module: target.name_mangling',
2102.         '      :value: None',
2103.         '',
2104.         '      a member having mangled-like name',
2105.         '',
2106.         '',
2107.         '   .. py:attribute:: Bar.__address',
2108.         '      :module: target.name_mangling',
2109.         '      :value: None',
2110.         '',
2111.         '',
2112.         '.. py:class:: Foo()',
2113.         '   :module: target.name_mangling',
2114.         '',
2115.         '',
2116.         '   .. py:attribute:: Foo.__age',
2117.         '      :module: target.name_mangling',
2118.         '      :value: None',
2119.         '',
2120.         '',
2121.         '   .. py:attribute:: Foo.__name',
2122.         '      :module: target.name_mangling',
2123.         '      :value: None',
2124.         '',
2125.         '      name of Foo',
2126.         '',
2127.     ]

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-23 12:34:41,822 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="The user has requested the full content of the file 'tests/test_ext_autodoc.py'. This context block encompasses the entire file, fulfilling the user's request.", relative_path='tests/test_ext_autodoc.py', start_line=1, end_line=2127)]
2025-12-23 12:34:41,825 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of tests/test_ext_autodoc.py.
2025-12-23 12:34:41,825 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-23 12:34:41,825 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-23 12:34:41,826 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 1 existing contexts
2025-12-23 12:34:41,826 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 2 total contexts (removed 0 duplicates)
2025-12-23 12:34:41,827 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sphinx
├── .circleci
|   └── config.yml
├── .codecov.yml
├── .github
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.md
|   |   ├── config.yml
|   |   └── feature_request.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   └── workflows
|       ├── builddoc.yml
|       ├── lint.yml
|       └── main.yml
├── .travis.yml
├── CONTRIBUTING.rst
├── README.rst
├── bindep.txt
├── doc
|   ├── _static
|   |   ├── conf.py.txt
|   |   └── themes
|   |       └── fullsize
|   ├── _templates
|   |   ├── index.html
|   |   └── indexsidebar.html
|   ├── _themes
|   |   └── sphinx13
|   |       ├── layout.html
|   |       └── static
|   |           └── sphinx13.css
|   ├── changes.rst
|   ├── conf.py
|   ├── contents.rst
|   ├── develop.rst
|   ├── development
|   |   ├── builders.rst
|   |   ├── index.rst
|   |   ├── overview.rst
|   |   ├── theming.rst
|   |   └── tutorials
|   |       ├── examples
|   |       |   ├── README.rst
|   |       |   ├── helloworld.py
|   |       |   ├── recipe.py
|   |       |   └── todo.py
|   |       ├── helloworld.rst
|   |       ├── index.rst
|   |       ├── recipe.rst
|   |       └── todo.rst
|   ├── examples.rst
|   ├── extdev
|   |   ├── appapi.rst
|   |   ├── builderapi.rst
|   |   ├── collectorapi.rst
|   |   ├── deprecated.rst
|   |   ├── domainapi.rst
|   |   ├── envapi.rst
|   |   ├── i18n.rst
|   |   ├── index.rst
|   |   ├── logging.rst
|   |   ├── markupapi.rst
|   |   ├── nodes.rst
|   |   ├── parserapi.rst
|   |   ├── projectapi.rst
|   |   └── utils.rst
|   ├── faq.rst
|   ├── glossary.rst
|   ├── internals
|   |   ├── authors.rst
|   |   ├── code-of-conduct.rst
|   |   ├── contributing.rst
|   |   ├── index.rst
|   |   ├── organization.rst
|   |   └── release-process.rst
|   ├── latex.rst
|   ├── man
|   |   ├── index.rst
|   |   ├── sphinx-apidoc.rst
|   |   ├── sphinx-autogen.rst
|   |   ├── sphinx-build.rst
|   |   └── sphinx-quickstart.rst
|   ├── templating.rst
|   └── usage
|       ├── advanced
|       |   ├── intl.rst
|       |   ├── setuptools.rst
|       |   └── websupport
|       |       ├── api.rst
|       |       ├── index.rst
|       |       ├── quickstart.rst
|       |       ├── searchadapters.rst
|       |       └── storagebackends.rst
|       ├── builders
|       |   └── index.rst
|       ├── configuration.rst
|       ├── extensions
|       |   ├── autodoc.rst
|       |   ├── autosectionlabel.rst
|       |   ├── autosummary.rst
|       |   ├── coverage.rst
|       |   ├── doctest.rst
|       |   ├── duration.rst
|       |   ├── example_google.py
|       |   ├── example_google.rst
|       |   ├── example_numpy.py
|       |   ├── example_numpy.rst
|       |   ├── extlinks.rst
|       |   ├── githubpages.rst
|       |   ├── graphviz.rst
|       |   ├── ifconfig.rst
|       |   ├── imgconverter.rst
|       |   ├── index.rst
|       |   ├── inheritance.rst
|       |   ├── intersphinx.rst
|       |   ├── linkcode.rst
|       |   ├── math.rst
|       |   ├── napoleon.rst
|       |   ├── todo.rst
|       |   └── viewcode.rst
|       ├── index.rst
|       ├── installation.rst
|       ├── markdown.rst
|       ├── quickstart.rst
|       ├── restructuredtext
|       |   ├── basics.rst
|       |   ├── directives.rst
|       |   ├── domains.rst
|       |   ├── field-lists.rst
|       |   ├── index.rst
|       |   └── roles.rst
|       └── theming.rst
├── karma.conf.js
├── setup.py
├── sphinx
|   ├── __init__.py
|   ├── __main__.py
|   ├── addnodes.py
|   ├── application.py
|   ├── builders
|   |   ├── __init__.py
|   |   ├── _epub_base.py
|   |   ├── applehelp.py
|   |   ├── changes.py
|   |   ├── devhelp.py
|   |   ├── dirhtml.py
|   |   ├── dummy.py
|   |   ├── epub3.py
|   |   ├── gettext.py
|   |   ├── html
|   |   |   ├── __init__.py
|   |   |   └── transforms.py
|   |   ├── htmlhelp.py
|   |   ├── latex
|   |   |   ├── __init__.py
|   |   |   ├── constants.py
|   |   |   ├── nodes.py
|   |   |   ├── theming.py
|   |   |   ├── transforms.py
|   |   |   └── util.py
|   |   ├── linkcheck.py
|   |   ├── manpage.py
|   |   ├── qthelp.py
|   |   ├── singlehtml.py
|   |   ├── texinfo.py
|   |   ├── text.py
|   |   └── xml.py
|   ├── cmd
|   |   ├── __init__.py
|   |   ├── build.py
|   |   ├── make_mode.py
|   |   └── quickstart.py
|   ├── config.py
|   ├── deprecation.py
|   ├── directives
|   |   ├── __init__.py
|   |   ├── code.py
|   |   ├── other.py
|   |   └── patches.py
|   ├── domains
|   |   ├── __init__.py
|   |   ├── c.py
|   |   ├── changeset.py
|   |   ├── citation.py
|   |   ├── cpp.py
|   |   ├── index.py
|   |   ├── javascript.py
|   |   ├── math.py
|   |   ├── python.py
|   |   ├── rst.py
|   |   └── std.py
|   ├── environment
|   |   ├── __init__.py
|   |   ├── adapters
|   |   |   ├── __init__.py
|   |   |   ├── asset.py
|   |   |   ├── indexentries.py
|   |   |   └── toctree.py
|   |   └── collectors
|   |       ├── __init__.py
|   |       ├── asset.py
|   |       ├── dependencies.py
|   |       ├── indexentries.py
|   |       ├── metadata.py
|   |       ├── title.py
|   |       └── toctree.py
|   ├── errors.py
|   ├── events.py
|   ├── ext
|   |   ├── __init__.py
|   |   ├── apidoc.py
|   |   ├── autodoc
|   |   |   ├── __init__.py
|   |   |   ├── directive.py
|   |   |   ├── importer.py
|   |   |   ├── mock.py
|   |   |   ├── type_comment.py
|   |   |   └── typehints.py
|   |   ├── autosectionlabel.py
|   |   ├── autosummary
|   |   |   ├── __init__.py
|   |   |   ├── generate.py
|   |   |   └── templates
|   |   |       └── autosummary
|   |   ├── coverage.py
|   |   ├── doctest.py
|   |   ├── duration.py
|   |   ├── extlinks.py
|   |   ├── githubpages.py
|   |   ├── graphviz.py
|   |   ├── ifconfig.py
|   |   ├── imgconverter.py
|   |   ├── imgmath.py
|   |   ├── inheritance_diagram.py
|   |   ├── intersphinx.py
|   |   ├── jsmath.py
|   |   ├── linkcode.py
|   |   ├── mathjax.py
|   |   ├── napoleon
|   |   |   ├── __init__.py
|   |   |   ├── docstring.py
|   |   |   └── iterators.py
|   |   ├── todo.py
|   |   └── viewcode.py
|   ├── extension.py
|   ├── highlighting.py
|   ├── io.py
|   ├── jinja2glue.py
|   ├── locale
|   |   ├── __init__.py
|   |   ├── ar
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bg
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bn
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ca
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cak
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cs
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cy
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── da
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── de
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── el
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eo
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── es
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── et
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fa
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── he
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi_IN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── id
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── it
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ja
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ko
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── mk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nb_NO
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ne
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_BR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_PT
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ro
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ru
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── si
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sq
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr@latin
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr_RS
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ta
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── te
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── tr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── uk_UA
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ur
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── vi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_CN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   └── zh_TW
|   |       └── LC_MESSAGES
|   |           └── sphinx.js
|   ├── parsers.py
|   ├── project.py
|   ├── pycode
|   |   ├── __init__.py
|   |   ├── ast.py
|   |   └── parser.py
|   ├── pygments_styles.py
|   ├── registry.py
|   ├── roles.py
|   ├── search
|   |   ├── __init__.py
|   |   ├── da.py
|   |   ├── de.py
|   |   ├── en.py
|   |   ├── es.py
|   |   ├── fi.py
|   |   ├── fr.py
|   |   ├── hu.py
|   |   ├── it.py
|   |   ├── ja.py
|   |   ├── jssplitter.py
|   |   ├── nl.py
|   |   ├── no.py
|   |   ├── non-minified-js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── pt.py
|   |   ├── ro.py
|   |   ├── ru.py
|   |   ├── sv.py
|   |   ├── tr.py
|   |   └── zh.py
|   ├── setup_command.py
|   ├── templates
|   |   ├── apidoc
|   |   ├── epub3
|   |   |   └── container.xml
|   |   ├── gettext
|   |   ├── graphviz
|   |   |   └── graphviz.css
|   |   ├── htmlhelp
|   |   ├── imgmath
|   |   ├── latex
|   |   ├── quickstart
|   |   └── texinfo
|   ├── testing
|   |   ├── __init__.py
|   |   ├── comparer.py
|   |   ├── fixtures.py
|   |   ├── path.py
|   |   ├── restructuredtext.py
|   |   └── util.py
|   ├── texinputs
|   ├── texinputs_win
|   ├── themes
|   |   ├── agogo
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── basic
|   |   |   ├── changes
|   |   |   |   ├── frameset.html
|   |   |   |   ├── rstsource.html
|   |   |   |   └── versionchanges.html
|   |   |   ├── defindex.html
|   |   |   ├── domainindex.html
|   |   |   ├── genindex-single.html
|   |   |   ├── genindex-split.html
|   |   |   ├── genindex.html
|   |   |   ├── globaltoc.html
|   |   |   ├── layout.html
|   |   |   ├── localtoc.html
|   |   |   ├── opensearch.xml
|   |   |   ├── page.html
|   |   |   ├── relations.html
|   |   |   ├── search.html
|   |   |   ├── searchbox.html
|   |   |   ├── sourcelink.html
|   |   |   └── static
|   |   |       ├── doctools.js
|   |   |       ├── jquery-3.5.1.js
|   |   |       ├── jquery.js
|   |   |       ├── searchtools.js
|   |   |       ├── underscore-1.3.1.js
|   |   |       └── underscore.js
|   |   ├── bizstyle
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── css3-mediaqueries.js
|   |   |       └── css3-mediaqueries_src.js
|   |   ├── classic
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── default
|   |   |   └── static
|   |   |       └── default.css
|   |   ├── epub
|   |   |   ├── epub-cover.html
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── haiku
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── nature
|   |   |   └── static
|   |   ├── nonav
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       └── nonav.css
|   |   ├── pyramid
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── epub.css
|   |   |       └── ie6.css
|   |   ├── scrolls
|   |   |   ├── artwork
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── print.css
|   |   |       └── theme_extras.js
|   |   ├── sphinxdoc
|   |   |   └── static
|   |   └── traditional
|   |       └── static
|   ├── theming.py
|   ├── transforms
|   |   ├── __init__.py
|   |   ├── compact_bullet_list.py
|   |   ├── i18n.py
|   |   ├── post_transforms
|   |   |   ├── __init__.py
|   |   |   ├── code.py
|   |   |   └── images.py
|   |   └── references.py
|   ├── util
|   |   ├── __init__.py
|   |   ├── build_phase.py
|   |   ├── cfamily.py
|   |   ├── compat.py
|   |   ├── console.py
|   |   ├── docfields.py
|   |   ├── docstrings.py
|   |   ├── docutils.py
|   |   ├── fileutil.py
|   |   ├── i18n.py
|   |   ├── images.py
|   |   ├── inspect.py
|   |   ├── inventory.py
|   |   ├── jsdump.py
|   |   ├── jsonimpl.py
|   |   ├── logging.py
|   |   ├── matching.py
|   |   ├── math.py
|   |   ├── nodes.py
|   |   ├── osutil.py
|   |   ├── parallel.py
|   |   ├── png.py
|   |   ├── pycompat.py
|   |   ├── requests.py
|   |   ├── rst.py
|   |   ├── smartypants.py
|   |   ├── stemmer
|   |   |   ├── __init__.py
|   |   |   └── porter.py
|   |   ├── tags.py
|   |   ├── template.py
|   |   ├── texescape.py
|   |   └── typing.py
|   ├── versioning.py
|   └── writers
|       ├── __init__.py
|       ├── html.py
|       ├── html5.py
|       ├── latex.py
|       ├── manpage.py
|       ├── texinfo.py
|       ├── text.py
|       └── xml.py
├── tests
|   ├── conftest.py
|   ├── js
|   |   └── doctools.js
|   ├── roots
|   |   ├── test-add_enumerable_node
|   |   |   ├── conf.py
|   |   |   ├── enumerable_node.py
|   |   |   └── index.rst
|   |   ├── test-add_source_parser
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-add_source_parser-conflicts-with-users-setting
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-api-set-translator
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nonext
|   |   |   |   └── conf.py
|   |   |   └── translator.py
|   |   ├── test-apidoc-pep420
|   |   |   └── a
|   |   |       └── b
|   |   ├── test-apidoc-subpackage-in-toc
|   |   |   └── parent
|   |   |       ├── __init__.py
|   |   |       └── child
|   |   ├── test-apidoc-toc
|   |   |   └── mypackage
|   |   |       ├── __init__.py
|   |   |       ├── main.py
|   |   |       ├── no_init
|   |   |       ├── resource
|   |   |       └── something
|   |   ├── test-apidoc-trailing-underscore
|   |   |   └── package_
|   |   |       ├── __init__.py
|   |   |       └── module_.py
|   |   ├── test-autosummary
|   |   |   ├── conf.py
|   |   |   ├── dummy_module.py
|   |   |   ├── index.rst
|   |   |   ├── sphinx.rst
|   |   |   └── underscore_module_.py
|   |   ├── test-basic
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-html-translator
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-text
|   |   |   ├── conf.py
|   |   |   ├── doc1.txt
|   |   |   ├── doc2.txt
|   |   |   ├── index.txt
|   |   |   ├── lineblock.txt
|   |   |   ├── listitems.txt
|   |   |   ├── maxwidth.txt
|   |   |   ├── nonascii_maxwidth.txt
|   |   |   ├── nonascii_table.txt
|   |   |   ├── nonascii_title.txt
|   |   |   ├── table.txt
|   |   |   ├── table_colspan.txt
|   |   |   ├── table_colspan_and_rowspan.txt
|   |   |   ├── table_colspan_left.txt
|   |   |   └── table_rowspan.txt
|   |   ├── test-builder-dirhtml
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo
|   |   |   |   ├── foo_1.rst
|   |   |   |   ├── foo_2.rst
|   |   |   |   └── index.rst
|   |   |   └── index.rst
|   |   ├── test-builder-gettext-dont-rebuild-mo
|   |   |   ├── bom.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-changes
|   |   |   ├── base.rst
|   |   |   ├── c-api.rst
|   |   |   ├── conf.py
|   |   |   ├── contents.rst
|   |   |   └── library
|   |   |       └── utils.rst
|   |   ├── test-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-config
|   |   |   └── conf.py
|   |   ├── test-correct-year
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-default_role
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-directive-code
|   |   |   ├── caption.rst
|   |   |   ├── classes.rst
|   |   |   ├── conf.py
|   |   |   ├── emphasize.rst
|   |   |   ├── force.rst
|   |   |   ├── highlight.rst
|   |   |   ├── index.rst
|   |   |   ├── linenos.rst
|   |   |   ├── linenothreshold.rst
|   |   |   ├── namedblocks.rst
|   |   |   ├── py-decorators.rst
|   |   |   ├── python.rst
|   |   |   └── target.py
|   |   ├── test-directive-only
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── only.rst
|   |   ├── test-directives-raw
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-docutilsconf
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-c
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── namespace.rst
|   |   |   └── semicolon.rst
|   |   ├── test-domain-cpp
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── any-role.rst
|   |   |   ├── backslash.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── lookup-key-overload.rst
|   |   |   ├── multi-decl-lookup.rst
|   |   |   ├── roles-targets-ok.rst
|   |   |   ├── roles-targets-warn.rst
|   |   |   ├── roles.rst
|   |   |   ├── roles2.rst
|   |   |   ├── semicolon.rst
|   |   |   ├── warn-template-param-qualified-name.rst
|   |   |   └── xref_consistency.rst
|   |   ├── test-domain-js
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   ├── module_option.rst
|   |   |   └── roles.rst
|   |   ├── test-double-inheriting-theme
|   |   |   ├── base_themes_dir
|   |   |   |   ├── base_theme1
|   |   |   |   └── base_theme2
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-epub-anchor-id
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autodoc
|   |   |   ├── autodoc_dummy_bar.py
|   |   |   ├── autodoc_dummy_module.py
|   |   |   ├── bug2437
|   |   |   |   ├── __init__.py
|   |   |   |   └── autodoc_dummy_foo.py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target
|   |   |       ├── TYPE_CHECKING.py
|   |   |       ├── __init__.py
|   |   |       ├── abstractmethods.py
|   |   |       ├── annotated.py
|   |   |       ├── annotations.py
|   |   |       ├── autoclass_content.py
|   |   |       ├── bound_method.py
|   |   |       ├── cached_property.py
|   |   |       ├── callable.py
|   |   |       ├── classes.py
|   |   |       ├── coroutine.py
|   |   |       ├── decorator.py
|   |   |       ├── descriptor.py
|   |   |       ├── docstring_signature.py
|   |   |       ├── enums.py
|   |   |       ├── final.py
|   |   |       ├── functions.py
|   |   |       ├── generic_class.py
|   |   |       ├── genericalias.py
|   |   |       ├── imported_members.py
|   |   |       ├── inheritance.py
|   |   |       ├── methods.py
|   |   |       ├── name_conflict
|   |   |       ├── name_mangling.py
|   |   |       ├── need_mocks.py
|   |   |       ├── overload.py
|   |   |       ├── partialfunction.py
|   |   |       ├── partialmethod.py
|   |   |       ├── pep570.py
|   |   |       ├── private.py
|   |   |       ├── process_docstring.py
|   |   |       ├── singledispatch.py
|   |   |       ├── singledispatchmethod.py
|   |   |       ├── slots.py
|   |   |       ├── sort_by_all.py
|   |   |       ├── typed_vars.py
|   |   |       ├── typehints.py
|   |   |       ├── typevar.py
|   |   |       └── wrappedfunction.py
|   |   ├── test-ext-autosectionlabel
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosectionlabel-prefix-document
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── autosummary_importfail.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-filename-map
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-imported_members
|   |   |   ├── autosummary_dummy_package
|   |   |   |   ├── __init__.py
|   |   |   |   └── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-mock_imports
|   |   |   ├── conf.py
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-recursive
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── package
|   |   |   |   ├── __init__.py
|   |   |   |   ├── module.py
|   |   |   |   ├── module_importfail.py
|   |   |   |   └── package
|   |   |   └── package2
|   |   |       ├── __init__.py
|   |   |       └── module.py
|   |   ├── test-ext-autosummary-skip-member
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-autosummary-template
|   |   |   ├── _templates
|   |   |   |   └── empty.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-coverage
|   |   |   ├── conf.py
|   |   |   ├── coverage_ignored.py
|   |   |   ├── coverage_not_ignored.py
|   |   |   └── index.rst
|   |   ├── test-ext-doctest
|   |   |   ├── conf.py
|   |   |   └── doctest.txt
|   |   ├── test-ext-doctest-skipif
|   |   |   ├── conf.py
|   |   |   └── skipif.txt
|   |   ├── test-ext-doctest-with-autodoc
|   |   |   ├── conf.py
|   |   |   ├── dir
|   |   |   |   ├── __init__.py
|   |   |   |   ├── bar.py
|   |   |   |   └── inner.rst
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-githubpages
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-graphviz
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-ifconfig
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-imgconverter
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-inheritance_diagram
|   |   |   ├── conf.py
|   |   |   ├── example
|   |   |   |   ├── __init__.py
|   |   |   |   └── sphinx.py
|   |   |   ├── index.rst
|   |   |   └── test.py
|   |   ├── test-ext-intersphinx-cppdomain
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── math.rst
|   |   |   └── page.rst
|   |   ├── test-ext-math-compat
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math-simple
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-todo
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-ext-viewcode
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── objects.rst
|   |   |   └── spam
|   |   |       ├── __init__.py
|   |   |       ├── mod1.py
|   |   |       ├── mod2.py
|   |   |       └── mod3.py
|   |   ├── test-ext-viewcode-find
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── not_a_package
|   |   |       ├── __init__.py
|   |   |       └── submodule.py
|   |   ├── test-extensions
|   |   |   ├── conf.py
|   |   |   ├── read_parallel.py
|   |   |   ├── read_serial.py
|   |   |   ├── write_parallel.py
|   |   |   └── write_serial.py
|   |   ├── test-footnotes
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-gettext-template
|   |   |   ├── _templates
|   |   |   |   ├── template1.html
|   |   |   |   └── template2.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-glossary
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_assets
|   |   |   ├── conf.py
|   |   |   ├── extra
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   └── subdir
|   |   |   ├── index.rst
|   |   |   ├── static
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   ├── js
|   |   |   |   └── subdir
|   |   |   └── subdir
|   |   |       └── _build
|   |   ├── test-html_entity
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_scaled_image_link
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_style
|   |   |   ├── _static
|   |   |   |   └── default.css
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-parsed-literal
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-section
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-images
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── subdir
|   |   |       └── index.rst
|   |   ├── test-index_on_title
|   |   |   ├── conf.py
|   |   |   └── contents.rst
|   |   ├── test-inheritance
|   |   |   ├── basic_diagram.rst
|   |   |   ├── conf.py
|   |   |   ├── diagram_module_w_2_top_classes.rst
|   |   |   ├── diagram_w_1_top_class.rst
|   |   |   ├── diagram_w_2_top_classes.rst
|   |   |   ├── diagram_w_nested_classes.rst
|   |   |   ├── diagram_w_parts.rst
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── test.py
|   |   |   |   └── test_nested.py
|   |   |   └── index.rst
|   |   ├── test-intl
|   |   |   ├── _templates
|   |   |   |   └── contents.html
|   |   |   ├── admonitions.txt
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── definition_terms.txt
|   |   |   ├── docfields.txt
|   |   |   ├── external_links.txt
|   |   |   ├── figure.txt
|   |   |   ├── footnote.txt
|   |   |   ├── glossary_terms.txt
|   |   |   ├── glossary_terms_inconsistency.txt
|   |   |   ├── index.txt
|   |   |   ├── index_entries.txt
|   |   |   ├── label_target.txt
|   |   |   ├── literalblock.txt
|   |   |   ├── only.txt
|   |   |   ├── raw.txt
|   |   |   ├── refs.txt
|   |   |   ├── refs_inconsistency.txt
|   |   |   ├── refs_python_domain.txt
|   |   |   ├── role_xref.txt
|   |   |   ├── rubric.txt
|   |   |   ├── section.txt
|   |   |   ├── seealso.txt
|   |   |   ├── subdir
|   |   |   |   └── index.txt
|   |   |   ├── table.txt
|   |   |   ├── toctree.txt
|   |   |   ├── topic.txt
|   |   |   ├── versionchange.txt
|   |   |   ├── warnings.txt
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-keep_warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-babel
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-latex-equations
|   |   |   ├── conf.py
|   |   |   ├── equations.rst
|   |   |   └── expects
|   |   ├── test-latex-figure-in-admonition
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-includegraphics
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-index
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-labels
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── otherdoc.rst
|   |   ├── test-latex-numfig
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── indexhowto.rst
|   |   |   └── indexmanual.rst
|   |   ├── test-latex-table
|   |   |   ├── _mytemplates
|   |   |   |   └── latex
|   |   |   ├── complex.rst
|   |   |   ├── conf.py
|   |   |   ├── expects
|   |   |   ├── index.rst
|   |   |   ├── longtable.rst
|   |   |   └── tabular.rst
|   |   ├── test-latex-theme
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── theme
|   |   |       └── custom
|   |   ├── test-latex-title
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-unicode
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck
|   |   |   ├── conf.py
|   |   |   └── links.txt
|   |   ├── test-linkcheck-localserver
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-locale
|   |   |   ├── locale1
|   |   |   |   └── en
|   |   |   └── locale2
|   |   |       └── en
|   |   ├── test-manpage_url
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-citation
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-rubric
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-maxlistdepth
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-metadata
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-need-escaped
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux.rst
|   |   ├── test-nested-enumerated-list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nested-tables
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-numbered-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-numfig
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-productionlist
|   |   |   ├── Bare.rst
|   |   |   ├── Dup1.rst
|   |   |   ├── Dup2.rst
|   |   |   ├── LineContinuation.rst
|   |   |   ├── P1.rst
|   |   |   ├── P2.rst
|   |   |   ├── conf.py
|   |   |   ├── firstLineRule.rst
|   |   |   └── index.rst
|   |   ├── test-prolog
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── markdown.md
|   |   |   ├── prolog_markdown_parser.py
|   |   |   └── restructuredtext.rst
|   |   ├── test-pycode
|   |   |   └── cp_1251_coded.py
|   |   ├── test-pycode-egg
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── src
|   |   |       ├── sample.py
|   |   |       └── setup.py
|   |   ├── test-reST-code-block
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-refonly_bullet_list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-roles-download
|   |   |   ├── another
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-root
|   |   |   ├── _templates
|   |   |   |   ├── contentssb.html
|   |   |   |   ├── customsb.html
|   |   |   |   └── layout.html
|   |   |   ├── autodoc.txt
|   |   |   ├── autodoc_target.py
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── extapi.txt
|   |   |   ├── extensions.txt
|   |   |   ├── footnote.txt
|   |   |   ├── images.txt
|   |   |   ├── includes.txt
|   |   |   ├── index.txt
|   |   |   ├── lists.txt
|   |   |   ├── markup.txt
|   |   |   ├── math.txt
|   |   |   ├── objects.txt
|   |   |   ├── parsermod.py
|   |   |   ├── special
|   |   |   |   └── code.py
|   |   |   └── subdir
|   |   |       ├── excluded.txt
|   |   |       ├── images.txt
|   |   |       └── includes.txt
|   |   ├── test-search
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nosearch.rst
|   |   |   └── tocitem.rst
|   |   ├── test-setup
|   |   |   ├── doc
|   |   |   |   ├── conf.py
|   |   |   |   └── index.txt
|   |   |   └── setup.py
|   |   ├── test-smartquotes
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-stylesheets
|   |   |   ├── _templates
|   |   |   |   └── layout.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-templating
|   |   |   ├── _templates
|   |   |   |   ├── autosummary
|   |   |   |   └── layout.html
|   |   |   ├── autosummary_templating.txt
|   |   |   ├── conf.py
|   |   |   └── index.txt
|   |   ├── test-theming
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── setup.py
|   |   |   └── test_theme
|   |   |       ├── __init__.py
|   |   |       ├── staticfiles
|   |   |       └── test-theme
|   |   ├── test-tocdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   ├── qux.rst
|   |   |   └── tocdepth.rst
|   |   ├── test-toctree-duplicated
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree-empty
|   |   |   ├── _templates
|   |   |   |   └── localtoc.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-toctree-glob
|   |   |   ├── bar
|   |   |   |   ├── bar_1.rst
|   |   |   |   ├── bar_2.rst
|   |   |   |   ├── bar_3.rst
|   |   |   |   ├── bar_4
|   |   |   |   └── index.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux
|   |   |       ├── index.rst
|   |   |       ├── qux_1.rst
|   |   |       └── qux_2.rst
|   |   ├── test-toctree-maxdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   └── qux.rst
|   |   ├── test-trim_doctest_flags
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-versioning
|   |   |   ├── added.txt
|   |   |   ├── conf.py
|   |   |   ├── deleted.txt
|   |   |   ├── deleted_end.txt
|   |   |   ├── index.txt
|   |   |   ├── insert.txt
|   |   |   ├── insert_beginning.txt
|   |   |   ├── insert_similar.txt
|   |   |   ├── modified.txt
|   |   |   └── original.txt
|   |   └── test-warnings
|   |       ├── autodoc_fodder.py
|   |       ├── conf.py
|   |       ├── index.rst
|   |       └── undecodable.rst
|   ├── test_api_translator.py
|   ├── test_application.py
|   ├── test_build.py
|   ├── test_build_changes.py
|   ├── test_build_dirhtml.py
|   ├── test_build_epub.py
|   ├── test_build_gettext.py
|   ├── test_build_html.py
|   ├── test_build_latex.py
|   ├── test_build_linkcheck.py
|   ├── test_build_manpage.py
|   ├── test_build_texinfo.py
|   ├── test_build_text.py
|   ├── test_builder.py
|   ├── test_catalogs.py
|   ├── test_config.py
|   ├── test_correct_year.py
|   ├── test_directive_code.py
|   ├── test_directive_only.py
|   ├── test_directive_other.py
|   ├── test_directive_patch.py
|   ├── test_docutilsconf.py
|   ├── test_domain_c.py
|   ├── test_domain_cpp.py
|   ├── test_domain_js.py
|   ├── test_domain_py.py
|   ├── test_domain_rst.py
|   ├── test_domain_std.py
|   ├── test_environment.py
|   ├── test_environment_indexentries.py
|   ├── test_environment_toctree.py
|   ├── test_errors.py
|   ├── test_events.py
|   ├── test_ext_apidoc.py
|   ├── test_ext_autodoc.py
|   ├── test_ext_autodoc_autofunction.py
|   ├── test_ext_autodoc_configs.py
|   ├── test_ext_autodoc_events.py
|   ├── test_ext_autodoc_mock.py
|   ├── test_ext_autodoc_private_members.py
|   ├── test_ext_autosectionlabel.py
|   ├── test_ext_autosummary.py
|   ├── test_ext_coverage.py
|   ├── test_ext_doctest.py
|   ├── test_ext_duration.py
|   ├── test_ext_githubpages.py
|   ├── test_ext_graphviz.py
|   ├── test_ext_ifconfig.py
|   ├── test_ext_imgconverter.py
|   ├── test_ext_inheritance_diagram.py
|   ├── test_ext_intersphinx.py
|   ├── test_ext_math.py
|   ├── test_ext_napoleon.py
|   ├── test_ext_napoleon_docstring.py
|   ├── test_ext_napoleon_iterators.py
|   ├── test_ext_todo.py
|   ├── test_ext_viewcode.py
|   ├── test_highlighting.py
|   ├── test_intl.py
|   ├── test_locale.py
|   ├── test_markup.py
|   ├── test_metadata.py
|   ├── test_parser.py
|   ├── test_project.py
|   ├── test_pycode.py
|   ├── test_pycode_ast.py
|   ├── test_pycode_parser.py
|   ├── test_quickstart.py
|   ├── test_roles.py
|   ├── test_search.py
|   ├── test_setup_command.py
|   ├── test_smartquotes.py
|   ├── test_templating.py
|   ├── test_theming.py
|   ├── test_toctree.py
|   ├── test_transforms_post_transforms_code.py
|   ├── test_util.py
|   ├── test_util_docstrings.py
|   ├── test_util_docutils.py
|   ├── test_util_fileutil.py
|   ├── test_util_i18n.py
|   ├── test_util_images.py
|   ├── test_util_inspect.py
|   ├── test_util_inventory.py
|   ├── test_util_jsdump.py
|   ├── test_util_logging.py
|   ├── test_util_matching.py
|   ├── test_util_nodes.py
|   ├── test_util_pycompat.py
|   ├── test_util_rst.py
|   ├── test_util_template.py
|   ├── test_util_typing.py
|   ├── test_versioning.py
|   ├── test_writer_latex.py
|   └── typing_test_data.py
└── utils
    ├── __init__.py
    ├── bump_docker.sh
    ├── bump_version.py
    ├── checks.py
    ├── doclinter.py
    └── jssplitter_generator.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: docstring default arg is broken

Description: **Describe the bug**
docstring default arg is broken in html.
Python class method
>     def add_lines(self, lines, color=(1, 1, 1), width=5, label=None, name=None):
is rendered as
>    add_lines(lines, color=1, 1, 1, width=5, label=None, name=None)

**To Reproduce**
Steps to reproduce the behavior (Dockerfile):
```
FROM python:3.7-slim
RUN apt update; apt install -y git make python3-vtk7
RUN git clone https://github.com/tkoyama010/pyvista.git
WORKDIR /pyvista
RUN git checkout patch-1
RUN pip install . 
RUN pip install -r requirements_docs.txt
RUN (cd docs; make html)
```

**Expected behavior**
A clear and concise description of what you expected to happen.
Python class method
>     def add_lines(self, lines, color=(1, 1, 1), width=5, label=None, name=None):
is rendered as
>    add_lines(lines, color=(1, 1, 1), width=5, label=None, name=None)

**Your project**
Link to your sphinx project, or attach zipped small project sample.
https://github.com/pyvista/pyvista
https://docs.pyvista.org/plotting/plotting.html#pyvista.BasePlotter.add_lines

**Screenshots**
If applicable, add screenshots to help explain your problem.
![image](https://user-images.githubusercontent.com/7513610/87623793-2e412d80-c761-11ea-8caa-0b8bfcaf56c3.png)

**Environment info**
- OS: [e.g. Unix/Linux/Mac/Win/other with version] Linux
- Python version: [e.g. 3.7.1] 3.7
- Sphinx version: [e.g. 1.8.2] sphinx-build 3.1.1
- Sphinx extensions:  [e.g. sphinx.ext.autodoc, recommonmark] sphinx.ext.autodoc
- Extra tools: [e.g. Browser, tex or something else] None

**Additional context**
Add any other context about the problem here.

- [e.g. URL or Ticket] None



Patch information:
diff --git a/sphinx/util/inspect.py b/sphinx/util/inspect.py
index 378174993..89c148a6e 100644
--- a/sphinx/util/inspect.py
+++ b/sphinx/util/inspect.py
@@ -626,7 +626,14 @@ def signature_from_ast(node: ast.FunctionDef) -> inspect.Signature:
             if defaults[i] is Parameter.empty:
                 default = Parameter.empty
             else:
-                default = ast_unparse(defaults[i])
+                default_node = defaults[i]
+                default = ast_unparse(default_node)
+                if isinstance(default_node, ast.Tuple):
+                    # ensure tuple defaults are parenthesized (and keep singleton comma)
+                    if len(getattr(default_node, 'elts', [])) == 1:
+                        default = f"({default},)"
+                    else:
+                        default = f"({default})"
 
             annotation = ast_unparse(arg.annotation) or Parameter.empty
             params.append(Parameter(arg.arg, Parameter.POSITIONAL_ONLY,
@@ -636,7 +643,14 @@ def signature_from_ast(node: ast.FunctionDef) -> inspect.Signature:
         if defaults[i + posonlyargs] is Parameter.empty:
             default = Parameter.empty
         else:
-            default = ast_unparse(defaults[i + posonlyargs])
+            default_node = defaults[i + posonlyargs]
+            default = ast_unparse(default_node)
+            if isinstance(default_node, ast.Tuple):
+                # ensure tuple defaults are parenthesized (and keep singleton comma)
+                if len(getattr(default_node, 'elts', [])) == 1:
+                    default = f"({default},)"
+                else:
+                    default = f"({default})"
 
         annotation = ast_unparse(arg.annotation) or Parameter.empty
         params.append(Parameter(arg.arg, Parameter.POSITIONAL_OR_KEYWORD,
@@ -649,6 +663,14 @@ def signature_from_ast(node: ast.FunctionDef) -> inspect.Signature:
 
     for i, arg in enumerate(args.kwonlyargs):
         default = ast_unparse(args.kw_defaults[i]) or Parameter.empty
+        if default is not Parameter.empty and args.kw_defaults[i] is not None:
+            default_node = args.kw_defaults[i]
+            if isinstance(default_node, ast.Tuple):
+                # ensure tuple defaults are parenthesized (and keep singleton comma)
+                if len(getattr(default_node, 'elts', [])) == 1:
+                    default = f"({default},)"
+                else:
+                    default = f"({default})"
         annotation = ast_unparse(arg.annotation) or Parameter.empty
         params.append(Parameter(arg.arg, Parameter.KEYWORD_ONLY, default=default,
                                 annotation=annotation))


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of tests/test_util_inspect.py.
Extra Requirements: 
Purpose: This file is expected to contain unit tests for the patched code in `sphinx/util/inspect.py`, which will help identify test cases related to function signature parsing and default argument handling.

Previous refined query 2:
Essential Query: Please provide the full content of tests/test_ext_autodoc.py.
Extra Requirements: 
Purpose: This file is expected to contain integration tests for the `autodoc` extension, which will likely have test cases that cover the rendering of function signatures with various kinds of default arguments, including tuples.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: tests/test_ext_autodoc.py
Line number range: 1 - 2127
Content:
1. """
2.     test_ext_autodoc
3.     ~~~~~~~~~~~~~~~~
4. 
5.     Test the autodoc extension.  This tests mainly the Documenters; the auto
6.     directives are tested in a test source file translated by test_build.
7. 
8.     :copyright: Copyright 2007-2020 by the Sphinx team, see AUTHORS.
9.     :license: BSD, see LICENSE for details.
10. """
11. 
12. import sys
13. from unittest.mock import Mock
14. from warnings import catch_warnings
15. 
16. import pytest
17. from docutils.statemachine import ViewList
18. 
19. from sphinx import addnodes
20. from sphinx.ext.autodoc import ModuleLevelDocumenter, ALL, Options
21. from sphinx.ext.autodoc.directive import DocumenterBridge, process_documenter_options
22. from sphinx.testing.util import SphinxTestApp, Struct  # NOQA
23. from sphinx.util.docutils import LoggingReporter
24. 
25. try:
26.     # Enable pyximport to test cython module
27.     import pyximport
28.     pyximport.install()
29. except ImportError:
30.     pyximport = None
31. 
32. 
33. def do_autodoc(app, objtype, name, options=None):
34.     if options is None:
35.         options = {}
36.     app.env.temp_data.setdefault('docname', 'index')  # set dummy docname
37.     doccls = app.registry.documenters[objtype]
38.     docoptions = process_documenter_options(doccls, app.config, options)
39.     state = Mock()
40.     state.document.settings.tab_width = 8
41.     bridge = DocumenterBridge(app.env, LoggingReporter(''), docoptions, 1, state)
42.     documenter = doccls(bridge, name)
43.     documenter.generate()
44. 
45.     return bridge.result
46. 
47. 
48. def make_directive_bridge(env):
49.     options = Options(
50.         inherited_members = False,
51.         undoc_members = False,
52.         private_members = False,
53.         special_members = False,
54.         imported_members = False,
55.         show_inheritance = False,
56.         noindex = False,
57.         annotation = None,
58.         synopsis = '',
59.         platform = '',
60.         deprecated = False,
61.         members = [],
62.         member_order = 'alphabetical',
63.         exclude_members = set(),
64.         ignore_module_all = False,
65.     )
66. 
67.     directive = Struct(
68.         env = env,
69.         genopt = options,
70.         result = ViewList(),
71.         filename_set = set(),
72.         state = Mock(),
73.     )
74.     directive.state.document.settings.tab_width = 8
75. 
76.     return directive
77. 
78. 
79. processed_signatures = []
80. 
81. 
82. def process_signature(app, what, name, obj, options, args, retann):
83.     processed_signatures.append((what, name))
84.     if name == 'bar':
85.         return '42', None
86. 
87. 
88. def skip_member(app, what, name, obj, skip, options):
89.     if name in ('__special1__', '__special2__'):
90.         return skip
91.     if name.startswith('__'):
92.         return True
93.     if name == 'skipmeth':
94.         return True
95. 
96. 
97. def test_parse_name(app):
98.     def verify(objtype, name, result):
99.         inst = app.registry.documenters[objtype](directive, name)
100.         assert inst.parse_name()
101.         assert (inst.modname, inst.objpath, inst.args, inst.retann) == result
102. 
103.     directive = make_directive_bridge(app.env)
104. 
105.     # for modules
106.     verify('module', 'test_ext_autodoc', ('test_ext_autodoc', [], None, None))
107.     verify('module', 'test.test_ext_autodoc', ('test.test_ext_autodoc', [], None, None))
108.     verify('module', 'test(arg)', ('test', [], 'arg', None))
109.     assert 'signature arguments' in app._warning.getvalue()
110. 
111.     # for functions/classes
112.     verify('function', 'test_ext_autodoc.raises',
113.            ('test_ext_autodoc', ['raises'], None, None))
114.     verify('function', 'test_ext_autodoc.raises(exc) -> None',
115.            ('test_ext_autodoc', ['raises'], 'exc', 'None'))
116.     directive.env.temp_data['autodoc:module'] = 'test_ext_autodoc'
117.     verify('function', 'raises', ('test_ext_autodoc', ['raises'], None, None))
118.     del directive.env.temp_data['autodoc:module']
119.     directive.env.ref_context['py:module'] = 'test_ext_autodoc'
120.     verify('function', 'raises', ('test_ext_autodoc', ['raises'], None, None))
121.     verify('class', 'Base', ('test_ext_autodoc', ['Base'], None, None))
122. 
123.     # for members
124.     directive.env.ref_context['py:module'] = 'sphinx.testing.util'
125.     verify('method', 'SphinxTestApp.cleanup',
126.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
127.     directive.env.ref_context['py:module'] = 'sphinx.testing.util'
128.     directive.env.ref_context['py:class'] = 'Foo'
129.     directive.env.temp_data['autodoc:class'] = 'SphinxTestApp'
130.     verify('method', 'cleanup',
131.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
132.     verify('method', 'SphinxTestApp.cleanup',
133.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
134. 
135. 
136. def test_format_signature(app):
137.     app.connect('autodoc-process-signature', process_signature)
138.     app.connect('autodoc-skip-member', skip_member)
139. 
140.     directive = make_directive_bridge(app.env)
141. 
142.     def formatsig(objtype, name, obj, args, retann):
143.         inst = app.registry.documenters[objtype](directive, name)
144.         inst.fullname = name
145.         inst.doc_as_attr = False  # for class objtype
146.         inst.parent = object  # dummy
147.         inst.object = obj
148.         inst.objpath = [name]
149.         inst.args = args
150.         inst.retann = retann
151.         res = inst.format_signature()
152.         print(res)
153.         return res
154. 
155.     # no signatures for modules
156.     assert formatsig('module', 'test', None, None, None) == ''
157. 
158.     # test for functions
159.     def f(a, b, c=1, **d):
160.         pass
161. 
162.     def g(a='\n'):
163.         pass
164.     assert formatsig('function', 'f', f, None, None) == '(a, b, c=1, **d)'
165.     assert formatsig('function', 'f', f, 'a, b, c, d', None) == '(a, b, c, d)'
166.     assert formatsig('function', 'g', g, None, None) == r"(a='\n')"
167. 
168.     # test for classes
169.     class D:
170.         pass
171. 
172.     class E:
173.         def __init__(self):
174.             pass
175. 
176.     # an empty init and no init are the same
177.     for C in (D, E):
178.         assert formatsig('class', 'D', C, None, None) == '()'
179. 
180. 
181.     class SomeMeta(type):
182.         def __call__(cls, a, b=None):
183.             return type.__call__(cls, a, b)
184. 
185.     # these three are all equivalent
186.     class F:
187.         def __init__(self, a, b=None):
188.             pass
189. 
190.     class FNew:
191.         def __new__(cls, a, b=None):
192.             return super().__new__(cls)
193. 
194.     class FMeta(metaclass=SomeMeta):
195.         pass
196. 
197.     # and subclasses should always inherit
198.     class G(F):
199.         pass
200. 
201.     class GNew(FNew):
202.         pass
203. 
204.     class GMeta(FMeta):
205.         pass
206. 
207.     # subclasses inherit
208.     for C in (F, FNew, FMeta, G, GNew, GMeta):
209.         assert formatsig('class', 'C', C, None, None) == '(a, b=None)'
210.     assert formatsig('class', 'C', D, 'a, b', 'X') == '(a, b) -> X'
211. 
212. 
213.     class ListSubclass(list):
214.         pass
215. 
216.     # only supported if the python implementation decides to document it
217.     if getattr(list, '__text_signature__', None) is not None:
218.         assert formatsig('class', 'C', ListSubclass, None, None) == '(iterable=(), /)'
219.     else:
220.         assert formatsig('class', 'C', ListSubclass, None, None) == ''
221. 
222. 
223.     class ExceptionSubclass(Exception):
224.         pass
225. 
226.     # Exception has no __text_signature__ at least in Python 3.8
227.     if getattr(Exception, '__text_signature__', None) is None:
228.         assert formatsig('class', 'C', ExceptionSubclass, None, None) == ''
229. 
230. 
231.     # __init__ have signature at first line of docstring
232.     directive.env.config.autoclass_content = 'both'
233. 
234.     class F2:
235.         '''some docstring for F2.'''
236.         def __init__(self, *args, **kw):
237.             '''
238.             __init__(a1, a2, kw1=True, kw2=False)
239. 
240.             some docstring for __init__.
241.             '''
242.     class G2(F2):
243.         pass
244. 
245.     assert formatsig('class', 'F2', F2, None, None) == \
246.         '(a1, a2, kw1=True, kw2=False)'
247.     assert formatsig('class', 'G2', G2, None, None) == \
248.         '(a1, a2, kw1=True, kw2=False)'
249. 
250.     # test for methods
251.     class H:
252.         def foo1(self, b, *c):
253.             pass
254. 
255.         def foo2(b, *c):
256.             pass
257. 
258.         def foo3(self, d='\n'):
259.             pass
260.     assert formatsig('method', 'H.foo', H.foo1, None, None) == '(b, *c)'
261.     assert formatsig('method', 'H.foo', H.foo1, 'a', None) == '(a)'
262.     assert formatsig('method', 'H.foo', H.foo2, None, None) == '(*c)'
263.     assert formatsig('method', 'H.foo', H.foo3, None, None) == r"(d='\n')"
264. 
265.     # test bound methods interpreted as functions
266.     assert formatsig('function', 'foo', H().foo1, None, None) == '(b, *c)'
267.     assert formatsig('function', 'foo', H().foo2, None, None) == '(*c)'
268.     assert formatsig('function', 'foo', H().foo3, None, None) == r"(d='\n')"
269. 
270.     # test exception handling (exception is caught and args is '')
271.     directive.env.config.autodoc_docstring_signature = False
272.     assert formatsig('function', 'int', int, None, None) == ''
273. 
274.     # test processing by event handler
275.     assert formatsig('method', 'bar', H.foo1, None, None) == '42'
276. 
277.     # test functions created via functools.partial
278.     from functools import partial
279.     curried1 = partial(lambda a, b, c: None, 'A')
280.     assert formatsig('function', 'curried1', curried1, None, None) == \
281.         '(b, c)'
282.     curried2 = partial(lambda a, b, c=42: None, 'A')
283.     assert formatsig('function', 'curried2', curried2, None, None) == \
284.         '(b, c=42)'
285.     curried3 = partial(lambda a, b, *c: None, 'A')
286.     assert formatsig('function', 'curried3', curried3, None, None) == \
287.         '(b, *c)'
288.     curried4 = partial(lambda a, b, c=42, *d, **e: None, 'A')
289.     assert formatsig('function', 'curried4', curried4, None, None) == \
290.         '(b, c=42, *d, **e)'
291. 
292. 
293. @pytest.mark.skipif(sys.version_info < (3, 5), reason='typing is available since python3.5.')
294. @pytest.mark.sphinx('html', testroot='ext-autodoc')
295. def test_autodoc_process_signature_typing_generic(app):
296.     actual = do_autodoc(app, 'class', 'target.generic_class.A', {})
297. 
298.     assert list(actual) == [
299.         '',
300.         '.. py:class:: A(a, b=None)',
301.         '   :module: target.generic_class',
302.         '',
303.         '   docstring for A',
304.         '',
305.     ]
306. 
307. 
308. def test_autodoc_process_signature_typehints(app):
309.     captured = []
310. 
311.     def process_signature(*args):
312.         captured.append(args)
313. 
314.     app.connect('autodoc-process-signature', process_signature)
315. 
316.     def func(x: int, y: int) -> int:
317.         pass
318. 
319.     directive = make_directive_bridge(app.env)
320.     inst = app.registry.documenters['function'](directive, 'func')
321.     inst.fullname = 'func'
322.     inst.object = func
323.     inst.objpath = ['func']
324.     inst.format_signature()
325.     assert captured == [(app, 'function', 'func', func,
326.                          directive.genopt, '(x: int, y: int)', 'int')]
327. 
328. 
329. def test_get_doc(app):
330.     directive = make_directive_bridge(app.env)
331. 
332.     def getdocl(objtype, obj):
333.         inst = app.registry.documenters[objtype](directive, 'tmp')
334.         inst.parent = object  # dummy
335.         inst.object = obj
336.         inst.objpath = [obj.__name__]
337.         inst.doc_as_attr = False
338.         inst.format_signature()  # handle docstring signatures!
339.         ds = inst.get_doc()
340.         # for testing purposes, concat them and strip the empty line at the end
341.         res = sum(ds, [])[:-1]
342.         print(res)
343.         return res
344. 
345.     # objects without docstring
346.     def f():
347.         pass
348.     assert getdocl('function', f) == []
349. 
350.     # standard function, diverse docstring styles...
351.     def f():
352.         """Docstring"""
353.     def g():
354.         """
355.         Docstring
356.         """
357.     for func in (f, g):
358.         assert getdocl('function', func) == ['Docstring']
359. 
360.     # first line vs. other lines indentation
361.     def f():
362.         """First line
363. 
364.         Other
365.           lines
366.         """
367.     assert getdocl('function', f) == ['First line', '', 'Other', '  lines']
368. 
369.     # charset guessing (this module is encoded in utf-8)
370.     def f():
371.         """Döcstring"""
372.     assert getdocl('function', f) == ['Döcstring']
373. 
374.     # already-unicode docstrings must be taken literally
375.     def f():
376.         """Döcstring"""
377.     assert getdocl('function', f) == ['Döcstring']
378. 
379.     # verify that method docstrings get extracted in both normal case
380.     # and in case of bound method posing as a function
381.     class J:  # NOQA
382.         def foo(self):
383.             """Method docstring"""
384.     assert getdocl('method', J.foo) == ['Method docstring']
385.     assert getdocl('function', J().foo) == ['Method docstring']
386. 
387. 
388. @pytest.mark.sphinx('html', testroot='ext-autodoc')
389. def test_new_documenter(app):
390.     class MyDocumenter(ModuleLevelDocumenter):
391.         objtype = 'integer'
392.         directivetype = 'integer'
393.         priority = 100
394. 
395.         @classmethod
396.         def can_document_member(cls, member, membername, isattr, parent):
397.             return isinstance(member, int)
398. 
399.         def document_members(self, all_members=False):
400.             return
401. 
402.     app.add_autodocumenter(MyDocumenter)
403. 
404.     options = {"members": 'integer'}
405.     actual = do_autodoc(app, 'module', 'target', options)
406.     assert list(actual) == [
407.         '',
408.         '.. py:module:: target',
409.         '',
410.         '',
411.         '.. py:integer:: integer',
412.         '   :module: target',
413.         '',
414.         '   documentation for the integer',
415.         '',
416.     ]
417. 
418. 
419. def test_attrgetter_using(app):
420.     from target import Class
421.     from target.inheritance import Derived
422. 
423.     directive = make_directive_bridge(app.env)
424. 
425.     def assert_getter_works(objtype, name, obj, attrs=[], **kw):
426.         getattr_spy = []
427. 
428.         def special_getattr(obj, name, *defargs):
429.             if name in attrs:
430.                 getattr_spy.append((obj, name))
431.                 return None
432.             return getattr(obj, name, *defargs)
433.         app.add_autodoc_attrgetter(type, special_getattr)
434. 
435.         del getattr_spy[:]
436.         inst = app.registry.documenters[objtype](directive, name)
437.         inst.generate(**kw)
438. 
439.         hooked_members = [s[1] for s in getattr_spy]
440.         documented_members = [s[1] for s in processed_signatures]
441.         for attr in attrs:
442.             fullname = '.'.join((name, attr))
443.             assert attr in hooked_members
444.             assert fullname not in documented_members, \
445.                 '%r was not hooked by special_attrgetter function' % fullname
446. 
447.     with catch_warnings(record=True):
448.         directive.genopt['members'] = ALL
449.         directive.genopt['inherited_members'] = False
450.         print(directive.genopt)
451.         assert_getter_works('class', 'target.Class', Class, ['meth'])
452. 
453.         directive.genopt['inherited_members'] = True
454.         assert_getter_works('class', 'target.inheritance.Derived', Derived, ['inheritedmeth'])
455. 
456. 
457. @pytest.mark.sphinx('html', testroot='ext-autodoc')
458. def test_py_module(app, warning):
459.     # without py:module
460.     actual = do_autodoc(app, 'method', 'Class.meth')
461.     assert list(actual) == []
462.     assert ("don't know which module to import for autodocumenting 'Class.meth'"
463.             in warning.getvalue())
464. 
465.     # with py:module
466.     app.env.ref_context['py:module'] = 'target'
467.     warning.truncate(0)
468. 
469.     actual = do_autodoc(app, 'method', 'Class.meth')
470.     assert list(actual) == [
471.         '',
472.         '.. py:method:: Class.meth()',
473.         '   :module: target',
474.         '',
475.         '   Function.',
476.         '',
477.     ]
478.     assert ("don't know which module to import for autodocumenting 'Class.meth'"
479.             not in warning.getvalue())
480. 
481. 
482. @pytest.mark.sphinx('html', testroot='ext-autodoc')
483. def test_autodoc_decorator(app):
484.     actual = do_autodoc(app, 'decorator', 'target.decorator.deco1')
485.     assert list(actual) == [
486.         '',
487.         '.. py:decorator:: deco1',
488.         '   :module: target.decorator',
489.         '',
490.         '   docstring for deco1',
491.         '',
492.     ]
493. 
494.     actual = do_autodoc(app, 'decorator', 'target.decorator.deco2')
495.     assert list(actual) == [
496.         '',
497.         '.. py:decorator:: deco2(condition, message)',
498.         '   :module: target.decorator',
499.         '',
500.         '   docstring for deco2',
501.         '',
502.     ]
503. 
504. 
505. @pytest.mark.sphinx('html', testroot='ext-autodoc')
506. def test_autodoc_exception(app):
507.     actual = do_autodoc(app, 'exception', 'target.CustomEx')
508.     assert list(actual) == [
509.         '',
510.         '.. py:exception:: CustomEx',
511.         '   :module: target',
512.         '',
513.         '   My custom exception.',
514.         '',
515.     ]
516. 
517. 
518. @pytest.mark.sphinx('html', testroot='ext-autodoc')
519. def test_autodoc_warnings(app, warning):
520.     app.env.temp_data['docname'] = 'dummy'
521. 
522.     # can't import module
523.     do_autodoc(app, 'module', 'unknown')
524.     assert "failed to import module 'unknown'" in warning.getvalue()
525. 
526.     # missing function
527.     do_autodoc(app, 'function', 'unknown')
528.     assert "import for autodocumenting 'unknown'" in warning.getvalue()
529. 
530.     do_autodoc(app, 'function', 'target.unknown')
531.     assert "failed to import function 'unknown' from module 'target'" in warning.getvalue()
532. 
533.     # missing method
534.     do_autodoc(app, 'method', 'target.Class.unknown')
535.     assert "failed to import method 'Class.unknown' from module 'target'" in warning.getvalue()
536. 
537. 
538. @pytest.mark.sphinx('html', testroot='ext-autodoc')
539. def test_autodoc_attributes(app):
540.     options = {"synopsis": 'Synopsis',
541.                "platform": "Platform",
542.                "deprecated": None}
543.     actual = do_autodoc(app, 'module', 'target', options)
544.     assert list(actual) == [
545.         '',
546.         '.. py:module:: target',
547.         '   :synopsis: Synopsis',
548.         '   :platform: Platform',
549.         '   :deprecated:',
550.         ''
551.     ]
552. 
553. 
554. @pytest.mark.sphinx('html', testroot='ext-autodoc')
555. def test_autodoc_members(app):
556.     # default (no-members)
557.     actual = do_autodoc(app, 'class', 'target.inheritance.Base')
558.     assert list(filter(lambda l: '::' in l, actual)) == [
559.         '.. py:class:: Base()',
560.     ]
561. 
562.     # default ALL-members
563.     options = {"members": None}
564.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
565.     assert list(filter(lambda l: '::' in l, actual)) == [
566.         '.. py:class:: Base()',
567.         '   .. py:method:: Base.inheritedclassmeth()',
568.         '   .. py:method:: Base.inheritedmeth()',
569.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
570.     ]
571. 
572.     # default specific-members
573.     options = {"members": "inheritedmeth,inheritedstaticmeth"}
574.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
575.     assert list(filter(lambda l: '::' in l, actual)) == [
576.         '.. py:class:: Base()',
577.         '   .. py:method:: Base.inheritedmeth()',
578.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
579.     ]
580. 
581. 
582. @pytest.mark.sphinx('html', testroot='ext-autodoc')
583. def test_autodoc_exclude_members(app):
584.     options = {"members": None,
585.                "exclude-members": "inheritedmeth,inheritedstaticmeth"}
586.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
587.     assert list(filter(lambda l: '::' in l, actual)) == [
588.         '.. py:class:: Base()',
589.         '   .. py:method:: Base.inheritedclassmeth()'
590.     ]
591. 
592.     # members vs exclude-members
593.     options = {"members": "inheritedmeth",
594.                "exclude-members": "inheritedmeth"}
595.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
596.     assert list(filter(lambda l: '::' in l, actual)) == [
597.         '.. py:class:: Base()',
598.     ]
599. 
600. 
601. @pytest.mark.sphinx('html', testroot='ext-autodoc')
602. def test_autodoc_undoc_members(app):
603.     options = {"members": None,
604.                "undoc-members": None}
605.     actual = do_autodoc(app, 'class', 'target.Class', options)
606.     assert list(filter(lambda l: '::' in l, actual)) == [
607.         '.. py:class:: Class(arg)',
608.         '   .. py:attribute:: Class.attr',
609.         '   .. py:attribute:: Class.docattr',
610.         '   .. py:method:: Class.excludemeth()',
611.         '   .. py:attribute:: Class.inst_attr_comment',
612.         '   .. py:attribute:: Class.inst_attr_inline',
613.         '   .. py:attribute:: Class.inst_attr_string',
614.         '   .. py:attribute:: Class.mdocattr',
615.         '   .. py:method:: Class.meth()',
616.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
617.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
618.         '   .. py:attribute:: Class.skipattr',
619.         '   .. py:method:: Class.skipmeth()',
620.         '   .. py:attribute:: Class.udocattr',
621.         '   .. py:method:: Class.undocmeth()'
622.     ]
623. 
624. 
625. @pytest.mark.sphinx('html', testroot='ext-autodoc')
626. def test_autodoc_inherited_members(app):
627.     options = {"members": None,
628.                "inherited-members": None}
629.     actual = do_autodoc(app, 'class', 'target.inheritance.Derived', options)
630.     assert list(filter(lambda l: 'method::' in l, actual)) == [
631.         '   .. py:method:: Derived.inheritedclassmeth()',
632.         '   .. py:method:: Derived.inheritedmeth()',
633.         '   .. py:method:: Derived.inheritedstaticmeth(cls)',
634.     ]
635. 
636. 
637. @pytest.mark.sphinx('html', testroot='ext-autodoc')
638. def test_autodoc_inherited_members_Base(app):
639.     options = {"members": None,
640.                "inherited-members": "Base",
641.                "special-members": None}
642. 
643.     # check methods for object class are shown
644.     actual = do_autodoc(app, 'class', 'target.inheritance.Derived', options)
645.     assert '   .. py:method:: Derived.inheritedmeth()' in actual
646.     assert '   .. py:method:: Derived.inheritedclassmeth' not in actual
647. 
648. 
649. @pytest.mark.sphinx('html', testroot='ext-autodoc')
650. def test_autodoc_inherited_members_None(app):
651.     options = {"members": None,
652.                "inherited-members": "None",
653.                "special-members": None}
654. 
655.     # check methods for object class are shown
656.     actual = do_autodoc(app, 'class', 'target.inheritance.Derived', options)
657.     assert '   .. py:method:: Derived.__init__()' in actual
658.     assert '   .. py:method:: Derived.__str__()' in actual
659. 
660. 
661. @pytest.mark.sphinx('html', testroot='ext-autodoc')
662. def test_autodoc_imported_members(app):
663.     options = {"members": None,
664.                "imported-members": None,
665.                "ignore-module-all": None}
666.     actual = do_autodoc(app, 'module', 'target', options)
667.     assert '.. py:function:: save_traceback(app: Sphinx) -> str' in actual
668. 
669. 
670. @pytest.mark.sphinx('html', testroot='ext-autodoc')
671. def test_autodoc_special_members(app):
672.     # specific special methods
673.     options = {"undoc-members": None,
674.                "special-members": "__init__,__special1__"}
675.     actual = do_autodoc(app, 'class', 'target.Class', options)
676.     assert list(filter(lambda l: '::' in l, actual)) == [
677.         '.. py:class:: Class(arg)',
678.         '   .. py:method:: Class.__init__(arg)',
679.         '   .. py:method:: Class.__special1__()',
680.     ]
681. 
682.     # combination with specific members
683.     options = {"members": "attr,docattr",
684.                "undoc-members": None,
685.                "special-members": "__init__,__special1__"}
686.     actual = do_autodoc(app, 'class', 'target.Class', options)
687.     assert list(filter(lambda l: '::' in l, actual)) == [
688.         '.. py:class:: Class(arg)',
689.         '   .. py:method:: Class.__init__(arg)',
690.         '   .. py:method:: Class.__special1__()',
691.         '   .. py:attribute:: Class.attr',
692.         '   .. py:attribute:: Class.docattr',
693.     ]
694. 
695.     # all special methods
696.     options = {"members": None,
697.                "undoc-members": None,
698.                "special-members": None}
699.     actual = do_autodoc(app, 'class', 'target.Class', options)
700.     assert list(filter(lambda l: '::' in l, actual)) == [
701.         '.. py:class:: Class(arg)',
702.         '   .. py:attribute:: Class.__dict__',
703.         '   .. py:method:: Class.__init__(arg)',
704.         '   .. py:attribute:: Class.__module__',
705.         '   .. py:method:: Class.__special1__()',
706.         '   .. py:method:: Class.__special2__()',
707.         '   .. py:attribute:: Class.__weakref__',
708.         '   .. py:attribute:: Class.attr',
709.         '   .. py:attribute:: Class.docattr',
710.         '   .. py:method:: Class.excludemeth()',
711.         '   .. py:attribute:: Class.inst_attr_comment',
712.         '   .. py:attribute:: Class.inst_attr_inline',
713.         '   .. py:attribute:: Class.inst_attr_string',
714.         '   .. py:attribute:: Class.mdocattr',
715.         '   .. py:method:: Class.meth()',
716.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
717.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
718.         '   .. py:attribute:: Class.skipattr',
719.         '   .. py:method:: Class.skipmeth()',
720.         '   .. py:attribute:: Class.udocattr',
721.         '   .. py:method:: Class.undocmeth()'
722.     ]
723. 
724. 
725. @pytest.mark.sphinx('html', testroot='ext-autodoc')
726. def test_autodoc_ignore_module_all(app):
727.     # default (no-ignore-module-all)
728.     options = {"members": None}
729.     actual = do_autodoc(app, 'module', 'target', options)
730.     assert list(filter(lambda l: 'class::' in l, actual)) == [
731.         '.. py:class:: Class(arg)',
732.     ]
733. 
734.     # ignore-module-all
735.     options = {"members": None,
736.                "ignore-module-all": None}
737.     actual = do_autodoc(app, 'module', 'target', options)
738.     assert list(filter(lambda l: 'class::' in l, actual)) == [
739.         '.. py:class:: Class(arg)',
740.         '.. py:class:: CustomDict',
741.         '.. py:class:: InnerChild()',
742.         '.. py:class:: InstAttCls()',
743.         '.. py:class:: Outer()',
744.         '   .. py:class:: Outer.Inner()',
745.         '.. py:class:: StrRepr'
746.     ]
747. 
748. 
749. @pytest.mark.sphinx('html', testroot='ext-autodoc')
750. def test_autodoc_noindex(app):
751.     options = {"noindex": True}
752.     actual = do_autodoc(app, 'module', 'target', options)
753.     assert list(actual) == [
754.         '',
755.         '.. py:module:: target',
756.         '   :noindex:',
757.         ''
758.     ]
759. 
760.     # TODO: :noindex: should be propagated to children of target item.
761. 
762.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
763.     assert list(actual) == [
764.         '',
765.         '.. py:class:: Base()',
766.         '   :noindex:',
767.         '   :module: target.inheritance',
768.         ''
769.     ]
770. 
771. 
772. @pytest.mark.sphinx('html', testroot='ext-autodoc')
773. def test_autodoc_subclass_of_builtin_class(app):
774.     options = {"members": None}
775.     actual = do_autodoc(app, 'class', 'target.CustomDict', options)
776.     assert list(actual) == [
777.         '',
778.         '.. py:class:: CustomDict',
779.         '   :module: target',
780.         '',
781.         '   Docstring.',
782.         '',
783.     ]
784. 
785. 
786. @pytest.mark.sphinx('html', testroot='ext-autodoc')
787. def test_autodoc_inner_class(app):
788.     options = {"members": None}
789.     actual = do_autodoc(app, 'class', 'target.Outer', options)
790.     assert list(actual) == [
791.         '',
792.         '.. py:class:: Outer()',
793.         '   :module: target',
794.         '',
795.         '   Foo',
796.         '',
797.         '',
798.         '   .. py:class:: Outer.Inner()',
799.         '      :module: target',
800.         '',
801.         '      Foo',
802.         '',
803.         '',
804.         '      .. py:method:: Outer.Inner.meth()',
805.         '         :module: target',
806.         '',
807.         '         Foo',
808.         '',
809.         '',
810.         '   .. py:attribute:: Outer.factory',
811.         '      :module: target',
812.         '',
813.         '      alias of :class:`builtins.dict`'
814.     ]
815. 
816.     actual = do_autodoc(app, 'class', 'target.Outer.Inner', options)
817.     assert list(actual) == [
818.         '',
819.         '.. py:class:: Inner()',
820.         '   :module: target.Outer',
821.         '',
822.         '   Foo',
823.         '',
824.         '',
825.         '   .. py:method:: Inner.meth()',
826.         '      :module: target.Outer',
827.         '',
828.         '      Foo',
829.         '',
830.     ]
831. 
832.     options['show-inheritance'] = True
833.     actual = do_autodoc(app, 'class', 'target.InnerChild', options)
834.     assert list(actual) == [
835.         '',
836.         '.. py:class:: InnerChild()',
837.         '   :module: target', '',
838.         '   Bases: :class:`target.Outer.Inner`',
839.         '',
840.         '   InnerChild docstring',
841.         '',
842.     ]
843. 
844. 
845. @pytest.mark.sphinx('html', testroot='ext-autodoc')
846. def test_autodoc_classmethod(app):
847.     actual = do_autodoc(app, 'method', 'target.inheritance.Base.inheritedclassmeth')
848.     assert list(actual) == [
849.         '',
850.         '.. py:method:: Base.inheritedclassmeth()',
851.         '   :module: target.inheritance',
852.         '   :classmethod:',
853.         '',
854.         '   Inherited class method.',
855.         '',
856.     ]
857. 
858. 
859. @pytest.mark.sphinx('html', testroot='ext-autodoc')
860. def test_autodoc_staticmethod(app):
861.     actual = do_autodoc(app, 'method', 'target.inheritance.Base.inheritedstaticmeth')
862.     assert list(actual) == [
863.         '',
864.         '.. py:method:: Base.inheritedstaticmeth(cls)',
865.         '   :module: target.inheritance',
866.         '   :staticmethod:',
867.         '',
868.         '   Inherited static method.',
869.         '',
870.     ]
871. 
872. 
873. @pytest.mark.sphinx('html', testroot='ext-autodoc')
874. def test_autodoc_descriptor(app):
875.     options = {"members": None,
876.                "undoc-members": True}
877.     actual = do_autodoc(app, 'class', 'target.descriptor.Class', options)
878.     assert list(actual) == [
879.         '',
880.         '.. py:class:: Class()',
881.         '   :module: target.descriptor',
882.         '',
883.         '',
884.         '   .. py:attribute:: Class.descr',
885.         '      :module: target.descriptor',
886.         '',
887.         '      Descriptor instance docstring.',
888.         '',
889.         '',
890.         '   .. py:method:: Class.prop',
891.         '      :module: target.descriptor',
892.         '      :property:',
893.         '',
894.         '      Property.',
895.         ''
896.     ]
897. 
898. 
899. @pytest.mark.skipif(sys.version_info < (3, 8),
900.                     reason='cached_property is available since python3.8.')
901. @pytest.mark.sphinx('html', testroot='ext-autodoc')
902. def test_autodoc_cached_property(app):
903.     options = {"members": None,
904.                "undoc-members": True}
905.     actual = do_autodoc(app, 'class', 'target.cached_property.Foo', options)
906.     assert list(actual) == [
907.         '',
908.         '.. py:class:: Foo()',
909.         '   :module: target.cached_property',
910.         '',
911.         '',
912.         '   .. py:method:: Foo.prop',
913.         '      :module: target.cached_property',
914.         '      :property:',
915.         '',
916.     ]
917. 
918. 
919. @pytest.mark.sphinx('html', testroot='ext-autodoc')
920. def test_autodoc_member_order(app):
921.     # case member-order='bysource'
922.     options = {"members": None,
923.                'member-order': 'bysource',
924.                "undoc-members": True,
925.                'private-members': True}
926.     actual = do_autodoc(app, 'class', 'target.Class', options)
927.     assert list(filter(lambda l: '::' in l, actual)) == [
928.         '.. py:class:: Class(arg)',
929.         '   .. py:method:: Class.meth()',
930.         '   .. py:method:: Class.undocmeth()',
931.         '   .. py:method:: Class.skipmeth()',
932.         '   .. py:method:: Class.excludemeth()',
933.         '   .. py:attribute:: Class.skipattr',
934.         '   .. py:attribute:: Class.attr',
935.         '   .. py:attribute:: Class.docattr',
936.         '   .. py:attribute:: Class.udocattr',
937.         '   .. py:attribute:: Class.mdocattr',
938.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
939.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
940.         '   .. py:attribute:: Class.inst_attr_inline',
941.         '   .. py:attribute:: Class.inst_attr_comment',
942.         '   .. py:attribute:: Class.inst_attr_string',
943.         '   .. py:attribute:: Class._private_inst_attr'
944.     ]
945. 
946.     # case member-order='groupwise'
947.     options = {"members": None,
948.                'member-order': 'groupwise',
949.                "undoc-members": True,
950.                'private-members': True}
951.     actual = do_autodoc(app, 'class', 'target.Class', options)
952.     assert list(filter(lambda l: '::' in l, actual)) == [
953.         '.. py:class:: Class(arg)',
954.         '   .. py:method:: Class.excludemeth()',
955.         '   .. py:method:: Class.meth()',
956.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
957.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
958.         '   .. py:method:: Class.skipmeth()',
959.         '   .. py:method:: Class.undocmeth()',
960.         '   .. py:attribute:: Class._private_inst_attr',
961.         '   .. py:attribute:: Class.attr',
962.         '   .. py:attribute:: Class.docattr',
963.         '   .. py:attribute:: Class.inst_attr_comment',
964.         '   .. py:attribute:: Class.inst_attr_inline',
965.         '   .. py:attribute:: Class.inst_attr_string',
966.         '   .. py:attribute:: Class.mdocattr',
967.         '   .. py:attribute:: Class.skipattr',
968.         '   .. py:attribute:: Class.udocattr'
969.     ]
970. 
971.     # case member-order=None
972.     options = {"members": None,
973.                "undoc-members": True,
974.                'private-members': True}
975.     actual = do_autodoc(app, 'class', 'target.Class', options)
976.     assert list(filter(lambda l: '::' in l, actual)) == [
977.         '.. py:class:: Class(arg)',
978.         '   .. py:attribute:: Class._private_inst_attr',
979.         '   .. py:attribute:: Class.attr',
980.         '   .. py:attribute:: Class.docattr',
981.         '   .. py:method:: Class.excludemeth()',
982.         '   .. py:attribute:: Class.inst_attr_comment',
983.         '   .. py:attribute:: Class.inst_attr_inline',
984.         '   .. py:attribute:: Class.inst_attr_string',
985.         '   .. py:attribute:: Class.mdocattr',
986.         '   .. py:method:: Class.meth()',
987.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
988.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
989.         '   .. py:attribute:: Class.skipattr',
990.         '   .. py:method:: Class.skipmeth()',
991.         '   .. py:attribute:: Class.udocattr',
992.         '   .. py:method:: Class.undocmeth()'
993.     ]
994. 
995. 
996. @pytest.mark.sphinx('html', testroot='ext-autodoc')
997. def test_autodoc_module_member_order(app):
998.     # case member-order='bysource'
999.     options = {"members": 'foo, Bar, baz, qux, Quux, foobar',
1000.                'member-order': 'bysource',
1001.                "undoc-members": True}
1002.     actual = do_autodoc(app, 'module', 'target.sort_by_all', options)
1003.     assert list(filter(lambda l: '::' in l, actual)) == [
1004.         '.. py:module:: target.sort_by_all',
1005.         '.. py:function:: baz()',
1006.         '.. py:function:: foo()',
1007.         '.. py:class:: Bar()',
1008.         '.. py:class:: Quux()',
1009.         '.. py:function:: foobar()',
1010.         '.. py:function:: qux()',
1011.     ]
1012. 
1013.     # case member-order='bysource' and ignore-module-all
1014.     options = {"members": 'foo, Bar, baz, qux, Quux, foobar',
1015.                'member-order': 'bysource',
1016.                "undoc-members": True,
1017.                "ignore-module-all": True}
1018.     actual = do_autodoc(app, 'module', 'target.sort_by_all', options)
1019.     assert list(filter(lambda l: '::' in l, actual)) == [
1020.         '.. py:module:: target.sort_by_all',
1021.         '.. py:function:: foo()',
1022.         '.. py:class:: Bar()',
1023.         '.. py:function:: baz()',
1024.         '.. py:function:: qux()',
1025.         '.. py:class:: Quux()',
1026.         '.. py:function:: foobar()',
1027.     ]
1028. 
1029. 
1030. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1031. def test_autodoc_module_scope(app):
1032.     app.env.temp_data['autodoc:module'] = 'target'
1033.     actual = do_autodoc(app, 'attribute', 'Class.mdocattr')
1034.     assert list(actual) == [
1035.         '',
1036.         '.. py:attribute:: Class.mdocattr',
1037.         '   :module: target',
1038.         '   :value: <_io.StringIO object>',
1039.         '',
1040.         '   should be documented as well - süß',
1041.         '',
1042.     ]
1043. 
1044. 
1045. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1046. def test_autodoc_class_scope(app):
1047.     app.env.temp_data['autodoc:module'] = 'target'
1048.     app.env.temp_data['autodoc:class'] = 'Class'
1049.     actual = do_autodoc(app, 'attribute', 'mdocattr')
1050.     assert list(actual) == [
1051.         '',
1052.         '.. py:attribute:: Class.mdocattr',
1053.         '   :module: target',
1054.         '   :value: <_io.StringIO object>',
1055.         '',
1056.         '   should be documented as well - süß',
1057.         '',
1058.     ]
1059. 
1060. 
1061. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1062. def test_class_attributes(app):
1063.     options = {"members": None,
1064.                "undoc-members": True}
1065.     actual = do_autodoc(app, 'class', 'target.AttCls', options)
1066.     assert list(actual) == [
1067.         '',
1068.         '.. py:class:: AttCls()',
1069.         '   :module: target',
1070.         '',
1071.         '',
1072.         '   .. py:attribute:: AttCls.a1',
1073.         '      :module: target',
1074.         '      :value: hello world',
1075.         '',
1076.         '',
1077.         '   .. py:attribute:: AttCls.a2',
1078.         '      :module: target',
1079.         '      :value: None',
1080.         ''
1081.     ]
1082. 
1083. 
1084. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1085. def test_autoclass_instance_attributes(app):
1086.     options = {"members": None}
1087.     actual = do_autodoc(app, 'class', 'target.InstAttCls', options)
1088.     assert list(actual) == [
1089.         '',
1090.         '.. py:class:: InstAttCls()',
1091.         '   :module: target',
1092.         '',
1093.         '   Class with documented class and instance attributes.',
1094.         '',
1095.         '',
1096.         '   .. py:attribute:: InstAttCls.ca1',
1097.         '      :module: target',
1098.         "      :value: 'a'",
1099.         '',
1100.         '      Doc comment for class attribute InstAttCls.ca1.',
1101.         '      It can have multiple lines.',
1102.         '',
1103.         '',
1104.         '   .. py:attribute:: InstAttCls.ca2',
1105.         '      :module: target',
1106.         "      :value: 'b'",
1107.         '',
1108.         '      Doc comment for InstAttCls.ca2. One line only.',
1109.         '',
1110.         '',
1111.         '   .. py:attribute:: InstAttCls.ca3',
1112.         '      :module: target',
1113.         "      :value: 'c'",
1114.         '',
1115.         '      Docstring for class attribute InstAttCls.ca3.',
1116.         '',
1117.         '',
1118.         '   .. py:attribute:: InstAttCls.ia1',
1119.         '      :module: target',
1120.         '',
1121.         '      Doc comment for instance attribute InstAttCls.ia1',
1122.         '',
1123.         '',
1124.         '   .. py:attribute:: InstAttCls.ia2',
1125.         '      :module: target',
1126.         '',
1127.         '      Docstring for instance attribute InstAttCls.ia2.',
1128.         ''
1129.     ]
1130. 
1131.     # pick up arbitrary attributes
1132.     options = {"members": 'ca1,ia1'}
1133.     actual = do_autodoc(app, 'class', 'target.InstAttCls', options)
1134.     assert list(actual) == [
1135.         '',
1136.         '.. py:class:: InstAttCls()',
1137.         '   :module: target',
1138.         '',
1139.         '   Class with documented class and instance attributes.',
1140.         '',
1141.         '',
1142.         '   .. py:attribute:: InstAttCls.ca1',
1143.         '      :module: target',
1144.         "      :value: 'a'",
1145.         '',
1146.         '      Doc comment for class attribute InstAttCls.ca1.',
1147.         '      It can have multiple lines.',
1148.         '',
1149.         '',
1150.         '   .. py:attribute:: InstAttCls.ia1',
1151.         '      :module: target',
1152.         '',
1153.         '      Doc comment for instance attribute InstAttCls.ia1',
1154.         ''
1155.     ]
1156. 
1157. 
1158. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1159. def test_autoattribute_instance_attributes(app):
1160.     actual = do_autodoc(app, 'attribute', 'target.InstAttCls.ia1')
1161.     assert list(actual) == [
1162.         '',
1163.         '.. py:attribute:: InstAttCls.ia1',
1164.         '   :module: target',
1165.         '',
1166.         '   Doc comment for instance attribute InstAttCls.ia1',
1167.         ''
1168.     ]
1169. 
1170. 
1171. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1172. def test_slots(app):
1173.     options = {"members": None,
1174.                "undoc-members": True}
1175.     actual = do_autodoc(app, 'module', 'target.slots', options)
1176.     assert list(actual) == [
1177.         '',
1178.         '.. py:module:: target.slots',
1179.         '',
1180.         '',
1181.         '.. py:class:: Bar()',
1182.         '   :module: target.slots',
1183.         '',
1184.         '',
1185.         '   .. py:attribute:: Bar.attr1',
1186.         '      :module: target.slots',
1187.         '',
1188.         '      docstring of attr1',
1189.         '',
1190.         '',
1191.         '   .. py:attribute:: Bar.attr2',
1192.         '      :module: target.slots',
1193.         '',
1194.         '      docstring of instance attr2',
1195.         '',
1196.         '',
1197.         '   .. py:attribute:: Bar.attr3',
1198.         '      :module: target.slots',
1199.         '',
1200.         '',
1201.         '.. py:class:: Foo()',
1202.         '   :module: target.slots',
1203.         '',
1204.         '',
1205.         '   .. py:attribute:: Foo.attr',
1206.         '      :module: target.slots',
1207.         '',
1208.     ]
1209. 
1210. 
1211. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1212. def test_enum_class(app):
1213.     options = {"members": None}
1214.     actual = do_autodoc(app, 'class', 'target.enums.EnumCls', options)
1215.     assert list(actual) == [
1216.         '',
1217.         '.. py:class:: EnumCls(value)',
1218.         '   :module: target.enums',
1219.         '',
1220.         '   this is enum class',
1221.         '',
1222.         '',
1223.         '   .. py:method:: EnumCls.say_goodbye()',
1224.         '      :module: target.enums',
1225.         '      :classmethod:',
1226.         '',
1227.         '      a classmethod says good-bye to you.',
1228.         '',
1229.         '',
1230.         '   .. py:method:: EnumCls.say_hello()',
1231.         '      :module: target.enums',
1232.         '',
1233.         '      a method says hello to you.',
1234.         '',
1235.         '',
1236.         '   .. py:attribute:: EnumCls.val1',
1237.         '      :module: target.enums',
1238.         '      :value: 12',
1239.         '',
1240.         '      doc for val1',
1241.         '',
1242.         '',
1243.         '   .. py:attribute:: EnumCls.val2',
1244.         '      :module: target.enums',
1245.         '      :value: 23',
1246.         '',
1247.         '      doc for val2',
1248.         '',
1249.         '',
1250.         '   .. py:attribute:: EnumCls.val3',
1251.         '      :module: target.enums',
1252.         '      :value: 34',
1253.         '',
1254.         '      doc for val3',
1255.         '',
1256.     ]
1257. 
1258.     # checks for an attribute of EnumClass
1259.     actual = do_autodoc(app, 'attribute', 'target.enums.EnumCls.val1')
1260.     assert list(actual) == [
1261.         '',
1262.         '.. py:attribute:: EnumCls.val1',
1263.         '   :module: target.enums',
1264.         '   :value: 12',
1265.         '',
1266.         '   doc for val1',
1267.         ''
1268.     ]
1269. 
1270. 
1271. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1272. def test_descriptor_class(app):
1273.     options = {"members": 'CustomDataDescriptor,CustomDataDescriptor2'}
1274.     actual = do_autodoc(app, 'module', 'target.descriptor', options)
1275.     assert list(actual) == [
1276.         '',
1277.         '.. py:module:: target.descriptor',
1278.         '',
1279.         '',
1280.         '.. py:class:: CustomDataDescriptor(doc)',
1281.         '   :module: target.descriptor',
1282.         '',
1283.         '   Descriptor class docstring.',
1284.         '',
1285.         '',
1286.         '   .. py:method:: CustomDataDescriptor.meth()',
1287.         '      :module: target.descriptor',
1288.         '',
1289.         '      Function.',
1290.         '',
1291.         '',
1292.         '.. py:class:: CustomDataDescriptor2(doc)',
1293.         '   :module: target.descriptor',
1294.         '',
1295.         '   Descriptor class with custom metaclass docstring.',
1296.         '',
1297.     ]
1298. 
1299. 
1300. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1301. def test_automethod_for_builtin(app):
1302.     actual = do_autodoc(app, 'method', 'builtins.int.__add__')
1303.     assert list(actual) == [
1304.         '',
1305.         '.. py:method:: int.__add__(value, /)',
1306.         '   :module: builtins',
1307.         '',
1308.         '   Return self+value.',
1309.         '',
1310.     ]
1311. 
1312. 
1313. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1314. def test_automethod_for_decorated(app):
1315.     actual = do_autodoc(app, 'method', 'target.decorator.Bar.meth')
1316.     assert list(actual) == [
1317.         '',
1318.         '.. py:method:: Bar.meth(name=None, age=None)',
1319.         '   :module: target.decorator',
1320.         '',
1321.     ]
1322. 
1323. 
1324. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1325. def test_abstractmethods(app):
1326.     options = {"members": None,
1327.                "undoc-members": None}
1328.     actual = do_autodoc(app, 'module', 'target.abstractmethods', options)
1329.     assert list(actual) == [
1330.         '',
1331.         '.. py:module:: target.abstractmethods',
1332.         '',
1333.         '',
1334.         '.. py:class:: Base()',
1335.         '   :module: target.abstractmethods',
1336.         '',
1337.         '',
1338.         '   .. py:method:: Base.abstractmeth()',
1339.         '      :module: target.abstractmethods',
1340.         '      :abstractmethod:',
1341.         '',
1342.         '',
1343.         '   .. py:method:: Base.classmeth()',
1344.         '      :module: target.abstractmethods',
1345.         '      :abstractmethod:',
1346.         '      :classmethod:',
1347.         '',
1348.         '',
1349.         '   .. py:method:: Base.coroutinemeth()',
1350.         '      :module: target.abstractmethods',
1351.         '      :abstractmethod:',
1352.         '      :async:',
1353.         '',
1354.         '',
1355.         '   .. py:method:: Base.meth()',
1356.         '      :module: target.abstractmethods',
1357.         '',
1358.         '',
1359.         '   .. py:method:: Base.prop',
1360.         '      :module: target.abstractmethods',
1361.         '      :abstractmethod:',
1362.         '      :property:',
1363.         '',
1364.         '',
1365.         '   .. py:method:: Base.staticmeth()',
1366.         '      :module: target.abstractmethods',
1367.         '      :abstractmethod:',
1368.         '      :staticmethod:',
1369.         '',
1370.     ]
1371. 
1372. 
1373. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1374. def test_partialfunction(app):
1375.     options = {"members": None}
1376.     actual = do_autodoc(app, 'module', 'target.partialfunction', options)
1377.     assert list(actual) == [
1378.         '',
1379.         '.. py:module:: target.partialfunction',
1380.         '',
1381.         '',
1382.         '.. py:function:: func1(a, b, c)',
1383.         '   :module: target.partialfunction',
1384.         '',
1385.         '   docstring of func1',
1386.         '',
1387.         '',
1388.         '.. py:function:: func2(b, c)',
1389.         '   :module: target.partialfunction',
1390.         '',
1391.         '   docstring of func1',
1392.         '',
1393.         '',
1394.         '.. py:function:: func3(c)',
1395.         '   :module: target.partialfunction',
1396.         '',
1397.         '   docstring of func3',
1398.         '',
1399.         '',
1400.         '.. py:function:: func4()',
1401.         '   :module: target.partialfunction',
1402.         '',
1403.         '   docstring of func3',
1404.         '',
1405.     ]
1406. 
1407. 
1408. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1409. def test_imported_partialfunction_should_not_shown_without_imported_members(app):
1410.     options = {"members": None}
1411.     actual = do_autodoc(app, 'module', 'target.imported_members', options)
1412.     assert list(actual) == [
1413.         '',
1414.         '.. py:module:: target.imported_members',
1415.         ''
1416.     ]
1417. 
1418. 
1419. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1420. def test_bound_method(app):
1421.     options = {"members": None}
1422.     actual = do_autodoc(app, 'module', 'target.bound_method', options)
1423.     assert list(actual) == [
1424.         '',
1425.         '.. py:module:: target.bound_method',
1426.         '',
1427.         '',
1428.         '.. py:function:: bound_method()',
1429.         '   :module: target.bound_method',
1430.         '',
1431.         '   Method docstring',
1432.         '',
1433.     ]
1434. 
1435. 
1436. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1437. def test_coroutine(app):
1438.     actual = do_autodoc(app, 'function', 'target.functions.coroutinefunc')
1439.     assert list(actual) == [
1440.         '',
1441.         '.. py:function:: coroutinefunc()',
1442.         '   :module: target.functions',
1443.         '   :async:',
1444.         '',
1445.     ]
1446. 
1447.     options = {"members": None}
1448.     actual = do_autodoc(app, 'class', 'target.coroutine.AsyncClass', options)
1449.     assert list(actual) == [
1450.         '',
1451.         '.. py:class:: AsyncClass()',
1452.         '   :module: target.coroutine',
1453.         '',
1454.         '',
1455.         '   .. py:method:: AsyncClass.do_coroutine()',
1456.         '      :module: target.coroutine',
1457.         '      :async:',
1458.         '',
1459.         '      A documented coroutine function',
1460.         '',
1461.         '',
1462.         '   .. py:method:: AsyncClass.do_coroutine2()',
1463.         '      :module: target.coroutine',
1464.         '      :async:',
1465.         '      :classmethod:',
1466.         '',
1467.         '      A documented coroutine classmethod',
1468.         '',
1469.         '',
1470.         '   .. py:method:: AsyncClass.do_coroutine3()',
1471.         '      :module: target.coroutine',
1472.         '      :async:',
1473.         '      :staticmethod:',
1474.         '',
1475.         '      A documented coroutine staticmethod',
1476.         '',
1477.     ]
1478. 
1479.     # force-synchronized wrapper
1480.     actual = do_autodoc(app, 'function', 'target.coroutine.sync_func')
1481.     assert list(actual) == [
1482.         '',
1483.         '.. py:function:: sync_func()',
1484.         '   :module: target.coroutine',
1485.         '',
1486.     ]
1487. 
1488. 
1489. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1490. def test_partialmethod(app):
1491.     expected = [
1492.         '',
1493.         '.. py:class:: Cell()',
1494.         '   :module: target.partialmethod',
1495.         '',
1496.         '   An example for partialmethod.',
1497.         '',
1498.         '   refs: https://docs.python.jp/3/library/functools.html#functools.partialmethod',
1499.         '',
1500.         '',
1501.         '   .. py:method:: Cell.set_alive()',
1502.         '      :module: target.partialmethod',
1503.         '',
1504.         '      Make a cell alive.',
1505.         '',
1506.         '',
1507.         '   .. py:method:: Cell.set_state(state)',
1508.         '      :module: target.partialmethod',
1509.         '',
1510.         '      Update state of cell to *state*.',
1511.         '',
1512.     ]
1513. 
1514.     options = {"members": None}
1515.     actual = do_autodoc(app, 'class', 'target.partialmethod.Cell', options)
1516.     assert list(actual) == expected
1517. 
1518. 
1519. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1520. def test_partialmethod_undoc_members(app):
1521.     expected = [
1522.         '',
1523.         '.. py:class:: Cell()',
1524.         '   :module: target.partialmethod',
1525.         '',
1526.         '   An example for partialmethod.',
1527.         '',
1528.         '   refs: https://docs.python.jp/3/library/functools.html#functools.partialmethod',
1529.         '',
1530.         '',
1531.         '   .. py:method:: Cell.set_alive()',
1532.         '      :module: target.partialmethod',
1533.         '',
1534.         '      Make a cell alive.',
1535.         '',
1536.         '',
1537.         '   .. py:method:: Cell.set_dead()',
1538.         '      :module: target.partialmethod',
1539.         '',
1540.         '',
1541.         '   .. py:method:: Cell.set_state(state)',
1542.         '      :module: target.partialmethod',
1543.         '',
1544.         '      Update state of cell to *state*.',
1545.         '',
1546.     ]
1547. 
1548.     options = {"members": None,
1549.                "undoc-members": None}
1550.     actual = do_autodoc(app, 'class', 'target.partialmethod.Cell', options)
1551.     assert list(actual) == expected
1552. 
1553. 
1554. @pytest.mark.skipif(sys.version_info < (3, 6), reason='py36+ is available since python3.6.')
1555. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1556. def test_autodoc_typed_instance_variables(app):
1557.     options = {"members": None,
1558.                "undoc-members": True}
1559.     actual = do_autodoc(app, 'module', 'target.typed_vars', options)
1560.     assert list(actual) == [
1561.         '',
1562.         '.. py:module:: target.typed_vars',
1563.         '',
1564.         '',
1565.         '.. py:class:: Class()',
1566.         '   :module: target.typed_vars',
1567.         '',
1568.         '',
1569.         '   .. py:attribute:: Class.attr1',
1570.         '      :module: target.typed_vars',
1571.         '      :type: int',
1572.         '      :value: 0',
1573.         '',
1574.         '',
1575.         '   .. py:attribute:: Class.attr2',
1576.         '      :module: target.typed_vars',
1577.         '      :type: int',
1578.         '',
1579.         '',
1580.         '   .. py:attribute:: Class.attr3',
1581.         '      :module: target.typed_vars',
1582.         '      :type: int',
1583.         '      :value: 0',
1584.         '',
1585.         '',
1586.         '   .. py:attribute:: Class.attr4',
1587.         '      :module: target.typed_vars',
1588.         '      :type: int',
1589.         '',
1590.         '      attr4',
1591.         '',
1592.         '',
1593.         '   .. py:attribute:: Class.attr5',
1594.         '      :module: target.typed_vars',
1595.         '      :type: int',
1596.         '',
1597.         '      attr5',
1598.         '',
1599.         '',
1600.         '   .. py:attribute:: Class.attr6',
1601.         '      :module: target.typed_vars',
1602.         '      :type: int',
1603.         '',
1604.         '      attr6',
1605.         '',
1606.         '',
1607.         '   .. py:attribute:: Class.descr4',
1608.         '      :module: target.typed_vars',
1609.         '      :type: int',
1610.         '',
1611.         '      This is descr4',
1612.         '',
1613.         '',
1614.         '.. py:class:: Derived()',
1615.         '   :module: target.typed_vars',
1616.         '',
1617.         '',
1618.         '   .. py:attribute:: Derived.attr7',
1619.         '      :module: target.typed_vars',
1620.         '      :type: int',
1621.         '',
1622.         '',
1623.         '.. py:data:: attr1',
1624.         '   :module: target.typed_vars',
1625.         '   :type: str',
1626.         "   :value: ''",
1627.         '',
1628.         '   attr1',
1629.         '',
1630.         '',
1631.         '.. py:data:: attr2',
1632.         '   :module: target.typed_vars',
1633.         '   :type: str',
1634.         '',
1635.         '   attr2',
1636.         '',
1637.         '',
1638.         '.. py:data:: attr3',
1639.         '   :module: target.typed_vars',
1640.         '   :type: str',
1641.         "   :value: ''",
1642.         '',
1643.         '   attr3',
1644.         '',
1645.     ]
1646. 
1647. 
1648. @pytest.mark.skipif(sys.version_info < (3, 6), reason='py36+ is available since python3.6.')
1649. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1650. def test_autodoc_typed_inherited_instance_variables(app):
1651.     options = {"members": None,
1652.                "undoc-members": True,
1653.                "inherited-members": True}
1654.     actual = do_autodoc(app, 'class', 'target.typed_vars.Derived', options)
1655.     assert list(actual) == [
1656.         '',
1657.         '.. py:class:: Derived()',
1658.         '   :module: target.typed_vars',
1659.         '',
1660.         '',
1661.         '   .. py:attribute:: Derived.attr1',
1662.         '      :module: target.typed_vars',
1663.         '      :type: int',
1664.         '      :value: 0',
1665.         '',
1666.         '',
1667.         '   .. py:attribute:: Derived.attr2',
1668.         '      :module: target.typed_vars',
1669.         '      :type: int',
1670.         '',
1671.         '',
1672.         '   .. py:attribute:: Derived.attr3',
1673.         '      :module: target.typed_vars',
1674.         '      :value: 0',
1675.         '',
1676.         '',
1677.         '   .. py:attribute:: Derived.attr7',
1678.         '      :module: target.typed_vars',
1679.         '      :type: int',
1680.         '',
1681.         '',
1682.         '   .. py:attribute:: Derived.descr4',
1683.         '      :module: target.typed_vars',
1684.         '      :type: int',
1685.         '',
1686.     ]
1687. 
1688. 
1689. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1690. def test_autodoc_GenericAlias(app):
1691.     options = {"members": None,
1692.                "undoc-members": None}
1693.     actual = do_autodoc(app, 'module', 'target.genericalias', options)
1694.     if sys.version_info < (3, 7):
1695.         assert list(actual) == [
1696.             '',
1697.             '.. py:module:: target.genericalias',
1698.             '',
1699.             '',
1700.             '.. py:attribute:: T',
1701.             '   :module: target.genericalias',
1702.             '',
1703.             '   alias of :class:`typing.List`',
1704.         ]
1705.     else:
1706.         assert list(actual) == [
1707.             '',
1708.             '.. py:module:: target.genericalias',
1709.             '',
1710.             '',
1711.             '.. py:data:: T',
1712.             '   :module: target.genericalias',
1713.             '',
1714.             '   A list of int',
1715.             '',
1716.             '   alias of List[int]',
1717.         ]
1718. 
1719. 
1720. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1721. def test_autodoc_TypeVar(app):
1722.     options = {"members": None,
1723.                "undoc-members": None}
1724.     actual = do_autodoc(app, 'module', 'target.typevar', options)
1725.     assert list(actual) == [
1726.         '',
1727.         '.. py:module:: target.typevar',
1728.         '',
1729.         '',
1730.         '.. py:data:: T1',
1731.         '   :module: target.typevar',
1732.         '',
1733.         '   T1',
1734.         '',
1735.         "   alias of TypeVar('T1')",
1736.         '',
1737.         '.. py:data:: T3',
1738.         '   :module: target.typevar',
1739.         '',
1740.         '   T3',
1741.         '',
1742.         "   alias of TypeVar('T3', int, str)",
1743.         '',
1744.         '.. py:data:: T4',
1745.         '   :module: target.typevar',
1746.         '',
1747.         '   T4',
1748.         '',
1749.         "   alias of TypeVar('T4', covariant=True)",
1750.         '',
1751.         '.. py:data:: T5',
1752.         '   :module: target.typevar',
1753.         '',
1754.         '   T5',
1755.         '',
1756.         "   alias of TypeVar('T5', contravariant=True)",
1757.     ]
1758. 
1759. 
1760. @pytest.mark.skipif(sys.version_info < (3, 9), reason='py39+ is required.')
1761. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1762. def test_autodoc_Annotated(app):
1763.     options = {"members": None}
1764.     actual = do_autodoc(app, 'module', 'target.annotated', options)
1765.     assert list(actual) == [
1766.         '',
1767.         '.. py:module:: target.annotated',
1768.         '',
1769.         '',
1770.         '.. py:function:: hello(name: str) -> None',
1771.         '   :module: target.annotated',
1772.         '',
1773.         '   docstring',
1774.         '',
1775.     ]
1776. 
1777. 
1778. @pytest.mark.skipif(sys.version_info < (3, 6), reason='py36+ is required.')
1779. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1780. def test_autodoc_TYPE_CHECKING(app):
1781.     options = {"members": None,
1782.                "undoc-members": None}
1783.     actual = do_autodoc(app, 'module', 'target.TYPE_CHECKING', options)
1784.     assert list(actual) == [
1785.         '',
1786.         '.. py:module:: target.TYPE_CHECKING',
1787.         '',
1788.         '',
1789.         '.. py:class:: Foo()',
1790.         '   :module: target.TYPE_CHECKING',
1791.         '',
1792.         '',
1793.         '   .. py:attribute:: Foo.attr1',
1794.         '      :module: target.TYPE_CHECKING',
1795.         '      :type: StringIO',
1796.         '',
1797.     ]
1798. 
1799. 
1800. @pytest.mark.sphinx('html', testroot='pycode-egg')
1801. def test_autodoc_for_egged_code(app):
1802.     options = {"members": None,
1803.                "undoc-members": None}
1804.     actual = do_autodoc(app, 'module', 'sample', options)
1805.     assert list(actual) == [
1806.         '',
1807.         '.. py:module:: sample',
1808.         '',
1809.         '',
1810.         '.. py:data:: CONSTANT',
1811.         '   :module: sample',
1812.         '   :value: 1',
1813.         '',
1814.         '   constant on sample.py',
1815.         '',
1816.         '',
1817.         '.. py:function:: hello(s)',
1818.         '   :module: sample',
1819.         ''
1820.     ]
1821. 
1822. 
1823. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1824. def test_singledispatch(app):
1825.     options = {"members": None}
1826.     actual = do_autodoc(app, 'module', 'target.singledispatch', options)
1827.     assert list(actual) == [
1828.         '',
1829.         '.. py:module:: target.singledispatch',
1830.         '',
1831.         '',
1832.         '.. py:function:: func(arg, kwarg=None)',
1833.         '                 func(arg: int, kwarg=None)',
1834.         '                 func(arg: str, kwarg=None)',
1835.         '   :module: target.singledispatch',
1836.         '',
1837.         '   A function for general use.',
1838.         '',
1839.     ]
1840. 
1841. 
1842. @pytest.mark.skipif(sys.version_info < (3, 8),
1843.                     reason='singledispatchmethod is available since python3.8')
1844. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1845. def test_singledispatchmethod(app):
1846.     options = {"members": None}
1847.     actual = do_autodoc(app, 'module', 'target.singledispatchmethod', options)
1848.     assert list(actual) == [
1849.         '',
1850.         '.. py:module:: target.singledispatchmethod',
1851.         '',
1852.         '',
1853.         '.. py:class:: Foo()',
1854.         '   :module: target.singledispatchmethod',
1855.         '',
1856.         '   docstring',
1857.         '',
1858.         '',
1859.         '   .. py:method:: Foo.meth(arg, kwarg=None)',
1860.         '                  Foo.meth(arg: int, kwarg=None)',
1861.         '                  Foo.meth(arg: str, kwarg=None)',
1862.         '      :module: target.singledispatchmethod',
1863.         '',
1864.         '      A method for general use.',
1865.         '',
1866.     ]
1867. 
1868. 
1869. @pytest.mark.skipif(sys.version_info < (3, 8),
1870.                     reason='singledispatchmethod is available since python3.8')
1871. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1872. def test_singledispatchmethod_automethod(app):
1873.     options = {}
1874.     actual = do_autodoc(app, 'method', 'target.singledispatchmethod.Foo.meth', options)
1875.     assert list(actual) == [
1876.         '',
1877.         '.. py:method:: Foo.meth(arg, kwarg=None)',
1878.         '               Foo.meth(arg: int, kwarg=None)',
1879.         '               Foo.meth(arg: str, kwarg=None)',
1880.         '   :module: target.singledispatchmethod',
1881.         '',
1882.         '   A method for general use.',
1883.         '',
1884.     ]
1885. 
1886. 
1887. @pytest.mark.skipif(pyximport is None, reason='cython is not installed')
1888. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1889. def test_cython(app):
1890.     options = {"members": None,
1891.                "undoc-members": None}
1892.     actual = do_autodoc(app, 'module', 'target.cython', options)
1893.     assert list(actual) == [
1894.         '',
1895.         '.. py:module:: target.cython',
1896.         '',
1897.         '',
1898.         '.. py:class:: Class()',
1899.         '   :module: target.cython',
1900.         '',
1901.         '   Docstring.',
1902.         '',
1903.         '',
1904.         '   .. py:method:: Class.meth(name: str, age: int = 0) -> None',
1905.         '      :module: target.cython',
1906.         '',
1907.         '      Docstring.',
1908.         '',
1909.         '',
1910.         '.. py:function:: foo(x: int, *args, y: str, **kwargs)',
1911.         '   :module: target.cython',
1912.         '',
1913.         '   Docstring.',
1914.         '',
1915.     ]
1916. 
1917. 
1918. @pytest.mark.skipif(sys.version_info < (3, 8),
1919.                     reason='typing.final is available since python3.8')
1920. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1921. def test_final(app):
1922.     options = {"members": None}
1923.     actual = do_autodoc(app, 'module', 'target.final', options)
1924.     assert list(actual) == [
1925.         '',
1926.         '.. py:module:: target.final',
1927.         '',
1928.         '',
1929.         '.. py:class:: Class()',
1930.         '   :module: target.final',
1931.         '   :final:',
1932.         '',
1933.         '   docstring',
1934.         '',
1935.         '',
1936.         '   .. py:method:: Class.meth1()',
1937.         '      :module: target.final',
1938.         '      :final:',
1939.         '',
1940.         '      docstring',
1941.         '',
1942.         '',
1943.         '   .. py:method:: Class.meth2()',
1944.         '      :module: target.final',
1945.         '',
1946.         '      docstring',
1947.         '',
1948.     ]
1949. 
1950. 
1951. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1952. def test_overload(app):
1953.     options = {"members": None}
1954.     actual = do_autodoc(app, 'module', 'target.overload', options)
1955.     assert list(actual) == [
1956.         '',
1957.         '.. py:module:: target.overload',
1958.         '',
1959.         '',
1960.         '.. py:class:: Bar(x: int, y: int)',
1961.         '              Bar(x: str, y: str)',
1962.         '   :module: target.overload',
1963.         '',
1964.         '   docstring',
1965.         '',
1966.         '',
1967.         '.. py:class:: Baz(x: int, y: int)',
1968.         '              Baz(x: str, y: str)',
1969.         '   :module: target.overload',
1970.         '',
1971.         '   docstring',
1972.         '',
1973.         '',
1974.         '.. py:class:: Foo(x: int, y: int)',
1975.         '              Foo(x: str, y: str)',
1976.         '   :module: target.overload',
1977.         '',
1978.         '   docstring',
1979.         '',
1980.         '',
1981.         '.. py:class:: Math()',
1982.         '   :module: target.overload',
1983.         '',
1984.         '   docstring',
1985.         '',
1986.         '',
1987.         '   .. py:method:: Math.sum(x: int, y: int) -> int',
1988.         '                  Math.sum(x: float, y: float) -> float',
1989.         '                  Math.sum(x: str, y: str) -> str',
1990.         '      :module: target.overload',
1991.         '',
1992.         '      docstring',
1993.         '',
1994.         '',
1995.         '.. py:function:: sum(x: int, y: int) -> int',
1996.         '                 sum(x: float, y: float) -> float',
1997.         '                 sum(x: str, y: str) -> str',
1998.         '   :module: target.overload',
1999.         '',
2000.         '   docstring',
2001.         '',
2002.     ]
2003. 
2004. 
2005. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2006. def test_pymodule_for_ModuleLevelDocumenter(app):
2007.     app.env.ref_context['py:module'] = 'target.classes'
2008.     actual = do_autodoc(app, 'class', 'Foo')
2009.     assert list(actual) == [
2010.         '',
2011.         '.. py:class:: Foo()',
2012.         '   :module: target.classes',
2013.         '',
2014.     ]
2015. 
2016. 
2017. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2018. def test_pymodule_for_ClassLevelDocumenter(app):
2019.     app.env.ref_context['py:module'] = 'target.methods'
2020.     actual = do_autodoc(app, 'method', 'Base.meth')
2021.     assert list(actual) == [
2022.         '',
2023.         '.. py:method:: Base.meth()',
2024.         '   :module: target.methods',
2025.         '',
2026.     ]
2027. 
2028. 
2029. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2030. def test_pyclass_for_ClassLevelDocumenter(app):
2031.     app.env.ref_context['py:module'] = 'target.methods'
2032.     app.env.ref_context['py:class'] = 'Base'
2033.     actual = do_autodoc(app, 'method', 'meth')
2034.     assert list(actual) == [
2035.         '',
2036.         '.. py:method:: Base.meth()',
2037.         '   :module: target.methods',
2038.         '',
2039.     ]
2040. 
2041. 
2042. @pytest.mark.sphinx('dummy', testroot='ext-autodoc')
2043. def test_autodoc(app, status, warning):
2044.     app.builder.build_all()
2045. 
2046.     content = app.env.get_doctree('index')
2047.     assert isinstance(content[3], addnodes.desc)
2048.     assert content[3][0].astext() == 'autodoc_dummy_module.test()'
2049.     assert content[3][1].astext() == 'Dummy function using dummy.*'
2050. 
2051.     # issue sphinx-doc/sphinx#2437
2052.     assert content[11][-1].astext() == """Dummy class Bar with alias.
2053. 
2054. 
2055. 
2056. my_name
2057. 
2058. alias of bug2437.autodoc_dummy_foo.Foo"""
2059.     assert warning.getvalue() == ''
2060. 
2061. 
2062. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2063. def test_name_conflict(app):
2064.     actual = do_autodoc(app, 'class', 'target.name_conflict.foo')
2065.     assert list(actual) == [
2066.         '',
2067.         '.. py:class:: foo()',
2068.         '   :module: target.name_conflict',
2069.         '',
2070.         '   docstring of target.name_conflict::foo.',
2071.         '',
2072.     ]
2073. 
2074.     actual = do_autodoc(app, 'class', 'target.name_conflict.foo.bar')
2075.     assert list(actual) == [
2076.         '',
2077.         '.. py:class:: bar()',
2078.         '   :module: target.name_conflict.foo',
2079.         '',
2080.         '   docstring of target.name_conflict.foo::bar.',
2081.         '',
2082.     ]
2083. 
2084. 
2085. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2086. def test_name_mangling(app):
2087.     options = {"members": None,
2088.                "undoc-members": None,
2089.                "private-members": None}
2090.     actual = do_autodoc(app, 'module', 'target.name_mangling', options)
2091.     assert list(actual) == [
2092.         '',
2093.         '.. py:module:: target.name_mangling',
2094.         '',
2095.         '',
2096.         '.. py:class:: Bar()',
2097.         '   :module: target.name_mangling',
2098.         '',
2099.         '',
2100.         '   .. py:attribute:: Bar._Baz__email',
2101.         '      :module: target.name_mangling',
2102.         '      :value: None',
2103.         '',
2104.         '      a member having mangled-like name',
2105.         '',
2106.         '',
2107.         '   .. py:attribute:: Bar.__address',
2108.         '      :module: target.name_mangling',
2109.         '      :value: None',
2110.         '',
2111.         '',
2112.         '.. py:class:: Foo()',
2113.         '   :module: target.name_mangling',
2114.         '',
2115.         '',
2116.         '   .. py:attribute:: Foo.__age',
2117.         '      :module: target.name_mangling',
2118.         '      :value: None',
2119.         '',
2120.         '',
2121.         '   .. py:attribute:: Foo.__name',
2122.         '      :module: target.name_mangling',
2123.         '      :value: None',
2124.         '',
2125.         '      name of Foo',
2126.         '',
2127.     ]


File: tests/test_util_inspect.py
Line number range: 1 - 658
Content:
1. """
2.     test_util_inspect
3.     ~~~~~~~~~~~~~~~
4. 
5.     Tests util.inspect functions.
6. 
7.     :copyright: Copyright 2007-2020 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import _testcapi
12. import ast
13. import datetime
14. import functools
15. import sys
16. import types
17. from inspect import Parameter
18. 
19. import pytest
20. 
21. from sphinx.util import inspect
22. from sphinx.util.inspect import stringify_signature, is_builtin_class_method
23. 
24. 
25. def test_signature():
26.     # literals
27.     with pytest.raises(TypeError):
28.         inspect.signature(1)
29. 
30.     with pytest.raises(TypeError):
31.         inspect.signature('')
32. 
33.     # builtins are supported on a case-by-case basis, depending on whether
34.     # they define __text_signature__
35.     if getattr(list, '__text_signature__', None):
36.         sig = inspect.stringify_signature(inspect.signature(list))
37.         assert sig == '(iterable=(), /)'
38.     else:
39.         with pytest.raises(ValueError):
40.             inspect.signature(list)
41. 
42.     # normal function
43.     def func(a, b, c=1, d=2, *e, **f):
44.         pass
45. 
46.     sig = inspect.stringify_signature(inspect.signature(func))
47.     assert sig == '(a, b, c=1, d=2, *e, **f)'
48. 
49. 
50. def test_signature_partial():
51.     def fun(a, b, c=1, d=2):
52.         pass
53.     p = functools.partial(fun, 10, c=11)
54. 
55.     sig = inspect.signature(p)
56.     assert stringify_signature(sig) == '(b, *, c=11, d=2)'
57. 
58. 
59. def test_signature_methods():
60.     class Foo:
61.         def meth1(self, arg1, **kwargs):
62.             pass
63. 
64.         @classmethod
65.         def meth2(cls, arg1, *args, **kwargs):
66.             pass
67. 
68.         @staticmethod
69.         def meth3(arg1, *args, **kwargs):
70.             pass
71. 
72.     @functools.wraps(Foo().meth1)
73.     def wrapped_bound_method(*args, **kwargs):
74.         pass
75. 
76.     # unbound method
77.     sig = inspect.signature(Foo.meth1)
78.     assert stringify_signature(sig) == '(self, arg1, **kwargs)'
79. 
80.     sig = inspect.signature(Foo.meth1, bound_method=True)
81.     assert stringify_signature(sig) == '(arg1, **kwargs)'
82. 
83.     # bound method
84.     sig = inspect.signature(Foo().meth1)
85.     assert stringify_signature(sig) == '(arg1, **kwargs)'
86. 
87.     # class method
88.     sig = inspect.signature(Foo.meth2)
89.     assert stringify_signature(sig) == '(arg1, *args, **kwargs)'
90. 
91.     sig = inspect.signature(Foo().meth2)
92.     assert stringify_signature(sig) == '(arg1, *args, **kwargs)'
93. 
94.     # static method
95.     sig = inspect.signature(Foo.meth3)
96.     assert stringify_signature(sig) == '(arg1, *args, **kwargs)'
97. 
98.     sig = inspect.signature(Foo().meth3)
99.     assert stringify_signature(sig) == '(arg1, *args, **kwargs)'
100. 
101.     # wrapped bound method
102.     sig = inspect.signature(wrapped_bound_method)
103.     assert stringify_signature(sig) == '(*args, **kwargs)'
104. 
105. 
106. def test_signature_partialmethod():
107.     from functools import partialmethod
108. 
109.     class Foo:
110.         def meth1(self, arg1, arg2, arg3=None, arg4=None):
111.             pass
112. 
113.         def meth2(self, arg1, arg2):
114.             pass
115. 
116.         foo = partialmethod(meth1, 1, 2)
117.         bar = partialmethod(meth1, 1, arg3=3)
118.         baz = partialmethod(meth2, 1, 2)
119. 
120.     subject = Foo()
121.     sig = inspect.signature(subject.foo)
122.     assert stringify_signature(sig) == '(arg3=None, arg4=None)'
123. 
124.     sig = inspect.signature(subject.bar)
125.     assert stringify_signature(sig) == '(arg2, *, arg3=3, arg4=None)'
126. 
127.     sig = inspect.signature(subject.baz)
128.     assert stringify_signature(sig) == '()'
129. 
130. 
131. def test_signature_annotations():
132.     from typing_test_data import (f0, f1, f2, f3, f4, f5, f6, f7, f8, f9, f10,
133.                                   f11, f12, f13, f14, f15, f16, f17, f18, f19, f20, f21, Node)
134. 
135.     # Class annotations
136.     sig = inspect.signature(f0)
137.     assert stringify_signature(sig) == '(x: int, y: numbers.Integral) -> None'
138. 
139.     # Generic types with concrete parameters
140.     sig = inspect.signature(f1)
141.     assert stringify_signature(sig) == '(x: List[int]) -> List[int]'
142. 
143.     # TypeVars and generic types with TypeVars
144.     sig = inspect.signature(f2)
145.     assert stringify_signature(sig) == '(x: List[T], y: List[T_co], z: T) -> List[T_contra]'
146. 
147.     # Union types
148.     sig = inspect.signature(f3)
149.     assert stringify_signature(sig) == '(x: Union[str, numbers.Integral]) -> None'
150. 
151.     # Quoted annotations
152.     sig = inspect.signature(f4)
153.     assert stringify_signature(sig) == '(x: str, y: str) -> None'
154. 
155.     # Keyword-only arguments
156.     sig = inspect.signature(f5)
157.     assert stringify_signature(sig) == '(x: int, *, y: str, z: str) -> None'
158. 
159.     # Keyword-only arguments with varargs
160.     sig = inspect.signature(f6)
161.     assert stringify_signature(sig) == '(x: int, *args, y: str, z: str) -> None'
162. 
163.     # Space around '=' for defaults
164.     sig = inspect.signature(f7)
165.     assert stringify_signature(sig) == '(x: int = None, y: dict = {}) -> None'
166. 
167.     # Callable types
168.     sig = inspect.signature(f8)
169.     assert stringify_signature(sig) == '(x: Callable[[int, str], int]) -> None'
170. 
171.     sig = inspect.signature(f9)
172.     assert stringify_signature(sig) == '(x: Callable) -> None'
173. 
174.     # Tuple types
175.     sig = inspect.signature(f10)
176.     assert stringify_signature(sig) == '(x: Tuple[int, str], y: Tuple[int, ...]) -> None'
177. 
178.     # Instance annotations
179.     sig = inspect.signature(f11)
180.     assert stringify_signature(sig) == '(x: CustomAnnotation, y: 123) -> None'
181. 
182.     # tuple with more than two items
183.     sig = inspect.signature(f12)
184.     assert stringify_signature(sig) == '() -> Tuple[int, str, int]'
185. 
186.     # optional
187.     sig = inspect.signature(f13)
188.     assert stringify_signature(sig) == '() -> Optional[str]'
189. 
190.     # optional union
191.     sig = inspect.signature(f20)
192.     assert stringify_signature(sig) == '() -> Optional[Union[int, str]]'
193. 
194.     # Any
195.     sig = inspect.signature(f14)
196.     assert stringify_signature(sig) == '() -> Any'
197. 
198.     # ForwardRef
199.     sig = inspect.signature(f15)
200.     assert stringify_signature(sig) == '(x: Unknown, y: int) -> Any'
201. 
202.     # keyword only arguments (1)
203.     sig = inspect.signature(f16)
204.     assert stringify_signature(sig) == '(arg1, arg2, *, arg3=None, arg4=None)'
205. 
206.     # keyword only arguments (2)
207.     sig = inspect.signature(f17)
208.     assert stringify_signature(sig) == '(*, arg3, arg4)'
209. 
210.     sig = inspect.signature(f18)
211.     assert stringify_signature(sig) == '(self, arg1: Union[int, Tuple] = 10) -> List[Dict]'
212. 
213.     # annotations for variadic and keyword parameters
214.     sig = inspect.signature(f19)
215.     assert stringify_signature(sig) == '(*args: int, **kwargs: str)'
216. 
217.     # default value is inspect.Signature.empty
218.     sig = inspect.signature(f21)
219.     assert stringify_signature(sig) == "(arg1='whatever', arg2)"
220. 
221.     # type hints by string
222.     sig = inspect.signature(Node.children)
223.     if (3, 5, 0) <= sys.version_info < (3, 5, 3):
224.         assert stringify_signature(sig) == '(self) -> List[Node]'
225.     else:
226.         assert stringify_signature(sig) == '(self) -> List[typing_test_data.Node]'
227. 
228.     sig = inspect.signature(Node.__init__)
229.     assert stringify_signature(sig) == '(self, parent: Optional[Node]) -> None'
230. 
231.     # show_annotation is False
232.     sig = inspect.signature(f7)
233.     assert stringify_signature(sig, show_annotation=False) == '(x=None, y={})'
234. 
235.     # show_return_annotation is False
236.     sig = inspect.signature(f7)
237.     assert stringify_signature(sig, show_return_annotation=False) == '(x: int = None, y: dict = {})'
238. 
239. 
240. @pytest.mark.skipif(sys.version_info < (3, 8), reason='python 3.8+ is required.')
241. @pytest.mark.sphinx(testroot='ext-autodoc')
242. def test_signature_annotations_py38(app):
243.     from target.pep570 import foo, bar, baz, qux
244. 
245.     # case: separator at head
246.     sig = inspect.signature(foo)
247.     assert stringify_signature(sig) == '(*, a, b)'
248. 
249.     # case: separator in the middle
250.     sig = inspect.signature(bar)
251.     assert stringify_signature(sig) == '(a, b, /, c, d)'
252. 
253.     sig = inspect.signature(baz)
254.     assert stringify_signature(sig) == '(a, /, *, b)'
255. 
256.     # case: separator at tail
257.     sig = inspect.signature(qux)
258.     assert stringify_signature(sig) == '(a, b, /)'
259. 
260. 
261. def test_signature_from_str_basic():
262.     signature = '(a, b, *args, c=0, d="blah", **kwargs)'
263.     sig = inspect.signature_from_str(signature)
264.     assert list(sig.parameters.keys()) == ['a', 'b', 'args', 'c', 'd', 'kwargs']
265.     assert sig.parameters['a'].name == 'a'
266.     assert sig.parameters['a'].kind == Parameter.POSITIONAL_OR_KEYWORD
267.     assert sig.parameters['a'].default == Parameter.empty
268.     assert sig.parameters['a'].annotation == Parameter.empty
269.     assert sig.parameters['b'].name == 'b'
270.     assert sig.parameters['b'].kind == Parameter.POSITIONAL_OR_KEYWORD
271.     assert sig.parameters['b'].default == Parameter.empty
272.     assert sig.parameters['b'].annotation == Parameter.empty
273.     assert sig.parameters['args'].name == 'args'
274.     assert sig.parameters['args'].kind == Parameter.VAR_POSITIONAL
275.     assert sig.parameters['args'].default == Parameter.empty
276.     assert sig.parameters['args'].annotation == Parameter.empty
277.     assert sig.parameters['c'].name == 'c'
278.     assert sig.parameters['c'].kind == Parameter.KEYWORD_ONLY
279.     assert sig.parameters['c'].default == '0'
280.     assert sig.parameters['c'].annotation == Parameter.empty
281.     assert sig.parameters['d'].name == 'd'
282.     assert sig.parameters['d'].kind == Parameter.KEYWORD_ONLY
283.     assert sig.parameters['d'].default == "'blah'"
284.     assert sig.parameters['d'].annotation == Parameter.empty
285.     assert sig.parameters['kwargs'].name == 'kwargs'
286.     assert sig.parameters['kwargs'].kind == Parameter.VAR_KEYWORD
287.     assert sig.parameters['kwargs'].default == Parameter.empty
288.     assert sig.parameters['kwargs'].annotation == Parameter.empty
289.     assert sig.return_annotation == Parameter.empty
290. 
291. 
292. def test_signature_from_str_default_values():
293.     signature = ('(a=0, b=0.0, c="str", d=b"bytes", e=..., f=True, '
294.                  'g=[1, 2, 3], h={"a": 1}, i={1, 2, 3}, '
295.                  'j=lambda x, y: None, k=None, l=object(), m=foo.bar.CONSTANT)')
296.     sig = inspect.signature_from_str(signature)
297.     assert sig.parameters['a'].default == '0'
298.     assert sig.parameters['b'].default == '0.0'
299.     assert sig.parameters['c'].default == "'str'"
300.     assert sig.parameters['d'].default == "b'bytes'"
301.     assert sig.parameters['e'].default == '...'
302.     assert sig.parameters['f'].default == 'True'
303.     assert sig.parameters['g'].default == '[1, 2, 3]'
304.     assert sig.parameters['h'].default == "{'a': 1}"
305.     assert sig.parameters['i'].default == '{1, 2, 3}'
306.     assert sig.parameters['j'].default == 'lambda x, y: ...'
307.     assert sig.parameters['k'].default == 'None'
308.     assert sig.parameters['l'].default == 'object()'
309.     assert sig.parameters['m'].default == 'foo.bar.CONSTANT'
310. 
311. 
312. def test_signature_from_str_annotations():
313.     signature = '(a: int, *args: bytes, b: str = "blah", **kwargs: float) -> None'
314.     sig = inspect.signature_from_str(signature)
315.     assert list(sig.parameters.keys()) == ['a', 'args', 'b', 'kwargs']
316.     assert sig.parameters['a'].annotation == "int"
317.     assert sig.parameters['args'].annotation == "bytes"
318.     assert sig.parameters['b'].annotation == "str"
319.     assert sig.parameters['kwargs'].annotation == "float"
320.     assert sig.return_annotation == 'None'
321. 
322. 
323. def test_signature_from_str_complex_annotations():
324.     sig = inspect.signature_from_str('() -> Tuple[str, int, ...]')
325.     assert sig.return_annotation == 'Tuple[str, int, ...]'
326. 
327.     sig = inspect.signature_from_str('() -> Callable[[int, int], int]')
328.     assert sig.return_annotation == 'Callable[[int, int], int]'
329. 
330. 
331. def test_signature_from_str_kwonly_args():
332.     sig = inspect.signature_from_str('(a, *, b)')
333.     assert list(sig.parameters.keys()) == ['a', 'b']
334.     assert sig.parameters['a'].kind == Parameter.POSITIONAL_OR_KEYWORD
335.     assert sig.parameters['a'].default == Parameter.empty
336.     assert sig.parameters['b'].kind == Parameter.KEYWORD_ONLY
337.     assert sig.parameters['b'].default == Parameter.empty
338. 
339. 
340. @pytest.mark.skipif(sys.version_info < (3, 8),
341.                     reason='python-3.8 or above is required')
342. def test_signature_from_str_positionaly_only_args():
343.     sig = inspect.signature_from_str('(a, b=0, /, c=1)')
344.     assert list(sig.parameters.keys()) == ['a', 'b', 'c']
345.     assert sig.parameters['a'].kind == Parameter.POSITIONAL_ONLY
346.     assert sig.parameters['a'].default == Parameter.empty
347.     assert sig.parameters['b'].kind == Parameter.POSITIONAL_ONLY
348.     assert sig.parameters['b'].default == '0'
349.     assert sig.parameters['c'].kind == Parameter.POSITIONAL_OR_KEYWORD
350.     assert sig.parameters['c'].default == '1'
351. 
352. 
353. def test_signature_from_str_invalid():
354.     with pytest.raises(SyntaxError):
355.         inspect.signature_from_str('')
356. 
357. 
358. def test_signature_from_ast():
359.     signature = 'def func(a, b, *args, c=0, d="blah", **kwargs): pass'
360.     tree = ast.parse(signature)
361.     sig = inspect.signature_from_ast(tree.body[0])
362.     assert list(sig.parameters.keys()) == ['a', 'b', 'args', 'c', 'd', 'kwargs']
363.     assert sig.parameters['a'].name == 'a'
364.     assert sig.parameters['a'].kind == Parameter.POSITIONAL_OR_KEYWORD
365.     assert sig.parameters['a'].default == Parameter.empty
366.     assert sig.parameters['a'].annotation == Parameter.empty
367.     assert sig.parameters['b'].name == 'b'
368.     assert sig.parameters['b'].kind == Parameter.POSITIONAL_OR_KEYWORD
369.     assert sig.parameters['b'].default == Parameter.empty
370.     assert sig.parameters['b'].annotation == Parameter.empty
371.     assert sig.parameters['args'].name == 'args'
372.     assert sig.parameters['args'].kind == Parameter.VAR_POSITIONAL
373.     assert sig.parameters['args'].default == Parameter.empty
374.     assert sig.parameters['args'].annotation == Parameter.empty
375.     assert sig.parameters['c'].name == 'c'
376.     assert sig.parameters['c'].kind == Parameter.KEYWORD_ONLY
377.     assert sig.parameters['c'].default == '0'
378.     assert sig.parameters['c'].annotation == Parameter.empty
379.     assert sig.parameters['d'].name == 'd'
380.     assert sig.parameters['d'].kind == Parameter.KEYWORD_ONLY
381.     assert sig.parameters['d'].default == "'blah'"
382.     assert sig.parameters['d'].annotation == Parameter.empty
383.     assert sig.parameters['kwargs'].name == 'kwargs'
384.     assert sig.parameters['kwargs'].kind == Parameter.VAR_KEYWORD
385.     assert sig.parameters['kwargs'].default == Parameter.empty
386.     assert sig.parameters['kwargs'].annotation == Parameter.empty
387.     assert sig.return_annotation == Parameter.empty
388. 
389. 
390. def test_safe_getattr_with_default():
391.     class Foo:
392.         def __getattr__(self, item):
393.             raise Exception
394. 
395.     obj = Foo()
396. 
397.     result = inspect.safe_getattr(obj, 'bar', 'baz')
398. 
399.     assert result == 'baz'
400. 
401. 
402. def test_safe_getattr_with_exception():
403.     class Foo:
404.         def __getattr__(self, item):
405.             raise Exception
406. 
407.     obj = Foo()
408. 
409.     try:
410.         inspect.safe_getattr(obj, 'bar')
411.     except AttributeError as exc:
412.         assert exc.args[0] == 'bar'
413.     else:
414.         pytest.fail('AttributeError not raised')
415. 
416. 
417. def test_safe_getattr_with_property_exception():
418.     class Foo:
419.         @property
420.         def bar(self):
421.             raise Exception
422. 
423.     obj = Foo()
424. 
425.     try:
426.         inspect.safe_getattr(obj, 'bar')
427.     except AttributeError as exc:
428.         assert exc.args[0] == 'bar'
429.     else:
430.         pytest.fail('AttributeError not raised')
431. 
432. 
433. def test_safe_getattr_with___dict___override():
434.     class Foo:
435.         @property
436.         def __dict__(self):
437.             raise Exception
438. 
439.     obj = Foo()
440. 
441.     try:
442.         inspect.safe_getattr(obj, 'bar')
443.     except AttributeError as exc:
444.         assert exc.args[0] == 'bar'
445.     else:
446.         pytest.fail('AttributeError not raised')
447. 
448. 
449. def test_dictionary_sorting():
450.     dictionary = {"c": 3, "a": 1, "d": 2, "b": 4}
451.     description = inspect.object_description(dictionary)
452.     assert description == "{'a': 1, 'b': 4, 'c': 3, 'd': 2}"
453. 
454. 
455. def test_set_sorting():
456.     set_ = set("gfedcba")
457.     description = inspect.object_description(set_)
458.     assert description == "{'a', 'b', 'c', 'd', 'e', 'f', 'g'}"
459. 
460. 
461. def test_set_sorting_fallback():
462.     set_ = {None, 1}
463.     description = inspect.object_description(set_)
464.     assert description in ("{1, None}", "{None, 1}")
465. 
466. 
467. def test_frozenset_sorting():
468.     frozenset_ = frozenset("gfedcba")
469.     description = inspect.object_description(frozenset_)
470.     assert description == "frozenset({'a', 'b', 'c', 'd', 'e', 'f', 'g'})"
471. 
472. 
473. def test_frozenset_sorting_fallback():
474.     frozenset_ = frozenset((None, 1))
475.     description = inspect.object_description(frozenset_)
476.     assert description in ("frozenset({1, None})", "frozenset({None, 1})")
477. 
478. 
479. def test_dict_customtype():
480.     class CustomType:
481.         def __init__(self, value):
482.             self._value = value
483. 
484.         def __repr__(self):
485.             return "<CustomType(%r)>" % self._value
486. 
487.     dictionary = {CustomType(2): 2, CustomType(1): 1}
488.     description = inspect.object_description(dictionary)
489.     # Type is unsortable, just check that it does not crash
490.     assert "<CustomType(2)>: 2" in description
491. 
492. 
493. @pytest.mark.sphinx(testroot='ext-autodoc')
494. def test_isclassmethod(app):
495.     from target.methods import Base, Inherited
496. 
497.     assert inspect.isclassmethod(Base.classmeth) is True
498.     assert inspect.isclassmethod(Base.meth) is False
499.     assert inspect.isclassmethod(Inherited.classmeth) is True
500.     assert inspect.isclassmethod(Inherited.meth) is False
501. 
502. 
503. @pytest.mark.sphinx(testroot='ext-autodoc')
504. def test_isstaticmethod(app):
505.     from target.methods import Base, Inherited
506. 
507.     assert inspect.isstaticmethod(Base.staticmeth, Base, 'staticmeth') is True
508.     assert inspect.isstaticmethod(Base.meth, Base, 'meth') is False
509.     assert inspect.isstaticmethod(Inherited.staticmeth, Inherited, 'staticmeth') is True
510.     assert inspect.isstaticmethod(Inherited.meth, Inherited, 'meth') is False
511. 
512. 
513. @pytest.mark.sphinx(testroot='ext-autodoc')
514. def test_iscoroutinefunction(app):
515.     from target.functions import coroutinefunc, func, partial_coroutinefunc
516.     from target.methods import Base
517. 
518.     assert inspect.iscoroutinefunction(func) is False                   # function
519.     assert inspect.iscoroutinefunction(coroutinefunc) is True           # coroutine
520.     assert inspect.iscoroutinefunction(partial_coroutinefunc) is True   # partial-ed coroutine
521.     assert inspect.iscoroutinefunction(Base.meth) is False              # method
522.     assert inspect.iscoroutinefunction(Base.coroutinemeth) is True      # coroutine-method
523. 
524.     # partial-ed coroutine-method
525.     partial_coroutinemeth = Base.__dict__['partial_coroutinemeth']
526.     assert inspect.iscoroutinefunction(partial_coroutinemeth) is True
527. 
528. 
529. @pytest.mark.sphinx(testroot='ext-autodoc')
530. def test_isfunction(app):
531.     from target.functions import builtin_func, partial_builtin_func
532.     from target.functions import func, partial_func
533.     from target.methods import Base
534. 
535.     assert inspect.isfunction(func) is True                     # function
536.     assert inspect.isfunction(partial_func) is True             # partial-ed function
537.     assert inspect.isfunction(Base.meth) is True                # method of class
538.     assert inspect.isfunction(Base.partialmeth) is True         # partial-ed method of class
539.     assert inspect.isfunction(Base().meth) is False             # method of instance
540.     assert inspect.isfunction(builtin_func) is False            # builtin function
541.     assert inspect.isfunction(partial_builtin_func) is False    # partial-ed builtin function
542. 
543. 
544. @pytest.mark.sphinx(testroot='ext-autodoc')
545. def test_isbuiltin(app):
546.     from target.functions import builtin_func, partial_builtin_func
547.     from target.functions import func, partial_func
548.     from target.methods import Base
549. 
550.     assert inspect.isbuiltin(builtin_func) is True          # builtin function
551.     assert inspect.isbuiltin(partial_builtin_func) is True  # partial-ed builtin function
552.     assert inspect.isbuiltin(func) is False                 # function
553.     assert inspect.isbuiltin(partial_func) is False         # partial-ed function
554.     assert inspect.isbuiltin(Base.meth) is False            # method of class
555.     assert inspect.isbuiltin(Base().meth) is False          # method of instance
556. 
557. 
558. @pytest.mark.sphinx(testroot='ext-autodoc')
559. def test_isdescriptor(app):
560.     from target.functions import func
561.     from target.methods import Base
562. 
563.     assert inspect.isdescriptor(Base.prop) is True      # property of class
564.     assert inspect.isdescriptor(Base().prop) is False   # property of instance
565.     assert inspect.isdescriptor(Base.meth) is True      # method of class
566.     assert inspect.isdescriptor(Base().meth) is True    # method of instance
567.     assert inspect.isdescriptor(func) is True           # function
568. 
569. 
570. @pytest.mark.sphinx(testroot='ext-autodoc')
571. def test_isattributedescriptor(app):
572.     from target.methods import Base
573. 
574.     class Descriptor:
575.         def __get__(self, obj, typ=None):
576.             pass
577. 
578.     testinstancemethod = _testcapi.instancemethod(str.__repr__)
579. 
580.     assert inspect.isattributedescriptor(Base.prop) is True                    # property
581.     assert inspect.isattributedescriptor(Base.meth) is False                   # method
582.     assert inspect.isattributedescriptor(Base.staticmeth) is False             # staticmethod
583.     assert inspect.isattributedescriptor(Base.classmeth) is False              # classmetho
584.     assert inspect.isattributedescriptor(Descriptor) is False                  # custom descriptor class    # NOQA
585.     assert inspect.isattributedescriptor(str.join) is False                    # MethodDescriptorType       # NOQA
586.     assert inspect.isattributedescriptor(object.__init__) is False             # WrapperDescriptorType      # NOQA
587.     assert inspect.isattributedescriptor(dict.__dict__['fromkeys']) is False   # ClassMethodDescriptorType  # NOQA
588.     assert inspect.isattributedescriptor(types.FrameType.f_locals) is True     # GetSetDescriptorType       # NOQA
589.     assert inspect.isattributedescriptor(datetime.timedelta.days) is True      # MemberDescriptorType       # NOQA
590.     assert inspect.isattributedescriptor(testinstancemethod) is False          # instancemethod (C-API)     # NOQA
591. 
592. 
593. def test_isproperty(app):
594.     from target.functions import func
595.     from target.methods import Base
596. 
597.     assert inspect.isproperty(Base.prop) is True        # property of class
598.     assert inspect.isproperty(Base().prop) is False     # property of instance
599.     assert inspect.isproperty(Base.meth) is False       # method of class
600.     assert inspect.isproperty(Base().meth) is False     # method of instance
601.     assert inspect.isproperty(func) is False            # function
602. 
603. 
604. @pytest.mark.skipif(sys.version_info < (3, 7), reason='python 3.7+ is required.')
605. @pytest.mark.sphinx(testroot='ext-autodoc')
606. def test_isgenericalias(app):
607.     from target.genericalias import C, T
608.     from target.methods import Base
609. 
610.     assert inspect.isgenericalias(C) is True
611.     assert inspect.isgenericalias(T) is True
612.     assert inspect.isgenericalias(object()) is False
613.     assert inspect.isgenericalias(Base) is False
614. 
615. 
616. def test_unpartial():
617.     def func1(a, b, c):
618.         pass
619. 
620.     func2 = functools.partial(func1, 1)
621.     func2.__doc__ = "func2"
622.     func3 = functools.partial(func2, 2)  # nested partial object
623. 
624.     assert inspect.unpartial(func2) is func1
625.     assert inspect.unpartial(func3) is func1
626. 
627. 
628. def test_getdoc_inherited_decorated_method():
629.     class Foo:
630.         def meth(self):
631.             """docstring."""
632. 
633.     class Bar(Foo):
634.         @functools.lru_cache()
635.         def meth(self):
636.             # inherited and decorated method
637.             pass
638. 
639.     assert inspect.getdoc(Bar.meth, getattr, False, Bar, "meth") is None
640.     assert inspect.getdoc(Bar.meth, getattr, True, Bar, "meth") == "docstring."
641. 
642. 
643. def test_is_builtin_class_method():
644.     class MyInt(int):
645.         def my_method(self):
646.             pass
647. 
648.     assert inspect.is_builtin_class_method(MyInt, 'to_bytes')
649.     assert inspect.is_builtin_class_method(MyInt, '__init__')
650.     assert not inspect.is_builtin_class_method(MyInt, 'my_method')
651.     assert not inspect.is_builtin_class_method(MyInt, 'does_not_exist')
652.     assert not inspect.is_builtin_class_method(4, 'still does not crash')
653. 
654.     class ObjectWithMroAttr:
655.         def __init__(self, mro_attr):
656.             self.__mro__ = mro_attr
657. 
658.     assert not inspect.is_builtin_class_method(ObjectWithMroAttr([1, 2, 3]), 'still does not crash')

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-23 12:35:20,393 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='I have analyzed `tests/test_util_inspect.py` and found that the `test_signature_annotations` function, which is highly relevant to the bug, imports its test data from `tests/typing_test_data.py`. To check if there are any test cases that cover functions with tuple default arguments, I need to inspect the contents of `tests/typing_test_data.py`.' query='Please provide the full content of tests/typing_test_data.py.' extra_requirements='' purpose='This file contains the function definitions used for testing signature parsing in `test_util_inspect.py`, and it is essential for finding a test case related to tuple default arguments.'
2025-12-23 12:35:20,394 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of tests/typing_test_data.py.
2025-12-23 12:35:20,394 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-23 12:35:20,394 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-23 12:35:20,395 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-23 12:35:20,395 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of tests/typing_test_data.py.
Purpose: This file contains the function definitions used for testing signature parsing in `test_util_inspect.py`, and it is essential for finding a test case related to tuple default arguments.
2025-12-23 12:35:22,322 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/typing_test_data.py"}'}, '__gemini_function_call_thought_signatures__': {'f73a3e51-cc35-4515-819f-6d7b7c8fd83a': 'Ct0CAY89a1/IO0UDxZRIl2nhVmyXRIF/Twd0fvrf73uTl6FzERCrmc4T3Cf5ZysUbt4y/SmSrQsVtyomsZJsSda33dJXhqj+4hm7I5VagrHfSCf7rofJBbLaNtCRuTO5MPBr17IJcjHJuO5QEn8H3TeN4lST0zz4dFxoQjsK6v4PLnP0fTDEuk208uqgcrZFpqP6p+v34lOIfNitzTGrfppp6WHSXKLT9rhs81JYh20yYk/l8QyTJh4OsHF32btQ0R+6gfYk5s7maKRWyz6H5PHPGLIKSydojqT+BnPlZnCmN0AMecpGVMhNzF5gyDAtYffChzXPiJn24Hfo5cwKdbjceNerk7123xliIBYnY13uti09fBTyw55dAtc56BYbQ24VWGgJpnWKh7czpclVm4G5UEXcf3/9ZyrY4e2UCng13iqZClfadvn3j6g2B76T3apfzaaNzFTvF6fy3uu0Rw=='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2088, 'candidates_token_count': 23, 'total_token_count': 2196, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2088}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 23}], 'thoughts_token_count': 85, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.1601392289866572, 'model_name': 'gemini-2.5-pro'} id='run--86da6367-2138-4693-b6a1-da52179cff63-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/typing_test_data.py'}, 'id': 'f73a3e51-cc35-4515-819f-6d7b7c8fd83a', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2088, 'output_tokens': 23, 'total_tokens': 2196, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 85}}
2025-12-23 12:35:24,258 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the full content of the file `tests/typing_test_data.py` as you requested. This file contains various function definitions with type hints, which are used for testing purposes in the codebase. You can now examine the file to find the specific test case related to tuple default arguments that you are looking for.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 3327, 'candidates_token_count': 67, 'total_token_count': 3438, 'cached_content_token_count': 1622, 'prompt_tokens_details': [{'modality': 1, 'token_count': 3412}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1622}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 67}], 'thoughts_token_count': 44}, 'finish_reason': 'STOP', 'avg_logprobs': -0.22596947114859053, 'model_name': 'gemini-2.5-pro'} id='run--f655c195-20d3-4ba0-831f-227670d40368-0' usage_metadata={'input_tokens': 3327, 'output_tokens': 67, 'total_tokens': 3438, 'input_token_details': {'cache_read': 1622}, 'output_token_details': {'reasoning': 44}}
2025-12-23 12:35:24,260 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of tests/typing_test_data.py.
--- END QUERY ---



--- BEGIN PURPOSE ---
This file contains the function definitions used for testing signature parsing in `test_util_inspect.py`, and it is essential for finding a test case related to tuple default arguments.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/typing_test_data.py
Line number range: 1 - 113
Content:
1. from inspect import Signature
2. from numbers import Integral
3. from typing import Any, Dict, List, TypeVar, Union, Callable, Tuple, Optional
4. 
5. 
6. def f0(x: int, y: Integral) -> None:
7.     pass
8. 
9. 
10. def f1(x: List[int]) -> List[int]:
11.     pass
12. 
13. 
14. T = TypeVar('T')
15. T_co = TypeVar('T_co', covariant=True)
16. T_contra = TypeVar('T_contra', contravariant=True)
17. 
18. 
19. def f2(x: List[T], y: List[T_co], z: T) -> List[T_contra]:
20.     pass
21. 
22. 
23. def f3(x: Union[str, Integral]) -> None:
24.     pass
25. 
26. 
27. MyStr = str
28. 
29. 
30. def f4(x: 'MyStr', y: MyStr) -> None:
31.     pass
32. 
33. 
34. def f5(x: int, *, y: str, z: str) -> None:
35.     pass
36. 
37. 
38. def f6(x: int, *args, y: str, z: str) -> None:
39.     pass
40. 
41. 
42. def f7(x: int = None, y: dict = {}) -> None:
43.     pass
44. 
45. 
46. def f8(x: Callable[[int, str], int]) -> None:
47.     # See https://github.com/ambv/typehinting/issues/149 for Callable[..., int]
48.     pass
49. 
50. 
51. def f9(x: Callable) -> None:
52.     pass
53. 
54. 
55. def f10(x: Tuple[int, str], y: Tuple[int, ...]) -> None:
56.     pass
57. 
58. 
59. class CustomAnnotation:
60.     def __repr__(self):
61.         return 'CustomAnnotation'
62. 
63. 
64. def f11(x: CustomAnnotation(), y: 123) -> None:
65.     pass
66. 
67. 
68. def f12() -> Tuple[int, str, int]:
69.     pass
70. 
71. 
72. def f13() -> Optional[str]:
73.     pass
74. 
75. 
76. def f14() -> Any:
77.     pass
78. 
79. 
80. def f15(x: "Unknown", y: "int") -> Any:
81.     pass
82. 
83. 
84. def f16(arg1, arg2, *, arg3=None, arg4=None):
85.     pass
86. 
87. 
88. def f17(*, arg3, arg4):
89.     pass
90. 
91. 
92. def f18(self, arg1: Union[int, Tuple] = 10) -> List[Dict]:
93.     pass
94. 
95. 
96. def f19(*args: int, **kwargs: str):
97.     pass
98. 
99. 
100. def f20() -> Optional[Union[int, str]]:
101.     pass
102. 
103. 
104. def f21(arg1='whatever', arg2=Signature.empty):
105.     pass
106. 
107. 
108. class Node:
109.     def __init__(self, parent: Optional['Node']) -> None:
110.         pass
111. 
112.     def children(self) -> List['Node']:
113.         pass

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-23 12:35:29,319 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="1. Query requirement analysis:\n   - The user explicitly asks for the full content of the file `tests/typing_test_data.py`.\n\n2. Extended relevance:\n   - The provided context contains the entire content of the requested file, from line 1 to 113. Therefore, the whole file is relevant to answer the user's query.", relative_path='tests/typing_test_data.py', start_line=1, end_line=113)]
2025-12-23 12:35:29,320 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of tests/typing_test_data.py.
2025-12-23 12:35:29,320 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-23 12:35:29,320 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-23 12:35:29,320 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 2 existing contexts
2025-12-23 12:35:29,320 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 3 total contexts (removed 0 duplicates)
2025-12-23 12:35:29,321 - thread-139574441383616.prometheus_context_collector.lang_graph.nodes.context_refine_node - INFO - Reached max_refined_query_loop, not asking for more context
2025-12-23 12:35:29,322 - thread-139574441383616.prometheus_context_collector - INFO - Successfully retrieved 3 context snippets
