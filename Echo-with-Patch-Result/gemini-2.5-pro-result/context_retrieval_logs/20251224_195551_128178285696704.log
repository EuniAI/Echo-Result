2025-12-24 19:55:51,860 - thread-128178285696704.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: linkcheck could also check local (internal) links

Description: Subject: linkcheck currently doesn't check local (internal) links, but this would be useful.

<!--
  Important: This is a list of issues for Sphinx, not a forum.
  If you'd like to post a question, please move to sphinx-users group.
  https://groups.google.com/forum/#!forum/sphinx-users

  Thanks,
-->

### Problem
See above.

#### Procedure to reproduce the problem
Create a template project with sphinx-quickstart, put the following in index.rst
```
broken external-link_
broken local-link_

.. _external-link: https://lkfqhlkghflkhs
.. _local-link: doesntexist
```

Run `make linkcheck`

#### Error logs / results
```
Running Sphinx v1.7.6
making output directory...
loading pickled environment... done
building [mo]: targets for 0 po files that are out of date
building [linkcheck]: targets for 1 source files that are out of date
updating environment: 0 added, 0 changed, 0 removed
looking for now-outdated files... none found
preparing documents... done
writing output... [100%] index                                                                   
(line   14) -local-   doesntexist
(line   14) broken    https://lkfqhlkghflkhs - HTTPSConnectionPool(host='lkfqhlkghflkhs', port=443): Max retries exceeded with url: / (Caused by NewConnectionError('<urllib3.connection.VerifiedHTTPSConnection object at 0x7faed7ddfc88>: Failed to establish a new connection: [Errno -2] Name or service not known',))

build finished with problems.
make: *** [Makefile:20: linkcheck] Error 1
```

#### Expected results
Also a check for the local link.

### Reproducible project / your project
N/A

### Environment info
- OS: Arch Linux
- Python version: 3.6
- Sphinx version: 1.7.6


Patch information:
diff --git a/doc/usage/builders/index.rst b/doc/usage/builders/index.rst
index db6706944..c860a2517 100644
--- a/doc/usage/builders/index.rst
+++ b/doc/usage/builders/index.rst
@@ -428,9 +428,11 @@ name is ``rinoh``. Refer to the `rinohtype manual`_ for details.
 .. module:: sphinx.builders.linkcheck
 .. class:: CheckExternalLinksBuilder
 
-   This builder scans all documents for external links, tries to open them with
-   ``requests``, and writes an overview which ones are broken and redirected to
-   standard output and to :file:`output.txt` in the output directory.
+   This builder scans all documents for external HTTP(S) links and local
+   links. External links are tried to open with ``requests`` while local
+   links are checked for existence on disk. It writes an overview which
+   ones are broken and redirected to standard output and to :file:`output.txt`
+   in the output directory.
 
    .. autoattribute:: name
 
diff --git a/sphinx/builders/linkcheck.py b/sphinx/builders/linkcheck.py
index dd5317087..c159b273f 100644
--- a/sphinx/builders/linkcheck.py
+++ b/sphinx/builders/linkcheck.py
@@ -77,7 +77,11 @@ def check_anchor(response: requests.requests.Response, anchor: str) -> bool:
 
 class CheckExternalLinksBuilder(Builder):
     """
-    Checks for broken external links.
+    Checks for broken links.
+
+    This builder scans all documents for external HTTP(S) links and local
+    (internal) links. External links are validated via HTTP requests, and
+    local links are checked for existence on disk.
     """
     name = 'linkcheck'
     epilog = __('Look for any errors in the above output or in '
@@ -213,7 +217,17 @@ class CheckExternalLinksBuilder(Builder):
             if len(uri) == 0 or uri.startswith(('#', 'mailto:', 'ftp:')):
                 return 'unchecked', '', 0
             elif not uri.startswith(('http:', 'https:')):
-                return 'local', '', 0
+                # Check local (internal) links by resolving against the document path
+                local_uri = uri.split('#', 1)[0] if '#' in uri else uri
+                try:
+                    rel_fn, abs_fn = self.env.relfn2path(local_uri, docname)
+                except Exception:
+                    # If resolution fails, consider as broken
+                    return 'broken', __("Local path could not be resolved: %s") % local_uri, 0
+                if path.exists(abs_fn):
+                    return 'working', '', 0
+                else:
+                    return 'broken', __("Local path not found: %s") % rel_fn, 0
             elif uri in self.good:
                 return 'working', 'old', 0
             elif uri in self.broken:
@@ -324,7 +338,7 @@ class CheckExternalLinksBuilder(Builder):
         # image nodes
         for imgnode in doctree.traverse(nodes.image):
             uri = imgnode['candidates'].get('?')
-            if uri and '://' in uri:
+            if uri:
                 lineno = get_node_line(imgnode)
                 self.wqueue.put((uri, docname, lineno), False)
                 n += 1


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-12-24 19:55:51,923 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sphinx
├── .circleci
|   └── config.yml
├── .codecov.yml
├── .github
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.md
|   |   ├── config.yml
|   |   └── feature_request.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   └── workflows
|       ├── builddoc.yml
|       ├── lint.yml
|       └── main.yml
├── .travis.yml
├── CONTRIBUTING.rst
├── README.rst
├── bindep.txt
├── doc
|   ├── _static
|   |   ├── conf.py.txt
|   |   └── themes
|   |       └── fullsize
|   ├── _templates
|   |   ├── index.html
|   |   └── indexsidebar.html
|   ├── _themes
|   |   └── sphinx13
|   |       ├── layout.html
|   |       └── static
|   |           └── sphinx13.css
|   ├── changes.rst
|   ├── conf.py
|   ├── contents.rst
|   ├── develop.rst
|   ├── development
|   |   ├── index.rst
|   |   └── tutorials
|   |       ├── examples
|   |       |   ├── README.rst
|   |       |   ├── helloworld.py
|   |       |   ├── recipe.py
|   |       |   └── todo.py
|   |       ├── helloworld.rst
|   |       ├── index.rst
|   |       ├── recipe.rst
|   |       └── todo.rst
|   ├── examples.rst
|   ├── extdev
|   |   ├── appapi.rst
|   |   ├── builderapi.rst
|   |   ├── collectorapi.rst
|   |   ├── deprecated.rst
|   |   ├── domainapi.rst
|   |   ├── envapi.rst
|   |   ├── i18n.rst
|   |   ├── index.rst
|   |   ├── logging.rst
|   |   ├── markupapi.rst
|   |   ├── nodes.rst
|   |   ├── parserapi.rst
|   |   ├── projectapi.rst
|   |   └── utils.rst
|   ├── faq.rst
|   ├── glossary.rst
|   ├── internals
|   |   ├── authors.rst
|   |   ├── code-of-conduct.rst
|   |   ├── contributing.rst
|   |   ├── index.rst
|   |   ├── organization.rst
|   |   └── release-process.rst
|   ├── latex.rst
|   ├── man
|   |   ├── index.rst
|   |   ├── sphinx-apidoc.rst
|   |   ├── sphinx-autogen.rst
|   |   ├── sphinx-build.rst
|   |   └── sphinx-quickstart.rst
|   ├── templating.rst
|   ├── theming.rst
|   └── usage
|       ├── advanced
|       |   ├── intl.rst
|       |   ├── setuptools.rst
|       |   └── websupport
|       |       ├── api.rst
|       |       ├── index.rst
|       |       ├── quickstart.rst
|       |       ├── searchadapters.rst
|       |       └── storagebackends.rst
|       ├── builders
|       |   └── index.rst
|       ├── configuration.rst
|       ├── extensions
|       |   ├── autodoc.rst
|       |   ├── autosectionlabel.rst
|       |   ├── autosummary.rst
|       |   ├── coverage.rst
|       |   ├── doctest.rst
|       |   ├── duration.rst
|       |   ├── example_google.py
|       |   ├── example_google.rst
|       |   ├── example_numpy.py
|       |   ├── example_numpy.rst
|       |   ├── extlinks.rst
|       |   ├── githubpages.rst
|       |   ├── graphviz.rst
|       |   ├── ifconfig.rst
|       |   ├── imgconverter.rst
|       |   ├── index.rst
|       |   ├── inheritance.rst
|       |   ├── intersphinx.rst
|       |   ├── linkcode.rst
|       |   ├── math.rst
|       |   ├── napoleon.rst
|       |   ├── todo.rst
|       |   └── viewcode.rst
|       ├── index.rst
|       ├── installation.rst
|       ├── markdown.rst
|       ├── quickstart.rst
|       ├── restructuredtext
|       |   ├── basics.rst
|       |   ├── directives.rst
|       |   ├── domains.rst
|       |   ├── field-lists.rst
|       |   ├── index.rst
|       |   └── roles.rst
|       └── theming.rst
├── karma.conf.js
├── setup.py
├── sphinx
|   ├── __init__.py
|   ├── __main__.py
|   ├── addnodes.py
|   ├── application.py
|   ├── builders
|   |   ├── __init__.py
|   |   ├── _epub_base.py
|   |   ├── applehelp.py
|   |   ├── changes.py
|   |   ├── devhelp.py
|   |   ├── dirhtml.py
|   |   ├── dummy.py
|   |   ├── epub3.py
|   |   ├── gettext.py
|   |   ├── html
|   |   |   ├── __init__.py
|   |   |   └── transforms.py
|   |   ├── htmlhelp.py
|   |   ├── latex
|   |   |   ├── __init__.py
|   |   |   ├── constants.py
|   |   |   ├── nodes.py
|   |   |   ├── theming.py
|   |   |   ├── transforms.py
|   |   |   └── util.py
|   |   ├── linkcheck.py
|   |   ├── manpage.py
|   |   ├── qthelp.py
|   |   ├── singlehtml.py
|   |   ├── texinfo.py
|   |   ├── text.py
|   |   └── xml.py
|   ├── cmd
|   |   ├── __init__.py
|   |   ├── build.py
|   |   ├── make_mode.py
|   |   └── quickstart.py
|   ├── config.py
|   ├── deprecation.py
|   ├── directives
|   |   ├── __init__.py
|   |   ├── code.py
|   |   ├── other.py
|   |   └── patches.py
|   ├── domains
|   |   ├── __init__.py
|   |   ├── c.py
|   |   ├── changeset.py
|   |   ├── citation.py
|   |   ├── cpp.py
|   |   ├── index.py
|   |   ├── javascript.py
|   |   ├── math.py
|   |   ├── python.py
|   |   ├── rst.py
|   |   └── std.py
|   ├── environment
|   |   ├── __init__.py
|   |   ├── adapters
|   |   |   ├── __init__.py
|   |   |   ├── asset.py
|   |   |   ├── indexentries.py
|   |   |   └── toctree.py
|   |   └── collectors
|   |       ├── __init__.py
|   |       ├── asset.py
|   |       ├── dependencies.py
|   |       ├── indexentries.py
|   |       ├── metadata.py
|   |       ├── title.py
|   |       └── toctree.py
|   ├── errors.py
|   ├── events.py
|   ├── ext
|   |   ├── __init__.py
|   |   ├── apidoc.py
|   |   ├── autodoc
|   |   |   ├── __init__.py
|   |   |   ├── directive.py
|   |   |   ├── importer.py
|   |   |   ├── mock.py
|   |   |   ├── type_comment.py
|   |   |   └── typehints.py
|   |   ├── autosectionlabel.py
|   |   ├── autosummary
|   |   |   ├── __init__.py
|   |   |   ├── generate.py
|   |   |   └── templates
|   |   |       └── autosummary
|   |   ├── coverage.py
|   |   ├── doctest.py
|   |   ├── duration.py
|   |   ├── extlinks.py
|   |   ├── githubpages.py
|   |   ├── graphviz.py
|   |   ├── ifconfig.py
|   |   ├── imgconverter.py
|   |   ├── imgmath.py
|   |   ├── inheritance_diagram.py
|   |   ├── intersphinx.py
|   |   ├── jsmath.py
|   |   ├── linkcode.py
|   |   ├── mathjax.py
|   |   ├── napoleon
|   |   |   ├── __init__.py
|   |   |   ├── docstring.py
|   |   |   └── iterators.py
|   |   ├── todo.py
|   |   └── viewcode.py
|   ├── extension.py
|   ├── highlighting.py
|   ├── io.py
|   ├── jinja2glue.py
|   ├── locale
|   |   ├── __init__.py
|   |   ├── ar
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bg
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bn
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ca
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cak
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cs
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cy
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── da
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── de
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── el
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eo
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── es
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── et
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fa
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── he
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi_IN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── id
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── it
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ja
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ko
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── mk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nb_NO
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ne
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_BR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_PT
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ro
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ru
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── si
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sq
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr@latin
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr_RS
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ta
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── te
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── tr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── uk_UA
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ur
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── vi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_CN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   └── zh_TW
|   |       └── LC_MESSAGES
|   |           └── sphinx.js
|   ├── parsers.py
|   ├── project.py
|   ├── pycode
|   |   ├── __init__.py
|   |   ├── ast.py
|   |   └── parser.py
|   ├── pygments_styles.py
|   ├── registry.py
|   ├── roles.py
|   ├── search
|   |   ├── __init__.py
|   |   ├── da.py
|   |   ├── de.py
|   |   ├── en.py
|   |   ├── es.py
|   |   ├── fi.py
|   |   ├── fr.py
|   |   ├── hu.py
|   |   ├── it.py
|   |   ├── ja.py
|   |   ├── jssplitter.py
|   |   ├── nl.py
|   |   ├── no.py
|   |   ├── non-minified-js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── pt.py
|   |   ├── ro.py
|   |   ├── ru.py
|   |   ├── sv.py
|   |   ├── tr.py
|   |   └── zh.py
|   ├── setup_command.py
|   ├── templates
|   |   ├── apidoc
|   |   ├── epub3
|   |   |   └── container.xml
|   |   ├── gettext
|   |   ├── graphviz
|   |   |   └── graphviz.css
|   |   ├── htmlhelp
|   |   ├── imgmath
|   |   ├── latex
|   |   ├── quickstart
|   |   └── texinfo
|   ├── testing
|   |   ├── __init__.py
|   |   ├── comparer.py
|   |   ├── fixtures.py
|   |   ├── path.py
|   |   ├── restructuredtext.py
|   |   └── util.py
|   ├── texinputs
|   ├── texinputs_win
|   ├── themes
|   |   ├── agogo
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── basic
|   |   |   ├── changes
|   |   |   |   ├── frameset.html
|   |   |   |   ├── rstsource.html
|   |   |   |   └── versionchanges.html
|   |   |   ├── defindex.html
|   |   |   ├── domainindex.html
|   |   |   ├── genindex-single.html
|   |   |   ├── genindex-split.html
|   |   |   ├── genindex.html
|   |   |   ├── globaltoc.html
|   |   |   ├── layout.html
|   |   |   ├── localtoc.html
|   |   |   ├── opensearch.xml
|   |   |   ├── page.html
|   |   |   ├── relations.html
|   |   |   ├── search.html
|   |   |   ├── searchbox.html
|   |   |   ├── sourcelink.html
|   |   |   └── static
|   |   |       ├── doctools.js
|   |   |       ├── jquery-3.5.1.js
|   |   |       ├── jquery.js
|   |   |       ├── searchtools.js
|   |   |       ├── underscore-1.3.1.js
|   |   |       └── underscore.js
|   |   ├── bizstyle
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── css3-mediaqueries.js
|   |   |       └── css3-mediaqueries_src.js
|   |   ├── classic
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── default
|   |   |   └── static
|   |   |       └── default.css
|   |   ├── epub
|   |   |   ├── epub-cover.html
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── haiku
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── nature
|   |   |   └── static
|   |   ├── nonav
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       └── nonav.css
|   |   ├── pyramid
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── epub.css
|   |   |       └── ie6.css
|   |   ├── scrolls
|   |   |   ├── artwork
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── print.css
|   |   |       └── theme_extras.js
|   |   ├── sphinxdoc
|   |   |   └── static
|   |   └── traditional
|   |       └── static
|   ├── theming.py
|   ├── transforms
|   |   ├── __init__.py
|   |   ├── compact_bullet_list.py
|   |   ├── i18n.py
|   |   ├── post_transforms
|   |   |   ├── __init__.py
|   |   |   ├── code.py
|   |   |   └── images.py
|   |   └── references.py
|   ├── util
|   |   ├── __init__.py
|   |   ├── build_phase.py
|   |   ├── cfamily.py
|   |   ├── compat.py
|   |   ├── console.py
|   |   ├── docfields.py
|   |   ├── docstrings.py
|   |   ├── docutils.py
|   |   ├── fileutil.py
|   |   ├── i18n.py
|   |   ├── images.py
|   |   ├── inspect.py
|   |   ├── inventory.py
|   |   ├── jsdump.py
|   |   ├── jsonimpl.py
|   |   ├── logging.py
|   |   ├── matching.py
|   |   ├── math.py
|   |   ├── nodes.py
|   |   ├── osutil.py
|   |   ├── parallel.py
|   |   ├── png.py
|   |   ├── pycompat.py
|   |   ├── requests.py
|   |   ├── rst.py
|   |   ├── smartypants.py
|   |   ├── stemmer
|   |   |   ├── __init__.py
|   |   |   └── porter.py
|   |   ├── tags.py
|   |   ├── template.py
|   |   ├── texescape.py
|   |   └── typing.py
|   ├── versioning.py
|   └── writers
|       ├── __init__.py
|       ├── html.py
|       ├── html5.py
|       ├── latex.py
|       ├── manpage.py
|       ├── texinfo.py
|       ├── text.py
|       └── xml.py
├── tests
|   ├── conftest.py
|   ├── js
|   |   └── doctools.js
|   ├── roots
|   |   ├── test-add_enumerable_node
|   |   |   ├── conf.py
|   |   |   ├── enumerable_node.py
|   |   |   └── index.rst
|   |   ├── test-add_source_parser
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-add_source_parser-conflicts-with-users-setting
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-api-set-translator
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nonext
|   |   |   |   └── conf.py
|   |   |   └── translator.py
|   |   ├── test-apidoc-pep420
|   |   |   └── a
|   |   |       └── b
|   |   ├── test-apidoc-subpackage-in-toc
|   |   |   └── parent
|   |   |       ├── __init__.py
|   |   |       └── child
|   |   ├── test-apidoc-toc
|   |   |   └── mypackage
|   |   |       ├── __init__.py
|   |   |       ├── main.py
|   |   |       ├── no_init
|   |   |       ├── resource
|   |   |       └── something
|   |   ├── test-apidoc-trailing-underscore
|   |   |   └── package_
|   |   |       ├── __init__.py
|   |   |       └── module_.py
|   |   ├── test-autosummary
|   |   |   ├── conf.py
|   |   |   ├── dummy_module.py
|   |   |   ├── index.rst
|   |   |   ├── sphinx.rst
|   |   |   └── underscore_module_.py
|   |   ├── test-basic
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-html-translator
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-text
|   |   |   ├── conf.py
|   |   |   ├── doc1.txt
|   |   |   ├── doc2.txt
|   |   |   ├── index.txt
|   |   |   ├── lineblock.txt
|   |   |   ├── listitems.txt
|   |   |   ├── maxwidth.txt
|   |   |   ├── nonascii_maxwidth.txt
|   |   |   ├── nonascii_table.txt
|   |   |   ├── nonascii_title.txt
|   |   |   ├── table.txt
|   |   |   ├── table_colspan.txt
|   |   |   ├── table_colspan_and_rowspan.txt
|   |   |   ├── table_colspan_left.txt
|   |   |   └── table_rowspan.txt
|   |   ├── test-builder-dirhtml
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo
|   |   |   |   ├── foo_1.rst
|   |   |   |   ├── foo_2.rst
|   |   |   |   └── index.rst
|   |   |   └── index.rst
|   |   ├── test-builder-gettext-dont-rebuild-mo
|   |   |   ├── bom.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-changes
|   |   |   ├── base.rst
|   |   |   ├── c-api.rst
|   |   |   ├── conf.py
|   |   |   ├── contents.rst
|   |   |   └── library
|   |   |       └── utils.rst
|   |   ├── test-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-config
|   |   |   └── conf.py
|   |   ├── test-correct-year
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-default_role
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-directive-code
|   |   |   ├── caption.rst
|   |   |   ├── classes.rst
|   |   |   ├── conf.py
|   |   |   ├── emphasize.rst
|   |   |   ├── force.rst
|   |   |   ├── highlight.rst
|   |   |   ├── index.rst
|   |   |   ├── linenos.rst
|   |   |   ├── linenothreshold.rst
|   |   |   ├── namedblocks.rst
|   |   |   ├── py-decorators.rst
|   |   |   ├── python.rst
|   |   |   └── target.py
|   |   ├── test-directive-only
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── only.rst
|   |   ├── test-directives-raw
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-docutilsconf
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-c
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── namespace.rst
|   |   |   └── semicolon.rst
|   |   ├── test-domain-cpp
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── any-role.rst
|   |   |   ├── backslash.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── lookup-key-overload.rst
|   |   |   ├── multi-decl-lookup.rst
|   |   |   ├── roles-targets-ok.rst
|   |   |   ├── roles-targets-warn.rst
|   |   |   ├── roles.rst
|   |   |   ├── roles2.rst
|   |   |   ├── semicolon.rst
|   |   |   ├── warn-template-param-qualified-name.rst
|   |   |   └── xref_consistency.rst
|   |   ├── test-domain-js
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   ├── module_option.rst
|   |   |   └── roles.rst
|   |   ├── test-double-inheriting-theme
|   |   |   ├── base_themes_dir
|   |   |   |   ├── base_theme1
|   |   |   |   └── base_theme2
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-epub-anchor-id
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autodoc
|   |   |   ├── autodoc_dummy_bar.py
|   |   |   ├── autodoc_dummy_module.py
|   |   |   ├── bug2437
|   |   |   |   ├── __init__.py
|   |   |   |   └── autodoc_dummy_foo.py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target
|   |   |       ├── __init__.py
|   |   |       ├── abstractmethods.py
|   |   |       ├── annotated.py
|   |   |       ├── autoclass_content.py
|   |   |       ├── bound_method.py
|   |   |       ├── callable.py
|   |   |       ├── classes.py
|   |   |       ├── coroutine.py
|   |   |       ├── decorator.py
|   |   |       ├── descriptor.py
|   |   |       ├── docstring_signature.py
|   |   |       ├── enum.py
|   |   |       ├── final.py
|   |   |       ├── functions.py
|   |   |       ├── genericalias.py
|   |   |       ├── imported_members.py
|   |   |       ├── inheritance.py
|   |   |       ├── methods.py
|   |   |       ├── name_conflict
|   |   |       ├── name_mangling.py
|   |   |       ├── need_mocks.py
|   |   |       ├── overload.py
|   |   |       ├── partialfunction.py
|   |   |       ├── partialmethod.py
|   |   |       ├── pep570.py
|   |   |       ├── private.py
|   |   |       ├── process_docstring.py
|   |   |       ├── singledispatch.py
|   |   |       ├── singledispatchmethod.py
|   |   |       ├── slots.py
|   |   |       ├── sort_by_all.py
|   |   |       ├── typed_vars.py
|   |   |       ├── typehints.py
|   |   |       ├── typevar.py
|   |   |       └── wrappedfunction.py
|   |   ├── test-ext-autosectionlabel
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosectionlabel-prefix-document
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── autosummary_importfail.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-imported_members
|   |   |   ├── autosummary_dummy_package
|   |   |   |   ├── __init__.py
|   |   |   |   └── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-mock_imports
|   |   |   ├── conf.py
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-recursive
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── package
|   |   |   |   ├── __init__.py
|   |   |   |   ├── module.py
|   |   |   |   ├── module_importfail.py
|   |   |   |   └── package
|   |   |   └── package2
|   |   |       ├── __init__.py
|   |   |       └── module.py
|   |   ├── test-ext-autosummary-skip-member
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-autosummary-template
|   |   |   ├── _templates
|   |   |   |   └── empty.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-coverage
|   |   |   ├── conf.py
|   |   |   ├── coverage_ignored.py
|   |   |   ├── coverage_not_ignored.py
|   |   |   └── index.rst
|   |   ├── test-ext-doctest
|   |   |   ├── conf.py
|   |   |   └── doctest.txt
|   |   ├── test-ext-doctest-skipif
|   |   |   ├── conf.py
|   |   |   └── skipif.txt
|   |   ├── test-ext-doctest-with-autodoc
|   |   |   ├── conf.py
|   |   |   ├── dir
|   |   |   |   ├── __init__.py
|   |   |   |   ├── bar.py
|   |   |   |   └── inner.rst
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-githubpages
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-graphviz
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-ifconfig
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-imgconverter
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-inheritance_diagram
|   |   |   ├── conf.py
|   |   |   ├── example
|   |   |   |   ├── __init__.py
|   |   |   |   └── sphinx.py
|   |   |   ├── index.rst
|   |   |   └── test.py
|   |   ├── test-ext-intersphinx-cppdomain
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── math.rst
|   |   |   └── page.rst
|   |   ├── test-ext-math-compat
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math-simple
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-todo
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-ext-viewcode
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── objects.rst
|   |   |   └── spam
|   |   |       ├── __init__.py
|   |   |       ├── mod1.py
|   |   |       ├── mod2.py
|   |   |       └── mod3.py
|   |   ├── test-ext-viewcode-find
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── not_a_package
|   |   |       ├── __init__.py
|   |   |       └── submodule.py
|   |   ├── test-extensions
|   |   |   ├── conf.py
|   |   |   ├── read_parallel.py
|   |   |   ├── read_serial.py
|   |   |   ├── write_parallel.py
|   |   |   └── write_serial.py
|   |   ├── test-footnotes
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-gettext-template
|   |   |   ├── _templates
|   |   |   |   ├── template1.html
|   |   |   |   └── template2.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-glossary
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_assets
|   |   |   ├── conf.py
|   |   |   ├── extra
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   └── subdir
|   |   |   ├── index.rst
|   |   |   ├── static
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   ├── js
|   |   |   |   └── subdir
|   |   |   └── subdir
|   |   |       └── _build
|   |   ├── test-html_entity
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_scaled_image_link
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_style
|   |   |   ├── _static
|   |   |   |   └── default.css
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-parsed-literal
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-section
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-images
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── subdir
|   |   |       └── index.rst
|   |   ├── test-index_on_title
|   |   |   ├── conf.py
|   |   |   └── contents.rst
|   |   ├── test-inheritance
|   |   |   ├── basic_diagram.rst
|   |   |   ├── conf.py
|   |   |   ├── diagram_module_w_2_top_classes.rst
|   |   |   ├── diagram_w_1_top_class.rst
|   |   |   ├── diagram_w_2_top_classes.rst
|   |   |   ├── diagram_w_nested_classes.rst
|   |   |   ├── diagram_w_parts.rst
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── test.py
|   |   |   |   └── test_nested.py
|   |   |   └── index.rst
|   |   ├── test-intl
|   |   |   ├── _templates
|   |   |   |   └── contents.html
|   |   |   ├── admonitions.txt
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── definition_terms.txt
|   |   |   ├── docfields.txt
|   |   |   ├── external_links.txt
|   |   |   ├── figure.txt
|   |   |   ├── footnote.txt
|   |   |   ├── glossary_terms.txt
|   |   |   ├── glossary_terms_inconsistency.txt
|   |   |   ├── index.txt
|   |   |   ├── index_entries.txt
|   |   |   ├── label_target.txt
|   |   |   ├── literalblock.txt
|   |   |   ├── only.txt
|   |   |   ├── raw.txt
|   |   |   ├── refs.txt
|   |   |   ├── refs_inconsistency.txt
|   |   |   ├── refs_python_domain.txt
|   |   |   ├── role_xref.txt
|   |   |   ├── rubric.txt
|   |   |   ├── section.txt
|   |   |   ├── seealso.txt
|   |   |   ├── subdir
|   |   |   |   └── index.txt
|   |   |   ├── table.txt
|   |   |   ├── toctree.txt
|   |   |   ├── topic.txt
|   |   |   ├── versionchange.txt
|   |   |   ├── warnings.txt
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-keep_warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-babel
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-latex-equations
|   |   |   ├── conf.py
|   |   |   ├── equations.rst
|   |   |   └── expects
|   |   ├── test-latex-figure-in-admonition
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-includegraphics
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-index
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-labels
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── otherdoc.rst
|   |   ├── test-latex-numfig
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── indexhowto.rst
|   |   |   └── indexmanual.rst
|   |   ├── test-latex-table
|   |   |   ├── _mytemplates
|   |   |   |   └── latex
|   |   |   ├── complex.rst
|   |   |   ├── conf.py
|   |   |   ├── expects
|   |   |   ├── index.rst
|   |   |   ├── longtable.rst
|   |   |   └── tabular.rst
|   |   ├── test-latex-theme
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── theme
|   |   |       └── custom
|   |   ├── test-latex-title
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-unicode
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck
|   |   |   ├── conf.py
|   |   |   └── links.txt
|   |   ├── test-locale
|   |   |   ├── locale1
|   |   |   |   └── en
|   |   |   └── locale2
|   |   |       └── en
|   |   ├── test-manpage_url
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-citation
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-rubric
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-maxlistdepth
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-metadata
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-need-escaped
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux.rst
|   |   ├── test-nested-enumerated-list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nested-tables
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-numbered-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-numfig
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-productionlist
|   |   |   ├── Bare.rst
|   |   |   ├── Dup1.rst
|   |   |   ├── Dup2.rst
|   |   |   ├── LineContinuation.rst
|   |   |   ├── P1.rst
|   |   |   ├── P2.rst
|   |   |   ├── conf.py
|   |   |   ├── firstLineRule.rst
|   |   |   └── index.rst
|   |   ├── test-prolog
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── markdown.md
|   |   |   ├── prolog_markdown_parser.py
|   |   |   └── restructuredtext.rst
|   |   ├── test-pycode
|   |   |   └── cp_1251_coded.py
|   |   ├── test-pycode-egg
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── src
|   |   |       ├── sample.py
|   |   |       └── setup.py
|   |   ├── test-reST-code-block
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-refonly_bullet_list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-roles-download
|   |   |   ├── another
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-root
|   |   |   ├── _templates
|   |   |   |   ├── contentssb.html
|   |   |   |   ├── customsb.html
|   |   |   |   └── layout.html
|   |   |   ├── autodoc.txt
|   |   |   ├── autodoc_target.py
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── extapi.txt
|   |   |   ├── extensions.txt
|   |   |   ├── footnote.txt
|   |   |   ├── images.txt
|   |   |   ├── includes.txt
|   |   |   ├── index.txt
|   |   |   ├── lists.txt
|   |   |   ├── markup.txt
|   |   |   ├── math.txt
|   |   |   ├── objects.txt
|   |   |   ├── parsermod.py
|   |   |   ├── special
|   |   |   |   └── code.py
|   |   |   └── subdir
|   |   |       ├── excluded.txt
|   |   |       ├── images.txt
|   |   |       └── includes.txt
|   |   ├── test-search
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nosearch.rst
|   |   |   └── tocitem.rst
|   |   ├── test-setup
|   |   |   ├── doc
|   |   |   |   ├── conf.py
|   |   |   |   └── index.txt
|   |   |   └── setup.py
|   |   ├── test-smartquotes
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-stylesheets
|   |   |   ├── _templates
|   |   |   |   └── layout.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-templating
|   |   |   ├── _templates
|   |   |   |   ├── autosummary
|   |   |   |   └── layout.html
|   |   |   ├── autosummary_templating.txt
|   |   |   ├── conf.py
|   |   |   └── index.txt
|   |   ├── test-theming
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── setup.py
|   |   |   └── test_theme
|   |   |       ├── __init__.py
|   |   |       ├── staticfiles
|   |   |       └── test-theme
|   |   ├── test-tocdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   ├── qux.rst
|   |   |   └── tocdepth.rst
|   |   ├── test-toctree-duplicated
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree-empty
|   |   |   ├── _templates
|   |   |   |   └── localtoc.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-toctree-glob
|   |   |   ├── bar
|   |   |   |   ├── bar_1.rst
|   |   |   |   ├── bar_2.rst
|   |   |   |   ├── bar_3.rst
|   |   |   |   ├── bar_4
|   |   |   |   └── index.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux
|   |   |       ├── index.rst
|   |   |       ├── qux_1.rst
|   |   |       └── qux_2.rst
|   |   ├── test-toctree-maxdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   └── qux.rst
|   |   ├── test-trim_doctest_flags
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-versioning
|   |   |   ├── added.txt
|   |   |   ├── conf.py
|   |   |   ├── deleted.txt
|   |   |   ├── deleted_end.txt
|   |   |   ├── index.txt
|   |   |   ├── insert.txt
|   |   |   ├── insert_beginning.txt
|   |   |   ├── insert_similar.txt
|   |   |   ├── modified.txt
|   |   |   └── original.txt
|   |   └── test-warnings
|   |       ├── autodoc_fodder.py
|   |       ├── conf.py
|   |       ├── index.rst
|   |       └── undecodable.rst
|   ├── test_api_translator.py
|   ├── test_application.py
|   ├── test_build.py
|   ├── test_build_changes.py
|   ├── test_build_dirhtml.py
|   ├── test_build_epub.py
|   ├── test_build_gettext.py
|   ├── test_build_html.py
|   ├── test_build_latex.py
|   ├── test_build_linkcheck.py
|   ├── test_build_manpage.py
|   ├── test_build_texinfo.py
|   ├── test_build_text.py
|   ├── test_builder.py
|   ├── test_catalogs.py
|   ├── test_config.py
|   ├── test_correct_year.py
|   ├── test_directive_code.py
|   ├── test_directive_only.py
|   ├── test_directive_other.py
|   ├── test_directive_patch.py
|   ├── test_docutilsconf.py
|   ├── test_domain_c.py
|   ├── test_domain_cpp.py
|   ├── test_domain_js.py
|   ├── test_domain_py.py
|   ├── test_domain_rst.py
|   ├── test_domain_std.py
|   ├── test_environment.py
|   ├── test_environment_indexentries.py
|   ├── test_environment_toctree.py
|   ├── test_errors.py
|   ├── test_events.py
|   ├── test_ext_apidoc.py
|   ├── test_ext_autodoc.py
|   ├── test_ext_autodoc_autofunction.py
|   ├── test_ext_autodoc_configs.py
|   ├── test_ext_autodoc_events.py
|   ├── test_ext_autodoc_mock.py
|   ├── test_ext_autodoc_private_members.py
|   ├── test_ext_autosectionlabel.py
|   ├── test_ext_autosummary.py
|   ├── test_ext_coverage.py
|   ├── test_ext_doctest.py
|   ├── test_ext_duration.py
|   ├── test_ext_githubpages.py
|   ├── test_ext_graphviz.py
|   ├── test_ext_ifconfig.py
|   ├── test_ext_imgconverter.py
|   ├── test_ext_inheritance_diagram.py
|   ├── test_ext_intersphinx.py
|   ├── test_ext_math.py
|   ├── test_ext_napoleon.py
|   ├── test_ext_napoleon_docstring.py
|   ├── test_ext_napoleon_iterators.py
|   ├── test_ext_todo.py
|   ├── test_ext_viewcode.py
|   ├── test_highlighting.py
|   ├── test_intl.py
|   ├── test_locale.py
|   ├── test_markup.py
|   ├── test_metadata.py
|   ├── test_parser.py
|   ├── test_project.py
|   ├── test_pycode.py
|   ├── test_pycode_ast.py
|   ├── test_pycode_parser.py
|   ├── test_quickstart.py
|   ├── test_roles.py
|   ├── test_search.py
|   ├── test_setup_command.py
|   ├── test_smartquotes.py
|   ├── test_templating.py
|   ├── test_theming.py
|   ├── test_toctree.py
|   ├── test_transforms_post_transforms_code.py
|   ├── test_util.py
|   ├── test_util_docstrings.py
|   ├── test_util_docutils.py
|   ├── test_util_fileutil.py
|   ├── test_util_i18n.py
|   ├── test_util_images.py
|   ├── test_util_inspect.py
|   ├── test_util_inventory.py
|   ├── test_util_jsdump.py
|   ├── test_util_logging.py
|   ├── test_util_matching.py
|   ├── test_util_nodes.py
|   ├── test_util_pycompat.py
|   ├── test_util_rst.py
|   ├── test_util_template.py
|   ├── test_util_typing.py
|   ├── test_versioning.py
|   ├── test_writer_latex.py
|   └── typing_test_data.py
└── utils
    ├── __init__.py
    ├── bump_docker.sh
    ├── bump_version.py
    ├── checks.py
    ├── doclinter.py
    └── jssplitter_generator.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: linkcheck could also check local (internal) links

Description: Subject: linkcheck currently doesn't check local (internal) links, but this would be useful.

<!--
  Important: This is a list of issues for Sphinx, not a forum.
  If you'd like to post a question, please move to sphinx-users group.
  https://groups.google.com/forum/#!forum/sphinx-users

  Thanks,
-->

### Problem
See above.

#### Procedure to reproduce the problem
Create a template project with sphinx-quickstart, put the following in index.rst
```
broken external-link_
broken local-link_

.. _external-link: https://lkfqhlkghflkhs
.. _local-link: doesntexist
```

Run `make linkcheck`

#### Error logs / results
```
Running Sphinx v1.7.6
making output directory...
loading pickled environment... done
building [mo]: targets for 0 po files that are out of date
building [linkcheck]: targets for 1 source files that are out of date
updating environment: 0 added, 0 changed, 0 removed
looking for now-outdated files... none found
preparing documents... done
writing output... [100%] index                                                                   
(line   14) -local-   doesntexist
(line   14) broken    https://lkfqhlkghflkhs - HTTPSConnectionPool(host='lkfqhlkghflkhs', port=443): Max retries exceeded with url: / (Caused by NewConnectionError('<urllib3.connection.VerifiedHTTPSConnection object at 0x7faed7ddfc88>: Failed to establish a new connection: [Errno -2] Name or service not known',))

build finished with problems.
make: *** [Makefile:20: linkcheck] Error 1
```

#### Expected results
Also a check for the local link.

### Reproducible project / your project
N/A

### Environment info
- OS: Arch Linux
- Python version: 3.6
- Sphinx version: 1.7.6


Patch information:
diff --git a/doc/usage/builders/index.rst b/doc/usage/builders/index.rst
index db6706944..c860a2517 100644
--- a/doc/usage/builders/index.rst
+++ b/doc/usage/builders/index.rst
@@ -428,9 +428,11 @@ name is ``rinoh``. Refer to the `rinohtype manual`_ for details.
 .. module:: sphinx.builders.linkcheck
 .. class:: CheckExternalLinksBuilder
 
-   This builder scans all documents for external links, tries to open them with
-   ``requests``, and writes an overview which ones are broken and redirected to
-   standard output and to :file:`output.txt` in the output directory.
+   This builder scans all documents for external HTTP(S) links and local
+   links. External links are tried to open with ``requests`` while local
+   links are checked for existence on disk. It writes an overview which
+   ones are broken and redirected to standard output and to :file:`output.txt`
+   in the output directory.
 
    .. autoattribute:: name
 
diff --git a/sphinx/builders/linkcheck.py b/sphinx/builders/linkcheck.py
index dd5317087..c159b273f 100644
--- a/sphinx/builders/linkcheck.py
+++ b/sphinx/builders/linkcheck.py
@@ -77,7 +77,11 @@ def check_anchor(response: requests.requests.Response, anchor: str) -> bool:
 
 class CheckExternalLinksBuilder(Builder):
     """
-    Checks for broken external links.
+    Checks for broken links.
+
+    This builder scans all documents for external HTTP(S) links and local
+    (internal) links. External links are validated via HTTP requests, and
+    local links are checked for existence on disk.
     """
     name = 'linkcheck'
     epilog = __('Look for any errors in the above output or in '
@@ -213,7 +217,17 @@ class CheckExternalLinksBuilder(Builder):
             if len(uri) == 0 or uri.startswith(('#', 'mailto:', 'ftp:')):
                 return 'unchecked', '', 0
             elif not uri.startswith(('http:', 'https:')):
-                return 'local', '', 0
+                # Check local (internal) links by resolving against the document path
+                local_uri = uri.split('#', 1)[0] if '#' in uri else uri
+                try:
+                    rel_fn, abs_fn = self.env.relfn2path(local_uri, docname)
+                except Exception:
+                    # If resolution fails, consider as broken
+                    return 'broken', __("Local path could not be resolved: %s") % local_uri, 0
+                if path.exists(abs_fn):
+                    return 'working', '', 0
+                else:
+                    return 'broken', __("Local path not found: %s") % rel_fn, 0
             elif uri in self.good:
                 return 'working', 'old', 0
             elif uri in self.broken:
@@ -324,7 +338,7 @@ class CheckExternalLinksBuilder(Builder):
         # image nodes
         for imgnode in doctree.traverse(nodes.image):
             uri = imgnode['candidates'].get('?')
-            if uri and '://' in uri:
+            if uri:
                 lineno = get_node_line(imgnode)
                 self.wqueue.put((uri, docname, lineno), False)
                 n += 1


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-24 19:56:05,519 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find relevant test cases for a bug fix related to the `linkcheck` builder. To do this, I need to examine the existing tests for `linkcheck`. The most relevant files are the test file itself and the test data it uses. The file `tests/test_build_linkcheck.py` contains the tests, and `tests/roots/test-linkcheck/links.txt` is likely the input data for these tests. I need the content of these files to identify suitable test cases.' query='Please provide the full content of `tests/test_build_linkcheck.py` and `tests/roots/test-linkcheck/links.txt`.' extra_requirements='' purpose='I need to analyze the existing tests for the linkcheck builder to find test cases that are relevant to the bug fix, which involves checking local links.'
2025-12-24 19:56:05,520 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `tests/test_build_linkcheck.py` and `tests/roots/test-linkcheck/links.txt`.
2025-12-24 19:56:05,520 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-24 19:56:05,521 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-24 19:56:05,522 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-24 19:56:05,522 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `tests/test_build_linkcheck.py` and `tests/roots/test-linkcheck/links.txt`.
Purpose: I need to analyze the existing tests for the linkcheck builder to find test cases that are relevant to the bug fix, which involves checking local links.
2025-12-24 19:56:08,559 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the full content of `tests/test_build_linkcheck.py` to understand the existing tests for the linkcheck builder. I also accessed `tests/roots/test-linkcheck/links.txt` to analyze the test cases related to local link checking, which will help in addressing the bug fix.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/roots/test-linkcheck/links.txt"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2093, 'candidates_token_count': 117, 'total_token_count': 2339, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2093}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 117}], 'thoughts_token_count': 129, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.044714601630838506, 'model_name': 'gemini-2.5-pro'} id='run--3719e9b9-04ce-4f40-ae7a-d13b9e93ab7b-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/test_build_linkcheck.py'}, 'id': 'b7d9e163-94a5-4fc9-9a33-16ccbd53a1db', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/roots/test-linkcheck/links.txt'}, 'id': '07a56019-2c04-4759-9269-ede9e5c93c58', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2093, 'output_tokens': 117, 'total_tokens': 2339, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 129}}
2025-12-24 19:56:14,314 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the content of `tests/test_build_linkcheck.py` and `tests/roots/test-linkcheck/links.txt` as requested. The first file contains the Python tests for the linkcheck builder, and the second file provides the sample links used in those tests. This information should allow you to analyze the existing test cases for local link checking and help in developing a fix for the bug.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 5228, 'candidates_token_count': 87, 'total_token_count': 5740, 'cached_content_token_count': 1697, 'prompt_tokens_details': [{'modality': 1, 'token_count': 5228}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1697}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 87}], 'thoughts_token_count': 425}, 'finish_reason': 'STOP', 'avg_logprobs': -0.6053146274610498, 'model_name': 'gemini-2.5-pro'} id='run--ef0e70bf-894b-4197-9914-d7b7dbd0476a-0' usage_metadata={'input_tokens': 5228, 'output_tokens': 87, 'total_tokens': 5740, 'input_token_details': {'cache_read': 1697}, 'output_token_details': {'reasoning': 425}}
2025-12-24 19:56:14,316 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `tests/test_build_linkcheck.py` and `tests/roots/test-linkcheck/links.txt`.
--- END QUERY ---



--- BEGIN PURPOSE ---
I need to analyze the existing tests for the linkcheck builder to find test cases that are relevant to the bug fix, which involves checking local links.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/roots/test-linkcheck/links.txt
Line number range: 1 - 16
Content:
1. This is from CPython documentation.
2. 
3. * Also, if there is a `default namespace <https://www.w3.org/TR/2006/REC-xml-names-20060816/#defaulting>`__, that full URI gets prepended to all of the non-prefixed tags.
4. 
5. * The URL having anchor: `http://www.sphinx-doc.org/en/1.4.8/tutorial.html#install-sphinx`_
6. 
7. Some additional anchors to exercise ignore code
8. 
9. * `Example Bar invalid <https://www.google.com/#!bar>`_
10. * `Example Bar invalid <https://www.google.com#!bar>`_ tests that default ignore anchor of #! does not need to be prefixed with /
11. * `Example Bar invalid <https://www.google.com/#top>`_
12. * `Example anchor invalid <http://www.sphinx-doc.org/en/1.7/intro.html#does-not-exist>`_
13. * `Complete nonsense <https://localhost:7777/doesnotexist>`_
14. 
15. .. image:: https://www.google.com/image.png
16. .. figure:: https://www.google.com/image2.png


File: tests/test_build_linkcheck.py
Line number range: 1 - 159
Content:
1. """
2.     test_build_linkcheck
3.     ~~~~~~~~~~~~~~~~~~~~
4. 
5.     Test the build process with manpage builder with the test root.
6. 
7.     :copyright: Copyright 2007-2020 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import json
12. import re
13. from unittest import mock
14. import pytest
15. 
16. 
17. @pytest.mark.sphinx('linkcheck', testroot='linkcheck', freshenv=True)
18. def test_defaults(app, status, warning):
19.     app.builder.build_all()
20. 
21.     assert (app.outdir / 'output.txt').exists()
22.     content = (app.outdir / 'output.txt').read_text()
23. 
24.     print(content)
25.     # looking for '#top' and '#does-not-exist' not found should fail
26.     assert "Anchor 'top' not found" in content
27.     assert "Anchor 'does-not-exist' not found" in content
28.     # looking for non-existent URL should fail
29.     assert " Max retries exceeded with url: /doesnotexist" in content
30.     # images should fail
31.     assert "Not Found for url: https://www.google.com/image.png" in content
32.     assert "Not Found for url: https://www.google.com/image2.png" in content
33.     assert len(content.splitlines()) == 5
34. 
35. 
36. @pytest.mark.sphinx('linkcheck', testroot='linkcheck', freshenv=True)
37. def test_defaults_json(app, status, warning):
38.     app.builder.build_all()
39. 
40.     assert (app.outdir / 'output.json').exists()
41.     content = (app.outdir / 'output.json').read_text()
42.     print(content)
43. 
44.     rows = [json.loads(x) for x in content.splitlines()]
45.     row = rows[0]
46.     for attr in ["filename", "lineno", "status", "code", "uri",
47.                  "info"]:
48.         assert attr in row
49. 
50.     assert len(content.splitlines()) == 8
51.     assert len(rows) == 8
52.     # the output order of the rows is not stable
53.     # due to possible variance in network latency
54.     rowsby = {row["uri"]:row for row in rows}
55.     assert rowsby["https://www.google.com#!bar"] == {
56.         'filename': 'links.txt',
57.         'lineno': 10,
58.         'status': 'working',
59.         'code': 0,
60.         'uri': 'https://www.google.com#!bar',
61.         'info': ''
62.     }
63.     # looking for non-existent URL should fail
64.     dnerow = rowsby['https://localhost:7777/doesnotexist']
65.     assert dnerow['filename'] == 'links.txt'
66.     assert dnerow['lineno'] == 13
67.     assert dnerow['status'] == 'broken'
68.     assert dnerow['code'] == 0
69.     assert dnerow['uri'] == 'https://localhost:7777/doesnotexist'
70.     assert rowsby['https://www.google.com/image2.png'] == {
71.         'filename': 'links.txt',
72.         'lineno': 16,
73.         'status': 'broken',
74.         'code': 0,
75.         'uri': 'https://www.google.com/image2.png',
76.         'info': '404 Client Error: Not Found for url: https://www.google.com/image2.png'
77.     }
78.     # looking for '#top' and '#does-not-exist' not found should fail
79.     assert "Anchor 'top' not found" == \
80.         rowsby["https://www.google.com/#top"]["info"]
81.     assert "Anchor 'does-not-exist' not found" == \
82.         rowsby["http://www.sphinx-doc.org/en/1.7/intro.html#does-not-exist"]["info"]
83.     # images should fail
84.     assert "Not Found for url: https://www.google.com/image.png" in \
85.         rowsby["https://www.google.com/image.png"]["info"]
86. 
87. 
88. @pytest.mark.sphinx(
89.     'linkcheck', testroot='linkcheck', freshenv=True,
90.     confoverrides={'linkcheck_anchors_ignore': ["^!", "^top$"],
91.                    'linkcheck_ignore': [
92.                        'https://localhost:7777/doesnotexist',
93.                        'http://www.sphinx-doc.org/en/1.7/intro.html#',
94.                        'https://www.google.com/image.png',
95.                        'https://www.google.com/image2.png']
96.                    })
97. def test_anchors_ignored(app, status, warning):
98.     app.builder.build_all()
99. 
100.     assert (app.outdir / 'output.txt').exists()
101.     content = (app.outdir / 'output.txt').read_text()
102. 
103.     # expect all ok when excluding #top
104.     assert not content
105. 
106. 
107. @pytest.mark.sphinx(
108.     'linkcheck', testroot='linkcheck', freshenv=True,
109.     confoverrides={'linkcheck_auth': [
110.                         (r'.+google\.com/image.+', 'authinfo1'),
111.                         (r'.+google\.com.+', 'authinfo2'),
112.                    ]
113.                   })
114. def test_auth(app, status, warning):
115.     mock_req = mock.MagicMock()
116.     mock_req.return_value = 'fake-response'
117. 
118.     with mock.patch.multiple('requests', get=mock_req, head=mock_req):
119.         app.builder.build_all()
120.         for c_args, c_kwargs in mock_req.call_args_list:
121.             if 'google.com/image' in c_args[0]:
122.                 assert c_kwargs['auth'] == 'authinfo1'
123.             elif 'google.com' in c_args[0]:
124.                 assert c_kwargs['auth'] == 'authinfo2'
125.             else:
126.                 assert not c_kwargs['auth']
127. 
128. 
129. @pytest.mark.sphinx(
130.     'linkcheck', testroot='linkcheck', freshenv=True,
131.     confoverrides={'linkcheck_request_headers': {
132.         "https://localhost:7777/": {
133.             "Accept": "text/html",
134.         },
135.         "http://www.sphinx-doc.org": {  # no slash at the end
136.             "Accept": "application/json",
137.         },
138.         "*": {
139.             "X-Secret": "open sesami",
140.         }
141.     }})
142. def test_linkcheck_request_headers(app, status, warning):
143.     mock_req = mock.MagicMock()
144.     mock_req.return_value = 'fake-response'
145. 
146.     with mock.patch.multiple('requests', get=mock_req, head=mock_req):
147.         app.builder.build_all()
148.         for args, kwargs in mock_req.call_args_list:
149.             url = args[0]
150.             headers = kwargs.get('headers', {})
151.             if "https://localhost:7777" in url:
152.                 assert headers["Accept"] == "text/html"
153.             elif 'http://www.sphinx-doc.org' in url:
154.                 assert headers["Accept"] == "application/json"
155.             elif 'https://www.google.com' in url:
156.                 assert headers["Accept"] == "text/html,application/xhtml+xml;q=0.9,*/*;q=0.8"
157.                 assert headers["X-Secret"] == "open sesami"
158.             else:
159.                 assert headers["Accept"] == "text/html,application/xhtml+xml;q=0.9,*/*;q=0.8"

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-24 19:56:20,594 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="1. Query requirement analysis:\n   - The query explicitly asks for the full content of `tests/test_build_linkcheck.py`.\n   - The provided context contains the entire file content from line 1 to 159.\n2. Extended relevance:\n   - Providing the full file content is necessary to fulfill the user's request to analyze all existing tests for the linkcheck builder.", relative_path='tests/test_build_linkcheck.py', start_line=1, end_line=159), ContextOutput(reasoning='1. Query requirement analysis:\n   - The query explicitly asks for the full content of `tests/roots/test-linkcheck/links.txt`.\n   - The provided context contains the entire file content from line 1 to 16.\n2. Extended relevance:\n   - This file is a dependency for the tests in `tests/test_build_linkcheck.py` and its content is essential for understanding the test cases.', relative_path='tests/roots/test-linkcheck/links.txt', start_line=1, end_line=16)]
2025-12-24 19:56:20,596 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 2 contexts to memory for query: Please provide the full content of `tests/test_build_linkcheck.py` and `tests/roots/test-linkcheck/links.txt`.
2025-12-24 19:56:20,596 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-24 19:56:20,596 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-24 19:56:20,596 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 2 new contexts to 0 existing contexts
2025-12-24 19:56:20,596 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 2 total contexts (removed 0 duplicates)
2025-12-24 19:56:20,597 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sphinx
├── .circleci
|   └── config.yml
├── .codecov.yml
├── .github
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.md
|   |   ├── config.yml
|   |   └── feature_request.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   └── workflows
|       ├── builddoc.yml
|       ├── lint.yml
|       └── main.yml
├── .travis.yml
├── CONTRIBUTING.rst
├── README.rst
├── bindep.txt
├── doc
|   ├── _static
|   |   ├── conf.py.txt
|   |   └── themes
|   |       └── fullsize
|   ├── _templates
|   |   ├── index.html
|   |   └── indexsidebar.html
|   ├── _themes
|   |   └── sphinx13
|   |       ├── layout.html
|   |       └── static
|   |           └── sphinx13.css
|   ├── changes.rst
|   ├── conf.py
|   ├── contents.rst
|   ├── develop.rst
|   ├── development
|   |   ├── index.rst
|   |   └── tutorials
|   |       ├── examples
|   |       |   ├── README.rst
|   |       |   ├── helloworld.py
|   |       |   ├── recipe.py
|   |       |   └── todo.py
|   |       ├── helloworld.rst
|   |       ├── index.rst
|   |       ├── recipe.rst
|   |       └── todo.rst
|   ├── examples.rst
|   ├── extdev
|   |   ├── appapi.rst
|   |   ├── builderapi.rst
|   |   ├── collectorapi.rst
|   |   ├── deprecated.rst
|   |   ├── domainapi.rst
|   |   ├── envapi.rst
|   |   ├── i18n.rst
|   |   ├── index.rst
|   |   ├── logging.rst
|   |   ├── markupapi.rst
|   |   ├── nodes.rst
|   |   ├── parserapi.rst
|   |   ├── projectapi.rst
|   |   └── utils.rst
|   ├── faq.rst
|   ├── glossary.rst
|   ├── internals
|   |   ├── authors.rst
|   |   ├── code-of-conduct.rst
|   |   ├── contributing.rst
|   |   ├── index.rst
|   |   ├── organization.rst
|   |   └── release-process.rst
|   ├── latex.rst
|   ├── man
|   |   ├── index.rst
|   |   ├── sphinx-apidoc.rst
|   |   ├── sphinx-autogen.rst
|   |   ├── sphinx-build.rst
|   |   └── sphinx-quickstart.rst
|   ├── templating.rst
|   ├── theming.rst
|   └── usage
|       ├── advanced
|       |   ├── intl.rst
|       |   ├── setuptools.rst
|       |   └── websupport
|       |       ├── api.rst
|       |       ├── index.rst
|       |       ├── quickstart.rst
|       |       ├── searchadapters.rst
|       |       └── storagebackends.rst
|       ├── builders
|       |   └── index.rst
|       ├── configuration.rst
|       ├── extensions
|       |   ├── autodoc.rst
|       |   ├── autosectionlabel.rst
|       |   ├── autosummary.rst
|       |   ├── coverage.rst
|       |   ├── doctest.rst
|       |   ├── duration.rst
|       |   ├── example_google.py
|       |   ├── example_google.rst
|       |   ├── example_numpy.py
|       |   ├── example_numpy.rst
|       |   ├── extlinks.rst
|       |   ├── githubpages.rst
|       |   ├── graphviz.rst
|       |   ├── ifconfig.rst
|       |   ├── imgconverter.rst
|       |   ├── index.rst
|       |   ├── inheritance.rst
|       |   ├── intersphinx.rst
|       |   ├── linkcode.rst
|       |   ├── math.rst
|       |   ├── napoleon.rst
|       |   ├── todo.rst
|       |   └── viewcode.rst
|       ├── index.rst
|       ├── installation.rst
|       ├── markdown.rst
|       ├── quickstart.rst
|       ├── restructuredtext
|       |   ├── basics.rst
|       |   ├── directives.rst
|       |   ├── domains.rst
|       |   ├── field-lists.rst
|       |   ├── index.rst
|       |   └── roles.rst
|       └── theming.rst
├── karma.conf.js
├── setup.py
├── sphinx
|   ├── __init__.py
|   ├── __main__.py
|   ├── addnodes.py
|   ├── application.py
|   ├── builders
|   |   ├── __init__.py
|   |   ├── _epub_base.py
|   |   ├── applehelp.py
|   |   ├── changes.py
|   |   ├── devhelp.py
|   |   ├── dirhtml.py
|   |   ├── dummy.py
|   |   ├── epub3.py
|   |   ├── gettext.py
|   |   ├── html
|   |   |   ├── __init__.py
|   |   |   └── transforms.py
|   |   ├── htmlhelp.py
|   |   ├── latex
|   |   |   ├── __init__.py
|   |   |   ├── constants.py
|   |   |   ├── nodes.py
|   |   |   ├── theming.py
|   |   |   ├── transforms.py
|   |   |   └── util.py
|   |   ├── linkcheck.py
|   |   ├── manpage.py
|   |   ├── qthelp.py
|   |   ├── singlehtml.py
|   |   ├── texinfo.py
|   |   ├── text.py
|   |   └── xml.py
|   ├── cmd
|   |   ├── __init__.py
|   |   ├── build.py
|   |   ├── make_mode.py
|   |   └── quickstart.py
|   ├── config.py
|   ├── deprecation.py
|   ├── directives
|   |   ├── __init__.py
|   |   ├── code.py
|   |   ├── other.py
|   |   └── patches.py
|   ├── domains
|   |   ├── __init__.py
|   |   ├── c.py
|   |   ├── changeset.py
|   |   ├── citation.py
|   |   ├── cpp.py
|   |   ├── index.py
|   |   ├── javascript.py
|   |   ├── math.py
|   |   ├── python.py
|   |   ├── rst.py
|   |   └── std.py
|   ├── environment
|   |   ├── __init__.py
|   |   ├── adapters
|   |   |   ├── __init__.py
|   |   |   ├── asset.py
|   |   |   ├── indexentries.py
|   |   |   └── toctree.py
|   |   └── collectors
|   |       ├── __init__.py
|   |       ├── asset.py
|   |       ├── dependencies.py
|   |       ├── indexentries.py
|   |       ├── metadata.py
|   |       ├── title.py
|   |       └── toctree.py
|   ├── errors.py
|   ├── events.py
|   ├── ext
|   |   ├── __init__.py
|   |   ├── apidoc.py
|   |   ├── autodoc
|   |   |   ├── __init__.py
|   |   |   ├── directive.py
|   |   |   ├── importer.py
|   |   |   ├── mock.py
|   |   |   ├── type_comment.py
|   |   |   └── typehints.py
|   |   ├── autosectionlabel.py
|   |   ├── autosummary
|   |   |   ├── __init__.py
|   |   |   ├── generate.py
|   |   |   └── templates
|   |   |       └── autosummary
|   |   ├── coverage.py
|   |   ├── doctest.py
|   |   ├── duration.py
|   |   ├── extlinks.py
|   |   ├── githubpages.py
|   |   ├── graphviz.py
|   |   ├── ifconfig.py
|   |   ├── imgconverter.py
|   |   ├── imgmath.py
|   |   ├── inheritance_diagram.py
|   |   ├── intersphinx.py
|   |   ├── jsmath.py
|   |   ├── linkcode.py
|   |   ├── mathjax.py
|   |   ├── napoleon
|   |   |   ├── __init__.py
|   |   |   ├── docstring.py
|   |   |   └── iterators.py
|   |   ├── todo.py
|   |   └── viewcode.py
|   ├── extension.py
|   ├── highlighting.py
|   ├── io.py
|   ├── jinja2glue.py
|   ├── locale
|   |   ├── __init__.py
|   |   ├── ar
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bg
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bn
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ca
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cak
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cs
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cy
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── da
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── de
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── el
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eo
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── es
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── et
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fa
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── he
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi_IN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── id
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── it
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ja
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ko
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── mk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nb_NO
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ne
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_BR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_PT
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ro
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ru
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── si
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sq
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr@latin
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr_RS
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ta
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── te
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── tr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── uk_UA
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ur
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── vi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_CN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   └── zh_TW
|   |       └── LC_MESSAGES
|   |           └── sphinx.js
|   ├── parsers.py
|   ├── project.py
|   ├── pycode
|   |   ├── __init__.py
|   |   ├── ast.py
|   |   └── parser.py
|   ├── pygments_styles.py
|   ├── registry.py
|   ├── roles.py
|   ├── search
|   |   ├── __init__.py
|   |   ├── da.py
|   |   ├── de.py
|   |   ├── en.py
|   |   ├── es.py
|   |   ├── fi.py
|   |   ├── fr.py
|   |   ├── hu.py
|   |   ├── it.py
|   |   ├── ja.py
|   |   ├── jssplitter.py
|   |   ├── nl.py
|   |   ├── no.py
|   |   ├── non-minified-js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── pt.py
|   |   ├── ro.py
|   |   ├── ru.py
|   |   ├── sv.py
|   |   ├── tr.py
|   |   └── zh.py
|   ├── setup_command.py
|   ├── templates
|   |   ├── apidoc
|   |   ├── epub3
|   |   |   └── container.xml
|   |   ├── gettext
|   |   ├── graphviz
|   |   |   └── graphviz.css
|   |   ├── htmlhelp
|   |   ├── imgmath
|   |   ├── latex
|   |   ├── quickstart
|   |   └── texinfo
|   ├── testing
|   |   ├── __init__.py
|   |   ├── comparer.py
|   |   ├── fixtures.py
|   |   ├── path.py
|   |   ├── restructuredtext.py
|   |   └── util.py
|   ├── texinputs
|   ├── texinputs_win
|   ├── themes
|   |   ├── agogo
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── basic
|   |   |   ├── changes
|   |   |   |   ├── frameset.html
|   |   |   |   ├── rstsource.html
|   |   |   |   └── versionchanges.html
|   |   |   ├── defindex.html
|   |   |   ├── domainindex.html
|   |   |   ├── genindex-single.html
|   |   |   ├── genindex-split.html
|   |   |   ├── genindex.html
|   |   |   ├── globaltoc.html
|   |   |   ├── layout.html
|   |   |   ├── localtoc.html
|   |   |   ├── opensearch.xml
|   |   |   ├── page.html
|   |   |   ├── relations.html
|   |   |   ├── search.html
|   |   |   ├── searchbox.html
|   |   |   ├── sourcelink.html
|   |   |   └── static
|   |   |       ├── doctools.js
|   |   |       ├── jquery-3.5.1.js
|   |   |       ├── jquery.js
|   |   |       ├── searchtools.js
|   |   |       ├── underscore-1.3.1.js
|   |   |       └── underscore.js
|   |   ├── bizstyle
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── css3-mediaqueries.js
|   |   |       └── css3-mediaqueries_src.js
|   |   ├── classic
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── default
|   |   |   └── static
|   |   |       └── default.css
|   |   ├── epub
|   |   |   ├── epub-cover.html
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── haiku
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── nature
|   |   |   └── static
|   |   ├── nonav
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       └── nonav.css
|   |   ├── pyramid
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── epub.css
|   |   |       └── ie6.css
|   |   ├── scrolls
|   |   |   ├── artwork
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── print.css
|   |   |       └── theme_extras.js
|   |   ├── sphinxdoc
|   |   |   └── static
|   |   └── traditional
|   |       └── static
|   ├── theming.py
|   ├── transforms
|   |   ├── __init__.py
|   |   ├── compact_bullet_list.py
|   |   ├── i18n.py
|   |   ├── post_transforms
|   |   |   ├── __init__.py
|   |   |   ├── code.py
|   |   |   └── images.py
|   |   └── references.py
|   ├── util
|   |   ├── __init__.py
|   |   ├── build_phase.py
|   |   ├── cfamily.py
|   |   ├── compat.py
|   |   ├── console.py
|   |   ├── docfields.py
|   |   ├── docstrings.py
|   |   ├── docutils.py
|   |   ├── fileutil.py
|   |   ├── i18n.py
|   |   ├── images.py
|   |   ├── inspect.py
|   |   ├── inventory.py
|   |   ├── jsdump.py
|   |   ├── jsonimpl.py
|   |   ├── logging.py
|   |   ├── matching.py
|   |   ├── math.py
|   |   ├── nodes.py
|   |   ├── osutil.py
|   |   ├── parallel.py
|   |   ├── png.py
|   |   ├── pycompat.py
|   |   ├── requests.py
|   |   ├── rst.py
|   |   ├── smartypants.py
|   |   ├── stemmer
|   |   |   ├── __init__.py
|   |   |   └── porter.py
|   |   ├── tags.py
|   |   ├── template.py
|   |   ├── texescape.py
|   |   └── typing.py
|   ├── versioning.py
|   └── writers
|       ├── __init__.py
|       ├── html.py
|       ├── html5.py
|       ├── latex.py
|       ├── manpage.py
|       ├── texinfo.py
|       ├── text.py
|       └── xml.py
├── tests
|   ├── conftest.py
|   ├── js
|   |   └── doctools.js
|   ├── roots
|   |   ├── test-add_enumerable_node
|   |   |   ├── conf.py
|   |   |   ├── enumerable_node.py
|   |   |   └── index.rst
|   |   ├── test-add_source_parser
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-add_source_parser-conflicts-with-users-setting
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-api-set-translator
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nonext
|   |   |   |   └── conf.py
|   |   |   └── translator.py
|   |   ├── test-apidoc-pep420
|   |   |   └── a
|   |   |       └── b
|   |   ├── test-apidoc-subpackage-in-toc
|   |   |   └── parent
|   |   |       ├── __init__.py
|   |   |       └── child
|   |   ├── test-apidoc-toc
|   |   |   └── mypackage
|   |   |       ├── __init__.py
|   |   |       ├── main.py
|   |   |       ├── no_init
|   |   |       ├── resource
|   |   |       └── something
|   |   ├── test-apidoc-trailing-underscore
|   |   |   └── package_
|   |   |       ├── __init__.py
|   |   |       └── module_.py
|   |   ├── test-autosummary
|   |   |   ├── conf.py
|   |   |   ├── dummy_module.py
|   |   |   ├── index.rst
|   |   |   ├── sphinx.rst
|   |   |   └── underscore_module_.py
|   |   ├── test-basic
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-html-translator
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-text
|   |   |   ├── conf.py
|   |   |   ├── doc1.txt
|   |   |   ├── doc2.txt
|   |   |   ├── index.txt
|   |   |   ├── lineblock.txt
|   |   |   ├── listitems.txt
|   |   |   ├── maxwidth.txt
|   |   |   ├── nonascii_maxwidth.txt
|   |   |   ├── nonascii_table.txt
|   |   |   ├── nonascii_title.txt
|   |   |   ├── table.txt
|   |   |   ├── table_colspan.txt
|   |   |   ├── table_colspan_and_rowspan.txt
|   |   |   ├── table_colspan_left.txt
|   |   |   └── table_rowspan.txt
|   |   ├── test-builder-dirhtml
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo
|   |   |   |   ├── foo_1.rst
|   |   |   |   ├── foo_2.rst
|   |   |   |   └── index.rst
|   |   |   └── index.rst
|   |   ├── test-builder-gettext-dont-rebuild-mo
|   |   |   ├── bom.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-changes
|   |   |   ├── base.rst
|   |   |   ├── c-api.rst
|   |   |   ├── conf.py
|   |   |   ├── contents.rst
|   |   |   └── library
|   |   |       └── utils.rst
|   |   ├── test-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-config
|   |   |   └── conf.py
|   |   ├── test-correct-year
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-default_role
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-directive-code
|   |   |   ├── caption.rst
|   |   |   ├── classes.rst
|   |   |   ├── conf.py
|   |   |   ├── emphasize.rst
|   |   |   ├── force.rst
|   |   |   ├── highlight.rst
|   |   |   ├── index.rst
|   |   |   ├── linenos.rst
|   |   |   ├── linenothreshold.rst
|   |   |   ├── namedblocks.rst
|   |   |   ├── py-decorators.rst
|   |   |   ├── python.rst
|   |   |   └── target.py
|   |   ├── test-directive-only
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── only.rst
|   |   ├── test-directives-raw
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-docutilsconf
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-c
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── namespace.rst
|   |   |   └── semicolon.rst
|   |   ├── test-domain-cpp
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── any-role.rst
|   |   |   ├── backslash.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── lookup-key-overload.rst
|   |   |   ├── multi-decl-lookup.rst
|   |   |   ├── roles-targets-ok.rst
|   |   |   ├── roles-targets-warn.rst
|   |   |   ├── roles.rst
|   |   |   ├── roles2.rst
|   |   |   ├── semicolon.rst
|   |   |   ├── warn-template-param-qualified-name.rst
|   |   |   └── xref_consistency.rst
|   |   ├── test-domain-js
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   ├── module_option.rst
|   |   |   └── roles.rst
|   |   ├── test-double-inheriting-theme
|   |   |   ├── base_themes_dir
|   |   |   |   ├── base_theme1
|   |   |   |   └── base_theme2
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-epub-anchor-id
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autodoc
|   |   |   ├── autodoc_dummy_bar.py
|   |   |   ├── autodoc_dummy_module.py
|   |   |   ├── bug2437
|   |   |   |   ├── __init__.py
|   |   |   |   └── autodoc_dummy_foo.py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target
|   |   |       ├── __init__.py
|   |   |       ├── abstractmethods.py
|   |   |       ├── annotated.py
|   |   |       ├── autoclass_content.py
|   |   |       ├── bound_method.py
|   |   |       ├── callable.py
|   |   |       ├── classes.py
|   |   |       ├── coroutine.py
|   |   |       ├── decorator.py
|   |   |       ├── descriptor.py
|   |   |       ├── docstring_signature.py
|   |   |       ├── enum.py
|   |   |       ├── final.py
|   |   |       ├── functions.py
|   |   |       ├── genericalias.py
|   |   |       ├── imported_members.py
|   |   |       ├── inheritance.py
|   |   |       ├── methods.py
|   |   |       ├── name_conflict
|   |   |       ├── name_mangling.py
|   |   |       ├── need_mocks.py
|   |   |       ├── overload.py
|   |   |       ├── partialfunction.py
|   |   |       ├── partialmethod.py
|   |   |       ├── pep570.py
|   |   |       ├── private.py
|   |   |       ├── process_docstring.py
|   |   |       ├── singledispatch.py
|   |   |       ├── singledispatchmethod.py
|   |   |       ├── slots.py
|   |   |       ├── sort_by_all.py
|   |   |       ├── typed_vars.py
|   |   |       ├── typehints.py
|   |   |       ├── typevar.py
|   |   |       └── wrappedfunction.py
|   |   ├── test-ext-autosectionlabel
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosectionlabel-prefix-document
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── autosummary_importfail.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-imported_members
|   |   |   ├── autosummary_dummy_package
|   |   |   |   ├── __init__.py
|   |   |   |   └── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-mock_imports
|   |   |   ├── conf.py
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-recursive
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── package
|   |   |   |   ├── __init__.py
|   |   |   |   ├── module.py
|   |   |   |   ├── module_importfail.py
|   |   |   |   └── package
|   |   |   └── package2
|   |   |       ├── __init__.py
|   |   |       └── module.py
|   |   ├── test-ext-autosummary-skip-member
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-autosummary-template
|   |   |   ├── _templates
|   |   |   |   └── empty.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-coverage
|   |   |   ├── conf.py
|   |   |   ├── coverage_ignored.py
|   |   |   ├── coverage_not_ignored.py
|   |   |   └── index.rst
|   |   ├── test-ext-doctest
|   |   |   ├── conf.py
|   |   |   └── doctest.txt
|   |   ├── test-ext-doctest-skipif
|   |   |   ├── conf.py
|   |   |   └── skipif.txt
|   |   ├── test-ext-doctest-with-autodoc
|   |   |   ├── conf.py
|   |   |   ├── dir
|   |   |   |   ├── __init__.py
|   |   |   |   ├── bar.py
|   |   |   |   └── inner.rst
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-githubpages
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-graphviz
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-ifconfig
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-imgconverter
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-inheritance_diagram
|   |   |   ├── conf.py
|   |   |   ├── example
|   |   |   |   ├── __init__.py
|   |   |   |   └── sphinx.py
|   |   |   ├── index.rst
|   |   |   └── test.py
|   |   ├── test-ext-intersphinx-cppdomain
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── math.rst
|   |   |   └── page.rst
|   |   ├── test-ext-math-compat
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math-simple
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-todo
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-ext-viewcode
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── objects.rst
|   |   |   └── spam
|   |   |       ├── __init__.py
|   |   |       ├── mod1.py
|   |   |       ├── mod2.py
|   |   |       └── mod3.py
|   |   ├── test-ext-viewcode-find
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── not_a_package
|   |   |       ├── __init__.py
|   |   |       └── submodule.py
|   |   ├── test-extensions
|   |   |   ├── conf.py
|   |   |   ├── read_parallel.py
|   |   |   ├── read_serial.py
|   |   |   ├── write_parallel.py
|   |   |   └── write_serial.py
|   |   ├── test-footnotes
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-gettext-template
|   |   |   ├── _templates
|   |   |   |   ├── template1.html
|   |   |   |   └── template2.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-glossary
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_assets
|   |   |   ├── conf.py
|   |   |   ├── extra
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   └── subdir
|   |   |   ├── index.rst
|   |   |   ├── static
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   ├── js
|   |   |   |   └── subdir
|   |   |   └── subdir
|   |   |       └── _build
|   |   ├── test-html_entity
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_scaled_image_link
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_style
|   |   |   ├── _static
|   |   |   |   └── default.css
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-parsed-literal
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-section
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-images
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── subdir
|   |   |       └── index.rst
|   |   ├── test-index_on_title
|   |   |   ├── conf.py
|   |   |   └── contents.rst
|   |   ├── test-inheritance
|   |   |   ├── basic_diagram.rst
|   |   |   ├── conf.py
|   |   |   ├── diagram_module_w_2_top_classes.rst
|   |   |   ├── diagram_w_1_top_class.rst
|   |   |   ├── diagram_w_2_top_classes.rst
|   |   |   ├── diagram_w_nested_classes.rst
|   |   |   ├── diagram_w_parts.rst
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── test.py
|   |   |   |   └── test_nested.py
|   |   |   └── index.rst
|   |   ├── test-intl
|   |   |   ├── _templates
|   |   |   |   └── contents.html
|   |   |   ├── admonitions.txt
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── definition_terms.txt
|   |   |   ├── docfields.txt
|   |   |   ├── external_links.txt
|   |   |   ├── figure.txt
|   |   |   ├── footnote.txt
|   |   |   ├── glossary_terms.txt
|   |   |   ├── glossary_terms_inconsistency.txt
|   |   |   ├── index.txt
|   |   |   ├── index_entries.txt
|   |   |   ├── label_target.txt
|   |   |   ├── literalblock.txt
|   |   |   ├── only.txt
|   |   |   ├── raw.txt
|   |   |   ├── refs.txt
|   |   |   ├── refs_inconsistency.txt
|   |   |   ├── refs_python_domain.txt
|   |   |   ├── role_xref.txt
|   |   |   ├── rubric.txt
|   |   |   ├── section.txt
|   |   |   ├── seealso.txt
|   |   |   ├── subdir
|   |   |   |   └── index.txt
|   |   |   ├── table.txt
|   |   |   ├── toctree.txt
|   |   |   ├── topic.txt
|   |   |   ├── versionchange.txt
|   |   |   ├── warnings.txt
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-keep_warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-babel
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-latex-equations
|   |   |   ├── conf.py
|   |   |   ├── equations.rst
|   |   |   └── expects
|   |   ├── test-latex-figure-in-admonition
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-includegraphics
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-index
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-labels
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── otherdoc.rst
|   |   ├── test-latex-numfig
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── indexhowto.rst
|   |   |   └── indexmanual.rst
|   |   ├── test-latex-table
|   |   |   ├── _mytemplates
|   |   |   |   └── latex
|   |   |   ├── complex.rst
|   |   |   ├── conf.py
|   |   |   ├── expects
|   |   |   ├── index.rst
|   |   |   ├── longtable.rst
|   |   |   └── tabular.rst
|   |   ├── test-latex-theme
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── theme
|   |   |       └── custom
|   |   ├── test-latex-title
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-unicode
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck
|   |   |   ├── conf.py
|   |   |   └── links.txt
|   |   ├── test-locale
|   |   |   ├── locale1
|   |   |   |   └── en
|   |   |   └── locale2
|   |   |       └── en
|   |   ├── test-manpage_url
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-citation
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-rubric
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-maxlistdepth
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-metadata
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-need-escaped
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux.rst
|   |   ├── test-nested-enumerated-list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nested-tables
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-numbered-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-numfig
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-productionlist
|   |   |   ├── Bare.rst
|   |   |   ├── Dup1.rst
|   |   |   ├── Dup2.rst
|   |   |   ├── LineContinuation.rst
|   |   |   ├── P1.rst
|   |   |   ├── P2.rst
|   |   |   ├── conf.py
|   |   |   ├── firstLineRule.rst
|   |   |   └── index.rst
|   |   ├── test-prolog
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── markdown.md
|   |   |   ├── prolog_markdown_parser.py
|   |   |   └── restructuredtext.rst
|   |   ├── test-pycode
|   |   |   └── cp_1251_coded.py
|   |   ├── test-pycode-egg
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── src
|   |   |       ├── sample.py
|   |   |       └── setup.py
|   |   ├── test-reST-code-block
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-refonly_bullet_list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-roles-download
|   |   |   ├── another
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-root
|   |   |   ├── _templates
|   |   |   |   ├── contentssb.html
|   |   |   |   ├── customsb.html
|   |   |   |   └── layout.html
|   |   |   ├── autodoc.txt
|   |   |   ├── autodoc_target.py
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── extapi.txt
|   |   |   ├── extensions.txt
|   |   |   ├── footnote.txt
|   |   |   ├── images.txt
|   |   |   ├── includes.txt
|   |   |   ├── index.txt
|   |   |   ├── lists.txt
|   |   |   ├── markup.txt
|   |   |   ├── math.txt
|   |   |   ├── objects.txt
|   |   |   ├── parsermod.py
|   |   |   ├── special
|   |   |   |   └── code.py
|   |   |   └── subdir
|   |   |       ├── excluded.txt
|   |   |       ├── images.txt
|   |   |       └── includes.txt
|   |   ├── test-search
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nosearch.rst
|   |   |   └── tocitem.rst
|   |   ├── test-setup
|   |   |   ├── doc
|   |   |   |   ├── conf.py
|   |   |   |   └── index.txt
|   |   |   └── setup.py
|   |   ├── test-smartquotes
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-stylesheets
|   |   |   ├── _templates
|   |   |   |   └── layout.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-templating
|   |   |   ├── _templates
|   |   |   |   ├── autosummary
|   |   |   |   └── layout.html
|   |   |   ├── autosummary_templating.txt
|   |   |   ├── conf.py
|   |   |   └── index.txt
|   |   ├── test-theming
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── setup.py
|   |   |   └── test_theme
|   |   |       ├── __init__.py
|   |   |       ├── staticfiles
|   |   |       └── test-theme
|   |   ├── test-tocdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   ├── qux.rst
|   |   |   └── tocdepth.rst
|   |   ├── test-toctree-duplicated
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree-empty
|   |   |   ├── _templates
|   |   |   |   └── localtoc.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-toctree-glob
|   |   |   ├── bar
|   |   |   |   ├── bar_1.rst
|   |   |   |   ├── bar_2.rst
|   |   |   |   ├── bar_3.rst
|   |   |   |   ├── bar_4
|   |   |   |   └── index.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux
|   |   |       ├── index.rst
|   |   |       ├── qux_1.rst
|   |   |       └── qux_2.rst
|   |   ├── test-toctree-maxdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   └── qux.rst
|   |   ├── test-trim_doctest_flags
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-versioning
|   |   |   ├── added.txt
|   |   |   ├── conf.py
|   |   |   ├── deleted.txt
|   |   |   ├── deleted_end.txt
|   |   |   ├── index.txt
|   |   |   ├── insert.txt
|   |   |   ├── insert_beginning.txt
|   |   |   ├── insert_similar.txt
|   |   |   ├── modified.txt
|   |   |   └── original.txt
|   |   └── test-warnings
|   |       ├── autodoc_fodder.py
|   |       ├── conf.py
|   |       ├── index.rst
|   |       └── undecodable.rst
|   ├── test_api_translator.py
|   ├── test_application.py
|   ├── test_build.py
|   ├── test_build_changes.py
|   ├── test_build_dirhtml.py
|   ├── test_build_epub.py
|   ├── test_build_gettext.py
|   ├── test_build_html.py
|   ├── test_build_latex.py
|   ├── test_build_linkcheck.py
|   ├── test_build_manpage.py
|   ├── test_build_texinfo.py
|   ├── test_build_text.py
|   ├── test_builder.py
|   ├── test_catalogs.py
|   ├── test_config.py
|   ├── test_correct_year.py
|   ├── test_directive_code.py
|   ├── test_directive_only.py
|   ├── test_directive_other.py
|   ├── test_directive_patch.py
|   ├── test_docutilsconf.py
|   ├── test_domain_c.py
|   ├── test_domain_cpp.py
|   ├── test_domain_js.py
|   ├── test_domain_py.py
|   ├── test_domain_rst.py
|   ├── test_domain_std.py
|   ├── test_environment.py
|   ├── test_environment_indexentries.py
|   ├── test_environment_toctree.py
|   ├── test_errors.py
|   ├── test_events.py
|   ├── test_ext_apidoc.py
|   ├── test_ext_autodoc.py
|   ├── test_ext_autodoc_autofunction.py
|   ├── test_ext_autodoc_configs.py
|   ├── test_ext_autodoc_events.py
|   ├── test_ext_autodoc_mock.py
|   ├── test_ext_autodoc_private_members.py
|   ├── test_ext_autosectionlabel.py
|   ├── test_ext_autosummary.py
|   ├── test_ext_coverage.py
|   ├── test_ext_doctest.py
|   ├── test_ext_duration.py
|   ├── test_ext_githubpages.py
|   ├── test_ext_graphviz.py
|   ├── test_ext_ifconfig.py
|   ├── test_ext_imgconverter.py
|   ├── test_ext_inheritance_diagram.py
|   ├── test_ext_intersphinx.py
|   ├── test_ext_math.py
|   ├── test_ext_napoleon.py
|   ├── test_ext_napoleon_docstring.py
|   ├── test_ext_napoleon_iterators.py
|   ├── test_ext_todo.py
|   ├── test_ext_viewcode.py
|   ├── test_highlighting.py
|   ├── test_intl.py
|   ├── test_locale.py
|   ├── test_markup.py
|   ├── test_metadata.py
|   ├── test_parser.py
|   ├── test_project.py
|   ├── test_pycode.py
|   ├── test_pycode_ast.py
|   ├── test_pycode_parser.py
|   ├── test_quickstart.py
|   ├── test_roles.py
|   ├── test_search.py
|   ├── test_setup_command.py
|   ├── test_smartquotes.py
|   ├── test_templating.py
|   ├── test_theming.py
|   ├── test_toctree.py
|   ├── test_transforms_post_transforms_code.py
|   ├── test_util.py
|   ├── test_util_docstrings.py
|   ├── test_util_docutils.py
|   ├── test_util_fileutil.py
|   ├── test_util_i18n.py
|   ├── test_util_images.py
|   ├── test_util_inspect.py
|   ├── test_util_inventory.py
|   ├── test_util_jsdump.py
|   ├── test_util_logging.py
|   ├── test_util_matching.py
|   ├── test_util_nodes.py
|   ├── test_util_pycompat.py
|   ├── test_util_rst.py
|   ├── test_util_template.py
|   ├── test_util_typing.py
|   ├── test_versioning.py
|   ├── test_writer_latex.py
|   └── typing_test_data.py
└── utils
    ├── __init__.py
    ├── bump_docker.sh
    ├── bump_version.py
    ├── checks.py
    ├── doclinter.py
    └── jssplitter_generator.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: linkcheck could also check local (internal) links

Description: Subject: linkcheck currently doesn't check local (internal) links, but this would be useful.

<!--
  Important: This is a list of issues for Sphinx, not a forum.
  If you'd like to post a question, please move to sphinx-users group.
  https://groups.google.com/forum/#!forum/sphinx-users

  Thanks,
-->

### Problem
See above.

#### Procedure to reproduce the problem
Create a template project with sphinx-quickstart, put the following in index.rst
```
broken external-link_
broken local-link_

.. _external-link: https://lkfqhlkghflkhs
.. _local-link: doesntexist
```

Run `make linkcheck`

#### Error logs / results
```
Running Sphinx v1.7.6
making output directory...
loading pickled environment... done
building [mo]: targets for 0 po files that are out of date
building [linkcheck]: targets for 1 source files that are out of date
updating environment: 0 added, 0 changed, 0 removed
looking for now-outdated files... none found
preparing documents... done
writing output... [100%] index                                                                   
(line   14) -local-   doesntexist
(line   14) broken    https://lkfqhlkghflkhs - HTTPSConnectionPool(host='lkfqhlkghflkhs', port=443): Max retries exceeded with url: / (Caused by NewConnectionError('<urllib3.connection.VerifiedHTTPSConnection object at 0x7faed7ddfc88>: Failed to establish a new connection: [Errno -2] Name or service not known',))

build finished with problems.
make: *** [Makefile:20: linkcheck] Error 1
```

#### Expected results
Also a check for the local link.

### Reproducible project / your project
N/A

### Environment info
- OS: Arch Linux
- Python version: 3.6
- Sphinx version: 1.7.6


Patch information:
diff --git a/doc/usage/builders/index.rst b/doc/usage/builders/index.rst
index db6706944..c860a2517 100644
--- a/doc/usage/builders/index.rst
+++ b/doc/usage/builders/index.rst
@@ -428,9 +428,11 @@ name is ``rinoh``. Refer to the `rinohtype manual`_ for details.
 .. module:: sphinx.builders.linkcheck
 .. class:: CheckExternalLinksBuilder
 
-   This builder scans all documents for external links, tries to open them with
-   ``requests``, and writes an overview which ones are broken and redirected to
-   standard output and to :file:`output.txt` in the output directory.
+   This builder scans all documents for external HTTP(S) links and local
+   links. External links are tried to open with ``requests`` while local
+   links are checked for existence on disk. It writes an overview which
+   ones are broken and redirected to standard output and to :file:`output.txt`
+   in the output directory.
 
    .. autoattribute:: name
 
diff --git a/sphinx/builders/linkcheck.py b/sphinx/builders/linkcheck.py
index dd5317087..c159b273f 100644
--- a/sphinx/builders/linkcheck.py
+++ b/sphinx/builders/linkcheck.py
@@ -77,7 +77,11 @@ def check_anchor(response: requests.requests.Response, anchor: str) -> bool:
 
 class CheckExternalLinksBuilder(Builder):
     """
-    Checks for broken external links.
+    Checks for broken links.
+
+    This builder scans all documents for external HTTP(S) links and local
+    (internal) links. External links are validated via HTTP requests, and
+    local links are checked for existence on disk.
     """
     name = 'linkcheck'
     epilog = __('Look for any errors in the above output or in '
@@ -213,7 +217,17 @@ class CheckExternalLinksBuilder(Builder):
             if len(uri) == 0 or uri.startswith(('#', 'mailto:', 'ftp:')):
                 return 'unchecked', '', 0
             elif not uri.startswith(('http:', 'https:')):
-                return 'local', '', 0
+                # Check local (internal) links by resolving against the document path
+                local_uri = uri.split('#', 1)[0] if '#' in uri else uri
+                try:
+                    rel_fn, abs_fn = self.env.relfn2path(local_uri, docname)
+                except Exception:
+                    # If resolution fails, consider as broken
+                    return 'broken', __("Local path could not be resolved: %s") % local_uri, 0
+                if path.exists(abs_fn):
+                    return 'working', '', 0
+                else:
+                    return 'broken', __("Local path not found: %s") % rel_fn, 0
             elif uri in self.good:
                 return 'working', 'old', 0
             elif uri in self.broken:
@@ -324,7 +338,7 @@ class CheckExternalLinksBuilder(Builder):
         # image nodes
         for imgnode in doctree.traverse(nodes.image):
             uri = imgnode['candidates'].get('?')
-            if uri and '://' in uri:
+            if uri:
                 lineno = get_node_line(imgnode)
                 self.wqueue.put((uri, docname, lineno), False)
                 n += 1


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `tests/test_build_linkcheck.py` and `tests/roots/test-linkcheck/links.txt`.
Extra Requirements: 
Purpose: I need to analyze the existing tests for the linkcheck builder to find test cases that are relevant to the bug fix, which involves checking local links.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: tests/roots/test-linkcheck/links.txt
Line number range: 1 - 16
Content:
1. This is from CPython documentation.
2. 
3. * Also, if there is a `default namespace <https://www.w3.org/TR/2006/REC-xml-names-20060816/#defaulting>`__, that full URI gets prepended to all of the non-prefixed tags.
4. 
5. * The URL having anchor: `http://www.sphinx-doc.org/en/1.4.8/tutorial.html#install-sphinx`_
6. 
7. Some additional anchors to exercise ignore code
8. 
9. * `Example Bar invalid <https://www.google.com/#!bar>`_
10. * `Example Bar invalid <https://www.google.com#!bar>`_ tests that default ignore anchor of #! does not need to be prefixed with /
11. * `Example Bar invalid <https://www.google.com/#top>`_
12. * `Example anchor invalid <http://www.sphinx-doc.org/en/1.7/intro.html#does-not-exist>`_
13. * `Complete nonsense <https://localhost:7777/doesnotexist>`_
14. 
15. .. image:: https://www.google.com/image.png
16. .. figure:: https://www.google.com/image2.png


File: tests/test_build_linkcheck.py
Line number range: 1 - 159
Content:
1. """
2.     test_build_linkcheck
3.     ~~~~~~~~~~~~~~~~~~~~
4. 
5.     Test the build process with manpage builder with the test root.
6. 
7.     :copyright: Copyright 2007-2020 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import json
12. import re
13. from unittest import mock
14. import pytest
15. 
16. 
17. @pytest.mark.sphinx('linkcheck', testroot='linkcheck', freshenv=True)
18. def test_defaults(app, status, warning):
19.     app.builder.build_all()
20. 
21.     assert (app.outdir / 'output.txt').exists()
22.     content = (app.outdir / 'output.txt').read_text()
23. 
24.     print(content)
25.     # looking for '#top' and '#does-not-exist' not found should fail
26.     assert "Anchor 'top' not found" in content
27.     assert "Anchor 'does-not-exist' not found" in content
28.     # looking for non-existent URL should fail
29.     assert " Max retries exceeded with url: /doesnotexist" in content
30.     # images should fail
31.     assert "Not Found for url: https://www.google.com/image.png" in content
32.     assert "Not Found for url: https://www.google.com/image2.png" in content
33.     assert len(content.splitlines()) == 5
34. 
35. 
36. @pytest.mark.sphinx('linkcheck', testroot='linkcheck', freshenv=True)
37. def test_defaults_json(app, status, warning):
38.     app.builder.build_all()
39. 
40.     assert (app.outdir / 'output.json').exists()
41.     content = (app.outdir / 'output.json').read_text()
42.     print(content)
43. 
44.     rows = [json.loads(x) for x in content.splitlines()]
45.     row = rows[0]
46.     for attr in ["filename", "lineno", "status", "code", "uri",
47.                  "info"]:
48.         assert attr in row
49. 
50.     assert len(content.splitlines()) == 8
51.     assert len(rows) == 8
52.     # the output order of the rows is not stable
53.     # due to possible variance in network latency
54.     rowsby = {row["uri"]:row for row in rows}
55.     assert rowsby["https://www.google.com#!bar"] == {
56.         'filename': 'links.txt',
57.         'lineno': 10,
58.         'status': 'working',
59.         'code': 0,
60.         'uri': 'https://www.google.com#!bar',
61.         'info': ''
62.     }
63.     # looking for non-existent URL should fail
64.     dnerow = rowsby['https://localhost:7777/doesnotexist']
65.     assert dnerow['filename'] == 'links.txt'
66.     assert dnerow['lineno'] == 13
67.     assert dnerow['status'] == 'broken'
68.     assert dnerow['code'] == 0
69.     assert dnerow['uri'] == 'https://localhost:7777/doesnotexist'
70.     assert rowsby['https://www.google.com/image2.png'] == {
71.         'filename': 'links.txt',
72.         'lineno': 16,
73.         'status': 'broken',
74.         'code': 0,
75.         'uri': 'https://www.google.com/image2.png',
76.         'info': '404 Client Error: Not Found for url: https://www.google.com/image2.png'
77.     }
78.     # looking for '#top' and '#does-not-exist' not found should fail
79.     assert "Anchor 'top' not found" == \
80.         rowsby["https://www.google.com/#top"]["info"]
81.     assert "Anchor 'does-not-exist' not found" == \
82.         rowsby["http://www.sphinx-doc.org/en/1.7/intro.html#does-not-exist"]["info"]
83.     # images should fail
84.     assert "Not Found for url: https://www.google.com/image.png" in \
85.         rowsby["https://www.google.com/image.png"]["info"]
86. 
87. 
88. @pytest.mark.sphinx(
89.     'linkcheck', testroot='linkcheck', freshenv=True,
90.     confoverrides={'linkcheck_anchors_ignore': ["^!", "^top$"],
91.                    'linkcheck_ignore': [
92.                        'https://localhost:7777/doesnotexist',
93.                        'http://www.sphinx-doc.org/en/1.7/intro.html#',
94.                        'https://www.google.com/image.png',
95.                        'https://www.google.com/image2.png']
96.                    })
97. def test_anchors_ignored(app, status, warning):
98.     app.builder.build_all()
99. 
100.     assert (app.outdir / 'output.txt').exists()
101.     content = (app.outdir / 'output.txt').read_text()
102. 
103.     # expect all ok when excluding #top
104.     assert not content
105. 
106. 
107. @pytest.mark.sphinx(
108.     'linkcheck', testroot='linkcheck', freshenv=True,
109.     confoverrides={'linkcheck_auth': [
110.                         (r'.+google\.com/image.+', 'authinfo1'),
111.                         (r'.+google\.com.+', 'authinfo2'),
112.                    ]
113.                   })
114. def test_auth(app, status, warning):
115.     mock_req = mock.MagicMock()
116.     mock_req.return_value = 'fake-response'
117. 
118.     with mock.patch.multiple('requests', get=mock_req, head=mock_req):
119.         app.builder.build_all()
120.         for c_args, c_kwargs in mock_req.call_args_list:
121.             if 'google.com/image' in c_args[0]:
122.                 assert c_kwargs['auth'] == 'authinfo1'
123.             elif 'google.com' in c_args[0]:
124.                 assert c_kwargs['auth'] == 'authinfo2'
125.             else:
126.                 assert not c_kwargs['auth']
127. 
128. 
129. @pytest.mark.sphinx(
130.     'linkcheck', testroot='linkcheck', freshenv=True,
131.     confoverrides={'linkcheck_request_headers': {
132.         "https://localhost:7777/": {
133.             "Accept": "text/html",
134.         },
135.         "http://www.sphinx-doc.org": {  # no slash at the end
136.             "Accept": "application/json",
137.         },
138.         "*": {
139.             "X-Secret": "open sesami",
140.         }
141.     }})
142. def test_linkcheck_request_headers(app, status, warning):
143.     mock_req = mock.MagicMock()
144.     mock_req.return_value = 'fake-response'
145. 
146.     with mock.patch.multiple('requests', get=mock_req, head=mock_req):
147.         app.builder.build_all()
148.         for args, kwargs in mock_req.call_args_list:
149.             url = args[0]
150.             headers = kwargs.get('headers', {})
151.             if "https://localhost:7777" in url:
152.                 assert headers["Accept"] == "text/html"
153.             elif 'http://www.sphinx-doc.org' in url:
154.                 assert headers["Accept"] == "application/json"
155.             elif 'https://www.google.com' in url:
156.                 assert headers["Accept"] == "text/html,application/xhtml+xml;q=0.9,*/*;q=0.8"
157.                 assert headers["X-Secret"] == "open sesami"
158.             else:
159.                 assert headers["Accept"] == "text/html,application/xhtml+xml;q=0.9,*/*;q=0.8"

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-24 19:56:49,783 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find three test cases that are relevant to checking local links. The provided context in `tests/test_build_linkcheck.py` only contains tests for external links. To find examples of tests that handle local file paths and references, which is the core of the bug fix, I need to examine other test files that deal with similar functionality like resolving internal document links, handling local image paths, and resolving standard cross-references.' query='Please provide the full content of `tests/test_toctree.py`, `tests/test_util_images.py`, and `tests/test_domain_std.py`.' extra_requirements='If sending the full files is too large, please prioritize `tests/test_toctree.py` and `tests/test_util_images.py` as they are most relevant to internal link and resource handling.' purpose='These files are needed to find existing test patterns for local path and reference resolution, which is analogous to the functionality being added in the patch for the linkcheck builder.'
2025-12-24 19:56:49,784 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `tests/test_toctree.py`, `tests/test_util_images.py`, and `tests/test_domain_std.py`.
2025-12-24 19:56:49,785 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-24 19:56:49,785 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-24 19:56:49,786 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-24 19:56:49,786 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `tests/test_toctree.py`, `tests/test_util_images.py`, and `tests/test_domain_std.py`.
Extra requirements: If sending the full files is too large, please prioritize `tests/test_toctree.py` and `tests/test_util_images.py` as they are most relevant to internal link and resource handling.
Purpose: These files are needed to find existing test patterns for local path and reference resolution, which is analogous to the functionality being added in the patch for the linkcheck builder.
2025-12-24 19:56:53,286 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have started by fetching the contents of `tests/test_toctree.py`, which you mentioned is the highest priority. I will proceed to retrieve the other two files you requested.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/test_toctree.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2149, 'candidates_token_count': 58, 'total_token_count': 2462, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2149}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 58}], 'thoughts_token_count': 255, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.1258436318101554, 'model_name': 'gemini-2.5-pro'} id='run--2b6984fd-d71a-44bc-b0f5-97fcf319699f-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/test_toctree.py'}, 'id': 'bc8bdea3-c627-4634-85fa-48916606732e', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2149, 'output_tokens': 58, 'total_tokens': 2462, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 255}}
2025-12-24 19:56:55,359 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/test_util_images.py"}'}, '__gemini_function_call_thought_signatures__': {'c2e3d6cc-e7ec-4441-881c-1985925a9df4': 'Cu4DAY89a1/UEOxMDjrFH1/9O/qyRJdTZER5SmiLRHhVm+jGC/HNQ8PxNhgrHmzPIBWxL/n4h49nGqeiPzo0r4vXqGRsG5pmUkZyajXJtWLpJ40Q4JaHdU6lYYjfJdhTXraVDn/3ID+5HaDjRAUzZAN+ZeiMeKfTAE5gbhQr7bOsvaPol8DdDfQBkVuw+ce19IIaHe/a8lhZ6S+Xx/gYZHUnSBDpJPhnf/Iyb2TMlFmAYyhJclGOiWdWX63rO2Xe1vJikxnvUXEm1tyjLUPDC3Ficc9EfQNvczRaZ5eaGOkef0Z0ql8kyUI5VK7dx3RsXtlnyEy0LAyvb9Dx4u1I3xgC3PI8r4KcUUjETtucXCLnYRCsUYC3H/Duz3DuhaGnobcneJhk9OsZ6C22tYmfCn602NpyWUBnMkv3CidWVpxcc0dax5r+5MF+tuhBMR1lLl0u9JZb2oGbEth/oxTWk2b7wg1tihqTMIx5JKVYobV4D7y5CG42aornLe2oaZiE0j/D4sdJv74NLxWRDlCRisvNlXYk3isy1AQU2IP6fhiuRQpwcLwJdtGstQRHnhMhAzV169b6AjUPBeB7mnARKeojzJt+PG1hOYE1gChEirSp0PH8vzKQdPjcePYZvo2beELaLuelEh9A5SqJkFVyO2E='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 3197, 'candidates_token_count': 23, 'total_token_count': 3358, 'cached_content_token_count': 1583, 'prompt_tokens_details': [{'modality': 1, 'token_count': 3197}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1583}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 23}], 'thoughts_token_count': 138}, 'finish_reason': 'STOP', 'avg_logprobs': -0.22542646656865659, 'model_name': 'gemini-2.5-pro'} id='run--3aff6402-c3f9-47e6-b3d6-67342877acd0-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/test_util_images.py'}, 'id': 'c2e3d6cc-e7ec-4441-881c-1985925a9df4', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3197, 'output_tokens': 23, 'total_tokens': 3358, 'input_token_details': {'cache_read': 1583}, 'output_token_details': {'reasoning': 138}}
2025-12-24 19:56:57,054 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/test_domain_std.py"}'}, '__gemini_function_call_thought_signatures__': {'f63d7228-5ab7-4c9e-a968-69942cfd93df': 'Cs8BAY89a1/Axa77WcK8h2Av0LOhqoX5MP4aQyXwYRhQ/lNxtl9uVpDoiMrgEFNpssEeQAw4JpQX2fYKaGQI5OXcB4cuuef7SxFczVuoPv6YPVSFtGoZn2uiYW7AX/l1CyFdZejyU8ow194wauAFmfsQcjqI9QK9ru1OKVVOboKzwwvDHGv86wxAa5ue/QGdkI9TQVxJI3UdLvmLJE39mPOucXcAqGmQRFQuu38yAIvdPne05vNHAflwFnpQ/hPvccmGMUINTZ+EB8AYGG2eOnxQ'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 4680, 'candidates_token_count': 23, 'total_token_count': 4752, 'cached_content_token_count': 3368, 'prompt_tokens_details': [{'modality': 1, 'token_count': 4818}], 'cache_tokens_details': [{'modality': 1, 'token_count': 3368}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 23}], 'thoughts_token_count': 49}, 'finish_reason': 'STOP', 'avg_logprobs': -0.09076494755952255, 'model_name': 'gemini-2.5-pro'} id='run--cb3dcf78-d8ae-4b4b-8efc-5d68ef0e2381-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/test_domain_std.py'}, 'id': 'f63d7228-5ab7-4c9e-a968-69942cfd93df', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4680, 'output_tokens': 23, 'total_tokens': 4752, 'input_token_details': {'cache_read': 3368}, 'output_token_details': {'reasoning': 49}}
2025-12-24 19:56:58,984 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the full content of the three requested test files: `tests/test_toctree.py`, `tests/test_util_images.py`, and `tests/test_domain_std.py`. I started with `tests/test_toctree.py` and then proceeded to fetch the other two files as requested.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 11143, 'candidates_token_count': 69, 'total_token_count': 11270, 'cached_content_token_count': 3657, 'prompt_tokens_details': [{'modality': 1, 'token_count': 11330}], 'cache_tokens_details': [{'modality': 1, 'token_count': 3657}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 69}], 'thoughts_token_count': 58}, 'finish_reason': 'STOP', 'avg_logprobs': -0.08105395496755406, 'model_name': 'gemini-2.5-pro'} id='run--ddab0a60-846e-4058-9446-3c81fd561118-0' usage_metadata={'input_tokens': 11143, 'output_tokens': 69, 'total_tokens': 11270, 'input_token_details': {'cache_read': 3657}, 'output_token_details': {'reasoning': 58}}
2025-12-24 19:56:58,986 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `tests/test_toctree.py`, `tests/test_util_images.py`, and `tests/test_domain_std.py`.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If sending the full files is too large, please prioritize `tests/test_toctree.py` and `tests/test_util_images.py` as they are most relevant to internal link and resource handling.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
These files are needed to find existing test patterns for local path and reference resolution, which is analogous to the functionality being added in the patch for the linkcheck builder.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/test_domain_std.py
Line number range: 1 - 396
Content:
1. """
2.     test_domain_std
3.     ~~~~~~~~~~~~~~~
4. 
5.     Tests the std domain
6. 
7.     :copyright: Copyright 2007-2020 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import pytest
12. 
13. from unittest import mock
14. 
15. from docutils import nodes
16. from docutils.nodes import definition, definition_list, definition_list_item, term
17. 
18. from html5lib import HTMLParser
19. 
20. from sphinx import addnodes
21. from sphinx.addnodes import (
22.     desc, desc_addname, desc_content, desc_name, desc_signature, glossary, index,
23.     pending_xref
24. )
25. from sphinx.domains.std import StandardDomain
26. from sphinx.testing import restructuredtext
27. from sphinx.testing.util import assert_node
28. from sphinx.util import docutils
29. 
30. 
31. def test_process_doc_handle_figure_caption():
32.     env = mock.Mock(domaindata={})
33.     env.app.registry.enumerable_nodes = {}
34.     figure_node = nodes.figure(
35.         '',
36.         nodes.caption('caption text', 'caption text'),
37.     )
38.     document = mock.Mock(
39.         nametypes={'testname': True},
40.         nameids={'testname': 'testid'},
41.         ids={'testid': figure_node},
42.         citation_refs={},
43.     )
44.     document.traverse.return_value = []
45. 
46.     domain = StandardDomain(env)
47.     if 'testname' in domain.data['labels']:
48.         del domain.data['labels']['testname']
49.     domain.process_doc(env, 'testdoc', document)
50.     assert 'testname' in domain.data['labels']
51.     assert domain.data['labels']['testname'] == (
52.         'testdoc', 'testid', 'caption text')
53. 
54. 
55. def test_process_doc_handle_table_title():
56.     env = mock.Mock(domaindata={})
57.     env.app.registry.enumerable_nodes = {}
58.     table_node = nodes.table(
59.         '',
60.         nodes.title('title text', 'title text'),
61.     )
62.     document = mock.Mock(
63.         nametypes={'testname': True},
64.         nameids={'testname': 'testid'},
65.         ids={'testid': table_node},
66.         citation_refs={},
67.     )
68.     document.traverse.return_value = []
69. 
70.     domain = StandardDomain(env)
71.     if 'testname' in domain.data['labels']:
72.         del domain.data['labels']['testname']
73.     domain.process_doc(env, 'testdoc', document)
74.     assert 'testname' in domain.data['labels']
75.     assert domain.data['labels']['testname'] == (
76.         'testdoc', 'testid', 'title text')
77. 
78. 
79. def test_get_full_qualified_name():
80.     env = mock.Mock(domaindata={})
81.     env.app.registry.enumerable_nodes = {}
82.     domain = StandardDomain(env)
83. 
84.     # normal references
85.     node = nodes.reference()
86.     assert domain.get_full_qualified_name(node) is None
87. 
88.     # simple reference to options
89.     node = nodes.reference(reftype='option', reftarget='-l')
90.     assert domain.get_full_qualified_name(node) is None
91. 
92.     # options with std:program context
93.     kwargs = {'std:program': 'ls'}
94.     node = nodes.reference(reftype='option', reftarget='-l', **kwargs)
95.     assert domain.get_full_qualified_name(node) == 'ls.-l'
96. 
97. 
98. def test_glossary(app):
99.     text = (".. glossary::\n"
100.             "\n"
101.             "   term1\n"
102.             "   TERM2\n"
103.             "       description\n"
104.             "\n"
105.             "   term3 : classifier\n"
106.             "       description\n"
107.             "       description\n"
108.             "\n"
109.             "   term4 : class1 : class2\n"
110.             "       description\n")
111. 
112.     # doctree
113.     doctree = restructuredtext.parse(app, text)
114.     assert_node(doctree, (
115.         [glossary, definition_list, ([definition_list_item, ([term, ("term1",
116.                                                                      index)],
117.                                                              [term, ("TERM2",
118.                                                                      index)],
119.                                                              definition)],
120.                                      [definition_list_item, ([term, ("term3",
121.                                                                      index)],
122.                                                              definition)],
123.                                      [definition_list_item, ([term, ("term4",
124.                                                                      index)],
125.                                                              definition)])],
126.     ))
127.     assert_node(doctree[0][0][0][0][1],
128.                 entries=[("single", "term1", "term-term1", "main", None)])
129.     assert_node(doctree[0][0][0][1][1],
130.                 entries=[("single", "TERM2", "term-TERM2", "main", None)])
131.     assert_node(doctree[0][0][0][2],
132.                 [definition, nodes.paragraph, "description"])
133.     assert_node(doctree[0][0][1][0][1],
134.                 entries=[("single", "term3", "term-term3", "main", "classifier")])
135.     assert_node(doctree[0][0][1][1],
136.                 [definition, nodes.paragraph, ("description\n"
137.                                                "description")])
138.     assert_node(doctree[0][0][2][0][1],
139.                 entries=[("single", "term4", "term-term4", "main", "class1")])
140.     assert_node(doctree[0][0][2][1],
141.                 [nodes.definition, nodes.paragraph, "description"])
142. 
143.     # index
144.     domain = app.env.get_domain("std")
145.     objects = list(domain.get_objects())
146.     assert ("term1", "term1", "term", "index", "term-term1", -1) in objects
147.     assert ("TERM2", "TERM2", "term", "index", "term-TERM2", -1) in objects
148.     assert ("term3", "term3", "term", "index", "term-term3", -1) in objects
149.     assert ("term4", "term4", "term", "index", "term-term4", -1) in objects
150. 
151.     # term reference (case sensitive)
152.     refnode = domain.resolve_xref(app.env, 'index', app.builder, 'term', 'term1',
153.                                   pending_xref(), nodes.paragraph())
154.     assert_node(refnode, nodes.reference, refid="term-term1")
155. 
156.     # term reference (case insensitive)
157.     refnode = domain.resolve_xref(app.env, 'index', app.builder, 'term', 'term2',
158.                                   pending_xref(), nodes.paragraph())
159.     assert_node(refnode, nodes.reference, refid="term-TERM2")
160. 
161. 
162. def test_glossary_warning(app, status, warning):
163.     # empty line between terms
164.     text = (".. glossary::\n"
165.             "\n"
166.             "   term1\n"
167.             "\n"
168.             "   term2\n")
169.     restructuredtext.parse(app, text, "case1")
170.     assert ("case1.rst:4: WARNING: glossary terms must not be separated by empty lines"
171.             in warning.getvalue())
172. 
173.     # glossary starts with indented item
174.     text = (".. glossary::\n"
175.             "\n"
176.             "       description\n"
177.             "   term\n")
178.     restructuredtext.parse(app, text, "case2")
179.     assert ("case2.rst:3: WARNING: glossary term must be preceded by empty line"
180.             in warning.getvalue())
181. 
182.     # empty line between terms
183.     text = (".. glossary::\n"
184.             "\n"
185.             "   term1\n"
186.             "       description\n"
187.             "   term2\n")
188.     restructuredtext.parse(app, text, "case3")
189.     assert ("case3.rst:4: WARNING: glossary term must be preceded by empty line"
190.             in warning.getvalue())
191. 
192.     # duplicated terms
193.     text = (".. glossary::\n"
194.             "\n"
195.             "   term-case4\n"
196.             "   term-case4\n")
197.     restructuredtext.parse(app, text, "case4")
198.     assert ("case4.rst:3: WARNING: duplicate term description of term-case4, "
199.             "other instance in case4" in warning.getvalue())
200. 
201. 
202. def test_glossary_comment(app):
203.     text = (".. glossary::\n"
204.             "\n"
205.             "   term1\n"
206.             "       description\n"
207.             "   .. term2\n"
208.             "       description\n"
209.             "       description\n")
210.     doctree = restructuredtext.parse(app, text)
211.     assert_node(doctree, (
212.         [glossary, definition_list, definition_list_item, ([term, ("term1",
213.                                                                    index)],
214.                                                            definition)],
215.     ))
216.     assert_node(doctree[0][0][0][1],
217.                 [nodes.definition, nodes.paragraph, "description"])
218. 
219. 
220. def test_glossary_comment2(app):
221.     text = (".. glossary::\n"
222.             "\n"
223.             "   term1\n"
224.             "       description\n"
225.             "\n"
226.             "   .. term2\n"
227.             "   term3\n"
228.             "       description\n"
229.             "       description\n")
230.     doctree = restructuredtext.parse(app, text)
231.     assert_node(doctree, (
232.         [glossary, definition_list, ([definition_list_item, ([term, ("term1",
233.                                                                      index)],
234.                                                              definition)],
235.                                      [definition_list_item, ([term, ("term3",
236.                                                                      index)],
237.                                                              definition)])],
238.     ))
239.     assert_node(doctree[0][0][0][1],
240.                 [nodes.definition, nodes.paragraph, "description"])
241.     assert_node(doctree[0][0][1][1],
242.                 [nodes.definition, nodes.paragraph, ("description\n"
243.                                                      "description")])
244. 
245. 
246. def test_glossary_sorted(app):
247.     text = (".. glossary::\n"
248.             "   :sorted:\n"
249.             "\n"
250.             "   term3\n"
251.             "       description\n"
252.             "\n"
253.             "   term2\n"
254.             "   term1\n"
255.             "       description\n")
256.     doctree = restructuredtext.parse(app, text)
257.     assert_node(doctree, (
258.         [glossary, definition_list, ([definition_list_item, ([term, ("term2",
259.                                                                      index)],
260.                                                              [term, ("term1",
261.                                                                      index)],
262.                                                              definition)],
263.                                      [definition_list_item, ([term, ("term3",
264.                                                                      index)],
265.                                                              definition)])],
266.     ))
267.     assert_node(doctree[0][0][0][2],
268.                 [nodes.definition, nodes.paragraph, "description"])
269.     assert_node(doctree[0][0][1][1],
270.                 [nodes.definition, nodes.paragraph, "description"])
271. 
272. 
273. def test_glossary_alphanumeric(app):
274.     text = (".. glossary::\n"
275.             "\n"
276.             "   1\n"
277.             "   /\n")
278.     restructuredtext.parse(app, text)
279.     objects = list(app.env.get_domain("std").get_objects())
280.     assert ("1", "1", "term", "index", "term-1", -1) in objects
281.     assert ("/", "/", "term", "index", "term-0", -1) in objects
282. 
283. 
284. def test_glossary_conflicted_labels(app):
285.     text = (".. _term-foo:\n"
286.             ".. glossary::\n"
287.             "\n"
288.             "   foo\n")
289.     restructuredtext.parse(app, text)
290.     objects = list(app.env.get_domain("std").get_objects())
291.     assert ("foo", "foo", "term", "index", "term-0", -1) in objects
292. 
293. 
294. def test_cmdoption(app):
295.     text = (".. program:: ls\n"
296.             "\n"
297.             ".. option:: -l\n")
298.     domain = app.env.get_domain('std')
299.     doctree = restructuredtext.parse(app, text)
300.     assert_node(doctree, (addnodes.index,
301.                           [desc, ([desc_signature, ([desc_name, "-l"],
302.                                                     [desc_addname, ()])],
303.                                   [desc_content, ()])]))
304.     assert_node(doctree[0], addnodes.index,
305.                 entries=[('pair', 'ls command line option; -l', 'cmdoption-ls-l', '', None)])
306.     assert ('ls', '-l') in domain.progoptions
307.     assert domain.progoptions[('ls', '-l')] == ('index', 'cmdoption-ls-l')
308. 
309. 
310. def test_multiple_cmdoptions(app):
311.     text = (".. program:: cmd\n"
312.             "\n"
313.             ".. option:: -o directory, --output directory\n")
314.     domain = app.env.get_domain('std')
315.     doctree = restructuredtext.parse(app, text)
316.     assert_node(doctree, (addnodes.index,
317.                           [desc, ([desc_signature, ([desc_name, "-o"],
318.                                                     [desc_addname, " directory"],
319.                                                     [desc_addname, ", "],
320.                                                     [desc_name, "--output"],
321.                                                     [desc_addname, " directory"])],
322.                                   [desc_content, ()])]))
323.     assert_node(doctree[0], addnodes.index,
324.                 entries=[('pair', 'cmd command line option; -o directory',
325.                           'cmdoption-cmd-o', '', None),
326.                          ('pair', 'cmd command line option; --output directory',
327.                           'cmdoption-cmd-o', '', None)])
328.     assert ('cmd', '-o') in domain.progoptions
329.     assert ('cmd', '--output') in domain.progoptions
330.     assert domain.progoptions[('cmd', '-o')] == ('index', 'cmdoption-cmd-o')
331.     assert domain.progoptions[('cmd', '--output')] == ('index', 'cmdoption-cmd-o')
332. 
333. 
334. @pytest.mark.skipif(docutils.__version_info__ < (0, 13),
335.                     reason='docutils-0.13 or above is required')
336. @pytest.mark.sphinx(testroot='productionlist')
337. def test_productionlist(app, status, warning):
338.     app.builder.build_all()
339. 
340.     warnings = warning.getvalue().split("\n");
341.     assert len(warnings) == 2
342.     assert warnings[-1] == ''
343.     assert "Dup2.rst:4: WARNING: duplicate token description of Dup, other instance in Dup1" in warnings[0]
344. 
345.     with (app.outdir / 'index.html').open('rb') as f:
346.         etree = HTMLParser(namespaceHTMLElements=False).parse(f)
347.     ul = list(etree.iter('ul'))[1]
348.     cases = []
349.     for li in list(ul):
350.         assert len(list(li)) == 1
351.         p = list(li)[0]
352.         assert p.tag == 'p'
353.         text = str(p.text).strip(' :')
354.         assert len(list(p)) == 1
355.         a = list(p)[0]
356.         assert a.tag == 'a'
357.         link = a.get('href')
358.         assert len(list(a)) == 1
359.         code = list(a)[0]
360.         assert code.tag == 'code'
361.         assert len(list(code)) == 1
362.         span = list(code)[0]
363.         assert span.tag == 'span'
364.         linkText = span.text.strip()
365.         cases.append((text, link, linkText))
366.     assert cases == [
367.         ('A', 'Bare.html#grammar-token-A', 'A'),
368.         ('B', 'Bare.html#grammar-token-B', 'B'),
369.         ('P1:A', 'P1.html#grammar-token-P1-A', 'P1:A'),
370.         ('P1:B', 'P1.html#grammar-token-P1-B', 'P1:B'),
371.         ('P2:A', 'P1.html#grammar-token-P1-A', 'P1:A'),
372.         ('P2:B', 'P2.html#grammar-token-P2-B', 'P2:B'),
373.         ('Explicit title A, plain', 'Bare.html#grammar-token-A', 'MyTitle'),
374.         ('Explicit title A, colon', 'Bare.html#grammar-token-A', 'My:Title'),
375.         ('Explicit title P1:A, plain', 'P1.html#grammar-token-P1-A', 'MyTitle'),
376.         ('Explicit title P1:A, colon', 'P1.html#grammar-token-P1-A', 'My:Title'),
377.         ('Tilde A', 'Bare.html#grammar-token-A', 'A'),
378.         ('Tilde P1:A', 'P1.html#grammar-token-P1-A', 'A'),
379.         ('Tilde explicit title P1:A', 'P1.html#grammar-token-P1-A', '~MyTitle'),
380.         ('Tilde, explicit title P1:A', 'P1.html#grammar-token-P1-A', 'MyTitle'),
381.         ('Dup', 'Dup2.html#grammar-token-Dup', 'Dup'),
382.         ('FirstLine', 'firstLineRule.html#grammar-token-FirstLine', 'FirstLine'),
383.         ('SecondLine', 'firstLineRule.html#grammar-token-SecondLine', 'SecondLine'),
384.     ]
385. 
386.     text = (app.outdir / 'LineContinuation.html').read_text()
387.     assert "A</strong> ::=  B C D    E F G" in text
388. 
389. 
390. def test_disabled_docref(app):
391.     text = (":doc:`index`\n"
392.             ":doc:`!index`\n")
393.     doctree = restructuredtext.parse(app, text)
394.     assert_node(doctree, ([nodes.paragraph, ([pending_xref, nodes.inline, "index"],
395.                                              "\n",
396.                                              [nodes.inline, "index"])],))


File: tests/test_toctree.py
Line number range: 1 - 47
Content:
1. """
2.     test_toctree
3.     ~~~~~~~~~~~~
4. 
5.     Test the HTML builder and check output against XPath.
6. 
7.     :copyright: Copyright 2007-2020 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. import re
11. 
12. import pytest
13. 
14. 
15. @pytest.mark.sphinx(testroot='toctree-glob')
16. def test_relations(app, status, warning):
17.     app.builder.build_all()
18.     assert app.builder.relations['index'] == [None, None, 'foo']
19.     assert app.builder.relations['foo'] == ['index', 'index', 'bar/index']
20.     assert app.builder.relations['bar/index'] == ['index', 'foo', 'bar/bar_1']
21.     assert app.builder.relations['bar/bar_1'] == ['bar/index', 'bar/index', 'bar/bar_2']
22.     assert app.builder.relations['bar/bar_2'] == ['bar/index', 'bar/bar_1', 'bar/bar_3']
23.     assert app.builder.relations['bar/bar_3'] == ['bar/index', 'bar/bar_2', 'bar/bar_4/index']
24.     assert app.builder.relations['bar/bar_4/index'] == ['bar/index', 'bar/bar_3', 'baz']
25.     assert app.builder.relations['baz'] == ['index', 'bar/bar_4/index', 'qux/index']
26.     assert app.builder.relations['qux/index'] == ['index', 'baz', 'qux/qux_1']
27.     assert app.builder.relations['qux/qux_1'] == ['qux/index', 'qux/index', 'qux/qux_2']
28.     assert app.builder.relations['qux/qux_2'] == ['qux/index', 'qux/qux_1', None]
29.     assert 'quux' not in app.builder.relations
30. 
31. 
32. @pytest.mark.sphinx('singlehtml', testroot='toctree-empty')
33. def test_singlehtml_toctree(app, status, warning):
34.     app.builder.build_all()
35.     try:
36.         app.builder._get_local_toctree('index')
37.     except AttributeError:
38.         pytest.fail('Unexpected AttributeError in app.builder.fix_refuris')
39. 
40. 
41. @pytest.mark.sphinx(testroot='toctree', srcdir="numbered-toctree")
42. def test_numbered_toctree(app, status, warning):
43.     # give argument to :numbered: option
44.     index = (app.srcdir / 'index.rst').read_text()
45.     index = re.sub(':numbered:.*', ':numbered: 1', index)
46.     (app.srcdir / 'index.rst').write_text(index)
47.     app.builder.build_all()


File: tests/test_util_images.py
Line number range: 1 - 79
Content:
1. """
2.     test_util_images
3.     ~~~~~~~~~~~~~~~~
4. 
5.     Test images util.
6. 
7.     :copyright: Copyright 2007-2020 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import pytest
12. 
13. from sphinx.util.images import (
14.     get_image_size, guess_mimetype, get_image_extension, parse_data_uri
15. )
16. 
17. GIF_FILENAME = 'img.gif'
18. PNG_FILENAME = 'img.png'
19. PDF_FILENAME = 'img.pdf'
20. TXT_FILENAME = 'index.txt'
21. 
22. 
23. def test_get_image_size(rootdir):
24.     assert get_image_size(rootdir / 'test-root' / GIF_FILENAME) == (200, 181)
25.     assert get_image_size(rootdir / 'test-root' / PNG_FILENAME) == (200, 181)
26.     assert get_image_size(rootdir / 'test-root' / PDF_FILENAME) is None
27.     assert get_image_size(rootdir / 'test-root' / TXT_FILENAME) is None
28. 
29. 
30. @pytest.mark.filterwarnings('ignore:The content argument')
31. def test_guess_mimetype():
32.     # guess by filename
33.     assert guess_mimetype('img.png') == 'image/png'
34.     assert guess_mimetype('img.jpg') == 'image/jpeg'
35.     assert guess_mimetype('img.txt') is None
36.     assert guess_mimetype('img.txt', default='text/plain') == 'text/plain'
37.     assert guess_mimetype('no_extension') is None
38.     assert guess_mimetype('IMG.PNG') == 'image/png'
39. 
40.     # default parameter is used when no extension
41.     assert guess_mimetype('img.png', 'text/plain') == 'image/png'
42.     assert guess_mimetype('no_extension', 'text/plain') == 'text/plain'
43. 
44. 
45. def test_get_image_extension():
46.     assert get_image_extension('image/png') == '.png'
47.     assert get_image_extension('image/jpeg') == '.jpg'
48.     assert get_image_extension('image/svg+xml') == '.svg'
49.     assert get_image_extension('text/plain') is None
50. 
51. 
52. def test_parse_data_uri():
53.     # standard case
54.     uri = ("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4"
55.            "//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")
56.     image = parse_data_uri(uri)
57.     assert image is not None
58.     assert image.mimetype == 'image/png'
59.     assert image.charset == 'US-ASCII'
60. 
61.     # no mimetype
62.     uri = ("data:charset=utf-8,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElE"
63.            "QVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")
64.     image = parse_data_uri(uri)
65.     assert image is not None
66.     assert image.mimetype == 'text/plain'
67.     assert image.charset == 'utf-8'
68. 
69.     # non data URI
70.     uri = ("image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4"
71.            "//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")
72.     image = parse_data_uri(uri)
73.     assert image is None
74. 
75.     # invalid data URI (no properties)
76.     with pytest.raises(ValueError):
77.         uri = ("data:iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4"
78.                "//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")
79.         parse_data_uri(uri)

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-24 19:57:04,915 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='The user requested the full content of `tests/test_domain_std.py`. This context includes the entire file.', relative_path='tests/test_domain_std.py', start_line=1, end_line=396), ContextOutput(reasoning='The user requested the full content of `tests/test_toctree.py`. This context includes the entire file.', relative_path='tests/test_toctree.py', start_line=1, end_line=47), ContextOutput(reasoning='The user requested the full content of `tests/test_util_images.py`. This context includes the entire file.', relative_path='tests/test_util_images.py', start_line=1, end_line=79)]
2025-12-24 19:57:04,916 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 3 contexts to memory for query: Please provide the full content of `tests/test_toctree.py`, `tests/test_util_images.py`, and `tests/test_domain_std.py`.
2025-12-24 19:57:04,917 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-24 19:57:04,917 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-24 19:57:04,917 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 3 new contexts to 2 existing contexts
2025-12-24 19:57:04,917 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 5 total contexts (removed 0 duplicates)
2025-12-24 19:57:04,918 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sphinx
├── .circleci
|   └── config.yml
├── .codecov.yml
├── .github
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.md
|   |   ├── config.yml
|   |   └── feature_request.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   └── workflows
|       ├── builddoc.yml
|       ├── lint.yml
|       └── main.yml
├── .travis.yml
├── CONTRIBUTING.rst
├── README.rst
├── bindep.txt
├── doc
|   ├── _static
|   |   ├── conf.py.txt
|   |   └── themes
|   |       └── fullsize
|   ├── _templates
|   |   ├── index.html
|   |   └── indexsidebar.html
|   ├── _themes
|   |   └── sphinx13
|   |       ├── layout.html
|   |       └── static
|   |           └── sphinx13.css
|   ├── changes.rst
|   ├── conf.py
|   ├── contents.rst
|   ├── develop.rst
|   ├── development
|   |   ├── index.rst
|   |   └── tutorials
|   |       ├── examples
|   |       |   ├── README.rst
|   |       |   ├── helloworld.py
|   |       |   ├── recipe.py
|   |       |   └── todo.py
|   |       ├── helloworld.rst
|   |       ├── index.rst
|   |       ├── recipe.rst
|   |       └── todo.rst
|   ├── examples.rst
|   ├── extdev
|   |   ├── appapi.rst
|   |   ├── builderapi.rst
|   |   ├── collectorapi.rst
|   |   ├── deprecated.rst
|   |   ├── domainapi.rst
|   |   ├── envapi.rst
|   |   ├── i18n.rst
|   |   ├── index.rst
|   |   ├── logging.rst
|   |   ├── markupapi.rst
|   |   ├── nodes.rst
|   |   ├── parserapi.rst
|   |   ├── projectapi.rst
|   |   └── utils.rst
|   ├── faq.rst
|   ├── glossary.rst
|   ├── internals
|   |   ├── authors.rst
|   |   ├── code-of-conduct.rst
|   |   ├── contributing.rst
|   |   ├── index.rst
|   |   ├── organization.rst
|   |   └── release-process.rst
|   ├── latex.rst
|   ├── man
|   |   ├── index.rst
|   |   ├── sphinx-apidoc.rst
|   |   ├── sphinx-autogen.rst
|   |   ├── sphinx-build.rst
|   |   └── sphinx-quickstart.rst
|   ├── templating.rst
|   ├── theming.rst
|   └── usage
|       ├── advanced
|       |   ├── intl.rst
|       |   ├── setuptools.rst
|       |   └── websupport
|       |       ├── api.rst
|       |       ├── index.rst
|       |       ├── quickstart.rst
|       |       ├── searchadapters.rst
|       |       └── storagebackends.rst
|       ├── builders
|       |   └── index.rst
|       ├── configuration.rst
|       ├── extensions
|       |   ├── autodoc.rst
|       |   ├── autosectionlabel.rst
|       |   ├── autosummary.rst
|       |   ├── coverage.rst
|       |   ├── doctest.rst
|       |   ├── duration.rst
|       |   ├── example_google.py
|       |   ├── example_google.rst
|       |   ├── example_numpy.py
|       |   ├── example_numpy.rst
|       |   ├── extlinks.rst
|       |   ├── githubpages.rst
|       |   ├── graphviz.rst
|       |   ├── ifconfig.rst
|       |   ├── imgconverter.rst
|       |   ├── index.rst
|       |   ├── inheritance.rst
|       |   ├── intersphinx.rst
|       |   ├── linkcode.rst
|       |   ├── math.rst
|       |   ├── napoleon.rst
|       |   ├── todo.rst
|       |   └── viewcode.rst
|       ├── index.rst
|       ├── installation.rst
|       ├── markdown.rst
|       ├── quickstart.rst
|       ├── restructuredtext
|       |   ├── basics.rst
|       |   ├── directives.rst
|       |   ├── domains.rst
|       |   ├── field-lists.rst
|       |   ├── index.rst
|       |   └── roles.rst
|       └── theming.rst
├── karma.conf.js
├── setup.py
├── sphinx
|   ├── __init__.py
|   ├── __main__.py
|   ├── addnodes.py
|   ├── application.py
|   ├── builders
|   |   ├── __init__.py
|   |   ├── _epub_base.py
|   |   ├── applehelp.py
|   |   ├── changes.py
|   |   ├── devhelp.py
|   |   ├── dirhtml.py
|   |   ├── dummy.py
|   |   ├── epub3.py
|   |   ├── gettext.py
|   |   ├── html
|   |   |   ├── __init__.py
|   |   |   └── transforms.py
|   |   ├── htmlhelp.py
|   |   ├── latex
|   |   |   ├── __init__.py
|   |   |   ├── constants.py
|   |   |   ├── nodes.py
|   |   |   ├── theming.py
|   |   |   ├── transforms.py
|   |   |   └── util.py
|   |   ├── linkcheck.py
|   |   ├── manpage.py
|   |   ├── qthelp.py
|   |   ├── singlehtml.py
|   |   ├── texinfo.py
|   |   ├── text.py
|   |   └── xml.py
|   ├── cmd
|   |   ├── __init__.py
|   |   ├── build.py
|   |   ├── make_mode.py
|   |   └── quickstart.py
|   ├── config.py
|   ├── deprecation.py
|   ├── directives
|   |   ├── __init__.py
|   |   ├── code.py
|   |   ├── other.py
|   |   └── patches.py
|   ├── domains
|   |   ├── __init__.py
|   |   ├── c.py
|   |   ├── changeset.py
|   |   ├── citation.py
|   |   ├── cpp.py
|   |   ├── index.py
|   |   ├── javascript.py
|   |   ├── math.py
|   |   ├── python.py
|   |   ├── rst.py
|   |   └── std.py
|   ├── environment
|   |   ├── __init__.py
|   |   ├── adapters
|   |   |   ├── __init__.py
|   |   |   ├── asset.py
|   |   |   ├── indexentries.py
|   |   |   └── toctree.py
|   |   └── collectors
|   |       ├── __init__.py
|   |       ├── asset.py
|   |       ├── dependencies.py
|   |       ├── indexentries.py
|   |       ├── metadata.py
|   |       ├── title.py
|   |       └── toctree.py
|   ├── errors.py
|   ├── events.py
|   ├── ext
|   |   ├── __init__.py
|   |   ├── apidoc.py
|   |   ├── autodoc
|   |   |   ├── __init__.py
|   |   |   ├── directive.py
|   |   |   ├── importer.py
|   |   |   ├── mock.py
|   |   |   ├── type_comment.py
|   |   |   └── typehints.py
|   |   ├── autosectionlabel.py
|   |   ├── autosummary
|   |   |   ├── __init__.py
|   |   |   ├── generate.py
|   |   |   └── templates
|   |   |       └── autosummary
|   |   ├── coverage.py
|   |   ├── doctest.py
|   |   ├── duration.py
|   |   ├── extlinks.py
|   |   ├── githubpages.py
|   |   ├── graphviz.py
|   |   ├── ifconfig.py
|   |   ├── imgconverter.py
|   |   ├── imgmath.py
|   |   ├── inheritance_diagram.py
|   |   ├── intersphinx.py
|   |   ├── jsmath.py
|   |   ├── linkcode.py
|   |   ├── mathjax.py
|   |   ├── napoleon
|   |   |   ├── __init__.py
|   |   |   ├── docstring.py
|   |   |   └── iterators.py
|   |   ├── todo.py
|   |   └── viewcode.py
|   ├── extension.py
|   ├── highlighting.py
|   ├── io.py
|   ├── jinja2glue.py
|   ├── locale
|   |   ├── __init__.py
|   |   ├── ar
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bg
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bn
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ca
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cak
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cs
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cy
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── da
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── de
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── el
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eo
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── es
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── et
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fa
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── he
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi_IN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── id
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── it
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ja
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ko
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── mk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nb_NO
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ne
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_BR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_PT
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ro
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ru
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── si
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sq
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr@latin
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr_RS
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ta
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── te
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── tr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── uk_UA
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ur
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── vi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_CN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   └── zh_TW
|   |       └── LC_MESSAGES
|   |           └── sphinx.js
|   ├── parsers.py
|   ├── project.py
|   ├── pycode
|   |   ├── __init__.py
|   |   ├── ast.py
|   |   └── parser.py
|   ├── pygments_styles.py
|   ├── registry.py
|   ├── roles.py
|   ├── search
|   |   ├── __init__.py
|   |   ├── da.py
|   |   ├── de.py
|   |   ├── en.py
|   |   ├── es.py
|   |   ├── fi.py
|   |   ├── fr.py
|   |   ├── hu.py
|   |   ├── it.py
|   |   ├── ja.py
|   |   ├── jssplitter.py
|   |   ├── nl.py
|   |   ├── no.py
|   |   ├── non-minified-js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── pt.py
|   |   ├── ro.py
|   |   ├── ru.py
|   |   ├── sv.py
|   |   ├── tr.py
|   |   └── zh.py
|   ├── setup_command.py
|   ├── templates
|   |   ├── apidoc
|   |   ├── epub3
|   |   |   └── container.xml
|   |   ├── gettext
|   |   ├── graphviz
|   |   |   └── graphviz.css
|   |   ├── htmlhelp
|   |   ├── imgmath
|   |   ├── latex
|   |   ├── quickstart
|   |   └── texinfo
|   ├── testing
|   |   ├── __init__.py
|   |   ├── comparer.py
|   |   ├── fixtures.py
|   |   ├── path.py
|   |   ├── restructuredtext.py
|   |   └── util.py
|   ├── texinputs
|   ├── texinputs_win
|   ├── themes
|   |   ├── agogo
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── basic
|   |   |   ├── changes
|   |   |   |   ├── frameset.html
|   |   |   |   ├── rstsource.html
|   |   |   |   └── versionchanges.html
|   |   |   ├── defindex.html
|   |   |   ├── domainindex.html
|   |   |   ├── genindex-single.html
|   |   |   ├── genindex-split.html
|   |   |   ├── genindex.html
|   |   |   ├── globaltoc.html
|   |   |   ├── layout.html
|   |   |   ├── localtoc.html
|   |   |   ├── opensearch.xml
|   |   |   ├── page.html
|   |   |   ├── relations.html
|   |   |   ├── search.html
|   |   |   ├── searchbox.html
|   |   |   ├── sourcelink.html
|   |   |   └── static
|   |   |       ├── doctools.js
|   |   |       ├── jquery-3.5.1.js
|   |   |       ├── jquery.js
|   |   |       ├── searchtools.js
|   |   |       ├── underscore-1.3.1.js
|   |   |       └── underscore.js
|   |   ├── bizstyle
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── css3-mediaqueries.js
|   |   |       └── css3-mediaqueries_src.js
|   |   ├── classic
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── default
|   |   |   └── static
|   |   |       └── default.css
|   |   ├── epub
|   |   |   ├── epub-cover.html
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── haiku
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── nature
|   |   |   └── static
|   |   ├── nonav
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       └── nonav.css
|   |   ├── pyramid
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── epub.css
|   |   |       └── ie6.css
|   |   ├── scrolls
|   |   |   ├── artwork
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── print.css
|   |   |       └── theme_extras.js
|   |   ├── sphinxdoc
|   |   |   └── static
|   |   └── traditional
|   |       └── static
|   ├── theming.py
|   ├── transforms
|   |   ├── __init__.py
|   |   ├── compact_bullet_list.py
|   |   ├── i18n.py
|   |   ├── post_transforms
|   |   |   ├── __init__.py
|   |   |   ├── code.py
|   |   |   └── images.py
|   |   └── references.py
|   ├── util
|   |   ├── __init__.py
|   |   ├── build_phase.py
|   |   ├── cfamily.py
|   |   ├── compat.py
|   |   ├── console.py
|   |   ├── docfields.py
|   |   ├── docstrings.py
|   |   ├── docutils.py
|   |   ├── fileutil.py
|   |   ├── i18n.py
|   |   ├── images.py
|   |   ├── inspect.py
|   |   ├── inventory.py
|   |   ├── jsdump.py
|   |   ├── jsonimpl.py
|   |   ├── logging.py
|   |   ├── matching.py
|   |   ├── math.py
|   |   ├── nodes.py
|   |   ├── osutil.py
|   |   ├── parallel.py
|   |   ├── png.py
|   |   ├── pycompat.py
|   |   ├── requests.py
|   |   ├── rst.py
|   |   ├── smartypants.py
|   |   ├── stemmer
|   |   |   ├── __init__.py
|   |   |   └── porter.py
|   |   ├── tags.py
|   |   ├── template.py
|   |   ├── texescape.py
|   |   └── typing.py
|   ├── versioning.py
|   └── writers
|       ├── __init__.py
|       ├── html.py
|       ├── html5.py
|       ├── latex.py
|       ├── manpage.py
|       ├── texinfo.py
|       ├── text.py
|       └── xml.py
├── tests
|   ├── conftest.py
|   ├── js
|   |   └── doctools.js
|   ├── roots
|   |   ├── test-add_enumerable_node
|   |   |   ├── conf.py
|   |   |   ├── enumerable_node.py
|   |   |   └── index.rst
|   |   ├── test-add_source_parser
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-add_source_parser-conflicts-with-users-setting
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-api-set-translator
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nonext
|   |   |   |   └── conf.py
|   |   |   └── translator.py
|   |   ├── test-apidoc-pep420
|   |   |   └── a
|   |   |       └── b
|   |   ├── test-apidoc-subpackage-in-toc
|   |   |   └── parent
|   |   |       ├── __init__.py
|   |   |       └── child
|   |   ├── test-apidoc-toc
|   |   |   └── mypackage
|   |   |       ├── __init__.py
|   |   |       ├── main.py
|   |   |       ├── no_init
|   |   |       ├── resource
|   |   |       └── something
|   |   ├── test-apidoc-trailing-underscore
|   |   |   └── package_
|   |   |       ├── __init__.py
|   |   |       └── module_.py
|   |   ├── test-autosummary
|   |   |   ├── conf.py
|   |   |   ├── dummy_module.py
|   |   |   ├── index.rst
|   |   |   ├── sphinx.rst
|   |   |   └── underscore_module_.py
|   |   ├── test-basic
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-html-translator
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-text
|   |   |   ├── conf.py
|   |   |   ├── doc1.txt
|   |   |   ├── doc2.txt
|   |   |   ├── index.txt
|   |   |   ├── lineblock.txt
|   |   |   ├── listitems.txt
|   |   |   ├── maxwidth.txt
|   |   |   ├── nonascii_maxwidth.txt
|   |   |   ├── nonascii_table.txt
|   |   |   ├── nonascii_title.txt
|   |   |   ├── table.txt
|   |   |   ├── table_colspan.txt
|   |   |   ├── table_colspan_and_rowspan.txt
|   |   |   ├── table_colspan_left.txt
|   |   |   └── table_rowspan.txt
|   |   ├── test-builder-dirhtml
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo
|   |   |   |   ├── foo_1.rst
|   |   |   |   ├── foo_2.rst
|   |   |   |   └── index.rst
|   |   |   └── index.rst
|   |   ├── test-builder-gettext-dont-rebuild-mo
|   |   |   ├── bom.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-changes
|   |   |   ├── base.rst
|   |   |   ├── c-api.rst
|   |   |   ├── conf.py
|   |   |   ├── contents.rst
|   |   |   └── library
|   |   |       └── utils.rst
|   |   ├── test-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-config
|   |   |   └── conf.py
|   |   ├── test-correct-year
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-default_role
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-directive-code
|   |   |   ├── caption.rst
|   |   |   ├── classes.rst
|   |   |   ├── conf.py
|   |   |   ├── emphasize.rst
|   |   |   ├── force.rst
|   |   |   ├── highlight.rst
|   |   |   ├── index.rst
|   |   |   ├── linenos.rst
|   |   |   ├── linenothreshold.rst
|   |   |   ├── namedblocks.rst
|   |   |   ├── py-decorators.rst
|   |   |   ├── python.rst
|   |   |   └── target.py
|   |   ├── test-directive-only
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── only.rst
|   |   ├── test-directives-raw
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-docutilsconf
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-c
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── namespace.rst
|   |   |   └── semicolon.rst
|   |   ├── test-domain-cpp
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── any-role.rst
|   |   |   ├── backslash.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── lookup-key-overload.rst
|   |   |   ├── multi-decl-lookup.rst
|   |   |   ├── roles-targets-ok.rst
|   |   |   ├── roles-targets-warn.rst
|   |   |   ├── roles.rst
|   |   |   ├── roles2.rst
|   |   |   ├── semicolon.rst
|   |   |   ├── warn-template-param-qualified-name.rst
|   |   |   └── xref_consistency.rst
|   |   ├── test-domain-js
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   ├── module_option.rst
|   |   |   └── roles.rst
|   |   ├── test-double-inheriting-theme
|   |   |   ├── base_themes_dir
|   |   |   |   ├── base_theme1
|   |   |   |   └── base_theme2
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-epub-anchor-id
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autodoc
|   |   |   ├── autodoc_dummy_bar.py
|   |   |   ├── autodoc_dummy_module.py
|   |   |   ├── bug2437
|   |   |   |   ├── __init__.py
|   |   |   |   └── autodoc_dummy_foo.py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target
|   |   |       ├── __init__.py
|   |   |       ├── abstractmethods.py
|   |   |       ├── annotated.py
|   |   |       ├── autoclass_content.py
|   |   |       ├── bound_method.py
|   |   |       ├── callable.py
|   |   |       ├── classes.py
|   |   |       ├── coroutine.py
|   |   |       ├── decorator.py
|   |   |       ├── descriptor.py
|   |   |       ├── docstring_signature.py
|   |   |       ├── enum.py
|   |   |       ├── final.py
|   |   |       ├── functions.py
|   |   |       ├── genericalias.py
|   |   |       ├── imported_members.py
|   |   |       ├── inheritance.py
|   |   |       ├── methods.py
|   |   |       ├── name_conflict
|   |   |       ├── name_mangling.py
|   |   |       ├── need_mocks.py
|   |   |       ├── overload.py
|   |   |       ├── partialfunction.py
|   |   |       ├── partialmethod.py
|   |   |       ├── pep570.py
|   |   |       ├── private.py
|   |   |       ├── process_docstring.py
|   |   |       ├── singledispatch.py
|   |   |       ├── singledispatchmethod.py
|   |   |       ├── slots.py
|   |   |       ├── sort_by_all.py
|   |   |       ├── typed_vars.py
|   |   |       ├── typehints.py
|   |   |       ├── typevar.py
|   |   |       └── wrappedfunction.py
|   |   ├── test-ext-autosectionlabel
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosectionlabel-prefix-document
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── autosummary_importfail.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-imported_members
|   |   |   ├── autosummary_dummy_package
|   |   |   |   ├── __init__.py
|   |   |   |   └── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-mock_imports
|   |   |   ├── conf.py
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-recursive
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── package
|   |   |   |   ├── __init__.py
|   |   |   |   ├── module.py
|   |   |   |   ├── module_importfail.py
|   |   |   |   └── package
|   |   |   └── package2
|   |   |       ├── __init__.py
|   |   |       └── module.py
|   |   ├── test-ext-autosummary-skip-member
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-autosummary-template
|   |   |   ├── _templates
|   |   |   |   └── empty.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-coverage
|   |   |   ├── conf.py
|   |   |   ├── coverage_ignored.py
|   |   |   ├── coverage_not_ignored.py
|   |   |   └── index.rst
|   |   ├── test-ext-doctest
|   |   |   ├── conf.py
|   |   |   └── doctest.txt
|   |   ├── test-ext-doctest-skipif
|   |   |   ├── conf.py
|   |   |   └── skipif.txt
|   |   ├── test-ext-doctest-with-autodoc
|   |   |   ├── conf.py
|   |   |   ├── dir
|   |   |   |   ├── __init__.py
|   |   |   |   ├── bar.py
|   |   |   |   └── inner.rst
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-githubpages
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-graphviz
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-ifconfig
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-imgconverter
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-inheritance_diagram
|   |   |   ├── conf.py
|   |   |   ├── example
|   |   |   |   ├── __init__.py
|   |   |   |   └── sphinx.py
|   |   |   ├── index.rst
|   |   |   └── test.py
|   |   ├── test-ext-intersphinx-cppdomain
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── math.rst
|   |   |   └── page.rst
|   |   ├── test-ext-math-compat
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math-simple
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-todo
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-ext-viewcode
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── objects.rst
|   |   |   └── spam
|   |   |       ├── __init__.py
|   |   |       ├── mod1.py
|   |   |       ├── mod2.py
|   |   |       └── mod3.py
|   |   ├── test-ext-viewcode-find
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── not_a_package
|   |   |       ├── __init__.py
|   |   |       └── submodule.py
|   |   ├── test-extensions
|   |   |   ├── conf.py
|   |   |   ├── read_parallel.py
|   |   |   ├── read_serial.py
|   |   |   ├── write_parallel.py
|   |   |   └── write_serial.py
|   |   ├── test-footnotes
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-gettext-template
|   |   |   ├── _templates
|   |   |   |   ├── template1.html
|   |   |   |   └── template2.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-glossary
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_assets
|   |   |   ├── conf.py
|   |   |   ├── extra
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   └── subdir
|   |   |   ├── index.rst
|   |   |   ├── static
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   ├── js
|   |   |   |   └── subdir
|   |   |   └── subdir
|   |   |       └── _build
|   |   ├── test-html_entity
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_scaled_image_link
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_style
|   |   |   ├── _static
|   |   |   |   └── default.css
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-parsed-literal
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-section
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-images
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── subdir
|   |   |       └── index.rst
|   |   ├── test-index_on_title
|   |   |   ├── conf.py
|   |   |   └── contents.rst
|   |   ├── test-inheritance
|   |   |   ├── basic_diagram.rst
|   |   |   ├── conf.py
|   |   |   ├── diagram_module_w_2_top_classes.rst
|   |   |   ├── diagram_w_1_top_class.rst
|   |   |   ├── diagram_w_2_top_classes.rst
|   |   |   ├── diagram_w_nested_classes.rst
|   |   |   ├── diagram_w_parts.rst
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── test.py
|   |   |   |   └── test_nested.py
|   |   |   └── index.rst
|   |   ├── test-intl
|   |   |   ├── _templates
|   |   |   |   └── contents.html
|   |   |   ├── admonitions.txt
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── definition_terms.txt
|   |   |   ├── docfields.txt
|   |   |   ├── external_links.txt
|   |   |   ├── figure.txt
|   |   |   ├── footnote.txt
|   |   |   ├── glossary_terms.txt
|   |   |   ├── glossary_terms_inconsistency.txt
|   |   |   ├── index.txt
|   |   |   ├── index_entries.txt
|   |   |   ├── label_target.txt
|   |   |   ├── literalblock.txt
|   |   |   ├── only.txt
|   |   |   ├── raw.txt
|   |   |   ├── refs.txt
|   |   |   ├── refs_inconsistency.txt
|   |   |   ├── refs_python_domain.txt
|   |   |   ├── role_xref.txt
|   |   |   ├── rubric.txt
|   |   |   ├── section.txt
|   |   |   ├── seealso.txt
|   |   |   ├── subdir
|   |   |   |   └── index.txt
|   |   |   ├── table.txt
|   |   |   ├── toctree.txt
|   |   |   ├── topic.txt
|   |   |   ├── versionchange.txt
|   |   |   ├── warnings.txt
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-keep_warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-babel
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-latex-equations
|   |   |   ├── conf.py
|   |   |   ├── equations.rst
|   |   |   └── expects
|   |   ├── test-latex-figure-in-admonition
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-includegraphics
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-index
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-labels
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── otherdoc.rst
|   |   ├── test-latex-numfig
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── indexhowto.rst
|   |   |   └── indexmanual.rst
|   |   ├── test-latex-table
|   |   |   ├── _mytemplates
|   |   |   |   └── latex
|   |   |   ├── complex.rst
|   |   |   ├── conf.py
|   |   |   ├── expects
|   |   |   ├── index.rst
|   |   |   ├── longtable.rst
|   |   |   └── tabular.rst
|   |   ├── test-latex-theme
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── theme
|   |   |       └── custom
|   |   ├── test-latex-title
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-unicode
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck
|   |   |   ├── conf.py
|   |   |   └── links.txt
|   |   ├── test-locale
|   |   |   ├── locale1
|   |   |   |   └── en
|   |   |   └── locale2
|   |   |       └── en
|   |   ├── test-manpage_url
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-citation
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-rubric
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-maxlistdepth
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-metadata
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-need-escaped
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux.rst
|   |   ├── test-nested-enumerated-list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nested-tables
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-numbered-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-numfig
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-productionlist
|   |   |   ├── Bare.rst
|   |   |   ├── Dup1.rst
|   |   |   ├── Dup2.rst
|   |   |   ├── LineContinuation.rst
|   |   |   ├── P1.rst
|   |   |   ├── P2.rst
|   |   |   ├── conf.py
|   |   |   ├── firstLineRule.rst
|   |   |   └── index.rst
|   |   ├── test-prolog
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── markdown.md
|   |   |   ├── prolog_markdown_parser.py
|   |   |   └── restructuredtext.rst
|   |   ├── test-pycode
|   |   |   └── cp_1251_coded.py
|   |   ├── test-pycode-egg
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── src
|   |   |       ├── sample.py
|   |   |       └── setup.py
|   |   ├── test-reST-code-block
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-refonly_bullet_list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-roles-download
|   |   |   ├── another
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-root
|   |   |   ├── _templates
|   |   |   |   ├── contentssb.html
|   |   |   |   ├── customsb.html
|   |   |   |   └── layout.html
|   |   |   ├── autodoc.txt
|   |   |   ├── autodoc_target.py
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── extapi.txt
|   |   |   ├── extensions.txt
|   |   |   ├── footnote.txt
|   |   |   ├── images.txt
|   |   |   ├── includes.txt
|   |   |   ├── index.txt
|   |   |   ├── lists.txt
|   |   |   ├── markup.txt
|   |   |   ├── math.txt
|   |   |   ├── objects.txt
|   |   |   ├── parsermod.py
|   |   |   ├── special
|   |   |   |   └── code.py
|   |   |   └── subdir
|   |   |       ├── excluded.txt
|   |   |       ├── images.txt
|   |   |       └── includes.txt
|   |   ├── test-search
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nosearch.rst
|   |   |   └── tocitem.rst
|   |   ├── test-setup
|   |   |   ├── doc
|   |   |   |   ├── conf.py
|   |   |   |   └── index.txt
|   |   |   └── setup.py
|   |   ├── test-smartquotes
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-stylesheets
|   |   |   ├── _templates
|   |   |   |   └── layout.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-templating
|   |   |   ├── _templates
|   |   |   |   ├── autosummary
|   |   |   |   └── layout.html
|   |   |   ├── autosummary_templating.txt
|   |   |   ├── conf.py
|   |   |   └── index.txt
|   |   ├── test-theming
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── setup.py
|   |   |   └── test_theme
|   |   |       ├── __init__.py
|   |   |       ├── staticfiles
|   |   |       └── test-theme
|   |   ├── test-tocdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   ├── qux.rst
|   |   |   └── tocdepth.rst
|   |   ├── test-toctree-duplicated
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree-empty
|   |   |   ├── _templates
|   |   |   |   └── localtoc.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-toctree-glob
|   |   |   ├── bar
|   |   |   |   ├── bar_1.rst
|   |   |   |   ├── bar_2.rst
|   |   |   |   ├── bar_3.rst
|   |   |   |   ├── bar_4
|   |   |   |   └── index.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux
|   |   |       ├── index.rst
|   |   |       ├── qux_1.rst
|   |   |       └── qux_2.rst
|   |   ├── test-toctree-maxdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   └── qux.rst
|   |   ├── test-trim_doctest_flags
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-versioning
|   |   |   ├── added.txt
|   |   |   ├── conf.py
|   |   |   ├── deleted.txt
|   |   |   ├── deleted_end.txt
|   |   |   ├── index.txt
|   |   |   ├── insert.txt
|   |   |   ├── insert_beginning.txt
|   |   |   ├── insert_similar.txt
|   |   |   ├── modified.txt
|   |   |   └── original.txt
|   |   └── test-warnings
|   |       ├── autodoc_fodder.py
|   |       ├── conf.py
|   |       ├── index.rst
|   |       └── undecodable.rst
|   ├── test_api_translator.py
|   ├── test_application.py
|   ├── test_build.py
|   ├── test_build_changes.py
|   ├── test_build_dirhtml.py
|   ├── test_build_epub.py
|   ├── test_build_gettext.py
|   ├── test_build_html.py
|   ├── test_build_latex.py
|   ├── test_build_linkcheck.py
|   ├── test_build_manpage.py
|   ├── test_build_texinfo.py
|   ├── test_build_text.py
|   ├── test_builder.py
|   ├── test_catalogs.py
|   ├── test_config.py
|   ├── test_correct_year.py
|   ├── test_directive_code.py
|   ├── test_directive_only.py
|   ├── test_directive_other.py
|   ├── test_directive_patch.py
|   ├── test_docutilsconf.py
|   ├── test_domain_c.py
|   ├── test_domain_cpp.py
|   ├── test_domain_js.py
|   ├── test_domain_py.py
|   ├── test_domain_rst.py
|   ├── test_domain_std.py
|   ├── test_environment.py
|   ├── test_environment_indexentries.py
|   ├── test_environment_toctree.py
|   ├── test_errors.py
|   ├── test_events.py
|   ├── test_ext_apidoc.py
|   ├── test_ext_autodoc.py
|   ├── test_ext_autodoc_autofunction.py
|   ├── test_ext_autodoc_configs.py
|   ├── test_ext_autodoc_events.py
|   ├── test_ext_autodoc_mock.py
|   ├── test_ext_autodoc_private_members.py
|   ├── test_ext_autosectionlabel.py
|   ├── test_ext_autosummary.py
|   ├── test_ext_coverage.py
|   ├── test_ext_doctest.py
|   ├── test_ext_duration.py
|   ├── test_ext_githubpages.py
|   ├── test_ext_graphviz.py
|   ├── test_ext_ifconfig.py
|   ├── test_ext_imgconverter.py
|   ├── test_ext_inheritance_diagram.py
|   ├── test_ext_intersphinx.py
|   ├── test_ext_math.py
|   ├── test_ext_napoleon.py
|   ├── test_ext_napoleon_docstring.py
|   ├── test_ext_napoleon_iterators.py
|   ├── test_ext_todo.py
|   ├── test_ext_viewcode.py
|   ├── test_highlighting.py
|   ├── test_intl.py
|   ├── test_locale.py
|   ├── test_markup.py
|   ├── test_metadata.py
|   ├── test_parser.py
|   ├── test_project.py
|   ├── test_pycode.py
|   ├── test_pycode_ast.py
|   ├── test_pycode_parser.py
|   ├── test_quickstart.py
|   ├── test_roles.py
|   ├── test_search.py
|   ├── test_setup_command.py
|   ├── test_smartquotes.py
|   ├── test_templating.py
|   ├── test_theming.py
|   ├── test_toctree.py
|   ├── test_transforms_post_transforms_code.py
|   ├── test_util.py
|   ├── test_util_docstrings.py
|   ├── test_util_docutils.py
|   ├── test_util_fileutil.py
|   ├── test_util_i18n.py
|   ├── test_util_images.py
|   ├── test_util_inspect.py
|   ├── test_util_inventory.py
|   ├── test_util_jsdump.py
|   ├── test_util_logging.py
|   ├── test_util_matching.py
|   ├── test_util_nodes.py
|   ├── test_util_pycompat.py
|   ├── test_util_rst.py
|   ├── test_util_template.py
|   ├── test_util_typing.py
|   ├── test_versioning.py
|   ├── test_writer_latex.py
|   └── typing_test_data.py
└── utils
    ├── __init__.py
    ├── bump_docker.sh
    ├── bump_version.py
    ├── checks.py
    ├── doclinter.py
    └── jssplitter_generator.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: linkcheck could also check local (internal) links

Description: Subject: linkcheck currently doesn't check local (internal) links, but this would be useful.

<!--
  Important: This is a list of issues for Sphinx, not a forum.
  If you'd like to post a question, please move to sphinx-users group.
  https://groups.google.com/forum/#!forum/sphinx-users

  Thanks,
-->

### Problem
See above.

#### Procedure to reproduce the problem
Create a template project with sphinx-quickstart, put the following in index.rst
```
broken external-link_
broken local-link_

.. _external-link: https://lkfqhlkghflkhs
.. _local-link: doesntexist
```

Run `make linkcheck`

#### Error logs / results
```
Running Sphinx v1.7.6
making output directory...
loading pickled environment... done
building [mo]: targets for 0 po files that are out of date
building [linkcheck]: targets for 1 source files that are out of date
updating environment: 0 added, 0 changed, 0 removed
looking for now-outdated files... none found
preparing documents... done
writing output... [100%] index                                                                   
(line   14) -local-   doesntexist
(line   14) broken    https://lkfqhlkghflkhs - HTTPSConnectionPool(host='lkfqhlkghflkhs', port=443): Max retries exceeded with url: / (Caused by NewConnectionError('<urllib3.connection.VerifiedHTTPSConnection object at 0x7faed7ddfc88>: Failed to establish a new connection: [Errno -2] Name or service not known',))

build finished with problems.
make: *** [Makefile:20: linkcheck] Error 1
```

#### Expected results
Also a check for the local link.

### Reproducible project / your project
N/A

### Environment info
- OS: Arch Linux
- Python version: 3.6
- Sphinx version: 1.7.6


Patch information:
diff --git a/doc/usage/builders/index.rst b/doc/usage/builders/index.rst
index db6706944..c860a2517 100644
--- a/doc/usage/builders/index.rst
+++ b/doc/usage/builders/index.rst
@@ -428,9 +428,11 @@ name is ``rinoh``. Refer to the `rinohtype manual`_ for details.
 .. module:: sphinx.builders.linkcheck
 .. class:: CheckExternalLinksBuilder
 
-   This builder scans all documents for external links, tries to open them with
-   ``requests``, and writes an overview which ones are broken and redirected to
-   standard output and to :file:`output.txt` in the output directory.
+   This builder scans all documents for external HTTP(S) links and local
+   links. External links are tried to open with ``requests`` while local
+   links are checked for existence on disk. It writes an overview which
+   ones are broken and redirected to standard output and to :file:`output.txt`
+   in the output directory.
 
    .. autoattribute:: name
 
diff --git a/sphinx/builders/linkcheck.py b/sphinx/builders/linkcheck.py
index dd5317087..c159b273f 100644
--- a/sphinx/builders/linkcheck.py
+++ b/sphinx/builders/linkcheck.py
@@ -77,7 +77,11 @@ def check_anchor(response: requests.requests.Response, anchor: str) -> bool:
 
 class CheckExternalLinksBuilder(Builder):
     """
-    Checks for broken external links.
+    Checks for broken links.
+
+    This builder scans all documents for external HTTP(S) links and local
+    (internal) links. External links are validated via HTTP requests, and
+    local links are checked for existence on disk.
     """
     name = 'linkcheck'
     epilog = __('Look for any errors in the above output or in '
@@ -213,7 +217,17 @@ class CheckExternalLinksBuilder(Builder):
             if len(uri) == 0 or uri.startswith(('#', 'mailto:', 'ftp:')):
                 return 'unchecked', '', 0
             elif not uri.startswith(('http:', 'https:')):
-                return 'local', '', 0
+                # Check local (internal) links by resolving against the document path
+                local_uri = uri.split('#', 1)[0] if '#' in uri else uri
+                try:
+                    rel_fn, abs_fn = self.env.relfn2path(local_uri, docname)
+                except Exception:
+                    # If resolution fails, consider as broken
+                    return 'broken', __("Local path could not be resolved: %s") % local_uri, 0
+                if path.exists(abs_fn):
+                    return 'working', '', 0
+                else:
+                    return 'broken', __("Local path not found: %s") % rel_fn, 0
             elif uri in self.good:
                 return 'working', 'old', 0
             elif uri in self.broken:
@@ -324,7 +338,7 @@ class CheckExternalLinksBuilder(Builder):
         # image nodes
         for imgnode in doctree.traverse(nodes.image):
             uri = imgnode['candidates'].get('?')
-            if uri and '://' in uri:
+            if uri:
                 lineno = get_node_line(imgnode)
                 self.wqueue.put((uri, docname, lineno), False)
                 n += 1


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `tests/test_build_linkcheck.py` and `tests/roots/test-linkcheck/links.txt`.
Extra Requirements: 
Purpose: I need to analyze the existing tests for the linkcheck builder to find test cases that are relevant to the bug fix, which involves checking local links.

Previous refined query 2:
Essential Query: Please provide the full content of `tests/test_toctree.py`, `tests/test_util_images.py`, and `tests/test_domain_std.py`.
Extra Requirements: If sending the full files is too large, please prioritize `tests/test_toctree.py` and `tests/test_util_images.py` as they are most relevant to internal link and resource handling.
Purpose: These files are needed to find existing test patterns for local path and reference resolution, which is analogous to the functionality being added in the patch for the linkcheck builder.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: tests/roots/test-linkcheck/links.txt
Line number range: 1 - 16
Content:
1. This is from CPython documentation.
2. 
3. * Also, if there is a `default namespace <https://www.w3.org/TR/2006/REC-xml-names-20060816/#defaulting>`__, that full URI gets prepended to all of the non-prefixed tags.
4. 
5. * The URL having anchor: `http://www.sphinx-doc.org/en/1.4.8/tutorial.html#install-sphinx`_
6. 
7. Some additional anchors to exercise ignore code
8. 
9. * `Example Bar invalid <https://www.google.com/#!bar>`_
10. * `Example Bar invalid <https://www.google.com#!bar>`_ tests that default ignore anchor of #! does not need to be prefixed with /
11. * `Example Bar invalid <https://www.google.com/#top>`_
12. * `Example anchor invalid <http://www.sphinx-doc.org/en/1.7/intro.html#does-not-exist>`_
13. * `Complete nonsense <https://localhost:7777/doesnotexist>`_
14. 
15. .. image:: https://www.google.com/image.png
16. .. figure:: https://www.google.com/image2.png


File: tests/test_build_linkcheck.py
Line number range: 1 - 159
Content:
1. """
2.     test_build_linkcheck
3.     ~~~~~~~~~~~~~~~~~~~~
4. 
5.     Test the build process with manpage builder with the test root.
6. 
7.     :copyright: Copyright 2007-2020 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import json
12. import re
13. from unittest import mock
14. import pytest
15. 
16. 
17. @pytest.mark.sphinx('linkcheck', testroot='linkcheck', freshenv=True)
18. def test_defaults(app, status, warning):
19.     app.builder.build_all()
20. 
21.     assert (app.outdir / 'output.txt').exists()
22.     content = (app.outdir / 'output.txt').read_text()
23. 
24.     print(content)
25.     # looking for '#top' and '#does-not-exist' not found should fail
26.     assert "Anchor 'top' not found" in content
27.     assert "Anchor 'does-not-exist' not found" in content
28.     # looking for non-existent URL should fail
29.     assert " Max retries exceeded with url: /doesnotexist" in content
30.     # images should fail
31.     assert "Not Found for url: https://www.google.com/image.png" in content
32.     assert "Not Found for url: https://www.google.com/image2.png" in content
33.     assert len(content.splitlines()) == 5
34. 
35. 
36. @pytest.mark.sphinx('linkcheck', testroot='linkcheck', freshenv=True)
37. def test_defaults_json(app, status, warning):
38.     app.builder.build_all()
39. 
40.     assert (app.outdir / 'output.json').exists()
41.     content = (app.outdir / 'output.json').read_text()
42.     print(content)
43. 
44.     rows = [json.loads(x) for x in content.splitlines()]
45.     row = rows[0]
46.     for attr in ["filename", "lineno", "status", "code", "uri",
47.                  "info"]:
48.         assert attr in row
49. 
50.     assert len(content.splitlines()) == 8
51.     assert len(rows) == 8
52.     # the output order of the rows is not stable
53.     # due to possible variance in network latency
54.     rowsby = {row["uri"]:row for row in rows}
55.     assert rowsby["https://www.google.com#!bar"] == {
56.         'filename': 'links.txt',
57.         'lineno': 10,
58.         'status': 'working',
59.         'code': 0,
60.         'uri': 'https://www.google.com#!bar',
61.         'info': ''
62.     }
63.     # looking for non-existent URL should fail
64.     dnerow = rowsby['https://localhost:7777/doesnotexist']
65.     assert dnerow['filename'] == 'links.txt'
66.     assert dnerow['lineno'] == 13
67.     assert dnerow['status'] == 'broken'
68.     assert dnerow['code'] == 0
69.     assert dnerow['uri'] == 'https://localhost:7777/doesnotexist'
70.     assert rowsby['https://www.google.com/image2.png'] == {
71.         'filename': 'links.txt',
72.         'lineno': 16,
73.         'status': 'broken',
74.         'code': 0,
75.         'uri': 'https://www.google.com/image2.png',
76.         'info': '404 Client Error: Not Found for url: https://www.google.com/image2.png'
77.     }
78.     # looking for '#top' and '#does-not-exist' not found should fail
79.     assert "Anchor 'top' not found" == \
80.         rowsby["https://www.google.com/#top"]["info"]
81.     assert "Anchor 'does-not-exist' not found" == \
82.         rowsby["http://www.sphinx-doc.org/en/1.7/intro.html#does-not-exist"]["info"]
83.     # images should fail
84.     assert "Not Found for url: https://www.google.com/image.png" in \
85.         rowsby["https://www.google.com/image.png"]["info"]
86. 
87. 
88. @pytest.mark.sphinx(
89.     'linkcheck', testroot='linkcheck', freshenv=True,
90.     confoverrides={'linkcheck_anchors_ignore': ["^!", "^top$"],
91.                    'linkcheck_ignore': [
92.                        'https://localhost:7777/doesnotexist',
93.                        'http://www.sphinx-doc.org/en/1.7/intro.html#',
94.                        'https://www.google.com/image.png',
95.                        'https://www.google.com/image2.png']
96.                    })
97. def test_anchors_ignored(app, status, warning):
98.     app.builder.build_all()
99. 
100.     assert (app.outdir / 'output.txt').exists()
101.     content = (app.outdir / 'output.txt').read_text()
102. 
103.     # expect all ok when excluding #top
104.     assert not content
105. 
106. 
107. @pytest.mark.sphinx(
108.     'linkcheck', testroot='linkcheck', freshenv=True,
109.     confoverrides={'linkcheck_auth': [
110.                         (r'.+google\.com/image.+', 'authinfo1'),
111.                         (r'.+google\.com.+', 'authinfo2'),
112.                    ]
113.                   })
114. def test_auth(app, status, warning):
115.     mock_req = mock.MagicMock()
116.     mock_req.return_value = 'fake-response'
117. 
118.     with mock.patch.multiple('requests', get=mock_req, head=mock_req):
119.         app.builder.build_all()
120.         for c_args, c_kwargs in mock_req.call_args_list:
121.             if 'google.com/image' in c_args[0]:
122.                 assert c_kwargs['auth'] == 'authinfo1'
123.             elif 'google.com' in c_args[0]:
124.                 assert c_kwargs['auth'] == 'authinfo2'
125.             else:
126.                 assert not c_kwargs['auth']
127. 
128. 
129. @pytest.mark.sphinx(
130.     'linkcheck', testroot='linkcheck', freshenv=True,
131.     confoverrides={'linkcheck_request_headers': {
132.         "https://localhost:7777/": {
133.             "Accept": "text/html",
134.         },
135.         "http://www.sphinx-doc.org": {  # no slash at the end
136.             "Accept": "application/json",
137.         },
138.         "*": {
139.             "X-Secret": "open sesami",
140.         }
141.     }})
142. def test_linkcheck_request_headers(app, status, warning):
143.     mock_req = mock.MagicMock()
144.     mock_req.return_value = 'fake-response'
145. 
146.     with mock.patch.multiple('requests', get=mock_req, head=mock_req):
147.         app.builder.build_all()
148.         for args, kwargs in mock_req.call_args_list:
149.             url = args[0]
150.             headers = kwargs.get('headers', {})
151.             if "https://localhost:7777" in url:
152.                 assert headers["Accept"] == "text/html"
153.             elif 'http://www.sphinx-doc.org' in url:
154.                 assert headers["Accept"] == "application/json"
155.             elif 'https://www.google.com' in url:
156.                 assert headers["Accept"] == "text/html,application/xhtml+xml;q=0.9,*/*;q=0.8"
157.                 assert headers["X-Secret"] == "open sesami"
158.             else:
159.                 assert headers["Accept"] == "text/html,application/xhtml+xml;q=0.9,*/*;q=0.8"


File: tests/test_domain_std.py
Line number range: 1 - 396
Content:
1. """
2.     test_domain_std
3.     ~~~~~~~~~~~~~~~
4. 
5.     Tests the std domain
6. 
7.     :copyright: Copyright 2007-2020 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import pytest
12. 
13. from unittest import mock
14. 
15. from docutils import nodes
16. from docutils.nodes import definition, definition_list, definition_list_item, term
17. 
18. from html5lib import HTMLParser
19. 
20. from sphinx import addnodes
21. from sphinx.addnodes import (
22.     desc, desc_addname, desc_content, desc_name, desc_signature, glossary, index,
23.     pending_xref
24. )
25. from sphinx.domains.std import StandardDomain
26. from sphinx.testing import restructuredtext
27. from sphinx.testing.util import assert_node
28. from sphinx.util import docutils
29. 
30. 
31. def test_process_doc_handle_figure_caption():
32.     env = mock.Mock(domaindata={})
33.     env.app.registry.enumerable_nodes = {}
34.     figure_node = nodes.figure(
35.         '',
36.         nodes.caption('caption text', 'caption text'),
37.     )
38.     document = mock.Mock(
39.         nametypes={'testname': True},
40.         nameids={'testname': 'testid'},
41.         ids={'testid': figure_node},
42.         citation_refs={},
43.     )
44.     document.traverse.return_value = []
45. 
46.     domain = StandardDomain(env)
47.     if 'testname' in domain.data['labels']:
48.         del domain.data['labels']['testname']
49.     domain.process_doc(env, 'testdoc', document)
50.     assert 'testname' in domain.data['labels']
51.     assert domain.data['labels']['testname'] == (
52.         'testdoc', 'testid', 'caption text')
53. 
54. 
55. def test_process_doc_handle_table_title():
56.     env = mock.Mock(domaindata={})
57.     env.app.registry.enumerable_nodes = {}
58.     table_node = nodes.table(
59.         '',
60.         nodes.title('title text', 'title text'),
61.     )
62.     document = mock.Mock(
63.         nametypes={'testname': True},
64.         nameids={'testname': 'testid'},
65.         ids={'testid': table_node},
66.         citation_refs={},
67.     )
68.     document.traverse.return_value = []
69. 
70.     domain = StandardDomain(env)
71.     if 'testname' in domain.data['labels']:
72.         del domain.data['labels']['testname']
73.     domain.process_doc(env, 'testdoc', document)
74.     assert 'testname' in domain.data['labels']
75.     assert domain.data['labels']['testname'] == (
76.         'testdoc', 'testid', 'title text')
77. 
78. 
79. def test_get_full_qualified_name():
80.     env = mock.Mock(domaindata={})
81.     env.app.registry.enumerable_nodes = {}
82.     domain = StandardDomain(env)
83. 
84.     # normal references
85.     node = nodes.reference()
86.     assert domain.get_full_qualified_name(node) is None
87. 
88.     # simple reference to options
89.     node = nodes.reference(reftype='option', reftarget='-l')
90.     assert domain.get_full_qualified_name(node) is None
91. 
92.     # options with std:program context
93.     kwargs = {'std:program': 'ls'}
94.     node = nodes.reference(reftype='option', reftarget='-l', **kwargs)
95.     assert domain.get_full_qualified_name(node) == 'ls.-l'
96. 
97. 
98. def test_glossary(app):
99.     text = (".. glossary::\n"
100.             "\n"
101.             "   term1\n"
102.             "   TERM2\n"
103.             "       description\n"
104.             "\n"
105.             "   term3 : classifier\n"
106.             "       description\n"
107.             "       description\n"
108.             "\n"
109.             "   term4 : class1 : class2\n"
110.             "       description\n")
111. 
112.     # doctree
113.     doctree = restructuredtext.parse(app, text)
114.     assert_node(doctree, (
115.         [glossary, definition_list, ([definition_list_item, ([term, ("term1",
116.                                                                      index)],
117.                                                              [term, ("TERM2",
118.                                                                      index)],
119.                                                              definition)],
120.                                      [definition_list_item, ([term, ("term3",
121.                                                                      index)],
122.                                                              definition)],
123.                                      [definition_list_item, ([term, ("term4",
124.                                                                      index)],
125.                                                              definition)])],
126.     ))
127.     assert_node(doctree[0][0][0][0][1],
128.                 entries=[("single", "term1", "term-term1", "main", None)])
129.     assert_node(doctree[0][0][0][1][1],
130.                 entries=[("single", "TERM2", "term-TERM2", "main", None)])
131.     assert_node(doctree[0][0][0][2],
132.                 [definition, nodes.paragraph, "description"])
133.     assert_node(doctree[0][0][1][0][1],
134.                 entries=[("single", "term3", "term-term3", "main", "classifier")])
135.     assert_node(doctree[0][0][1][1],
136.                 [definition, nodes.paragraph, ("description\n"
137.                                                "description")])
138.     assert_node(doctree[0][0][2][0][1],
139.                 entries=[("single", "term4", "term-term4", "main", "class1")])
140.     assert_node(doctree[0][0][2][1],
141.                 [nodes.definition, nodes.paragraph, "description"])
142. 
143.     # index
144.     domain = app.env.get_domain("std")
145.     objects = list(domain.get_objects())
146.     assert ("term1", "term1", "term", "index", "term-term1", -1) in objects
147.     assert ("TERM2", "TERM2", "term", "index", "term-TERM2", -1) in objects
148.     assert ("term3", "term3", "term", "index", "term-term3", -1) in objects
149.     assert ("term4", "term4", "term", "index", "term-term4", -1) in objects
150. 
151.     # term reference (case sensitive)
152.     refnode = domain.resolve_xref(app.env, 'index', app.builder, 'term', 'term1',
153.                                   pending_xref(), nodes.paragraph())
154.     assert_node(refnode, nodes.reference, refid="term-term1")
155. 
156.     # term reference (case insensitive)
157.     refnode = domain.resolve_xref(app.env, 'index', app.builder, 'term', 'term2',
158.                                   pending_xref(), nodes.paragraph())
159.     assert_node(refnode, nodes.reference, refid="term-TERM2")
160. 
161. 
162. def test_glossary_warning(app, status, warning):
163.     # empty line between terms
164.     text = (".. glossary::\n"
165.             "\n"
166.             "   term1\n"
167.             "\n"
168.             "   term2\n")
169.     restructuredtext.parse(app, text, "case1")
170.     assert ("case1.rst:4: WARNING: glossary terms must not be separated by empty lines"
171.             in warning.getvalue())
172. 
173.     # glossary starts with indented item
174.     text = (".. glossary::\n"
175.             "\n"
176.             "       description\n"
177.             "   term\n")
178.     restructuredtext.parse(app, text, "case2")
179.     assert ("case2.rst:3: WARNING: glossary term must be preceded by empty line"
180.             in warning.getvalue())
181. 
182.     # empty line between terms
183.     text = (".. glossary::\n"
184.             "\n"
185.             "   term1\n"
186.             "       description\n"
187.             "   term2\n")
188.     restructuredtext.parse(app, text, "case3")
189.     assert ("case3.rst:4: WARNING: glossary term must be preceded by empty line"
190.             in warning.getvalue())
191. 
192.     # duplicated terms
193.     text = (".. glossary::\n"
194.             "\n"
195.             "   term-case4\n"
196.             "   term-case4\n")
197.     restructuredtext.parse(app, text, "case4")
198.     assert ("case4.rst:3: WARNING: duplicate term description of term-case4, "
199.             "other instance in case4" in warning.getvalue())
200. 
201. 
202. def test_glossary_comment(app):
203.     text = (".. glossary::\n"
204.             "\n"
205.             "   term1\n"
206.             "       description\n"
207.             "   .. term2\n"
208.             "       description\n"
209.             "       description\n")
210.     doctree = restructuredtext.parse(app, text)
211.     assert_node(doctree, (
212.         [glossary, definition_list, definition_list_item, ([term, ("term1",
213.                                                                    index)],
214.                                                            definition)],
215.     ))
216.     assert_node(doctree[0][0][0][1],
217.                 [nodes.definition, nodes.paragraph, "description"])
218. 
219. 
220. def test_glossary_comment2(app):
221.     text = (".. glossary::\n"
222.             "\n"
223.             "   term1\n"
224.             "       description\n"
225.             "\n"
226.             "   .. term2\n"
227.             "   term3\n"
228.             "       description\n"
229.             "       description\n")
230.     doctree = restructuredtext.parse(app, text)
231.     assert_node(doctree, (
232.         [glossary, definition_list, ([definition_list_item, ([term, ("term1",
233.                                                                      index)],
234.                                                              definition)],
235.                                      [definition_list_item, ([term, ("term3",
236.                                                                      index)],
237.                                                              definition)])],
238.     ))
239.     assert_node(doctree[0][0][0][1],
240.                 [nodes.definition, nodes.paragraph, "description"])
241.     assert_node(doctree[0][0][1][1],
242.                 [nodes.definition, nodes.paragraph, ("description\n"
243.                                                      "description")])
244. 
245. 
246. def test_glossary_sorted(app):
247.     text = (".. glossary::\n"
248.             "   :sorted:\n"
249.             "\n"
250.             "   term3\n"
251.             "       description\n"
252.             "\n"
253.             "   term2\n"
254.             "   term1\n"
255.             "       description\n")
256.     doctree = restructuredtext.parse(app, text)
257.     assert_node(doctree, (
258.         [glossary, definition_list, ([definition_list_item, ([term, ("term2",
259.                                                                      index)],
260.                                                              [term, ("term1",
261.                                                                      index)],
262.                                                              definition)],
263.                                      [definition_list_item, ([term, ("term3",
264.                                                                      index)],
265.                                                              definition)])],
266.     ))
267.     assert_node(doctree[0][0][0][2],
268.                 [nodes.definition, nodes.paragraph, "description"])
269.     assert_node(doctree[0][0][1][1],
270.                 [nodes.definition, nodes.paragraph, "description"])
271. 
272. 
273. def test_glossary_alphanumeric(app):
274.     text = (".. glossary::\n"
275.             "\n"
276.             "   1\n"
277.             "   /\n")
278.     restructuredtext.parse(app, text)
279.     objects = list(app.env.get_domain("std").get_objects())
280.     assert ("1", "1", "term", "index", "term-1", -1) in objects
281.     assert ("/", "/", "term", "index", "term-0", -1) in objects
282. 
283. 
284. def test_glossary_conflicted_labels(app):
285.     text = (".. _term-foo:\n"
286.             ".. glossary::\n"
287.             "\n"
288.             "   foo\n")
289.     restructuredtext.parse(app, text)
290.     objects = list(app.env.get_domain("std").get_objects())
291.     assert ("foo", "foo", "term", "index", "term-0", -1) in objects
292. 
293. 
294. def test_cmdoption(app):
295.     text = (".. program:: ls\n"
296.             "\n"
297.             ".. option:: -l\n")
298.     domain = app.env.get_domain('std')
299.     doctree = restructuredtext.parse(app, text)
300.     assert_node(doctree, (addnodes.index,
301.                           [desc, ([desc_signature, ([desc_name, "-l"],
302.                                                     [desc_addname, ()])],
303.                                   [desc_content, ()])]))
304.     assert_node(doctree[0], addnodes.index,
305.                 entries=[('pair', 'ls command line option; -l', 'cmdoption-ls-l', '', None)])
306.     assert ('ls', '-l') in domain.progoptions
307.     assert domain.progoptions[('ls', '-l')] == ('index', 'cmdoption-ls-l')
308. 
309. 
310. def test_multiple_cmdoptions(app):
311.     text = (".. program:: cmd\n"
312.             "\n"
313.             ".. option:: -o directory, --output directory\n")
314.     domain = app.env.get_domain('std')
315.     doctree = restructuredtext.parse(app, text)
316.     assert_node(doctree, (addnodes.index,
317.                           [desc, ([desc_signature, ([desc_name, "-o"],
318.                                                     [desc_addname, " directory"],
319.                                                     [desc_addname, ", "],
320.                                                     [desc_name, "--output"],
321.                                                     [desc_addname, " directory"])],
322.                                   [desc_content, ()])]))
323.     assert_node(doctree[0], addnodes.index,
324.                 entries=[('pair', 'cmd command line option; -o directory',
325.                           'cmdoption-cmd-o', '', None),
326.                          ('pair', 'cmd command line option; --output directory',
327.                           'cmdoption-cmd-o', '', None)])
328.     assert ('cmd', '-o') in domain.progoptions
329.     assert ('cmd', '--output') in domain.progoptions
330.     assert domain.progoptions[('cmd', '-o')] == ('index', 'cmdoption-cmd-o')
331.     assert domain.progoptions[('cmd', '--output')] == ('index', 'cmdoption-cmd-o')
332. 
333. 
334. @pytest.mark.skipif(docutils.__version_info__ < (0, 13),
335.                     reason='docutils-0.13 or above is required')
336. @pytest.mark.sphinx(testroot='productionlist')
337. def test_productionlist(app, status, warning):
338.     app.builder.build_all()
339. 
340.     warnings = warning.getvalue().split("\n");
341.     assert len(warnings) == 2
342.     assert warnings[-1] == ''
343.     assert "Dup2.rst:4: WARNING: duplicate token description of Dup, other instance in Dup1" in warnings[0]
344. 
345.     with (app.outdir / 'index.html').open('rb') as f:
346.         etree = HTMLParser(namespaceHTMLElements=False).parse(f)
347.     ul = list(etree.iter('ul'))[1]
348.     cases = []
349.     for li in list(ul):
350.         assert len(list(li)) == 1
351.         p = list(li)[0]
352.         assert p.tag == 'p'
353.         text = str(p.text).strip(' :')
354.         assert len(list(p)) == 1
355.         a = list(p)[0]
356.         assert a.tag == 'a'
357.         link = a.get('href')
358.         assert len(list(a)) == 1
359.         code = list(a)[0]
360.         assert code.tag == 'code'
361.         assert len(list(code)) == 1
362.         span = list(code)[0]
363.         assert span.tag == 'span'
364.         linkText = span.text.strip()
365.         cases.append((text, link, linkText))
366.     assert cases == [
367.         ('A', 'Bare.html#grammar-token-A', 'A'),
368.         ('B', 'Bare.html#grammar-token-B', 'B'),
369.         ('P1:A', 'P1.html#grammar-token-P1-A', 'P1:A'),
370.         ('P1:B', 'P1.html#grammar-token-P1-B', 'P1:B'),
371.         ('P2:A', 'P1.html#grammar-token-P1-A', 'P1:A'),
372.         ('P2:B', 'P2.html#grammar-token-P2-B', 'P2:B'),
373.         ('Explicit title A, plain', 'Bare.html#grammar-token-A', 'MyTitle'),
374.         ('Explicit title A, colon', 'Bare.html#grammar-token-A', 'My:Title'),
375.         ('Explicit title P1:A, plain', 'P1.html#grammar-token-P1-A', 'MyTitle'),
376.         ('Explicit title P1:A, colon', 'P1.html#grammar-token-P1-A', 'My:Title'),
377.         ('Tilde A', 'Bare.html#grammar-token-A', 'A'),
378.         ('Tilde P1:A', 'P1.html#grammar-token-P1-A', 'A'),
379.         ('Tilde explicit title P1:A', 'P1.html#grammar-token-P1-A', '~MyTitle'),
380.         ('Tilde, explicit title P1:A', 'P1.html#grammar-token-P1-A', 'MyTitle'),
381.         ('Dup', 'Dup2.html#grammar-token-Dup', 'Dup'),
382.         ('FirstLine', 'firstLineRule.html#grammar-token-FirstLine', 'FirstLine'),
383.         ('SecondLine', 'firstLineRule.html#grammar-token-SecondLine', 'SecondLine'),
384.     ]
385. 
386.     text = (app.outdir / 'LineContinuation.html').read_text()
387.     assert "A</strong> ::=  B C D    E F G" in text
388. 
389. 
390. def test_disabled_docref(app):
391.     text = (":doc:`index`\n"
392.             ":doc:`!index`\n")
393.     doctree = restructuredtext.parse(app, text)
394.     assert_node(doctree, ([nodes.paragraph, ([pending_xref, nodes.inline, "index"],
395.                                              "\n",
396.                                              [nodes.inline, "index"])],))


File: tests/test_toctree.py
Line number range: 1 - 47
Content:
1. """
2.     test_toctree
3.     ~~~~~~~~~~~~
4. 
5.     Test the HTML builder and check output against XPath.
6. 
7.     :copyright: Copyright 2007-2020 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. import re
11. 
12. import pytest
13. 
14. 
15. @pytest.mark.sphinx(testroot='toctree-glob')
16. def test_relations(app, status, warning):
17.     app.builder.build_all()
18.     assert app.builder.relations['index'] == [None, None, 'foo']
19.     assert app.builder.relations['foo'] == ['index', 'index', 'bar/index']
20.     assert app.builder.relations['bar/index'] == ['index', 'foo', 'bar/bar_1']
21.     assert app.builder.relations['bar/bar_1'] == ['bar/index', 'bar/index', 'bar/bar_2']
22.     assert app.builder.relations['bar/bar_2'] == ['bar/index', 'bar/bar_1', 'bar/bar_3']
23.     assert app.builder.relations['bar/bar_3'] == ['bar/index', 'bar/bar_2', 'bar/bar_4/index']
24.     assert app.builder.relations['bar/bar_4/index'] == ['bar/index', 'bar/bar_3', 'baz']
25.     assert app.builder.relations['baz'] == ['index', 'bar/bar_4/index', 'qux/index']
26.     assert app.builder.relations['qux/index'] == ['index', 'baz', 'qux/qux_1']
27.     assert app.builder.relations['qux/qux_1'] == ['qux/index', 'qux/index', 'qux/qux_2']
28.     assert app.builder.relations['qux/qux_2'] == ['qux/index', 'qux/qux_1', None]
29.     assert 'quux' not in app.builder.relations
30. 
31. 
32. @pytest.mark.sphinx('singlehtml', testroot='toctree-empty')
33. def test_singlehtml_toctree(app, status, warning):
34.     app.builder.build_all()
35.     try:
36.         app.builder._get_local_toctree('index')
37.     except AttributeError:
38.         pytest.fail('Unexpected AttributeError in app.builder.fix_refuris')
39. 
40. 
41. @pytest.mark.sphinx(testroot='toctree', srcdir="numbered-toctree")
42. def test_numbered_toctree(app, status, warning):
43.     # give argument to :numbered: option
44.     index = (app.srcdir / 'index.rst').read_text()
45.     index = re.sub(':numbered:.*', ':numbered: 1', index)
46.     (app.srcdir / 'index.rst').write_text(index)
47.     app.builder.build_all()


File: tests/test_util_images.py
Line number range: 1 - 79
Content:
1. """
2.     test_util_images
3.     ~~~~~~~~~~~~~~~~
4. 
5.     Test images util.
6. 
7.     :copyright: Copyright 2007-2020 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import pytest
12. 
13. from sphinx.util.images import (
14.     get_image_size, guess_mimetype, get_image_extension, parse_data_uri
15. )
16. 
17. GIF_FILENAME = 'img.gif'
18. PNG_FILENAME = 'img.png'
19. PDF_FILENAME = 'img.pdf'
20. TXT_FILENAME = 'index.txt'
21. 
22. 
23. def test_get_image_size(rootdir):
24.     assert get_image_size(rootdir / 'test-root' / GIF_FILENAME) == (200, 181)
25.     assert get_image_size(rootdir / 'test-root' / PNG_FILENAME) == (200, 181)
26.     assert get_image_size(rootdir / 'test-root' / PDF_FILENAME) is None
27.     assert get_image_size(rootdir / 'test-root' / TXT_FILENAME) is None
28. 
29. 
30. @pytest.mark.filterwarnings('ignore:The content argument')
31. def test_guess_mimetype():
32.     # guess by filename
33.     assert guess_mimetype('img.png') == 'image/png'
34.     assert guess_mimetype('img.jpg') == 'image/jpeg'
35.     assert guess_mimetype('img.txt') is None
36.     assert guess_mimetype('img.txt', default='text/plain') == 'text/plain'
37.     assert guess_mimetype('no_extension') is None
38.     assert guess_mimetype('IMG.PNG') == 'image/png'
39. 
40.     # default parameter is used when no extension
41.     assert guess_mimetype('img.png', 'text/plain') == 'image/png'
42.     assert guess_mimetype('no_extension', 'text/plain') == 'text/plain'
43. 
44. 
45. def test_get_image_extension():
46.     assert get_image_extension('image/png') == '.png'
47.     assert get_image_extension('image/jpeg') == '.jpg'
48.     assert get_image_extension('image/svg+xml') == '.svg'
49.     assert get_image_extension('text/plain') is None
50. 
51. 
52. def test_parse_data_uri():
53.     # standard case
54.     uri = ("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4"
55.            "//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")
56.     image = parse_data_uri(uri)
57.     assert image is not None
58.     assert image.mimetype == 'image/png'
59.     assert image.charset == 'US-ASCII'
60. 
61.     # no mimetype
62.     uri = ("data:charset=utf-8,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElE"
63.            "QVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")
64.     image = parse_data_uri(uri)
65.     assert image is not None
66.     assert image.mimetype == 'text/plain'
67.     assert image.charset == 'utf-8'
68. 
69.     # non data URI
70.     uri = ("image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4"
71.            "//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")
72.     image = parse_data_uri(uri)
73.     assert image is None
74. 
75.     # invalid data URI (no properties)
76.     with pytest.raises(ValueError):
77.         uri = ("data:iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4"
78.                "//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")
79.         parse_data_uri(uri)

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-24 19:57:40,840 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find test cases that are similar to the bug fix, which involves checking for the existence of local files referenced in documents. The current context provides tests for external link checking and general internal reference resolution, but lacks specific examples of builder tests that validate local file paths. To find relevant patterns, I need to examine tests for features that handle local file references, such as the `image` directive and the `download` role. The test files `tests/test_directive_other.py`, `tests/test_roles.py`, and `tests/test_build_html.py` are likely to contain such test cases.' query='Please provide the full content of `tests/test_directive_other.py`, `tests/test_roles.py`, and `tests/test_build_html.py`.' extra_requirements='If sending the full files is too large, please prioritize `tests/test_directive_other.py` and `tests/test_roles.py` as they are most likely to contain tests for directives and roles that reference local files.' purpose='I need these files to find existing test patterns for verifying local file links, which is the core functionality being added in the patch. These tests will serve as a blueprint for identifying relevant test cases for the user.'
2025-12-24 19:57:40,841 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `tests/test_directive_other.py`, `tests/test_roles.py`, and `tests/test_build_html.py`.
2025-12-24 19:57:40,842 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-24 19:57:40,842 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-24 19:57:40,843 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-24 19:57:40,843 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `tests/test_directive_other.py`, `tests/test_roles.py`, and `tests/test_build_html.py`.
Extra requirements: If sending the full files is too large, please prioritize `tests/test_directive_other.py` and `tests/test_roles.py` as they are most likely to contain tests for directives and roles that reference local files.
Purpose: I need these files to find existing test patterns for verifying local file links, which is the core functionality being added in the patch. These tests will serve as a blueprint for identifying relevant test cases for the user.
2025-12-24 19:57:43,918 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I will first read the full content of `tests/test_directive_other.py` to find test patterns for directives. Next, I will read the entire `tests/test_roles.py` file to find test patterns for roles. Finally, I will read the content of `tests/test_build_html.py` to gather additional context.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/test_build_html.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2163, 'candidates_token_count': 141, 'total_token_count': 2430, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2163}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 141}], 'thoughts_token_count': 126, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.085647204243545, 'model_name': 'gemini-2.5-pro'} id='run--804ed367-d43e-4e8e-be89-db774753904e-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/test_directive_other.py'}, 'id': 'ede53410-5d46-4705-86dd-8f2bb482de37', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/test_roles.py'}, 'id': '0b865977-3996-47c5-97d7-0fe2817e826e', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/test_build_html.py'}, 'id': '5851bf1d-98eb-424c-8b84-8ed8ea97c929', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2163, 'output_tokens': 141, 'total_tokens': 2430, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 126}}
2025-12-24 19:57:46,437 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have successfully retrieved the entire contents of `tests/test_directive_other.py`, `tests/test_roles.py`, and `tests/test_build_html.py`. These files contain numerous tests for directives and roles, including those that reference other files. I will now proceed to analyze these files to identify relevant test patterns that can be used as a blueprint for the new tests.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 15965, 'candidates_token_count': 82, 'total_token_count': 16106, 'cached_content_token_count': 1823, 'prompt_tokens_details': [{'modality': 1, 'token_count': 15965}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1823}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 82}], 'thoughts_token_count': 59}, 'finish_reason': 'STOP', 'avg_logprobs': -0.18649987476628002, 'model_name': 'gemini-2.5-pro'} id='run--0b837a45-e490-496f-8a72-db75e5176af1-0' usage_metadata={'input_tokens': 15965, 'output_tokens': 82, 'total_tokens': 16106, 'input_token_details': {'cache_read': 1823}, 'output_token_details': {'reasoning': 59}}
2025-12-24 19:57:46,439 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `tests/test_directive_other.py`, `tests/test_roles.py`, and `tests/test_build_html.py`.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If sending the full files is too large, please prioritize `tests/test_directive_other.py` and `tests/test_roles.py` as they are most likely to contain tests for directives and roles that reference local files.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
I need these files to find existing test patterns for verifying local file links, which is the core functionality being added in the patch. These tests will serve as a blueprint for identifying relevant test cases for the user.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/test_build_html.py
Line number range: 1 - 500
Content:
1. """
2.     test_build_html
3.     ~~~~~~~~~~~~~~~
4. 
5.     Test the HTML builder and check output against XPath.
6. 
7.     :copyright: Copyright 2007-2020 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import os
12. import re
13. from itertools import cycle, chain
14. 
15. import pytest
16. from html5lib import HTMLParser
17. 
18. from sphinx.builders.html import validate_html_extra_path, validate_html_static_path
19. from sphinx.errors import ConfigError
20. from sphinx.testing.util import strip_escseq
21. from sphinx.util import docutils, md5
22. from sphinx.util.inventory import InventoryFile
23. 
24. 
25. ENV_WARNINGS = """\
26. %(root)s/autodoc_fodder.py:docstring of autodoc_fodder.MarkupError:\\d+: \
27. WARNING: Explicit markup ends without a blank line; unexpected unindent.
28. %(root)s/index.rst:\\d+: WARNING: Encoding 'utf-8-sig' used for reading included \
29. file '%(root)s/wrongenc.inc' seems to be wrong, try giving an :encoding: option
30. %(root)s/index.rst:\\d+: WARNING: invalid single index entry ''
31. %(root)s/index.rst:\\d+: WARNING: image file not readable: foo.png
32. %(root)s/index.rst:\\d+: WARNING: download file not readable: %(root)s/nonexisting.png
33. %(root)s/undecodable.rst:\\d+: WARNING: undecodable source characters, replacing \
34. with "\\?": b?'here: >>>(\\\\|/)xbb<<<((\\\\|/)r)?'
35. """
36. 
37. HTML_WARNINGS = ENV_WARNINGS + """\
38. %(root)s/index.rst:\\d+: WARNING: unknown option: &option
39. %(root)s/index.rst:\\d+: WARNING: citation not found: missing
40. %(root)s/index.rst:\\d+: WARNING: a suitable image for html builder not found: foo.\\*
41. %(root)s/index.rst:\\d+: WARNING: Could not lex literal_block as "c". Highlighting skipped.
42. """
43. 
44. 
45. etree_cache = {}
46. 
47. 
48. @pytest.fixture(scope='module')
49. def cached_etree_parse():
50.     def parse(fname):
51.         if fname in etree_cache:
52.             return etree_cache[fname]
53.         with (fname).open('rb') as fp:
54.             etree = HTMLParser(namespaceHTMLElements=False).parse(fp)
55.             etree_cache.clear()
56.             etree_cache[fname] = etree
57.             return etree
58.     yield parse
59.     etree_cache.clear()
60. 
61. 
62. def flat_dict(d):
63.     return chain.from_iterable(
64.         [
65.             zip(cycle([fname]), values)
66.             for fname, values in d.items()
67.         ]
68.     )
69. 
70. 
71. def tail_check(check):
72.     rex = re.compile(check)
73. 
74.     def checker(nodes):
75.         for node in nodes:
76.             if node.tail and rex.search(node.tail):
77.                 return True
78.         assert False, '%r not found in tail of any nodes %s' % (check, nodes)
79.     return checker
80. 
81. 
82. def check_xpath(etree, fname, path, check, be_found=True):
83.     nodes = list(etree.findall(path))
84.     if check is None:
85.         assert nodes == [], ('found any nodes matching xpath '
86.                              '%r in file %s' % (path, fname))
87.         return
88.     else:
89.         assert nodes != [], ('did not find any node matching xpath '
90.                              '%r in file %s' % (path, fname))
91.     if hasattr(check, '__call__'):
92.         check(nodes)
93.     elif not check:
94.         # only check for node presence
95.         pass
96.     else:
97.         def get_text(node):
98.             if node.text is not None:
99.                 # the node has only one text
100.                 return node.text
101.             else:
102.                 # the node has tags and text; gather texts just under the node
103.                 return ''.join(n.tail or '' for n in node)
104. 
105.         rex = re.compile(check)
106.         if be_found:
107.             if any(rex.search(get_text(node)) for node in nodes):
108.                 return
109.         else:
110.             if all(not rex.search(get_text(node)) for node in nodes):
111.                 return
112. 
113.         assert False, ('%r not found in any node matching '
114.                        'path %s in %s: %r' % (check, path, fname,
115.                                               [node.text for node in nodes]))
116. 
117. 
118. @pytest.mark.sphinx('html', testroot='warnings')
119. def test_html_warnings(app, warning):
120.     app.build()
121.     html_warnings = strip_escseq(re.sub(re.escape(os.sep) + '{1,2}', '/', warning.getvalue()))
122.     html_warnings_exp = HTML_WARNINGS % {
123.         'root': re.escape(app.srcdir.replace(os.sep, '/'))}
124.     assert re.match(html_warnings_exp + '$', html_warnings), \
125.         'Warnings don\'t match:\n' + \
126.         '--- Expected (regex):\n' + html_warnings_exp + \
127.         '--- Got:\n' + html_warnings
128. 
129. 
130. @pytest.mark.sphinx('html', confoverrides={'html4_writer': True})
131. def test_html4_output(app, status, warning):
132.     app.build()
133. 
134. 
135. @pytest.mark.parametrize("fname,expect", flat_dict({
136.     'images.html': [
137.         (".//img[@src='_images/img.png']", ''),
138.         (".//img[@src='_images/img1.png']", ''),
139.         (".//img[@src='_images/simg.png']", ''),
140.         (".//img[@src='_images/svgimg.svg']", ''),
141.         (".//a[@href='_sources/images.txt']", ''),
142.     ],
143.     'subdir/images.html': [
144.         (".//img[@src='../_images/img1.png']", ''),
145.         (".//img[@src='../_images/rimg.png']", ''),
146.     ],
147.     'subdir/includes.html': [
148.         (".//a[@class='reference download internal']", ''),
149.         (".//img[@src='../_images/img.png']", ''),
150.         (".//p", 'This is an include file.'),
151.         (".//pre/span", 'line 1'),
152.         (".//pre/span", 'line 2'),
153.     ],
154.     'includes.html': [
155.         (".//pre", 'Max Strauß'),
156.         (".//a[@class='reference download internal']", ''),
157.         (".//pre/span", '"quotes"'),
158.         (".//pre/span", "'included'"),
159.         (".//pre/span[@class='s2']", 'üöä'),
160.         (".//div[@class='inc-pyobj1 highlight-text notranslate']//pre",
161.          r'^class Foo:\n    pass\n\s*$'),
162.         (".//div[@class='inc-pyobj2 highlight-text notranslate']//pre",
163.          r'^    def baz\(\):\n        pass\n\s*$'),
164.         (".//div[@class='inc-lines highlight-text notranslate']//pre",
165.          r'^class Foo:\n    pass\nclass Bar:\n$'),
166.         (".//div[@class='inc-startend highlight-text notranslate']//pre",
167.          '^foo = "Including Unicode characters: üöä"\\n$'),
168.         (".//div[@class='inc-preappend highlight-text notranslate']//pre",
169.          r'(?m)^START CODE$'),
170.         (".//div[@class='inc-pyobj-dedent highlight-python notranslate']//span",
171.          r'def'),
172.         (".//div[@class='inc-tab3 highlight-text notranslate']//pre",
173.          r'-| |-'),
174.         (".//div[@class='inc-tab8 highlight-python notranslate']//pre/span",
175.          r'-|      |-'),
176.     ],
177.     'autodoc.html': [
178.         (".//dl[@class='py class']/dt[@id='autodoc_target.Class']", ''),
179.         (".//dl[@class='py function']/dt[@id='autodoc_target.function']/em/span", r'\*\*'),
180.         (".//dl[@class='py function']/dt[@id='autodoc_target.function']/em/span", r'kwds'),
181.         (".//dd/p", r'Return spam\.'),
182.     ],
183.     'extapi.html': [
184.         (".//strong", 'from class: Bar'),
185.     ],
186.     'markup.html': [
187.         (".//title", 'set by title directive'),
188.         (".//p/em", 'Section author: Georg Brandl'),
189.         (".//p/em", 'Module author: Georg Brandl'),
190.         # created by the meta directive
191.         (".//meta[@name='author'][@content='Me']", ''),
192.         (".//meta[@name='keywords'][@content='docs, sphinx']", ''),
193.         # a label created by ``.. _label:``
194.         (".//div[@id='label']", ''),
195.         # code with standard code blocks
196.         (".//pre", '^some code$'),
197.         # an option list
198.         (".//span[@class='option']", '--help'),
199.         # admonitions
200.         (".//p[@class='admonition-title']", 'My Admonition'),
201.         (".//div[@class='admonition note']/p", 'Note text.'),
202.         (".//div[@class='admonition warning']/p", 'Warning text.'),
203.         # inline markup
204.         (".//li/p/strong", r'^command\\n$'),
205.         (".//li/p/strong", r'^program\\n$'),
206.         (".//li/p/em", r'^dfn\\n$'),
207.         (".//li/p/kbd", r'^kbd\\n$'),
208.         (".//li/p/span", 'File \N{TRIANGULAR BULLET} Close'),
209.         (".//li/p/code/span[@class='pre']", '^a/$'),
210.         (".//li/p/code/em/span[@class='pre']", '^varpart$'),
211.         (".//li/p/code/em/span[@class='pre']", '^i$'),
212.         (".//a[@href='https://www.python.org/dev/peps/pep-0008']"
213.          "[@class='pep reference external']/strong", 'PEP 8'),
214.         (".//a[@href='https://www.python.org/dev/peps/pep-0008']"
215.          "[@class='pep reference external']/strong",
216.          'Python Enhancement Proposal #8'),
217.         (".//a[@href='https://tools.ietf.org/html/rfc1.html']"
218.          "[@class='rfc reference external']/strong", 'RFC 1'),
219.         (".//a[@href='https://tools.ietf.org/html/rfc1.html']"
220.          "[@class='rfc reference external']/strong", 'Request for Comments #1'),
221.         (".//a[@href='objects.html#envvar-HOME']"
222.          "[@class='reference internal']/code/span[@class='pre']", 'HOME'),
223.         (".//a[@href='#with']"
224.          "[@class='reference internal']/code/span[@class='pre']", '^with$'),
225.         (".//a[@href='#grammar-token-try_stmt']"
226.          "[@class='reference internal']/code/span", '^statement$'),
227.         (".//a[@href='#some-label'][@class='reference internal']/span", '^here$'),
228.         (".//a[@href='#some-label'][@class='reference internal']/span", '^there$'),
229.         (".//a[@href='subdir/includes.html']"
230.          "[@class='reference internal']/span", 'Including in subdir'),
231.         (".//a[@href='objects.html#cmdoption-python-c']"
232.          "[@class='reference internal']/code/span[@class='pre']", '-c'),
233.         # abbreviations
234.         (".//abbr[@title='abbreviation']", '^abbr$'),
235.         # version stuff
236.         (".//div[@class='versionadded']/p/span", 'New in version 0.6: '),
237.         (".//div[@class='versionadded']/p/span",
238.          tail_check('First paragraph of versionadded')),
239.         (".//div[@class='versionchanged']/p/span",
240.          tail_check('First paragraph of versionchanged')),
241.         (".//div[@class='versionchanged']/p",
242.          'Second paragraph of versionchanged'),
243.         # footnote reference
244.         (".//a[@class='footnote-reference brackets']", r'1'),
245.         # created by reference lookup
246.         (".//a[@href='index.html#ref1']", ''),
247.         # ``seealso`` directive
248.         (".//div/p[@class='admonition-title']", 'See also'),
249.         # a ``hlist`` directive
250.         (".//table[@class='hlist']/tbody/tr/td/ul/li/p", '^This$'),
251.         # a ``centered`` directive
252.         (".//p[@class='centered']/strong", 'LICENSE'),
253.         # a glossary
254.         (".//dl/dt[@id='term-boson']", 'boson'),
255.         # a production list
256.         (".//pre/strong", 'try_stmt'),
257.         (".//pre/a[@href='#grammar-token-try1_stmt']/code/span", 'try1_stmt'),
258.         # tests for ``only`` directive
259.         (".//p", 'A global substitution.'),
260.         (".//p", 'In HTML.'),
261.         (".//p", 'In both.'),
262.         (".//p", 'Always present'),
263.         # tests for ``any`` role
264.         (".//a[@href='#with']/span", 'headings'),
265.         (".//a[@href='objects.html#func_without_body']/code/span", 'objects'),
266.         # tests for numeric labels
267.         (".//a[@href='#id1'][@class='reference internal']/span", 'Testing various markup'),
268.         # tests for smartypants
269.         (".//li/p", 'Smart “quotes” in English ‘text’.'),
270.         (".//li/p", 'Smart — long and – short dashes.'),
271.         (".//li/p", 'Ellipsis…'),
272.         (".//li/p/code/span[@class='pre']", 'foo--"bar"...'),
273.         (".//p", 'Этот «абзац» должен использовать „русские“ кавычки.'),
274.         (".//p", 'Il dit : « C’est “super” ! »'),
275.     ],
276.     'objects.html': [
277.         (".//dt[@id='mod.Cls.meth1']", ''),
278.         (".//dt[@id='errmod.Error']", ''),
279.         (".//dt/code", r'long\(parameter,\s* list\)'),
280.         (".//dt/code", 'another one'),
281.         (".//a[@href='#mod.Cls'][@class='reference internal']", ''),
282.         (".//dl[@class='std userdesc']", ''),
283.         (".//dt[@id='userdesc-myobj']", ''),
284.         (".//a[@href='#userdesc-myobj'][@class='reference internal']", ''),
285.         # docfields
286.         (".//a[@class='reference internal'][@href='#TimeInt']/em", 'TimeInt'),
287.         (".//a[@class='reference internal'][@href='#Time']", 'Time'),
288.         (".//a[@class='reference internal'][@href='#errmod.Error']/strong", 'Error'),
289.         # C references
290.         (".//span[@class='pre']", 'CFunction()'),
291.         (".//a[@href='#c.Sphinx_DoSomething']", ''),
292.         (".//a[@href='#c.SphinxStruct.member']", ''),
293.         (".//a[@href='#c.SPHINX_USE_PYTHON']", ''),
294.         (".//a[@href='#c.SphinxType']", ''),
295.         (".//a[@href='#c.sphinx_global']", ''),
296.         # test global TOC created by toctree()
297.         (".//ul[@class='current']/li[@class='toctree-l1 current']/a[@href='#']",
298.          'Testing object descriptions'),
299.         (".//li[@class='toctree-l1']/a[@href='markup.html']",
300.          'Testing various markup'),
301.         # test unknown field names
302.         (".//dt[@class='field-odd']", 'Field_name'),
303.         (".//dt[@class='field-even']", 'Field_name all lower'),
304.         (".//dt[@class='field-odd']", 'FIELD_NAME'),
305.         (".//dt[@class='field-even']", 'FIELD_NAME ALL CAPS'),
306.         (".//dt[@class='field-odd']", 'Field_Name'),
307.         (".//dt[@class='field-even']", 'Field_Name All Word Caps'),
308.         (".//dt[@class='field-odd']", 'Field_name'),
309.         (".//dt[@class='field-even']", 'Field_name First word cap'),
310.         (".//dt[@class='field-odd']", 'FIELd_name'),
311.         (".//dt[@class='field-even']", 'FIELd_name PARTial caps'),
312.         # custom sidebar
313.         (".//h4", 'Custom sidebar'),
314.         # docfields
315.         (".//dd[@class='field-odd']/p/strong", '^moo$'),
316.         (".//dd[@class='field-odd']/p/strong", tail_check(r'\(Moo\) .* Moo')),
317.         (".//dd[@class='field-odd']/ul/li/p/strong", '^hour$'),
318.         (".//dd[@class='field-odd']/ul/li/p/em", '^DuplicateType$'),
319.         (".//dd[@class='field-odd']/ul/li/p/em", tail_check(r'.* Some parameter')),
320.         # others
321.         (".//a[@class='reference internal'][@href='#cmdoption-perl-arg-p']/code/span",
322.          'perl'),
323.         (".//a[@class='reference internal'][@href='#cmdoption-perl-arg-p']/code/span",
324.          '\\+p'),
325.         (".//a[@class='reference internal'][@href='#cmdoption-perl-ObjC']/code/span",
326.          '--ObjC\\+\\+'),
327.         (".//a[@class='reference internal'][@href='#cmdoption-perl-plugin.option']/code/span",
328.          '--plugin.option'),
329.         (".//a[@class='reference internal'][@href='#cmdoption-perl-arg-create-auth-token']"
330.          "/code/span",
331.          'create-auth-token'),
332.         (".//a[@class='reference internal'][@href='#cmdoption-perl-arg-arg']/code/span",
333.          'arg'),
334.         (".//a[@class='reference internal'][@href='#cmdoption-perl-j']/code/span",
335.          '-j'),
336.         (".//a[@class='reference internal'][@href='#cmdoption-hg-arg-commit']/code/span",
337.          'hg'),
338.         (".//a[@class='reference internal'][@href='#cmdoption-hg-arg-commit']/code/span",
339.          'commit'),
340.         (".//a[@class='reference internal'][@href='#cmdoption-git-commit-p']/code/span",
341.          'git'),
342.         (".//a[@class='reference internal'][@href='#cmdoption-git-commit-p']/code/span",
343.          'commit'),
344.         (".//a[@class='reference internal'][@href='#cmdoption-git-commit-p']/code/span",
345.          '-p'),
346.     ],
347.     'index.html': [
348.         (".//meta[@name='hc'][@content='hcval']", ''),
349.         (".//meta[@name='hc_co'][@content='hcval_co']", ''),
350.         (".//dt[@class='label']/span[@class='brackets']", r'Ref1'),
351.         (".//dt[@class='label']", ''),
352.         (".//li[@class='toctree-l1']/a", 'Testing various markup'),
353.         (".//li[@class='toctree-l2']/a", 'Inline markup'),
354.         (".//title", 'Sphinx <Tests>'),
355.         (".//div[@class='footer']", 'Georg Brandl & Team'),
356.         (".//a[@href='http://python.org/']"
357.          "[@class='reference external']", ''),
358.         (".//li/p/a[@href='genindex.html']/span", 'Index'),
359.         (".//li/p/a[@href='py-modindex.html']/span", 'Module Index'),
360.         # custom sidebar only for contents
361.         (".//h4", 'Contents sidebar'),
362.         # custom JavaScript
363.         (".//script[@src='file://moo.js']", ''),
364.         # URL in contents
365.         (".//a[@class='reference external'][@href='http://sphinx-doc.org/']",
366.          'http://sphinx-doc.org/'),
367.         (".//a[@class='reference external'][@href='http://sphinx-doc.org/latest/']",
368.          'Latest reference'),
369.         # Indirect hyperlink targets across files
370.         (".//a[@href='markup.html#some-label'][@class='reference internal']/span",
371.          '^indirect hyperref$'),
372.     ],
373.     'bom.html': [
374.         (".//title", " File with UTF-8 BOM"),
375.     ],
376.     'extensions.html': [
377.         (".//a[@href='http://python.org/dev/']", "http://python.org/dev/"),
378.         (".//a[@href='http://bugs.python.org/issue1000']", "issue 1000"),
379.         (".//a[@href='http://bugs.python.org/issue1042']", "explicit caption"),
380.     ],
381.     'genindex.html': [
382.         # index entries
383.         (".//a/strong", "Main"),
384.         (".//a/strong", "[1]"),
385.         (".//a/strong", "Other"),
386.         (".//a", "entry"),
387.         (".//li/a", "double"),
388.     ],
389.     'footnote.html': [
390.         (".//a[@class='footnote-reference brackets'][@href='#id9'][@id='id1']", r"1"),
391.         (".//a[@class='footnote-reference brackets'][@href='#id10'][@id='id2']", r"2"),
392.         (".//a[@class='footnote-reference brackets'][@href='#foo'][@id='id3']", r"3"),
393.         (".//a[@class='reference internal'][@href='#bar'][@id='id4']/span", r"\[bar\]"),
394.         (".//a[@class='reference internal'][@href='#baz-qux'][@id='id5']/span", r"\[baz_qux\]"),
395.         (".//a[@class='footnote-reference brackets'][@href='#id11'][@id='id6']", r"4"),
396.         (".//a[@class='footnote-reference brackets'][@href='#id12'][@id='id7']", r"5"),
397.         (".//a[@class='fn-backref'][@href='#id1']", r"1"),
398.         (".//a[@class='fn-backref'][@href='#id2']", r"2"),
399.         (".//a[@class='fn-backref'][@href='#id3']", r"3"),
400.         (".//a[@class='fn-backref'][@href='#id4']", r"bar"),
401.         (".//a[@class='fn-backref'][@href='#id5']", r"baz_qux"),
402.         (".//a[@class='fn-backref'][@href='#id6']", r"4"),
403.         (".//a[@class='fn-backref'][@href='#id7']", r"5"),
404.         (".//a[@class='fn-backref'][@href='#id8']", r"6"),
405.     ],
406.     'otherext.html': [
407.         (".//h1", "Generated section"),
408.         (".//a[@href='_sources/otherext.foo.txt']", ''),
409.     ]
410. }))
411. @pytest.mark.skipif(docutils.__version_info__ < (0, 13),
412.                     reason='docutils-0.13 or above is required')
413. @pytest.mark.sphinx('html', tags=['testtag'],
414.                     confoverrides={'html_context.hckey_co': 'hcval_co'})
415. @pytest.mark.test_params(shared_result='test_build_html_output')
416. def test_html5_output(app, cached_etree_parse, fname, expect):
417.     app.build()
418.     print(app.outdir / fname)
419.     check_xpath(cached_etree_parse(app.outdir / fname), fname, *expect)
420. 
421. 
422. @pytest.mark.skipif(docutils.__version_info__ < (0, 13),
423.                     reason='docutils-0.13 or above is required')
424. @pytest.mark.sphinx('html')
425. @pytest.mark.test_params(shared_result='test_build_html_output')
426. def test_html_download(app):
427.     app.build()
428. 
429.     # subdir/includes.html
430.     result = (app.outdir / 'subdir' / 'includes.html').read_text()
431.     pattern = ('<a class="reference download internal" download="" '
432.                'href="../(_downloads/.*/img.png)">')
433.     matched = re.search(pattern, result)
434.     assert matched
435.     assert (app.outdir / matched.group(1)).exists()
436.     filename = matched.group(1)
437. 
438.     # includes.html
439.     result = (app.outdir / 'includes.html').read_text()
440.     pattern = ('<a class="reference download internal" download="" '
441.                'href="(_downloads/.*/img.png)">')
442.     matched = re.search(pattern, result)
443.     assert matched
444.     assert (app.outdir / matched.group(1)).exists()
445.     assert matched.group(1) == filename
446. 
447. 
448. @pytest.mark.skipif(docutils.__version_info__ < (0, 13),
449.                     reason='docutils-0.13 or above is required')
450. @pytest.mark.sphinx('html', testroot='roles-download')
451. def test_html_download_role(app, status, warning):
452.     app.build()
453.     digest = md5(b'dummy.dat').hexdigest()
454.     assert (app.outdir / '_downloads' / digest / 'dummy.dat').exists()
455.     digest_another = md5(b'another/dummy.dat').hexdigest()
456.     assert (app.outdir / '_downloads' / digest_another / 'dummy.dat').exists()
457. 
458.     content = (app.outdir / 'index.html').read_text()
459.     assert (('<li><p><a class="reference download internal" download="" '
460.              'href="_downloads/%s/dummy.dat">'
461.              '<code class="xref download docutils literal notranslate">'
462.              '<span class="pre">dummy.dat</span></code></a></p></li>' % digest)
463.             in content)
464.     assert (('<li><p><a class="reference download internal" download="" '
465.              'href="_downloads/%s/dummy.dat">'
466.              '<code class="xref download docutils literal notranslate">'
467.              '<span class="pre">another/dummy.dat</span></code></a></p></li>' %
468.              digest_another) in content)
469.     assert ('<li><p><code class="xref download docutils literal notranslate">'
470.             '<span class="pre">not_found.dat</span></code></p></li>' in content)
471.     assert ('<li><p><a class="reference download external" download="" '
472.             'href="http://www.sphinx-doc.org/en/master/_static/sphinxheader.png">'
473.             '<code class="xref download docutils literal notranslate">'
474.             '<span class="pre">Sphinx</span> <span class="pre">logo</span>'
475.             '</code></a></p></li>' in content)
476. 
477. 
478. @pytest.mark.sphinx('html', testroot='build-html-translator')
479. def test_html_translator(app):
480.     app.build()
481.     assert app.builder.docwriter.visitor.depart_with_node == 10
482. 
483. 
484. @pytest.mark.parametrize("fname,expect", flat_dict({
485.     'index.html': [
486.         (".//li[@class='toctree-l3']/a", '1.1.1. Foo A1', True),
487.         (".//li[@class='toctree-l3']/a", '1.2.1. Foo B1', True),
488.         (".//li[@class='toctree-l3']/a", '2.1.1. Bar A1', False),
489.         (".//li[@class='toctree-l3']/a", '2.2.1. Bar B1', False),
490.     ],
491.     'foo.html': [
492.         (".//h1", 'Foo', True),
493.         (".//h2", 'Foo A', True),
494.         (".//h3", 'Foo A1', True),
495.         (".//h2", 'Foo B', True),
496.         (".//h3", 'Foo B1', True),
497. 
498.         (".//h1//span[@class='section-number']", '1. ', True),
499.         (".//h2//span[@class='section-number']", '1.1. ', True),
500.         (".//h3//span[@class='section-number']", '1.1.1. ', True),


File: tests/test_directive_other.py
Line number range: 1 - 158
Content:
1. """
2.     test_directive_other
3.     ~~~~~~~~~~~~~~~~~~~~
4. 
5.     Test the other directives.
6. 
7.     :copyright: Copyright 2007-2020 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import pytest
12. from docutils import nodes
13. 
14. from sphinx import addnodes
15. from sphinx.testing import restructuredtext
16. from sphinx.testing.util import assert_node
17. 
18. 
19. @pytest.mark.sphinx(testroot='toctree-glob')
20. def test_toctree(app):
21.     text = (".. toctree::\n"
22.             "\n"
23.             "   foo\n"
24.             "   bar/index\n"
25.             "   baz\n")
26. 
27.     app.env.find_files(app.config, app.builder)
28.     doctree = restructuredtext.parse(app, text, 'index')
29.     assert_node(doctree, [nodes.document, nodes.compound, addnodes.toctree])
30.     assert_node(doctree[0][0],
31.                 entries=[(None, 'foo'), (None, 'bar/index'), (None, 'baz')],
32.                 includefiles=['foo', 'bar/index', 'baz'])
33. 
34. 
35. @pytest.mark.sphinx(testroot='toctree-glob')
36. def test_relative_toctree(app):
37.     text = (".. toctree::\n"
38.             "\n"
39.             "   bar_1\n"
40.             "   bar_2\n"
41.             "   bar_3\n"
42.             "   ../quux\n")
43. 
44.     app.env.find_files(app.config, app.builder)
45.     doctree = restructuredtext.parse(app, text, 'bar/index')
46.     assert_node(doctree, [nodes.document, nodes.compound, addnodes.toctree])
47.     assert_node(doctree[0][0],
48.                 entries=[(None, 'bar/bar_1'), (None, 'bar/bar_2'), (None, 'bar/bar_3'),
49.                          (None, 'quux')],
50.                 includefiles=['bar/bar_1', 'bar/bar_2', 'bar/bar_3', 'quux'])
51. 
52. 
53. @pytest.mark.sphinx(testroot='toctree-glob')
54. def test_toctree_urls_and_titles(app):
55.     text = (".. toctree::\n"
56.             "\n"
57.             "   Sphinx <https://www.sphinx-doc.org/>\n"
58.             "   https://readthedocs.org/\n"
59.             "   The BAR <bar/index>\n")
60. 
61.     app.env.find_files(app.config, app.builder)
62.     doctree = restructuredtext.parse(app, text, 'index')
63.     assert_node(doctree, [nodes.document, nodes.compound, addnodes.toctree])
64.     assert_node(doctree[0][0],
65.                 entries=[('Sphinx', 'https://www.sphinx-doc.org/'),
66.                          (None, 'https://readthedocs.org/'),
67.                          ('The BAR', 'bar/index')],
68.                 includefiles=['bar/index'])
69. 
70. 
71. @pytest.mark.sphinx(testroot='toctree-glob')
72. def test_toctree_glob(app):
73.     text = (".. toctree::\n"
74.             "   :glob:\n"
75.             "\n"
76.             "   *\n")
77. 
78.     app.env.find_files(app.config, app.builder)
79.     doctree = restructuredtext.parse(app, text, 'index')
80.     assert_node(doctree, [nodes.document, nodes.compound, addnodes.toctree])
81.     assert_node(doctree[0][0],
82.                 entries=[(None, 'baz'), (None, 'foo'), (None, 'quux')],
83.                 includefiles=['baz', 'foo', 'quux'])
84. 
85.     # give both docname and glob (case1)
86.     text = (".. toctree::\n"
87.             "   :glob:\n"
88.             "\n"
89.             "   foo\n"
90.             "   *\n")
91. 
92.     app.env.find_files(app.config, app.builder)
93.     doctree = restructuredtext.parse(app, text, 'index')
94.     assert_node(doctree, [nodes.document, nodes.compound, addnodes.toctree])
95.     assert_node(doctree[0][0],
96.                 entries=[(None, 'foo'), (None, 'baz'), (None, 'quux')],
97.                 includefiles=['foo', 'baz', 'quux'])
98. 
99.     # give both docname and glob (case2)
100.     text = (".. toctree::\n"
101.             "   :glob:\n"
102.             "\n"
103.             "   *\n"
104.             "   foo\n")
105. 
106.     app.env.find_files(app.config, app.builder)
107.     doctree = restructuredtext.parse(app, text, 'index')
108.     assert_node(doctree, [nodes.document, nodes.compound, addnodes.toctree])
109.     assert_node(doctree[0][0],
110.                 entries=[(None, 'baz'), (None, 'foo'), (None, 'quux'), (None, 'foo')],
111.                 includefiles=['baz', 'foo', 'quux', 'foo'])
112. 
113. 
114. @pytest.mark.sphinx(testroot='toctree-glob')
115. def test_toctree_glob_and_url(app):
116.     text = (".. toctree::\n"
117.             "   :glob:\n"
118.             "\n"
119.             "   https://example.com/?q=sphinx\n")
120. 
121.     app.env.find_files(app.config, app.builder)
122.     doctree = restructuredtext.parse(app, text, 'index')
123.     assert_node(doctree, [nodes.document, nodes.compound, addnodes.toctree])
124.     assert_node(doctree[0][0],
125.                 entries=[(None, 'https://example.com/?q=sphinx')],
126.                 includefiles=[])
127. 
128. 
129. @pytest.mark.sphinx(testroot='toctree-glob')
130. def test_reversed_toctree(app):
131.     text = (".. toctree::\n"
132.             "   :reversed:\n"
133.             "\n"
134.             "   foo\n"
135.             "   bar/index\n"
136.             "   baz\n")
137. 
138.     app.env.find_files(app.config, app.builder)
139.     doctree = restructuredtext.parse(app, text, 'index')
140.     assert_node(doctree, [nodes.document, nodes.compound, addnodes.toctree])
141.     assert_node(doctree[0][0],
142.                 entries=[(None, 'baz'), (None, 'bar/index'), (None, 'foo')],
143.                 includefiles=['baz', 'bar/index', 'foo'])
144. 
145. 
146. @pytest.mark.sphinx(testroot='toctree-glob')
147. def test_toctree_twice(app):
148.     text = (".. toctree::\n"
149.             "\n"
150.             "   foo\n"
151.             "   foo\n")
152. 
153.     app.env.find_files(app.config, app.builder)
154.     doctree = restructuredtext.parse(app, text, 'index')
155.     assert_node(doctree, [nodes.document, nodes.compound, addnodes.toctree])
156.     assert_node(doctree[0][0],
157.                 entries=[(None, 'foo'), (None, 'foo')],
158.                 includefiles=['foo', 'foo'])


File: tests/test_roles.py
Line number range: 1 - 83
Content:
1. """
2.     test_roles
3.     ~~~~~~~~~~
4. 
5.     Test sphinx.roles
6. 
7.     :copyright: Copyright 2007-2020 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. from unittest.mock import Mock
12. 
13. from docutils import nodes
14. 
15. from sphinx.roles import EmphasizedLiteral
16. from sphinx.testing.util import assert_node
17. 
18. 
19. def test_samp():
20.     emph_literal_role = EmphasizedLiteral()
21. 
22.     # normal case
23.     text = 'print 1+{variable}'
24.     ret, msg = emph_literal_role('samp', text, text, 0, Mock())
25.     assert_node(ret[0], [nodes.literal, ("print 1+",
26.                                          [nodes.emphasis, "variable"])])
27.     assert msg == []
28. 
29.     # two emphasis items
30.     text = 'print {1}+{variable}'
31.     ret, msg = emph_literal_role('samp', text, text, 0, Mock())
32.     assert_node(ret[0], [nodes.literal, ("print ",
33.                                          [nodes.emphasis, "1"],
34.                                          "+",
35.                                          [nodes.emphasis, "variable"])])
36.     assert msg == []
37. 
38.     # empty curly brace
39.     text = 'print 1+{}'
40.     ret, msg = emph_literal_role('samp', text, text, 0, Mock())
41.     assert_node(ret[0], [nodes.literal, "print 1+{}"])
42.     assert msg == []
43. 
44.     # half-opened variable
45.     text = 'print 1+{variable'
46.     ret, msg = emph_literal_role('samp', text, text, 0, Mock())
47.     assert_node(ret[0], [nodes.literal, "print 1+{variable"])
48.     assert msg == []
49. 
50.     # nested
51.     text = 'print 1+{{variable}}'
52.     ret, msg = emph_literal_role('samp', text, text, 0, Mock())
53.     assert_node(ret[0], [nodes.literal, ("print 1+",
54.                                          [nodes.emphasis, "{variable"],
55.                                          "}")])
56.     assert msg == []
57. 
58.     # emphasized item only
59.     text = '{variable}'
60.     ret, msg = emph_literal_role('samp', text, text, 0, Mock())
61.     assert_node(ret[0], [nodes.literal, nodes.emphasis, "variable"])
62.     assert msg == []
63. 
64.     # escaping
65.     text = r'print 1+\{variable}'
66.     ret, msg = emph_literal_role('samp', text, text, 0, Mock())
67.     assert_node(ret[0], [nodes.literal, "print 1+{variable}"])
68.     assert msg == []
69. 
70.     # escaping (2)
71.     text = r'print 1+\{{variable}\}'
72.     ret, msg = emph_literal_role('samp', text, text, 0, Mock())
73.     assert_node(ret[0], [nodes.literal, ("print 1+{",
74.                                          [nodes.emphasis, "variable"],
75.                                          "}")])
76.     assert msg == []
77. 
78.     # escape a backslash
79.     text = r'print 1+\\{variable}'
80.     ret, msg = emph_literal_role('samp', text, text, 0, Mock())
81.     assert_node(ret[0], [nodes.literal, ("print 1+\\",
82.                                          [nodes.emphasis, "variable"])])
83.     assert msg == []

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-24 19:57:54,638 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="1. Query requirement analysis:\n   - The user explicitly asked for the full content of `tests/test_build_html.py`.\n\n2. Extended relevance:\n   - This file is crucial for the user's purpose of finding existing test patterns for verifying local file links. It contains tests for the HTML builder, which handles the final output of links and file references.", relative_path='tests/test_build_html.py', start_line=1, end_line=500), ContextOutput(reasoning="1. Query requirement analysis:\n   - The user explicitly asked for the full content of `tests/test_directive_other.py`.\n\n2. Extended relevance:\n   - This file is highly relevant as it contains tests for directives like `toctree`, which often involve local file references. This directly aligns with the user's goal of finding test patterns for local file links.", relative_path='tests/test_directive_other.py', start_line=1, end_line=158), ContextOutput(reasoning='1. Query requirement analysis:\n   - The user explicitly asked for the full content of `tests/test_roles.py`.\n\n2. Extended relevance:\n   - This file is relevant because roles can also reference local files. Examining tests for roles will help the user understand how to verify such links, which is part of their core task.', relative_path='tests/test_roles.py', start_line=1, end_line=83)]
2025-12-24 19:57:54,641 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 3 contexts to memory for query: Please provide the full content of `tests/test_directive_other.py`, `tests/test_roles.py`, and `tests/test_build_html.py`.
2025-12-24 19:57:54,642 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-24 19:57:54,642 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-24 19:57:54,643 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 3 new contexts to 5 existing contexts
2025-12-24 19:57:54,643 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 8 total contexts (removed 0 duplicates)
2025-12-24 19:57:54,643 - thread-128178285696704.prometheus_context_collector.lang_graph.nodes.context_refine_node - INFO - Reached max_refined_query_loop, not asking for more context
2025-12-24 19:57:54,644 - thread-128178285696704.prometheus_context_collector - INFO - Successfully retrieved 8 context snippets
