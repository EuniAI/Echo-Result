2025-12-24 05:46:33,042 - thread-125239516182208.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: ModelAdmin.lookup_allowed() incorrectly raises DisallowedModelAdminLookup lookup with foreign key as primary key

Description: Description
	 
		(last modified by Tim Graham)
	 
Wrote a failing test for tests/modeladmin/tests.py to demonstrate - same test/code passes on 1.8
@isolate_apps('modeladmin')
def test_lookup_allowed_foreign_primary(self):
	class Country(models.Model):
		name = models.CharField(max_length=256)
	class Place(models.Model):
		country = models.ForeignKey(Country, models.CASCADE)
	class Restaurant(models.Model):
		place = models.OneToOneField(Place, models.CASCADE, primary_key=True)
	class Waiter(models.Model):
		restaurant = models.ForeignKey(Restaurant, models.CASCADE)
	class WaiterAdmin(ModelAdmin):
		list_filter = [
			'restaurant__place__country',
		]
	ma = WaiterAdmin(Waiter, self.site)
	self.assertIs(ma.lookup_allowed('restaurant__place__country', 'test_value'), True)
I think this is caused by the admin thinking that having a foreign key field as a primary key is the same as concrete inheritance. So when you try and check lookups for restaurant__place__country it thinks 'place' is the concrete parent of 'restaurant' and shortcuts it to restaurant__country which isn't in 'list_filter'. And you can't add restaurant__country to list_filter because country isn't actually on restaurant.

Patch information:
diff --git a/django/contrib/admin/options.py b/django/contrib/admin/options.py
index 5240b07cd6..b7b639d0c8 100644
--- a/django/contrib/admin/options.py
+++ b/django/contrib/admin/options.py
@@ -464,9 +464,17 @@ class BaseModelAdmin(metaclass=forms.MediaDefiningClass):
             # It is allowed to filter on values that would be found from local
             # model anyways. For example, if you filter on employee__department__id,
             # then the id value would be found already from employee__department_id.
-            if not prev_field or (
-                prev_field.is_relation
-                and field not in prev_field.path_infos[-1].target_fields
+            # However, if the target field is itself relational (e.g., a OneToOneField
+            # used as a primary key), don't collapse that step.
+            if (
+                not prev_field
+                or (
+                    prev_field.is_relation
+                    and (
+                        field not in prev_field.path_infos[-1].target_fields
+                        or getattr(field, "is_relation", False)
+                    )
+                )
             ):
                 relation_parts.append(part)
             if not getattr(field, "path_infos", None):


Find all relevant source code context needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

2025-12-24 05:46:33,142 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .github
|   ├── CODE_OF_CONDUCT.md
|   ├── FUNDING.yml
|   ├── SECURITY.md
|   └── workflows
|       ├── benchmark.yml
|       ├── docs.yml
|       ├── linters.yml
|       ├── new_contributor_pr.yml
|       ├── schedule_tests.yml
|       ├── schedules.yml
|       └── tests.yml
├── .pre-commit-config.yaml
├── .readthedocs.yml
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ar_DZ
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ckb
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ig
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ky
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ms
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uz
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   ├── 0012_alter_user_first_name_max_length.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   └── options.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── constraints.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── ms
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── tg
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── uz
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_redirect_new_path_help_text.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── templates
|   |   |   |   ├── sitemap.xml
|   |   |   |   └── sitemap_index.xml
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── asgi.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   ├── memcached.py
|   |   |   |   └── redis.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── async_checks.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   ├── __init__.py
|   |   |   |   └── django_4_0.py
|   |   |   ├── database.py
|   |   |   ├── files.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── filesystem.py
|   |   |   |   ├── handler.py
|   |   |   |   ├── memory.py
|   |   |   |   └── mixins.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── asgi.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── __init__.py
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── optimizemigration.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── jsonl.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── psycopg_any.py
|   |   |   |   └── schema.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _functions.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   └── special.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── enums.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── json.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── autoreload.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── asyncio.py
|   |   ├── autoreload.py
|   |   ├── cache.py
|   |   ├── connection.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── common.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           ├── csrf_403.html
|           ├── default_urlconf.html
|           ├── directory_index.html
|           ├── i18n_catalog.js
|           ├── technical_404.html
|           ├── technical_500.html
|           └── technical_500.txt
├── docs
|   ├── README.rst
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   ├── genindex.html
|   |   |   ├── layout.html
|   |   |   ├── modindex.html
|   |   |   ├── search.html
|   |   |   └── static
|   |   |       ├── console-tabs.css
|   |   |       ├── default.css
|   |   |       ├── djangodocs.css
|   |   |       ├── fontawesome
|   |   |       ├── homepage.css
|   |   |       └── reset-fonts-grids.css
|   |   └── djangodocs-epub
|   |       ├── epub-cover.html
|   |       └── static
|   |           └── epub.css
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── _images
|   |   ├── auth-remote-user.txt
|   |   ├── csrf.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-backend.txt
|   |   ├── custom-template-tags.txt
|   |   ├── deployment
|   |   |   ├── asgi
|   |   |   |   ├── daphne.txt
|   |   |   |   ├── hypercorn.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── uvicorn.txt
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── legacy-databases.txt
|   |   ├── logging.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   ├── tutorial08.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── filters.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── constraints.txt
|   |   |   |   ├── expressions.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── logging.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── paginator.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.19.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.20.txt
|   |   ├── 1.11.21.txt
|   |   ├── 1.11.22.txt
|   |   ├── 1.11.23.txt
|   |   ├── 1.11.24.txt
|   |   ├── 1.11.25.txt
|   |   ├── 1.11.26.txt
|   |   ├── 1.11.27.txt
|   |   ├── 1.11.28.txt
|   |   ├── 1.11.29.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.11.txt
|   |   ├── 2.0.12.txt
|   |   ├── 2.0.13.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.10.txt
|   |   ├── 2.1.11.txt
|   |   ├── 2.1.12.txt
|   |   ├── 2.1.13.txt
|   |   ├── 2.1.14.txt
|   |   ├── 2.1.15.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.7.txt
|   |   ├── 2.1.8.txt
|   |   ├── 2.1.9.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.1.txt
|   |   ├── 2.2.10.txt
|   |   ├── 2.2.11.txt
|   |   ├── 2.2.12.txt
|   |   ├── 2.2.13.txt
|   |   ├── 2.2.14.txt
|   |   ├── 2.2.15.txt
|   |   ├── 2.2.16.txt
|   |   ├── 2.2.17.txt
|   |   ├── 2.2.18.txt
|   |   ├── 2.2.19.txt
|   |   ├── 2.2.2.txt
|   |   ├── 2.2.20.txt
|   |   ├── 2.2.21.txt
|   |   ├── 2.2.22.txt
|   |   ├── 2.2.23.txt
|   |   ├── 2.2.24.txt
|   |   ├── 2.2.25.txt
|   |   ├── 2.2.26.txt
|   |   ├── 2.2.27.txt
|   |   ├── 2.2.28.txt
|   |   ├── 2.2.3.txt
|   |   ├── 2.2.4.txt
|   |   ├── 2.2.5.txt
|   |   ├── 2.2.6.txt
|   |   ├── 2.2.7.txt
|   |   ├── 2.2.8.txt
|   |   ├── 2.2.9.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.1.txt
|   |   ├── 3.0.10.txt
|   |   ├── 3.0.11.txt
|   |   ├── 3.0.12.txt
|   |   ├── 3.0.13.txt
|   |   ├── 3.0.14.txt
|   |   ├── 3.0.2.txt
|   |   ├── 3.0.3.txt
|   |   ├── 3.0.4.txt
|   |   ├── 3.0.5.txt
|   |   ├── 3.0.6.txt
|   |   ├── 3.0.7.txt
|   |   ├── 3.0.8.txt
|   |   ├── 3.0.9.txt
|   |   ├── 3.0.txt
|   |   ├── 3.1.1.txt
|   |   ├── 3.1.10.txt
|   |   ├── 3.1.11.txt
|   |   ├── 3.1.12.txt
|   |   ├── 3.1.13.txt
|   |   ├── 3.1.14.txt
|   |   ├── 3.1.2.txt
|   |   ├── 3.1.3.txt
|   |   ├── 3.1.4.txt
|   |   ├── 3.1.5.txt
|   |   ├── 3.1.6.txt
|   |   ├── 3.1.7.txt
|   |   ├── 3.1.8.txt
|   |   ├── 3.1.9.txt
|   |   ├── 3.1.txt
|   |   ├── 3.2.1.txt
|   |   ├── 3.2.10.txt
|   |   ├── 3.2.11.txt
|   |   ├── 3.2.12.txt
|   |   ├── 3.2.13.txt
|   |   ├── 3.2.14.txt
|   |   ├── 3.2.15.txt
|   |   ├── 3.2.16.txt
|   |   ├── 3.2.17.txt
|   |   ├── 3.2.18.txt
|   |   ├── 3.2.2.txt
|   |   ├── 3.2.3.txt
|   |   ├── 3.2.4.txt
|   |   ├── 3.2.5.txt
|   |   ├── 3.2.6.txt
|   |   ├── 3.2.7.txt
|   |   ├── 3.2.8.txt
|   |   ├── 3.2.9.txt
|   |   ├── 3.2.txt
|   |   ├── 4.0.1.txt
|   |   ├── 4.0.10.txt
|   |   ├── 4.0.2.txt
|   |   ├── 4.0.3.txt
|   |   ├── 4.0.4.txt
|   |   ├── 4.0.5.txt
|   |   ├── 4.0.6.txt
|   |   ├── 4.0.7.txt
|   |   ├── 4.0.8.txt
|   |   ├── 4.0.9.txt
|   |   ├── 4.0.txt
|   |   ├── 4.1.1.txt
|   |   ├── 4.1.2.txt
|   |   ├── 4.1.3.txt
|   |   ├── 4.1.4.txt
|   |   ├── 4.1.5.txt
|   |   ├── 4.1.6.txt
|   |   ├── 4.1.7.txt
|   |   ├── 4.1.8.txt
|   |   ├── 4.1.txt
|   |   ├── 4.2.txt
|   |   ├── 5.0.txt
|   |   ├── index.txt
|   |   └── security.txt
|   ├── requirements.txt
|   └── topics
|       ├── async.txt
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── fixtures.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   ├── jsi18n-mocks.test.js
|   |   └── navigation.test.js
|   ├── gis
|   |   └── mapwidget.test.js
|   └── tests.html
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_dynamic_settings_manage.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── .hidden
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       ├── noargs_command.py
    |   |       └── suppress_base_options_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── admin
    |   |   |   ├── admin_views
    |   |   |   └── base_site.html
    |   |   └── custom_filter_template.html
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_breadcrumbs.py
    |   ├── test_forms.py
    |   ├── test_history_view.py
    |   ├── test_multidb.py
    |   ├── test_nav_sidebar.py
    |   ├── test_skip_link_to_content.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   ├── no_config_app
    |   |   └── __init__.py
    |   ├── one_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── tests.py
    |   ├── two_configs_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── two_configs_one_default_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   └── two_default_configs_app
    |       ├── __init__.py
    |       └── apps.py
    ├── asgi
    |   ├── __init__.py
    |   ├── project
    |   |   └── static
    |   |       └── file.txt
    |   ├── tests.py
    |   └── urls.py
    ├── async
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_async_model_methods.py
    |   ├── test_async_queryset.py
    |   ├── test_async_related_managers.py
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   ├── with_last_login_attr.py
    |   |   ├── with_many_to_many.py
    |   |   └── with_unique_constraint.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   |   ├── auth_attrs_access.html
    |   |   |   ├── auth_attrs_messages.html
    |   |   |   ├── auth_attrs_no_access.html
    |   |   |   ├── auth_attrs_perm_in_perms.html
    |   |   |   ├── auth_attrs_perms.html
    |   |   |   ├── auth_attrs_test_access.html
    |   |   |   └── auth_attrs_user.html
    |   |   └── registration
    |   |       ├── html_password_reset_email.html
    |   |       ├── logged_out.html
    |   |       ├── login.html
    |   |       ├── password_change_form.html
    |   |       ├── password_reset_complete.html
    |   |       ├── password_reset_confirm.html
    |   |       ├── password_reset_done.html
    |   |       ├── password_reset_email.html
    |   |       ├── password_reset_form.html
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_remote_user.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── app_unmigrated
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── test_base.py
    |   |   ├── test_client.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_functions.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   ├── tests.py
    |   └── tests_async.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── template_test_apps
    |   |   ├── __init__.py
    |   |   ├── different_tags_app
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   ├── same_tags_app_1
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   └── same_tags_app_2
    |   |       ├── __init__.py
    |   |       ├── apps.py
    |   |       └── templatetags
    |   ├── test_4_0_compatibility.py
    |   ├── test_async_checks.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_files.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_class_based_error_handlers.py
    |       ├── bad_error_handlers_invalid_path.py
    |       ├── bad_function_based_error_handlers.py
    |       ├── beginning_with_slash.py
    |       ├── cbv_as_view.py
    |       ├── contains_tuple.py
    |       ├── good_class_based_error_handlers.py
    |       ├── good_function_based_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   └── ending_with_dollar.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_migrations.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   |       ├── debug.html
    |   |       └── request_attrs.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_collate.py
    |   |   ├── test_greatest.py
    |   |   ├── test_json_object.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_random.py
    |   |   ├── test_round.py
    |   |   ├── test_sign.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_md5.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_sha1.py
    |   |   ├── test_sha224.py
    |   |   ├── test_sha256.py
    |   |   ├── test_sha384.py
    |   |   ├── test_sha512.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── fake_client.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   ├── test_postgresql.py
    |   ├── test_sqlite.py
    |   └── tests.py
    ├── decorators
    |   ├── __init__.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   ├── test_middleware_mixin.py
    |   ├── test_storages.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── empty_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── test_commands.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── test_inmemory_storage.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── fixture2.xml
    |   |   ├── fixture3.xml
    |   |   ├── fixture7.xml
    |   |   └── fixture9.xml
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── animal.xml
    |   |   ├── bad_fixture2.xml
    |   |   ├── nk-inheritance2.xml
    |   |   ├── non_natural_2.xml
    |   |   ├── pretty.xml
    |   |   └── sequence_extra_xml.xml
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── absolute_urls.py
    |   ├── no_slash_urls.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   |   └── default.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_jsonfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   |       └── custom_widget.html
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   |       ├── article_form.html
    |   |       ├── custom_field.html
    |   |       ├── custom_widget.html
    |   |       ├── cyclic_context_boundfield_render.html
    |   |       ├── error.html
    |   |       ├── form_snippet.html
    |   |       ├── legend_test.html
    |   |       └── use_fieldset.html
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   └── tags.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   |       └── using.html
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   ├── about.html
    |   |   |   ├── apple_detail.html
    |   |   |   ├── artist_detail.html
    |   |   |   ├── artist_form.html
    |   |   |   ├── author_confirm_delete.html
    |   |   |   ├── author_detail.html
    |   |   |   ├── author_form.html
    |   |   |   ├── author_list.html
    |   |   |   ├── author_objects.html
    |   |   |   ├── author_view.html
    |   |   |   ├── book_archive.html
    |   |   |   ├── book_archive_day.html
    |   |   |   ├── book_archive_month.html
    |   |   |   ├── book_archive_week.html
    |   |   |   ├── book_archive_year.html
    |   |   |   ├── book_detail.html
    |   |   |   ├── book_list.html
    |   |   |   ├── confirm_delete.html
    |   |   |   ├── detail.html
    |   |   |   ├── form.html
    |   |   |   ├── list.html
    |   |   |   ├── page_template.html
    |   |   |   ├── robots.txt
    |   |   |   └── using.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── has_nulls
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   ├── test_srs.py
    |   |   └── tests.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_indexes.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_create_models.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_rastermodels.py
    |   |   |   └── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   |   └── test_handler.html
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   |   └── ignored.html
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   |   └── media_ignored.html
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   ├── javascript_ignored.js
    |   |   |   └── static_ignored.html
    |   |   └── templates
    |   |       ├── empty.html
    |   |       ├── subdir
    |   |       ├── test.html
    |   |       └── xxx_ignored.html
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── loading
    |   |   ├── en
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_AU
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_CA
    |   |   |   └── LC_MESSAGES
    |   |   └── en_NZ
    |   |       └── LC_MESSAGES
    |   ├── loading_app
    |   |   ├── __init__.py
    |   |   ├── apps.py
    |   |   └── locale
    |   |       └── en
    |   ├── models.py
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   |   ├── 404.html
    |   |   |   └── dummy.html
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── models.py
    |   |   |   └── test.html
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   |   └── percents.html
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── unchanged
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   ├── tests.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_fake_initial_case_insensitive
    |   |   ├── fake_initial
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── initial
    |   |       ├── 0001_initial.py
    |   |       └── __init__.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_conflict_long_name
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second_migration_with_long_name.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_manual_porting
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   └── __init__.py
    |   ├── test_migrations_namespace_package
    |   |   └── 0001_initial.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_no_operations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_noop
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   ├── 0005_fifth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_no_replaces
    |   |   ├── 0001_squashed_0002.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_enums
    |   ├── __init__.py
    |   └── tests.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autofield.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_filepathfield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_jsonfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_pk.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── model_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── integration_settings.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_constraints.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_integration.py
    |   ├── test_introspection.py
    |   ├── test_operations.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_contains.py
    |   ├── test_db_returning.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   ├── test_sqlcompiler.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests_tests
    |   ├── __init__.py
    |   ├── test_accept_header.py
    |   ├── test_data_upload_settings.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_jsonl.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_clear_expired.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   |       └── using.html
    |   ├── templates
    |   |   └── shortcuts
    |   |       ├── render_test.html
    |   |       └── using.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── custom_sitemap.xml
    |   |   └── custom_sitemap_lastmod_index.xml
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   ├── test_management.py
    |   ├── test_utils.py
    |   └── urls
    |       ├── __init__.py
    |       ├── empty.py
    |       ├── http.py
    |       ├── https.py
    |       ├── index_only.py
    |       └── sitemap_only.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── absolute_root.css
    |   |   |   ├── absolute_root.js
    |   |   |   ├── cached
    |   |   |   ├── nested
    |   |   |   ├── styles_root.css
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   |   └── faulty.css
    |   |   ├── loop
    |   |   |   ├── bar.css
    |   |   |   └── foo.css
    |   |   ├── nonutf8
    |   |   |   └── nonutf8.css
    |   |   ├── pathlib
    |   |   |   └── pathlib.txt
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   |       ├── description.html
    |   |       ├── description_context.html
    |   |       ├── title.html
    |   |       └── title_context.html
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   |       └── hello.html
    |   ├── jinja2
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       ├── syntax_error.html
    |   |       ├── syntax_error2.html
    |   |       └── syntax_error_include.html
    |   ├── template_strings
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       └── syntax_error.html
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_loader
    |   |       ├── goodbye.html
    |   |       ├── hello.html
    |   |       └── request.html
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   |       └── using.html
    |   ├── other_templates
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   └── test_dirs.html
    |   ├── recursive_templates
    |   |   ├── fs
    |   |   |   ├── extend-missing.html
    |   |   |   ├── one.html
    |   |   |   ├── other-recursive.html
    |   |   |   ├── recursive.html
    |   |   |   ├── self.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── fs2
    |   |   |   └── recursive.html
    |   |   └── fs3
    |   |       └── recursive.html
    |   ├── relative_templates
    |   |   ├── dir1
    |   |   |   ├── dir2
    |   |   |   ├── looped.html
    |   |   |   ├── one.html
    |   |   |   ├── one1.html
    |   |   |   ├── one2.html
    |   |   |   ├── one3.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── error_extends.html
    |   |   ├── error_include.html
    |   |   ├── one.html
    |   |   ├── one_var.html
    |   |   ├── three.html
    |   |   └── two.html
    |   ├── syntax_tests
    |   |   ├── __init__.py
    |   |   ├── i18n
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: ModelAdmin.lookup_allowed() incorrectly raises DisallowedModelAdminLookup lookup with foreign key as primary key

Description: Description
	 
		(last modified by Tim Graham)
	 
Wrote a failing test for tests/modeladmin/tests.py to demonstrate - same test/code passes on 1.8
@isolate_apps('modeladmin')
def test_lookup_allowed_foreign_primary(self):
	class Country(models.Model):
		name = models.CharField(max_length=256)
	class Place(models.Model):
		country = models.ForeignKey(Country, models.CASCADE)
	class Restaurant(models.Model):
		place = models.OneToOneField(Place, models.CASCADE, primary_key=True)
	class Waiter(models.Model):
		restaurant = models.ForeignKey(Restaurant, models.CASCADE)
	class WaiterAdmin(ModelAdmin):
		list_filter = [
			'restaurant__place__country',
		]
	ma = WaiterAdmin(Waiter, self.site)
	self.assertIs(ma.lookup_allowed('restaurant__place__country', 'test_value'), True)
I think this is caused by the admin thinking that having a foreign key field as a primary key is the same as concrete inheritance. So when you try and check lookups for restaurant__place__country it thinks 'place' is the concrete parent of 'restaurant' and shortcuts it to restaurant__country which isn't in 'list_filter'. And you can't add restaurant__country to list_filter because country isn't actually on restaurant.

Patch information:
diff --git a/django/contrib/admin/options.py b/django/contrib/admin/options.py
index 5240b07cd6..b7b639d0c8 100644
--- a/django/contrib/admin/options.py
+++ b/django/contrib/admin/options.py
@@ -464,9 +464,17 @@ class BaseModelAdmin(metaclass=forms.MediaDefiningClass):
             # It is allowed to filter on values that would be found from local
             # model anyways. For example, if you filter on employee__department__id,
             # then the id value would be found already from employee__department_id.
-            if not prev_field or (
-                prev_field.is_relation
-                and field not in prev_field.path_infos[-1].target_fields
+            # However, if the target field is itself relational (e.g., a OneToOneField
+            # used as a primary key), don't collapse that step.
+            if (
+                not prev_field
+                or (
+                    prev_field.is_relation
+                    and (
+                        field not in prev_field.path_infos[-1].target_fields
+                        or getattr(field, "is_relation", False)
+                    )
+                )
             ):
                 relation_parts.append(part)
             if not getattr(field, "path_infos", None):


Find all relevant source code context needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-24 05:47:09,681 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to fix a bug in `ModelAdmin.lookup_allowed`. The provided patch targets `django/contrib/admin/options.py`. To understand the bug and the patch, I need to see the full implementation of the `lookup_allowed` method and its surrounding code within the `BaseModelAdmin` and `ModelAdmin` classes.' query='Please provide the full content of the file django/contrib/admin/options.py.' extra_requirements='' purpose='This file contains the `lookup_allowed` method that needs to be fixed, and having its full content is essential to understand the logic and apply the patch correctly.'
2025-12-24 05:47:09,682 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of the file django/contrib/admin/options.py.
2025-12-24 05:47:09,682 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-24 05:47:09,683 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-24 05:47:09,684 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-24 05:47:09,684 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of the file django/contrib/admin/options.py.
Purpose: This file contains the `lookup_allowed` method that needs to be fixed, and having its full content is essential to understand the logic and apply the patch correctly.
2025-12-24 05:47:12,032 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "django/contrib/admin/options.py"}'}, '__gemini_function_call_thought_signatures__': {'90ae9ee3-7dec-4b66-99f1-08c18b327ffd': 'CtMFAY89a1/Piu73ccY5nxXqKmK28JGG0WTIbtSWBbfITyUU+UVcwaIH4U3DbnxVtJ8zSuGTwMT2DAhQs3MWk8ZbSaKyPOlKgUGnV99nFJddYUsbetAbOt1q+hhpDLXX5PXtVTxOYXVJoNxTrJqOxZCnB+MtDM7BE++UoTBRxchaJsy9dd+BsoGLbKPNT+5OCo+TYnSyi7veRGCpWikTZ6sVHyTa2s7C0+jqFVajmycAl0cj8M6saNSjjT2aMxKS1hkQkQ3n9ZRtdxebeKZqcQznitsBQroGewM/D832jhPmkNAK1fwtiIaswUwu11rlfCvoUmXhvyAPCWyTrpFH9VrNHS41F51xbKBmbIDTfRL/AkkC6g0s4xY02kXlkjTz1wQiXUll+3z2GOyZ99x79VV6OiA2m0R/bj0yCHRojGcLd1FtZtl2Wb4Z5gYWrzvwLvuO7RsGQiGrirZVEOCR100V4AH18CVstFdiCjXos2MDesacFl/BKn0WYkhKmQpcDnCXUFS52UTfxrtLvNWkBhYeRRsvDVt9aLDNdkupc9XnIL4U7ID+zvf7srRxEwee5IuUD/BM+RZ9rBA0coACnJofMqLXbQDQL/ldlFXoTTLM6CIl8givhEeUj4S/7TquLUl+9F/3QYMifFipxg1qQI54/6i0ZGP1DSaO8ZQW2kZ2jqvB0nqXNbV+YUY1OxTJJraxSJax+M3Nr47h6w7ZfAiizVrA8zTWNjQn9yvw7oeVk0SrJgHW4ZaKPmJKbTQ7BzH8/5KdETqide2oQmea6wrEjpHYhsys/3Z48vZk9yvKSw4qST9xfIF8IGwYxJKuFpoS5nPcL3Wq1UTGW4cnqZzrwIQtWlUHPV4XkiraJvm+8sE/bROGTQyZ2q1sykX2OUPP61RVaeQ+nGWrRFDfjjeEH54HqddTX+d7v5+Pj+vL2a3tlS5naEY0WCPRBRDrL4BJSfSM'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2111, 'candidates_token_count': 23, 'total_token_count': 2302, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2111}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 23}], 'thoughts_token_count': 168, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.2691046673318614, 'model_name': 'gemini-2.5-pro'} id='run--fbe27327-94cf-444f-bd66-69852388bb0e-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'django/contrib/admin/options.py'}, 'id': '90ae9ee3-7dec-4b66-99f1-08c18b327ffd', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2111, 'output_tokens': 23, 'total_tokens': 2302, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 168}}
2025-12-24 05:47:16,625 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 501.0, "relative_path": "django/contrib/admin/options.py", "end_line": 2000.0}'}, '__gemini_function_call_thought_signatures__': {'e634dc45-61a4-4c80-a8e5-6a4d2cbea1a3': 'Cp4JAY89a1/AwmmpWwmk/CxRmzX1Hcw8YucE+g4LCMBznPfZxFCNoBBarRovA/tHz9evVkCLSrSBCngH71WlZ6nkRMKoLXS0SELw9sSS5UPXOm1De6u7LchX5Wa6BBkexeODLJTJxf7ZvlT2g0D49xdv4g29h77lBOz1CSUua7Zf5C0aiHkuu7r6huz/5fsm4tHmTqpqWGaIICgYtPxM4/3ohBz0TT9zLkJtPTjJFrY4F8t8a1+toYY3wd0dz4B7yzmIf/H0wLfo9ZAv0fkWNB7QfSXzd+QzWYRSS7l2BtS2yT66kZmcfiyJT3DEaQVG0XgX59LXBtVEzochqeWnb3YVqY6MZ7euWeXAX1LrTmozLOmyhrKC/XCoTMMtIHCH2ngls8n9U/DyQdQ1l5QDdJU0O+oeFC5wwEWdym7+fPPnJ1qU0Hr/O1aCYQOMFh+Eh1uSGgkYlOu/1GiDnQhhmYWT2C0fnbSKstdt4lMAGP3Jdi+xrssYQeHRbJbpUa4dLCQmLwnJd+sO4mesNaepNAE7ELquJUi4HbiSo7Eyrl9TyukKpTFxCjptmM2PDtq4bIV1ACH3a0+ER0pQ1sfXxUYnu+7Eq43G34Q0828Bs1X1vGzpmrhslqherkaqo5rFfqkGYdlSblXXRkPjY8cgi9mauEP4rPCkJ9lsg4W1d9Hjls9WD0ydDSfm4n8DrkL2RbSAf9kttdPiyWn6f5Ba82+0kvtlF2DSmxWumy9KD2807B/6hYcAYG1q+TOtOwKMAti0+kbQQ7w7OoucA61suo36WSM/ALlgPWEl2PnFGOYgaY2sEvBLe3U3DxefEqpweOyZDsMfkATBXHBH9sd5WOKtsEQycWdSy+q3DgJAFjSLO/TYlTeltwpP7PEqVU6NXlvX6zS6Sw2cmPVeOJgimVaIdsc2qlcpptN9TnK5vs11SQIVdNi4qtn+bopqjMj7n04omrJf5jn+Z/oeMEf7grwIheTMZRKck23eNlUSna980c8IPwKLpshD1g7GAz/XxWi/6H4Yr4r7GMehsWERVAje/pGeeQsVKofVmcMpSuBopqbveSVOXK9Mu1SDq3Fb168Nkx2tN1RQxKAzt6zjGRRBTqHSXspN46SyMDaZh8GE3XLOycRcRGUDLPRgMy+zpnTyRGZE+pdUFs6Sb2KKXvsTbAdRd1QMMTIY/IGmzcK48/osC1ButPLjUz5sGqxvawSqiNjFQRaE9ZCR1jZ7qbTOj2mpzpU/bz4tjztBDiEL/Zv1eL3Gw4UbsNEIbHBc0eG/VGrBznnZEKVqcxyYF4RW2o+Qq2zGISPSl4y8da8KPlyaQ7mXjbxbZpUgbHNqkAVS/U0rRXwM+hf7Pi4LFCiqZiSmqabM5rVx/52JzlCUrRurHCilHCDJLXumRbtbm9A04ETKoBcrg2h7YcXq14YjfTjf+aIPNfh9wVNx/ry1klCWLfIvddK3jTGa0g1so7YfdkRfcR0nnQ+TnLmOK1f2fgh7fR6jomP0zUnmjenrqBz3yLE3jeOJhydxskPtp0fehXLepLKTtdCshTsKPra6C1LqbyM2ubQPugBExLGD'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 9145, 'candidates_token_count': 29, 'total_token_count': 9498, 'cached_content_token_count': 1836, 'prompt_tokens_details': [{'modality': 1, 'token_count': 9313}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1836}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 29}], 'thoughts_token_count': 324}, 'finish_reason': 'STOP', 'avg_logprobs': -0.9023362521467537, 'model_name': 'gemini-2.5-pro'} id='run--6b08c161-a69d-4d4b-9ce6-5c7eb86f2371-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 501.0, 'relative_path': 'django/contrib/admin/options.py', 'end_line': 2000.0}, 'id': 'e634dc45-61a4-4c80-a8e5-6a4d2cbea1a3', 'type': 'tool_call'}] usage_metadata={'input_tokens': 9145, 'output_tokens': 29, 'total_tokens': 9498, 'input_token_details': {'cache_read': 1836}, 'output_token_details': {'reasoning': 324}}
2025-12-24 05:47:20,411 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have successfully retrieved the entire content of the `django/contrib/admin/options.py` file. I initially fetched the first 500 lines and then proceeded to read the remaining lines to ensure the complete file was available. This approach provides the full context of the file, including the `lookup_allowed` method, as requested.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 31660, 'candidates_token_count': 70, 'total_token_count': 31888, 'cached_content_token_count': 9728, 'prompt_tokens_details': [{'modality': 1, 'token_count': 32152}], 'cache_tokens_details': [{'modality': 1, 'token_count': 9728}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 70}], 'thoughts_token_count': 158}, 'finish_reason': 'STOP', 'avg_logprobs': -0.3377297537667411, 'model_name': 'gemini-2.5-pro'} id='run--8bad5085-839b-428e-835b-0be0f95ee374-0' usage_metadata={'input_tokens': 31660, 'output_tokens': 70, 'total_tokens': 31888, 'input_token_details': {'cache_read': 9728}, 'output_token_details': {'reasoning': 158}}
2025-12-24 05:47:20,414 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of the file django/contrib/admin/options.py.
--- END QUERY ---



--- BEGIN PURPOSE ---
This file contains the `lookup_allowed` method that needs to be fixed, and having its full content is essential to understand the logic and apply the patch correctly.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: django/contrib/admin/options.py
Line number range: 1 - 500
Content:
1. import copy
2. import enum
3. import json
4. import re
5. from functools import partial, update_wrapper
6. from urllib.parse import quote as urlquote
7. 
8. from django import forms
9. from django.conf import settings
10. from django.contrib import messages
11. from django.contrib.admin import helpers, widgets
12. from django.contrib.admin.checks import (
13.     BaseModelAdminChecks,
14.     InlineModelAdminChecks,
15.     ModelAdminChecks,
16. )
17. from django.contrib.admin.exceptions import DisallowedModelAdminToField
18. from django.contrib.admin.templatetags.admin_urls import add_preserved_filters
19. from django.contrib.admin.utils import (
20.     NestedObjects,
21.     construct_change_message,
22.     flatten_fieldsets,
23.     get_deleted_objects,
24.     lookup_spawns_duplicates,
25.     model_format_dict,
26.     model_ngettext,
27.     quote,
28.     unquote,
29. )
30. from django.contrib.admin.widgets import AutocompleteSelect, AutocompleteSelectMultiple
31. from django.contrib.auth import get_permission_codename
32. from django.core.exceptions import (
33.     FieldDoesNotExist,
34.     FieldError,
35.     PermissionDenied,
36.     ValidationError,
37. )
38. from django.core.paginator import Paginator
39. from django.db import models, router, transaction
40. from django.db.models.constants import LOOKUP_SEP
41. from django.forms.formsets import DELETION_FIELD_NAME, all_valid
42. from django.forms.models import (
43.     BaseInlineFormSet,
44.     inlineformset_factory,
45.     modelform_defines_fields,
46.     modelform_factory,
47.     modelformset_factory,
48. )
49. from django.forms.widgets import CheckboxSelectMultiple, SelectMultiple
50. from django.http import HttpResponseRedirect
51. from django.http.response import HttpResponseBase
52. from django.template.response import SimpleTemplateResponse, TemplateResponse
53. from django.urls import reverse
54. from django.utils.decorators import method_decorator
55. from django.utils.html import format_html
56. from django.utils.http import urlencode
57. from django.utils.safestring import mark_safe
58. from django.utils.text import (
59.     capfirst,
60.     format_lazy,
61.     get_text_list,
62.     smart_split,
63.     unescape_string_literal,
64. )
65. from django.utils.translation import gettext as _
66. from django.utils.translation import ngettext
67. from django.views.decorators.csrf import csrf_protect
68. from django.views.generic import RedirectView
69. 
70. IS_POPUP_VAR = "_popup"
71. TO_FIELD_VAR = "_to_field"
72. IS_FACETS_VAR = "_facets"
73. 
74. 
75. class ShowFacets(enum.Enum):
76.     NEVER = "NEVER"
77.     ALLOW = "ALLOW"
78.     ALWAYS = "ALWAYS"
79. 
80. 
81. HORIZONTAL, VERTICAL = 1, 2
82. 
83. 
84. def get_content_type_for_model(obj):
85.     # Since this module gets imported in the application's root package,
86.     # it cannot import models from other applications at the module level.
87.     from django.contrib.contenttypes.models import ContentType
88. 
89.     return ContentType.objects.get_for_model(obj, for_concrete_model=False)
90. 
91. 
92. def get_ul_class(radio_style):
93.     return "radiolist" if radio_style == VERTICAL else "radiolist inline"
94. 
95. 
96. class IncorrectLookupParameters(Exception):
97.     pass
98. 
99. 
100. # Defaults for formfield_overrides. ModelAdmin subclasses can change this
101. # by adding to ModelAdmin.formfield_overrides.
102. 
103. FORMFIELD_FOR_DBFIELD_DEFAULTS = {
104.     models.DateTimeField: {
105.         "form_class": forms.SplitDateTimeField,
106.         "widget": widgets.AdminSplitDateTime,
107.     },
108.     models.DateField: {"widget": widgets.AdminDateWidget},
109.     models.TimeField: {"widget": widgets.AdminTimeWidget},
110.     models.TextField: {"widget": widgets.AdminTextareaWidget},
111.     models.URLField: {"widget": widgets.AdminURLFieldWidget},
112.     models.IntegerField: {"widget": widgets.AdminIntegerFieldWidget},
113.     models.BigIntegerField: {"widget": widgets.AdminBigIntegerFieldWidget},
114.     models.CharField: {"widget": widgets.AdminTextInputWidget},
115.     models.ImageField: {"widget": widgets.AdminFileWidget},
116.     models.FileField: {"widget": widgets.AdminFileWidget},
117.     models.EmailField: {"widget": widgets.AdminEmailInputWidget},
118.     models.UUIDField: {"widget": widgets.AdminUUIDInputWidget},
119. }
120. 
121. csrf_protect_m = method_decorator(csrf_protect)
122. 
123. 
124. class BaseModelAdmin(metaclass=forms.MediaDefiningClass):
125.     """Functionality common to both ModelAdmin and InlineAdmin."""
126. 
127.     autocomplete_fields = ()
128.     raw_id_fields = ()
129.     fields = None
130.     exclude = None
131.     fieldsets = None
132.     form = forms.ModelForm
133.     filter_vertical = ()
134.     filter_horizontal = ()
135.     radio_fields = {}
136.     prepopulated_fields = {}
137.     formfield_overrides = {}
138.     readonly_fields = ()
139.     ordering = None
140.     sortable_by = None
141.     view_on_site = True
142.     show_full_result_count = True
143.     checks_class = BaseModelAdminChecks
144. 
145.     def check(self, **kwargs):
146.         return self.checks_class().check(self, **kwargs)
147. 
148.     def __init__(self):
149.         # Merge FORMFIELD_FOR_DBFIELD_DEFAULTS with the formfield_overrides
150.         # rather than simply overwriting.
151.         overrides = copy.deepcopy(FORMFIELD_FOR_DBFIELD_DEFAULTS)
152.         for k, v in self.formfield_overrides.items():
153.             overrides.setdefault(k, {}).update(v)
154.         self.formfield_overrides = overrides
155. 
156.     def formfield_for_dbfield(self, db_field, request, **kwargs):
157.         """
158.         Hook for specifying the form Field instance for a given database Field
159.         instance.
160. 
161.         If kwargs are given, they're passed to the form Field's constructor.
162.         """
163.         # If the field specifies choices, we don't need to look for special
164.         # admin widgets - we just need to use a select widget of some kind.
165.         if db_field.choices:
166.             return self.formfield_for_choice_field(db_field, request, **kwargs)
167. 
168.         # ForeignKey or ManyToManyFields
169.         if isinstance(db_field, (models.ForeignKey, models.ManyToManyField)):
170.             # Combine the field kwargs with any options for formfield_overrides.
171.             # Make sure the passed in **kwargs override anything in
172.             # formfield_overrides because **kwargs is more specific, and should
173.             # always win.
174.             if db_field.__class__ in self.formfield_overrides:
175.                 kwargs = {**self.formfield_overrides[db_field.__class__], **kwargs}
176. 
177.             # Get the correct formfield.
178.             if isinstance(db_field, models.ForeignKey):
179.                 formfield = self.formfield_for_foreignkey(db_field, request, **kwargs)
180.             elif isinstance(db_field, models.ManyToManyField):
181.                 formfield = self.formfield_for_manytomany(db_field, request, **kwargs)
182. 
183.             # For non-raw_id fields, wrap the widget with a wrapper that adds
184.             # extra HTML -- the "add other" interface -- to the end of the
185.             # rendered output. formfield can be None if it came from a
186.             # OneToOneField with parent_link=True or a M2M intermediary.
187.             if formfield and db_field.name not in self.raw_id_fields:
188.                 related_modeladmin = self.admin_site._registry.get(
189.                     db_field.remote_field.model
190.                 )
191.                 wrapper_kwargs = {}
192.                 if related_modeladmin:
193.                     wrapper_kwargs.update(
194.                         can_add_related=related_modeladmin.has_add_permission(request),
195.                         can_change_related=related_modeladmin.has_change_permission(
196.                             request
197.                         ),
198.                         can_delete_related=related_modeladmin.has_delete_permission(
199.                             request
200.                         ),
201.                         can_view_related=related_modeladmin.has_view_permission(
202.                             request
203.                         ),
204.                     )
205.                 formfield.widget = widgets.RelatedFieldWidgetWrapper(
206.                     formfield.widget,
207.                     db_field.remote_field,
208.                     self.admin_site,
209.                     **wrapper_kwargs,
210.                 )
211. 
212.             return formfield
213. 
214.         # If we've got overrides for the formfield defined, use 'em. **kwargs
215.         # passed to formfield_for_dbfield override the defaults.
216.         for klass in db_field.__class__.mro():
217.             if klass in self.formfield_overrides:
218.                 kwargs = {**copy.deepcopy(self.formfield_overrides[klass]), **kwargs}
219.                 return db_field.formfield(**kwargs)
220. 
221.         # For any other type of field, just call its formfield() method.
222.         return db_field.formfield(**kwargs)
223. 
224.     def formfield_for_choice_field(self, db_field, request, **kwargs):
225.         """
226.         Get a form Field for a database Field that has declared choices.
227.         """
228.         # If the field is named as a radio_field, use a RadioSelect
229.         if db_field.name in self.radio_fields:
230.             # Avoid stomping on custom widget/choices arguments.
231.             if "widget" not in kwargs:
232.                 kwargs["widget"] = widgets.AdminRadioSelect(
233.                     attrs={
234.                         "class": get_ul_class(self.radio_fields[db_field.name]),
235.                     }
236.                 )
237.             if "choices" not in kwargs:
238.                 kwargs["choices"] = db_field.get_choices(
239.                     include_blank=db_field.blank, blank_choice=[("", _("None"))]
240.                 )
241.         return db_field.formfield(**kwargs)
242. 
243.     def get_field_queryset(self, db, db_field, request):
244.         """
245.         If the ModelAdmin specifies ordering, the queryset should respect that
246.         ordering.  Otherwise don't specify the queryset, let the field decide
247.         (return None in that case).
248.         """
249.         related_admin = self.admin_site._registry.get(db_field.remote_field.model)
250.         if related_admin is not None:
251.             ordering = related_admin.get_ordering(request)
252.             if ordering is not None and ordering != ():
253.                 return db_field.remote_field.model._default_manager.using(db).order_by(
254.                     *ordering
255.                 )
256.         return None
257. 
258.     def formfield_for_foreignkey(self, db_field, request, **kwargs):
259.         """
260.         Get a form Field for a ForeignKey.
261.         """
262.         db = kwargs.get("using")
263. 
264.         if "widget" not in kwargs:
265.             if db_field.name in self.get_autocomplete_fields(request):
266.                 kwargs["widget"] = AutocompleteSelect(
267.                     db_field, self.admin_site, using=db
268.                 )
269.             elif db_field.name in self.raw_id_fields:
270.                 kwargs["widget"] = widgets.ForeignKeyRawIdWidget(
271.                     db_field.remote_field, self.admin_site, using=db
272.                 )
273.             elif db_field.name in self.radio_fields:
274.                 kwargs["widget"] = widgets.AdminRadioSelect(
275.                     attrs={
276.                         "class": get_ul_class(self.radio_fields[db_field.name]),
277.                     }
278.                 )
279.                 kwargs["empty_label"] = (
280.                     kwargs.get("empty_label", _("None")) if db_field.blank else None
281.                 )
282. 
283.         if "queryset" not in kwargs:
284.             queryset = self.get_field_queryset(db, db_field, request)
285.             if queryset is not None:
286.                 kwargs["queryset"] = queryset
287. 
288.         return db_field.formfield(**kwargs)
289. 
290.     def formfield_for_manytomany(self, db_field, request, **kwargs):
291.         """
292.         Get a form Field for a ManyToManyField.
293.         """
294.         # If it uses an intermediary model that isn't auto created, don't show
295.         # a field in admin.
296.         if not db_field.remote_field.through._meta.auto_created:
297.             return None
298.         db = kwargs.get("using")
299. 
300.         if "widget" not in kwargs:
301.             autocomplete_fields = self.get_autocomplete_fields(request)
302.             if db_field.name in autocomplete_fields:
303.                 kwargs["widget"] = AutocompleteSelectMultiple(
304.                     db_field,
305.                     self.admin_site,
306.                     using=db,
307.                 )
308.             elif db_field.name in self.raw_id_fields:
309.                 kwargs["widget"] = widgets.ManyToManyRawIdWidget(
310.                     db_field.remote_field,
311.                     self.admin_site,
312.                     using=db,
313.                 )
314.             elif db_field.name in [*self.filter_vertical, *self.filter_horizontal]:
315.                 kwargs["widget"] = widgets.FilteredSelectMultiple(
316.                     db_field.verbose_name, db_field.name in self.filter_vertical
317.                 )
318.         if "queryset" not in kwargs:
319.             queryset = self.get_field_queryset(db, db_field, request)
320.             if queryset is not None:
321.                 kwargs["queryset"] = queryset
322. 
323.         form_field = db_field.formfield(**kwargs)
324.         if (
325.             isinstance(form_field.widget, SelectMultiple)
326.             and form_field.widget.allow_multiple_selected
327.             and not isinstance(
328.                 form_field.widget, (CheckboxSelectMultiple, AutocompleteSelectMultiple)
329.             )
330.         ):
331.             msg = _(
332.                 "Hold down “Control”, or “Command” on a Mac, to select more than one."
333.             )
334.             help_text = form_field.help_text
335.             form_field.help_text = (
336.                 format_lazy("{} {}", help_text, msg) if help_text else msg
337.             )
338.         return form_field
339. 
340.     def get_autocomplete_fields(self, request):
341.         """
342.         Return a list of ForeignKey and/or ManyToMany fields which should use
343.         an autocomplete widget.
344.         """
345.         return self.autocomplete_fields
346. 
347.     def get_view_on_site_url(self, obj=None):
348.         if obj is None or not self.view_on_site:
349.             return None
350. 
351.         if callable(self.view_on_site):
352.             return self.view_on_site(obj)
353.         elif hasattr(obj, "get_absolute_url"):
354.             # use the ContentType lookup if view_on_site is True
355.             return reverse(
356.                 "admin:view_on_site",
357.                 kwargs={
358.                     "content_type_id": get_content_type_for_model(obj).pk,
359.                     "object_id": obj.pk,
360.                 },
361.                 current_app=self.admin_site.name,
362.             )
363. 
364.     def get_empty_value_display(self):
365.         """
366.         Return the empty_value_display set on ModelAdmin or AdminSite.
367.         """
368.         try:
369.             return mark_safe(self.empty_value_display)
370.         except AttributeError:
371.             return mark_safe(self.admin_site.empty_value_display)
372. 
373.     def get_exclude(self, request, obj=None):
374.         """
375.         Hook for specifying exclude.
376.         """
377.         return self.exclude
378. 
379.     def get_fields(self, request, obj=None):
380.         """
381.         Hook for specifying fields.
382.         """
383.         if self.fields:
384.             return self.fields
385.         # _get_form_for_get_fields() is implemented in subclasses.
386.         form = self._get_form_for_get_fields(request, obj)
387.         return [*form.base_fields, *self.get_readonly_fields(request, obj)]
388. 
389.     def get_fieldsets(self, request, obj=None):
390.         """
391.         Hook for specifying fieldsets.
392.         """
393.         if self.fieldsets:
394.             return self.fieldsets
395.         return [(None, {"fields": self.get_fields(request, obj)})]
396. 
397.     def get_inlines(self, request, obj):
398.         """Hook for specifying custom inlines."""
399.         return self.inlines
400. 
401.     def get_ordering(self, request):
402.         """
403.         Hook for specifying field ordering.
404.         """
405.         return self.ordering or ()  # otherwise we might try to *None, which is bad ;)
406. 
407.     def get_readonly_fields(self, request, obj=None):
408.         """
409.         Hook for specifying custom readonly fields.
410.         """
411.         return self.readonly_fields
412. 
413.     def get_prepopulated_fields(self, request, obj=None):
414.         """
415.         Hook for specifying custom prepopulated fields.
416.         """
417.         return self.prepopulated_fields
418. 
419.     def get_queryset(self, request):
420.         """
421.         Return a QuerySet of all model instances that can be edited by the
422.         admin site. This is used by changelist_view.
423.         """
424.         qs = self.model._default_manager.get_queryset()
425.         # TODO: this should be handled by some parameter to the ChangeList.
426.         ordering = self.get_ordering(request)
427.         if ordering:
428.             qs = qs.order_by(*ordering)
429.         return qs
430. 
431.     def get_sortable_by(self, request):
432.         """Hook for specifying which fields can be sorted in the changelist."""
433.         return (
434.             self.sortable_by
435.             if self.sortable_by is not None
436.             else self.get_list_display(request)
437.         )
438. 
439.     def lookup_allowed(self, lookup, value):
440.         from django.contrib.admin.filters import SimpleListFilter
441. 
442.         model = self.model
443.         # Check FKey lookups that are allowed, so that popups produced by
444.         # ForeignKeyRawIdWidget, on the basis of ForeignKey.limit_choices_to,
445.         # are allowed to work.
446.         for fk_lookup in model._meta.related_fkey_lookups:
447.             # As ``limit_choices_to`` can be a callable, invoke it here.
448.             if callable(fk_lookup):
449.                 fk_lookup = fk_lookup()
450.             if (lookup, value) in widgets.url_params_from_lookup_dict(
451.                 fk_lookup
452.             ).items():
453.                 return True
454. 
455.         relation_parts = []
456.         prev_field = None
457.         for part in lookup.split(LOOKUP_SEP):
458.             try:
459.                 field = model._meta.get_field(part)
460.             except FieldDoesNotExist:
461.                 # Lookups on nonexistent fields are ok, since they're ignored
462.                 # later.
463.                 break
464.             # It is allowed to filter on values that would be found from local
465.             # model anyways. For example, if you filter on employee__department__id,
466.             # then the id value would be found already from employee__department_id.
467.             if not prev_field or (
468.                 prev_field.is_relation
469.                 and field not in prev_field.path_infos[-1].target_fields
470.             ):
471.                 relation_parts.append(part)
472.             if not getattr(field, "path_infos", None):
473.                 # This is not a relational field, so further parts
474.                 # must be transforms.
475.                 break
476.             prev_field = field
477.             model = field.path_infos[-1].to_opts.model
478. 
479.         if len(relation_parts) <= 1:
480.             # Either a local field filter, or no fields at all.
481.             return True
482.         valid_lookups = {self.date_hierarchy}
483.         for filter_item in self.list_filter:
484.             if isinstance(filter_item, type) and issubclass(
485.                 filter_item, SimpleListFilter
486.             ):
487.                 valid_lookups.add(filter_item.parameter_name)
488.             elif isinstance(filter_item, (list, tuple)):
489.                 valid_lookups.add(filter_item[0])
490.             else:
491.                 valid_lookups.add(filter_item)
492. 
493.         # Is it a valid relational lookup?
494.         return not {
495.             LOOKUP_SEP.join(relation_parts),
496.             LOOKUP_SEP.join(relation_parts + [part]),
497.         }.isdisjoint(valid_lookups)
498. 
499.     def to_field_allowed(self, request, to_field):
500.         """


File: django/contrib/admin/options.py
Line number range: 501 - 2000
Content:
501.         Return True if the model associated with this admin should be
502.         allowed to be referenced by the specified field.
503.         """
504.         try:
505.             field = self.opts.get_field(to_field)
506.         except FieldDoesNotExist:
507.             return False
508. 
509.         # Always allow referencing the primary key since it's already possible
510.         # to get this information from the change view URL.
511.         if field.primary_key:
512.             return True
513. 
514.         # Allow reverse relationships to models defining m2m fields if they
515.         # target the specified field.
516.         for many_to_many in self.opts.many_to_many:
517.             if many_to_many.m2m_target_field_name() == to_field:
518.                 return True
519. 
520.         # Make sure at least one of the models registered for this site
521.         # references this field through a FK or a M2M relationship.
522.         registered_models = set()
523.         for model, admin in self.admin_site._registry.items():
524.             registered_models.add(model)
525.             for inline in admin.inlines:
526.                 registered_models.add(inline.model)
527. 
528.         related_objects = (
529.             f
530.             for f in self.opts.get_fields(include_hidden=True)
531.             if (f.auto_created and not f.concrete)
532.         )
533.         for related_object in related_objects:
534.             related_model = related_object.related_model
535.             remote_field = related_object.field.remote_field
536.             if (
537.                 any(issubclass(model, related_model) for model in registered_models)
538.                 and hasattr(remote_field, "get_related_field")
539.                 and remote_field.get_related_field() == field
540.             ):
541.                 return True
542. 
543.         return False
544. 
545.     def has_add_permission(self, request):
546.         """
547.         Return True if the given request has permission to add an object.
548.         Can be overridden by the user in subclasses.
549.         """
550.         opts = self.opts
551.         codename = get_permission_codename("add", opts)
552.         return request.user.has_perm("%s.%s" % (opts.app_label, codename))
553. 
554.     def has_change_permission(self, request, obj=None):
555.         """
556.         Return True if the given request has permission to change the given
557.         Django model instance, the default implementation doesn't examine the
558.         `obj` parameter.
559. 
560.         Can be overridden by the user in subclasses. In such case it should
561.         return True if the given request has permission to change the `obj`
562.         model instance. If `obj` is None, this should return True if the given
563.         request has permission to change *any* object of the given type.
564.         """
565.         opts = self.opts
566.         codename = get_permission_codename("change", opts)
567.         return request.user.has_perm("%s.%s" % (opts.app_label, codename))
568. 
569.     def has_delete_permission(self, request, obj=None):
570.         """
571.         Return True if the given request has permission to delete the given
572.         Django model instance, the default implementation doesn't examine the
573.         `obj` parameter.
574. 
575.         Can be overridden by the user in subclasses. In such case it should
576.         return True if the given request has permission to delete the `obj`
577.         model instance. If `obj` is None, this should return True if the given
578.         request has permission to delete *any* object of the given type.
579.         """
580.         opts = self.opts
581.         codename = get_permission_codename("delete", opts)
582.         return request.user.has_perm("%s.%s" % (opts.app_label, codename))
583. 
584.     def has_view_permission(self, request, obj=None):
585.         """
586.         Return True if the given request has permission to view the given
587.         Django model instance. The default implementation doesn't examine the
588.         `obj` parameter.
589. 
590.         If overridden by the user in subclasses, it should return True if the
591.         given request has permission to view the `obj` model instance. If `obj`
592.         is None, it should return True if the request has permission to view
593.         any object of the given type.
594.         """
595.         opts = self.opts
596.         codename_view = get_permission_codename("view", opts)
597.         codename_change = get_permission_codename("change", opts)
598.         return request.user.has_perm(
599.             "%s.%s" % (opts.app_label, codename_view)
600.         ) or request.user.has_perm("%s.%s" % (opts.app_label, codename_change))
601. 
602.     def has_view_or_change_permission(self, request, obj=None):
603.         return self.has_view_permission(request, obj) or self.has_change_permission(
604.             request, obj
605.         )
606. 
607.     def has_module_permission(self, request):
608.         """
609.         Return True if the given request has any permission in the given
610.         app label.
611. 
612.         Can be overridden by the user in subclasses. In such case it should
613.         return True if the given request has permission to view the module on
614.         the admin index page and access the module's index page. Overriding it
615.         does not restrict access to the add, change or delete views. Use
616.         `ModelAdmin.has_(add|change|delete)_permission` for that.
617.         """
618.         return request.user.has_module_perms(self.opts.app_label)
619. 
620. 
621. class ModelAdmin(BaseModelAdmin):
622.     """Encapsulate all admin options and functionality for a given model."""
623. 
624.     list_display = ("__str__",)
625.     list_display_links = ()
626.     list_filter = ()
627.     list_select_related = False
628.     list_per_page = 100
629.     list_max_show_all = 200
630.     list_editable = ()
631.     search_fields = ()
632.     search_help_text = None
633.     date_hierarchy = None
634.     save_as = False
635.     save_as_continue = True
636.     save_on_top = False
637.     paginator = Paginator
638.     preserve_filters = True
639.     show_facets = ShowFacets.ALLOW
640.     inlines = ()
641. 
642.     # Custom templates (designed to be over-ridden in subclasses)
643.     add_form_template = None
644.     change_form_template = None
645.     change_list_template = None
646.     delete_confirmation_template = None
647.     delete_selected_confirmation_template = None
648.     object_history_template = None
649.     popup_response_template = None
650. 
651.     # Actions
652.     actions = ()
653.     action_form = helpers.ActionForm
654.     actions_on_top = True
655.     actions_on_bottom = False
656.     actions_selection_counter = True
657.     checks_class = ModelAdminChecks
658. 
659.     def __init__(self, model, admin_site):
660.         self.model = model
661.         self.opts = model._meta
662.         self.admin_site = admin_site
663.         super().__init__()
664. 
665.     def __str__(self):
666.         return "%s.%s" % (self.opts.app_label, self.__class__.__name__)
667. 
668.     def __repr__(self):
669.         return (
670.             f"<{self.__class__.__qualname__}: model={self.model.__qualname__} "
671.             f"site={self.admin_site!r}>"
672.         )
673. 
674.     def get_inline_instances(self, request, obj=None):
675.         inline_instances = []
676.         for inline_class in self.get_inlines(request, obj):
677.             inline = inline_class(self.model, self.admin_site)
678.             if request:
679.                 if not (
680.                     inline.has_view_or_change_permission(request, obj)
681.                     or inline.has_add_permission(request, obj)
682.                     or inline.has_delete_permission(request, obj)
683.                 ):
684.                     continue
685.                 if not inline.has_add_permission(request, obj):
686.                     inline.max_num = 0
687.             inline_instances.append(inline)
688. 
689.         return inline_instances
690. 
691.     def get_urls(self):
692.         from django.urls import path
693. 
694.         def wrap(view):
695.             def wrapper(*args, **kwargs):
696.                 return self.admin_site.admin_view(view)(*args, **kwargs)
697. 
698.             wrapper.model_admin = self
699.             return update_wrapper(wrapper, view)
700. 
701.         info = self.opts.app_label, self.opts.model_name
702. 
703.         return [
704.             path("", wrap(self.changelist_view), name="%s_%s_changelist" % info),
705.             path("add/", wrap(self.add_view), name="%s_%s_add" % info),
706.             path(
707.                 "<path:object_id>/history/",
708.                 wrap(self.history_view),
709.                 name="%s_%s_history" % info,
710.             ),
711.             path(
712.                 "<path:object_id>/delete/",
713.                 wrap(self.delete_view),
714.                 name="%s_%s_delete" % info,
715.             ),
716.             path(
717.                 "<path:object_id>/change/",
718.                 wrap(self.change_view),
719.                 name="%s_%s_change" % info,
720.             ),
721.             # For backwards compatibility (was the change url before 1.9)
722.             path(
723.                 "<path:object_id>/",
724.                 wrap(
725.                     RedirectView.as_view(
726.                         pattern_name="%s:%s_%s_change"
727.                         % ((self.admin_site.name,) + info)
728.                     )
729.                 ),
730.             ),
731.         ]
732. 
733.     @property
734.     def urls(self):
735.         return self.get_urls()
736. 
737.     @property
738.     def media(self):
739.         extra = "" if settings.DEBUG else ".min"
740.         js = [
741.             "vendor/jquery/jquery%s.js" % extra,
742.             "jquery.init.js",
743.             "core.js",
744.             "admin/RelatedObjectLookups.js",
745.             "actions.js",
746.             "urlify.js",
747.             "prepopulate.js",
748.             "vendor/xregexp/xregexp%s.js" % extra,
749.         ]
750.         return forms.Media(js=["admin/js/%s" % url for url in js])
751. 
752.     def get_model_perms(self, request):
753.         """
754.         Return a dict of all perms for this model. This dict has the keys
755.         ``add``, ``change``, ``delete``, and ``view`` mapping to the True/False
756.         for each of those actions.
757.         """
758.         return {
759.             "add": self.has_add_permission(request),
760.             "change": self.has_change_permission(request),
761.             "delete": self.has_delete_permission(request),
762.             "view": self.has_view_permission(request),
763.         }
764. 
765.     def _get_form_for_get_fields(self, request, obj):
766.         return self.get_form(request, obj, fields=None)
767. 
768.     def get_form(self, request, obj=None, change=False, **kwargs):
769.         """
770.         Return a Form class for use in the admin add view. This is used by
771.         add_view and change_view.
772.         """
773.         if "fields" in kwargs:
774.             fields = kwargs.pop("fields")
775.         else:
776.             fields = flatten_fieldsets(self.get_fieldsets(request, obj))
777.         excluded = self.get_exclude(request, obj)
778.         exclude = [] if excluded is None else list(excluded)
779.         readonly_fields = self.get_readonly_fields(request, obj)
780.         exclude.extend(readonly_fields)
781.         # Exclude all fields if it's a change form and the user doesn't have
782.         # the change permission.
783.         if (
784.             change
785.             and hasattr(request, "user")
786.             and not self.has_change_permission(request, obj)
787.         ):
788.             exclude.extend(fields)
789.         if excluded is None and hasattr(self.form, "_meta") and self.form._meta.exclude:
790.             # Take the custom ModelForm's Meta.exclude into account only if the
791.             # ModelAdmin doesn't define its own.
792.             exclude.extend(self.form._meta.exclude)
793.         # if exclude is an empty list we pass None to be consistent with the
794.         # default on modelform_factory
795.         exclude = exclude or None
796. 
797.         # Remove declared form fields which are in readonly_fields.
798.         new_attrs = dict.fromkeys(
799.             f for f in readonly_fields if f in self.form.declared_fields
800.         )
801.         form = type(self.form.__name__, (self.form,), new_attrs)
802. 
803.         defaults = {
804.             "form": form,
805.             "fields": fields,
806.             "exclude": exclude,
807.             "formfield_callback": partial(self.formfield_for_dbfield, request=request),
808.             **kwargs,
809.         }
810. 
811.         if defaults["fields"] is None and not modelform_defines_fields(
812.             defaults["form"]
813.         ):
814.             defaults["fields"] = forms.ALL_FIELDS
815. 
816.         try:
817.             return modelform_factory(self.model, **defaults)
818.         except FieldError as e:
819.             raise FieldError(
820.                 "%s. Check fields/fieldsets/exclude attributes of class %s."
821.                 % (e, self.__class__.__name__)
822.             )
823. 
824.     def get_changelist(self, request, **kwargs):
825.         """
826.         Return the ChangeList class for use on the changelist page.
827.         """
828.         from django.contrib.admin.views.main import ChangeList
829. 
830.         return ChangeList
831. 
832.     def get_changelist_instance(self, request):
833.         """
834.         Return a `ChangeList` instance based on `request`. May raise
835.         `IncorrectLookupParameters`.
836.         """
837.         list_display = self.get_list_display(request)
838.         list_display_links = self.get_list_display_links(request, list_display)
839.         # Add the action checkboxes if any actions are available.
840.         if self.get_actions(request):
841.             list_display = ["action_checkbox", *list_display]
842.         sortable_by = self.get_sortable_by(request)
843.         ChangeList = self.get_changelist(request)
844.         return ChangeList(
845.             request,
846.             self.model,
847.             list_display,
848.             list_display_links,
849.             self.get_list_filter(request),
850.             self.date_hierarchy,
851.             self.get_search_fields(request),
852.             self.get_list_select_related(request),
853.             self.list_per_page,
854.             self.list_max_show_all,
855.             self.list_editable,
856.             self,
857.             sortable_by,
858.             self.search_help_text,
859.         )
860. 
861.     def get_object(self, request, object_id, from_field=None):
862.         """
863.         Return an instance matching the field and value provided, the primary
864.         key is used if no field is provided. Return ``None`` if no match is
865.         found or the object_id fails validation.
866.         """
867.         queryset = self.get_queryset(request)
868.         model = queryset.model
869.         field = (
870.             model._meta.pk if from_field is None else model._meta.get_field(from_field)
871.         )
872.         try:
873.             object_id = field.to_python(object_id)
874.             return queryset.get(**{field.name: object_id})
875.         except (model.DoesNotExist, ValidationError, ValueError):
876.             return None
877. 
878.     def get_changelist_form(self, request, **kwargs):
879.         """
880.         Return a Form class for use in the Formset on the changelist page.
881.         """
882.         defaults = {
883.             "formfield_callback": partial(self.formfield_for_dbfield, request=request),
884.             **kwargs,
885.         }
886.         if defaults.get("fields") is None and not modelform_defines_fields(
887.             defaults.get("form")
888.         ):
889.             defaults["fields"] = forms.ALL_FIELDS
890. 
891.         return modelform_factory(self.model, **defaults)
892. 
893.     def get_changelist_formset(self, request, **kwargs):
894.         """
895.         Return a FormSet class for use on the changelist page if list_editable
896.         is used.
897.         """
898.         defaults = {
899.             "formfield_callback": partial(self.formfield_for_dbfield, request=request),
900.             **kwargs,
901.         }
902.         return modelformset_factory(
903.             self.model,
904.             self.get_changelist_form(request),
905.             extra=0,
906.             fields=self.list_editable,
907.             **defaults,
908.         )
909. 
910.     def get_formsets_with_inlines(self, request, obj=None):
911.         """
912.         Yield formsets and the corresponding inlines.
913.         """
914.         for inline in self.get_inline_instances(request, obj):
915.             yield inline.get_formset(request, obj), inline
916. 
917.     def get_paginator(
918.         self, request, queryset, per_page, orphans=0, allow_empty_first_page=True
919.     ):
920.         return self.paginator(queryset, per_page, orphans, allow_empty_first_page)
921. 
922.     def log_addition(self, request, obj, message):
923.         """
924.         Log that an object has been successfully added.
925. 
926.         The default implementation creates an admin LogEntry object.
927.         """
928.         from django.contrib.admin.models import ADDITION, LogEntry
929. 
930.         return LogEntry.objects.log_action(
931.             user_id=request.user.pk,
932.             content_type_id=get_content_type_for_model(obj).pk,
933.             object_id=obj.pk,
934.             object_repr=str(obj),
935.             action_flag=ADDITION,
936.             change_message=message,
937.         )
938. 
939.     def log_change(self, request, obj, message):
940.         """
941.         Log that an object has been successfully changed.
942. 
943.         The default implementation creates an admin LogEntry object.
944.         """
945.         from django.contrib.admin.models import CHANGE, LogEntry
946. 
947.         return LogEntry.objects.log_action(
948.             user_id=request.user.pk,
949.             content_type_id=get_content_type_for_model(obj).pk,
950.             object_id=obj.pk,
951.             object_repr=str(obj),
952.             action_flag=CHANGE,
953.             change_message=message,
954.         )
955. 
956.     def log_deletion(self, request, obj, object_repr):
957.         """
958.         Log that an object will be deleted. Note that this method must be
959.         called before the deletion.
960. 
961.         The default implementation creates an admin LogEntry object.
962.         """
963.         from django.contrib.admin.models import DELETION, LogEntry
964. 
965.         return LogEntry.objects.log_action(
966.             user_id=request.user.pk,
967.             content_type_id=get_content_type_for_model(obj).pk,
968.             object_id=obj.pk,
969.             object_repr=object_repr,
970.             action_flag=DELETION,
971.         )
972. 
973.     def action_checkbox(self, obj):
974.         """
975.         A list_display column containing a checkbox widget.
976.         """
977.         attrs = {
978.             "class": "action-select",
979.             "aria-label": format_html(_("Select this object for an action - {}"), obj),
980.         }
981.         checkbox = forms.CheckboxInput(attrs, lambda value: False)
982.         return checkbox.render(helpers.ACTION_CHECKBOX_NAME, str(obj.pk))
983. 
984.     @staticmethod
985.     def _get_action_description(func, name):
986.         return getattr(func, "short_description", capfirst(name.replace("_", " ")))
987. 
988.     def _get_base_actions(self):
989.         """Return the list of actions, prior to any request-based filtering."""
990.         actions = []
991.         base_actions = (self.get_action(action) for action in self.actions or [])
992.         # get_action might have returned None, so filter any of those out.
993.         base_actions = [action for action in base_actions if action]
994.         base_action_names = {name for _, name, _ in base_actions}
995. 
996.         # Gather actions from the admin site first
997.         for name, func in self.admin_site.actions:
998.             if name in base_action_names:
999.                 continue
1000.             description = self._get_action_description(func, name)
1001.             actions.append((func, name, description))
1002.         # Add actions from this ModelAdmin.
1003.         actions.extend(base_actions)
1004.         return actions
1005. 
1006.     def _filter_actions_by_permissions(self, request, actions):
1007.         """Filter out any actions that the user doesn't have access to."""
1008.         filtered_actions = []
1009.         for action in actions:
1010.             callable = action[0]
1011.             if not hasattr(callable, "allowed_permissions"):
1012.                 filtered_actions.append(action)
1013.                 continue
1014.             permission_checks = (
1015.                 getattr(self, "has_%s_permission" % permission)
1016.                 for permission in callable.allowed_permissions
1017.             )
1018.             if any(has_permission(request) for has_permission in permission_checks):
1019.                 filtered_actions.append(action)
1020.         return filtered_actions
1021. 
1022.     def get_actions(self, request):
1023.         """
1024.         Return a dictionary mapping the names of all actions for this
1025.         ModelAdmin to a tuple of (callable, name, description) for each action.
1026.         """
1027.         # If self.actions is set to None that means actions are disabled on
1028.         # this page.
1029.         if self.actions is None or IS_POPUP_VAR in request.GET:
1030.             return {}
1031.         actions = self._filter_actions_by_permissions(request, self._get_base_actions())
1032.         return {name: (func, name, desc) for func, name, desc in actions}
1033. 
1034.     def get_action_choices(self, request, default_choices=models.BLANK_CHOICE_DASH):
1035.         """
1036.         Return a list of choices for use in a form object.  Each choice is a
1037.         tuple (name, description).
1038.         """
1039.         choices = [] + default_choices
1040.         for func, name, description in self.get_actions(request).values():
1041.             choice = (name, description % model_format_dict(self.opts))
1042.             choices.append(choice)
1043.         return choices
1044. 
1045.     def get_action(self, action):
1046.         """
1047.         Return a given action from a parameter, which can either be a callable,
1048.         or the name of a method on the ModelAdmin.  Return is a tuple of
1049.         (callable, name, description).
1050.         """
1051.         # If the action is a callable, just use it.
1052.         if callable(action):
1053.             func = action
1054.             action = action.__name__
1055. 
1056.         # Next, look for a method. Grab it off self.__class__ to get an unbound
1057.         # method instead of a bound one; this ensures that the calling
1058.         # conventions are the same for functions and methods.
1059.         elif hasattr(self.__class__, action):
1060.             func = getattr(self.__class__, action)
1061. 
1062.         # Finally, look for a named method on the admin site
1063.         else:
1064.             try:
1065.                 func = self.admin_site.get_action(action)
1066.             except KeyError:
1067.                 return None
1068. 
1069.         description = self._get_action_description(func, action)
1070.         return func, action, description
1071. 
1072.     def get_list_display(self, request):
1073.         """
1074.         Return a sequence containing the fields to be displayed on the
1075.         changelist.
1076.         """
1077.         return self.list_display
1078. 
1079.     def get_list_display_links(self, request, list_display):
1080.         """
1081.         Return a sequence containing the fields to be displayed as links
1082.         on the changelist. The list_display parameter is the list of fields
1083.         returned by get_list_display().
1084.         """
1085.         if (
1086.             self.list_display_links
1087.             or self.list_display_links is None
1088.             or not list_display
1089.         ):
1090.             return self.list_display_links
1091.         else:
1092.             # Use only the first item in list_display as link
1093.             return list(list_display)[:1]
1094. 
1095.     def get_list_filter(self, request):
1096.         """
1097.         Return a sequence containing the fields to be displayed as filters in
1098.         the right sidebar of the changelist page.
1099.         """
1100.         return self.list_filter
1101. 
1102.     def get_list_select_related(self, request):
1103.         """
1104.         Return a list of fields to add to the select_related() part of the
1105.         changelist items query.
1106.         """
1107.         return self.list_select_related
1108. 
1109.     def get_search_fields(self, request):
1110.         """
1111.         Return a sequence containing the fields to be searched whenever
1112.         somebody submits a search query.
1113.         """
1114.         return self.search_fields
1115. 
1116.     def get_search_results(self, request, queryset, search_term):
1117.         """
1118.         Return a tuple containing a queryset to implement the search
1119.         and a boolean indicating if the results may contain duplicates.
1120.         """
1121. 
1122.         # Apply keyword searches.
1123.         def construct_search(field_name):
1124.             if field_name.startswith("^"):
1125.                 return "%s__istartswith" % field_name.removeprefix("^")
1126.             elif field_name.startswith("="):
1127.                 return "%s__iexact" % field_name.removeprefix("=")
1128.             elif field_name.startswith("@"):
1129.                 return "%s__search" % field_name.removeprefix("@")
1130.             # Use field_name if it includes a lookup.
1131.             opts = queryset.model._meta
1132.             lookup_fields = field_name.split(LOOKUP_SEP)
1133.             # Go through the fields, following all relations.
1134.             prev_field = None
1135.             for path_part in lookup_fields:
1136.                 if path_part == "pk":
1137.                     path_part = opts.pk.name
1138.                 try:
1139.                     field = opts.get_field(path_part)
1140.                 except FieldDoesNotExist:
1141.                     # Use valid query lookups.
1142.                     if prev_field and prev_field.get_lookup(path_part):
1143.                         return field_name
1144.                 else:
1145.                     prev_field = field
1146.                     if hasattr(field, "path_infos"):
1147.                         # Update opts to follow the relation.
1148.                         opts = field.path_infos[-1].to_opts
1149.             # Otherwise, use the field with icontains.
1150.             return "%s__icontains" % field_name
1151. 
1152.         may_have_duplicates = False
1153.         search_fields = self.get_search_fields(request)
1154.         if search_fields and search_term:
1155.             orm_lookups = [
1156.                 construct_search(str(search_field)) for search_field in search_fields
1157.             ]
1158.             term_queries = []
1159.             for bit in smart_split(search_term):
1160.                 if bit.startswith(('"', "'")) and bit[0] == bit[-1]:
1161.                     bit = unescape_string_literal(bit)
1162.                 or_queries = models.Q.create(
1163.                     [(orm_lookup, bit) for orm_lookup in orm_lookups],
1164.                     connector=models.Q.OR,
1165.                 )
1166.                 term_queries.append(or_queries)
1167.             queryset = queryset.filter(models.Q.create(term_queries))
1168.             may_have_duplicates |= any(
1169.                 lookup_spawns_duplicates(self.opts, search_spec)
1170.                 for search_spec in orm_lookups
1171.             )
1172.         return queryset, may_have_duplicates
1173. 
1174.     def get_preserved_filters(self, request):
1175.         """
1176.         Return the preserved filters querystring.
1177.         """
1178.         match = request.resolver_match
1179.         if self.preserve_filters and match:
1180.             current_url = "%s:%s" % (match.app_name, match.url_name)
1181.             changelist_url = "admin:%s_%s_changelist" % (
1182.                 self.opts.app_label,
1183.                 self.opts.model_name,
1184.             )
1185.             if current_url == changelist_url:
1186.                 preserved_filters = request.GET.urlencode()
1187.             else:
1188.                 preserved_filters = request.GET.get("_changelist_filters")
1189. 
1190.             if preserved_filters:
1191.                 return urlencode({"_changelist_filters": preserved_filters})
1192.         return ""
1193. 
1194.     def construct_change_message(self, request, form, formsets, add=False):
1195.         """
1196.         Construct a JSON structure describing changes from a changed object.
1197.         """
1198.         return construct_change_message(form, formsets, add)
1199. 
1200.     def message_user(
1201.         self, request, message, level=messages.INFO, extra_tags="", fail_silently=False
1202.     ):
1203.         """
1204.         Send a message to the user. The default implementation
1205.         posts a message using the django.contrib.messages backend.
1206. 
1207.         Exposes almost the same API as messages.add_message(), but accepts the
1208.         positional arguments in a different order to maintain backwards
1209.         compatibility. For convenience, it accepts the `level` argument as
1210.         a string rather than the usual level number.
1211.         """
1212.         if not isinstance(level, int):
1213.             # attempt to get the level if passed a string
1214.             try:
1215.                 level = getattr(messages.constants, level.upper())
1216.             except AttributeError:
1217.                 levels = messages.constants.DEFAULT_TAGS.values()
1218.                 levels_repr = ", ".join("`%s`" % level for level in levels)
1219.                 raise ValueError(
1220.                     "Bad message level string: `%s`. Possible values are: %s"
1221.                     % (level, levels_repr)
1222.                 )
1223. 
1224.         messages.add_message(
1225.             request, level, message, extra_tags=extra_tags, fail_silently=fail_silently
1226.         )
1227. 
1228.     def save_form(self, request, form, change):
1229.         """
1230.         Given a ModelForm return an unsaved instance. ``change`` is True if
1231.         the object is being changed, and False if it's being added.
1232.         """
1233.         return form.save(commit=False)
1234. 
1235.     def save_model(self, request, obj, form, change):
1236.         """
1237.         Given a model instance save it to the database.
1238.         """
1239.         obj.save()
1240. 
1241.     def delete_model(self, request, obj):
1242.         """
1243.         Given a model instance delete it from the database.
1244.         """
1245.         obj.delete()
1246. 
1247.     def delete_queryset(self, request, queryset):
1248.         """Given a queryset, delete it from the database."""
1249.         queryset.delete()
1250. 
1251.     def save_formset(self, request, form, formset, change):
1252.         """
1253.         Given an inline formset save it to the database.
1254.         """
1255.         formset.save()
1256. 
1257.     def save_related(self, request, form, formsets, change):
1258.         """
1259.         Given the ``HttpRequest``, the parent ``ModelForm`` instance, the
1260.         list of inline formsets and a boolean value based on whether the
1261.         parent is being added or changed, save the related objects to the
1262.         database. Note that at this point save_form() and save_model() have
1263.         already been called.
1264.         """
1265.         form.save_m2m()
1266.         for formset in formsets:
1267.             self.save_formset(request, form, formset, change=change)
1268. 
1269.     def render_change_form(
1270.         self, request, context, add=False, change=False, form_url="", obj=None
1271.     ):
1272.         app_label = self.opts.app_label
1273.         preserved_filters = self.get_preserved_filters(request)
1274.         form_url = add_preserved_filters(
1275.             {"preserved_filters": preserved_filters, "opts": self.opts}, form_url
1276.         )
1277.         view_on_site_url = self.get_view_on_site_url(obj)
1278.         has_editable_inline_admin_formsets = False
1279.         for inline in context["inline_admin_formsets"]:
1280.             if (
1281.                 inline.has_add_permission
1282.                 or inline.has_change_permission
1283.                 or inline.has_delete_permission
1284.             ):
1285.                 has_editable_inline_admin_formsets = True
1286.                 break
1287.         context.update(
1288.             {
1289.                 "add": add,
1290.                 "change": change,
1291.                 "has_view_permission": self.has_view_permission(request, obj),
1292.                 "has_add_permission": self.has_add_permission(request),
1293.                 "has_change_permission": self.has_change_permission(request, obj),
1294.                 "has_delete_permission": self.has_delete_permission(request, obj),
1295.                 "has_editable_inline_admin_formsets": (
1296.                     has_editable_inline_admin_formsets
1297.                 ),
1298.                 "has_file_field": context["adminform"].form.is_multipart()
1299.                 or any(
1300.                     admin_formset.formset.is_multipart()
1301.                     for admin_formset in context["inline_admin_formsets"]
1302.                 ),
1303.                 "has_absolute_url": view_on_site_url is not None,
1304.                 "absolute_url": view_on_site_url,
1305.                 "form_url": form_url,
1306.                 "opts": self.opts,
1307.                 "content_type_id": get_content_type_for_model(self.model).pk,
1308.                 "save_as": self.save_as,
1309.                 "save_on_top": self.save_on_top,
1310.                 "to_field_var": TO_FIELD_VAR,
1311.                 "is_popup_var": IS_POPUP_VAR,
1312.                 "app_label": app_label,
1313.             }
1314.         )
1315.         if add and self.add_form_template is not None:
1316.             form_template = self.add_form_template
1317.         else:
1318.             form_template = self.change_form_template
1319. 
1320.         request.current_app = self.admin_site.name
1321. 
1322.         return TemplateResponse(
1323.             request,
1324.             form_template
1325.             or [
1326.                 "admin/%s/%s/change_form.html" % (app_label, self.opts.model_name),
1327.                 "admin/%s/change_form.html" % app_label,
1328.                 "admin/change_form.html",
1329.             ],
1330.             context,
1331.         )
1332. 
1333.     def response_add(self, request, obj, post_url_continue=None):
1334.         """
1335.         Determine the HttpResponse for the add_view stage.
1336.         """
1337.         opts = obj._meta
1338.         preserved_filters = self.get_preserved_filters(request)
1339.         obj_url = reverse(
1340.             "admin:%s_%s_change" % (opts.app_label, opts.model_name),
1341.             args=(quote(obj.pk),),
1342.             current_app=self.admin_site.name,
1343.         )
1344.         # Add a link to the object's change form if the user can edit the obj.
1345.         if self.has_change_permission(request, obj):
1346.             obj_repr = format_html('<a href="{}">{}</a>', urlquote(obj_url), obj)
1347.         else:
1348.             obj_repr = str(obj)
1349.         msg_dict = {
1350.             "name": opts.verbose_name,
1351.             "obj": obj_repr,
1352.         }
1353.         # Here, we distinguish between different save types by checking for
1354.         # the presence of keys in request.POST.
1355. 
1356.         if IS_POPUP_VAR in request.POST:
1357.             to_field = request.POST.get(TO_FIELD_VAR)
1358.             if to_field:
1359.                 attr = str(to_field)
1360.             else:
1361.                 attr = obj._meta.pk.attname
1362.             value = obj.serializable_value(attr)
1363.             popup_response_data = json.dumps(
1364.                 {
1365.                     "value": str(value),
1366.                     "obj": str(obj),
1367.                 }
1368.             )
1369.             return TemplateResponse(
1370.                 request,
1371.                 self.popup_response_template
1372.                 or [
1373.                     "admin/%s/%s/popup_response.html"
1374.                     % (opts.app_label, opts.model_name),
1375.                     "admin/%s/popup_response.html" % opts.app_label,
1376.                     "admin/popup_response.html",
1377.                 ],
1378.                 {
1379.                     "popup_response_data": popup_response_data,
1380.                 },
1381.             )
1382. 
1383.         elif "_continue" in request.POST or (
1384.             # Redirecting after "Save as new".
1385.             "_saveasnew" in request.POST
1386.             and self.save_as_continue
1387.             and self.has_change_permission(request, obj)
1388.         ):
1389.             msg = _("The {name} “{obj}” was added successfully.")
1390.             if self.has_change_permission(request, obj):
1391.                 msg += " " + _("You may edit it again below.")
1392.             self.message_user(request, format_html(msg, **msg_dict), messages.SUCCESS)
1393.             if post_url_continue is None:
1394.                 post_url_continue = obj_url
1395.             post_url_continue = add_preserved_filters(
1396.                 {"preserved_filters": preserved_filters, "opts": opts},
1397.                 post_url_continue,
1398.             )
1399.             return HttpResponseRedirect(post_url_continue)
1400. 
1401.         elif "_addanother" in request.POST:
1402.             msg = format_html(
1403.                 _(
1404.                     "The {name} “{obj}” was added successfully. You may add another "
1405.                     "{name} below."
1406.                 ),
1407.                 **msg_dict,
1408.             )
1409.             self.message_user(request, msg, messages.SUCCESS)
1410.             redirect_url = request.path
1411.             redirect_url = add_preserved_filters(
1412.                 {"preserved_filters": preserved_filters, "opts": opts}, redirect_url
1413.             )
1414.             return HttpResponseRedirect(redirect_url)
1415. 
1416.         else:
1417.             msg = format_html(
1418.                 _("The {name} “{obj}” was added successfully."), **msg_dict
1419.             )
1420.             self.message_user(request, msg, messages.SUCCESS)
1421.             return self.response_post_save_add(request, obj)
1422. 
1423.     def response_change(self, request, obj):
1424.         """
1425.         Determine the HttpResponse for the change_view stage.
1426.         """
1427. 
1428.         if IS_POPUP_VAR in request.POST:
1429.             opts = obj._meta
1430.             to_field = request.POST.get(TO_FIELD_VAR)
1431.             attr = str(to_field) if to_field else opts.pk.attname
1432.             value = request.resolver_match.kwargs["object_id"]
1433.             new_value = obj.serializable_value(attr)
1434.             popup_response_data = json.dumps(
1435.                 {
1436.                     "action": "change",
1437.                     "value": str(value),
1438.                     "obj": str(obj),
1439.                     "new_value": str(new_value),
1440.                 }
1441.             )
1442.             return TemplateResponse(
1443.                 request,
1444.                 self.popup_response_template
1445.                 or [
1446.                     "admin/%s/%s/popup_response.html"
1447.                     % (opts.app_label, opts.model_name),
1448.                     "admin/%s/popup_response.html" % opts.app_label,
1449.                     "admin/popup_response.html",
1450.                 ],
1451.                 {
1452.                     "popup_response_data": popup_response_data,
1453.                 },
1454.             )
1455. 
1456.         opts = self.opts
1457.         preserved_filters = self.get_preserved_filters(request)
1458. 
1459.         msg_dict = {
1460.             "name": opts.verbose_name,
1461.             "obj": format_html('<a href="{}">{}</a>', urlquote(request.path), obj),
1462.         }
1463.         if "_continue" in request.POST:
1464.             msg = format_html(
1465.                 _(
1466.                     "The {name} “{obj}” was changed successfully. You may edit it "
1467.                     "again below."
1468.                 ),
1469.                 **msg_dict,
1470.             )
1471.             self.message_user(request, msg, messages.SUCCESS)
1472.             redirect_url = request.path
1473.             redirect_url = add_preserved_filters(
1474.                 {"preserved_filters": preserved_filters, "opts": opts}, redirect_url
1475.             )
1476.             return HttpResponseRedirect(redirect_url)
1477. 
1478.         elif "_saveasnew" in request.POST:
1479.             msg = format_html(
1480.                 _(
1481.                     "The {name} “{obj}” was added successfully. You may edit it again "
1482.                     "below."
1483.                 ),
1484.                 **msg_dict,
1485.             )
1486.             self.message_user(request, msg, messages.SUCCESS)
1487.             redirect_url = reverse(
1488.                 "admin:%s_%s_change" % (opts.app_label, opts.model_name),
1489.                 args=(obj.pk,),
1490.                 current_app=self.admin_site.name,
1491.             )
1492.             redirect_url = add_preserved_filters(
1493.                 {"preserved_filters": preserved_filters, "opts": opts}, redirect_url
1494.             )
1495.             return HttpResponseRedirect(redirect_url)
1496. 
1497.         elif "_addanother" in request.POST:
1498.             msg = format_html(
1499.                 _(
1500.                     "The {name} “{obj}” was changed successfully. You may add another "
1501.                     "{name} below."
1502.                 ),
1503.                 **msg_dict,
1504.             )
1505.             self.message_user(request, msg, messages.SUCCESS)
1506.             redirect_url = reverse(
1507.                 "admin:%s_%s_add" % (opts.app_label, opts.model_name),
1508.                 current_app=self.admin_site.name,
1509.             )
1510.             redirect_url = add_preserved_filters(
1511.                 {"preserved_filters": preserved_filters, "opts": opts}, redirect_url
1512.             )
1513.             return HttpResponseRedirect(redirect_url)
1514. 
1515.         else:
1516.             msg = format_html(
1517.                 _("The {name} “{obj}” was changed successfully."), **msg_dict
1518.             )
1519.             self.message_user(request, msg, messages.SUCCESS)
1520.             return self.response_post_save_change(request, obj)
1521. 
1522.     def _response_post_save(self, request, obj):
1523.         if self.has_view_or_change_permission(request):
1524.             post_url = reverse(
1525.                 "admin:%s_%s_changelist" % (self.opts.app_label, self.opts.model_name),
1526.                 current_app=self.admin_site.name,
1527.             )
1528.             preserved_filters = self.get_preserved_filters(request)
1529.             post_url = add_preserved_filters(
1530.                 {"preserved_filters": preserved_filters, "opts": self.opts}, post_url
1531.             )
1532.         else:
1533.             post_url = reverse("admin:index", current_app=self.admin_site.name)
1534.         return HttpResponseRedirect(post_url)
1535. 
1536.     def response_post_save_add(self, request, obj):
1537.         """
1538.         Figure out where to redirect after the 'Save' button has been pressed
1539.         when adding a new object.
1540.         """
1541.         return self._response_post_save(request, obj)
1542. 
1543.     def response_post_save_change(self, request, obj):
1544.         """
1545.         Figure out where to redirect after the 'Save' button has been pressed
1546.         when editing an existing object.
1547.         """
1548.         return self._response_post_save(request, obj)
1549. 
1550.     def response_action(self, request, queryset):
1551.         """
1552.         Handle an admin action. This is called if a request is POSTed to the
1553.         changelist; it returns an HttpResponse if the action was handled, and
1554.         None otherwise.
1555.         """
1556. 
1557.         # There can be multiple action forms on the page (at the top
1558.         # and bottom of the change list, for example). Get the action
1559.         # whose button was pushed.
1560.         try:
1561.             action_index = int(request.POST.get("index", 0))
1562.         except ValueError:
1563.             action_index = 0
1564. 
1565.         # Construct the action form.
1566.         data = request.POST.copy()
1567.         data.pop(helpers.ACTION_CHECKBOX_NAME, None)
1568.         data.pop("index", None)
1569. 
1570.         # Use the action whose button was pushed
1571.         try:
1572.             data.update({"action": data.getlist("action")[action_index]})
1573.         except IndexError:
1574.             # If we didn't get an action from the chosen form that's invalid
1575.             # POST data, so by deleting action it'll fail the validation check
1576.             # below. So no need to do anything here
1577.             pass
1578. 
1579.         action_form = self.action_form(data, auto_id=None)
1580.         action_form.fields["action"].choices = self.get_action_choices(request)
1581. 
1582.         # If the form's valid we can handle the action.
1583.         if action_form.is_valid():
1584.             action = action_form.cleaned_data["action"]
1585.             select_across = action_form.cleaned_data["select_across"]
1586.             func = self.get_actions(request)[action][0]
1587. 
1588.             # Get the list of selected PKs. If nothing's selected, we can't
1589.             # perform an action on it, so bail. Except we want to perform
1590.             # the action explicitly on all objects.
1591.             selected = request.POST.getlist(helpers.ACTION_CHECKBOX_NAME)
1592.             if not selected and not select_across:
1593.                 # Reminder that something needs to be selected or nothing will happen
1594.                 msg = _(
1595.                     "Items must be selected in order to perform "
1596.                     "actions on them. No items have been changed."
1597.                 )
1598.                 self.message_user(request, msg, messages.WARNING)
1599.                 return None
1600. 
1601.             if not select_across:
1602.                 # Perform the action only on the selected objects
1603.                 queryset = queryset.filter(pk__in=selected)
1604. 
1605.             response = func(self, request, queryset)
1606. 
1607.             # Actions may return an HttpResponse-like object, which will be
1608.             # used as the response from the POST. If not, we'll be a good
1609.             # little HTTP citizen and redirect back to the changelist page.
1610.             if isinstance(response, HttpResponseBase):
1611.                 return response
1612.             else:
1613.                 return HttpResponseRedirect(request.get_full_path())
1614.         else:
1615.             msg = _("No action selected.")
1616.             self.message_user(request, msg, messages.WARNING)
1617.             return None
1618. 
1619.     def response_delete(self, request, obj_display, obj_id):
1620.         """
1621.         Determine the HttpResponse for the delete_view stage.
1622.         """
1623.         if IS_POPUP_VAR in request.POST:
1624.             popup_response_data = json.dumps(
1625.                 {
1626.                     "action": "delete",
1627.                     "value": str(obj_id),
1628.                 }
1629.             )
1630.             return TemplateResponse(
1631.                 request,
1632.                 self.popup_response_template
1633.                 or [
1634.                     "admin/%s/%s/popup_response.html"
1635.                     % (self.opts.app_label, self.opts.model_name),
1636.                     "admin/%s/popup_response.html" % self.opts.app_label,
1637.                     "admin/popup_response.html",
1638.                 ],
1639.                 {
1640.                     "popup_response_data": popup_response_data,
1641.                 },
1642.             )
1643. 
1644.         self.message_user(
1645.             request,
1646.             _("The %(name)s “%(obj)s” was deleted successfully.")
1647.             % {
1648.                 "name": self.opts.verbose_name,
1649.                 "obj": obj_display,
1650.             },
1651.             messages.SUCCESS,
1652.         )
1653. 
1654.         if self.has_change_permission(request, None):
1655.             post_url = reverse(
1656.                 "admin:%s_%s_changelist" % (self.opts.app_label, self.opts.model_name),
1657.                 current_app=self.admin_site.name,
1658.             )
1659.             preserved_filters = self.get_preserved_filters(request)
1660.             post_url = add_preserved_filters(
1661.                 {"preserved_filters": preserved_filters, "opts": self.opts}, post_url
1662.             )
1663.         else:
1664.             post_url = reverse("admin:index", current_app=self.admin_site.name)
1665.         return HttpResponseRedirect(post_url)
1666. 
1667.     def render_delete_form(self, request, context):
1668.         app_label = self.opts.app_label
1669. 
1670.         request.current_app = self.admin_site.name
1671.         context.update(
1672.             to_field_var=TO_FIELD_VAR,
1673.             is_popup_var=IS_POPUP_VAR,
1674.             media=self.media,
1675.         )
1676. 
1677.         return TemplateResponse(
1678.             request,
1679.             self.delete_confirmation_template
1680.             or [
1681.                 "admin/{}/{}/delete_confirmation.html".format(
1682.                     app_label, self.opts.model_name
1683.                 ),
1684.                 "admin/{}/delete_confirmation.html".format(app_label),
1685.                 "admin/delete_confirmation.html",
1686.             ],
1687.             context,
1688.         )
1689. 
1690.     def get_inline_formsets(self, request, formsets, inline_instances, obj=None):
1691.         # Edit permissions on parent model are required for editable inlines.
1692.         can_edit_parent = (
1693.             self.has_change_permission(request, obj)
1694.             if obj
1695.             else self.has_add_permission(request)
1696.         )
1697.         inline_admin_formsets = []
1698.         for inline, formset in zip(inline_instances, formsets):
1699.             fieldsets = list(inline.get_fieldsets(request, obj))
1700.             readonly = list(inline.get_readonly_fields(request, obj))
1701.             if can_edit_parent:
1702.                 has_add_permission = inline.has_add_permission(request, obj)
1703.                 has_change_permission = inline.has_change_permission(request, obj)
1704.                 has_delete_permission = inline.has_delete_permission(request, obj)
1705.             else:
1706.                 # Disable all edit-permissions, and override formset settings.
1707.                 has_add_permission = (
1708.                     has_change_permission
1709.                 ) = has_delete_permission = False
1710.                 formset.extra = formset.max_num = 0
1711.             has_view_permission = inline.has_view_permission(request, obj)
1712.             prepopulated = dict(inline.get_prepopulated_fields(request, obj))
1713.             inline_admin_formset = helpers.InlineAdminFormSet(
1714.                 inline,
1715.                 formset,
1716.                 fieldsets,
1717.                 prepopulated,
1718.                 readonly,
1719.                 model_admin=self,
1720.                 has_add_permission=has_add_permission,
1721.                 has_change_permission=has_change_permission,
1722.                 has_delete_permission=has_delete_permission,
1723.                 has_view_permission=has_view_permission,
1724.             )
1725.             inline_admin_formsets.append(inline_admin_formset)
1726.         return inline_admin_formsets
1727. 
1728.     def get_changeform_initial_data(self, request):
1729.         """
1730.         Get the initial form data from the request's GET params.
1731.         """
1732.         initial = dict(request.GET.items())
1733.         for k in initial:
1734.             try:
1735.                 f = self.opts.get_field(k)
1736.             except FieldDoesNotExist:
1737.                 continue
1738.             # We have to special-case M2Ms as a list of comma-separated PKs.
1739.             if isinstance(f, models.ManyToManyField):
1740.                 initial[k] = initial[k].split(",")
1741.         return initial
1742. 
1743.     def _get_obj_does_not_exist_redirect(self, request, opts, object_id):
1744.         """
1745.         Create a message informing the user that the object doesn't exist
1746.         and return a redirect to the admin index page.
1747.         """
1748.         msg = _("%(name)s with ID “%(key)s” doesn’t exist. Perhaps it was deleted?") % {
1749.             "name": opts.verbose_name,
1750.             "key": unquote(object_id),
1751.         }
1752.         self.message_user(request, msg, messages.WARNING)
1753.         url = reverse("admin:index", current_app=self.admin_site.name)
1754.         return HttpResponseRedirect(url)
1755. 
1756.     @csrf_protect_m
1757.     def changeform_view(self, request, object_id=None, form_url="", extra_context=None):
1758.         with transaction.atomic(using=router.db_for_write(self.model)):
1759.             return self._changeform_view(request, object_id, form_url, extra_context)
1760. 
1761.     def _changeform_view(self, request, object_id, form_url, extra_context):
1762.         to_field = request.POST.get(TO_FIELD_VAR, request.GET.get(TO_FIELD_VAR))
1763.         if to_field and not self.to_field_allowed(request, to_field):
1764.             raise DisallowedModelAdminToField(
1765.                 "The field %s cannot be referenced." % to_field
1766.             )
1767. 
1768.         if request.method == "POST" and "_saveasnew" in request.POST:
1769.             object_id = None
1770. 
1771.         add = object_id is None
1772. 
1773.         if add:
1774.             if not self.has_add_permission(request):
1775.                 raise PermissionDenied
1776.             obj = None
1777. 
1778.         else:
1779.             obj = self.get_object(request, unquote(object_id), to_field)
1780. 
1781.             if request.method == "POST":
1782.                 if not self.has_change_permission(request, obj):
1783.                     raise PermissionDenied
1784.             else:
1785.                 if not self.has_view_or_change_permission(request, obj):
1786.                     raise PermissionDenied
1787. 
1788.             if obj is None:
1789.                 return self._get_obj_does_not_exist_redirect(
1790.                     request, self.opts, object_id
1791.                 )
1792. 
1793.         fieldsets = self.get_fieldsets(request, obj)
1794.         ModelForm = self.get_form(
1795.             request, obj, change=not add, fields=flatten_fieldsets(fieldsets)
1796.         )
1797.         if request.method == "POST":
1798.             form = ModelForm(request.POST, request.FILES, instance=obj)
1799.             formsets, inline_instances = self._create_formsets(
1800.                 request,
1801.                 form.instance,
1802.                 change=not add,
1803.             )
1804.             form_validated = form.is_valid()
1805.             if form_validated:
1806.                 new_object = self.save_form(request, form, change=not add)
1807.             else:
1808.                 new_object = form.instance
1809.             if all_valid(formsets) and form_validated:
1810.                 self.save_model(request, new_object, form, not add)
1811.                 self.save_related(request, form, formsets, not add)
1812.                 change_message = self.construct_change_message(
1813.                     request, form, formsets, add
1814.                 )
1815.                 if add:
1816.                     self.log_addition(request, new_object, change_message)
1817.                     return self.response_add(request, new_object)
1818.                 else:
1819.                     self.log_change(request, new_object, change_message)
1820.                     return self.response_change(request, new_object)
1821.             else:
1822.                 form_validated = False
1823.         else:
1824.             if add:
1825.                 initial = self.get_changeform_initial_data(request)
1826.                 form = ModelForm(initial=initial)
1827.                 formsets, inline_instances = self._create_formsets(
1828.                     request, form.instance, change=False
1829.                 )
1830.             else:
1831.                 form = ModelForm(instance=obj)
1832.                 formsets, inline_instances = self._create_formsets(
1833.                     request, obj, change=True
1834.                 )
1835. 
1836.         if not add and not self.has_change_permission(request, obj):
1837.             readonly_fields = flatten_fieldsets(fieldsets)
1838.         else:
1839.             readonly_fields = self.get_readonly_fields(request, obj)
1840.         admin_form = helpers.AdminForm(
1841.             form,
1842.             list(fieldsets),
1843.             # Clear prepopulated fields on a view-only form to avoid a crash.
1844.             self.get_prepopulated_fields(request, obj)
1845.             if add or self.has_change_permission(request, obj)
1846.             else {},
1847.             readonly_fields,
1848.             model_admin=self,
1849.         )
1850.         media = self.media + admin_form.media
1851. 
1852.         inline_formsets = self.get_inline_formsets(
1853.             request, formsets, inline_instances, obj
1854.         )
1855.         for inline_formset in inline_formsets:
1856.             media += inline_formset.media
1857. 
1858.         if add:
1859.             title = _("Add %s")
1860.         elif self.has_change_permission(request, obj):
1861.             title = _("Change %s")
1862.         else:
1863.             title = _("View %s")
1864.         context = {
1865.             **self.admin_site.each_context(request),
1866.             "title": title % self.opts.verbose_name,
1867.             "subtitle": str(obj) if obj else None,
1868.             "adminform": admin_form,
1869.             "object_id": object_id,
1870.             "original": obj,
1871.             "is_popup": IS_POPUP_VAR in request.POST or IS_POPUP_VAR in request.GET,
1872.             "to_field": to_field,
1873.             "media": media,
1874.             "inline_admin_formsets": inline_formsets,
1875.             "errors": helpers.AdminErrorList(form, formsets),
1876.             "preserved_filters": self.get_preserved_filters(request),
1877.         }
1878. 
1879.         # Hide the "Save" and "Save and continue" buttons if "Save as New" was
1880.         # previously chosen to prevent the interface from getting confusing.
1881.         if (
1882.             request.method == "POST"
1883.             and not form_validated
1884.             and "_saveasnew" in request.POST
1885.         ):
1886.             context["show_save"] = False
1887.             context["show_save_and_continue"] = False
1888.             # Use the change template instead of the add template.
1889.             add = False
1890. 
1891.         context.update(extra_context or {})
1892. 
1893.         return self.render_change_form(
1894.             request, context, add=add, change=not add, obj=obj, form_url=form_url
1895.         )
1896. 
1897.     def add_view(self, request, form_url="", extra_context=None):
1898.         return self.changeform_view(request, None, form_url, extra_context)
1899. 
1900.     def change_view(self, request, object_id, form_url="", extra_context=None):
1901.         return self.changeform_view(request, object_id, form_url, extra_context)
1902. 
1903.     def _get_edited_object_pks(self, request, prefix):
1904.         """Return POST data values of list_editable primary keys."""
1905.         pk_pattern = re.compile(
1906.             r"{}-\d+-{}$".format(re.escape(prefix), self.opts.pk.name)
1907.         )
1908.         return [value for key, value in request.POST.items() if pk_pattern.match(key)]
1909. 
1910.     def _get_list_editable_queryset(self, request, prefix):
1911.         """
1912.         Based on POST data, return a queryset of the objects that were edited
1913.         via list_editable.
1914.         """
1915.         object_pks = self._get_edited_object_pks(request, prefix)
1916.         queryset = self.get_queryset(request)
1917.         validate = queryset.model._meta.pk.to_python
1918.         try:
1919.             for pk in object_pks:
1920.                 validate(pk)
1921.         except ValidationError:
1922.             # Disable the optimization if the POST data was tampered with.
1923.             return queryset
1924.         return queryset.filter(pk__in=object_pks)
1925. 
1926.     @csrf_protect_m
1927.     def changelist_view(self, request, extra_context=None):
1928.         """
1929.         The 'change list' admin view for this model.
1930.         """
1931.         from django.contrib.admin.views.main import ERROR_FLAG
1932. 
1933.         app_label = self.opts.app_label
1934.         if not self.has_view_or_change_permission(request):
1935.             raise PermissionDenied
1936. 
1937.         try:
1938.             cl = self.get_changelist_instance(request)
1939.         except IncorrectLookupParameters:
1940.             # Wacky lookup parameters were given, so redirect to the main
1941.             # changelist page, without parameters, and pass an 'invalid=1'
1942.             # parameter via the query string. If wacky parameters were given
1943.             # and the 'invalid=1' parameter was already in the query string,
1944.             # something is screwed up with the database, so display an error
1945.             # page.
1946.             if ERROR_FLAG in request.GET:
1947.                 return SimpleTemplateResponse(
1948.                     "admin/invalid_setup.html",
1949.                     {
1950.                         "title": _("Database error"),
1951.                     },
1952.                 )
1953.             return HttpResponseRedirect(request.path + "?" + ERROR_FLAG + "=1")
1954. 
1955.         # If the request was POSTed, this might be a bulk action or a bulk
1956.         # edit. Try to look up an action or confirmation first, but if this
1957.         # isn't an action the POST will fall through to the bulk edit check,
1958.         # below.
1959.         action_failed = False
1960.         selected = request.POST.getlist(helpers.ACTION_CHECKBOX_NAME)
1961. 
1962.         actions = self.get_actions(request)
1963.         # Actions with no confirmation
1964.         if (
1965.             actions
1966.             and request.method == "POST"
1967.             and "index" in request.POST
1968.             and "_save" not in request.POST
1969.         ):
1970.             if selected:
1971.                 response = self.response_action(
1972.                     request, queryset=cl.get_queryset(request)
1973.                 )
1974.                 if response:
1975.                     return response
1976.                 else:
1977.                     action_failed = True
1978.             else:
1979.                 msg = _(
1980.                     "Items must be selected in order to perform "
1981.                     "actions on them. No items have been changed."
1982.                 )
1983.                 self.message_user(request, msg, messages.WARNING)
1984.                 action_failed = True
1985. 
1986.         # Actions with confirmation
1987.         if (
1988.             actions
1989.             and request.method == "POST"
1990.             and helpers.ACTION_CHECKBOX_NAME in request.POST
1991.             and "index" not in request.POST
1992.             and "_save" not in request.POST
1993.         ):
1994.             if selected:
1995.                 response = self.response_action(
1996.                     request, queryset=cl.get_queryset(request)
1997.                 )
1998.                 if response:
1999.                     return response
2000.                 else:

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-24 05:47:26,440 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="The user has explicitly requested the full content of the file 'django/contrib/admin/options.py'. The provided context contains the content of this file from line 1 to 2000, which directly and completely answers the user's query.", relative_path='django/contrib/admin/options.py', start_line=1, end_line=2000)]
2025-12-24 05:47:26,444 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of the file django/contrib/admin/options.py.
2025-12-24 05:47:26,444 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-24 05:47:26,444 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-24 05:47:26,445 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 0 existing contexts
2025-12-24 05:47:26,445 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 1 total contexts (removed 0 duplicates)
2025-12-24 05:47:26,446 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .github
|   ├── CODE_OF_CONDUCT.md
|   ├── FUNDING.yml
|   ├── SECURITY.md
|   └── workflows
|       ├── benchmark.yml
|       ├── docs.yml
|       ├── linters.yml
|       ├── new_contributor_pr.yml
|       ├── schedule_tests.yml
|       ├── schedules.yml
|       └── tests.yml
├── .pre-commit-config.yaml
├── .readthedocs.yml
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ar_DZ
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ckb
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ig
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ky
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ms
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uz
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   ├── 0012_alter_user_first_name_max_length.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   └── options.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── constraints.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── ms
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── tg
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── uz
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_redirect_new_path_help_text.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── templates
|   |   |   |   ├── sitemap.xml
|   |   |   |   └── sitemap_index.xml
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── asgi.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   ├── memcached.py
|   |   |   |   └── redis.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── async_checks.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   ├── __init__.py
|   |   |   |   └── django_4_0.py
|   |   |   ├── database.py
|   |   |   ├── files.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── filesystem.py
|   |   |   |   ├── handler.py
|   |   |   |   ├── memory.py
|   |   |   |   └── mixins.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── asgi.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── __init__.py
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── optimizemigration.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── jsonl.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── psycopg_any.py
|   |   |   |   └── schema.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _functions.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   └── special.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── enums.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── json.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── autoreload.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── asyncio.py
|   |   ├── autoreload.py
|   |   ├── cache.py
|   |   ├── connection.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── common.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           ├── csrf_403.html
|           ├── default_urlconf.html
|           ├── directory_index.html
|           ├── i18n_catalog.js
|           ├── technical_404.html
|           ├── technical_500.html
|           └── technical_500.txt
├── docs
|   ├── README.rst
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   ├── genindex.html
|   |   |   ├── layout.html
|   |   |   ├── modindex.html
|   |   |   ├── search.html
|   |   |   └── static
|   |   |       ├── console-tabs.css
|   |   |       ├── default.css
|   |   |       ├── djangodocs.css
|   |   |       ├── fontawesome
|   |   |       ├── homepage.css
|   |   |       └── reset-fonts-grids.css
|   |   └── djangodocs-epub
|   |       ├── epub-cover.html
|   |       └── static
|   |           └── epub.css
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── _images
|   |   ├── auth-remote-user.txt
|   |   ├── csrf.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-backend.txt
|   |   ├── custom-template-tags.txt
|   |   ├── deployment
|   |   |   ├── asgi
|   |   |   |   ├── daphne.txt
|   |   |   |   ├── hypercorn.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── uvicorn.txt
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── legacy-databases.txt
|   |   ├── logging.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   ├── tutorial08.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── filters.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── constraints.txt
|   |   |   |   ├── expressions.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── logging.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── paginator.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.19.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.20.txt
|   |   ├── 1.11.21.txt
|   |   ├── 1.11.22.txt
|   |   ├── 1.11.23.txt
|   |   ├── 1.11.24.txt
|   |   ├── 1.11.25.txt
|   |   ├── 1.11.26.txt
|   |   ├── 1.11.27.txt
|   |   ├── 1.11.28.txt
|   |   ├── 1.11.29.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.11.txt
|   |   ├── 2.0.12.txt
|   |   ├── 2.0.13.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.10.txt
|   |   ├── 2.1.11.txt
|   |   ├── 2.1.12.txt
|   |   ├── 2.1.13.txt
|   |   ├── 2.1.14.txt
|   |   ├── 2.1.15.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.7.txt
|   |   ├── 2.1.8.txt
|   |   ├── 2.1.9.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.1.txt
|   |   ├── 2.2.10.txt
|   |   ├── 2.2.11.txt
|   |   ├── 2.2.12.txt
|   |   ├── 2.2.13.txt
|   |   ├── 2.2.14.txt
|   |   ├── 2.2.15.txt
|   |   ├── 2.2.16.txt
|   |   ├── 2.2.17.txt
|   |   ├── 2.2.18.txt
|   |   ├── 2.2.19.txt
|   |   ├── 2.2.2.txt
|   |   ├── 2.2.20.txt
|   |   ├── 2.2.21.txt
|   |   ├── 2.2.22.txt
|   |   ├── 2.2.23.txt
|   |   ├── 2.2.24.txt
|   |   ├── 2.2.25.txt
|   |   ├── 2.2.26.txt
|   |   ├── 2.2.27.txt
|   |   ├── 2.2.28.txt
|   |   ├── 2.2.3.txt
|   |   ├── 2.2.4.txt
|   |   ├── 2.2.5.txt
|   |   ├── 2.2.6.txt
|   |   ├── 2.2.7.txt
|   |   ├── 2.2.8.txt
|   |   ├── 2.2.9.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.1.txt
|   |   ├── 3.0.10.txt
|   |   ├── 3.0.11.txt
|   |   ├── 3.0.12.txt
|   |   ├── 3.0.13.txt
|   |   ├── 3.0.14.txt
|   |   ├── 3.0.2.txt
|   |   ├── 3.0.3.txt
|   |   ├── 3.0.4.txt
|   |   ├── 3.0.5.txt
|   |   ├── 3.0.6.txt
|   |   ├── 3.0.7.txt
|   |   ├── 3.0.8.txt
|   |   ├── 3.0.9.txt
|   |   ├── 3.0.txt
|   |   ├── 3.1.1.txt
|   |   ├── 3.1.10.txt
|   |   ├── 3.1.11.txt
|   |   ├── 3.1.12.txt
|   |   ├── 3.1.13.txt
|   |   ├── 3.1.14.txt
|   |   ├── 3.1.2.txt
|   |   ├── 3.1.3.txt
|   |   ├── 3.1.4.txt
|   |   ├── 3.1.5.txt
|   |   ├── 3.1.6.txt
|   |   ├── 3.1.7.txt
|   |   ├── 3.1.8.txt
|   |   ├── 3.1.9.txt
|   |   ├── 3.1.txt
|   |   ├── 3.2.1.txt
|   |   ├── 3.2.10.txt
|   |   ├── 3.2.11.txt
|   |   ├── 3.2.12.txt
|   |   ├── 3.2.13.txt
|   |   ├── 3.2.14.txt
|   |   ├── 3.2.15.txt
|   |   ├── 3.2.16.txt
|   |   ├── 3.2.17.txt
|   |   ├── 3.2.18.txt
|   |   ├── 3.2.2.txt
|   |   ├── 3.2.3.txt
|   |   ├── 3.2.4.txt
|   |   ├── 3.2.5.txt
|   |   ├── 3.2.6.txt
|   |   ├── 3.2.7.txt
|   |   ├── 3.2.8.txt
|   |   ├── 3.2.9.txt
|   |   ├── 3.2.txt
|   |   ├── 4.0.1.txt
|   |   ├── 4.0.10.txt
|   |   ├── 4.0.2.txt
|   |   ├── 4.0.3.txt
|   |   ├── 4.0.4.txt
|   |   ├── 4.0.5.txt
|   |   ├── 4.0.6.txt
|   |   ├── 4.0.7.txt
|   |   ├── 4.0.8.txt
|   |   ├── 4.0.9.txt
|   |   ├── 4.0.txt
|   |   ├── 4.1.1.txt
|   |   ├── 4.1.2.txt
|   |   ├── 4.1.3.txt
|   |   ├── 4.1.4.txt
|   |   ├── 4.1.5.txt
|   |   ├── 4.1.6.txt
|   |   ├── 4.1.7.txt
|   |   ├── 4.1.8.txt
|   |   ├── 4.1.txt
|   |   ├── 4.2.txt
|   |   ├── 5.0.txt
|   |   ├── index.txt
|   |   └── security.txt
|   ├── requirements.txt
|   └── topics
|       ├── async.txt
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── fixtures.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   ├── jsi18n-mocks.test.js
|   |   └── navigation.test.js
|   ├── gis
|   |   └── mapwidget.test.js
|   └── tests.html
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_dynamic_settings_manage.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── .hidden
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       ├── noargs_command.py
    |   |       └── suppress_base_options_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── admin
    |   |   |   ├── admin_views
    |   |   |   └── base_site.html
    |   |   └── custom_filter_template.html
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_breadcrumbs.py
    |   ├── test_forms.py
    |   ├── test_history_view.py
    |   ├── test_multidb.py
    |   ├── test_nav_sidebar.py
    |   ├── test_skip_link_to_content.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   ├── no_config_app
    |   |   └── __init__.py
    |   ├── one_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── tests.py
    |   ├── two_configs_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── two_configs_one_default_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   └── two_default_configs_app
    |       ├── __init__.py
    |       └── apps.py
    ├── asgi
    |   ├── __init__.py
    |   ├── project
    |   |   └── static
    |   |       └── file.txt
    |   ├── tests.py
    |   └── urls.py
    ├── async
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_async_model_methods.py
    |   ├── test_async_queryset.py
    |   ├── test_async_related_managers.py
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   ├── with_last_login_attr.py
    |   |   ├── with_many_to_many.py
    |   |   └── with_unique_constraint.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   |   ├── auth_attrs_access.html
    |   |   |   ├── auth_attrs_messages.html
    |   |   |   ├── auth_attrs_no_access.html
    |   |   |   ├── auth_attrs_perm_in_perms.html
    |   |   |   ├── auth_attrs_perms.html
    |   |   |   ├── auth_attrs_test_access.html
    |   |   |   └── auth_attrs_user.html
    |   |   └── registration
    |   |       ├── html_password_reset_email.html
    |   |       ├── logged_out.html
    |   |       ├── login.html
    |   |       ├── password_change_form.html
    |   |       ├── password_reset_complete.html
    |   |       ├── password_reset_confirm.html
    |   |       ├── password_reset_done.html
    |   |       ├── password_reset_email.html
    |   |       ├── password_reset_form.html
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_remote_user.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── app_unmigrated
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── test_base.py
    |   |   ├── test_client.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_functions.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   ├── tests.py
    |   └── tests_async.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── template_test_apps
    |   |   ├── __init__.py
    |   |   ├── different_tags_app
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   ├── same_tags_app_1
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   └── same_tags_app_2
    |   |       ├── __init__.py
    |   |       ├── apps.py
    |   |       └── templatetags
    |   ├── test_4_0_compatibility.py
    |   ├── test_async_checks.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_files.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_class_based_error_handlers.py
    |       ├── bad_error_handlers_invalid_path.py
    |       ├── bad_function_based_error_handlers.py
    |       ├── beginning_with_slash.py
    |       ├── cbv_as_view.py
    |       ├── contains_tuple.py
    |       ├── good_class_based_error_handlers.py
    |       ├── good_function_based_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   └── ending_with_dollar.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_migrations.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   |       ├── debug.html
    |   |       └── request_attrs.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_collate.py
    |   |   ├── test_greatest.py
    |   |   ├── test_json_object.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_random.py
    |   |   ├── test_round.py
    |   |   ├── test_sign.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_md5.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_sha1.py
    |   |   ├── test_sha224.py
    |   |   ├── test_sha256.py
    |   |   ├── test_sha384.py
    |   |   ├── test_sha512.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── fake_client.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   ├── test_postgresql.py
    |   ├── test_sqlite.py
    |   └── tests.py
    ├── decorators
    |   ├── __init__.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   ├── test_middleware_mixin.py
    |   ├── test_storages.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── empty_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── test_commands.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── test_inmemory_storage.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── fixture2.xml
    |   |   ├── fixture3.xml
    |   |   ├── fixture7.xml
    |   |   └── fixture9.xml
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── animal.xml
    |   |   ├── bad_fixture2.xml
    |   |   ├── nk-inheritance2.xml
    |   |   ├── non_natural_2.xml
    |   |   ├── pretty.xml
    |   |   └── sequence_extra_xml.xml
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── absolute_urls.py
    |   ├── no_slash_urls.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   |   └── default.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_jsonfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   |       └── custom_widget.html
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   |       ├── article_form.html
    |   |       ├── custom_field.html
    |   |       ├── custom_widget.html
    |   |       ├── cyclic_context_boundfield_render.html
    |   |       ├── error.html
    |   |       ├── form_snippet.html
    |   |       ├── legend_test.html
    |   |       └── use_fieldset.html
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   └── tags.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   |       └── using.html
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   ├── about.html
    |   |   |   ├── apple_detail.html
    |   |   |   ├── artist_detail.html
    |   |   |   ├── artist_form.html
    |   |   |   ├── author_confirm_delete.html
    |   |   |   ├── author_detail.html
    |   |   |   ├── author_form.html
    |   |   |   ├── author_list.html
    |   |   |   ├── author_objects.html
    |   |   |   ├── author_view.html
    |   |   |   ├── book_archive.html
    |   |   |   ├── book_archive_day.html
    |   |   |   ├── book_archive_month.html
    |   |   |   ├── book_archive_week.html
    |   |   |   ├── book_archive_year.html
    |   |   |   ├── book_detail.html
    |   |   |   ├── book_list.html
    |   |   |   ├── confirm_delete.html
    |   |   |   ├── detail.html
    |   |   |   ├── form.html
    |   |   |   ├── list.html
    |   |   |   ├── page_template.html
    |   |   |   ├── robots.txt
    |   |   |   └── using.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── has_nulls
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   ├── test_srs.py
    |   |   └── tests.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_indexes.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_create_models.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_rastermodels.py
    |   |   |   └── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   |   └── test_handler.html
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   |   └── ignored.html
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   |   └── media_ignored.html
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   ├── javascript_ignored.js
    |   |   |   └── static_ignored.html
    |   |   └── templates
    |   |       ├── empty.html
    |   |       ├── subdir
    |   |       ├── test.html
    |   |       └── xxx_ignored.html
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── loading
    |   |   ├── en
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_AU
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_CA
    |   |   |   └── LC_MESSAGES
    |   |   └── en_NZ
    |   |       └── LC_MESSAGES
    |   ├── loading_app
    |   |   ├── __init__.py
    |   |   ├── apps.py
    |   |   └── locale
    |   |       └── en
    |   ├── models.py
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   |   ├── 404.html
    |   |   |   └── dummy.html
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── models.py
    |   |   |   └── test.html
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   |   └── percents.html
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── unchanged
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   ├── tests.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_fake_initial_case_insensitive
    |   |   ├── fake_initial
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── initial
    |   |       ├── 0001_initial.py
    |   |       └── __init__.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_conflict_long_name
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second_migration_with_long_name.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_manual_porting
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   └── __init__.py
    |   ├── test_migrations_namespace_package
    |   |   └── 0001_initial.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_no_operations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_noop
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   ├── 0005_fifth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_no_replaces
    |   |   ├── 0001_squashed_0002.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_enums
    |   ├── __init__.py
    |   └── tests.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autofield.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_filepathfield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_jsonfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_pk.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── model_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── integration_settings.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_constraints.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_integration.py
    |   ├── test_introspection.py
    |   ├── test_operations.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_contains.py
    |   ├── test_db_returning.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   ├── test_sqlcompiler.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests_tests
    |   ├── __init__.py
    |   ├── test_accept_header.py
    |   ├── test_data_upload_settings.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_jsonl.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_clear_expired.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   |       └── using.html
    |   ├── templates
    |   |   └── shortcuts
    |   |       ├── render_test.html
    |   |       └── using.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── custom_sitemap.xml
    |   |   └── custom_sitemap_lastmod_index.xml
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   ├── test_management.py
    |   ├── test_utils.py
    |   └── urls
    |       ├── __init__.py
    |       ├── empty.py
    |       ├── http.py
    |       ├── https.py
    |       ├── index_only.py
    |       └── sitemap_only.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── absolute_root.css
    |   |   |   ├── absolute_root.js
    |   |   |   ├── cached
    |   |   |   ├── nested
    |   |   |   ├── styles_root.css
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   |   └── faulty.css
    |   |   ├── loop
    |   |   |   ├── bar.css
    |   |   |   └── foo.css
    |   |   ├── nonutf8
    |   |   |   └── nonutf8.css
    |   |   ├── pathlib
    |   |   |   └── pathlib.txt
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   |       ├── description.html
    |   |       ├── description_context.html
    |   |       ├── title.html
    |   |       └── title_context.html
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   |       └── hello.html
    |   ├── jinja2
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       ├── syntax_error.html
    |   |       ├── syntax_error2.html
    |   |       └── syntax_error_include.html
    |   ├── template_strings
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       └── syntax_error.html
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_loader
    |   |       ├── goodbye.html
    |   |       ├── hello.html
    |   |       └── request.html
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   |       └── using.html
    |   ├── other_templates
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   └── test_dirs.html
    |   ├── recursive_templates
    |   |   ├── fs
    |   |   |   ├── extend-missing.html
    |   |   |   ├── one.html
    |   |   |   ├── other-recursive.html
    |   |   |   ├── recursive.html
    |   |   |   ├── self.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── fs2
    |   |   |   └── recursive.html
    |   |   └── fs3
    |   |       └── recursive.html
    |   ├── relative_templates
    |   |   ├── dir1
    |   |   |   ├── dir2
    |   |   |   ├── looped.html
    |   |   |   ├── one.html
    |   |   |   ├── one1.html
    |   |   |   ├── one2.html
    |   |   |   ├── one3.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── error_extends.html
    |   |   ├── error_include.html
    |   |   ├── one.html
    |   |   ├── one_var.html
    |   |   ├── three.html
    |   |   └── two.html
    |   ├── syntax_tests
    |   |   ├── __init__.py
    |   |   ├── i18n
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: ModelAdmin.lookup_allowed() incorrectly raises DisallowedModelAdminLookup lookup with foreign key as primary key

Description: Description
	 
		(last modified by Tim Graham)
	 
Wrote a failing test for tests/modeladmin/tests.py to demonstrate - same test/code passes on 1.8
@isolate_apps('modeladmin')
def test_lookup_allowed_foreign_primary(self):
	class Country(models.Model):
		name = models.CharField(max_length=256)
	class Place(models.Model):
		country = models.ForeignKey(Country, models.CASCADE)
	class Restaurant(models.Model):
		place = models.OneToOneField(Place, models.CASCADE, primary_key=True)
	class Waiter(models.Model):
		restaurant = models.ForeignKey(Restaurant, models.CASCADE)
	class WaiterAdmin(ModelAdmin):
		list_filter = [
			'restaurant__place__country',
		]
	ma = WaiterAdmin(Waiter, self.site)
	self.assertIs(ma.lookup_allowed('restaurant__place__country', 'test_value'), True)
I think this is caused by the admin thinking that having a foreign key field as a primary key is the same as concrete inheritance. So when you try and check lookups for restaurant__place__country it thinks 'place' is the concrete parent of 'restaurant' and shortcuts it to restaurant__country which isn't in 'list_filter'. And you can't add restaurant__country to list_filter because country isn't actually on restaurant.

Patch information:
diff --git a/django/contrib/admin/options.py b/django/contrib/admin/options.py
index 5240b07cd6..b7b639d0c8 100644
--- a/django/contrib/admin/options.py
+++ b/django/contrib/admin/options.py
@@ -464,9 +464,17 @@ class BaseModelAdmin(metaclass=forms.MediaDefiningClass):
             # It is allowed to filter on values that would be found from local
             # model anyways. For example, if you filter on employee__department__id,
             # then the id value would be found already from employee__department_id.
-            if not prev_field or (
-                prev_field.is_relation
-                and field not in prev_field.path_infos[-1].target_fields
+            # However, if the target field is itself relational (e.g., a OneToOneField
+            # used as a primary key), don't collapse that step.
+            if (
+                not prev_field
+                or (
+                    prev_field.is_relation
+                    and (
+                        field not in prev_field.path_infos[-1].target_fields
+                        or getattr(field, "is_relation", False)
+                    )
+                )
             ):
                 relation_parts.append(part)
             if not getattr(field, "path_infos", None):


Find all relevant source code context needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of the file django/contrib/admin/options.py.
Extra Requirements: 
Purpose: This file contains the `lookup_allowed` method that needs to be fixed, and having its full content is essential to understand the logic and apply the patch correctly.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: django/contrib/admin/options.py
Line number range: 1 - 2000
Content:
1. import copy
2. import enum
3. import json
4. import re
5. from functools import partial, update_wrapper
6. from urllib.parse import quote as urlquote
7. 
8. from django import forms
9. from django.conf import settings
10. from django.contrib import messages
11. from django.contrib.admin import helpers, widgets
12. from django.contrib.admin.checks import (
13.     BaseModelAdminChecks,
14.     InlineModelAdminChecks,
15.     ModelAdminChecks,
16. )
17. from django.contrib.admin.exceptions import DisallowedModelAdminToField
18. from django.contrib.admin.templatetags.admin_urls import add_preserved_filters
19. from django.contrib.admin.utils import (
20.     NestedObjects,
21.     construct_change_message,
22.     flatten_fieldsets,
23.     get_deleted_objects,
24.     lookup_spawns_duplicates,
25.     model_format_dict,
26.     model_ngettext,
27.     quote,
28.     unquote,
29. )
30. from django.contrib.admin.widgets import AutocompleteSelect, AutocompleteSelectMultiple
31. from django.contrib.auth import get_permission_codename
32. from django.core.exceptions import (
33.     FieldDoesNotExist,
34.     FieldError,
35.     PermissionDenied,
36.     ValidationError,
37. )
38. from django.core.paginator import Paginator
39. from django.db import models, router, transaction
40. from django.db.models.constants import LOOKUP_SEP
41. from django.forms.formsets import DELETION_FIELD_NAME, all_valid
42. from django.forms.models import (
43.     BaseInlineFormSet,
44.     inlineformset_factory,
45.     modelform_defines_fields,
46.     modelform_factory,
47.     modelformset_factory,
48. )
49. from django.forms.widgets import CheckboxSelectMultiple, SelectMultiple
50. from django.http import HttpResponseRedirect
51. from django.http.response import HttpResponseBase
52. from django.template.response import SimpleTemplateResponse, TemplateResponse
53. from django.urls import reverse
54. from django.utils.decorators import method_decorator
55. from django.utils.html import format_html
56. from django.utils.http import urlencode
57. from django.utils.safestring import mark_safe
58. from django.utils.text import (
59.     capfirst,
60.     format_lazy,
61.     get_text_list,
62.     smart_split,
63.     unescape_string_literal,
64. )
65. from django.utils.translation import gettext as _
66. from django.utils.translation import ngettext
67. from django.views.decorators.csrf import csrf_protect
68. from django.views.generic import RedirectView
69. 
70. IS_POPUP_VAR = "_popup"
71. TO_FIELD_VAR = "_to_field"
72. IS_FACETS_VAR = "_facets"
73. 
74. 
75. class ShowFacets(enum.Enum):
76.     NEVER = "NEVER"
77.     ALLOW = "ALLOW"
78.     ALWAYS = "ALWAYS"
79. 
80. 
81. HORIZONTAL, VERTICAL = 1, 2
82. 
83. 
84. def get_content_type_for_model(obj):
85.     # Since this module gets imported in the application's root package,
86.     # it cannot import models from other applications at the module level.
87.     from django.contrib.contenttypes.models import ContentType
88. 
89.     return ContentType.objects.get_for_model(obj, for_concrete_model=False)
90. 
91. 
92. def get_ul_class(radio_style):
93.     return "radiolist" if radio_style == VERTICAL else "radiolist inline"
94. 
95. 
96. class IncorrectLookupParameters(Exception):
97.     pass
98. 
99. 
100. # Defaults for formfield_overrides. ModelAdmin subclasses can change this
101. # by adding to ModelAdmin.formfield_overrides.
102. 
103. FORMFIELD_FOR_DBFIELD_DEFAULTS = {
104.     models.DateTimeField: {
105.         "form_class": forms.SplitDateTimeField,
106.         "widget": widgets.AdminSplitDateTime,
107.     },
108.     models.DateField: {"widget": widgets.AdminDateWidget},
109.     models.TimeField: {"widget": widgets.AdminTimeWidget},
110.     models.TextField: {"widget": widgets.AdminTextareaWidget},
111.     models.URLField: {"widget": widgets.AdminURLFieldWidget},
112.     models.IntegerField: {"widget": widgets.AdminIntegerFieldWidget},
113.     models.BigIntegerField: {"widget": widgets.AdminBigIntegerFieldWidget},
114.     models.CharField: {"widget": widgets.AdminTextInputWidget},
115.     models.ImageField: {"widget": widgets.AdminFileWidget},
116.     models.FileField: {"widget": widgets.AdminFileWidget},
117.     models.EmailField: {"widget": widgets.AdminEmailInputWidget},
118.     models.UUIDField: {"widget": widgets.AdminUUIDInputWidget},
119. }
120. 
121. csrf_protect_m = method_decorator(csrf_protect)
122. 
123. 
124. class BaseModelAdmin(metaclass=forms.MediaDefiningClass):
125.     """Functionality common to both ModelAdmin and InlineAdmin."""
126. 
127.     autocomplete_fields = ()
128.     raw_id_fields = ()
129.     fields = None
130.     exclude = None
131.     fieldsets = None
132.     form = forms.ModelForm
133.     filter_vertical = ()
134.     filter_horizontal = ()
135.     radio_fields = {}
136.     prepopulated_fields = {}
137.     formfield_overrides = {}
138.     readonly_fields = ()
139.     ordering = None
140.     sortable_by = None
141.     view_on_site = True
142.     show_full_result_count = True
143.     checks_class = BaseModelAdminChecks
144. 
145.     def check(self, **kwargs):
146.         return self.checks_class().check(self, **kwargs)
147. 
148.     def __init__(self):
149.         # Merge FORMFIELD_FOR_DBFIELD_DEFAULTS with the formfield_overrides
150.         # rather than simply overwriting.
151.         overrides = copy.deepcopy(FORMFIELD_FOR_DBFIELD_DEFAULTS)
152.         for k, v in self.formfield_overrides.items():
153.             overrides.setdefault(k, {}).update(v)
154.         self.formfield_overrides = overrides
155. 
156.     def formfield_for_dbfield(self, db_field, request, **kwargs):
157.         """
158.         Hook for specifying the form Field instance for a given database Field
159.         instance.
160. 
161.         If kwargs are given, they're passed to the form Field's constructor.
162.         """
163.         # If the field specifies choices, we don't need to look for special
164.         # admin widgets - we just need to use a select widget of some kind.
165.         if db_field.choices:
166.             return self.formfield_for_choice_field(db_field, request, **kwargs)
167. 
168.         # ForeignKey or ManyToManyFields
169.         if isinstance(db_field, (models.ForeignKey, models.ManyToManyField)):
170.             # Combine the field kwargs with any options for formfield_overrides.
171.             # Make sure the passed in **kwargs override anything in
172.             # formfield_overrides because **kwargs is more specific, and should
173.             # always win.
174.             if db_field.__class__ in self.formfield_overrides:
175.                 kwargs = {**self.formfield_overrides[db_field.__class__], **kwargs}
176. 
177.             # Get the correct formfield.
178.             if isinstance(db_field, models.ForeignKey):
179.                 formfield = self.formfield_for_foreignkey(db_field, request, **kwargs)
180.             elif isinstance(db_field, models.ManyToManyField):
181.                 formfield = self.formfield_for_manytomany(db_field, request, **kwargs)
182. 
183.             # For non-raw_id fields, wrap the widget with a wrapper that adds
184.             # extra HTML -- the "add other" interface -- to the end of the
185.             # rendered output. formfield can be None if it came from a
186.             # OneToOneField with parent_link=True or a M2M intermediary.
187.             if formfield and db_field.name not in self.raw_id_fields:
188.                 related_modeladmin = self.admin_site._registry.get(
189.                     db_field.remote_field.model
190.                 )
191.                 wrapper_kwargs = {}
192.                 if related_modeladmin:
193.                     wrapper_kwargs.update(
194.                         can_add_related=related_modeladmin.has_add_permission(request),
195.                         can_change_related=related_modeladmin.has_change_permission(
196.                             request
197.                         ),
198.                         can_delete_related=related_modeladmin.has_delete_permission(
199.                             request
200.                         ),
201.                         can_view_related=related_modeladmin.has_view_permission(
202.                             request
203.                         ),
204.                     )
205.                 formfield.widget = widgets.RelatedFieldWidgetWrapper(
206.                     formfield.widget,
207.                     db_field.remote_field,
208.                     self.admin_site,
209.                     **wrapper_kwargs,
210.                 )
211. 
212.             return formfield
213. 
214.         # If we've got overrides for the formfield defined, use 'em. **kwargs
215.         # passed to formfield_for_dbfield override the defaults.
216.         for klass in db_field.__class__.mro():
217.             if klass in self.formfield_overrides:
218.                 kwargs = {**copy.deepcopy(self.formfield_overrides[klass]), **kwargs}
219.                 return db_field.formfield(**kwargs)
220. 
221.         # For any other type of field, just call its formfield() method.
222.         return db_field.formfield(**kwargs)
223. 
224.     def formfield_for_choice_field(self, db_field, request, **kwargs):
225.         """
226.         Get a form Field for a database Field that has declared choices.
227.         """
228.         # If the field is named as a radio_field, use a RadioSelect
229.         if db_field.name in self.radio_fields:
230.             # Avoid stomping on custom widget/choices arguments.
231.             if "widget" not in kwargs:
232.                 kwargs["widget"] = widgets.AdminRadioSelect(
233.                     attrs={
234.                         "class": get_ul_class(self.radio_fields[db_field.name]),
235.                     }
236.                 )
237.             if "choices" not in kwargs:
238.                 kwargs["choices"] = db_field.get_choices(
239.                     include_blank=db_field.blank, blank_choice=[("", _("None"))]
240.                 )
241.         return db_field.formfield(**kwargs)
242. 
243.     def get_field_queryset(self, db, db_field, request):
244.         """
245.         If the ModelAdmin specifies ordering, the queryset should respect that
246.         ordering.  Otherwise don't specify the queryset, let the field decide
247.         (return None in that case).
248.         """
249.         related_admin = self.admin_site._registry.get(db_field.remote_field.model)
250.         if related_admin is not None:
251.             ordering = related_admin.get_ordering(request)
252.             if ordering is not None and ordering != ():
253.                 return db_field.remote_field.model._default_manager.using(db).order_by(
254.                     *ordering
255.                 )
256.         return None
257. 
258.     def formfield_for_foreignkey(self, db_field, request, **kwargs):
259.         """
260.         Get a form Field for a ForeignKey.
261.         """
262.         db = kwargs.get("using")
263. 
264.         if "widget" not in kwargs:
265.             if db_field.name in self.get_autocomplete_fields(request):
266.                 kwargs["widget"] = AutocompleteSelect(
267.                     db_field, self.admin_site, using=db
268.                 )
269.             elif db_field.name in self.raw_id_fields:
270.                 kwargs["widget"] = widgets.ForeignKeyRawIdWidget(
271.                     db_field.remote_field, self.admin_site, using=db
272.                 )
273.             elif db_field.name in self.radio_fields:
274.                 kwargs["widget"] = widgets.AdminRadioSelect(
275.                     attrs={
276.                         "class": get_ul_class(self.radio_fields[db_field.name]),
277.                     }
278.                 )
279.                 kwargs["empty_label"] = (
280.                     kwargs.get("empty_label", _("None")) if db_field.blank else None
281.                 )
282. 
283.         if "queryset" not in kwargs:
284.             queryset = self.get_field_queryset(db, db_field, request)
285.             if queryset is not None:
286.                 kwargs["queryset"] = queryset
287. 
288.         return db_field.formfield(**kwargs)
289. 
290.     def formfield_for_manytomany(self, db_field, request, **kwargs):
291.         """
292.         Get a form Field for a ManyToManyField.
293.         """
294.         # If it uses an intermediary model that isn't auto created, don't show
295.         # a field in admin.
296.         if not db_field.remote_field.through._meta.auto_created:
297.             return None
298.         db = kwargs.get("using")
299. 
300.         if "widget" not in kwargs:
301.             autocomplete_fields = self.get_autocomplete_fields(request)
302.             if db_field.name in autocomplete_fields:
303.                 kwargs["widget"] = AutocompleteSelectMultiple(
304.                     db_field,
305.                     self.admin_site,
306.                     using=db,
307.                 )
308.             elif db_field.name in self.raw_id_fields:
309.                 kwargs["widget"] = widgets.ManyToManyRawIdWidget(
310.                     db_field.remote_field,
311.                     self.admin_site,
312.                     using=db,
313.                 )
314.             elif db_field.name in [*self.filter_vertical, *self.filter_horizontal]:
315.                 kwargs["widget"] = widgets.FilteredSelectMultiple(
316.                     db_field.verbose_name, db_field.name in self.filter_vertical
317.                 )
318.         if "queryset" not in kwargs:
319.             queryset = self.get_field_queryset(db, db_field, request)
320.             if queryset is not None:
321.                 kwargs["queryset"] = queryset
322. 
323.         form_field = db_field.formfield(**kwargs)
324.         if (
325.             isinstance(form_field.widget, SelectMultiple)
326.             and form_field.widget.allow_multiple_selected
327.             and not isinstance(
328.                 form_field.widget, (CheckboxSelectMultiple, AutocompleteSelectMultiple)
329.             )
330.         ):
331.             msg = _(
332.                 "Hold down “Control”, or “Command” on a Mac, to select more than one."
333.             )
334.             help_text = form_field.help_text
335.             form_field.help_text = (
336.                 format_lazy("{} {}", help_text, msg) if help_text else msg
337.             )
338.         return form_field
339. 
340.     def get_autocomplete_fields(self, request):
341.         """
342.         Return a list of ForeignKey and/or ManyToMany fields which should use
343.         an autocomplete widget.
344.         """
345.         return self.autocomplete_fields
346. 
347.     def get_view_on_site_url(self, obj=None):
348.         if obj is None or not self.view_on_site:
349.             return None
350. 
351.         if callable(self.view_on_site):
352.             return self.view_on_site(obj)
353.         elif hasattr(obj, "get_absolute_url"):
354.             # use the ContentType lookup if view_on_site is True
355.             return reverse(
356.                 "admin:view_on_site",
357.                 kwargs={
358.                     "content_type_id": get_content_type_for_model(obj).pk,
359.                     "object_id": obj.pk,
360.                 },
361.                 current_app=self.admin_site.name,
362.             )
363. 
364.     def get_empty_value_display(self):
365.         """
366.         Return the empty_value_display set on ModelAdmin or AdminSite.
367.         """
368.         try:
369.             return mark_safe(self.empty_value_display)
370.         except AttributeError:
371.             return mark_safe(self.admin_site.empty_value_display)
372. 
373.     def get_exclude(self, request, obj=None):
374.         """
375.         Hook for specifying exclude.
376.         """
377.         return self.exclude
378. 
379.     def get_fields(self, request, obj=None):
380.         """
381.         Hook for specifying fields.
382.         """
383.         if self.fields:
384.             return self.fields
385.         # _get_form_for_get_fields() is implemented in subclasses.
386.         form = self._get_form_for_get_fields(request, obj)
387.         return [*form.base_fields, *self.get_readonly_fields(request, obj)]
388. 
389.     def get_fieldsets(self, request, obj=None):
390.         """
391.         Hook for specifying fieldsets.
392.         """
393.         if self.fieldsets:
394.             return self.fieldsets
395.         return [(None, {"fields": self.get_fields(request, obj)})]
396. 
397.     def get_inlines(self, request, obj):
398.         """Hook for specifying custom inlines."""
399.         return self.inlines
400. 
401.     def get_ordering(self, request):
402.         """
403.         Hook for specifying field ordering.
404.         """
405.         return self.ordering or ()  # otherwise we might try to *None, which is bad ;)
406. 
407.     def get_readonly_fields(self, request, obj=None):
408.         """
409.         Hook for specifying custom readonly fields.
410.         """
411.         return self.readonly_fields
412. 
413.     def get_prepopulated_fields(self, request, obj=None):
414.         """
415.         Hook for specifying custom prepopulated fields.
416.         """
417.         return self.prepopulated_fields
418. 
419.     def get_queryset(self, request):
420.         """
421.         Return a QuerySet of all model instances that can be edited by the
422.         admin site. This is used by changelist_view.
423.         """
424.         qs = self.model._default_manager.get_queryset()
425.         # TODO: this should be handled by some parameter to the ChangeList.
426.         ordering = self.get_ordering(request)
427.         if ordering:
428.             qs = qs.order_by(*ordering)
429.         return qs
430. 
431.     def get_sortable_by(self, request):
432.         """Hook for specifying which fields can be sorted in the changelist."""
433.         return (
434.             self.sortable_by
435.             if self.sortable_by is not None
436.             else self.get_list_display(request)
437.         )
438. 
439.     def lookup_allowed(self, lookup, value):
440.         from django.contrib.admin.filters import SimpleListFilter
441. 
442.         model = self.model
443.         # Check FKey lookups that are allowed, so that popups produced by
444.         # ForeignKeyRawIdWidget, on the basis of ForeignKey.limit_choices_to,
445.         # are allowed to work.
446.         for fk_lookup in model._meta.related_fkey_lookups:
447.             # As ``limit_choices_to`` can be a callable, invoke it here.
448.             if callable(fk_lookup):
449.                 fk_lookup = fk_lookup()
450.             if (lookup, value) in widgets.url_params_from_lookup_dict(
451.                 fk_lookup
452.             ).items():
453.                 return True
454. 
455.         relation_parts = []
456.         prev_field = None
457.         for part in lookup.split(LOOKUP_SEP):
458.             try:
459.                 field = model._meta.get_field(part)
460.             except FieldDoesNotExist:
461.                 # Lookups on nonexistent fields are ok, since they're ignored
462.                 # later.
463.                 break
464.             # It is allowed to filter on values that would be found from local
465.             # model anyways. For example, if you filter on employee__department__id,
466.             # then the id value would be found already from employee__department_id.
467.             if not prev_field or (
468.                 prev_field.is_relation
469.                 and field not in prev_field.path_infos[-1].target_fields
470.             ):
471.                 relation_parts.append(part)
472.             if not getattr(field, "path_infos", None):
473.                 # This is not a relational field, so further parts
474.                 # must be transforms.
475.                 break
476.             prev_field = field
477.             model = field.path_infos[-1].to_opts.model
478. 
479.         if len(relation_parts) <= 1:
480.             # Either a local field filter, or no fields at all.
481.             return True
482.         valid_lookups = {self.date_hierarchy}
483.         for filter_item in self.list_filter:
484.             if isinstance(filter_item, type) and issubclass(
485.                 filter_item, SimpleListFilter
486.             ):
487.                 valid_lookups.add(filter_item.parameter_name)
488.             elif isinstance(filter_item, (list, tuple)):
489.                 valid_lookups.add(filter_item[0])
490.             else:
491.                 valid_lookups.add(filter_item)
492. 
493.         # Is it a valid relational lookup?
494.         return not {
495.             LOOKUP_SEP.join(relation_parts),
496.             LOOKUP_SEP.join(relation_parts + [part]),
497.         }.isdisjoint(valid_lookups)
498. 
499.     def to_field_allowed(self, request, to_field):
500.         """
501.         Return True if the model associated with this admin should be
502.         allowed to be referenced by the specified field.
503.         """
504.         try:
505.             field = self.opts.get_field(to_field)
506.         except FieldDoesNotExist:
507.             return False
508. 
509.         # Always allow referencing the primary key since it's already possible
510.         # to get this information from the change view URL.
511.         if field.primary_key:
512.             return True
513. 
514.         # Allow reverse relationships to models defining m2m fields if they
515.         # target the specified field.
516.         for many_to_many in self.opts.many_to_many:
517.             if many_to_many.m2m_target_field_name() == to_field:
518.                 return True
519. 
520.         # Make sure at least one of the models registered for this site
521.         # references this field through a FK or a M2M relationship.
522.         registered_models = set()
523.         for model, admin in self.admin_site._registry.items():
524.             registered_models.add(model)
525.             for inline in admin.inlines:
526.                 registered_models.add(inline.model)
527. 
528.         related_objects = (
529.             f
530.             for f in self.opts.get_fields(include_hidden=True)
531.             if (f.auto_created and not f.concrete)
532.         )
533.         for related_object in related_objects:
534.             related_model = related_object.related_model
535.             remote_field = related_object.field.remote_field
536.             if (
537.                 any(issubclass(model, related_model) for model in registered_models)
538.                 and hasattr(remote_field, "get_related_field")
539.                 and remote_field.get_related_field() == field
540.             ):
541.                 return True
542. 
543.         return False
544. 
545.     def has_add_permission(self, request):
546.         """
547.         Return True if the given request has permission to add an object.
548.         Can be overridden by the user in subclasses.
549.         """
550.         opts = self.opts
551.         codename = get_permission_codename("add", opts)
552.         return request.user.has_perm("%s.%s" % (opts.app_label, codename))
553. 
554.     def has_change_permission(self, request, obj=None):
555.         """
556.         Return True if the given request has permission to change the given
557.         Django model instance, the default implementation doesn't examine the
558.         `obj` parameter.
559. 
560.         Can be overridden by the user in subclasses. In such case it should
561.         return True if the given request has permission to change the `obj`
562.         model instance. If `obj` is None, this should return True if the given
563.         request has permission to change *any* object of the given type.
564.         """
565.         opts = self.opts
566.         codename = get_permission_codename("change", opts)
567.         return request.user.has_perm("%s.%s" % (opts.app_label, codename))
568. 
569.     def has_delete_permission(self, request, obj=None):
570.         """
571.         Return True if the given request has permission to delete the given
572.         Django model instance, the default implementation doesn't examine the
573.         `obj` parameter.
574. 
575.         Can be overridden by the user in subclasses. In such case it should
576.         return True if the given request has permission to delete the `obj`
577.         model instance. If `obj` is None, this should return True if the given
578.         request has permission to delete *any* object of the given type.
579.         """
580.         opts = self.opts
581.         codename = get_permission_codename("delete", opts)
582.         return request.user.has_perm("%s.%s" % (opts.app_label, codename))
583. 
584.     def has_view_permission(self, request, obj=None):
585.         """
586.         Return True if the given request has permission to view the given
587.         Django model instance. The default implementation doesn't examine the
588.         `obj` parameter.
589. 
590.         If overridden by the user in subclasses, it should return True if the
591.         given request has permission to view the `obj` model instance. If `obj`
592.         is None, it should return True if the request has permission to view
593.         any object of the given type.
594.         """
595.         opts = self.opts
596.         codename_view = get_permission_codename("view", opts)
597.         codename_change = get_permission_codename("change", opts)
598.         return request.user.has_perm(
599.             "%s.%s" % (opts.app_label, codename_view)
600.         ) or request.user.has_perm("%s.%s" % (opts.app_label, codename_change))
601. 
602.     def has_view_or_change_permission(self, request, obj=None):
603.         return self.has_view_permission(request, obj) or self.has_change_permission(
604.             request, obj
605.         )
606. 
607.     def has_module_permission(self, request):
608.         """
609.         Return True if the given request has any permission in the given
610.         app label.
611. 
612.         Can be overridden by the user in subclasses. In such case it should
613.         return True if the given request has permission to view the module on
614.         the admin index page and access the module's index page. Overriding it
615.         does not restrict access to the add, change or delete views. Use
616.         `ModelAdmin.has_(add|change|delete)_permission` for that.
617.         """
618.         return request.user.has_module_perms(self.opts.app_label)
619. 
620. 
621. class ModelAdmin(BaseModelAdmin):
622.     """Encapsulate all admin options and functionality for a given model."""
623. 
624.     list_display = ("__str__",)
625.     list_display_links = ()
626.     list_filter = ()
627.     list_select_related = False
628.     list_per_page = 100
629.     list_max_show_all = 200
630.     list_editable = ()
631.     search_fields = ()
632.     search_help_text = None
633.     date_hierarchy = None
634.     save_as = False
635.     save_as_continue = True
636.     save_on_top = False
637.     paginator = Paginator
638.     preserve_filters = True
639.     show_facets = ShowFacets.ALLOW
640.     inlines = ()
641. 
642.     # Custom templates (designed to be over-ridden in subclasses)
643.     add_form_template = None
644.     change_form_template = None
645.     change_list_template = None
646.     delete_confirmation_template = None
647.     delete_selected_confirmation_template = None
648.     object_history_template = None
649.     popup_response_template = None
650. 
651.     # Actions
652.     actions = ()
653.     action_form = helpers.ActionForm
654.     actions_on_top = True
655.     actions_on_bottom = False
656.     actions_selection_counter = True
657.     checks_class = ModelAdminChecks
658. 
659.     def __init__(self, model, admin_site):
660.         self.model = model
661.         self.opts = model._meta
662.         self.admin_site = admin_site
663.         super().__init__()
664. 
665.     def __str__(self):
666.         return "%s.%s" % (self.opts.app_label, self.__class__.__name__)
667. 
668.     def __repr__(self):
669.         return (
670.             f"<{self.__class__.__qualname__}: model={self.model.__qualname__} "
671.             f"site={self.admin_site!r}>"
672.         )
673. 
674.     def get_inline_instances(self, request, obj=None):
675.         inline_instances = []
676.         for inline_class in self.get_inlines(request, obj):
677.             inline = inline_class(self.model, self.admin_site)
678.             if request:
679.                 if not (
680.                     inline.has_view_or_change_permission(request, obj)
681.                     or inline.has_add_permission(request, obj)
682.                     or inline.has_delete_permission(request, obj)
683.                 ):
684.                     continue
685.                 if not inline.has_add_permission(request, obj):
686.                     inline.max_num = 0
687.             inline_instances.append(inline)
688. 
689.         return inline_instances
690. 
691.     def get_urls(self):
692.         from django.urls import path
693. 
694.         def wrap(view):
695.             def wrapper(*args, **kwargs):
696.                 return self.admin_site.admin_view(view)(*args, **kwargs)
697. 
698.             wrapper.model_admin = self
699.             return update_wrapper(wrapper, view)
700. 
701.         info = self.opts.app_label, self.opts.model_name
702. 
703.         return [
704.             path("", wrap(self.changelist_view), name="%s_%s_changelist" % info),
705.             path("add/", wrap(self.add_view), name="%s_%s_add" % info),
706.             path(
707.                 "<path:object_id>/history/",
708.                 wrap(self.history_view),
709.                 name="%s_%s_history" % info,
710.             ),
711.             path(
712.                 "<path:object_id>/delete/",
713.                 wrap(self.delete_view),
714.                 name="%s_%s_delete" % info,
715.             ),
716.             path(
717.                 "<path:object_id>/change/",
718.                 wrap(self.change_view),
719.                 name="%s_%s_change" % info,
720.             ),
721.             # For backwards compatibility (was the change url before 1.9)
722.             path(
723.                 "<path:object_id>/",
724.                 wrap(
725.                     RedirectView.as_view(
726.                         pattern_name="%s:%s_%s_change"
727.                         % ((self.admin_site.name,) + info)
728.                     )
729.                 ),
730.             ),
731.         ]
732. 
733.     @property
734.     def urls(self):
735.         return self.get_urls()
736. 
737.     @property
738.     def media(self):
739.         extra = "" if settings.DEBUG else ".min"
740.         js = [
741.             "vendor/jquery/jquery%s.js" % extra,
742.             "jquery.init.js",
743.             "core.js",
744.             "admin/RelatedObjectLookups.js",
745.             "actions.js",
746.             "urlify.js",
747.             "prepopulate.js",
748.             "vendor/xregexp/xregexp%s.js" % extra,
749.         ]
750.         return forms.Media(js=["admin/js/%s" % url for url in js])
751. 
752.     def get_model_perms(self, request):
753.         """
754.         Return a dict of all perms for this model. This dict has the keys
755.         ``add``, ``change``, ``delete``, and ``view`` mapping to the True/False
756.         for each of those actions.
757.         """
758.         return {
759.             "add": self.has_add_permission(request),
760.             "change": self.has_change_permission(request),
761.             "delete": self.has_delete_permission(request),
762.             "view": self.has_view_permission(request),
763.         }
764. 
765.     def _get_form_for_get_fields(self, request, obj):
766.         return self.get_form(request, obj, fields=None)
767. 
768.     def get_form(self, request, obj=None, change=False, **kwargs):
769.         """
770.         Return a Form class for use in the admin add view. This is used by
771.         add_view and change_view.
772.         """
773.         if "fields" in kwargs:
774.             fields = kwargs.pop("fields")
775.         else:
776.             fields = flatten_fieldsets(self.get_fieldsets(request, obj))
777.         excluded = self.get_exclude(request, obj)
778.         exclude = [] if excluded is None else list(excluded)
779.         readonly_fields = self.get_readonly_fields(request, obj)
780.         exclude.extend(readonly_fields)
781.         # Exclude all fields if it's a change form and the user doesn't have
782.         # the change permission.
783.         if (
784.             change
785.             and hasattr(request, "user")
786.             and not self.has_change_permission(request, obj)
787.         ):
788.             exclude.extend(fields)
789.         if excluded is None and hasattr(self.form, "_meta") and self.form._meta.exclude:
790.             # Take the custom ModelForm's Meta.exclude into account only if the
791.             # ModelAdmin doesn't define its own.
792.             exclude.extend(self.form._meta.exclude)
793.         # if exclude is an empty list we pass None to be consistent with the
794.         # default on modelform_factory
795.         exclude = exclude or None
796. 
797.         # Remove declared form fields which are in readonly_fields.
798.         new_attrs = dict.fromkeys(
799.             f for f in readonly_fields if f in self.form.declared_fields
800.         )
801.         form = type(self.form.__name__, (self.form,), new_attrs)
802. 
803.         defaults = {
804.             "form": form,
805.             "fields": fields,
806.             "exclude": exclude,
807.             "formfield_callback": partial(self.formfield_for_dbfield, request=request),
808.             **kwargs,
809.         }
810. 
811.         if defaults["fields"] is None and not modelform_defines_fields(
812.             defaults["form"]
813.         ):
814.             defaults["fields"] = forms.ALL_FIELDS
815. 
816.         try:
817.             return modelform_factory(self.model, **defaults)
818.         except FieldError as e:
819.             raise FieldError(
820.                 "%s. Check fields/fieldsets/exclude attributes of class %s."
821.                 % (e, self.__class__.__name__)
822.             )
823. 
824.     def get_changelist(self, request, **kwargs):
825.         """
826.         Return the ChangeList class for use on the changelist page.
827.         """
828.         from django.contrib.admin.views.main import ChangeList
829. 
830.         return ChangeList
831. 
832.     def get_changelist_instance(self, request):
833.         """
834.         Return a `ChangeList` instance based on `request`. May raise
835.         `IncorrectLookupParameters`.
836.         """
837.         list_display = self.get_list_display(request)
838.         list_display_links = self.get_list_display_links(request, list_display)
839.         # Add the action checkboxes if any actions are available.
840.         if self.get_actions(request):
841.             list_display = ["action_checkbox", *list_display]
842.         sortable_by = self.get_sortable_by(request)
843.         ChangeList = self.get_changelist(request)
844.         return ChangeList(
845.             request,
846.             self.model,
847.             list_display,
848.             list_display_links,
849.             self.get_list_filter(request),
850.             self.date_hierarchy,
851.             self.get_search_fields(request),
852.             self.get_list_select_related(request),
853.             self.list_per_page,
854.             self.list_max_show_all,
855.             self.list_editable,
856.             self,
857.             sortable_by,
858.             self.search_help_text,
859.         )
860. 
861.     def get_object(self, request, object_id, from_field=None):
862.         """
863.         Return an instance matching the field and value provided, the primary
864.         key is used if no field is provided. Return ``None`` if no match is
865.         found or the object_id fails validation.
866.         """
867.         queryset = self.get_queryset(request)
868.         model = queryset.model
869.         field = (
870.             model._meta.pk if from_field is None else model._meta.get_field(from_field)
871.         )
872.         try:
873.             object_id = field.to_python(object_id)
874.             return queryset.get(**{field.name: object_id})
875.         except (model.DoesNotExist, ValidationError, ValueError):
876.             return None
877. 
878.     def get_changelist_form(self, request, **kwargs):
879.         """
880.         Return a Form class for use in the Formset on the changelist page.
881.         """
882.         defaults = {
883.             "formfield_callback": partial(self.formfield_for_dbfield, request=request),
884.             **kwargs,
885.         }
886.         if defaults.get("fields") is None and not modelform_defines_fields(
887.             defaults.get("form")
888.         ):
889.             defaults["fields"] = forms.ALL_FIELDS
890. 
891.         return modelform_factory(self.model, **defaults)
892. 
893.     def get_changelist_formset(self, request, **kwargs):
894.         """
895.         Return a FormSet class for use on the changelist page if list_editable
896.         is used.
897.         """
898.         defaults = {
899.             "formfield_callback": partial(self.formfield_for_dbfield, request=request),
900.             **kwargs,
901.         }
902.         return modelformset_factory(
903.             self.model,
904.             self.get_changelist_form(request),
905.             extra=0,
906.             fields=self.list_editable,
907.             **defaults,
908.         )
909. 
910.     def get_formsets_with_inlines(self, request, obj=None):
911.         """
912.         Yield formsets and the corresponding inlines.
913.         """
914.         for inline in self.get_inline_instances(request, obj):
915.             yield inline.get_formset(request, obj), inline
916. 
917.     def get_paginator(
918.         self, request, queryset, per_page, orphans=0, allow_empty_first_page=True
919.     ):
920.         return self.paginator(queryset, per_page, orphans, allow_empty_first_page)
921. 
922.     def log_addition(self, request, obj, message):
923.         """
924.         Log that an object has been successfully added.
925. 
926.         The default implementation creates an admin LogEntry object.
927.         """
928.         from django.contrib.admin.models import ADDITION, LogEntry
929. 
930.         return LogEntry.objects.log_action(
931.             user_id=request.user.pk,
932.             content_type_id=get_content_type_for_model(obj).pk,
933.             object_id=obj.pk,
934.             object_repr=str(obj),
935.             action_flag=ADDITION,
936.             change_message=message,
937.         )
938. 
939.     def log_change(self, request, obj, message):
940.         """
941.         Log that an object has been successfully changed.
942. 
943.         The default implementation creates an admin LogEntry object.
944.         """
945.         from django.contrib.admin.models import CHANGE, LogEntry
946. 
947.         return LogEntry.objects.log_action(
948.             user_id=request.user.pk,
949.             content_type_id=get_content_type_for_model(obj).pk,
950.             object_id=obj.pk,
951.             object_repr=str(obj),
952.             action_flag=CHANGE,
953.             change_message=message,
954.         )
955. 
956.     def log_deletion(self, request, obj, object_repr):
957.         """
958.         Log that an object will be deleted. Note that this method must be
959.         called before the deletion.
960. 
961.         The default implementation creates an admin LogEntry object.
962.         """
963.         from django.contrib.admin.models import DELETION, LogEntry
964. 
965.         return LogEntry.objects.log_action(
966.             user_id=request.user.pk,
967.             content_type_id=get_content_type_for_model(obj).pk,
968.             object_id=obj.pk,
969.             object_repr=object_repr,
970.             action_flag=DELETION,
971.         )
972. 
973.     def action_checkbox(self, obj):
974.         """
975.         A list_display column containing a checkbox widget.
976.         """
977.         attrs = {
978.             "class": "action-select",
979.             "aria-label": format_html(_("Select this object for an action - {}"), obj),
980.         }
981.         checkbox = forms.CheckboxInput(attrs, lambda value: False)
982.         return checkbox.render(helpers.ACTION_CHECKBOX_NAME, str(obj.pk))
983. 
984.     @staticmethod
985.     def _get_action_description(func, name):
986.         return getattr(func, "short_description", capfirst(name.replace("_", " ")))
987. 
988.     def _get_base_actions(self):
989.         """Return the list of actions, prior to any request-based filtering."""
990.         actions = []
991.         base_actions = (self.get_action(action) for action in self.actions or [])
992.         # get_action might have returned None, so filter any of those out.
993.         base_actions = [action for action in base_actions if action]
994.         base_action_names = {name for _, name, _ in base_actions}
995. 
996.         # Gather actions from the admin site first
997.         for name, func in self.admin_site.actions:
998.             if name in base_action_names:
999.                 continue
1000.             description = self._get_action_description(func, name)
1001.             actions.append((func, name, description))
1002.         # Add actions from this ModelAdmin.
1003.         actions.extend(base_actions)
1004.         return actions
1005. 
1006.     def _filter_actions_by_permissions(self, request, actions):
1007.         """Filter out any actions that the user doesn't have access to."""
1008.         filtered_actions = []
1009.         for action in actions:
1010.             callable = action[0]
1011.             if not hasattr(callable, "allowed_permissions"):
1012.                 filtered_actions.append(action)
1013.                 continue
1014.             permission_checks = (
1015.                 getattr(self, "has_%s_permission" % permission)
1016.                 for permission in callable.allowed_permissions
1017.             )
1018.             if any(has_permission(request) for has_permission in permission_checks):
1019.                 filtered_actions.append(action)
1020.         return filtered_actions
1021. 
1022.     def get_actions(self, request):
1023.         """
1024.         Return a dictionary mapping the names of all actions for this
1025.         ModelAdmin to a tuple of (callable, name, description) for each action.
1026.         """
1027.         # If self.actions is set to None that means actions are disabled on
1028.         # this page.
1029.         if self.actions is None or IS_POPUP_VAR in request.GET:
1030.             return {}
1031.         actions = self._filter_actions_by_permissions(request, self._get_base_actions())
1032.         return {name: (func, name, desc) for func, name, desc in actions}
1033. 
1034.     def get_action_choices(self, request, default_choices=models.BLANK_CHOICE_DASH):
1035.         """
1036.         Return a list of choices for use in a form object.  Each choice is a
1037.         tuple (name, description).
1038.         """
1039.         choices = [] + default_choices
1040.         for func, name, description in self.get_actions(request).values():
1041.             choice = (name, description % model_format_dict(self.opts))
1042.             choices.append(choice)
1043.         return choices
1044. 
1045.     def get_action(self, action):
1046.         """
1047.         Return a given action from a parameter, which can either be a callable,
1048.         or the name of a method on the ModelAdmin.  Return is a tuple of
1049.         (callable, name, description).
1050.         """
1051.         # If the action is a callable, just use it.
1052.         if callable(action):
1053.             func = action
1054.             action = action.__name__
1055. 
1056.         # Next, look for a method. Grab it off self.__class__ to get an unbound
1057.         # method instead of a bound one; this ensures that the calling
1058.         # conventions are the same for functions and methods.
1059.         elif hasattr(self.__class__, action):
1060.             func = getattr(self.__class__, action)
1061. 
1062.         # Finally, look for a named method on the admin site
1063.         else:
1064.             try:
1065.                 func = self.admin_site.get_action(action)
1066.             except KeyError:
1067.                 return None
1068. 
1069.         description = self._get_action_description(func, action)
1070.         return func, action, description
1071. 
1072.     def get_list_display(self, request):
1073.         """
1074.         Return a sequence containing the fields to be displayed on the
1075.         changelist.
1076.         """
1077.         return self.list_display
1078. 
1079.     def get_list_display_links(self, request, list_display):
1080.         """
1081.         Return a sequence containing the fields to be displayed as links
1082.         on the changelist. The list_display parameter is the list of fields
1083.         returned by get_list_display().
1084.         """
1085.         if (
1086.             self.list_display_links
1087.             or self.list_display_links is None
1088.             or not list_display
1089.         ):
1090.             return self.list_display_links
1091.         else:
1092.             # Use only the first item in list_display as link
1093.             return list(list_display)[:1]
1094. 
1095.     def get_list_filter(self, request):
1096.         """
1097.         Return a sequence containing the fields to be displayed as filters in
1098.         the right sidebar of the changelist page.
1099.         """
1100.         return self.list_filter
1101. 
1102.     def get_list_select_related(self, request):
1103.         """
1104.         Return a list of fields to add to the select_related() part of the
1105.         changelist items query.
1106.         """
1107.         return self.list_select_related
1108. 
1109.     def get_search_fields(self, request):
1110.         """
1111.         Return a sequence containing the fields to be searched whenever
1112.         somebody submits a search query.
1113.         """
1114.         return self.search_fields
1115. 
1116.     def get_search_results(self, request, queryset, search_term):
1117.         """
1118.         Return a tuple containing a queryset to implement the search
1119.         and a boolean indicating if the results may contain duplicates.
1120.         """
1121. 
1122.         # Apply keyword searches.
1123.         def construct_search(field_name):
1124.             if field_name.startswith("^"):
1125.                 return "%s__istartswith" % field_name.removeprefix("^")
1126.             elif field_name.startswith("="):
1127.                 return "%s__iexact" % field_name.removeprefix("=")
1128.             elif field_name.startswith("@"):
1129.                 return "%s__search" % field_name.removeprefix("@")
1130.             # Use field_name if it includes a lookup.
1131.             opts = queryset.model._meta
1132.             lookup_fields = field_name.split(LOOKUP_SEP)
1133.             # Go through the fields, following all relations.
1134.             prev_field = None
1135.             for path_part in lookup_fields:
1136.                 if path_part == "pk":
1137.                     path_part = opts.pk.name
1138.                 try:
1139.                     field = opts.get_field(path_part)
1140.                 except FieldDoesNotExist:
1141.                     # Use valid query lookups.
1142.                     if prev_field and prev_field.get_lookup(path_part):
1143.                         return field_name
1144.                 else:
1145.                     prev_field = field
1146.                     if hasattr(field, "path_infos"):
1147.                         # Update opts to follow the relation.
1148.                         opts = field.path_infos[-1].to_opts
1149.             # Otherwise, use the field with icontains.
1150.             return "%s__icontains" % field_name
1151. 
1152.         may_have_duplicates = False
1153.         search_fields = self.get_search_fields(request)
1154.         if search_fields and search_term:
1155.             orm_lookups = [
1156.                 construct_search(str(search_field)) for search_field in search_fields
1157.             ]
1158.             term_queries = []
1159.             for bit in smart_split(search_term):
1160.                 if bit.startswith(('"', "'")) and bit[0] == bit[-1]:
1161.                     bit = unescape_string_literal(bit)
1162.                 or_queries = models.Q.create(
1163.                     [(orm_lookup, bit) for orm_lookup in orm_lookups],
1164.                     connector=models.Q.OR,
1165.                 )
1166.                 term_queries.append(or_queries)
1167.             queryset = queryset.filter(models.Q.create(term_queries))
1168.             may_have_duplicates |= any(
1169.                 lookup_spawns_duplicates(self.opts, search_spec)
1170.                 for search_spec in orm_lookups
1171.             )
1172.         return queryset, may_have_duplicates
1173. 
1174.     def get_preserved_filters(self, request):
1175.         """
1176.         Return the preserved filters querystring.
1177.         """
1178.         match = request.resolver_match
1179.         if self.preserve_filters and match:
1180.             current_url = "%s:%s" % (match.app_name, match.url_name)
1181.             changelist_url = "admin:%s_%s_changelist" % (
1182.                 self.opts.app_label,
1183.                 self.opts.model_name,
1184.             )
1185.             if current_url == changelist_url:
1186.                 preserved_filters = request.GET.urlencode()
1187.             else:
1188.                 preserved_filters = request.GET.get("_changelist_filters")
1189. 
1190.             if preserved_filters:
1191.                 return urlencode({"_changelist_filters": preserved_filters})
1192.         return ""
1193. 
1194.     def construct_change_message(self, request, form, formsets, add=False):
1195.         """
1196.         Construct a JSON structure describing changes from a changed object.
1197.         """
1198.         return construct_change_message(form, formsets, add)
1199. 
1200.     def message_user(
1201.         self, request, message, level=messages.INFO, extra_tags="", fail_silently=False
1202.     ):
1203.         """
1204.         Send a message to the user. The default implementation
1205.         posts a message using the django.contrib.messages backend.
1206. 
1207.         Exposes almost the same API as messages.add_message(), but accepts the
1208.         positional arguments in a different order to maintain backwards
1209.         compatibility. For convenience, it accepts the `level` argument as
1210.         a string rather than the usual level number.
1211.         """
1212.         if not isinstance(level, int):
1213.             # attempt to get the level if passed a string
1214.             try:
1215.                 level = getattr(messages.constants, level.upper())
1216.             except AttributeError:
1217.                 levels = messages.constants.DEFAULT_TAGS.values()
1218.                 levels_repr = ", ".join("`%s`" % level for level in levels)
1219.                 raise ValueError(
1220.                     "Bad message level string: `%s`. Possible values are: %s"
1221.                     % (level, levels_repr)
1222.                 )
1223. 
1224.         messages.add_message(
1225.             request, level, message, extra_tags=extra_tags, fail_silently=fail_silently
1226.         )
1227. 
1228.     def save_form(self, request, form, change):
1229.         """
1230.         Given a ModelForm return an unsaved instance. ``change`` is True if
1231.         the object is being changed, and False if it's being added.
1232.         """
1233.         return form.save(commit=False)
1234. 
1235.     def save_model(self, request, obj, form, change):
1236.         """
1237.         Given a model instance save it to the database.
1238.         """
1239.         obj.save()
1240. 
1241.     def delete_model(self, request, obj):
1242.         """
1243.         Given a model instance delete it from the database.
1244.         """
1245.         obj.delete()
1246. 
1247.     def delete_queryset(self, request, queryset):
1248.         """Given a queryset, delete it from the database."""
1249.         queryset.delete()
1250. 
1251.     def save_formset(self, request, form, formset, change):
1252.         """
1253.         Given an inline formset save it to the database.
1254.         """
1255.         formset.save()
1256. 
1257.     def save_related(self, request, form, formsets, change):
1258.         """
1259.         Given the ``HttpRequest``, the parent ``ModelForm`` instance, the
1260.         list of inline formsets and a boolean value based on whether the
1261.         parent is being added or changed, save the related objects to the
1262.         database. Note that at this point save_form() and save_model() have
1263.         already been called.
1264.         """
1265.         form.save_m2m()
1266.         for formset in formsets:
1267.             self.save_formset(request, form, formset, change=change)
1268. 
1269.     def render_change_form(
1270.         self, request, context, add=False, change=False, form_url="", obj=None
1271.     ):
1272.         app_label = self.opts.app_label
1273.         preserved_filters = self.get_preserved_filters(request)
1274.         form_url = add_preserved_filters(
1275.             {"preserved_filters": preserved_filters, "opts": self.opts}, form_url
1276.         )
1277.         view_on_site_url = self.get_view_on_site_url(obj)
1278.         has_editable_inline_admin_formsets = False
1279.         for inline in context["inline_admin_formsets"]:
1280.             if (
1281.                 inline.has_add_permission
1282.                 or inline.has_change_permission
1283.                 or inline.has_delete_permission
1284.             ):
1285.                 has_editable_inline_admin_formsets = True
1286.                 break
1287.         context.update(
1288.             {
1289.                 "add": add,
1290.                 "change": change,
1291.                 "has_view_permission": self.has_view_permission(request, obj),
1292.                 "has_add_permission": self.has_add_permission(request),
1293.                 "has_change_permission": self.has_change_permission(request, obj),
1294.                 "has_delete_permission": self.has_delete_permission(request, obj),
1295.                 "has_editable_inline_admin_formsets": (
1296.                     has_editable_inline_admin_formsets
1297.                 ),
1298.                 "has_file_field": context["adminform"].form.is_multipart()
1299.                 or any(
1300.                     admin_formset.formset.is_multipart()
1301.                     for admin_formset in context["inline_admin_formsets"]
1302.                 ),
1303.                 "has_absolute_url": view_on_site_url is not None,
1304.                 "absolute_url": view_on_site_url,
1305.                 "form_url": form_url,
1306.                 "opts": self.opts,
1307.                 "content_type_id": get_content_type_for_model(self.model).pk,
1308.                 "save_as": self.save_as,
1309.                 "save_on_top": self.save_on_top,
1310.                 "to_field_var": TO_FIELD_VAR,
1311.                 "is_popup_var": IS_POPUP_VAR,
1312.                 "app_label": app_label,
1313.             }
1314.         )
1315.         if add and self.add_form_template is not None:
1316.             form_template = self.add_form_template
1317.         else:
1318.             form_template = self.change_form_template
1319. 
1320.         request.current_app = self.admin_site.name
1321. 
1322.         return TemplateResponse(
1323.             request,
1324.             form_template
1325.             or [
1326.                 "admin/%s/%s/change_form.html" % (app_label, self.opts.model_name),
1327.                 "admin/%s/change_form.html" % app_label,
1328.                 "admin/change_form.html",
1329.             ],
1330.             context,
1331.         )
1332. 
1333.     def response_add(self, request, obj, post_url_continue=None):
1334.         """
1335.         Determine the HttpResponse for the add_view stage.
1336.         """
1337.         opts = obj._meta
1338.         preserved_filters = self.get_preserved_filters(request)
1339.         obj_url = reverse(
1340.             "admin:%s_%s_change" % (opts.app_label, opts.model_name),
1341.             args=(quote(obj.pk),),
1342.             current_app=self.admin_site.name,
1343.         )
1344.         # Add a link to the object's change form if the user can edit the obj.
1345.         if self.has_change_permission(request, obj):
1346.             obj_repr = format_html('<a href="{}">{}</a>', urlquote(obj_url), obj)
1347.         else:
1348.             obj_repr = str(obj)
1349.         msg_dict = {
1350.             "name": opts.verbose_name,
1351.             "obj": obj_repr,
1352.         }
1353.         # Here, we distinguish between different save types by checking for
1354.         # the presence of keys in request.POST.
1355. 
1356.         if IS_POPUP_VAR in request.POST:
1357.             to_field = request.POST.get(TO_FIELD_VAR)
1358.             if to_field:
1359.                 attr = str(to_field)
1360.             else:
1361.                 attr = obj._meta.pk.attname
1362.             value = obj.serializable_value(attr)
1363.             popup_response_data = json.dumps(
1364.                 {
1365.                     "value": str(value),
1366.                     "obj": str(obj),
1367.                 }
1368.             )
1369.             return TemplateResponse(
1370.                 request,
1371.                 self.popup_response_template
1372.                 or [
1373.                     "admin/%s/%s/popup_response.html"
1374.                     % (opts.app_label, opts.model_name),
1375.                     "admin/%s/popup_response.html" % opts.app_label,
1376.                     "admin/popup_response.html",
1377.                 ],
1378.                 {
1379.                     "popup_response_data": popup_response_data,
1380.                 },
1381.             )
1382. 
1383.         elif "_continue" in request.POST or (
1384.             # Redirecting after "Save as new".
1385.             "_saveasnew" in request.POST
1386.             and self.save_as_continue
1387.             and self.has_change_permission(request, obj)
1388.         ):
1389.             msg = _("The {name} “{obj}” was added successfully.")
1390.             if self.has_change_permission(request, obj):
1391.                 msg += " " + _("You may edit it again below.")
1392.             self.message_user(request, format_html(msg, **msg_dict), messages.SUCCESS)
1393.             if post_url_continue is None:
1394.                 post_url_continue = obj_url
1395.             post_url_continue = add_preserved_filters(
1396.                 {"preserved_filters": preserved_filters, "opts": opts},
1397.                 post_url_continue,
1398.             )
1399.             return HttpResponseRedirect(post_url_continue)
1400. 
1401.         elif "_addanother" in request.POST:
1402.             msg = format_html(
1403.                 _(
1404.                     "The {name} “{obj}” was added successfully. You may add another "
1405.                     "{name} below."
1406.                 ),
1407.                 **msg_dict,
1408.             )
1409.             self.message_user(request, msg, messages.SUCCESS)
1410.             redirect_url = request.path
1411.             redirect_url = add_preserved_filters(
1412.                 {"preserved_filters": preserved_filters, "opts": opts}, redirect_url
1413.             )
1414.             return HttpResponseRedirect(redirect_url)
1415. 
1416.         else:
1417.             msg = format_html(
1418.                 _("The {name} “{obj}” was added successfully."), **msg_dict
1419.             )
1420.             self.message_user(request, msg, messages.SUCCESS)
1421.             return self.response_post_save_add(request, obj)
1422. 
1423.     def response_change(self, request, obj):
1424.         """
1425.         Determine the HttpResponse for the change_view stage.
1426.         """
1427. 
1428.         if IS_POPUP_VAR in request.POST:
1429.             opts = obj._meta
1430.             to_field = request.POST.get(TO_FIELD_VAR)
1431.             attr = str(to_field) if to_field else opts.pk.attname
1432.             value = request.resolver_match.kwargs["object_id"]
1433.             new_value = obj.serializable_value(attr)
1434.             popup_response_data = json.dumps(
1435.                 {
1436.                     "action": "change",
1437.                     "value": str(value),
1438.                     "obj": str(obj),
1439.                     "new_value": str(new_value),
1440.                 }
1441.             )
1442.             return TemplateResponse(
1443.                 request,
1444.                 self.popup_response_template
1445.                 or [
1446.                     "admin/%s/%s/popup_response.html"
1447.                     % (opts.app_label, opts.model_name),
1448.                     "admin/%s/popup_response.html" % opts.app_label,
1449.                     "admin/popup_response.html",
1450.                 ],
1451.                 {
1452.                     "popup_response_data": popup_response_data,
1453.                 },
1454.             )
1455. 
1456.         opts = self.opts
1457.         preserved_filters = self.get_preserved_filters(request)
1458. 
1459.         msg_dict = {
1460.             "name": opts.verbose_name,
1461.             "obj": format_html('<a href="{}">{}</a>', urlquote(request.path), obj),
1462.         }
1463.         if "_continue" in request.POST:
1464.             msg = format_html(
1465.                 _(
1466.                     "The {name} “{obj}” was changed successfully. You may edit it "
1467.                     "again below."
1468.                 ),
1469.                 **msg_dict,
1470.             )
1471.             self.message_user(request, msg, messages.SUCCESS)
1472.             redirect_url = request.path
1473.             redirect_url = add_preserved_filters(
1474.                 {"preserved_filters": preserved_filters, "opts": opts}, redirect_url
1475.             )
1476.             return HttpResponseRedirect(redirect_url)
1477. 
1478.         elif "_saveasnew" in request.POST:
1479.             msg = format_html(
1480.                 _(
1481.                     "The {name} “{obj}” was added successfully. You may edit it again "
1482.                     "below."
1483.                 ),
1484.                 **msg_dict,
1485.             )
1486.             self.message_user(request, msg, messages.SUCCESS)
1487.             redirect_url = reverse(
1488.                 "admin:%s_%s_change" % (opts.app_label, opts.model_name),
1489.                 args=(obj.pk,),
1490.                 current_app=self.admin_site.name,
1491.             )
1492.             redirect_url = add_preserved_filters(
1493.                 {"preserved_filters": preserved_filters, "opts": opts}, redirect_url
1494.             )
1495.             return HttpResponseRedirect(redirect_url)
1496. 
1497.         elif "_addanother" in request.POST:
1498.             msg = format_html(
1499.                 _(
1500.                     "The {name} “{obj}” was changed successfully. You may add another "
1501.                     "{name} below."
1502.                 ),
1503.                 **msg_dict,
1504.             )
1505.             self.message_user(request, msg, messages.SUCCESS)
1506.             redirect_url = reverse(
1507.                 "admin:%s_%s_add" % (opts.app_label, opts.model_name),
1508.                 current_app=self.admin_site.name,
1509.             )
1510.             redirect_url = add_preserved_filters(
1511.                 {"preserved_filters": preserved_filters, "opts": opts}, redirect_url
1512.             )
1513.             return HttpResponseRedirect(redirect_url)
1514. 
1515.         else:
1516.             msg = format_html(
1517.                 _("The {name} “{obj}” was changed successfully."), **msg_dict
1518.             )
1519.             self.message_user(request, msg, messages.SUCCESS)
1520.             return self.response_post_save_change(request, obj)
1521. 
1522.     def _response_post_save(self, request, obj):
1523.         if self.has_view_or_change_permission(request):
1524.             post_url = reverse(
1525.                 "admin:%s_%s_changelist" % (self.opts.app_label, self.opts.model_name),
1526.                 current_app=self.admin_site.name,
1527.             )
1528.             preserved_filters = self.get_preserved_filters(request)
1529.             post_url = add_preserved_filters(
1530.                 {"preserved_filters": preserved_filters, "opts": self.opts}, post_url
1531.             )
1532.         else:
1533.             post_url = reverse("admin:index", current_app=self.admin_site.name)
1534.         return HttpResponseRedirect(post_url)
1535. 
1536.     def response_post_save_add(self, request, obj):
1537.         """
1538.         Figure out where to redirect after the 'Save' button has been pressed
1539.         when adding a new object.
1540.         """
1541.         return self._response_post_save(request, obj)
1542. 
1543.     def response_post_save_change(self, request, obj):
1544.         """
1545.         Figure out where to redirect after the 'Save' button has been pressed
1546.         when editing an existing object.
1547.         """
1548.         return self._response_post_save(request, obj)
1549. 
1550.     def response_action(self, request, queryset):
1551.         """
1552.         Handle an admin action. This is called if a request is POSTed to the
1553.         changelist; it returns an HttpResponse if the action was handled, and
1554.         None otherwise.
1555.         """
1556. 
1557.         # There can be multiple action forms on the page (at the top
1558.         # and bottom of the change list, for example). Get the action
1559.         # whose button was pushed.
1560.         try:
1561.             action_index = int(request.POST.get("index", 0))
1562.         except ValueError:
1563.             action_index = 0
1564. 
1565.         # Construct the action form.
1566.         data = request.POST.copy()
1567.         data.pop(helpers.ACTION_CHECKBOX_NAME, None)
1568.         data.pop("index", None)
1569. 
1570.         # Use the action whose button was pushed
1571.         try:
1572.             data.update({"action": data.getlist("action")[action_index]})
1573.         except IndexError:
1574.             # If we didn't get an action from the chosen form that's invalid
1575.             # POST data, so by deleting action it'll fail the validation check
1576.             # below. So no need to do anything here
1577.             pass
1578. 
1579.         action_form = self.action_form(data, auto_id=None)
1580.         action_form.fields["action"].choices = self.get_action_choices(request)
1581. 
1582.         # If the form's valid we can handle the action.
1583.         if action_form.is_valid():
1584.             action = action_form.cleaned_data["action"]
1585.             select_across = action_form.cleaned_data["select_across"]
1586.             func = self.get_actions(request)[action][0]
1587. 
1588.             # Get the list of selected PKs. If nothing's selected, we can't
1589.             # perform an action on it, so bail. Except we want to perform
1590.             # the action explicitly on all objects.
1591.             selected = request.POST.getlist(helpers.ACTION_CHECKBOX_NAME)
1592.             if not selected and not select_across:
1593.                 # Reminder that something needs to be selected or nothing will happen
1594.                 msg = _(
1595.                     "Items must be selected in order to perform "
1596.                     "actions on them. No items have been changed."
1597.                 )
1598.                 self.message_user(request, msg, messages.WARNING)
1599.                 return None
1600. 
1601.             if not select_across:
1602.                 # Perform the action only on the selected objects
1603.                 queryset = queryset.filter(pk__in=selected)
1604. 
1605.             response = func(self, request, queryset)
1606. 
1607.             # Actions may return an HttpResponse-like object, which will be
1608.             # used as the response from the POST. If not, we'll be a good
1609.             # little HTTP citizen and redirect back to the changelist page.
1610.             if isinstance(response, HttpResponseBase):
1611.                 return response
1612.             else:
1613.                 return HttpResponseRedirect(request.get_full_path())
1614.         else:
1615.             msg = _("No action selected.")
1616.             self.message_user(request, msg, messages.WARNING)
1617.             return None
1618. 
1619.     def response_delete(self, request, obj_display, obj_id):
1620.         """
1621.         Determine the HttpResponse for the delete_view stage.
1622.         """
1623.         if IS_POPUP_VAR in request.POST:
1624.             popup_response_data = json.dumps(
1625.                 {
1626.                     "action": "delete",
1627.                     "value": str(obj_id),
1628.                 }
1629.             )
1630.             return TemplateResponse(
1631.                 request,
1632.                 self.popup_response_template
1633.                 or [
1634.                     "admin/%s/%s/popup_response.html"
1635.                     % (self.opts.app_label, self.opts.model_name),
1636.                     "admin/%s/popup_response.html" % self.opts.app_label,
1637.                     "admin/popup_response.html",
1638.                 ],
1639.                 {
1640.                     "popup_response_data": popup_response_data,
1641.                 },
1642.             )
1643. 
1644.         self.message_user(
1645.             request,
1646.             _("The %(name)s “%(obj)s” was deleted successfully.")
1647.             % {
1648.                 "name": self.opts.verbose_name,
1649.                 "obj": obj_display,
1650.             },
1651.             messages.SUCCESS,
1652.         )
1653. 
1654.         if self.has_change_permission(request, None):
1655.             post_url = reverse(
1656.                 "admin:%s_%s_changelist" % (self.opts.app_label, self.opts.model_name),
1657.                 current_app=self.admin_site.name,
1658.             )
1659.             preserved_filters = self.get_preserved_filters(request)
1660.             post_url = add_preserved_filters(
1661.                 {"preserved_filters": preserved_filters, "opts": self.opts}, post_url
1662.             )
1663.         else:
1664.             post_url = reverse("admin:index", current_app=self.admin_site.name)
1665.         return HttpResponseRedirect(post_url)
1666. 
1667.     def render_delete_form(self, request, context):
1668.         app_label = self.opts.app_label
1669. 
1670.         request.current_app = self.admin_site.name
1671.         context.update(
1672.             to_field_var=TO_FIELD_VAR,
1673.             is_popup_var=IS_POPUP_VAR,
1674.             media=self.media,
1675.         )
1676. 
1677.         return TemplateResponse(
1678.             request,
1679.             self.delete_confirmation_template
1680.             or [
1681.                 "admin/{}/{}/delete_confirmation.html".format(
1682.                     app_label, self.opts.model_name
1683.                 ),
1684.                 "admin/{}/delete_confirmation.html".format(app_label),
1685.                 "admin/delete_confirmation.html",
1686.             ],
1687.             context,
1688.         )
1689. 
1690.     def get_inline_formsets(self, request, formsets, inline_instances, obj=None):
1691.         # Edit permissions on parent model are required for editable inlines.
1692.         can_edit_parent = (
1693.             self.has_change_permission(request, obj)
1694.             if obj
1695.             else self.has_add_permission(request)
1696.         )
1697.         inline_admin_formsets = []
1698.         for inline, formset in zip(inline_instances, formsets):
1699.             fieldsets = list(inline.get_fieldsets(request, obj))
1700.             readonly = list(inline.get_readonly_fields(request, obj))
1701.             if can_edit_parent:
1702.                 has_add_permission = inline.has_add_permission(request, obj)
1703.                 has_change_permission = inline.has_change_permission(request, obj)
1704.                 has_delete_permission = inline.has_delete_permission(request, obj)
1705.             else:
1706.                 # Disable all edit-permissions, and override formset settings.
1707.                 has_add_permission = (
1708.                     has_change_permission
1709.                 ) = has_delete_permission = False
1710.                 formset.extra = formset.max_num = 0
1711.             has_view_permission = inline.has_view_permission(request, obj)
1712.             prepopulated = dict(inline.get_prepopulated_fields(request, obj))
1713.             inline_admin_formset = helpers.InlineAdminFormSet(
1714.                 inline,
1715.                 formset,
1716.                 fieldsets,
1717.                 prepopulated,
1718.                 readonly,
1719.                 model_admin=self,
1720.                 has_add_permission=has_add_permission,
1721.                 has_change_permission=has_change_permission,
1722.                 has_delete_permission=has_delete_permission,
1723.                 has_view_permission=has_view_permission,
1724.             )
1725.             inline_admin_formsets.append(inline_admin_formset)
1726.         return inline_admin_formsets
1727. 
1728.     def get_changeform_initial_data(self, request):
1729.         """
1730.         Get the initial form data from the request's GET params.
1731.         """
1732.         initial = dict(request.GET.items())
1733.         for k in initial:
1734.             try:
1735.                 f = self.opts.get_field(k)
1736.             except FieldDoesNotExist:
1737.                 continue
1738.             # We have to special-case M2Ms as a list of comma-separated PKs.
1739.             if isinstance(f, models.ManyToManyField):
1740.                 initial[k] = initial[k].split(",")
1741.         return initial
1742. 
1743.     def _get_obj_does_not_exist_redirect(self, request, opts, object_id):
1744.         """
1745.         Create a message informing the user that the object doesn't exist
1746.         and return a redirect to the admin index page.
1747.         """
1748.         msg = _("%(name)s with ID “%(key)s” doesn’t exist. Perhaps it was deleted?") % {
1749.             "name": opts.verbose_name,
1750.             "key": unquote(object_id),
1751.         }
1752.         self.message_user(request, msg, messages.WARNING)
1753.         url = reverse("admin:index", current_app=self.admin_site.name)
1754.         return HttpResponseRedirect(url)
1755. 
1756.     @csrf_protect_m
1757.     def changeform_view(self, request, object_id=None, form_url="", extra_context=None):
1758.         with transaction.atomic(using=router.db_for_write(self.model)):
1759.             return self._changeform_view(request, object_id, form_url, extra_context)
1760. 
1761.     def _changeform_view(self, request, object_id, form_url, extra_context):
1762.         to_field = request.POST.get(TO_FIELD_VAR, request.GET.get(TO_FIELD_VAR))
1763.         if to_field and not self.to_field_allowed(request, to_field):
1764.             raise DisallowedModelAdminToField(
1765.                 "The field %s cannot be referenced." % to_field
1766.             )
1767. 
1768.         if request.method == "POST" and "_saveasnew" in request.POST:
1769.             object_id = None
1770. 
1771.         add = object_id is None
1772. 
1773.         if add:
1774.             if not self.has_add_permission(request):
1775.                 raise PermissionDenied
1776.             obj = None
1777. 
1778.         else:
1779.             obj = self.get_object(request, unquote(object_id), to_field)
1780. 
1781.             if request.method == "POST":
1782.                 if not self.has_change_permission(request, obj):
1783.                     raise PermissionDenied
1784.             else:
1785.                 if not self.has_view_or_change_permission(request, obj):
1786.                     raise PermissionDenied
1787. 
1788.             if obj is None:
1789.                 return self._get_obj_does_not_exist_redirect(
1790.                     request, self.opts, object_id
1791.                 )
1792. 
1793.         fieldsets = self.get_fieldsets(request, obj)
1794.         ModelForm = self.get_form(
1795.             request, obj, change=not add, fields=flatten_fieldsets(fieldsets)
1796.         )
1797.         if request.method == "POST":
1798.             form = ModelForm(request.POST, request.FILES, instance=obj)
1799.             formsets, inline_instances = self._create_formsets(
1800.                 request,
1801.                 form.instance,
1802.                 change=not add,
1803.             )
1804.             form_validated = form.is_valid()
1805.             if form_validated:
1806.                 new_object = self.save_form(request, form, change=not add)
1807.             else:
1808.                 new_object = form.instance
1809.             if all_valid(formsets) and form_validated:
1810.                 self.save_model(request, new_object, form, not add)
1811.                 self.save_related(request, form, formsets, not add)
1812.                 change_message = self.construct_change_message(
1813.                     request, form, formsets, add
1814.                 )
1815.                 if add:
1816.                     self.log_addition(request, new_object, change_message)
1817.                     return self.response_add(request, new_object)
1818.                 else:
1819.                     self.log_change(request, new_object, change_message)
1820.                     return self.response_change(request, new_object)
1821.             else:
1822.                 form_validated = False
1823.         else:
1824.             if add:
1825.                 initial = self.get_changeform_initial_data(request)
1826.                 form = ModelForm(initial=initial)
1827.                 formsets, inline_instances = self._create_formsets(
1828.                     request, form.instance, change=False
1829.                 )
1830.             else:
1831.                 form = ModelForm(instance=obj)
1832.                 formsets, inline_instances = self._create_formsets(
1833.                     request, obj, change=True
1834.                 )
1835. 
1836.         if not add and not self.has_change_permission(request, obj):
1837.             readonly_fields = flatten_fieldsets(fieldsets)
1838.         else:
1839.             readonly_fields = self.get_readonly_fields(request, obj)
1840.         admin_form = helpers.AdminForm(
1841.             form,
1842.             list(fieldsets),
1843.             # Clear prepopulated fields on a view-only form to avoid a crash.
1844.             self.get_prepopulated_fields(request, obj)
1845.             if add or self.has_change_permission(request, obj)
1846.             else {},
1847.             readonly_fields,
1848.             model_admin=self,
1849.         )
1850.         media = self.media + admin_form.media
1851. 
1852.         inline_formsets = self.get_inline_formsets(
1853.             request, formsets, inline_instances, obj
1854.         )
1855.         for inline_formset in inline_formsets:
1856.             media += inline_formset.media
1857. 
1858.         if add:
1859.             title = _("Add %s")
1860.         elif self.has_change_permission(request, obj):
1861.             title = _("Change %s")
1862.         else:
1863.             title = _("View %s")
1864.         context = {
1865.             **self.admin_site.each_context(request),
1866.             "title": title % self.opts.verbose_name,
1867.             "subtitle": str(obj) if obj else None,
1868.             "adminform": admin_form,
1869.             "object_id": object_id,
1870.             "original": obj,
1871.             "is_popup": IS_POPUP_VAR in request.POST or IS_POPUP_VAR in request.GET,
1872.             "to_field": to_field,
1873.             "media": media,
1874.             "inline_admin_formsets": inline_formsets,
1875.             "errors": helpers.AdminErrorList(form, formsets),
1876.             "preserved_filters": self.get_preserved_filters(request),
1877.         }
1878. 
1879.         # Hide the "Save" and "Save and continue" buttons if "Save as New" was
1880.         # previously chosen to prevent the interface from getting confusing.
1881.         if (
1882.             request.method == "POST"
1883.             and not form_validated
1884.             and "_saveasnew" in request.POST
1885.         ):
1886.             context["show_save"] = False
1887.             context["show_save_and_continue"] = False
1888.             # Use the change template instead of the add template.
1889.             add = False
1890. 
1891.         context.update(extra_context or {})
1892. 
1893.         return self.render_change_form(
1894.             request, context, add=add, change=not add, obj=obj, form_url=form_url
1895.         )
1896. 
1897.     def add_view(self, request, form_url="", extra_context=None):
1898.         return self.changeform_view(request, None, form_url, extra_context)
1899. 
1900.     def change_view(self, request, object_id, form_url="", extra_context=None):
1901.         return self.changeform_view(request, object_id, form_url, extra_context)
1902. 
1903.     def _get_edited_object_pks(self, request, prefix):
1904.         """Return POST data values of list_editable primary keys."""
1905.         pk_pattern = re.compile(
1906.             r"{}-\d+-{}$".format(re.escape(prefix), self.opts.pk.name)
1907.         )
1908.         return [value for key, value in request.POST.items() if pk_pattern.match(key)]
1909. 
1910.     def _get_list_editable_queryset(self, request, prefix):
1911.         """
1912.         Based on POST data, return a queryset of the objects that were edited
1913.         via list_editable.
1914.         """
1915.         object_pks = self._get_edited_object_pks(request, prefix)
1916.         queryset = self.get_queryset(request)
1917.         validate = queryset.model._meta.pk.to_python
1918.         try:
1919.             for pk in object_pks:
1920.                 validate(pk)
1921.         except ValidationError:
1922.             # Disable the optimization if the POST data was tampered with.
1923.             return queryset
1924.         return queryset.filter(pk__in=object_pks)
1925. 
1926.     @csrf_protect_m
1927.     def changelist_view(self, request, extra_context=None):
1928.         """
1929.         The 'change list' admin view for this model.
1930.         """
1931.         from django.contrib.admin.views.main import ERROR_FLAG
1932. 
1933.         app_label = self.opts.app_label
1934.         if not self.has_view_or_change_permission(request):
1935.             raise PermissionDenied
1936. 
1937.         try:
1938.             cl = self.get_changelist_instance(request)
1939.         except IncorrectLookupParameters:
1940.             # Wacky lookup parameters were given, so redirect to the main
1941.             # changelist page, without parameters, and pass an 'invalid=1'
1942.             # parameter via the query string. If wacky parameters were given
1943.             # and the 'invalid=1' parameter was already in the query string,
1944.             # something is screwed up with the database, so display an error
1945.             # page.
1946.             if ERROR_FLAG in request.GET:
1947.                 return SimpleTemplateResponse(
1948.                     "admin/invalid_setup.html",
1949.                     {
1950.                         "title": _("Database error"),
1951.                     },
1952.                 )
1953.             return HttpResponseRedirect(request.path + "?" + ERROR_FLAG + "=1")
1954. 
1955.         # If the request was POSTed, this might be a bulk action or a bulk
1956.         # edit. Try to look up an action or confirmation first, but if this
1957.         # isn't an action the POST will fall through to the bulk edit check,
1958.         # below.
1959.         action_failed = False
1960.         selected = request.POST.getlist(helpers.ACTION_CHECKBOX_NAME)
1961. 
1962.         actions = self.get_actions(request)
1963.         # Actions with no confirmation
1964.         if (
1965.             actions
1966.             and request.method == "POST"
1967.             and "index" in request.POST
1968.             and "_save" not in request.POST
1969.         ):
1970.             if selected:
1971.                 response = self.response_action(
1972.                     request, queryset=cl.get_queryset(request)
1973.                 )
1974.                 if response:
1975.                     return response
1976.                 else:
1977.                     action_failed = True
1978.             else:
1979.                 msg = _(
1980.                     "Items must be selected in order to perform "
1981.                     "actions on them. No items have been changed."
1982.                 )
1983.                 self.message_user(request, msg, messages.WARNING)
1984.                 action_failed = True
1985. 
1986.         # Actions with confirmation
1987.         if (
1988.             actions
1989.             and request.method == "POST"
1990.             and helpers.ACTION_CHECKBOX_NAME in request.POST
1991.             and "index" not in request.POST
1992.             and "_save" not in request.POST
1993.         ):
1994.             if selected:
1995.                 response = self.response_action(
1996.                     request, queryset=cl.get_queryset(request)
1997.                 )
1998.                 if response:
1999.                     return response
2000.                 else:

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-24 05:48:10,042 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="The user wants to understand a bug in `ModelAdmin.lookup_allowed` related to how it handles lookups through `OneToOneField` primary keys. The current context provides `django/contrib/admin/options.py`, which contains the `lookup_allowed` method. However, the logic of this method depends heavily on the attributes of Django's model fields, specifically `is_relation` and `path_infos`. These attributes are defined within Django's ORM, not in the admin code. To understand why the lookup is failing and how the provided patch fixes it, I need to see the implementation of the relational fields themselves." query='Please provide the full content of the file django/db/models/fields/related.py.' extra_requirements='' purpose='This file defines `ForeignKey`, `OneToOneField`, and other relational fields, which will provide the necessary context on the `path_infos` and `target_fields` attributes that are central to the bug.'
2025-12-24 05:48:10,044 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of the file django/db/models/fields/related.py.
2025-12-24 05:48:10,044 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-24 05:48:10,044 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-24 05:48:10,045 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-24 05:48:10,045 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of the file django/db/models/fields/related.py.
Purpose: This file defines `ForeignKey`, `OneToOneField`, and other relational fields, which will provide the necessary context on the `path_infos` and `target_fields` attributes that are central to the bug.
2025-12-24 05:48:12,919 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the full content of the file `django/db/models/fields/related.py`. This file is crucial for understanding the issue as it defines various relational fields, including `ForeignKey` and `OneToOneField`, which will provide the necessary context on the `path_infos` and `target_fields` attributes that are central to the bug.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "django/db/models/fields/related.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2123, 'candidates_token_count': 99, 'total_token_count': 2351, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2123}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 99}], 'thoughts_token_count': 129, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.09073483823525785, 'model_name': 'gemini-2.5-pro'} id='run--22118979-1136-44db-833f-396a06fda41b-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'django/db/models/fields/related.py'}, 'id': '1378fe32-f51b-4b1a-97b6-aa9c38ec2f6e', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2123, 'output_tokens': 99, 'total_tokens': 2351, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 129}}
2025-12-24 05:48:15,487 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have read the first 500 lines of `django/db/models/fields/related.py` and will now read the remaining content to provide the complete file. This file is essential for understanding the context of relational fields in Django.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 501.0, "relative_path": "django/db/models/fields/related.py", "end_line": 1000.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 9322, 'candidates_token_count': 82, 'total_token_count': 9501, 'cached_content_token_count': 1835, 'prompt_tokens_details': [{'modality': 1, 'token_count': 9322}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1835}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 82}], 'thoughts_token_count': 97}, 'finish_reason': 'STOP', 'avg_logprobs': -0.14428322489668682, 'model_name': 'gemini-2.5-pro'} id='run--60174991-9e43-4b2f-8cae-c64ef564dc0e-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 501.0, 'relative_path': 'django/db/models/fields/related.py', 'end_line': 1000.0}, 'id': '0ec74ce4-3f0f-419a-9b3f-5b866d1975c1', 'type': 'tool_call'}] usage_metadata={'input_tokens': 9322, 'output_tokens': 82, 'total_tokens': 9501, 'input_token_details': {'cache_read': 1835}, 'output_token_details': {'reasoning': 97}}
2025-12-24 05:48:20,365 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have now retrieved the entire content of `django/db/models/fields/related.py`. This file provides the complete implementation of Django's relational fields, which is essential for understanding the context of the bug." additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 1001.0, "relative_path": "django/db/models/fields/related.py", "end_line": 1500.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 16341, 'candidates_token_count': 76, 'total_token_count': 16709, 'cached_content_token_count': 9481, 'prompt_tokens_details': [{'modality': 1, 'token_count': 16341}], 'cache_tokens_details': [{'modality': 1, 'token_count': 9481}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 76}], 'thoughts_token_count': 292}, 'finish_reason': 'STOP', 'avg_logprobs': -0.46515073274311264, 'model_name': 'gemini-2.5-pro'} id='run--c2c4d30d-74b4-4852-a20a-4e98e7f5bb3c-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 1001.0, 'relative_path': 'django/db/models/fields/related.py', 'end_line': 1500.0}, 'id': '8c8dc961-4c22-4862-a364-7ecd5bd89068', 'type': 'tool_call'}] usage_metadata={'input_tokens': 16341, 'output_tokens': 76, 'total_tokens': 16709, 'input_token_details': {'cache_read': 9481}, 'output_token_details': {'reasoning': 292}}
2025-12-24 05:48:22,267 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have now retrieved the entire content of `django/db/models/fields/related.py`. This file provides the complete implementation of Django's relational fields, which is essential for understanding the context of the bug." additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 1501.0, "relative_path": "django/db/models/fields/related.py", "end_line": 2000.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 23672, 'candidates_token_count': 76, 'total_token_count': 23748, 'cached_content_token_count': 15397, 'prompt_tokens_details': [{'modality': 1, 'token_count': 23672}], 'cache_tokens_details': [{'modality': 1, 'token_count': 15397}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 76}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.039189856303365606, 'model_name': 'gemini-2.5-pro'} id='run--046cfee2-a78b-44d9-baeb-811ccb7309a1-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 1501.0, 'relative_path': 'django/db/models/fields/related.py', 'end_line': 2000.0}, 'id': '2c9efedf-6f0b-4532-b9b8-01e72bac0eaf', 'type': 'tool_call'}] usage_metadata={'input_tokens': 23672, 'output_tokens': 76, 'total_tokens': 23748, 'input_token_details': {'cache_read': 15397}}
2025-12-24 05:48:25,172 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have successfully retrieved the entire content of the file `django/db/models/fields/related.py`. This was done by reading the file in manageable chunks to ensure all data was captured. The file's content, defining crucial relational fields for the Django ORM, is now fully available for analysis." additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 31630, 'candidates_token_count': 63, 'total_token_count': 31787, 'cached_content_token_count': 23271, 'prompt_tokens_details': [{'modality': 1, 'token_count': 31630}], 'cache_tokens_details': [{'modality': 1, 'token_count': 23271}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 63}], 'thoughts_token_count': 94}, 'finish_reason': 'STOP', 'avg_logprobs': -0.3407386900886657, 'model_name': 'gemini-2.5-pro'} id='run--e94be131-8788-49ec-b421-b330fe54367f-0' usage_metadata={'input_tokens': 31630, 'output_tokens': 63, 'total_tokens': 31787, 'input_token_details': {'cache_read': 23271}, 'output_token_details': {'reasoning': 94}}
2025-12-24 05:48:25,174 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of the file django/db/models/fields/related.py.
--- END QUERY ---



--- BEGIN PURPOSE ---
This file defines `ForeignKey`, `OneToOneField`, and other relational fields, which will provide the necessary context on the `path_infos` and `target_fields` attributes that are central to the bug.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: django/db/models/fields/related.py
Line number range: 1 - 500
Content:
1. import functools
2. import inspect
3. from functools import partial
4. 
5. from django import forms
6. from django.apps import apps
7. from django.conf import SettingsReference, settings
8. from django.core import checks, exceptions
9. from django.db import connection, router
10. from django.db.backends import utils
11. from django.db.models import Q
12. from django.db.models.constants import LOOKUP_SEP
13. from django.db.models.deletion import CASCADE, SET_DEFAULT, SET_NULL
14. from django.db.models.query_utils import PathInfo
15. from django.db.models.utils import make_model_tuple
16. from django.utils.functional import cached_property
17. from django.utils.translation import gettext_lazy as _
18. 
19. from . import Field
20. from .mixins import FieldCacheMixin
21. from .related_descriptors import (
22.     ForeignKeyDeferredAttribute,
23.     ForwardManyToOneDescriptor,
24.     ForwardOneToOneDescriptor,
25.     ManyToManyDescriptor,
26.     ReverseManyToOneDescriptor,
27.     ReverseOneToOneDescriptor,
28. )
29. from .related_lookups import (
30.     RelatedExact,
31.     RelatedGreaterThan,
32.     RelatedGreaterThanOrEqual,
33.     RelatedIn,
34.     RelatedIsNull,
35.     RelatedLessThan,
36.     RelatedLessThanOrEqual,
37. )
38. from .reverse_related import ForeignObjectRel, ManyToManyRel, ManyToOneRel, OneToOneRel
39. 
40. RECURSIVE_RELATIONSHIP_CONSTANT = "self"
41. 
42. 
43. def resolve_relation(scope_model, relation):
44.     """
45.     Transform relation into a model or fully-qualified model string of the form
46.     "app_label.ModelName", relative to scope_model.
47. 
48.     The relation argument can be:
49.       * RECURSIVE_RELATIONSHIP_CONSTANT, i.e. the string "self", in which case
50.         the model argument will be returned.
51.       * A bare model name without an app_label, in which case scope_model's
52.         app_label will be prepended.
53.       * An "app_label.ModelName" string.
54.       * A model class, which will be returned unchanged.
55.     """
56.     # Check for recursive relations
57.     if relation == RECURSIVE_RELATIONSHIP_CONSTANT:
58.         relation = scope_model
59. 
60.     # Look for an "app.Model" relation
61.     if isinstance(relation, str):
62.         if "." not in relation:
63.             relation = "%s.%s" % (scope_model._meta.app_label, relation)
64. 
65.     return relation
66. 
67. 
68. def lazy_related_operation(function, model, *related_models, **kwargs):
69.     """
70.     Schedule `function` to be called once `model` and all `related_models`
71.     have been imported and registered with the app registry. `function` will
72.     be called with the newly-loaded model classes as its positional arguments,
73.     plus any optional keyword arguments.
74. 
75.     The `model` argument must be a model class. Each subsequent positional
76.     argument is another model, or a reference to another model - see
77.     `resolve_relation()` for the various forms these may take. Any relative
78.     references will be resolved relative to `model`.
79. 
80.     This is a convenience wrapper for `Apps.lazy_model_operation` - the app
81.     registry model used is the one found in `model._meta.apps`.
82.     """
83.     models = [model] + [resolve_relation(model, rel) for rel in related_models]
84.     model_keys = (make_model_tuple(m) for m in models)
85.     apps = model._meta.apps
86.     return apps.lazy_model_operation(partial(function, **kwargs), *model_keys)
87. 
88. 
89. class RelatedField(FieldCacheMixin, Field):
90.     """Base class that all relational fields inherit from."""
91. 
92.     # Field flags
93.     one_to_many = False
94.     one_to_one = False
95.     many_to_many = False
96.     many_to_one = False
97. 
98.     def __init__(
99.         self,
100.         related_name=None,
101.         related_query_name=None,
102.         limit_choices_to=None,
103.         **kwargs,
104.     ):
105.         self._related_name = related_name
106.         self._related_query_name = related_query_name
107.         self._limit_choices_to = limit_choices_to
108.         super().__init__(**kwargs)
109. 
110.     @cached_property
111.     def related_model(self):
112.         # Can't cache this property until all the models are loaded.
113.         apps.check_models_ready()
114.         return self.remote_field.model
115. 
116.     def check(self, **kwargs):
117.         return [
118.             *super().check(**kwargs),
119.             *self._check_related_name_is_valid(),
120.             *self._check_related_query_name_is_valid(),
121.             *self._check_relation_model_exists(),
122.             *self._check_referencing_to_swapped_model(),
123.             *self._check_clashes(),
124.         ]
125. 
126.     def _check_related_name_is_valid(self):
127.         import keyword
128. 
129.         related_name = self.remote_field.related_name
130.         if related_name is None:
131.             return []
132.         is_valid_id = (
133.             not keyword.iskeyword(related_name) and related_name.isidentifier()
134.         )
135.         if not (is_valid_id or related_name.endswith("+")):
136.             return [
137.                 checks.Error(
138.                     "The name '%s' is invalid related_name for field %s.%s"
139.                     % (
140.                         self.remote_field.related_name,
141.                         self.model._meta.object_name,
142.                         self.name,
143.                     ),
144.                     hint=(
145.                         "Related name must be a valid Python identifier or end with a "
146.                         "'+'"
147.                     ),
148.                     obj=self,
149.                     id="fields.E306",
150.                 )
151.             ]
152.         return []
153. 
154.     def _check_related_query_name_is_valid(self):
155.         if self.remote_field.is_hidden():
156.             return []
157.         rel_query_name = self.related_query_name()
158.         errors = []
159.         if rel_query_name.endswith("_"):
160.             errors.append(
161.                 checks.Error(
162.                     "Reverse query name '%s' must not end with an underscore."
163.                     % rel_query_name,
164.                     hint=(
165.                         "Add or change a related_name or related_query_name "
166.                         "argument for this field."
167.                     ),
168.                     obj=self,
169.                     id="fields.E308",
170.                 )
171.             )
172.         if LOOKUP_SEP in rel_query_name:
173.             errors.append(
174.                 checks.Error(
175.                     "Reverse query name '%s' must not contain '%s'."
176.                     % (rel_query_name, LOOKUP_SEP),
177.                     hint=(
178.                         "Add or change a related_name or related_query_name "
179.                         "argument for this field."
180.                     ),
181.                     obj=self,
182.                     id="fields.E309",
183.                 )
184.             )
185.         return errors
186. 
187.     def _check_relation_model_exists(self):
188.         rel_is_missing = self.remote_field.model not in self.opts.apps.get_models()
189.         rel_is_string = isinstance(self.remote_field.model, str)
190.         model_name = (
191.             self.remote_field.model
192.             if rel_is_string
193.             else self.remote_field.model._meta.object_name
194.         )
195.         if rel_is_missing and (
196.             rel_is_string or not self.remote_field.model._meta.swapped
197.         ):
198.             return [
199.                 checks.Error(
200.                     "Field defines a relation with model '%s', which is either "
201.                     "not installed, or is abstract." % model_name,
202.                     obj=self,
203.                     id="fields.E300",
204.                 )
205.             ]
206.         return []
207. 
208.     def _check_referencing_to_swapped_model(self):
209.         if (
210.             self.remote_field.model not in self.opts.apps.get_models()
211.             and not isinstance(self.remote_field.model, str)
212.             and self.remote_field.model._meta.swapped
213.         ):
214.             return [
215.                 checks.Error(
216.                     "Field defines a relation with the model '%s', which has "
217.                     "been swapped out." % self.remote_field.model._meta.label,
218.                     hint="Update the relation to point at 'settings.%s'."
219.                     % self.remote_field.model._meta.swappable,
220.                     obj=self,
221.                     id="fields.E301",
222.                 )
223.             ]
224.         return []
225. 
226.     def _check_clashes(self):
227.         """Check accessor and reverse query name clashes."""
228.         from django.db.models.base import ModelBase
229. 
230.         errors = []
231.         opts = self.model._meta
232. 
233.         # f.remote_field.model may be a string instead of a model. Skip if
234.         # model name is not resolved.
235.         if not isinstance(self.remote_field.model, ModelBase):
236.             return []
237. 
238.         # Consider that we are checking field `Model.foreign` and the models
239.         # are:
240.         #
241.         #     class Target(models.Model):
242.         #         model = models.IntegerField()
243.         #         model_set = models.IntegerField()
244.         #
245.         #     class Model(models.Model):
246.         #         foreign = models.ForeignKey(Target)
247.         #         m2m = models.ManyToManyField(Target)
248. 
249.         # rel_opts.object_name == "Target"
250.         rel_opts = self.remote_field.model._meta
251.         # If the field doesn't install a backward relation on the target model
252.         # (so `is_hidden` returns True), then there are no clashes to check
253.         # and we can skip these fields.
254.         rel_is_hidden = self.remote_field.is_hidden()
255.         rel_name = self.remote_field.get_accessor_name()  # i. e. "model_set"
256.         rel_query_name = self.related_query_name()  # i. e. "model"
257.         # i.e. "app_label.Model.field".
258.         field_name = "%s.%s" % (opts.label, self.name)
259. 
260.         # Check clashes between accessor or reverse query name of `field`
261.         # and any other field name -- i.e. accessor for Model.foreign is
262.         # model_set and it clashes with Target.model_set.
263.         potential_clashes = rel_opts.fields + rel_opts.many_to_many
264.         for clash_field in potential_clashes:
265.             # i.e. "app_label.Target.model_set".
266.             clash_name = "%s.%s" % (rel_opts.label, clash_field.name)
267.             if not rel_is_hidden and clash_field.name == rel_name:
268.                 errors.append(
269.                     checks.Error(
270.                         f"Reverse accessor '{rel_opts.object_name}.{rel_name}' "
271.                         f"for '{field_name}' clashes with field name "
272.                         f"'{clash_name}'.",
273.                         hint=(
274.                             "Rename field '%s', or add/change a related_name "
275.                             "argument to the definition for field '%s'."
276.                         )
277.                         % (clash_name, field_name),
278.                         obj=self,
279.                         id="fields.E302",
280.                     )
281.                 )
282. 
283.             if clash_field.name == rel_query_name:
284.                 errors.append(
285.                     checks.Error(
286.                         "Reverse query name for '%s' clashes with field name '%s'."
287.                         % (field_name, clash_name),
288.                         hint=(
289.                             "Rename field '%s', or add/change a related_name "
290.                             "argument to the definition for field '%s'."
291.                         )
292.                         % (clash_name, field_name),
293.                         obj=self,
294.                         id="fields.E303",
295.                     )
296.                 )
297. 
298.         # Check clashes between accessors/reverse query names of `field` and
299.         # any other field accessor -- i. e. Model.foreign accessor clashes with
300.         # Model.m2m accessor.
301.         potential_clashes = (r for r in rel_opts.related_objects if r.field is not self)
302.         for clash_field in potential_clashes:
303.             # i.e. "app_label.Model.m2m".
304.             clash_name = "%s.%s" % (
305.                 clash_field.related_model._meta.label,
306.                 clash_field.field.name,
307.             )
308.             if not rel_is_hidden and clash_field.get_accessor_name() == rel_name:
309.                 errors.append(
310.                     checks.Error(
311.                         f"Reverse accessor '{rel_opts.object_name}.{rel_name}' "
312.                         f"for '{field_name}' clashes with reverse accessor for "
313.                         f"'{clash_name}'.",
314.                         hint=(
315.                             "Add or change a related_name argument "
316.                             "to the definition for '%s' or '%s'."
317.                         )
318.                         % (field_name, clash_name),
319.                         obj=self,
320.                         id="fields.E304",
321.                     )
322.                 )
323. 
324.             if clash_field.get_accessor_name() == rel_query_name:
325.                 errors.append(
326.                     checks.Error(
327.                         "Reverse query name for '%s' clashes with reverse query name "
328.                         "for '%s'." % (field_name, clash_name),
329.                         hint=(
330.                             "Add or change a related_name argument "
331.                             "to the definition for '%s' or '%s'."
332.                         )
333.                         % (field_name, clash_name),
334.                         obj=self,
335.                         id="fields.E305",
336.                     )
337.                 )
338. 
339.         return errors
340. 
341.     def db_type(self, connection):
342.         # By default related field will not have a column as it relates to
343.         # columns from another table.
344.         return None
345. 
346.     def contribute_to_class(self, cls, name, private_only=False, **kwargs):
347.         super().contribute_to_class(cls, name, private_only=private_only, **kwargs)
348. 
349.         self.opts = cls._meta
350. 
351.         if not cls._meta.abstract:
352.             if self.remote_field.related_name:
353.                 related_name = self.remote_field.related_name
354.             else:
355.                 related_name = self.opts.default_related_name
356.             if related_name:
357.                 related_name %= {
358.                     "class": cls.__name__.lower(),
359.                     "model_name": cls._meta.model_name.lower(),
360.                     "app_label": cls._meta.app_label.lower(),
361.                 }
362.                 self.remote_field.related_name = related_name
363. 
364.             if self.remote_field.related_query_name:
365.                 related_query_name = self.remote_field.related_query_name % {
366.                     "class": cls.__name__.lower(),
367.                     "app_label": cls._meta.app_label.lower(),
368.                 }
369.                 self.remote_field.related_query_name = related_query_name
370. 
371.             def resolve_related_class(model, related, field):
372.                 field.remote_field.model = related
373.                 field.do_related_class(related, model)
374. 
375.             lazy_related_operation(
376.                 resolve_related_class, cls, self.remote_field.model, field=self
377.             )
378. 
379.     def deconstruct(self):
380.         name, path, args, kwargs = super().deconstruct()
381.         if self._limit_choices_to:
382.             kwargs["limit_choices_to"] = self._limit_choices_to
383.         if self._related_name is not None:
384.             kwargs["related_name"] = self._related_name
385.         if self._related_query_name is not None:
386.             kwargs["related_query_name"] = self._related_query_name
387.         return name, path, args, kwargs
388. 
389.     def get_forward_related_filter(self, obj):
390.         """
391.         Return the keyword arguments that when supplied to
392.         self.model.object.filter(), would select all instances related through
393.         this field to the remote obj. This is used to build the querysets
394.         returned by related descriptors. obj is an instance of
395.         self.related_field.model.
396.         """
397.         return {
398.             "%s__%s" % (self.name, rh_field.name): getattr(obj, rh_field.attname)
399.             for _, rh_field in self.related_fields
400.         }
401. 
402.     def get_reverse_related_filter(self, obj):
403.         """
404.         Complement to get_forward_related_filter(). Return the keyword
405.         arguments that when passed to self.related_field.model.object.filter()
406.         select all instances of self.related_field.model related through
407.         this field to obj. obj is an instance of self.model.
408.         """
409.         base_q = Q.create(
410.             [
411.                 (rh_field.attname, getattr(obj, lh_field.attname))
412.                 for lh_field, rh_field in self.related_fields
413.             ]
414.         )
415.         descriptor_filter = self.get_extra_descriptor_filter(obj)
416.         if isinstance(descriptor_filter, dict):
417.             return base_q & Q(**descriptor_filter)
418.         elif descriptor_filter:
419.             return base_q & descriptor_filter
420.         return base_q
421. 
422.     @property
423.     def swappable_setting(self):
424.         """
425.         Get the setting that this is powered from for swapping, or None
426.         if it's not swapped in / marked with swappable=False.
427.         """
428.         if self.swappable:
429.             # Work out string form of "to"
430.             if isinstance(self.remote_field.model, str):
431.                 to_string = self.remote_field.model
432.             else:
433.                 to_string = self.remote_field.model._meta.label
434.             return apps.get_swappable_settings_name(to_string)
435.         return None
436. 
437.     def set_attributes_from_rel(self):
438.         self.name = self.name or (
439.             self.remote_field.model._meta.model_name
440.             + "_"
441.             + self.remote_field.model._meta.pk.name
442.         )
443.         if self.verbose_name is None:
444.             self.verbose_name = self.remote_field.model._meta.verbose_name
445.         self.remote_field.set_field_name()
446. 
447.     def do_related_class(self, other, cls):
448.         self.set_attributes_from_rel()
449.         self.contribute_to_related_class(other, self.remote_field)
450. 
451.     def get_limit_choices_to(self):
452.         """
453.         Return ``limit_choices_to`` for this model field.
454. 
455.         If it is a callable, it will be invoked and the result will be
456.         returned.
457.         """
458.         if callable(self.remote_field.limit_choices_to):
459.             return self.remote_field.limit_choices_to()
460.         return self.remote_field.limit_choices_to
461. 
462.     def formfield(self, **kwargs):
463.         """
464.         Pass ``limit_choices_to`` to the field being constructed.
465. 
466.         Only passes it if there is a type that supports related fields.
467.         This is a similar strategy used to pass the ``queryset`` to the field
468.         being constructed.
469.         """
470.         defaults = {}
471.         if hasattr(self.remote_field, "get_related_field"):
472.             # If this is a callable, do not invoke it here. Just pass
473.             # it in the defaults for when the form class will later be
474.             # instantiated.
475.             limit_choices_to = self.remote_field.limit_choices_to
476.             defaults.update(
477.                 {
478.                     "limit_choices_to": limit_choices_to,
479.                 }
480.             )
481.         defaults.update(kwargs)
482.         return super().formfield(**defaults)
483. 
484.     def related_query_name(self):
485.         """
486.         Define the name that can be used to identify this related object in a
487.         table-spanning query.
488.         """
489.         return (
490.             self.remote_field.related_query_name
491.             or self.remote_field.related_name
492.             or self.opts.model_name
493.         )
494. 
495.     @property
496.     def target_field(self):
497.         """
498.         When filtering against this relation, return the field on the remote
499.         model against which the filtering should happen.
500.         """


File: django/db/models/fields/related.py
Line number range: 501 - 1000
Content:
501.         target_fields = self.path_infos[-1].target_fields
502.         if len(target_fields) > 1:
503.             raise exceptions.FieldError(
504.                 "The relation has multiple target fields, but only single target field "
505.                 "was asked for"
506.             )
507.         return target_fields[0]
508. 
509.     def get_cache_name(self):
510.         return self.name
511. 
512. 
513. class ForeignObject(RelatedField):
514.     """
515.     Abstraction of the ForeignKey relation to support multi-column relations.
516.     """
517. 
518.     # Field flags
519.     many_to_many = False
520.     many_to_one = True
521.     one_to_many = False
522.     one_to_one = False
523. 
524.     requires_unique_target = True
525.     related_accessor_class = ReverseManyToOneDescriptor
526.     forward_related_accessor_class = ForwardManyToOneDescriptor
527.     rel_class = ForeignObjectRel
528. 
529.     def __init__(
530.         self,
531.         to,
532.         on_delete,
533.         from_fields,
534.         to_fields,
535.         rel=None,
536.         related_name=None,
537.         related_query_name=None,
538.         limit_choices_to=None,
539.         parent_link=False,
540.         swappable=True,
541.         **kwargs,
542.     ):
543.         if rel is None:
544.             rel = self.rel_class(
545.                 self,
546.                 to,
547.                 related_name=related_name,
548.                 related_query_name=related_query_name,
549.                 limit_choices_to=limit_choices_to,
550.                 parent_link=parent_link,
551.                 on_delete=on_delete,
552.             )
553. 
554.         super().__init__(
555.             rel=rel,
556.             related_name=related_name,
557.             related_query_name=related_query_name,
558.             limit_choices_to=limit_choices_to,
559.             **kwargs,
560.         )
561. 
562.         self.from_fields = from_fields
563.         self.to_fields = to_fields
564.         self.swappable = swappable
565. 
566.     def __copy__(self):
567.         obj = super().__copy__()
568.         # Remove any cached PathInfo values.
569.         obj.__dict__.pop("path_infos", None)
570.         obj.__dict__.pop("reverse_path_infos", None)
571.         return obj
572. 
573.     def check(self, **kwargs):
574.         return [
575.             *super().check(**kwargs),
576.             *self._check_to_fields_exist(),
577.             *self._check_unique_target(),
578.         ]
579. 
580.     def _check_to_fields_exist(self):
581.         # Skip nonexistent models.
582.         if isinstance(self.remote_field.model, str):
583.             return []
584. 
585.         errors = []
586.         for to_field in self.to_fields:
587.             if to_field:
588.                 try:
589.                     self.remote_field.model._meta.get_field(to_field)
590.                 except exceptions.FieldDoesNotExist:
591.                     errors.append(
592.                         checks.Error(
593.                             "The to_field '%s' doesn't exist on the related "
594.                             "model '%s'."
595.                             % (to_field, self.remote_field.model._meta.label),
596.                             obj=self,
597.                             id="fields.E312",
598.                         )
599.                     )
600.         return errors
601. 
602.     def _check_unique_target(self):
603.         rel_is_string = isinstance(self.remote_field.model, str)
604.         if rel_is_string or not self.requires_unique_target:
605.             return []
606. 
607.         try:
608.             self.foreign_related_fields
609.         except exceptions.FieldDoesNotExist:
610.             return []
611. 
612.         if not self.foreign_related_fields:
613.             return []
614. 
615.         unique_foreign_fields = {
616.             frozenset([f.name])
617.             for f in self.remote_field.model._meta.get_fields()
618.             if getattr(f, "unique", False)
619.         }
620.         unique_foreign_fields.update(
621.             {frozenset(ut) for ut in self.remote_field.model._meta.unique_together}
622.         )
623.         unique_foreign_fields.update(
624.             {
625.                 frozenset(uc.fields)
626.                 for uc in self.remote_field.model._meta.total_unique_constraints
627.             }
628.         )
629.         foreign_fields = {f.name for f in self.foreign_related_fields}
630.         has_unique_constraint = any(u <= foreign_fields for u in unique_foreign_fields)
631. 
632.         if not has_unique_constraint and len(self.foreign_related_fields) > 1:
633.             field_combination = ", ".join(
634.                 "'%s'" % rel_field.name for rel_field in self.foreign_related_fields
635.             )
636.             model_name = self.remote_field.model.__name__
637.             return [
638.                 checks.Error(
639.                     "No subset of the fields %s on model '%s' is unique."
640.                     % (field_combination, model_name),
641.                     hint=(
642.                         "Mark a single field as unique=True or add a set of "
643.                         "fields to a unique constraint (via unique_together "
644.                         "or a UniqueConstraint (without condition) in the "
645.                         "model Meta.constraints)."
646.                     ),
647.                     obj=self,
648.                     id="fields.E310",
649.                 )
650.             ]
651.         elif not has_unique_constraint:
652.             field_name = self.foreign_related_fields[0].name
653.             model_name = self.remote_field.model.__name__
654.             return [
655.                 checks.Error(
656.                     "'%s.%s' must be unique because it is referenced by "
657.                     "a foreign key." % (model_name, field_name),
658.                     hint=(
659.                         "Add unique=True to this field or add a "
660.                         "UniqueConstraint (without condition) in the model "
661.                         "Meta.constraints."
662.                     ),
663.                     obj=self,
664.                     id="fields.E311",
665.                 )
666.             ]
667.         else:
668.             return []
669. 
670.     def deconstruct(self):
671.         name, path, args, kwargs = super().deconstruct()
672.         kwargs["on_delete"] = self.remote_field.on_delete
673.         kwargs["from_fields"] = self.from_fields
674.         kwargs["to_fields"] = self.to_fields
675. 
676.         if self.remote_field.parent_link:
677.             kwargs["parent_link"] = self.remote_field.parent_link
678.         if isinstance(self.remote_field.model, str):
679.             if "." in self.remote_field.model:
680.                 app_label, model_name = self.remote_field.model.split(".")
681.                 kwargs["to"] = "%s.%s" % (app_label, model_name.lower())
682.             else:
683.                 kwargs["to"] = self.remote_field.model.lower()
684.         else:
685.             kwargs["to"] = self.remote_field.model._meta.label_lower
686.         # If swappable is True, then see if we're actually pointing to the target
687.         # of a swap.
688.         swappable_setting = self.swappable_setting
689.         if swappable_setting is not None:
690.             # If it's already a settings reference, error
691.             if hasattr(kwargs["to"], "setting_name"):
692.                 if kwargs["to"].setting_name != swappable_setting:
693.                     raise ValueError(
694.                         "Cannot deconstruct a ForeignKey pointing to a model "
695.                         "that is swapped in place of more than one model (%s and %s)"
696.                         % (kwargs["to"].setting_name, swappable_setting)
697.                     )
698.             # Set it
699.             kwargs["to"] = SettingsReference(
700.                 kwargs["to"],
701.                 swappable_setting,
702.             )
703.         return name, path, args, kwargs
704. 
705.     def resolve_related_fields(self):
706.         if not self.from_fields or len(self.from_fields) != len(self.to_fields):
707.             raise ValueError(
708.                 "Foreign Object from and to fields must be the same non-zero length"
709.             )
710.         if isinstance(self.remote_field.model, str):
711.             raise ValueError(
712.                 "Related model %r cannot be resolved" % self.remote_field.model
713.             )
714.         related_fields = []
715.         for index in range(len(self.from_fields)):
716.             from_field_name = self.from_fields[index]
717.             to_field_name = self.to_fields[index]
718.             from_field = (
719.                 self
720.                 if from_field_name == RECURSIVE_RELATIONSHIP_CONSTANT
721.                 else self.opts.get_field(from_field_name)
722.             )
723.             to_field = (
724.                 self.remote_field.model._meta.pk
725.                 if to_field_name is None
726.                 else self.remote_field.model._meta.get_field(to_field_name)
727.             )
728.             related_fields.append((from_field, to_field))
729.         return related_fields
730. 
731.     @cached_property
732.     def related_fields(self):
733.         return self.resolve_related_fields()
734. 
735.     @cached_property
736.     def reverse_related_fields(self):
737.         return [(rhs_field, lhs_field) for lhs_field, rhs_field in self.related_fields]
738. 
739.     @cached_property
740.     def local_related_fields(self):
741.         return tuple(lhs_field for lhs_field, rhs_field in self.related_fields)
742. 
743.     @cached_property
744.     def foreign_related_fields(self):
745.         return tuple(
746.             rhs_field for lhs_field, rhs_field in self.related_fields if rhs_field
747.         )
748. 
749.     def get_local_related_value(self, instance):
750.         return self.get_instance_value_for_fields(instance, self.local_related_fields)
751. 
752.     def get_foreign_related_value(self, instance):
753.         return self.get_instance_value_for_fields(instance, self.foreign_related_fields)
754. 
755.     @staticmethod
756.     def get_instance_value_for_fields(instance, fields):
757.         ret = []
758.         opts = instance._meta
759.         for field in fields:
760.             # Gotcha: in some cases (like fixture loading) a model can have
761.             # different values in parent_ptr_id and parent's id. So, use
762.             # instance.pk (that is, parent_ptr_id) when asked for instance.id.
763.             if field.primary_key:
764.                 possible_parent_link = opts.get_ancestor_link(field.model)
765.                 if (
766.                     not possible_parent_link
767.                     or possible_parent_link.primary_key
768.                     or possible_parent_link.model._meta.abstract
769.                 ):
770.                     ret.append(instance.pk)
771.                     continue
772.             ret.append(getattr(instance, field.attname))
773.         return tuple(ret)
774. 
775.     def get_attname_column(self):
776.         attname, column = super().get_attname_column()
777.         return attname, None
778. 
779.     def get_joining_columns(self, reverse_join=False):
780.         source = self.reverse_related_fields if reverse_join else self.related_fields
781.         return tuple(
782.             (lhs_field.column, rhs_field.column) for lhs_field, rhs_field in source
783.         )
784. 
785.     def get_reverse_joining_columns(self):
786.         return self.get_joining_columns(reverse_join=True)
787. 
788.     def get_extra_descriptor_filter(self, instance):
789.         """
790.         Return an extra filter condition for related object fetching when
791.         user does 'instance.fieldname', that is the extra filter is used in
792.         the descriptor of the field.
793. 
794.         The filter should be either a dict usable in .filter(**kwargs) call or
795.         a Q-object. The condition will be ANDed together with the relation's
796.         joining columns.
797. 
798.         A parallel method is get_extra_restriction() which is used in
799.         JOIN and subquery conditions.
800.         """
801.         return {}
802. 
803.     def get_extra_restriction(self, alias, related_alias):
804.         """
805.         Return a pair condition used for joining and subquery pushdown. The
806.         condition is something that responds to as_sql(compiler, connection)
807.         method.
808. 
809.         Note that currently referring both the 'alias' and 'related_alias'
810.         will not work in some conditions, like subquery pushdown.
811. 
812.         A parallel method is get_extra_descriptor_filter() which is used in
813.         instance.fieldname related object fetching.
814.         """
815.         return None
816. 
817.     def get_path_info(self, filtered_relation=None):
818.         """Get path from this field to the related model."""
819.         opts = self.remote_field.model._meta
820.         from_opts = self.model._meta
821.         return [
822.             PathInfo(
823.                 from_opts=from_opts,
824.                 to_opts=opts,
825.                 target_fields=self.foreign_related_fields,
826.                 join_field=self,
827.                 m2m=False,
828.                 direct=True,
829.                 filtered_relation=filtered_relation,
830.             )
831.         ]
832. 
833.     @cached_property
834.     def path_infos(self):
835.         return self.get_path_info()
836. 
837.     def get_reverse_path_info(self, filtered_relation=None):
838.         """Get path from the related model to this field's model."""
839.         opts = self.model._meta
840.         from_opts = self.remote_field.model._meta
841.         return [
842.             PathInfo(
843.                 from_opts=from_opts,
844.                 to_opts=opts,
845.                 target_fields=(opts.pk,),
846.                 join_field=self.remote_field,
847.                 m2m=not self.unique,
848.                 direct=False,
849.                 filtered_relation=filtered_relation,
850.             )
851.         ]
852. 
853.     @cached_property
854.     def reverse_path_infos(self):
855.         return self.get_reverse_path_info()
856. 
857.     @classmethod
858.     @functools.cache
859.     def get_class_lookups(cls):
860.         bases = inspect.getmro(cls)
861.         bases = bases[: bases.index(ForeignObject) + 1]
862.         class_lookups = [parent.__dict__.get("class_lookups", {}) for parent in bases]
863.         return cls.merge_dicts(class_lookups)
864. 
865.     def contribute_to_class(self, cls, name, private_only=False, **kwargs):
866.         super().contribute_to_class(cls, name, private_only=private_only, **kwargs)
867.         setattr(cls, self.name, self.forward_related_accessor_class(self))
868. 
869.     def contribute_to_related_class(self, cls, related):
870.         # Internal FK's - i.e., those with a related name ending with '+' -
871.         # and swapped models don't get a related descriptor.
872.         if (
873.             not self.remote_field.is_hidden()
874.             and not related.related_model._meta.swapped
875.         ):
876.             setattr(
877.                 cls._meta.concrete_model,
878.                 related.get_accessor_name(),
879.                 self.related_accessor_class(related),
880.             )
881.             # While 'limit_choices_to' might be a callable, simply pass
882.             # it along for later - this is too early because it's still
883.             # model load time.
884.             if self.remote_field.limit_choices_to:
885.                 cls._meta.related_fkey_lookups.append(
886.                     self.remote_field.limit_choices_to
887.                 )
888. 
889. 
890. ForeignObject.register_lookup(RelatedIn)
891. ForeignObject.register_lookup(RelatedExact)
892. ForeignObject.register_lookup(RelatedLessThan)
893. ForeignObject.register_lookup(RelatedGreaterThan)
894. ForeignObject.register_lookup(RelatedGreaterThanOrEqual)
895. ForeignObject.register_lookup(RelatedLessThanOrEqual)
896. ForeignObject.register_lookup(RelatedIsNull)
897. 
898. 
899. class ForeignKey(ForeignObject):
900.     """
901.     Provide a many-to-one relation by adding a column to the local model
902.     to hold the remote value.
903. 
904.     By default ForeignKey will target the pk of the remote model but this
905.     behavior can be changed by using the ``to_field`` argument.
906.     """
907. 
908.     descriptor_class = ForeignKeyDeferredAttribute
909.     # Field flags
910.     many_to_many = False
911.     many_to_one = True
912.     one_to_many = False
913.     one_to_one = False
914. 
915.     rel_class = ManyToOneRel
916. 
917.     empty_strings_allowed = False
918.     default_error_messages = {
919.         "invalid": _("%(model)s instance with %(field)s %(value)r does not exist.")
920.     }
921.     description = _("Foreign Key (type determined by related field)")
922. 
923.     def __init__(
924.         self,
925.         to,
926.         on_delete,
927.         related_name=None,
928.         related_query_name=None,
929.         limit_choices_to=None,
930.         parent_link=False,
931.         to_field=None,
932.         db_constraint=True,
933.         **kwargs,
934.     ):
935.         try:
936.             to._meta.model_name
937.         except AttributeError:
938.             if not isinstance(to, str):
939.                 raise TypeError(
940.                     "%s(%r) is invalid. First parameter to ForeignKey must be "
941.                     "either a model, a model name, or the string %r"
942.                     % (
943.                         self.__class__.__name__,
944.                         to,
945.                         RECURSIVE_RELATIONSHIP_CONSTANT,
946.                     )
947.                 )
948.         else:
949.             # For backwards compatibility purposes, we need to *try* and set
950.             # the to_field during FK construction. It won't be guaranteed to
951.             # be correct until contribute_to_class is called. Refs #12190.
952.             to_field = to_field or (to._meta.pk and to._meta.pk.name)
953.         if not callable(on_delete):
954.             raise TypeError("on_delete must be callable.")
955. 
956.         kwargs["rel"] = self.rel_class(
957.             self,
958.             to,
959.             to_field,
960.             related_name=related_name,
961.             related_query_name=related_query_name,
962.             limit_choices_to=limit_choices_to,
963.             parent_link=parent_link,
964.             on_delete=on_delete,
965.         )
966.         kwargs.setdefault("db_index", True)
967. 
968.         super().__init__(
969.             to,
970.             on_delete,
971.             related_name=related_name,
972.             related_query_name=related_query_name,
973.             limit_choices_to=limit_choices_to,
974.             from_fields=[RECURSIVE_RELATIONSHIP_CONSTANT],
975.             to_fields=[to_field],
976.             **kwargs,
977.         )
978.         self.db_constraint = db_constraint
979. 
980.     def __class_getitem__(cls, *args, **kwargs):
981.         return cls
982. 
983.     def check(self, **kwargs):
984.         return [
985.             *super().check(**kwargs),
986.             *self._check_on_delete(),
987.             *self._check_unique(),
988.         ]
989. 
990.     def _check_on_delete(self):
991.         on_delete = getattr(self.remote_field, "on_delete", None)
992.         if on_delete == SET_NULL and not self.null:
993.             return [
994.                 checks.Error(
995.                     "Field specifies on_delete=SET_NULL, but cannot be null.",
996.                     hint=(
997.                         "Set null=True argument on the field, or change the on_delete "
998.                         "rule."
999.                     ),
1000.                     obj=self,


File: django/db/models/fields/related.py
Line number range: 1001 - 1500
Content:
1001.                     id="fields.E320",
1002.                 )
1003.             ]
1004.         elif on_delete == SET_DEFAULT and not self.has_default():
1005.             return [
1006.                 checks.Error(
1007.                     "Field specifies on_delete=SET_DEFAULT, but has no default value.",
1008.                     hint="Set a default value, or change the on_delete rule.",
1009.                     obj=self,
1010.                     id="fields.E321",
1011.                 )
1012.             ]
1013.         else:
1014.             return []
1015. 
1016.     def _check_unique(self, **kwargs):
1017.         return (
1018.             [
1019.                 checks.Warning(
1020.                     "Setting unique=True on a ForeignKey has the same effect as using "
1021.                     "a OneToOneField.",
1022.                     hint=(
1023.                         "ForeignKey(unique=True) is usually better served by a "
1024.                         "OneToOneField."
1025.                     ),
1026.                     obj=self,
1027.                     id="fields.W342",
1028.                 )
1029.             ]
1030.             if self.unique
1031.             else []
1032.         )
1033. 
1034.     def deconstruct(self):
1035.         name, path, args, kwargs = super().deconstruct()
1036.         del kwargs["to_fields"]
1037.         del kwargs["from_fields"]
1038.         # Handle the simpler arguments
1039.         if self.db_index:
1040.             del kwargs["db_index"]
1041.         else:
1042.             kwargs["db_index"] = False
1043.         if self.db_constraint is not True:
1044.             kwargs["db_constraint"] = self.db_constraint
1045.         # Rel needs more work.
1046.         to_meta = getattr(self.remote_field.model, "_meta", None)
1047.         if self.remote_field.field_name and (
1048.             not to_meta
1049.             or (to_meta.pk and self.remote_field.field_name != to_meta.pk.name)
1050.         ):
1051.             kwargs["to_field"] = self.remote_field.field_name
1052.         return name, path, args, kwargs
1053. 
1054.     def to_python(self, value):
1055.         return self.target_field.to_python(value)
1056. 
1057.     @property
1058.     def target_field(self):
1059.         return self.foreign_related_fields[0]
1060. 
1061.     def validate(self, value, model_instance):
1062.         if self.remote_field.parent_link:
1063.             return
1064.         super().validate(value, model_instance)
1065.         if value is None:
1066.             return
1067. 
1068.         using = router.db_for_read(self.remote_field.model, instance=model_instance)
1069.         qs = self.remote_field.model._base_manager.using(using).filter(
1070.             **{self.remote_field.field_name: value}
1071.         )
1072.         qs = qs.complex_filter(self.get_limit_choices_to())
1073.         if not qs.exists():
1074.             raise exceptions.ValidationError(
1075.                 self.error_messages["invalid"],
1076.                 code="invalid",
1077.                 params={
1078.                     "model": self.remote_field.model._meta.verbose_name,
1079.                     "pk": value,
1080.                     "field": self.remote_field.field_name,
1081.                     "value": value,
1082.                 },  # 'pk' is included for backwards compatibility
1083.             )
1084. 
1085.     def resolve_related_fields(self):
1086.         related_fields = super().resolve_related_fields()
1087.         for from_field, to_field in related_fields:
1088.             if (
1089.                 to_field
1090.                 and to_field.model != self.remote_field.model._meta.concrete_model
1091.             ):
1092.                 raise exceptions.FieldError(
1093.                     "'%s.%s' refers to field '%s' which is not local to model "
1094.                     "'%s'."
1095.                     % (
1096.                         self.model._meta.label,
1097.                         self.name,
1098.                         to_field.name,
1099.                         self.remote_field.model._meta.concrete_model._meta.label,
1100.                     )
1101.                 )
1102.         return related_fields
1103. 
1104.     def get_attname(self):
1105.         return "%s_id" % self.name
1106. 
1107.     def get_attname_column(self):
1108.         attname = self.get_attname()
1109.         column = self.db_column or attname
1110.         return attname, column
1111. 
1112.     def get_default(self):
1113.         """Return the to_field if the default value is an object."""
1114.         field_default = super().get_default()
1115.         if isinstance(field_default, self.remote_field.model):
1116.             return getattr(field_default, self.target_field.attname)
1117.         return field_default
1118. 
1119.     def get_db_prep_save(self, value, connection):
1120.         if value is None or (
1121.             value == ""
1122.             and (
1123.                 not self.target_field.empty_strings_allowed
1124.                 or connection.features.interprets_empty_strings_as_nulls
1125.             )
1126.         ):
1127.             return None
1128.         else:
1129.             return self.target_field.get_db_prep_save(value, connection=connection)
1130. 
1131.     def get_db_prep_value(self, value, connection, prepared=False):
1132.         return self.target_field.get_db_prep_value(value, connection, prepared)
1133. 
1134.     def get_prep_value(self, value):
1135.         return self.target_field.get_prep_value(value)
1136. 
1137.     def contribute_to_related_class(self, cls, related):
1138.         super().contribute_to_related_class(cls, related)
1139.         if self.remote_field.field_name is None:
1140.             self.remote_field.field_name = cls._meta.pk.name
1141. 
1142.     def formfield(self, *, using=None, **kwargs):
1143.         if isinstance(self.remote_field.model, str):
1144.             raise ValueError(
1145.                 "Cannot create form field for %r yet, because "
1146.                 "its related model %r has not been loaded yet"
1147.                 % (self.name, self.remote_field.model)
1148.             )
1149.         return super().formfield(
1150.             **{
1151.                 "form_class": forms.ModelChoiceField,
1152.                 "queryset": self.remote_field.model._default_manager.using(using),
1153.                 "to_field_name": self.remote_field.field_name,
1154.                 **kwargs,
1155.                 "blank": self.blank,
1156.             }
1157.         )
1158. 
1159.     def db_check(self, connection):
1160.         return None
1161. 
1162.     def db_type(self, connection):
1163.         return self.target_field.rel_db_type(connection=connection)
1164. 
1165.     def cast_db_type(self, connection):
1166.         return self.target_field.cast_db_type(connection=connection)
1167. 
1168.     def db_parameters(self, connection):
1169.         target_db_parameters = self.target_field.db_parameters(connection)
1170.         return {
1171.             "type": self.db_type(connection),
1172.             "check": self.db_check(connection),
1173.             "collation": target_db_parameters.get("collation"),
1174.         }
1175. 
1176.     def convert_empty_strings(self, value, expression, connection):
1177.         if (not value) and isinstance(value, str):
1178.             return None
1179.         return value
1180. 
1181.     def get_db_converters(self, connection):
1182.         converters = super().get_db_converters(connection)
1183.         if connection.features.interprets_empty_strings_as_nulls:
1184.             converters += [self.convert_empty_strings]
1185.         return converters
1186. 
1187.     def get_col(self, alias, output_field=None):
1188.         if output_field is None:
1189.             output_field = self.target_field
1190.             while isinstance(output_field, ForeignKey):
1191.                 output_field = output_field.target_field
1192.                 if output_field is self:
1193.                     raise ValueError("Cannot resolve output_field.")
1194.         return super().get_col(alias, output_field)
1195. 
1196. 
1197. class OneToOneField(ForeignKey):
1198.     """
1199.     A OneToOneField is essentially the same as a ForeignKey, with the exception
1200.     that it always carries a "unique" constraint with it and the reverse
1201.     relation always returns the object pointed to (since there will only ever
1202.     be one), rather than returning a list.
1203.     """
1204. 
1205.     # Field flags
1206.     many_to_many = False
1207.     many_to_one = False
1208.     one_to_many = False
1209.     one_to_one = True
1210. 
1211.     related_accessor_class = ReverseOneToOneDescriptor
1212.     forward_related_accessor_class = ForwardOneToOneDescriptor
1213.     rel_class = OneToOneRel
1214. 
1215.     description = _("One-to-one relationship")
1216. 
1217.     def __init__(self, to, on_delete, to_field=None, **kwargs):
1218.         kwargs["unique"] = True
1219.         super().__init__(to, on_delete, to_field=to_field, **kwargs)
1220. 
1221.     def deconstruct(self):
1222.         name, path, args, kwargs = super().deconstruct()
1223.         if "unique" in kwargs:
1224.             del kwargs["unique"]
1225.         return name, path, args, kwargs
1226. 
1227.     def formfield(self, **kwargs):
1228.         if self.remote_field.parent_link:
1229.             return None
1230.         return super().formfield(**kwargs)
1231. 
1232.     def save_form_data(self, instance, data):
1233.         if isinstance(data, self.remote_field.model):
1234.             setattr(instance, self.name, data)
1235.         else:
1236.             setattr(instance, self.attname, data)
1237.             # Remote field object must be cleared otherwise Model.save()
1238.             # will reassign attname using the related object pk.
1239.             if data is None:
1240.                 setattr(instance, self.name, data)
1241. 
1242.     def _check_unique(self, **kwargs):
1243.         # Override ForeignKey since check isn't applicable here.
1244.         return []
1245. 
1246. 
1247. def create_many_to_many_intermediary_model(field, klass):
1248.     from django.db import models
1249. 
1250.     def set_managed(model, related, through):
1251.         through._meta.managed = model._meta.managed or related._meta.managed
1252. 
1253.     to_model = resolve_relation(klass, field.remote_field.model)
1254.     name = "%s_%s" % (klass._meta.object_name, field.name)
1255.     lazy_related_operation(set_managed, klass, to_model, name)
1256. 
1257.     to = make_model_tuple(to_model)[1]
1258.     from_ = klass._meta.model_name
1259.     if to == from_:
1260.         to = "to_%s" % to
1261.         from_ = "from_%s" % from_
1262. 
1263.     meta = type(
1264.         "Meta",
1265.         (),
1266.         {
1267.             "db_table": field._get_m2m_db_table(klass._meta),
1268.             "auto_created": klass,
1269.             "app_label": klass._meta.app_label,
1270.             "db_tablespace": klass._meta.db_tablespace,
1271.             "unique_together": (from_, to),
1272.             "verbose_name": _("%(from)s-%(to)s relationship")
1273.             % {"from": from_, "to": to},
1274.             "verbose_name_plural": _("%(from)s-%(to)s relationships")
1275.             % {"from": from_, "to": to},
1276.             "apps": field.model._meta.apps,
1277.         },
1278.     )
1279.     # Construct and return the new class.
1280.     return type(
1281.         name,
1282.         (models.Model,),
1283.         {
1284.             "Meta": meta,
1285.             "__module__": klass.__module__,
1286.             from_: models.ForeignKey(
1287.                 klass,
1288.                 related_name="%s+" % name,
1289.                 db_tablespace=field.db_tablespace,
1290.                 db_constraint=field.remote_field.db_constraint,
1291.                 on_delete=CASCADE,
1292.             ),
1293.             to: models.ForeignKey(
1294.                 to_model,
1295.                 related_name="%s+" % name,
1296.                 db_tablespace=field.db_tablespace,
1297.                 db_constraint=field.remote_field.db_constraint,
1298.                 on_delete=CASCADE,
1299.             ),
1300.         },
1301.     )
1302. 
1303. 
1304. class ManyToManyField(RelatedField):
1305.     """
1306.     Provide a many-to-many relation by using an intermediary model that
1307.     holds two ForeignKey fields pointed at the two sides of the relation.
1308. 
1309.     Unless a ``through`` model was provided, ManyToManyField will use the
1310.     create_many_to_many_intermediary_model factory to automatically generate
1311.     the intermediary model.
1312.     """
1313. 
1314.     # Field flags
1315.     many_to_many = True
1316.     many_to_one = False
1317.     one_to_many = False
1318.     one_to_one = False
1319. 
1320.     rel_class = ManyToManyRel
1321. 
1322.     description = _("Many-to-many relationship")
1323. 
1324.     def __init__(
1325.         self,
1326.         to,
1327.         related_name=None,
1328.         related_query_name=None,
1329.         limit_choices_to=None,
1330.         symmetrical=None,
1331.         through=None,
1332.         through_fields=None,
1333.         db_constraint=True,
1334.         db_table=None,
1335.         swappable=True,
1336.         **kwargs,
1337.     ):
1338.         try:
1339.             to._meta
1340.         except AttributeError:
1341.             if not isinstance(to, str):
1342.                 raise TypeError(
1343.                     "%s(%r) is invalid. First parameter to ManyToManyField "
1344.                     "must be either a model, a model name, or the string %r"
1345.                     % (
1346.                         self.__class__.__name__,
1347.                         to,
1348.                         RECURSIVE_RELATIONSHIP_CONSTANT,
1349.                     )
1350.                 )
1351. 
1352.         if symmetrical is None:
1353.             symmetrical = to == RECURSIVE_RELATIONSHIP_CONSTANT
1354. 
1355.         if through is not None and db_table is not None:
1356.             raise ValueError(
1357.                 "Cannot specify a db_table if an intermediary model is used."
1358.             )
1359. 
1360.         kwargs["rel"] = self.rel_class(
1361.             self,
1362.             to,
1363.             related_name=related_name,
1364.             related_query_name=related_query_name,
1365.             limit_choices_to=limit_choices_to,
1366.             symmetrical=symmetrical,
1367.             through=through,
1368.             through_fields=through_fields,
1369.             db_constraint=db_constraint,
1370.         )
1371.         self.has_null_arg = "null" in kwargs
1372. 
1373.         super().__init__(
1374.             related_name=related_name,
1375.             related_query_name=related_query_name,
1376.             limit_choices_to=limit_choices_to,
1377.             **kwargs,
1378.         )
1379. 
1380.         self.db_table = db_table
1381.         self.swappable = swappable
1382. 
1383.     def check(self, **kwargs):
1384.         return [
1385.             *super().check(**kwargs),
1386.             *self._check_unique(**kwargs),
1387.             *self._check_relationship_model(**kwargs),
1388.             *self._check_ignored_options(**kwargs),
1389.             *self._check_table_uniqueness(**kwargs),
1390.         ]
1391. 
1392.     def _check_unique(self, **kwargs):
1393.         if self.unique:
1394.             return [
1395.                 checks.Error(
1396.                     "ManyToManyFields cannot be unique.",
1397.                     obj=self,
1398.                     id="fields.E330",
1399.                 )
1400.             ]
1401.         return []
1402. 
1403.     def _check_ignored_options(self, **kwargs):
1404.         warnings = []
1405. 
1406.         if self.has_null_arg:
1407.             warnings.append(
1408.                 checks.Warning(
1409.                     "null has no effect on ManyToManyField.",
1410.                     obj=self,
1411.                     id="fields.W340",
1412.                 )
1413.             )
1414. 
1415.         if self._validators:
1416.             warnings.append(
1417.                 checks.Warning(
1418.                     "ManyToManyField does not support validators.",
1419.                     obj=self,
1420.                     id="fields.W341",
1421.                 )
1422.             )
1423.         if self.remote_field.symmetrical and self._related_name:
1424.             warnings.append(
1425.                 checks.Warning(
1426.                     "related_name has no effect on ManyToManyField "
1427.                     'with a symmetrical relationship, e.g. to "self".',
1428.                     obj=self,
1429.                     id="fields.W345",
1430.                 )
1431.             )
1432.         if self.db_comment:
1433.             warnings.append(
1434.                 checks.Warning(
1435.                     "db_comment has no effect on ManyToManyField.",
1436.                     obj=self,
1437.                     id="fields.W346",
1438.                 )
1439.             )
1440. 
1441.         return warnings
1442. 
1443.     def _check_relationship_model(self, from_model=None, **kwargs):
1444.         if hasattr(self.remote_field.through, "_meta"):
1445.             qualified_model_name = "%s.%s" % (
1446.                 self.remote_field.through._meta.app_label,
1447.                 self.remote_field.through.__name__,
1448.             )
1449.         else:
1450.             qualified_model_name = self.remote_field.through
1451. 
1452.         errors = []
1453. 
1454.         if self.remote_field.through not in self.opts.apps.get_models(
1455.             include_auto_created=True
1456.         ):
1457.             # The relationship model is not installed.
1458.             errors.append(
1459.                 checks.Error(
1460.                     "Field specifies a many-to-many relation through model "
1461.                     "'%s', which has not been installed." % qualified_model_name,
1462.                     obj=self,
1463.                     id="fields.E331",
1464.                 )
1465.             )
1466. 
1467.         else:
1468.             assert from_model is not None, (
1469.                 "ManyToManyField with intermediate "
1470.                 "tables cannot be checked if you don't pass the model "
1471.                 "where the field is attached to."
1472.             )
1473.             # Set some useful local variables
1474.             to_model = resolve_relation(from_model, self.remote_field.model)
1475.             from_model_name = from_model._meta.object_name
1476.             if isinstance(to_model, str):
1477.                 to_model_name = to_model
1478.             else:
1479.                 to_model_name = to_model._meta.object_name
1480.             relationship_model_name = self.remote_field.through._meta.object_name
1481.             self_referential = from_model == to_model
1482.             # Count foreign keys in intermediate model
1483.             if self_referential:
1484.                 seen_self = sum(
1485.                     from_model == getattr(field.remote_field, "model", None)
1486.                     for field in self.remote_field.through._meta.fields
1487.                 )
1488. 
1489.                 if seen_self > 2 and not self.remote_field.through_fields:
1490.                     errors.append(
1491.                         checks.Error(
1492.                             "The model is used as an intermediate model by "
1493.                             "'%s', but it has more than two foreign keys "
1494.                             "to '%s', which is ambiguous. You must specify "
1495.                             "which two foreign keys Django should use via the "
1496.                             "through_fields keyword argument."
1497.                             % (self, from_model_name),
1498.                             hint=(
1499.                                 "Use through_fields to specify which two foreign keys "
1500.                                 "Django should use."


File: django/db/models/fields/related.py
Line number range: 1501 - 2000
Content:
1501.                             ),
1502.                             obj=self.remote_field.through,
1503.                             id="fields.E333",
1504.                         )
1505.                     )
1506. 
1507.             else:
1508.                 # Count foreign keys in relationship model
1509.                 seen_from = sum(
1510.                     from_model == getattr(field.remote_field, "model", None)
1511.                     for field in self.remote_field.through._meta.fields
1512.                 )
1513.                 seen_to = sum(
1514.                     to_model == getattr(field.remote_field, "model", None)
1515.                     for field in self.remote_field.through._meta.fields
1516.                 )
1517. 
1518.                 if seen_from > 1 and not self.remote_field.through_fields:
1519.                     errors.append(
1520.                         checks.Error(
1521.                             (
1522.                                 "The model is used as an intermediate model by "
1523.                                 "'%s', but it has more than one foreign key "
1524.                                 "from '%s', which is ambiguous. You must specify "
1525.                                 "which foreign key Django should use via the "
1526.                                 "through_fields keyword argument."
1527.                             )
1528.                             % (self, from_model_name),
1529.                             hint=(
1530.                                 "If you want to create a recursive relationship, "
1531.                                 'use ManyToManyField("%s", through="%s").'
1532.                             )
1533.                             % (
1534.                                 RECURSIVE_RELATIONSHIP_CONSTANT,
1535.                                 relationship_model_name,
1536.                             ),
1537.                             obj=self,
1538.                             id="fields.E334",
1539.                         )
1540.                     )
1541. 
1542.                 if seen_to > 1 and not self.remote_field.through_fields:
1543.                     errors.append(
1544.                         checks.Error(
1545.                             "The model is used as an intermediate model by "
1546.                             "'%s', but it has more than one foreign key "
1547.                             "to '%s', which is ambiguous. You must specify "
1548.                             "which foreign key Django should use via the "
1549.                             "through_fields keyword argument." % (self, to_model_name),
1550.                             hint=(
1551.                                 "If you want to create a recursive relationship, "
1552.                                 'use ManyToManyField("%s", through="%s").'
1553.                             )
1554.                             % (
1555.                                 RECURSIVE_RELATIONSHIP_CONSTANT,
1556.                                 relationship_model_name,
1557.                             ),
1558.                             obj=self,
1559.                             id="fields.E335",
1560.                         )
1561.                     )
1562. 
1563.                 if seen_from == 0 or seen_to == 0:
1564.                     errors.append(
1565.                         checks.Error(
1566.                             "The model is used as an intermediate model by "
1567.                             "'%s', but it does not have a foreign key to '%s' or '%s'."
1568.                             % (self, from_model_name, to_model_name),
1569.                             obj=self.remote_field.through,
1570.                             id="fields.E336",
1571.                         )
1572.                     )
1573. 
1574.         # Validate `through_fields`.
1575.         if self.remote_field.through_fields is not None:
1576.             # Validate that we're given an iterable of at least two items
1577.             # and that none of them is "falsy".
1578.             if not (
1579.                 len(self.remote_field.through_fields) >= 2
1580.                 and self.remote_field.through_fields[0]
1581.                 and self.remote_field.through_fields[1]
1582.             ):
1583.                 errors.append(
1584.                     checks.Error(
1585.                         "Field specifies 'through_fields' but does not provide "
1586.                         "the names of the two link fields that should be used "
1587.                         "for the relation through model '%s'." % qualified_model_name,
1588.                         hint=(
1589.                             "Make sure you specify 'through_fields' as "
1590.                             "through_fields=('field1', 'field2')"
1591.                         ),
1592.                         obj=self,
1593.                         id="fields.E337",
1594.                     )
1595.                 )
1596. 
1597.             # Validate the given through fields -- they should be actual
1598.             # fields on the through model, and also be foreign keys to the
1599.             # expected models.
1600.             else:
1601.                 assert from_model is not None, (
1602.                     "ManyToManyField with intermediate "
1603.                     "tables cannot be checked if you don't pass the model "
1604.                     "where the field is attached to."
1605.                 )
1606. 
1607.                 source, through, target = (
1608.                     from_model,
1609.                     self.remote_field.through,
1610.                     self.remote_field.model,
1611.                 )
1612.                 source_field_name, target_field_name = self.remote_field.through_fields[
1613.                     :2
1614.                 ]
1615. 
1616.                 for field_name, related_model in (
1617.                     (source_field_name, source),
1618.                     (target_field_name, target),
1619.                 ):
1620.                     possible_field_names = []
1621.                     for f in through._meta.fields:
1622.                         if (
1623.                             hasattr(f, "remote_field")
1624.                             and getattr(f.remote_field, "model", None) == related_model
1625.                         ):
1626.                             possible_field_names.append(f.name)
1627.                     if possible_field_names:
1628.                         hint = (
1629.                             "Did you mean one of the following foreign keys to '%s': "
1630.                             "%s?"
1631.                             % (
1632.                                 related_model._meta.object_name,
1633.                                 ", ".join(possible_field_names),
1634.                             )
1635.                         )
1636.                     else:
1637.                         hint = None
1638. 
1639.                     try:
1640.                         field = through._meta.get_field(field_name)
1641.                     except exceptions.FieldDoesNotExist:
1642.                         errors.append(
1643.                             checks.Error(
1644.                                 "The intermediary model '%s' has no field '%s'."
1645.                                 % (qualified_model_name, field_name),
1646.                                 hint=hint,
1647.                                 obj=self,
1648.                                 id="fields.E338",
1649.                             )
1650.                         )
1651.                     else:
1652.                         if not (
1653.                             hasattr(field, "remote_field")
1654.                             and getattr(field.remote_field, "model", None)
1655.                             == related_model
1656.                         ):
1657.                             errors.append(
1658.                                 checks.Error(
1659.                                     "'%s.%s' is not a foreign key to '%s'."
1660.                                     % (
1661.                                         through._meta.object_name,
1662.                                         field_name,
1663.                                         related_model._meta.object_name,
1664.                                     ),
1665.                                     hint=hint,
1666.                                     obj=self,
1667.                                     id="fields.E339",
1668.                                 )
1669.                             )
1670. 
1671.         return errors
1672. 
1673.     def _check_table_uniqueness(self, **kwargs):
1674.         if (
1675.             isinstance(self.remote_field.through, str)
1676.             or not self.remote_field.through._meta.managed
1677.         ):
1678.             return []
1679.         registered_tables = {
1680.             model._meta.db_table: model
1681.             for model in self.opts.apps.get_models(include_auto_created=True)
1682.             if model != self.remote_field.through and model._meta.managed
1683.         }
1684.         m2m_db_table = self.m2m_db_table()
1685.         model = registered_tables.get(m2m_db_table)
1686.         # The second condition allows multiple m2m relations on a model if
1687.         # some point to a through model that proxies another through model.
1688.         if (
1689.             model
1690.             and model._meta.concrete_model
1691.             != self.remote_field.through._meta.concrete_model
1692.         ):
1693.             if model._meta.auto_created:
1694. 
1695.                 def _get_field_name(model):
1696.                     for field in model._meta.auto_created._meta.many_to_many:
1697.                         if field.remote_field.through is model:
1698.                             return field.name
1699. 
1700.                 opts = model._meta.auto_created._meta
1701.                 clashing_obj = "%s.%s" % (opts.label, _get_field_name(model))
1702.             else:
1703.                 clashing_obj = model._meta.label
1704.             if settings.DATABASE_ROUTERS:
1705.                 error_class, error_id = checks.Warning, "fields.W344"
1706.                 error_hint = (
1707.                     "You have configured settings.DATABASE_ROUTERS. Verify "
1708.                     "that the table of %r is correctly routed to a separate "
1709.                     "database." % clashing_obj
1710.                 )
1711.             else:
1712.                 error_class, error_id = checks.Error, "fields.E340"
1713.                 error_hint = None
1714.             return [
1715.                 error_class(
1716.                     "The field's intermediary table '%s' clashes with the "
1717.                     "table name of '%s'." % (m2m_db_table, clashing_obj),
1718.                     obj=self,
1719.                     hint=error_hint,
1720.                     id=error_id,
1721.                 )
1722.             ]
1723.         return []
1724. 
1725.     def deconstruct(self):
1726.         name, path, args, kwargs = super().deconstruct()
1727.         # Handle the simpler arguments.
1728.         if self.db_table is not None:
1729.             kwargs["db_table"] = self.db_table
1730.         if self.remote_field.db_constraint is not True:
1731.             kwargs["db_constraint"] = self.remote_field.db_constraint
1732.         # Lowercase model names as they should be treated as case-insensitive.
1733.         if isinstance(self.remote_field.model, str):
1734.             if "." in self.remote_field.model:
1735.                 app_label, model_name = self.remote_field.model.split(".")
1736.                 kwargs["to"] = "%s.%s" % (app_label, model_name.lower())
1737.             else:
1738.                 kwargs["to"] = self.remote_field.model.lower()
1739.         else:
1740.             kwargs["to"] = self.remote_field.model._meta.label_lower
1741.         if getattr(self.remote_field, "through", None) is not None:
1742.             if isinstance(self.remote_field.through, str):
1743.                 kwargs["through"] = self.remote_field.through
1744.             elif not self.remote_field.through._meta.auto_created:
1745.                 kwargs["through"] = self.remote_field.through._meta.label
1746.         # If swappable is True, then see if we're actually pointing to the target
1747.         # of a swap.
1748.         swappable_setting = self.swappable_setting
1749.         if swappable_setting is not None:
1750.             # If it's already a settings reference, error.
1751.             if hasattr(kwargs["to"], "setting_name"):
1752.                 if kwargs["to"].setting_name != swappable_setting:
1753.                     raise ValueError(
1754.                         "Cannot deconstruct a ManyToManyField pointing to a "
1755.                         "model that is swapped in place of more than one model "
1756.                         "(%s and %s)" % (kwargs["to"].setting_name, swappable_setting)
1757.                     )
1758. 
1759.             kwargs["to"] = SettingsReference(
1760.                 kwargs["to"],
1761.                 swappable_setting,
1762.             )
1763.         return name, path, args, kwargs
1764. 
1765.     def _get_path_info(self, direct=False, filtered_relation=None):
1766.         """Called by both direct and indirect m2m traversal."""
1767.         int_model = self.remote_field.through
1768.         linkfield1 = int_model._meta.get_field(self.m2m_field_name())
1769.         linkfield2 = int_model._meta.get_field(self.m2m_reverse_field_name())
1770.         if direct:
1771.             join1infos = linkfield1.reverse_path_infos
1772.             if filtered_relation:
1773.                 join2infos = linkfield2.get_path_info(filtered_relation)
1774.             else:
1775.                 join2infos = linkfield2.path_infos
1776.         else:
1777.             join1infos = linkfield2.reverse_path_infos
1778.             if filtered_relation:
1779.                 join2infos = linkfield1.get_path_info(filtered_relation)
1780.             else:
1781.                 join2infos = linkfield1.path_infos
1782.         # Get join infos between the last model of join 1 and the first model
1783.         # of join 2. Assume the only reason these may differ is due to model
1784.         # inheritance.
1785.         join1_final = join1infos[-1].to_opts
1786.         join2_initial = join2infos[0].from_opts
1787.         if join1_final is join2_initial:
1788.             intermediate_infos = []
1789.         elif issubclass(join1_final.model, join2_initial.model):
1790.             intermediate_infos = join1_final.get_path_to_parent(join2_initial.model)
1791.         else:
1792.             intermediate_infos = join2_initial.get_path_from_parent(join1_final.model)
1793. 
1794.         return [*join1infos, *intermediate_infos, *join2infos]
1795. 
1796.     def get_path_info(self, filtered_relation=None):
1797.         return self._get_path_info(direct=True, filtered_relation=filtered_relation)
1798. 
1799.     @cached_property
1800.     def path_infos(self):
1801.         return self.get_path_info()
1802. 
1803.     def get_reverse_path_info(self, filtered_relation=None):
1804.         return self._get_path_info(direct=False, filtered_relation=filtered_relation)
1805. 
1806.     @cached_property
1807.     def reverse_path_infos(self):
1808.         return self.get_reverse_path_info()
1809. 
1810.     def _get_m2m_db_table(self, opts):
1811.         """
1812.         Function that can be curried to provide the m2m table name for this
1813.         relation.
1814.         """
1815.         if self.remote_field.through is not None:
1816.             return self.remote_field.through._meta.db_table
1817.         elif self.db_table:
1818.             return self.db_table
1819.         else:
1820.             m2m_table_name = "%s_%s" % (utils.strip_quotes(opts.db_table), self.name)
1821.             return utils.truncate_name(m2m_table_name, connection.ops.max_name_length())
1822. 
1823.     def _get_m2m_attr(self, related, attr):
1824.         """
1825.         Function that can be curried to provide the source accessor or DB
1826.         column name for the m2m table.
1827.         """
1828.         cache_attr = "_m2m_%s_cache" % attr
1829.         if hasattr(self, cache_attr):
1830.             return getattr(self, cache_attr)
1831.         if self.remote_field.through_fields is not None:
1832.             link_field_name = self.remote_field.through_fields[0]
1833.         else:
1834.             link_field_name = None
1835.         for f in self.remote_field.through._meta.fields:
1836.             if (
1837.                 f.is_relation
1838.                 and f.remote_field.model == related.related_model
1839.                 and (link_field_name is None or link_field_name == f.name)
1840.             ):
1841.                 setattr(self, cache_attr, getattr(f, attr))
1842.                 return getattr(self, cache_attr)
1843. 
1844.     def _get_m2m_reverse_attr(self, related, attr):
1845.         """
1846.         Function that can be curried to provide the related accessor or DB
1847.         column name for the m2m table.
1848.         """
1849.         cache_attr = "_m2m_reverse_%s_cache" % attr
1850.         if hasattr(self, cache_attr):
1851.             return getattr(self, cache_attr)
1852.         found = False
1853.         if self.remote_field.through_fields is not None:
1854.             link_field_name = self.remote_field.through_fields[1]
1855.         else:
1856.             link_field_name = None
1857.         for f in self.remote_field.through._meta.fields:
1858.             if f.is_relation and f.remote_field.model == related.model:
1859.                 if link_field_name is None and related.related_model == related.model:
1860.                     # If this is an m2m-intermediate to self,
1861.                     # the first foreign key you find will be
1862.                     # the source column. Keep searching for
1863.                     # the second foreign key.
1864.                     if found:
1865.                         setattr(self, cache_attr, getattr(f, attr))
1866.                         break
1867.                     else:
1868.                         found = True
1869.                 elif link_field_name is None or link_field_name == f.name:
1870.                     setattr(self, cache_attr, getattr(f, attr))
1871.                     break
1872.         return getattr(self, cache_attr)
1873. 
1874.     def contribute_to_class(self, cls, name, **kwargs):
1875.         # To support multiple relations to self, it's useful to have a non-None
1876.         # related name on symmetrical relations for internal reasons. The
1877.         # concept doesn't make a lot of sense externally ("you want me to
1878.         # specify *what* on my non-reversible relation?!"), so we set it up
1879.         # automatically. The funky name reduces the chance of an accidental
1880.         # clash.
1881.         if self.remote_field.symmetrical and (
1882.             self.remote_field.model == RECURSIVE_RELATIONSHIP_CONSTANT
1883.             or self.remote_field.model == cls._meta.object_name
1884.         ):
1885.             self.remote_field.related_name = "%s_rel_+" % name
1886.         elif self.remote_field.is_hidden():
1887.             # If the backwards relation is disabled, replace the original
1888.             # related_name with one generated from the m2m field name. Django
1889.             # still uses backwards relations internally and we need to avoid
1890.             # clashes between multiple m2m fields with related_name == '+'.
1891.             self.remote_field.related_name = "_%s_%s_%s_+" % (
1892.                 cls._meta.app_label,
1893.                 cls.__name__.lower(),
1894.                 name,
1895.             )
1896. 
1897.         super().contribute_to_class(cls, name, **kwargs)
1898. 
1899.         # The intermediate m2m model is not auto created if:
1900.         #  1) There is a manually specified intermediate, or
1901.         #  2) The class owning the m2m field is abstract.
1902.         #  3) The class owning the m2m field has been swapped out.
1903.         if not cls._meta.abstract:
1904.             if self.remote_field.through:
1905. 
1906.                 def resolve_through_model(_, model, field):
1907.                     field.remote_field.through = model
1908. 
1909.                 lazy_related_operation(
1910.                     resolve_through_model, cls, self.remote_field.through, field=self
1911.                 )
1912.             elif not cls._meta.swapped:
1913.                 self.remote_field.through = create_many_to_many_intermediary_model(
1914.                     self, cls
1915.                 )
1916. 
1917.         # Add the descriptor for the m2m relation.
1918.         setattr(cls, self.name, ManyToManyDescriptor(self.remote_field, reverse=False))
1919. 
1920.         # Set up the accessor for the m2m table name for the relation.
1921.         self.m2m_db_table = partial(self._get_m2m_db_table, cls._meta)
1922. 
1923.     def contribute_to_related_class(self, cls, related):
1924.         # Internal M2Ms (i.e., those with a related name ending with '+')
1925.         # and swapped models don't get a related descriptor.
1926.         if (
1927.             not self.remote_field.is_hidden()
1928.             and not related.related_model._meta.swapped
1929.         ):
1930.             setattr(
1931.                 cls,
1932.                 related.get_accessor_name(),
1933.                 ManyToManyDescriptor(self.remote_field, reverse=True),
1934.             )
1935. 
1936.         # Set up the accessors for the column names on the m2m table.
1937.         self.m2m_column_name = partial(self._get_m2m_attr, related, "column")
1938.         self.m2m_reverse_name = partial(self._get_m2m_reverse_attr, related, "column")
1939. 
1940.         self.m2m_field_name = partial(self._get_m2m_attr, related, "name")
1941.         self.m2m_reverse_field_name = partial(
1942.             self._get_m2m_reverse_attr, related, "name"
1943.         )
1944. 
1945.         get_m2m_rel = partial(self._get_m2m_attr, related, "remote_field")
1946.         self.m2m_target_field_name = lambda: get_m2m_rel().field_name
1947.         get_m2m_reverse_rel = partial(
1948.             self._get_m2m_reverse_attr, related, "remote_field"
1949.         )
1950.         self.m2m_reverse_target_field_name = lambda: get_m2m_reverse_rel().field_name
1951. 
1952.     def set_attributes_from_rel(self):
1953.         pass
1954. 
1955.     def value_from_object(self, obj):
1956.         return [] if obj.pk is None else list(getattr(obj, self.attname).all())
1957. 
1958.     def save_form_data(self, instance, data):
1959.         getattr(instance, self.attname).set(data)
1960. 
1961.     def formfield(self, *, using=None, **kwargs):
1962.         defaults = {
1963.             "form_class": forms.ModelMultipleChoiceField,
1964.             "queryset": self.remote_field.model._default_manager.using(using),
1965.             **kwargs,
1966.         }
1967.         # If initial is passed in, it's a list of related objects, but the
1968.         # MultipleChoiceField takes a list of IDs.
1969.         if defaults.get("initial") is not None:
1970.             initial = defaults["initial"]
1971.             if callable(initial):
1972.                 initial = initial()
1973.             defaults["initial"] = [i.pk for i in initial]
1974.         return super().formfield(**defaults)
1975. 
1976.     def db_check(self, connection):
1977.         return None
1978. 
1979.     def db_type(self, connection):
1980.         # A ManyToManyField is not represented by a single column,
1981.         # so return None.
1982.         return None
1983. 
1984.     def db_parameters(self, connection):
1985.         return {"type": None, "check": None}

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-24 05:48:31,241 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="The user requested the full content of the file 'django/db/models/fields/related.py'. The provided context contains the content of this file from line 1 to 1985. This context block includes the entire file content as requested.", relative_path='django/db/models/fields/related.py', start_line=1, end_line=1985)]
2025-12-24 05:48:31,244 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of the file django/db/models/fields/related.py.
2025-12-24 05:48:31,244 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-24 05:48:31,245 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-24 05:48:31,245 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 1 existing contexts
2025-12-24 05:48:31,245 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 2 total contexts (removed 0 duplicates)
2025-12-24 05:48:31,247 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .github
|   ├── CODE_OF_CONDUCT.md
|   ├── FUNDING.yml
|   ├── SECURITY.md
|   └── workflows
|       ├── benchmark.yml
|       ├── docs.yml
|       ├── linters.yml
|       ├── new_contributor_pr.yml
|       ├── schedule_tests.yml
|       ├── schedules.yml
|       └── tests.yml
├── .pre-commit-config.yaml
├── .readthedocs.yml
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ar_DZ
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ckb
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ig
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ky
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ms
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uz
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   ├── 0012_alter_user_first_name_max_length.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   └── options.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── constraints.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── ms
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── tg
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── uz
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_redirect_new_path_help_text.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── templates
|   |   |   |   ├── sitemap.xml
|   |   |   |   └── sitemap_index.xml
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── asgi.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   ├── memcached.py
|   |   |   |   └── redis.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── async_checks.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   ├── __init__.py
|   |   |   |   └── django_4_0.py
|   |   |   ├── database.py
|   |   |   ├── files.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── filesystem.py
|   |   |   |   ├── handler.py
|   |   |   |   ├── memory.py
|   |   |   |   └── mixins.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── asgi.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── __init__.py
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── optimizemigration.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── jsonl.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── psycopg_any.py
|   |   |   |   └── schema.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _functions.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   └── special.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── enums.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── json.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── autoreload.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── asyncio.py
|   |   ├── autoreload.py
|   |   ├── cache.py
|   |   ├── connection.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── common.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           ├── csrf_403.html
|           ├── default_urlconf.html
|           ├── directory_index.html
|           ├── i18n_catalog.js
|           ├── technical_404.html
|           ├── technical_500.html
|           └── technical_500.txt
├── docs
|   ├── README.rst
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   ├── genindex.html
|   |   |   ├── layout.html
|   |   |   ├── modindex.html
|   |   |   ├── search.html
|   |   |   └── static
|   |   |       ├── console-tabs.css
|   |   |       ├── default.css
|   |   |       ├── djangodocs.css
|   |   |       ├── fontawesome
|   |   |       ├── homepage.css
|   |   |       └── reset-fonts-grids.css
|   |   └── djangodocs-epub
|   |       ├── epub-cover.html
|   |       └── static
|   |           └── epub.css
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── _images
|   |   ├── auth-remote-user.txt
|   |   ├── csrf.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-backend.txt
|   |   ├── custom-template-tags.txt
|   |   ├── deployment
|   |   |   ├── asgi
|   |   |   |   ├── daphne.txt
|   |   |   |   ├── hypercorn.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── uvicorn.txt
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── legacy-databases.txt
|   |   ├── logging.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   ├── tutorial08.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── filters.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── constraints.txt
|   |   |   |   ├── expressions.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── logging.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── paginator.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.19.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.20.txt
|   |   ├── 1.11.21.txt
|   |   ├── 1.11.22.txt
|   |   ├── 1.11.23.txt
|   |   ├── 1.11.24.txt
|   |   ├── 1.11.25.txt
|   |   ├── 1.11.26.txt
|   |   ├── 1.11.27.txt
|   |   ├── 1.11.28.txt
|   |   ├── 1.11.29.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.11.txt
|   |   ├── 2.0.12.txt
|   |   ├── 2.0.13.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.10.txt
|   |   ├── 2.1.11.txt
|   |   ├── 2.1.12.txt
|   |   ├── 2.1.13.txt
|   |   ├── 2.1.14.txt
|   |   ├── 2.1.15.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.7.txt
|   |   ├── 2.1.8.txt
|   |   ├── 2.1.9.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.1.txt
|   |   ├── 2.2.10.txt
|   |   ├── 2.2.11.txt
|   |   ├── 2.2.12.txt
|   |   ├── 2.2.13.txt
|   |   ├── 2.2.14.txt
|   |   ├── 2.2.15.txt
|   |   ├── 2.2.16.txt
|   |   ├── 2.2.17.txt
|   |   ├── 2.2.18.txt
|   |   ├── 2.2.19.txt
|   |   ├── 2.2.2.txt
|   |   ├── 2.2.20.txt
|   |   ├── 2.2.21.txt
|   |   ├── 2.2.22.txt
|   |   ├── 2.2.23.txt
|   |   ├── 2.2.24.txt
|   |   ├── 2.2.25.txt
|   |   ├── 2.2.26.txt
|   |   ├── 2.2.27.txt
|   |   ├── 2.2.28.txt
|   |   ├── 2.2.3.txt
|   |   ├── 2.2.4.txt
|   |   ├── 2.2.5.txt
|   |   ├── 2.2.6.txt
|   |   ├── 2.2.7.txt
|   |   ├── 2.2.8.txt
|   |   ├── 2.2.9.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.1.txt
|   |   ├── 3.0.10.txt
|   |   ├── 3.0.11.txt
|   |   ├── 3.0.12.txt
|   |   ├── 3.0.13.txt
|   |   ├── 3.0.14.txt
|   |   ├── 3.0.2.txt
|   |   ├── 3.0.3.txt
|   |   ├── 3.0.4.txt
|   |   ├── 3.0.5.txt
|   |   ├── 3.0.6.txt
|   |   ├── 3.0.7.txt
|   |   ├── 3.0.8.txt
|   |   ├── 3.0.9.txt
|   |   ├── 3.0.txt
|   |   ├── 3.1.1.txt
|   |   ├── 3.1.10.txt
|   |   ├── 3.1.11.txt
|   |   ├── 3.1.12.txt
|   |   ├── 3.1.13.txt
|   |   ├── 3.1.14.txt
|   |   ├── 3.1.2.txt
|   |   ├── 3.1.3.txt
|   |   ├── 3.1.4.txt
|   |   ├── 3.1.5.txt
|   |   ├── 3.1.6.txt
|   |   ├── 3.1.7.txt
|   |   ├── 3.1.8.txt
|   |   ├── 3.1.9.txt
|   |   ├── 3.1.txt
|   |   ├── 3.2.1.txt
|   |   ├── 3.2.10.txt
|   |   ├── 3.2.11.txt
|   |   ├── 3.2.12.txt
|   |   ├── 3.2.13.txt
|   |   ├── 3.2.14.txt
|   |   ├── 3.2.15.txt
|   |   ├── 3.2.16.txt
|   |   ├── 3.2.17.txt
|   |   ├── 3.2.18.txt
|   |   ├── 3.2.2.txt
|   |   ├── 3.2.3.txt
|   |   ├── 3.2.4.txt
|   |   ├── 3.2.5.txt
|   |   ├── 3.2.6.txt
|   |   ├── 3.2.7.txt
|   |   ├── 3.2.8.txt
|   |   ├── 3.2.9.txt
|   |   ├── 3.2.txt
|   |   ├── 4.0.1.txt
|   |   ├── 4.0.10.txt
|   |   ├── 4.0.2.txt
|   |   ├── 4.0.3.txt
|   |   ├── 4.0.4.txt
|   |   ├── 4.0.5.txt
|   |   ├── 4.0.6.txt
|   |   ├── 4.0.7.txt
|   |   ├── 4.0.8.txt
|   |   ├── 4.0.9.txt
|   |   ├── 4.0.txt
|   |   ├── 4.1.1.txt
|   |   ├── 4.1.2.txt
|   |   ├── 4.1.3.txt
|   |   ├── 4.1.4.txt
|   |   ├── 4.1.5.txt
|   |   ├── 4.1.6.txt
|   |   ├── 4.1.7.txt
|   |   ├── 4.1.8.txt
|   |   ├── 4.1.txt
|   |   ├── 4.2.txt
|   |   ├── 5.0.txt
|   |   ├── index.txt
|   |   └── security.txt
|   ├── requirements.txt
|   └── topics
|       ├── async.txt
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── fixtures.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   ├── jsi18n-mocks.test.js
|   |   └── navigation.test.js
|   ├── gis
|   |   └── mapwidget.test.js
|   └── tests.html
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_dynamic_settings_manage.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── .hidden
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       ├── noargs_command.py
    |   |       └── suppress_base_options_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── admin
    |   |   |   ├── admin_views
    |   |   |   └── base_site.html
    |   |   └── custom_filter_template.html
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_breadcrumbs.py
    |   ├── test_forms.py
    |   ├── test_history_view.py
    |   ├── test_multidb.py
    |   ├── test_nav_sidebar.py
    |   ├── test_skip_link_to_content.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   ├── no_config_app
    |   |   └── __init__.py
    |   ├── one_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── tests.py
    |   ├── two_configs_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── two_configs_one_default_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   └── two_default_configs_app
    |       ├── __init__.py
    |       └── apps.py
    ├── asgi
    |   ├── __init__.py
    |   ├── project
    |   |   └── static
    |   |       └── file.txt
    |   ├── tests.py
    |   └── urls.py
    ├── async
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_async_model_methods.py
    |   ├── test_async_queryset.py
    |   ├── test_async_related_managers.py
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   ├── with_last_login_attr.py
    |   |   ├── with_many_to_many.py
    |   |   └── with_unique_constraint.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   |   ├── auth_attrs_access.html
    |   |   |   ├── auth_attrs_messages.html
    |   |   |   ├── auth_attrs_no_access.html
    |   |   |   ├── auth_attrs_perm_in_perms.html
    |   |   |   ├── auth_attrs_perms.html
    |   |   |   ├── auth_attrs_test_access.html
    |   |   |   └── auth_attrs_user.html
    |   |   └── registration
    |   |       ├── html_password_reset_email.html
    |   |       ├── logged_out.html
    |   |       ├── login.html
    |   |       ├── password_change_form.html
    |   |       ├── password_reset_complete.html
    |   |       ├── password_reset_confirm.html
    |   |       ├── password_reset_done.html
    |   |       ├── password_reset_email.html
    |   |       ├── password_reset_form.html
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_remote_user.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── app_unmigrated
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── test_base.py
    |   |   ├── test_client.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_functions.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   ├── tests.py
    |   └── tests_async.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── template_test_apps
    |   |   ├── __init__.py
    |   |   ├── different_tags_app
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   ├── same_tags_app_1
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   └── same_tags_app_2
    |   |       ├── __init__.py
    |   |       ├── apps.py
    |   |       └── templatetags
    |   ├── test_4_0_compatibility.py
    |   ├── test_async_checks.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_files.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_class_based_error_handlers.py
    |       ├── bad_error_handlers_invalid_path.py
    |       ├── bad_function_based_error_handlers.py
    |       ├── beginning_with_slash.py
    |       ├── cbv_as_view.py
    |       ├── contains_tuple.py
    |       ├── good_class_based_error_handlers.py
    |       ├── good_function_based_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   └── ending_with_dollar.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_migrations.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   |       ├── debug.html
    |   |       └── request_attrs.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_collate.py
    |   |   ├── test_greatest.py
    |   |   ├── test_json_object.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_random.py
    |   |   ├── test_round.py
    |   |   ├── test_sign.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_md5.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_sha1.py
    |   |   ├── test_sha224.py
    |   |   ├── test_sha256.py
    |   |   ├── test_sha384.py
    |   |   ├── test_sha512.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── fake_client.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   ├── test_postgresql.py
    |   ├── test_sqlite.py
    |   └── tests.py
    ├── decorators
    |   ├── __init__.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   ├── test_middleware_mixin.py
    |   ├── test_storages.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── empty_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── test_commands.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── test_inmemory_storage.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── fixture2.xml
    |   |   ├── fixture3.xml
    |   |   ├── fixture7.xml
    |   |   └── fixture9.xml
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── animal.xml
    |   |   ├── bad_fixture2.xml
    |   |   ├── nk-inheritance2.xml
    |   |   ├── non_natural_2.xml
    |   |   ├── pretty.xml
    |   |   └── sequence_extra_xml.xml
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── absolute_urls.py
    |   ├── no_slash_urls.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   |   └── default.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_jsonfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   |       └── custom_widget.html
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   |       ├── article_form.html
    |   |       ├── custom_field.html
    |   |       ├── custom_widget.html
    |   |       ├── cyclic_context_boundfield_render.html
    |   |       ├── error.html
    |   |       ├── form_snippet.html
    |   |       ├── legend_test.html
    |   |       └── use_fieldset.html
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   └── tags.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   |       └── using.html
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   ├── about.html
    |   |   |   ├── apple_detail.html
    |   |   |   ├── artist_detail.html
    |   |   |   ├── artist_form.html
    |   |   |   ├── author_confirm_delete.html
    |   |   |   ├── author_detail.html
    |   |   |   ├── author_form.html
    |   |   |   ├── author_list.html
    |   |   |   ├── author_objects.html
    |   |   |   ├── author_view.html
    |   |   |   ├── book_archive.html
    |   |   |   ├── book_archive_day.html
    |   |   |   ├── book_archive_month.html
    |   |   |   ├── book_archive_week.html
    |   |   |   ├── book_archive_year.html
    |   |   |   ├── book_detail.html
    |   |   |   ├── book_list.html
    |   |   |   ├── confirm_delete.html
    |   |   |   ├── detail.html
    |   |   |   ├── form.html
    |   |   |   ├── list.html
    |   |   |   ├── page_template.html
    |   |   |   ├── robots.txt
    |   |   |   └── using.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── has_nulls
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   ├── test_srs.py
    |   |   └── tests.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_indexes.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_create_models.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_rastermodels.py
    |   |   |   └── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   |   └── test_handler.html
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   |   └── ignored.html
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   |   └── media_ignored.html
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   ├── javascript_ignored.js
    |   |   |   └── static_ignored.html
    |   |   └── templates
    |   |       ├── empty.html
    |   |       ├── subdir
    |   |       ├── test.html
    |   |       └── xxx_ignored.html
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── loading
    |   |   ├── en
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_AU
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_CA
    |   |   |   └── LC_MESSAGES
    |   |   └── en_NZ
    |   |       └── LC_MESSAGES
    |   ├── loading_app
    |   |   ├── __init__.py
    |   |   ├── apps.py
    |   |   └── locale
    |   |       └── en
    |   ├── models.py
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   |   ├── 404.html
    |   |   |   └── dummy.html
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── models.py
    |   |   |   └── test.html
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   |   └── percents.html
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── unchanged
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   ├── tests.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_fake_initial_case_insensitive
    |   |   ├── fake_initial
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── initial
    |   |       ├── 0001_initial.py
    |   |       └── __init__.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_conflict_long_name
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second_migration_with_long_name.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_manual_porting
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   └── __init__.py
    |   ├── test_migrations_namespace_package
    |   |   └── 0001_initial.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_no_operations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_noop
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   ├── 0005_fifth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_no_replaces
    |   |   ├── 0001_squashed_0002.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_enums
    |   ├── __init__.py
    |   └── tests.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autofield.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_filepathfield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_jsonfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_pk.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── model_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── integration_settings.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_constraints.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_integration.py
    |   ├── test_introspection.py
    |   ├── test_operations.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_contains.py
    |   ├── test_db_returning.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   ├── test_sqlcompiler.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests_tests
    |   ├── __init__.py
    |   ├── test_accept_header.py
    |   ├── test_data_upload_settings.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_jsonl.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_clear_expired.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   |       └── using.html
    |   ├── templates
    |   |   └── shortcuts
    |   |       ├── render_test.html
    |   |       └── using.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── custom_sitemap.xml
    |   |   └── custom_sitemap_lastmod_index.xml
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   ├── test_management.py
    |   ├── test_utils.py
    |   └── urls
    |       ├── __init__.py
    |       ├── empty.py
    |       ├── http.py
    |       ├── https.py
    |       ├── index_only.py
    |       └── sitemap_only.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── absolute_root.css
    |   |   |   ├── absolute_root.js
    |   |   |   ├── cached
    |   |   |   ├── nested
    |   |   |   ├── styles_root.css
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   |   └── faulty.css
    |   |   ├── loop
    |   |   |   ├── bar.css
    |   |   |   └── foo.css
    |   |   ├── nonutf8
    |   |   |   └── nonutf8.css
    |   |   ├── pathlib
    |   |   |   └── pathlib.txt
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   |       ├── description.html
    |   |       ├── description_context.html
    |   |       ├── title.html
    |   |       └── title_context.html
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   |       └── hello.html
    |   ├── jinja2
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       ├── syntax_error.html
    |   |       ├── syntax_error2.html
    |   |       └── syntax_error_include.html
    |   ├── template_strings
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       └── syntax_error.html
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_loader
    |   |       ├── goodbye.html
    |   |       ├── hello.html
    |   |       └── request.html
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   |       └── using.html
    |   ├── other_templates
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   └── test_dirs.html
    |   ├── recursive_templates
    |   |   ├── fs
    |   |   |   ├── extend-missing.html
    |   |   |   ├── one.html
    |   |   |   ├── other-recursive.html
    |   |   |   ├── recursive.html
    |   |   |   ├── self.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── fs2
    |   |   |   └── recursive.html
    |   |   └── fs3
    |   |       └── recursive.html
    |   ├── relative_templates
    |   |   ├── dir1
    |   |   |   ├── dir2
    |   |   |   ├── looped.html
    |   |   |   ├── one.html
    |   |   |   ├── one1.html
    |   |   |   ├── one2.html
    |   |   |   ├── one3.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── error_extends.html
    |   |   ├── error_include.html
    |   |   ├── one.html
    |   |   ├── one_var.html
    |   |   ├── three.html
    |   |   └── two.html
    |   ├── syntax_tests
    |   |   ├── __init__.py
    |   |   ├── i18n
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: ModelAdmin.lookup_allowed() incorrectly raises DisallowedModelAdminLookup lookup with foreign key as primary key

Description: Description
	 
		(last modified by Tim Graham)
	 
Wrote a failing test for tests/modeladmin/tests.py to demonstrate - same test/code passes on 1.8
@isolate_apps('modeladmin')
def test_lookup_allowed_foreign_primary(self):
	class Country(models.Model):
		name = models.CharField(max_length=256)
	class Place(models.Model):
		country = models.ForeignKey(Country, models.CASCADE)
	class Restaurant(models.Model):
		place = models.OneToOneField(Place, models.CASCADE, primary_key=True)
	class Waiter(models.Model):
		restaurant = models.ForeignKey(Restaurant, models.CASCADE)
	class WaiterAdmin(ModelAdmin):
		list_filter = [
			'restaurant__place__country',
		]
	ma = WaiterAdmin(Waiter, self.site)
	self.assertIs(ma.lookup_allowed('restaurant__place__country', 'test_value'), True)
I think this is caused by the admin thinking that having a foreign key field as a primary key is the same as concrete inheritance. So when you try and check lookups for restaurant__place__country it thinks 'place' is the concrete parent of 'restaurant' and shortcuts it to restaurant__country which isn't in 'list_filter'. And you can't add restaurant__country to list_filter because country isn't actually on restaurant.

Patch information:
diff --git a/django/contrib/admin/options.py b/django/contrib/admin/options.py
index 5240b07cd6..b7b639d0c8 100644
--- a/django/contrib/admin/options.py
+++ b/django/contrib/admin/options.py
@@ -464,9 +464,17 @@ class BaseModelAdmin(metaclass=forms.MediaDefiningClass):
             # It is allowed to filter on values that would be found from local
             # model anyways. For example, if you filter on employee__department__id,
             # then the id value would be found already from employee__department_id.
-            if not prev_field or (
-                prev_field.is_relation
-                and field not in prev_field.path_infos[-1].target_fields
+            # However, if the target field is itself relational (e.g., a OneToOneField
+            # used as a primary key), don't collapse that step.
+            if (
+                not prev_field
+                or (
+                    prev_field.is_relation
+                    and (
+                        field not in prev_field.path_infos[-1].target_fields
+                        or getattr(field, "is_relation", False)
+                    )
+                )
             ):
                 relation_parts.append(part)
             if not getattr(field, "path_infos", None):


Find all relevant source code context needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of the file django/contrib/admin/options.py.
Extra Requirements: 
Purpose: This file contains the `lookup_allowed` method that needs to be fixed, and having its full content is essential to understand the logic and apply the patch correctly.

Previous refined query 2:
Essential Query: Please provide the full content of the file django/db/models/fields/related.py.
Extra Requirements: 
Purpose: This file defines `ForeignKey`, `OneToOneField`, and other relational fields, which will provide the necessary context on the `path_infos` and `target_fields` attributes that are central to the bug.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: django/contrib/admin/options.py
Line number range: 1 - 2000
Content:
1. import copy
2. import enum
3. import json
4. import re
5. from functools import partial, update_wrapper
6. from urllib.parse import quote as urlquote
7. 
8. from django import forms
9. from django.conf import settings
10. from django.contrib import messages
11. from django.contrib.admin import helpers, widgets
12. from django.contrib.admin.checks import (
13.     BaseModelAdminChecks,
14.     InlineModelAdminChecks,
15.     ModelAdminChecks,
16. )
17. from django.contrib.admin.exceptions import DisallowedModelAdminToField
18. from django.contrib.admin.templatetags.admin_urls import add_preserved_filters
19. from django.contrib.admin.utils import (
20.     NestedObjects,
21.     construct_change_message,
22.     flatten_fieldsets,
23.     get_deleted_objects,
24.     lookup_spawns_duplicates,
25.     model_format_dict,
26.     model_ngettext,
27.     quote,
28.     unquote,
29. )
30. from django.contrib.admin.widgets import AutocompleteSelect, AutocompleteSelectMultiple
31. from django.contrib.auth import get_permission_codename
32. from django.core.exceptions import (
33.     FieldDoesNotExist,
34.     FieldError,
35.     PermissionDenied,
36.     ValidationError,
37. )
38. from django.core.paginator import Paginator
39. from django.db import models, router, transaction
40. from django.db.models.constants import LOOKUP_SEP
41. from django.forms.formsets import DELETION_FIELD_NAME, all_valid
42. from django.forms.models import (
43.     BaseInlineFormSet,
44.     inlineformset_factory,
45.     modelform_defines_fields,
46.     modelform_factory,
47.     modelformset_factory,
48. )
49. from django.forms.widgets import CheckboxSelectMultiple, SelectMultiple
50. from django.http import HttpResponseRedirect
51. from django.http.response import HttpResponseBase
52. from django.template.response import SimpleTemplateResponse, TemplateResponse
53. from django.urls import reverse
54. from django.utils.decorators import method_decorator
55. from django.utils.html import format_html
56. from django.utils.http import urlencode
57. from django.utils.safestring import mark_safe
58. from django.utils.text import (
59.     capfirst,
60.     format_lazy,
61.     get_text_list,
62.     smart_split,
63.     unescape_string_literal,
64. )
65. from django.utils.translation import gettext as _
66. from django.utils.translation import ngettext
67. from django.views.decorators.csrf import csrf_protect
68. from django.views.generic import RedirectView
69. 
70. IS_POPUP_VAR = "_popup"
71. TO_FIELD_VAR = "_to_field"
72. IS_FACETS_VAR = "_facets"
73. 
74. 
75. class ShowFacets(enum.Enum):
76.     NEVER = "NEVER"
77.     ALLOW = "ALLOW"
78.     ALWAYS = "ALWAYS"
79. 
80. 
81. HORIZONTAL, VERTICAL = 1, 2
82. 
83. 
84. def get_content_type_for_model(obj):
85.     # Since this module gets imported in the application's root package,
86.     # it cannot import models from other applications at the module level.
87.     from django.contrib.contenttypes.models import ContentType
88. 
89.     return ContentType.objects.get_for_model(obj, for_concrete_model=False)
90. 
91. 
92. def get_ul_class(radio_style):
93.     return "radiolist" if radio_style == VERTICAL else "radiolist inline"
94. 
95. 
96. class IncorrectLookupParameters(Exception):
97.     pass
98. 
99. 
100. # Defaults for formfield_overrides. ModelAdmin subclasses can change this
101. # by adding to ModelAdmin.formfield_overrides.
102. 
103. FORMFIELD_FOR_DBFIELD_DEFAULTS = {
104.     models.DateTimeField: {
105.         "form_class": forms.SplitDateTimeField,
106.         "widget": widgets.AdminSplitDateTime,
107.     },
108.     models.DateField: {"widget": widgets.AdminDateWidget},
109.     models.TimeField: {"widget": widgets.AdminTimeWidget},
110.     models.TextField: {"widget": widgets.AdminTextareaWidget},
111.     models.URLField: {"widget": widgets.AdminURLFieldWidget},
112.     models.IntegerField: {"widget": widgets.AdminIntegerFieldWidget},
113.     models.BigIntegerField: {"widget": widgets.AdminBigIntegerFieldWidget},
114.     models.CharField: {"widget": widgets.AdminTextInputWidget},
115.     models.ImageField: {"widget": widgets.AdminFileWidget},
116.     models.FileField: {"widget": widgets.AdminFileWidget},
117.     models.EmailField: {"widget": widgets.AdminEmailInputWidget},
118.     models.UUIDField: {"widget": widgets.AdminUUIDInputWidget},
119. }
120. 
121. csrf_protect_m = method_decorator(csrf_protect)
122. 
123. 
124. class BaseModelAdmin(metaclass=forms.MediaDefiningClass):
125.     """Functionality common to both ModelAdmin and InlineAdmin."""
126. 
127.     autocomplete_fields = ()
128.     raw_id_fields = ()
129.     fields = None
130.     exclude = None
131.     fieldsets = None
132.     form = forms.ModelForm
133.     filter_vertical = ()
134.     filter_horizontal = ()
135.     radio_fields = {}
136.     prepopulated_fields = {}
137.     formfield_overrides = {}
138.     readonly_fields = ()
139.     ordering = None
140.     sortable_by = None
141.     view_on_site = True
142.     show_full_result_count = True
143.     checks_class = BaseModelAdminChecks
144. 
145.     def check(self, **kwargs):
146.         return self.checks_class().check(self, **kwargs)
147. 
148.     def __init__(self):
149.         # Merge FORMFIELD_FOR_DBFIELD_DEFAULTS with the formfield_overrides
150.         # rather than simply overwriting.
151.         overrides = copy.deepcopy(FORMFIELD_FOR_DBFIELD_DEFAULTS)
152.         for k, v in self.formfield_overrides.items():
153.             overrides.setdefault(k, {}).update(v)
154.         self.formfield_overrides = overrides
155. 
156.     def formfield_for_dbfield(self, db_field, request, **kwargs):
157.         """
158.         Hook for specifying the form Field instance for a given database Field
159.         instance.
160. 
161.         If kwargs are given, they're passed to the form Field's constructor.
162.         """
163.         # If the field specifies choices, we don't need to look for special
164.         # admin widgets - we just need to use a select widget of some kind.
165.         if db_field.choices:
166.             return self.formfield_for_choice_field(db_field, request, **kwargs)
167. 
168.         # ForeignKey or ManyToManyFields
169.         if isinstance(db_field, (models.ForeignKey, models.ManyToManyField)):
170.             # Combine the field kwargs with any options for formfield_overrides.
171.             # Make sure the passed in **kwargs override anything in
172.             # formfield_overrides because **kwargs is more specific, and should
173.             # always win.
174.             if db_field.__class__ in self.formfield_overrides:
175.                 kwargs = {**self.formfield_overrides[db_field.__class__], **kwargs}
176. 
177.             # Get the correct formfield.
178.             if isinstance(db_field, models.ForeignKey):
179.                 formfield = self.formfield_for_foreignkey(db_field, request, **kwargs)
180.             elif isinstance(db_field, models.ManyToManyField):
181.                 formfield = self.formfield_for_manytomany(db_field, request, **kwargs)
182. 
183.             # For non-raw_id fields, wrap the widget with a wrapper that adds
184.             # extra HTML -- the "add other" interface -- to the end of the
185.             # rendered output. formfield can be None if it came from a
186.             # OneToOneField with parent_link=True or a M2M intermediary.
187.             if formfield and db_field.name not in self.raw_id_fields:
188.                 related_modeladmin = self.admin_site._registry.get(
189.                     db_field.remote_field.model
190.                 )
191.                 wrapper_kwargs = {}
192.                 if related_modeladmin:
193.                     wrapper_kwargs.update(
194.                         can_add_related=related_modeladmin.has_add_permission(request),
195.                         can_change_related=related_modeladmin.has_change_permission(
196.                             request
197.                         ),
198.                         can_delete_related=related_modeladmin.has_delete_permission(
199.                             request
200.                         ),
201.                         can_view_related=related_modeladmin.has_view_permission(
202.                             request
203.                         ),
204.                     )
205.                 formfield.widget = widgets.RelatedFieldWidgetWrapper(
206.                     formfield.widget,
207.                     db_field.remote_field,
208.                     self.admin_site,
209.                     **wrapper_kwargs,
210.                 )
211. 
212.             return formfield
213. 
214.         # If we've got overrides for the formfield defined, use 'em. **kwargs
215.         # passed to formfield_for_dbfield override the defaults.
216.         for klass in db_field.__class__.mro():
217.             if klass in self.formfield_overrides:
218.                 kwargs = {**copy.deepcopy(self.formfield_overrides[klass]), **kwargs}
219.                 return db_field.formfield(**kwargs)
220. 
221.         # For any other type of field, just call its formfield() method.
222.         return db_field.formfield(**kwargs)
223. 
224.     def formfield_for_choice_field(self, db_field, request, **kwargs):
225.         """
226.         Get a form Field for a database Field that has declared choices.
227.         """
228.         # If the field is named as a radio_field, use a RadioSelect
229.         if db_field.name in self.radio_fields:
230.             # Avoid stomping on custom widget/choices arguments.
231.             if "widget" not in kwargs:
232.                 kwargs["widget"] = widgets.AdminRadioSelect(
233.                     attrs={
234.                         "class": get_ul_class(self.radio_fields[db_field.name]),
235.                     }
236.                 )
237.             if "choices" not in kwargs:
238.                 kwargs["choices"] = db_field.get_choices(
239.                     include_blank=db_field.blank, blank_choice=[("", _("None"))]
240.                 )
241.         return db_field.formfield(**kwargs)
242. 
243.     def get_field_queryset(self, db, db_field, request):
244.         """
245.         If the ModelAdmin specifies ordering, the queryset should respect that
246.         ordering.  Otherwise don't specify the queryset, let the field decide
247.         (return None in that case).
248.         """
249.         related_admin = self.admin_site._registry.get(db_field.remote_field.model)
250.         if related_admin is not None:
251.             ordering = related_admin.get_ordering(request)
252.             if ordering is not None and ordering != ():
253.                 return db_field.remote_field.model._default_manager.using(db).order_by(
254.                     *ordering
255.                 )
256.         return None
257. 
258.     def formfield_for_foreignkey(self, db_field, request, **kwargs):
259.         """
260.         Get a form Field for a ForeignKey.
261.         """
262.         db = kwargs.get("using")
263. 
264.         if "widget" not in kwargs:
265.             if db_field.name in self.get_autocomplete_fields(request):
266.                 kwargs["widget"] = AutocompleteSelect(
267.                     db_field, self.admin_site, using=db
268.                 )
269.             elif db_field.name in self.raw_id_fields:
270.                 kwargs["widget"] = widgets.ForeignKeyRawIdWidget(
271.                     db_field.remote_field, self.admin_site, using=db
272.                 )
273.             elif db_field.name in self.radio_fields:
274.                 kwargs["widget"] = widgets.AdminRadioSelect(
275.                     attrs={
276.                         "class": get_ul_class(self.radio_fields[db_field.name]),
277.                     }
278.                 )
279.                 kwargs["empty_label"] = (
280.                     kwargs.get("empty_label", _("None")) if db_field.blank else None
281.                 )
282. 
283.         if "queryset" not in kwargs:
284.             queryset = self.get_field_queryset(db, db_field, request)
285.             if queryset is not None:
286.                 kwargs["queryset"] = queryset
287. 
288.         return db_field.formfield(**kwargs)
289. 
290.     def formfield_for_manytomany(self, db_field, request, **kwargs):
291.         """
292.         Get a form Field for a ManyToManyField.
293.         """
294.         # If it uses an intermediary model that isn't auto created, don't show
295.         # a field in admin.
296.         if not db_field.remote_field.through._meta.auto_created:
297.             return None
298.         db = kwargs.get("using")
299. 
300.         if "widget" not in kwargs:
301.             autocomplete_fields = self.get_autocomplete_fields(request)
302.             if db_field.name in autocomplete_fields:
303.                 kwargs["widget"] = AutocompleteSelectMultiple(
304.                     db_field,
305.                     self.admin_site,
306.                     using=db,
307.                 )
308.             elif db_field.name in self.raw_id_fields:
309.                 kwargs["widget"] = widgets.ManyToManyRawIdWidget(
310.                     db_field.remote_field,
311.                     self.admin_site,
312.                     using=db,
313.                 )
314.             elif db_field.name in [*self.filter_vertical, *self.filter_horizontal]:
315.                 kwargs["widget"] = widgets.FilteredSelectMultiple(
316.                     db_field.verbose_name, db_field.name in self.filter_vertical
317.                 )
318.         if "queryset" not in kwargs:
319.             queryset = self.get_field_queryset(db, db_field, request)
320.             if queryset is not None:
321.                 kwargs["queryset"] = queryset
322. 
323.         form_field = db_field.formfield(**kwargs)
324.         if (
325.             isinstance(form_field.widget, SelectMultiple)
326.             and form_field.widget.allow_multiple_selected
327.             and not isinstance(
328.                 form_field.widget, (CheckboxSelectMultiple, AutocompleteSelectMultiple)
329.             )
330.         ):
331.             msg = _(
332.                 "Hold down “Control”, or “Command” on a Mac, to select more than one."
333.             )
334.             help_text = form_field.help_text
335.             form_field.help_text = (
336.                 format_lazy("{} {}", help_text, msg) if help_text else msg
337.             )
338.         return form_field
339. 
340.     def get_autocomplete_fields(self, request):
341.         """
342.         Return a list of ForeignKey and/or ManyToMany fields which should use
343.         an autocomplete widget.
344.         """
345.         return self.autocomplete_fields
346. 
347.     def get_view_on_site_url(self, obj=None):
348.         if obj is None or not self.view_on_site:
349.             return None
350. 
351.         if callable(self.view_on_site):
352.             return self.view_on_site(obj)
353.         elif hasattr(obj, "get_absolute_url"):
354.             # use the ContentType lookup if view_on_site is True
355.             return reverse(
356.                 "admin:view_on_site",
357.                 kwargs={
358.                     "content_type_id": get_content_type_for_model(obj).pk,
359.                     "object_id": obj.pk,
360.                 },
361.                 current_app=self.admin_site.name,
362.             )
363. 
364.     def get_empty_value_display(self):
365.         """
366.         Return the empty_value_display set on ModelAdmin or AdminSite.
367.         """
368.         try:
369.             return mark_safe(self.empty_value_display)
370.         except AttributeError:
371.             return mark_safe(self.admin_site.empty_value_display)
372. 
373.     def get_exclude(self, request, obj=None):
374.         """
375.         Hook for specifying exclude.
376.         """
377.         return self.exclude
378. 
379.     def get_fields(self, request, obj=None):
380.         """
381.         Hook for specifying fields.
382.         """
383.         if self.fields:
384.             return self.fields
385.         # _get_form_for_get_fields() is implemented in subclasses.
386.         form = self._get_form_for_get_fields(request, obj)
387.         return [*form.base_fields, *self.get_readonly_fields(request, obj)]
388. 
389.     def get_fieldsets(self, request, obj=None):
390.         """
391.         Hook for specifying fieldsets.
392.         """
393.         if self.fieldsets:
394.             return self.fieldsets
395.         return [(None, {"fields": self.get_fields(request, obj)})]
396. 
397.     def get_inlines(self, request, obj):
398.         """Hook for specifying custom inlines."""
399.         return self.inlines
400. 
401.     def get_ordering(self, request):
402.         """
403.         Hook for specifying field ordering.
404.         """
405.         return self.ordering or ()  # otherwise we might try to *None, which is bad ;)
406. 
407.     def get_readonly_fields(self, request, obj=None):
408.         """
409.         Hook for specifying custom readonly fields.
410.         """
411.         return self.readonly_fields
412. 
413.     def get_prepopulated_fields(self, request, obj=None):
414.         """
415.         Hook for specifying custom prepopulated fields.
416.         """
417.         return self.prepopulated_fields
418. 
419.     def get_queryset(self, request):
420.         """
421.         Return a QuerySet of all model instances that can be edited by the
422.         admin site. This is used by changelist_view.
423.         """
424.         qs = self.model._default_manager.get_queryset()
425.         # TODO: this should be handled by some parameter to the ChangeList.
426.         ordering = self.get_ordering(request)
427.         if ordering:
428.             qs = qs.order_by(*ordering)
429.         return qs
430. 
431.     def get_sortable_by(self, request):
432.         """Hook for specifying which fields can be sorted in the changelist."""
433.         return (
434.             self.sortable_by
435.             if self.sortable_by is not None
436.             else self.get_list_display(request)
437.         )
438. 
439.     def lookup_allowed(self, lookup, value):
440.         from django.contrib.admin.filters import SimpleListFilter
441. 
442.         model = self.model
443.         # Check FKey lookups that are allowed, so that popups produced by
444.         # ForeignKeyRawIdWidget, on the basis of ForeignKey.limit_choices_to,
445.         # are allowed to work.
446.         for fk_lookup in model._meta.related_fkey_lookups:
447.             # As ``limit_choices_to`` can be a callable, invoke it here.
448.             if callable(fk_lookup):
449.                 fk_lookup = fk_lookup()
450.             if (lookup, value) in widgets.url_params_from_lookup_dict(
451.                 fk_lookup
452.             ).items():
453.                 return True
454. 
455.         relation_parts = []
456.         prev_field = None
457.         for part in lookup.split(LOOKUP_SEP):
458.             try:
459.                 field = model._meta.get_field(part)
460.             except FieldDoesNotExist:
461.                 # Lookups on nonexistent fields are ok, since they're ignored
462.                 # later.
463.                 break
464.             # It is allowed to filter on values that would be found from local
465.             # model anyways. For example, if you filter on employee__department__id,
466.             # then the id value would be found already from employee__department_id.
467.             if not prev_field or (
468.                 prev_field.is_relation
469.                 and field not in prev_field.path_infos[-1].target_fields
470.             ):
471.                 relation_parts.append(part)
472.             if not getattr(field, "path_infos", None):
473.                 # This is not a relational field, so further parts
474.                 # must be transforms.
475.                 break
476.             prev_field = field
477.             model = field.path_infos[-1].to_opts.model
478. 
479.         if len(relation_parts) <= 1:
480.             # Either a local field filter, or no fields at all.
481.             return True
482.         valid_lookups = {self.date_hierarchy}
483.         for filter_item in self.list_filter:
484.             if isinstance(filter_item, type) and issubclass(
485.                 filter_item, SimpleListFilter
486.             ):
487.                 valid_lookups.add(filter_item.parameter_name)
488.             elif isinstance(filter_item, (list, tuple)):
489.                 valid_lookups.add(filter_item[0])
490.             else:
491.                 valid_lookups.add(filter_item)
492. 
493.         # Is it a valid relational lookup?
494.         return not {
495.             LOOKUP_SEP.join(relation_parts),
496.             LOOKUP_SEP.join(relation_parts + [part]),
497.         }.isdisjoint(valid_lookups)
498. 
499.     def to_field_allowed(self, request, to_field):
500.         """
501.         Return True if the model associated with this admin should be
502.         allowed to be referenced by the specified field.
503.         """
504.         try:
505.             field = self.opts.get_field(to_field)
506.         except FieldDoesNotExist:
507.             return False
508. 
509.         # Always allow referencing the primary key since it's already possible
510.         # to get this information from the change view URL.
511.         if field.primary_key:
512.             return True
513. 
514.         # Allow reverse relationships to models defining m2m fields if they
515.         # target the specified field.
516.         for many_to_many in self.opts.many_to_many:
517.             if many_to_many.m2m_target_field_name() == to_field:
518.                 return True
519. 
520.         # Make sure at least one of the models registered for this site
521.         # references this field through a FK or a M2M relationship.
522.         registered_models = set()
523.         for model, admin in self.admin_site._registry.items():
524.             registered_models.add(model)
525.             for inline in admin.inlines:
526.                 registered_models.add(inline.model)
527. 
528.         related_objects = (
529.             f
530.             for f in self.opts.get_fields(include_hidden=True)
531.             if (f.auto_created and not f.concrete)
532.         )
533.         for related_object in related_objects:
534.             related_model = related_object.related_model
535.             remote_field = related_object.field.remote_field
536.             if (
537.                 any(issubclass(model, related_model) for model in registered_models)
538.                 and hasattr(remote_field, "get_related_field")
539.                 and remote_field.get_related_field() == field
540.             ):
541.                 return True
542. 
543.         return False
544. 
545.     def has_add_permission(self, request):
546.         """
547.         Return True if the given request has permission to add an object.
548.         Can be overridden by the user in subclasses.
549.         """
550.         opts = self.opts
551.         codename = get_permission_codename("add", opts)
552.         return request.user.has_perm("%s.%s" % (opts.app_label, codename))
553. 
554.     def has_change_permission(self, request, obj=None):
555.         """
556.         Return True if the given request has permission to change the given
557.         Django model instance, the default implementation doesn't examine the
558.         `obj` parameter.
559. 
560.         Can be overridden by the user in subclasses. In such case it should
561.         return True if the given request has permission to change the `obj`
562.         model instance. If `obj` is None, this should return True if the given
563.         request has permission to change *any* object of the given type.
564.         """
565.         opts = self.opts
566.         codename = get_permission_codename("change", opts)
567.         return request.user.has_perm("%s.%s" % (opts.app_label, codename))
568. 
569.     def has_delete_permission(self, request, obj=None):
570.         """
571.         Return True if the given request has permission to delete the given
572.         Django model instance, the default implementation doesn't examine the
573.         `obj` parameter.
574. 
575.         Can be overridden by the user in subclasses. In such case it should
576.         return True if the given request has permission to delete the `obj`
577.         model instance. If `obj` is None, this should return True if the given
578.         request has permission to delete *any* object of the given type.
579.         """
580.         opts = self.opts
581.         codename = get_permission_codename("delete", opts)
582.         return request.user.has_perm("%s.%s" % (opts.app_label, codename))
583. 
584.     def has_view_permission(self, request, obj=None):
585.         """
586.         Return True if the given request has permission to view the given
587.         Django model instance. The default implementation doesn't examine the
588.         `obj` parameter.
589. 
590.         If overridden by the user in subclasses, it should return True if the
591.         given request has permission to view the `obj` model instance. If `obj`
592.         is None, it should return True if the request has permission to view
593.         any object of the given type.
594.         """
595.         opts = self.opts
596.         codename_view = get_permission_codename("view", opts)
597.         codename_change = get_permission_codename("change", opts)
598.         return request.user.has_perm(
599.             "%s.%s" % (opts.app_label, codename_view)
600.         ) or request.user.has_perm("%s.%s" % (opts.app_label, codename_change))
601. 
602.     def has_view_or_change_permission(self, request, obj=None):
603.         return self.has_view_permission(request, obj) or self.has_change_permission(
604.             request, obj
605.         )
606. 
607.     def has_module_permission(self, request):
608.         """
609.         Return True if the given request has any permission in the given
610.         app label.
611. 
612.         Can be overridden by the user in subclasses. In such case it should
613.         return True if the given request has permission to view the module on
614.         the admin index page and access the module's index page. Overriding it
615.         does not restrict access to the add, change or delete views. Use
616.         `ModelAdmin.has_(add|change|delete)_permission` for that.
617.         """
618.         return request.user.has_module_perms(self.opts.app_label)
619. 
620. 
621. class ModelAdmin(BaseModelAdmin):
622.     """Encapsulate all admin options and functionality for a given model."""
623. 
624.     list_display = ("__str__",)
625.     list_display_links = ()
626.     list_filter = ()
627.     list_select_related = False
628.     list_per_page = 100
629.     list_max_show_all = 200
630.     list_editable = ()
631.     search_fields = ()
632.     search_help_text = None
633.     date_hierarchy = None
634.     save_as = False
635.     save_as_continue = True
636.     save_on_top = False
637.     paginator = Paginator
638.     preserve_filters = True
639.     show_facets = ShowFacets.ALLOW
640.     inlines = ()
641. 
642.     # Custom templates (designed to be over-ridden in subclasses)
643.     add_form_template = None
644.     change_form_template = None
645.     change_list_template = None
646.     delete_confirmation_template = None
647.     delete_selected_confirmation_template = None
648.     object_history_template = None
649.     popup_response_template = None
650. 
651.     # Actions
652.     actions = ()
653.     action_form = helpers.ActionForm
654.     actions_on_top = True
655.     actions_on_bottom = False
656.     actions_selection_counter = True
657.     checks_class = ModelAdminChecks
658. 
659.     def __init__(self, model, admin_site):
660.         self.model = model
661.         self.opts = model._meta
662.         self.admin_site = admin_site
663.         super().__init__()
664. 
665.     def __str__(self):
666.         return "%s.%s" % (self.opts.app_label, self.__class__.__name__)
667. 
668.     def __repr__(self):
669.         return (
670.             f"<{self.__class__.__qualname__}: model={self.model.__qualname__} "
671.             f"site={self.admin_site!r}>"
672.         )
673. 
674.     def get_inline_instances(self, request, obj=None):
675.         inline_instances = []
676.         for inline_class in self.get_inlines(request, obj):
677.             inline = inline_class(self.model, self.admin_site)
678.             if request:
679.                 if not (
680.                     inline.has_view_or_change_permission(request, obj)
681.                     or inline.has_add_permission(request, obj)
682.                     or inline.has_delete_permission(request, obj)
683.                 ):
684.                     continue
685.                 if not inline.has_add_permission(request, obj):
686.                     inline.max_num = 0
687.             inline_instances.append(inline)
688. 
689.         return inline_instances
690. 
691.     def get_urls(self):
692.         from django.urls import path
693. 
694.         def wrap(view):
695.             def wrapper(*args, **kwargs):
696.                 return self.admin_site.admin_view(view)(*args, **kwargs)
697. 
698.             wrapper.model_admin = self
699.             return update_wrapper(wrapper, view)
700. 
701.         info = self.opts.app_label, self.opts.model_name
702. 
703.         return [
704.             path("", wrap(self.changelist_view), name="%s_%s_changelist" % info),
705.             path("add/", wrap(self.add_view), name="%s_%s_add" % info),
706.             path(
707.                 "<path:object_id>/history/",
708.                 wrap(self.history_view),
709.                 name="%s_%s_history" % info,
710.             ),
711.             path(
712.                 "<path:object_id>/delete/",
713.                 wrap(self.delete_view),
714.                 name="%s_%s_delete" % info,
715.             ),
716.             path(
717.                 "<path:object_id>/change/",
718.                 wrap(self.change_view),
719.                 name="%s_%s_change" % info,
720.             ),
721.             # For backwards compatibility (was the change url before 1.9)
722.             path(
723.                 "<path:object_id>/",
724.                 wrap(
725.                     RedirectView.as_view(
726.                         pattern_name="%s:%s_%s_change"
727.                         % ((self.admin_site.name,) + info)
728.                     )
729.                 ),
730.             ),
731.         ]
732. 
733.     @property
734.     def urls(self):
735.         return self.get_urls()
736. 
737.     @property
738.     def media(self):
739.         extra = "" if settings.DEBUG else ".min"
740.         js = [
741.             "vendor/jquery/jquery%s.js" % extra,
742.             "jquery.init.js",
743.             "core.js",
744.             "admin/RelatedObjectLookups.js",
745.             "actions.js",
746.             "urlify.js",
747.             "prepopulate.js",
748.             "vendor/xregexp/xregexp%s.js" % extra,
749.         ]
750.         return forms.Media(js=["admin/js/%s" % url for url in js])
751. 
752.     def get_model_perms(self, request):
753.         """
754.         Return a dict of all perms for this model. This dict has the keys
755.         ``add``, ``change``, ``delete``, and ``view`` mapping to the True/False
756.         for each of those actions.
757.         """
758.         return {
759.             "add": self.has_add_permission(request),
760.             "change": self.has_change_permission(request),
761.             "delete": self.has_delete_permission(request),
762.             "view": self.has_view_permission(request),
763.         }
764. 
765.     def _get_form_for_get_fields(self, request, obj):
766.         return self.get_form(request, obj, fields=None)
767. 
768.     def get_form(self, request, obj=None, change=False, **kwargs):
769.         """
770.         Return a Form class for use in the admin add view. This is used by
771.         add_view and change_view.
772.         """
773.         if "fields" in kwargs:
774.             fields = kwargs.pop("fields")
775.         else:
776.             fields = flatten_fieldsets(self.get_fieldsets(request, obj))
777.         excluded = self.get_exclude(request, obj)
778.         exclude = [] if excluded is None else list(excluded)
779.         readonly_fields = self.get_readonly_fields(request, obj)
780.         exclude.extend(readonly_fields)
781.         # Exclude all fields if it's a change form and the user doesn't have
782.         # the change permission.
783.         if (
784.             change
785.             and hasattr(request, "user")
786.             and not self.has_change_permission(request, obj)
787.         ):
788.             exclude.extend(fields)
789.         if excluded is None and hasattr(self.form, "_meta") and self.form._meta.exclude:
790.             # Take the custom ModelForm's Meta.exclude into account only if the
791.             # ModelAdmin doesn't define its own.
792.             exclude.extend(self.form._meta.exclude)
793.         # if exclude is an empty list we pass None to be consistent with the
794.         # default on modelform_factory
795.         exclude = exclude or None
796. 
797.         # Remove declared form fields which are in readonly_fields.
798.         new_attrs = dict.fromkeys(
799.             f for f in readonly_fields if f in self.form.declared_fields
800.         )
801.         form = type(self.form.__name__, (self.form,), new_attrs)
802. 
803.         defaults = {
804.             "form": form,
805.             "fields": fields,
806.             "exclude": exclude,
807.             "formfield_callback": partial(self.formfield_for_dbfield, request=request),
808.             **kwargs,
809.         }
810. 
811.         if defaults["fields"] is None and not modelform_defines_fields(
812.             defaults["form"]
813.         ):
814.             defaults["fields"] = forms.ALL_FIELDS
815. 
816.         try:
817.             return modelform_factory(self.model, **defaults)
818.         except FieldError as e:
819.             raise FieldError(
820.                 "%s. Check fields/fieldsets/exclude attributes of class %s."
821.                 % (e, self.__class__.__name__)
822.             )
823. 
824.     def get_changelist(self, request, **kwargs):
825.         """
826.         Return the ChangeList class for use on the changelist page.
827.         """
828.         from django.contrib.admin.views.main import ChangeList
829. 
830.         return ChangeList
831. 
832.     def get_changelist_instance(self, request):
833.         """
834.         Return a `ChangeList` instance based on `request`. May raise
835.         `IncorrectLookupParameters`.
836.         """
837.         list_display = self.get_list_display(request)
838.         list_display_links = self.get_list_display_links(request, list_display)
839.         # Add the action checkboxes if any actions are available.
840.         if self.get_actions(request):
841.             list_display = ["action_checkbox", *list_display]
842.         sortable_by = self.get_sortable_by(request)
843.         ChangeList = self.get_changelist(request)
844.         return ChangeList(
845.             request,
846.             self.model,
847.             list_display,
848.             list_display_links,
849.             self.get_list_filter(request),
850.             self.date_hierarchy,
851.             self.get_search_fields(request),
852.             self.get_list_select_related(request),
853.             self.list_per_page,
854.             self.list_max_show_all,
855.             self.list_editable,
856.             self,
857.             sortable_by,
858.             self.search_help_text,
859.         )
860. 
861.     def get_object(self, request, object_id, from_field=None):
862.         """
863.         Return an instance matching the field and value provided, the primary
864.         key is used if no field is provided. Return ``None`` if no match is
865.         found or the object_id fails validation.
866.         """
867.         queryset = self.get_queryset(request)
868.         model = queryset.model
869.         field = (
870.             model._meta.pk if from_field is None else model._meta.get_field(from_field)
871.         )
872.         try:
873.             object_id = field.to_python(object_id)
874.             return queryset.get(**{field.name: object_id})
875.         except (model.DoesNotExist, ValidationError, ValueError):
876.             return None
877. 
878.     def get_changelist_form(self, request, **kwargs):
879.         """
880.         Return a Form class for use in the Formset on the changelist page.
881.         """
882.         defaults = {
883.             "formfield_callback": partial(self.formfield_for_dbfield, request=request),
884.             **kwargs,
885.         }
886.         if defaults.get("fields") is None and not modelform_defines_fields(
887.             defaults.get("form")
888.         ):
889.             defaults["fields"] = forms.ALL_FIELDS
890. 
891.         return modelform_factory(self.model, **defaults)
892. 
893.     def get_changelist_formset(self, request, **kwargs):
894.         """
895.         Return a FormSet class for use on the changelist page if list_editable
896.         is used.
897.         """
898.         defaults = {
899.             "formfield_callback": partial(self.formfield_for_dbfield, request=request),
900.             **kwargs,
901.         }
902.         return modelformset_factory(
903.             self.model,
904.             self.get_changelist_form(request),
905.             extra=0,
906.             fields=self.list_editable,
907.             **defaults,
908.         )
909. 
910.     def get_formsets_with_inlines(self, request, obj=None):
911.         """
912.         Yield formsets and the corresponding inlines.
913.         """
914.         for inline in self.get_inline_instances(request, obj):
915.             yield inline.get_formset(request, obj), inline
916. 
917.     def get_paginator(
918.         self, request, queryset, per_page, orphans=0, allow_empty_first_page=True
919.     ):
920.         return self.paginator(queryset, per_page, orphans, allow_empty_first_page)
921. 
922.     def log_addition(self, request, obj, message):
923.         """
924.         Log that an object has been successfully added.
925. 
926.         The default implementation creates an admin LogEntry object.
927.         """
928.         from django.contrib.admin.models import ADDITION, LogEntry
929. 
930.         return LogEntry.objects.log_action(
931.             user_id=request.user.pk,
932.             content_type_id=get_content_type_for_model(obj).pk,
933.             object_id=obj.pk,
934.             object_repr=str(obj),
935.             action_flag=ADDITION,
936.             change_message=message,
937.         )
938. 
939.     def log_change(self, request, obj, message):
940.         """
941.         Log that an object has been successfully changed.
942. 
943.         The default implementation creates an admin LogEntry object.
944.         """
945.         from django.contrib.admin.models import CHANGE, LogEntry
946. 
947.         return LogEntry.objects.log_action(
948.             user_id=request.user.pk,
949.             content_type_id=get_content_type_for_model(obj).pk,
950.             object_id=obj.pk,
951.             object_repr=str(obj),
952.             action_flag=CHANGE,
953.             change_message=message,
954.         )
955. 
956.     def log_deletion(self, request, obj, object_repr):
957.         """
958.         Log that an object will be deleted. Note that this method must be
959.         called before the deletion.
960. 
961.         The default implementation creates an admin LogEntry object.
962.         """
963.         from django.contrib.admin.models import DELETION, LogEntry
964. 
965.         return LogEntry.objects.log_action(
966.             user_id=request.user.pk,
967.             content_type_id=get_content_type_for_model(obj).pk,
968.             object_id=obj.pk,
969.             object_repr=object_repr,
970.             action_flag=DELETION,
971.         )
972. 
973.     def action_checkbox(self, obj):
974.         """
975.         A list_display column containing a checkbox widget.
976.         """
977.         attrs = {
978.             "class": "action-select",
979.             "aria-label": format_html(_("Select this object for an action - {}"), obj),
980.         }
981.         checkbox = forms.CheckboxInput(attrs, lambda value: False)
982.         return checkbox.render(helpers.ACTION_CHECKBOX_NAME, str(obj.pk))
983. 
984.     @staticmethod
985.     def _get_action_description(func, name):
986.         return getattr(func, "short_description", capfirst(name.replace("_", " ")))
987. 
988.     def _get_base_actions(self):
989.         """Return the list of actions, prior to any request-based filtering."""
990.         actions = []
991.         base_actions = (self.get_action(action) for action in self.actions or [])
992.         # get_action might have returned None, so filter any of those out.
993.         base_actions = [action for action in base_actions if action]
994.         base_action_names = {name for _, name, _ in base_actions}
995. 
996.         # Gather actions from the admin site first
997.         for name, func in self.admin_site.actions:
998.             if name in base_action_names:
999.                 continue
1000.             description = self._get_action_description(func, name)
1001.             actions.append((func, name, description))
1002.         # Add actions from this ModelAdmin.
1003.         actions.extend(base_actions)
1004.         return actions
1005. 
1006.     def _filter_actions_by_permissions(self, request, actions):
1007.         """Filter out any actions that the user doesn't have access to."""
1008.         filtered_actions = []
1009.         for action in actions:
1010.             callable = action[0]
1011.             if not hasattr(callable, "allowed_permissions"):
1012.                 filtered_actions.append(action)
1013.                 continue
1014.             permission_checks = (
1015.                 getattr(self, "has_%s_permission" % permission)
1016.                 for permission in callable.allowed_permissions
1017.             )
1018.             if any(has_permission(request) for has_permission in permission_checks):
1019.                 filtered_actions.append(action)
1020.         return filtered_actions
1021. 
1022.     def get_actions(self, request):
1023.         """
1024.         Return a dictionary mapping the names of all actions for this
1025.         ModelAdmin to a tuple of (callable, name, description) for each action.
1026.         """
1027.         # If self.actions is set to None that means actions are disabled on
1028.         # this page.
1029.         if self.actions is None or IS_POPUP_VAR in request.GET:
1030.             return {}
1031.         actions = self._filter_actions_by_permissions(request, self._get_base_actions())
1032.         return {name: (func, name, desc) for func, name, desc in actions}
1033. 
1034.     def get_action_choices(self, request, default_choices=models.BLANK_CHOICE_DASH):
1035.         """
1036.         Return a list of choices for use in a form object.  Each choice is a
1037.         tuple (name, description).
1038.         """
1039.         choices = [] + default_choices
1040.         for func, name, description in self.get_actions(request).values():
1041.             choice = (name, description % model_format_dict(self.opts))
1042.             choices.append(choice)
1043.         return choices
1044. 
1045.     def get_action(self, action):
1046.         """
1047.         Return a given action from a parameter, which can either be a callable,
1048.         or the name of a method on the ModelAdmin.  Return is a tuple of
1049.         (callable, name, description).
1050.         """
1051.         # If the action is a callable, just use it.
1052.         if callable(action):
1053.             func = action
1054.             action = action.__name__
1055. 
1056.         # Next, look for a method. Grab it off self.__class__ to get an unbound
1057.         # method instead of a bound one; this ensures that the calling
1058.         # conventions are the same for functions and methods.
1059.         elif hasattr(self.__class__, action):
1060.             func = getattr(self.__class__, action)
1061. 
1062.         # Finally, look for a named method on the admin site
1063.         else:
1064.             try:
1065.                 func = self.admin_site.get_action(action)
1066.             except KeyError:
1067.                 return None
1068. 
1069.         description = self._get_action_description(func, action)
1070.         return func, action, description
1071. 
1072.     def get_list_display(self, request):
1073.         """
1074.         Return a sequence containing the fields to be displayed on the
1075.         changelist.
1076.         """
1077.         return self.list_display
1078. 
1079.     def get_list_display_links(self, request, list_display):
1080.         """
1081.         Return a sequence containing the fields to be displayed as links
1082.         on the changelist. The list_display parameter is the list of fields
1083.         returned by get_list_display().
1084.         """
1085.         if (
1086.             self.list_display_links
1087.             or self.list_display_links is None
1088.             or not list_display
1089.         ):
1090.             return self.list_display_links
1091.         else:
1092.             # Use only the first item in list_display as link
1093.             return list(list_display)[:1]
1094. 
1095.     def get_list_filter(self, request):
1096.         """
1097.         Return a sequence containing the fields to be displayed as filters in
1098.         the right sidebar of the changelist page.
1099.         """
1100.         return self.list_filter
1101. 
1102.     def get_list_select_related(self, request):
1103.         """
1104.         Return a list of fields to add to the select_related() part of the
1105.         changelist items query.
1106.         """
1107.         return self.list_select_related
1108. 
1109.     def get_search_fields(self, request):
1110.         """
1111.         Return a sequence containing the fields to be searched whenever
1112.         somebody submits a search query.
1113.         """
1114.         return self.search_fields
1115. 
1116.     def get_search_results(self, request, queryset, search_term):
1117.         """
1118.         Return a tuple containing a queryset to implement the search
1119.         and a boolean indicating if the results may contain duplicates.
1120.         """
1121. 
1122.         # Apply keyword searches.
1123.         def construct_search(field_name):
1124.             if field_name.startswith("^"):
1125.                 return "%s__istartswith" % field_name.removeprefix("^")
1126.             elif field_name.startswith("="):
1127.                 return "%s__iexact" % field_name.removeprefix("=")
1128.             elif field_name.startswith("@"):
1129.                 return "%s__search" % field_name.removeprefix("@")
1130.             # Use field_name if it includes a lookup.
1131.             opts = queryset.model._meta
1132.             lookup_fields = field_name.split(LOOKUP_SEP)
1133.             # Go through the fields, following all relations.
1134.             prev_field = None
1135.             for path_part in lookup_fields:
1136.                 if path_part == "pk":
1137.                     path_part = opts.pk.name
1138.                 try:
1139.                     field = opts.get_field(path_part)
1140.                 except FieldDoesNotExist:
1141.                     # Use valid query lookups.
1142.                     if prev_field and prev_field.get_lookup(path_part):
1143.                         return field_name
1144.                 else:
1145.                     prev_field = field
1146.                     if hasattr(field, "path_infos"):
1147.                         # Update opts to follow the relation.
1148.                         opts = field.path_infos[-1].to_opts
1149.             # Otherwise, use the field with icontains.
1150.             return "%s__icontains" % field_name
1151. 
1152.         may_have_duplicates = False
1153.         search_fields = self.get_search_fields(request)
1154.         if search_fields and search_term:
1155.             orm_lookups = [
1156.                 construct_search(str(search_field)) for search_field in search_fields
1157.             ]
1158.             term_queries = []
1159.             for bit in smart_split(search_term):
1160.                 if bit.startswith(('"', "'")) and bit[0] == bit[-1]:
1161.                     bit = unescape_string_literal(bit)
1162.                 or_queries = models.Q.create(
1163.                     [(orm_lookup, bit) for orm_lookup in orm_lookups],
1164.                     connector=models.Q.OR,
1165.                 )
1166.                 term_queries.append(or_queries)
1167.             queryset = queryset.filter(models.Q.create(term_queries))
1168.             may_have_duplicates |= any(
1169.                 lookup_spawns_duplicates(self.opts, search_spec)
1170.                 for search_spec in orm_lookups
1171.             )
1172.         return queryset, may_have_duplicates
1173. 
1174.     def get_preserved_filters(self, request):
1175.         """
1176.         Return the preserved filters querystring.
1177.         """
1178.         match = request.resolver_match
1179.         if self.preserve_filters and match:
1180.             current_url = "%s:%s" % (match.app_name, match.url_name)
1181.             changelist_url = "admin:%s_%s_changelist" % (
1182.                 self.opts.app_label,
1183.                 self.opts.model_name,
1184.             )
1185.             if current_url == changelist_url:
1186.                 preserved_filters = request.GET.urlencode()
1187.             else:
1188.                 preserved_filters = request.GET.get("_changelist_filters")
1189. 
1190.             if preserved_filters:
1191.                 return urlencode({"_changelist_filters": preserved_filters})
1192.         return ""
1193. 
1194.     def construct_change_message(self, request, form, formsets, add=False):
1195.         """
1196.         Construct a JSON structure describing changes from a changed object.
1197.         """
1198.         return construct_change_message(form, formsets, add)
1199. 
1200.     def message_user(
1201.         self, request, message, level=messages.INFO, extra_tags="", fail_silently=False
1202.     ):
1203.         """
1204.         Send a message to the user. The default implementation
1205.         posts a message using the django.contrib.messages backend.
1206. 
1207.         Exposes almost the same API as messages.add_message(), but accepts the
1208.         positional arguments in a different order to maintain backwards
1209.         compatibility. For convenience, it accepts the `level` argument as
1210.         a string rather than the usual level number.
1211.         """
1212.         if not isinstance(level, int):
1213.             # attempt to get the level if passed a string
1214.             try:
1215.                 level = getattr(messages.constants, level.upper())
1216.             except AttributeError:
1217.                 levels = messages.constants.DEFAULT_TAGS.values()
1218.                 levels_repr = ", ".join("`%s`" % level for level in levels)
1219.                 raise ValueError(
1220.                     "Bad message level string: `%s`. Possible values are: %s"
1221.                     % (level, levels_repr)
1222.                 )
1223. 
1224.         messages.add_message(
1225.             request, level, message, extra_tags=extra_tags, fail_silently=fail_silently
1226.         )
1227. 
1228.     def save_form(self, request, form, change):
1229.         """
1230.         Given a ModelForm return an unsaved instance. ``change`` is True if
1231.         the object is being changed, and False if it's being added.
1232.         """
1233.         return form.save(commit=False)
1234. 
1235.     def save_model(self, request, obj, form, change):
1236.         """
1237.         Given a model instance save it to the database.
1238.         """
1239.         obj.save()
1240. 
1241.     def delete_model(self, request, obj):
1242.         """
1243.         Given a model instance delete it from the database.
1244.         """
1245.         obj.delete()
1246. 
1247.     def delete_queryset(self, request, queryset):
1248.         """Given a queryset, delete it from the database."""
1249.         queryset.delete()
1250. 
1251.     def save_formset(self, request, form, formset, change):
1252.         """
1253.         Given an inline formset save it to the database.
1254.         """
1255.         formset.save()
1256. 
1257.     def save_related(self, request, form, formsets, change):
1258.         """
1259.         Given the ``HttpRequest``, the parent ``ModelForm`` instance, the
1260.         list of inline formsets and a boolean value based on whether the
1261.         parent is being added or changed, save the related objects to the
1262.         database. Note that at this point save_form() and save_model() have
1263.         already been called.
1264.         """
1265.         form.save_m2m()
1266.         for formset in formsets:
1267.             self.save_formset(request, form, formset, change=change)
1268. 
1269.     def render_change_form(
1270.         self, request, context, add=False, change=False, form_url="", obj=None
1271.     ):
1272.         app_label = self.opts.app_label
1273.         preserved_filters = self.get_preserved_filters(request)
1274.         form_url = add_preserved_filters(
1275.             {"preserved_filters": preserved_filters, "opts": self.opts}, form_url
1276.         )
1277.         view_on_site_url = self.get_view_on_site_url(obj)
1278.         has_editable_inline_admin_formsets = False
1279.         for inline in context["inline_admin_formsets"]:
1280.             if (
1281.                 inline.has_add_permission
1282.                 or inline.has_change_permission
1283.                 or inline.has_delete_permission
1284.             ):
1285.                 has_editable_inline_admin_formsets = True
1286.                 break
1287.         context.update(
1288.             {
1289.                 "add": add,
1290.                 "change": change,
1291.                 "has_view_permission": self.has_view_permission(request, obj),
1292.                 "has_add_permission": self.has_add_permission(request),
1293.                 "has_change_permission": self.has_change_permission(request, obj),
1294.                 "has_delete_permission": self.has_delete_permission(request, obj),
1295.                 "has_editable_inline_admin_formsets": (
1296.                     has_editable_inline_admin_formsets
1297.                 ),
1298.                 "has_file_field": context["adminform"].form.is_multipart()
1299.                 or any(
1300.                     admin_formset.formset.is_multipart()
1301.                     for admin_formset in context["inline_admin_formsets"]
1302.                 ),
1303.                 "has_absolute_url": view_on_site_url is not None,
1304.                 "absolute_url": view_on_site_url,
1305.                 "form_url": form_url,
1306.                 "opts": self.opts,
1307.                 "content_type_id": get_content_type_for_model(self.model).pk,
1308.                 "save_as": self.save_as,
1309.                 "save_on_top": self.save_on_top,
1310.                 "to_field_var": TO_FIELD_VAR,
1311.                 "is_popup_var": IS_POPUP_VAR,
1312.                 "app_label": app_label,
1313.             }
1314.         )
1315.         if add and self.add_form_template is not None:
1316.             form_template = self.add_form_template
1317.         else:
1318.             form_template = self.change_form_template
1319. 
1320.         request.current_app = self.admin_site.name
1321. 
1322.         return TemplateResponse(
1323.             request,
1324.             form_template
1325.             or [
1326.                 "admin/%s/%s/change_form.html" % (app_label, self.opts.model_name),
1327.                 "admin/%s/change_form.html" % app_label,
1328.                 "admin/change_form.html",
1329.             ],
1330.             context,
1331.         )
1332. 
1333.     def response_add(self, request, obj, post_url_continue=None):
1334.         """
1335.         Determine the HttpResponse for the add_view stage.
1336.         """
1337.         opts = obj._meta
1338.         preserved_filters = self.get_preserved_filters(request)
1339.         obj_url = reverse(
1340.             "admin:%s_%s_change" % (opts.app_label, opts.model_name),
1341.             args=(quote(obj.pk),),
1342.             current_app=self.admin_site.name,
1343.         )
1344.         # Add a link to the object's change form if the user can edit the obj.
1345.         if self.has_change_permission(request, obj):
1346.             obj_repr = format_html('<a href="{}">{}</a>', urlquote(obj_url), obj)
1347.         else:
1348.             obj_repr = str(obj)
1349.         msg_dict = {
1350.             "name": opts.verbose_name,
1351.             "obj": obj_repr,
1352.         }
1353.         # Here, we distinguish between different save types by checking for
1354.         # the presence of keys in request.POST.
1355. 
1356.         if IS_POPUP_VAR in request.POST:
1357.             to_field = request.POST.get(TO_FIELD_VAR)
1358.             if to_field:
1359.                 attr = str(to_field)
1360.             else:
1361.                 attr = obj._meta.pk.attname
1362.             value = obj.serializable_value(attr)
1363.             popup_response_data = json.dumps(
1364.                 {
1365.                     "value": str(value),
1366.                     "obj": str(obj),
1367.                 }
1368.             )
1369.             return TemplateResponse(
1370.                 request,
1371.                 self.popup_response_template
1372.                 or [
1373.                     "admin/%s/%s/popup_response.html"
1374.                     % (opts.app_label, opts.model_name),
1375.                     "admin/%s/popup_response.html" % opts.app_label,
1376.                     "admin/popup_response.html",
1377.                 ],
1378.                 {
1379.                     "popup_response_data": popup_response_data,
1380.                 },
1381.             )
1382. 
1383.         elif "_continue" in request.POST or (
1384.             # Redirecting after "Save as new".
1385.             "_saveasnew" in request.POST
1386.             and self.save_as_continue
1387.             and self.has_change_permission(request, obj)
1388.         ):
1389.             msg = _("The {name} “{obj}” was added successfully.")
1390.             if self.has_change_permission(request, obj):
1391.                 msg += " " + _("You may edit it again below.")
1392.             self.message_user(request, format_html(msg, **msg_dict), messages.SUCCESS)
1393.             if post_url_continue is None:
1394.                 post_url_continue = obj_url
1395.             post_url_continue = add_preserved_filters(
1396.                 {"preserved_filters": preserved_filters, "opts": opts},
1397.                 post_url_continue,
1398.             )
1399.             return HttpResponseRedirect(post_url_continue)
1400. 
1401.         elif "_addanother" in request.POST:
1402.             msg = format_html(
1403.                 _(
1404.                     "The {name} “{obj}” was added successfully. You may add another "
1405.                     "{name} below."
1406.                 ),
1407.                 **msg_dict,
1408.             )
1409.             self.message_user(request, msg, messages.SUCCESS)
1410.             redirect_url = request.path
1411.             redirect_url = add_preserved_filters(
1412.                 {"preserved_filters": preserved_filters, "opts": opts}, redirect_url
1413.             )
1414.             return HttpResponseRedirect(redirect_url)
1415. 
1416.         else:
1417.             msg = format_html(
1418.                 _("The {name} “{obj}” was added successfully."), **msg_dict
1419.             )
1420.             self.message_user(request, msg, messages.SUCCESS)
1421.             return self.response_post_save_add(request, obj)
1422. 
1423.     def response_change(self, request, obj):
1424.         """
1425.         Determine the HttpResponse for the change_view stage.
1426.         """
1427. 
1428.         if IS_POPUP_VAR in request.POST:
1429.             opts = obj._meta
1430.             to_field = request.POST.get(TO_FIELD_VAR)
1431.             attr = str(to_field) if to_field else opts.pk.attname
1432.             value = request.resolver_match.kwargs["object_id"]
1433.             new_value = obj.serializable_value(attr)
1434.             popup_response_data = json.dumps(
1435.                 {
1436.                     "action": "change",
1437.                     "value": str(value),
1438.                     "obj": str(obj),
1439.                     "new_value": str(new_value),
1440.                 }
1441.             )
1442.             return TemplateResponse(
1443.                 request,
1444.                 self.popup_response_template
1445.                 or [
1446.                     "admin/%s/%s/popup_response.html"
1447.                     % (opts.app_label, opts.model_name),
1448.                     "admin/%s/popup_response.html" % opts.app_label,
1449.                     "admin/popup_response.html",
1450.                 ],
1451.                 {
1452.                     "popup_response_data": popup_response_data,
1453.                 },
1454.             )
1455. 
1456.         opts = self.opts
1457.         preserved_filters = self.get_preserved_filters(request)
1458. 
1459.         msg_dict = {
1460.             "name": opts.verbose_name,
1461.             "obj": format_html('<a href="{}">{}</a>', urlquote(request.path), obj),
1462.         }
1463.         if "_continue" in request.POST:
1464.             msg = format_html(
1465.                 _(
1466.                     "The {name} “{obj}” was changed successfully. You may edit it "
1467.                     "again below."
1468.                 ),
1469.                 **msg_dict,
1470.             )
1471.             self.message_user(request, msg, messages.SUCCESS)
1472.             redirect_url = request.path
1473.             redirect_url = add_preserved_filters(
1474.                 {"preserved_filters": preserved_filters, "opts": opts}, redirect_url
1475.             )
1476.             return HttpResponseRedirect(redirect_url)
1477. 
1478.         elif "_saveasnew" in request.POST:
1479.             msg = format_html(
1480.                 _(
1481.                     "The {name} “{obj}” was added successfully. You may edit it again "
1482.                     "below."
1483.                 ),
1484.                 **msg_dict,
1485.             )
1486.             self.message_user(request, msg, messages.SUCCESS)
1487.             redirect_url = reverse(
1488.                 "admin:%s_%s_change" % (opts.app_label, opts.model_name),
1489.                 args=(obj.pk,),
1490.                 current_app=self.admin_site.name,
1491.             )
1492.             redirect_url = add_preserved_filters(
1493.                 {"preserved_filters": preserved_filters, "opts": opts}, redirect_url
1494.             )
1495.             return HttpResponseRedirect(redirect_url)
1496. 
1497.         elif "_addanother" in request.POST:
1498.             msg = format_html(
1499.                 _(
1500.                     "The {name} “{obj}” was changed successfully. You may add another "
1501.                     "{name} below."
1502.                 ),
1503.                 **msg_dict,
1504.             )
1505.             self.message_user(request, msg, messages.SUCCESS)
1506.             redirect_url = reverse(
1507.                 "admin:%s_%s_add" % (opts.app_label, opts.model_name),
1508.                 current_app=self.admin_site.name,
1509.             )
1510.             redirect_url = add_preserved_filters(
1511.                 {"preserved_filters": preserved_filters, "opts": opts}, redirect_url
1512.             )
1513.             return HttpResponseRedirect(redirect_url)
1514. 
1515.         else:
1516.             msg = format_html(
1517.                 _("The {name} “{obj}” was changed successfully."), **msg_dict
1518.             )
1519.             self.message_user(request, msg, messages.SUCCESS)
1520.             return self.response_post_save_change(request, obj)
1521. 
1522.     def _response_post_save(self, request, obj):
1523.         if self.has_view_or_change_permission(request):
1524.             post_url = reverse(
1525.                 "admin:%s_%s_changelist" % (self.opts.app_label, self.opts.model_name),
1526.                 current_app=self.admin_site.name,
1527.             )
1528.             preserved_filters = self.get_preserved_filters(request)
1529.             post_url = add_preserved_filters(
1530.                 {"preserved_filters": preserved_filters, "opts": self.opts}, post_url
1531.             )
1532.         else:
1533.             post_url = reverse("admin:index", current_app=self.admin_site.name)
1534.         return HttpResponseRedirect(post_url)
1535. 
1536.     def response_post_save_add(self, request, obj):
1537.         """
1538.         Figure out where to redirect after the 'Save' button has been pressed
1539.         when adding a new object.
1540.         """
1541.         return self._response_post_save(request, obj)
1542. 
1543.     def response_post_save_change(self, request, obj):
1544.         """
1545.         Figure out where to redirect after the 'Save' button has been pressed
1546.         when editing an existing object.
1547.         """
1548.         return self._response_post_save(request, obj)
1549. 
1550.     def response_action(self, request, queryset):
1551.         """
1552.         Handle an admin action. This is called if a request is POSTed to the
1553.         changelist; it returns an HttpResponse if the action was handled, and
1554.         None otherwise.
1555.         """
1556. 
1557.         # There can be multiple action forms on the page (at the top
1558.         # and bottom of the change list, for example). Get the action
1559.         # whose button was pushed.
1560.         try:
1561.             action_index = int(request.POST.get("index", 0))
1562.         except ValueError:
1563.             action_index = 0
1564. 
1565.         # Construct the action form.
1566.         data = request.POST.copy()
1567.         data.pop(helpers.ACTION_CHECKBOX_NAME, None)
1568.         data.pop("index", None)
1569. 
1570.         # Use the action whose button was pushed
1571.         try:
1572.             data.update({"action": data.getlist("action")[action_index]})
1573.         except IndexError:
1574.             # If we didn't get an action from the chosen form that's invalid
1575.             # POST data, so by deleting action it'll fail the validation check
1576.             # below. So no need to do anything here
1577.             pass
1578. 
1579.         action_form = self.action_form(data, auto_id=None)
1580.         action_form.fields["action"].choices = self.get_action_choices(request)
1581. 
1582.         # If the form's valid we can handle the action.
1583.         if action_form.is_valid():
1584.             action = action_form.cleaned_data["action"]
1585.             select_across = action_form.cleaned_data["select_across"]
1586.             func = self.get_actions(request)[action][0]
1587. 
1588.             # Get the list of selected PKs. If nothing's selected, we can't
1589.             # perform an action on it, so bail. Except we want to perform
1590.             # the action explicitly on all objects.
1591.             selected = request.POST.getlist(helpers.ACTION_CHECKBOX_NAME)
1592.             if not selected and not select_across:
1593.                 # Reminder that something needs to be selected or nothing will happen
1594.                 msg = _(
1595.                     "Items must be selected in order to perform "
1596.                     "actions on them. No items have been changed."
1597.                 )
1598.                 self.message_user(request, msg, messages.WARNING)
1599.                 return None
1600. 
1601.             if not select_across:
1602.                 # Perform the action only on the selected objects
1603.                 queryset = queryset.filter(pk__in=selected)
1604. 
1605.             response = func(self, request, queryset)
1606. 
1607.             # Actions may return an HttpResponse-like object, which will be
1608.             # used as the response from the POST. If not, we'll be a good
1609.             # little HTTP citizen and redirect back to the changelist page.
1610.             if isinstance(response, HttpResponseBase):
1611.                 return response
1612.             else:
1613.                 return HttpResponseRedirect(request.get_full_path())
1614.         else:
1615.             msg = _("No action selected.")
1616.             self.message_user(request, msg, messages.WARNING)
1617.             return None
1618. 
1619.     def response_delete(self, request, obj_display, obj_id):
1620.         """
1621.         Determine the HttpResponse for the delete_view stage.
1622.         """
1623.         if IS_POPUP_VAR in request.POST:
1624.             popup_response_data = json.dumps(
1625.                 {
1626.                     "action": "delete",
1627.                     "value": str(obj_id),
1628.                 }
1629.             )
1630.             return TemplateResponse(
1631.                 request,
1632.                 self.popup_response_template
1633.                 or [
1634.                     "admin/%s/%s/popup_response.html"
1635.                     % (self.opts.app_label, self.opts.model_name),
1636.                     "admin/%s/popup_response.html" % self.opts.app_label,
1637.                     "admin/popup_response.html",
1638.                 ],
1639.                 {
1640.                     "popup_response_data": popup_response_data,
1641.                 },
1642.             )
1643. 
1644.         self.message_user(
1645.             request,
1646.             _("The %(name)s “%(obj)s” was deleted successfully.")
1647.             % {
1648.                 "name": self.opts.verbose_name,
1649.                 "obj": obj_display,
1650.             },
1651.             messages.SUCCESS,
1652.         )
1653. 
1654.         if self.has_change_permission(request, None):
1655.             post_url = reverse(
1656.                 "admin:%s_%s_changelist" % (self.opts.app_label, self.opts.model_name),
1657.                 current_app=self.admin_site.name,
1658.             )
1659.             preserved_filters = self.get_preserved_filters(request)
1660.             post_url = add_preserved_filters(
1661.                 {"preserved_filters": preserved_filters, "opts": self.opts}, post_url
1662.             )
1663.         else:
1664.             post_url = reverse("admin:index", current_app=self.admin_site.name)
1665.         return HttpResponseRedirect(post_url)
1666. 
1667.     def render_delete_form(self, request, context):
1668.         app_label = self.opts.app_label
1669. 
1670.         request.current_app = self.admin_site.name
1671.         context.update(
1672.             to_field_var=TO_FIELD_VAR,
1673.             is_popup_var=IS_POPUP_VAR,
1674.             media=self.media,
1675.         )
1676. 
1677.         return TemplateResponse(
1678.             request,
1679.             self.delete_confirmation_template
1680.             or [
1681.                 "admin/{}/{}/delete_confirmation.html".format(
1682.                     app_label, self.opts.model_name
1683.                 ),
1684.                 "admin/{}/delete_confirmation.html".format(app_label),
1685.                 "admin/delete_confirmation.html",
1686.             ],
1687.             context,
1688.         )
1689. 
1690.     def get_inline_formsets(self, request, formsets, inline_instances, obj=None):
1691.         # Edit permissions on parent model are required for editable inlines.
1692.         can_edit_parent = (
1693.             self.has_change_permission(request, obj)
1694.             if obj
1695.             else self.has_add_permission(request)
1696.         )
1697.         inline_admin_formsets = []
1698.         for inline, formset in zip(inline_instances, formsets):
1699.             fieldsets = list(inline.get_fieldsets(request, obj))
1700.             readonly = list(inline.get_readonly_fields(request, obj))
1701.             if can_edit_parent:
1702.                 has_add_permission = inline.has_add_permission(request, obj)
1703.                 has_change_permission = inline.has_change_permission(request, obj)
1704.                 has_delete_permission = inline.has_delete_permission(request, obj)
1705.             else:
1706.                 # Disable all edit-permissions, and override formset settings.
1707.                 has_add_permission = (
1708.                     has_change_permission
1709.                 ) = has_delete_permission = False
1710.                 formset.extra = formset.max_num = 0
1711.             has_view_permission = inline.has_view_permission(request, obj)
1712.             prepopulated = dict(inline.get_prepopulated_fields(request, obj))
1713.             inline_admin_formset = helpers.InlineAdminFormSet(
1714.                 inline,
1715.                 formset,
1716.                 fieldsets,
1717.                 prepopulated,
1718.                 readonly,
1719.                 model_admin=self,
1720.                 has_add_permission=has_add_permission,
1721.                 has_change_permission=has_change_permission,
1722.                 has_delete_permission=has_delete_permission,
1723.                 has_view_permission=has_view_permission,
1724.             )
1725.             inline_admin_formsets.append(inline_admin_formset)
1726.         return inline_admin_formsets
1727. 
1728.     def get_changeform_initial_data(self, request):
1729.         """
1730.         Get the initial form data from the request's GET params.
1731.         """
1732.         initial = dict(request.GET.items())
1733.         for k in initial:
1734.             try:
1735.                 f = self.opts.get_field(k)
1736.             except FieldDoesNotExist:
1737.                 continue
1738.             # We have to special-case M2Ms as a list of comma-separated PKs.
1739.             if isinstance(f, models.ManyToManyField):
1740.                 initial[k] = initial[k].split(",")
1741.         return initial
1742. 
1743.     def _get_obj_does_not_exist_redirect(self, request, opts, object_id):
1744.         """
1745.         Create a message informing the user that the object doesn't exist
1746.         and return a redirect to the admin index page.
1747.         """
1748.         msg = _("%(name)s with ID “%(key)s” doesn’t exist. Perhaps it was deleted?") % {
1749.             "name": opts.verbose_name,
1750.             "key": unquote(object_id),
1751.         }
1752.         self.message_user(request, msg, messages.WARNING)
1753.         url = reverse("admin:index", current_app=self.admin_site.name)
1754.         return HttpResponseRedirect(url)
1755. 
1756.     @csrf_protect_m
1757.     def changeform_view(self, request, object_id=None, form_url="", extra_context=None):
1758.         with transaction.atomic(using=router.db_for_write(self.model)):
1759.             return self._changeform_view(request, object_id, form_url, extra_context)
1760. 
1761.     def _changeform_view(self, request, object_id, form_url, extra_context):
1762.         to_field = request.POST.get(TO_FIELD_VAR, request.GET.get(TO_FIELD_VAR))
1763.         if to_field and not self.to_field_allowed(request, to_field):
1764.             raise DisallowedModelAdminToField(
1765.                 "The field %s cannot be referenced." % to_field
1766.             )
1767. 
1768.         if request.method == "POST" and "_saveasnew" in request.POST:
1769.             object_id = None
1770. 
1771.         add = object_id is None
1772. 
1773.         if add:
1774.             if not self.has_add_permission(request):
1775.                 raise PermissionDenied
1776.             obj = None
1777. 
1778.         else:
1779.             obj = self.get_object(request, unquote(object_id), to_field)
1780. 
1781.             if request.method == "POST":
1782.                 if not self.has_change_permission(request, obj):
1783.                     raise PermissionDenied
1784.             else:
1785.                 if not self.has_view_or_change_permission(request, obj):
1786.                     raise PermissionDenied
1787. 
1788.             if obj is None:
1789.                 return self._get_obj_does_not_exist_redirect(
1790.                     request, self.opts, object_id
1791.                 )
1792. 
1793.         fieldsets = self.get_fieldsets(request, obj)
1794.         ModelForm = self.get_form(
1795.             request, obj, change=not add, fields=flatten_fieldsets(fieldsets)
1796.         )
1797.         if request.method == "POST":
1798.             form = ModelForm(request.POST, request.FILES, instance=obj)
1799.             formsets, inline_instances = self._create_formsets(
1800.                 request,
1801.                 form.instance,
1802.                 change=not add,
1803.             )
1804.             form_validated = form.is_valid()
1805.             if form_validated:
1806.                 new_object = self.save_form(request, form, change=not add)
1807.             else:
1808.                 new_object = form.instance
1809.             if all_valid(formsets) and form_validated:
1810.                 self.save_model(request, new_object, form, not add)
1811.                 self.save_related(request, form, formsets, not add)
1812.                 change_message = self.construct_change_message(
1813.                     request, form, formsets, add
1814.                 )
1815.                 if add:
1816.                     self.log_addition(request, new_object, change_message)
1817.                     return self.response_add(request, new_object)
1818.                 else:
1819.                     self.log_change(request, new_object, change_message)
1820.                     return self.response_change(request, new_object)
1821.             else:
1822.                 form_validated = False
1823.         else:
1824.             if add:
1825.                 initial = self.get_changeform_initial_data(request)
1826.                 form = ModelForm(initial=initial)
1827.                 formsets, inline_instances = self._create_formsets(
1828.                     request, form.instance, change=False
1829.                 )
1830.             else:
1831.                 form = ModelForm(instance=obj)
1832.                 formsets, inline_instances = self._create_formsets(
1833.                     request, obj, change=True
1834.                 )
1835. 
1836.         if not add and not self.has_change_permission(request, obj):
1837.             readonly_fields = flatten_fieldsets(fieldsets)
1838.         else:
1839.             readonly_fields = self.get_readonly_fields(request, obj)
1840.         admin_form = helpers.AdminForm(
1841.             form,
1842.             list(fieldsets),
1843.             # Clear prepopulated fields on a view-only form to avoid a crash.
1844.             self.get_prepopulated_fields(request, obj)
1845.             if add or self.has_change_permission(request, obj)
1846.             else {},
1847.             readonly_fields,
1848.             model_admin=self,
1849.         )
1850.         media = self.media + admin_form.media
1851. 
1852.         inline_formsets = self.get_inline_formsets(
1853.             request, formsets, inline_instances, obj
1854.         )
1855.         for inline_formset in inline_formsets:
1856.             media += inline_formset.media
1857. 
1858.         if add:
1859.             title = _("Add %s")
1860.         elif self.has_change_permission(request, obj):
1861.             title = _("Change %s")
1862.         else:
1863.             title = _("View %s")
1864.         context = {
1865.             **self.admin_site.each_context(request),
1866.             "title": title % self.opts.verbose_name,
1867.             "subtitle": str(obj) if obj else None,
1868.             "adminform": admin_form,
1869.             "object_id": object_id,
1870.             "original": obj,
1871.             "is_popup": IS_POPUP_VAR in request.POST or IS_POPUP_VAR in request.GET,
1872.             "to_field": to_field,
1873.             "media": media,
1874.             "inline_admin_formsets": inline_formsets,
1875.             "errors": helpers.AdminErrorList(form, formsets),
1876.             "preserved_filters": self.get_preserved_filters(request),
1877.         }
1878. 
1879.         # Hide the "Save" and "Save and continue" buttons if "Save as New" was
1880.         # previously chosen to prevent the interface from getting confusing.
1881.         if (
1882.             request.method == "POST"
1883.             and not form_validated
1884.             and "_saveasnew" in request.POST
1885.         ):
1886.             context["show_save"] = False
1887.             context["show_save_and_continue"] = False
1888.             # Use the change template instead of the add template.
1889.             add = False
1890. 
1891.         context.update(extra_context or {})
1892. 
1893.         return self.render_change_form(
1894.             request, context, add=add, change=not add, obj=obj, form_url=form_url
1895.         )
1896. 
1897.     def add_view(self, request, form_url="", extra_context=None):
1898.         return self.changeform_view(request, None, form_url, extra_context)
1899. 
1900.     def change_view(self, request, object_id, form_url="", extra_context=None):
1901.         return self.changeform_view(request, object_id, form_url, extra_context)
1902. 
1903.     def _get_edited_object_pks(self, request, prefix):
1904.         """Return POST data values of list_editable primary keys."""
1905.         pk_pattern = re.compile(
1906.             r"{}-\d+-{}$".format(re.escape(prefix), self.opts.pk.name)
1907.         )
1908.         return [value for key, value in request.POST.items() if pk_pattern.match(key)]
1909. 
1910.     def _get_list_editable_queryset(self, request, prefix):
1911.         """
1912.         Based on POST data, return a queryset of the objects that were edited
1913.         via list_editable.
1914.         """
1915.         object_pks = self._get_edited_object_pks(request, prefix)
1916.         queryset = self.get_queryset(request)
1917.         validate = queryset.model._meta.pk.to_python
1918.         try:
1919.             for pk in object_pks:
1920.                 validate(pk)
1921.         except ValidationError:
1922.             # Disable the optimization if the POST data was tampered with.
1923.             return queryset
1924.         return queryset.filter(pk__in=object_pks)
1925. 
1926.     @csrf_protect_m
1927.     def changelist_view(self, request, extra_context=None):
1928.         """
1929.         The 'change list' admin view for this model.
1930.         """
1931.         from django.contrib.admin.views.main import ERROR_FLAG
1932. 
1933.         app_label = self.opts.app_label
1934.         if not self.has_view_or_change_permission(request):
1935.             raise PermissionDenied
1936. 
1937.         try:
1938.             cl = self.get_changelist_instance(request)
1939.         except IncorrectLookupParameters:
1940.             # Wacky lookup parameters were given, so redirect to the main
1941.             # changelist page, without parameters, and pass an 'invalid=1'
1942.             # parameter via the query string. If wacky parameters were given
1943.             # and the 'invalid=1' parameter was already in the query string,
1944.             # something is screwed up with the database, so display an error
1945.             # page.
1946.             if ERROR_FLAG in request.GET:
1947.                 return SimpleTemplateResponse(
1948.                     "admin/invalid_setup.html",
1949.                     {
1950.                         "title": _("Database error"),
1951.                     },
1952.                 )
1953.             return HttpResponseRedirect(request.path + "?" + ERROR_FLAG + "=1")
1954. 
1955.         # If the request was POSTed, this might be a bulk action or a bulk
1956.         # edit. Try to look up an action or confirmation first, but if this
1957.         # isn't an action the POST will fall through to the bulk edit check,
1958.         # below.
1959.         action_failed = False
1960.         selected = request.POST.getlist(helpers.ACTION_CHECKBOX_NAME)
1961. 
1962.         actions = self.get_actions(request)
1963.         # Actions with no confirmation
1964.         if (
1965.             actions
1966.             and request.method == "POST"
1967.             and "index" in request.POST
1968.             and "_save" not in request.POST
1969.         ):
1970.             if selected:
1971.                 response = self.response_action(
1972.                     request, queryset=cl.get_queryset(request)
1973.                 )
1974.                 if response:
1975.                     return response
1976.                 else:
1977.                     action_failed = True
1978.             else:
1979.                 msg = _(
1980.                     "Items must be selected in order to perform "
1981.                     "actions on them. No items have been changed."
1982.                 )
1983.                 self.message_user(request, msg, messages.WARNING)
1984.                 action_failed = True
1985. 
1986.         # Actions with confirmation
1987.         if (
1988.             actions
1989.             and request.method == "POST"
1990.             and helpers.ACTION_CHECKBOX_NAME in request.POST
1991.             and "index" not in request.POST
1992.             and "_save" not in request.POST
1993.         ):
1994.             if selected:
1995.                 response = self.response_action(
1996.                     request, queryset=cl.get_queryset(request)
1997.                 )
1998.                 if response:
1999.                     return response
2000.                 else:


File: django/db/models/fields/related.py
Line number range: 1 - 1985
Content:
1. import functools
2. import inspect
3. from functools import partial
4. 
5. from django import forms
6. from django.apps import apps
7. from django.conf import SettingsReference, settings
8. from django.core import checks, exceptions
9. from django.db import connection, router
10. from django.db.backends import utils
11. from django.db.models import Q
12. from django.db.models.constants import LOOKUP_SEP
13. from django.db.models.deletion import CASCADE, SET_DEFAULT, SET_NULL
14. from django.db.models.query_utils import PathInfo
15. from django.db.models.utils import make_model_tuple
16. from django.utils.functional import cached_property
17. from django.utils.translation import gettext_lazy as _
18. 
19. from . import Field
20. from .mixins import FieldCacheMixin
21. from .related_descriptors import (
22.     ForeignKeyDeferredAttribute,
23.     ForwardManyToOneDescriptor,
24.     ForwardOneToOneDescriptor,
25.     ManyToManyDescriptor,
26.     ReverseManyToOneDescriptor,
27.     ReverseOneToOneDescriptor,
28. )
29. from .related_lookups import (
30.     RelatedExact,
31.     RelatedGreaterThan,
32.     RelatedGreaterThanOrEqual,
33.     RelatedIn,
34.     RelatedIsNull,
35.     RelatedLessThan,
36.     RelatedLessThanOrEqual,
37. )
38. from .reverse_related import ForeignObjectRel, ManyToManyRel, ManyToOneRel, OneToOneRel
39. 
40. RECURSIVE_RELATIONSHIP_CONSTANT = "self"
41. 
42. 
43. def resolve_relation(scope_model, relation):
44.     """
45.     Transform relation into a model or fully-qualified model string of the form
46.     "app_label.ModelName", relative to scope_model.
47. 
48.     The relation argument can be:
49.       * RECURSIVE_RELATIONSHIP_CONSTANT, i.e. the string "self", in which case
50.         the model argument will be returned.
51.       * A bare model name without an app_label, in which case scope_model's
52.         app_label will be prepended.
53.       * An "app_label.ModelName" string.
54.       * A model class, which will be returned unchanged.
55.     """
56.     # Check for recursive relations
57.     if relation == RECURSIVE_RELATIONSHIP_CONSTANT:
58.         relation = scope_model
59. 
60.     # Look for an "app.Model" relation
61.     if isinstance(relation, str):
62.         if "." not in relation:
63.             relation = "%s.%s" % (scope_model._meta.app_label, relation)
64. 
65.     return relation
66. 
67. 
68. def lazy_related_operation(function, model, *related_models, **kwargs):
69.     """
70.     Schedule `function` to be called once `model` and all `related_models`
71.     have been imported and registered with the app registry. `function` will
72.     be called with the newly-loaded model classes as its positional arguments,
73.     plus any optional keyword arguments.
74. 
75.     The `model` argument must be a model class. Each subsequent positional
76.     argument is another model, or a reference to another model - see
77.     `resolve_relation()` for the various forms these may take. Any relative
78.     references will be resolved relative to `model`.
79. 
80.     This is a convenience wrapper for `Apps.lazy_model_operation` - the app
81.     registry model used is the one found in `model._meta.apps`.
82.     """
83.     models = [model] + [resolve_relation(model, rel) for rel in related_models]
84.     model_keys = (make_model_tuple(m) for m in models)
85.     apps = model._meta.apps
86.     return apps.lazy_model_operation(partial(function, **kwargs), *model_keys)
87. 
88. 
89. class RelatedField(FieldCacheMixin, Field):
90.     """Base class that all relational fields inherit from."""
91. 
92.     # Field flags
93.     one_to_many = False
94.     one_to_one = False
95.     many_to_many = False
96.     many_to_one = False
97. 
98.     def __init__(
99.         self,
100.         related_name=None,
101.         related_query_name=None,
102.         limit_choices_to=None,
103.         **kwargs,
104.     ):
105.         self._related_name = related_name
106.         self._related_query_name = related_query_name
107.         self._limit_choices_to = limit_choices_to
108.         super().__init__(**kwargs)
109. 
110.     @cached_property
111.     def related_model(self):
112.         # Can't cache this property until all the models are loaded.
113.         apps.check_models_ready()
114.         return self.remote_field.model
115. 
116.     def check(self, **kwargs):
117.         return [
118.             *super().check(**kwargs),
119.             *self._check_related_name_is_valid(),
120.             *self._check_related_query_name_is_valid(),
121.             *self._check_relation_model_exists(),
122.             *self._check_referencing_to_swapped_model(),
123.             *self._check_clashes(),
124.         ]
125. 
126.     def _check_related_name_is_valid(self):
127.         import keyword
128. 
129.         related_name = self.remote_field.related_name
130.         if related_name is None:
131.             return []
132.         is_valid_id = (
133.             not keyword.iskeyword(related_name) and related_name.isidentifier()
134.         )
135.         if not (is_valid_id or related_name.endswith("+")):
136.             return [
137.                 checks.Error(
138.                     "The name '%s' is invalid related_name for field %s.%s"
139.                     % (
140.                         self.remote_field.related_name,
141.                         self.model._meta.object_name,
142.                         self.name,
143.                     ),
144.                     hint=(
145.                         "Related name must be a valid Python identifier or end with a "
146.                         "'+'"
147.                     ),
148.                     obj=self,
149.                     id="fields.E306",
150.                 )
151.             ]
152.         return []
153. 
154.     def _check_related_query_name_is_valid(self):
155.         if self.remote_field.is_hidden():
156.             return []
157.         rel_query_name = self.related_query_name()
158.         errors = []
159.         if rel_query_name.endswith("_"):
160.             errors.append(
161.                 checks.Error(
162.                     "Reverse query name '%s' must not end with an underscore."
163.                     % rel_query_name,
164.                     hint=(
165.                         "Add or change a related_name or related_query_name "
166.                         "argument for this field."
167.                     ),
168.                     obj=self,
169.                     id="fields.E308",
170.                 )
171.             )
172.         if LOOKUP_SEP in rel_query_name:
173.             errors.append(
174.                 checks.Error(
175.                     "Reverse query name '%s' must not contain '%s'."
176.                     % (rel_query_name, LOOKUP_SEP),
177.                     hint=(
178.                         "Add or change a related_name or related_query_name "
179.                         "argument for this field."
180.                     ),
181.                     obj=self,
182.                     id="fields.E309",
183.                 )
184.             )
185.         return errors
186. 
187.     def _check_relation_model_exists(self):
188.         rel_is_missing = self.remote_field.model not in self.opts.apps.get_models()
189.         rel_is_string = isinstance(self.remote_field.model, str)
190.         model_name = (
191.             self.remote_field.model
192.             if rel_is_string
193.             else self.remote_field.model._meta.object_name
194.         )
195.         if rel_is_missing and (
196.             rel_is_string or not self.remote_field.model._meta.swapped
197.         ):
198.             return [
199.                 checks.Error(
200.                     "Field defines a relation with model '%s', which is either "
201.                     "not installed, or is abstract." % model_name,
202.                     obj=self,
203.                     id="fields.E300",
204.                 )
205.             ]
206.         return []
207. 
208.     def _check_referencing_to_swapped_model(self):
209.         if (
210.             self.remote_field.model not in self.opts.apps.get_models()
211.             and not isinstance(self.remote_field.model, str)
212.             and self.remote_field.model._meta.swapped
213.         ):
214.             return [
215.                 checks.Error(
216.                     "Field defines a relation with the model '%s', which has "
217.                     "been swapped out." % self.remote_field.model._meta.label,
218.                     hint="Update the relation to point at 'settings.%s'."
219.                     % self.remote_field.model._meta.swappable,
220.                     obj=self,
221.                     id="fields.E301",
222.                 )
223.             ]
224.         return []
225. 
226.     def _check_clashes(self):
227.         """Check accessor and reverse query name clashes."""
228.         from django.db.models.base import ModelBase
229. 
230.         errors = []
231.         opts = self.model._meta
232. 
233.         # f.remote_field.model may be a string instead of a model. Skip if
234.         # model name is not resolved.
235.         if not isinstance(self.remote_field.model, ModelBase):
236.             return []
237. 
238.         # Consider that we are checking field `Model.foreign` and the models
239.         # are:
240.         #
241.         #     class Target(models.Model):
242.         #         model = models.IntegerField()
243.         #         model_set = models.IntegerField()
244.         #
245.         #     class Model(models.Model):
246.         #         foreign = models.ForeignKey(Target)
247.         #         m2m = models.ManyToManyField(Target)
248. 
249.         # rel_opts.object_name == "Target"
250.         rel_opts = self.remote_field.model._meta
251.         # If the field doesn't install a backward relation on the target model
252.         # (so `is_hidden` returns True), then there are no clashes to check
253.         # and we can skip these fields.
254.         rel_is_hidden = self.remote_field.is_hidden()
255.         rel_name = self.remote_field.get_accessor_name()  # i. e. "model_set"
256.         rel_query_name = self.related_query_name()  # i. e. "model"
257.         # i.e. "app_label.Model.field".
258.         field_name = "%s.%s" % (opts.label, self.name)
259. 
260.         # Check clashes between accessor or reverse query name of `field`
261.         # and any other field name -- i.e. accessor for Model.foreign is
262.         # model_set and it clashes with Target.model_set.
263.         potential_clashes = rel_opts.fields + rel_opts.many_to_many
264.         for clash_field in potential_clashes:
265.             # i.e. "app_label.Target.model_set".
266.             clash_name = "%s.%s" % (rel_opts.label, clash_field.name)
267.             if not rel_is_hidden and clash_field.name == rel_name:
268.                 errors.append(
269.                     checks.Error(
270.                         f"Reverse accessor '{rel_opts.object_name}.{rel_name}' "
271.                         f"for '{field_name}' clashes with field name "
272.                         f"'{clash_name}'.",
273.                         hint=(
274.                             "Rename field '%s', or add/change a related_name "
275.                             "argument to the definition for field '%s'."
276.                         )
277.                         % (clash_name, field_name),
278.                         obj=self,
279.                         id="fields.E302",
280.                     )
281.                 )
282. 
283.             if clash_field.name == rel_query_name:
284.                 errors.append(
285.                     checks.Error(
286.                         "Reverse query name for '%s' clashes with field name '%s'."
287.                         % (field_name, clash_name),
288.                         hint=(
289.                             "Rename field '%s', or add/change a related_name "
290.                             "argument to the definition for field '%s'."
291.                         )
292.                         % (clash_name, field_name),
293.                         obj=self,
294.                         id="fields.E303",
295.                     )
296.                 )
297. 
298.         # Check clashes between accessors/reverse query names of `field` and
299.         # any other field accessor -- i. e. Model.foreign accessor clashes with
300.         # Model.m2m accessor.
301.         potential_clashes = (r for r in rel_opts.related_objects if r.field is not self)
302.         for clash_field in potential_clashes:
303.             # i.e. "app_label.Model.m2m".
304.             clash_name = "%s.%s" % (
305.                 clash_field.related_model._meta.label,
306.                 clash_field.field.name,
307.             )
308.             if not rel_is_hidden and clash_field.get_accessor_name() == rel_name:
309.                 errors.append(
310.                     checks.Error(
311.                         f"Reverse accessor '{rel_opts.object_name}.{rel_name}' "
312.                         f"for '{field_name}' clashes with reverse accessor for "
313.                         f"'{clash_name}'.",
314.                         hint=(
315.                             "Add or change a related_name argument "
316.                             "to the definition for '%s' or '%s'."
317.                         )
318.                         % (field_name, clash_name),
319.                         obj=self,
320.                         id="fields.E304",
321.                     )
322.                 )
323. 
324.             if clash_field.get_accessor_name() == rel_query_name:
325.                 errors.append(
326.                     checks.Error(
327.                         "Reverse query name for '%s' clashes with reverse query name "
328.                         "for '%s'." % (field_name, clash_name),
329.                         hint=(
330.                             "Add or change a related_name argument "
331.                             "to the definition for '%s' or '%s'."
332.                         )
333.                         % (field_name, clash_name),
334.                         obj=self,
335.                         id="fields.E305",
336.                     )
337.                 )
338. 
339.         return errors
340. 
341.     def db_type(self, connection):
342.         # By default related field will not have a column as it relates to
343.         # columns from another table.
344.         return None
345. 
346.     def contribute_to_class(self, cls, name, private_only=False, **kwargs):
347.         super().contribute_to_class(cls, name, private_only=private_only, **kwargs)
348. 
349.         self.opts = cls._meta
350. 
351.         if not cls._meta.abstract:
352.             if self.remote_field.related_name:
353.                 related_name = self.remote_field.related_name
354.             else:
355.                 related_name = self.opts.default_related_name
356.             if related_name:
357.                 related_name %= {
358.                     "class": cls.__name__.lower(),
359.                     "model_name": cls._meta.model_name.lower(),
360.                     "app_label": cls._meta.app_label.lower(),
361.                 }
362.                 self.remote_field.related_name = related_name
363. 
364.             if self.remote_field.related_query_name:
365.                 related_query_name = self.remote_field.related_query_name % {
366.                     "class": cls.__name__.lower(),
367.                     "app_label": cls._meta.app_label.lower(),
368.                 }
369.                 self.remote_field.related_query_name = related_query_name
370. 
371.             def resolve_related_class(model, related, field):
372.                 field.remote_field.model = related
373.                 field.do_related_class(related, model)
374. 
375.             lazy_related_operation(
376.                 resolve_related_class, cls, self.remote_field.model, field=self
377.             )
378. 
379.     def deconstruct(self):
380.         name, path, args, kwargs = super().deconstruct()
381.         if self._limit_choices_to:
382.             kwargs["limit_choices_to"] = self._limit_choices_to
383.         if self._related_name is not None:
384.             kwargs["related_name"] = self._related_name
385.         if self._related_query_name is not None:
386.             kwargs["related_query_name"] = self._related_query_name
387.         return name, path, args, kwargs
388. 
389.     def get_forward_related_filter(self, obj):
390.         """
391.         Return the keyword arguments that when supplied to
392.         self.model.object.filter(), would select all instances related through
393.         this field to the remote obj. This is used to build the querysets
394.         returned by related descriptors. obj is an instance of
395.         self.related_field.model.
396.         """
397.         return {
398.             "%s__%s" % (self.name, rh_field.name): getattr(obj, rh_field.attname)
399.             for _, rh_field in self.related_fields
400.         }
401. 
402.     def get_reverse_related_filter(self, obj):
403.         """
404.         Complement to get_forward_related_filter(). Return the keyword
405.         arguments that when passed to self.related_field.model.object.filter()
406.         select all instances of self.related_field.model related through
407.         this field to obj. obj is an instance of self.model.
408.         """
409.         base_q = Q.create(
410.             [
411.                 (rh_field.attname, getattr(obj, lh_field.attname))
412.                 for lh_field, rh_field in self.related_fields
413.             ]
414.         )
415.         descriptor_filter = self.get_extra_descriptor_filter(obj)
416.         if isinstance(descriptor_filter, dict):
417.             return base_q & Q(**descriptor_filter)
418.         elif descriptor_filter:
419.             return base_q & descriptor_filter
420.         return base_q
421. 
422.     @property
423.     def swappable_setting(self):
424.         """
425.         Get the setting that this is powered from for swapping, or None
426.         if it's not swapped in / marked with swappable=False.
427.         """
428.         if self.swappable:
429.             # Work out string form of "to"
430.             if isinstance(self.remote_field.model, str):
431.                 to_string = self.remote_field.model
432.             else:
433.                 to_string = self.remote_field.model._meta.label
434.             return apps.get_swappable_settings_name(to_string)
435.         return None
436. 
437.     def set_attributes_from_rel(self):
438.         self.name = self.name or (
439.             self.remote_field.model._meta.model_name
440.             + "_"
441.             + self.remote_field.model._meta.pk.name
442.         )
443.         if self.verbose_name is None:
444.             self.verbose_name = self.remote_field.model._meta.verbose_name
445.         self.remote_field.set_field_name()
446. 
447.     def do_related_class(self, other, cls):
448.         self.set_attributes_from_rel()
449.         self.contribute_to_related_class(other, self.remote_field)
450. 
451.     def get_limit_choices_to(self):
452.         """
453.         Return ``limit_choices_to`` for this model field.
454. 
455.         If it is a callable, it will be invoked and the result will be
456.         returned.
457.         """
458.         if callable(self.remote_field.limit_choices_to):
459.             return self.remote_field.limit_choices_to()
460.         return self.remote_field.limit_choices_to
461. 
462.     def formfield(self, **kwargs):
463.         """
464.         Pass ``limit_choices_to`` to the field being constructed.
465. 
466.         Only passes it if there is a type that supports related fields.
467.         This is a similar strategy used to pass the ``queryset`` to the field
468.         being constructed.
469.         """
470.         defaults = {}
471.         if hasattr(self.remote_field, "get_related_field"):
472.             # If this is a callable, do not invoke it here. Just pass
473.             # it in the defaults for when the form class will later be
474.             # instantiated.
475.             limit_choices_to = self.remote_field.limit_choices_to
476.             defaults.update(
477.                 {
478.                     "limit_choices_to": limit_choices_to,
479.                 }
480.             )
481.         defaults.update(kwargs)
482.         return super().formfield(**defaults)
483. 
484.     def related_query_name(self):
485.         """
486.         Define the name that can be used to identify this related object in a
487.         table-spanning query.
488.         """
489.         return (
490.             self.remote_field.related_query_name
491.             or self.remote_field.related_name
492.             or self.opts.model_name
493.         )
494. 
495.     @property
496.     def target_field(self):
497.         """
498.         When filtering against this relation, return the field on the remote
499.         model against which the filtering should happen.
500.         """
501.         target_fields = self.path_infos[-1].target_fields
502.         if len(target_fields) > 1:
503.             raise exceptions.FieldError(
504.                 "The relation has multiple target fields, but only single target field "
505.                 "was asked for"
506.             )
507.         return target_fields[0]
508. 
509.     def get_cache_name(self):
510.         return self.name
511. 
512. 
513. class ForeignObject(RelatedField):
514.     """
515.     Abstraction of the ForeignKey relation to support multi-column relations.
516.     """
517. 
518.     # Field flags
519.     many_to_many = False
520.     many_to_one = True
521.     one_to_many = False
522.     one_to_one = False
523. 
524.     requires_unique_target = True
525.     related_accessor_class = ReverseManyToOneDescriptor
526.     forward_related_accessor_class = ForwardManyToOneDescriptor
527.     rel_class = ForeignObjectRel
528. 
529.     def __init__(
530.         self,
531.         to,
532.         on_delete,
533.         from_fields,
534.         to_fields,
535.         rel=None,
536.         related_name=None,
537.         related_query_name=None,
538.         limit_choices_to=None,
539.         parent_link=False,
540.         swappable=True,
541.         **kwargs,
542.     ):
543.         if rel is None:
544.             rel = self.rel_class(
545.                 self,
546.                 to,
547.                 related_name=related_name,
548.                 related_query_name=related_query_name,
549.                 limit_choices_to=limit_choices_to,
550.                 parent_link=parent_link,
551.                 on_delete=on_delete,
552.             )
553. 
554.         super().__init__(
555.             rel=rel,
556.             related_name=related_name,
557.             related_query_name=related_query_name,
558.             limit_choices_to=limit_choices_to,
559.             **kwargs,
560.         )
561. 
562.         self.from_fields = from_fields
563.         self.to_fields = to_fields
564.         self.swappable = swappable
565. 
566.     def __copy__(self):
567.         obj = super().__copy__()
568.         # Remove any cached PathInfo values.
569.         obj.__dict__.pop("path_infos", None)
570.         obj.__dict__.pop("reverse_path_infos", None)
571.         return obj
572. 
573.     def check(self, **kwargs):
574.         return [
575.             *super().check(**kwargs),
576.             *self._check_to_fields_exist(),
577.             *self._check_unique_target(),
578.         ]
579. 
580.     def _check_to_fields_exist(self):
581.         # Skip nonexistent models.
582.         if isinstance(self.remote_field.model, str):
583.             return []
584. 
585.         errors = []
586.         for to_field in self.to_fields:
587.             if to_field:
588.                 try:
589.                     self.remote_field.model._meta.get_field(to_field)
590.                 except exceptions.FieldDoesNotExist:
591.                     errors.append(
592.                         checks.Error(
593.                             "The to_field '%s' doesn't exist on the related "
594.                             "model '%s'."
595.                             % (to_field, self.remote_field.model._meta.label),
596.                             obj=self,
597.                             id="fields.E312",
598.                         )
599.                     )
600.         return errors
601. 
602.     def _check_unique_target(self):
603.         rel_is_string = isinstance(self.remote_field.model, str)
604.         if rel_is_string or not self.requires_unique_target:
605.             return []
606. 
607.         try:
608.             self.foreign_related_fields
609.         except exceptions.FieldDoesNotExist:
610.             return []
611. 
612.         if not self.foreign_related_fields:
613.             return []
614. 
615.         unique_foreign_fields = {
616.             frozenset([f.name])
617.             for f in self.remote_field.model._meta.get_fields()
618.             if getattr(f, "unique", False)
619.         }
620.         unique_foreign_fields.update(
621.             {frozenset(ut) for ut in self.remote_field.model._meta.unique_together}
622.         )
623.         unique_foreign_fields.update(
624.             {
625.                 frozenset(uc.fields)
626.                 for uc in self.remote_field.model._meta.total_unique_constraints
627.             }
628.         )
629.         foreign_fields = {f.name for f in self.foreign_related_fields}
630.         has_unique_constraint = any(u <= foreign_fields for u in unique_foreign_fields)
631. 
632.         if not has_unique_constraint and len(self.foreign_related_fields) > 1:
633.             field_combination = ", ".join(
634.                 "'%s'" % rel_field.name for rel_field in self.foreign_related_fields
635.             )
636.             model_name = self.remote_field.model.__name__
637.             return [
638.                 checks.Error(
639.                     "No subset of the fields %s on model '%s' is unique."
640.                     % (field_combination, model_name),
641.                     hint=(
642.                         "Mark a single field as unique=True or add a set of "
643.                         "fields to a unique constraint (via unique_together "
644.                         "or a UniqueConstraint (without condition) in the "
645.                         "model Meta.constraints)."
646.                     ),
647.                     obj=self,
648.                     id="fields.E310",
649.                 )
650.             ]
651.         elif not has_unique_constraint:
652.             field_name = self.foreign_related_fields[0].name
653.             model_name = self.remote_field.model.__name__
654.             return [
655.                 checks.Error(
656.                     "'%s.%s' must be unique because it is referenced by "
657.                     "a foreign key." % (model_name, field_name),
658.                     hint=(
659.                         "Add unique=True to this field or add a "
660.                         "UniqueConstraint (without condition) in the model "
661.                         "Meta.constraints."
662.                     ),
663.                     obj=self,
664.                     id="fields.E311",
665.                 )
666.             ]
667.         else:
668.             return []
669. 
670.     def deconstruct(self):
671.         name, path, args, kwargs = super().deconstruct()
672.         kwargs["on_delete"] = self.remote_field.on_delete
673.         kwargs["from_fields"] = self.from_fields
674.         kwargs["to_fields"] = self.to_fields
675. 
676.         if self.remote_field.parent_link:
677.             kwargs["parent_link"] = self.remote_field.parent_link
678.         if isinstance(self.remote_field.model, str):
679.             if "." in self.remote_field.model:
680.                 app_label, model_name = self.remote_field.model.split(".")
681.                 kwargs["to"] = "%s.%s" % (app_label, model_name.lower())
682.             else:
683.                 kwargs["to"] = self.remote_field.model.lower()
684.         else:
685.             kwargs["to"] = self.remote_field.model._meta.label_lower
686.         # If swappable is True, then see if we're actually pointing to the target
687.         # of a swap.
688.         swappable_setting = self.swappable_setting
689.         if swappable_setting is not None:
690.             # If it's already a settings reference, error
691.             if hasattr(kwargs["to"], "setting_name"):
692.                 if kwargs["to"].setting_name != swappable_setting:
693.                     raise ValueError(
694.                         "Cannot deconstruct a ForeignKey pointing to a model "
695.                         "that is swapped in place of more than one model (%s and %s)"
696.                         % (kwargs["to"].setting_name, swappable_setting)
697.                     )
698.             # Set it
699.             kwargs["to"] = SettingsReference(
700.                 kwargs["to"],
701.                 swappable_setting,
702.             )
703.         return name, path, args, kwargs
704. 
705.     def resolve_related_fields(self):
706.         if not self.from_fields or len(self.from_fields) != len(self.to_fields):
707.             raise ValueError(
708.                 "Foreign Object from and to fields must be the same non-zero length"
709.             )
710.         if isinstance(self.remote_field.model, str):
711.             raise ValueError(
712.                 "Related model %r cannot be resolved" % self.remote_field.model
713.             )
714.         related_fields = []
715.         for index in range(len(self.from_fields)):
716.             from_field_name = self.from_fields[index]
717.             to_field_name = self.to_fields[index]
718.             from_field = (
719.                 self
720.                 if from_field_name == RECURSIVE_RELATIONSHIP_CONSTANT
721.                 else self.opts.get_field(from_field_name)
722.             )
723.             to_field = (
724.                 self.remote_field.model._meta.pk
725.                 if to_field_name is None
726.                 else self.remote_field.model._meta.get_field(to_field_name)
727.             )
728.             related_fields.append((from_field, to_field))
729.         return related_fields
730. 
731.     @cached_property
732.     def related_fields(self):
733.         return self.resolve_related_fields()
734. 
735.     @cached_property
736.     def reverse_related_fields(self):
737.         return [(rhs_field, lhs_field) for lhs_field, rhs_field in self.related_fields]
738. 
739.     @cached_property
740.     def local_related_fields(self):
741.         return tuple(lhs_field for lhs_field, rhs_field in self.related_fields)
742. 
743.     @cached_property
744.     def foreign_related_fields(self):
745.         return tuple(
746.             rhs_field for lhs_field, rhs_field in self.related_fields if rhs_field
747.         )
748. 
749.     def get_local_related_value(self, instance):
750.         return self.get_instance_value_for_fields(instance, self.local_related_fields)
751. 
752.     def get_foreign_related_value(self, instance):
753.         return self.get_instance_value_for_fields(instance, self.foreign_related_fields)
754. 
755.     @staticmethod
756.     def get_instance_value_for_fields(instance, fields):
757.         ret = []
758.         opts = instance._meta
759.         for field in fields:
760.             # Gotcha: in some cases (like fixture loading) a model can have
761.             # different values in parent_ptr_id and parent's id. So, use
762.             # instance.pk (that is, parent_ptr_id) when asked for instance.id.
763.             if field.primary_key:
764.                 possible_parent_link = opts.get_ancestor_link(field.model)
765.                 if (
766.                     not possible_parent_link
767.                     or possible_parent_link.primary_key
768.                     or possible_parent_link.model._meta.abstract
769.                 ):
770.                     ret.append(instance.pk)
771.                     continue
772.             ret.append(getattr(instance, field.attname))
773.         return tuple(ret)
774. 
775.     def get_attname_column(self):
776.         attname, column = super().get_attname_column()
777.         return attname, None
778. 
779.     def get_joining_columns(self, reverse_join=False):
780.         source = self.reverse_related_fields if reverse_join else self.related_fields
781.         return tuple(
782.             (lhs_field.column, rhs_field.column) for lhs_field, rhs_field in source
783.         )
784. 
785.     def get_reverse_joining_columns(self):
786.         return self.get_joining_columns(reverse_join=True)
787. 
788.     def get_extra_descriptor_filter(self, instance):
789.         """
790.         Return an extra filter condition for related object fetching when
791.         user does 'instance.fieldname', that is the extra filter is used in
792.         the descriptor of the field.
793. 
794.         The filter should be either a dict usable in .filter(**kwargs) call or
795.         a Q-object. The condition will be ANDed together with the relation's
796.         joining columns.
797. 
798.         A parallel method is get_extra_restriction() which is used in
799.         JOIN and subquery conditions.
800.         """
801.         return {}
802. 
803.     def get_extra_restriction(self, alias, related_alias):
804.         """
805.         Return a pair condition used for joining and subquery pushdown. The
806.         condition is something that responds to as_sql(compiler, connection)
807.         method.
808. 
809.         Note that currently referring both the 'alias' and 'related_alias'
810.         will not work in some conditions, like subquery pushdown.
811. 
812.         A parallel method is get_extra_descriptor_filter() which is used in
813.         instance.fieldname related object fetching.
814.         """
815.         return None
816. 
817.     def get_path_info(self, filtered_relation=None):
818.         """Get path from this field to the related model."""
819.         opts = self.remote_field.model._meta
820.         from_opts = self.model._meta
821.         return [
822.             PathInfo(
823.                 from_opts=from_opts,
824.                 to_opts=opts,
825.                 target_fields=self.foreign_related_fields,
826.                 join_field=self,
827.                 m2m=False,
828.                 direct=True,
829.                 filtered_relation=filtered_relation,
830.             )
831.         ]
832. 
833.     @cached_property
834.     def path_infos(self):
835.         return self.get_path_info()
836. 
837.     def get_reverse_path_info(self, filtered_relation=None):
838.         """Get path from the related model to this field's model."""
839.         opts = self.model._meta
840.         from_opts = self.remote_field.model._meta
841.         return [
842.             PathInfo(
843.                 from_opts=from_opts,
844.                 to_opts=opts,
845.                 target_fields=(opts.pk,),
846.                 join_field=self.remote_field,
847.                 m2m=not self.unique,
848.                 direct=False,
849.                 filtered_relation=filtered_relation,
850.             )
851.         ]
852. 
853.     @cached_property
854.     def reverse_path_infos(self):
855.         return self.get_reverse_path_info()
856. 
857.     @classmethod
858.     @functools.cache
859.     def get_class_lookups(cls):
860.         bases = inspect.getmro(cls)
861.         bases = bases[: bases.index(ForeignObject) + 1]
862.         class_lookups = [parent.__dict__.get("class_lookups", {}) for parent in bases]
863.         return cls.merge_dicts(class_lookups)
864. 
865.     def contribute_to_class(self, cls, name, private_only=False, **kwargs):
866.         super().contribute_to_class(cls, name, private_only=private_only, **kwargs)
867.         setattr(cls, self.name, self.forward_related_accessor_class(self))
868. 
869.     def contribute_to_related_class(self, cls, related):
870.         # Internal FK's - i.e., those with a related name ending with '+' -
871.         # and swapped models don't get a related descriptor.
872.         if (
873.             not self.remote_field.is_hidden()
874.             and not related.related_model._meta.swapped
875.         ):
876.             setattr(
877.                 cls._meta.concrete_model,
878.                 related.get_accessor_name(),
879.                 self.related_accessor_class(related),
880.             )
881.             # While 'limit_choices_to' might be a callable, simply pass
882.             # it along for later - this is too early because it's still
883.             # model load time.
884.             if self.remote_field.limit_choices_to:
885.                 cls._meta.related_fkey_lookups.append(
886.                     self.remote_field.limit_choices_to
887.                 )
888. 
889. 
890. ForeignObject.register_lookup(RelatedIn)
891. ForeignObject.register_lookup(RelatedExact)
892. ForeignObject.register_lookup(RelatedLessThan)
893. ForeignObject.register_lookup(RelatedGreaterThan)
894. ForeignObject.register_lookup(RelatedGreaterThanOrEqual)
895. ForeignObject.register_lookup(RelatedLessThanOrEqual)
896. ForeignObject.register_lookup(RelatedIsNull)
897. 
898. 
899. class ForeignKey(ForeignObject):
900.     """
901.     Provide a many-to-one relation by adding a column to the local model
902.     to hold the remote value.
903. 
904.     By default ForeignKey will target the pk of the remote model but this
905.     behavior can be changed by using the ``to_field`` argument.
906.     """
907. 
908.     descriptor_class = ForeignKeyDeferredAttribute
909.     # Field flags
910.     many_to_many = False
911.     many_to_one = True
912.     one_to_many = False
913.     one_to_one = False
914. 
915.     rel_class = ManyToOneRel
916. 
917.     empty_strings_allowed = False
918.     default_error_messages = {
919.         "invalid": _("%(model)s instance with %(field)s %(value)r does not exist.")
920.     }
921.     description = _("Foreign Key (type determined by related field)")
922. 
923.     def __init__(
924.         self,
925.         to,
926.         on_delete,
927.         related_name=None,
928.         related_query_name=None,
929.         limit_choices_to=None,
930.         parent_link=False,
931.         to_field=None,
932.         db_constraint=True,
933.         **kwargs,
934.     ):
935.         try:
936.             to._meta.model_name
937.         except AttributeError:
938.             if not isinstance(to, str):
939.                 raise TypeError(
940.                     "%s(%r) is invalid. First parameter to ForeignKey must be "
941.                     "either a model, a model name, or the string %r"
942.                     % (
943.                         self.__class__.__name__,
944.                         to,
945.                         RECURSIVE_RELATIONSHIP_CONSTANT,
946.                     )
947.                 )
948.         else:
949.             # For backwards compatibility purposes, we need to *try* and set
950.             # the to_field during FK construction. It won't be guaranteed to
951.             # be correct until contribute_to_class is called. Refs #12190.
952.             to_field = to_field or (to._meta.pk and to._meta.pk.name)
953.         if not callable(on_delete):
954.             raise TypeError("on_delete must be callable.")
955. 
956.         kwargs["rel"] = self.rel_class(
957.             self,
958.             to,
959.             to_field,
960.             related_name=related_name,
961.             related_query_name=related_query_name,
962.             limit_choices_to=limit_choices_to,
963.             parent_link=parent_link,
964.             on_delete=on_delete,
965.         )
966.         kwargs.setdefault("db_index", True)
967. 
968.         super().__init__(
969.             to,
970.             on_delete,
971.             related_name=related_name,
972.             related_query_name=related_query_name,
973.             limit_choices_to=limit_choices_to,
974.             from_fields=[RECURSIVE_RELATIONSHIP_CONSTANT],
975.             to_fields=[to_field],
976.             **kwargs,
977.         )
978.         self.db_constraint = db_constraint
979. 
980.     def __class_getitem__(cls, *args, **kwargs):
981.         return cls
982. 
983.     def check(self, **kwargs):
984.         return [
985.             *super().check(**kwargs),
986.             *self._check_on_delete(),
987.             *self._check_unique(),
988.         ]
989. 
990.     def _check_on_delete(self):
991.         on_delete = getattr(self.remote_field, "on_delete", None)
992.         if on_delete == SET_NULL and not self.null:
993.             return [
994.                 checks.Error(
995.                     "Field specifies on_delete=SET_NULL, but cannot be null.",
996.                     hint=(
997.                         "Set null=True argument on the field, or change the on_delete "
998.                         "rule."
999.                     ),
1000.                     obj=self,
1001.                     id="fields.E320",
1002.                 )
1003.             ]
1004.         elif on_delete == SET_DEFAULT and not self.has_default():
1005.             return [
1006.                 checks.Error(
1007.                     "Field specifies on_delete=SET_DEFAULT, but has no default value.",
1008.                     hint="Set a default value, or change the on_delete rule.",
1009.                     obj=self,
1010.                     id="fields.E321",
1011.                 )
1012.             ]
1013.         else:
1014.             return []
1015. 
1016.     def _check_unique(self, **kwargs):
1017.         return (
1018.             [
1019.                 checks.Warning(
1020.                     "Setting unique=True on a ForeignKey has the same effect as using "
1021.                     "a OneToOneField.",
1022.                     hint=(
1023.                         "ForeignKey(unique=True) is usually better served by a "
1024.                         "OneToOneField."
1025.                     ),
1026.                     obj=self,
1027.                     id="fields.W342",
1028.                 )
1029.             ]
1030.             if self.unique
1031.             else []
1032.         )
1033. 
1034.     def deconstruct(self):
1035.         name, path, args, kwargs = super().deconstruct()
1036.         del kwargs["to_fields"]
1037.         del kwargs["from_fields"]
1038.         # Handle the simpler arguments
1039.         if self.db_index:
1040.             del kwargs["db_index"]
1041.         else:
1042.             kwargs["db_index"] = False
1043.         if self.db_constraint is not True:
1044.             kwargs["db_constraint"] = self.db_constraint
1045.         # Rel needs more work.
1046.         to_meta = getattr(self.remote_field.model, "_meta", None)
1047.         if self.remote_field.field_name and (
1048.             not to_meta
1049.             or (to_meta.pk and self.remote_field.field_name != to_meta.pk.name)
1050.         ):
1051.             kwargs["to_field"] = self.remote_field.field_name
1052.         return name, path, args, kwargs
1053. 
1054.     def to_python(self, value):
1055.         return self.target_field.to_python(value)
1056. 
1057.     @property
1058.     def target_field(self):
1059.         return self.foreign_related_fields[0]
1060. 
1061.     def validate(self, value, model_instance):
1062.         if self.remote_field.parent_link:
1063.             return
1064.         super().validate(value, model_instance)
1065.         if value is None:
1066.             return
1067. 
1068.         using = router.db_for_read(self.remote_field.model, instance=model_instance)
1069.         qs = self.remote_field.model._base_manager.using(using).filter(
1070.             **{self.remote_field.field_name: value}
1071.         )
1072.         qs = qs.complex_filter(self.get_limit_choices_to())
1073.         if not qs.exists():
1074.             raise exceptions.ValidationError(
1075.                 self.error_messages["invalid"],
1076.                 code="invalid",
1077.                 params={
1078.                     "model": self.remote_field.model._meta.verbose_name,
1079.                     "pk": value,
1080.                     "field": self.remote_field.field_name,
1081.                     "value": value,
1082.                 },  # 'pk' is included for backwards compatibility
1083.             )
1084. 
1085.     def resolve_related_fields(self):
1086.         related_fields = super().resolve_related_fields()
1087.         for from_field, to_field in related_fields:
1088.             if (
1089.                 to_field
1090.                 and to_field.model != self.remote_field.model._meta.concrete_model
1091.             ):
1092.                 raise exceptions.FieldError(
1093.                     "'%s.%s' refers to field '%s' which is not local to model "
1094.                     "'%s'."
1095.                     % (
1096.                         self.model._meta.label,
1097.                         self.name,
1098.                         to_field.name,
1099.                         self.remote_field.model._meta.concrete_model._meta.label,
1100.                     )
1101.                 )
1102.         return related_fields
1103. 
1104.     def get_attname(self):
1105.         return "%s_id" % self.name
1106. 
1107.     def get_attname_column(self):
1108.         attname = self.get_attname()
1109.         column = self.db_column or attname
1110.         return attname, column
1111. 
1112.     def get_default(self):
1113.         """Return the to_field if the default value is an object."""
1114.         field_default = super().get_default()
1115.         if isinstance(field_default, self.remote_field.model):
1116.             return getattr(field_default, self.target_field.attname)
1117.         return field_default
1118. 
1119.     def get_db_prep_save(self, value, connection):
1120.         if value is None or (
1121.             value == ""
1122.             and (
1123.                 not self.target_field.empty_strings_allowed
1124.                 or connection.features.interprets_empty_strings_as_nulls
1125.             )
1126.         ):
1127.             return None
1128.         else:
1129.             return self.target_field.get_db_prep_save(value, connection=connection)
1130. 
1131.     def get_db_prep_value(self, value, connection, prepared=False):
1132.         return self.target_field.get_db_prep_value(value, connection, prepared)
1133. 
1134.     def get_prep_value(self, value):
1135.         return self.target_field.get_prep_value(value)
1136. 
1137.     def contribute_to_related_class(self, cls, related):
1138.         super().contribute_to_related_class(cls, related)
1139.         if self.remote_field.field_name is None:
1140.             self.remote_field.field_name = cls._meta.pk.name
1141. 
1142.     def formfield(self, *, using=None, **kwargs):
1143.         if isinstance(self.remote_field.model, str):
1144.             raise ValueError(
1145.                 "Cannot create form field for %r yet, because "
1146.                 "its related model %r has not been loaded yet"
1147.                 % (self.name, self.remote_field.model)
1148.             )
1149.         return super().formfield(
1150.             **{
1151.                 "form_class": forms.ModelChoiceField,
1152.                 "queryset": self.remote_field.model._default_manager.using(using),
1153.                 "to_field_name": self.remote_field.field_name,
1154.                 **kwargs,
1155.                 "blank": self.blank,
1156.             }
1157.         )
1158. 
1159.     def db_check(self, connection):
1160.         return None
1161. 
1162.     def db_type(self, connection):
1163.         return self.target_field.rel_db_type(connection=connection)
1164. 
1165.     def cast_db_type(self, connection):
1166.         return self.target_field.cast_db_type(connection=connection)
1167. 
1168.     def db_parameters(self, connection):
1169.         target_db_parameters = self.target_field.db_parameters(connection)
1170.         return {
1171.             "type": self.db_type(connection),
1172.             "check": self.db_check(connection),
1173.             "collation": target_db_parameters.get("collation"),
1174.         }
1175. 
1176.     def convert_empty_strings(self, value, expression, connection):
1177.         if (not value) and isinstance(value, str):
1178.             return None
1179.         return value
1180. 
1181.     def get_db_converters(self, connection):
1182.         converters = super().get_db_converters(connection)
1183.         if connection.features.interprets_empty_strings_as_nulls:
1184.             converters += [self.convert_empty_strings]
1185.         return converters
1186. 
1187.     def get_col(self, alias, output_field=None):
1188.         if output_field is None:
1189.             output_field = self.target_field
1190.             while isinstance(output_field, ForeignKey):
1191.                 output_field = output_field.target_field
1192.                 if output_field is self:
1193.                     raise ValueError("Cannot resolve output_field.")
1194.         return super().get_col(alias, output_field)
1195. 
1196. 
1197. class OneToOneField(ForeignKey):
1198.     """
1199.     A OneToOneField is essentially the same as a ForeignKey, with the exception
1200.     that it always carries a "unique" constraint with it and the reverse
1201.     relation always returns the object pointed to (since there will only ever
1202.     be one), rather than returning a list.
1203.     """
1204. 
1205.     # Field flags
1206.     many_to_many = False
1207.     many_to_one = False
1208.     one_to_many = False
1209.     one_to_one = True
1210. 
1211.     related_accessor_class = ReverseOneToOneDescriptor
1212.     forward_related_accessor_class = ForwardOneToOneDescriptor
1213.     rel_class = OneToOneRel
1214. 
1215.     description = _("One-to-one relationship")
1216. 
1217.     def __init__(self, to, on_delete, to_field=None, **kwargs):
1218.         kwargs["unique"] = True
1219.         super().__init__(to, on_delete, to_field=to_field, **kwargs)
1220. 
1221.     def deconstruct(self):
1222.         name, path, args, kwargs = super().deconstruct()
1223.         if "unique" in kwargs:
1224.             del kwargs["unique"]
1225.         return name, path, args, kwargs
1226. 
1227.     def formfield(self, **kwargs):
1228.         if self.remote_field.parent_link:
1229.             return None
1230.         return super().formfield(**kwargs)
1231. 
1232.     def save_form_data(self, instance, data):
1233.         if isinstance(data, self.remote_field.model):
1234.             setattr(instance, self.name, data)
1235.         else:
1236.             setattr(instance, self.attname, data)
1237.             # Remote field object must be cleared otherwise Model.save()
1238.             # will reassign attname using the related object pk.
1239.             if data is None:
1240.                 setattr(instance, self.name, data)
1241. 
1242.     def _check_unique(self, **kwargs):
1243.         # Override ForeignKey since check isn't applicable here.
1244.         return []
1245. 
1246. 
1247. def create_many_to_many_intermediary_model(field, klass):
1248.     from django.db import models
1249. 
1250.     def set_managed(model, related, through):
1251.         through._meta.managed = model._meta.managed or related._meta.managed
1252. 
1253.     to_model = resolve_relation(klass, field.remote_field.model)
1254.     name = "%s_%s" % (klass._meta.object_name, field.name)
1255.     lazy_related_operation(set_managed, klass, to_model, name)
1256. 
1257.     to = make_model_tuple(to_model)[1]
1258.     from_ = klass._meta.model_name
1259.     if to == from_:
1260.         to = "to_%s" % to
1261.         from_ = "from_%s" % from_
1262. 
1263.     meta = type(
1264.         "Meta",
1265.         (),
1266.         {
1267.             "db_table": field._get_m2m_db_table(klass._meta),
1268.             "auto_created": klass,
1269.             "app_label": klass._meta.app_label,
1270.             "db_tablespace": klass._meta.db_tablespace,
1271.             "unique_together": (from_, to),
1272.             "verbose_name": _("%(from)s-%(to)s relationship")
1273.             % {"from": from_, "to": to},
1274.             "verbose_name_plural": _("%(from)s-%(to)s relationships")
1275.             % {"from": from_, "to": to},
1276.             "apps": field.model._meta.apps,
1277.         },
1278.     )
1279.     # Construct and return the new class.
1280.     return type(
1281.         name,
1282.         (models.Model,),
1283.         {
1284.             "Meta": meta,
1285.             "__module__": klass.__module__,
1286.             from_: models.ForeignKey(
1287.                 klass,
1288.                 related_name="%s+" % name,
1289.                 db_tablespace=field.db_tablespace,
1290.                 db_constraint=field.remote_field.db_constraint,
1291.                 on_delete=CASCADE,
1292.             ),
1293.             to: models.ForeignKey(
1294.                 to_model,
1295.                 related_name="%s+" % name,
1296.                 db_tablespace=field.db_tablespace,
1297.                 db_constraint=field.remote_field.db_constraint,
1298.                 on_delete=CASCADE,
1299.             ),
1300.         },
1301.     )
1302. 
1303. 
1304. class ManyToManyField(RelatedField):
1305.     """
1306.     Provide a many-to-many relation by using an intermediary model that
1307.     holds two ForeignKey fields pointed at the two sides of the relation.
1308. 
1309.     Unless a ``through`` model was provided, ManyToManyField will use the
1310.     create_many_to_many_intermediary_model factory to automatically generate
1311.     the intermediary model.
1312.     """
1313. 
1314.     # Field flags
1315.     many_to_many = True
1316.     many_to_one = False
1317.     one_to_many = False
1318.     one_to_one = False
1319. 
1320.     rel_class = ManyToManyRel
1321. 
1322.     description = _("Many-to-many relationship")
1323. 
1324.     def __init__(
1325.         self,
1326.         to,
1327.         related_name=None,
1328.         related_query_name=None,
1329.         limit_choices_to=None,
1330.         symmetrical=None,
1331.         through=None,
1332.         through_fields=None,
1333.         db_constraint=True,
1334.         db_table=None,
1335.         swappable=True,
1336.         **kwargs,
1337.     ):
1338.         try:
1339.             to._meta
1340.         except AttributeError:
1341.             if not isinstance(to, str):
1342.                 raise TypeError(
1343.                     "%s(%r) is invalid. First parameter to ManyToManyField "
1344.                     "must be either a model, a model name, or the string %r"
1345.                     % (
1346.                         self.__class__.__name__,
1347.                         to,
1348.                         RECURSIVE_RELATIONSHIP_CONSTANT,
1349.                     )
1350.                 )
1351. 
1352.         if symmetrical is None:
1353.             symmetrical = to == RECURSIVE_RELATIONSHIP_CONSTANT
1354. 
1355.         if through is not None and db_table is not None:
1356.             raise ValueError(
1357.                 "Cannot specify a db_table if an intermediary model is used."
1358.             )
1359. 
1360.         kwargs["rel"] = self.rel_class(
1361.             self,
1362.             to,
1363.             related_name=related_name,
1364.             related_query_name=related_query_name,
1365.             limit_choices_to=limit_choices_to,
1366.             symmetrical=symmetrical,
1367.             through=through,
1368.             through_fields=through_fields,
1369.             db_constraint=db_constraint,
1370.         )
1371.         self.has_null_arg = "null" in kwargs
1372. 
1373.         super().__init__(
1374.             related_name=related_name,
1375.             related_query_name=related_query_name,
1376.             limit_choices_to=limit_choices_to,
1377.             **kwargs,
1378.         )
1379. 
1380.         self.db_table = db_table
1381.         self.swappable = swappable
1382. 
1383.     def check(self, **kwargs):
1384.         return [
1385.             *super().check(**kwargs),
1386.             *self._check_unique(**kwargs),
1387.             *self._check_relationship_model(**kwargs),
1388.             *self._check_ignored_options(**kwargs),
1389.             *self._check_table_uniqueness(**kwargs),
1390.         ]
1391. 
1392.     def _check_unique(self, **kwargs):
1393.         if self.unique:
1394.             return [
1395.                 checks.Error(
1396.                     "ManyToManyFields cannot be unique.",
1397.                     obj=self,
1398.                     id="fields.E330",
1399.                 )
1400.             ]
1401.         return []
1402. 
1403.     def _check_ignored_options(self, **kwargs):
1404.         warnings = []
1405. 
1406.         if self.has_null_arg:
1407.             warnings.append(
1408.                 checks.Warning(
1409.                     "null has no effect on ManyToManyField.",
1410.                     obj=self,
1411.                     id="fields.W340",
1412.                 )
1413.             )
1414. 
1415.         if self._validators:
1416.             warnings.append(
1417.                 checks.Warning(
1418.                     "ManyToManyField does not support validators.",
1419.                     obj=self,
1420.                     id="fields.W341",
1421.                 )
1422.             )
1423.         if self.remote_field.symmetrical and self._related_name:
1424.             warnings.append(
1425.                 checks.Warning(
1426.                     "related_name has no effect on ManyToManyField "
1427.                     'with a symmetrical relationship, e.g. to "self".',
1428.                     obj=self,
1429.                     id="fields.W345",
1430.                 )
1431.             )
1432.         if self.db_comment:
1433.             warnings.append(
1434.                 checks.Warning(
1435.                     "db_comment has no effect on ManyToManyField.",
1436.                     obj=self,
1437.                     id="fields.W346",
1438.                 )
1439.             )
1440. 
1441.         return warnings
1442. 
1443.     def _check_relationship_model(self, from_model=None, **kwargs):
1444.         if hasattr(self.remote_field.through, "_meta"):
1445.             qualified_model_name = "%s.%s" % (
1446.                 self.remote_field.through._meta.app_label,
1447.                 self.remote_field.through.__name__,
1448.             )
1449.         else:
1450.             qualified_model_name = self.remote_field.through
1451. 
1452.         errors = []
1453. 
1454.         if self.remote_field.through not in self.opts.apps.get_models(
1455.             include_auto_created=True
1456.         ):
1457.             # The relationship model is not installed.
1458.             errors.append(
1459.                 checks.Error(
1460.                     "Field specifies a many-to-many relation through model "
1461.                     "'%s', which has not been installed." % qualified_model_name,
1462.                     obj=self,
1463.                     id="fields.E331",
1464.                 )
1465.             )
1466. 
1467.         else:
1468.             assert from_model is not None, (
1469.                 "ManyToManyField with intermediate "
1470.                 "tables cannot be checked if you don't pass the model "
1471.                 "where the field is attached to."
1472.             )
1473.             # Set some useful local variables
1474.             to_model = resolve_relation(from_model, self.remote_field.model)
1475.             from_model_name = from_model._meta.object_name
1476.             if isinstance(to_model, str):
1477.                 to_model_name = to_model
1478.             else:
1479.                 to_model_name = to_model._meta.object_name
1480.             relationship_model_name = self.remote_field.through._meta.object_name
1481.             self_referential = from_model == to_model
1482.             # Count foreign keys in intermediate model
1483.             if self_referential:
1484.                 seen_self = sum(
1485.                     from_model == getattr(field.remote_field, "model", None)
1486.                     for field in self.remote_field.through._meta.fields
1487.                 )
1488. 
1489.                 if seen_self > 2 and not self.remote_field.through_fields:
1490.                     errors.append(
1491.                         checks.Error(
1492.                             "The model is used as an intermediate model by "
1493.                             "'%s', but it has more than two foreign keys "
1494.                             "to '%s', which is ambiguous. You must specify "
1495.                             "which two foreign keys Django should use via the "
1496.                             "through_fields keyword argument."
1497.                             % (self, from_model_name),
1498.                             hint=(
1499.                                 "Use through_fields to specify which two foreign keys "
1500.                                 "Django should use."
1501.                             ),
1502.                             obj=self.remote_field.through,
1503.                             id="fields.E333",
1504.                         )
1505.                     )
1506. 
1507.             else:
1508.                 # Count foreign keys in relationship model
1509.                 seen_from = sum(
1510.                     from_model == getattr(field.remote_field, "model", None)
1511.                     for field in self.remote_field.through._meta.fields
1512.                 )
1513.                 seen_to = sum(
1514.                     to_model == getattr(field.remote_field, "model", None)
1515.                     for field in self.remote_field.through._meta.fields
1516.                 )
1517. 
1518.                 if seen_from > 1 and not self.remote_field.through_fields:
1519.                     errors.append(
1520.                         checks.Error(
1521.                             (
1522.                                 "The model is used as an intermediate model by "
1523.                                 "'%s', but it has more than one foreign key "
1524.                                 "from '%s', which is ambiguous. You must specify "
1525.                                 "which foreign key Django should use via the "
1526.                                 "through_fields keyword argument."
1527.                             )
1528.                             % (self, from_model_name),
1529.                             hint=(
1530.                                 "If you want to create a recursive relationship, "
1531.                                 'use ManyToManyField("%s", through="%s").'
1532.                             )
1533.                             % (
1534.                                 RECURSIVE_RELATIONSHIP_CONSTANT,
1535.                                 relationship_model_name,
1536.                             ),
1537.                             obj=self,
1538.                             id="fields.E334",
1539.                         )
1540.                     )
1541. 
1542.                 if seen_to > 1 and not self.remote_field.through_fields:
1543.                     errors.append(
1544.                         checks.Error(
1545.                             "The model is used as an intermediate model by "
1546.                             "'%s', but it has more than one foreign key "
1547.                             "to '%s', which is ambiguous. You must specify "
1548.                             "which foreign key Django should use via the "
1549.                             "through_fields keyword argument." % (self, to_model_name),
1550.                             hint=(
1551.                                 "If you want to create a recursive relationship, "
1552.                                 'use ManyToManyField("%s", through="%s").'
1553.                             )
1554.                             % (
1555.                                 RECURSIVE_RELATIONSHIP_CONSTANT,
1556.                                 relationship_model_name,
1557.                             ),
1558.                             obj=self,
1559.                             id="fields.E335",
1560.                         )
1561.                     )
1562. 
1563.                 if seen_from == 0 or seen_to == 0:
1564.                     errors.append(
1565.                         checks.Error(
1566.                             "The model is used as an intermediate model by "
1567.                             "'%s', but it does not have a foreign key to '%s' or '%s'."
1568.                             % (self, from_model_name, to_model_name),
1569.                             obj=self.remote_field.through,
1570.                             id="fields.E336",
1571.                         )
1572.                     )
1573. 
1574.         # Validate `through_fields`.
1575.         if self.remote_field.through_fields is not None:
1576.             # Validate that we're given an iterable of at least two items
1577.             # and that none of them is "falsy".
1578.             if not (
1579.                 len(self.remote_field.through_fields) >= 2
1580.                 and self.remote_field.through_fields[0]
1581.                 and self.remote_field.through_fields[1]
1582.             ):
1583.                 errors.append(
1584.                     checks.Error(
1585.                         "Field specifies 'through_fields' but does not provide "
1586.                         "the names of the two link fields that should be used "
1587.                         "for the relation through model '%s'." % qualified_model_name,
1588.                         hint=(
1589.                             "Make sure you specify 'through_fields' as "
1590.                             "through_fields=('field1', 'field2')"
1591.                         ),
1592.                         obj=self,
1593.                         id="fields.E337",
1594.                     )
1595.                 )
1596. 
1597.             # Validate the given through fields -- they should be actual
1598.             # fields on the through model, and also be foreign keys to the
1599.             # expected models.
1600.             else:
1601.                 assert from_model is not None, (
1602.                     "ManyToManyField with intermediate "
1603.                     "tables cannot be checked if you don't pass the model "
1604.                     "where the field is attached to."
1605.                 )
1606. 
1607.                 source, through, target = (
1608.                     from_model,
1609.                     self.remote_field.through,
1610.                     self.remote_field.model,
1611.                 )
1612.                 source_field_name, target_field_name = self.remote_field.through_fields[
1613.                     :2
1614.                 ]
1615. 
1616.                 for field_name, related_model in (
1617.                     (source_field_name, source),
1618.                     (target_field_name, target),
1619.                 ):
1620.                     possible_field_names = []
1621.                     for f in through._meta.fields:
1622.                         if (
1623.                             hasattr(f, "remote_field")
1624.                             and getattr(f.remote_field, "model", None) == related_model
1625.                         ):
1626.                             possible_field_names.append(f.name)
1627.                     if possible_field_names:
1628.                         hint = (
1629.                             "Did you mean one of the following foreign keys to '%s': "
1630.                             "%s?"
1631.                             % (
1632.                                 related_model._meta.object_name,
1633.                                 ", ".join(possible_field_names),
1634.                             )
1635.                         )
1636.                     else:
1637.                         hint = None
1638. 
1639.                     try:
1640.                         field = through._meta.get_field(field_name)
1641.                     except exceptions.FieldDoesNotExist:
1642.                         errors.append(
1643.                             checks.Error(
1644.                                 "The intermediary model '%s' has no field '%s'."
1645.                                 % (qualified_model_name, field_name),
1646.                                 hint=hint,
1647.                                 obj=self,
1648.                                 id="fields.E338",
1649.                             )
1650.                         )
1651.                     else:
1652.                         if not (
1653.                             hasattr(field, "remote_field")
1654.                             and getattr(field.remote_field, "model", None)
1655.                             == related_model
1656.                         ):
1657.                             errors.append(
1658.                                 checks.Error(
1659.                                     "'%s.%s' is not a foreign key to '%s'."
1660.                                     % (
1661.                                         through._meta.object_name,
1662.                                         field_name,
1663.                                         related_model._meta.object_name,
1664.                                     ),
1665.                                     hint=hint,
1666.                                     obj=self,
1667.                                     id="fields.E339",
1668.                                 )
1669.                             )
1670. 
1671.         return errors
1672. 
1673.     def _check_table_uniqueness(self, **kwargs):
1674.         if (
1675.             isinstance(self.remote_field.through, str)
1676.             or not self.remote_field.through._meta.managed
1677.         ):
1678.             return []
1679.         registered_tables = {
1680.             model._meta.db_table: model
1681.             for model in self.opts.apps.get_models(include_auto_created=True)
1682.             if model != self.remote_field.through and model._meta.managed
1683.         }
1684.         m2m_db_table = self.m2m_db_table()
1685.         model = registered_tables.get(m2m_db_table)
1686.         # The second condition allows multiple m2m relations on a model if
1687.         # some point to a through model that proxies another through model.
1688.         if (
1689.             model
1690.             and model._meta.concrete_model
1691.             != self.remote_field.through._meta.concrete_model
1692.         ):
1693.             if model._meta.auto_created:
1694. 
1695.                 def _get_field_name(model):
1696.                     for field in model._meta.auto_created._meta.many_to_many:
1697.                         if field.remote_field.through is model:
1698.                             return field.name
1699. 
1700.                 opts = model._meta.auto_created._meta
1701.                 clashing_obj = "%s.%s" % (opts.label, _get_field_name(model))
1702.             else:
1703.                 clashing_obj = model._meta.label
1704.             if settings.DATABASE_ROUTERS:
1705.                 error_class, error_id = checks.Warning, "fields.W344"
1706.                 error_hint = (
1707.                     "You have configured settings.DATABASE_ROUTERS. Verify "
1708.                     "that the table of %r is correctly routed to a separate "
1709.                     "database." % clashing_obj
1710.                 )
1711.             else:
1712.                 error_class, error_id = checks.Error, "fields.E340"
1713.                 error_hint = None
1714.             return [
1715.                 error_class(
1716.                     "The field's intermediary table '%s' clashes with the "
1717.                     "table name of '%s'." % (m2m_db_table, clashing_obj),
1718.                     obj=self,
1719.                     hint=error_hint,
1720.                     id=error_id,
1721.                 )
1722.             ]
1723.         return []
1724. 
1725.     def deconstruct(self):
1726.         name, path, args, kwargs = super().deconstruct()
1727.         # Handle the simpler arguments.
1728.         if self.db_table is not None:
1729.             kwargs["db_table"] = self.db_table
1730.         if self.remote_field.db_constraint is not True:
1731.             kwargs["db_constraint"] = self.remote_field.db_constraint
1732.         # Lowercase model names as they should be treated as case-insensitive.
1733.         if isinstance(self.remote_field.model, str):
1734.             if "." in self.remote_field.model:
1735.                 app_label, model_name = self.remote_field.model.split(".")
1736.                 kwargs["to"] = "%s.%s" % (app_label, model_name.lower())
1737.             else:
1738.                 kwargs["to"] = self.remote_field.model.lower()
1739.         else:
1740.             kwargs["to"] = self.remote_field.model._meta.label_lower
1741.         if getattr(self.remote_field, "through", None) is not None:
1742.             if isinstance(self.remote_field.through, str):
1743.                 kwargs["through"] = self.remote_field.through
1744.             elif not self.remote_field.through._meta.auto_created:
1745.                 kwargs["through"] = self.remote_field.through._meta.label
1746.         # If swappable is True, then see if we're actually pointing to the target
1747.         # of a swap.
1748.         swappable_setting = self.swappable_setting
1749.         if swappable_setting is not None:
1750.             # If it's already a settings reference, error.
1751.             if hasattr(kwargs["to"], "setting_name"):
1752.                 if kwargs["to"].setting_name != swappable_setting:
1753.                     raise ValueError(
1754.                         "Cannot deconstruct a ManyToManyField pointing to a "
1755.                         "model that is swapped in place of more than one model "
1756.                         "(%s and %s)" % (kwargs["to"].setting_name, swappable_setting)
1757.                     )
1758. 
1759.             kwargs["to"] = SettingsReference(
1760.                 kwargs["to"],
1761.                 swappable_setting,
1762.             )
1763.         return name, path, args, kwargs
1764. 
1765.     def _get_path_info(self, direct=False, filtered_relation=None):
1766.         """Called by both direct and indirect m2m traversal."""
1767.         int_model = self.remote_field.through
1768.         linkfield1 = int_model._meta.get_field(self.m2m_field_name())
1769.         linkfield2 = int_model._meta.get_field(self.m2m_reverse_field_name())
1770.         if direct:
1771.             join1infos = linkfield1.reverse_path_infos
1772.             if filtered_relation:
1773.                 join2infos = linkfield2.get_path_info(filtered_relation)
1774.             else:
1775.                 join2infos = linkfield2.path_infos
1776.         else:
1777.             join1infos = linkfield2.reverse_path_infos
1778.             if filtered_relation:
1779.                 join2infos = linkfield1.get_path_info(filtered_relation)
1780.             else:
1781.                 join2infos = linkfield1.path_infos
1782.         # Get join infos between the last model of join 1 and the first model
1783.         # of join 2. Assume the only reason these may differ is due to model
1784.         # inheritance.
1785.         join1_final = join1infos[-1].to_opts
1786.         join2_initial = join2infos[0].from_opts
1787.         if join1_final is join2_initial:
1788.             intermediate_infos = []
1789.         elif issubclass(join1_final.model, join2_initial.model):
1790.             intermediate_infos = join1_final.get_path_to_parent(join2_initial.model)
1791.         else:
1792.             intermediate_infos = join2_initial.get_path_from_parent(join1_final.model)
1793. 
1794.         return [*join1infos, *intermediate_infos, *join2infos]
1795. 
1796.     def get_path_info(self, filtered_relation=None):
1797.         return self._get_path_info(direct=True, filtered_relation=filtered_relation)
1798. 
1799.     @cached_property
1800.     def path_infos(self):
1801.         return self.get_path_info()
1802. 
1803.     def get_reverse_path_info(self, filtered_relation=None):
1804.         return self._get_path_info(direct=False, filtered_relation=filtered_relation)
1805. 
1806.     @cached_property
1807.     def reverse_path_infos(self):
1808.         return self.get_reverse_path_info()
1809. 
1810.     def _get_m2m_db_table(self, opts):
1811.         """
1812.         Function that can be curried to provide the m2m table name for this
1813.         relation.
1814.         """
1815.         if self.remote_field.through is not None:
1816.             return self.remote_field.through._meta.db_table
1817.         elif self.db_table:
1818.             return self.db_table
1819.         else:
1820.             m2m_table_name = "%s_%s" % (utils.strip_quotes(opts.db_table), self.name)
1821.             return utils.truncate_name(m2m_table_name, connection.ops.max_name_length())
1822. 
1823.     def _get_m2m_attr(self, related, attr):
1824.         """
1825.         Function that can be curried to provide the source accessor or DB
1826.         column name for the m2m table.
1827.         """
1828.         cache_attr = "_m2m_%s_cache" % attr
1829.         if hasattr(self, cache_attr):
1830.             return getattr(self, cache_attr)
1831.         if self.remote_field.through_fields is not None:
1832.             link_field_name = self.remote_field.through_fields[0]
1833.         else:
1834.             link_field_name = None
1835.         for f in self.remote_field.through._meta.fields:
1836.             if (
1837.                 f.is_relation
1838.                 and f.remote_field.model == related.related_model
1839.                 and (link_field_name is None or link_field_name == f.name)
1840.             ):
1841.                 setattr(self, cache_attr, getattr(f, attr))
1842.                 return getattr(self, cache_attr)
1843. 
1844.     def _get_m2m_reverse_attr(self, related, attr):
1845.         """
1846.         Function that can be curried to provide the related accessor or DB
1847.         column name for the m2m table.
1848.         """
1849.         cache_attr = "_m2m_reverse_%s_cache" % attr
1850.         if hasattr(self, cache_attr):
1851.             return getattr(self, cache_attr)
1852.         found = False
1853.         if self.remote_field.through_fields is not None:
1854.             link_field_name = self.remote_field.through_fields[1]
1855.         else:
1856.             link_field_name = None
1857.         for f in self.remote_field.through._meta.fields:
1858.             if f.is_relation and f.remote_field.model == related.model:
1859.                 if link_field_name is None and related.related_model == related.model:
1860.                     # If this is an m2m-intermediate to self,
1861.                     # the first foreign key you find will be
1862.                     # the source column. Keep searching for
1863.                     # the second foreign key.
1864.                     if found:
1865.                         setattr(self, cache_attr, getattr(f, attr))
1866.                         break
1867.                     else:
1868.                         found = True
1869.                 elif link_field_name is None or link_field_name == f.name:
1870.                     setattr(self, cache_attr, getattr(f, attr))
1871.                     break
1872.         return getattr(self, cache_attr)
1873. 
1874.     def contribute_to_class(self, cls, name, **kwargs):
1875.         # To support multiple relations to self, it's useful to have a non-None
1876.         # related name on symmetrical relations for internal reasons. The
1877.         # concept doesn't make a lot of sense externally ("you want me to
1878.         # specify *what* on my non-reversible relation?!"), so we set it up
1879.         # automatically. The funky name reduces the chance of an accidental
1880.         # clash.
1881.         if self.remote_field.symmetrical and (
1882.             self.remote_field.model == RECURSIVE_RELATIONSHIP_CONSTANT
1883.             or self.remote_field.model == cls._meta.object_name
1884.         ):
1885.             self.remote_field.related_name = "%s_rel_+" % name
1886.         elif self.remote_field.is_hidden():
1887.             # If the backwards relation is disabled, replace the original
1888.             # related_name with one generated from the m2m field name. Django
1889.             # still uses backwards relations internally and we need to avoid
1890.             # clashes between multiple m2m fields with related_name == '+'.
1891.             self.remote_field.related_name = "_%s_%s_%s_+" % (
1892.                 cls._meta.app_label,
1893.                 cls.__name__.lower(),
1894.                 name,
1895.             )
1896. 
1897.         super().contribute_to_class(cls, name, **kwargs)
1898. 
1899.         # The intermediate m2m model is not auto created if:
1900.         #  1) There is a manually specified intermediate, or
1901.         #  2) The class owning the m2m field is abstract.
1902.         #  3) The class owning the m2m field has been swapped out.
1903.         if not cls._meta.abstract:
1904.             if self.remote_field.through:
1905. 
1906.                 def resolve_through_model(_, model, field):
1907.                     field.remote_field.through = model
1908. 
1909.                 lazy_related_operation(
1910.                     resolve_through_model, cls, self.remote_field.through, field=self
1911.                 )
1912.             elif not cls._meta.swapped:
1913.                 self.remote_field.through = create_many_to_many_intermediary_model(
1914.                     self, cls
1915.                 )
1916. 
1917.         # Add the descriptor for the m2m relation.
1918.         setattr(cls, self.name, ManyToManyDescriptor(self.remote_field, reverse=False))
1919. 
1920.         # Set up the accessor for the m2m table name for the relation.
1921.         self.m2m_db_table = partial(self._get_m2m_db_table, cls._meta)
1922. 
1923.     def contribute_to_related_class(self, cls, related):
1924.         # Internal M2Ms (i.e., those with a related name ending with '+')
1925.         # and swapped models don't get a related descriptor.
1926.         if (
1927.             not self.remote_field.is_hidden()
1928.             and not related.related_model._meta.swapped
1929.         ):
1930.             setattr(
1931.                 cls,
1932.                 related.get_accessor_name(),
1933.                 ManyToManyDescriptor(self.remote_field, reverse=True),
1934.             )
1935. 
1936.         # Set up the accessors for the column names on the m2m table.
1937.         self.m2m_column_name = partial(self._get_m2m_attr, related, "column")
1938.         self.m2m_reverse_name = partial(self._get_m2m_reverse_attr, related, "column")
1939. 
1940.         self.m2m_field_name = partial(self._get_m2m_attr, related, "name")
1941.         self.m2m_reverse_field_name = partial(
1942.             self._get_m2m_reverse_attr, related, "name"
1943.         )
1944. 
1945.         get_m2m_rel = partial(self._get_m2m_attr, related, "remote_field")
1946.         self.m2m_target_field_name = lambda: get_m2m_rel().field_name
1947.         get_m2m_reverse_rel = partial(
1948.             self._get_m2m_reverse_attr, related, "remote_field"
1949.         )
1950.         self.m2m_reverse_target_field_name = lambda: get_m2m_reverse_rel().field_name
1951. 
1952.     def set_attributes_from_rel(self):
1953.         pass
1954. 
1955.     def value_from_object(self, obj):
1956.         return [] if obj.pk is None else list(getattr(obj, self.attname).all())
1957. 
1958.     def save_form_data(self, instance, data):
1959.         getattr(instance, self.attname).set(data)
1960. 
1961.     def formfield(self, *, using=None, **kwargs):
1962.         defaults = {
1963.             "form_class": forms.ModelMultipleChoiceField,
1964.             "queryset": self.remote_field.model._default_manager.using(using),
1965.             **kwargs,
1966.         }
1967.         # If initial is passed in, it's a list of related objects, but the
1968.         # MultipleChoiceField takes a list of IDs.
1969.         if defaults.get("initial") is not None:
1970.             initial = defaults["initial"]
1971.             if callable(initial):
1972.                 initial = initial()
1973.             defaults["initial"] = [i.pk for i in initial]
1974.         return super().formfield(**defaults)
1975. 
1976.     def db_check(self, connection):
1977.         return None
1978. 
1979.     def db_type(self, connection):
1980.         # A ManyToManyField is not represented by a single column,
1981.         # so return None.
1982.         return None
1983. 
1984.     def db_parameters(self, connection):
1985.         return {"type": None, "check": None}

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-24 05:49:20,552 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to fix a bug in `ModelAdmin.lookup_allowed`. The provided patch relies on the `is_relation` attribute of a model field. To fully understand this attribute and its behavior, I need the definition of the base `Field` class, which is located in `django/db/models/fields/__init__.py`. The previously requested files, `options.py` and `related.py`, provide context for the `ModelAdmin` and relational fields, but not the base field definition itself.' query='Please provide the full content of the file django/db/models/fields/__init__.py.' extra_requirements='' purpose='This file contains the base `Field` class, which will clarify the `is_relation` attribute used in the patch and provide a complete picture of the field-related logic.'
2025-12-24 05:49:20,553 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of the file django/db/models/fields/__init__.py.
2025-12-24 05:49:20,553 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-24 05:49:20,554 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-24 05:49:20,554 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-24 05:49:20,554 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of the file django/db/models/fields/__init__.py.
Purpose: This file contains the base `Field` class, which will clarify the `is_relation` attribute used in the patch and provide a complete picture of the field-related logic.
2025-12-24 05:49:23,521 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the full content of the specified file, which contains the base `Field` class. This will help clarify the `is_relation` attribute and provide a complete picture of the field-related logic.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "django/db/models/fields/__init__.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2116, 'candidates_token_count': 68, 'total_token_count': 2332, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2116}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 68}], 'thoughts_token_count': 148, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.23479817895328298, 'model_name': 'gemini-2.5-pro'} id='run--18bfa57a-dec3-4698-9b00-0965cfd7de01-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'django/db/models/fields/__init__.py'}, 'id': '37cdaa66-671d-44df-9923-2489c938ea9d', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2116, 'output_tokens': 68, 'total_tokens': 2332, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 148}}
2025-12-24 05:49:25,774 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have read the first 500 lines of the requested file and will now retrieve the remaining content to provide the complete file.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 501.0, "relative_path": "django/db/models/fields/__init__.py", "end_line": 1500.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 8635, 'candidates_token_count': 58, 'total_token_count': 8780, 'cached_content_token_count': 1829, 'prompt_tokens_details': [{'modality': 1, 'token_count': 8635}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1829}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 58}], 'thoughts_token_count': 87}, 'finish_reason': 'STOP', 'avg_logprobs': -0.17452215326243434, 'model_name': 'gemini-2.5-pro'} id='run--d45bf218-a8d7-4fff-aa44-b28d63cf7ae2-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 501.0, 'relative_path': 'django/db/models/fields/__init__.py', 'end_line': 1500.0}, 'id': '3fd94070-999b-4e85-9980-d6bda77bf2cf', 'type': 'tool_call'}] usage_metadata={'input_tokens': 8635, 'output_tokens': 58, 'total_tokens': 8780, 'input_token_details': {'cache_read': 1829}, 'output_token_details': {'reasoning': 87}}
2025-12-24 05:49:30,682 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have now retrieved the entire content of the file `django/db/models/fields/__init__.py`. This file provides the fundamental `Field` class and other field-related logic, which will be instrumental in understanding the `is_relation` attribute and the overall context of the patch.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 1501.0, "relative_path": "django/db/models/fields/__init__.py", "end_line": 2500.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 23092, 'candidates_token_count': 91, 'total_token_count': 23421, 'cached_content_token_count': 7686, 'prompt_tokens_details': [{'modality': 1, 'token_count': 23092}], 'cache_tokens_details': [{'modality': 1, 'token_count': 7686}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 91}], 'thoughts_token_count': 238}, 'finish_reason': 'STOP', 'avg_logprobs': -0.37883544754195997, 'model_name': 'gemini-2.5-pro'} id='run--3be42bdb-951f-4fa2-8def-0c3399c892a9-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 1501.0, 'relative_path': 'django/db/models/fields/__init__.py', 'end_line': 2500.0}, 'id': '7b64aea1-711e-43fb-972d-77977e294765', 'type': 'tool_call'}] usage_metadata={'input_tokens': 23092, 'output_tokens': 91, 'total_tokens': 23421, 'input_token_details': {'cache_read': 7686}, 'output_token_details': {'reasoning': 238}}
2025-12-24 05:49:36,624 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have now retrieved the entire content of the file `django/db/models/fields/__init__.py`. This file provides the fundamental `Field` class and other field-related logic, which will be instrumental in understanding the `is_relation` attribute and the overall context of the patch.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 2501.0, "relative_path": "django/db/models/fields/__init__.py", "end_line": 3501.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 36892, 'candidates_token_count': 91, 'total_token_count': 37400, 'cached_content_token_count': 23335, 'prompt_tokens_details': [{'modality': 1, 'token_count': 36892}], 'cache_tokens_details': [{'modality': 1, 'token_count': 23335}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 91}], 'thoughts_token_count': 417}, 'finish_reason': 'STOP', 'avg_logprobs': -0.7317620581322974, 'model_name': 'gemini-2.5-pro'} id='run--3156dbd5-7657-44d5-a4db-1bfbdb9c7729-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 2501.0, 'relative_path': 'django/db/models/fields/__init__.py', 'end_line': 3501.0}, 'id': 'b1de05d7-8baa-4884-8542-bac67b382735', 'type': 'tool_call'}] usage_metadata={'input_tokens': 36892, 'output_tokens': 91, 'total_tokens': 37400, 'input_token_details': {'cache_read': 23335}, 'output_token_details': {'reasoning': 417}}
2025-12-24 05:49:42,432 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have successfully retrieved the entire content of the file `django/db/models/fields/__init__.py`. This was done by reading the file in chunks to ensure all data was captured. The retrieved content, which includes the base `Field` class, will be crucial for understanding the `is_relation` attribute and the overall field-related logic in the Django framework.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 41406, 'candidates_token_count': 76, 'total_token_count': 41940, 'cached_content_token_count': 35045, 'prompt_tokens_details': [{'modality': 1, 'token_count': 41406}], 'cache_tokens_details': [{'modality': 1, 'token_count': 35045}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 76}], 'thoughts_token_count': 458}, 'finish_reason': 'STOP', 'avg_logprobs': -0.5312716333489669, 'model_name': 'gemini-2.5-pro'} id='run--1149e6da-ca94-4318-8bc0-4640b535d3dc-0' usage_metadata={'input_tokens': 41406, 'output_tokens': 76, 'total_tokens': 41940, 'input_token_details': {'cache_read': 35045}, 'output_token_details': {'reasoning': 458}}
2025-12-24 05:49:42,435 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of the file django/db/models/fields/__init__.py.
--- END QUERY ---



--- BEGIN PURPOSE ---
This file contains the base `Field` class, which will clarify the `is_relation` attribute used in the patch and provide a complete picture of the field-related logic.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: django/db/models/fields/__init__.py
Line number range: 1 - 500
Content:
1. import collections.abc
2. import copy
3. import datetime
4. import decimal
5. import operator
6. import uuid
7. import warnings
8. from base64 import b64decode, b64encode
9. from functools import partialmethod, total_ordering
10. 
11. from django import forms
12. from django.apps import apps
13. from django.conf import settings
14. from django.core import checks, exceptions, validators
15. from django.db import connection, connections, router
16. from django.db.models.constants import LOOKUP_SEP
17. from django.db.models.enums import ChoicesMeta
18. from django.db.models.query_utils import DeferredAttribute, RegisterLookupMixin
19. from django.utils import timezone
20. from django.utils.datastructures import DictWrapper
21. from django.utils.dateparse import (
22.     parse_date,
23.     parse_datetime,
24.     parse_duration,
25.     parse_time,
26. )
27. from django.utils.duration import duration_microseconds, duration_string
28. from django.utils.functional import Promise, cached_property
29. from django.utils.ipv6 import clean_ipv6_address
30. from django.utils.itercompat import is_iterable
31. from django.utils.text import capfirst
32. from django.utils.translation import gettext_lazy as _
33. 
34. __all__ = [
35.     "AutoField",
36.     "BLANK_CHOICE_DASH",
37.     "BigAutoField",
38.     "BigIntegerField",
39.     "BinaryField",
40.     "BooleanField",
41.     "CharField",
42.     "CommaSeparatedIntegerField",
43.     "DateField",
44.     "DateTimeField",
45.     "DecimalField",
46.     "DurationField",
47.     "EmailField",
48.     "Empty",
49.     "Field",
50.     "FilePathField",
51.     "FloatField",
52.     "GenericIPAddressField",
53.     "IPAddressField",
54.     "IntegerField",
55.     "NOT_PROVIDED",
56.     "NullBooleanField",
57.     "PositiveBigIntegerField",
58.     "PositiveIntegerField",
59.     "PositiveSmallIntegerField",
60.     "SlugField",
61.     "SmallAutoField",
62.     "SmallIntegerField",
63.     "TextField",
64.     "TimeField",
65.     "URLField",
66.     "UUIDField",
67. ]
68. 
69. 
70. class Empty:
71.     pass
72. 
73. 
74. class NOT_PROVIDED:
75.     pass
76. 
77. 
78. # The values to use for "blank" in SelectFields. Will be appended to the start
79. # of most "choices" lists.
80. BLANK_CHOICE_DASH = [("", "---------")]
81. 
82. 
83. def _load_field(app_label, model_name, field_name):
84.     return apps.get_model(app_label, model_name)._meta.get_field(field_name)
85. 
86. 
87. # A guide to Field parameters:
88. #
89. #   * name:      The name of the field specified in the model.
90. #   * attname:   The attribute to use on the model object. This is the same as
91. #                "name", except in the case of ForeignKeys, where "_id" is
92. #                appended.
93. #   * db_column: The db_column specified in the model (or None).
94. #   * column:    The database column for this field. This is the same as
95. #                "attname", except if db_column is specified.
96. #
97. # Code that introspects values, or does other dynamic things, should use
98. # attname. For example, this gets the primary key value of object "obj":
99. #
100. #     getattr(obj, opts.pk.attname)
101. 
102. 
103. def _empty(of_cls):
104.     new = Empty()
105.     new.__class__ = of_cls
106.     return new
107. 
108. 
109. def return_None():
110.     return None
111. 
112. 
113. @total_ordering
114. class Field(RegisterLookupMixin):
115.     """Base class for all field types"""
116. 
117.     # Designates whether empty strings fundamentally are allowed at the
118.     # database level.
119.     empty_strings_allowed = True
120.     empty_values = list(validators.EMPTY_VALUES)
121. 
122.     # These track each time a Field instance is created. Used to retain order.
123.     # The auto_creation_counter is used for fields that Django implicitly
124.     # creates, creation_counter is used for all user-specified fields.
125.     creation_counter = 0
126.     auto_creation_counter = -1
127.     default_validators = []  # Default set of validators
128.     default_error_messages = {
129.         "invalid_choice": _("Value %(value)r is not a valid choice."),
130.         "null": _("This field cannot be null."),
131.         "blank": _("This field cannot be blank."),
132.         "unique": _("%(model_name)s with this %(field_label)s already exists."),
133.         "unique_for_date": _(
134.             # Translators: The 'lookup_type' is one of 'date', 'year' or
135.             # 'month'. Eg: "Title must be unique for pub_date year"
136.             "%(field_label)s must be unique for "
137.             "%(date_field_label)s %(lookup_type)s."
138.         ),
139.     }
140.     system_check_deprecated_details = None
141.     system_check_removed_details = None
142. 
143.     # Attributes that don't affect a column definition.
144.     # These attributes are ignored when altering the field.
145.     non_db_attrs = (
146.         "blank",
147.         "choices",
148.         "db_column",
149.         "editable",
150.         "error_messages",
151.         "help_text",
152.         "limit_choices_to",
153.         # Database-level options are not supported, see #21961.
154.         "on_delete",
155.         "related_name",
156.         "related_query_name",
157.         "validators",
158.         "verbose_name",
159.     )
160. 
161.     # Field flags
162.     hidden = False
163. 
164.     many_to_many = None
165.     many_to_one = None
166.     one_to_many = None
167.     one_to_one = None
168.     related_model = None
169. 
170.     descriptor_class = DeferredAttribute
171. 
172.     # Generic field type description, usually overridden by subclasses
173.     def _description(self):
174.         return _("Field of type: %(field_type)s") % {
175.             "field_type": self.__class__.__name__
176.         }
177. 
178.     description = property(_description)
179. 
180.     def __init__(
181.         self,
182.         verbose_name=None,
183.         name=None,
184.         primary_key=False,
185.         max_length=None,
186.         unique=False,
187.         blank=False,
188.         null=False,
189.         db_index=False,
190.         rel=None,
191.         default=NOT_PROVIDED,
192.         editable=True,
193.         serialize=True,
194.         unique_for_date=None,
195.         unique_for_month=None,
196.         unique_for_year=None,
197.         choices=None,
198.         help_text="",
199.         db_column=None,
200.         db_tablespace=None,
201.         auto_created=False,
202.         validators=(),
203.         error_messages=None,
204.         db_comment=None,
205.     ):
206.         self.name = name
207.         self.verbose_name = verbose_name  # May be set by set_attributes_from_name
208.         self._verbose_name = verbose_name  # Store original for deconstruction
209.         self.primary_key = primary_key
210.         self.max_length, self._unique = max_length, unique
211.         self.blank, self.null = blank, null
212.         self.remote_field = rel
213.         self.is_relation = self.remote_field is not None
214.         self.default = default
215.         self.editable = editable
216.         self.serialize = serialize
217.         self.unique_for_date = unique_for_date
218.         self.unique_for_month = unique_for_month
219.         self.unique_for_year = unique_for_year
220.         if isinstance(choices, ChoicesMeta):
221.             choices = choices.choices
222.         if isinstance(choices, collections.abc.Iterator):
223.             choices = list(choices)
224.         self.choices = choices
225.         self.help_text = help_text
226.         self.db_index = db_index
227.         self.db_column = db_column
228.         self.db_comment = db_comment
229.         self._db_tablespace = db_tablespace
230.         self.auto_created = auto_created
231. 
232.         # Adjust the appropriate creation counter, and save our local copy.
233.         if auto_created:
234.             self.creation_counter = Field.auto_creation_counter
235.             Field.auto_creation_counter -= 1
236.         else:
237.             self.creation_counter = Field.creation_counter
238.             Field.creation_counter += 1
239. 
240.         self._validators = list(validators)  # Store for deconstruction later
241. 
242.         self._error_messages = error_messages  # Store for deconstruction later
243. 
244.     def __str__(self):
245.         """
246.         Return "app_label.model_label.field_name" for fields attached to
247.         models.
248.         """
249.         if not hasattr(self, "model"):
250.             return super().__str__()
251.         model = self.model
252.         return "%s.%s" % (model._meta.label, self.name)
253. 
254.     def __repr__(self):
255.         """Display the module, class, and name of the field."""
256.         path = "%s.%s" % (self.__class__.__module__, self.__class__.__qualname__)
257.         name = getattr(self, "name", None)
258.         if name is not None:
259.             return "<%s: %s>" % (path, name)
260.         return "<%s>" % path
261. 
262.     def check(self, **kwargs):
263.         return [
264.             *self._check_field_name(),
265.             *self._check_choices(),
266.             *self._check_db_index(),
267.             *self._check_db_comment(**kwargs),
268.             *self._check_null_allowed_for_primary_keys(),
269.             *self._check_backend_specific_checks(**kwargs),
270.             *self._check_validators(),
271.             *self._check_deprecation_details(),
272.         ]
273. 
274.     def _check_field_name(self):
275.         """
276.         Check if field name is valid, i.e. 1) does not end with an
277.         underscore, 2) does not contain "__" and 3) is not "pk".
278.         """
279.         if self.name.endswith("_"):
280.             return [
281.                 checks.Error(
282.                     "Field names must not end with an underscore.",
283.                     obj=self,
284.                     id="fields.E001",
285.                 )
286.             ]
287.         elif LOOKUP_SEP in self.name:
288.             return [
289.                 checks.Error(
290.                     'Field names must not contain "%s".' % LOOKUP_SEP,
291.                     obj=self,
292.                     id="fields.E002",
293.                 )
294.             ]
295.         elif self.name == "pk":
296.             return [
297.                 checks.Error(
298.                     "'pk' is a reserved word that cannot be used as a field name.",
299.                     obj=self,
300.                     id="fields.E003",
301.                 )
302.             ]
303.         else:
304.             return []
305. 
306.     @classmethod
307.     def _choices_is_value(cls, value):
308.         return isinstance(value, (str, Promise)) or not is_iterable(value)
309. 
310.     def _check_choices(self):
311.         if not self.choices:
312.             return []
313. 
314.         if not is_iterable(self.choices) or isinstance(self.choices, str):
315.             return [
316.                 checks.Error(
317.                     "'choices' must be an iterable (e.g., a list or tuple).",
318.                     obj=self,
319.                     id="fields.E004",
320.                 )
321.             ]
322. 
323.         choice_max_length = 0
324.         # Expect [group_name, [value, display]]
325.         for choices_group in self.choices:
326.             try:
327.                 group_name, group_choices = choices_group
328.             except (TypeError, ValueError):
329.                 # Containing non-pairs
330.                 break
331.             try:
332.                 if not all(
333.                     self._choices_is_value(value) and self._choices_is_value(human_name)
334.                     for value, human_name in group_choices
335.                 ):
336.                     break
337.                 if self.max_length is not None and group_choices:
338.                     choice_max_length = max(
339.                         [
340.                             choice_max_length,
341.                             *(
342.                                 len(value)
343.                                 for value, _ in group_choices
344.                                 if isinstance(value, str)
345.                             ),
346.                         ]
347.                     )
348.             except (TypeError, ValueError):
349.                 # No groups, choices in the form [value, display]
350.                 value, human_name = group_name, group_choices
351.                 if not self._choices_is_value(value) or not self._choices_is_value(
352.                     human_name
353.                 ):
354.                     break
355.                 if self.max_length is not None and isinstance(value, str):
356.                     choice_max_length = max(choice_max_length, len(value))
357. 
358.             # Special case: choices=['ab']
359.             if isinstance(choices_group, str):
360.                 break
361.         else:
362.             if self.max_length is not None and choice_max_length > self.max_length:
363.                 return [
364.                     checks.Error(
365.                         "'max_length' is too small to fit the longest value "
366.                         "in 'choices' (%d characters)." % choice_max_length,
367.                         obj=self,
368.                         id="fields.E009",
369.                     ),
370.                 ]
371.             return []
372. 
373.         return [
374.             checks.Error(
375.                 "'choices' must be an iterable containing "
376.                 "(actual value, human readable name) tuples.",
377.                 obj=self,
378.                 id="fields.E005",
379.             )
380.         ]
381. 
382.     def _check_db_index(self):
383.         if self.db_index not in (None, True, False):
384.             return [
385.                 checks.Error(
386.                     "'db_index' must be None, True or False.",
387.                     obj=self,
388.                     id="fields.E006",
389.                 )
390.             ]
391.         else:
392.             return []
393. 
394.     def _check_db_comment(self, databases=None, **kwargs):
395.         if not self.db_comment or not databases:
396.             return []
397.         errors = []
398.         for db in databases:
399.             if not router.allow_migrate_model(db, self.model):
400.                 continue
401.             connection = connections[db]
402.             if not (
403.                 connection.features.supports_comments
404.                 or "supports_comments" in self.model._meta.required_db_features
405.             ):
406.                 errors.append(
407.                     checks.Warning(
408.                         f"{connection.display_name} does not support comments on "
409.                         f"columns (db_comment).",
410.                         obj=self,
411.                         id="fields.W163",
412.                     )
413.                 )
414.         return errors
415. 
416.     def _check_null_allowed_for_primary_keys(self):
417.         if (
418.             self.primary_key
419.             and self.null
420.             and not connection.features.interprets_empty_strings_as_nulls
421.         ):
422.             # We cannot reliably check this for backends like Oracle which
423.             # consider NULL and '' to be equal (and thus set up
424.             # character-based fields a little differently).
425.             return [
426.                 checks.Error(
427.                     "Primary keys must not have null=True.",
428.                     hint=(
429.                         "Set null=False on the field, or "
430.                         "remove primary_key=True argument."
431.                     ),
432.                     obj=self,
433.                     id="fields.E007",
434.                 )
435.             ]
436.         else:
437.             return []
438. 
439.     def _check_backend_specific_checks(self, databases=None, **kwargs):
440.         if databases is None:
441.             return []
442.         errors = []
443.         for alias in databases:
444.             if router.allow_migrate_model(alias, self.model):
445.                 errors.extend(connections[alias].validation.check_field(self, **kwargs))
446.         return errors
447. 
448.     def _check_validators(self):
449.         errors = []
450.         for i, validator in enumerate(self.validators):
451.             if not callable(validator):
452.                 errors.append(
453.                     checks.Error(
454.                         "All 'validators' must be callable.",
455.                         hint=(
456.                             "validators[{i}] ({repr}) isn't a function or "
457.                             "instance of a validator class.".format(
458.                                 i=i,
459.                                 repr=repr(validator),
460.                             )
461.                         ),
462.                         obj=self,
463.                         id="fields.E008",
464.                     )
465.                 )
466.         return errors
467. 
468.     def _check_deprecation_details(self):
469.         if self.system_check_removed_details is not None:
470.             return [
471.                 checks.Error(
472.                     self.system_check_removed_details.get(
473.                         "msg",
474.                         "%s has been removed except for support in historical "
475.                         "migrations." % self.__class__.__name__,
476.                     ),
477.                     hint=self.system_check_removed_details.get("hint"),
478.                     obj=self,
479.                     id=self.system_check_removed_details.get("id", "fields.EXXX"),
480.                 )
481.             ]
482.         elif self.system_check_deprecated_details is not None:
483.             return [
484.                 checks.Warning(
485.                     self.system_check_deprecated_details.get(
486.                         "msg", "%s has been deprecated." % self.__class__.__name__
487.                     ),
488.                     hint=self.system_check_deprecated_details.get("hint"),
489.                     obj=self,
490.                     id=self.system_check_deprecated_details.get("id", "fields.WXXX"),
491.                 )
492.             ]
493.         return []
494. 
495.     def get_col(self, alias, output_field=None):
496.         if alias == self.model._meta.db_table and (
497.             output_field is None or output_field == self
498.         ):
499.             return self.cached_col
500.         from django.db.models.expressions import Col


File: django/db/models/fields/__init__.py
Line number range: 501 - 1500
Content:
501. 
502.         return Col(alias, self, output_field)
503. 
504.     @cached_property
505.     def cached_col(self):
506.         from django.db.models.expressions import Col
507. 
508.         return Col(self.model._meta.db_table, self)
509. 
510.     def select_format(self, compiler, sql, params):
511.         """
512.         Custom format for select clauses. For example, GIS columns need to be
513.         selected as AsText(table.col) on MySQL as the table.col data can't be
514.         used by Django.
515.         """
516.         return sql, params
517. 
518.     def deconstruct(self):
519.         """
520.         Return enough information to recreate the field as a 4-tuple:
521. 
522.          * The name of the field on the model, if contribute_to_class() has
523.            been run.
524.          * The import path of the field, including the class, e.g.
525.            django.db.models.IntegerField. This should be the most portable
526.            version, so less specific may be better.
527.          * A list of positional arguments.
528.          * A dict of keyword arguments.
529. 
530.         Note that the positional or keyword arguments must contain values of
531.         the following types (including inner values of collection types):
532. 
533.          * None, bool, str, int, float, complex, set, frozenset, list, tuple,
534.            dict
535.          * UUID
536.          * datetime.datetime (naive), datetime.date
537.          * top-level classes, top-level functions - will be referenced by their
538.            full import path
539.          * Storage instances - these have their own deconstruct() method
540. 
541.         This is because the values here must be serialized into a text format
542.         (possibly new Python code, possibly JSON) and these are the only types
543.         with encoding handlers defined.
544. 
545.         There's no need to return the exact way the field was instantiated this
546.         time, just ensure that the resulting field is the same - prefer keyword
547.         arguments over positional ones, and omit parameters with their default
548.         values.
549.         """
550.         # Short-form way of fetching all the default parameters
551.         keywords = {}
552.         possibles = {
553.             "verbose_name": None,
554.             "primary_key": False,
555.             "max_length": None,
556.             "unique": False,
557.             "blank": False,
558.             "null": False,
559.             "db_index": False,
560.             "default": NOT_PROVIDED,
561.             "editable": True,
562.             "serialize": True,
563.             "unique_for_date": None,
564.             "unique_for_month": None,
565.             "unique_for_year": None,
566.             "choices": None,
567.             "help_text": "",
568.             "db_column": None,
569.             "db_comment": None,
570.             "db_tablespace": None,
571.             "auto_created": False,
572.             "validators": [],
573.             "error_messages": None,
574.         }
575.         attr_overrides = {
576.             "unique": "_unique",
577.             "error_messages": "_error_messages",
578.             "validators": "_validators",
579.             "verbose_name": "_verbose_name",
580.             "db_tablespace": "_db_tablespace",
581.         }
582.         equals_comparison = {"choices", "validators"}
583.         for name, default in possibles.items():
584.             value = getattr(self, attr_overrides.get(name, name))
585.             # Unroll anything iterable for choices into a concrete list
586.             if name == "choices" and isinstance(value, collections.abc.Iterable):
587.                 value = list(value)
588.             # Do correct kind of comparison
589.             if name in equals_comparison:
590.                 if value != default:
591.                     keywords[name] = value
592.             else:
593.                 if value is not default:
594.                     keywords[name] = value
595.         # Work out path - we shorten it for known Django core fields
596.         path = "%s.%s" % (self.__class__.__module__, self.__class__.__qualname__)
597.         if path.startswith("django.db.models.fields.related"):
598.             path = path.replace("django.db.models.fields.related", "django.db.models")
599.         elif path.startswith("django.db.models.fields.files"):
600.             path = path.replace("django.db.models.fields.files", "django.db.models")
601.         elif path.startswith("django.db.models.fields.json"):
602.             path = path.replace("django.db.models.fields.json", "django.db.models")
603.         elif path.startswith("django.db.models.fields.proxy"):
604.             path = path.replace("django.db.models.fields.proxy", "django.db.models")
605.         elif path.startswith("django.db.models.fields"):
606.             path = path.replace("django.db.models.fields", "django.db.models")
607.         # Return basic info - other fields should override this.
608.         return (self.name, path, [], keywords)
609. 
610.     def clone(self):
611.         """
612.         Uses deconstruct() to clone a new copy of this Field.
613.         Will not preserve any class attachments/attribute names.
614.         """
615.         name, path, args, kwargs = self.deconstruct()
616.         return self.__class__(*args, **kwargs)
617. 
618.     def __eq__(self, other):
619.         # Needed for @total_ordering
620.         if isinstance(other, Field):
621.             return self.creation_counter == other.creation_counter and getattr(
622.                 self, "model", None
623.             ) == getattr(other, "model", None)
624.         return NotImplemented
625. 
626.     def __lt__(self, other):
627.         # This is needed because bisect does not take a comparison function.
628.         # Order by creation_counter first for backward compatibility.
629.         if isinstance(other, Field):
630.             if (
631.                 self.creation_counter != other.creation_counter
632.                 or not hasattr(self, "model")
633.                 and not hasattr(other, "model")
634.             ):
635.                 return self.creation_counter < other.creation_counter
636.             elif hasattr(self, "model") != hasattr(other, "model"):
637.                 return not hasattr(self, "model")  # Order no-model fields first
638.             else:
639.                 # creation_counter's are equal, compare only models.
640.                 return (self.model._meta.app_label, self.model._meta.model_name) < (
641.                     other.model._meta.app_label,
642.                     other.model._meta.model_name,
643.                 )
644.         return NotImplemented
645. 
646.     def __hash__(self):
647.         return hash(self.creation_counter)
648. 
649.     def __deepcopy__(self, memodict):
650.         # We don't have to deepcopy very much here, since most things are not
651.         # intended to be altered after initial creation.
652.         obj = copy.copy(self)
653.         if self.remote_field:
654.             obj.remote_field = copy.copy(self.remote_field)
655.             if hasattr(self.remote_field, "field") and self.remote_field.field is self:
656.                 obj.remote_field.field = obj
657.         memodict[id(self)] = obj
658.         return obj
659. 
660.     def __copy__(self):
661.         # We need to avoid hitting __reduce__, so define this
662.         # slightly weird copy construct.
663.         obj = Empty()
664.         obj.__class__ = self.__class__
665.         obj.__dict__ = self.__dict__.copy()
666.         return obj
667. 
668.     def __reduce__(self):
669.         """
670.         Pickling should return the model._meta.fields instance of the field,
671.         not a new copy of that field. So, use the app registry to load the
672.         model and then the field back.
673.         """
674.         if not hasattr(self, "model"):
675.             # Fields are sometimes used without attaching them to models (for
676.             # example in aggregation). In this case give back a plain field
677.             # instance. The code below will create a new empty instance of
678.             # class self.__class__, then update its dict with self.__dict__
679.             # values - so, this is very close to normal pickle.
680.             state = self.__dict__.copy()
681.             # The _get_default cached_property can't be pickled due to lambda
682.             # usage.
683.             state.pop("_get_default", None)
684.             return _empty, (self.__class__,), state
685.         return _load_field, (
686.             self.model._meta.app_label,
687.             self.model._meta.object_name,
688.             self.name,
689.         )
690. 
691.     def get_pk_value_on_save(self, instance):
692.         """
693.         Hook to generate new PK values on save. This method is called when
694.         saving instances with no primary key value set. If this method returns
695.         something else than None, then the returned value is used when saving
696.         the new instance.
697.         """
698.         if self.default:
699.             return self.get_default()
700.         return None
701. 
702.     def to_python(self, value):
703.         """
704.         Convert the input value into the expected Python data type, raising
705.         django.core.exceptions.ValidationError if the data can't be converted.
706.         Return the converted value. Subclasses should override this.
707.         """
708.         return value
709. 
710.     @cached_property
711.     def error_messages(self):
712.         messages = {}
713.         for c in reversed(self.__class__.__mro__):
714.             messages.update(getattr(c, "default_error_messages", {}))
715.         messages.update(self._error_messages or {})
716.         return messages
717. 
718.     @cached_property
719.     def validators(self):
720.         """
721.         Some validators can't be created at field initialization time.
722.         This method provides a way to delay their creation until required.
723.         """
724.         return [*self.default_validators, *self._validators]
725. 
726.     def run_validators(self, value):
727.         if value in self.empty_values:
728.             return
729. 
730.         errors = []
731.         for v in self.validators:
732.             try:
733.                 v(value)
734.             except exceptions.ValidationError as e:
735.                 if hasattr(e, "code") and e.code in self.error_messages:
736.                     e.message = self.error_messages[e.code]
737.                 errors.extend(e.error_list)
738. 
739.         if errors:
740.             raise exceptions.ValidationError(errors)
741. 
742.     def validate(self, value, model_instance):
743.         """
744.         Validate value and raise ValidationError if necessary. Subclasses
745.         should override this to provide validation logic.
746.         """
747.         if not self.editable:
748.             # Skip validation for non-editable fields.
749.             return
750. 
751.         if self.choices is not None and value not in self.empty_values:
752.             for option_key, option_value in self.choices:
753.                 if isinstance(option_value, (list, tuple)):
754.                     # This is an optgroup, so look inside the group for
755.                     # options.
756.                     for optgroup_key, optgroup_value in option_value:
757.                         if value == optgroup_key:
758.                             return
759.                 elif value == option_key:
760.                     return
761.             raise exceptions.ValidationError(
762.                 self.error_messages["invalid_choice"],
763.                 code="invalid_choice",
764.                 params={"value": value},
765.             )
766. 
767.         if value is None and not self.null:
768.             raise exceptions.ValidationError(self.error_messages["null"], code="null")
769. 
770.         if not self.blank and value in self.empty_values:
771.             raise exceptions.ValidationError(self.error_messages["blank"], code="blank")
772. 
773.     def clean(self, value, model_instance):
774.         """
775.         Convert the value's type and run validation. Validation errors
776.         from to_python() and validate() are propagated. Return the correct
777.         value if no error is raised.
778.         """
779.         value = self.to_python(value)
780.         self.validate(value, model_instance)
781.         self.run_validators(value)
782.         return value
783. 
784.     def db_type_parameters(self, connection):
785.         return DictWrapper(self.__dict__, connection.ops.quote_name, "qn_")
786. 
787.     def db_check(self, connection):
788.         """
789.         Return the database column check constraint for this field, for the
790.         provided connection. Works the same way as db_type() for the case that
791.         get_internal_type() does not map to a preexisting model field.
792.         """
793.         data = self.db_type_parameters(connection)
794.         try:
795.             return (
796.                 connection.data_type_check_constraints[self.get_internal_type()] % data
797.             )
798.         except KeyError:
799.             return None
800. 
801.     def db_type(self, connection):
802.         """
803.         Return the database column data type for this field, for the provided
804.         connection.
805.         """
806.         # The default implementation of this method looks at the
807.         # backend-specific data_types dictionary, looking up the field by its
808.         # "internal type".
809.         #
810.         # A Field class can implement the get_internal_type() method to specify
811.         # which *preexisting* Django Field class it's most similar to -- i.e.,
812.         # a custom field might be represented by a TEXT column type, which is
813.         # the same as the TextField Django field type, which means the custom
814.         # field's get_internal_type() returns 'TextField'.
815.         #
816.         # But the limitation of the get_internal_type() / data_types approach
817.         # is that it cannot handle database column types that aren't already
818.         # mapped to one of the built-in Django field types. In this case, you
819.         # can implement db_type() instead of get_internal_type() to specify
820.         # exactly which wacky database column type you want to use.
821.         data = self.db_type_parameters(connection)
822.         try:
823.             column_type = connection.data_types[self.get_internal_type()]
824.         except KeyError:
825.             return None
826.         else:
827.             # column_type is either a single-parameter function or a string.
828.             if callable(column_type):
829.                 return column_type(data)
830.             return column_type % data
831. 
832.     def rel_db_type(self, connection):
833.         """
834.         Return the data type that a related field pointing to this field should
835.         use. For example, this method is called by ForeignKey and OneToOneField
836.         to determine its data type.
837.         """
838.         return self.db_type(connection)
839. 
840.     def cast_db_type(self, connection):
841.         """Return the data type to use in the Cast() function."""
842.         db_type = connection.ops.cast_data_types.get(self.get_internal_type())
843.         if db_type:
844.             return db_type % self.db_type_parameters(connection)
845.         return self.db_type(connection)
846. 
847.     def db_parameters(self, connection):
848.         """
849.         Extension of db_type(), providing a range of different return values
850.         (type, checks). This will look at db_type(), allowing custom model
851.         fields to override it.
852.         """
853.         type_string = self.db_type(connection)
854.         check_string = self.db_check(connection)
855.         return {
856.             "type": type_string,
857.             "check": check_string,
858.         }
859. 
860.     def db_type_suffix(self, connection):
861.         return connection.data_types_suffix.get(self.get_internal_type())
862. 
863.     def get_db_converters(self, connection):
864.         if hasattr(self, "from_db_value"):
865.             return [self.from_db_value]
866.         return []
867. 
868.     @property
869.     def unique(self):
870.         return self._unique or self.primary_key
871. 
872.     @property
873.     def db_tablespace(self):
874.         return self._db_tablespace or settings.DEFAULT_INDEX_TABLESPACE
875. 
876.     @property
877.     def db_returning(self):
878.         """
879.         Private API intended only to be used by Django itself. Currently only
880.         the PostgreSQL backend supports returning multiple fields on a model.
881.         """
882.         return False
883. 
884.     def set_attributes_from_name(self, name):
885.         self.name = self.name or name
886.         self.attname, self.column = self.get_attname_column()
887.         self.concrete = self.column is not None
888.         if self.verbose_name is None and self.name:
889.             self.verbose_name = self.name.replace("_", " ")
890. 
891.     def contribute_to_class(self, cls, name, private_only=False):
892.         """
893.         Register the field with the model class it belongs to.
894. 
895.         If private_only is True, create a separate instance of this field
896.         for every subclass of cls, even if cls is not an abstract model.
897.         """
898.         self.set_attributes_from_name(name)
899.         self.model = cls
900.         cls._meta.add_field(self, private=private_only)
901.         if self.column:
902.             setattr(cls, self.attname, self.descriptor_class(self))
903.         if self.choices is not None:
904.             # Don't override a get_FOO_display() method defined explicitly on
905.             # this class, but don't check methods derived from inheritance, to
906.             # allow overriding inherited choices. For more complex inheritance
907.             # structures users should override contribute_to_class().
908.             if "get_%s_display" % self.name not in cls.__dict__:
909.                 setattr(
910.                     cls,
911.                     "get_%s_display" % self.name,
912.                     partialmethod(cls._get_FIELD_display, field=self),
913.                 )
914. 
915.     def get_filter_kwargs_for_object(self, obj):
916.         """
917.         Return a dict that when passed as kwargs to self.model.filter(), would
918.         yield all instances having the same value for this field as obj has.
919.         """
920.         return {self.name: getattr(obj, self.attname)}
921. 
922.     def get_attname(self):
923.         return self.name
924. 
925.     def get_attname_column(self):
926.         attname = self.get_attname()
927.         column = self.db_column or attname
928.         return attname, column
929. 
930.     def get_internal_type(self):
931.         return self.__class__.__name__
932. 
933.     def pre_save(self, model_instance, add):
934.         """Return field's value just before saving."""
935.         return getattr(model_instance, self.attname)
936. 
937.     def get_prep_value(self, value):
938.         """Perform preliminary non-db specific value checks and conversions."""
939.         if isinstance(value, Promise):
940.             value = value._proxy____cast()
941.         return value
942. 
943.     def get_db_prep_value(self, value, connection, prepared=False):
944.         """
945.         Return field's value prepared for interacting with the database backend.
946. 
947.         Used by the default implementations of get_db_prep_save().
948.         """
949.         if not prepared:
950.             value = self.get_prep_value(value)
951.         return value
952. 
953.     def get_db_prep_save(self, value, connection):
954.         """Return field's value prepared for saving into a database."""
955.         if hasattr(value, "as_sql"):
956.             return value
957.         return self.get_db_prep_value(value, connection=connection, prepared=False)
958. 
959.     def has_default(self):
960.         """Return a boolean of whether this field has a default value."""
961.         return self.default is not NOT_PROVIDED
962. 
963.     def get_default(self):
964.         """Return the default value for this field."""
965.         return self._get_default()
966. 
967.     @cached_property
968.     def _get_default(self):
969.         if self.has_default():
970.             if callable(self.default):
971.                 return self.default
972.             return lambda: self.default
973. 
974.         if (
975.             not self.empty_strings_allowed
976.             or self.null
977.             and not connection.features.interprets_empty_strings_as_nulls
978.         ):
979.             return return_None
980.         return str  # return empty string
981. 
982.     def get_choices(
983.         self,
984.         include_blank=True,
985.         blank_choice=BLANK_CHOICE_DASH,
986.         limit_choices_to=None,
987.         ordering=(),
988.     ):
989.         """
990.         Return choices with a default blank choices included, for use
991.         as <select> choices for this field.
992.         """
993.         if self.choices is not None:
994.             choices = list(self.choices)
995.             if include_blank:
996.                 blank_defined = any(
997.                     choice in ("", None) for choice, _ in self.flatchoices
998.                 )
999.                 if not blank_defined:
1000.                     choices = blank_choice + choices
1001.             return choices
1002.         rel_model = self.remote_field.model
1003.         limit_choices_to = limit_choices_to or self.get_limit_choices_to()
1004.         choice_func = operator.attrgetter(
1005.             self.remote_field.get_related_field().attname
1006.             if hasattr(self.remote_field, "get_related_field")
1007.             else "pk"
1008.         )
1009.         qs = rel_model._default_manager.complex_filter(limit_choices_to)
1010.         if ordering:
1011.             qs = qs.order_by(*ordering)
1012.         return (blank_choice if include_blank else []) + [
1013.             (choice_func(x), str(x)) for x in qs
1014.         ]
1015. 
1016.     def value_to_string(self, obj):
1017.         """
1018.         Return a string value of this field from the passed obj.
1019.         This is used by the serialization framework.
1020.         """
1021.         return str(self.value_from_object(obj))
1022. 
1023.     def _get_flatchoices(self):
1024.         """Flattened version of choices tuple."""
1025.         if self.choices is None:
1026.             return []
1027.         flat = []
1028.         for choice, value in self.choices:
1029.             if isinstance(value, (list, tuple)):
1030.                 flat.extend(value)
1031.             else:
1032.                 flat.append((choice, value))
1033.         return flat
1034. 
1035.     flatchoices = property(_get_flatchoices)
1036. 
1037.     def save_form_data(self, instance, data):
1038.         setattr(instance, self.name, data)
1039. 
1040.     def formfield(self, form_class=None, choices_form_class=None, **kwargs):
1041.         """Return a django.forms.Field instance for this field."""
1042.         defaults = {
1043.             "required": not self.blank,
1044.             "label": capfirst(self.verbose_name),
1045.             "help_text": self.help_text,
1046.         }
1047.         if self.has_default():
1048.             if callable(self.default):
1049.                 defaults["initial"] = self.default
1050.                 defaults["show_hidden_initial"] = True
1051.             else:
1052.                 defaults["initial"] = self.get_default()
1053.         if self.choices is not None:
1054.             # Fields with choices get special treatment.
1055.             include_blank = self.blank or not (
1056.                 self.has_default() or "initial" in kwargs
1057.             )
1058.             defaults["choices"] = self.get_choices(include_blank=include_blank)
1059.             defaults["coerce"] = self.to_python
1060.             if self.null:
1061.                 defaults["empty_value"] = None
1062.             if choices_form_class is not None:
1063.                 form_class = choices_form_class
1064.             else:
1065.                 form_class = forms.TypedChoiceField
1066.             # Many of the subclass-specific formfield arguments (min_value,
1067.             # max_value) don't apply for choice fields, so be sure to only pass
1068.             # the values that TypedChoiceField will understand.
1069.             for k in list(kwargs):
1070.                 if k not in (
1071.                     "coerce",
1072.                     "empty_value",
1073.                     "choices",
1074.                     "required",
1075.                     "widget",
1076.                     "label",
1077.                     "initial",
1078.                     "help_text",
1079.                     "error_messages",
1080.                     "show_hidden_initial",
1081.                     "disabled",
1082.                 ):
1083.                     del kwargs[k]
1084.         defaults.update(kwargs)
1085.         if form_class is None:
1086.             form_class = forms.CharField
1087.         return form_class(**defaults)
1088. 
1089.     def value_from_object(self, obj):
1090.         """Return the value of this field in the given model instance."""
1091.         return getattr(obj, self.attname)
1092. 
1093. 
1094. class BooleanField(Field):
1095.     empty_strings_allowed = False
1096.     default_error_messages = {
1097.         "invalid": _("“%(value)s” value must be either True or False."),
1098.         "invalid_nullable": _("“%(value)s” value must be either True, False, or None."),
1099.     }
1100.     description = _("Boolean (Either True or False)")
1101. 
1102.     def get_internal_type(self):
1103.         return "BooleanField"
1104. 
1105.     def to_python(self, value):
1106.         if self.null and value in self.empty_values:
1107.             return None
1108.         if value in (True, False):
1109.             # 1/0 are equal to True/False. bool() converts former to latter.
1110.             return bool(value)
1111.         if value in ("t", "True", "1"):
1112.             return True
1113.         if value in ("f", "False", "0"):
1114.             return False
1115.         raise exceptions.ValidationError(
1116.             self.error_messages["invalid_nullable" if self.null else "invalid"],
1117.             code="invalid",
1118.             params={"value": value},
1119.         )
1120. 
1121.     def get_prep_value(self, value):
1122.         value = super().get_prep_value(value)
1123.         if value is None:
1124.             return None
1125.         return self.to_python(value)
1126. 
1127.     def formfield(self, **kwargs):
1128.         if self.choices is not None:
1129.             include_blank = not (self.has_default() or "initial" in kwargs)
1130.             defaults = {"choices": self.get_choices(include_blank=include_blank)}
1131.         else:
1132.             form_class = forms.NullBooleanField if self.null else forms.BooleanField
1133.             # In HTML checkboxes, 'required' means "must be checked" which is
1134.             # different from the choices case ("must select some value").
1135.             # required=False allows unchecked checkboxes.
1136.             defaults = {"form_class": form_class, "required": False}
1137.         return super().formfield(**{**defaults, **kwargs})
1138. 
1139. 
1140. class CharField(Field):
1141.     def __init__(self, *args, db_collation=None, **kwargs):
1142.         super().__init__(*args, **kwargs)
1143.         self.db_collation = db_collation
1144.         if self.max_length is not None:
1145.             self.validators.append(validators.MaxLengthValidator(self.max_length))
1146. 
1147.     @property
1148.     def description(self):
1149.         if self.max_length is not None:
1150.             return _("String (up to %(max_length)s)")
1151.         else:
1152.             return _("String (unlimited)")
1153. 
1154.     def check(self, **kwargs):
1155.         databases = kwargs.get("databases") or []
1156.         return [
1157.             *super().check(**kwargs),
1158.             *self._check_db_collation(databases),
1159.             *self._check_max_length_attribute(**kwargs),
1160.         ]
1161. 
1162.     def _check_max_length_attribute(self, **kwargs):
1163.         if self.max_length is None:
1164.             if (
1165.                 connection.features.supports_unlimited_charfield
1166.                 or "supports_unlimited_charfield"
1167.                 in self.model._meta.required_db_features
1168.             ):
1169.                 return []
1170.             return [
1171.                 checks.Error(
1172.                     "CharFields must define a 'max_length' attribute.",
1173.                     obj=self,
1174.                     id="fields.E120",
1175.                 )
1176.             ]
1177.         elif (
1178.             not isinstance(self.max_length, int)
1179.             or isinstance(self.max_length, bool)
1180.             or self.max_length <= 0
1181.         ):
1182.             return [
1183.                 checks.Error(
1184.                     "'max_length' must be a positive integer.",
1185.                     obj=self,
1186.                     id="fields.E121",
1187.                 )
1188.             ]
1189.         else:
1190.             return []
1191. 
1192.     def _check_db_collation(self, databases):
1193.         errors = []
1194.         for db in databases:
1195.             if not router.allow_migrate_model(db, self.model):
1196.                 continue
1197.             connection = connections[db]
1198.             if not (
1199.                 self.db_collation is None
1200.                 or "supports_collation_on_charfield"
1201.                 in self.model._meta.required_db_features
1202.                 or connection.features.supports_collation_on_charfield
1203.             ):
1204.                 errors.append(
1205.                     checks.Error(
1206.                         "%s does not support a database collation on "
1207.                         "CharFields." % connection.display_name,
1208.                         obj=self,
1209.                         id="fields.E190",
1210.                     ),
1211.                 )
1212.         return errors
1213. 
1214.     def cast_db_type(self, connection):
1215.         if self.max_length is None:
1216.             return connection.ops.cast_char_field_without_max_length
1217.         return super().cast_db_type(connection)
1218. 
1219.     def db_parameters(self, connection):
1220.         db_params = super().db_parameters(connection)
1221.         db_params["collation"] = self.db_collation
1222.         return db_params
1223. 
1224.     def get_internal_type(self):
1225.         return "CharField"
1226. 
1227.     def to_python(self, value):
1228.         if isinstance(value, str) or value is None:
1229.             return value
1230.         return str(value)
1231. 
1232.     def get_prep_value(self, value):
1233.         value = super().get_prep_value(value)
1234.         return self.to_python(value)
1235. 
1236.     def formfield(self, **kwargs):
1237.         # Passing max_length to forms.CharField means that the value's length
1238.         # will be validated twice. This is considered acceptable since we want
1239.         # the value in the form field (to pass into widget for example).
1240.         defaults = {"max_length": self.max_length}
1241.         # TODO: Handle multiple backends with different feature flags.
1242.         if self.null and not connection.features.interprets_empty_strings_as_nulls:
1243.             defaults["empty_value"] = None
1244.         defaults.update(kwargs)
1245.         return super().formfield(**defaults)
1246. 
1247.     def deconstruct(self):
1248.         name, path, args, kwargs = super().deconstruct()
1249.         if self.db_collation:
1250.             kwargs["db_collation"] = self.db_collation
1251.         return name, path, args, kwargs
1252. 
1253. 
1254. class CommaSeparatedIntegerField(CharField):
1255.     default_validators = [validators.validate_comma_separated_integer_list]
1256.     description = _("Comma-separated integers")
1257.     system_check_removed_details = {
1258.         "msg": (
1259.             "CommaSeparatedIntegerField is removed except for support in "
1260.             "historical migrations."
1261.         ),
1262.         "hint": (
1263.             "Use CharField(validators=[validate_comma_separated_integer_list]) "
1264.             "instead."
1265.         ),
1266.         "id": "fields.E901",
1267.     }
1268. 
1269. 
1270. def _to_naive(value):
1271.     if timezone.is_aware(value):
1272.         value = timezone.make_naive(value, datetime.timezone.utc)
1273.     return value
1274. 
1275. 
1276. def _get_naive_now():
1277.     return _to_naive(timezone.now())
1278. 
1279. 
1280. class DateTimeCheckMixin:
1281.     def check(self, **kwargs):
1282.         return [
1283.             *super().check(**kwargs),
1284.             *self._check_mutually_exclusive_options(),
1285.             *self._check_fix_default_value(),
1286.         ]
1287. 
1288.     def _check_mutually_exclusive_options(self):
1289.         # auto_now, auto_now_add, and default are mutually exclusive
1290.         # options. The use of more than one of these options together
1291.         # will trigger an Error
1292.         mutually_exclusive_options = [
1293.             self.auto_now_add,
1294.             self.auto_now,
1295.             self.has_default(),
1296.         ]
1297.         enabled_options = [
1298.             option not in (None, False) for option in mutually_exclusive_options
1299.         ].count(True)
1300.         if enabled_options > 1:
1301.             return [
1302.                 checks.Error(
1303.                     "The options auto_now, auto_now_add, and default "
1304.                     "are mutually exclusive. Only one of these options "
1305.                     "may be present.",
1306.                     obj=self,
1307.                     id="fields.E160",
1308.                 )
1309.             ]
1310.         else:
1311.             return []
1312. 
1313.     def _check_fix_default_value(self):
1314.         return []
1315. 
1316.     # Concrete subclasses use this in their implementations of
1317.     # _check_fix_default_value().
1318.     def _check_if_value_fixed(self, value, now=None):
1319.         """
1320.         Check if the given value appears to have been provided as a "fixed"
1321.         time value, and include a warning in the returned list if it does. The
1322.         value argument must be a date object or aware/naive datetime object. If
1323.         now is provided, it must be a naive datetime object.
1324.         """
1325.         if now is None:
1326.             now = _get_naive_now()
1327.         offset = datetime.timedelta(seconds=10)
1328.         lower = now - offset
1329.         upper = now + offset
1330.         if isinstance(value, datetime.datetime):
1331.             value = _to_naive(value)
1332.         else:
1333.             assert isinstance(value, datetime.date)
1334.             lower = lower.date()
1335.             upper = upper.date()
1336.         if lower <= value <= upper:
1337.             return [
1338.                 checks.Warning(
1339.                     "Fixed default value provided.",
1340.                     hint=(
1341.                         "It seems you set a fixed date / time / datetime "
1342.                         "value as default for this field. This may not be "
1343.                         "what you want. If you want to have the current date "
1344.                         "as default, use `django.utils.timezone.now`"
1345.                     ),
1346.                     obj=self,
1347.                     id="fields.W161",
1348.                 )
1349.             ]
1350.         return []
1351. 
1352. 
1353. class DateField(DateTimeCheckMixin, Field):
1354.     empty_strings_allowed = False
1355.     default_error_messages = {
1356.         "invalid": _(
1357.             "“%(value)s” value has an invalid date format. It must be "
1358.             "in YYYY-MM-DD format."
1359.         ),
1360.         "invalid_date": _(
1361.             "“%(value)s” value has the correct format (YYYY-MM-DD) "
1362.             "but it is an invalid date."
1363.         ),
1364.     }
1365.     description = _("Date (without time)")
1366. 
1367.     def __init__(
1368.         self, verbose_name=None, name=None, auto_now=False, auto_now_add=False, **kwargs
1369.     ):
1370.         self.auto_now, self.auto_now_add = auto_now, auto_now_add
1371.         if auto_now or auto_now_add:
1372.             kwargs["editable"] = False
1373.             kwargs["blank"] = True
1374.         super().__init__(verbose_name, name, **kwargs)
1375. 
1376.     def _check_fix_default_value(self):
1377.         """
1378.         Warn that using an actual date or datetime value is probably wrong;
1379.         it's only evaluated on server startup.
1380.         """
1381.         if not self.has_default():
1382.             return []
1383. 
1384.         value = self.default
1385.         if isinstance(value, datetime.datetime):
1386.             value = _to_naive(value).date()
1387.         elif isinstance(value, datetime.date):
1388.             pass
1389.         else:
1390.             # No explicit date / datetime value -- no checks necessary
1391.             return []
1392.         # At this point, value is a date object.
1393.         return self._check_if_value_fixed(value)
1394. 
1395.     def deconstruct(self):
1396.         name, path, args, kwargs = super().deconstruct()
1397.         if self.auto_now:
1398.             kwargs["auto_now"] = True
1399.         if self.auto_now_add:
1400.             kwargs["auto_now_add"] = True
1401.         if self.auto_now or self.auto_now_add:
1402.             del kwargs["editable"]
1403.             del kwargs["blank"]
1404.         return name, path, args, kwargs
1405. 
1406.     def get_internal_type(self):
1407.         return "DateField"
1408. 
1409.     def to_python(self, value):
1410.         if value is None:
1411.             return value
1412.         if isinstance(value, datetime.datetime):
1413.             if settings.USE_TZ and timezone.is_aware(value):
1414.                 # Convert aware datetimes to the default time zone
1415.                 # before casting them to dates (#17742).
1416.                 default_timezone = timezone.get_default_timezone()
1417.                 value = timezone.make_naive(value, default_timezone)
1418.             return value.date()
1419.         if isinstance(value, datetime.date):
1420.             return value
1421. 
1422.         try:
1423.             parsed = parse_date(value)
1424.             if parsed is not None:
1425.                 return parsed
1426.         except ValueError:
1427.             raise exceptions.ValidationError(
1428.                 self.error_messages["invalid_date"],
1429.                 code="invalid_date",
1430.                 params={"value": value},
1431.             )
1432. 
1433.         raise exceptions.ValidationError(
1434.             self.error_messages["invalid"],
1435.             code="invalid",
1436.             params={"value": value},
1437.         )
1438. 
1439.     def pre_save(self, model_instance, add):
1440.         if self.auto_now or (self.auto_now_add and add):
1441.             value = datetime.date.today()
1442.             setattr(model_instance, self.attname, value)
1443.             return value
1444.         else:
1445.             return super().pre_save(model_instance, add)
1446. 
1447.     def contribute_to_class(self, cls, name, **kwargs):
1448.         super().contribute_to_class(cls, name, **kwargs)
1449.         if not self.null:
1450.             setattr(
1451.                 cls,
1452.                 "get_next_by_%s" % self.name,
1453.                 partialmethod(
1454.                     cls._get_next_or_previous_by_FIELD, field=self, is_next=True
1455.                 ),
1456.             )
1457.             setattr(
1458.                 cls,
1459.                 "get_previous_by_%s" % self.name,
1460.                 partialmethod(
1461.                     cls._get_next_or_previous_by_FIELD, field=self, is_next=False
1462.                 ),
1463.             )
1464. 
1465.     def get_prep_value(self, value):
1466.         value = super().get_prep_value(value)
1467.         return self.to_python(value)
1468. 
1469.     def get_db_prep_value(self, value, connection, prepared=False):
1470.         # Casts dates into the format expected by the backend
1471.         if not prepared:
1472.             value = self.get_prep_value(value)
1473.         return connection.ops.adapt_datefield_value(value)
1474. 
1475.     def value_to_string(self, obj):
1476.         val = self.value_from_object(obj)
1477.         return "" if val is None else val.isoformat()
1478. 
1479.     def formfield(self, **kwargs):
1480.         return super().formfield(
1481.             **{
1482.                 "form_class": forms.DateField,
1483.                 **kwargs,
1484.             }
1485.         )
1486. 
1487. 
1488. class DateTimeField(DateField):
1489.     empty_strings_allowed = False
1490.     default_error_messages = {
1491.         "invalid": _(
1492.             "“%(value)s” value has an invalid format. It must be in "
1493.             "YYYY-MM-DD HH:MM[:ss[.uuuuuu]][TZ] format."
1494.         ),
1495.         "invalid_date": _(
1496.             "“%(value)s” value has the correct format "
1497.             "(YYYY-MM-DD) but it is an invalid date."
1498.         ),
1499.         "invalid_datetime": _(
1500.             "“%(value)s” value has the correct format "


File: django/db/models/fields/__init__.py
Line number range: 1501 - 2500
Content:
1501.             "(YYYY-MM-DD HH:MM[:ss[.uuuuuu]][TZ]) "
1502.             "but it is an invalid date/time."
1503.         ),
1504.     }
1505.     description = _("Date (with time)")
1506. 
1507.     # __init__ is inherited from DateField
1508. 
1509.     def _check_fix_default_value(self):
1510.         """
1511.         Warn that using an actual date or datetime value is probably wrong;
1512.         it's only evaluated on server startup.
1513.         """
1514.         if not self.has_default():
1515.             return []
1516. 
1517.         value = self.default
1518.         if isinstance(value, (datetime.datetime, datetime.date)):
1519.             return self._check_if_value_fixed(value)
1520.         # No explicit date / datetime value -- no checks necessary.
1521.         return []
1522. 
1523.     def get_internal_type(self):
1524.         return "DateTimeField"
1525. 
1526.     def to_python(self, value):
1527.         if value is None:
1528.             return value
1529.         if isinstance(value, datetime.datetime):
1530.             return value
1531.         if isinstance(value, datetime.date):
1532.             value = datetime.datetime(value.year, value.month, value.day)
1533.             if settings.USE_TZ:
1534.                 # For backwards compatibility, interpret naive datetimes in
1535.                 # local time. This won't work during DST change, but we can't
1536.                 # do much about it, so we let the exceptions percolate up the
1537.                 # call stack.
1538.                 warnings.warn(
1539.                     "DateTimeField %s.%s received a naive datetime "
1540.                     "(%s) while time zone support is active."
1541.                     % (self.model.__name__, self.name, value),
1542.                     RuntimeWarning,
1543.                 )
1544.                 default_timezone = timezone.get_default_timezone()
1545.                 value = timezone.make_aware(value, default_timezone)
1546.             return value
1547. 
1548.         try:
1549.             parsed = parse_datetime(value)
1550.             if parsed is not None:
1551.                 return parsed
1552.         except ValueError:
1553.             raise exceptions.ValidationError(
1554.                 self.error_messages["invalid_datetime"],
1555.                 code="invalid_datetime",
1556.                 params={"value": value},
1557.             )
1558. 
1559.         try:
1560.             parsed = parse_date(value)
1561.             if parsed is not None:
1562.                 return datetime.datetime(parsed.year, parsed.month, parsed.day)
1563.         except ValueError:
1564.             raise exceptions.ValidationError(
1565.                 self.error_messages["invalid_date"],
1566.                 code="invalid_date",
1567.                 params={"value": value},
1568.             )
1569. 
1570.         raise exceptions.ValidationError(
1571.             self.error_messages["invalid"],
1572.             code="invalid",
1573.             params={"value": value},
1574.         )
1575. 
1576.     def pre_save(self, model_instance, add):
1577.         if self.auto_now or (self.auto_now_add and add):
1578.             value = timezone.now()
1579.             setattr(model_instance, self.attname, value)
1580.             return value
1581.         else:
1582.             return super().pre_save(model_instance, add)
1583. 
1584.     # contribute_to_class is inherited from DateField, it registers
1585.     # get_next_by_FOO and get_prev_by_FOO
1586. 
1587.     def get_prep_value(self, value):
1588.         value = super().get_prep_value(value)
1589.         value = self.to_python(value)
1590.         if value is not None and settings.USE_TZ and timezone.is_naive(value):
1591.             # For backwards compatibility, interpret naive datetimes in local
1592.             # time. This won't work during DST change, but we can't do much
1593.             # about it, so we let the exceptions percolate up the call stack.
1594.             try:
1595.                 name = "%s.%s" % (self.model.__name__, self.name)
1596.             except AttributeError:
1597.                 name = "(unbound)"
1598.             warnings.warn(
1599.                 "DateTimeField %s received a naive datetime (%s)"
1600.                 " while time zone support is active." % (name, value),
1601.                 RuntimeWarning,
1602.             )
1603.             default_timezone = timezone.get_default_timezone()
1604.             value = timezone.make_aware(value, default_timezone)
1605.         return value
1606. 
1607.     def get_db_prep_value(self, value, connection, prepared=False):
1608.         # Casts datetimes into the format expected by the backend
1609.         if not prepared:
1610.             value = self.get_prep_value(value)
1611.         return connection.ops.adapt_datetimefield_value(value)
1612. 
1613.     def value_to_string(self, obj):
1614.         val = self.value_from_object(obj)
1615.         return "" if val is None else val.isoformat()
1616. 
1617.     def formfield(self, **kwargs):
1618.         return super().formfield(
1619.             **{
1620.                 "form_class": forms.DateTimeField,
1621.                 **kwargs,
1622.             }
1623.         )
1624. 
1625. 
1626. class DecimalField(Field):
1627.     empty_strings_allowed = False
1628.     default_error_messages = {
1629.         "invalid": _("“%(value)s” value must be a decimal number."),
1630.     }
1631.     description = _("Decimal number")
1632. 
1633.     def __init__(
1634.         self,
1635.         verbose_name=None,
1636.         name=None,
1637.         max_digits=None,
1638.         decimal_places=None,
1639.         **kwargs,
1640.     ):
1641.         self.max_digits, self.decimal_places = max_digits, decimal_places
1642.         super().__init__(verbose_name, name, **kwargs)
1643. 
1644.     def check(self, **kwargs):
1645.         errors = super().check(**kwargs)
1646. 
1647.         digits_errors = [
1648.             *self._check_decimal_places(),
1649.             *self._check_max_digits(),
1650.         ]
1651.         if not digits_errors:
1652.             errors.extend(self._check_decimal_places_and_max_digits(**kwargs))
1653.         else:
1654.             errors.extend(digits_errors)
1655.         return errors
1656. 
1657.     def _check_decimal_places(self):
1658.         try:
1659.             decimal_places = int(self.decimal_places)
1660.             if decimal_places < 0:
1661.                 raise ValueError()
1662.         except TypeError:
1663.             return [
1664.                 checks.Error(
1665.                     "DecimalFields must define a 'decimal_places' attribute.",
1666.                     obj=self,
1667.                     id="fields.E130",
1668.                 )
1669.             ]
1670.         except ValueError:
1671.             return [
1672.                 checks.Error(
1673.                     "'decimal_places' must be a non-negative integer.",
1674.                     obj=self,
1675.                     id="fields.E131",
1676.                 )
1677.             ]
1678.         else:
1679.             return []
1680. 
1681.     def _check_max_digits(self):
1682.         try:
1683.             max_digits = int(self.max_digits)
1684.             if max_digits <= 0:
1685.                 raise ValueError()
1686.         except TypeError:
1687.             return [
1688.                 checks.Error(
1689.                     "DecimalFields must define a 'max_digits' attribute.",
1690.                     obj=self,
1691.                     id="fields.E132",
1692.                 )
1693.             ]
1694.         except ValueError:
1695.             return [
1696.                 checks.Error(
1697.                     "'max_digits' must be a positive integer.",
1698.                     obj=self,
1699.                     id="fields.E133",
1700.                 )
1701.             ]
1702.         else:
1703.             return []
1704. 
1705.     def _check_decimal_places_and_max_digits(self, **kwargs):
1706.         if int(self.decimal_places) > int(self.max_digits):
1707.             return [
1708.                 checks.Error(
1709.                     "'max_digits' must be greater or equal to 'decimal_places'.",
1710.                     obj=self,
1711.                     id="fields.E134",
1712.                 )
1713.             ]
1714.         return []
1715. 
1716.     @cached_property
1717.     def validators(self):
1718.         return super().validators + [
1719.             validators.DecimalValidator(self.max_digits, self.decimal_places)
1720.         ]
1721. 
1722.     @cached_property
1723.     def context(self):
1724.         return decimal.Context(prec=self.max_digits)
1725. 
1726.     def deconstruct(self):
1727.         name, path, args, kwargs = super().deconstruct()
1728.         if self.max_digits is not None:
1729.             kwargs["max_digits"] = self.max_digits
1730.         if self.decimal_places is not None:
1731.             kwargs["decimal_places"] = self.decimal_places
1732.         return name, path, args, kwargs
1733. 
1734.     def get_internal_type(self):
1735.         return "DecimalField"
1736. 
1737.     def to_python(self, value):
1738.         if value is None:
1739.             return value
1740.         try:
1741.             if isinstance(value, float):
1742.                 decimal_value = self.context.create_decimal_from_float(value)
1743.             else:
1744.                 decimal_value = decimal.Decimal(value)
1745.         except (decimal.InvalidOperation, TypeError, ValueError):
1746.             raise exceptions.ValidationError(
1747.                 self.error_messages["invalid"],
1748.                 code="invalid",
1749.                 params={"value": value},
1750.             )
1751.         if not decimal_value.is_finite():
1752.             raise exceptions.ValidationError(
1753.                 self.error_messages["invalid"],
1754.                 code="invalid",
1755.                 params={"value": value},
1756.             )
1757.         return decimal_value
1758. 
1759.     def get_db_prep_value(self, value, connection, prepared=False):
1760.         if not prepared:
1761.             value = self.get_prep_value(value)
1762.         if hasattr(value, "as_sql"):
1763.             return value
1764.         return connection.ops.adapt_decimalfield_value(
1765.             value, self.max_digits, self.decimal_places
1766.         )
1767. 
1768.     def get_prep_value(self, value):
1769.         value = super().get_prep_value(value)
1770.         return self.to_python(value)
1771. 
1772.     def formfield(self, **kwargs):
1773.         return super().formfield(
1774.             **{
1775.                 "max_digits": self.max_digits,
1776.                 "decimal_places": self.decimal_places,
1777.                 "form_class": forms.DecimalField,
1778.                 **kwargs,
1779.             }
1780.         )
1781. 
1782. 
1783. class DurationField(Field):
1784.     """
1785.     Store timedelta objects.
1786. 
1787.     Use interval on PostgreSQL, INTERVAL DAY TO SECOND on Oracle, and bigint
1788.     of microseconds on other databases.
1789.     """
1790. 
1791.     empty_strings_allowed = False
1792.     default_error_messages = {
1793.         "invalid": _(
1794.             "“%(value)s” value has an invalid format. It must be in "
1795.             "[DD] [[HH:]MM:]ss[.uuuuuu] format."
1796.         )
1797.     }
1798.     description = _("Duration")
1799. 
1800.     def get_internal_type(self):
1801.         return "DurationField"
1802. 
1803.     def to_python(self, value):
1804.         if value is None:
1805.             return value
1806.         if isinstance(value, datetime.timedelta):
1807.             return value
1808.         try:
1809.             parsed = parse_duration(value)
1810.         except ValueError:
1811.             pass
1812.         else:
1813.             if parsed is not None:
1814.                 return parsed
1815. 
1816.         raise exceptions.ValidationError(
1817.             self.error_messages["invalid"],
1818.             code="invalid",
1819.             params={"value": value},
1820.         )
1821. 
1822.     def get_db_prep_value(self, value, connection, prepared=False):
1823.         if connection.features.has_native_duration_field:
1824.             return value
1825.         if value is None:
1826.             return None
1827.         return duration_microseconds(value)
1828. 
1829.     def get_db_converters(self, connection):
1830.         converters = []
1831.         if not connection.features.has_native_duration_field:
1832.             converters.append(connection.ops.convert_durationfield_value)
1833.         return converters + super().get_db_converters(connection)
1834. 
1835.     def value_to_string(self, obj):
1836.         val = self.value_from_object(obj)
1837.         return "" if val is None else duration_string(val)
1838. 
1839.     def formfield(self, **kwargs):
1840.         return super().formfield(
1841.             **{
1842.                 "form_class": forms.DurationField,
1843.                 **kwargs,
1844.             }
1845.         )
1846. 
1847. 
1848. class EmailField(CharField):
1849.     default_validators = [validators.validate_email]
1850.     description = _("Email address")
1851. 
1852.     def __init__(self, *args, **kwargs):
1853.         # max_length=254 to be compliant with RFCs 3696 and 5321
1854.         kwargs.setdefault("max_length", 254)
1855.         super().__init__(*args, **kwargs)
1856. 
1857.     def deconstruct(self):
1858.         name, path, args, kwargs = super().deconstruct()
1859.         # We do not exclude max_length if it matches default as we want to change
1860.         # the default in future.
1861.         return name, path, args, kwargs
1862. 
1863.     def formfield(self, **kwargs):
1864.         # As with CharField, this will cause email validation to be performed
1865.         # twice.
1866.         return super().formfield(
1867.             **{
1868.                 "form_class": forms.EmailField,
1869.                 **kwargs,
1870.             }
1871.         )
1872. 
1873. 
1874. class FilePathField(Field):
1875.     description = _("File path")
1876. 
1877.     def __init__(
1878.         self,
1879.         verbose_name=None,
1880.         name=None,
1881.         path="",
1882.         match=None,
1883.         recursive=False,
1884.         allow_files=True,
1885.         allow_folders=False,
1886.         **kwargs,
1887.     ):
1888.         self.path, self.match, self.recursive = path, match, recursive
1889.         self.allow_files, self.allow_folders = allow_files, allow_folders
1890.         kwargs.setdefault("max_length", 100)
1891.         super().__init__(verbose_name, name, **kwargs)
1892. 
1893.     def check(self, **kwargs):
1894.         return [
1895.             *super().check(**kwargs),
1896.             *self._check_allowing_files_or_folders(**kwargs),
1897.         ]
1898. 
1899.     def _check_allowing_files_or_folders(self, **kwargs):
1900.         if not self.allow_files and not self.allow_folders:
1901.             return [
1902.                 checks.Error(
1903.                     "FilePathFields must have either 'allow_files' or 'allow_folders' "
1904.                     "set to True.",
1905.                     obj=self,
1906.                     id="fields.E140",
1907.                 )
1908.             ]
1909.         return []
1910. 
1911.     def deconstruct(self):
1912.         name, path, args, kwargs = super().deconstruct()
1913.         if self.path != "":
1914.             kwargs["path"] = self.path
1915.         if self.match is not None:
1916.             kwargs["match"] = self.match
1917.         if self.recursive is not False:
1918.             kwargs["recursive"] = self.recursive
1919.         if self.allow_files is not True:
1920.             kwargs["allow_files"] = self.allow_files
1921.         if self.allow_folders is not False:
1922.             kwargs["allow_folders"] = self.allow_folders
1923.         if kwargs.get("max_length") == 100:
1924.             del kwargs["max_length"]
1925.         return name, path, args, kwargs
1926. 
1927.     def get_prep_value(self, value):
1928.         value = super().get_prep_value(value)
1929.         if value is None:
1930.             return None
1931.         return str(value)
1932. 
1933.     def formfield(self, **kwargs):
1934.         return super().formfield(
1935.             **{
1936.                 "path": self.path() if callable(self.path) else self.path,
1937.                 "match": self.match,
1938.                 "recursive": self.recursive,
1939.                 "form_class": forms.FilePathField,
1940.                 "allow_files": self.allow_files,
1941.                 "allow_folders": self.allow_folders,
1942.                 **kwargs,
1943.             }
1944.         )
1945. 
1946.     def get_internal_type(self):
1947.         return "FilePathField"
1948. 
1949. 
1950. class FloatField(Field):
1951.     empty_strings_allowed = False
1952.     default_error_messages = {
1953.         "invalid": _("“%(value)s” value must be a float."),
1954.     }
1955.     description = _("Floating point number")
1956. 
1957.     def get_prep_value(self, value):
1958.         value = super().get_prep_value(value)
1959.         if value is None:
1960.             return None
1961.         try:
1962.             return float(value)
1963.         except (TypeError, ValueError) as e:
1964.             raise e.__class__(
1965.                 "Field '%s' expected a number but got %r." % (self.name, value),
1966.             ) from e
1967. 
1968.     def get_internal_type(self):
1969.         return "FloatField"
1970. 
1971.     def to_python(self, value):
1972.         if value is None:
1973.             return value
1974.         try:
1975.             return float(value)
1976.         except (TypeError, ValueError):
1977.             raise exceptions.ValidationError(
1978.                 self.error_messages["invalid"],
1979.                 code="invalid",
1980.                 params={"value": value},
1981.             )
1982. 
1983.     def formfield(self, **kwargs):
1984.         return super().formfield(
1985.             **{
1986.                 "form_class": forms.FloatField,
1987.                 **kwargs,
1988.             }
1989.         )
1990. 
1991. 
1992. class IntegerField(Field):
1993.     empty_strings_allowed = False
1994.     default_error_messages = {
1995.         "invalid": _("“%(value)s” value must be an integer."),
1996.     }
1997.     description = _("Integer")
1998. 
1999.     def check(self, **kwargs):
2000.         return [
2001.             *super().check(**kwargs),
2002.             *self._check_max_length_warning(),
2003.         ]
2004. 
2005.     def _check_max_length_warning(self):
2006.         if self.max_length is not None:
2007.             return [
2008.                 checks.Warning(
2009.                     "'max_length' is ignored when used with %s."
2010.                     % self.__class__.__name__,
2011.                     hint="Remove 'max_length' from field",
2012.                     obj=self,
2013.                     id="fields.W122",
2014.                 )
2015.             ]
2016.         return []
2017. 
2018.     @cached_property
2019.     def validators(self):
2020.         # These validators can't be added at field initialization time since
2021.         # they're based on values retrieved from `connection`.
2022.         validators_ = super().validators
2023.         internal_type = self.get_internal_type()
2024.         min_value, max_value = connection.ops.integer_field_range(internal_type)
2025.         if min_value is not None and not any(
2026.             (
2027.                 isinstance(validator, validators.MinValueValidator)
2028.                 and (
2029.                     validator.limit_value()
2030.                     if callable(validator.limit_value)
2031.                     else validator.limit_value
2032.                 )
2033.                 >= min_value
2034.             )
2035.             for validator in validators_
2036.         ):
2037.             validators_.append(validators.MinValueValidator(min_value))
2038.         if max_value is not None and not any(
2039.             (
2040.                 isinstance(validator, validators.MaxValueValidator)
2041.                 and (
2042.                     validator.limit_value()
2043.                     if callable(validator.limit_value)
2044.                     else validator.limit_value
2045.                 )
2046.                 <= max_value
2047.             )
2048.             for validator in validators_
2049.         ):
2050.             validators_.append(validators.MaxValueValidator(max_value))
2051.         return validators_
2052. 
2053.     def get_prep_value(self, value):
2054.         value = super().get_prep_value(value)
2055.         if value is None:
2056.             return None
2057.         try:
2058.             return int(value)
2059.         except (TypeError, ValueError) as e:
2060.             raise e.__class__(
2061.                 "Field '%s' expected a number but got %r." % (self.name, value),
2062.             ) from e
2063. 
2064.     def get_db_prep_value(self, value, connection, prepared=False):
2065.         value = super().get_db_prep_value(value, connection, prepared)
2066.         return connection.ops.adapt_integerfield_value(value, self.get_internal_type())
2067. 
2068.     def get_internal_type(self):
2069.         return "IntegerField"
2070. 
2071.     def to_python(self, value):
2072.         if value is None:
2073.             return value
2074.         try:
2075.             return int(value)
2076.         except (TypeError, ValueError):
2077.             raise exceptions.ValidationError(
2078.                 self.error_messages["invalid"],
2079.                 code="invalid",
2080.                 params={"value": value},
2081.             )
2082. 
2083.     def formfield(self, **kwargs):
2084.         return super().formfield(
2085.             **{
2086.                 "form_class": forms.IntegerField,
2087.                 **kwargs,
2088.             }
2089.         )
2090. 
2091. 
2092. class BigIntegerField(IntegerField):
2093.     description = _("Big (8 byte) integer")
2094.     MAX_BIGINT = 9223372036854775807
2095. 
2096.     def get_internal_type(self):
2097.         return "BigIntegerField"
2098. 
2099.     def formfield(self, **kwargs):
2100.         return super().formfield(
2101.             **{
2102.                 "min_value": -BigIntegerField.MAX_BIGINT - 1,
2103.                 "max_value": BigIntegerField.MAX_BIGINT,
2104.                 **kwargs,
2105.             }
2106.         )
2107. 
2108. 
2109. class SmallIntegerField(IntegerField):
2110.     description = _("Small integer")
2111. 
2112.     def get_internal_type(self):
2113.         return "SmallIntegerField"
2114. 
2115. 
2116. class IPAddressField(Field):
2117.     empty_strings_allowed = False
2118.     description = _("IPv4 address")
2119.     system_check_removed_details = {
2120.         "msg": (
2121.             "IPAddressField has been removed except for support in "
2122.             "historical migrations."
2123.         ),
2124.         "hint": "Use GenericIPAddressField instead.",
2125.         "id": "fields.E900",
2126.     }
2127. 
2128.     def __init__(self, *args, **kwargs):
2129.         kwargs["max_length"] = 15
2130.         super().__init__(*args, **kwargs)
2131. 
2132.     def deconstruct(self):
2133.         name, path, args, kwargs = super().deconstruct()
2134.         del kwargs["max_length"]
2135.         return name, path, args, kwargs
2136. 
2137.     def get_prep_value(self, value):
2138.         value = super().get_prep_value(value)
2139.         if value is None:
2140.             return None
2141.         return str(value)
2142. 
2143.     def get_internal_type(self):
2144.         return "IPAddressField"
2145. 
2146. 
2147. class GenericIPAddressField(Field):
2148.     empty_strings_allowed = False
2149.     description = _("IP address")
2150.     default_error_messages = {}
2151. 
2152.     def __init__(
2153.         self,
2154.         verbose_name=None,
2155.         name=None,
2156.         protocol="both",
2157.         unpack_ipv4=False,
2158.         *args,
2159.         **kwargs,
2160.     ):
2161.         self.unpack_ipv4 = unpack_ipv4
2162.         self.protocol = protocol
2163.         (
2164.             self.default_validators,
2165.             invalid_error_message,
2166.         ) = validators.ip_address_validators(protocol, unpack_ipv4)
2167.         self.default_error_messages["invalid"] = invalid_error_message
2168.         kwargs["max_length"] = 39
2169.         super().__init__(verbose_name, name, *args, **kwargs)
2170. 
2171.     def check(self, **kwargs):
2172.         return [
2173.             *super().check(**kwargs),
2174.             *self._check_blank_and_null_values(**kwargs),
2175.         ]
2176. 
2177.     def _check_blank_and_null_values(self, **kwargs):
2178.         if not getattr(self, "null", False) and getattr(self, "blank", False):
2179.             return [
2180.                 checks.Error(
2181.                     "GenericIPAddressFields cannot have blank=True if null=False, "
2182.                     "as blank values are stored as nulls.",
2183.                     obj=self,
2184.                     id="fields.E150",
2185.                 )
2186.             ]
2187.         return []
2188. 
2189.     def deconstruct(self):
2190.         name, path, args, kwargs = super().deconstruct()
2191.         if self.unpack_ipv4 is not False:
2192.             kwargs["unpack_ipv4"] = self.unpack_ipv4
2193.         if self.protocol != "both":
2194.             kwargs["protocol"] = self.protocol
2195.         if kwargs.get("max_length") == 39:
2196.             del kwargs["max_length"]
2197.         return name, path, args, kwargs
2198. 
2199.     def get_internal_type(self):
2200.         return "GenericIPAddressField"
2201. 
2202.     def to_python(self, value):
2203.         if value is None:
2204.             return None
2205.         if not isinstance(value, str):
2206.             value = str(value)
2207.         value = value.strip()
2208.         if ":" in value:
2209.             return clean_ipv6_address(
2210.                 value, self.unpack_ipv4, self.error_messages["invalid"]
2211.             )
2212.         return value
2213. 
2214.     def get_db_prep_value(self, value, connection, prepared=False):
2215.         if not prepared:
2216.             value = self.get_prep_value(value)
2217.         return connection.ops.adapt_ipaddressfield_value(value)
2218. 
2219.     def get_prep_value(self, value):
2220.         value = super().get_prep_value(value)
2221.         if value is None:
2222.             return None
2223.         if value and ":" in value:
2224.             try:
2225.                 return clean_ipv6_address(value, self.unpack_ipv4)
2226.             except exceptions.ValidationError:
2227.                 pass
2228.         return str(value)
2229. 
2230.     def formfield(self, **kwargs):
2231.         return super().formfield(
2232.             **{
2233.                 "protocol": self.protocol,
2234.                 "form_class": forms.GenericIPAddressField,
2235.                 **kwargs,
2236.             }
2237.         )
2238. 
2239. 
2240. class NullBooleanField(BooleanField):
2241.     default_error_messages = {
2242.         "invalid": _("“%(value)s” value must be either None, True or False."),
2243.         "invalid_nullable": _("“%(value)s” value must be either None, True or False."),
2244.     }
2245.     description = _("Boolean (Either True, False or None)")
2246.     system_check_removed_details = {
2247.         "msg": (
2248.             "NullBooleanField is removed except for support in historical "
2249.             "migrations."
2250.         ),
2251.         "hint": "Use BooleanField(null=True) instead.",
2252.         "id": "fields.E903",
2253.     }
2254. 
2255.     def __init__(self, *args, **kwargs):
2256.         kwargs["null"] = True
2257.         kwargs["blank"] = True
2258.         super().__init__(*args, **kwargs)
2259. 
2260.     def deconstruct(self):
2261.         name, path, args, kwargs = super().deconstruct()
2262.         del kwargs["null"]
2263.         del kwargs["blank"]
2264.         return name, path, args, kwargs
2265. 
2266. 
2267. class PositiveIntegerRelDbTypeMixin:
2268.     def __init_subclass__(cls, **kwargs):
2269.         super().__init_subclass__(**kwargs)
2270.         if not hasattr(cls, "integer_field_class"):
2271.             cls.integer_field_class = next(
2272.                 (
2273.                     parent
2274.                     for parent in cls.__mro__[1:]
2275.                     if issubclass(parent, IntegerField)
2276.                 ),
2277.                 None,
2278.             )
2279. 
2280.     def rel_db_type(self, connection):
2281.         """
2282.         Return the data type that a related field pointing to this field should
2283.         use. In most cases, a foreign key pointing to a positive integer
2284.         primary key will have an integer column data type but some databases
2285.         (e.g. MySQL) have an unsigned integer type. In that case
2286.         (related_fields_match_type=True), the primary key should return its
2287.         db_type.
2288.         """
2289.         if connection.features.related_fields_match_type:
2290.             return self.db_type(connection)
2291.         else:
2292.             return self.integer_field_class().db_type(connection=connection)
2293. 
2294. 
2295. class PositiveBigIntegerField(PositiveIntegerRelDbTypeMixin, BigIntegerField):
2296.     description = _("Positive big integer")
2297. 
2298.     def get_internal_type(self):
2299.         return "PositiveBigIntegerField"
2300. 
2301.     def formfield(self, **kwargs):
2302.         return super().formfield(
2303.             **{
2304.                 "min_value": 0,
2305.                 **kwargs,
2306.             }
2307.         )
2308. 
2309. 
2310. class PositiveIntegerField(PositiveIntegerRelDbTypeMixin, IntegerField):
2311.     description = _("Positive integer")
2312. 
2313.     def get_internal_type(self):
2314.         return "PositiveIntegerField"
2315. 
2316.     def formfield(self, **kwargs):
2317.         return super().formfield(
2318.             **{
2319.                 "min_value": 0,
2320.                 **kwargs,
2321.             }
2322.         )
2323. 
2324. 
2325. class PositiveSmallIntegerField(PositiveIntegerRelDbTypeMixin, SmallIntegerField):
2326.     description = _("Positive small integer")
2327. 
2328.     def get_internal_type(self):
2329.         return "PositiveSmallIntegerField"
2330. 
2331.     def formfield(self, **kwargs):
2332.         return super().formfield(
2333.             **{
2334.                 "min_value": 0,
2335.                 **kwargs,
2336.             }
2337.         )
2338. 
2339. 
2340. class SlugField(CharField):
2341.     default_validators = [validators.validate_slug]
2342.     description = _("Slug (up to %(max_length)s)")
2343. 
2344.     def __init__(
2345.         self, *args, max_length=50, db_index=True, allow_unicode=False, **kwargs
2346.     ):
2347.         self.allow_unicode = allow_unicode
2348.         if self.allow_unicode:
2349.             self.default_validators = [validators.validate_unicode_slug]
2350.         super().__init__(*args, max_length=max_length, db_index=db_index, **kwargs)
2351. 
2352.     def deconstruct(self):
2353.         name, path, args, kwargs = super().deconstruct()
2354.         if kwargs.get("max_length") == 50:
2355.             del kwargs["max_length"]
2356.         if self.db_index is False:
2357.             kwargs["db_index"] = False
2358.         else:
2359.             del kwargs["db_index"]
2360.         if self.allow_unicode is not False:
2361.             kwargs["allow_unicode"] = self.allow_unicode
2362.         return name, path, args, kwargs
2363. 
2364.     def get_internal_type(self):
2365.         return "SlugField"
2366. 
2367.     def formfield(self, **kwargs):
2368.         return super().formfield(
2369.             **{
2370.                 "form_class": forms.SlugField,
2371.                 "allow_unicode": self.allow_unicode,
2372.                 **kwargs,
2373.             }
2374.         )
2375. 
2376. 
2377. class TextField(Field):
2378.     description = _("Text")
2379. 
2380.     def __init__(self, *args, db_collation=None, **kwargs):
2381.         super().__init__(*args, **kwargs)
2382.         self.db_collation = db_collation
2383. 
2384.     def check(self, **kwargs):
2385.         databases = kwargs.get("databases") or []
2386.         return [
2387.             *super().check(**kwargs),
2388.             *self._check_db_collation(databases),
2389.         ]
2390. 
2391.     def _check_db_collation(self, databases):
2392.         errors = []
2393.         for db in databases:
2394.             if not router.allow_migrate_model(db, self.model):
2395.                 continue
2396.             connection = connections[db]
2397.             if not (
2398.                 self.db_collation is None
2399.                 or "supports_collation_on_textfield"
2400.                 in self.model._meta.required_db_features
2401.                 or connection.features.supports_collation_on_textfield
2402.             ):
2403.                 errors.append(
2404.                     checks.Error(
2405.                         "%s does not support a database collation on "
2406.                         "TextFields." % connection.display_name,
2407.                         obj=self,
2408.                         id="fields.E190",
2409.                     ),
2410.                 )
2411.         return errors
2412. 
2413.     def db_parameters(self, connection):
2414.         db_params = super().db_parameters(connection)
2415.         db_params["collation"] = self.db_collation
2416.         return db_params
2417. 
2418.     def get_internal_type(self):
2419.         return "TextField"
2420. 
2421.     def to_python(self, value):
2422.         if isinstance(value, str) or value is None:
2423.             return value
2424.         return str(value)
2425. 
2426.     def get_prep_value(self, value):
2427.         value = super().get_prep_value(value)
2428.         return self.to_python(value)
2429. 
2430.     def formfield(self, **kwargs):
2431.         # Passing max_length to forms.CharField means that the value's length
2432.         # will be validated twice. This is considered acceptable since we want
2433.         # the value in the form field (to pass into widget for example).
2434.         return super().formfield(
2435.             **{
2436.                 "max_length": self.max_length,
2437.                 **({} if self.choices is not None else {"widget": forms.Textarea}),
2438.                 **kwargs,
2439.             }
2440.         )
2441. 
2442.     def deconstruct(self):
2443.         name, path, args, kwargs = super().deconstruct()
2444.         if self.db_collation:
2445.             kwargs["db_collation"] = self.db_collation
2446.         return name, path, args, kwargs
2447. 
2448. 
2449. class TimeField(DateTimeCheckMixin, Field):
2450.     empty_strings_allowed = False
2451.     default_error_messages = {
2452.         "invalid": _(
2453.             "“%(value)s” value has an invalid format. It must be in "
2454.             "HH:MM[:ss[.uuuuuu]] format."
2455.         ),
2456.         "invalid_time": _(
2457.             "“%(value)s” value has the correct format "
2458.             "(HH:MM[:ss[.uuuuuu]]) but it is an invalid time."
2459.         ),
2460.     }
2461.     description = _("Time")
2462. 
2463.     def __init__(
2464.         self, verbose_name=None, name=None, auto_now=False, auto_now_add=False, **kwargs
2465.     ):
2466.         self.auto_now, self.auto_now_add = auto_now, auto_now_add
2467.         if auto_now or auto_now_add:
2468.             kwargs["editable"] = False
2469.             kwargs["blank"] = True
2470.         super().__init__(verbose_name, name, **kwargs)
2471. 
2472.     def _check_fix_default_value(self):
2473.         """
2474.         Warn that using an actual date or datetime value is probably wrong;
2475.         it's only evaluated on server startup.
2476.         """
2477.         if not self.has_default():
2478.             return []
2479. 
2480.         value = self.default
2481.         if isinstance(value, datetime.datetime):
2482.             now = None
2483.         elif isinstance(value, datetime.time):
2484.             now = _get_naive_now()
2485.             # This will not use the right date in the race condition where now
2486.             # is just before the date change and value is just past 0:00.
2487.             value = datetime.datetime.combine(now.date(), value)
2488.         else:
2489.             # No explicit time / datetime value -- no checks necessary
2490.             return []
2491.         # At this point, value is a datetime object.
2492.         return self._check_if_value_fixed(value, now=now)
2493. 
2494.     def deconstruct(self):
2495.         name, path, args, kwargs = super().deconstruct()
2496.         if self.auto_now is not False:
2497.             kwargs["auto_now"] = self.auto_now
2498.         if self.auto_now_add is not False:
2499.             kwargs["auto_now_add"] = self.auto_now_add
2500.         if self.auto_now or self.auto_now_add:


File: django/db/models/fields/__init__.py
Line number range: 2501 - 3501
Content:
2501.             del kwargs["blank"]
2502.             del kwargs["editable"]
2503.         return name, path, args, kwargs
2504. 
2505.     def get_internal_type(self):
2506.         return "TimeField"
2507. 
2508.     def to_python(self, value):
2509.         if value is None:
2510.             return None
2511.         if isinstance(value, datetime.time):
2512.             return value
2513.         if isinstance(value, datetime.datetime):
2514.             # Not usually a good idea to pass in a datetime here (it loses
2515.             # information), but this can be a side-effect of interacting with a
2516.             # database backend (e.g. Oracle), so we'll be accommodating.
2517.             return value.time()
2518. 
2519.         try:
2520.             parsed = parse_time(value)
2521.             if parsed is not None:
2522.                 return parsed
2523.         except ValueError:
2524.             raise exceptions.ValidationError(
2525.                 self.error_messages["invalid_time"],
2526.                 code="invalid_time",
2527.                 params={"value": value},
2528.             )
2529. 
2530.         raise exceptions.ValidationError(
2531.             self.error_messages["invalid"],
2532.             code="invalid",
2533.             params={"value": value},
2534.         )
2535. 
2536.     def pre_save(self, model_instance, add):
2537.         if self.auto_now or (self.auto_now_add and add):
2538.             value = datetime.datetime.now().time()
2539.             setattr(model_instance, self.attname, value)
2540.             return value
2541.         else:
2542.             return super().pre_save(model_instance, add)
2543. 
2544.     def get_prep_value(self, value):
2545.         value = super().get_prep_value(value)
2546.         return self.to_python(value)
2547. 
2548.     def get_db_prep_value(self, value, connection, prepared=False):
2549.         # Casts times into the format expected by the backend
2550.         if not prepared:
2551.             value = self.get_prep_value(value)
2552.         return connection.ops.adapt_timefield_value(value)
2553. 
2554.     def value_to_string(self, obj):
2555.         val = self.value_from_object(obj)
2556.         return "" if val is None else val.isoformat()
2557. 
2558.     def formfield(self, **kwargs):
2559.         return super().formfield(
2560.             **{
2561.                 "form_class": forms.TimeField,
2562.                 **kwargs,
2563.             }
2564.         )
2565. 
2566. 
2567. class URLField(CharField):
2568.     default_validators = [validators.URLValidator()]
2569.     description = _("URL")
2570. 
2571.     def __init__(self, verbose_name=None, name=None, **kwargs):
2572.         kwargs.setdefault("max_length", 200)
2573.         super().__init__(verbose_name, name, **kwargs)
2574. 
2575.     def deconstruct(self):
2576.         name, path, args, kwargs = super().deconstruct()
2577.         if kwargs.get("max_length") == 200:
2578.             del kwargs["max_length"]
2579.         return name, path, args, kwargs
2580. 
2581.     def formfield(self, **kwargs):
2582.         # As with CharField, this will cause URL validation to be performed
2583.         # twice.
2584.         return super().formfield(
2585.             **{
2586.                 "form_class": forms.URLField,
2587.                 **kwargs,
2588.             }
2589.         )
2590. 
2591. 
2592. class BinaryField(Field):
2593.     description = _("Raw binary data")
2594.     empty_values = [None, b""]
2595. 
2596.     def __init__(self, *args, **kwargs):
2597.         kwargs.setdefault("editable", False)
2598.         super().__init__(*args, **kwargs)
2599.         if self.max_length is not None:
2600.             self.validators.append(validators.MaxLengthValidator(self.max_length))
2601. 
2602.     def check(self, **kwargs):
2603.         return [*super().check(**kwargs), *self._check_str_default_value()]
2604. 
2605.     def _check_str_default_value(self):
2606.         if self.has_default() and isinstance(self.default, str):
2607.             return [
2608.                 checks.Error(
2609.                     "BinaryField's default cannot be a string. Use bytes "
2610.                     "content instead.",
2611.                     obj=self,
2612.                     id="fields.E170",
2613.                 )
2614.             ]
2615.         return []
2616. 
2617.     def deconstruct(self):
2618.         name, path, args, kwargs = super().deconstruct()
2619.         if self.editable:
2620.             kwargs["editable"] = True
2621.         else:
2622.             del kwargs["editable"]
2623.         return name, path, args, kwargs
2624. 
2625.     def get_internal_type(self):
2626.         return "BinaryField"
2627. 
2628.     def get_placeholder(self, value, compiler, connection):
2629.         return connection.ops.binary_placeholder_sql(value)
2630. 
2631.     def get_default(self):
2632.         if self.has_default() and not callable(self.default):
2633.             return self.default
2634.         default = super().get_default()
2635.         if default == "":
2636.             return b""
2637.         return default
2638. 
2639.     def get_db_prep_value(self, value, connection, prepared=False):
2640.         value = super().get_db_prep_value(value, connection, prepared)
2641.         if value is not None:
2642.             return connection.Database.Binary(value)
2643.         return value
2644. 
2645.     def value_to_string(self, obj):
2646.         """Binary data is serialized as base64"""
2647.         return b64encode(self.value_from_object(obj)).decode("ascii")
2648. 
2649.     def to_python(self, value):
2650.         # If it's a string, it should be base64-encoded data
2651.         if isinstance(value, str):
2652.             return memoryview(b64decode(value.encode("ascii")))
2653.         return value
2654. 
2655. 
2656. class UUIDField(Field):
2657.     default_error_messages = {
2658.         "invalid": _("“%(value)s” is not a valid UUID."),
2659.     }
2660.     description = _("Universally unique identifier")
2661.     empty_strings_allowed = False
2662. 
2663.     def __init__(self, verbose_name=None, **kwargs):
2664.         kwargs["max_length"] = 32
2665.         super().__init__(verbose_name, **kwargs)
2666. 
2667.     def deconstruct(self):
2668.         name, path, args, kwargs = super().deconstruct()
2669.         del kwargs["max_length"]
2670.         return name, path, args, kwargs
2671. 
2672.     def get_internal_type(self):
2673.         return "UUIDField"
2674. 
2675.     def get_prep_value(self, value):
2676.         value = super().get_prep_value(value)
2677.         return self.to_python(value)
2678. 
2679.     def get_db_prep_value(self, value, connection, prepared=False):
2680.         if value is None:
2681.             return None
2682.         if not isinstance(value, uuid.UUID):
2683.             value = self.to_python(value)
2684. 
2685.         if connection.features.has_native_uuid_field:
2686.             return value
2687.         return value.hex
2688. 
2689.     def to_python(self, value):
2690.         if value is not None and not isinstance(value, uuid.UUID):
2691.             input_form = "int" if isinstance(value, int) else "hex"
2692.             try:
2693.                 return uuid.UUID(**{input_form: value})
2694.             except (AttributeError, ValueError):
2695.                 raise exceptions.ValidationError(
2696.                     self.error_messages["invalid"],
2697.                     code="invalid",
2698.                     params={"value": value},
2699.                 )
2700.         return value
2701. 
2702.     def formfield(self, **kwargs):
2703.         return super().formfield(
2704.             **{
2705.                 "form_class": forms.UUIDField,
2706.                 **kwargs,
2707.             }
2708.         )
2709. 
2710. 
2711. class AutoFieldMixin:
2712.     db_returning = True
2713. 
2714.     def __init__(self, *args, **kwargs):
2715.         kwargs["blank"] = True
2716.         super().__init__(*args, **kwargs)
2717. 
2718.     def check(self, **kwargs):
2719.         return [
2720.             *super().check(**kwargs),
2721.             *self._check_primary_key(),
2722.         ]
2723. 
2724.     def _check_primary_key(self):
2725.         if not self.primary_key:
2726.             return [
2727.                 checks.Error(
2728.                     "AutoFields must set primary_key=True.",
2729.                     obj=self,
2730.                     id="fields.E100",
2731.                 ),
2732.             ]
2733.         else:
2734.             return []
2735. 
2736.     def deconstruct(self):
2737.         name, path, args, kwargs = super().deconstruct()
2738.         del kwargs["blank"]
2739.         kwargs["primary_key"] = True
2740.         return name, path, args, kwargs
2741. 
2742.     def validate(self, value, model_instance):
2743.         pass
2744. 
2745.     def get_db_prep_value(self, value, connection, prepared=False):
2746.         if not prepared:
2747.             value = self.get_prep_value(value)
2748.             value = connection.ops.validate_autopk_value(value)
2749.         return value
2750. 
2751.     def contribute_to_class(self, cls, name, **kwargs):
2752.         if cls._meta.auto_field:
2753.             raise ValueError(
2754.                 "Model %s can't have more than one auto-generated field."
2755.                 % cls._meta.label
2756.             )
2757.         super().contribute_to_class(cls, name, **kwargs)
2758.         cls._meta.auto_field = self
2759. 
2760.     def formfield(self, **kwargs):
2761.         return None
2762. 
2763. 
2764. class AutoFieldMeta(type):
2765.     """
2766.     Metaclass to maintain backward inheritance compatibility for AutoField.
2767. 
2768.     It is intended that AutoFieldMixin become public API when it is possible to
2769.     create a non-integer automatically-generated field using column defaults
2770.     stored in the database.
2771. 
2772.     In many areas Django also relies on using isinstance() to check for an
2773.     automatically-generated field as a subclass of AutoField. A new flag needs
2774.     to be implemented on Field to be used instead.
2775. 
2776.     When these issues have been addressed, this metaclass could be used to
2777.     deprecate inheritance from AutoField and use of isinstance() with AutoField
2778.     for detecting automatically-generated fields.
2779.     """
2780. 
2781.     @property
2782.     def _subclasses(self):
2783.         return (BigAutoField, SmallAutoField)
2784. 
2785.     def __instancecheck__(self, instance):
2786.         return isinstance(instance, self._subclasses) or super().__instancecheck__(
2787.             instance
2788.         )
2789. 
2790.     def __subclasscheck__(self, subclass):
2791.         return issubclass(subclass, self._subclasses) or super().__subclasscheck__(
2792.             subclass
2793.         )
2794. 
2795. 
2796. class AutoField(AutoFieldMixin, IntegerField, metaclass=AutoFieldMeta):
2797.     def get_internal_type(self):
2798.         return "AutoField"
2799. 
2800.     def rel_db_type(self, connection):
2801.         return IntegerField().db_type(connection=connection)
2802. 
2803. 
2804. class BigAutoField(AutoFieldMixin, BigIntegerField):
2805.     def get_internal_type(self):
2806.         return "BigAutoField"
2807. 
2808.     def rel_db_type(self, connection):
2809.         return BigIntegerField().db_type(connection=connection)
2810. 
2811. 
2812. class SmallAutoField(AutoFieldMixin, SmallIntegerField):
2813.     def get_internal_type(self):
2814.         return "SmallAutoField"
2815. 
2816.     def rel_db_type(self, connection):
2817.         return SmallIntegerField().db_type(connection=connection)

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-24 05:49:47,694 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="The user requested the full content of the file 'django/db/models/fields/__init__.py'. The provided context contains the entire file content, so I am returning the whole file.", relative_path='django/db/models/fields/__init__.py', start_line=1, end_line=2817)]
2025-12-24 05:49:47,699 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of the file django/db/models/fields/__init__.py.
2025-12-24 05:49:47,699 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-24 05:49:47,699 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-24 05:49:47,700 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 2 existing contexts
2025-12-24 05:49:47,700 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 3 total contexts (removed 0 duplicates)
2025-12-24 05:49:47,700 - thread-125239516182208.prometheus_context_collector.lang_graph.nodes.context_refine_node - INFO - Reached max_refined_query_loop, not asking for more context
2025-12-24 05:49:47,701 - thread-125239516182208.prometheus_context_collector - INFO - Successfully retrieved 3 context snippets
