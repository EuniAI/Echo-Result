2025-12-21 13:50:01,898 - thread-136261515871936.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: Rational calc value error

Description: python 3.11, sympy 1.11.1
when calc Rational('0.5', '100'), the value is 1/100100; but Rational(0.5, 100) the value is 1/200, this value is the true value, and the version of sympy 1.8 is normal

Patch information:
diff --git a/sympy/core/numbers.py b/sympy/core/numbers.py
index 52f7ea45ad..96d0bdbcc4 100644
--- a/sympy/core/numbers.py
+++ b/sympy/core/numbers.py
@@ -1625,19 +1625,26 @@ def __new__(cls, p, q=None, gcd=None):
             q = 1
             gcd = 1
 
+        # Normalize p and q to integer numerator/denominator pairs before arithmetic
         if not isinstance(p, SYMPY_INTS):
             p = Rational(p)
-            q *= p.q
-            p = p.p
+            p_num = p.p
+            p_den = p.q
         else:
-            p = int(p)
+            p_num = int(p)
+            p_den = 1
 
         if not isinstance(q, SYMPY_INTS):
             q = Rational(q)
-            p *= q.q
-            q = q.p
+            q_num = q.p
+            q_den = q.q
         else:
-            q = int(q)
+            q_num = int(q)
+            q_den = 1
+
+        # Compute p/q as (p_num/p_den) / (q_num/q_den) = (p_num*q_den)/(p_den*q_num)
+        p = p_num * q_den
+        q = p_den * q_num
 
         # p and q are now ints
         if q == 0:


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-12-21 13:50:01,973 - thread-136261515871936.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sympy
├── .ci
|   ├── README.rst
|   ├── generate_durations_log.sh
|   └── parse_durations_log.py
├── .circleci
|   └── config.yml
├── .github
|   └── workflows
|       ├── checkconflict.yml
|       ├── ci-sage.yml
|       ├── comment-on-pr.yml
|       ├── docs-preview.yml
|       ├── release.yml
|       └── runtests.yml
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── PULL_REQUEST_TEMPLATE.md
├── README.md
├── bin
|   ├── ask_update.py
|   ├── coverage_doctest.py
|   ├── coverage_report.py
|   ├── generate_module_list.py
|   ├── generate_test_list.py
|   ├── get_sympy.py
|   ├── mailmap_check.py
|   ├── sympy_time.py
|   ├── sympy_time_cache.py
|   ├── test_executable.py
|   ├── test_external_imports.py
|   ├── test_import.py
|   ├── test_optional_dependencies.py
|   ├── test_py2_import.py
|   ├── test_setup.py
|   ├── test_sphinx.sh
|   ├── test_submodule_imports.py
|   ├── test_symengine.py
|   └── test_tensorflow.py
├── codecov.yml
├── conftest.py
├── data
|   └── TeXmacs
|       ├── bin
|       └── progs
├── doc
|   ├── README.rst
|   ├── api
|   |   ├── conf.py
|   |   └── index.rst
|   ├── aptinstall.sh
|   ├── cheatsheet
|   ├── ext
|   |   ├── convert-svg-to-pdf.py
|   |   ├── docscrape.py
|   |   ├── docscrape_sphinx.py
|   |   └── numpydoc.py
|   ├── generate_logos.py
|   ├── man
|   |   └── isympy.xml
|   ├── requirements.txt
|   └── src
|       ├── _pygments
|       |   └── styles.py
|       ├── _static
|       |   └── custom.css
|       ├── _templates
|       |   └── sidebar
|       |       └── versions.html
|       ├── citing.md
|       ├── conf.py
|       ├── contributing
|       |   ├── build-docs.rst
|       |   ├── debug.rst
|       |   ├── dependencies.md
|       |   ├── deprecations.md
|       |   ├── dev-setup.rst
|       |   ├── docstring.rst
|       |   ├── documentation-style-guide.rst
|       |   ├── index.rst
|       |   └── make-a-contribution.rst
|       ├── explanation
|       |   ├── active-deprecations.md
|       |   ├── glossary.md
|       |   ├── gotchas.rst
|       |   ├── index.rst
|       |   ├── solve_output.rst
|       |   └── special_topics
|       |       ├── classification.rst
|       |       ├── finite_diff_derivatives.rst
|       |       └── index.rst
|       ├── guides
|       |   ├── assumptions.rst
|       |   ├── booleans.rst
|       |   ├── custom-functions.md
|       |   ├── index.rst
|       |   └── solving
|       |       ├── find-roots-polynomial.md
|       |       ├── index.md
|       |       ├── reduce-inequalities-algebraically.md
|       |       ├── solve-diophantine-equation.md
|       |       ├── solve-equation-algebraically.md
|       |       ├── solve-matrix-equation.md
|       |       ├── solve-numerically.md
|       |       ├── solve-ode.md
|       |       ├── solve-system-of-equations-algebraically.md
|       |       └── solving-guidance.md
|       ├── index.rst
|       ├── install.md
|       ├── logo
|       |   └── info.txt
|       ├── modules
|       |   ├── abc.rst
|       |   ├── algebras.rst
|       |   ├── assumptions
|       |   |   ├── ask.rst
|       |   |   ├── assume.rst
|       |   |   ├── index.rst
|       |   |   ├── predicates.rst
|       |   |   └── refine.rst
|       |   ├── calculus
|       |   |   └── index.rst
|       |   ├── categories.rst
|       |   ├── codegen.rst
|       |   ├── combinatorics
|       |   |   ├── fp_groups.rst
|       |   |   ├── graycode.rst
|       |   |   ├── group_constructs.rst
|       |   |   ├── group_numbers.rst
|       |   |   ├── index.rst
|       |   |   ├── named_groups.rst
|       |   |   ├── partitions.rst
|       |   |   ├── pc_groups.rst
|       |   |   ├── perm_groups.rst
|       |   |   ├── permutations.rst
|       |   |   ├── polyhedron.rst
|       |   |   ├── prufer.rst
|       |   |   ├── subsets.rst
|       |   |   ├── tensor_can.rst
|       |   |   ├── testutil.rst
|       |   |   └── util.rst
|       |   ├── concrete.rst
|       |   ├── core.rst
|       |   ├── crypto.rst
|       |   ├── diffgeom.rst
|       |   ├── discrete.rst
|       |   ├── evalf.rst
|       |   ├── functions
|       |   |   ├── combinatorial.rst
|       |   |   ├── elementary.rst
|       |   |   ├── index.rst
|       |   |   └── special.rst
|       |   ├── geometry
|       |   |   ├── curves.rst
|       |   |   ├── ellipses.rst
|       |   |   ├── entities.rst
|       |   |   ├── index.rst
|       |   |   ├── lines.rst
|       |   |   ├── plane.rst
|       |   |   ├── points.rst
|       |   |   ├── polygons.rst
|       |   |   └── utils.rst
|       |   ├── holonomic
|       |   |   ├── about.rst
|       |   |   ├── convert.rst
|       |   |   ├── index.rst
|       |   |   ├── internal.rst
|       |   |   ├── operations.rst
|       |   |   ├── represent.rst
|       |   |   └── uses.rst
|       |   ├── integrals
|       |   |   ├── g-functions.rst
|       |   |   ├── index.rst
|       |   |   └── integrals.rst
|       |   ├── interactive.rst
|       |   ├── liealgebras
|       |   |   └── index.rst
|       |   ├── logic.rst
|       |   ├── matrices
|       |   |   ├── common.rst
|       |   |   ├── dense.rst
|       |   |   ├── expressions.rst
|       |   |   ├── immutablematrices.rst
|       |   |   ├── index.rst
|       |   |   ├── matrices.rst
|       |   |   ├── normalforms.rst
|       |   |   ├── sparse.rst
|       |   |   └── sparsetools.rst
|       |   ├── ntheory.rst
|       |   ├── numeric-computation.rst
|       |   ├── parsing.rst
|       |   ├── physics
|       |   |   ├── continuum_mechanics
|       |   |   ├── control
|       |   |   ├── hep
|       |   |   ├── hydrogen.rst
|       |   |   ├── matrices.rst
|       |   |   ├── mechanics
|       |   |   ├── optics
|       |   |   ├── paulialgebra.rst
|       |   |   ├── qho_1d.rst
|       |   |   ├── quantum
|       |   |   ├── secondquant.rst
|       |   |   ├── sho.rst
|       |   |   ├── units
|       |   |   ├── vector
|       |   |   └── wigner.rst
|       |   ├── plotting.rst
|       |   ├── polys
|       |   |   ├── agca.rst
|       |   |   ├── basics.rst
|       |   |   ├── domainmatrix.rst
|       |   |   ├── domainsintro.rst
|       |   |   ├── domainsref.rst
|       |   |   ├── index.rst
|       |   |   ├── internals.rst
|       |   |   ├── literature.rst
|       |   |   ├── numberfields.rst
|       |   |   ├── reference.rst
|       |   |   ├── ringseries.rst
|       |   |   ├── solvers.rst
|       |   |   └── wester.rst
|       |   ├── printing.rst
|       |   ├── rewriting.rst
|       |   ├── series
|       |   |   ├── formal.rst
|       |   |   ├── fourier.rst
|       |   |   ├── index.rst
|       |   |   ├── limitseq.rst
|       |   |   ├── sequences.rst
|       |   |   └── series.rst
|       |   ├── sets.rst
|       |   ├── simplify
|       |   |   ├── fu.rst
|       |   |   ├── hyperexpand.rst
|       |   |   ├── index.rst
|       |   |   └── simplify.rst
|       |   ├── solvers
|       |   |   ├── diophantine.rst
|       |   |   ├── index.rst
|       |   |   ├── inequalities.rst
|       |   |   ├── ode.rst
|       |   |   ├── pde.rst
|       |   |   ├── solvers.rst
|       |   |   └── solveset.rst
|       |   ├── stats.rst
|       |   ├── tensor
|       |   |   ├── array.rst
|       |   |   ├── array_expressions.rst
|       |   |   ├── index.rst
|       |   |   ├── index_methods.rst
|       |   |   ├── indexed.rst
|       |   |   ├── tensor.rst
|       |   |   └── toperators.rst
|       |   ├── testing
|       |   |   ├── index.rst
|       |   |   ├── pytest.rst
|       |   |   ├── randtest.rst
|       |   |   └── runtests.rst
|       |   ├── utilities
|       |   |   ├── autowrap.rst
|       |   |   ├── codegen.rst
|       |   |   ├── decorator.rst
|       |   |   ├── enumerative.rst
|       |   |   ├── exceptions.rst
|       |   |   ├── index.rst
|       |   |   ├── iterables.rst
|       |   |   ├── lambdify.rst
|       |   |   ├── memoization.rst
|       |   |   ├── misc.rst
|       |   |   ├── pkgdata.rst
|       |   |   ├── source.rst
|       |   |   └── timeutils.rst
|       |   └── vector
|       |       ├── api
|       |       ├── basics.rst
|       |       ├── coordsys.rst
|       |       ├── examples.rst
|       |       ├── fields.rst
|       |       ├── index.rst
|       |       ├── intro.rst
|       |       └── vector_integration.rst
|       ├── pics
|       ├── reference
|       |   ├── index.rst
|       |   └── public
|       |       ├── basics
|       |       ├── codegeneration
|       |       ├── logic
|       |       ├── matrices
|       |       ├── numbertheory
|       |       ├── physics
|       |       ├── topics
|       |       └── utilities
|       └── tutorials
|           ├── index.rst
|           └── intro-tutorial
|               ├── basic_operations.rst
|               ├── calculus.rst
|               ├── features.rst
|               ├── gotchas.rst
|               ├── index.rst
|               ├── intro.rst
|               ├── manipulation.rst
|               ├── matrices.rst
|               ├── next.rst
|               ├── preliminaries.rst
|               ├── printing.rst
|               ├── simplification.rst
|               └── solvers.rst
├── examples
|   ├── advanced
|   |   ├── autowrap_integrators.py
|   |   ├── autowrap_ufuncify.py
|   |   ├── curvilinear_coordinates.py
|   |   ├── dense_coding_example.py
|   |   ├── fem.py
|   |   ├── gibbs_phenomenon.py
|   |   ├── grover_example.py
|   |   ├── hydrogen.py
|   |   ├── pidigits.py
|   |   ├── pyglet_plotting.py
|   |   ├── qft.py
|   |   └── relativity.py
|   ├── all.py
|   ├── beginner
|   |   ├── basic.py
|   |   ├── differentiation.py
|   |   ├── expansion.py
|   |   ├── functions.py
|   |   ├── limits_examples.py
|   |   ├── plot_examples.py
|   |   ├── plotting_nice_plot.py
|   |   ├── precision.py
|   |   ├── print_pretty.py
|   |   ├── series.py
|   |   └── substitution.py
|   ├── intermediate
|   |   ├── coupled_cluster.py
|   |   ├── differential_equations.py
|   |   ├── infinite_1d_box.py
|   |   ├── mplot2d.py
|   |   ├── mplot3d.py
|   |   ├── partial_differential_eqs.py
|   |   ├── print_gtk.py
|   |   ├── sample.py
|   |   ├── trees.py
|   |   └── vandermonde.py
|   └── notebooks
|       └── README.txt
├── isympy.py
├── release
|   ├── README.md
|   ├── authors.py
|   ├── build_docs.py
|   ├── ci_release_script.sh
|   ├── compare_tar_against_git.py
|   ├── github_release.py
|   ├── helpers.py
|   ├── releasecheck.py
|   ├── sha256.py
|   └── update_docs.py
├── setup.py
├── setupegg.py
└── sympy
    ├── __init__.py
    ├── abc.py
    ├── algebras
    |   ├── __init__.py
    |   ├── quaternion.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_quaternion.py
    ├── assumptions
    |   ├── __init__.py
    |   ├── ask.py
    |   ├── ask_generated.py
    |   ├── assume.py
    |   ├── cnf.py
    |   ├── facts.py
    |   ├── handlers
    |   |   ├── __init__.py
    |   |   ├── calculus.py
    |   |   ├── common.py
    |   |   ├── matrices.py
    |   |   ├── ntheory.py
    |   |   ├── order.py
    |   |   └── sets.py
    |   ├── predicates
    |   |   ├── __init__.py
    |   |   ├── calculus.py
    |   |   ├── common.py
    |   |   ├── matrices.py
    |   |   ├── ntheory.py
    |   |   ├── order.py
    |   |   └── sets.py
    |   ├── refine.py
    |   ├── relation
    |   |   ├── __init__.py
    |   |   ├── binrel.py
    |   |   └── equality.py
    |   ├── satask.py
    |   ├── sathandlers.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_assumptions_2.py
    |   |   ├── test_context.py
    |   |   ├── test_matrices.py
    |   |   ├── test_query.py
    |   |   ├── test_refine.py
    |   |   ├── test_satask.py
    |   |   ├── test_sathandlers.py
    |   |   └── test_wrapper.py
    |   └── wrapper.py
    ├── benchmarks
    |   ├── __init__.py
    |   ├── bench_discrete_log.py
    |   ├── bench_meijerint.py
    |   └── bench_symbench.py
    ├── calculus
    |   ├── __init__.py
    |   ├── accumulationbounds.py
    |   ├── euler.py
    |   ├── finite_diff.py
    |   ├── singularities.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_accumulationbounds.py
    |   |   ├── test_euler.py
    |   |   ├── test_finite_diff.py
    |   |   ├── test_singularities.py
    |   |   └── test_util.py
    |   └── util.py
    ├── categories
    |   ├── __init__.py
    |   ├── baseclasses.py
    |   ├── diagram_drawing.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_baseclasses.py
    |       └── test_drawing.py
    ├── codegen
    |   ├── __init__.py
    |   ├── abstract_nodes.py
    |   ├── algorithms.py
    |   ├── approximations.py
    |   ├── ast.py
    |   ├── cfunctions.py
    |   ├── cnodes.py
    |   ├── cutils.py
    |   ├── cxxnodes.py
    |   ├── fnodes.py
    |   ├── futils.py
    |   ├── matrix_nodes.py
    |   ├── numpy_nodes.py
    |   ├── pynodes.py
    |   ├── pyutils.py
    |   ├── rewriting.py
    |   ├── scipy_nodes.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_abstract_nodes.py
    |       ├── test_algorithms.py
    |       ├── test_applications.py
    |       ├── test_approximations.py
    |       ├── test_ast.py
    |       ├── test_cfunctions.py
    |       ├── test_cnodes.py
    |       ├── test_cxxnodes.py
    |       ├── test_fnodes.py
    |       ├── test_numpy_nodes.py
    |       ├── test_pynodes.py
    |       ├── test_pyutils.py
    |       ├── test_rewriting.py
    |       └── test_scipy_nodes.py
    ├── combinatorics
    |   ├── __init__.py
    |   ├── coset_table.py
    |   ├── fp_groups.py
    |   ├── free_groups.py
    |   ├── generators.py
    |   ├── graycode.py
    |   ├── group_constructs.py
    |   ├── group_numbers.py
    |   ├── homomorphisms.py
    |   ├── named_groups.py
    |   ├── partitions.py
    |   ├── pc_groups.py
    |   ├── perm_groups.py
    |   ├── permutations.py
    |   ├── polyhedron.py
    |   ├── prufer.py
    |   ├── rewritingsystem.py
    |   ├── rewritingsystem_fsm.py
    |   ├── schur_number.py
    |   ├── subsets.py
    |   ├── tensor_can.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_coset_table.py
    |   |   ├── test_fp_groups.py
    |   |   ├── test_free_groups.py
    |   |   ├── test_generators.py
    |   |   ├── test_graycode.py
    |   |   ├── test_group_constructs.py
    |   |   ├── test_group_numbers.py
    |   |   ├── test_homomorphisms.py
    |   |   ├── test_named_groups.py
    |   |   ├── test_partitions.py
    |   |   ├── test_pc_groups.py
    |   |   ├── test_perm_groups.py
    |   |   ├── test_permutations.py
    |   |   ├── test_polyhedron.py
    |   |   ├── test_prufer.py
    |   |   ├── test_rewriting.py
    |   |   ├── test_schur_number.py
    |   |   ├── test_subsets.py
    |   |   ├── test_tensor_can.py
    |   |   ├── test_testutil.py
    |   |   └── test_util.py
    |   ├── testutil.py
    |   └── util.py
    ├── concrete
    |   ├── __init__.py
    |   ├── delta.py
    |   ├── expr_with_intlimits.py
    |   ├── expr_with_limits.py
    |   ├── gosper.py
    |   ├── guess.py
    |   ├── products.py
    |   ├── summations.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_delta.py
    |       ├── test_gosper.py
    |       ├── test_guess.py
    |       ├── test_products.py
    |       └── test_sums_products.py
    ├── conftest.py
    ├── core
    |   ├── __init__.py
    |   ├── _print_helpers.py
    |   ├── add.py
    |   ├── alphabets.py
    |   ├── assumptions.py
    |   ├── assumptions_generated.py
    |   ├── backend.py
    |   ├── basic.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_arit.py
    |   |   ├── bench_assumptions.py
    |   |   ├── bench_basic.py
    |   |   ├── bench_expand.py
    |   |   ├── bench_numbers.py
    |   |   └── bench_sympify.py
    |   ├── cache.py
    |   ├── compatibility.py
    |   ├── containers.py
    |   ├── core.py
    |   ├── coreerrors.py
    |   ├── decorators.py
    |   ├── evalf.py
    |   ├── expr.py
    |   ├── exprtools.py
    |   ├── facts.py
    |   ├── function.py
    |   ├── kind.py
    |   ├── logic.py
    |   ├── mod.py
    |   ├── mul.py
    |   ├── multidimensional.py
    |   ├── numbers.py
    |   ├── operations.py
    |   ├── parameters.py
    |   ├── power.py
    |   ├── random.py
    |   ├── relational.py
    |   ├── rules.py
    |   ├── singleton.py
    |   ├── sorting.py
    |   ├── symbol.py
    |   ├── sympify.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_args.py
    |   |   ├── test_arit.py
    |   |   ├── test_assumptions.py
    |   |   ├── test_basic.py
    |   |   ├── test_cache.py
    |   |   ├── test_compatibility.py
    |   |   ├── test_complex.py
    |   |   ├── test_constructor_postprocessor.py
    |   |   ├── test_containers.py
    |   |   ├── test_count_ops.py
    |   |   ├── test_diff.py
    |   |   ├── test_equal.py
    |   |   ├── test_eval.py
    |   |   ├── test_evalf.py
    |   |   ├── test_expand.py
    |   |   ├── test_expr.py
    |   |   ├── test_exprtools.py
    |   |   ├── test_facts.py
    |   |   ├── test_function.py
    |   |   ├── test_kind.py
    |   |   ├── test_logic.py
    |   |   ├── test_match.py
    |   |   ├── test_multidimensional.py
    |   |   ├── test_noncommutative.py
    |   |   ├── test_numbers.py
    |   |   ├── test_operations.py
    |   |   ├── test_parameters.py
    |   |   ├── test_power.py
    |   |   ├── test_priority.py
    |   |   ├── test_random.py
    |   |   ├── test_relational.py
    |   |   ├── test_rules.py
    |   |   ├── test_singleton.py
    |   |   ├── test_sorting.py
    |   |   ├── test_subs.py
    |   |   ├── test_symbol.py
    |   |   ├── test_sympify.py
    |   |   ├── test_traversal.py
    |   |   ├── test_truediv.py
    |   |   └── test_var.py
    |   ├── trace.py
    |   └── traversal.py
    ├── crypto
    |   ├── __init__.py
    |   ├── crypto.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_crypto.py
    ├── diffgeom
    |   ├── __init__.py
    |   ├── diffgeom.py
    |   ├── rn.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_class_structure.py
    |       ├── test_diffgeom.py
    |       ├── test_function_diffgeom_book.py
    |       └── test_hyperbolic_space.py
    ├── discrete
    |   ├── __init__.py
    |   ├── convolutions.py
    |   ├── recurrences.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_convolutions.py
    |   |   ├── test_recurrences.py
    |   |   └── test_transforms.py
    |   └── transforms.py
    ├── external
    |   ├── __init__.py
    |   ├── gmpy.py
    |   ├── importtools.py
    |   ├── pythonmpq.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_autowrap.py
    |       ├── test_codegen.py
    |       ├── test_importtools.py
    |       ├── test_numpy.py
    |       ├── test_pythonmpq.py
    |       └── test_scipy.py
    ├── functions
    |   ├── __init__.py
    |   ├── combinatorial
    |   |   ├── __init__.py
    |   |   ├── factorials.py
    |   |   ├── numbers.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_comb_factorials.py
    |   |       └── test_comb_numbers.py
    |   ├── elementary
    |   |   ├── __init__.py
    |   |   ├── benchmarks
    |   |   |   ├── __init__.py
    |   |   |   └── bench_exp.py
    |   |   ├── complexes.py
    |   |   ├── exponential.py
    |   |   ├── hyperbolic.py
    |   |   ├── integers.py
    |   |   ├── miscellaneous.py
    |   |   ├── piecewise.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_complexes.py
    |   |   |   ├── test_exponential.py
    |   |   |   ├── test_hyperbolic.py
    |   |   |   ├── test_integers.py
    |   |   |   ├── test_interface.py
    |   |   |   ├── test_miscellaneous.py
    |   |   |   ├── test_piecewise.py
    |   |   |   └── test_trigonometric.py
    |   |   └── trigonometric.py
    |   └── special
    |       ├── __init__.py
    |       ├── benchmarks
    |       |   ├── __init__.py
    |       |   └── bench_special.py
    |       ├── bessel.py
    |       ├── beta_functions.py
    |       ├── bsplines.py
    |       ├── delta_functions.py
    |       ├── elliptic_integrals.py
    |       ├── error_functions.py
    |       ├── gamma_functions.py
    |       ├── hyper.py
    |       ├── mathieu_functions.py
    |       ├── polynomials.py
    |       ├── singularity_functions.py
    |       ├── spherical_harmonics.py
    |       ├── tensor_functions.py
    |       ├── tests
    |       |   ├── __init__.py
    |       |   ├── test_bessel.py
    |       |   ├── test_beta_functions.py
    |       |   ├── test_bsplines.py
    |       |   ├── test_delta_functions.py
    |       |   ├── test_elliptic_integrals.py
    |       |   ├── test_error_functions.py
    |       |   ├── test_gamma_functions.py
    |       |   ├── test_hyper.py
    |       |   ├── test_mathieu.py
    |       |   ├── test_singularity_functions.py
    |       |   ├── test_spec_polynomials.py
    |       |   ├── test_spherical_harmonics.py
    |       |   ├── test_tensor_functions.py
    |       |   └── test_zeta_functions.py
    |       └── zeta_functions.py
    ├── galgebra.py
    ├── geometry
    |   ├── __init__.py
    |   ├── curve.py
    |   ├── ellipse.py
    |   ├── entity.py
    |   ├── exceptions.py
    |   ├── line.py
    |   ├── parabola.py
    |   ├── plane.py
    |   ├── point.py
    |   ├── polygon.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_curve.py
    |   |   ├── test_ellipse.py
    |   |   ├── test_entity.py
    |   |   ├── test_geometrysets.py
    |   |   ├── test_line.py
    |   |   ├── test_parabola.py
    |   |   ├── test_plane.py
    |   |   ├── test_point.py
    |   |   ├── test_polygon.py
    |   |   └── test_util.py
    |   └── util.py
    ├── holonomic
    |   ├── __init__.py
    |   ├── holonomic.py
    |   ├── holonomicerrors.py
    |   ├── numerical.py
    |   ├── recurrence.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_holonomic.py
    |       └── test_recurrence.py
    ├── integrals
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_integrate.py
    |   |   └── bench_trigintegrate.py
    |   ├── deltafunctions.py
    |   ├── heurisch.py
    |   ├── integrals.py
    |   ├── intpoly.py
    |   ├── manualintegrate.py
    |   ├── meijerint.py
    |   ├── meijerint_doc.py
    |   ├── prde.py
    |   ├── quadrature.py
    |   ├── rationaltools.py
    |   ├── rde.py
    |   ├── risch.py
    |   ├── singularityfunctions.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_deltafunctions.py
    |   |   ├── test_failing_integrals.py
    |   |   ├── test_heurisch.py
    |   |   ├── test_integrals.py
    |   |   ├── test_intpoly.py
    |   |   ├── test_lineintegrals.py
    |   |   ├── test_manual.py
    |   |   ├── test_meijerint.py
    |   |   ├── test_prde.py
    |   |   ├── test_quadrature.py
    |   |   ├── test_rationaltools.py
    |   |   ├── test_rde.py
    |   |   ├── test_risch.py
    |   |   ├── test_singularityfunctions.py
    |   |   ├── test_transforms.py
    |   |   └── test_trigonometry.py
    |   ├── transforms.py
    |   └── trigonometry.py
    ├── interactive
    |   ├── __init__.py
    |   ├── printing.py
    |   ├── session.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_interactive.py
    |   |   └── test_ipython.py
    |   └── traversal.py
    ├── liealgebras
    |   ├── __init__.py
    |   ├── cartan_matrix.py
    |   ├── cartan_type.py
    |   ├── dynkin_diagram.py
    |   ├── root_system.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_cartan_matrix.py
    |   |   ├── test_cartan_type.py
    |   |   ├── test_dynkin_diagram.py
    |   |   ├── test_root_system.py
    |   |   ├── test_type_A.py
    |   |   ├── test_type_B.py
    |   |   ├── test_type_C.py
    |   |   ├── test_type_D.py
    |   |   ├── test_type_E.py
    |   |   ├── test_type_F.py
    |   |   ├── test_type_G.py
    |   |   └── test_weyl_group.py
    |   ├── type_a.py
    |   ├── type_b.py
    |   ├── type_c.py
    |   ├── type_d.py
    |   ├── type_e.py
    |   ├── type_f.py
    |   ├── type_g.py
    |   └── weyl_group.py
    ├── logic
    |   ├── __init__.py
    |   ├── algorithms
    |   |   ├── __init__.py
    |   |   ├── dpll.py
    |   |   ├── dpll2.py
    |   |   ├── minisat22_wrapper.py
    |   |   └── pycosat_wrapper.py
    |   ├── boolalg.py
    |   ├── inference.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_boolalg.py
    |   |   ├── test_dimacs.py
    |   |   └── test_inference.py
    |   └── utilities
    |       ├── __init__.py
    |       └── dimacs.py
    ├── matrices
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_matrix.py
    |   ├── common.py
    |   ├── decompositions.py
    |   ├── dense.py
    |   ├── determinant.py
    |   ├── eigen.py
    |   ├── expressions
    |   |   ├── __init__.py
    |   |   ├── _shape.py
    |   |   ├── adjoint.py
    |   |   ├── applyfunc.py
    |   |   ├── blockmatrix.py
    |   |   ├── companion.py
    |   |   ├── determinant.py
    |   |   ├── diagonal.py
    |   |   ├── dotproduct.py
    |   |   ├── factorizations.py
    |   |   ├── fourier.py
    |   |   ├── funcmatrix.py
    |   |   ├── hadamard.py
    |   |   ├── inverse.py
    |   |   ├── kronecker.py
    |   |   ├── matadd.py
    |   |   ├── matexpr.py
    |   |   ├── matmul.py
    |   |   ├── matpow.py
    |   |   ├── permutation.py
    |   |   ├── sets.py
    |   |   ├── slice.py
    |   |   ├── special.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_adjoint.py
    |   |   |   ├── test_applyfunc.py
    |   |   |   ├── test_blockmatrix.py
    |   |   |   ├── test_companion.py
    |   |   |   ├── test_derivatives.py
    |   |   |   ├── test_determinant.py
    |   |   |   ├── test_diagonal.py
    |   |   |   ├── test_dotproduct.py
    |   |   |   ├── test_factorizations.py
    |   |   |   ├── test_fourier.py
    |   |   |   ├── test_funcmatrix.py
    |   |   |   ├── test_hadamard.py
    |   |   |   ├── test_indexing.py
    |   |   |   ├── test_inverse.py
    |   |   |   ├── test_kronecker.py
    |   |   |   ├── test_matadd.py
    |   |   |   ├── test_matexpr.py
    |   |   |   ├── test_matmul.py
    |   |   |   ├── test_matpow.py
    |   |   |   ├── test_permutation.py
    |   |   |   ├── test_sets.py
    |   |   |   ├── test_slice.py
    |   |   |   ├── test_special.py
    |   |   |   ├── test_trace.py
    |   |   |   └── test_transpose.py
    |   |   ├── trace.py
    |   |   └── transpose.py
    |   ├── graph.py
    |   ├── immutable.py
    |   ├── inverse.py
    |   ├── matrices.py
    |   ├── normalforms.py
    |   ├── reductions.py
    |   ├── repmatrix.py
    |   ├── solvers.py
    |   ├── sparse.py
    |   ├── sparsetools.py
    |   ├── subspaces.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_commonmatrix.py
    |   |   ├── test_decompositions.py
    |   |   ├── test_determinant.py
    |   |   ├── test_eigen.py
    |   |   ├── test_graph.py
    |   |   ├── test_immutable.py
    |   |   ├── test_interactions.py
    |   |   ├── test_matrices.py
    |   |   ├── test_normalforms.py
    |   |   ├── test_reductions.py
    |   |   ├── test_solvers.py
    |   |   ├── test_sparse.py
    |   |   ├── test_sparsetools.py
    |   |   └── test_subspaces.py
    |   └── utilities.py
    ├── multipledispatch
    |   ├── __init__.py
    |   ├── conflict.py
    |   ├── core.py
    |   ├── dispatcher.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_conflict.py
    |   |   ├── test_core.py
    |   |   └── test_dispatcher.py
    |   └── utils.py
    ├── ntheory
    |   ├── __init__.py
    |   ├── bbp_pi.py
    |   ├── continued_fraction.py
    |   ├── digits.py
    |   ├── ecm.py
    |   ├── egyptian_fraction.py
    |   ├── elliptic_curve.py
    |   ├── factor_.py
    |   ├── generate.py
    |   ├── modular.py
    |   ├── multinomial.py
    |   ├── partitions_.py
    |   ├── primetest.py
    |   ├── qs.py
    |   ├── residue_ntheory.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_bbp_pi.py
    |       ├── test_continued_fraction.py
    |       ├── test_digits.py
    |       ├── test_ecm.py
    |       ├── test_egyptian_fraction.py
    |       ├── test_elliptic_curve.py
    |       ├── test_factor_.py
    |       ├── test_generate.py
    |       ├── test_modular.py
    |       ├── test_multinomial.py
    |       ├── test_partitions.py
    |       ├── test_primetest.py
    |       ├── test_qs.py
    |       └── test_residue.py
    ├── parsing
    |   ├── __init__.py
    |   ├── ast_parser.py
    |   ├── autolev
    |   |   ├── __init__.py
    |   |   ├── _antlr
    |   |   |   ├── __init__.py
    |   |   |   ├── autolevlexer.py
    |   |   |   ├── autolevlistener.py
    |   |   |   └── autolevparser.py
    |   |   ├── _build_autolev_antlr.py
    |   |   ├── _listener_autolev_antlr.py
    |   |   ├── _parse_autolev_antlr.py
    |   |   └── test-examples
    |   |       ├── README.txt
    |   |       ├── pydy-example-repo
    |   |       ├── ruletest1.py
    |   |       ├── ruletest10.py
    |   |       ├── ruletest11.py
    |   |       ├── ruletest12.py
    |   |       ├── ruletest2.py
    |   |       ├── ruletest3.py
    |   |       ├── ruletest4.py
    |   |       ├── ruletest5.py
    |   |       ├── ruletest6.py
    |   |       ├── ruletest7.py
    |   |       ├── ruletest8.py
    |   |       └── ruletest9.py
    |   ├── c
    |   |   ├── __init__.py
    |   |   └── c_parser.py
    |   ├── fortran
    |   |   ├── __init__.py
    |   |   └── fortran_parser.py
    |   ├── latex
    |   |   ├── LICENSE.txt
    |   |   ├── __init__.py
    |   |   ├── _antlr
    |   |   |   ├── __init__.py
    |   |   |   ├── latexlexer.py
    |   |   |   └── latexparser.py
    |   |   ├── _build_latex_antlr.py
    |   |   ├── _parse_latex_antlr.py
    |   |   └── errors.py
    |   ├── mathematica.py
    |   ├── maxima.py
    |   ├── sym_expr.py
    |   ├── sympy_parser.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_ast_parser.py
    |       ├── test_autolev.py
    |       ├── test_c_parser.py
    |       ├── test_fortran_parser.py
    |       ├── test_implicit_multiplication_application.py
    |       ├── test_latex.py
    |       ├── test_latex_deps.py
    |       ├── test_mathematica.py
    |       ├── test_maxima.py
    |       ├── test_sym_expr.py
    |       └── test_sympy_parser.py
    ├── physics
    |   ├── __init__.py
    |   ├── continuum_mechanics
    |   |   ├── __init__.py
    |   |   ├── beam.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_beam.py
    |   |   |   └── test_truss.py
    |   |   └── truss.py
    |   ├── control
    |   |   ├── __init__.py
    |   |   ├── control_plots.py
    |   |   ├── lti.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_control_plots.py
    |   |       └── test_lti.py
    |   ├── hep
    |   |   ├── __init__.py
    |   |   ├── gamma_matrices.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_gamma_matrices.py
    |   ├── hydrogen.py
    |   ├── matrices.py
    |   ├── mechanics
    |   |   ├── __init__.py
    |   |   ├── body.py
    |   |   ├── functions.py
    |   |   ├── joint.py
    |   |   ├── jointsmethod.py
    |   |   ├── kane.py
    |   |   ├── lagrange.py
    |   |   ├── linearize.py
    |   |   ├── method.py
    |   |   ├── models.py
    |   |   ├── particle.py
    |   |   ├── rigidbody.py
    |   |   ├── system.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_body.py
    |   |       ├── test_functions.py
    |   |       ├── test_joint.py
    |   |       ├── test_jointsmethod.py
    |   |       ├── test_kane.py
    |   |       ├── test_kane2.py
    |   |       ├── test_kane3.py
    |   |       ├── test_kane4.py
    |   |       ├── test_lagrange.py
    |   |       ├── test_lagrange2.py
    |   |       ├── test_linearize.py
    |   |       ├── test_method.py
    |   |       ├── test_models.py
    |   |       ├── test_particle.py
    |   |       ├── test_rigidbody.py
    |   |       └── test_system.py
    |   ├── optics
    |   |   ├── __init__.py
    |   |   ├── gaussopt.py
    |   |   ├── medium.py
    |   |   ├── polarization.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_gaussopt.py
    |   |   |   ├── test_medium.py
    |   |   |   ├── test_polarization.py
    |   |   |   ├── test_utils.py
    |   |   |   └── test_waves.py
    |   |   ├── utils.py
    |   |   └── waves.py
    |   ├── paulialgebra.py
    |   ├── pring.py
    |   ├── qho_1d.py
    |   ├── quantum
    |   |   ├── __init__.py
    |   |   ├── anticommutator.py
    |   |   ├── boson.py
    |   |   ├── cartesian.py
    |   |   ├── cg.py
    |   |   ├── circuitplot.py
    |   |   ├── circuitutils.py
    |   |   ├── commutator.py
    |   |   ├── constants.py
    |   |   ├── dagger.py
    |   |   ├── density.py
    |   |   ├── fermion.py
    |   |   ├── gate.py
    |   |   ├── grover.py
    |   |   ├── hilbert.py
    |   |   ├── identitysearch.py
    |   |   ├── innerproduct.py
    |   |   ├── matrixcache.py
    |   |   ├── matrixutils.py
    |   |   ├── operator.py
    |   |   ├── operatorordering.py
    |   |   ├── operatorset.py
    |   |   ├── pauli.py
    |   |   ├── piab.py
    |   |   ├── qapply.py
    |   |   ├── qasm.py
    |   |   ├── qexpr.py
    |   |   ├── qft.py
    |   |   ├── qubit.py
    |   |   ├── represent.py
    |   |   ├── sho1d.py
    |   |   ├── shor.py
    |   |   ├── spin.py
    |   |   ├── state.py
    |   |   ├── tensorproduct.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_anticommutator.py
    |   |   |   ├── test_boson.py
    |   |   |   ├── test_cartesian.py
    |   |   |   ├── test_cg.py
    |   |   |   ├── test_circuitplot.py
    |   |   |   ├── test_circuitutils.py
    |   |   |   ├── test_commutator.py
    |   |   |   ├── test_constants.py
    |   |   |   ├── test_dagger.py
    |   |   |   ├── test_density.py
    |   |   |   ├── test_fermion.py
    |   |   |   ├── test_gate.py
    |   |   |   ├── test_grover.py
    |   |   |   ├── test_hilbert.py
    |   |   |   ├── test_identitysearch.py
    |   |   |   ├── test_innerproduct.py
    |   |   |   ├── test_matrixutils.py
    |   |   |   ├── test_operator.py
    |   |   |   ├── test_operatorordering.py
    |   |   |   ├── test_operatorset.py
    |   |   |   ├── test_pauli.py
    |   |   |   ├── test_piab.py
    |   |   |   ├── test_printing.py
    |   |   |   ├── test_qapply.py
    |   |   |   ├── test_qasm.py
    |   |   |   ├── test_qexpr.py
    |   |   |   ├── test_qft.py
    |   |   |   ├── test_qubit.py
    |   |   |   ├── test_represent.py
    |   |   |   ├── test_sho1d.py
    |   |   |   ├── test_shor.py
    |   |   |   ├── test_spin.py
    |   |   |   ├── test_state.py
    |   |   |   ├── test_tensorproduct.py
    |   |   |   └── test_trace.py
    |   |   └── trace.py
    |   ├── secondquant.py
    |   ├── sho.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_clebsch_gordan.py
    |   |   ├── test_hydrogen.py
    |   |   ├── test_paulialgebra.py
    |   |   ├── test_physics_matrices.py
    |   |   ├── test_pring.py
    |   |   ├── test_qho_1d.py
    |   |   ├── test_secondquant.py
    |   |   └── test_sho.py
    |   ├── units
    |   |   ├── __init__.py
    |   |   ├── definitions
    |   |   |   ├── __init__.py
    |   |   |   ├── dimension_definitions.py
    |   |   |   └── unit_definitions.py
    |   |   ├── dimensions.py
    |   |   ├── prefixes.py
    |   |   ├── quantities.py
    |   |   ├── systems
    |   |   |   ├── __init__.py
    |   |   |   ├── cgs.py
    |   |   |   ├── length_weight_time.py
    |   |   |   ├── mks.py
    |   |   |   ├── mksa.py
    |   |   |   ├── natural.py
    |   |   |   └── si.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dimensions.py
    |   |   |   ├── test_dimensionsystem.py
    |   |   |   ├── test_prefixes.py
    |   |   |   ├── test_quantities.py
    |   |   |   ├── test_unit_system_cgs_gauss.py
    |   |   |   ├── test_unitsystem.py
    |   |   |   └── test_util.py
    |   |   ├── unitsystem.py
    |   |   └── util.py
    |   ├── vector
    |   |   ├── __init__.py
    |   |   ├── dyadic.py
    |   |   ├── fieldfunctions.py
    |   |   ├── frame.py
    |   |   ├── functions.py
    |   |   ├── point.py
    |   |   ├── printing.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dyadic.py
    |   |   |   ├── test_fieldfunctions.py
    |   |   |   ├── test_frame.py
    |   |   |   ├── test_functions.py
    |   |   |   ├── test_output.py
    |   |   |   ├── test_point.py
    |   |   |   ├── test_printing.py
    |   |   |   └── test_vector.py
    |   |   └── vector.py
    |   └── wigner.py
    ├── plotting
    |   ├── __init__.py
    |   ├── experimental_lambdify.py
    |   ├── intervalmath
    |   |   ├── __init__.py
    |   |   ├── interval_arithmetic.py
    |   |   ├── interval_membership.py
    |   |   ├── lib_interval.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_interval_functions.py
    |   |       ├── test_interval_membership.py
    |   |       └── test_intervalmath.py
    |   ├── plot.py
    |   ├── plot_implicit.py
    |   ├── pygletplot
    |   |   ├── __init__.py
    |   |   ├── color_scheme.py
    |   |   ├── managed_window.py
    |   |   ├── plot.py
    |   |   ├── plot_axes.py
    |   |   ├── plot_camera.py
    |   |   ├── plot_controller.py
    |   |   ├── plot_curve.py
    |   |   ├── plot_interval.py
    |   |   ├── plot_mode.py
    |   |   ├── plot_mode_base.py
    |   |   ├── plot_modes.py
    |   |   ├── plot_object.py
    |   |   ├── plot_rotation.py
    |   |   ├── plot_surface.py
    |   |   ├── plot_window.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── test_plotting.py
    |   |   └── util.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_experimental_lambdify.py
    |   |   ├── test_plot.py
    |   |   ├── test_plot_implicit.py
    |   |   └── test_textplot.py
    |   └── textplot.py
    ├── polys
    |   ├── __init__.py
    |   ├── agca
    |   |   ├── __init__.py
    |   |   ├── extensions.py
    |   |   ├── homomorphisms.py
    |   |   ├── ideals.py
    |   |   ├── modules.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_extensions.py
    |   |       ├── test_homomorphisms.py
    |   |       ├── test_ideals.py
    |   |       └── test_modules.py
    |   ├── appellseqs.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_galoispolys.py
    |   |   ├── bench_groebnertools.py
    |   |   └── bench_solvers.py
    |   ├── compatibility.py
    |   ├── constructor.py
    |   ├── densearith.py
    |   ├── densebasic.py
    |   ├── densetools.py
    |   ├── dispersion.py
    |   ├── distributedmodules.py
    |   ├── domainmatrix.py
    |   ├── domains
    |   |   ├── __init__.py
    |   |   ├── algebraicfield.py
    |   |   ├── characteristiczero.py
    |   |   ├── complexfield.py
    |   |   ├── compositedomain.py
    |   |   ├── domain.py
    |   |   ├── domainelement.py
    |   |   ├── expressiondomain.py
    |   |   ├── expressionrawdomain.py
    |   |   ├── field.py
    |   |   ├── finitefield.py
    |   |   ├── fractionfield.py
    |   |   ├── gaussiandomains.py
    |   |   ├── gmpyfinitefield.py
    |   |   ├── gmpyintegerring.py
    |   |   ├── gmpyrationalfield.py
    |   |   ├── groundtypes.py
    |   |   ├── integerring.py
    |   |   ├── modularinteger.py
    |   |   ├── mpelements.py
    |   |   ├── old_fractionfield.py
    |   |   ├── old_polynomialring.py
    |   |   ├── polynomialring.py
    |   |   ├── pythonfinitefield.py
    |   |   ├── pythonintegerring.py
    |   |   ├── pythonrational.py
    |   |   ├── pythonrationalfield.py
    |   |   ├── quotientring.py
    |   |   ├── rationalfield.py
    |   |   ├── realfield.py
    |   |   ├── ring.py
    |   |   ├── simpledomain.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_domains.py
    |   |       ├── test_polynomialring.py
    |   |       └── test_quotientring.py
    |   ├── euclidtools.py
    |   ├── factortools.py
    |   ├── fglmtools.py
    |   ├── fields.py
    |   ├── galoistools.py
    |   ├── groebnertools.py
    |   ├── heuristicgcd.py
    |   ├── matrices
    |   |   ├── __init__.py
    |   |   ├── ddm.py
    |   |   ├── dense.py
    |   |   ├── domainmatrix.py
    |   |   ├── domainscalar.py
    |   |   ├── eigen.py
    |   |   ├── exceptions.py
    |   |   ├── linsolve.py
    |   |   ├── normalforms.py
    |   |   ├── sdm.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_ddm.py
    |   |       ├── test_dense.py
    |   |       ├── test_domainmatrix.py
    |   |       ├── test_domainscalar.py
    |   |       ├── test_eigen.py
    |   |       ├── test_linsolve.py
    |   |       ├── test_normalforms.py
    |   |       └── test_sdm.py
    |   ├── modulargcd.py
    |   ├── monomials.py
    |   ├── multivariate_resultants.py
    |   ├── numberfields
    |   |   ├── __init__.py
    |   |   ├── basis.py
    |   |   ├── exceptions.py
    |   |   ├── minpoly.py
    |   |   ├── modules.py
    |   |   ├── primes.py
    |   |   ├── subfield.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_basis.py
    |   |   |   ├── test_minpoly.py
    |   |   |   ├── test_modules.py
    |   |   |   ├── test_numbers.py
    |   |   |   ├── test_primes.py
    |   |   |   ├── test_subfield.py
    |   |   |   └── test_utilities.py
    |   |   └── utilities.py
    |   ├── orderings.py
    |   ├── orthopolys.py
    |   ├── partfrac.py
    |   ├── polyclasses.py
    |   ├── polyconfig.py
    |   ├── polyerrors.py
    |   ├── polyfuncs.py
    |   ├── polymatrix.py
    |   ├── polyoptions.py
    |   ├── polyquinticconst.py
    |   ├── polyroots.py
    |   ├── polytools.py
    |   ├── polyutils.py
    |   ├── rationaltools.py
    |   ├── ring_series.py
    |   ├── rings.py
    |   ├── rootisolation.py
    |   ├── rootoftools.py
    |   ├── solvers.py
    |   ├── specialpolys.py
    |   ├── sqfreetools.py
    |   ├── subresultants_qq_zz.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_appellseqs.py
    |       ├── test_constructor.py
    |       ├── test_densearith.py
    |       ├── test_densebasic.py
    |       ├── test_densetools.py
    |       ├── test_dispersion.py
    |       ├── test_distributedmodules.py
    |       ├── test_euclidtools.py
    |       ├── test_factortools.py
    |       ├── test_fields.py
    |       ├── test_galoistools.py
    |       ├── test_groebnertools.py
    |       ├── test_heuristicgcd.py
    |       ├── test_injections.py
    |       ├── test_modulargcd.py
    |       ├── test_monomials.py
    |       ├── test_multivariate_resultants.py
    |       ├── test_orderings.py
    |       ├── test_orthopolys.py
    |       ├── test_partfrac.py
    |       ├── test_polyclasses.py
    |       ├── test_polyfuncs.py
    |       ├── test_polymatrix.py
    |       ├── test_polyoptions.py
    |       ├── test_polyroots.py
    |       ├── test_polytools.py
    |       ├── test_polyutils.py
    |       ├── test_pythonrational.py
    |       ├── test_rationaltools.py
    |       ├── test_ring_series.py
    |       ├── test_rings.py
    |       ├── test_rootisolation.py
    |       ├── test_rootoftools.py
    |       ├── test_solvers.py
    |       ├── test_specialpolys.py
    |       ├── test_sqfreetools.py
    |       └── test_subresultants_qq_zz.py
    ├── printing
    |   ├── __init__.py
    |   ├── aesaracode.py
    |   ├── c.py
    |   ├── codeprinter.py
    |   ├── conventions.py
    |   ├── cxx.py
    |   ├── defaults.py
    |   ├── dot.py
    |   ├── fortran.py
    |   ├── glsl.py
    |   ├── gtk.py
    |   ├── jscode.py
    |   ├── julia.py
    |   ├── lambdarepr.py
    |   ├── latex.py
    |   ├── llvmjitcode.py
    |   ├── maple.py
    |   ├── mathematica.py
    |   ├── mathml.py
    |   ├── numpy.py
    |   ├── octave.py
    |   ├── precedence.py
    |   ├── pretty
    |   |   ├── __init__.py
    |   |   ├── pretty.py
    |   |   ├── pretty_symbology.py
    |   |   ├── stringpict.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_pretty.py
    |   ├── preview.py
    |   ├── printer.py
    |   ├── pycode.py
    |   ├── python.py
    |   ├── rcode.py
    |   ├── repr.py
    |   ├── rust.py
    |   ├── smtlib.py
    |   ├── str.py
    |   ├── tableform.py
    |   ├── tensorflow.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_aesaracode.py
    |   |   ├── test_c.py
    |   |   ├── test_codeprinter.py
    |   |   ├── test_conventions.py
    |   |   ├── test_cupy.py
    |   |   ├── test_cxx.py
    |   |   ├── test_dot.py
    |   |   ├── test_fortran.py
    |   |   ├── test_glsl.py
    |   |   ├── test_gtk.py
    |   |   ├── test_jax.py
    |   |   ├── test_jscode.py
    |   |   ├── test_julia.py
    |   |   ├── test_lambdarepr.py
    |   |   ├── test_latex.py
    |   |   ├── test_llvmjit.py
    |   |   ├── test_maple.py
    |   |   ├── test_mathematica.py
    |   |   ├── test_mathml.py
    |   |   ├── test_numpy.py
    |   |   ├── test_octave.py
    |   |   ├── test_precedence.py
    |   |   ├── test_preview.py
    |   |   ├── test_pycode.py
    |   |   ├── test_python.py
    |   |   ├── test_rcode.py
    |   |   ├── test_repr.py
    |   |   ├── test_rust.py
    |   |   ├── test_smtlib.py
    |   |   ├── test_str.py
    |   |   ├── test_tableform.py
    |   |   ├── test_tensorflow.py
    |   |   ├── test_theanocode.py
    |   |   └── test_tree.py
    |   ├── theanocode.py
    |   └── tree.py
    ├── release.py
    ├── sandbox
    |   ├── __init__.py
    |   ├── indexed_integrals.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_indexed_integrals.py
    ├── series
    |   ├── __init__.py
    |   ├── acceleration.py
    |   ├── approximants.py
    |   ├── aseries.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_limit.py
    |   |   └── bench_order.py
    |   ├── formal.py
    |   ├── fourier.py
    |   ├── gruntz.py
    |   ├── kauers.py
    |   ├── limits.py
    |   ├── limitseq.py
    |   ├── order.py
    |   ├── residues.py
    |   ├── sequences.py
    |   ├── series.py
    |   ├── series_class.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_approximants.py
    |       ├── test_aseries.py
    |       ├── test_demidovich.py
    |       ├── test_formal.py
    |       ├── test_fourier.py
    |       ├── test_gruntz.py
    |       ├── test_kauers.py
    |       ├── test_limits.py
    |       ├── test_limitseq.py
    |       ├── test_lseries.py
    |       ├── test_nseries.py
    |       ├── test_order.py
    |       ├── test_residues.py
    |       ├── test_sequences.py
    |       └── test_series.py
    ├── sets
    |   ├── __init__.py
    |   ├── conditionset.py
    |   ├── contains.py
    |   ├── fancysets.py
    |   ├── handlers
    |   |   ├── __init__.py
    |   |   ├── add.py
    |   |   ├── comparison.py
    |   |   ├── functions.py
    |   |   ├── intersection.py
    |   |   ├── issubset.py
    |   |   ├── mul.py
    |   |   ├── power.py
    |   |   └── union.py
    |   ├── ordinals.py
    |   ├── powerset.py
    |   ├── setexpr.py
    |   ├── sets.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_conditionset.py
    |       ├── test_contains.py
    |       ├── test_fancysets.py
    |       ├── test_ordinals.py
    |       ├── test_powerset.py
    |       ├── test_setexpr.py
    |       └── test_sets.py
    ├── simplify
    |   ├── __init__.py
    |   ├── combsimp.py
    |   ├── cse_main.py
    |   ├── cse_opts.py
    |   ├── epathtools.py
    |   ├── fu.py
    |   ├── gammasimp.py
    |   ├── hyperexpand.py
    |   ├── hyperexpand_doc.py
    |   ├── powsimp.py
    |   ├── radsimp.py
    |   ├── ratsimp.py
    |   ├── simplify.py
    |   ├── sqrtdenest.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_combsimp.py
    |   |   ├── test_cse.py
    |   |   ├── test_epathtools.py
    |   |   ├── test_fu.py
    |   |   ├── test_function.py
    |   |   ├── test_gammasimp.py
    |   |   ├── test_hyperexpand.py
    |   |   ├── test_powsimp.py
    |   |   ├── test_radsimp.py
    |   |   ├── test_ratsimp.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_simplify.py
    |   |   ├── test_sqrtdenest.py
    |   |   └── test_trigsimp.py
    |   ├── traversaltools.py
    |   └── trigsimp.py
    ├── solvers
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_solvers.py
    |   ├── bivariate.py
    |   ├── decompogen.py
    |   ├── deutils.py
    |   ├── diophantine
    |   |   ├── __init__.py
    |   |   ├── diophantine.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_diophantine.py
    |   ├── inequalities.py
    |   ├── ode
    |   |   ├── __init__.py
    |   |   ├── hypergeometric.py
    |   |   ├── lie_group.py
    |   |   ├── nonhomogeneous.py
    |   |   ├── ode.py
    |   |   ├── riccati.py
    |   |   ├── single.py
    |   |   ├── subscheck.py
    |   |   ├── systems.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_lie_group.py
    |   |       ├── test_ode.py
    |   |       ├── test_riccati.py
    |   |       ├── test_single.py
    |   |       ├── test_subscheck.py
    |   |       └── test_systems.py
    |   ├── pde.py
    |   ├── polysys.py
    |   ├── recurr.py
    |   ├── solvers.py
    |   ├── solveset.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_constantsimp.py
    |       ├── test_decompogen.py
    |       ├── test_inequalities.py
    |       ├── test_numeric.py
    |       ├── test_pde.py
    |       ├── test_polysys.py
    |       ├── test_recurr.py
    |       ├── test_solvers.py
    |       └── test_solveset.py
    ├── stats
    |   ├── __init__.py
    |   ├── compound_rv.py
    |   ├── crv.py
    |   ├── crv_types.py
    |   ├── drv.py
    |   ├── drv_types.py
    |   ├── error_prop.py
    |   ├── frv.py
    |   ├── frv_types.py
    |   ├── joint_rv.py
    |   ├── joint_rv_types.py
    |   ├── matrix_distributions.py
    |   ├── random_matrix.py
    |   ├── random_matrix_models.py
    |   ├── rv.py
    |   ├── rv_interface.py
    |   ├── sampling
    |   |   ├── __init__.py
    |   |   ├── sample_numpy.py
    |   |   ├── sample_pymc.py
    |   |   ├── sample_scipy.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_sample_continuous_rv.py
    |   |       ├── test_sample_discrete_rv.py
    |   |       └── test_sample_finite_rv.py
    |   ├── stochastic_process.py
    |   ├── stochastic_process_types.py
    |   ├── symbolic_multivariate_probability.py
    |   ├── symbolic_probability.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_compound_rv.py
    |       ├── test_continuous_rv.py
    |       ├── test_discrete_rv.py
    |       ├── test_error_prop.py
    |       ├── test_finite_rv.py
    |       ├── test_joint_rv.py
    |       ├── test_matrix_distributions.py
    |       ├── test_mix.py
    |       ├── test_random_matrix.py
    |       ├── test_rv.py
    |       ├── test_stochastic_process.py
    |       ├── test_symbolic_multivariate.py
    |       └── test_symbolic_probability.py
    ├── strategies
    |   ├── __init__.py
    |   ├── branch
    |   |   ├── __init__.py
    |   |   ├── core.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_core.py
    |   |   |   ├── test_tools.py
    |   |   |   └── test_traverse.py
    |   |   ├── tools.py
    |   |   └── traverse.py
    |   ├── core.py
    |   ├── rl.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_core.py
    |   |   ├── test_rl.py
    |   |   ├── test_tools.py
    |   |   ├── test_traverse.py
    |   |   └── test_tree.py
    |   ├── tools.py
    |   ├── traverse.py
    |   ├── tree.py
    |   └── util.py
    ├── tensor
    |   ├── __init__.py
    |   ├── array
    |   |   ├── __init__.py
    |   |   ├── array_comprehension.py
    |   |   ├── array_derivatives.py
    |   |   ├── arrayop.py
    |   |   ├── dense_ndim_array.py
    |   |   ├── expressions
    |   |   |   ├── __init__.py
    |   |   |   ├── array_expressions.py
    |   |   |   ├── arrayexpr_derivatives.py
    |   |   |   ├── conv_array_to_indexed.py
    |   |   |   ├── conv_array_to_matrix.py
    |   |   |   ├── conv_indexed_to_array.py
    |   |   |   ├── conv_matrix_to_array.py
    |   |   |   ├── from_array_to_indexed.py
    |   |   |   ├── from_array_to_matrix.py
    |   |   |   ├── from_indexed_to_array.py
    |   |   |   ├── from_matrix_to_array.py
    |   |   |   ├── tests
    |   |   |   └── utils.py
    |   |   ├── mutable_ndim_array.py
    |   |   ├── ndim_array.py
    |   |   ├── sparse_ndim_array.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_array_comprehension.py
    |   |       ├── test_array_derivatives.py
    |   |       ├── test_arrayop.py
    |   |       ├── test_immutable_ndim_array.py
    |   |       ├── test_mutable_ndim_array.py
    |   |       ├── test_ndim_array.py
    |   |       └── test_ndim_array_conversions.py
    |   ├── functions.py
    |   ├── index_methods.py
    |   ├── indexed.py
    |   ├── tensor.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_functions.py
    |   |   ├── test_index_methods.py
    |   |   ├── test_indexed.py
    |   |   ├── test_printing.py
    |   |   ├── test_tensor.py
    |   |   ├── test_tensor_element.py
    |   |   └── test_tensor_operators.py
    |   └── toperators.py
    ├── testing
    |   ├── __init__.py
    |   ├── matrices.py
    |   ├── pytest.py
    |   ├── quality_unicode.py
    |   ├── randtest.py
    |   ├── runtests.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── diagnose_imports.py
    |   |   ├── test_code_quality.py
    |   |   ├── test_deprecated.py
    |   |   ├── test_module_imports.py
    |   |   └── test_pytest.py
    |   └── tmpfiles.py
    ├── this.py
    ├── unify
    |   ├── __init__.py
    |   ├── core.py
    |   ├── rewrite.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_sympy.py
    |   |   └── test_unify.py
    |   └── usympy.py
    ├── utilities
    |   ├── __init__.py
    |   ├── _compilation
    |   |   ├── __init__.py
    |   |   ├── availability.py
    |   |   ├── compilation.py
    |   |   ├── runners.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── test_compilation.py
    |   |   └── util.py
    |   ├── autowrap.py
    |   ├── codegen.py
    |   ├── decorator.py
    |   ├── enumerative.py
    |   ├── exceptions.py
    |   ├── iterables.py
    |   ├── lambdify.py
    |   ├── magic.py
    |   ├── matchpy_connector.py
    |   ├── mathml
    |   |   ├── __init__.py
    |   |   └── data
    |   ├── memoization.py
    |   ├── misc.py
    |   ├── pkgdata.py
    |   ├── pytest.py
    |   ├── randtest.py
    |   ├── runtests.py
    |   ├── source.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_autowrap.py
    |   |   ├── test_codegen.py
    |   |   ├── test_codegen_julia.py
    |   |   ├── test_codegen_octave.py
    |   |   ├── test_codegen_rust.py
    |   |   ├── test_decorator.py
    |   |   ├── test_deprecated.py
    |   |   ├── test_enumerative.py
    |   |   ├── test_exceptions.py
    |   |   ├── test_iterables.py
    |   |   ├── test_lambdify.py
    |   |   ├── test_matchpy_connector.py
    |   |   ├── test_misc.py
    |   |   ├── test_pickling.py
    |   |   ├── test_source.py
    |   |   ├── test_timeutils.py
    |   |   └── test_wester.py
    |   ├── timeutils.py
    |   └── tmpfiles.py
    └── vector
        ├── __init__.py
        ├── basisdependent.py
        ├── coordsysrect.py
        ├── deloperator.py
        ├── dyadic.py
        ├── functions.py
        ├── implicitregion.py
        ├── integrals.py
        ├── operators.py
        ├── orienters.py
        ├── parametricregion.py
        ├── point.py
        ├── scalar.py
        ├── tests
        |   ├── __init__.py
        |   ├── test_coordsysrect.py
        |   ├── test_dyadic.py
        |   ├── test_field_functions.py
        |   ├── test_functions.py
        |   ├── test_implicitregion.py
        |   ├── test_integrals.py
        |   ├── test_operators.py
        |   ├── test_parametricregion.py
        |   ├── test_printing.py
        |   └── test_vector.py
        └── vector.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Rational calc value error

Description: python 3.11, sympy 1.11.1
when calc Rational('0.5', '100'), the value is 1/100100; but Rational(0.5, 100) the value is 1/200, this value is the true value, and the version of sympy 1.8 is normal

Patch information:
diff --git a/sympy/core/numbers.py b/sympy/core/numbers.py
index 52f7ea45ad..96d0bdbcc4 100644
--- a/sympy/core/numbers.py
+++ b/sympy/core/numbers.py
@@ -1625,19 +1625,26 @@ def __new__(cls, p, q=None, gcd=None):
             q = 1
             gcd = 1
 
+        # Normalize p and q to integer numerator/denominator pairs before arithmetic
         if not isinstance(p, SYMPY_INTS):
             p = Rational(p)
-            q *= p.q
-            p = p.p
+            p_num = p.p
+            p_den = p.q
         else:
-            p = int(p)
+            p_num = int(p)
+            p_den = 1
 
         if not isinstance(q, SYMPY_INTS):
             q = Rational(q)
-            p *= q.q
-            q = q.p
+            q_num = q.p
+            q_den = q.q
         else:
-            q = int(q)
+            q_num = int(q)
+            q_den = 1
+
+        # Compute p/q as (p_num/p_den) / (q_num/q_den) = (p_num*q_den)/(p_den*q_num)
+        p = p_num * q_den
+        q = p_den * q_num
 
         # p and q are now ints
         if q == 0:


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 13:50:08,381 - thread-136261515871936.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find relevant test cases for a bug in the `Rational` class constructor. The file tree indicates that tests for `sympy.core.numbers` are likely located in `sympy/core/tests/test_numbers.py`. To find the test cases, I need the content of this file.' query='Please provide the full content of the file `sympy/core/tests/test_numbers.py`.' extra_requirements='' purpose='I need to analyze the tests for the `Rational` class to find existing test cases that are relevant to the described bug.'
2025-12-21 13:50:08,382 - thread-136261515871936.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of the file `sympy/core/tests/test_numbers.py`.
2025-12-21 13:50:08,382 - thread-136261515871936.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-21 13:50:08,383 - thread-136261515871936.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-21 13:50:08,384 - thread-136261515871936.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-21 13:50:08,384 - thread-136261515871936.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of the file `sympy/core/tests/test_numbers.py`.
Purpose: I need to analyze the tests for the `Rational` class to find existing test cases that are relevant to the described bug.
2025-12-21 13:50:10,677 - thread-136261515871936.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the full content of the file `sympy/core/tests/test_numbers.py`. This will allow you to analyze the existing tests for the `Rational` class and identify any relevant test cases.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "sympy/core/tests/test_numbers.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2089, 'candidates_token_count': 69, 'total_token_count': 2251, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2089}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 69}], 'thoughts_token_count': 93, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.09659440275551616, 'model_name': 'gemini-2.5-pro'} id='run--d44b2912-e0a1-4642-988f-f192af5824e7-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'sympy/core/tests/test_numbers.py'}, 'id': 'b7fbc59b-8150-4dfc-82b1-6830e4016f51', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2089, 'output_tokens': 69, 'total_tokens': 2251, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 93}}
2025-12-21 13:50:16,664 - thread-136261515871936.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "sympy/core/tests/test_numbers.py", "start_line": 501.0, "end_line": 1000.0}'}, '__gemini_function_call_thought_signatures__': {'fc24e7ab-7c44-425e-bb5c-645e26d7e516': 'CoUNAY89a18gHe7Ajw+1COaqOzk31aBv5IRvNItiS+n8noRVjE2I+jaxt4+VzcQn4W05zH0uPNTjbIHokUyitMQJkeiT4N8wZ58W+oPmHMk8z1/e5L1nDS5PMa1ZmFUm/gFdoIZTTO0wRCQ8S5uyjB4HefSgiFMDRpmhywmfSttpf3BbpZTmFODc1sHyRgPgI83zqw1ppLD/tvOjaG2FALIANjOcsyar7s475ug9MSyZ2k/vaD91dPlUoRYUL8RGceATx3K6BajozqRjQb2UVfRmvtNko+6SwVX8eQqcPcvV1CvGdRtzQS2jwEOw/Dxd230RSryKYArzRPMDnYY6cQooBjPrnz1fcmhB9+maLtVN6dRSweW9swKsOyxhhKeAMk039a/vpYpX477XJbTk92MkvxzHTpL/+q25f7IoTnhuKzPwZ61qDGi9Z5S68VmYRE1TYtFijRQ+Mw+ysba56dCfzwPJQq20K83d+auA9qkhzMAkaqpaUXCT6LTZzaLiOH3idzvyNxzBRANII1oEPEAit668yWDfWDoo1MFpWvUXF55VtxXzNEhP0rubM5hNyBFniohXo1dUkVacrzgcWvhRLBFcWVzFiqQA89qxfEGCyzD3KM00oI3CwHobmu18rl0jF7heMcdLt9qfu+8r1t/8PBo4udFJ7qHmJ5h3+dDKr/J/e/T0fwqBV2etmXSgS1vTrs0/35ckN2NhbMERWrLRBZhXxyeXfeVrQytkeAn6BqEu68Ut/3dRUSQ72Ez9xpk2fUOAzZ6LwmF4lhNvQrmS0AipgJU7vMFMDAHMYedof/Sn9NFJh9HC07MEI6roMmA+Tv7x0/GurRUIOvmIzi+U20sGOfT2f3ArL/9vCmFs5LP7WgHtGiHowQwkGsOJoLHfqoEeY9t4/5PDyvrUXd8of2a3emHfbW5zfqidVF1AhDmBntM1t8NUFIMsuVspMo/Bp1amaSVDgxoMMSWgLAgeTa3AWP/VAQDnOc7DXmWRaUXb1nf/o0R8Z1+Cm2M3M2FdtMFyPksPHjy8ckNfdDJqa5YUxp8Hb0+76dwRO6sAcjonX71oIK3w3hclD4Ul/sUL+u63AluCcC0RB5DordeGUVs1rhsLOOlpb2TX0LTHE5/hh4jFpHW7GYsPPzS+bmf6u5Mz8yhGNQFElDywN2SxwcKu5YnDMw4eiAi9LHULYCEeVP9NzMEGY3QJZUDO8tLQ4ybIHBoT2NRJBQIOw534TxO/RFCuPDmfq+wvmprOMmiz6U5ZGELYjYN8X69VHGq5xPdCyumYyRyWgM8R4F3arQU4pVY7R4lJTERoQxxi2hlscOOGx5t9yYsRN/qGQYn5v2YweJSB/HVlRV44k7XNwy7Cf53FJOxTtomsJ1Wd8rPLC7/wT4eGnt9Pgn3QWdg7vG2yiLCIuLg6VZ2gWzyre4lZy+sHE7a4I/t6wfL0fufboWMA4n7OMiYlA3dOLwkna2wBnGMgyqYR6XIi1VtCaMphiEVyrRLmUnd4UDwNMjZX1w6TADhDQ49F5q5OB0zgOfNaqFVEeECcPy/05jOtO8/OuS1Zk4ZdRv5MAT1kwZMtU/aSPs2I1Sz5s8al666iroP2PZVJg5DkrAMzBCDC3DGxZDz0qGWm78NvYqWkcVOS85t/nGO+e1aw7wEK298US1VDSXr9r8TNymDKohfXy4KOTvyFO8oS5jo5UbfnovzjMAAPSqAUv5f5NkX72Jp5eh/gDK0bJwymlcPExjm3FWUwaIbplvh2Wr67gvELMC22WzBKhmopo93XrOiQGS2Plfbn13F1RJs0xuedKXVQT2Qm+c1MVJG87IY+FJ3iALUapIVHDlh5aPEjZN8nd2LFCdwROYVxfJt+zUsLkysw9xMnix+Yt6gJCO3ADdu/nVyPvXU2HCbyeW0Svdnls/pqn8VxmYwVXg2nOyYVjq9e77iMhoPOChI58hhm15OZj3bi8NdDTfwoJM/UbBa3hSR1ONB3178m46bfJXkOJjrevWiflOTRIUcsveTU+677/iYhqkZomx64oSV5it2crrGBAlbedPh0Ltat0R4+6I302l6sgHJIXjwHvKkM4rhysYEUFmgw6XYQUbSUi6lx112WYc2amyd95+D9OXyLytBhybweY/Gl/fbsny/g66K79TJGyrkdbHZPPvuKH7iFaKP6PhaVAkQVUem+c6M0R75nb5QLlicBfkAzCXFC7zCJbWmAOMwTqg=='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 11594, 'candidates_token_count': 31, 'total_token_count': 12114, 'cached_content_token_count': 1844, 'prompt_tokens_details': [{'modality': 1, 'token_count': 11594}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1844}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 31}], 'thoughts_token_count': 489}, 'finish_reason': 'STOP', 'avg_logprobs': -2.0879277875346522, 'model_name': 'gemini-2.5-pro'} id='run--4ba9219b-bf0e-4dfb-a77b-58a899d60536-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'sympy/core/tests/test_numbers.py', 'start_line': 501.0, 'end_line': 1000.0}, 'id': 'fc24e7ab-7c44-425e-bb5c-645e26d7e516', 'type': 'tool_call'}] usage_metadata={'input_tokens': 11594, 'output_tokens': 31, 'total_tokens': 12114, 'input_token_details': {'cache_read': 1844}, 'output_token_details': {'reasoning': 489}}
2025-12-21 13:50:19,684 - thread-136261515871936.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"end_line": 2000.0, "start_line": 1001.0, "relative_path": "sympy/core/tests/test_numbers.py"}'}, '__gemini_function_call_thought_signatures__': {'8f838aeb-2525-4730-8301-8a3c2bf2debb': 'CucCAY89a1/zEXPsDBtdoEzZagxFcGYf2eOo6bxHnF2rIm0wVWD5oYBzKePx15Niq+HXv1qbTxxUEHCdDOgWefkcxnBPgHfeXwTBzLxfv9fz7Pvwsc7A1uc/2X+19eCBZ2bZ0klN7/z2pmP1OrQVyKONOYD/9+XQIR56IABkBPw9bGcCCB9CPJMe2C2ljMYPuzsFAyzfJZKdu7YMJUzaQTa+Wgq80TrAKAHPU5cIHyTCq+vkoXy36VZaiGNP3cM7c/F4yXQ1ziKNu8Rh7ForiSnk/UVX4C5DJq4faX75W4pPn0msv6iqGEe2Pd9zfcjob16iIS0Q8OdQkXTdE2fwsJMZzbZVzq3WHtrQtSpnHPO3c6bfb1j2sgCaAo66HQtVfi2mPBCANO7BThDD/M8+U/JvGOGSga45zmxY1ribcruT+K1GPgTP0uuhsmgMWIlpQczBgqcbbSkrHJElFzzygnfgjHr1S3QaINw='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 20165, 'candidates_token_count': 31, 'total_token_count': 20307, 'cached_content_token_count': 11499, 'prompt_tokens_details': [{'modality': 1, 'token_count': 20654}], 'cache_tokens_details': [{'modality': 1, 'token_count': 11499}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 31}], 'thoughts_token_count': 111}, 'finish_reason': 'STOP', 'avg_logprobs': -0.3944703071348129, 'model_name': 'gemini-2.5-pro'} id='run--563a0e8a-a595-4f15-87f6-81b31befa984-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'end_line': 2000.0, 'start_line': 1001.0, 'relative_path': 'sympy/core/tests/test_numbers.py'}, 'id': '8f838aeb-2525-4730-8301-8a3c2bf2debb', 'type': 'tool_call'}] usage_metadata={'input_tokens': 20165, 'output_tokens': 31, 'total_tokens': 20307, 'input_token_details': {'cache_read': 11499}, 'output_token_details': {'reasoning': 111}}
2025-12-21 13:50:22,660 - thread-136261515871936.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 2001.0, "end_line": 3000.0, "relative_path": "sympy/core/tests/test_numbers.py"}'}, '__gemini_function_call_thought_signatures__': {'7361da1d-59fa-41ef-b82f-b988e5365f8b': 'CvQCAY89a196IIP3j1/rO3ITT5v6EwvjOfnVrwtgSvo41kWwEtzw+p7vv+JKfGrevW3JJhFQXgzRHoK33+PzQe4b7NYqxaWh8i1TpNYBmXeLtu1dn3eVkirWKmGQGz1JDNossHhoInWwHop1EO1+zLjMyiKnl1anAPkPb1zZtfU6xy1RxHDfzei8RifKctZfl+60ngs2oGFKENe0c9FuxSjeajkPkBVD6xIWjoRCt1pSB2Ok6bOtCZcoDcDrfq/rS7LC96gRJfiCr1kzj5QG1tt2QissAta1p3rrjFu/WlCoWnXrbBWcFm5UR6edHKw9HUC6v+LYeFftpZ65Ga2qb9+VVLYLkmvRnqAmRjsebGIVLp9JDt65itz/1AqO9TsGInXMLOyIEGdV09PgtOGIz49ZW+/yTdb9y2Xm0G+WswKZVEUQppETzwdbQMn8D2UOcAiFiD2PgqG4TuXdCl+DSRbLmWcMWdfxMdTMZbNIHmBGeoji9lSG'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 41545, 'candidates_token_count': 31, 'total_token_count': 41700, 'cached_content_token_count': 19727, 'prompt_tokens_details': [{'modality': 1, 'token_count': 42145}], 'cache_tokens_details': [{'modality': 1, 'token_count': 19727}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 31}], 'thoughts_token_count': 124}, 'finish_reason': 'STOP', 'avg_logprobs': -0.05184163201239801, 'model_name': 'gemini-2.5-pro'} id='run--dba17dd6-d33c-4339-a033-158c080fe03c-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 2001.0, 'end_line': 3000.0, 'relative_path': 'sympy/core/tests/test_numbers.py'}, 'id': '7361da1d-59fa-41ef-b82f-b988e5365f8b', 'type': 'tool_call'}] usage_metadata={'input_tokens': 41545, 'output_tokens': 31, 'total_tokens': 41700, 'input_token_details': {'cache_read': 19727}, 'output_token_details': {'reasoning': 124}}
2025-12-21 13:50:30,014 - thread-136261515871936.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the full content of `sympy/core/tests/test_numbers.py` by reading it in chunks. You can now analyze the tests for the `Rational` class to find existing test cases relevant to the bug you are investigating. The file contains a comprehensive suite of tests covering various aspects of the `Rational` class and other numerical types in SymPy.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 45372, 'candidates_token_count': 76, 'total_token_count': 45804, 'cached_content_token_count': 21722, 'prompt_tokens_details': [{'modality': 1, 'token_count': 46096}], 'cache_tokens_details': [{'modality': 1, 'token_count': 21722}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 76}], 'thoughts_token_count': 356}, 'finish_reason': 'STOP', 'avg_logprobs': -0.6253498478939659, 'model_name': 'gemini-2.5-pro'} id='run--9e9392a2-2953-4ed9-a9ee-a41e34e3d634-0' usage_metadata={'input_tokens': 45372, 'output_tokens': 76, 'total_tokens': 45804, 'input_token_details': {'cache_read': 21722}, 'output_token_details': {'reasoning': 356}}
2025-12-21 13:50:30,017 - thread-136261515871936.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of the file `sympy/core/tests/test_numbers.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
I need to analyze the tests for the `Rational` class to find existing test cases that are relevant to the described bug.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: sympy/core/tests/test_numbers.py
Line number range: 1 - 500
Content:
1. import numbers as nums
2. import decimal
3. from sympy.concrete.summations import Sum
4. from sympy.core import (EulerGamma, Catalan, TribonacciConstant,
5.     GoldenRatio)
6. from sympy.core.containers import Tuple
7. from sympy.core.expr import unchanged
8. from sympy.core.logic import fuzzy_not
9. from sympy.core.mul import Mul
10. from sympy.core.numbers import (mpf_norm, mod_inverse, igcd, seterr,
11.     igcd_lehmer, Integer, I, pi, comp, ilcm, Rational, E, nan, igcd2,
12.     oo, AlgebraicNumber, igcdex, Number, Float, zoo)
13. from sympy.core.power import Pow
14. from sympy.core.relational import Ge, Gt, Le, Lt
15. from sympy.core.singleton import S
16. from sympy.core.symbol import Dummy, Symbol
17. from sympy.core.sympify import sympify
18. from sympy.functions.combinatorial.factorials import factorial
19. from sympy.functions.elementary.integers import floor
20. from sympy.functions.combinatorial.numbers import fibonacci
21. from sympy.functions.elementary.exponential import exp, log
22. from sympy.functions.elementary.miscellaneous import sqrt, cbrt
23. from sympy.functions.elementary.trigonometric import cos, sin
24. from sympy.polys.domains.realfield import RealField
25. from sympy.printing.latex import latex
26. from sympy.printing.repr import srepr
27. from sympy.simplify import simplify
28. from sympy.core.power import integer_nthroot, isqrt, integer_log
29. from sympy.polys.domains.groundtypes import PythonRational
30. from sympy.utilities.decorator import conserve_mpmath_dps
31. from sympy.utilities.iterables import permutations
32. from sympy.testing.pytest import XFAIL, raises, _both_exp_pow
33. 
34. from mpmath import mpf
35. from mpmath.rational import mpq
36. import mpmath
37. from sympy.core import numbers
38. t = Symbol('t', real=False)
39. 
40. _ninf = float(-oo)
41. _inf = float(oo)
42. 
43. 
44. def same_and_same_prec(a, b):
45.     # stricter matching for Floats
46.     return a == b and a._prec == b._prec
47. 
48. 
49. def test_seterr():
50.     seterr(divide=True)
51.     raises(ValueError, lambda: S.Zero/S.Zero)
52.     seterr(divide=False)
53.     assert S.Zero / S.Zero is S.NaN
54. 
55. 
56. def test_mod():
57.     x = S.Half
58.     y = Rational(3, 4)
59.     z = Rational(5, 18043)
60. 
61.     assert x % x == 0
62.     assert x % y == S.Half
63.     assert x % z == Rational(3, 36086)
64.     assert y % x == Rational(1, 4)
65.     assert y % y == 0
66.     assert y % z == Rational(9, 72172)
67.     assert z % x == Rational(5, 18043)
68.     assert z % y == Rational(5, 18043)
69.     assert z % z == 0
70. 
71.     a = Float(2.6)
72. 
73.     assert (a % .2) == 0.0
74.     assert (a % 2).round(15) == 0.6
75.     assert (a % 0.5).round(15) == 0.1
76. 
77.     p = Symbol('p', infinite=True)
78. 
79.     assert oo % oo is nan
80.     assert zoo % oo is nan
81.     assert 5 % oo is nan
82.     assert p % 5 is nan
83. 
84.     # In these two tests, if the precision of m does
85.     # not match the precision of the ans, then it is
86.     # likely that the change made now gives an answer
87.     # with degraded accuracy.
88.     r = Rational(500, 41)
89.     f = Float('.36', 3)
90.     m = r % f
91.     ans = Float(r % Rational(f), 3)
92.     assert m == ans and m._prec == ans._prec
93.     f = Float('8.36', 3)
94.     m = f % r
95.     ans = Float(Rational(f) % r, 3)
96.     assert m == ans and m._prec == ans._prec
97. 
98.     s = S.Zero
99. 
100.     assert s % float(1) == 0.0
101. 
102.     # No rounding required since these numbers can be represented
103.     # exactly.
104.     assert Rational(3, 4) % Float(1.1) == 0.75
105.     assert Float(1.5) % Rational(5, 4) == 0.25
106.     assert Rational(5, 4).__rmod__(Float('1.5')) == 0.25
107.     assert Float('1.5').__rmod__(Float('2.75')) == Float('1.25')
108.     assert 2.75 % Float('1.5') == Float('1.25')
109. 
110.     a = Integer(7)
111.     b = Integer(4)
112. 
113.     assert type(a % b) == Integer
114.     assert a % b == Integer(3)
115.     assert Integer(1) % Rational(2, 3) == Rational(1, 3)
116.     assert Rational(7, 5) % Integer(1) == Rational(2, 5)
117.     assert Integer(2) % 1.5 == 0.5
118. 
119.     assert Integer(3).__rmod__(Integer(10)) == Integer(1)
120.     assert Integer(10) % 4 == Integer(2)
121.     assert 15 % Integer(4) == Integer(3)
122. 
123. 
124. def test_divmod():
125.     x = Symbol("x")
126.     assert divmod(S(12), S(8)) == Tuple(1, 4)
127.     assert divmod(-S(12), S(8)) == Tuple(-2, 4)
128.     assert divmod(S.Zero, S.One) == Tuple(0, 0)
129.     raises(ZeroDivisionError, lambda: divmod(S.Zero, S.Zero))
130.     raises(ZeroDivisionError, lambda: divmod(S.One, S.Zero))
131.     assert divmod(S(12), 8) == Tuple(1, 4)
132.     assert divmod(12, S(8)) == Tuple(1, 4)
133.     assert S(1024)//x == 1024//x == floor(1024/x)
134. 
135.     assert divmod(S("2"), S("3/2")) == Tuple(S("1"), S("1/2"))
136.     assert divmod(S("3/2"), S("2")) == Tuple(S("0"), S("3/2"))
137.     assert divmod(S("2"), S("3.5")) == Tuple(S("0"), S("2"))
138.     assert divmod(S("3.5"), S("2")) == Tuple(S("1"), S("1.5"))
139.     assert divmod(S("2"), S("1/3")) == Tuple(S("6"), S("0"))
140.     assert divmod(S("1/3"), S("2")) == Tuple(S("0"), S("1/3"))
141.     assert divmod(S("2"), S("1/10")) == Tuple(S("20"), S("0"))
142.     assert divmod(S("2"), S(".1"))[0] == 19
143.     assert divmod(S("0.1"), S("2")) == Tuple(S("0"), S("0.1"))
144.     assert divmod(S("2"), 2) == Tuple(S("1"), S("0"))
145.     assert divmod(2, S("2")) == Tuple(S("1"), S("0"))
146.     assert divmod(S("2"), 1.5) == Tuple(S("1"), S("0.5"))
147.     assert divmod(1.5, S("2")) == Tuple(S("0"), S("1.5"))
148.     assert divmod(0.3, S("2")) == Tuple(S("0"), S("0.3"))
149.     assert divmod(S("3/2"), S("3.5")) == Tuple(S("0"), S("3/2"))
150.     assert divmod(S("3.5"), S("3/2")) == Tuple(S("2"), S("0.5"))
151.     assert divmod(S("3/2"), S("1/3")) == Tuple(S("4"), S("1/6"))
152.     assert divmod(S("1/3"), S("3/2")) == Tuple(S("0"), S("1/3"))
153.     assert divmod(S("3/2"), S("0.1"))[0] == 14
154.     assert divmod(S("0.1"), S("3/2")) == Tuple(S("0"), S("0.1"))
155.     assert divmod(S("3/2"), 2) == Tuple(S("0"), S("3/2"))
156.     assert divmod(2, S("3/2")) == Tuple(S("1"), S("1/2"))
157.     assert divmod(S("3/2"), 1.5) == Tuple(S("1"), S("0"))
158.     assert divmod(1.5, S("3/2")) == Tuple(S("1"), S("0"))
159.     assert divmod(S("3/2"), 0.3) == Tuple(S("5"), S("0"))
160.     assert divmod(0.3, S("3/2")) == Tuple(S("0"), S("0.3"))
161.     assert divmod(S("1/3"), S("3.5")) == Tuple(S("0"), S("1/3"))
162.     assert divmod(S("3.5"), S("0.1")) == Tuple(S("35"), S("0"))
163.     assert divmod(S("0.1"), S("3.5")) == Tuple(S("0"), S("0.1"))
164.     assert divmod(S("3.5"), 2) == Tuple(S("1"), S("1.5"))
165.     assert divmod(2, S("3.5")) == Tuple(S("0"), S("2"))
166.     assert divmod(S("3.5"), 1.5) == Tuple(S("2"), S("0.5"))
167.     assert divmod(1.5, S("3.5")) == Tuple(S("0"), S("1.5"))
168.     assert divmod(0.3, S("3.5")) == Tuple(S("0"), S("0.3"))
169.     assert divmod(S("0.1"), S("1/3")) == Tuple(S("0"), S("0.1"))
170.     assert divmod(S("1/3"), 2) == Tuple(S("0"), S("1/3"))
171.     assert divmod(2, S("1/3")) == Tuple(S("6"), S("0"))
172.     assert divmod(S("1/3"), 1.5) == Tuple(S("0"), S("1/3"))
173.     assert divmod(0.3, S("1/3")) == Tuple(S("0"), S("0.3"))
174.     assert divmod(S("0.1"), 2) == Tuple(S("0"), S("0.1"))
175.     assert divmod(2, S("0.1"))[0] == 19
176.     assert divmod(S("0.1"), 1.5) == Tuple(S("0"), S("0.1"))
177.     assert divmod(1.5, S("0.1")) == Tuple(S("15"), S("0"))
178.     assert divmod(S("0.1"), 0.3) == Tuple(S("0"), S("0.1"))
179. 
180.     assert str(divmod(S("2"), 0.3)) == '(6, 0.2)'
181.     assert str(divmod(S("3.5"), S("1/3"))) == '(10, 0.166666666666667)'
182.     assert str(divmod(S("3.5"), 0.3)) == '(11, 0.2)'
183.     assert str(divmod(S("1/3"), S("0.1"))) == '(3, 0.0333333333333333)'
184.     assert str(divmod(1.5, S("1/3"))) == '(4, 0.166666666666667)'
185.     assert str(divmod(S("1/3"), 0.3)) == '(1, 0.0333333333333333)'
186.     assert str(divmod(0.3, S("0.1"))) == '(2, 0.1)'
187. 
188.     assert divmod(-3, S(2)) == (-2, 1)
189.     assert divmod(S(-3), S(2)) == (-2, 1)
190.     assert divmod(S(-3), 2) == (-2, 1)
191. 
192.     assert divmod(S(4), S(-3.1)) == Tuple(-2, -2.2)
193.     assert divmod(S(4), S(-2.1)) == divmod(4, -2.1)
194.     assert divmod(S(-8), S(-2.5) ) == Tuple(3, -0.5)
195. 
196.     assert divmod(oo, 1) == (S.NaN, S.NaN)
197.     assert divmod(S.NaN, 1) == (S.NaN, S.NaN)
198.     assert divmod(1, S.NaN) == (S.NaN, S.NaN)
199.     ans = [(-1, oo), (-1, oo), (0, 0), (0, 1), (0, 2)]
200.     OO = float('inf')
201.     ANS = [tuple(map(float, i)) for i in ans]
202.     assert [divmod(i, oo) for i in range(-2, 3)] == ans
203.     ans = [(0, -2), (0, -1), (0, 0), (-1, -oo), (-1, -oo)]
204.     ANS = [tuple(map(float, i)) for i in ans]
205.     assert [divmod(i, -oo) for i in range(-2, 3)] == ans
206.     assert [divmod(i, -OO) for i in range(-2, 3)] == ANS
207.     assert divmod(S(3.5), S(-2)) == divmod(3.5, -2)
208.     assert divmod(-S(3.5), S(-2)) == divmod(-3.5, -2)
209.     assert divmod(S(0.0), S(9)) == divmod(0.0, 9)
210.     assert divmod(S(0), S(9.0)) == divmod(0, 9.0)
211. 
212. 
213. def test_igcd():
214.     assert igcd(0, 0) == 0
215.     assert igcd(0, 1) == 1
216.     assert igcd(1, 0) == 1
217.     assert igcd(0, 7) == 7
218.     assert igcd(7, 0) == 7
219.     assert igcd(7, 1) == 1
220.     assert igcd(1, 7) == 1
221.     assert igcd(-1, 0) == 1
222.     assert igcd(0, -1) == 1
223.     assert igcd(-1, -1) == 1
224.     assert igcd(-1, 7) == 1
225.     assert igcd(7, -1) == 1
226.     assert igcd(8, 2) == 2
227.     assert igcd(4, 8) == 4
228.     assert igcd(8, 16) == 8
229.     assert igcd(7, -3) == 1
230.     assert igcd(-7, 3) == 1
231.     assert igcd(-7, -3) == 1
232.     assert igcd(*[10, 20, 30]) == 10
233.     raises(TypeError, lambda: igcd())
234.     raises(TypeError, lambda: igcd(2))
235.     raises(ValueError, lambda: igcd(0, None))
236.     raises(ValueError, lambda: igcd(1, 2.2))
237.     for args in permutations((45.1, 1, 30)):
238.         raises(ValueError, lambda: igcd(*args))
239.     for args in permutations((1, 2, None)):
240.         raises(ValueError, lambda: igcd(*args))
241. 
242. 
243. def test_igcd_lehmer():
244.     a, b = fibonacci(10001), fibonacci(10000)
245.     # len(str(a)) == 2090
246.     # small divisors, long Euclidean sequence
247.     assert igcd_lehmer(a, b) == 1
248.     c = fibonacci(100)
249.     assert igcd_lehmer(a*c, b*c) == c
250.     # big divisor
251.     assert igcd_lehmer(a, 10**1000) == 1
252.     # swapping argument
253.     assert igcd_lehmer(1, 2) == igcd_lehmer(2, 1)
254. 
255. 
256. def test_igcd2():
257.     # short loop
258.     assert igcd2(2**100 - 1, 2**99 - 1) == 1
259.     # Lehmer's algorithm
260.     a, b = int(fibonacci(10001)), int(fibonacci(10000))
261.     assert igcd2(a, b) == 1
262. 
263. 
264. def test_ilcm():
265.     assert ilcm(0, 0) == 0
266.     assert ilcm(1, 0) == 0
267.     assert ilcm(0, 1) == 0
268.     assert ilcm(1, 1) == 1
269.     assert ilcm(2, 1) == 2
270.     assert ilcm(8, 2) == 8
271.     assert ilcm(8, 6) == 24
272.     assert ilcm(8, 7) == 56
273.     assert ilcm(*[10, 20, 30]) == 60
274.     raises(ValueError, lambda: ilcm(8.1, 7))
275.     raises(ValueError, lambda: ilcm(8, 7.1))
276.     raises(TypeError, lambda: ilcm(8))
277. 
278. 
279. def test_igcdex():
280.     assert igcdex(2, 3) == (-1, 1, 1)
281.     assert igcdex(10, 12) == (-1, 1, 2)
282.     assert igcdex(100, 2004) == (-20, 1, 4)
283.     assert igcdex(0, 0) == (0, 1, 0)
284.     assert igcdex(1, 0) == (1, 0, 1)
285. 
286. 
287. def _strictly_equal(a, b):
288.     return (a.p, a.q, type(a.p), type(a.q)) == \
289.            (b.p, b.q, type(b.p), type(b.q))
290. 
291. 
292. def _test_rational_new(cls):
293.     """
294.     Tests that are common between Integer and Rational.
295.     """
296.     assert cls(0) is S.Zero
297.     assert cls(1) is S.One
298.     assert cls(-1) is S.NegativeOne
299.     # These look odd, but are similar to int():
300.     assert cls('1') is S.One
301.     assert cls('-1') is S.NegativeOne
302. 
303.     i = Integer(10)
304.     assert _strictly_equal(i, cls('10'))
305.     assert _strictly_equal(i, cls('10'))
306.     assert _strictly_equal(i, cls(int(10)))
307.     assert _strictly_equal(i, cls(i))
308. 
309.     raises(TypeError, lambda: cls(Symbol('x')))
310. 
311. 
312. def test_Integer_new():
313.     """
314.     Test for Integer constructor
315.     """
316.     _test_rational_new(Integer)
317. 
318.     assert _strictly_equal(Integer(0.9), S.Zero)
319.     assert _strictly_equal(Integer(10.5), Integer(10))
320.     raises(ValueError, lambda: Integer("10.5"))
321.     assert Integer(Rational('1.' + '9'*20)) == 1
322. 
323. 
324. def test_Rational_new():
325.     """"
326.     Test for Rational constructor
327.     """
328.     _test_rational_new(Rational)
329. 
330.     n1 = S.Half
331.     assert n1 == Rational(Integer(1), 2)
332.     assert n1 == Rational(Integer(1), Integer(2))
333.     assert n1 == Rational(1, Integer(2))
334.     assert n1 == Rational(S.Half)
335.     assert 1 == Rational(n1, n1)
336.     assert Rational(3, 2) == Rational(S.Half, Rational(1, 3))
337.     assert Rational(3, 1) == Rational(1, Rational(1, 3))
338.     n3_4 = Rational(3, 4)
339.     assert Rational('3/4') == n3_4
340.     assert -Rational('-3/4') == n3_4
341.     assert Rational('.76').limit_denominator(4) == n3_4
342.     assert Rational(19, 25).limit_denominator(4) == n3_4
343.     assert Rational('19/25').limit_denominator(4) == n3_4
344.     assert Rational(1.0, 3) == Rational(1, 3)
345.     assert Rational(1, 3.0) == Rational(1, 3)
346.     assert Rational(Float(0.5)) == S.Half
347.     assert Rational('1e2/1e-2') == Rational(10000)
348.     assert Rational('1 234') == Rational(1234)
349.     assert Rational('1/1 234') == Rational(1, 1234)
350.     assert Rational(-1, 0) is S.ComplexInfinity
351.     assert Rational(1, 0) is S.ComplexInfinity
352.     # Make sure Rational doesn't lose precision on Floats
353.     assert Rational(pi.evalf(100)).evalf(100) == pi.evalf(100)
354.     raises(TypeError, lambda: Rational('3**3'))
355.     raises(TypeError, lambda: Rational('1/2 + 2/3'))
356. 
357.     # handle fractions.Fraction instances
358.     try:
359.         import fractions
360.         assert Rational(fractions.Fraction(1, 2)) == S.Half
361.     except ImportError:
362.         pass
363. 
364.     assert Rational(mpq(2, 6)) == Rational(1, 3)
365.     assert Rational(PythonRational(2, 6)) == Rational(1, 3)
366. 
367.     assert Rational(2, 4, gcd=1).q == 4
368.     n = Rational(2, -4, gcd=1)
369.     assert n.q == 4
370.     assert n.p == -2
371. 
372. 
373. def test_Number_new():
374.     """"
375.     Test for Number constructor
376.     """
377.     # Expected behavior on numbers and strings
378.     assert Number(1) is S.One
379.     assert Number(2).__class__ is Integer
380.     assert Number(-622).__class__ is Integer
381.     assert Number(5, 3).__class__ is Rational
382.     assert Number(5.3).__class__ is Float
383.     assert Number('1') is S.One
384.     assert Number('2').__class__ is Integer
385.     assert Number('-622').__class__ is Integer
386.     assert Number('5/3').__class__ is Rational
387.     assert Number('5.3').__class__ is Float
388.     raises(ValueError, lambda: Number('cos'))
389.     raises(TypeError, lambda: Number(cos))
390.     a = Rational(3, 5)
391.     assert Number(a) is a  # Check idempotence on Numbers
392.     u = ['inf', '-inf', 'nan', 'iNF', '+inf']
393.     v = [oo, -oo, nan, oo, oo]
394.     for i, a in zip(u, v):
395.         assert Number(i) is a, (i, Number(i), a)
396. 
397. 
398. def test_Number_cmp():
399.     n1 = Number(1)
400.     n2 = Number(2)
401.     n3 = Number(-3)
402. 
403.     assert n1 < n2
404.     assert n1 <= n2
405.     assert n3 < n1
406.     assert n2 > n3
407.     assert n2 >= n3
408. 
409.     raises(TypeError, lambda: n1 < S.NaN)
410.     raises(TypeError, lambda: n1 <= S.NaN)
411.     raises(TypeError, lambda: n1 > S.NaN)
412.     raises(TypeError, lambda: n1 >= S.NaN)
413. 
414. 
415. def test_Rational_cmp():
416.     n1 = Rational(1, 4)
417.     n2 = Rational(1, 3)
418.     n3 = Rational(2, 4)
419.     n4 = Rational(2, -4)
420.     n5 = Rational(0)
421.     n6 = Rational(1)
422.     n7 = Rational(3)
423.     n8 = Rational(-3)
424. 
425.     assert n8 < n5
426.     assert n5 < n6
427.     assert n6 < n7
428.     assert n8 < n7
429.     assert n7 > n8
430.     assert (n1 + 1)**n2 < 2
431.     assert ((n1 + n6)/n7) < 1
432. 
433.     assert n4 < n3
434.     assert n2 < n3
435.     assert n1 < n2
436.     assert n3 > n1
437.     assert not n3 < n1
438.     assert not (Rational(-1) > 0)
439.     assert Rational(-1) < 0
440. 
441.     raises(TypeError, lambda: n1 < S.NaN)
442.     raises(TypeError, lambda: n1 <= S.NaN)
443.     raises(TypeError, lambda: n1 > S.NaN)
444.     raises(TypeError, lambda: n1 >= S.NaN)
445. 
446. 
447. def test_Float():
448.     def eq(a, b):
449.         t = Float("1.0E-15")
450.         return (-t < a - b < t)
451. 
452.     zeros = (0, S.Zero, 0., Float(0))
453.     for i, j in permutations(zeros, 2):
454.         assert i == j
455.     for z in zeros:
456.         assert z in zeros
457.     assert S.Zero.is_zero
458. 
459.     a = Float(2) ** Float(3)
460.     assert eq(a.evalf(), Float(8))
461.     assert eq((pi ** -1).evalf(), Float("0.31830988618379067"))
462.     a = Float(2) ** Float(4)
463.     assert eq(a.evalf(), Float(16))
464.     assert (S(.3) == S(.5)) is False
465. 
466.     mpf = (0, 5404319552844595, -52, 53)
467.     x_str = Float((0, '13333333333333', -52, 53))
468.     x_0xstr = Float((0, '0x13333333333333', -52, 53))
469.     x2_str = Float((0, '26666666666666', -53, 54))
470.     x_hex = Float((0, int(0x13333333333333), -52, 53))
471.     x_dec = Float(mpf)
472.     assert x_str == x_0xstr == x_hex == x_dec == Float(1.2)
473.     # x2_str was entered slightly malformed in that the mantissa
474.     # was even -- it should be odd and the even part should be
475.     # included with the exponent, but this is resolved by normalization
476.     # ONLY IF REQUIREMENTS of mpf_norm are met: the bitcount must
477.     # be exact: double the mantissa ==> increase bc by 1
478.     assert Float(1.2)._mpf_ == mpf
479.     assert x2_str._mpf_ == mpf
480. 
481.     assert Float((0, int(0), -123, -1)) is S.NaN
482.     assert Float((0, int(0), -456, -2)) is S.Infinity
483.     assert Float((1, int(0), -789, -3)) is S.NegativeInfinity
484.     # if you don't give the full signature, it's not special
485.     assert Float((0, int(0), -123)) == Float(0)
486.     assert Float((0, int(0), -456)) == Float(0)
487.     assert Float((1, int(0), -789)) == Float(0)
488. 
489.     raises(ValueError, lambda: Float((0, 7, 1, 3), ''))
490. 
491.     assert Float('0.0').is_finite is True
492.     assert Float('0.0').is_negative is False
493.     assert Float('0.0').is_positive is False
494.     assert Float('0.0').is_infinite is False
495.     assert Float('0.0').is_zero is True
496. 
497.     # rationality properties
498.     # if the integer test fails then the use of intlike
499.     # should be removed from gamma_functions.py
500.     assert Float(1).is_integer is False


File: sympy/core/tests/test_numbers.py
Line number range: 501 - 1000
Content:
501.     assert Float(1).is_rational is None
502.     assert Float(1).is_irrational is None
503.     assert sqrt(2).n(15).is_rational is None
504.     assert sqrt(2).n(15).is_irrational is None
505. 
506.     # do not automatically evalf
507.     def teq(a):
508.         assert (a.evalf() == a) is False
509.         assert (a.evalf() != a) is True
510.         assert (a == a.evalf()) is False
511.         assert (a != a.evalf()) is True
512. 
513.     teq(pi)
514.     teq(2*pi)
515.     teq(cos(0.1, evaluate=False))
516. 
517.     # long integer
518.     i = 12345678901234567890
519.     assert same_and_same_prec(Float(12, ''), Float('12', ''))
520.     assert same_and_same_prec(Float(Integer(i), ''), Float(i, ''))
521.     assert same_and_same_prec(Float(i, ''), Float(str(i), 20))
522.     assert same_and_same_prec(Float(str(i)), Float(i, ''))
523.     assert same_and_same_prec(Float(i), Float(i, ''))
524. 
525.     # inexact floats (repeating binary = denom not multiple of 2)
526.     # cannot have precision greater than 15
527.     assert Float(.125, 22) == .125
528.     assert Float(2.0, 22) == 2
529.     assert float(Float('.12500000000000001', '')) == .125
530.     raises(ValueError, lambda: Float(.12500000000000001, ''))
531. 
532.     # allow spaces
533.     assert Float('123 456.123 456') == Float('123456.123456')
534.     assert Integer('123 456') == Integer('123456')
535.     assert Rational('123 456.123 456') == Rational('123456.123456')
536.     assert Float(' .3e2') == Float('0.3e2')
537. 
538.     # allow underscore
539.     assert Float('1_23.4_56') == Float('123.456')
540.     assert Float('1_') == Float('1.0')
541.     assert Float('1_.') == Float('1.0')
542.     assert Float('1._') == Float('1.0')
543.     assert Float('1__2') == Float('12.0')
544.     # assert Float('1_23.4_5_6', 12) == Float('123.456', 12)
545.     # ...but not in all cases (per Py 3.6)
546.     raises(ValueError, lambda: Float('_1'))
547.     raises(ValueError, lambda: Float('_inf'))
548. 
549.     # allow auto precision detection
550.     assert Float('.1', '') == Float(.1, 1)
551.     assert Float('.125', '') == Float(.125, 3)
552.     assert Float('.100', '') == Float(.1, 3)
553.     assert Float('2.0', '') == Float('2', 2)
554. 
555.     raises(ValueError, lambda: Float("12.3d-4", ""))
556.     raises(ValueError, lambda: Float(12.3, ""))
557.     raises(ValueError, lambda: Float('.'))
558.     raises(ValueError, lambda: Float('-.'))
559. 
560.     zero = Float('0.0')
561.     assert Float('-0') == zero
562.     assert Float('.0') == zero
563.     assert Float('-.0') == zero
564.     assert Float('-0.0') == zero
565.     assert Float(0.0) == zero
566.     assert Float(0) == zero
567.     assert Float(0, '') == Float('0', '')
568.     assert Float(1) == Float(1.0)
569.     assert Float(S.Zero) == zero
570.     assert Float(S.One) == Float(1.0)
571. 
572.     assert Float(decimal.Decimal('0.1'), 3) == Float('.1', 3)
573.     assert Float(decimal.Decimal('nan')) is S.NaN
574.     assert Float(decimal.Decimal('Infinity')) is S.Infinity
575.     assert Float(decimal.Decimal('-Infinity')) is S.NegativeInfinity
576. 
577.     assert '{:.3f}'.format(Float(4.236622)) == '4.237'
578.     assert '{:.35f}'.format(Float(pi.n(40), 40)) == \
579.         '3.14159265358979323846264338327950288'
580. 
581.     # unicode
582.     assert Float('0.73908513321516064100000000') == \
583.         Float('0.73908513321516064100000000')
584.     assert Float('0.73908513321516064100000000', 28) == \
585.         Float('0.73908513321516064100000000', 28)
586. 
587.     # binary precision
588.     # Decimal value 0.1 cannot be expressed precisely as a base 2 fraction
589.     a = Float(S.One/10, dps=15)
590.     b = Float(S.One/10, dps=16)
591.     p = Float(S.One/10, precision=53)
592.     q = Float(S.One/10, precision=54)
593.     assert a._mpf_ == p._mpf_
594.     assert not a._mpf_ == q._mpf_
595.     assert not b._mpf_ == q._mpf_
596. 
597.     # Precision specifying errors
598.     raises(ValueError, lambda: Float("1.23", dps=3, precision=10))
599.     raises(ValueError, lambda: Float("1.23", dps="", precision=10))
600.     raises(ValueError, lambda: Float("1.23", dps=3, precision=""))
601.     raises(ValueError, lambda: Float("1.23", dps="", precision=""))
602. 
603.     # from NumberSymbol
604.     assert same_and_same_prec(Float(pi, 32), pi.evalf(32))
605.     assert same_and_same_prec(Float(Catalan), Catalan.evalf())
606. 
607.     # oo and nan
608.     u = ['inf', '-inf', 'nan', 'iNF', '+inf']
609.     v = [oo, -oo, nan, oo, oo]
610.     for i, a in zip(u, v):
611.         assert Float(i) is a
612. 
613. 
614. def test_zero_not_false():
615.     # https://github.com/sympy/sympy/issues/20796
616.     assert (S(0.0) == S.false) is False
617.     assert (S.false == S(0.0)) is False
618.     assert (S(0) == S.false) is False
619.     assert (S.false == S(0)) is False
620. 
621. 
622. @conserve_mpmath_dps
623. def test_float_mpf():
624.     import mpmath
625.     mpmath.mp.dps = 100
626.     mp_pi = mpmath.pi()
627. 
628.     assert Float(mp_pi, 100) == Float(mp_pi._mpf_, 100) == pi.evalf(100)
629. 
630.     mpmath.mp.dps = 15
631. 
632.     assert Float(mp_pi, 100) == Float(mp_pi._mpf_, 100) == pi.evalf(100)
633. 
634. 
635. def test_Float_RealElement():
636.     repi = RealField(dps=100)(pi.evalf(100))
637.     # We still have to pass the precision because Float doesn't know what
638.     # RealElement is, but make sure it keeps full precision from the result.
639.     assert Float(repi, 100) == pi.evalf(100)
640. 
641. 
642. def test_Float_default_to_highprec_from_str():
643.     s = str(pi.evalf(128))
644.     assert same_and_same_prec(Float(s), Float(s, ''))
645. 
646. 
647. def test_Float_eval():
648.     a = Float(3.2)
649.     assert (a**2).is_Float
650. 
651. 
652. def test_Float_issue_2107():
653.     a = Float(0.1, 10)
654.     b = Float("0.1", 10)
655. 
656.     assert a - a == 0
657.     assert a + (-a) == 0
658.     assert S.Zero + a - a == 0
659.     assert S.Zero + a + (-a) == 0
660. 
661.     assert b - b == 0
662.     assert b + (-b) == 0
663.     assert S.Zero + b - b == 0
664.     assert S.Zero + b + (-b) == 0
665. 
666. 
667. def test_issue_14289():
668.     from sympy.polys.numberfields import to_number_field
669. 
670.     a = 1 - sqrt(2)
671.     b = to_number_field(a)
672.     assert b.as_expr() == a
673.     assert b.minpoly(a).expand() == 0
674. 
675. 
676. def test_Float_from_tuple():
677.     a = Float((0, '1L', 0, 1))
678.     b = Float((0, '1', 0, 1))
679.     assert a == b
680. 
681. 
682. def test_Infinity():
683.     assert oo != 1
684.     assert 1*oo is oo
685.     assert 1 != oo
686.     assert oo != -oo
687.     assert oo != Symbol("x")**3
688.     assert oo + 1 is oo
689.     assert 2 + oo is oo
690.     assert 3*oo + 2 is oo
691.     assert S.Half**oo == 0
692.     assert S.Half**(-oo) is oo
693.     assert -oo*3 is -oo
694.     assert oo + oo is oo
695.     assert -oo + oo*(-5) is -oo
696.     assert 1/oo == 0
697.     assert 1/(-oo) == 0
698.     assert 8/oo == 0
699.     assert oo % 2 is nan
700.     assert 2 % oo is nan
701.     assert oo/oo is nan
702.     assert oo/-oo is nan
703.     assert -oo/oo is nan
704.     assert -oo/-oo is nan
705.     assert oo - oo is nan
706.     assert oo - -oo is oo
707.     assert -oo - oo is -oo
708.     assert -oo - -oo is nan
709.     assert oo + -oo is nan
710.     assert -oo + oo is nan
711.     assert oo + oo is oo
712.     assert -oo + oo is nan
713.     assert oo + -oo is nan
714.     assert -oo + -oo is -oo
715.     assert oo*oo is oo
716.     assert -oo*oo is -oo
717.     assert oo*-oo is -oo
718.     assert -oo*-oo is oo
719.     assert oo/0 is oo
720.     assert -oo/0 is -oo
721.     assert 0/oo == 0
722.     assert 0/-oo == 0
723.     assert oo*0 is nan
724.     assert -oo*0 is nan
725.     assert 0*oo is nan
726.     assert 0*-oo is nan
727.     assert oo + 0 is oo
728.     assert -oo + 0 is -oo
729.     assert 0 + oo is oo
730.     assert 0 + -oo is -oo
731.     assert oo - 0 is oo
732.     assert -oo - 0 is -oo
733.     assert 0 - oo is -oo
734.     assert 0 - -oo is oo
735.     assert oo/2 is oo
736.     assert -oo/2 is -oo
737.     assert oo/-2 is -oo
738.     assert -oo/-2 is oo
739.     assert oo*2 is oo
740.     assert -oo*2 is -oo
741.     assert oo*-2 is -oo
742.     assert 2/oo == 0
743.     assert 2/-oo == 0
744.     assert -2/oo == 0
745.     assert -2/-oo == 0
746.     assert 2*oo is oo
747.     assert 2*-oo is -oo
748.     assert -2*oo is -oo
749.     assert -2*-oo is oo
750.     assert 2 + oo is oo
751.     assert 2 - oo is -oo
752.     assert -2 + oo is oo
753.     assert -2 - oo is -oo
754.     assert 2 + -oo is -oo
755.     assert 2 - -oo is oo
756.     assert -2 + -oo is -oo
757.     assert -2 - -oo is oo
758.     assert S(2) + oo is oo
759.     assert S(2) - oo is -oo
760.     assert oo/I == -oo*I
761.     assert -oo/I == oo*I
762.     assert oo*float(1) == _inf and (oo*float(1)) is oo
763.     assert -oo*float(1) == _ninf and (-oo*float(1)) is -oo
764.     assert oo/float(1) == _inf and (oo/float(1)) is oo
765.     assert -oo/float(1) == _ninf and (-oo/float(1)) is -oo
766.     assert oo*float(-1) == _ninf and (oo*float(-1)) is -oo
767.     assert -oo*float(-1) == _inf and (-oo*float(-1)) is oo
768.     assert oo/float(-1) == _ninf and (oo/float(-1)) is -oo
769.     assert -oo/float(-1) == _inf and (-oo/float(-1)) is oo
770.     assert oo + float(1) == _inf and (oo + float(1)) is oo
771.     assert -oo + float(1) == _ninf and (-oo + float(1)) is -oo
772.     assert oo - float(1) == _inf and (oo - float(1)) is oo
773.     assert -oo - float(1) == _ninf and (-oo - float(1)) is -oo
774.     assert float(1)*oo == _inf and (float(1)*oo) is oo
775.     assert float(1)*-oo == _ninf and (float(1)*-oo) is -oo
776.     assert float(1)/oo == 0
777.     assert float(1)/-oo == 0
778.     assert float(-1)*oo == _ninf and (float(-1)*oo) is -oo
779.     assert float(-1)*-oo == _inf and (float(-1)*-oo) is oo
780.     assert float(-1)/oo == 0
781.     assert float(-1)/-oo == 0
782.     assert float(1) + oo is oo
783.     assert float(1) + -oo is -oo
784.     assert float(1) - oo is -oo
785.     assert float(1) - -oo is oo
786.     assert oo == float(oo)
787.     assert (oo != float(oo)) is False
788.     assert type(float(oo)) is float
789.     assert -oo == float(-oo)
790.     assert (-oo != float(-oo)) is False
791.     assert type(float(-oo)) is float
792. 
793.     assert Float('nan') is nan
794.     assert nan*1.0 is nan
795.     assert -1.0*nan is nan
796.     assert nan*oo is nan
797.     assert nan*-oo is nan
798.     assert nan/oo is nan
799.     assert nan/-oo is nan
800.     assert nan + oo is nan
801.     assert nan + -oo is nan
802.     assert nan - oo is nan
803.     assert nan - -oo is nan
804.     assert -oo * S.Zero is nan
805. 
806.     assert oo*nan is nan
807.     assert -oo*nan is nan
808.     assert oo/nan is nan
809.     assert -oo/nan is nan
810.     assert oo + nan is nan
811.     assert -oo + nan is nan
812.     assert oo - nan is nan
813.     assert -oo - nan is nan
814.     assert S.Zero * oo is nan
815.     assert oo.is_Rational is False
816.     assert isinstance(oo, Rational) is False
817. 
818.     assert S.One/oo == 0
819.     assert -S.One/oo == 0
820.     assert S.One/-oo == 0
821.     assert -S.One/-oo == 0
822.     assert S.One*oo is oo
823.     assert -S.One*oo is -oo
824.     assert S.One*-oo is -oo
825.     assert -S.One*-oo is oo
826.     assert S.One/nan is nan
827.     assert S.One - -oo is oo
828.     assert S.One + nan is nan
829.     assert S.One - nan is nan
830.     assert nan - S.One is nan
831.     assert nan/S.One is nan
832.     assert -oo - S.One is -oo
833. 
834. 
835. def test_Infinity_2():
836.     x = Symbol('x')
837.     assert oo*x != oo
838.     assert oo*(pi - 1) is oo
839.     assert oo*(1 - pi) is -oo
840. 
841.     assert (-oo)*x != -oo
842.     assert (-oo)*(pi - 1) is -oo
843.     assert (-oo)*(1 - pi) is oo
844. 
845.     assert (-1)**S.NaN is S.NaN
846.     assert oo - _inf is S.NaN
847.     assert oo + _ninf is S.NaN
848.     assert oo*0 is S.NaN
849.     assert oo/_inf is S.NaN
850.     assert oo/_ninf is S.NaN
851.     assert oo**S.NaN is S.NaN
852.     assert -oo + _inf is S.NaN
853.     assert -oo - _ninf is S.NaN
854.     assert -oo*S.NaN is S.NaN
855.     assert -oo*0 is S.NaN
856.     assert -oo/_inf is S.NaN
857.     assert -oo/_ninf is S.NaN
858.     assert -oo/S.NaN is S.NaN
859.     assert abs(-oo) is oo
860.     assert all((-oo)**i is S.NaN for i in (oo, -oo, S.NaN))
861.     assert (-oo)**3 is -oo
862.     assert (-oo)**2 is oo
863.     assert abs(S.ComplexInfinity) is oo
864. 
865. 
866. def test_Mul_Infinity_Zero():
867.     assert Float(0)*_inf is nan
868.     assert Float(0)*_ninf is nan
869.     assert Float(0)*_inf is nan
870.     assert Float(0)*_ninf is nan
871.     assert _inf*Float(0) is nan
872.     assert _ninf*Float(0) is nan
873.     assert _inf*Float(0) is nan
874.     assert _ninf*Float(0) is nan
875. 
876. 
877. def test_Div_By_Zero():
878.     assert 1/S.Zero is zoo
879.     assert 1/Float(0) is zoo
880.     assert 0/S.Zero is nan
881.     assert 0/Float(0) is nan
882.     assert S.Zero/0 is nan
883.     assert Float(0)/0 is nan
884.     assert -1/S.Zero is zoo
885.     assert -1/Float(0) is zoo
886. 
887. 
888. @_both_exp_pow
889. def test_Infinity_inequations():
890.     assert oo > pi
891.     assert not (oo < pi)
892.     assert exp(-3) < oo
893. 
894.     assert _inf > pi
895.     assert not (_inf < pi)
896.     assert exp(-3) < _inf
897. 
898.     raises(TypeError, lambda: oo < I)
899.     raises(TypeError, lambda: oo <= I)
900.     raises(TypeError, lambda: oo > I)
901.     raises(TypeError, lambda: oo >= I)
902.     raises(TypeError, lambda: -oo < I)
903.     raises(TypeError, lambda: -oo <= I)
904.     raises(TypeError, lambda: -oo > I)
905.     raises(TypeError, lambda: -oo >= I)
906. 
907.     raises(TypeError, lambda: I < oo)
908.     raises(TypeError, lambda: I <= oo)
909.     raises(TypeError, lambda: I > oo)
910.     raises(TypeError, lambda: I >= oo)
911.     raises(TypeError, lambda: I < -oo)
912.     raises(TypeError, lambda: I <= -oo)
913.     raises(TypeError, lambda: I > -oo)
914.     raises(TypeError, lambda: I >= -oo)
915. 
916.     assert oo > -oo and oo >= -oo
917.     assert (oo < -oo) == False and (oo <= -oo) == False
918.     assert -oo < oo and -oo <= oo
919.     assert (-oo > oo) == False and (-oo >= oo) == False
920. 
921.     assert (oo < oo) == False  # issue 7775
922.     assert (oo > oo) == False
923.     assert (-oo > -oo) == False and (-oo < -oo) == False
924.     assert oo >= oo and oo <= oo and -oo >= -oo and -oo <= -oo
925.     assert (-oo < -_inf) ==  False
926.     assert (oo > _inf) == False
927.     assert -oo >= -_inf
928.     assert oo <= _inf
929. 
930.     x = Symbol('x')
931.     b = Symbol('b', finite=True, real=True)
932.     assert (x < oo) == Lt(x, oo)  # issue 7775
933.     assert b < oo and b > -oo and b <= oo and b >= -oo
934.     assert oo > b and oo >= b and (oo < b) == False and (oo <= b) == False
935.     assert (-oo > b) == False and (-oo >= b) == False and -oo < b and -oo <= b
936.     assert (oo < x) == Lt(oo, x) and (oo > x) == Gt(oo, x)
937.     assert (oo <= x) == Le(oo, x) and (oo >= x) == Ge(oo, x)
938.     assert (-oo < x) == Lt(-oo, x) and (-oo > x) == Gt(-oo, x)
939.     assert (-oo <= x) == Le(-oo, x) and (-oo >= x) == Ge(-oo, x)
940. 
941. 
942. def test_NaN():
943.     assert nan is nan
944.     assert nan != 1
945.     assert 1*nan is nan
946.     assert 1 != nan
947.     assert -nan is nan
948.     assert oo != Symbol("x")**3
949.     assert 2 + nan is nan
950.     assert 3*nan + 2 is nan
951.     assert -nan*3 is nan
952.     assert nan + nan is nan
953.     assert -nan + nan*(-5) is nan
954.     assert 8/nan is nan
955.     raises(TypeError, lambda: nan > 0)
956.     raises(TypeError, lambda: nan < 0)
957.     raises(TypeError, lambda: nan >= 0)
958.     raises(TypeError, lambda: nan <= 0)
959.     raises(TypeError, lambda: 0 < nan)
960.     raises(TypeError, lambda: 0 > nan)
961.     raises(TypeError, lambda: 0 <= nan)
962.     raises(TypeError, lambda: 0 >= nan)
963.     assert nan**0 == 1  # as per IEEE 754
964.     assert 1**nan is nan # IEEE 754 is not the best choice for symbolic work
965.     # test Pow._eval_power's handling of NaN
966.     assert Pow(nan, 0, evaluate=False)**2 == 1
967.     for n in (1, 1., S.One, S.NegativeOne, Float(1)):
968.         assert n + nan is nan
969.         assert n - nan is nan
970.         assert nan + n is nan
971.         assert nan - n is nan
972.         assert n/nan is nan
973.         assert nan/n is nan
974. 
975. 
976. def test_special_numbers():
977.     assert isinstance(S.NaN, Number) is True
978.     assert isinstance(S.Infinity, Number) is True
979.     assert isinstance(S.NegativeInfinity, Number) is True
980. 
981.     assert S.NaN.is_number is True
982.     assert S.Infinity.is_number is True
983.     assert S.NegativeInfinity.is_number is True
984.     assert S.ComplexInfinity.is_number is True
985. 
986.     assert isinstance(S.NaN, Rational) is False
987.     assert isinstance(S.Infinity, Rational) is False
988.     assert isinstance(S.NegativeInfinity, Rational) is False
989. 
990.     assert S.NaN.is_rational is not True
991.     assert S.Infinity.is_rational is not True
992.     assert S.NegativeInfinity.is_rational is not True
993. 
994. 
995. def test_powers():
996.     assert integer_nthroot(1, 2) == (1, True)
997.     assert integer_nthroot(1, 5) == (1, True)
998.     assert integer_nthroot(2, 1) == (2, True)
999.     assert integer_nthroot(2, 2) == (1, False)
1000.     assert integer_nthroot(2, 5) == (1, False)


File: sympy/core/tests/test_numbers.py
Line number range: 1001 - 2000
Content:
1001.     assert integer_nthroot(4, 2) == (2, True)
1002.     assert integer_nthroot(123**25, 25) == (123, True)
1003.     assert integer_nthroot(123**25 + 1, 25) == (123, False)
1004.     assert integer_nthroot(123**25 - 1, 25) == (122, False)
1005.     assert integer_nthroot(1, 1) == (1, True)
1006.     assert integer_nthroot(0, 1) == (0, True)
1007.     assert integer_nthroot(0, 3) == (0, True)
1008.     assert integer_nthroot(10000, 1) == (10000, True)
1009.     assert integer_nthroot(4, 2) == (2, True)
1010.     assert integer_nthroot(16, 2) == (4, True)
1011.     assert integer_nthroot(26, 2) == (5, False)
1012.     assert integer_nthroot(1234567**7, 7) == (1234567, True)
1013.     assert integer_nthroot(1234567**7 + 1, 7) == (1234567, False)
1014.     assert integer_nthroot(1234567**7 - 1, 7) == (1234566, False)
1015.     b = 25**1000
1016.     assert integer_nthroot(b, 1000) == (25, True)
1017.     assert integer_nthroot(b + 1, 1000) == (25, False)
1018.     assert integer_nthroot(b - 1, 1000) == (24, False)
1019.     c = 10**400
1020.     c2 = c**2
1021.     assert integer_nthroot(c2, 2) == (c, True)
1022.     assert integer_nthroot(c2 + 1, 2) == (c, False)
1023.     assert integer_nthroot(c2 - 1, 2) == (c - 1, False)
1024.     assert integer_nthroot(2, 10**10) == (1, False)
1025. 
1026.     p, r = integer_nthroot(int(factorial(10000)), 100)
1027.     assert p % (10**10) == 5322420655
1028.     assert not r
1029. 
1030.     # Test that this is fast
1031.     assert integer_nthroot(2, 10**10) == (1, False)
1032. 
1033.     # output should be int if possible
1034.     assert type(integer_nthroot(2**61, 2)[0]) is int
1035. 
1036. 
1037. def test_integer_nthroot_overflow():
1038.     assert integer_nthroot(10**(50*50), 50) == (10**50, True)
1039.     assert integer_nthroot(10**100000, 10000) == (10**10, True)
1040. 
1041. 
1042. def test_integer_log():
1043.     raises(ValueError, lambda: integer_log(2, 1))
1044.     raises(ValueError, lambda: integer_log(0, 2))
1045.     raises(ValueError, lambda: integer_log(1.1, 2))
1046.     raises(ValueError, lambda: integer_log(1, 2.2))
1047. 
1048.     assert integer_log(1, 2) == (0, True)
1049.     assert integer_log(1, 3) == (0, True)
1050.     assert integer_log(2, 3) == (0, False)
1051.     assert integer_log(3, 3) == (1, True)
1052.     assert integer_log(3*2, 3) == (1, False)
1053.     assert integer_log(3**2, 3) == (2, True)
1054.     assert integer_log(3*4, 3) == (2, False)
1055.     assert integer_log(3**3, 3) == (3, True)
1056.     assert integer_log(27, 5) == (2, False)
1057.     assert integer_log(2, 3) == (0, False)
1058.     assert integer_log(-4, -2) == (2, False)
1059.     assert integer_log(27, -3) == (3, False)
1060.     assert integer_log(-49, 7) == (0, False)
1061.     assert integer_log(-49, -7) == (2, False)
1062. 
1063. 
1064. def test_isqrt():
1065.     from math import sqrt as _sqrt
1066.     limit = 4503599761588223
1067.     assert int(_sqrt(limit)) == integer_nthroot(limit, 2)[0]
1068.     assert int(_sqrt(limit + 1)) != integer_nthroot(limit + 1, 2)[0]
1069.     assert isqrt(limit + 1) == integer_nthroot(limit + 1, 2)[0]
1070.     assert isqrt(limit + S.Half) == integer_nthroot(limit, 2)[0]
1071.     assert isqrt(limit + 1 + S.Half) == integer_nthroot(limit + 1, 2)[0]
1072.     assert isqrt(limit + 2 + S.Half) == integer_nthroot(limit + 2, 2)[0]
1073. 
1074.     # Regression tests for https://github.com/sympy/sympy/issues/17034
1075.     assert isqrt(4503599761588224) == 67108864
1076.     assert isqrt(9999999999999999) == 99999999
1077. 
1078.     # Other corner cases, especially involving non-integers.
1079.     raises(ValueError, lambda: isqrt(-1))
1080.     raises(ValueError, lambda: isqrt(-10**1000))
1081.     raises(ValueError, lambda: isqrt(Rational(-1, 2)))
1082. 
1083.     tiny = Rational(1, 10**1000)
1084.     raises(ValueError, lambda: isqrt(-tiny))
1085.     assert isqrt(1-tiny) == 0
1086.     assert isqrt(4503599761588224-tiny) == 67108864
1087.     assert isqrt(10**100 - tiny) == 10**50 - 1
1088. 
1089.     # Check that using an inaccurate math.sqrt doesn't affect the results.
1090.     from sympy.core import power
1091.     old_sqrt = power._sqrt
1092.     power._sqrt = lambda x: 2.999999999
1093.     try:
1094.         assert isqrt(9) == 3
1095.         assert isqrt(10000) == 100
1096.     finally:
1097.         power._sqrt = old_sqrt
1098. 
1099. 
1100. def test_powers_Integer():
1101.     """Test Integer._eval_power"""
1102.     # check infinity
1103.     assert S.One ** S.Infinity is S.NaN
1104.     assert S.NegativeOne** S.Infinity is S.NaN
1105.     assert S(2) ** S.Infinity is S.Infinity
1106.     assert S(-2)** S.Infinity == zoo
1107.     assert S(0) ** S.Infinity is S.Zero
1108. 
1109.     # check Nan
1110.     assert S.One ** S.NaN is S.NaN
1111.     assert S.NegativeOne ** S.NaN is S.NaN
1112. 
1113.     # check for exact roots
1114.     assert S.NegativeOne ** Rational(6, 5) == - (-1)**(S.One/5)
1115.     assert sqrt(S(4)) == 2
1116.     assert sqrt(S(-4)) == I * 2
1117.     assert S(16) ** Rational(1, 4) == 2
1118.     assert S(-16) ** Rational(1, 4) == 2 * (-1)**Rational(1, 4)
1119.     assert S(9) ** Rational(3, 2) == 27
1120.     assert S(-9) ** Rational(3, 2) == -27*I
1121.     assert S(27) ** Rational(2, 3) == 9
1122.     assert S(-27) ** Rational(2, 3) == 9 * (S.NegativeOne ** Rational(2, 3))
1123.     assert (-2) ** Rational(-2, 1) == Rational(1, 4)
1124. 
1125.     # not exact roots
1126.     assert sqrt(-3) == I*sqrt(3)
1127.     assert (3) ** (Rational(3, 2)) == 3 * sqrt(3)
1128.     assert (-3) ** (Rational(3, 2)) == - 3 * sqrt(-3)
1129.     assert (-3) ** (Rational(5, 2)) == 9 * I * sqrt(3)
1130.     assert (-3) ** (Rational(7, 2)) == - I * 27 * sqrt(3)
1131.     assert (2) ** (Rational(3, 2)) == 2 * sqrt(2)
1132.     assert (2) ** (Rational(-3, 2)) == sqrt(2) / 4
1133.     assert (81) ** (Rational(2, 3)) == 9 * (S(3) ** (Rational(2, 3)))
1134.     assert (-81) ** (Rational(2, 3)) == 9 * (S(-3) ** (Rational(2, 3)))
1135.     assert (-3) ** Rational(-7, 3) == \
1136.         -(-1)**Rational(2, 3)*3**Rational(2, 3)/27
1137.     assert (-3) ** Rational(-2, 3) == \
1138.         -(-1)**Rational(1, 3)*3**Rational(1, 3)/3
1139. 
1140.     # join roots
1141.     assert sqrt(6) + sqrt(24) == 3*sqrt(6)
1142.     assert sqrt(2) * sqrt(3) == sqrt(6)
1143. 
1144.     # separate symbols & constansts
1145.     x = Symbol("x")
1146.     assert sqrt(49 * x) == 7 * sqrt(x)
1147.     assert sqrt((3 - sqrt(pi)) ** 2) == 3 - sqrt(pi)
1148. 
1149.     # check that it is fast for big numbers
1150.     assert (2**64 + 1) ** Rational(4, 3)
1151.     assert (2**64 + 1) ** Rational(17, 25)
1152. 
1153.     # negative rational power and negative base
1154.     assert (-3) ** Rational(-7, 3) == \
1155.         -(-1)**Rational(2, 3)*3**Rational(2, 3)/27
1156.     assert (-3) ** Rational(-2, 3) == \
1157.         -(-1)**Rational(1, 3)*3**Rational(1, 3)/3
1158.     assert (-2) ** Rational(-10, 3) == \
1159.         (-1)**Rational(2, 3)*2**Rational(2, 3)/16
1160.     assert abs(Pow(-2, Rational(-10, 3)).n() -
1161.         Pow(-2, Rational(-10, 3), evaluate=False).n()) < 1e-16
1162. 
1163.     # negative base and rational power with some simplification
1164.     assert (-8) ** Rational(2, 5) == \
1165.         2*(-1)**Rational(2, 5)*2**Rational(1, 5)
1166.     assert (-4) ** Rational(9, 5) == \
1167.         -8*(-1)**Rational(4, 5)*2**Rational(3, 5)
1168. 
1169.     assert S(1234).factors() == {617: 1, 2: 1}
1170.     assert Rational(2*3, 3*5*7).factors() == {2: 1, 5: -1, 7: -1}
1171. 
1172.     # test that eval_power factors numbers bigger than
1173.     # the current limit in factor_trial_division (2**15)
1174.     from sympy.ntheory.generate import nextprime
1175.     n = nextprime(2**15)
1176.     assert sqrt(n**2) == n
1177.     assert sqrt(n**3) == n*sqrt(n)
1178.     assert sqrt(4*n) == 2*sqrt(n)
1179. 
1180.     # check that factors of base with powers sharing gcd with power are removed
1181.     assert (2**4*3)**Rational(1, 6) == 2**Rational(2, 3)*3**Rational(1, 6)
1182.     assert (2**4*3)**Rational(5, 6) == 8*2**Rational(1, 3)*3**Rational(5, 6)
1183. 
1184.     # check that bases sharing a gcd are exptracted
1185.     assert 2**Rational(1, 3)*3**Rational(1, 4)*6**Rational(1, 5) == \
1186.         2**Rational(8, 15)*3**Rational(9, 20)
1187.     assert sqrt(8)*24**Rational(1, 3)*6**Rational(1, 5) == \
1188.         4*2**Rational(7, 10)*3**Rational(8, 15)
1189.     assert sqrt(8)*(-24)**Rational(1, 3)*(-6)**Rational(1, 5) == \
1190.         4*(-3)**Rational(8, 15)*2**Rational(7, 10)
1191.     assert 2**Rational(1, 3)*2**Rational(8, 9) == 2*2**Rational(2, 9)
1192.     assert 2**Rational(2, 3)*6**Rational(1, 3) == 2*3**Rational(1, 3)
1193.     assert 2**Rational(2, 3)*6**Rational(8, 9) == \
1194.         2*2**Rational(5, 9)*3**Rational(8, 9)
1195.     assert (-2)**Rational(2, S(3))*(-4)**Rational(1, S(3)) == -2*2**Rational(1, 3)
1196.     assert 3*Pow(3, 2, evaluate=False) == 3**3
1197.     assert 3*Pow(3, Rational(-1, 3), evaluate=False) == 3**Rational(2, 3)
1198.     assert (-2)**Rational(1, 3)*(-3)**Rational(1, 4)*(-5)**Rational(5, 6) == \
1199.         -(-1)**Rational(5, 12)*2**Rational(1, 3)*3**Rational(1, 4) * \
1200.         5**Rational(5, 6)
1201. 
1202.     assert Integer(-2)**Symbol('', even=True) == \
1203.         Integer(2)**Symbol('', even=True)
1204.     assert (-1)**Float(.5) == 1.0*I
1205. 
1206. 
1207. def test_powers_Rational():
1208.     """Test Rational._eval_power"""
1209.     # check infinity
1210.     assert S.Half ** S.Infinity == 0
1211.     assert Rational(3, 2) ** S.Infinity is S.Infinity
1212.     assert Rational(-1, 2) ** S.Infinity == 0
1213.     assert Rational(-3, 2) ** S.Infinity == zoo
1214. 
1215.     # check Nan
1216.     assert Rational(3, 4) ** S.NaN is S.NaN
1217.     assert Rational(-2, 3) ** S.NaN is S.NaN
1218. 
1219.     # exact roots on numerator
1220.     assert sqrt(Rational(4, 3)) == 2 * sqrt(3) / 3
1221.     assert Rational(4, 3) ** Rational(3, 2) == 8 * sqrt(3) / 9
1222.     assert sqrt(Rational(-4, 3)) == I * 2 * sqrt(3) / 3
1223.     assert Rational(-4, 3) ** Rational(3, 2) == - I * 8 * sqrt(3) / 9
1224.     assert Rational(27, 2) ** Rational(1, 3) == 3 * (2 ** Rational(2, 3)) / 2
1225.     assert Rational(5**3, 8**3) ** Rational(4, 3) == Rational(5**4, 8**4)
1226. 
1227.     # exact root on denominator
1228.     assert sqrt(Rational(1, 4)) == S.Half
1229.     assert sqrt(Rational(1, -4)) == I * S.Half
1230.     assert sqrt(Rational(3, 4)) == sqrt(3) / 2
1231.     assert sqrt(Rational(3, -4)) == I * sqrt(3) / 2
1232.     assert Rational(5, 27) ** Rational(1, 3) == (5 ** Rational(1, 3)) / 3
1233. 
1234.     # not exact roots
1235.     assert sqrt(S.Half) == sqrt(2) / 2
1236.     assert sqrt(Rational(-4, 7)) == I * sqrt(Rational(4, 7))
1237.     assert Rational(-3, 2)**Rational(-7, 3) == \
1238.         -4*(-1)**Rational(2, 3)*2**Rational(1, 3)*3**Rational(2, 3)/27
1239.     assert Rational(-3, 2)**Rational(-2, 3) == \
1240.         -(-1)**Rational(1, 3)*2**Rational(2, 3)*3**Rational(1, 3)/3
1241.     assert Rational(-3, 2)**Rational(-10, 3) == \
1242.         8*(-1)**Rational(2, 3)*2**Rational(1, 3)*3**Rational(2, 3)/81
1243.     assert abs(Pow(Rational(-2, 3), Rational(-7, 4)).n() -
1244.         Pow(Rational(-2, 3), Rational(-7, 4), evaluate=False).n()) < 1e-16
1245. 
1246.     # negative integer power and negative rational base
1247.     assert Rational(-2, 3) ** Rational(-2, 1) == Rational(9, 4)
1248. 
1249.     a = Rational(1, 10)
1250.     assert a**Float(a, 2) == Float(a, 2)**Float(a, 2)
1251.     assert Rational(-2, 3)**Symbol('', even=True) == \
1252.         Rational(2, 3)**Symbol('', even=True)
1253. 
1254. 
1255. def test_powers_Float():
1256.     assert str((S('-1/10')**S('3/10')).n()) == str(Float(-.1)**(.3))
1257. 
1258. 
1259. def test_lshift_Integer():
1260.     assert Integer(0) << Integer(2) == Integer(0)
1261.     assert Integer(0) << 2 == Integer(0)
1262.     assert 0 << Integer(2) == Integer(0)
1263. 
1264.     assert Integer(0b11) << Integer(0) == Integer(0b11)
1265.     assert Integer(0b11) << 0 == Integer(0b11)
1266.     assert 0b11 << Integer(0) == Integer(0b11)
1267. 
1268.     assert Integer(0b11) << Integer(2) == Integer(0b11 << 2)
1269.     assert Integer(0b11) << 2 == Integer(0b11 << 2)
1270.     assert 0b11 << Integer(2) == Integer(0b11 << 2)
1271. 
1272.     assert Integer(-0b11) << Integer(2) == Integer(-0b11 << 2)
1273.     assert Integer(-0b11) << 2 == Integer(-0b11 << 2)
1274.     assert -0b11 << Integer(2) == Integer(-0b11 << 2)
1275. 
1276.     raises(TypeError, lambda: Integer(2) << 0.0)
1277.     raises(TypeError, lambda: 0.0 << Integer(2))
1278.     raises(ValueError, lambda: Integer(1) << Integer(-1))
1279. 
1280. 
1281. def test_rshift_Integer():
1282.     assert Integer(0) >> Integer(2) == Integer(0)
1283.     assert Integer(0) >> 2 == Integer(0)
1284.     assert 0 >> Integer(2) == Integer(0)
1285. 
1286.     assert Integer(0b11) >> Integer(0) == Integer(0b11)
1287.     assert Integer(0b11) >> 0 == Integer(0b11)
1288.     assert 0b11 >> Integer(0) == Integer(0b11)
1289. 
1290.     assert Integer(0b11) >> Integer(2) == Integer(0)
1291.     assert Integer(0b11) >> 2 == Integer(0)
1292.     assert 0b11 >> Integer(2) == Integer(0)
1293. 
1294.     assert Integer(-0b11) >> Integer(2) == Integer(-1)
1295.     assert Integer(-0b11) >> 2 == Integer(-1)
1296.     assert -0b11 >> Integer(2) == Integer(-1)
1297. 
1298.     assert Integer(0b1100) >> Integer(2) == Integer(0b1100 >> 2)
1299.     assert Integer(0b1100) >> 2 == Integer(0b1100 >> 2)
1300.     assert 0b1100 >> Integer(2) == Integer(0b1100 >> 2)
1301. 
1302.     assert Integer(-0b1100) >> Integer(2) == Integer(-0b1100 >> 2)
1303.     assert Integer(-0b1100) >> 2 == Integer(-0b1100 >> 2)
1304.     assert -0b1100 >> Integer(2) == Integer(-0b1100 >> 2)
1305. 
1306.     raises(TypeError, lambda: Integer(0b10) >> 0.0)
1307.     raises(TypeError, lambda: 0.0 >> Integer(2))
1308.     raises(ValueError, lambda: Integer(1) >> Integer(-1))
1309. 
1310. 
1311. def test_and_Integer():
1312.     assert Integer(0b01010101) & Integer(0b10101010) == Integer(0)
1313.     assert Integer(0b01010101) & 0b10101010 == Integer(0)
1314.     assert 0b01010101 & Integer(0b10101010) == Integer(0)
1315. 
1316.     assert Integer(0b01010101) & Integer(0b11011011) == Integer(0b01010001)
1317.     assert Integer(0b01010101) & 0b11011011 == Integer(0b01010001)
1318.     assert 0b01010101 & Integer(0b11011011) == Integer(0b01010001)
1319. 
1320.     assert -Integer(0b01010101) & Integer(0b11011011) == Integer(-0b01010101 & 0b11011011)
1321.     assert Integer(-0b01010101) & 0b11011011 == Integer(-0b01010101 & 0b11011011)
1322.     assert -0b01010101 & Integer(0b11011011) == Integer(-0b01010101 & 0b11011011)
1323. 
1324.     assert Integer(0b01010101) & -Integer(0b11011011) == Integer(0b01010101 & -0b11011011)
1325.     assert Integer(0b01010101) & -0b11011011 == Integer(0b01010101 & -0b11011011)
1326.     assert 0b01010101 & Integer(-0b11011011) == Integer(0b01010101 & -0b11011011)
1327. 
1328.     raises(TypeError, lambda: Integer(2) & 0.0)
1329.     raises(TypeError, lambda: 0.0 & Integer(2))
1330. 
1331. 
1332. def test_xor_Integer():
1333.     assert Integer(0b01010101) ^ Integer(0b11111111) == Integer(0b10101010)
1334.     assert Integer(0b01010101) ^ 0b11111111 == Integer(0b10101010)
1335.     assert 0b01010101 ^ Integer(0b11111111) == Integer(0b10101010)
1336. 
1337.     assert Integer(0b01010101) ^ Integer(0b11011011) == Integer(0b10001110)
1338.     assert Integer(0b01010101) ^ 0b11011011 == Integer(0b10001110)
1339.     assert 0b01010101 ^ Integer(0b11011011) == Integer(0b10001110)
1340. 
1341.     assert -Integer(0b01010101) ^ Integer(0b11011011) == Integer(-0b01010101 ^ 0b11011011)
1342.     assert Integer(-0b01010101) ^ 0b11011011 == Integer(-0b01010101 ^ 0b11011011)
1343.     assert -0b01010101 ^ Integer(0b11011011) == Integer(-0b01010101 ^ 0b11011011)
1344. 
1345.     assert Integer(0b01010101) ^ -Integer(0b11011011) == Integer(0b01010101 ^ -0b11011011)
1346.     assert Integer(0b01010101) ^ -0b11011011 == Integer(0b01010101 ^ -0b11011011)
1347.     assert 0b01010101 ^ Integer(-0b11011011) == Integer(0b01010101 ^ -0b11011011)
1348. 
1349.     raises(TypeError, lambda: Integer(2) ^ 0.0)
1350.     raises(TypeError, lambda: 0.0 ^ Integer(2))
1351. 
1352. 
1353. def test_or_Integer():
1354.     assert Integer(0b01010101) | Integer(0b10101010) == Integer(0b11111111)
1355.     assert Integer(0b01010101) | 0b10101010 == Integer(0b11111111)
1356.     assert 0b01010101 | Integer(0b10101010) == Integer(0b11111111)
1357. 
1358.     assert Integer(0b01010101) | Integer(0b11011011) == Integer(0b11011111)
1359.     assert Integer(0b01010101) | 0b11011011 == Integer(0b11011111)
1360.     assert 0b01010101 | Integer(0b11011011) == Integer(0b11011111)
1361. 
1362.     assert -Integer(0b01010101) | Integer(0b11011011) == Integer(-0b01010101 | 0b11011011)
1363.     assert Integer(-0b01010101) | 0b11011011 == Integer(-0b01010101 | 0b11011011)
1364.     assert -0b01010101 | Integer(0b11011011) == Integer(-0b01010101 | 0b11011011)
1365. 
1366.     assert Integer(0b01010101) | -Integer(0b11011011) == Integer(0b01010101 | -0b11011011)
1367.     assert Integer(0b01010101) | -0b11011011 == Integer(0b01010101 | -0b11011011)
1368.     assert 0b01010101 | Integer(-0b11011011) == Integer(0b01010101 | -0b11011011)
1369. 
1370.     raises(TypeError, lambda: Integer(2) | 0.0)
1371.     raises(TypeError, lambda: 0.0 | Integer(2))
1372. 
1373. 
1374. def test_invert_Integer():
1375.     assert ~Integer(0b01010101) == Integer(-0b01010110)
1376.     assert ~Integer(0b01010101) == Integer(~0b01010101)
1377.     assert ~(~Integer(0b01010101)) == Integer(0b01010101)
1378. 
1379. 
1380. def test_abs1():
1381.     assert Rational(1, 6) != Rational(-1, 6)
1382.     assert abs(Rational(1, 6)) == abs(Rational(-1, 6))
1383. 
1384. 
1385. def test_accept_int():
1386.     assert Float(4) == 4
1387. 
1388. 
1389. def test_dont_accept_str():
1390.     assert Float("0.2") != "0.2"
1391.     assert not (Float("0.2") == "0.2")
1392. 
1393. 
1394. def test_int():
1395.     a = Rational(5)
1396.     assert int(a) == 5
1397.     a = Rational(9, 10)
1398.     assert int(a) == int(-a) == 0
1399.     assert 1/(-1)**Rational(2, 3) == -(-1)**Rational(1, 3)
1400.     # issue 10368
1401.     a = Rational(32442016954, 78058255275)
1402.     assert type(int(a)) is type(int(-a)) is int
1403. 
1404. 
1405. def test_int_NumberSymbols():
1406.     assert int(Catalan) == 0
1407.     assert int(EulerGamma) == 0
1408.     assert int(pi) == 3
1409.     assert int(E) == 2
1410.     assert int(GoldenRatio) == 1
1411.     assert int(TribonacciConstant) == 1
1412.     for i in [Catalan, E, EulerGamma, GoldenRatio, TribonacciConstant, pi]:
1413.         a, b = i.approximation_interval(Integer)
1414.         ia = int(i)
1415.         assert ia == a
1416.         assert isinstance(ia, int)
1417.         assert b == a + 1
1418.         assert a.is_Integer and b.is_Integer
1419. 
1420. 
1421. def test_real_bug():
1422.     x = Symbol("x")
1423.     assert str(2.0*x*x) in ["(2.0*x)*x", "2.0*x**2", "2.00000000000000*x**2"]
1424.     assert str(2.1*x*x) != "(2.0*x)*x"
1425. 
1426. 
1427. def test_bug_sqrt():
1428.     assert ((sqrt(Rational(2)) + 1)*(sqrt(Rational(2)) - 1)).expand() == 1
1429. 
1430. 
1431. def test_pi_Pi():
1432.     "Test that pi (instance) is imported, but Pi (class) is not"
1433.     from sympy import pi  # noqa
1434.     with raises(ImportError):
1435.         from sympy import Pi  # noqa
1436. 
1437. 
1438. def test_no_len():
1439.     # there should be no len for numbers
1440.     raises(TypeError, lambda: len(Rational(2)))
1441.     raises(TypeError, lambda: len(Rational(2, 3)))
1442.     raises(TypeError, lambda: len(Integer(2)))
1443. 
1444. 
1445. def test_issue_3321():
1446.     assert sqrt(Rational(1, 5)) == Rational(1, 5)**S.Half
1447.     assert 5 * sqrt(Rational(1, 5)) == sqrt(5)
1448. 
1449. 
1450. def test_issue_3692():
1451.     assert ((-1)**Rational(1, 6)).expand(complex=True) == I/2 + sqrt(3)/2
1452.     assert ((-5)**Rational(1, 6)).expand(complex=True) == \
1453.         5**Rational(1, 6)*I/2 + 5**Rational(1, 6)*sqrt(3)/2
1454.     assert ((-64)**Rational(1, 6)).expand(complex=True) == I + sqrt(3)
1455. 
1456. 
1457. def test_issue_3423():
1458.     x = Symbol("x")
1459.     assert sqrt(x - 1).as_base_exp() == (x - 1, S.Half)
1460.     assert sqrt(x - 1) != I*sqrt(1 - x)
1461. 
1462. 
1463. def test_issue_3449():
1464.     x = Symbol("x")
1465.     assert sqrt(x - 1).subs(x, 5) == 2
1466. 
1467. 
1468. def test_issue_13890():
1469.     x = Symbol("x")
1470.     e = (-x/4 - S.One/12)**x - 1
1471.     f = simplify(e)
1472.     a = Rational(9, 5)
1473.     assert abs(e.subs(x,a).evalf() - f.subs(x,a).evalf()) < 1e-15
1474. 
1475. 
1476. def test_Integer_factors():
1477.     def F(i):
1478.         return Integer(i).factors()
1479. 
1480.     assert F(1) == {}
1481.     assert F(2) == {2: 1}
1482.     assert F(3) == {3: 1}
1483.     assert F(4) == {2: 2}
1484.     assert F(5) == {5: 1}
1485.     assert F(6) == {2: 1, 3: 1}
1486.     assert F(7) == {7: 1}
1487.     assert F(8) == {2: 3}
1488.     assert F(9) == {3: 2}
1489.     assert F(10) == {2: 1, 5: 1}
1490.     assert F(11) == {11: 1}
1491.     assert F(12) == {2: 2, 3: 1}
1492.     assert F(13) == {13: 1}
1493.     assert F(14) == {2: 1, 7: 1}
1494.     assert F(15) == {3: 1, 5: 1}
1495.     assert F(16) == {2: 4}
1496.     assert F(17) == {17: 1}
1497.     assert F(18) == {2: 1, 3: 2}
1498.     assert F(19) == {19: 1}
1499.     assert F(20) == {2: 2, 5: 1}
1500.     assert F(21) == {3: 1, 7: 1}
1501.     assert F(22) == {2: 1, 11: 1}
1502.     assert F(23) == {23: 1}
1503.     assert F(24) == {2: 3, 3: 1}
1504.     assert F(25) == {5: 2}
1505.     assert F(26) == {2: 1, 13: 1}
1506.     assert F(27) == {3: 3}
1507.     assert F(28) == {2: 2, 7: 1}
1508.     assert F(29) == {29: 1}
1509.     assert F(30) == {2: 1, 3: 1, 5: 1}
1510.     assert F(31) == {31: 1}
1511.     assert F(32) == {2: 5}
1512.     assert F(33) == {3: 1, 11: 1}
1513.     assert F(34) == {2: 1, 17: 1}
1514.     assert F(35) == {5: 1, 7: 1}
1515.     assert F(36) == {2: 2, 3: 2}
1516.     assert F(37) == {37: 1}
1517.     assert F(38) == {2: 1, 19: 1}
1518.     assert F(39) == {3: 1, 13: 1}
1519.     assert F(40) == {2: 3, 5: 1}
1520.     assert F(41) == {41: 1}
1521.     assert F(42) == {2: 1, 3: 1, 7: 1}
1522.     assert F(43) == {43: 1}
1523.     assert F(44) == {2: 2, 11: 1}
1524.     assert F(45) == {3: 2, 5: 1}
1525.     assert F(46) == {2: 1, 23: 1}
1526.     assert F(47) == {47: 1}
1527.     assert F(48) == {2: 4, 3: 1}
1528.     assert F(49) == {7: 2}
1529.     assert F(50) == {2: 1, 5: 2}
1530.     assert F(51) == {3: 1, 17: 1}
1531. 
1532. 
1533. def test_Rational_factors():
1534.     def F(p, q, visual=None):
1535.         return Rational(p, q).factors(visual=visual)
1536. 
1537.     assert F(2, 3) == {2: 1, 3: -1}
1538.     assert F(2, 9) == {2: 1, 3: -2}
1539.     assert F(2, 15) == {2: 1, 3: -1, 5: -1}
1540.     assert F(6, 10) == {3: 1, 5: -1}
1541. 
1542. 
1543. def test_issue_4107():
1544.     assert pi*(E + 10) + pi*(-E - 10) != 0
1545.     assert pi*(E + 10**10) + pi*(-E - 10**10) != 0
1546.     assert pi*(E + 10**20) + pi*(-E - 10**20) != 0
1547.     assert pi*(E + 10**80) + pi*(-E - 10**80) != 0
1548. 
1549.     assert (pi*(E + 10) + pi*(-E - 10)).expand() == 0
1550.     assert (pi*(E + 10**10) + pi*(-E - 10**10)).expand() == 0
1551.     assert (pi*(E + 10**20) + pi*(-E - 10**20)).expand() == 0
1552.     assert (pi*(E + 10**80) + pi*(-E - 10**80)).expand() == 0
1553. 
1554. 
1555. def test_IntegerInteger():
1556.     a = Integer(4)
1557.     b = Integer(a)
1558. 
1559.     assert a == b
1560. 
1561. 
1562. def test_Rational_gcd_lcm_cofactors():
1563.     assert Integer(4).gcd(2) == Integer(2)
1564.     assert Integer(4).lcm(2) == Integer(4)
1565.     assert Integer(4).gcd(Integer(2)) == Integer(2)
1566.     assert Integer(4).lcm(Integer(2)) == Integer(4)
1567.     a, b = 720**99911, 480**12342
1568.     assert Integer(a).lcm(b) == a*b/Integer(a).gcd(b)
1569. 
1570.     assert Integer(4).gcd(3) == Integer(1)
1571.     assert Integer(4).lcm(3) == Integer(12)
1572.     assert Integer(4).gcd(Integer(3)) == Integer(1)
1573.     assert Integer(4).lcm(Integer(3)) == Integer(12)
1574. 
1575.     assert Rational(4, 3).gcd(2) == Rational(2, 3)
1576.     assert Rational(4, 3).lcm(2) == Integer(4)
1577.     assert Rational(4, 3).gcd(Integer(2)) == Rational(2, 3)
1578.     assert Rational(4, 3).lcm(Integer(2)) == Integer(4)
1579. 
1580.     assert Integer(4).gcd(Rational(2, 9)) == Rational(2, 9)
1581.     assert Integer(4).lcm(Rational(2, 9)) == Integer(4)
1582. 
1583.     assert Rational(4, 3).gcd(Rational(2, 9)) == Rational(2, 9)
1584.     assert Rational(4, 3).lcm(Rational(2, 9)) == Rational(4, 3)
1585.     assert Rational(4, 5).gcd(Rational(2, 9)) == Rational(2, 45)
1586.     assert Rational(4, 5).lcm(Rational(2, 9)) == Integer(4)
1587.     assert Rational(5, 9).lcm(Rational(3, 7)) == Rational(Integer(5).lcm(3),Integer(9).gcd(7))
1588. 
1589.     assert Integer(4).cofactors(2) == (Integer(2), Integer(2), Integer(1))
1590.     assert Integer(4).cofactors(Integer(2)) == \
1591.         (Integer(2), Integer(2), Integer(1))
1592. 
1593.     assert Integer(4).gcd(Float(2.0)) == S.One
1594.     assert Integer(4).lcm(Float(2.0)) == Float(8.0)
1595.     assert Integer(4).cofactors(Float(2.0)) == (S.One, Integer(4), Float(2.0))
1596. 
1597.     assert S.Half.gcd(Float(2.0)) == S.One
1598.     assert S.Half.lcm(Float(2.0)) == Float(1.0)
1599.     assert S.Half.cofactors(Float(2.0)) == \
1600.         (S.One, S.Half, Float(2.0))
1601. 
1602. 
1603. def test_Float_gcd_lcm_cofactors():
1604.     assert Float(2.0).gcd(Integer(4)) == S.One
1605.     assert Float(2.0).lcm(Integer(4)) == Float(8.0)
1606.     assert Float(2.0).cofactors(Integer(4)) == (S.One, Float(2.0), Integer(4))
1607. 
1608.     assert Float(2.0).gcd(S.Half) == S.One
1609.     assert Float(2.0).lcm(S.Half) == Float(1.0)
1610.     assert Float(2.0).cofactors(S.Half) == \
1611.         (S.One, Float(2.0), S.Half)
1612. 
1613. 
1614. def test_issue_4611():
1615.     assert abs(pi._evalf(50) - 3.14159265358979) < 1e-10
1616.     assert abs(E._evalf(50) - 2.71828182845905) < 1e-10
1617.     assert abs(Catalan._evalf(50) - 0.915965594177219) < 1e-10
1618.     assert abs(EulerGamma._evalf(50) - 0.577215664901533) < 1e-10
1619.     assert abs(GoldenRatio._evalf(50) - 1.61803398874989) < 1e-10
1620.     assert abs(TribonacciConstant._evalf(50) - 1.83928675521416) < 1e-10
1621. 
1622.     x = Symbol("x")
1623.     assert (pi + x).evalf() == pi.evalf() + x
1624.     assert (E + x).evalf() == E.evalf() + x
1625.     assert (Catalan + x).evalf() == Catalan.evalf() + x
1626.     assert (EulerGamma + x).evalf() == EulerGamma.evalf() + x
1627.     assert (GoldenRatio + x).evalf() == GoldenRatio.evalf() + x
1628.     assert (TribonacciConstant + x).evalf() == TribonacciConstant.evalf() + x
1629. 
1630. 
1631. @conserve_mpmath_dps
1632. def test_conversion_to_mpmath():
1633.     assert mpmath.mpmathify(Integer(1)) == mpmath.mpf(1)
1634.     assert mpmath.mpmathify(S.Half) == mpmath.mpf(0.5)
1635.     assert mpmath.mpmathify(Float('1.23', 15)) == mpmath.mpf('1.23')
1636. 
1637.     assert mpmath.mpmathify(I) == mpmath.mpc(1j)
1638. 
1639.     assert mpmath.mpmathify(1 + 2*I) == mpmath.mpc(1 + 2j)
1640.     assert mpmath.mpmathify(1.0 + 2*I) == mpmath.mpc(1 + 2j)
1641.     assert mpmath.mpmathify(1 + 2.0*I) == mpmath.mpc(1 + 2j)
1642.     assert mpmath.mpmathify(1.0 + 2.0*I) == mpmath.mpc(1 + 2j)
1643.     assert mpmath.mpmathify(S.Half + S.Half*I) == mpmath.mpc(0.5 + 0.5j)
1644. 
1645.     assert mpmath.mpmathify(2*I) == mpmath.mpc(2j)
1646.     assert mpmath.mpmathify(2.0*I) == mpmath.mpc(2j)
1647.     assert mpmath.mpmathify(S.Half*I) == mpmath.mpc(0.5j)
1648. 
1649.     mpmath.mp.dps = 100
1650.     assert mpmath.mpmathify(pi.evalf(100) + pi.evalf(100)*I) == mpmath.pi + mpmath.pi*mpmath.j
1651.     assert mpmath.mpmathify(pi.evalf(100)*I) == mpmath.pi*mpmath.j
1652. 
1653. 
1654. def test_relational():
1655.     # real
1656.     x = S(.1)
1657.     assert (x != cos) is True
1658.     assert (x == cos) is False
1659. 
1660.     # rational
1661.     x = Rational(1, 3)
1662.     assert (x != cos) is True
1663.     assert (x == cos) is False
1664. 
1665.     # integer defers to rational so these tests are omitted
1666. 
1667.     # number symbol
1668.     x = pi
1669.     assert (x != cos) is True
1670.     assert (x == cos) is False
1671. 
1672. 
1673. def test_Integer_as_index():
1674.     assert 'hello'[Integer(2):] == 'llo'
1675. 
1676. 
1677. def test_Rational_int():
1678.     assert int( Rational(7, 5)) == 1
1679.     assert int( S.Half) == 0
1680.     assert int(Rational(-1, 2)) == 0
1681.     assert int(-Rational(7, 5)) == -1
1682. 
1683. 
1684. def test_zoo():
1685.     b = Symbol('b', finite=True)
1686.     nz = Symbol('nz', nonzero=True)
1687.     p = Symbol('p', positive=True)
1688.     n = Symbol('n', negative=True)
1689.     im = Symbol('i', imaginary=True)
1690.     c = Symbol('c', complex=True)
1691.     pb = Symbol('pb', positive=True)
1692.     nb = Symbol('nb', negative=True)
1693.     imb = Symbol('ib', imaginary=True, finite=True)
1694.     for i in [I, S.Infinity, S.NegativeInfinity, S.Zero, S.One, S.Pi, S.Half, S(3), log(3),
1695.               b, nz, p, n, im, pb, nb, imb, c]:
1696.         if i.is_finite and (i.is_real or i.is_imaginary):
1697.             assert i + zoo is zoo
1698.             assert i - zoo is zoo
1699.             assert zoo + i is zoo
1700.             assert zoo - i is zoo
1701.         elif i.is_finite is not False:
1702.             assert (i + zoo).is_Add
1703.             assert (i - zoo).is_Add
1704.             assert (zoo + i).is_Add
1705.             assert (zoo - i).is_Add
1706.         else:
1707.             assert (i + zoo) is S.NaN
1708.             assert (i - zoo) is S.NaN
1709.             assert (zoo + i) is S.NaN
1710.             assert (zoo - i) is S.NaN
1711. 
1712.         if fuzzy_not(i.is_zero) and (i.is_extended_real or i.is_imaginary):
1713.             assert i*zoo is zoo
1714.             assert zoo*i is zoo
1715.         elif i.is_zero:
1716.             assert i*zoo is S.NaN
1717.             assert zoo*i is S.NaN
1718.         else:
1719.             assert (i*zoo).is_Mul
1720.             assert (zoo*i).is_Mul
1721. 
1722.         if fuzzy_not((1/i).is_zero) and (i.is_real or i.is_imaginary):
1723.             assert zoo/i is zoo
1724.         elif (1/i).is_zero:
1725.             assert zoo/i is S.NaN
1726.         elif i.is_zero:
1727.             assert zoo/i is zoo
1728.         else:
1729.             assert (zoo/i).is_Mul
1730. 
1731.     assert (I*oo).is_Mul  # allow directed infinity
1732.     assert zoo + zoo is S.NaN
1733.     assert zoo * zoo is zoo
1734.     assert zoo - zoo is S.NaN
1735.     assert zoo/zoo is S.NaN
1736.     assert zoo**zoo is S.NaN
1737.     assert zoo**0 is S.One
1738.     assert zoo**2 is zoo
1739.     assert 1/zoo is S.Zero
1740. 
1741.     assert Mul.flatten([S.NegativeOne, oo, S(0)]) == ([S.NaN], [], None)
1742. 
1743. 
1744. def test_issue_4122():
1745.     x = Symbol('x', nonpositive=True)
1746.     assert oo + x is oo
1747.     x = Symbol('x', extended_nonpositive=True)
1748.     assert (oo + x).is_Add
1749.     x = Symbol('x', finite=True)
1750.     assert (oo + x).is_Add  # x could be imaginary
1751.     x = Symbol('x', nonnegative=True)
1752.     assert oo + x is oo
1753.     x = Symbol('x', extended_nonnegative=True)
1754.     assert oo + x is oo
1755.     x = Symbol('x', finite=True, real=True)
1756.     assert oo + x is oo
1757. 
1758.     # similarly for negative infinity
1759.     x = Symbol('x', nonnegative=True)
1760.     assert -oo + x is -oo
1761.     x = Symbol('x', extended_nonnegative=True)
1762.     assert (-oo + x).is_Add
1763.     x = Symbol('x', finite=True)
1764.     assert (-oo + x).is_Add
1765.     x = Symbol('x', nonpositive=True)
1766.     assert -oo + x is -oo
1767.     x = Symbol('x', extended_nonpositive=True)
1768.     assert -oo + x is -oo
1769.     x = Symbol('x', finite=True, real=True)
1770.     assert -oo + x is -oo
1771. 
1772. 
1773. def test_GoldenRatio_expand():
1774.     assert GoldenRatio.expand(func=True) == S.Half + sqrt(5)/2
1775. 
1776. 
1777. def test_TribonacciConstant_expand():
1778.         assert TribonacciConstant.expand(func=True) == \
1779.           (1 + cbrt(19 - 3*sqrt(33)) + cbrt(19 + 3*sqrt(33))) / 3
1780. 
1781. 
1782. def test_as_content_primitive():
1783.     assert S.Zero.as_content_primitive() == (1, 0)
1784.     assert S.Half.as_content_primitive() == (S.Half, 1)
1785.     assert (Rational(-1, 2)).as_content_primitive() == (S.Half, -1)
1786.     assert S(3).as_content_primitive() == (3, 1)
1787.     assert S(3.1).as_content_primitive() == (1, 3.1)
1788. 
1789. 
1790. def test_hashing_sympy_integers():
1791.     # Test for issue 5072
1792.     assert {Integer(3)} == {int(3)}
1793.     assert hash(Integer(4)) == hash(int(4))
1794. 
1795. 
1796. def test_rounding_issue_4172():
1797.     assert int((E**100).round()) == \
1798.         26881171418161354484126255515800135873611119
1799.     assert int((pi**100).round()) == \
1800.         51878483143196131920862615246303013562686760680406
1801.     assert int((Rational(1)/EulerGamma**100).round()) == \
1802.         734833795660954410469466
1803. 
1804. 
1805. @XFAIL
1806. def test_mpmath_issues():
1807.     from mpmath.libmp.libmpf import _normalize
1808.     import mpmath.libmp as mlib
1809.     rnd = mlib.round_nearest
1810.     mpf = (0, int(0), -123, -1, 53, rnd)  # nan
1811.     assert _normalize(mpf, 53) != (0, int(0), 0, 0)
1812.     mpf = (0, int(0), -456, -2, 53, rnd)  # +inf
1813.     assert _normalize(mpf, 53) != (0, int(0), 0, 0)
1814.     mpf = (1, int(0), -789, -3, 53, rnd)  # -inf
1815.     assert _normalize(mpf, 53) != (0, int(0), 0, 0)
1816. 
1817.     from mpmath.libmp.libmpf import fnan
1818.     assert mlib.mpf_eq(fnan, fnan)
1819. 
1820. 
1821. def test_Catalan_EulerGamma_prec():
1822.     n = GoldenRatio
1823.     f = Float(n.n(), 5)
1824.     assert f._mpf_ == (0, int(212079), -17, 18)
1825.     assert f._prec == 20
1826.     assert n._as_mpf_val(20) == f._mpf_
1827. 
1828.     n = EulerGamma
1829.     f = Float(n.n(), 5)
1830.     assert f._mpf_ == (0, int(302627), -19, 19)
1831.     assert f._prec == 20
1832.     assert n._as_mpf_val(20) == f._mpf_
1833. 
1834. 
1835. def test_Catalan_rewrite():
1836.     k = Dummy('k', integer=True, nonnegative=True)
1837.     assert Catalan.rewrite(Sum).dummy_eq(
1838.             Sum((-1)**k/(2*k + 1)**2, (k, 0, oo)))
1839.     assert Catalan.rewrite() == Catalan
1840. 
1841. 
1842. def test_bool_eq():
1843.     assert 0 == False
1844.     assert S(0) == False
1845.     assert S(0) != S.false
1846.     assert 1 == True
1847.     assert S.One == True
1848.     assert S.One != S.true
1849. 
1850. 
1851. def test_Float_eq():
1852.     # all .5 values are the same
1853.     assert Float(.5, 10) == Float(.5, 11) == Float(.5, 1)
1854.     # but floats that aren't exact in base-2 still
1855.     # don't compare the same because they have different
1856.     # underlying mpf values
1857.     assert Float(.12, 3) != Float(.12, 4)
1858.     assert Float(.12, 3) != .12
1859.     assert 0.12 != Float(.12, 3)
1860.     assert Float('.12', 22) != .12
1861.     # issue 11707
1862.     # but Float/Rational -- except for 0 --
1863.     # are exact so Rational(x) = Float(y) only if
1864.     # Rational(x) == Rational(Float(y))
1865.     assert Float('1.1') != Rational(11, 10)
1866.     assert Rational(11, 10) != Float('1.1')
1867.     # coverage
1868.     assert not Float(3) == 2
1869.     assert not Float(2**2) == S.Half
1870.     assert Float(2**2) == 4
1871.     assert not Float(2**-2) == 1
1872.     assert Float(2**-1) == S.Half
1873.     assert not Float(2*3) == 3
1874.     assert not Float(2*3) == S.Half
1875.     assert Float(2*3) == 6
1876.     assert not Float(2*3) == 8
1877.     assert Float(.75) == Rational(3, 4)
1878.     assert Float(5/18) == 5/18
1879.     # 4473
1880.     assert Float(2.) != 3
1881.     assert Float((0,1,-3)) == S.One/8
1882.     assert Float((0,1,-3)) != S.One/9
1883.     # 16196
1884.     assert 2 == Float(2)  # as per Python
1885.     # but in a computation...
1886.     assert t**2 != t**2.0
1887. 
1888. 
1889. def test_issue_6640():
1890.     from mpmath.libmp.libmpf import finf, fninf
1891.     # fnan is not included because Float no longer returns fnan,
1892.     # but otherwise, the same sort of test could apply
1893.     assert Float(finf).is_zero is False
1894.     assert Float(fninf).is_zero is False
1895.     assert bool(Float(0)) is False
1896. 
1897. 
1898. def test_issue_6349():
1899.     assert Float('23.e3', '')._prec == 10
1900.     assert Float('23e3', '')._prec == 20
1901.     assert Float('23000', '')._prec == 20
1902.     assert Float('-23000', '')._prec == 20
1903. 
1904. 
1905. def test_mpf_norm():
1906.     assert mpf_norm((1, 0, 1, 0), 10) == mpf('0')._mpf_
1907.     assert Float._new((1, 0, 1, 0), 10)._mpf_ == mpf('0')._mpf_
1908. 
1909. 
1910. def test_latex():
1911.     assert latex(pi) == r"\pi"
1912.     assert latex(E) == r"e"
1913.     assert latex(GoldenRatio) == r"\phi"
1914.     assert latex(TribonacciConstant) == r"\text{TribonacciConstant}"
1915.     assert latex(EulerGamma) == r"\gamma"
1916.     assert latex(oo) == r"\infty"
1917.     assert latex(-oo) == r"-\infty"
1918.     assert latex(zoo) == r"\tilde{\infty}"
1919.     assert latex(nan) == r"\text{NaN}"
1920.     assert latex(I) == r"i"
1921. 
1922. 
1923. def test_issue_7742():
1924.     assert -oo % 1 is nan
1925. 
1926. 
1927. def test_simplify_AlgebraicNumber():
1928.     A = AlgebraicNumber
1929.     e = 3**(S.One/6)*(3 + (135 + 78*sqrt(3))**Rational(2, 3))/(45 + 26*sqrt(3))**(S.One/3)
1930.     assert simplify(A(e)) == A(12)  # wester test_C20
1931. 
1932.     e = (41 + 29*sqrt(2))**(S.One/5)
1933.     assert simplify(A(e)) == A(1 + sqrt(2))  # wester test_C21
1934. 
1935.     e = (3 + 4*I)**Rational(3, 2)
1936.     assert simplify(A(e)) == A(2 + 11*I)  # issue 4401
1937. 
1938. 
1939. def test_Float_idempotence():
1940.     x = Float('1.23', '')
1941.     y = Float(x)
1942.     z = Float(x, 15)
1943.     assert same_and_same_prec(y, x)
1944.     assert not same_and_same_prec(z, x)
1945.     x = Float(10**20)
1946.     y = Float(x)
1947.     z = Float(x, 15)
1948.     assert same_and_same_prec(y, x)
1949.     assert not same_and_same_prec(z, x)
1950. 
1951. 
1952. def test_comp1():
1953.     # sqrt(2) = 1.414213 5623730950...
1954.     a = sqrt(2).n(7)
1955.     assert comp(a, 1.4142129) is False
1956.     assert comp(a, 1.4142130)
1957.     #                  ...
1958.     assert comp(a, 1.4142141)
1959.     assert comp(a, 1.4142142) is False
1960.     assert comp(sqrt(2).n(2), '1.4')
1961.     assert comp(sqrt(2).n(2), Float(1.4, 2), '')
1962.     assert comp(sqrt(2).n(2), 1.4, '')
1963.     assert comp(sqrt(2).n(2), Float(1.4, 3), '') is False
1964.     assert comp(sqrt(2) + sqrt(3)*I, 1.4 + 1.7*I, .1)
1965.     assert not comp(sqrt(2) + sqrt(3)*I, (1.5 + 1.7*I)*0.89, .1)
1966.     assert comp(sqrt(2) + sqrt(3)*I, (1.5 + 1.7*I)*0.90, .1)
1967.     assert comp(sqrt(2) + sqrt(3)*I, (1.5 + 1.7*I)*1.07, .1)
1968.     assert not comp(sqrt(2) + sqrt(3)*I, (1.5 + 1.7*I)*1.08, .1)
1969.     assert [(i, j)
1970.             for i in range(130, 150)
1971.             for j in range(170, 180)
1972.             if comp((sqrt(2)+ I*sqrt(3)).n(3), i/100. + I*j/100.)] == [
1973.         (141, 173), (142, 173)]
1974.     raises(ValueError, lambda: comp(t, '1'))
1975.     raises(ValueError, lambda: comp(t, 1))
1976.     assert comp(0, 0.0)
1977.     assert comp(.5, S.Half)
1978.     assert comp(2 + sqrt(2), 2.0 + sqrt(2))
1979.     assert not comp(0, 1)
1980.     assert not comp(2, sqrt(2))
1981.     assert not comp(2 + I, 2.0 + sqrt(2))
1982.     assert not comp(2.0 + sqrt(2), 2 + I)
1983.     assert not comp(2.0 + sqrt(2), sqrt(3))
1984.     assert comp(1/pi.n(4), 0.3183, 1e-5)
1985.     assert not comp(1/pi.n(4), 0.3183, 8e-6)
1986. 
1987. 
1988. def test_issue_9491():
1989.     assert oo**zoo is nan
1990. 
1991. 
1992. def test_issue_10063():
1993.     assert 2**Float(3) == Float(8)
1994. 
1995. 
1996. def test_issue_10020():
1997.     assert oo**I is S.NaN
1998.     assert oo**(1 + I) is S.ComplexInfinity
1999.     assert oo**(-1 + I) is S.Zero
2000.     assert (-oo)**I is S.NaN


File: sympy/core/tests/test_numbers.py
Line number range: 2001 - 3000
Content:
2001.     assert (-oo)**(-1 + I) is S.Zero
2002.     assert oo**t == Pow(oo, t, evaluate=False)
2003.     assert (-oo)**t == Pow(-oo, t, evaluate=False)
2004. 
2005. 
2006. def test_invert_numbers():
2007.     assert S(2).invert(5) == 3
2008.     assert S(2).invert(Rational(5, 2)) == S.Half
2009.     assert S(2).invert(5.) == 0.5
2010.     assert S(2).invert(S(5)) == 3
2011.     assert S(2.).invert(5) == 0.5
2012.     assert S(sqrt(2)).invert(5) == 1/sqrt(2)
2013.     assert S(sqrt(2)).invert(sqrt(3)) == 1/sqrt(2)
2014. 
2015. 
2016. def test_mod_inverse():
2017.     assert mod_inverse(3, 11) == 4
2018.     assert mod_inverse(5, 11) == 9
2019.     assert mod_inverse(21124921, 521512) == 7713
2020.     assert mod_inverse(124215421, 5125) == 2981
2021.     assert mod_inverse(214, 12515) == 1579
2022.     assert mod_inverse(5823991, 3299) == 1442
2023.     assert mod_inverse(123, 44) == 39
2024.     assert mod_inverse(2, 5) == 3
2025.     assert mod_inverse(-2, 5) == 2
2026.     assert mod_inverse(2, -5) == -2
2027.     assert mod_inverse(-2, -5) == -3
2028.     assert mod_inverse(-3, -7) == -5
2029.     x = Symbol('x')
2030.     assert S(2).invert(x) == S.Half
2031.     raises(TypeError, lambda: mod_inverse(2, x))
2032.     raises(ValueError, lambda: mod_inverse(2, S.Half))
2033.     raises(ValueError, lambda: mod_inverse(2, cos(1)**2 + sin(1)**2))
2034. 
2035. 
2036. def test_golden_ratio_rewrite_as_sqrt():
2037.     assert GoldenRatio.rewrite(sqrt) == S.Half + sqrt(5)*S.Half
2038. 
2039. 
2040. def test_tribonacci_constant_rewrite_as_sqrt():
2041.     assert TribonacciConstant.rewrite(sqrt) == \
2042.       (1 + cbrt(19 - 3*sqrt(33)) + cbrt(19 + 3*sqrt(33))) / 3
2043. 
2044. 
2045. def test_comparisons_with_unknown_type():
2046.     class Foo:
2047.         """
2048.         Class that is unaware of Basic, and relies on both classes returning
2049.         the NotImplemented singleton for equivalence to evaluate to False.
2050. 
2051.         """
2052. 
2053.     ni, nf, nr = Integer(3), Float(1.0), Rational(1, 3)
2054.     foo = Foo()
2055. 
2056.     for n in ni, nf, nr, oo, -oo, zoo, nan:
2057.         assert n != foo
2058.         assert foo != n
2059.         assert not n == foo
2060.         assert not foo == n
2061.         raises(TypeError, lambda: n < foo)
2062.         raises(TypeError, lambda: foo > n)
2063.         raises(TypeError, lambda: n > foo)
2064.         raises(TypeError, lambda: foo < n)
2065.         raises(TypeError, lambda: n <= foo)
2066.         raises(TypeError, lambda: foo >= n)
2067.         raises(TypeError, lambda: n >= foo)
2068.         raises(TypeError, lambda: foo <= n)
2069. 
2070.     class Bar:
2071.         """
2072.         Class that considers itself equal to any instance of Number except
2073.         infinities and nans, and relies on SymPy types returning the
2074.         NotImplemented singleton for symmetric equality relations.
2075. 
2076.         """
2077.         def __eq__(self, other):
2078.             if other in (oo, -oo, zoo, nan):
2079.                 return False
2080.             if isinstance(other, Number):
2081.                 return True
2082.             return NotImplemented
2083. 
2084.         def __ne__(self, other):
2085.             return not self == other
2086. 
2087.     bar = Bar()
2088. 
2089.     for n in ni, nf, nr:
2090.         assert n == bar
2091.         assert bar == n
2092.         assert not n != bar
2093.         assert not bar != n
2094. 
2095.     for n in oo, -oo, zoo, nan:
2096.         assert n != bar
2097.         assert bar != n
2098.         assert not n == bar
2099.         assert not bar == n
2100. 
2101.     for n in ni, nf, nr, oo, -oo, zoo, nan:
2102.         raises(TypeError, lambda: n < bar)
2103.         raises(TypeError, lambda: bar > n)
2104.         raises(TypeError, lambda: n > bar)
2105.         raises(TypeError, lambda: bar < n)
2106.         raises(TypeError, lambda: n <= bar)
2107.         raises(TypeError, lambda: bar >= n)
2108.         raises(TypeError, lambda: n >= bar)
2109.         raises(TypeError, lambda: bar <= n)
2110. 
2111. 
2112. def test_NumberSymbol_comparison():
2113.     from sympy.core.tests.test_relational import rel_check
2114.     rpi = Rational('905502432259640373/288230376151711744')
2115.     fpi = Float(float(pi))
2116.     assert rel_check(rpi, fpi)
2117. 
2118. 
2119. def test_Integer_precision():
2120.     # Make sure Integer inputs for keyword args work
2121.     assert Float('1.0', dps=Integer(15))._prec == 53
2122.     assert Float('1.0', precision=Integer(15))._prec == 15
2123.     assert type(Float('1.0', precision=Integer(15))._prec) == int
2124.     assert sympify(srepr(Float('1.0', precision=15))) == Float('1.0', precision=15)
2125. 
2126. 
2127. def test_numpy_to_float():
2128.     from sympy.testing.pytest import skip
2129.     from sympy.external import import_module
2130.     np = import_module('numpy')
2131.     if not np:
2132.         skip('numpy not installed. Abort numpy tests.')
2133. 
2134.     def check_prec_and_relerr(npval, ratval):
2135.         prec = np.finfo(npval).nmant + 1
2136.         x = Float(npval)
2137.         assert x._prec == prec
2138.         y = Float(ratval, precision=prec)
2139.         assert abs((x - y)/y) < 2**(-(prec + 1))
2140. 
2141.     check_prec_and_relerr(np.float16(2.0/3), Rational(2, 3))
2142.     check_prec_and_relerr(np.float32(2.0/3), Rational(2, 3))
2143.     check_prec_and_relerr(np.float64(2.0/3), Rational(2, 3))
2144.     # extended precision, on some arch/compilers:
2145.     x = np.longdouble(2)/3
2146.     check_prec_and_relerr(x, Rational(2, 3))
2147.     y = Float(x, precision=10)
2148.     assert same_and_same_prec(y, Float(Rational(2, 3), precision=10))
2149. 
2150.     raises(TypeError, lambda: Float(np.complex64(1+2j)))
2151.     raises(TypeError, lambda: Float(np.complex128(1+2j)))
2152. 
2153. 
2154. def test_Integer_ceiling_floor():
2155.     a = Integer(4)
2156. 
2157.     assert a.floor() == a
2158.     assert a.ceiling() == a
2159. 
2160. 
2161. def test_ComplexInfinity():
2162.     assert zoo.floor() is zoo
2163.     assert zoo.ceiling() is zoo
2164.     assert zoo**zoo is S.NaN
2165. 
2166. 
2167. def test_Infinity_floor_ceiling_power():
2168.     assert oo.floor() is oo
2169.     assert oo.ceiling() is oo
2170.     assert oo**S.NaN is S.NaN
2171.     assert oo**zoo is S.NaN
2172. 
2173. 
2174. def test_One_power():
2175.     assert S.One**12 is S.One
2176.     assert S.NegativeOne**S.NaN is S.NaN
2177. 
2178. 
2179. def test_NegativeInfinity():
2180.     assert (-oo).floor() is -oo
2181.     assert (-oo).ceiling() is -oo
2182.     assert (-oo)**11 is -oo
2183.     assert (-oo)**12 is oo
2184. 
2185. 
2186. def test_issue_6133():
2187.     raises(TypeError, lambda: (-oo < None))
2188.     raises(TypeError, lambda: (S(-2) < None))
2189.     raises(TypeError, lambda: (oo < None))
2190.     raises(TypeError, lambda: (oo > None))
2191.     raises(TypeError, lambda: (S(2) < None))
2192. 
2193. 
2194. def test_abc():
2195.     x = numbers.Float(5)
2196.     assert(isinstance(x, nums.Number))
2197.     assert(isinstance(x, numbers.Number))
2198.     assert(isinstance(x, nums.Real))
2199.     y = numbers.Rational(1, 3)
2200.     assert(isinstance(y, nums.Number))
2201.     assert(y.numerator == 1)
2202.     assert(y.denominator == 3)
2203.     assert(isinstance(y, nums.Rational))
2204.     z = numbers.Integer(3)
2205.     assert(isinstance(z, nums.Number))
2206.     assert(isinstance(z, numbers.Number))
2207.     assert(isinstance(z, nums.Rational))
2208.     assert(isinstance(z, numbers.Rational))
2209.     assert(isinstance(z, nums.Integral))
2210. 
2211. 
2212. def test_floordiv():
2213.     assert S(2)//S.Half == 4
2214. 
2215. 
2216. def test_negation():
2217.     assert -S.Zero is S.Zero
2218.     assert -Float(0) is not S.Zero and -Float(0) == 0
2219. 
2220. 
2221. def test_exponentiation_of_0():
2222.     x = Symbol('x')
2223.     assert 0**-x == zoo**x
2224.     assert unchanged(Pow, 0, x)
2225.     x = Symbol('x', zero=True)
2226.     assert 0**-x == S.One
2227.     assert 0**x == S.One

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-21 13:50:41,406 - thread-136261515871936.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='1. Query requirement analysis:\n   - The user explicitly requested the full content of the file `sympy/core/tests/test_numbers.py`.\n\n2. Extended relevance:\n   - The purpose provided is to analyze tests for the `Rational` class. Providing the full test file ensures that all relevant tests, helper functions, and imports are available for a comprehensive analysis.', relative_path='sympy/core/tests/test_numbers.py', start_line=1, end_line=2227)]
2025-12-21 13:50:41,410 - thread-136261515871936.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of the file `sympy/core/tests/test_numbers.py`.
2025-12-21 13:50:41,410 - thread-136261515871936.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-21 13:50:41,410 - thread-136261515871936.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-21 13:50:41,410 - thread-136261515871936.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 0 existing contexts
2025-12-21 13:50:41,410 - thread-136261515871936.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 1 total contexts (removed 0 duplicates)
2025-12-21 13:50:41,411 - thread-136261515871936.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sympy
├── .ci
|   ├── README.rst
|   ├── generate_durations_log.sh
|   └── parse_durations_log.py
├── .circleci
|   └── config.yml
├── .github
|   └── workflows
|       ├── checkconflict.yml
|       ├── ci-sage.yml
|       ├── comment-on-pr.yml
|       ├── docs-preview.yml
|       ├── release.yml
|       └── runtests.yml
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── PULL_REQUEST_TEMPLATE.md
├── README.md
├── bin
|   ├── ask_update.py
|   ├── coverage_doctest.py
|   ├── coverage_report.py
|   ├── generate_module_list.py
|   ├── generate_test_list.py
|   ├── get_sympy.py
|   ├── mailmap_check.py
|   ├── sympy_time.py
|   ├── sympy_time_cache.py
|   ├── test_executable.py
|   ├── test_external_imports.py
|   ├── test_import.py
|   ├── test_optional_dependencies.py
|   ├── test_py2_import.py
|   ├── test_setup.py
|   ├── test_sphinx.sh
|   ├── test_submodule_imports.py
|   ├── test_symengine.py
|   └── test_tensorflow.py
├── codecov.yml
├── conftest.py
├── data
|   └── TeXmacs
|       ├── bin
|       └── progs
├── doc
|   ├── README.rst
|   ├── api
|   |   ├── conf.py
|   |   └── index.rst
|   ├── aptinstall.sh
|   ├── cheatsheet
|   ├── ext
|   |   ├── convert-svg-to-pdf.py
|   |   ├── docscrape.py
|   |   ├── docscrape_sphinx.py
|   |   └── numpydoc.py
|   ├── generate_logos.py
|   ├── man
|   |   └── isympy.xml
|   ├── requirements.txt
|   └── src
|       ├── _pygments
|       |   └── styles.py
|       ├── _static
|       |   └── custom.css
|       ├── _templates
|       |   └── sidebar
|       |       └── versions.html
|       ├── citing.md
|       ├── conf.py
|       ├── contributing
|       |   ├── build-docs.rst
|       |   ├── debug.rst
|       |   ├── dependencies.md
|       |   ├── deprecations.md
|       |   ├── dev-setup.rst
|       |   ├── docstring.rst
|       |   ├── documentation-style-guide.rst
|       |   ├── index.rst
|       |   └── make-a-contribution.rst
|       ├── explanation
|       |   ├── active-deprecations.md
|       |   ├── glossary.md
|       |   ├── gotchas.rst
|       |   ├── index.rst
|       |   ├── solve_output.rst
|       |   └── special_topics
|       |       ├── classification.rst
|       |       ├── finite_diff_derivatives.rst
|       |       └── index.rst
|       ├── guides
|       |   ├── assumptions.rst
|       |   ├── booleans.rst
|       |   ├── custom-functions.md
|       |   ├── index.rst
|       |   └── solving
|       |       ├── find-roots-polynomial.md
|       |       ├── index.md
|       |       ├── reduce-inequalities-algebraically.md
|       |       ├── solve-diophantine-equation.md
|       |       ├── solve-equation-algebraically.md
|       |       ├── solve-matrix-equation.md
|       |       ├── solve-numerically.md
|       |       ├── solve-ode.md
|       |       ├── solve-system-of-equations-algebraically.md
|       |       └── solving-guidance.md
|       ├── index.rst
|       ├── install.md
|       ├── logo
|       |   └── info.txt
|       ├── modules
|       |   ├── abc.rst
|       |   ├── algebras.rst
|       |   ├── assumptions
|       |   |   ├── ask.rst
|       |   |   ├── assume.rst
|       |   |   ├── index.rst
|       |   |   ├── predicates.rst
|       |   |   └── refine.rst
|       |   ├── calculus
|       |   |   └── index.rst
|       |   ├── categories.rst
|       |   ├── codegen.rst
|       |   ├── combinatorics
|       |   |   ├── fp_groups.rst
|       |   |   ├── graycode.rst
|       |   |   ├── group_constructs.rst
|       |   |   ├── group_numbers.rst
|       |   |   ├── index.rst
|       |   |   ├── named_groups.rst
|       |   |   ├── partitions.rst
|       |   |   ├── pc_groups.rst
|       |   |   ├── perm_groups.rst
|       |   |   ├── permutations.rst
|       |   |   ├── polyhedron.rst
|       |   |   ├── prufer.rst
|       |   |   ├── subsets.rst
|       |   |   ├── tensor_can.rst
|       |   |   ├── testutil.rst
|       |   |   └── util.rst
|       |   ├── concrete.rst
|       |   ├── core.rst
|       |   ├── crypto.rst
|       |   ├── diffgeom.rst
|       |   ├── discrete.rst
|       |   ├── evalf.rst
|       |   ├── functions
|       |   |   ├── combinatorial.rst
|       |   |   ├── elementary.rst
|       |   |   ├── index.rst
|       |   |   └── special.rst
|       |   ├── geometry
|       |   |   ├── curves.rst
|       |   |   ├── ellipses.rst
|       |   |   ├── entities.rst
|       |   |   ├── index.rst
|       |   |   ├── lines.rst
|       |   |   ├── plane.rst
|       |   |   ├── points.rst
|       |   |   ├── polygons.rst
|       |   |   └── utils.rst
|       |   ├── holonomic
|       |   |   ├── about.rst
|       |   |   ├── convert.rst
|       |   |   ├── index.rst
|       |   |   ├── internal.rst
|       |   |   ├── operations.rst
|       |   |   ├── represent.rst
|       |   |   └── uses.rst
|       |   ├── integrals
|       |   |   ├── g-functions.rst
|       |   |   ├── index.rst
|       |   |   └── integrals.rst
|       |   ├── interactive.rst
|       |   ├── liealgebras
|       |   |   └── index.rst
|       |   ├── logic.rst
|       |   ├── matrices
|       |   |   ├── common.rst
|       |   |   ├── dense.rst
|       |   |   ├── expressions.rst
|       |   |   ├── immutablematrices.rst
|       |   |   ├── index.rst
|       |   |   ├── matrices.rst
|       |   |   ├── normalforms.rst
|       |   |   ├── sparse.rst
|       |   |   └── sparsetools.rst
|       |   ├── ntheory.rst
|       |   ├── numeric-computation.rst
|       |   ├── parsing.rst
|       |   ├── physics
|       |   |   ├── continuum_mechanics
|       |   |   ├── control
|       |   |   ├── hep
|       |   |   ├── hydrogen.rst
|       |   |   ├── matrices.rst
|       |   |   ├── mechanics
|       |   |   ├── optics
|       |   |   ├── paulialgebra.rst
|       |   |   ├── qho_1d.rst
|       |   |   ├── quantum
|       |   |   ├── secondquant.rst
|       |   |   ├── sho.rst
|       |   |   ├── units
|       |   |   ├── vector
|       |   |   └── wigner.rst
|       |   ├── plotting.rst
|       |   ├── polys
|       |   |   ├── agca.rst
|       |   |   ├── basics.rst
|       |   |   ├── domainmatrix.rst
|       |   |   ├── domainsintro.rst
|       |   |   ├── domainsref.rst
|       |   |   ├── index.rst
|       |   |   ├── internals.rst
|       |   |   ├── literature.rst
|       |   |   ├── numberfields.rst
|       |   |   ├── reference.rst
|       |   |   ├── ringseries.rst
|       |   |   ├── solvers.rst
|       |   |   └── wester.rst
|       |   ├── printing.rst
|       |   ├── rewriting.rst
|       |   ├── series
|       |   |   ├── formal.rst
|       |   |   ├── fourier.rst
|       |   |   ├── index.rst
|       |   |   ├── limitseq.rst
|       |   |   ├── sequences.rst
|       |   |   └── series.rst
|       |   ├── sets.rst
|       |   ├── simplify
|       |   |   ├── fu.rst
|       |   |   ├── hyperexpand.rst
|       |   |   ├── index.rst
|       |   |   └── simplify.rst
|       |   ├── solvers
|       |   |   ├── diophantine.rst
|       |   |   ├── index.rst
|       |   |   ├── inequalities.rst
|       |   |   ├── ode.rst
|       |   |   ├── pde.rst
|       |   |   ├── solvers.rst
|       |   |   └── solveset.rst
|       |   ├── stats.rst
|       |   ├── tensor
|       |   |   ├── array.rst
|       |   |   ├── array_expressions.rst
|       |   |   ├── index.rst
|       |   |   ├── index_methods.rst
|       |   |   ├── indexed.rst
|       |   |   ├── tensor.rst
|       |   |   └── toperators.rst
|       |   ├── testing
|       |   |   ├── index.rst
|       |   |   ├── pytest.rst
|       |   |   ├── randtest.rst
|       |   |   └── runtests.rst
|       |   ├── utilities
|       |   |   ├── autowrap.rst
|       |   |   ├── codegen.rst
|       |   |   ├── decorator.rst
|       |   |   ├── enumerative.rst
|       |   |   ├── exceptions.rst
|       |   |   ├── index.rst
|       |   |   ├── iterables.rst
|       |   |   ├── lambdify.rst
|       |   |   ├── memoization.rst
|       |   |   ├── misc.rst
|       |   |   ├── pkgdata.rst
|       |   |   ├── source.rst
|       |   |   └── timeutils.rst
|       |   └── vector
|       |       ├── api
|       |       ├── basics.rst
|       |       ├── coordsys.rst
|       |       ├── examples.rst
|       |       ├── fields.rst
|       |       ├── index.rst
|       |       ├── intro.rst
|       |       └── vector_integration.rst
|       ├── pics
|       ├── reference
|       |   ├── index.rst
|       |   └── public
|       |       ├── basics
|       |       ├── codegeneration
|       |       ├── logic
|       |       ├── matrices
|       |       ├── numbertheory
|       |       ├── physics
|       |       ├── topics
|       |       └── utilities
|       └── tutorials
|           ├── index.rst
|           └── intro-tutorial
|               ├── basic_operations.rst
|               ├── calculus.rst
|               ├── features.rst
|               ├── gotchas.rst
|               ├── index.rst
|               ├── intro.rst
|               ├── manipulation.rst
|               ├── matrices.rst
|               ├── next.rst
|               ├── preliminaries.rst
|               ├── printing.rst
|               ├── simplification.rst
|               └── solvers.rst
├── examples
|   ├── advanced
|   |   ├── autowrap_integrators.py
|   |   ├── autowrap_ufuncify.py
|   |   ├── curvilinear_coordinates.py
|   |   ├── dense_coding_example.py
|   |   ├── fem.py
|   |   ├── gibbs_phenomenon.py
|   |   ├── grover_example.py
|   |   ├── hydrogen.py
|   |   ├── pidigits.py
|   |   ├── pyglet_plotting.py
|   |   ├── qft.py
|   |   └── relativity.py
|   ├── all.py
|   ├── beginner
|   |   ├── basic.py
|   |   ├── differentiation.py
|   |   ├── expansion.py
|   |   ├── functions.py
|   |   ├── limits_examples.py
|   |   ├── plot_examples.py
|   |   ├── plotting_nice_plot.py
|   |   ├── precision.py
|   |   ├── print_pretty.py
|   |   ├── series.py
|   |   └── substitution.py
|   ├── intermediate
|   |   ├── coupled_cluster.py
|   |   ├── differential_equations.py
|   |   ├── infinite_1d_box.py
|   |   ├── mplot2d.py
|   |   ├── mplot3d.py
|   |   ├── partial_differential_eqs.py
|   |   ├── print_gtk.py
|   |   ├── sample.py
|   |   ├── trees.py
|   |   └── vandermonde.py
|   └── notebooks
|       └── README.txt
├── isympy.py
├── release
|   ├── README.md
|   ├── authors.py
|   ├── build_docs.py
|   ├── ci_release_script.sh
|   ├── compare_tar_against_git.py
|   ├── github_release.py
|   ├── helpers.py
|   ├── releasecheck.py
|   ├── sha256.py
|   └── update_docs.py
├── setup.py
├── setupegg.py
└── sympy
    ├── __init__.py
    ├── abc.py
    ├── algebras
    |   ├── __init__.py
    |   ├── quaternion.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_quaternion.py
    ├── assumptions
    |   ├── __init__.py
    |   ├── ask.py
    |   ├── ask_generated.py
    |   ├── assume.py
    |   ├── cnf.py
    |   ├── facts.py
    |   ├── handlers
    |   |   ├── __init__.py
    |   |   ├── calculus.py
    |   |   ├── common.py
    |   |   ├── matrices.py
    |   |   ├── ntheory.py
    |   |   ├── order.py
    |   |   └── sets.py
    |   ├── predicates
    |   |   ├── __init__.py
    |   |   ├── calculus.py
    |   |   ├── common.py
    |   |   ├── matrices.py
    |   |   ├── ntheory.py
    |   |   ├── order.py
    |   |   └── sets.py
    |   ├── refine.py
    |   ├── relation
    |   |   ├── __init__.py
    |   |   ├── binrel.py
    |   |   └── equality.py
    |   ├── satask.py
    |   ├── sathandlers.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_assumptions_2.py
    |   |   ├── test_context.py
    |   |   ├── test_matrices.py
    |   |   ├── test_query.py
    |   |   ├── test_refine.py
    |   |   ├── test_satask.py
    |   |   ├── test_sathandlers.py
    |   |   └── test_wrapper.py
    |   └── wrapper.py
    ├── benchmarks
    |   ├── __init__.py
    |   ├── bench_discrete_log.py
    |   ├── bench_meijerint.py
    |   └── bench_symbench.py
    ├── calculus
    |   ├── __init__.py
    |   ├── accumulationbounds.py
    |   ├── euler.py
    |   ├── finite_diff.py
    |   ├── singularities.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_accumulationbounds.py
    |   |   ├── test_euler.py
    |   |   ├── test_finite_diff.py
    |   |   ├── test_singularities.py
    |   |   └── test_util.py
    |   └── util.py
    ├── categories
    |   ├── __init__.py
    |   ├── baseclasses.py
    |   ├── diagram_drawing.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_baseclasses.py
    |       └── test_drawing.py
    ├── codegen
    |   ├── __init__.py
    |   ├── abstract_nodes.py
    |   ├── algorithms.py
    |   ├── approximations.py
    |   ├── ast.py
    |   ├── cfunctions.py
    |   ├── cnodes.py
    |   ├── cutils.py
    |   ├── cxxnodes.py
    |   ├── fnodes.py
    |   ├── futils.py
    |   ├── matrix_nodes.py
    |   ├── numpy_nodes.py
    |   ├── pynodes.py
    |   ├── pyutils.py
    |   ├── rewriting.py
    |   ├── scipy_nodes.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_abstract_nodes.py
    |       ├── test_algorithms.py
    |       ├── test_applications.py
    |       ├── test_approximations.py
    |       ├── test_ast.py
    |       ├── test_cfunctions.py
    |       ├── test_cnodes.py
    |       ├── test_cxxnodes.py
    |       ├── test_fnodes.py
    |       ├── test_numpy_nodes.py
    |       ├── test_pynodes.py
    |       ├── test_pyutils.py
    |       ├── test_rewriting.py
    |       └── test_scipy_nodes.py
    ├── combinatorics
    |   ├── __init__.py
    |   ├── coset_table.py
    |   ├── fp_groups.py
    |   ├── free_groups.py
    |   ├── generators.py
    |   ├── graycode.py
    |   ├── group_constructs.py
    |   ├── group_numbers.py
    |   ├── homomorphisms.py
    |   ├── named_groups.py
    |   ├── partitions.py
    |   ├── pc_groups.py
    |   ├── perm_groups.py
    |   ├── permutations.py
    |   ├── polyhedron.py
    |   ├── prufer.py
    |   ├── rewritingsystem.py
    |   ├── rewritingsystem_fsm.py
    |   ├── schur_number.py
    |   ├── subsets.py
    |   ├── tensor_can.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_coset_table.py
    |   |   ├── test_fp_groups.py
    |   |   ├── test_free_groups.py
    |   |   ├── test_generators.py
    |   |   ├── test_graycode.py
    |   |   ├── test_group_constructs.py
    |   |   ├── test_group_numbers.py
    |   |   ├── test_homomorphisms.py
    |   |   ├── test_named_groups.py
    |   |   ├── test_partitions.py
    |   |   ├── test_pc_groups.py
    |   |   ├── test_perm_groups.py
    |   |   ├── test_permutations.py
    |   |   ├── test_polyhedron.py
    |   |   ├── test_prufer.py
    |   |   ├── test_rewriting.py
    |   |   ├── test_schur_number.py
    |   |   ├── test_subsets.py
    |   |   ├── test_tensor_can.py
    |   |   ├── test_testutil.py
    |   |   └── test_util.py
    |   ├── testutil.py
    |   └── util.py
    ├── concrete
    |   ├── __init__.py
    |   ├── delta.py
    |   ├── expr_with_intlimits.py
    |   ├── expr_with_limits.py
    |   ├── gosper.py
    |   ├── guess.py
    |   ├── products.py
    |   ├── summations.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_delta.py
    |       ├── test_gosper.py
    |       ├── test_guess.py
    |       ├── test_products.py
    |       └── test_sums_products.py
    ├── conftest.py
    ├── core
    |   ├── __init__.py
    |   ├── _print_helpers.py
    |   ├── add.py
    |   ├── alphabets.py
    |   ├── assumptions.py
    |   ├── assumptions_generated.py
    |   ├── backend.py
    |   ├── basic.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_arit.py
    |   |   ├── bench_assumptions.py
    |   |   ├── bench_basic.py
    |   |   ├── bench_expand.py
    |   |   ├── bench_numbers.py
    |   |   └── bench_sympify.py
    |   ├── cache.py
    |   ├── compatibility.py
    |   ├── containers.py
    |   ├── core.py
    |   ├── coreerrors.py
    |   ├── decorators.py
    |   ├── evalf.py
    |   ├── expr.py
    |   ├── exprtools.py
    |   ├── facts.py
    |   ├── function.py
    |   ├── kind.py
    |   ├── logic.py
    |   ├── mod.py
    |   ├── mul.py
    |   ├── multidimensional.py
    |   ├── numbers.py
    |   ├── operations.py
    |   ├── parameters.py
    |   ├── power.py
    |   ├── random.py
    |   ├── relational.py
    |   ├── rules.py
    |   ├── singleton.py
    |   ├── sorting.py
    |   ├── symbol.py
    |   ├── sympify.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_args.py
    |   |   ├── test_arit.py
    |   |   ├── test_assumptions.py
    |   |   ├── test_basic.py
    |   |   ├── test_cache.py
    |   |   ├── test_compatibility.py
    |   |   ├── test_complex.py
    |   |   ├── test_constructor_postprocessor.py
    |   |   ├── test_containers.py
    |   |   ├── test_count_ops.py
    |   |   ├── test_diff.py
    |   |   ├── test_equal.py
    |   |   ├── test_eval.py
    |   |   ├── test_evalf.py
    |   |   ├── test_expand.py
    |   |   ├── test_expr.py
    |   |   ├── test_exprtools.py
    |   |   ├── test_facts.py
    |   |   ├── test_function.py
    |   |   ├── test_kind.py
    |   |   ├── test_logic.py
    |   |   ├── test_match.py
    |   |   ├── test_multidimensional.py
    |   |   ├── test_noncommutative.py
    |   |   ├── test_numbers.py
    |   |   ├── test_operations.py
    |   |   ├── test_parameters.py
    |   |   ├── test_power.py
    |   |   ├── test_priority.py
    |   |   ├── test_random.py
    |   |   ├── test_relational.py
    |   |   ├── test_rules.py
    |   |   ├── test_singleton.py
    |   |   ├── test_sorting.py
    |   |   ├── test_subs.py
    |   |   ├── test_symbol.py
    |   |   ├── test_sympify.py
    |   |   ├── test_traversal.py
    |   |   ├── test_truediv.py
    |   |   └── test_var.py
    |   ├── trace.py
    |   └── traversal.py
    ├── crypto
    |   ├── __init__.py
    |   ├── crypto.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_crypto.py
    ├── diffgeom
    |   ├── __init__.py
    |   ├── diffgeom.py
    |   ├── rn.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_class_structure.py
    |       ├── test_diffgeom.py
    |       ├── test_function_diffgeom_book.py
    |       └── test_hyperbolic_space.py
    ├── discrete
    |   ├── __init__.py
    |   ├── convolutions.py
    |   ├── recurrences.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_convolutions.py
    |   |   ├── test_recurrences.py
    |   |   └── test_transforms.py
    |   └── transforms.py
    ├── external
    |   ├── __init__.py
    |   ├── gmpy.py
    |   ├── importtools.py
    |   ├── pythonmpq.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_autowrap.py
    |       ├── test_codegen.py
    |       ├── test_importtools.py
    |       ├── test_numpy.py
    |       ├── test_pythonmpq.py
    |       └── test_scipy.py
    ├── functions
    |   ├── __init__.py
    |   ├── combinatorial
    |   |   ├── __init__.py
    |   |   ├── factorials.py
    |   |   ├── numbers.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_comb_factorials.py
    |   |       └── test_comb_numbers.py
    |   ├── elementary
    |   |   ├── __init__.py
    |   |   ├── benchmarks
    |   |   |   ├── __init__.py
    |   |   |   └── bench_exp.py
    |   |   ├── complexes.py
    |   |   ├── exponential.py
    |   |   ├── hyperbolic.py
    |   |   ├── integers.py
    |   |   ├── miscellaneous.py
    |   |   ├── piecewise.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_complexes.py
    |   |   |   ├── test_exponential.py
    |   |   |   ├── test_hyperbolic.py
    |   |   |   ├── test_integers.py
    |   |   |   ├── test_interface.py
    |   |   |   ├── test_miscellaneous.py
    |   |   |   ├── test_piecewise.py
    |   |   |   └── test_trigonometric.py
    |   |   └── trigonometric.py
    |   └── special
    |       ├── __init__.py
    |       ├── benchmarks
    |       |   ├── __init__.py
    |       |   └── bench_special.py
    |       ├── bessel.py
    |       ├── beta_functions.py
    |       ├── bsplines.py
    |       ├── delta_functions.py
    |       ├── elliptic_integrals.py
    |       ├── error_functions.py
    |       ├── gamma_functions.py
    |       ├── hyper.py
    |       ├── mathieu_functions.py
    |       ├── polynomials.py
    |       ├── singularity_functions.py
    |       ├── spherical_harmonics.py
    |       ├── tensor_functions.py
    |       ├── tests
    |       |   ├── __init__.py
    |       |   ├── test_bessel.py
    |       |   ├── test_beta_functions.py
    |       |   ├── test_bsplines.py
    |       |   ├── test_delta_functions.py
    |       |   ├── test_elliptic_integrals.py
    |       |   ├── test_error_functions.py
    |       |   ├── test_gamma_functions.py
    |       |   ├── test_hyper.py
    |       |   ├── test_mathieu.py
    |       |   ├── test_singularity_functions.py
    |       |   ├── test_spec_polynomials.py
    |       |   ├── test_spherical_harmonics.py
    |       |   ├── test_tensor_functions.py
    |       |   └── test_zeta_functions.py
    |       └── zeta_functions.py
    ├── galgebra.py
    ├── geometry
    |   ├── __init__.py
    |   ├── curve.py
    |   ├── ellipse.py
    |   ├── entity.py
    |   ├── exceptions.py
    |   ├── line.py
    |   ├── parabola.py
    |   ├── plane.py
    |   ├── point.py
    |   ├── polygon.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_curve.py
    |   |   ├── test_ellipse.py
    |   |   ├── test_entity.py
    |   |   ├── test_geometrysets.py
    |   |   ├── test_line.py
    |   |   ├── test_parabola.py
    |   |   ├── test_plane.py
    |   |   ├── test_point.py
    |   |   ├── test_polygon.py
    |   |   └── test_util.py
    |   └── util.py
    ├── holonomic
    |   ├── __init__.py
    |   ├── holonomic.py
    |   ├── holonomicerrors.py
    |   ├── numerical.py
    |   ├── recurrence.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_holonomic.py
    |       └── test_recurrence.py
    ├── integrals
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_integrate.py
    |   |   └── bench_trigintegrate.py
    |   ├── deltafunctions.py
    |   ├── heurisch.py
    |   ├── integrals.py
    |   ├── intpoly.py
    |   ├── manualintegrate.py
    |   ├── meijerint.py
    |   ├── meijerint_doc.py
    |   ├── prde.py
    |   ├── quadrature.py
    |   ├── rationaltools.py
    |   ├── rde.py
    |   ├── risch.py
    |   ├── singularityfunctions.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_deltafunctions.py
    |   |   ├── test_failing_integrals.py
    |   |   ├── test_heurisch.py
    |   |   ├── test_integrals.py
    |   |   ├── test_intpoly.py
    |   |   ├── test_lineintegrals.py
    |   |   ├── test_manual.py
    |   |   ├── test_meijerint.py
    |   |   ├── test_prde.py
    |   |   ├── test_quadrature.py
    |   |   ├── test_rationaltools.py
    |   |   ├── test_rde.py
    |   |   ├── test_risch.py
    |   |   ├── test_singularityfunctions.py
    |   |   ├── test_transforms.py
    |   |   └── test_trigonometry.py
    |   ├── transforms.py
    |   └── trigonometry.py
    ├── interactive
    |   ├── __init__.py
    |   ├── printing.py
    |   ├── session.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_interactive.py
    |   |   └── test_ipython.py
    |   └── traversal.py
    ├── liealgebras
    |   ├── __init__.py
    |   ├── cartan_matrix.py
    |   ├── cartan_type.py
    |   ├── dynkin_diagram.py
    |   ├── root_system.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_cartan_matrix.py
    |   |   ├── test_cartan_type.py
    |   |   ├── test_dynkin_diagram.py
    |   |   ├── test_root_system.py
    |   |   ├── test_type_A.py
    |   |   ├── test_type_B.py
    |   |   ├── test_type_C.py
    |   |   ├── test_type_D.py
    |   |   ├── test_type_E.py
    |   |   ├── test_type_F.py
    |   |   ├── test_type_G.py
    |   |   └── test_weyl_group.py
    |   ├── type_a.py
    |   ├── type_b.py
    |   ├── type_c.py
    |   ├── type_d.py
    |   ├── type_e.py
    |   ├── type_f.py
    |   ├── type_g.py
    |   └── weyl_group.py
    ├── logic
    |   ├── __init__.py
    |   ├── algorithms
    |   |   ├── __init__.py
    |   |   ├── dpll.py
    |   |   ├── dpll2.py
    |   |   ├── minisat22_wrapper.py
    |   |   └── pycosat_wrapper.py
    |   ├── boolalg.py
    |   ├── inference.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_boolalg.py
    |   |   ├── test_dimacs.py
    |   |   └── test_inference.py
    |   └── utilities
    |       ├── __init__.py
    |       └── dimacs.py
    ├── matrices
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_matrix.py
    |   ├── common.py
    |   ├── decompositions.py
    |   ├── dense.py
    |   ├── determinant.py
    |   ├── eigen.py
    |   ├── expressions
    |   |   ├── __init__.py
    |   |   ├── _shape.py
    |   |   ├── adjoint.py
    |   |   ├── applyfunc.py
    |   |   ├── blockmatrix.py
    |   |   ├── companion.py
    |   |   ├── determinant.py
    |   |   ├── diagonal.py
    |   |   ├── dotproduct.py
    |   |   ├── factorizations.py
    |   |   ├── fourier.py
    |   |   ├── funcmatrix.py
    |   |   ├── hadamard.py
    |   |   ├── inverse.py
    |   |   ├── kronecker.py
    |   |   ├── matadd.py
    |   |   ├── matexpr.py
    |   |   ├── matmul.py
    |   |   ├── matpow.py
    |   |   ├── permutation.py
    |   |   ├── sets.py
    |   |   ├── slice.py
    |   |   ├── special.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_adjoint.py
    |   |   |   ├── test_applyfunc.py
    |   |   |   ├── test_blockmatrix.py
    |   |   |   ├── test_companion.py
    |   |   |   ├── test_derivatives.py
    |   |   |   ├── test_determinant.py
    |   |   |   ├── test_diagonal.py
    |   |   |   ├── test_dotproduct.py
    |   |   |   ├── test_factorizations.py
    |   |   |   ├── test_fourier.py
    |   |   |   ├── test_funcmatrix.py
    |   |   |   ├── test_hadamard.py
    |   |   |   ├── test_indexing.py
    |   |   |   ├── test_inverse.py
    |   |   |   ├── test_kronecker.py
    |   |   |   ├── test_matadd.py
    |   |   |   ├── test_matexpr.py
    |   |   |   ├── test_matmul.py
    |   |   |   ├── test_matpow.py
    |   |   |   ├── test_permutation.py
    |   |   |   ├── test_sets.py
    |   |   |   ├── test_slice.py
    |   |   |   ├── test_special.py
    |   |   |   ├── test_trace.py
    |   |   |   └── test_transpose.py
    |   |   ├── trace.py
    |   |   └── transpose.py
    |   ├── graph.py
    |   ├── immutable.py
    |   ├── inverse.py
    |   ├── matrices.py
    |   ├── normalforms.py
    |   ├── reductions.py
    |   ├── repmatrix.py
    |   ├── solvers.py
    |   ├── sparse.py
    |   ├── sparsetools.py
    |   ├── subspaces.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_commonmatrix.py
    |   |   ├── test_decompositions.py
    |   |   ├── test_determinant.py
    |   |   ├── test_eigen.py
    |   |   ├── test_graph.py
    |   |   ├── test_immutable.py
    |   |   ├── test_interactions.py
    |   |   ├── test_matrices.py
    |   |   ├── test_normalforms.py
    |   |   ├── test_reductions.py
    |   |   ├── test_solvers.py
    |   |   ├── test_sparse.py
    |   |   ├── test_sparsetools.py
    |   |   └── test_subspaces.py
    |   └── utilities.py
    ├── multipledispatch
    |   ├── __init__.py
    |   ├── conflict.py
    |   ├── core.py
    |   ├── dispatcher.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_conflict.py
    |   |   ├── test_core.py
    |   |   └── test_dispatcher.py
    |   └── utils.py
    ├── ntheory
    |   ├── __init__.py
    |   ├── bbp_pi.py
    |   ├── continued_fraction.py
    |   ├── digits.py
    |   ├── ecm.py
    |   ├── egyptian_fraction.py
    |   ├── elliptic_curve.py
    |   ├── factor_.py
    |   ├── generate.py
    |   ├── modular.py
    |   ├── multinomial.py
    |   ├── partitions_.py
    |   ├── primetest.py
    |   ├── qs.py
    |   ├── residue_ntheory.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_bbp_pi.py
    |       ├── test_continued_fraction.py
    |       ├── test_digits.py
    |       ├── test_ecm.py
    |       ├── test_egyptian_fraction.py
    |       ├── test_elliptic_curve.py
    |       ├── test_factor_.py
    |       ├── test_generate.py
    |       ├── test_modular.py
    |       ├── test_multinomial.py
    |       ├── test_partitions.py
    |       ├── test_primetest.py
    |       ├── test_qs.py
    |       └── test_residue.py
    ├── parsing
    |   ├── __init__.py
    |   ├── ast_parser.py
    |   ├── autolev
    |   |   ├── __init__.py
    |   |   ├── _antlr
    |   |   |   ├── __init__.py
    |   |   |   ├── autolevlexer.py
    |   |   |   ├── autolevlistener.py
    |   |   |   └── autolevparser.py
    |   |   ├── _build_autolev_antlr.py
    |   |   ├── _listener_autolev_antlr.py
    |   |   ├── _parse_autolev_antlr.py
    |   |   └── test-examples
    |   |       ├── README.txt
    |   |       ├── pydy-example-repo
    |   |       ├── ruletest1.py
    |   |       ├── ruletest10.py
    |   |       ├── ruletest11.py
    |   |       ├── ruletest12.py
    |   |       ├── ruletest2.py
    |   |       ├── ruletest3.py
    |   |       ├── ruletest4.py
    |   |       ├── ruletest5.py
    |   |       ├── ruletest6.py
    |   |       ├── ruletest7.py
    |   |       ├── ruletest8.py
    |   |       └── ruletest9.py
    |   ├── c
    |   |   ├── __init__.py
    |   |   └── c_parser.py
    |   ├── fortran
    |   |   ├── __init__.py
    |   |   └── fortran_parser.py
    |   ├── latex
    |   |   ├── LICENSE.txt
    |   |   ├── __init__.py
    |   |   ├── _antlr
    |   |   |   ├── __init__.py
    |   |   |   ├── latexlexer.py
    |   |   |   └── latexparser.py
    |   |   ├── _build_latex_antlr.py
    |   |   ├── _parse_latex_antlr.py
    |   |   └── errors.py
    |   ├── mathematica.py
    |   ├── maxima.py
    |   ├── sym_expr.py
    |   ├── sympy_parser.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_ast_parser.py
    |       ├── test_autolev.py
    |       ├── test_c_parser.py
    |       ├── test_fortran_parser.py
    |       ├── test_implicit_multiplication_application.py
    |       ├── test_latex.py
    |       ├── test_latex_deps.py
    |       ├── test_mathematica.py
    |       ├── test_maxima.py
    |       ├── test_sym_expr.py
    |       └── test_sympy_parser.py
    ├── physics
    |   ├── __init__.py
    |   ├── continuum_mechanics
    |   |   ├── __init__.py
    |   |   ├── beam.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_beam.py
    |   |   |   └── test_truss.py
    |   |   └── truss.py
    |   ├── control
    |   |   ├── __init__.py
    |   |   ├── control_plots.py
    |   |   ├── lti.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_control_plots.py
    |   |       └── test_lti.py
    |   ├── hep
    |   |   ├── __init__.py
    |   |   ├── gamma_matrices.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_gamma_matrices.py
    |   ├── hydrogen.py
    |   ├── matrices.py
    |   ├── mechanics
    |   |   ├── __init__.py
    |   |   ├── body.py
    |   |   ├── functions.py
    |   |   ├── joint.py
    |   |   ├── jointsmethod.py
    |   |   ├── kane.py
    |   |   ├── lagrange.py
    |   |   ├── linearize.py
    |   |   ├── method.py
    |   |   ├── models.py
    |   |   ├── particle.py
    |   |   ├── rigidbody.py
    |   |   ├── system.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_body.py
    |   |       ├── test_functions.py
    |   |       ├── test_joint.py
    |   |       ├── test_jointsmethod.py
    |   |       ├── test_kane.py
    |   |       ├── test_kane2.py
    |   |       ├── test_kane3.py
    |   |       ├── test_kane4.py
    |   |       ├── test_lagrange.py
    |   |       ├── test_lagrange2.py
    |   |       ├── test_linearize.py
    |   |       ├── test_method.py
    |   |       ├── test_models.py
    |   |       ├── test_particle.py
    |   |       ├── test_rigidbody.py
    |   |       └── test_system.py
    |   ├── optics
    |   |   ├── __init__.py
    |   |   ├── gaussopt.py
    |   |   ├── medium.py
    |   |   ├── polarization.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_gaussopt.py
    |   |   |   ├── test_medium.py
    |   |   |   ├── test_polarization.py
    |   |   |   ├── test_utils.py
    |   |   |   └── test_waves.py
    |   |   ├── utils.py
    |   |   └── waves.py
    |   ├── paulialgebra.py
    |   ├── pring.py
    |   ├── qho_1d.py
    |   ├── quantum
    |   |   ├── __init__.py
    |   |   ├── anticommutator.py
    |   |   ├── boson.py
    |   |   ├── cartesian.py
    |   |   ├── cg.py
    |   |   ├── circuitplot.py
    |   |   ├── circuitutils.py
    |   |   ├── commutator.py
    |   |   ├── constants.py
    |   |   ├── dagger.py
    |   |   ├── density.py
    |   |   ├── fermion.py
    |   |   ├── gate.py
    |   |   ├── grover.py
    |   |   ├── hilbert.py
    |   |   ├── identitysearch.py
    |   |   ├── innerproduct.py
    |   |   ├── matrixcache.py
    |   |   ├── matrixutils.py
    |   |   ├── operator.py
    |   |   ├── operatorordering.py
    |   |   ├── operatorset.py
    |   |   ├── pauli.py
    |   |   ├── piab.py
    |   |   ├── qapply.py
    |   |   ├── qasm.py
    |   |   ├── qexpr.py
    |   |   ├── qft.py
    |   |   ├── qubit.py
    |   |   ├── represent.py
    |   |   ├── sho1d.py
    |   |   ├── shor.py
    |   |   ├── spin.py
    |   |   ├── state.py
    |   |   ├── tensorproduct.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_anticommutator.py
    |   |   |   ├── test_boson.py
    |   |   |   ├── test_cartesian.py
    |   |   |   ├── test_cg.py
    |   |   |   ├── test_circuitplot.py
    |   |   |   ├── test_circuitutils.py
    |   |   |   ├── test_commutator.py
    |   |   |   ├── test_constants.py
    |   |   |   ├── test_dagger.py
    |   |   |   ├── test_density.py
    |   |   |   ├── test_fermion.py
    |   |   |   ├── test_gate.py
    |   |   |   ├── test_grover.py
    |   |   |   ├── test_hilbert.py
    |   |   |   ├── test_identitysearch.py
    |   |   |   ├── test_innerproduct.py
    |   |   |   ├── test_matrixutils.py
    |   |   |   ├── test_operator.py
    |   |   |   ├── test_operatorordering.py
    |   |   |   ├── test_operatorset.py
    |   |   |   ├── test_pauli.py
    |   |   |   ├── test_piab.py
    |   |   |   ├── test_printing.py
    |   |   |   ├── test_qapply.py
    |   |   |   ├── test_qasm.py
    |   |   |   ├── test_qexpr.py
    |   |   |   ├── test_qft.py
    |   |   |   ├── test_qubit.py
    |   |   |   ├── test_represent.py
    |   |   |   ├── test_sho1d.py
    |   |   |   ├── test_shor.py
    |   |   |   ├── test_spin.py
    |   |   |   ├── test_state.py
    |   |   |   ├── test_tensorproduct.py
    |   |   |   └── test_trace.py
    |   |   └── trace.py
    |   ├── secondquant.py
    |   ├── sho.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_clebsch_gordan.py
    |   |   ├── test_hydrogen.py
    |   |   ├── test_paulialgebra.py
    |   |   ├── test_physics_matrices.py
    |   |   ├── test_pring.py
    |   |   ├── test_qho_1d.py
    |   |   ├── test_secondquant.py
    |   |   └── test_sho.py
    |   ├── units
    |   |   ├── __init__.py
    |   |   ├── definitions
    |   |   |   ├── __init__.py
    |   |   |   ├── dimension_definitions.py
    |   |   |   └── unit_definitions.py
    |   |   ├── dimensions.py
    |   |   ├── prefixes.py
    |   |   ├── quantities.py
    |   |   ├── systems
    |   |   |   ├── __init__.py
    |   |   |   ├── cgs.py
    |   |   |   ├── length_weight_time.py
    |   |   |   ├── mks.py
    |   |   |   ├── mksa.py
    |   |   |   ├── natural.py
    |   |   |   └── si.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dimensions.py
    |   |   |   ├── test_dimensionsystem.py
    |   |   |   ├── test_prefixes.py
    |   |   |   ├── test_quantities.py
    |   |   |   ├── test_unit_system_cgs_gauss.py
    |   |   |   ├── test_unitsystem.py
    |   |   |   └── test_util.py
    |   |   ├── unitsystem.py
    |   |   └── util.py
    |   ├── vector
    |   |   ├── __init__.py
    |   |   ├── dyadic.py
    |   |   ├── fieldfunctions.py
    |   |   ├── frame.py
    |   |   ├── functions.py
    |   |   ├── point.py
    |   |   ├── printing.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dyadic.py
    |   |   |   ├── test_fieldfunctions.py
    |   |   |   ├── test_frame.py
    |   |   |   ├── test_functions.py
    |   |   |   ├── test_output.py
    |   |   |   ├── test_point.py
    |   |   |   ├── test_printing.py
    |   |   |   └── test_vector.py
    |   |   └── vector.py
    |   └── wigner.py
    ├── plotting
    |   ├── __init__.py
    |   ├── experimental_lambdify.py
    |   ├── intervalmath
    |   |   ├── __init__.py
    |   |   ├── interval_arithmetic.py
    |   |   ├── interval_membership.py
    |   |   ├── lib_interval.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_interval_functions.py
    |   |       ├── test_interval_membership.py
    |   |       └── test_intervalmath.py
    |   ├── plot.py
    |   ├── plot_implicit.py
    |   ├── pygletplot
    |   |   ├── __init__.py
    |   |   ├── color_scheme.py
    |   |   ├── managed_window.py
    |   |   ├── plot.py
    |   |   ├── plot_axes.py
    |   |   ├── plot_camera.py
    |   |   ├── plot_controller.py
    |   |   ├── plot_curve.py
    |   |   ├── plot_interval.py
    |   |   ├── plot_mode.py
    |   |   ├── plot_mode_base.py
    |   |   ├── plot_modes.py
    |   |   ├── plot_object.py
    |   |   ├── plot_rotation.py
    |   |   ├── plot_surface.py
    |   |   ├── plot_window.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── test_plotting.py
    |   |   └── util.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_experimental_lambdify.py
    |   |   ├── test_plot.py
    |   |   ├── test_plot_implicit.py
    |   |   └── test_textplot.py
    |   └── textplot.py
    ├── polys
    |   ├── __init__.py
    |   ├── agca
    |   |   ├── __init__.py
    |   |   ├── extensions.py
    |   |   ├── homomorphisms.py
    |   |   ├── ideals.py
    |   |   ├── modules.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_extensions.py
    |   |       ├── test_homomorphisms.py
    |   |       ├── test_ideals.py
    |   |       └── test_modules.py
    |   ├── appellseqs.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_galoispolys.py
    |   |   ├── bench_groebnertools.py
    |   |   └── bench_solvers.py
    |   ├── compatibility.py
    |   ├── constructor.py
    |   ├── densearith.py
    |   ├── densebasic.py
    |   ├── densetools.py
    |   ├── dispersion.py
    |   ├── distributedmodules.py
    |   ├── domainmatrix.py
    |   ├── domains
    |   |   ├── __init__.py
    |   |   ├── algebraicfield.py
    |   |   ├── characteristiczero.py
    |   |   ├── complexfield.py
    |   |   ├── compositedomain.py
    |   |   ├── domain.py
    |   |   ├── domainelement.py
    |   |   ├── expressiondomain.py
    |   |   ├── expressionrawdomain.py
    |   |   ├── field.py
    |   |   ├── finitefield.py
    |   |   ├── fractionfield.py
    |   |   ├── gaussiandomains.py
    |   |   ├── gmpyfinitefield.py
    |   |   ├── gmpyintegerring.py
    |   |   ├── gmpyrationalfield.py
    |   |   ├── groundtypes.py
    |   |   ├── integerring.py
    |   |   ├── modularinteger.py
    |   |   ├── mpelements.py
    |   |   ├── old_fractionfield.py
    |   |   ├── old_polynomialring.py
    |   |   ├── polynomialring.py
    |   |   ├── pythonfinitefield.py
    |   |   ├── pythonintegerring.py
    |   |   ├── pythonrational.py
    |   |   ├── pythonrationalfield.py
    |   |   ├── quotientring.py
    |   |   ├── rationalfield.py
    |   |   ├── realfield.py
    |   |   ├── ring.py
    |   |   ├── simpledomain.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_domains.py
    |   |       ├── test_polynomialring.py
    |   |       └── test_quotientring.py
    |   ├── euclidtools.py
    |   ├── factortools.py
    |   ├── fglmtools.py
    |   ├── fields.py
    |   ├── galoistools.py
    |   ├── groebnertools.py
    |   ├── heuristicgcd.py
    |   ├── matrices
    |   |   ├── __init__.py
    |   |   ├── ddm.py
    |   |   ├── dense.py
    |   |   ├── domainmatrix.py
    |   |   ├── domainscalar.py
    |   |   ├── eigen.py
    |   |   ├── exceptions.py
    |   |   ├── linsolve.py
    |   |   ├── normalforms.py
    |   |   ├── sdm.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_ddm.py
    |   |       ├── test_dense.py
    |   |       ├── test_domainmatrix.py
    |   |       ├── test_domainscalar.py
    |   |       ├── test_eigen.py
    |   |       ├── test_linsolve.py
    |   |       ├── test_normalforms.py
    |   |       └── test_sdm.py
    |   ├── modulargcd.py
    |   ├── monomials.py
    |   ├── multivariate_resultants.py
    |   ├── numberfields
    |   |   ├── __init__.py
    |   |   ├── basis.py
    |   |   ├── exceptions.py
    |   |   ├── minpoly.py
    |   |   ├── modules.py
    |   |   ├── primes.py
    |   |   ├── subfield.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_basis.py
    |   |   |   ├── test_minpoly.py
    |   |   |   ├── test_modules.py
    |   |   |   ├── test_numbers.py
    |   |   |   ├── test_primes.py
    |   |   |   ├── test_subfield.py
    |   |   |   └── test_utilities.py
    |   |   └── utilities.py
    |   ├── orderings.py
    |   ├── orthopolys.py
    |   ├── partfrac.py
    |   ├── polyclasses.py
    |   ├── polyconfig.py
    |   ├── polyerrors.py
    |   ├── polyfuncs.py
    |   ├── polymatrix.py
    |   ├── polyoptions.py
    |   ├── polyquinticconst.py
    |   ├── polyroots.py
    |   ├── polytools.py
    |   ├── polyutils.py
    |   ├── rationaltools.py
    |   ├── ring_series.py
    |   ├── rings.py
    |   ├── rootisolation.py
    |   ├── rootoftools.py
    |   ├── solvers.py
    |   ├── specialpolys.py
    |   ├── sqfreetools.py
    |   ├── subresultants_qq_zz.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_appellseqs.py
    |       ├── test_constructor.py
    |       ├── test_densearith.py
    |       ├── test_densebasic.py
    |       ├── test_densetools.py
    |       ├── test_dispersion.py
    |       ├── test_distributedmodules.py
    |       ├── test_euclidtools.py
    |       ├── test_factortools.py
    |       ├── test_fields.py
    |       ├── test_galoistools.py
    |       ├── test_groebnertools.py
    |       ├── test_heuristicgcd.py
    |       ├── test_injections.py
    |       ├── test_modulargcd.py
    |       ├── test_monomials.py
    |       ├── test_multivariate_resultants.py
    |       ├── test_orderings.py
    |       ├── test_orthopolys.py
    |       ├── test_partfrac.py
    |       ├── test_polyclasses.py
    |       ├── test_polyfuncs.py
    |       ├── test_polymatrix.py
    |       ├── test_polyoptions.py
    |       ├── test_polyroots.py
    |       ├── test_polytools.py
    |       ├── test_polyutils.py
    |       ├── test_pythonrational.py
    |       ├── test_rationaltools.py
    |       ├── test_ring_series.py
    |       ├── test_rings.py
    |       ├── test_rootisolation.py
    |       ├── test_rootoftools.py
    |       ├── test_solvers.py
    |       ├── test_specialpolys.py
    |       ├── test_sqfreetools.py
    |       └── test_subresultants_qq_zz.py
    ├── printing
    |   ├── __init__.py
    |   ├── aesaracode.py
    |   ├── c.py
    |   ├── codeprinter.py
    |   ├── conventions.py
    |   ├── cxx.py
    |   ├── defaults.py
    |   ├── dot.py
    |   ├── fortran.py
    |   ├── glsl.py
    |   ├── gtk.py
    |   ├── jscode.py
    |   ├── julia.py
    |   ├── lambdarepr.py
    |   ├── latex.py
    |   ├── llvmjitcode.py
    |   ├── maple.py
    |   ├── mathematica.py
    |   ├── mathml.py
    |   ├── numpy.py
    |   ├── octave.py
    |   ├── precedence.py
    |   ├── pretty
    |   |   ├── __init__.py
    |   |   ├── pretty.py
    |   |   ├── pretty_symbology.py
    |   |   ├── stringpict.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_pretty.py
    |   ├── preview.py
    |   ├── printer.py
    |   ├── pycode.py
    |   ├── python.py
    |   ├── rcode.py
    |   ├── repr.py
    |   ├── rust.py
    |   ├── smtlib.py
    |   ├── str.py
    |   ├── tableform.py
    |   ├── tensorflow.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_aesaracode.py
    |   |   ├── test_c.py
    |   |   ├── test_codeprinter.py
    |   |   ├── test_conventions.py
    |   |   ├── test_cupy.py
    |   |   ├── test_cxx.py
    |   |   ├── test_dot.py
    |   |   ├── test_fortran.py
    |   |   ├── test_glsl.py
    |   |   ├── test_gtk.py
    |   |   ├── test_jax.py
    |   |   ├── test_jscode.py
    |   |   ├── test_julia.py
    |   |   ├── test_lambdarepr.py
    |   |   ├── test_latex.py
    |   |   ├── test_llvmjit.py
    |   |   ├── test_maple.py
    |   |   ├── test_mathematica.py
    |   |   ├── test_mathml.py
    |   |   ├── test_numpy.py
    |   |   ├── test_octave.py
    |   |   ├── test_precedence.py
    |   |   ├── test_preview.py
    |   |   ├── test_pycode.py
    |   |   ├── test_python.py
    |   |   ├── test_rcode.py
    |   |   ├── test_repr.py
    |   |   ├── test_rust.py
    |   |   ├── test_smtlib.py
    |   |   ├── test_str.py
    |   |   ├── test_tableform.py
    |   |   ├── test_tensorflow.py
    |   |   ├── test_theanocode.py
    |   |   └── test_tree.py
    |   ├── theanocode.py
    |   └── tree.py
    ├── release.py
    ├── sandbox
    |   ├── __init__.py
    |   ├── indexed_integrals.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_indexed_integrals.py
    ├── series
    |   ├── __init__.py
    |   ├── acceleration.py
    |   ├── approximants.py
    |   ├── aseries.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_limit.py
    |   |   └── bench_order.py
    |   ├── formal.py
    |   ├── fourier.py
    |   ├── gruntz.py
    |   ├── kauers.py
    |   ├── limits.py
    |   ├── limitseq.py
    |   ├── order.py
    |   ├── residues.py
    |   ├── sequences.py
    |   ├── series.py
    |   ├── series_class.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_approximants.py
    |       ├── test_aseries.py
    |       ├── test_demidovich.py
    |       ├── test_formal.py
    |       ├── test_fourier.py
    |       ├── test_gruntz.py
    |       ├── test_kauers.py
    |       ├── test_limits.py
    |       ├── test_limitseq.py
    |       ├── test_lseries.py
    |       ├── test_nseries.py
    |       ├── test_order.py
    |       ├── test_residues.py
    |       ├── test_sequences.py
    |       └── test_series.py
    ├── sets
    |   ├── __init__.py
    |   ├── conditionset.py
    |   ├── contains.py
    |   ├── fancysets.py
    |   ├── handlers
    |   |   ├── __init__.py
    |   |   ├── add.py
    |   |   ├── comparison.py
    |   |   ├── functions.py
    |   |   ├── intersection.py
    |   |   ├── issubset.py
    |   |   ├── mul.py
    |   |   ├── power.py
    |   |   └── union.py
    |   ├── ordinals.py
    |   ├── powerset.py
    |   ├── setexpr.py
    |   ├── sets.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_conditionset.py
    |       ├── test_contains.py
    |       ├── test_fancysets.py
    |       ├── test_ordinals.py
    |       ├── test_powerset.py
    |       ├── test_setexpr.py
    |       └── test_sets.py
    ├── simplify
    |   ├── __init__.py
    |   ├── combsimp.py
    |   ├── cse_main.py
    |   ├── cse_opts.py
    |   ├── epathtools.py
    |   ├── fu.py
    |   ├── gammasimp.py
    |   ├── hyperexpand.py
    |   ├── hyperexpand_doc.py
    |   ├── powsimp.py
    |   ├── radsimp.py
    |   ├── ratsimp.py
    |   ├── simplify.py
    |   ├── sqrtdenest.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_combsimp.py
    |   |   ├── test_cse.py
    |   |   ├── test_epathtools.py
    |   |   ├── test_fu.py
    |   |   ├── test_function.py
    |   |   ├── test_gammasimp.py
    |   |   ├── test_hyperexpand.py
    |   |   ├── test_powsimp.py
    |   |   ├── test_radsimp.py
    |   |   ├── test_ratsimp.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_simplify.py
    |   |   ├── test_sqrtdenest.py
    |   |   └── test_trigsimp.py
    |   ├── traversaltools.py
    |   └── trigsimp.py
    ├── solvers
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_solvers.py
    |   ├── bivariate.py
    |   ├── decompogen.py
    |   ├── deutils.py
    |   ├── diophantine
    |   |   ├── __init__.py
    |   |   ├── diophantine.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_diophantine.py
    |   ├── inequalities.py
    |   ├── ode
    |   |   ├── __init__.py
    |   |   ├── hypergeometric.py
    |   |   ├── lie_group.py
    |   |   ├── nonhomogeneous.py
    |   |   ├── ode.py
    |   |   ├── riccati.py
    |   |   ├── single.py
    |   |   ├── subscheck.py
    |   |   ├── systems.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_lie_group.py
    |   |       ├── test_ode.py
    |   |       ├── test_riccati.py
    |   |       ├── test_single.py
    |   |       ├── test_subscheck.py
    |   |       └── test_systems.py
    |   ├── pde.py
    |   ├── polysys.py
    |   ├── recurr.py
    |   ├── solvers.py
    |   ├── solveset.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_constantsimp.py
    |       ├── test_decompogen.py
    |       ├── test_inequalities.py
    |       ├── test_numeric.py
    |       ├── test_pde.py
    |       ├── test_polysys.py
    |       ├── test_recurr.py
    |       ├── test_solvers.py
    |       └── test_solveset.py
    ├── stats
    |   ├── __init__.py
    |   ├── compound_rv.py
    |   ├── crv.py
    |   ├── crv_types.py
    |   ├── drv.py
    |   ├── drv_types.py
    |   ├── error_prop.py
    |   ├── frv.py
    |   ├── frv_types.py
    |   ├── joint_rv.py
    |   ├── joint_rv_types.py
    |   ├── matrix_distributions.py
    |   ├── random_matrix.py
    |   ├── random_matrix_models.py
    |   ├── rv.py
    |   ├── rv_interface.py
    |   ├── sampling
    |   |   ├── __init__.py
    |   |   ├── sample_numpy.py
    |   |   ├── sample_pymc.py
    |   |   ├── sample_scipy.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_sample_continuous_rv.py
    |   |       ├── test_sample_discrete_rv.py
    |   |       └── test_sample_finite_rv.py
    |   ├── stochastic_process.py
    |   ├── stochastic_process_types.py
    |   ├── symbolic_multivariate_probability.py
    |   ├── symbolic_probability.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_compound_rv.py
    |       ├── test_continuous_rv.py
    |       ├── test_discrete_rv.py
    |       ├── test_error_prop.py
    |       ├── test_finite_rv.py
    |       ├── test_joint_rv.py
    |       ├── test_matrix_distributions.py
    |       ├── test_mix.py
    |       ├── test_random_matrix.py
    |       ├── test_rv.py
    |       ├── test_stochastic_process.py
    |       ├── test_symbolic_multivariate.py
    |       └── test_symbolic_probability.py
    ├── strategies
    |   ├── __init__.py
    |   ├── branch
    |   |   ├── __init__.py
    |   |   ├── core.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_core.py
    |   |   |   ├── test_tools.py
    |   |   |   └── test_traverse.py
    |   |   ├── tools.py
    |   |   └── traverse.py
    |   ├── core.py
    |   ├── rl.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_core.py
    |   |   ├── test_rl.py
    |   |   ├── test_tools.py
    |   |   ├── test_traverse.py
    |   |   └── test_tree.py
    |   ├── tools.py
    |   ├── traverse.py
    |   ├── tree.py
    |   └── util.py
    ├── tensor
    |   ├── __init__.py
    |   ├── array
    |   |   ├── __init__.py
    |   |   ├── array_comprehension.py
    |   |   ├── array_derivatives.py
    |   |   ├── arrayop.py
    |   |   ├── dense_ndim_array.py
    |   |   ├── expressions
    |   |   |   ├── __init__.py
    |   |   |   ├── array_expressions.py
    |   |   |   ├── arrayexpr_derivatives.py
    |   |   |   ├── conv_array_to_indexed.py
    |   |   |   ├── conv_array_to_matrix.py
    |   |   |   ├── conv_indexed_to_array.py
    |   |   |   ├── conv_matrix_to_array.py
    |   |   |   ├── from_array_to_indexed.py
    |   |   |   ├── from_array_to_matrix.py
    |   |   |   ├── from_indexed_to_array.py
    |   |   |   ├── from_matrix_to_array.py
    |   |   |   ├── tests
    |   |   |   └── utils.py
    |   |   ├── mutable_ndim_array.py
    |   |   ├── ndim_array.py
    |   |   ├── sparse_ndim_array.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_array_comprehension.py
    |   |       ├── test_array_derivatives.py
    |   |       ├── test_arrayop.py
    |   |       ├── test_immutable_ndim_array.py
    |   |       ├── test_mutable_ndim_array.py
    |   |       ├── test_ndim_array.py
    |   |       └── test_ndim_array_conversions.py
    |   ├── functions.py
    |   ├── index_methods.py
    |   ├── indexed.py
    |   ├── tensor.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_functions.py
    |   |   ├── test_index_methods.py
    |   |   ├── test_indexed.py
    |   |   ├── test_printing.py
    |   |   ├── test_tensor.py
    |   |   ├── test_tensor_element.py
    |   |   └── test_tensor_operators.py
    |   └── toperators.py
    ├── testing
    |   ├── __init__.py
    |   ├── matrices.py
    |   ├── pytest.py
    |   ├── quality_unicode.py
    |   ├── randtest.py
    |   ├── runtests.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── diagnose_imports.py
    |   |   ├── test_code_quality.py
    |   |   ├── test_deprecated.py
    |   |   ├── test_module_imports.py
    |   |   └── test_pytest.py
    |   └── tmpfiles.py
    ├── this.py
    ├── unify
    |   ├── __init__.py
    |   ├── core.py
    |   ├── rewrite.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_sympy.py
    |   |   └── test_unify.py
    |   └── usympy.py
    ├── utilities
    |   ├── __init__.py
    |   ├── _compilation
    |   |   ├── __init__.py
    |   |   ├── availability.py
    |   |   ├── compilation.py
    |   |   ├── runners.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── test_compilation.py
    |   |   └── util.py
    |   ├── autowrap.py
    |   ├── codegen.py
    |   ├── decorator.py
    |   ├── enumerative.py
    |   ├── exceptions.py
    |   ├── iterables.py
    |   ├── lambdify.py
    |   ├── magic.py
    |   ├── matchpy_connector.py
    |   ├── mathml
    |   |   ├── __init__.py
    |   |   └── data
    |   ├── memoization.py
    |   ├── misc.py
    |   ├── pkgdata.py
    |   ├── pytest.py
    |   ├── randtest.py
    |   ├── runtests.py
    |   ├── source.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_autowrap.py
    |   |   ├── test_codegen.py
    |   |   ├── test_codegen_julia.py
    |   |   ├── test_codegen_octave.py
    |   |   ├── test_codegen_rust.py
    |   |   ├── test_decorator.py
    |   |   ├── test_deprecated.py
    |   |   ├── test_enumerative.py
    |   |   ├── test_exceptions.py
    |   |   ├── test_iterables.py
    |   |   ├── test_lambdify.py
    |   |   ├── test_matchpy_connector.py
    |   |   ├── test_misc.py
    |   |   ├── test_pickling.py
    |   |   ├── test_source.py
    |   |   ├── test_timeutils.py
    |   |   └── test_wester.py
    |   ├── timeutils.py
    |   └── tmpfiles.py
    └── vector
        ├── __init__.py
        ├── basisdependent.py
        ├── coordsysrect.py
        ├── deloperator.py
        ├── dyadic.py
        ├── functions.py
        ├── implicitregion.py
        ├── integrals.py
        ├── operators.py
        ├── orienters.py
        ├── parametricregion.py
        ├── point.py
        ├── scalar.py
        ├── tests
        |   ├── __init__.py
        |   ├── test_coordsysrect.py
        |   ├── test_dyadic.py
        |   ├── test_field_functions.py
        |   ├── test_functions.py
        |   ├── test_implicitregion.py
        |   ├── test_integrals.py
        |   ├── test_operators.py
        |   ├── test_parametricregion.py
        |   ├── test_printing.py
        |   └── test_vector.py
        └── vector.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Rational calc value error

Description: python 3.11, sympy 1.11.1
when calc Rational('0.5', '100'), the value is 1/100100; but Rational(0.5, 100) the value is 1/200, this value is the true value, and the version of sympy 1.8 is normal

Patch information:
diff --git a/sympy/core/numbers.py b/sympy/core/numbers.py
index 52f7ea45ad..96d0bdbcc4 100644
--- a/sympy/core/numbers.py
+++ b/sympy/core/numbers.py
@@ -1625,19 +1625,26 @@ def __new__(cls, p, q=None, gcd=None):
             q = 1
             gcd = 1
 
+        # Normalize p and q to integer numerator/denominator pairs before arithmetic
         if not isinstance(p, SYMPY_INTS):
             p = Rational(p)
-            q *= p.q
-            p = p.p
+            p_num = p.p
+            p_den = p.q
         else:
-            p = int(p)
+            p_num = int(p)
+            p_den = 1
 
         if not isinstance(q, SYMPY_INTS):
             q = Rational(q)
-            p *= q.q
-            q = q.p
+            q_num = q.p
+            q_den = q.q
         else:
-            q = int(q)
+            q_num = int(q)
+            q_den = 1
+
+        # Compute p/q as (p_num/p_den) / (q_num/q_den) = (p_num*q_den)/(p_den*q_num)
+        p = p_num * q_den
+        q = p_den * q_num
 
         # p and q are now ints
         if q == 0:


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of the file `sympy/core/tests/test_numbers.py`.
Extra Requirements: 
Purpose: I need to analyze the tests for the `Rational` class to find existing test cases that are relevant to the described bug.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: sympy/core/tests/test_numbers.py
Line number range: 1 - 2227
Content:
1. import numbers as nums
2. import decimal
3. from sympy.concrete.summations import Sum
4. from sympy.core import (EulerGamma, Catalan, TribonacciConstant,
5.     GoldenRatio)
6. from sympy.core.containers import Tuple
7. from sympy.core.expr import unchanged
8. from sympy.core.logic import fuzzy_not
9. from sympy.core.mul import Mul
10. from sympy.core.numbers import (mpf_norm, mod_inverse, igcd, seterr,
11.     igcd_lehmer, Integer, I, pi, comp, ilcm, Rational, E, nan, igcd2,
12.     oo, AlgebraicNumber, igcdex, Number, Float, zoo)
13. from sympy.core.power import Pow
14. from sympy.core.relational import Ge, Gt, Le, Lt
15. from sympy.core.singleton import S
16. from sympy.core.symbol import Dummy, Symbol
17. from sympy.core.sympify import sympify
18. from sympy.functions.combinatorial.factorials import factorial
19. from sympy.functions.elementary.integers import floor
20. from sympy.functions.combinatorial.numbers import fibonacci
21. from sympy.functions.elementary.exponential import exp, log
22. from sympy.functions.elementary.miscellaneous import sqrt, cbrt
23. from sympy.functions.elementary.trigonometric import cos, sin
24. from sympy.polys.domains.realfield import RealField
25. from sympy.printing.latex import latex
26. from sympy.printing.repr import srepr
27. from sympy.simplify import simplify
28. from sympy.core.power import integer_nthroot, isqrt, integer_log
29. from sympy.polys.domains.groundtypes import PythonRational
30. from sympy.utilities.decorator import conserve_mpmath_dps
31. from sympy.utilities.iterables import permutations
32. from sympy.testing.pytest import XFAIL, raises, _both_exp_pow
33. 
34. from mpmath import mpf
35. from mpmath.rational import mpq
36. import mpmath
37. from sympy.core import numbers
38. t = Symbol('t', real=False)
39. 
40. _ninf = float(-oo)
41. _inf = float(oo)
42. 
43. 
44. def same_and_same_prec(a, b):
45.     # stricter matching for Floats
46.     return a == b and a._prec == b._prec
47. 
48. 
49. def test_seterr():
50.     seterr(divide=True)
51.     raises(ValueError, lambda: S.Zero/S.Zero)
52.     seterr(divide=False)
53.     assert S.Zero / S.Zero is S.NaN
54. 
55. 
56. def test_mod():
57.     x = S.Half
58.     y = Rational(3, 4)
59.     z = Rational(5, 18043)
60. 
61.     assert x % x == 0
62.     assert x % y == S.Half
63.     assert x % z == Rational(3, 36086)
64.     assert y % x == Rational(1, 4)
65.     assert y % y == 0
66.     assert y % z == Rational(9, 72172)
67.     assert z % x == Rational(5, 18043)
68.     assert z % y == Rational(5, 18043)
69.     assert z % z == 0
70. 
71.     a = Float(2.6)
72. 
73.     assert (a % .2) == 0.0
74.     assert (a % 2).round(15) == 0.6
75.     assert (a % 0.5).round(15) == 0.1
76. 
77.     p = Symbol('p', infinite=True)
78. 
79.     assert oo % oo is nan
80.     assert zoo % oo is nan
81.     assert 5 % oo is nan
82.     assert p % 5 is nan
83. 
84.     # In these two tests, if the precision of m does
85.     # not match the precision of the ans, then it is
86.     # likely that the change made now gives an answer
87.     # with degraded accuracy.
88.     r = Rational(500, 41)
89.     f = Float('.36', 3)
90.     m = r % f
91.     ans = Float(r % Rational(f), 3)
92.     assert m == ans and m._prec == ans._prec
93.     f = Float('8.36', 3)
94.     m = f % r
95.     ans = Float(Rational(f) % r, 3)
96.     assert m == ans and m._prec == ans._prec
97. 
98.     s = S.Zero
99. 
100.     assert s % float(1) == 0.0
101. 
102.     # No rounding required since these numbers can be represented
103.     # exactly.
104.     assert Rational(3, 4) % Float(1.1) == 0.75
105.     assert Float(1.5) % Rational(5, 4) == 0.25
106.     assert Rational(5, 4).__rmod__(Float('1.5')) == 0.25
107.     assert Float('1.5').__rmod__(Float('2.75')) == Float('1.25')
108.     assert 2.75 % Float('1.5') == Float('1.25')
109. 
110.     a = Integer(7)
111.     b = Integer(4)
112. 
113.     assert type(a % b) == Integer
114.     assert a % b == Integer(3)
115.     assert Integer(1) % Rational(2, 3) == Rational(1, 3)
116.     assert Rational(7, 5) % Integer(1) == Rational(2, 5)
117.     assert Integer(2) % 1.5 == 0.5
118. 
119.     assert Integer(3).__rmod__(Integer(10)) == Integer(1)
120.     assert Integer(10) % 4 == Integer(2)
121.     assert 15 % Integer(4) == Integer(3)
122. 
123. 
124. def test_divmod():
125.     x = Symbol("x")
126.     assert divmod(S(12), S(8)) == Tuple(1, 4)
127.     assert divmod(-S(12), S(8)) == Tuple(-2, 4)
128.     assert divmod(S.Zero, S.One) == Tuple(0, 0)
129.     raises(ZeroDivisionError, lambda: divmod(S.Zero, S.Zero))
130.     raises(ZeroDivisionError, lambda: divmod(S.One, S.Zero))
131.     assert divmod(S(12), 8) == Tuple(1, 4)
132.     assert divmod(12, S(8)) == Tuple(1, 4)
133.     assert S(1024)//x == 1024//x == floor(1024/x)
134. 
135.     assert divmod(S("2"), S("3/2")) == Tuple(S("1"), S("1/2"))
136.     assert divmod(S("3/2"), S("2")) == Tuple(S("0"), S("3/2"))
137.     assert divmod(S("2"), S("3.5")) == Tuple(S("0"), S("2"))
138.     assert divmod(S("3.5"), S("2")) == Tuple(S("1"), S("1.5"))
139.     assert divmod(S("2"), S("1/3")) == Tuple(S("6"), S("0"))
140.     assert divmod(S("1/3"), S("2")) == Tuple(S("0"), S("1/3"))
141.     assert divmod(S("2"), S("1/10")) == Tuple(S("20"), S("0"))
142.     assert divmod(S("2"), S(".1"))[0] == 19
143.     assert divmod(S("0.1"), S("2")) == Tuple(S("0"), S("0.1"))
144.     assert divmod(S("2"), 2) == Tuple(S("1"), S("0"))
145.     assert divmod(2, S("2")) == Tuple(S("1"), S("0"))
146.     assert divmod(S("2"), 1.5) == Tuple(S("1"), S("0.5"))
147.     assert divmod(1.5, S("2")) == Tuple(S("0"), S("1.5"))
148.     assert divmod(0.3, S("2")) == Tuple(S("0"), S("0.3"))
149.     assert divmod(S("3/2"), S("3.5")) == Tuple(S("0"), S("3/2"))
150.     assert divmod(S("3.5"), S("3/2")) == Tuple(S("2"), S("0.5"))
151.     assert divmod(S("3/2"), S("1/3")) == Tuple(S("4"), S("1/6"))
152.     assert divmod(S("1/3"), S("3/2")) == Tuple(S("0"), S("1/3"))
153.     assert divmod(S("3/2"), S("0.1"))[0] == 14
154.     assert divmod(S("0.1"), S("3/2")) == Tuple(S("0"), S("0.1"))
155.     assert divmod(S("3/2"), 2) == Tuple(S("0"), S("3/2"))
156.     assert divmod(2, S("3/2")) == Tuple(S("1"), S("1/2"))
157.     assert divmod(S("3/2"), 1.5) == Tuple(S("1"), S("0"))
158.     assert divmod(1.5, S("3/2")) == Tuple(S("1"), S("0"))
159.     assert divmod(S("3/2"), 0.3) == Tuple(S("5"), S("0"))
160.     assert divmod(0.3, S("3/2")) == Tuple(S("0"), S("0.3"))
161.     assert divmod(S("1/3"), S("3.5")) == Tuple(S("0"), S("1/3"))
162.     assert divmod(S("3.5"), S("0.1")) == Tuple(S("35"), S("0"))
163.     assert divmod(S("0.1"), S("3.5")) == Tuple(S("0"), S("0.1"))
164.     assert divmod(S("3.5"), 2) == Tuple(S("1"), S("1.5"))
165.     assert divmod(2, S("3.5")) == Tuple(S("0"), S("2"))
166.     assert divmod(S("3.5"), 1.5) == Tuple(S("2"), S("0.5"))
167.     assert divmod(1.5, S("3.5")) == Tuple(S("0"), S("1.5"))
168.     assert divmod(0.3, S("3.5")) == Tuple(S("0"), S("0.3"))
169.     assert divmod(S("0.1"), S("1/3")) == Tuple(S("0"), S("0.1"))
170.     assert divmod(S("1/3"), 2) == Tuple(S("0"), S("1/3"))
171.     assert divmod(2, S("1/3")) == Tuple(S("6"), S("0"))
172.     assert divmod(S("1/3"), 1.5) == Tuple(S("0"), S("1/3"))
173.     assert divmod(0.3, S("1/3")) == Tuple(S("0"), S("0.3"))
174.     assert divmod(S("0.1"), 2) == Tuple(S("0"), S("0.1"))
175.     assert divmod(2, S("0.1"))[0] == 19
176.     assert divmod(S("0.1"), 1.5) == Tuple(S("0"), S("0.1"))
177.     assert divmod(1.5, S("0.1")) == Tuple(S("15"), S("0"))
178.     assert divmod(S("0.1"), 0.3) == Tuple(S("0"), S("0.1"))
179. 
180.     assert str(divmod(S("2"), 0.3)) == '(6, 0.2)'
181.     assert str(divmod(S("3.5"), S("1/3"))) == '(10, 0.166666666666667)'
182.     assert str(divmod(S("3.5"), 0.3)) == '(11, 0.2)'
183.     assert str(divmod(S("1/3"), S("0.1"))) == '(3, 0.0333333333333333)'
184.     assert str(divmod(1.5, S("1/3"))) == '(4, 0.166666666666667)'
185.     assert str(divmod(S("1/3"), 0.3)) == '(1, 0.0333333333333333)'
186.     assert str(divmod(0.3, S("0.1"))) == '(2, 0.1)'
187. 
188.     assert divmod(-3, S(2)) == (-2, 1)
189.     assert divmod(S(-3), S(2)) == (-2, 1)
190.     assert divmod(S(-3), 2) == (-2, 1)
191. 
192.     assert divmod(S(4), S(-3.1)) == Tuple(-2, -2.2)
193.     assert divmod(S(4), S(-2.1)) == divmod(4, -2.1)
194.     assert divmod(S(-8), S(-2.5) ) == Tuple(3, -0.5)
195. 
196.     assert divmod(oo, 1) == (S.NaN, S.NaN)
197.     assert divmod(S.NaN, 1) == (S.NaN, S.NaN)
198.     assert divmod(1, S.NaN) == (S.NaN, S.NaN)
199.     ans = [(-1, oo), (-1, oo), (0, 0), (0, 1), (0, 2)]
200.     OO = float('inf')
201.     ANS = [tuple(map(float, i)) for i in ans]
202.     assert [divmod(i, oo) for i in range(-2, 3)] == ans
203.     ans = [(0, -2), (0, -1), (0, 0), (-1, -oo), (-1, -oo)]
204.     ANS = [tuple(map(float, i)) for i in ans]
205.     assert [divmod(i, -oo) for i in range(-2, 3)] == ans
206.     assert [divmod(i, -OO) for i in range(-2, 3)] == ANS
207.     assert divmod(S(3.5), S(-2)) == divmod(3.5, -2)
208.     assert divmod(-S(3.5), S(-2)) == divmod(-3.5, -2)
209.     assert divmod(S(0.0), S(9)) == divmod(0.0, 9)
210.     assert divmod(S(0), S(9.0)) == divmod(0, 9.0)
211. 
212. 
213. def test_igcd():
214.     assert igcd(0, 0) == 0
215.     assert igcd(0, 1) == 1
216.     assert igcd(1, 0) == 1
217.     assert igcd(0, 7) == 7
218.     assert igcd(7, 0) == 7
219.     assert igcd(7, 1) == 1
220.     assert igcd(1, 7) == 1
221.     assert igcd(-1, 0) == 1
222.     assert igcd(0, -1) == 1
223.     assert igcd(-1, -1) == 1
224.     assert igcd(-1, 7) == 1
225.     assert igcd(7, -1) == 1
226.     assert igcd(8, 2) == 2
227.     assert igcd(4, 8) == 4
228.     assert igcd(8, 16) == 8
229.     assert igcd(7, -3) == 1
230.     assert igcd(-7, 3) == 1
231.     assert igcd(-7, -3) == 1
232.     assert igcd(*[10, 20, 30]) == 10
233.     raises(TypeError, lambda: igcd())
234.     raises(TypeError, lambda: igcd(2))
235.     raises(ValueError, lambda: igcd(0, None))
236.     raises(ValueError, lambda: igcd(1, 2.2))
237.     for args in permutations((45.1, 1, 30)):
238.         raises(ValueError, lambda: igcd(*args))
239.     for args in permutations((1, 2, None)):
240.         raises(ValueError, lambda: igcd(*args))
241. 
242. 
243. def test_igcd_lehmer():
244.     a, b = fibonacci(10001), fibonacci(10000)
245.     # len(str(a)) == 2090
246.     # small divisors, long Euclidean sequence
247.     assert igcd_lehmer(a, b) == 1
248.     c = fibonacci(100)
249.     assert igcd_lehmer(a*c, b*c) == c
250.     # big divisor
251.     assert igcd_lehmer(a, 10**1000) == 1
252.     # swapping argument
253.     assert igcd_lehmer(1, 2) == igcd_lehmer(2, 1)
254. 
255. 
256. def test_igcd2():
257.     # short loop
258.     assert igcd2(2**100 - 1, 2**99 - 1) == 1
259.     # Lehmer's algorithm
260.     a, b = int(fibonacci(10001)), int(fibonacci(10000))
261.     assert igcd2(a, b) == 1
262. 
263. 
264. def test_ilcm():
265.     assert ilcm(0, 0) == 0
266.     assert ilcm(1, 0) == 0
267.     assert ilcm(0, 1) == 0
268.     assert ilcm(1, 1) == 1
269.     assert ilcm(2, 1) == 2
270.     assert ilcm(8, 2) == 8
271.     assert ilcm(8, 6) == 24
272.     assert ilcm(8, 7) == 56
273.     assert ilcm(*[10, 20, 30]) == 60
274.     raises(ValueError, lambda: ilcm(8.1, 7))
275.     raises(ValueError, lambda: ilcm(8, 7.1))
276.     raises(TypeError, lambda: ilcm(8))
277. 
278. 
279. def test_igcdex():
280.     assert igcdex(2, 3) == (-1, 1, 1)
281.     assert igcdex(10, 12) == (-1, 1, 2)
282.     assert igcdex(100, 2004) == (-20, 1, 4)
283.     assert igcdex(0, 0) == (0, 1, 0)
284.     assert igcdex(1, 0) == (1, 0, 1)
285. 
286. 
287. def _strictly_equal(a, b):
288.     return (a.p, a.q, type(a.p), type(a.q)) == \
289.            (b.p, b.q, type(b.p), type(b.q))
290. 
291. 
292. def _test_rational_new(cls):
293.     """
294.     Tests that are common between Integer and Rational.
295.     """
296.     assert cls(0) is S.Zero
297.     assert cls(1) is S.One
298.     assert cls(-1) is S.NegativeOne
299.     # These look odd, but are similar to int():
300.     assert cls('1') is S.One
301.     assert cls('-1') is S.NegativeOne
302. 
303.     i = Integer(10)
304.     assert _strictly_equal(i, cls('10'))
305.     assert _strictly_equal(i, cls('10'))
306.     assert _strictly_equal(i, cls(int(10)))
307.     assert _strictly_equal(i, cls(i))
308. 
309.     raises(TypeError, lambda: cls(Symbol('x')))
310. 
311. 
312. def test_Integer_new():
313.     """
314.     Test for Integer constructor
315.     """
316.     _test_rational_new(Integer)
317. 
318.     assert _strictly_equal(Integer(0.9), S.Zero)
319.     assert _strictly_equal(Integer(10.5), Integer(10))
320.     raises(ValueError, lambda: Integer("10.5"))
321.     assert Integer(Rational('1.' + '9'*20)) == 1
322. 
323. 
324. def test_Rational_new():
325.     """"
326.     Test for Rational constructor
327.     """
328.     _test_rational_new(Rational)
329. 
330.     n1 = S.Half
331.     assert n1 == Rational(Integer(1), 2)
332.     assert n1 == Rational(Integer(1), Integer(2))
333.     assert n1 == Rational(1, Integer(2))
334.     assert n1 == Rational(S.Half)
335.     assert 1 == Rational(n1, n1)
336.     assert Rational(3, 2) == Rational(S.Half, Rational(1, 3))
337.     assert Rational(3, 1) == Rational(1, Rational(1, 3))
338.     n3_4 = Rational(3, 4)
339.     assert Rational('3/4') == n3_4
340.     assert -Rational('-3/4') == n3_4
341.     assert Rational('.76').limit_denominator(4) == n3_4
342.     assert Rational(19, 25).limit_denominator(4) == n3_4
343.     assert Rational('19/25').limit_denominator(4) == n3_4
344.     assert Rational(1.0, 3) == Rational(1, 3)
345.     assert Rational(1, 3.0) == Rational(1, 3)
346.     assert Rational(Float(0.5)) == S.Half
347.     assert Rational('1e2/1e-2') == Rational(10000)
348.     assert Rational('1 234') == Rational(1234)
349.     assert Rational('1/1 234') == Rational(1, 1234)
350.     assert Rational(-1, 0) is S.ComplexInfinity
351.     assert Rational(1, 0) is S.ComplexInfinity
352.     # Make sure Rational doesn't lose precision on Floats
353.     assert Rational(pi.evalf(100)).evalf(100) == pi.evalf(100)
354.     raises(TypeError, lambda: Rational('3**3'))
355.     raises(TypeError, lambda: Rational('1/2 + 2/3'))
356. 
357.     # handle fractions.Fraction instances
358.     try:
359.         import fractions
360.         assert Rational(fractions.Fraction(1, 2)) == S.Half
361.     except ImportError:
362.         pass
363. 
364.     assert Rational(mpq(2, 6)) == Rational(1, 3)
365.     assert Rational(PythonRational(2, 6)) == Rational(1, 3)
366. 
367.     assert Rational(2, 4, gcd=1).q == 4
368.     n = Rational(2, -4, gcd=1)
369.     assert n.q == 4
370.     assert n.p == -2
371. 
372. 
373. def test_Number_new():
374.     """"
375.     Test for Number constructor
376.     """
377.     # Expected behavior on numbers and strings
378.     assert Number(1) is S.One
379.     assert Number(2).__class__ is Integer
380.     assert Number(-622).__class__ is Integer
381.     assert Number(5, 3).__class__ is Rational
382.     assert Number(5.3).__class__ is Float
383.     assert Number('1') is S.One
384.     assert Number('2').__class__ is Integer
385.     assert Number('-622').__class__ is Integer
386.     assert Number('5/3').__class__ is Rational
387.     assert Number('5.3').__class__ is Float
388.     raises(ValueError, lambda: Number('cos'))
389.     raises(TypeError, lambda: Number(cos))
390.     a = Rational(3, 5)
391.     assert Number(a) is a  # Check idempotence on Numbers
392.     u = ['inf', '-inf', 'nan', 'iNF', '+inf']
393.     v = [oo, -oo, nan, oo, oo]
394.     for i, a in zip(u, v):
395.         assert Number(i) is a, (i, Number(i), a)
396. 
397. 
398. def test_Number_cmp():
399.     n1 = Number(1)
400.     n2 = Number(2)
401.     n3 = Number(-3)
402. 
403.     assert n1 < n2
404.     assert n1 <= n2
405.     assert n3 < n1
406.     assert n2 > n3
407.     assert n2 >= n3
408. 
409.     raises(TypeError, lambda: n1 < S.NaN)
410.     raises(TypeError, lambda: n1 <= S.NaN)
411.     raises(TypeError, lambda: n1 > S.NaN)
412.     raises(TypeError, lambda: n1 >= S.NaN)
413. 
414. 
415. def test_Rational_cmp():
416.     n1 = Rational(1, 4)
417.     n2 = Rational(1, 3)
418.     n3 = Rational(2, 4)
419.     n4 = Rational(2, -4)
420.     n5 = Rational(0)
421.     n6 = Rational(1)
422.     n7 = Rational(3)
423.     n8 = Rational(-3)
424. 
425.     assert n8 < n5
426.     assert n5 < n6
427.     assert n6 < n7
428.     assert n8 < n7
429.     assert n7 > n8
430.     assert (n1 + 1)**n2 < 2
431.     assert ((n1 + n6)/n7) < 1
432. 
433.     assert n4 < n3
434.     assert n2 < n3
435.     assert n1 < n2
436.     assert n3 > n1
437.     assert not n3 < n1
438.     assert not (Rational(-1) > 0)
439.     assert Rational(-1) < 0
440. 
441.     raises(TypeError, lambda: n1 < S.NaN)
442.     raises(TypeError, lambda: n1 <= S.NaN)
443.     raises(TypeError, lambda: n1 > S.NaN)
444.     raises(TypeError, lambda: n1 >= S.NaN)
445. 
446. 
447. def test_Float():
448.     def eq(a, b):
449.         t = Float("1.0E-15")
450.         return (-t < a - b < t)
451. 
452.     zeros = (0, S.Zero, 0., Float(0))
453.     for i, j in permutations(zeros, 2):
454.         assert i == j
455.     for z in zeros:
456.         assert z in zeros
457.     assert S.Zero.is_zero
458. 
459.     a = Float(2) ** Float(3)
460.     assert eq(a.evalf(), Float(8))
461.     assert eq((pi ** -1).evalf(), Float("0.31830988618379067"))
462.     a = Float(2) ** Float(4)
463.     assert eq(a.evalf(), Float(16))
464.     assert (S(.3) == S(.5)) is False
465. 
466.     mpf = (0, 5404319552844595, -52, 53)
467.     x_str = Float((0, '13333333333333', -52, 53))
468.     x_0xstr = Float((0, '0x13333333333333', -52, 53))
469.     x2_str = Float((0, '26666666666666', -53, 54))
470.     x_hex = Float((0, int(0x13333333333333), -52, 53))
471.     x_dec = Float(mpf)
472.     assert x_str == x_0xstr == x_hex == x_dec == Float(1.2)
473.     # x2_str was entered slightly malformed in that the mantissa
474.     # was even -- it should be odd and the even part should be
475.     # included with the exponent, but this is resolved by normalization
476.     # ONLY IF REQUIREMENTS of mpf_norm are met: the bitcount must
477.     # be exact: double the mantissa ==> increase bc by 1
478.     assert Float(1.2)._mpf_ == mpf
479.     assert x2_str._mpf_ == mpf
480. 
481.     assert Float((0, int(0), -123, -1)) is S.NaN
482.     assert Float((0, int(0), -456, -2)) is S.Infinity
483.     assert Float((1, int(0), -789, -3)) is S.NegativeInfinity
484.     # if you don't give the full signature, it's not special
485.     assert Float((0, int(0), -123)) == Float(0)
486.     assert Float((0, int(0), -456)) == Float(0)
487.     assert Float((1, int(0), -789)) == Float(0)
488. 
489.     raises(ValueError, lambda: Float((0, 7, 1, 3), ''))
490. 
491.     assert Float('0.0').is_finite is True
492.     assert Float('0.0').is_negative is False
493.     assert Float('0.0').is_positive is False
494.     assert Float('0.0').is_infinite is False
495.     assert Float('0.0').is_zero is True
496. 
497.     # rationality properties
498.     # if the integer test fails then the use of intlike
499.     # should be removed from gamma_functions.py
500.     assert Float(1).is_integer is False
501.     assert Float(1).is_rational is None
502.     assert Float(1).is_irrational is None
503.     assert sqrt(2).n(15).is_rational is None
504.     assert sqrt(2).n(15).is_irrational is None
505. 
506.     # do not automatically evalf
507.     def teq(a):
508.         assert (a.evalf() == a) is False
509.         assert (a.evalf() != a) is True
510.         assert (a == a.evalf()) is False
511.         assert (a != a.evalf()) is True
512. 
513.     teq(pi)
514.     teq(2*pi)
515.     teq(cos(0.1, evaluate=False))
516. 
517.     # long integer
518.     i = 12345678901234567890
519.     assert same_and_same_prec(Float(12, ''), Float('12', ''))
520.     assert same_and_same_prec(Float(Integer(i), ''), Float(i, ''))
521.     assert same_and_same_prec(Float(i, ''), Float(str(i), 20))
522.     assert same_and_same_prec(Float(str(i)), Float(i, ''))
523.     assert same_and_same_prec(Float(i), Float(i, ''))
524. 
525.     # inexact floats (repeating binary = denom not multiple of 2)
526.     # cannot have precision greater than 15
527.     assert Float(.125, 22) == .125
528.     assert Float(2.0, 22) == 2
529.     assert float(Float('.12500000000000001', '')) == .125
530.     raises(ValueError, lambda: Float(.12500000000000001, ''))
531. 
532.     # allow spaces
533.     assert Float('123 456.123 456') == Float('123456.123456')
534.     assert Integer('123 456') == Integer('123456')
535.     assert Rational('123 456.123 456') == Rational('123456.123456')
536.     assert Float(' .3e2') == Float('0.3e2')
537. 
538.     # allow underscore
539.     assert Float('1_23.4_56') == Float('123.456')
540.     assert Float('1_') == Float('1.0')
541.     assert Float('1_.') == Float('1.0')
542.     assert Float('1._') == Float('1.0')
543.     assert Float('1__2') == Float('12.0')
544.     # assert Float('1_23.4_5_6', 12) == Float('123.456', 12)
545.     # ...but not in all cases (per Py 3.6)
546.     raises(ValueError, lambda: Float('_1'))
547.     raises(ValueError, lambda: Float('_inf'))
548. 
549.     # allow auto precision detection
550.     assert Float('.1', '') == Float(.1, 1)
551.     assert Float('.125', '') == Float(.125, 3)
552.     assert Float('.100', '') == Float(.1, 3)
553.     assert Float('2.0', '') == Float('2', 2)
554. 
555.     raises(ValueError, lambda: Float("12.3d-4", ""))
556.     raises(ValueError, lambda: Float(12.3, ""))
557.     raises(ValueError, lambda: Float('.'))
558.     raises(ValueError, lambda: Float('-.'))
559. 
560.     zero = Float('0.0')
561.     assert Float('-0') == zero
562.     assert Float('.0') == zero
563.     assert Float('-.0') == zero
564.     assert Float('-0.0') == zero
565.     assert Float(0.0) == zero
566.     assert Float(0) == zero
567.     assert Float(0, '') == Float('0', '')
568.     assert Float(1) == Float(1.0)
569.     assert Float(S.Zero) == zero
570.     assert Float(S.One) == Float(1.0)
571. 
572.     assert Float(decimal.Decimal('0.1'), 3) == Float('.1', 3)
573.     assert Float(decimal.Decimal('nan')) is S.NaN
574.     assert Float(decimal.Decimal('Infinity')) is S.Infinity
575.     assert Float(decimal.Decimal('-Infinity')) is S.NegativeInfinity
576. 
577.     assert '{:.3f}'.format(Float(4.236622)) == '4.237'
578.     assert '{:.35f}'.format(Float(pi.n(40), 40)) == \
579.         '3.14159265358979323846264338327950288'
580. 
581.     # unicode
582.     assert Float('0.73908513321516064100000000') == \
583.         Float('0.73908513321516064100000000')
584.     assert Float('0.73908513321516064100000000', 28) == \
585.         Float('0.73908513321516064100000000', 28)
586. 
587.     # binary precision
588.     # Decimal value 0.1 cannot be expressed precisely as a base 2 fraction
589.     a = Float(S.One/10, dps=15)
590.     b = Float(S.One/10, dps=16)
591.     p = Float(S.One/10, precision=53)
592.     q = Float(S.One/10, precision=54)
593.     assert a._mpf_ == p._mpf_
594.     assert not a._mpf_ == q._mpf_
595.     assert not b._mpf_ == q._mpf_
596. 
597.     # Precision specifying errors
598.     raises(ValueError, lambda: Float("1.23", dps=3, precision=10))
599.     raises(ValueError, lambda: Float("1.23", dps="", precision=10))
600.     raises(ValueError, lambda: Float("1.23", dps=3, precision=""))
601.     raises(ValueError, lambda: Float("1.23", dps="", precision=""))
602. 
603.     # from NumberSymbol
604.     assert same_and_same_prec(Float(pi, 32), pi.evalf(32))
605.     assert same_and_same_prec(Float(Catalan), Catalan.evalf())
606. 
607.     # oo and nan
608.     u = ['inf', '-inf', 'nan', 'iNF', '+inf']
609.     v = [oo, -oo, nan, oo, oo]
610.     for i, a in zip(u, v):
611.         assert Float(i) is a
612. 
613. 
614. def test_zero_not_false():
615.     # https://github.com/sympy/sympy/issues/20796
616.     assert (S(0.0) == S.false) is False
617.     assert (S.false == S(0.0)) is False
618.     assert (S(0) == S.false) is False
619.     assert (S.false == S(0)) is False
620. 
621. 
622. @conserve_mpmath_dps
623. def test_float_mpf():
624.     import mpmath
625.     mpmath.mp.dps = 100
626.     mp_pi = mpmath.pi()
627. 
628.     assert Float(mp_pi, 100) == Float(mp_pi._mpf_, 100) == pi.evalf(100)
629. 
630.     mpmath.mp.dps = 15
631. 
632.     assert Float(mp_pi, 100) == Float(mp_pi._mpf_, 100) == pi.evalf(100)
633. 
634. 
635. def test_Float_RealElement():
636.     repi = RealField(dps=100)(pi.evalf(100))
637.     # We still have to pass the precision because Float doesn't know what
638.     # RealElement is, but make sure it keeps full precision from the result.
639.     assert Float(repi, 100) == pi.evalf(100)
640. 
641. 
642. def test_Float_default_to_highprec_from_str():
643.     s = str(pi.evalf(128))
644.     assert same_and_same_prec(Float(s), Float(s, ''))
645. 
646. 
647. def test_Float_eval():
648.     a = Float(3.2)
649.     assert (a**2).is_Float
650. 
651. 
652. def test_Float_issue_2107():
653.     a = Float(0.1, 10)
654.     b = Float("0.1", 10)
655. 
656.     assert a - a == 0
657.     assert a + (-a) == 0
658.     assert S.Zero + a - a == 0
659.     assert S.Zero + a + (-a) == 0
660. 
661.     assert b - b == 0
662.     assert b + (-b) == 0
663.     assert S.Zero + b - b == 0
664.     assert S.Zero + b + (-b) == 0
665. 
666. 
667. def test_issue_14289():
668.     from sympy.polys.numberfields import to_number_field
669. 
670.     a = 1 - sqrt(2)
671.     b = to_number_field(a)
672.     assert b.as_expr() == a
673.     assert b.minpoly(a).expand() == 0
674. 
675. 
676. def test_Float_from_tuple():
677.     a = Float((0, '1L', 0, 1))
678.     b = Float((0, '1', 0, 1))
679.     assert a == b
680. 
681. 
682. def test_Infinity():
683.     assert oo != 1
684.     assert 1*oo is oo
685.     assert 1 != oo
686.     assert oo != -oo
687.     assert oo != Symbol("x")**3
688.     assert oo + 1 is oo
689.     assert 2 + oo is oo
690.     assert 3*oo + 2 is oo
691.     assert S.Half**oo == 0
692.     assert S.Half**(-oo) is oo
693.     assert -oo*3 is -oo
694.     assert oo + oo is oo
695.     assert -oo + oo*(-5) is -oo
696.     assert 1/oo == 0
697.     assert 1/(-oo) == 0
698.     assert 8/oo == 0
699.     assert oo % 2 is nan
700.     assert 2 % oo is nan
701.     assert oo/oo is nan
702.     assert oo/-oo is nan
703.     assert -oo/oo is nan
704.     assert -oo/-oo is nan
705.     assert oo - oo is nan
706.     assert oo - -oo is oo
707.     assert -oo - oo is -oo
708.     assert -oo - -oo is nan
709.     assert oo + -oo is nan
710.     assert -oo + oo is nan
711.     assert oo + oo is oo
712.     assert -oo + oo is nan
713.     assert oo + -oo is nan
714.     assert -oo + -oo is -oo
715.     assert oo*oo is oo
716.     assert -oo*oo is -oo
717.     assert oo*-oo is -oo
718.     assert -oo*-oo is oo
719.     assert oo/0 is oo
720.     assert -oo/0 is -oo
721.     assert 0/oo == 0
722.     assert 0/-oo == 0
723.     assert oo*0 is nan
724.     assert -oo*0 is nan
725.     assert 0*oo is nan
726.     assert 0*-oo is nan
727.     assert oo + 0 is oo
728.     assert -oo + 0 is -oo
729.     assert 0 + oo is oo
730.     assert 0 + -oo is -oo
731.     assert oo - 0 is oo
732.     assert -oo - 0 is -oo
733.     assert 0 - oo is -oo
734.     assert 0 - -oo is oo
735.     assert oo/2 is oo
736.     assert -oo/2 is -oo
737.     assert oo/-2 is -oo
738.     assert -oo/-2 is oo
739.     assert oo*2 is oo
740.     assert -oo*2 is -oo
741.     assert oo*-2 is -oo
742.     assert 2/oo == 0
743.     assert 2/-oo == 0
744.     assert -2/oo == 0
745.     assert -2/-oo == 0
746.     assert 2*oo is oo
747.     assert 2*-oo is -oo
748.     assert -2*oo is -oo
749.     assert -2*-oo is oo
750.     assert 2 + oo is oo
751.     assert 2 - oo is -oo
752.     assert -2 + oo is oo
753.     assert -2 - oo is -oo
754.     assert 2 + -oo is -oo
755.     assert 2 - -oo is oo
756.     assert -2 + -oo is -oo
757.     assert -2 - -oo is oo
758.     assert S(2) + oo is oo
759.     assert S(2) - oo is -oo
760.     assert oo/I == -oo*I
761.     assert -oo/I == oo*I
762.     assert oo*float(1) == _inf and (oo*float(1)) is oo
763.     assert -oo*float(1) == _ninf and (-oo*float(1)) is -oo
764.     assert oo/float(1) == _inf and (oo/float(1)) is oo
765.     assert -oo/float(1) == _ninf and (-oo/float(1)) is -oo
766.     assert oo*float(-1) == _ninf and (oo*float(-1)) is -oo
767.     assert -oo*float(-1) == _inf and (-oo*float(-1)) is oo
768.     assert oo/float(-1) == _ninf and (oo/float(-1)) is -oo
769.     assert -oo/float(-1) == _inf and (-oo/float(-1)) is oo
770.     assert oo + float(1) == _inf and (oo + float(1)) is oo
771.     assert -oo + float(1) == _ninf and (-oo + float(1)) is -oo
772.     assert oo - float(1) == _inf and (oo - float(1)) is oo
773.     assert -oo - float(1) == _ninf and (-oo - float(1)) is -oo
774.     assert float(1)*oo == _inf and (float(1)*oo) is oo
775.     assert float(1)*-oo == _ninf and (float(1)*-oo) is -oo
776.     assert float(1)/oo == 0
777.     assert float(1)/-oo == 0
778.     assert float(-1)*oo == _ninf and (float(-1)*oo) is -oo
779.     assert float(-1)*-oo == _inf and (float(-1)*-oo) is oo
780.     assert float(-1)/oo == 0
781.     assert float(-1)/-oo == 0
782.     assert float(1) + oo is oo
783.     assert float(1) + -oo is -oo
784.     assert float(1) - oo is -oo
785.     assert float(1) - -oo is oo
786.     assert oo == float(oo)
787.     assert (oo != float(oo)) is False
788.     assert type(float(oo)) is float
789.     assert -oo == float(-oo)
790.     assert (-oo != float(-oo)) is False
791.     assert type(float(-oo)) is float
792. 
793.     assert Float('nan') is nan
794.     assert nan*1.0 is nan
795.     assert -1.0*nan is nan
796.     assert nan*oo is nan
797.     assert nan*-oo is nan
798.     assert nan/oo is nan
799.     assert nan/-oo is nan
800.     assert nan + oo is nan
801.     assert nan + -oo is nan
802.     assert nan - oo is nan
803.     assert nan - -oo is nan
804.     assert -oo * S.Zero is nan
805. 
806.     assert oo*nan is nan
807.     assert -oo*nan is nan
808.     assert oo/nan is nan
809.     assert -oo/nan is nan
810.     assert oo + nan is nan
811.     assert -oo + nan is nan
812.     assert oo - nan is nan
813.     assert -oo - nan is nan
814.     assert S.Zero * oo is nan
815.     assert oo.is_Rational is False
816.     assert isinstance(oo, Rational) is False
817. 
818.     assert S.One/oo == 0
819.     assert -S.One/oo == 0
820.     assert S.One/-oo == 0
821.     assert -S.One/-oo == 0
822.     assert S.One*oo is oo
823.     assert -S.One*oo is -oo
824.     assert S.One*-oo is -oo
825.     assert -S.One*-oo is oo
826.     assert S.One/nan is nan
827.     assert S.One - -oo is oo
828.     assert S.One + nan is nan
829.     assert S.One - nan is nan
830.     assert nan - S.One is nan
831.     assert nan/S.One is nan
832.     assert -oo - S.One is -oo
833. 
834. 
835. def test_Infinity_2():
836.     x = Symbol('x')
837.     assert oo*x != oo
838.     assert oo*(pi - 1) is oo
839.     assert oo*(1 - pi) is -oo
840. 
841.     assert (-oo)*x != -oo
842.     assert (-oo)*(pi - 1) is -oo
843.     assert (-oo)*(1 - pi) is oo
844. 
845.     assert (-1)**S.NaN is S.NaN
846.     assert oo - _inf is S.NaN
847.     assert oo + _ninf is S.NaN
848.     assert oo*0 is S.NaN
849.     assert oo/_inf is S.NaN
850.     assert oo/_ninf is S.NaN
851.     assert oo**S.NaN is S.NaN
852.     assert -oo + _inf is S.NaN
853.     assert -oo - _ninf is S.NaN
854.     assert -oo*S.NaN is S.NaN
855.     assert -oo*0 is S.NaN
856.     assert -oo/_inf is S.NaN
857.     assert -oo/_ninf is S.NaN
858.     assert -oo/S.NaN is S.NaN
859.     assert abs(-oo) is oo
860.     assert all((-oo)**i is S.NaN for i in (oo, -oo, S.NaN))
861.     assert (-oo)**3 is -oo
862.     assert (-oo)**2 is oo
863.     assert abs(S.ComplexInfinity) is oo
864. 
865. 
866. def test_Mul_Infinity_Zero():
867.     assert Float(0)*_inf is nan
868.     assert Float(0)*_ninf is nan
869.     assert Float(0)*_inf is nan
870.     assert Float(0)*_ninf is nan
871.     assert _inf*Float(0) is nan
872.     assert _ninf*Float(0) is nan
873.     assert _inf*Float(0) is nan
874.     assert _ninf*Float(0) is nan
875. 
876. 
877. def test_Div_By_Zero():
878.     assert 1/S.Zero is zoo
879.     assert 1/Float(0) is zoo
880.     assert 0/S.Zero is nan
881.     assert 0/Float(0) is nan
882.     assert S.Zero/0 is nan
883.     assert Float(0)/0 is nan
884.     assert -1/S.Zero is zoo
885.     assert -1/Float(0) is zoo
886. 
887. 
888. @_both_exp_pow
889. def test_Infinity_inequations():
890.     assert oo > pi
891.     assert not (oo < pi)
892.     assert exp(-3) < oo
893. 
894.     assert _inf > pi
895.     assert not (_inf < pi)
896.     assert exp(-3) < _inf
897. 
898.     raises(TypeError, lambda: oo < I)
899.     raises(TypeError, lambda: oo <= I)
900.     raises(TypeError, lambda: oo > I)
901.     raises(TypeError, lambda: oo >= I)
902.     raises(TypeError, lambda: -oo < I)
903.     raises(TypeError, lambda: -oo <= I)
904.     raises(TypeError, lambda: -oo > I)
905.     raises(TypeError, lambda: -oo >= I)
906. 
907.     raises(TypeError, lambda: I < oo)
908.     raises(TypeError, lambda: I <= oo)
909.     raises(TypeError, lambda: I > oo)
910.     raises(TypeError, lambda: I >= oo)
911.     raises(TypeError, lambda: I < -oo)
912.     raises(TypeError, lambda: I <= -oo)
913.     raises(TypeError, lambda: I > -oo)
914.     raises(TypeError, lambda: I >= -oo)
915. 
916.     assert oo > -oo and oo >= -oo
917.     assert (oo < -oo) == False and (oo <= -oo) == False
918.     assert -oo < oo and -oo <= oo
919.     assert (-oo > oo) == False and (-oo >= oo) == False
920. 
921.     assert (oo < oo) == False  # issue 7775
922.     assert (oo > oo) == False
923.     assert (-oo > -oo) == False and (-oo < -oo) == False
924.     assert oo >= oo and oo <= oo and -oo >= -oo and -oo <= -oo
925.     assert (-oo < -_inf) ==  False
926.     assert (oo > _inf) == False
927.     assert -oo >= -_inf
928.     assert oo <= _inf
929. 
930.     x = Symbol('x')
931.     b = Symbol('b', finite=True, real=True)
932.     assert (x < oo) == Lt(x, oo)  # issue 7775
933.     assert b < oo and b > -oo and b <= oo and b >= -oo
934.     assert oo > b and oo >= b and (oo < b) == False and (oo <= b) == False
935.     assert (-oo > b) == False and (-oo >= b) == False and -oo < b and -oo <= b
936.     assert (oo < x) == Lt(oo, x) and (oo > x) == Gt(oo, x)
937.     assert (oo <= x) == Le(oo, x) and (oo >= x) == Ge(oo, x)
938.     assert (-oo < x) == Lt(-oo, x) and (-oo > x) == Gt(-oo, x)
939.     assert (-oo <= x) == Le(-oo, x) and (-oo >= x) == Ge(-oo, x)
940. 
941. 
942. def test_NaN():
943.     assert nan is nan
944.     assert nan != 1
945.     assert 1*nan is nan
946.     assert 1 != nan
947.     assert -nan is nan
948.     assert oo != Symbol("x")**3
949.     assert 2 + nan is nan
950.     assert 3*nan + 2 is nan
951.     assert -nan*3 is nan
952.     assert nan + nan is nan
953.     assert -nan + nan*(-5) is nan
954.     assert 8/nan is nan
955.     raises(TypeError, lambda: nan > 0)
956.     raises(TypeError, lambda: nan < 0)
957.     raises(TypeError, lambda: nan >= 0)
958.     raises(TypeError, lambda: nan <= 0)
959.     raises(TypeError, lambda: 0 < nan)
960.     raises(TypeError, lambda: 0 > nan)
961.     raises(TypeError, lambda: 0 <= nan)
962.     raises(TypeError, lambda: 0 >= nan)
963.     assert nan**0 == 1  # as per IEEE 754
964.     assert 1**nan is nan # IEEE 754 is not the best choice for symbolic work
965.     # test Pow._eval_power's handling of NaN
966.     assert Pow(nan, 0, evaluate=False)**2 == 1
967.     for n in (1, 1., S.One, S.NegativeOne, Float(1)):
968.         assert n + nan is nan
969.         assert n - nan is nan
970.         assert nan + n is nan
971.         assert nan - n is nan
972.         assert n/nan is nan
973.         assert nan/n is nan
974. 
975. 
976. def test_special_numbers():
977.     assert isinstance(S.NaN, Number) is True
978.     assert isinstance(S.Infinity, Number) is True
979.     assert isinstance(S.NegativeInfinity, Number) is True
980. 
981.     assert S.NaN.is_number is True
982.     assert S.Infinity.is_number is True
983.     assert S.NegativeInfinity.is_number is True
984.     assert S.ComplexInfinity.is_number is True
985. 
986.     assert isinstance(S.NaN, Rational) is False
987.     assert isinstance(S.Infinity, Rational) is False
988.     assert isinstance(S.NegativeInfinity, Rational) is False
989. 
990.     assert S.NaN.is_rational is not True
991.     assert S.Infinity.is_rational is not True
992.     assert S.NegativeInfinity.is_rational is not True
993. 
994. 
995. def test_powers():
996.     assert integer_nthroot(1, 2) == (1, True)
997.     assert integer_nthroot(1, 5) == (1, True)
998.     assert integer_nthroot(2, 1) == (2, True)
999.     assert integer_nthroot(2, 2) == (1, False)
1000.     assert integer_nthroot(2, 5) == (1, False)
1001.     assert integer_nthroot(4, 2) == (2, True)
1002.     assert integer_nthroot(123**25, 25) == (123, True)
1003.     assert integer_nthroot(123**25 + 1, 25) == (123, False)
1004.     assert integer_nthroot(123**25 - 1, 25) == (122, False)
1005.     assert integer_nthroot(1, 1) == (1, True)
1006.     assert integer_nthroot(0, 1) == (0, True)
1007.     assert integer_nthroot(0, 3) == (0, True)
1008.     assert integer_nthroot(10000, 1) == (10000, True)
1009.     assert integer_nthroot(4, 2) == (2, True)
1010.     assert integer_nthroot(16, 2) == (4, True)
1011.     assert integer_nthroot(26, 2) == (5, False)
1012.     assert integer_nthroot(1234567**7, 7) == (1234567, True)
1013.     assert integer_nthroot(1234567**7 + 1, 7) == (1234567, False)
1014.     assert integer_nthroot(1234567**7 - 1, 7) == (1234566, False)
1015.     b = 25**1000
1016.     assert integer_nthroot(b, 1000) == (25, True)
1017.     assert integer_nthroot(b + 1, 1000) == (25, False)
1018.     assert integer_nthroot(b - 1, 1000) == (24, False)
1019.     c = 10**400
1020.     c2 = c**2
1021.     assert integer_nthroot(c2, 2) == (c, True)
1022.     assert integer_nthroot(c2 + 1, 2) == (c, False)
1023.     assert integer_nthroot(c2 - 1, 2) == (c - 1, False)
1024.     assert integer_nthroot(2, 10**10) == (1, False)
1025. 
1026.     p, r = integer_nthroot(int(factorial(10000)), 100)
1027.     assert p % (10**10) == 5322420655
1028.     assert not r
1029. 
1030.     # Test that this is fast
1031.     assert integer_nthroot(2, 10**10) == (1, False)
1032. 
1033.     # output should be int if possible
1034.     assert type(integer_nthroot(2**61, 2)[0]) is int
1035. 
1036. 
1037. def test_integer_nthroot_overflow():
1038.     assert integer_nthroot(10**(50*50), 50) == (10**50, True)
1039.     assert integer_nthroot(10**100000, 10000) == (10**10, True)
1040. 
1041. 
1042. def test_integer_log():
1043.     raises(ValueError, lambda: integer_log(2, 1))
1044.     raises(ValueError, lambda: integer_log(0, 2))
1045.     raises(ValueError, lambda: integer_log(1.1, 2))
1046.     raises(ValueError, lambda: integer_log(1, 2.2))
1047. 
1048.     assert integer_log(1, 2) == (0, True)
1049.     assert integer_log(1, 3) == (0, True)
1050.     assert integer_log(2, 3) == (0, False)
1051.     assert integer_log(3, 3) == (1, True)
1052.     assert integer_log(3*2, 3) == (1, False)
1053.     assert integer_log(3**2, 3) == (2, True)
1054.     assert integer_log(3*4, 3) == (2, False)
1055.     assert integer_log(3**3, 3) == (3, True)
1056.     assert integer_log(27, 5) == (2, False)
1057.     assert integer_log(2, 3) == (0, False)
1058.     assert integer_log(-4, -2) == (2, False)
1059.     assert integer_log(27, -3) == (3, False)
1060.     assert integer_log(-49, 7) == (0, False)
1061.     assert integer_log(-49, -7) == (2, False)
1062. 
1063. 
1064. def test_isqrt():
1065.     from math import sqrt as _sqrt
1066.     limit = 4503599761588223
1067.     assert int(_sqrt(limit)) == integer_nthroot(limit, 2)[0]
1068.     assert int(_sqrt(limit + 1)) != integer_nthroot(limit + 1, 2)[0]
1069.     assert isqrt(limit + 1) == integer_nthroot(limit + 1, 2)[0]
1070.     assert isqrt(limit + S.Half) == integer_nthroot(limit, 2)[0]
1071.     assert isqrt(limit + 1 + S.Half) == integer_nthroot(limit + 1, 2)[0]
1072.     assert isqrt(limit + 2 + S.Half) == integer_nthroot(limit + 2, 2)[0]
1073. 
1074.     # Regression tests for https://github.com/sympy/sympy/issues/17034
1075.     assert isqrt(4503599761588224) == 67108864
1076.     assert isqrt(9999999999999999) == 99999999
1077. 
1078.     # Other corner cases, especially involving non-integers.
1079.     raises(ValueError, lambda: isqrt(-1))
1080.     raises(ValueError, lambda: isqrt(-10**1000))
1081.     raises(ValueError, lambda: isqrt(Rational(-1, 2)))
1082. 
1083.     tiny = Rational(1, 10**1000)
1084.     raises(ValueError, lambda: isqrt(-tiny))
1085.     assert isqrt(1-tiny) == 0
1086.     assert isqrt(4503599761588224-tiny) == 67108864
1087.     assert isqrt(10**100 - tiny) == 10**50 - 1
1088. 
1089.     # Check that using an inaccurate math.sqrt doesn't affect the results.
1090.     from sympy.core import power
1091.     old_sqrt = power._sqrt
1092.     power._sqrt = lambda x: 2.999999999
1093.     try:
1094.         assert isqrt(9) == 3
1095.         assert isqrt(10000) == 100
1096.     finally:
1097.         power._sqrt = old_sqrt
1098. 
1099. 
1100. def test_powers_Integer():
1101.     """Test Integer._eval_power"""
1102.     # check infinity
1103.     assert S.One ** S.Infinity is S.NaN
1104.     assert S.NegativeOne** S.Infinity is S.NaN
1105.     assert S(2) ** S.Infinity is S.Infinity
1106.     assert S(-2)** S.Infinity == zoo
1107.     assert S(0) ** S.Infinity is S.Zero
1108. 
1109.     # check Nan
1110.     assert S.One ** S.NaN is S.NaN
1111.     assert S.NegativeOne ** S.NaN is S.NaN
1112. 
1113.     # check for exact roots
1114.     assert S.NegativeOne ** Rational(6, 5) == - (-1)**(S.One/5)
1115.     assert sqrt(S(4)) == 2
1116.     assert sqrt(S(-4)) == I * 2
1117.     assert S(16) ** Rational(1, 4) == 2
1118.     assert S(-16) ** Rational(1, 4) == 2 * (-1)**Rational(1, 4)
1119.     assert S(9) ** Rational(3, 2) == 27
1120.     assert S(-9) ** Rational(3, 2) == -27*I
1121.     assert S(27) ** Rational(2, 3) == 9
1122.     assert S(-27) ** Rational(2, 3) == 9 * (S.NegativeOne ** Rational(2, 3))
1123.     assert (-2) ** Rational(-2, 1) == Rational(1, 4)
1124. 
1125.     # not exact roots
1126.     assert sqrt(-3) == I*sqrt(3)
1127.     assert (3) ** (Rational(3, 2)) == 3 * sqrt(3)
1128.     assert (-3) ** (Rational(3, 2)) == - 3 * sqrt(-3)
1129.     assert (-3) ** (Rational(5, 2)) == 9 * I * sqrt(3)
1130.     assert (-3) ** (Rational(7, 2)) == - I * 27 * sqrt(3)
1131.     assert (2) ** (Rational(3, 2)) == 2 * sqrt(2)
1132.     assert (2) ** (Rational(-3, 2)) == sqrt(2) / 4
1133.     assert (81) ** (Rational(2, 3)) == 9 * (S(3) ** (Rational(2, 3)))
1134.     assert (-81) ** (Rational(2, 3)) == 9 * (S(-3) ** (Rational(2, 3)))
1135.     assert (-3) ** Rational(-7, 3) == \
1136.         -(-1)**Rational(2, 3)*3**Rational(2, 3)/27
1137.     assert (-3) ** Rational(-2, 3) == \
1138.         -(-1)**Rational(1, 3)*3**Rational(1, 3)/3
1139. 
1140.     # join roots
1141.     assert sqrt(6) + sqrt(24) == 3*sqrt(6)
1142.     assert sqrt(2) * sqrt(3) == sqrt(6)
1143. 
1144.     # separate symbols & constansts
1145.     x = Symbol("x")
1146.     assert sqrt(49 * x) == 7 * sqrt(x)
1147.     assert sqrt((3 - sqrt(pi)) ** 2) == 3 - sqrt(pi)
1148. 
1149.     # check that it is fast for big numbers
1150.     assert (2**64 + 1) ** Rational(4, 3)
1151.     assert (2**64 + 1) ** Rational(17, 25)
1152. 
1153.     # negative rational power and negative base
1154.     assert (-3) ** Rational(-7, 3) == \
1155.         -(-1)**Rational(2, 3)*3**Rational(2, 3)/27
1156.     assert (-3) ** Rational(-2, 3) == \
1157.         -(-1)**Rational(1, 3)*3**Rational(1, 3)/3
1158.     assert (-2) ** Rational(-10, 3) == \
1159.         (-1)**Rational(2, 3)*2**Rational(2, 3)/16
1160.     assert abs(Pow(-2, Rational(-10, 3)).n() -
1161.         Pow(-2, Rational(-10, 3), evaluate=False).n()) < 1e-16
1162. 
1163.     # negative base and rational power with some simplification
1164.     assert (-8) ** Rational(2, 5) == \
1165.         2*(-1)**Rational(2, 5)*2**Rational(1, 5)
1166.     assert (-4) ** Rational(9, 5) == \
1167.         -8*(-1)**Rational(4, 5)*2**Rational(3, 5)
1168. 
1169.     assert S(1234).factors() == {617: 1, 2: 1}
1170.     assert Rational(2*3, 3*5*7).factors() == {2: 1, 5: -1, 7: -1}
1171. 
1172.     # test that eval_power factors numbers bigger than
1173.     # the current limit in factor_trial_division (2**15)
1174.     from sympy.ntheory.generate import nextprime
1175.     n = nextprime(2**15)
1176.     assert sqrt(n**2) == n
1177.     assert sqrt(n**3) == n*sqrt(n)
1178.     assert sqrt(4*n) == 2*sqrt(n)
1179. 
1180.     # check that factors of base with powers sharing gcd with power are removed
1181.     assert (2**4*3)**Rational(1, 6) == 2**Rational(2, 3)*3**Rational(1, 6)
1182.     assert (2**4*3)**Rational(5, 6) == 8*2**Rational(1, 3)*3**Rational(5, 6)
1183. 
1184.     # check that bases sharing a gcd are exptracted
1185.     assert 2**Rational(1, 3)*3**Rational(1, 4)*6**Rational(1, 5) == \
1186.         2**Rational(8, 15)*3**Rational(9, 20)
1187.     assert sqrt(8)*24**Rational(1, 3)*6**Rational(1, 5) == \
1188.         4*2**Rational(7, 10)*3**Rational(8, 15)
1189.     assert sqrt(8)*(-24)**Rational(1, 3)*(-6)**Rational(1, 5) == \
1190.         4*(-3)**Rational(8, 15)*2**Rational(7, 10)
1191.     assert 2**Rational(1, 3)*2**Rational(8, 9) == 2*2**Rational(2, 9)
1192.     assert 2**Rational(2, 3)*6**Rational(1, 3) == 2*3**Rational(1, 3)
1193.     assert 2**Rational(2, 3)*6**Rational(8, 9) == \
1194.         2*2**Rational(5, 9)*3**Rational(8, 9)
1195.     assert (-2)**Rational(2, S(3))*(-4)**Rational(1, S(3)) == -2*2**Rational(1, 3)
1196.     assert 3*Pow(3, 2, evaluate=False) == 3**3
1197.     assert 3*Pow(3, Rational(-1, 3), evaluate=False) == 3**Rational(2, 3)
1198.     assert (-2)**Rational(1, 3)*(-3)**Rational(1, 4)*(-5)**Rational(5, 6) == \
1199.         -(-1)**Rational(5, 12)*2**Rational(1, 3)*3**Rational(1, 4) * \
1200.         5**Rational(5, 6)
1201. 
1202.     assert Integer(-2)**Symbol('', even=True) == \
1203.         Integer(2)**Symbol('', even=True)
1204.     assert (-1)**Float(.5) == 1.0*I
1205. 
1206. 
1207. def test_powers_Rational():
1208.     """Test Rational._eval_power"""
1209.     # check infinity
1210.     assert S.Half ** S.Infinity == 0
1211.     assert Rational(3, 2) ** S.Infinity is S.Infinity
1212.     assert Rational(-1, 2) ** S.Infinity == 0
1213.     assert Rational(-3, 2) ** S.Infinity == zoo
1214. 
1215.     # check Nan
1216.     assert Rational(3, 4) ** S.NaN is S.NaN
1217.     assert Rational(-2, 3) ** S.NaN is S.NaN
1218. 
1219.     # exact roots on numerator
1220.     assert sqrt(Rational(4, 3)) == 2 * sqrt(3) / 3
1221.     assert Rational(4, 3) ** Rational(3, 2) == 8 * sqrt(3) / 9
1222.     assert sqrt(Rational(-4, 3)) == I * 2 * sqrt(3) / 3
1223.     assert Rational(-4, 3) ** Rational(3, 2) == - I * 8 * sqrt(3) / 9
1224.     assert Rational(27, 2) ** Rational(1, 3) == 3 * (2 ** Rational(2, 3)) / 2
1225.     assert Rational(5**3, 8**3) ** Rational(4, 3) == Rational(5**4, 8**4)
1226. 
1227.     # exact root on denominator
1228.     assert sqrt(Rational(1, 4)) == S.Half
1229.     assert sqrt(Rational(1, -4)) == I * S.Half
1230.     assert sqrt(Rational(3, 4)) == sqrt(3) / 2
1231.     assert sqrt(Rational(3, -4)) == I * sqrt(3) / 2
1232.     assert Rational(5, 27) ** Rational(1, 3) == (5 ** Rational(1, 3)) / 3
1233. 
1234.     # not exact roots
1235.     assert sqrt(S.Half) == sqrt(2) / 2
1236.     assert sqrt(Rational(-4, 7)) == I * sqrt(Rational(4, 7))
1237.     assert Rational(-3, 2)**Rational(-7, 3) == \
1238.         -4*(-1)**Rational(2, 3)*2**Rational(1, 3)*3**Rational(2, 3)/27
1239.     assert Rational(-3, 2)**Rational(-2, 3) == \
1240.         -(-1)**Rational(1, 3)*2**Rational(2, 3)*3**Rational(1, 3)/3
1241.     assert Rational(-3, 2)**Rational(-10, 3) == \
1242.         8*(-1)**Rational(2, 3)*2**Rational(1, 3)*3**Rational(2, 3)/81
1243.     assert abs(Pow(Rational(-2, 3), Rational(-7, 4)).n() -
1244.         Pow(Rational(-2, 3), Rational(-7, 4), evaluate=False).n()) < 1e-16
1245. 
1246.     # negative integer power and negative rational base
1247.     assert Rational(-2, 3) ** Rational(-2, 1) == Rational(9, 4)
1248. 
1249.     a = Rational(1, 10)
1250.     assert a**Float(a, 2) == Float(a, 2)**Float(a, 2)
1251.     assert Rational(-2, 3)**Symbol('', even=True) == \
1252.         Rational(2, 3)**Symbol('', even=True)
1253. 
1254. 
1255. def test_powers_Float():
1256.     assert str((S('-1/10')**S('3/10')).n()) == str(Float(-.1)**(.3))
1257. 
1258. 
1259. def test_lshift_Integer():
1260.     assert Integer(0) << Integer(2) == Integer(0)
1261.     assert Integer(0) << 2 == Integer(0)
1262.     assert 0 << Integer(2) == Integer(0)
1263. 
1264.     assert Integer(0b11) << Integer(0) == Integer(0b11)
1265.     assert Integer(0b11) << 0 == Integer(0b11)
1266.     assert 0b11 << Integer(0) == Integer(0b11)
1267. 
1268.     assert Integer(0b11) << Integer(2) == Integer(0b11 << 2)
1269.     assert Integer(0b11) << 2 == Integer(0b11 << 2)
1270.     assert 0b11 << Integer(2) == Integer(0b11 << 2)
1271. 
1272.     assert Integer(-0b11) << Integer(2) == Integer(-0b11 << 2)
1273.     assert Integer(-0b11) << 2 == Integer(-0b11 << 2)
1274.     assert -0b11 << Integer(2) == Integer(-0b11 << 2)
1275. 
1276.     raises(TypeError, lambda: Integer(2) << 0.0)
1277.     raises(TypeError, lambda: 0.0 << Integer(2))
1278.     raises(ValueError, lambda: Integer(1) << Integer(-1))
1279. 
1280. 
1281. def test_rshift_Integer():
1282.     assert Integer(0) >> Integer(2) == Integer(0)
1283.     assert Integer(0) >> 2 == Integer(0)
1284.     assert 0 >> Integer(2) == Integer(0)
1285. 
1286.     assert Integer(0b11) >> Integer(0) == Integer(0b11)
1287.     assert Integer(0b11) >> 0 == Integer(0b11)
1288.     assert 0b11 >> Integer(0) == Integer(0b11)
1289. 
1290.     assert Integer(0b11) >> Integer(2) == Integer(0)
1291.     assert Integer(0b11) >> 2 == Integer(0)
1292.     assert 0b11 >> Integer(2) == Integer(0)
1293. 
1294.     assert Integer(-0b11) >> Integer(2) == Integer(-1)
1295.     assert Integer(-0b11) >> 2 == Integer(-1)
1296.     assert -0b11 >> Integer(2) == Integer(-1)
1297. 
1298.     assert Integer(0b1100) >> Integer(2) == Integer(0b1100 >> 2)
1299.     assert Integer(0b1100) >> 2 == Integer(0b1100 >> 2)
1300.     assert 0b1100 >> Integer(2) == Integer(0b1100 >> 2)
1301. 
1302.     assert Integer(-0b1100) >> Integer(2) == Integer(-0b1100 >> 2)
1303.     assert Integer(-0b1100) >> 2 == Integer(-0b1100 >> 2)
1304.     assert -0b1100 >> Integer(2) == Integer(-0b1100 >> 2)
1305. 
1306.     raises(TypeError, lambda: Integer(0b10) >> 0.0)
1307.     raises(TypeError, lambda: 0.0 >> Integer(2))
1308.     raises(ValueError, lambda: Integer(1) >> Integer(-1))
1309. 
1310. 
1311. def test_and_Integer():
1312.     assert Integer(0b01010101) & Integer(0b10101010) == Integer(0)
1313.     assert Integer(0b01010101) & 0b10101010 == Integer(0)
1314.     assert 0b01010101 & Integer(0b10101010) == Integer(0)
1315. 
1316.     assert Integer(0b01010101) & Integer(0b11011011) == Integer(0b01010001)
1317.     assert Integer(0b01010101) & 0b11011011 == Integer(0b01010001)
1318.     assert 0b01010101 & Integer(0b11011011) == Integer(0b01010001)
1319. 
1320.     assert -Integer(0b01010101) & Integer(0b11011011) == Integer(-0b01010101 & 0b11011011)
1321.     assert Integer(-0b01010101) & 0b11011011 == Integer(-0b01010101 & 0b11011011)
1322.     assert -0b01010101 & Integer(0b11011011) == Integer(-0b01010101 & 0b11011011)
1323. 
1324.     assert Integer(0b01010101) & -Integer(0b11011011) == Integer(0b01010101 & -0b11011011)
1325.     assert Integer(0b01010101) & -0b11011011 == Integer(0b01010101 & -0b11011011)
1326.     assert 0b01010101 & Integer(-0b11011011) == Integer(0b01010101 & -0b11011011)
1327. 
1328.     raises(TypeError, lambda: Integer(2) & 0.0)
1329.     raises(TypeError, lambda: 0.0 & Integer(2))
1330. 
1331. 
1332. def test_xor_Integer():
1333.     assert Integer(0b01010101) ^ Integer(0b11111111) == Integer(0b10101010)
1334.     assert Integer(0b01010101) ^ 0b11111111 == Integer(0b10101010)
1335.     assert 0b01010101 ^ Integer(0b11111111) == Integer(0b10101010)
1336. 
1337.     assert Integer(0b01010101) ^ Integer(0b11011011) == Integer(0b10001110)
1338.     assert Integer(0b01010101) ^ 0b11011011 == Integer(0b10001110)
1339.     assert 0b01010101 ^ Integer(0b11011011) == Integer(0b10001110)
1340. 
1341.     assert -Integer(0b01010101) ^ Integer(0b11011011) == Integer(-0b01010101 ^ 0b11011011)
1342.     assert Integer(-0b01010101) ^ 0b11011011 == Integer(-0b01010101 ^ 0b11011011)
1343.     assert -0b01010101 ^ Integer(0b11011011) == Integer(-0b01010101 ^ 0b11011011)
1344. 
1345.     assert Integer(0b01010101) ^ -Integer(0b11011011) == Integer(0b01010101 ^ -0b11011011)
1346.     assert Integer(0b01010101) ^ -0b11011011 == Integer(0b01010101 ^ -0b11011011)
1347.     assert 0b01010101 ^ Integer(-0b11011011) == Integer(0b01010101 ^ -0b11011011)
1348. 
1349.     raises(TypeError, lambda: Integer(2) ^ 0.0)
1350.     raises(TypeError, lambda: 0.0 ^ Integer(2))
1351. 
1352. 
1353. def test_or_Integer():
1354.     assert Integer(0b01010101) | Integer(0b10101010) == Integer(0b11111111)
1355.     assert Integer(0b01010101) | 0b10101010 == Integer(0b11111111)
1356.     assert 0b01010101 | Integer(0b10101010) == Integer(0b11111111)
1357. 
1358.     assert Integer(0b01010101) | Integer(0b11011011) == Integer(0b11011111)
1359.     assert Integer(0b01010101) | 0b11011011 == Integer(0b11011111)
1360.     assert 0b01010101 | Integer(0b11011011) == Integer(0b11011111)
1361. 
1362.     assert -Integer(0b01010101) | Integer(0b11011011) == Integer(-0b01010101 | 0b11011011)
1363.     assert Integer(-0b01010101) | 0b11011011 == Integer(-0b01010101 | 0b11011011)
1364.     assert -0b01010101 | Integer(0b11011011) == Integer(-0b01010101 | 0b11011011)
1365. 
1366.     assert Integer(0b01010101) | -Integer(0b11011011) == Integer(0b01010101 | -0b11011011)
1367.     assert Integer(0b01010101) | -0b11011011 == Integer(0b01010101 | -0b11011011)
1368.     assert 0b01010101 | Integer(-0b11011011) == Integer(0b01010101 | -0b11011011)
1369. 
1370.     raises(TypeError, lambda: Integer(2) | 0.0)
1371.     raises(TypeError, lambda: 0.0 | Integer(2))
1372. 
1373. 
1374. def test_invert_Integer():
1375.     assert ~Integer(0b01010101) == Integer(-0b01010110)
1376.     assert ~Integer(0b01010101) == Integer(~0b01010101)
1377.     assert ~(~Integer(0b01010101)) == Integer(0b01010101)
1378. 
1379. 
1380. def test_abs1():
1381.     assert Rational(1, 6) != Rational(-1, 6)
1382.     assert abs(Rational(1, 6)) == abs(Rational(-1, 6))
1383. 
1384. 
1385. def test_accept_int():
1386.     assert Float(4) == 4
1387. 
1388. 
1389. def test_dont_accept_str():
1390.     assert Float("0.2") != "0.2"
1391.     assert not (Float("0.2") == "0.2")
1392. 
1393. 
1394. def test_int():
1395.     a = Rational(5)
1396.     assert int(a) == 5
1397.     a = Rational(9, 10)
1398.     assert int(a) == int(-a) == 0
1399.     assert 1/(-1)**Rational(2, 3) == -(-1)**Rational(1, 3)
1400.     # issue 10368
1401.     a = Rational(32442016954, 78058255275)
1402.     assert type(int(a)) is type(int(-a)) is int
1403. 
1404. 
1405. def test_int_NumberSymbols():
1406.     assert int(Catalan) == 0
1407.     assert int(EulerGamma) == 0
1408.     assert int(pi) == 3
1409.     assert int(E) == 2
1410.     assert int(GoldenRatio) == 1
1411.     assert int(TribonacciConstant) == 1
1412.     for i in [Catalan, E, EulerGamma, GoldenRatio, TribonacciConstant, pi]:
1413.         a, b = i.approximation_interval(Integer)
1414.         ia = int(i)
1415.         assert ia == a
1416.         assert isinstance(ia, int)
1417.         assert b == a + 1
1418.         assert a.is_Integer and b.is_Integer
1419. 
1420. 
1421. def test_real_bug():
1422.     x = Symbol("x")
1423.     assert str(2.0*x*x) in ["(2.0*x)*x", "2.0*x**2", "2.00000000000000*x**2"]
1424.     assert str(2.1*x*x) != "(2.0*x)*x"
1425. 
1426. 
1427. def test_bug_sqrt():
1428.     assert ((sqrt(Rational(2)) + 1)*(sqrt(Rational(2)) - 1)).expand() == 1
1429. 
1430. 
1431. def test_pi_Pi():
1432.     "Test that pi (instance) is imported, but Pi (class) is not"
1433.     from sympy import pi  # noqa
1434.     with raises(ImportError):
1435.         from sympy import Pi  # noqa
1436. 
1437. 
1438. def test_no_len():
1439.     # there should be no len for numbers
1440.     raises(TypeError, lambda: len(Rational(2)))
1441.     raises(TypeError, lambda: len(Rational(2, 3)))
1442.     raises(TypeError, lambda: len(Integer(2)))
1443. 
1444. 
1445. def test_issue_3321():
1446.     assert sqrt(Rational(1, 5)) == Rational(1, 5)**S.Half
1447.     assert 5 * sqrt(Rational(1, 5)) == sqrt(5)
1448. 
1449. 
1450. def test_issue_3692():
1451.     assert ((-1)**Rational(1, 6)).expand(complex=True) == I/2 + sqrt(3)/2
1452.     assert ((-5)**Rational(1, 6)).expand(complex=True) == \
1453.         5**Rational(1, 6)*I/2 + 5**Rational(1, 6)*sqrt(3)/2
1454.     assert ((-64)**Rational(1, 6)).expand(complex=True) == I + sqrt(3)
1455. 
1456. 
1457. def test_issue_3423():
1458.     x = Symbol("x")
1459.     assert sqrt(x - 1).as_base_exp() == (x - 1, S.Half)
1460.     assert sqrt(x - 1) != I*sqrt(1 - x)
1461. 
1462. 
1463. def test_issue_3449():
1464.     x = Symbol("x")
1465.     assert sqrt(x - 1).subs(x, 5) == 2
1466. 
1467. 
1468. def test_issue_13890():
1469.     x = Symbol("x")
1470.     e = (-x/4 - S.One/12)**x - 1
1471.     f = simplify(e)
1472.     a = Rational(9, 5)
1473.     assert abs(e.subs(x,a).evalf() - f.subs(x,a).evalf()) < 1e-15
1474. 
1475. 
1476. def test_Integer_factors():
1477.     def F(i):
1478.         return Integer(i).factors()
1479. 
1480.     assert F(1) == {}
1481.     assert F(2) == {2: 1}
1482.     assert F(3) == {3: 1}
1483.     assert F(4) == {2: 2}
1484.     assert F(5) == {5: 1}
1485.     assert F(6) == {2: 1, 3: 1}
1486.     assert F(7) == {7: 1}
1487.     assert F(8) == {2: 3}
1488.     assert F(9) == {3: 2}
1489.     assert F(10) == {2: 1, 5: 1}
1490.     assert F(11) == {11: 1}
1491.     assert F(12) == {2: 2, 3: 1}
1492.     assert F(13) == {13: 1}
1493.     assert F(14) == {2: 1, 7: 1}
1494.     assert F(15) == {3: 1, 5: 1}
1495.     assert F(16) == {2: 4}
1496.     assert F(17) == {17: 1}
1497.     assert F(18) == {2: 1, 3: 2}
1498.     assert F(19) == {19: 1}
1499.     assert F(20) == {2: 2, 5: 1}
1500.     assert F(21) == {3: 1, 7: 1}
1501.     assert F(22) == {2: 1, 11: 1}
1502.     assert F(23) == {23: 1}
1503.     assert F(24) == {2: 3, 3: 1}
1504.     assert F(25) == {5: 2}
1505.     assert F(26) == {2: 1, 13: 1}
1506.     assert F(27) == {3: 3}
1507.     assert F(28) == {2: 2, 7: 1}
1508.     assert F(29) == {29: 1}
1509.     assert F(30) == {2: 1, 3: 1, 5: 1}
1510.     assert F(31) == {31: 1}
1511.     assert F(32) == {2: 5}
1512.     assert F(33) == {3: 1, 11: 1}
1513.     assert F(34) == {2: 1, 17: 1}
1514.     assert F(35) == {5: 1, 7: 1}
1515.     assert F(36) == {2: 2, 3: 2}
1516.     assert F(37) == {37: 1}
1517.     assert F(38) == {2: 1, 19: 1}
1518.     assert F(39) == {3: 1, 13: 1}
1519.     assert F(40) == {2: 3, 5: 1}
1520.     assert F(41) == {41: 1}
1521.     assert F(42) == {2: 1, 3: 1, 7: 1}
1522.     assert F(43) == {43: 1}
1523.     assert F(44) == {2: 2, 11: 1}
1524.     assert F(45) == {3: 2, 5: 1}
1525.     assert F(46) == {2: 1, 23: 1}
1526.     assert F(47) == {47: 1}
1527.     assert F(48) == {2: 4, 3: 1}
1528.     assert F(49) == {7: 2}
1529.     assert F(50) == {2: 1, 5: 2}
1530.     assert F(51) == {3: 1, 17: 1}
1531. 
1532. 
1533. def test_Rational_factors():
1534.     def F(p, q, visual=None):
1535.         return Rational(p, q).factors(visual=visual)
1536. 
1537.     assert F(2, 3) == {2: 1, 3: -1}
1538.     assert F(2, 9) == {2: 1, 3: -2}
1539.     assert F(2, 15) == {2: 1, 3: -1, 5: -1}
1540.     assert F(6, 10) == {3: 1, 5: -1}
1541. 
1542. 
1543. def test_issue_4107():
1544.     assert pi*(E + 10) + pi*(-E - 10) != 0
1545.     assert pi*(E + 10**10) + pi*(-E - 10**10) != 0
1546.     assert pi*(E + 10**20) + pi*(-E - 10**20) != 0
1547.     assert pi*(E + 10**80) + pi*(-E - 10**80) != 0
1548. 
1549.     assert (pi*(E + 10) + pi*(-E - 10)).expand() == 0
1550.     assert (pi*(E + 10**10) + pi*(-E - 10**10)).expand() == 0
1551.     assert (pi*(E + 10**20) + pi*(-E - 10**20)).expand() == 0
1552.     assert (pi*(E + 10**80) + pi*(-E - 10**80)).expand() == 0
1553. 
1554. 
1555. def test_IntegerInteger():
1556.     a = Integer(4)
1557.     b = Integer(a)
1558. 
1559.     assert a == b
1560. 
1561. 
1562. def test_Rational_gcd_lcm_cofactors():
1563.     assert Integer(4).gcd(2) == Integer(2)
1564.     assert Integer(4).lcm(2) == Integer(4)
1565.     assert Integer(4).gcd(Integer(2)) == Integer(2)
1566.     assert Integer(4).lcm(Integer(2)) == Integer(4)
1567.     a, b = 720**99911, 480**12342
1568.     assert Integer(a).lcm(b) == a*b/Integer(a).gcd(b)
1569. 
1570.     assert Integer(4).gcd(3) == Integer(1)
1571.     assert Integer(4).lcm(3) == Integer(12)
1572.     assert Integer(4).gcd(Integer(3)) == Integer(1)
1573.     assert Integer(4).lcm(Integer(3)) == Integer(12)
1574. 
1575.     assert Rational(4, 3).gcd(2) == Rational(2, 3)
1576.     assert Rational(4, 3).lcm(2) == Integer(4)
1577.     assert Rational(4, 3).gcd(Integer(2)) == Rational(2, 3)
1578.     assert Rational(4, 3).lcm(Integer(2)) == Integer(4)
1579. 
1580.     assert Integer(4).gcd(Rational(2, 9)) == Rational(2, 9)
1581.     assert Integer(4).lcm(Rational(2, 9)) == Integer(4)
1582. 
1583.     assert Rational(4, 3).gcd(Rational(2, 9)) == Rational(2, 9)
1584.     assert Rational(4, 3).lcm(Rational(2, 9)) == Rational(4, 3)
1585.     assert Rational(4, 5).gcd(Rational(2, 9)) == Rational(2, 45)
1586.     assert Rational(4, 5).lcm(Rational(2, 9)) == Integer(4)
1587.     assert Rational(5, 9).lcm(Rational(3, 7)) == Rational(Integer(5).lcm(3),Integer(9).gcd(7))
1588. 
1589.     assert Integer(4).cofactors(2) == (Integer(2), Integer(2), Integer(1))
1590.     assert Integer(4).cofactors(Integer(2)) == \
1591.         (Integer(2), Integer(2), Integer(1))
1592. 
1593.     assert Integer(4).gcd(Float(2.0)) == S.One
1594.     assert Integer(4).lcm(Float(2.0)) == Float(8.0)
1595.     assert Integer(4).cofactors(Float(2.0)) == (S.One, Integer(4), Float(2.0))
1596. 
1597.     assert S.Half.gcd(Float(2.0)) == S.One
1598.     assert S.Half.lcm(Float(2.0)) == Float(1.0)
1599.     assert S.Half.cofactors(Float(2.0)) == \
1600.         (S.One, S.Half, Float(2.0))
1601. 
1602. 
1603. def test_Float_gcd_lcm_cofactors():
1604.     assert Float(2.0).gcd(Integer(4)) == S.One
1605.     assert Float(2.0).lcm(Integer(4)) == Float(8.0)
1606.     assert Float(2.0).cofactors(Integer(4)) == (S.One, Float(2.0), Integer(4))
1607. 
1608.     assert Float(2.0).gcd(S.Half) == S.One
1609.     assert Float(2.0).lcm(S.Half) == Float(1.0)
1610.     assert Float(2.0).cofactors(S.Half) == \
1611.         (S.One, Float(2.0), S.Half)
1612. 
1613. 
1614. def test_issue_4611():
1615.     assert abs(pi._evalf(50) - 3.14159265358979) < 1e-10
1616.     assert abs(E._evalf(50) - 2.71828182845905) < 1e-10
1617.     assert abs(Catalan._evalf(50) - 0.915965594177219) < 1e-10
1618.     assert abs(EulerGamma._evalf(50) - 0.577215664901533) < 1e-10
1619.     assert abs(GoldenRatio._evalf(50) - 1.61803398874989) < 1e-10
1620.     assert abs(TribonacciConstant._evalf(50) - 1.83928675521416) < 1e-10
1621. 
1622.     x = Symbol("x")
1623.     assert (pi + x).evalf() == pi.evalf() + x
1624.     assert (E + x).evalf() == E.evalf() + x
1625.     assert (Catalan + x).evalf() == Catalan.evalf() + x
1626.     assert (EulerGamma + x).evalf() == EulerGamma.evalf() + x
1627.     assert (GoldenRatio + x).evalf() == GoldenRatio.evalf() + x
1628.     assert (TribonacciConstant + x).evalf() == TribonacciConstant.evalf() + x
1629. 
1630. 
1631. @conserve_mpmath_dps
1632. def test_conversion_to_mpmath():
1633.     assert mpmath.mpmathify(Integer(1)) == mpmath.mpf(1)
1634.     assert mpmath.mpmathify(S.Half) == mpmath.mpf(0.5)
1635.     assert mpmath.mpmathify(Float('1.23', 15)) == mpmath.mpf('1.23')
1636. 
1637.     assert mpmath.mpmathify(I) == mpmath.mpc(1j)
1638. 
1639.     assert mpmath.mpmathify(1 + 2*I) == mpmath.mpc(1 + 2j)
1640.     assert mpmath.mpmathify(1.0 + 2*I) == mpmath.mpc(1 + 2j)
1641.     assert mpmath.mpmathify(1 + 2.0*I) == mpmath.mpc(1 + 2j)
1642.     assert mpmath.mpmathify(1.0 + 2.0*I) == mpmath.mpc(1 + 2j)
1643.     assert mpmath.mpmathify(S.Half + S.Half*I) == mpmath.mpc(0.5 + 0.5j)
1644. 
1645.     assert mpmath.mpmathify(2*I) == mpmath.mpc(2j)
1646.     assert mpmath.mpmathify(2.0*I) == mpmath.mpc(2j)
1647.     assert mpmath.mpmathify(S.Half*I) == mpmath.mpc(0.5j)
1648. 
1649.     mpmath.mp.dps = 100
1650.     assert mpmath.mpmathify(pi.evalf(100) + pi.evalf(100)*I) == mpmath.pi + mpmath.pi*mpmath.j
1651.     assert mpmath.mpmathify(pi.evalf(100)*I) == mpmath.pi*mpmath.j
1652. 
1653. 
1654. def test_relational():
1655.     # real
1656.     x = S(.1)
1657.     assert (x != cos) is True
1658.     assert (x == cos) is False
1659. 
1660.     # rational
1661.     x = Rational(1, 3)
1662.     assert (x != cos) is True
1663.     assert (x == cos) is False
1664. 
1665.     # integer defers to rational so these tests are omitted
1666. 
1667.     # number symbol
1668.     x = pi
1669.     assert (x != cos) is True
1670.     assert (x == cos) is False
1671. 
1672. 
1673. def test_Integer_as_index():
1674.     assert 'hello'[Integer(2):] == 'llo'
1675. 
1676. 
1677. def test_Rational_int():
1678.     assert int( Rational(7, 5)) == 1
1679.     assert int( S.Half) == 0
1680.     assert int(Rational(-1, 2)) == 0
1681.     assert int(-Rational(7, 5)) == -1
1682. 
1683. 
1684. def test_zoo():
1685.     b = Symbol('b', finite=True)
1686.     nz = Symbol('nz', nonzero=True)
1687.     p = Symbol('p', positive=True)
1688.     n = Symbol('n', negative=True)
1689.     im = Symbol('i', imaginary=True)
1690.     c = Symbol('c', complex=True)
1691.     pb = Symbol('pb', positive=True)
1692.     nb = Symbol('nb', negative=True)
1693.     imb = Symbol('ib', imaginary=True, finite=True)
1694.     for i in [I, S.Infinity, S.NegativeInfinity, S.Zero, S.One, S.Pi, S.Half, S(3), log(3),
1695.               b, nz, p, n, im, pb, nb, imb, c]:
1696.         if i.is_finite and (i.is_real or i.is_imaginary):
1697.             assert i + zoo is zoo
1698.             assert i - zoo is zoo
1699.             assert zoo + i is zoo
1700.             assert zoo - i is zoo
1701.         elif i.is_finite is not False:
1702.             assert (i + zoo).is_Add
1703.             assert (i - zoo).is_Add
1704.             assert (zoo + i).is_Add
1705.             assert (zoo - i).is_Add
1706.         else:
1707.             assert (i + zoo) is S.NaN
1708.             assert (i - zoo) is S.NaN
1709.             assert (zoo + i) is S.NaN
1710.             assert (zoo - i) is S.NaN
1711. 
1712.         if fuzzy_not(i.is_zero) and (i.is_extended_real or i.is_imaginary):
1713.             assert i*zoo is zoo
1714.             assert zoo*i is zoo
1715.         elif i.is_zero:
1716.             assert i*zoo is S.NaN
1717.             assert zoo*i is S.NaN
1718.         else:
1719.             assert (i*zoo).is_Mul
1720.             assert (zoo*i).is_Mul
1721. 
1722.         if fuzzy_not((1/i).is_zero) and (i.is_real or i.is_imaginary):
1723.             assert zoo/i is zoo
1724.         elif (1/i).is_zero:
1725.             assert zoo/i is S.NaN
1726.         elif i.is_zero:
1727.             assert zoo/i is zoo
1728.         else:
1729.             assert (zoo/i).is_Mul
1730. 
1731.     assert (I*oo).is_Mul  # allow directed infinity
1732.     assert zoo + zoo is S.NaN
1733.     assert zoo * zoo is zoo
1734.     assert zoo - zoo is S.NaN
1735.     assert zoo/zoo is S.NaN
1736.     assert zoo**zoo is S.NaN
1737.     assert zoo**0 is S.One
1738.     assert zoo**2 is zoo
1739.     assert 1/zoo is S.Zero
1740. 
1741.     assert Mul.flatten([S.NegativeOne, oo, S(0)]) == ([S.NaN], [], None)
1742. 
1743. 
1744. def test_issue_4122():
1745.     x = Symbol('x', nonpositive=True)
1746.     assert oo + x is oo
1747.     x = Symbol('x', extended_nonpositive=True)
1748.     assert (oo + x).is_Add
1749.     x = Symbol('x', finite=True)
1750.     assert (oo + x).is_Add  # x could be imaginary
1751.     x = Symbol('x', nonnegative=True)
1752.     assert oo + x is oo
1753.     x = Symbol('x', extended_nonnegative=True)
1754.     assert oo + x is oo
1755.     x = Symbol('x', finite=True, real=True)
1756.     assert oo + x is oo
1757. 
1758.     # similarly for negative infinity
1759.     x = Symbol('x', nonnegative=True)
1760.     assert -oo + x is -oo
1761.     x = Symbol('x', extended_nonnegative=True)
1762.     assert (-oo + x).is_Add
1763.     x = Symbol('x', finite=True)
1764.     assert (-oo + x).is_Add
1765.     x = Symbol('x', nonpositive=True)
1766.     assert -oo + x is -oo
1767.     x = Symbol('x', extended_nonpositive=True)
1768.     assert -oo + x is -oo
1769.     x = Symbol('x', finite=True, real=True)
1770.     assert -oo + x is -oo
1771. 
1772. 
1773. def test_GoldenRatio_expand():
1774.     assert GoldenRatio.expand(func=True) == S.Half + sqrt(5)/2
1775. 
1776. 
1777. def test_TribonacciConstant_expand():
1778.         assert TribonacciConstant.expand(func=True) == \
1779.           (1 + cbrt(19 - 3*sqrt(33)) + cbrt(19 + 3*sqrt(33))) / 3
1780. 
1781. 
1782. def test_as_content_primitive():
1783.     assert S.Zero.as_content_primitive() == (1, 0)
1784.     assert S.Half.as_content_primitive() == (S.Half, 1)
1785.     assert (Rational(-1, 2)).as_content_primitive() == (S.Half, -1)
1786.     assert S(3).as_content_primitive() == (3, 1)
1787.     assert S(3.1).as_content_primitive() == (1, 3.1)
1788. 
1789. 
1790. def test_hashing_sympy_integers():
1791.     # Test for issue 5072
1792.     assert {Integer(3)} == {int(3)}
1793.     assert hash(Integer(4)) == hash(int(4))
1794. 
1795. 
1796. def test_rounding_issue_4172():
1797.     assert int((E**100).round()) == \
1798.         26881171418161354484126255515800135873611119
1799.     assert int((pi**100).round()) == \
1800.         51878483143196131920862615246303013562686760680406
1801.     assert int((Rational(1)/EulerGamma**100).round()) == \
1802.         734833795660954410469466
1803. 
1804. 
1805. @XFAIL
1806. def test_mpmath_issues():
1807.     from mpmath.libmp.libmpf import _normalize
1808.     import mpmath.libmp as mlib
1809.     rnd = mlib.round_nearest
1810.     mpf = (0, int(0), -123, -1, 53, rnd)  # nan
1811.     assert _normalize(mpf, 53) != (0, int(0), 0, 0)
1812.     mpf = (0, int(0), -456, -2, 53, rnd)  # +inf
1813.     assert _normalize(mpf, 53) != (0, int(0), 0, 0)
1814.     mpf = (1, int(0), -789, -3, 53, rnd)  # -inf
1815.     assert _normalize(mpf, 53) != (0, int(0), 0, 0)
1816. 
1817.     from mpmath.libmp.libmpf import fnan
1818.     assert mlib.mpf_eq(fnan, fnan)
1819. 
1820. 
1821. def test_Catalan_EulerGamma_prec():
1822.     n = GoldenRatio
1823.     f = Float(n.n(), 5)
1824.     assert f._mpf_ == (0, int(212079), -17, 18)
1825.     assert f._prec == 20
1826.     assert n._as_mpf_val(20) == f._mpf_
1827. 
1828.     n = EulerGamma
1829.     f = Float(n.n(), 5)
1830.     assert f._mpf_ == (0, int(302627), -19, 19)
1831.     assert f._prec == 20
1832.     assert n._as_mpf_val(20) == f._mpf_
1833. 
1834. 
1835. def test_Catalan_rewrite():
1836.     k = Dummy('k', integer=True, nonnegative=True)
1837.     assert Catalan.rewrite(Sum).dummy_eq(
1838.             Sum((-1)**k/(2*k + 1)**2, (k, 0, oo)))
1839.     assert Catalan.rewrite() == Catalan
1840. 
1841. 
1842. def test_bool_eq():
1843.     assert 0 == False
1844.     assert S(0) == False
1845.     assert S(0) != S.false
1846.     assert 1 == True
1847.     assert S.One == True
1848.     assert S.One != S.true
1849. 
1850. 
1851. def test_Float_eq():
1852.     # all .5 values are the same
1853.     assert Float(.5, 10) == Float(.5, 11) == Float(.5, 1)
1854.     # but floats that aren't exact in base-2 still
1855.     # don't compare the same because they have different
1856.     # underlying mpf values
1857.     assert Float(.12, 3) != Float(.12, 4)
1858.     assert Float(.12, 3) != .12
1859.     assert 0.12 != Float(.12, 3)
1860.     assert Float('.12', 22) != .12
1861.     # issue 11707
1862.     # but Float/Rational -- except for 0 --
1863.     # are exact so Rational(x) = Float(y) only if
1864.     # Rational(x) == Rational(Float(y))
1865.     assert Float('1.1') != Rational(11, 10)
1866.     assert Rational(11, 10) != Float('1.1')
1867.     # coverage
1868.     assert not Float(3) == 2
1869.     assert not Float(2**2) == S.Half
1870.     assert Float(2**2) == 4
1871.     assert not Float(2**-2) == 1
1872.     assert Float(2**-1) == S.Half
1873.     assert not Float(2*3) == 3
1874.     assert not Float(2*3) == S.Half
1875.     assert Float(2*3) == 6
1876.     assert not Float(2*3) == 8
1877.     assert Float(.75) == Rational(3, 4)
1878.     assert Float(5/18) == 5/18
1879.     # 4473
1880.     assert Float(2.) != 3
1881.     assert Float((0,1,-3)) == S.One/8
1882.     assert Float((0,1,-3)) != S.One/9
1883.     # 16196
1884.     assert 2 == Float(2)  # as per Python
1885.     # but in a computation...
1886.     assert t**2 != t**2.0
1887. 
1888. 
1889. def test_issue_6640():
1890.     from mpmath.libmp.libmpf import finf, fninf
1891.     # fnan is not included because Float no longer returns fnan,
1892.     # but otherwise, the same sort of test could apply
1893.     assert Float(finf).is_zero is False
1894.     assert Float(fninf).is_zero is False
1895.     assert bool(Float(0)) is False
1896. 
1897. 
1898. def test_issue_6349():
1899.     assert Float('23.e3', '')._prec == 10
1900.     assert Float('23e3', '')._prec == 20
1901.     assert Float('23000', '')._prec == 20
1902.     assert Float('-23000', '')._prec == 20
1903. 
1904. 
1905. def test_mpf_norm():
1906.     assert mpf_norm((1, 0, 1, 0), 10) == mpf('0')._mpf_
1907.     assert Float._new((1, 0, 1, 0), 10)._mpf_ == mpf('0')._mpf_
1908. 
1909. 
1910. def test_latex():
1911.     assert latex(pi) == r"\pi"
1912.     assert latex(E) == r"e"
1913.     assert latex(GoldenRatio) == r"\phi"
1914.     assert latex(TribonacciConstant) == r"\text{TribonacciConstant}"
1915.     assert latex(EulerGamma) == r"\gamma"
1916.     assert latex(oo) == r"\infty"
1917.     assert latex(-oo) == r"-\infty"
1918.     assert latex(zoo) == r"\tilde{\infty}"
1919.     assert latex(nan) == r"\text{NaN}"
1920.     assert latex(I) == r"i"
1921. 
1922. 
1923. def test_issue_7742():
1924.     assert -oo % 1 is nan
1925. 
1926. 
1927. def test_simplify_AlgebraicNumber():
1928.     A = AlgebraicNumber
1929.     e = 3**(S.One/6)*(3 + (135 + 78*sqrt(3))**Rational(2, 3))/(45 + 26*sqrt(3))**(S.One/3)
1930.     assert simplify(A(e)) == A(12)  # wester test_C20
1931. 
1932.     e = (41 + 29*sqrt(2))**(S.One/5)
1933.     assert simplify(A(e)) == A(1 + sqrt(2))  # wester test_C21
1934. 
1935.     e = (3 + 4*I)**Rational(3, 2)
1936.     assert simplify(A(e)) == A(2 + 11*I)  # issue 4401
1937. 
1938. 
1939. def test_Float_idempotence():
1940.     x = Float('1.23', '')
1941.     y = Float(x)
1942.     z = Float(x, 15)
1943.     assert same_and_same_prec(y, x)
1944.     assert not same_and_same_prec(z, x)
1945.     x = Float(10**20)
1946.     y = Float(x)
1947.     z = Float(x, 15)
1948.     assert same_and_same_prec(y, x)
1949.     assert not same_and_same_prec(z, x)
1950. 
1951. 
1952. def test_comp1():
1953.     # sqrt(2) = 1.414213 5623730950...
1954.     a = sqrt(2).n(7)
1955.     assert comp(a, 1.4142129) is False
1956.     assert comp(a, 1.4142130)
1957.     #                  ...
1958.     assert comp(a, 1.4142141)
1959.     assert comp(a, 1.4142142) is False
1960.     assert comp(sqrt(2).n(2), '1.4')
1961.     assert comp(sqrt(2).n(2), Float(1.4, 2), '')
1962.     assert comp(sqrt(2).n(2), 1.4, '')
1963.     assert comp(sqrt(2).n(2), Float(1.4, 3), '') is False
1964.     assert comp(sqrt(2) + sqrt(3)*I, 1.4 + 1.7*I, .1)
1965.     assert not comp(sqrt(2) + sqrt(3)*I, (1.5 + 1.7*I)*0.89, .1)
1966.     assert comp(sqrt(2) + sqrt(3)*I, (1.5 + 1.7*I)*0.90, .1)
1967.     assert comp(sqrt(2) + sqrt(3)*I, (1.5 + 1.7*I)*1.07, .1)
1968.     assert not comp(sqrt(2) + sqrt(3)*I, (1.5 + 1.7*I)*1.08, .1)
1969.     assert [(i, j)
1970.             for i in range(130, 150)
1971.             for j in range(170, 180)
1972.             if comp((sqrt(2)+ I*sqrt(3)).n(3), i/100. + I*j/100.)] == [
1973.         (141, 173), (142, 173)]
1974.     raises(ValueError, lambda: comp(t, '1'))
1975.     raises(ValueError, lambda: comp(t, 1))
1976.     assert comp(0, 0.0)
1977.     assert comp(.5, S.Half)
1978.     assert comp(2 + sqrt(2), 2.0 + sqrt(2))
1979.     assert not comp(0, 1)
1980.     assert not comp(2, sqrt(2))
1981.     assert not comp(2 + I, 2.0 + sqrt(2))
1982.     assert not comp(2.0 + sqrt(2), 2 + I)
1983.     assert not comp(2.0 + sqrt(2), sqrt(3))
1984.     assert comp(1/pi.n(4), 0.3183, 1e-5)
1985.     assert not comp(1/pi.n(4), 0.3183, 8e-6)
1986. 
1987. 
1988. def test_issue_9491():
1989.     assert oo**zoo is nan
1990. 
1991. 
1992. def test_issue_10063():
1993.     assert 2**Float(3) == Float(8)
1994. 
1995. 
1996. def test_issue_10020():
1997.     assert oo**I is S.NaN
1998.     assert oo**(1 + I) is S.ComplexInfinity
1999.     assert oo**(-1 + I) is S.Zero
2000.     assert (-oo)**I is S.NaN
2001.     assert (-oo)**(-1 + I) is S.Zero
2002.     assert oo**t == Pow(oo, t, evaluate=False)
2003.     assert (-oo)**t == Pow(-oo, t, evaluate=False)
2004. 
2005. 
2006. def test_invert_numbers():
2007.     assert S(2).invert(5) == 3
2008.     assert S(2).invert(Rational(5, 2)) == S.Half
2009.     assert S(2).invert(5.) == 0.5
2010.     assert S(2).invert(S(5)) == 3
2011.     assert S(2.).invert(5) == 0.5
2012.     assert S(sqrt(2)).invert(5) == 1/sqrt(2)
2013.     assert S(sqrt(2)).invert(sqrt(3)) == 1/sqrt(2)
2014. 
2015. 
2016. def test_mod_inverse():
2017.     assert mod_inverse(3, 11) == 4
2018.     assert mod_inverse(5, 11) == 9
2019.     assert mod_inverse(21124921, 521512) == 7713
2020.     assert mod_inverse(124215421, 5125) == 2981
2021.     assert mod_inverse(214, 12515) == 1579
2022.     assert mod_inverse(5823991, 3299) == 1442
2023.     assert mod_inverse(123, 44) == 39
2024.     assert mod_inverse(2, 5) == 3
2025.     assert mod_inverse(-2, 5) == 2
2026.     assert mod_inverse(2, -5) == -2
2027.     assert mod_inverse(-2, -5) == -3
2028.     assert mod_inverse(-3, -7) == -5
2029.     x = Symbol('x')
2030.     assert S(2).invert(x) == S.Half
2031.     raises(TypeError, lambda: mod_inverse(2, x))
2032.     raises(ValueError, lambda: mod_inverse(2, S.Half))
2033.     raises(ValueError, lambda: mod_inverse(2, cos(1)**2 + sin(1)**2))
2034. 
2035. 
2036. def test_golden_ratio_rewrite_as_sqrt():
2037.     assert GoldenRatio.rewrite(sqrt) == S.Half + sqrt(5)*S.Half
2038. 
2039. 
2040. def test_tribonacci_constant_rewrite_as_sqrt():
2041.     assert TribonacciConstant.rewrite(sqrt) == \
2042.       (1 + cbrt(19 - 3*sqrt(33)) + cbrt(19 + 3*sqrt(33))) / 3
2043. 
2044. 
2045. def test_comparisons_with_unknown_type():
2046.     class Foo:
2047.         """
2048.         Class that is unaware of Basic, and relies on both classes returning
2049.         the NotImplemented singleton for equivalence to evaluate to False.
2050. 
2051.         """
2052. 
2053.     ni, nf, nr = Integer(3), Float(1.0), Rational(1, 3)
2054.     foo = Foo()
2055. 
2056.     for n in ni, nf, nr, oo, -oo, zoo, nan:
2057.         assert n != foo
2058.         assert foo != n
2059.         assert not n == foo
2060.         assert not foo == n
2061.         raises(TypeError, lambda: n < foo)
2062.         raises(TypeError, lambda: foo > n)
2063.         raises(TypeError, lambda: n > foo)
2064.         raises(TypeError, lambda: foo < n)
2065.         raises(TypeError, lambda: n <= foo)
2066.         raises(TypeError, lambda: foo >= n)
2067.         raises(TypeError, lambda: n >= foo)
2068.         raises(TypeError, lambda: foo <= n)
2069. 
2070.     class Bar:
2071.         """
2072.         Class that considers itself equal to any instance of Number except
2073.         infinities and nans, and relies on SymPy types returning the
2074.         NotImplemented singleton for symmetric equality relations.
2075. 
2076.         """
2077.         def __eq__(self, other):
2078.             if other in (oo, -oo, zoo, nan):
2079.                 return False
2080.             if isinstance(other, Number):
2081.                 return True
2082.             return NotImplemented
2083. 
2084.         def __ne__(self, other):
2085.             return not self == other
2086. 
2087.     bar = Bar()
2088. 
2089.     for n in ni, nf, nr:
2090.         assert n == bar
2091.         assert bar == n
2092.         assert not n != bar
2093.         assert not bar != n
2094. 
2095.     for n in oo, -oo, zoo, nan:
2096.         assert n != bar
2097.         assert bar != n
2098.         assert not n == bar
2099.         assert not bar == n
2100. 
2101.     for n in ni, nf, nr, oo, -oo, zoo, nan:
2102.         raises(TypeError, lambda: n < bar)
2103.         raises(TypeError, lambda: bar > n)
2104.         raises(TypeError, lambda: n > bar)
2105.         raises(TypeError, lambda: bar < n)
2106.         raises(TypeError, lambda: n <= bar)
2107.         raises(TypeError, lambda: bar >= n)
2108.         raises(TypeError, lambda: n >= bar)
2109.         raises(TypeError, lambda: bar <= n)
2110. 
2111. 
2112. def test_NumberSymbol_comparison():
2113.     from sympy.core.tests.test_relational import rel_check
2114.     rpi = Rational('905502432259640373/288230376151711744')
2115.     fpi = Float(float(pi))
2116.     assert rel_check(rpi, fpi)
2117. 
2118. 
2119. def test_Integer_precision():
2120.     # Make sure Integer inputs for keyword args work
2121.     assert Float('1.0', dps=Integer(15))._prec == 53
2122.     assert Float('1.0', precision=Integer(15))._prec == 15
2123.     assert type(Float('1.0', precision=Integer(15))._prec) == int
2124.     assert sympify(srepr(Float('1.0', precision=15))) == Float('1.0', precision=15)
2125. 
2126. 
2127. def test_numpy_to_float():
2128.     from sympy.testing.pytest import skip
2129.     from sympy.external import import_module
2130.     np = import_module('numpy')
2131.     if not np:
2132.         skip('numpy not installed. Abort numpy tests.')
2133. 
2134.     def check_prec_and_relerr(npval, ratval):
2135.         prec = np.finfo(npval).nmant + 1
2136.         x = Float(npval)
2137.         assert x._prec == prec
2138.         y = Float(ratval, precision=prec)
2139.         assert abs((x - y)/y) < 2**(-(prec + 1))
2140. 
2141.     check_prec_and_relerr(np.float16(2.0/3), Rational(2, 3))
2142.     check_prec_and_relerr(np.float32(2.0/3), Rational(2, 3))
2143.     check_prec_and_relerr(np.float64(2.0/3), Rational(2, 3))
2144.     # extended precision, on some arch/compilers:
2145.     x = np.longdouble(2)/3
2146.     check_prec_and_relerr(x, Rational(2, 3))
2147.     y = Float(x, precision=10)
2148.     assert same_and_same_prec(y, Float(Rational(2, 3), precision=10))
2149. 
2150.     raises(TypeError, lambda: Float(np.complex64(1+2j)))
2151.     raises(TypeError, lambda: Float(np.complex128(1+2j)))
2152. 
2153. 
2154. def test_Integer_ceiling_floor():
2155.     a = Integer(4)
2156. 
2157.     assert a.floor() == a
2158.     assert a.ceiling() == a
2159. 
2160. 
2161. def test_ComplexInfinity():
2162.     assert zoo.floor() is zoo
2163.     assert zoo.ceiling() is zoo
2164.     assert zoo**zoo is S.NaN
2165. 
2166. 
2167. def test_Infinity_floor_ceiling_power():
2168.     assert oo.floor() is oo
2169.     assert oo.ceiling() is oo
2170.     assert oo**S.NaN is S.NaN
2171.     assert oo**zoo is S.NaN
2172. 
2173. 
2174. def test_One_power():
2175.     assert S.One**12 is S.One
2176.     assert S.NegativeOne**S.NaN is S.NaN
2177. 
2178. 
2179. def test_NegativeInfinity():
2180.     assert (-oo).floor() is -oo
2181.     assert (-oo).ceiling() is -oo
2182.     assert (-oo)**11 is -oo
2183.     assert (-oo)**12 is oo
2184. 
2185. 
2186. def test_issue_6133():
2187.     raises(TypeError, lambda: (-oo < None))
2188.     raises(TypeError, lambda: (S(-2) < None))
2189.     raises(TypeError, lambda: (oo < None))
2190.     raises(TypeError, lambda: (oo > None))
2191.     raises(TypeError, lambda: (S(2) < None))
2192. 
2193. 
2194. def test_abc():
2195.     x = numbers.Float(5)
2196.     assert(isinstance(x, nums.Number))
2197.     assert(isinstance(x, numbers.Number))
2198.     assert(isinstance(x, nums.Real))
2199.     y = numbers.Rational(1, 3)
2200.     assert(isinstance(y, nums.Number))
2201.     assert(y.numerator == 1)
2202.     assert(y.denominator == 3)
2203.     assert(isinstance(y, nums.Rational))
2204.     z = numbers.Integer(3)
2205.     assert(isinstance(z, nums.Number))
2206.     assert(isinstance(z, numbers.Number))
2207.     assert(isinstance(z, nums.Rational))
2208.     assert(isinstance(z, numbers.Rational))
2209.     assert(isinstance(z, nums.Integral))
2210. 
2211. 
2212. def test_floordiv():
2213.     assert S(2)//S.Half == 4
2214. 
2215. 
2216. def test_negation():
2217.     assert -S.Zero is S.Zero
2218.     assert -Float(0) is not S.Zero and -Float(0) == 0
2219. 
2220. 
2221. def test_exponentiation_of_0():
2222.     x = Symbol('x')
2223.     assert 0**-x == zoo**x
2224.     assert unchanged(Pow, 0, x)
2225.     x = Symbol('x', zero=True)
2226.     assert 0**-x == S.One
2227.     assert 0**x == S.One

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 13:51:54,510 - thread-136261515871936.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='1. The user wants to find 3 test cases related to a bug in the `Rational` constructor when using string arguments.\n2. The provided context is the file `sympy/core/tests/test_numbers.py`, which contains tests for number types including `Rational`.\n3. This file contains the test method `test_Rational_new`, which directly tests the `Rational` constructor with a variety of arguments, including different string formats, floats, and other number types.\n4. The file also contains other relevant test methods like `test_Number_new` (testing a factory that creates Rationals from strings) and `test_divmod` (which uses `sympify` to create Rationals from strings for use in the test).\n5. Therefore, the provided context is sufficient to identify and extract 3 relevant test cases as requested by the user. No additional context is required.' query='' extra_requirements='' purpose=''
2025-12-21 13:51:54,511 - thread-136261515871936.prometheus_context_collector - INFO - Successfully retrieved 1 context snippets
