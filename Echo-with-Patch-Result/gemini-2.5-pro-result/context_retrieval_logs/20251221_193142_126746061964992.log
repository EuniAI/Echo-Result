2025-12-21 19:31:42,149 - thread-126746061964992.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: units.quantity_input decorator fails for constructors with type hinted return value -> None

Description: ### Summary
I am using the `units.quantity_input` decorator with typing hints for constructors, however when I add the correct return value for the constructor (`None`) then I get an exception, because `None` has no attribute `to`.

### Reproducer
The issue can be reproduced with the following file:
``` Python
import astropy.units as u


class PoC(object):

    @u.quantity_input
    def __init__(self, voltage: u.V) -> None:
        pass


if __name__ == '__main__':
    poc = PoC(1.*u.V)
```
which results in the following error:
```
$ python3 poc.py
Traceback (most recent call last):
  File "poc.py", line 12, in <module>
    poc = PoC(1.*u.V)
  File "/usr/lib64/python3.6/site-packages/astropy/utils/decorators.py", line 868, in __init__
    func = make_function_with_signature(func, name=name, **wrapped_args)
  File "/usr/lib64/python3.6/site-packages/astropy/units/decorators.py", line 225, in wrapper
    return return_.to(wrapped_signature.return_annotation)
AttributeError: 'NoneType' object has no attribute 'to'
```

This has been tested on Fedora 27 with python 3.6.3, astropy 2.0.2 and numpy 1.13.3 all from Fedora's repository.

### Workaround
The issue can be circumvented by not adding the return type typing hint. Unfortunately, then a static type checker cannot infer that this function returns nothing.

### Possible fix
Maybe the decorator could explicitly check whether None is returned and then omit the unit check.

Patch information:
diff --git a/astropy/units/decorators.py b/astropy/units/decorators.py
index 8bece5a850..fc185cb5e0 100644
--- a/astropy/units/decorators.py
+++ b/astropy/units/decorators.py
@@ -221,6 +221,9 @@ class QuantityInput:
             with add_enabled_equivalencies(self.equivalencies):
                 return_ = wrapped_function(*func_args, **func_kwargs)
             if wrapped_signature.return_annotation is not inspect.Signature.empty:
+                # If the return value is None, return it directly without trying to convert units
+                if return_ is None:
+                    return None
                 return return_.to(wrapped_signature.return_annotation)
             else:
                 return return_


Find all relevant source code context needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

2025-12-21 19:31:42,326 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
astropy
├── .circleci
|   └── config.yml
├── .rtd-environment.yml
├── .travis.yml
├── CHANGES.rst
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── LICENSE.rst
├── README.rst
├── ah_bootstrap.py
├── appveyor.yml
├── astropy
|   ├── __init__.py
|   ├── _erfa
|   |   ├── __init__.py
|   |   ├── erfa_generator.py
|   |   ├── setup_package.py
|   |   └── tests
|   |       ├── __init__.py
|   |       └── test_erfa.py
|   ├── config
|   |   ├── __init__.py
|   |   ├── affiliated.py
|   |   ├── configuration.py
|   |   ├── paths.py
|   |   ├── setup_package.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── data
|   |       └── test_configs.py
|   ├── conftest.py
|   ├── constants
|   |   ├── __init__.py
|   |   ├── astropyconst13.py
|   |   ├── astropyconst20.py
|   |   ├── cgs.py
|   |   ├── codata2010.py
|   |   ├── codata2014.py
|   |   ├── constant.py
|   |   ├── iau2012.py
|   |   ├── iau2015.py
|   |   ├── si.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_constant.py
|   |   |   ├── test_pickle.py
|   |   |   └── test_prior_version.py
|   |   └── utils.py
|   ├── convolution
|   |   ├── __init__.py
|   |   ├── convolve.py
|   |   ├── core.py
|   |   ├── kernels.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_convolve.py
|   |   |   ├── test_convolve_fft.py
|   |   |   ├── test_convolve_kernels.py
|   |   |   ├── test_convolve_models.py
|   |   |   ├── test_convolve_nddata.py
|   |   |   ├── test_convolve_speeds.py
|   |   |   ├── test_discretize.py
|   |   |   ├── test_kernel_class.py
|   |   |   └── test_pickle.py
|   |   └── utils.py
|   ├── coordinates
|   |   ├── __init__.py
|   |   ├── angle_lextab.py
|   |   ├── angle_parsetab.py
|   |   ├── angle_utilities.py
|   |   ├── angles.py
|   |   ├── attributes.py
|   |   ├── baseframe.py
|   |   ├── builtin_frames
|   |   |   ├── __init__.py
|   |   |   ├── altaz.py
|   |   |   ├── baseradec.py
|   |   |   ├── cirs.py
|   |   |   ├── cirs_observed_transforms.py
|   |   |   ├── ecliptic.py
|   |   |   ├── ecliptic_transforms.py
|   |   |   ├── fk4.py
|   |   |   ├── fk4_fk5_transforms.py
|   |   |   ├── fk5.py
|   |   |   ├── galactic.py
|   |   |   ├── galactic_transforms.py
|   |   |   ├── galactocentric.py
|   |   |   ├── gcrs.py
|   |   |   ├── hcrs.py
|   |   |   ├── icrs.py
|   |   |   ├── icrs_cirs_transforms.py
|   |   |   ├── icrs_fk5_transforms.py
|   |   |   ├── intermediate_rotation_transforms.py
|   |   |   ├── itrs.py
|   |   |   ├── lsr.py
|   |   |   ├── skyoffset.py
|   |   |   ├── supergalactic.py
|   |   |   ├── supergalactic_transforms.py
|   |   |   └── utils.py
|   |   ├── calculation.py
|   |   ├── data
|   |   ├── distances.py
|   |   ├── earth.py
|   |   ├── earth_orientation.py
|   |   ├── errors.py
|   |   ├── funcs.py
|   |   ├── matching.py
|   |   ├── matrix_utilities.py
|   |   ├── name_resolve.py
|   |   ├── orbital_elements.py
|   |   ├── representation.py
|   |   ├── setup_package.py
|   |   ├── sites.py
|   |   ├── sky_coordinate.py
|   |   ├── solar_system.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── accuracy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── generate_ref_ast.py
|   |   |   |   ├── test_altaz_icrs.py
|   |   |   |   ├── test_ecliptic.py
|   |   |   |   ├── test_fk4_no_e_fk4.py
|   |   |   |   ├── test_fk4_no_e_fk5.py
|   |   |   |   ├── test_galactic_fk4.py
|   |   |   |   └── test_icrs_fk5.py
|   |   |   ├── test_angles.py
|   |   |   ├── test_angular_separation.py
|   |   |   ├── test_api_ape5.py
|   |   |   ├── test_arrays.py
|   |   |   ├── test_atc_replacements.py
|   |   |   ├── test_celestial_transformations.py
|   |   |   ├── test_distance.py
|   |   |   ├── test_earth.py
|   |   |   ├── test_finite_difference_velocities.py
|   |   |   ├── test_formatting.py
|   |   |   ├── test_frames.py
|   |   |   ├── test_frames_with_velocity.py
|   |   |   ├── test_funcs.py
|   |   |   ├── test_iau_fullstack.py
|   |   |   ├── test_intermediate_transformations.py
|   |   |   ├── test_matching.py
|   |   |   ├── test_matrix_utilities.py
|   |   |   ├── test_name_resolve.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_regression.py
|   |   |   ├── test_representation.py
|   |   |   ├── test_representation_arithmetic.py
|   |   |   ├── test_representation_methods.py
|   |   |   ├── test_shape_manipulation.py
|   |   |   ├── test_sites.py
|   |   |   ├── test_sky_coord.py
|   |   |   ├── test_sky_coord_velocities.py
|   |   |   ├── test_skyoffset_transformations.py
|   |   |   ├── test_solar_system.py
|   |   |   ├── test_transformations.py
|   |   |   ├── test_unit_representation.py
|   |   |   ├── test_velocity_corrs.py
|   |   |   └── utils.py
|   |   └── transformations.py
|   ├── cosmology
|   |   ├── __init__.py
|   |   ├── core.py
|   |   ├── funcs.py
|   |   ├── parameters.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── test_cosmology.py
|   |       └── test_pickle.py
|   ├── extern
|   |   ├── README.rst
|   |   ├── __init__.py
|   |   ├── bundled
|   |   |   ├── __init__.py
|   |   |   └── six.py
|   |   ├── configobj
|   |   |   ├── __init__.py
|   |   |   ├── configobj.py
|   |   |   └── validate.py
|   |   ├── css
|   |   |   └── jquery.dataTables.css
|   |   ├── js
|   |   |   ├── jquery-3.1.1.js
|   |   |   ├── jquery-3.1.1.min.js
|   |   |   ├── jquery.dataTables.js
|   |   |   └── jquery.dataTables.min.js
|   |   ├── ply
|   |   |   ├── __init__.py
|   |   |   ├── cpp.py
|   |   |   ├── ctokens.py
|   |   |   ├── lex.py
|   |   |   ├── yacc.py
|   |   |   └── ygen.py
|   |   ├── setup_package.py
|   |   └── six.py
|   ├── io
|   |   ├── __init__.py
|   |   ├── ascii
|   |   |   ├── __init__.py
|   |   |   ├── basic.py
|   |   |   ├── cds.py
|   |   |   ├── connect.py
|   |   |   ├── core.py
|   |   |   ├── daophot.py
|   |   |   ├── ecsv.py
|   |   |   ├── fastbasic.py
|   |   |   ├── fixedwidth.py
|   |   |   ├── html.py
|   |   |   ├── ipac.py
|   |   |   ├── latex.py
|   |   |   ├── misc.py
|   |   |   ├── rst.py
|   |   |   ├── setup_package.py
|   |   |   ├── sextractor.py
|   |   |   ├── src
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── common.py
|   |   |   |   ├── t
|   |   |   |   ├── test_c_reader.py
|   |   |   |   ├── test_cds_header_from_readme.py
|   |   |   |   ├── test_compressed.py
|   |   |   |   ├── test_connect.py
|   |   |   |   ├── test_ecsv.py
|   |   |   |   ├── test_fixedwidth.py
|   |   |   |   ├── test_html.py
|   |   |   |   ├── test_ipac_definitions.py
|   |   |   |   ├── test_read.py
|   |   |   |   ├── test_rst.py
|   |   |   |   ├── test_types.py
|   |   |   |   └── test_write.py
|   |   |   └── ui.py
|   |   ├── fits
|   |   |   ├── __init__.py
|   |   |   ├── _numpy_hacks.py
|   |   |   ├── card.py
|   |   |   ├── column.py
|   |   |   ├── connect.py
|   |   |   ├── convenience.py
|   |   |   ├── diff.py
|   |   |   ├── file.py
|   |   |   ├── fitsrec.py
|   |   |   ├── fitstime.py
|   |   |   ├── hdu
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── compressed.py
|   |   |   |   ├── groups.py
|   |   |   |   ├── hdulist.py
|   |   |   |   ├── image.py
|   |   |   |   ├── nonstandard.py
|   |   |   |   ├── streaming.py
|   |   |   |   └── table.py
|   |   |   ├── header.py
|   |   |   ├── scripts
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fitscheck.py
|   |   |   |   ├── fitsdiff.py
|   |   |   |   ├── fitsheader.py
|   |   |   |   └── fitsinfo.py
|   |   |   ├── setup_package.py
|   |   |   ├── src
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── data
|   |   |   |   ├── test_checksum.py
|   |   |   |   ├── test_compression_failures.py
|   |   |   |   ├── test_connect.py
|   |   |   |   ├── test_convenience.py
|   |   |   |   ├── test_core.py
|   |   |   |   ├── test_diff.py
|   |   |   |   ├── test_division.py
|   |   |   |   ├── test_fitscheck.py
|   |   |   |   ├── test_fitsdiff.py
|   |   |   |   ├── test_fitsheader.py
|   |   |   |   ├── test_fitsinfo.py
|   |   |   |   ├── test_fitstime.py
|   |   |   |   ├── test_groups.py
|   |   |   |   ├── test_hdulist.py
|   |   |   |   ├── test_header.py
|   |   |   |   ├── test_image.py
|   |   |   |   ├── test_nonstandard.py
|   |   |   |   ├── test_structured.py
|   |   |   |   ├── test_table.py
|   |   |   |   ├── test_uint.py
|   |   |   |   └── test_util.py
|   |   |   ├── util.py
|   |   |   └── verify.py
|   |   ├── misc
|   |   |   ├── __init__.py
|   |   |   ├── asdf
|   |   |   |   ├── __init__.py
|   |   |   |   ├── extension.py
|   |   |   |   ├── schemas
|   |   |   |   ├── setup_package.py
|   |   |   |   ├── tags
|   |   |   |   └── types.py
|   |   |   ├── connect.py
|   |   |   ├── hdf5.py
|   |   |   ├── pickle_helpers.py
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── test_hdf5.py
|   |   |   |   ├── test_pickle_helpers.py
|   |   |   |   └── test_yaml.py
|   |   |   └── yaml.py
|   |   ├── registry.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   └── test_registry.py
|   |   └── votable
|   |       ├── __init__.py
|   |       ├── connect.py
|   |       ├── converters.py
|   |       ├── data
|   |       |   └── ucd1p-words.txt
|   |       ├── exceptions.py
|   |       ├── setup_package.py
|   |       ├── src
|   |       |   └── tablewriter.c
|   |       ├── table.py
|   |       ├── tests
|   |       |   ├── __init__.py
|   |       |   ├── converter_test.py
|   |       |   ├── data
|   |       |   ├── exception_test.py
|   |       |   ├── resource_test.py
|   |       |   ├── table_test.py
|   |       |   ├── tree_test.py
|   |       |   ├── ucd_test.py
|   |       |   ├── util_test.py
|   |       |   └── vo_test.py
|   |       ├── tree.py
|   |       ├── ucd.py
|   |       ├── util.py
|   |       ├── validator
|   |       |   ├── __init__.py
|   |       |   ├── html.py
|   |       |   ├── main.py
|   |       |   ├── result.py
|   |       |   └── urls
|   |       ├── volint.py
|   |       └── xmlutil.py
|   ├── logger.py
|   ├── modeling
|   |   ├── __init__.py
|   |   ├── blackbody.py
|   |   ├── core.py
|   |   ├── fitting.py
|   |   ├── functional_models.py
|   |   ├── mappings.py
|   |   ├── models.py
|   |   ├── optimizers.py
|   |   ├── parameters.py
|   |   ├── polynomial.py
|   |   ├── powerlaws.py
|   |   ├── projections.py
|   |   ├── rotations.py
|   |   ├── separable.py
|   |   ├── setup_package.py
|   |   ├── src
|   |   ├── statistic.py
|   |   ├── tabular.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   |   └── __init__.py
|   |   |   ├── example_models.py
|   |   |   ├── irafutil.py
|   |   |   ├── test_blackbody.py
|   |   |   ├── test_compound.py
|   |   |   ├── test_constraints.py
|   |   |   ├── test_core.py
|   |   |   ├── test_fitters.py
|   |   |   ├── test_functional_models.py
|   |   |   ├── test_input.py
|   |   |   ├── test_mappings.py
|   |   |   ├── test_model_sets.py
|   |   |   ├── test_models.py
|   |   |   ├── test_models_quantities.py
|   |   |   ├── test_parameters.py
|   |   |   ├── test_polynomial.py
|   |   |   ├── test_projections.py
|   |   |   ├── test_quantities_evaluation.py
|   |   |   ├── test_quantities_fitting.py
|   |   |   ├── test_quantities_model.py
|   |   |   ├── test_quantities_parameters.py
|   |   |   ├── test_quantities_rotations.py
|   |   |   ├── test_rotations.py
|   |   |   ├── test_separable.py
|   |   |   ├── test_utils.py
|   |   |   └── utils.py
|   |   └── utils.py
|   ├── nddata
|   |   ├── __init__.py
|   |   ├── ccddata.py
|   |   ├── compat.py
|   |   ├── decorators.py
|   |   ├── flag_collection.py
|   |   ├── mixins
|   |   |   ├── __init__.py
|   |   |   ├── ndarithmetic.py
|   |   |   ├── ndio.py
|   |   |   ├── ndslicing.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── test_ndarithmetic.py
|   |   |       ├── test_ndio.py
|   |   |       └── test_ndslicing.py
|   |   ├── nddata.py
|   |   ├── nddata_base.py
|   |   ├── nddata_withmixins.py
|   |   ├── nduncertainty.py
|   |   ├── setup_package.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   ├── test_ccddata.py
|   |   |   ├── test_compat.py
|   |   |   ├── test_decorators.py
|   |   |   ├── test_flag_collection.py
|   |   |   ├── test_nddata.py
|   |   |   ├── test_nddata_base.py
|   |   |   ├── test_nduncertainty.py
|   |   |   └── test_utils.py
|   |   └── utils.py
|   ├── samp
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── constants.py
|   |   ├── data
|   |   |   ├── clientaccesspolicy.xml
|   |   |   └── crossdomain.xml
|   |   ├── errors.py
|   |   ├── hub.py
|   |   ├── hub_proxy.py
|   |   ├── hub_script.py
|   |   ├── integrated_client.py
|   |   ├── lockfile_helpers.py
|   |   ├── setup_package.py
|   |   ├── standard_profile.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_client.py
|   |   |   ├── test_errors.py
|   |   |   ├── test_helpers.py
|   |   |   ├── test_hub.py
|   |   |   ├── test_hub_proxy.py
|   |   |   ├── test_hub_script.py
|   |   |   ├── test_standard_profile.py
|   |   |   ├── test_web_profile.py
|   |   |   └── web_profile_test_helpers.py
|   |   ├── utils.py
|   |   └── web_profile.py
|   ├── setup_package.py
|   ├── stats
|   |   ├── __init__.py
|   |   ├── bayesian_blocks.py
|   |   ├── biweight.py
|   |   ├── circstats.py
|   |   ├── funcs.py
|   |   ├── histogram.py
|   |   ├── info_theory.py
|   |   ├── jackknife.py
|   |   ├── lombscargle
|   |   |   ├── __init__.py
|   |   |   ├── _statistics.py
|   |   |   ├── core.py
|   |   |   ├── implementations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── chi2_impl.py
|   |   |   |   ├── fast_impl.py
|   |   |   |   ├── fastchi2_impl.py
|   |   |   |   ├── main.py
|   |   |   |   ├── mle.py
|   |   |   |   ├── scipy_impl.py
|   |   |   |   ├── slow_impl.py
|   |   |   |   ├── tests
|   |   |   |   └── utils.py
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── test_lombscargle.py
|   |   |   |   ├── test_statistics.py
|   |   |   |   └── test_utils.py
|   |   |   └── utils.py
|   |   ├── sigma_clipping.py
|   |   ├── spatial.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── test_bayesian_blocks.py
|   |       ├── test_biweight.py
|   |       ├── test_circstats.py
|   |       ├── test_funcs.py
|   |       ├── test_histogram.py
|   |       ├── test_info_theory.py
|   |       ├── test_jackknife.py
|   |       ├── test_sigma_clipping.py
|   |       └── test_spatial.py
|   ├── table
|   |   ├── __init__.py
|   |   ├── bst.py
|   |   ├── column.py
|   |   ├── groups.py
|   |   ├── index.py
|   |   ├── info.py
|   |   ├── jsviewer.py
|   |   ├── meta.py
|   |   ├── np_utils.py
|   |   ├── operations.py
|   |   ├── pandas.py
|   |   ├── pprint.py
|   |   ├── row.py
|   |   ├── scripts
|   |   |   ├── __init__.py
|   |   |   └── showtable.py
|   |   ├── serialize.py
|   |   ├── setup_package.py
|   |   ├── sorted_array.py
|   |   ├── table.py
|   |   ├── table_helpers.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── conftest.py
|   |       ├── test_array.py
|   |       ├── test_bst.py
|   |       ├── test_column.py
|   |       ├── test_groups.py
|   |       ├── test_index.py
|   |       ├── test_info.py
|   |       ├── test_init_table.py
|   |       ├── test_item_access.py
|   |       ├── test_jsviewer.py
|   |       ├── test_masked.py
|   |       ├── test_mixin.py
|   |       ├── test_np_utils.py
|   |       ├── test_operations.py
|   |       ├── test_pickle.py
|   |       ├── test_pprint.py
|   |       ├── test_row.py
|   |       ├── test_showtable.py
|   |       ├── test_subclass.py
|   |       └── test_table.py
|   ├── tests
|   |   ├── __init__.py
|   |   ├── command.py
|   |   ├── disable_internet.py
|   |   ├── helper.py
|   |   ├── image_tests.py
|   |   ├── plugins
|   |   |   ├── __init__.py
|   |   |   ├── config.py
|   |   |   └── display.py
|   |   ├── pytest_plugins.py
|   |   ├── runner.py
|   |   ├── setup_package.py
|   |   ├── test_logger.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── test_imports.py
|   |       ├── test_quantity_helpers.py
|   |       ├── test_run_tests.py
|   |       └── test_runner.py
|   ├── time
|   |   ├── __init__.py
|   |   ├── core.py
|   |   ├── formats.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_basic.py
|   |   |   ├── test_comparisons.py
|   |   |   ├── test_corrs.py
|   |   |   ├── test_delta.py
|   |   |   ├── test_guess.py
|   |   |   ├── test_mask.py
|   |   |   ├── test_methods.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_precision.py
|   |   |   ├── test_quantity_interaction.py
|   |   |   ├── test_sidereal.py
|   |   |   └── test_ut1.py
|   |   └── utils.py
|   ├── units
|   |   ├── __init__.py
|   |   ├── astrophys.py
|   |   ├── cds.py
|   |   ├── cgs.py
|   |   ├── core.py
|   |   ├── decorators.py
|   |   ├── deprecated.py
|   |   ├── equivalencies.py
|   |   ├── format
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── cds.py
|   |   |   ├── cds_lextab.py
|   |   |   ├── cds_parsetab.py
|   |   |   ├── console.py
|   |   |   ├── fits.py
|   |   |   ├── generic.py
|   |   |   ├── generic_lextab.py
|   |   |   ├── generic_parsetab.py
|   |   |   ├── latex.py
|   |   |   ├── ogip.py
|   |   |   ├── ogip_lextab.py
|   |   |   ├── ogip_parsetab.py
|   |   |   ├── unicode_format.py
|   |   |   ├── utils.py
|   |   |   └── vounit.py
|   |   ├── function
|   |   |   ├── __init__.py
|   |   |   ├── core.py
|   |   |   ├── logarithmic.py
|   |   |   ├── magnitude_zero_points.py
|   |   |   ├── mixin.py
|   |   |   └── units.py
|   |   ├── imperial.py
|   |   ├── physical.py
|   |   ├── quantity.py
|   |   ├── quantity_helper.py
|   |   ├── required_by_vounit.py
|   |   ├── si.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── py3_test_quantity_annotations.py
|   |   |   ├── test_deprecated.py
|   |   |   ├── test_equivalencies.py
|   |   |   ├── test_format.py
|   |   |   ├── test_logarithmic.py
|   |   |   ├── test_physical.py
|   |   |   ├── test_quantity.py
|   |   |   ├── test_quantity_array_methods.py
|   |   |   ├── test_quantity_decorator.py
|   |   |   ├── test_quantity_non_ufuncs.py
|   |   |   ├── test_quantity_ufuncs.py
|   |   |   └── test_units.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── argparse.py
|   |   ├── codegen.py
|   |   ├── collections.py
|   |   ├── compat
|   |   |   ├── __init__.py
|   |   |   ├── funcsigs.py
|   |   |   ├── futures
|   |   |   |   └── __init__.py
|   |   |   ├── misc.py
|   |   |   ├── numpy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── core
|   |   |   |   ├── lib
|   |   |   |   └── tests
|   |   |   └── numpycompat.py
|   |   ├── console.py
|   |   ├── data.py
|   |   ├── data_info.py
|   |   ├── decorators.py
|   |   ├── exceptions.py
|   |   ├── iers
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   ├── iers.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       └── test_iers.py
|   |   ├── introspection.py
|   |   ├── metadata.py
|   |   ├── misc.py
|   |   ├── setup_package.py
|   |   ├── src
|   |   ├── state.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   |   ├── .hidden_file.txt
|   |   |   |   ├── test_package
|   |   |   |   └── unicode.txt
|   |   |   ├── test_codegen.py
|   |   |   ├── test_collections.py
|   |   |   ├── test_console.py
|   |   |   ├── test_data.py
|   |   |   ├── test_data_info.py
|   |   |   ├── test_decorators.py
|   |   |   ├── test_introspection.py
|   |   |   ├── test_metadata.py
|   |   |   ├── test_misc.py
|   |   |   ├── test_progress_bar_func.py
|   |   |   ├── test_timer.py
|   |   |   └── test_xml.py
|   |   ├── timer.py
|   |   └── xml
|   |       ├── __init__.py
|   |       ├── check.py
|   |       ├── iterparser.py
|   |       ├── setup_package.py
|   |       ├── src
|   |       |   └── iterparse.c
|   |       ├── tests
|   |       |   ├── __init__.py
|   |       |   └── test_iterparse.py
|   |       ├── unescaper.py
|   |       ├── validate.py
|   |       └── writer.py
|   ├── visualization
|   |   ├── __init__.py
|   |   ├── hist.py
|   |   ├── interval.py
|   |   ├── lupton_rgb.py
|   |   ├── mpl_normalize.py
|   |   ├── mpl_style.py
|   |   ├── scripts
|   |   |   ├── __init__.py
|   |   |   ├── fits2bitmap.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       └── test_fits2bitmap.py
|   |   ├── stretch.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_histogram.py
|   |   |   ├── test_interval.py
|   |   |   ├── test_lupton_rgb.py
|   |   |   ├── test_norm.py
|   |   |   ├── test_stretch.py
|   |   |   └── test_units.py
|   |   ├── transform.py
|   |   ├── units.py
|   |   └── wcsaxes
|   |       ├── __init__.py
|   |       ├── axislabels.py
|   |       ├── coordinate_helpers.py
|   |       ├── coordinate_range.py
|   |       ├── coordinates_map.py
|   |       ├── core.py
|   |       ├── formatter_locator.py
|   |       ├── frame.py
|   |       ├── grid_paths.py
|   |       ├── patches.py
|   |       ├── tests
|   |       |   ├── __init__.py
|   |       |   ├── data
|   |       |   ├── datasets.py
|   |       |   ├── setup_package.py
|   |       |   ├── test_coordinate_helpers.py
|   |       |   ├── test_display_world_coordinates.py
|   |       |   ├── test_formatter_locator.py
|   |       |   ├── test_frame.py
|   |       |   ├── test_images.py
|   |       |   ├── test_misc.py
|   |       |   ├── test_transform_coord_meta.py
|   |       |   ├── test_transforms.py
|   |       |   └── test_utils.py
|   |       ├── ticklabels.py
|   |       ├── ticks.py
|   |       ├── transforms.py
|   |       └── utils.py
|   └── wcs
|       ├── __init__.py
|       ├── _docutil.py
|       ├── docstrings.py
|       ├── include
|       |   ├── astropy_wcs
|       |   └── wcslib
|       ├── setup_package.py
|       ├── src
|       |   ├── astropy_wcs.c
|       |   ├── astropy_wcs_api.c
|       |   ├── distortion.c
|       |   ├── distortion_wrap.c
|       |   ├── pipeline.c
|       |   ├── pyutil.c
|       |   ├── sip.c
|       |   ├── sip_wrap.c
|       |   ├── str_list_proxy.c
|       |   ├── unit_list_proxy.c
|       |   ├── util.c
|       |   ├── wcslib_tabprm_wrap.c
|       |   └── wcslib_wrap.c
|       ├── tests
|       |   ├── __init__.py
|       |   ├── data
|       |   |   ├── validate.5.0.txt
|       |   |   ├── validate.5.13.txt
|       |   |   └── validate.txt
|       |   ├── extension
|       |   |   ├── __init__.py
|       |   |   ├── setup.py
|       |   |   ├── test_extension.py
|       |   |   └── wcsapi_test.c
|       |   ├── maps
|       |   ├── spectra
|       |   ├── test_pickle.py
|       |   ├── test_profiling.py
|       |   ├── test_utils.py
|       |   ├── test_wcs.py
|       |   └── test_wcsprm.py
|       ├── utils.py
|       ├── wcs.py
|       └── wcslint.py
├── astropy_helpers
├── cextern
|   ├── README.rst
|   ├── cfitsio
|   |   ├── License.txt
|   |   ├── README.txt
|   |   ├── docs
|   |   |   └── changes.txt
|   |   ├── lib
|   |   |   ├── buffers.c
|   |   |   ├── cfileio.c
|   |   |   ├── checksum.c
|   |   |   ├── drvrfile.c
|   |   |   ├── drvrgsiftp.c
|   |   |   ├── drvrmem.c
|   |   |   ├── drvrnet.c
|   |   |   ├── drvrsmem.c
|   |   |   ├── editcol.c
|   |   |   ├── edithdu.c
|   |   |   ├── eval_f.c
|   |   |   ├── eval_l.c
|   |   |   ├── eval_y.c
|   |   |   ├── fits_hcompress.c
|   |   |   ├── fits_hdecompress.c
|   |   |   ├── fitscore.c
|   |   |   ├── getcol.c
|   |   |   ├── getcolb.c
|   |   |   ├── getcold.c
|   |   |   ├── getcole.c
|   |   |   ├── getcoli.c
|   |   |   ├── getcolj.c
|   |   |   ├── getcolk.c
|   |   |   ├── getcoll.c
|   |   |   ├── getcols.c
|   |   |   ├── getcolsb.c
|   |   |   ├── getcolui.c
|   |   |   ├── getcoluj.c
|   |   |   ├── getcoluk.c
|   |   |   ├── getkey.c
|   |   |   ├── group.c
|   |   |   ├── grparser.c
|   |   |   ├── histo.c
|   |   |   ├── imcompress.c
|   |   |   ├── iraffits.c
|   |   |   ├── modkey.c
|   |   |   ├── pliocomp.c
|   |   |   ├── putcol.c
|   |   |   ├── putcolb.c
|   |   |   ├── putcold.c
|   |   |   ├── putcole.c
|   |   |   ├── putcoli.c
|   |   |   ├── putcolj.c
|   |   |   ├── putcolk.c
|   |   |   ├── putcoll.c
|   |   |   ├── putcols.c
|   |   |   ├── putcolsb.c
|   |   |   ├── putcolu.c
|   |   |   ├── putcolui.c
|   |   |   ├── putcoluj.c
|   |   |   ├── putcoluk.c
|   |   |   ├── putkey.c
|   |   |   ├── quantize.c
|   |   |   ├── region.c
|   |   |   ├── ricecomp.c
|   |   |   ├── scalnull.c
|   |   |   ├── simplerng.c
|   |   |   ├── swapproc.c
|   |   |   ├── wcssub.c
|   |   |   └── wcsutil.c
|   |   └── zlib
|   |       ├── adler32.c
|   |       ├── crc32.c
|   |       ├── deflate.c
|   |       ├── infback.c
|   |       ├── inffast.c
|   |       ├── inflate.c
|   |       ├── inftrees.c
|   |       ├── trees.c
|   |       ├── uncompr.c
|   |       ├── zcompress.c
|   |       ├── zuncompress.c
|   |       └── zutil.c
|   ├── erfa
|   |   ├── README.rst
|   |   ├── a2af.c
|   |   ├── a2tf.c
|   |   ├── ab.c
|   |   ├── af2a.c
|   |   ├── anp.c
|   |   ├── anpm.c
|   |   ├── apcg.c
|   |   ├── apcg13.c
|   |   ├── apci.c
|   |   ├── apci13.c
|   |   ├── apco.c
|   |   ├── apco13.c
|   |   ├── apcs.c
|   |   ├── apcs13.c
|   |   ├── aper.c
|   |   ├── aper13.c
|   |   ├── apio.c
|   |   ├── apio13.c
|   |   ├── atci13.c
|   |   ├── atciq.c
|   |   ├── atciqn.c
|   |   ├── atciqz.c
|   |   ├── atco13.c
|   |   ├── atic13.c
|   |   ├── aticq.c
|   |   ├── aticqn.c
|   |   ├── atio13.c
|   |   ├── atioq.c
|   |   ├── atoc13.c
|   |   ├── atoi13.c
|   |   ├── atoiq.c
|   |   ├── bi00.c
|   |   ├── bp00.c
|   |   ├── bp06.c
|   |   ├── bpn2xy.c
|   |   ├── c2i00a.c
|   |   ├── c2i00b.c
|   |   ├── c2i06a.c
|   |   ├── c2ibpn.c
|   |   ├── c2ixy.c
|   |   ├── c2ixys.c
|   |   ├── c2s.c
|   |   ├── c2t00a.c
|   |   ├── c2t00b.c
|   |   ├── c2t06a.c
|   |   ├── c2tcio.c
|   |   ├── c2teqx.c
|   |   ├── c2tpe.c
|   |   ├── c2txy.c
|   |   ├── cal2jd.c
|   |   ├── cp.c
|   |   ├── cpv.c
|   |   ├── cr.c
|   |   ├── d2dtf.c
|   |   ├── d2tf.c
|   |   ├── dat.c
|   |   ├── dtdb.c
|   |   ├── dtf2d.c
|   |   ├── eceq06.c
|   |   ├── ecm06.c
|   |   ├── ee00.c
|   |   ├── ee00a.c
|   |   ├── ee00b.c
|   |   ├── ee06a.c
|   |   ├── eect00.c
|   |   ├── eform.c
|   |   ├── eo06a.c
|   |   ├── eors.c
|   |   ├── epb.c
|   |   ├── epb2jd.c
|   |   ├── epj.c
|   |   ├── epj2jd.c
|   |   ├── epv00.c
|   |   ├── eqec06.c
|   |   ├── eqeq94.c
|   |   ├── era00.c
|   |   ├── erfaversion.c
|   |   ├── fad03.c
|   |   ├── fae03.c
|   |   ├── faf03.c
|   |   ├── faju03.c
|   |   ├── fal03.c
|   |   ├── falp03.c
|   |   ├── fama03.c
|   |   ├── fame03.c
|   |   ├── fane03.c
|   |   ├── faom03.c
|   |   ├── fapa03.c
|   |   ├── fasa03.c
|   |   ├── faur03.c
|   |   ├── fave03.c
|   |   ├── fk52h.c
|   |   ├── fk5hip.c
|   |   ├── fk5hz.c
|   |   ├── fw2m.c
|   |   ├── fw2xy.c
|   |   ├── g2icrs.c
|   |   ├── gc2gd.c
|   |   ├── gc2gde.c
|   |   ├── gd2gc.c
|   |   ├── gd2gce.c
|   |   ├── gmst00.c
|   |   ├── gmst06.c
|   |   ├── gmst82.c
|   |   ├── gst00a.c
|   |   ├── gst00b.c
|   |   ├── gst06.c
|   |   ├── gst06a.c
|   |   ├── gst94.c
|   |   ├── h2fk5.c
|   |   ├── hfk5z.c
|   |   ├── icrs2g.c
|   |   ├── ir.c
|   |   ├── jd2cal.c
|   |   ├── jdcalf.c
|   |   ├── ld.c
|   |   ├── ldn.c
|   |   ├── ldsun.c
|   |   ├── lteceq.c
|   |   ├── ltecm.c
|   |   ├── lteqec.c
|   |   ├── ltp.c
|   |   ├── ltpb.c
|   |   ├── ltpecl.c
|   |   ├── ltpequ.c
|   |   ├── num00a.c
|   |   ├── num00b.c
|   |   ├── num06a.c
|   |   ├── numat.c
|   |   ├── nut00a.c
|   |   ├── nut00b.c
|   |   ├── nut06a.c
|   |   ├── nut80.c
|   |   ├── nutm80.c
|   |   ├── obl06.c
|   |   ├── obl80.c
|   |   ├── p06e.c
|   |   ├── p2pv.c
|   |   ├── p2s.c
|   |   ├── pap.c
|   |   ├── pas.c
|   |   ├── pb06.c
|   |   ├── pdp.c
|   |   ├── pfw06.c
|   |   ├── plan94.c
|   |   ├── pm.c
|   |   ├── pmat00.c
|   |   ├── pmat06.c
|   |   ├── pmat76.c
|   |   ├── pmp.c
|   |   ├── pmpx.c
|   |   ├── pmsafe.c
|   |   ├── pn.c
|   |   ├── pn00.c
|   |   ├── pn00a.c
|   |   ├── pn00b.c
|   |   ├── pn06.c
|   |   ├── pn06a.c
|   |   ├── pnm00a.c
|   |   ├── pnm00b.c
|   |   ├── pnm06a.c
|   |   ├── pnm80.c
|   |   ├── pom00.c
|   |   ├── ppp.c
|   |   ├── ppsp.c
|   |   ├── pr00.c
|   |   ├── prec76.c
|   |   ├── pv2p.c
|   |   ├── pv2s.c
|   |   ├── pvdpv.c
|   |   ├── pvm.c
|   |   ├── pvmpv.c
|   |   ├── pvppv.c
|   |   ├── pvstar.c
|   |   ├── pvtob.c
|   |   ├── pvu.c
|   |   ├── pvup.c
|   |   ├── pvxpv.c
|   |   ├── pxp.c
|   |   ├── refco.c
|   |   ├── rm2v.c
|   |   ├── rv2m.c
|   |   ├── rx.c
|   |   ├── rxp.c
|   |   ├── rxpv.c
|   |   ├── rxr.c
|   |   ├── ry.c
|   |   ├── rz.c
|   |   ├── s00.c
|   |   ├── s00a.c
|   |   ├── s00b.c
|   |   ├── s06.c
|   |   ├── s06a.c
|   |   ├── s2c.c
|   |   ├── s2p.c
|   |   ├── s2pv.c
|   |   ├── s2xpv.c
|   |   ├── sepp.c
|   |   ├── seps.c
|   |   ├── sp00.c
|   |   ├── starpm.c
|   |   ├── starpv.c
|   |   ├── sxp.c
|   |   ├── sxpv.c
|   |   ├── taitt.c
|   |   ├── taiut1.c
|   |   ├── taiutc.c
|   |   ├── tcbtdb.c
|   |   ├── tcgtt.c
|   |   ├── tdbtcb.c
|   |   ├── tdbtt.c
|   |   ├── tf2a.c
|   |   ├── tf2d.c
|   |   ├── tr.c
|   |   ├── trxp.c
|   |   ├── trxpv.c
|   |   ├── tttai.c
|   |   ├── tttcg.c
|   |   ├── tttdb.c
|   |   ├── ttut1.c
|   |   ├── ut1tai.c
|   |   ├── ut1tt.c
|   |   ├── ut1utc.c
|   |   ├── utctai.c
|   |   ├── utcut1.c
|   |   ├── xy06.c
|   |   ├── xys00a.c
|   |   ├── xys00b.c
|   |   ├── xys06a.c
|   |   ├── zp.c
|   |   ├── zpv.c
|   |   └── zr.c
|   ├── expat
|   |   ├── CMakeLists.txt
|   |   ├── amiga
|   |   |   ├── README.txt
|   |   |   ├── expat.xml
|   |   |   ├── expat_68k.c
|   |   |   ├── expat_68k_handler_stubs.c
|   |   |   ├── expat_lib.c
|   |   |   ├── expat_vectors.c
|   |   |   ├── include
|   |   |   |   ├── inline4
|   |   |   |   ├── interfaces
|   |   |   |   ├── libraries
|   |   |   |   └── proto
|   |   |   ├── launch.c
|   |   |   └── stdlib.c
|   |   ├── bcb5
|   |   |   └── README.txt
|   |   ├── conftools
|   |   |   ├── get-version.sh
|   |   |   └── ltmain.sh
|   |   ├── doc
|   |   |   ├── reference.html
|   |   |   └── style.css
|   |   ├── examples
|   |   |   ├── elements.c
|   |   |   └── outline.c
|   |   ├── lib
|   |   |   ├── xmlparse.c
|   |   |   ├── xmlrole.c
|   |   |   ├── xmltok.c
|   |   |   ├── xmltok_impl.c
|   |   |   └── xmltok_ns.c
|   |   ├── m4
|   |   ├── tests
|   |   |   ├── README.txt
|   |   |   ├── benchmark
|   |   |   |   ├── README.txt
|   |   |   |   └── benchmark.c
|   |   |   ├── chardata.c
|   |   |   ├── minicheck.c
|   |   |   ├── runtests.c
|   |   |   ├── runtestspp.cpp
|   |   |   └── xmltest.sh
|   |   ├── vms
|   |   ├── win32
|   |   |   ├── MANIFEST.txt
|   |   |   └── README.txt
|   |   └── xmlwf
|   |       ├── codepage.c
|   |       ├── ct.c
|   |       ├── readfilemap.c
|   |       ├── unixfilemap.c
|   |       ├── win32filemap.c
|   |       ├── xmlfile.c
|   |       ├── xmlmime.c
|   |       ├── xmlwf.c
|   |       └── xmlwin32url.cxx
|   ├── trim_cfitsio.sh
|   ├── trim_wcslib.sh
|   └── wcslib
|       ├── C
|       |   ├── cel.c
|       |   ├── dis.c
|       |   ├── flexed
|       |   |   ├── fitshdr.c
|       |   |   ├── wcsbth.c
|       |   |   ├── wcspih.c
|       |   |   ├── wcsulex.c
|       |   |   └── wcsutrn.c
|       |   ├── getwcstab.c
|       |   ├── lin.c
|       |   ├── log.c
|       |   ├── prj.c
|       |   ├── spc.c
|       |   ├── sph.c
|       |   ├── spx.c
|       |   ├── tab.c
|       |   ├── wcs.c
|       |   ├── wcserr.c
|       |   ├── wcsfix.c
|       |   ├── wcshdr.c
|       |   ├── wcsprintf.c
|       |   ├── wcstrig.c
|       |   ├── wcsunits.c
|       |   └── wcsutil.c
|       └── config
├── conftest.py
├── docs
|   ├── _pkgtemplate.rst
|   ├── _static
|   ├── changelog.rst
|   ├── conf.py
|   ├── config
|   |   ├── config_0_4_transition.rst
|   |   └── index.rst
|   ├── constants
|   |   └── index.rst
|   ├── convolution
|   |   ├── images
|   |   ├── index.rst
|   |   ├── kernels.rst
|   |   ├── non_normalized_kernels.rst
|   |   └── using.rst
|   ├── coordinates
|   |   ├── angles.rst
|   |   ├── apply_space_motion.rst
|   |   ├── definitions.rst
|   |   ├── formatting.rst
|   |   ├── frames.rst
|   |   ├── galactocentric.rst
|   |   ├── index.rst
|   |   ├── inplace.rst
|   |   ├── matchsep.rst
|   |   ├── references.txt
|   |   ├── remote_methods.rst
|   |   ├── representations.rst
|   |   ├── skycoord.rst
|   |   ├── solarsystem.rst
|   |   ├── transforming.rst
|   |   └── velocities.rst
|   ├── cosmology
|   |   └── index.rst
|   ├── credits.rst
|   ├── development
|   |   ├── astropy-package-template.rst
|   |   ├── building.rst
|   |   ├── ccython.rst
|   |   ├── codeguide.rst
|   |   ├── codeguide_emacs.rst
|   |   ├── docguide.rst
|   |   ├── docrules.rst
|   |   ├── releasing.rst
|   |   ├── scripts.rst
|   |   ├── testguide.rst
|   |   ├── vision.rst
|   |   └── workflow
|   |       ├── additional_git_topics.rst
|   |       ├── command_history.rst
|   |       ├── command_history.sh
|   |       ├── command_history_with_output.sh
|   |       ├── development_workflow.rst
|   |       ├── get_devel_version.rst
|   |       ├── git_edit_workflow_examples.rst
|   |       ├── git_install.rst
|   |       ├── git_resources.rst
|   |       ├── maintainer_workflow.rst
|   |       ├── patches.rst
|   |       ├── terminal_cast.rst
|   |       ├── virtual_pythons.rst
|   |       └── virtualenv_detail.rst
|   ├── getting_started.rst
|   ├── importing_astropy.rst
|   ├── index.rst
|   ├── install.rst
|   ├── io
|   |   ├── ascii
|   |   |   ├── base_classes.rst
|   |   |   ├── extension_classes.rst
|   |   |   ├── fast_ascii_io.rst
|   |   |   ├── fixed_width_gallery.rst
|   |   |   ├── index.rst
|   |   |   ├── read.rst
|   |   |   ├── references.txt
|   |   |   ├── toc.txt
|   |   |   └── write.rst
|   |   ├── fits
|   |   |   ├── api
|   |   |   |   ├── cards.rst
|   |   |   |   ├── diff.rst
|   |   |   |   ├── files.rst
|   |   |   |   ├── hdulists.rst
|   |   |   |   ├── hdus.rst
|   |   |   |   ├── headers.rst
|   |   |   |   ├── images.rst
|   |   |   |   ├── tables.rst
|   |   |   |   └── verification.rst
|   |   |   ├── appendix
|   |   |   |   ├── faq.rst
|   |   |   |   ├── header_transition.rst
|   |   |   |   └── history.rst
|   |   |   ├── index.rst
|   |   |   └── usage
|   |   |       ├── headers.rst
|   |   |       ├── image.rst
|   |   |       ├── misc.rst
|   |   |       ├── scripts.rst
|   |   |       ├── table.rst
|   |   |       ├── unfamiliar.rst
|   |   |       └── verification.rst
|   |   ├── misc.rst
|   |   ├── registry.rst
|   |   ├── unified.rst
|   |   └── votable
|   |       ├── api_exceptions.rst
|   |       ├── index.rst
|   |       └── references.txt
|   ├── known_issues.rst
|   ├── license.rst
|   ├── logging.rst
|   ├── modeling
|   |   ├── algorithms.rst
|   |   ├── bounding-boxes.rst
|   |   ├── compound-models.rst
|   |   ├── fitting.rst
|   |   ├── index.rst
|   |   ├── models.rst
|   |   ├── new.rst
|   |   ├── parameters.rst
|   |   └── units.rst
|   ├── nddata
|   |   ├── ccddata.rst
|   |   ├── decorator.rst
|   |   ├── index.rst
|   |   ├── mixins
|   |   |   ├── index.rst
|   |   |   ├── ndarithmetic.rst
|   |   |   ├── ndio.rst
|   |   |   └── ndslicing.rst
|   |   ├── nddata.rst
|   |   ├── subclassing.rst
|   |   └── utils.rst
|   ├── overview.rst
|   ├── samp
|   |   ├── advanced_embed_samp_hub.rst
|   |   ├── example_clients.rst
|   |   ├── example_hub.rst
|   |   ├── example_table_image.rst
|   |   ├── index.rst
|   |   └── references.txt
|   ├── stability.rst
|   ├── stats
|   |   ├── circ.rst
|   |   ├── index.rst
|   |   ├── lombscargle.rst
|   |   ├── ripley.rst
|   |   └── robust.rst
|   ├── table
|   |   ├── access_table.rst
|   |   ├── construct_table.rst
|   |   ├── implementation_details.rst
|   |   ├── index.rst
|   |   ├── indexing.rst
|   |   ├── io.rst
|   |   ├── masking.rst
|   |   ├── mixin_columns.rst
|   |   ├── modify_table.rst
|   |   ├── operations.rst
|   |   ├── pandas.rst
|   |   └── references.txt
|   ├── testhelpers.rst
|   ├── time
|   |   ├── index.rst
|   |   └── references.txt
|   ├── units
|   |   ├── combining_and_defining.rst
|   |   ├── conversion.rst
|   |   ├── decomposing_and_composing.rst
|   |   ├── equivalencies.rst
|   |   ├── format.rst
|   |   ├── index.rst
|   |   ├── logarithmic_units.rst
|   |   ├── quantity.rst
|   |   └── standard_units.rst
|   ├── utils
|   |   ├── iers.rst
|   |   ├── index.rst
|   |   └── numpy.rst
|   ├── visualization
|   |   ├── histogram.rst
|   |   ├── index.rst
|   |   ├── lupton_rgb.rst
|   |   ├── normalization.rst
|   |   └── wcsaxes
|   |       ├── controlling_axes.rst
|   |       ├── custom_frames.rst
|   |       ├── images_contours.rst
|   |       ├── index.rst
|   |       ├── initializing_axes.rst
|   |       ├── overlaying_coordinate_systems.rst
|   |       ├── overlays.rst
|   |       ├── slicing_datacubes.rst
|   |       └── ticks_labels_grid.rst
|   ├── warnings.rst
|   ├── wcs
|   |   ├── examples
|   |   |   ├── from_file.py
|   |   |   └── programmatic.py
|   |   ├── history.rst
|   |   ├── index.rst
|   |   ├── note_sip.rst
|   |   ├── references.rst
|   |   ├── references.txt
|   |   └── relax.rst
|   └── whatsnew
|       ├── 0.1.rst
|       ├── 0.2.rst
|       ├── 0.3.rst
|       ├── 0.4.rst
|       ├── 1.0.rst
|       ├── 1.1.rst
|       ├── 1.2.rst
|       ├── 1.3.rst
|       ├── 2.0.rst
|       ├── 3.0.rst
|       ├── 3.1.rst
|       └── index.rst
├── examples
|   ├── README.txt
|   ├── coordinates
|   |   ├── README.txt
|   |   ├── plot_galactocentric-frame.py
|   |   ├── plot_obs-planning.py
|   |   ├── plot_sgr-coordinate-frame.py
|   |   └── rv-to-gsr.py
|   ├── io
|   |   ├── README.txt
|   |   ├── create-mef.py
|   |   ├── fits-tables.py
|   |   ├── modify-fits-header.py
|   |   ├── plot_fits-image.py
|   |   ├── skip_create-large-fits.py
|   |   └── split-jpeg-to-fits.py
|   └── template
|       └── example-template.py
├── ez_setup.py
├── licenses
|   ├── AURA_LICENSE.rst
|   ├── CONFIGOBJ_LICENSE.rst
|   ├── DATATABLES_LICENSE.rst
|   ├── ERFA.rst
|   ├── EXPAT_LICENSE.rst
|   ├── JQUERY_LICENSE.rst
|   ├── NUMPY_LICENSE.rst
|   ├── PLY_LICENSE.rst
|   ├── PYFITS.rst
|   ├── README.rst
|   └── WCSLIB_LICENSE.rst
├── readthedocs.yml
├── setup.py
└── static
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: units.quantity_input decorator fails for constructors with type hinted return value -> None

Description: ### Summary
I am using the `units.quantity_input` decorator with typing hints for constructors, however when I add the correct return value for the constructor (`None`) then I get an exception, because `None` has no attribute `to`.

### Reproducer
The issue can be reproduced with the following file:
``` Python
import astropy.units as u


class PoC(object):

    @u.quantity_input
    def __init__(self, voltage: u.V) -> None:
        pass


if __name__ == '__main__':
    poc = PoC(1.*u.V)
```
which results in the following error:
```
$ python3 poc.py
Traceback (most recent call last):
  File "poc.py", line 12, in <module>
    poc = PoC(1.*u.V)
  File "/usr/lib64/python3.6/site-packages/astropy/utils/decorators.py", line 868, in __init__
    func = make_function_with_signature(func, name=name, **wrapped_args)
  File "/usr/lib64/python3.6/site-packages/astropy/units/decorators.py", line 225, in wrapper
    return return_.to(wrapped_signature.return_annotation)
AttributeError: 'NoneType' object has no attribute 'to'
```

This has been tested on Fedora 27 with python 3.6.3, astropy 2.0.2 and numpy 1.13.3 all from Fedora's repository.

### Workaround
The issue can be circumvented by not adding the return type typing hint. Unfortunately, then a static type checker cannot infer that this function returns nothing.

### Possible fix
Maybe the decorator could explicitly check whether None is returned and then omit the unit check.

Patch information:
diff --git a/astropy/units/decorators.py b/astropy/units/decorators.py
index 8bece5a850..fc185cb5e0 100644
--- a/astropy/units/decorators.py
+++ b/astropy/units/decorators.py
@@ -221,6 +221,9 @@ class QuantityInput:
             with add_enabled_equivalencies(self.equivalencies):
                 return_ = wrapped_function(*func_args, **func_kwargs)
             if wrapped_signature.return_annotation is not inspect.Signature.empty:
+                # If the return value is None, return it directly without trying to convert units
+                if return_ is None:
+                    return None
                 return return_.to(wrapped_signature.return_annotation)
             else:
                 return return_


Find all relevant source code context needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 19:32:10,379 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user is reporting a bug in the `astropy.units.quantity_input` decorator. The traceback and the provided patch point directly to the `QuantityInput` class in `astropy/units/decorators.py`. To understand the context of the bug and the proposed fix, I need to examine the complete implementation of this decorator.' query='Please provide the full content of astropy/units/decorators.py.' extra_requirements='' purpose='This file is needed to understand the implementation of the `quantity_input` decorator and how it handles return value annotations, or fails to handle, `None` return types from decorated functions like `__init__`.'
2025-12-21 19:32:10,380 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of astropy/units/decorators.py.
2025-12-21 19:32:10,381 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-21 19:32:10,381 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-21 19:32:10,382 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-21 19:32:10,382 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of astropy/units/decorators.py.
Purpose: This file is needed to understand the implementation of the `quantity_input` decorator and how it handles return value annotations, or fails to handle, `None` return types from decorated functions like `__init__`.
2025-12-21 19:32:12,683 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have located the file `astropy/units/decorators.py` and will now read its entire contents. This will allow me to examine the implementation of the `quantity_input` decorator and understand how it interacts with function return types.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "astropy/units/decorators.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2151, 'candidates_token_count': 71, 'total_token_count': 2296, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2151}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 71}], 'thoughts_token_count': 74, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.19189355071161834, 'model_name': 'gemini-2.5-pro'} id='run--369a0091-3c4a-4b4b-ade6-b3e30bd26681-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'astropy/units/decorators.py'}, 'id': 'e488edc6-b010-4349-910f-6e9b7bfe764c', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2151, 'output_tokens': 71, 'total_tokens': 2296, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 74}}
2025-12-21 19:32:19,532 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have successfully retrieved the entire content of the file `astropy/units/decorators.py`. This file contains the implementation of the `quantity_input` decorator. The code is now available for you to analyze and understand how it handles function arguments, return value annotations, and its behavior with `None` return types, particularly in the context of `__init__` methods.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 5285, 'candidates_token_count': 77, 'total_token_count': 6044, 'prompt_tokens_details': [{'modality': 1, 'token_count': 5285}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 77}], 'thoughts_token_count': 682, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -1.0779428853617086, 'model_name': 'gemini-2.5-pro'} id='run--8b2be37c-d651-4f1f-a29f-9747e541b0d3-0' usage_metadata={'input_tokens': 5285, 'output_tokens': 77, 'total_tokens': 6044, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 682}}
2025-12-21 19:32:19,533 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of astropy/units/decorators.py.
--- END QUERY ---



--- BEGIN PURPOSE ---
This file is needed to understand the implementation of the `quantity_input` decorator and how it handles return value annotations, or fails to handle, `None` return types from decorated functions like `__init__`.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: astropy/units/decorators.py
Line number range: 1 - 231
Content:
1. # -*- coding: utf-8 -*-
2. # Licensed under a 3-clause BSD style license - see LICENSE.rst
3. 
4. __all__ = ['quantity_input']
5. 
6. import inspect
7. from ..utils.decorators import wraps
8. from ..utils.misc import isiterable
9. 
10. from .core import Unit, UnitsError, add_enabled_equivalencies
11. from .physical import _unit_physical_mapping
12. 
13. 
14. def _get_allowed_units(targets):
15.     """
16.     From a list of target units (either as strings or unit objects) and physical
17.     types, return a list of Unit objects.
18.     """
19. 
20.     allowed_units = []
21.     for target in targets:
22. 
23.         try:  # unit passed in as a string
24.             target_unit = Unit(target)
25. 
26.         except ValueError:
27. 
28.             try:  # See if the function writer specified a physical type
29.                 physical_type_id = _unit_physical_mapping[target]
30. 
31.             except KeyError:  # Function argument target is invalid
32.                 raise ValueError("Invalid unit or physical type '{0}'."
33.                                  .format(target))
34. 
35.             # get unit directly from physical type id
36.             target_unit = Unit._from_physical_type_id(physical_type_id)
37. 
38.         allowed_units.append(target_unit)
39. 
40.     return allowed_units
41. 
42. 
43. def _validate_arg_value(param_name, func_name, arg, targets, equivalencies):
44.     """
45.     Validates the object passed in to the wrapped function, ``arg``, with target
46.     unit or physical type, ``target``.
47.     """
48. 
49.     allowed_units = _get_allowed_units(targets)
50. 
51.     for allowed_unit in allowed_units:
52.         try:
53.             is_equivalent = arg.unit.is_equivalent(allowed_unit,
54.                                                    equivalencies=equivalencies)
55. 
56.             if is_equivalent:
57.                 break
58. 
59.         except AttributeError:  # Either there is no .unit or no .is_equivalent
60.             if hasattr(arg, "unit"):
61.                 error_msg = "a 'unit' attribute without an 'is_equivalent' method"
62.             else:
63.                 error_msg = "no 'unit' attribute"
64. 
65.             raise TypeError("Argument '{0}' to function '{1}' has {2}. "
66.                   "You may want to pass in an astropy Quantity instead."
67.                      .format(param_name, func_name, error_msg))
68. 
69.     else:
70.         if len(targets) > 1:
71.             raise UnitsError("Argument '{0}' to function '{1}' must be in units"
72.                              " convertible to one of: {2}."
73.                              .format(param_name, func_name,
74.                                      [str(targ) for targ in targets]))
75.         else:
76.             raise UnitsError("Argument '{0}' to function '{1}' must be in units"
77.                              " convertible to '{2}'."
78.                              .format(param_name, func_name,
79.                                      str(targets[0])))
80. 
81. 
82. class QuantityInput:
83. 
84.     @classmethod
85.     def as_decorator(cls, func=None, **kwargs):
86.         r"""
87.         A decorator for validating the units of arguments to functions.
88. 
89.         Unit specifications can be provided as keyword arguments to the decorator,
90.         or by using function annotation syntax. Arguments to the decorator
91.         take precedence over any function annotations present.
92. 
93.         A `~astropy.units.UnitsError` will be raised if the unit attribute of
94.         the argument is not equivalent to the unit specified to the decorator
95.         or in the annotation.
96.         If the argument has no unit attribute, i.e. it is not a Quantity object, a
97.         `ValueError` will be raised.
98. 
99.         Where an equivalency is specified in the decorator, the function will be
100.         executed with that equivalency in force.
101. 
102.         Notes
103.         -----
104. 
105.         The checking of arguments inside variable arguments to a function is not
106.         supported (i.e. \*arg or \**kwargs).
107. 
108.         Examples
109.         --------
110. 
111.         .. code-block:: python
112. 
113.             import astropy.units as u
114.             @u.quantity_input(myangle=u.arcsec)
115.             def myfunction(myangle):
116.                 return myangle**2
117. 
118. 
119.         .. code-block:: python
120. 
121.             import astropy.units as u
122.             @u.quantity_input
123.             def myfunction(myangle: u.arcsec):
124.                 return myangle**2
125. 
126.         Also you can specify a return value annotation, which will
127.         cause the function to always return a `~astropy.units.Quantity` in that
128.         unit.
129. 
130.         .. code-block:: python
131. 
132.             import astropy.units as u
133.             @u.quantity_input
134.             def myfunction(myangle: u.arcsec) -> u.deg**2:
135.                 return myangle**2
136. 
137.         Using equivalencies::
138. 
139.             import astropy.units as u
140.             @u.quantity_input(myenergy=u.eV, equivalencies=u.mass_energy())
141.             def myfunction(myenergy):
142.                 return myenergy**2
143. 
144.         """
145.         self = cls(**kwargs)
146.         if func is not None and not kwargs:
147.             return self(func)
148.         else:
149.             return self
150. 
151.     def __init__(self, func=None, **kwargs):
152.         self.equivalencies = kwargs.pop('equivalencies', [])
153.         self.decorator_kwargs = kwargs
154. 
155.     def __call__(self, wrapped_function):
156. 
157.         # Extract the function signature for the function we are wrapping.
158.         wrapped_signature = inspect.signature(wrapped_function)
159. 
160.         # Define a new function to return in place of the wrapped one
161.         @wraps(wrapped_function)
162.         def wrapper(*func_args, **func_kwargs):
163.             # Bind the arguments to our new function to the signature of the original.
164.             bound_args = wrapped_signature.bind(*func_args, **func_kwargs)
165. 
166.             # Iterate through the parameters of the original signature
167.             for param in wrapped_signature.parameters.values():
168.                 # We do not support variable arguments (*args, **kwargs)
169.                 if param.kind in (inspect.Parameter.VAR_KEYWORD,
170.                                   inspect.Parameter.VAR_POSITIONAL):
171.                     continue
172. 
173.                 # Catch the (never triggered) case where bind relied on a default value.
174.                 if param.name not in bound_args.arguments and param.default is not param.empty:
175.                     bound_args.arguments[param.name] = param.default
176. 
177.                 # Get the value of this parameter (argument to new function)
178.                 arg = bound_args.arguments[param.name]
179. 
180.                 # Get target unit or physical type, either from decorator kwargs
181.                 #   or annotations
182.                 if param.name in self.decorator_kwargs:
183.                     targets = self.decorator_kwargs[param.name]
184.                 else:
185.                     targets = param.annotation
186. 
187.                 # If the targets is empty, then no target units or physical
188.                 #   types were specified so we can continue to the next arg
189.                 if targets is inspect.Parameter.empty:
190.                     continue
191. 
192.                 # If the argument value is None, and the default value is None,
193.                 #   pass through the None even if there is a target unit
194.                 if arg is None and param.default is None:
195.                     continue
196. 
197.                 # Here, we check whether multiple target unit/physical type's
198.                 #   were specified in the decorator/annotation, or whether a
199.                 #   single string (unit or physical type) or a Unit object was
200.                 #   specified
201.                 if isinstance(targets, str) or not isiterable(targets):
202.                     valid_targets = [targets]
203. 
204.                 # Check for None in the supplied list of allowed units and, if
205.                 #   present and the passed value is also None, ignore.
206.                 elif None in targets:
207.                     if arg is None:
208.                         continue
209.                     else:
210.                         valid_targets = [t for t in targets if t is not None]
211. 
212.                 else:
213.                     valid_targets = targets
214. 
215.                 # Now we loop over the allowed units/physical types and validate
216.                 #   the value of the argument:
217.                 _validate_arg_value(param.name, wrapped_function.__name__,
218.                                     arg, valid_targets, self.equivalencies)
219. 
220.             # Call the original function with any equivalencies in force.
221.             with add_enabled_equivalencies(self.equivalencies):
222.                 return_ = wrapped_function(*func_args, **func_kwargs)
223.             if wrapped_signature.return_annotation is not inspect.Signature.empty:
224.                 return return_.to(wrapped_signature.return_annotation)
225.             else:
226.                 return return_
227. 
228.         return wrapper
229. 
230. 
231. quantity_input = QuantityInput.as_decorator

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-21 19:32:25,295 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="The user requested the full content of the file 'astropy/units/decorators.py'. This context block includes the entire file, which defines the `quantity_input` decorator, its implementation class `QuantityInput`, and helper functions. This directly answers the user's query and provides the necessary code to understand its functionality, as stated in the purpose.", relative_path='astropy/units/decorators.py', start_line=1, end_line=231)]
2025-12-21 19:32:25,297 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of astropy/units/decorators.py.
2025-12-21 19:32:25,302 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-21 19:32:25,308 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-21 19:32:25,318 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 0 existing contexts
2025-12-21 19:32:25,318 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 1 total contexts (removed 0 duplicates)
2025-12-21 19:32:25,318 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
astropy
├── .circleci
|   └── config.yml
├── .rtd-environment.yml
├── .travis.yml
├── CHANGES.rst
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── LICENSE.rst
├── README.rst
├── ah_bootstrap.py
├── appveyor.yml
├── astropy
|   ├── __init__.py
|   ├── _erfa
|   |   ├── __init__.py
|   |   ├── erfa_generator.py
|   |   ├── setup_package.py
|   |   └── tests
|   |       ├── __init__.py
|   |       └── test_erfa.py
|   ├── config
|   |   ├── __init__.py
|   |   ├── affiliated.py
|   |   ├── configuration.py
|   |   ├── paths.py
|   |   ├── setup_package.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── data
|   |       └── test_configs.py
|   ├── conftest.py
|   ├── constants
|   |   ├── __init__.py
|   |   ├── astropyconst13.py
|   |   ├── astropyconst20.py
|   |   ├── cgs.py
|   |   ├── codata2010.py
|   |   ├── codata2014.py
|   |   ├── constant.py
|   |   ├── iau2012.py
|   |   ├── iau2015.py
|   |   ├── si.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_constant.py
|   |   |   ├── test_pickle.py
|   |   |   └── test_prior_version.py
|   |   └── utils.py
|   ├── convolution
|   |   ├── __init__.py
|   |   ├── convolve.py
|   |   ├── core.py
|   |   ├── kernels.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_convolve.py
|   |   |   ├── test_convolve_fft.py
|   |   |   ├── test_convolve_kernels.py
|   |   |   ├── test_convolve_models.py
|   |   |   ├── test_convolve_nddata.py
|   |   |   ├── test_convolve_speeds.py
|   |   |   ├── test_discretize.py
|   |   |   ├── test_kernel_class.py
|   |   |   └── test_pickle.py
|   |   └── utils.py
|   ├── coordinates
|   |   ├── __init__.py
|   |   ├── angle_lextab.py
|   |   ├── angle_parsetab.py
|   |   ├── angle_utilities.py
|   |   ├── angles.py
|   |   ├── attributes.py
|   |   ├── baseframe.py
|   |   ├── builtin_frames
|   |   |   ├── __init__.py
|   |   |   ├── altaz.py
|   |   |   ├── baseradec.py
|   |   |   ├── cirs.py
|   |   |   ├── cirs_observed_transforms.py
|   |   |   ├── ecliptic.py
|   |   |   ├── ecliptic_transforms.py
|   |   |   ├── fk4.py
|   |   |   ├── fk4_fk5_transforms.py
|   |   |   ├── fk5.py
|   |   |   ├── galactic.py
|   |   |   ├── galactic_transforms.py
|   |   |   ├── galactocentric.py
|   |   |   ├── gcrs.py
|   |   |   ├── hcrs.py
|   |   |   ├── icrs.py
|   |   |   ├── icrs_cirs_transforms.py
|   |   |   ├── icrs_fk5_transforms.py
|   |   |   ├── intermediate_rotation_transforms.py
|   |   |   ├── itrs.py
|   |   |   ├── lsr.py
|   |   |   ├── skyoffset.py
|   |   |   ├── supergalactic.py
|   |   |   ├── supergalactic_transforms.py
|   |   |   └── utils.py
|   |   ├── calculation.py
|   |   ├── data
|   |   ├── distances.py
|   |   ├── earth.py
|   |   ├── earth_orientation.py
|   |   ├── errors.py
|   |   ├── funcs.py
|   |   ├── matching.py
|   |   ├── matrix_utilities.py
|   |   ├── name_resolve.py
|   |   ├── orbital_elements.py
|   |   ├── representation.py
|   |   ├── setup_package.py
|   |   ├── sites.py
|   |   ├── sky_coordinate.py
|   |   ├── solar_system.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── accuracy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── generate_ref_ast.py
|   |   |   |   ├── test_altaz_icrs.py
|   |   |   |   ├── test_ecliptic.py
|   |   |   |   ├── test_fk4_no_e_fk4.py
|   |   |   |   ├── test_fk4_no_e_fk5.py
|   |   |   |   ├── test_galactic_fk4.py
|   |   |   |   └── test_icrs_fk5.py
|   |   |   ├── test_angles.py
|   |   |   ├── test_angular_separation.py
|   |   |   ├── test_api_ape5.py
|   |   |   ├── test_arrays.py
|   |   |   ├── test_atc_replacements.py
|   |   |   ├── test_celestial_transformations.py
|   |   |   ├── test_distance.py
|   |   |   ├── test_earth.py
|   |   |   ├── test_finite_difference_velocities.py
|   |   |   ├── test_formatting.py
|   |   |   ├── test_frames.py
|   |   |   ├── test_frames_with_velocity.py
|   |   |   ├── test_funcs.py
|   |   |   ├── test_iau_fullstack.py
|   |   |   ├── test_intermediate_transformations.py
|   |   |   ├── test_matching.py
|   |   |   ├── test_matrix_utilities.py
|   |   |   ├── test_name_resolve.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_regression.py
|   |   |   ├── test_representation.py
|   |   |   ├── test_representation_arithmetic.py
|   |   |   ├── test_representation_methods.py
|   |   |   ├── test_shape_manipulation.py
|   |   |   ├── test_sites.py
|   |   |   ├── test_sky_coord.py
|   |   |   ├── test_sky_coord_velocities.py
|   |   |   ├── test_skyoffset_transformations.py
|   |   |   ├── test_solar_system.py
|   |   |   ├── test_transformations.py
|   |   |   ├── test_unit_representation.py
|   |   |   ├── test_velocity_corrs.py
|   |   |   └── utils.py
|   |   └── transformations.py
|   ├── cosmology
|   |   ├── __init__.py
|   |   ├── core.py
|   |   ├── funcs.py
|   |   ├── parameters.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── test_cosmology.py
|   |       └── test_pickle.py
|   ├── extern
|   |   ├── README.rst
|   |   ├── __init__.py
|   |   ├── bundled
|   |   |   ├── __init__.py
|   |   |   └── six.py
|   |   ├── configobj
|   |   |   ├── __init__.py
|   |   |   ├── configobj.py
|   |   |   └── validate.py
|   |   ├── css
|   |   |   └── jquery.dataTables.css
|   |   ├── js
|   |   |   ├── jquery-3.1.1.js
|   |   |   ├── jquery-3.1.1.min.js
|   |   |   ├── jquery.dataTables.js
|   |   |   └── jquery.dataTables.min.js
|   |   ├── ply
|   |   |   ├── __init__.py
|   |   |   ├── cpp.py
|   |   |   ├── ctokens.py
|   |   |   ├── lex.py
|   |   |   ├── yacc.py
|   |   |   └── ygen.py
|   |   ├── setup_package.py
|   |   └── six.py
|   ├── io
|   |   ├── __init__.py
|   |   ├── ascii
|   |   |   ├── __init__.py
|   |   |   ├── basic.py
|   |   |   ├── cds.py
|   |   |   ├── connect.py
|   |   |   ├── core.py
|   |   |   ├── daophot.py
|   |   |   ├── ecsv.py
|   |   |   ├── fastbasic.py
|   |   |   ├── fixedwidth.py
|   |   |   ├── html.py
|   |   |   ├── ipac.py
|   |   |   ├── latex.py
|   |   |   ├── misc.py
|   |   |   ├── rst.py
|   |   |   ├── setup_package.py
|   |   |   ├── sextractor.py
|   |   |   ├── src
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── common.py
|   |   |   |   ├── t
|   |   |   |   ├── test_c_reader.py
|   |   |   |   ├── test_cds_header_from_readme.py
|   |   |   |   ├── test_compressed.py
|   |   |   |   ├── test_connect.py
|   |   |   |   ├── test_ecsv.py
|   |   |   |   ├── test_fixedwidth.py
|   |   |   |   ├── test_html.py
|   |   |   |   ├── test_ipac_definitions.py
|   |   |   |   ├── test_read.py
|   |   |   |   ├── test_rst.py
|   |   |   |   ├── test_types.py
|   |   |   |   └── test_write.py
|   |   |   └── ui.py
|   |   ├── fits
|   |   |   ├── __init__.py
|   |   |   ├── _numpy_hacks.py
|   |   |   ├── card.py
|   |   |   ├── column.py
|   |   |   ├── connect.py
|   |   |   ├── convenience.py
|   |   |   ├── diff.py
|   |   |   ├── file.py
|   |   |   ├── fitsrec.py
|   |   |   ├── fitstime.py
|   |   |   ├── hdu
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── compressed.py
|   |   |   |   ├── groups.py
|   |   |   |   ├── hdulist.py
|   |   |   |   ├── image.py
|   |   |   |   ├── nonstandard.py
|   |   |   |   ├── streaming.py
|   |   |   |   └── table.py
|   |   |   ├── header.py
|   |   |   ├── scripts
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fitscheck.py
|   |   |   |   ├── fitsdiff.py
|   |   |   |   ├── fitsheader.py
|   |   |   |   └── fitsinfo.py
|   |   |   ├── setup_package.py
|   |   |   ├── src
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── data
|   |   |   |   ├── test_checksum.py
|   |   |   |   ├── test_compression_failures.py
|   |   |   |   ├── test_connect.py
|   |   |   |   ├── test_convenience.py
|   |   |   |   ├── test_core.py
|   |   |   |   ├── test_diff.py
|   |   |   |   ├── test_division.py
|   |   |   |   ├── test_fitscheck.py
|   |   |   |   ├── test_fitsdiff.py
|   |   |   |   ├── test_fitsheader.py
|   |   |   |   ├── test_fitsinfo.py
|   |   |   |   ├── test_fitstime.py
|   |   |   |   ├── test_groups.py
|   |   |   |   ├── test_hdulist.py
|   |   |   |   ├── test_header.py
|   |   |   |   ├── test_image.py
|   |   |   |   ├── test_nonstandard.py
|   |   |   |   ├── test_structured.py
|   |   |   |   ├── test_table.py
|   |   |   |   ├── test_uint.py
|   |   |   |   └── test_util.py
|   |   |   ├── util.py
|   |   |   └── verify.py
|   |   ├── misc
|   |   |   ├── __init__.py
|   |   |   ├── asdf
|   |   |   |   ├── __init__.py
|   |   |   |   ├── extension.py
|   |   |   |   ├── schemas
|   |   |   |   ├── setup_package.py
|   |   |   |   ├── tags
|   |   |   |   └── types.py
|   |   |   ├── connect.py
|   |   |   ├── hdf5.py
|   |   |   ├── pickle_helpers.py
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── test_hdf5.py
|   |   |   |   ├── test_pickle_helpers.py
|   |   |   |   └── test_yaml.py
|   |   |   └── yaml.py
|   |   ├── registry.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   └── test_registry.py
|   |   └── votable
|   |       ├── __init__.py
|   |       ├── connect.py
|   |       ├── converters.py
|   |       ├── data
|   |       |   └── ucd1p-words.txt
|   |       ├── exceptions.py
|   |       ├── setup_package.py
|   |       ├── src
|   |       |   └── tablewriter.c
|   |       ├── table.py
|   |       ├── tests
|   |       |   ├── __init__.py
|   |       |   ├── converter_test.py
|   |       |   ├── data
|   |       |   ├── exception_test.py
|   |       |   ├── resource_test.py
|   |       |   ├── table_test.py
|   |       |   ├── tree_test.py
|   |       |   ├── ucd_test.py
|   |       |   ├── util_test.py
|   |       |   └── vo_test.py
|   |       ├── tree.py
|   |       ├── ucd.py
|   |       ├── util.py
|   |       ├── validator
|   |       |   ├── __init__.py
|   |       |   ├── html.py
|   |       |   ├── main.py
|   |       |   ├── result.py
|   |       |   └── urls
|   |       ├── volint.py
|   |       └── xmlutil.py
|   ├── logger.py
|   ├── modeling
|   |   ├── __init__.py
|   |   ├── blackbody.py
|   |   ├── core.py
|   |   ├── fitting.py
|   |   ├── functional_models.py
|   |   ├── mappings.py
|   |   ├── models.py
|   |   ├── optimizers.py
|   |   ├── parameters.py
|   |   ├── polynomial.py
|   |   ├── powerlaws.py
|   |   ├── projections.py
|   |   ├── rotations.py
|   |   ├── separable.py
|   |   ├── setup_package.py
|   |   ├── src
|   |   ├── statistic.py
|   |   ├── tabular.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   |   └── __init__.py
|   |   |   ├── example_models.py
|   |   |   ├── irafutil.py
|   |   |   ├── test_blackbody.py
|   |   |   ├── test_compound.py
|   |   |   ├── test_constraints.py
|   |   |   ├── test_core.py
|   |   |   ├── test_fitters.py
|   |   |   ├── test_functional_models.py
|   |   |   ├── test_input.py
|   |   |   ├── test_mappings.py
|   |   |   ├── test_model_sets.py
|   |   |   ├── test_models.py
|   |   |   ├── test_models_quantities.py
|   |   |   ├── test_parameters.py
|   |   |   ├── test_polynomial.py
|   |   |   ├── test_projections.py
|   |   |   ├── test_quantities_evaluation.py
|   |   |   ├── test_quantities_fitting.py
|   |   |   ├── test_quantities_model.py
|   |   |   ├── test_quantities_parameters.py
|   |   |   ├── test_quantities_rotations.py
|   |   |   ├── test_rotations.py
|   |   |   ├── test_separable.py
|   |   |   ├── test_utils.py
|   |   |   └── utils.py
|   |   └── utils.py
|   ├── nddata
|   |   ├── __init__.py
|   |   ├── ccddata.py
|   |   ├── compat.py
|   |   ├── decorators.py
|   |   ├── flag_collection.py
|   |   ├── mixins
|   |   |   ├── __init__.py
|   |   |   ├── ndarithmetic.py
|   |   |   ├── ndio.py
|   |   |   ├── ndslicing.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── test_ndarithmetic.py
|   |   |       ├── test_ndio.py
|   |   |       └── test_ndslicing.py
|   |   ├── nddata.py
|   |   ├── nddata_base.py
|   |   ├── nddata_withmixins.py
|   |   ├── nduncertainty.py
|   |   ├── setup_package.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   ├── test_ccddata.py
|   |   |   ├── test_compat.py
|   |   |   ├── test_decorators.py
|   |   |   ├── test_flag_collection.py
|   |   |   ├── test_nddata.py
|   |   |   ├── test_nddata_base.py
|   |   |   ├── test_nduncertainty.py
|   |   |   └── test_utils.py
|   |   └── utils.py
|   ├── samp
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── constants.py
|   |   ├── data
|   |   |   ├── clientaccesspolicy.xml
|   |   |   └── crossdomain.xml
|   |   ├── errors.py
|   |   ├── hub.py
|   |   ├── hub_proxy.py
|   |   ├── hub_script.py
|   |   ├── integrated_client.py
|   |   ├── lockfile_helpers.py
|   |   ├── setup_package.py
|   |   ├── standard_profile.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_client.py
|   |   |   ├── test_errors.py
|   |   |   ├── test_helpers.py
|   |   |   ├── test_hub.py
|   |   |   ├── test_hub_proxy.py
|   |   |   ├── test_hub_script.py
|   |   |   ├── test_standard_profile.py
|   |   |   ├── test_web_profile.py
|   |   |   └── web_profile_test_helpers.py
|   |   ├── utils.py
|   |   └── web_profile.py
|   ├── setup_package.py
|   ├── stats
|   |   ├── __init__.py
|   |   ├── bayesian_blocks.py
|   |   ├── biweight.py
|   |   ├── circstats.py
|   |   ├── funcs.py
|   |   ├── histogram.py
|   |   ├── info_theory.py
|   |   ├── jackknife.py
|   |   ├── lombscargle
|   |   |   ├── __init__.py
|   |   |   ├── _statistics.py
|   |   |   ├── core.py
|   |   |   ├── implementations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── chi2_impl.py
|   |   |   |   ├── fast_impl.py
|   |   |   |   ├── fastchi2_impl.py
|   |   |   |   ├── main.py
|   |   |   |   ├── mle.py
|   |   |   |   ├── scipy_impl.py
|   |   |   |   ├── slow_impl.py
|   |   |   |   ├── tests
|   |   |   |   └── utils.py
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── test_lombscargle.py
|   |   |   |   ├── test_statistics.py
|   |   |   |   └── test_utils.py
|   |   |   └── utils.py
|   |   ├── sigma_clipping.py
|   |   ├── spatial.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── test_bayesian_blocks.py
|   |       ├── test_biweight.py
|   |       ├── test_circstats.py
|   |       ├── test_funcs.py
|   |       ├── test_histogram.py
|   |       ├── test_info_theory.py
|   |       ├── test_jackknife.py
|   |       ├── test_sigma_clipping.py
|   |       └── test_spatial.py
|   ├── table
|   |   ├── __init__.py
|   |   ├── bst.py
|   |   ├── column.py
|   |   ├── groups.py
|   |   ├── index.py
|   |   ├── info.py
|   |   ├── jsviewer.py
|   |   ├── meta.py
|   |   ├── np_utils.py
|   |   ├── operations.py
|   |   ├── pandas.py
|   |   ├── pprint.py
|   |   ├── row.py
|   |   ├── scripts
|   |   |   ├── __init__.py
|   |   |   └── showtable.py
|   |   ├── serialize.py
|   |   ├── setup_package.py
|   |   ├── sorted_array.py
|   |   ├── table.py
|   |   ├── table_helpers.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── conftest.py
|   |       ├── test_array.py
|   |       ├── test_bst.py
|   |       ├── test_column.py
|   |       ├── test_groups.py
|   |       ├── test_index.py
|   |       ├── test_info.py
|   |       ├── test_init_table.py
|   |       ├── test_item_access.py
|   |       ├── test_jsviewer.py
|   |       ├── test_masked.py
|   |       ├── test_mixin.py
|   |       ├── test_np_utils.py
|   |       ├── test_operations.py
|   |       ├── test_pickle.py
|   |       ├── test_pprint.py
|   |       ├── test_row.py
|   |       ├── test_showtable.py
|   |       ├── test_subclass.py
|   |       └── test_table.py
|   ├── tests
|   |   ├── __init__.py
|   |   ├── command.py
|   |   ├── disable_internet.py
|   |   ├── helper.py
|   |   ├── image_tests.py
|   |   ├── plugins
|   |   |   ├── __init__.py
|   |   |   ├── config.py
|   |   |   └── display.py
|   |   ├── pytest_plugins.py
|   |   ├── runner.py
|   |   ├── setup_package.py
|   |   ├── test_logger.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── test_imports.py
|   |       ├── test_quantity_helpers.py
|   |       ├── test_run_tests.py
|   |       └── test_runner.py
|   ├── time
|   |   ├── __init__.py
|   |   ├── core.py
|   |   ├── formats.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_basic.py
|   |   |   ├── test_comparisons.py
|   |   |   ├── test_corrs.py
|   |   |   ├── test_delta.py
|   |   |   ├── test_guess.py
|   |   |   ├── test_mask.py
|   |   |   ├── test_methods.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_precision.py
|   |   |   ├── test_quantity_interaction.py
|   |   |   ├── test_sidereal.py
|   |   |   └── test_ut1.py
|   |   └── utils.py
|   ├── units
|   |   ├── __init__.py
|   |   ├── astrophys.py
|   |   ├── cds.py
|   |   ├── cgs.py
|   |   ├── core.py
|   |   ├── decorators.py
|   |   ├── deprecated.py
|   |   ├── equivalencies.py
|   |   ├── format
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── cds.py
|   |   |   ├── cds_lextab.py
|   |   |   ├── cds_parsetab.py
|   |   |   ├── console.py
|   |   |   ├── fits.py
|   |   |   ├── generic.py
|   |   |   ├── generic_lextab.py
|   |   |   ├── generic_parsetab.py
|   |   |   ├── latex.py
|   |   |   ├── ogip.py
|   |   |   ├── ogip_lextab.py
|   |   |   ├── ogip_parsetab.py
|   |   |   ├── unicode_format.py
|   |   |   ├── utils.py
|   |   |   └── vounit.py
|   |   ├── function
|   |   |   ├── __init__.py
|   |   |   ├── core.py
|   |   |   ├── logarithmic.py
|   |   |   ├── magnitude_zero_points.py
|   |   |   ├── mixin.py
|   |   |   └── units.py
|   |   ├── imperial.py
|   |   ├── physical.py
|   |   ├── quantity.py
|   |   ├── quantity_helper.py
|   |   ├── required_by_vounit.py
|   |   ├── si.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── py3_test_quantity_annotations.py
|   |   |   ├── test_deprecated.py
|   |   |   ├── test_equivalencies.py
|   |   |   ├── test_format.py
|   |   |   ├── test_logarithmic.py
|   |   |   ├── test_physical.py
|   |   |   ├── test_quantity.py
|   |   |   ├── test_quantity_array_methods.py
|   |   |   ├── test_quantity_decorator.py
|   |   |   ├── test_quantity_non_ufuncs.py
|   |   |   ├── test_quantity_ufuncs.py
|   |   |   └── test_units.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── argparse.py
|   |   ├── codegen.py
|   |   ├── collections.py
|   |   ├── compat
|   |   |   ├── __init__.py
|   |   |   ├── funcsigs.py
|   |   |   ├── futures
|   |   |   |   └── __init__.py
|   |   |   ├── misc.py
|   |   |   ├── numpy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── core
|   |   |   |   ├── lib
|   |   |   |   └── tests
|   |   |   └── numpycompat.py
|   |   ├── console.py
|   |   ├── data.py
|   |   ├── data_info.py
|   |   ├── decorators.py
|   |   ├── exceptions.py
|   |   ├── iers
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   ├── iers.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       └── test_iers.py
|   |   ├── introspection.py
|   |   ├── metadata.py
|   |   ├── misc.py
|   |   ├── setup_package.py
|   |   ├── src
|   |   ├── state.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   |   ├── .hidden_file.txt
|   |   |   |   ├── test_package
|   |   |   |   └── unicode.txt
|   |   |   ├── test_codegen.py
|   |   |   ├── test_collections.py
|   |   |   ├── test_console.py
|   |   |   ├── test_data.py
|   |   |   ├── test_data_info.py
|   |   |   ├── test_decorators.py
|   |   |   ├── test_introspection.py
|   |   |   ├── test_metadata.py
|   |   |   ├── test_misc.py
|   |   |   ├── test_progress_bar_func.py
|   |   |   ├── test_timer.py
|   |   |   └── test_xml.py
|   |   ├── timer.py
|   |   └── xml
|   |       ├── __init__.py
|   |       ├── check.py
|   |       ├── iterparser.py
|   |       ├── setup_package.py
|   |       ├── src
|   |       |   └── iterparse.c
|   |       ├── tests
|   |       |   ├── __init__.py
|   |       |   └── test_iterparse.py
|   |       ├── unescaper.py
|   |       ├── validate.py
|   |       └── writer.py
|   ├── visualization
|   |   ├── __init__.py
|   |   ├── hist.py
|   |   ├── interval.py
|   |   ├── lupton_rgb.py
|   |   ├── mpl_normalize.py
|   |   ├── mpl_style.py
|   |   ├── scripts
|   |   |   ├── __init__.py
|   |   |   ├── fits2bitmap.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       └── test_fits2bitmap.py
|   |   ├── stretch.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_histogram.py
|   |   |   ├── test_interval.py
|   |   |   ├── test_lupton_rgb.py
|   |   |   ├── test_norm.py
|   |   |   ├── test_stretch.py
|   |   |   └── test_units.py
|   |   ├── transform.py
|   |   ├── units.py
|   |   └── wcsaxes
|   |       ├── __init__.py
|   |       ├── axislabels.py
|   |       ├── coordinate_helpers.py
|   |       ├── coordinate_range.py
|   |       ├── coordinates_map.py
|   |       ├── core.py
|   |       ├── formatter_locator.py
|   |       ├── frame.py
|   |       ├── grid_paths.py
|   |       ├── patches.py
|   |       ├── tests
|   |       |   ├── __init__.py
|   |       |   ├── data
|   |       |   ├── datasets.py
|   |       |   ├── setup_package.py
|   |       |   ├── test_coordinate_helpers.py
|   |       |   ├── test_display_world_coordinates.py
|   |       |   ├── test_formatter_locator.py
|   |       |   ├── test_frame.py
|   |       |   ├── test_images.py
|   |       |   ├── test_misc.py
|   |       |   ├── test_transform_coord_meta.py
|   |       |   ├── test_transforms.py
|   |       |   └── test_utils.py
|   |       ├── ticklabels.py
|   |       ├── ticks.py
|   |       ├── transforms.py
|   |       └── utils.py
|   └── wcs
|       ├── __init__.py
|       ├── _docutil.py
|       ├── docstrings.py
|       ├── include
|       |   ├── astropy_wcs
|       |   └── wcslib
|       ├── setup_package.py
|       ├── src
|       |   ├── astropy_wcs.c
|       |   ├── astropy_wcs_api.c
|       |   ├── distortion.c
|       |   ├── distortion_wrap.c
|       |   ├── pipeline.c
|       |   ├── pyutil.c
|       |   ├── sip.c
|       |   ├── sip_wrap.c
|       |   ├── str_list_proxy.c
|       |   ├── unit_list_proxy.c
|       |   ├── util.c
|       |   ├── wcslib_tabprm_wrap.c
|       |   └── wcslib_wrap.c
|       ├── tests
|       |   ├── __init__.py
|       |   ├── data
|       |   |   ├── validate.5.0.txt
|       |   |   ├── validate.5.13.txt
|       |   |   └── validate.txt
|       |   ├── extension
|       |   |   ├── __init__.py
|       |   |   ├── setup.py
|       |   |   ├── test_extension.py
|       |   |   └── wcsapi_test.c
|       |   ├── maps
|       |   ├── spectra
|       |   ├── test_pickle.py
|       |   ├── test_profiling.py
|       |   ├── test_utils.py
|       |   ├── test_wcs.py
|       |   └── test_wcsprm.py
|       ├── utils.py
|       ├── wcs.py
|       └── wcslint.py
├── astropy_helpers
├── cextern
|   ├── README.rst
|   ├── cfitsio
|   |   ├── License.txt
|   |   ├── README.txt
|   |   ├── docs
|   |   |   └── changes.txt
|   |   ├── lib
|   |   |   ├── buffers.c
|   |   |   ├── cfileio.c
|   |   |   ├── checksum.c
|   |   |   ├── drvrfile.c
|   |   |   ├── drvrgsiftp.c
|   |   |   ├── drvrmem.c
|   |   |   ├── drvrnet.c
|   |   |   ├── drvrsmem.c
|   |   |   ├── editcol.c
|   |   |   ├── edithdu.c
|   |   |   ├── eval_f.c
|   |   |   ├── eval_l.c
|   |   |   ├── eval_y.c
|   |   |   ├── fits_hcompress.c
|   |   |   ├── fits_hdecompress.c
|   |   |   ├── fitscore.c
|   |   |   ├── getcol.c
|   |   |   ├── getcolb.c
|   |   |   ├── getcold.c
|   |   |   ├── getcole.c
|   |   |   ├── getcoli.c
|   |   |   ├── getcolj.c
|   |   |   ├── getcolk.c
|   |   |   ├── getcoll.c
|   |   |   ├── getcols.c
|   |   |   ├── getcolsb.c
|   |   |   ├── getcolui.c
|   |   |   ├── getcoluj.c
|   |   |   ├── getcoluk.c
|   |   |   ├── getkey.c
|   |   |   ├── group.c
|   |   |   ├── grparser.c
|   |   |   ├── histo.c
|   |   |   ├── imcompress.c
|   |   |   ├── iraffits.c
|   |   |   ├── modkey.c
|   |   |   ├── pliocomp.c
|   |   |   ├── putcol.c
|   |   |   ├── putcolb.c
|   |   |   ├── putcold.c
|   |   |   ├── putcole.c
|   |   |   ├── putcoli.c
|   |   |   ├── putcolj.c
|   |   |   ├── putcolk.c
|   |   |   ├── putcoll.c
|   |   |   ├── putcols.c
|   |   |   ├── putcolsb.c
|   |   |   ├── putcolu.c
|   |   |   ├── putcolui.c
|   |   |   ├── putcoluj.c
|   |   |   ├── putcoluk.c
|   |   |   ├── putkey.c
|   |   |   ├── quantize.c
|   |   |   ├── region.c
|   |   |   ├── ricecomp.c
|   |   |   ├── scalnull.c
|   |   |   ├── simplerng.c
|   |   |   ├── swapproc.c
|   |   |   ├── wcssub.c
|   |   |   └── wcsutil.c
|   |   └── zlib
|   |       ├── adler32.c
|   |       ├── crc32.c
|   |       ├── deflate.c
|   |       ├── infback.c
|   |       ├── inffast.c
|   |       ├── inflate.c
|   |       ├── inftrees.c
|   |       ├── trees.c
|   |       ├── uncompr.c
|   |       ├── zcompress.c
|   |       ├── zuncompress.c
|   |       └── zutil.c
|   ├── erfa
|   |   ├── README.rst
|   |   ├── a2af.c
|   |   ├── a2tf.c
|   |   ├── ab.c
|   |   ├── af2a.c
|   |   ├── anp.c
|   |   ├── anpm.c
|   |   ├── apcg.c
|   |   ├── apcg13.c
|   |   ├── apci.c
|   |   ├── apci13.c
|   |   ├── apco.c
|   |   ├── apco13.c
|   |   ├── apcs.c
|   |   ├── apcs13.c
|   |   ├── aper.c
|   |   ├── aper13.c
|   |   ├── apio.c
|   |   ├── apio13.c
|   |   ├── atci13.c
|   |   ├── atciq.c
|   |   ├── atciqn.c
|   |   ├── atciqz.c
|   |   ├── atco13.c
|   |   ├── atic13.c
|   |   ├── aticq.c
|   |   ├── aticqn.c
|   |   ├── atio13.c
|   |   ├── atioq.c
|   |   ├── atoc13.c
|   |   ├── atoi13.c
|   |   ├── atoiq.c
|   |   ├── bi00.c
|   |   ├── bp00.c
|   |   ├── bp06.c
|   |   ├── bpn2xy.c
|   |   ├── c2i00a.c
|   |   ├── c2i00b.c
|   |   ├── c2i06a.c
|   |   ├── c2ibpn.c
|   |   ├── c2ixy.c
|   |   ├── c2ixys.c
|   |   ├── c2s.c
|   |   ├── c2t00a.c
|   |   ├── c2t00b.c
|   |   ├── c2t06a.c
|   |   ├── c2tcio.c
|   |   ├── c2teqx.c
|   |   ├── c2tpe.c
|   |   ├── c2txy.c
|   |   ├── cal2jd.c
|   |   ├── cp.c
|   |   ├── cpv.c
|   |   ├── cr.c
|   |   ├── d2dtf.c
|   |   ├── d2tf.c
|   |   ├── dat.c
|   |   ├── dtdb.c
|   |   ├── dtf2d.c
|   |   ├── eceq06.c
|   |   ├── ecm06.c
|   |   ├── ee00.c
|   |   ├── ee00a.c
|   |   ├── ee00b.c
|   |   ├── ee06a.c
|   |   ├── eect00.c
|   |   ├── eform.c
|   |   ├── eo06a.c
|   |   ├── eors.c
|   |   ├── epb.c
|   |   ├── epb2jd.c
|   |   ├── epj.c
|   |   ├── epj2jd.c
|   |   ├── epv00.c
|   |   ├── eqec06.c
|   |   ├── eqeq94.c
|   |   ├── era00.c
|   |   ├── erfaversion.c
|   |   ├── fad03.c
|   |   ├── fae03.c
|   |   ├── faf03.c
|   |   ├── faju03.c
|   |   ├── fal03.c
|   |   ├── falp03.c
|   |   ├── fama03.c
|   |   ├── fame03.c
|   |   ├── fane03.c
|   |   ├── faom03.c
|   |   ├── fapa03.c
|   |   ├── fasa03.c
|   |   ├── faur03.c
|   |   ├── fave03.c
|   |   ├── fk52h.c
|   |   ├── fk5hip.c
|   |   ├── fk5hz.c
|   |   ├── fw2m.c
|   |   ├── fw2xy.c
|   |   ├── g2icrs.c
|   |   ├── gc2gd.c
|   |   ├── gc2gde.c
|   |   ├── gd2gc.c
|   |   ├── gd2gce.c
|   |   ├── gmst00.c
|   |   ├── gmst06.c
|   |   ├── gmst82.c
|   |   ├── gst00a.c
|   |   ├── gst00b.c
|   |   ├── gst06.c
|   |   ├── gst06a.c
|   |   ├── gst94.c
|   |   ├── h2fk5.c
|   |   ├── hfk5z.c
|   |   ├── icrs2g.c
|   |   ├── ir.c
|   |   ├── jd2cal.c
|   |   ├── jdcalf.c
|   |   ├── ld.c
|   |   ├── ldn.c
|   |   ├── ldsun.c
|   |   ├── lteceq.c
|   |   ├── ltecm.c
|   |   ├── lteqec.c
|   |   ├── ltp.c
|   |   ├── ltpb.c
|   |   ├── ltpecl.c
|   |   ├── ltpequ.c
|   |   ├── num00a.c
|   |   ├── num00b.c
|   |   ├── num06a.c
|   |   ├── numat.c
|   |   ├── nut00a.c
|   |   ├── nut00b.c
|   |   ├── nut06a.c
|   |   ├── nut80.c
|   |   ├── nutm80.c
|   |   ├── obl06.c
|   |   ├── obl80.c
|   |   ├── p06e.c
|   |   ├── p2pv.c
|   |   ├── p2s.c
|   |   ├── pap.c
|   |   ├── pas.c
|   |   ├── pb06.c
|   |   ├── pdp.c
|   |   ├── pfw06.c
|   |   ├── plan94.c
|   |   ├── pm.c
|   |   ├── pmat00.c
|   |   ├── pmat06.c
|   |   ├── pmat76.c
|   |   ├── pmp.c
|   |   ├── pmpx.c
|   |   ├── pmsafe.c
|   |   ├── pn.c
|   |   ├── pn00.c
|   |   ├── pn00a.c
|   |   ├── pn00b.c
|   |   ├── pn06.c
|   |   ├── pn06a.c
|   |   ├── pnm00a.c
|   |   ├── pnm00b.c
|   |   ├── pnm06a.c
|   |   ├── pnm80.c
|   |   ├── pom00.c
|   |   ├── ppp.c
|   |   ├── ppsp.c
|   |   ├── pr00.c
|   |   ├── prec76.c
|   |   ├── pv2p.c
|   |   ├── pv2s.c
|   |   ├── pvdpv.c
|   |   ├── pvm.c
|   |   ├── pvmpv.c
|   |   ├── pvppv.c
|   |   ├── pvstar.c
|   |   ├── pvtob.c
|   |   ├── pvu.c
|   |   ├── pvup.c
|   |   ├── pvxpv.c
|   |   ├── pxp.c
|   |   ├── refco.c
|   |   ├── rm2v.c
|   |   ├── rv2m.c
|   |   ├── rx.c
|   |   ├── rxp.c
|   |   ├── rxpv.c
|   |   ├── rxr.c
|   |   ├── ry.c
|   |   ├── rz.c
|   |   ├── s00.c
|   |   ├── s00a.c
|   |   ├── s00b.c
|   |   ├── s06.c
|   |   ├── s06a.c
|   |   ├── s2c.c
|   |   ├── s2p.c
|   |   ├── s2pv.c
|   |   ├── s2xpv.c
|   |   ├── sepp.c
|   |   ├── seps.c
|   |   ├── sp00.c
|   |   ├── starpm.c
|   |   ├── starpv.c
|   |   ├── sxp.c
|   |   ├── sxpv.c
|   |   ├── taitt.c
|   |   ├── taiut1.c
|   |   ├── taiutc.c
|   |   ├── tcbtdb.c
|   |   ├── tcgtt.c
|   |   ├── tdbtcb.c
|   |   ├── tdbtt.c
|   |   ├── tf2a.c
|   |   ├── tf2d.c
|   |   ├── tr.c
|   |   ├── trxp.c
|   |   ├── trxpv.c
|   |   ├── tttai.c
|   |   ├── tttcg.c
|   |   ├── tttdb.c
|   |   ├── ttut1.c
|   |   ├── ut1tai.c
|   |   ├── ut1tt.c
|   |   ├── ut1utc.c
|   |   ├── utctai.c
|   |   ├── utcut1.c
|   |   ├── xy06.c
|   |   ├── xys00a.c
|   |   ├── xys00b.c
|   |   ├── xys06a.c
|   |   ├── zp.c
|   |   ├── zpv.c
|   |   └── zr.c
|   ├── expat
|   |   ├── CMakeLists.txt
|   |   ├── amiga
|   |   |   ├── README.txt
|   |   |   ├── expat.xml
|   |   |   ├── expat_68k.c
|   |   |   ├── expat_68k_handler_stubs.c
|   |   |   ├── expat_lib.c
|   |   |   ├── expat_vectors.c
|   |   |   ├── include
|   |   |   |   ├── inline4
|   |   |   |   ├── interfaces
|   |   |   |   ├── libraries
|   |   |   |   └── proto
|   |   |   ├── launch.c
|   |   |   └── stdlib.c
|   |   ├── bcb5
|   |   |   └── README.txt
|   |   ├── conftools
|   |   |   ├── get-version.sh
|   |   |   └── ltmain.sh
|   |   ├── doc
|   |   |   ├── reference.html
|   |   |   └── style.css
|   |   ├── examples
|   |   |   ├── elements.c
|   |   |   └── outline.c
|   |   ├── lib
|   |   |   ├── xmlparse.c
|   |   |   ├── xmlrole.c
|   |   |   ├── xmltok.c
|   |   |   ├── xmltok_impl.c
|   |   |   └── xmltok_ns.c
|   |   ├── m4
|   |   ├── tests
|   |   |   ├── README.txt
|   |   |   ├── benchmark
|   |   |   |   ├── README.txt
|   |   |   |   └── benchmark.c
|   |   |   ├── chardata.c
|   |   |   ├── minicheck.c
|   |   |   ├── runtests.c
|   |   |   ├── runtestspp.cpp
|   |   |   └── xmltest.sh
|   |   ├── vms
|   |   ├── win32
|   |   |   ├── MANIFEST.txt
|   |   |   └── README.txt
|   |   └── xmlwf
|   |       ├── codepage.c
|   |       ├── ct.c
|   |       ├── readfilemap.c
|   |       ├── unixfilemap.c
|   |       ├── win32filemap.c
|   |       ├── xmlfile.c
|   |       ├── xmlmime.c
|   |       ├── xmlwf.c
|   |       └── xmlwin32url.cxx
|   ├── trim_cfitsio.sh
|   ├── trim_wcslib.sh
|   └── wcslib
|       ├── C
|       |   ├── cel.c
|       |   ├── dis.c
|       |   ├── flexed
|       |   |   ├── fitshdr.c
|       |   |   ├── wcsbth.c
|       |   |   ├── wcspih.c
|       |   |   ├── wcsulex.c
|       |   |   └── wcsutrn.c
|       |   ├── getwcstab.c
|       |   ├── lin.c
|       |   ├── log.c
|       |   ├── prj.c
|       |   ├── spc.c
|       |   ├── sph.c
|       |   ├── spx.c
|       |   ├── tab.c
|       |   ├── wcs.c
|       |   ├── wcserr.c
|       |   ├── wcsfix.c
|       |   ├── wcshdr.c
|       |   ├── wcsprintf.c
|       |   ├── wcstrig.c
|       |   ├── wcsunits.c
|       |   └── wcsutil.c
|       └── config
├── conftest.py
├── docs
|   ├── _pkgtemplate.rst
|   ├── _static
|   ├── changelog.rst
|   ├── conf.py
|   ├── config
|   |   ├── config_0_4_transition.rst
|   |   └── index.rst
|   ├── constants
|   |   └── index.rst
|   ├── convolution
|   |   ├── images
|   |   ├── index.rst
|   |   ├── kernels.rst
|   |   ├── non_normalized_kernels.rst
|   |   └── using.rst
|   ├── coordinates
|   |   ├── angles.rst
|   |   ├── apply_space_motion.rst
|   |   ├── definitions.rst
|   |   ├── formatting.rst
|   |   ├── frames.rst
|   |   ├── galactocentric.rst
|   |   ├── index.rst
|   |   ├── inplace.rst
|   |   ├── matchsep.rst
|   |   ├── references.txt
|   |   ├── remote_methods.rst
|   |   ├── representations.rst
|   |   ├── skycoord.rst
|   |   ├── solarsystem.rst
|   |   ├── transforming.rst
|   |   └── velocities.rst
|   ├── cosmology
|   |   └── index.rst
|   ├── credits.rst
|   ├── development
|   |   ├── astropy-package-template.rst
|   |   ├── building.rst
|   |   ├── ccython.rst
|   |   ├── codeguide.rst
|   |   ├── codeguide_emacs.rst
|   |   ├── docguide.rst
|   |   ├── docrules.rst
|   |   ├── releasing.rst
|   |   ├── scripts.rst
|   |   ├── testguide.rst
|   |   ├── vision.rst
|   |   └── workflow
|   |       ├── additional_git_topics.rst
|   |       ├── command_history.rst
|   |       ├── command_history.sh
|   |       ├── command_history_with_output.sh
|   |       ├── development_workflow.rst
|   |       ├── get_devel_version.rst
|   |       ├── git_edit_workflow_examples.rst
|   |       ├── git_install.rst
|   |       ├── git_resources.rst
|   |       ├── maintainer_workflow.rst
|   |       ├── patches.rst
|   |       ├── terminal_cast.rst
|   |       ├── virtual_pythons.rst
|   |       └── virtualenv_detail.rst
|   ├── getting_started.rst
|   ├── importing_astropy.rst
|   ├── index.rst
|   ├── install.rst
|   ├── io
|   |   ├── ascii
|   |   |   ├── base_classes.rst
|   |   |   ├── extension_classes.rst
|   |   |   ├── fast_ascii_io.rst
|   |   |   ├── fixed_width_gallery.rst
|   |   |   ├── index.rst
|   |   |   ├── read.rst
|   |   |   ├── references.txt
|   |   |   ├── toc.txt
|   |   |   └── write.rst
|   |   ├── fits
|   |   |   ├── api
|   |   |   |   ├── cards.rst
|   |   |   |   ├── diff.rst
|   |   |   |   ├── files.rst
|   |   |   |   ├── hdulists.rst
|   |   |   |   ├── hdus.rst
|   |   |   |   ├── headers.rst
|   |   |   |   ├── images.rst
|   |   |   |   ├── tables.rst
|   |   |   |   └── verification.rst
|   |   |   ├── appendix
|   |   |   |   ├── faq.rst
|   |   |   |   ├── header_transition.rst
|   |   |   |   └── history.rst
|   |   |   ├── index.rst
|   |   |   └── usage
|   |   |       ├── headers.rst
|   |   |       ├── image.rst
|   |   |       ├── misc.rst
|   |   |       ├── scripts.rst
|   |   |       ├── table.rst
|   |   |       ├── unfamiliar.rst
|   |   |       └── verification.rst
|   |   ├── misc.rst
|   |   ├── registry.rst
|   |   ├── unified.rst
|   |   └── votable
|   |       ├── api_exceptions.rst
|   |       ├── index.rst
|   |       └── references.txt
|   ├── known_issues.rst
|   ├── license.rst
|   ├── logging.rst
|   ├── modeling
|   |   ├── algorithms.rst
|   |   ├── bounding-boxes.rst
|   |   ├── compound-models.rst
|   |   ├── fitting.rst
|   |   ├── index.rst
|   |   ├── models.rst
|   |   ├── new.rst
|   |   ├── parameters.rst
|   |   └── units.rst
|   ├── nddata
|   |   ├── ccddata.rst
|   |   ├── decorator.rst
|   |   ├── index.rst
|   |   ├── mixins
|   |   |   ├── index.rst
|   |   |   ├── ndarithmetic.rst
|   |   |   ├── ndio.rst
|   |   |   └── ndslicing.rst
|   |   ├── nddata.rst
|   |   ├── subclassing.rst
|   |   └── utils.rst
|   ├── overview.rst
|   ├── samp
|   |   ├── advanced_embed_samp_hub.rst
|   |   ├── example_clients.rst
|   |   ├── example_hub.rst
|   |   ├── example_table_image.rst
|   |   ├── index.rst
|   |   └── references.txt
|   ├── stability.rst
|   ├── stats
|   |   ├── circ.rst
|   |   ├── index.rst
|   |   ├── lombscargle.rst
|   |   ├── ripley.rst
|   |   └── robust.rst
|   ├── table
|   |   ├── access_table.rst
|   |   ├── construct_table.rst
|   |   ├── implementation_details.rst
|   |   ├── index.rst
|   |   ├── indexing.rst
|   |   ├── io.rst
|   |   ├── masking.rst
|   |   ├── mixin_columns.rst
|   |   ├── modify_table.rst
|   |   ├── operations.rst
|   |   ├── pandas.rst
|   |   └── references.txt
|   ├── testhelpers.rst
|   ├── time
|   |   ├── index.rst
|   |   └── references.txt
|   ├── units
|   |   ├── combining_and_defining.rst
|   |   ├── conversion.rst
|   |   ├── decomposing_and_composing.rst
|   |   ├── equivalencies.rst
|   |   ├── format.rst
|   |   ├── index.rst
|   |   ├── logarithmic_units.rst
|   |   ├── quantity.rst
|   |   └── standard_units.rst
|   ├── utils
|   |   ├── iers.rst
|   |   ├── index.rst
|   |   └── numpy.rst
|   ├── visualization
|   |   ├── histogram.rst
|   |   ├── index.rst
|   |   ├── lupton_rgb.rst
|   |   ├── normalization.rst
|   |   └── wcsaxes
|   |       ├── controlling_axes.rst
|   |       ├── custom_frames.rst
|   |       ├── images_contours.rst
|   |       ├── index.rst
|   |       ├── initializing_axes.rst
|   |       ├── overlaying_coordinate_systems.rst
|   |       ├── overlays.rst
|   |       ├── slicing_datacubes.rst
|   |       └── ticks_labels_grid.rst
|   ├── warnings.rst
|   ├── wcs
|   |   ├── examples
|   |   |   ├── from_file.py
|   |   |   └── programmatic.py
|   |   ├── history.rst
|   |   ├── index.rst
|   |   ├── note_sip.rst
|   |   ├── references.rst
|   |   ├── references.txt
|   |   └── relax.rst
|   └── whatsnew
|       ├── 0.1.rst
|       ├── 0.2.rst
|       ├── 0.3.rst
|       ├── 0.4.rst
|       ├── 1.0.rst
|       ├── 1.1.rst
|       ├── 1.2.rst
|       ├── 1.3.rst
|       ├── 2.0.rst
|       ├── 3.0.rst
|       ├── 3.1.rst
|       └── index.rst
├── examples
|   ├── README.txt
|   ├── coordinates
|   |   ├── README.txt
|   |   ├── plot_galactocentric-frame.py
|   |   ├── plot_obs-planning.py
|   |   ├── plot_sgr-coordinate-frame.py
|   |   └── rv-to-gsr.py
|   ├── io
|   |   ├── README.txt
|   |   ├── create-mef.py
|   |   ├── fits-tables.py
|   |   ├── modify-fits-header.py
|   |   ├── plot_fits-image.py
|   |   ├── skip_create-large-fits.py
|   |   └── split-jpeg-to-fits.py
|   └── template
|       └── example-template.py
├── ez_setup.py
├── licenses
|   ├── AURA_LICENSE.rst
|   ├── CONFIGOBJ_LICENSE.rst
|   ├── DATATABLES_LICENSE.rst
|   ├── ERFA.rst
|   ├── EXPAT_LICENSE.rst
|   ├── JQUERY_LICENSE.rst
|   ├── NUMPY_LICENSE.rst
|   ├── PLY_LICENSE.rst
|   ├── PYFITS.rst
|   ├── README.rst
|   └── WCSLIB_LICENSE.rst
├── readthedocs.yml
├── setup.py
└── static
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: units.quantity_input decorator fails for constructors with type hinted return value -> None

Description: ### Summary
I am using the `units.quantity_input` decorator with typing hints for constructors, however when I add the correct return value for the constructor (`None`) then I get an exception, because `None` has no attribute `to`.

### Reproducer
The issue can be reproduced with the following file:
``` Python
import astropy.units as u


class PoC(object):

    @u.quantity_input
    def __init__(self, voltage: u.V) -> None:
        pass


if __name__ == '__main__':
    poc = PoC(1.*u.V)
```
which results in the following error:
```
$ python3 poc.py
Traceback (most recent call last):
  File "poc.py", line 12, in <module>
    poc = PoC(1.*u.V)
  File "/usr/lib64/python3.6/site-packages/astropy/utils/decorators.py", line 868, in __init__
    func = make_function_with_signature(func, name=name, **wrapped_args)
  File "/usr/lib64/python3.6/site-packages/astropy/units/decorators.py", line 225, in wrapper
    return return_.to(wrapped_signature.return_annotation)
AttributeError: 'NoneType' object has no attribute 'to'
```

This has been tested on Fedora 27 with python 3.6.3, astropy 2.0.2 and numpy 1.13.3 all from Fedora's repository.

### Workaround
The issue can be circumvented by not adding the return type typing hint. Unfortunately, then a static type checker cannot infer that this function returns nothing.

### Possible fix
Maybe the decorator could explicitly check whether None is returned and then omit the unit check.

Patch information:
diff --git a/astropy/units/decorators.py b/astropy/units/decorators.py
index 8bece5a850..fc185cb5e0 100644
--- a/astropy/units/decorators.py
+++ b/astropy/units/decorators.py
@@ -221,6 +221,9 @@ class QuantityInput:
             with add_enabled_equivalencies(self.equivalencies):
                 return_ = wrapped_function(*func_args, **func_kwargs)
             if wrapped_signature.return_annotation is not inspect.Signature.empty:
+                # If the return value is None, return it directly without trying to convert units
+                if return_ is None:
+                    return None
                 return return_.to(wrapped_signature.return_annotation)
             else:
                 return return_


Find all relevant source code context needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of astropy/units/decorators.py.
Extra Requirements: 
Purpose: This file is needed to understand the implementation of the `quantity_input` decorator and how it handles return value annotations, or fails to handle, `None` return types from decorated functions like `__init__`.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: astropy/units/decorators.py
Line number range: 1 - 231
Content:
1. # -*- coding: utf-8 -*-
2. # Licensed under a 3-clause BSD style license - see LICENSE.rst
3. 
4. __all__ = ['quantity_input']
5. 
6. import inspect
7. from ..utils.decorators import wraps
8. from ..utils.misc import isiterable
9. 
10. from .core import Unit, UnitsError, add_enabled_equivalencies
11. from .physical import _unit_physical_mapping
12. 
13. 
14. def _get_allowed_units(targets):
15.     """
16.     From a list of target units (either as strings or unit objects) and physical
17.     types, return a list of Unit objects.
18.     """
19. 
20.     allowed_units = []
21.     for target in targets:
22. 
23.         try:  # unit passed in as a string
24.             target_unit = Unit(target)
25. 
26.         except ValueError:
27. 
28.             try:  # See if the function writer specified a physical type
29.                 physical_type_id = _unit_physical_mapping[target]
30. 
31.             except KeyError:  # Function argument target is invalid
32.                 raise ValueError("Invalid unit or physical type '{0}'."
33.                                  .format(target))
34. 
35.             # get unit directly from physical type id
36.             target_unit = Unit._from_physical_type_id(physical_type_id)
37. 
38.         allowed_units.append(target_unit)
39. 
40.     return allowed_units
41. 
42. 
43. def _validate_arg_value(param_name, func_name, arg, targets, equivalencies):
44.     """
45.     Validates the object passed in to the wrapped function, ``arg``, with target
46.     unit or physical type, ``target``.
47.     """
48. 
49.     allowed_units = _get_allowed_units(targets)
50. 
51.     for allowed_unit in allowed_units:
52.         try:
53.             is_equivalent = arg.unit.is_equivalent(allowed_unit,
54.                                                    equivalencies=equivalencies)
55. 
56.             if is_equivalent:
57.                 break
58. 
59.         except AttributeError:  # Either there is no .unit or no .is_equivalent
60.             if hasattr(arg, "unit"):
61.                 error_msg = "a 'unit' attribute without an 'is_equivalent' method"
62.             else:
63.                 error_msg = "no 'unit' attribute"
64. 
65.             raise TypeError("Argument '{0}' to function '{1}' has {2}. "
66.                   "You may want to pass in an astropy Quantity instead."
67.                      .format(param_name, func_name, error_msg))
68. 
69.     else:
70.         if len(targets) > 1:
71.             raise UnitsError("Argument '{0}' to function '{1}' must be in units"
72.                              " convertible to one of: {2}."
73.                              .format(param_name, func_name,
74.                                      [str(targ) for targ in targets]))
75.         else:
76.             raise UnitsError("Argument '{0}' to function '{1}' must be in units"
77.                              " convertible to '{2}'."
78.                              .format(param_name, func_name,
79.                                      str(targets[0])))
80. 
81. 
82. class QuantityInput:
83. 
84.     @classmethod
85.     def as_decorator(cls, func=None, **kwargs):
86.         r"""
87.         A decorator for validating the units of arguments to functions.
88. 
89.         Unit specifications can be provided as keyword arguments to the decorator,
90.         or by using function annotation syntax. Arguments to the decorator
91.         take precedence over any function annotations present.
92. 
93.         A `~astropy.units.UnitsError` will be raised if the unit attribute of
94.         the argument is not equivalent to the unit specified to the decorator
95.         or in the annotation.
96.         If the argument has no unit attribute, i.e. it is not a Quantity object, a
97.         `ValueError` will be raised.
98. 
99.         Where an equivalency is specified in the decorator, the function will be
100.         executed with that equivalency in force.
101. 
102.         Notes
103.         -----
104. 
105.         The checking of arguments inside variable arguments to a function is not
106.         supported (i.e. \*arg or \**kwargs).
107. 
108.         Examples
109.         --------
110. 
111.         .. code-block:: python
112. 
113.             import astropy.units as u
114.             @u.quantity_input(myangle=u.arcsec)
115.             def myfunction(myangle):
116.                 return myangle**2
117. 
118. 
119.         .. code-block:: python
120. 
121.             import astropy.units as u
122.             @u.quantity_input
123.             def myfunction(myangle: u.arcsec):
124.                 return myangle**2
125. 
126.         Also you can specify a return value annotation, which will
127.         cause the function to always return a `~astropy.units.Quantity` in that
128.         unit.
129. 
130.         .. code-block:: python
131. 
132.             import astropy.units as u
133.             @u.quantity_input
134.             def myfunction(myangle: u.arcsec) -> u.deg**2:
135.                 return myangle**2
136. 
137.         Using equivalencies::
138. 
139.             import astropy.units as u
140.             @u.quantity_input(myenergy=u.eV, equivalencies=u.mass_energy())
141.             def myfunction(myenergy):
142.                 return myenergy**2
143. 
144.         """
145.         self = cls(**kwargs)
146.         if func is not None and not kwargs:
147.             return self(func)
148.         else:
149.             return self
150. 
151.     def __init__(self, func=None, **kwargs):
152.         self.equivalencies = kwargs.pop('equivalencies', [])
153.         self.decorator_kwargs = kwargs
154. 
155.     def __call__(self, wrapped_function):
156. 
157.         # Extract the function signature for the function we are wrapping.
158.         wrapped_signature = inspect.signature(wrapped_function)
159. 
160.         # Define a new function to return in place of the wrapped one
161.         @wraps(wrapped_function)
162.         def wrapper(*func_args, **func_kwargs):
163.             # Bind the arguments to our new function to the signature of the original.
164.             bound_args = wrapped_signature.bind(*func_args, **func_kwargs)
165. 
166.             # Iterate through the parameters of the original signature
167.             for param in wrapped_signature.parameters.values():
168.                 # We do not support variable arguments (*args, **kwargs)
169.                 if param.kind in (inspect.Parameter.VAR_KEYWORD,
170.                                   inspect.Parameter.VAR_POSITIONAL):
171.                     continue
172. 
173.                 # Catch the (never triggered) case where bind relied on a default value.
174.                 if param.name not in bound_args.arguments and param.default is not param.empty:
175.                     bound_args.arguments[param.name] = param.default
176. 
177.                 # Get the value of this parameter (argument to new function)
178.                 arg = bound_args.arguments[param.name]
179. 
180.                 # Get target unit or physical type, either from decorator kwargs
181.                 #   or annotations
182.                 if param.name in self.decorator_kwargs:
183.                     targets = self.decorator_kwargs[param.name]
184.                 else:
185.                     targets = param.annotation
186. 
187.                 # If the targets is empty, then no target units or physical
188.                 #   types were specified so we can continue to the next arg
189.                 if targets is inspect.Parameter.empty:
190.                     continue
191. 
192.                 # If the argument value is None, and the default value is None,
193.                 #   pass through the None even if there is a target unit
194.                 if arg is None and param.default is None:
195.                     continue
196. 
197.                 # Here, we check whether multiple target unit/physical type's
198.                 #   were specified in the decorator/annotation, or whether a
199.                 #   single string (unit or physical type) or a Unit object was
200.                 #   specified
201.                 if isinstance(targets, str) or not isiterable(targets):
202.                     valid_targets = [targets]
203. 
204.                 # Check for None in the supplied list of allowed units and, if
205.                 #   present and the passed value is also None, ignore.
206.                 elif None in targets:
207.                     if arg is None:
208.                         continue
209.                     else:
210.                         valid_targets = [t for t in targets if t is not None]
211. 
212.                 else:
213.                     valid_targets = targets
214. 
215.                 # Now we loop over the allowed units/physical types and validate
216.                 #   the value of the argument:
217.                 _validate_arg_value(param.name, wrapped_function.__name__,
218.                                     arg, valid_targets, self.equivalencies)
219. 
220.             # Call the original function with any equivalencies in force.
221.             with add_enabled_equivalencies(self.equivalencies):
222.                 return_ = wrapped_function(*func_args, **func_kwargs)
223.             if wrapped_signature.return_annotation is not inspect.Signature.empty:
224.                 return return_.to(wrapped_signature.return_annotation)
225.             else:
226.                 return return_
227. 
228.         return wrapper
229. 
230. 
231. quantity_input = QuantityInput.as_decorator

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 19:33:30,033 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="The user's traceback indicates that `astropy/utils/decorators.py` is part of the call stack that leads to the error. The `quantity_input` decorator in `astropy/units/decorators.py` uses the `wraps` helper from `astropy/utils/decorators.py`. To fully understand why the decorator fails for `__init__` methods, it is essential to examine the implementation of `wraps` and any other relevant utilities in `astropy/utils/decorators.py` that might have special handling for `__init__` methods." query='Please provide the full content of astropy/utils/decorators.py.' extra_requirements='' purpose='This file is required to understand the full execution path that leads to the error, particularly how decorators on `__init__` methods are handled, as indicated by the traceback.'
2025-12-21 19:33:30,034 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of astropy/utils/decorators.py.
2025-12-21 19:33:30,034 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-21 19:33:30,038 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-21 19:33:30,039 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-21 19:33:30,039 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of astropy/utils/decorators.py.
Purpose: This file is required to understand the full execution path that leads to the error, particularly how decorators on `__init__` methods are handled, as indicated by the traceback.
2025-12-21 19:33:32,650 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the full content of `astropy/utils/decorators.py` as you requested. This will allow you to examine the decorators, such as `@deprecated_renamed_argument`, and understand how they behave, especially when applied to `__init__` methods. This information should help in diagnosing the root cause of the error.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "astropy/utils/decorators.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2143, 'candidates_token_count': 92, 'total_token_count': 2342, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2143}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 92}], 'thoughts_token_count': 107, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.10578369057696799, 'model_name': 'gemini-2.5-pro'} id='run--900b7655-6824-4767-97e8-d8d8b2c8498d-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'astropy/utils/decorators.py'}, 'id': '1cf1524e-88c7-47ed-b8a8-04cd4bee1e9f', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2143, 'output_tokens': 92, 'total_tokens': 2342, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 107}}
2025-12-21 19:34:20,252 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the full content of `astropy/utils/decorators.py` as you requested. This will allow you to examine the decorators, such as `@deprecated_renamed_argument`, and understand how they behave, especially when applied to `__init__` methods. This information should help in diagnosing the root cause of the error.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "astropy/utils/decorators.py", "start_line": 501.0, "end_line": 1001.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 9216, 'candidates_token_count': 98, 'total_token_count': 17183, 'cached_content_token_count': 1836, 'prompt_tokens_details': [{'modality': 1, 'token_count': 9216}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1836}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 98}], 'thoughts_token_count': 7869}, 'finish_reason': 'STOP', 'avg_logprobs': -1.0215604353924186, 'model_name': 'gemini-2.5-pro'} id='run--51ac4702-488c-4716-be45-76434b3c59b0-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'astropy/utils/decorators.py', 'start_line': 501.0, 'end_line': 1001.0}, 'id': '9d410974-762f-4c4b-a11b-3fbf420da03d', 'type': 'tool_call'}] usage_metadata={'input_tokens': 9216, 'output_tokens': 98, 'total_tokens': 17183, 'input_token_details': {'cache_read': 1836}, 'output_token_details': {'reasoning': 7869}}
2025-12-21 19:34:24,264 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the full content of `astropy/utils/decorators.py` by reading it in two parts and combining them. This gives you the complete source code for the file, which should be instrumental in understanding the decorator implementations and debugging the issue at hand.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 16090, 'candidates_token_count': 54, 'total_token_count': 16422, 'cached_content_token_count': 9496, 'prompt_tokens_details': [{'modality': 1, 'token_count': 16090}], 'cache_tokens_details': [{'modality': 1, 'token_count': 9496}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 54}], 'thoughts_token_count': 278}, 'finish_reason': 'STOP', 'avg_logprobs': -0.6528903819896557, 'model_name': 'gemini-2.5-pro'} id='run--104dc44f-eea4-495b-88ca-b2965c7abeb0-0' usage_metadata={'input_tokens': 16090, 'output_tokens': 54, 'total_tokens': 16422, 'input_token_details': {'cache_read': 9496}, 'output_token_details': {'reasoning': 278}}
2025-12-21 19:34:24,266 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of astropy/utils/decorators.py.
--- END QUERY ---



--- BEGIN PURPOSE ---
This file is required to understand the full execution path that leads to the error, particularly how decorators on `__init__` methods are handled, as indicated by the traceback.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: astropy/utils/decorators.py
Line number range: 1 - 500
Content:
1. # -*- coding: utf-8 -*-
2. # Licensed under a 3-clause BSD style license - see LICENSE.rst
3. """Sundry function and class decorators."""
4. 
5. 
6. 
7. import functools
8. import inspect
9. import textwrap
10. import types
11. import warnings
12. from inspect import signature
13. 
14. from .codegen import make_function_with_signature
15. from .exceptions import (AstropyDeprecationWarning, AstropyUserWarning,
16.                          AstropyPendingDeprecationWarning)
17. 
18. 
19. __all__ = ['classproperty', 'deprecated', 'deprecated_attribute',
20.            'deprecated_renamed_argument', 'format_doc',
21.            'lazyproperty', 'sharedmethod', 'wraps']
22. 
23. 
24. def deprecated(since, message='', name='', alternative='', pending=False,
25.                obj_type=None):
26.     """
27.     Used to mark a function or class as deprecated.
28. 
29.     To mark an attribute as deprecated, use `deprecated_attribute`.
30. 
31.     Parameters
32.     ------------
33.     since : str
34.         The release at which this API became deprecated.  This is
35.         required.
36. 
37.     message : str, optional
38.         Override the default deprecation message.  The format
39.         specifier ``func`` may be used for the name of the function,
40.         and ``alternative`` may be used in the deprecation message
41.         to insert the name of an alternative to the deprecated
42.         function. ``obj_type`` may be used to insert a friendly name
43.         for the type of object being deprecated.
44. 
45.     name : str, optional
46.         The name of the deprecated function or class; if not provided
47.         the name is automatically determined from the passed in
48.         function or class, though this is useful in the case of
49.         renamed functions, where the new function is just assigned to
50.         the name of the deprecated function.  For example::
51. 
52.             def new_function():
53.                 ...
54.             oldFunction = new_function
55. 
56.     alternative : str, optional
57.         An alternative function or class name that the user may use in
58.         place of the deprecated object.  The deprecation warning will
59.         tell the user about this alternative if provided.
60. 
61.     pending : bool, optional
62.         If True, uses a AstropyPendingDeprecationWarning instead of a
63.         AstropyDeprecationWarning.
64. 
65.     obj_type : str, optional
66.         The type of this object, if the automatically determined one
67.         needs to be overridden.
68.     """
69. 
70.     method_types = (classmethod, staticmethod, types.MethodType)
71. 
72.     def deprecate_doc(old_doc, message):
73.         """
74.         Returns a given docstring with a deprecation message prepended
75.         to it.
76.         """
77.         if not old_doc:
78.             old_doc = ''
79.         old_doc = textwrap.dedent(old_doc).strip('\n')
80.         new_doc = (('\n.. deprecated:: {since}'
81.                     '\n    {message}\n\n'.format(
82.                     **{'since': since, 'message': message.strip()})) + old_doc)
83.         if not old_doc:
84.             # This is to prevent a spurious 'unexpected unindent' warning from
85.             # docutils when the original docstring was blank.
86.             new_doc += r'\ '
87.         return new_doc
88. 
89.     def get_function(func):
90.         """
91.         Given a function or classmethod (or other function wrapper type), get
92.         the function object.
93.         """
94.         if isinstance(func, method_types):
95.             func = func.__func__
96.         return func
97. 
98.     def deprecate_function(func, message):
99.         """
100.         Returns a wrapped function that displays an
101.         ``AstropyDeprecationWarning`` when it is called.
102.         """
103. 
104.         if isinstance(func, method_types):
105.             func_wrapper = type(func)
106.         else:
107.             func_wrapper = lambda f: f
108. 
109.         func = get_function(func)
110. 
111.         def deprecated_func(*args, **kwargs):
112.             if pending:
113.                 category = AstropyPendingDeprecationWarning
114.             else:
115.                 category = AstropyDeprecationWarning
116. 
117.             warnings.warn(message, category, stacklevel=2)
118. 
119.             return func(*args, **kwargs)
120. 
121.         # If this is an extension function, we can't call
122.         # functools.wraps on it, but we normally don't care.
123.         # This crazy way to get the type of a wrapper descriptor is
124.         # straight out of the Python 3.3 inspect module docs.
125.         if type(func) is not type(str.__dict__['__add__']):  # nopep8
126.             deprecated_func = functools.wraps(func)(deprecated_func)
127. 
128.         deprecated_func.__doc__ = deprecate_doc(
129.             deprecated_func.__doc__, message)
130. 
131.         return func_wrapper(deprecated_func)
132. 
133.     def deprecate_class(cls, message):
134.         """
135.         Update the docstring and wrap the ``__init__`` in-place (or ``__new__``
136.         if the class or any of the bases overrides ``__new__``) so it will give
137.         a deprecation warning when an instance is created.
138. 
139.         This won't work for extension classes because these can't be modified
140.         in-place and the alternatives don't work in the general case:
141. 
142.         - Using a new class that looks and behaves like the original doesn't
143.           work because the __new__ method of extension types usually makes sure
144.           that it's the same class or a subclass.
145.         - Subclassing the class and return the subclass can lead to problems
146.           with pickle and will look weird in the Sphinx docs.
147.         """
148.         cls.__doc__ = deprecate_doc(cls.__doc__, message)
149.         if cls.__new__ is object.__new__:
150.             cls.__init__ = deprecate_function(get_function(cls.__init__), message)
151.         else:
152.             cls.__new__ = deprecate_function(get_function(cls.__new__), message)
153.         return cls
154. 
155.     def deprecate(obj, message=message, name=name, alternative=alternative,
156.                   pending=pending):
157.         if obj_type is None:
158.             if isinstance(obj, type):
159.                 obj_type_name = 'class'
160.             elif inspect.isfunction(obj):
161.                 obj_type_name = 'function'
162.             elif inspect.ismethod(obj) or isinstance(obj, method_types):
163.                 obj_type_name = 'method'
164.             else:
165.                 obj_type_name = 'object'
166.         else:
167.             obj_type_name = obj_type
168. 
169.         if not name:
170.             name = get_function(obj).__name__
171. 
172.         altmessage = ''
173.         if not message or type(message) is type(deprecate):
174.             if pending:
175.                 message = ('The {func} {obj_type} will be deprecated in a '
176.                            'future version.')
177.             else:
178.                 message = ('The {func} {obj_type} is deprecated and may '
179.                            'be removed in a future version.')
180.             if alternative:
181.                 altmessage = '\n        Use {} instead.'.format(alternative)
182. 
183.         message = ((message.format(**{
184.             'func': name,
185.             'name': name,
186.             'alternative': alternative,
187.             'obj_type': obj_type_name})) +
188.             altmessage)
189. 
190.         if isinstance(obj, type):
191.             return deprecate_class(obj, message)
192.         else:
193.             return deprecate_function(obj, message)
194. 
195.     if type(message) is type(deprecate):
196.         return deprecate(message)
197. 
198.     return deprecate
199. 
200. 
201. def deprecated_attribute(name, since, message=None, alternative=None,
202.                          pending=False):
203.     """
204.     Used to mark a public attribute as deprecated.  This creates a
205.     property that will warn when the given attribute name is accessed.
206.     To prevent the warning (i.e. for internal code), use the private
207.     name for the attribute by prepending an underscore
208.     (i.e. ``self._name``).
209. 
210.     Parameters
211.     ----------
212.     name : str
213.         The name of the deprecated attribute.
214. 
215.     since : str
216.         The release at which this API became deprecated.  This is
217.         required.
218. 
219.     message : str, optional
220.         Override the default deprecation message.  The format
221.         specifier ``name`` may be used for the name of the attribute,
222.         and ``alternative`` may be used in the deprecation message
223.         to insert the name of an alternative to the deprecated
224.         function.
225. 
226.     alternative : str, optional
227.         An alternative attribute that the user may use in place of the
228.         deprecated attribute.  The deprecation warning will tell the
229.         user about this alternative if provided.
230. 
231.     pending : bool, optional
232.         If True, uses a AstropyPendingDeprecationWarning instead of a
233.         AstropyDeprecationWarning.
234. 
235.     Examples
236.     --------
237. 
238.     ::
239. 
240.         class MyClass:
241.             # Mark the old_name as deprecated
242.             old_name = misc.deprecated_attribute('old_name', '0.1')
243. 
244.             def method(self):
245.                 self._old_name = 42
246.     """
247.     private_name = '_' + name
248. 
249.     @deprecated(since, name=name, obj_type='attribute')
250.     def get(self):
251.         return getattr(self, private_name)
252. 
253.     @deprecated(since, name=name, obj_type='attribute')
254.     def set(self, val):
255.         setattr(self, private_name, val)
256. 
257.     @deprecated(since, name=name, obj_type='attribute')
258.     def delete(self):
259.         delattr(self, private_name)
260. 
261.     return property(get, set, delete)
262. 
263. 
264. def deprecated_renamed_argument(old_name, new_name, since,
265.                                 arg_in_kwargs=False, relax=False,
266.                                 pending=False):
267.     """Deprecate a _renamed_ function argument.
268. 
269.     The decorator assumes that the argument with the ``old_name`` was removed
270.     from the function signature and the ``new_name`` replaced it at the
271.     **same position** in the signature.  If the ``old_name`` argument is
272.     given when calling the decorated function the decorator will catch it and
273.     issue a deprecation warning and pass it on as ``new_name`` argument.
274. 
275.     Parameters
276.     ----------
277.     old_name : str or list/tuple thereof
278.         The old name of the argument.
279. 
280.     new_name : str or list/tuple thereof
281.         The new name of the argument.
282. 
283.     since : str or number or list/tuple thereof
284.         The release at which the old argument became deprecated.
285. 
286.     arg_in_kwargs : bool or list/tuple thereof, optional
287.         If the argument is not a named argument (for example it
288.         was meant to be consumed by ``**kwargs``) set this to
289.         ``True``.  Otherwise the decorator will throw an Exception
290.         if the ``new_name`` cannot be found in the signature of
291.         the decorated function.
292.         Default is ``False``.
293. 
294.     relax : bool or list/tuple thereof, optional
295.         If ``False`` a ``TypeError`` is raised if both ``new_name`` and
296.         ``old_name`` are given.  If ``True`` the value for ``new_name`` is used
297.         and a Warning is issued.
298.         Default is ``False``.
299. 
300.     pending : bool or list/tuple thereof, optional
301.         If ``True`` this will hide the deprecation warning and ignore the
302.         corresponding ``relax`` parameter value.
303.         Default is ``False``.
304. 
305.     Raises
306.     ------
307.     TypeError
308.         If the new argument name cannot be found in the function
309.         signature and arg_in_kwargs was False or if it is used to
310.         deprecate the name of the ``*args``-, ``**kwargs``-like arguments.
311.         At runtime such an Error is raised if both the new_name
312.         and old_name were specified when calling the function and
313.         "relax=False".
314. 
315.     Notes
316.     -----
317.     The decorator should be applied to a function where the **name**
318.     of an argument was changed but it applies the same logic.
319. 
320.     .. warning::
321.         If ``old_name`` is a list or tuple the ``new_name`` and ``since`` must
322.         also be a list or tuple with the same number of entries. ``relax`` and
323.         ``arg_in_kwarg`` can be a single bool (applied to all) or also a
324.         list/tuple with the same number of entries like ``new_name``, etc.
325. 
326.     Examples
327.     --------
328.     The deprecation warnings are not shown in the following examples.
329. 
330.     To deprecate a positional or keyword argument::
331. 
332.         >>> from astropy.utils.decorators import deprecated_renamed_argument
333.         >>> @deprecated_renamed_argument('sig', 'sigma', '1.0')
334.         ... def test(sigma):
335.         ...     return sigma
336. 
337.         >>> test(2)
338.         2
339.         >>> test(sigma=2)
340.         2
341.         >>> test(sig=2)
342.         2
343. 
344.     To deprecate an argument catched inside the ``**kwargs`` the
345.     ``arg_in_kwargs`` has to be set::
346. 
347.         >>> @deprecated_renamed_argument('sig', 'sigma', '1.0',
348.         ...                             arg_in_kwargs=True)
349.         ... def test(**kwargs):
350.         ...     return kwargs['sigma']
351. 
352.         >>> test(sigma=2)
353.         2
354.         >>> test(sig=2)
355.         2
356. 
357.     By default providing the new and old keyword will lead to an Exception. If
358.     a Warning is desired set the ``relax`` argument::
359. 
360.         >>> @deprecated_renamed_argument('sig', 'sigma', '1.0', relax=True)
361.         ... def test(sigma):
362.         ...     return sigma
363. 
364.         >>> test(sig=2)
365.         2
366. 
367.     It is also possible to replace multiple arguments. The ``old_name``,
368.     ``new_name`` and ``since`` have to be `tuple` or `list` and contain the
369.     same number of entries::
370. 
371.         >>> @deprecated_renamed_argument(['a', 'b'], ['alpha', 'beta'],
372.         ...                              ['1.0', 1.2])
373.         ... def test(alpha, beta):
374.         ...     return alpha, beta
375. 
376.         >>> test(a=2, b=3)
377.         (2, 3)
378. 
379.     In this case ``arg_in_kwargs`` and ``relax`` can be a single value (which
380.     is applied to all renamed arguments) or must also be a `tuple` or `list`
381.     with values for each of the arguments.
382.     """
383.     cls_iter = (list, tuple)
384.     if isinstance(old_name, cls_iter):
385.         n = len(old_name)
386.         # Assume that new_name and since are correct (tuple/list with the
387.         # appropriate length) in the spirit of the "consenting adults". But the
388.         # optional parameters may not be set, so if these are not iterables
389.         # wrap them.
390.         if not isinstance(arg_in_kwargs, cls_iter):
391.             arg_in_kwargs = [arg_in_kwargs] * n
392.         if not isinstance(relax, cls_iter):
393.             relax = [relax] * n
394.         if not isinstance(pending, cls_iter):
395.             pending = [pending] * n
396.     else:
397.         # To allow a uniform approach later on, wrap all arguments in lists.
398.         n = 1
399.         old_name = [old_name]
400.         new_name = [new_name]
401.         since = [since]
402.         arg_in_kwargs = [arg_in_kwargs]
403.         relax = [relax]
404.         pending = [pending]
405. 
406.     def decorator(function):
407.         # The named arguments of the function.
408.         arguments = signature(function).parameters
409.         keys = list(arguments.keys())
410.         position = [None] * n
411. 
412.         for i in range(n):
413.             # Determine the position of the argument.
414.             if new_name[i] in arguments:
415.                 param = arguments[new_name[i]]
416.                 # There are several possibilities now:
417. 
418.                 # 1.) Positional or keyword argument:
419.                 if param.kind == param.POSITIONAL_OR_KEYWORD:
420.                     position[i] = keys.index(new_name[i])
421. 
422.                 # 2.) Keyword only argument:
423.                 elif param.kind == param.KEYWORD_ONLY:
424.                     # These cannot be specified by position.
425.                     position[i] = None
426. 
427.                 # 3.) positional-only argument, varargs, varkwargs or some
428.                 #     unknown type:
429.                 else:
430.                     raise TypeError('cannot replace argument "{0}" of kind '
431.                                     '{1!r}.'.format(new_name[i], param.kind))
432. 
433.             # In case the argument is not found in the list of arguments
434.             # the only remaining possibility is that it should be catched
435.             # by some kind of **kwargs argument.
436.             # This case has to be explicitly specified, otherwise throw
437.             # an exception!
438.             elif arg_in_kwargs[i]:
439.                 position[i] = None
440.             else:
441.                 raise TypeError('"{}" was not specified in the function '
442.                                 'signature. If it was meant to be part of '
443.                                 '"**kwargs" then set "arg_in_kwargs" to "True"'
444.                                 '.'.format(new_name[i]))
445. 
446.         @functools.wraps(function)
447.         def wrapper(*args, **kwargs):
448.             for i in range(n):
449.                 # The only way to have oldkeyword inside the function is
450.                 # that it is passed as kwarg because the oldkeyword
451.                 # parameter was renamed to newkeyword.
452.                 if old_name[i] in kwargs:
453.                     value = kwargs.pop(old_name[i])
454.                     # Display the deprecation warning only when it's only
455.                     # pending.
456.                     if not pending[i]:
457.                         warnings.warn(
458.                             '"{0}" was deprecated in version {1} '
459.                             'and will be removed in a future version. '
460.                             'Use argument "{2}" instead.'
461.                             ''.format(old_name[i], since[i], new_name[i]),
462.                             AstropyDeprecationWarning, stacklevel=2)
463. 
464.                     # Check if the newkeyword was given as well.
465.                     newarg_in_args = (position[i] is not None and
466.                                       len(args) > position[i])
467.                     newarg_in_kwargs = new_name[i] in kwargs
468. 
469.                     if newarg_in_args or newarg_in_kwargs:
470.                         if not pending[i]:
471.                             # If both are given print a Warning if relax is
472.                             # True or raise an Exception is relax is False.
473.                             if relax[i]:
474.                                 warnings.warn(
475.                                     '"{0}" and "{1}" keywords were set. '
476.                                     'Using the value of "{1}".'
477.                                     ''.format(old_name[i], new_name[i]),
478.                                     AstropyUserWarning)
479.                             else:
480.                                 raise TypeError(
481.                                     'cannot specify both "{}" and "{}"'
482.                                     '.'.format(old_name[i], new_name[i]))
483.                     else:
484.                         # If the new argument isn't specified just pass the old
485.                         # one with the name of the new argument to the function
486.                         kwargs[new_name[i]] = value
487.             return function(*args, **kwargs)
488. 
489.         return wrapper
490.     return decorator
491. 
492. 
493. # TODO: This can still be made to work for setters by implementing an
494. # accompanying metaclass that supports it; we just don't need that right this
495. # second
496. class classproperty(property):
497.     """
498.     Similar to `property`, but allows class-level properties.  That is,
499.     a property whose getter is like a `classmethod`.
500.


File: astropy/utils/decorators.py
Line number range: 501 - 1001
Content:
501.     The wrapped method may explicitly use the `classmethod` decorator (which
502.     must become before this decorator), or the `classmethod` may be omitted
503.     (it is implicit through use of this decorator).
504. 
505.     .. note::
506. 
507.         classproperty only works for *read-only* properties.  It does not
508.         currently allow writeable/deleteable properties, due to subtleties of how
509.         Python descriptors work.  In order to implement such properties on a class
510.         a metaclass for that class must be implemented.
511. 
512.     Parameters
513.     ----------
514.     fget : callable
515.         The function that computes the value of this property (in particular,
516.         the function when this is used as a decorator) a la `property`.
517. 
518.     doc : str, optional
519.         The docstring for the property--by default inherited from the getter
520.         function.
521. 
522.     lazy : bool, optional
523.         If True, caches the value returned by the first call to the getter
524.         function, so that it is only called once (used for lazy evaluation
525.         of an attribute).  This is analogous to `lazyproperty`.  The ``lazy``
526.         argument can also be used when `classproperty` is used as a decorator
527.         (see the third example below).  When used in the decorator syntax this
528.         *must* be passed in as a keyword argument.
529. 
530.     Examples
531.     --------
532. 
533.     ::
534. 
535.         >>> class Foo:
536.         ...     _bar_internal = 1
537.         ...     @classproperty
538.         ...     def bar(cls):
539.         ...         return cls._bar_internal + 1
540.         ...
541.         >>> Foo.bar
542.         2
543.         >>> foo_instance = Foo()
544.         >>> foo_instance.bar
545.         2
546.         >>> foo_instance._bar_internal = 2
547.         >>> foo_instance.bar  # Ignores instance attributes
548.         2
549. 
550.     As previously noted, a `classproperty` is limited to implementing
551.     read-only attributes::
552. 
553.         >>> class Foo:
554.         ...     _bar_internal = 1
555.         ...     @classproperty
556.         ...     def bar(cls):
557.         ...         return cls._bar_internal
558.         ...     @bar.setter
559.         ...     def bar(cls, value):
560.         ...         cls._bar_internal = value
561.         ...
562.         Traceback (most recent call last):
563.         ...
564.         NotImplementedError: classproperty can only be read-only; use a
565.         metaclass to implement modifiable class-level properties
566. 
567.     When the ``lazy`` option is used, the getter is only called once::
568. 
569.         >>> class Foo:
570.         ...     @classproperty(lazy=True)
571.         ...     def bar(cls):
572.         ...         print("Performing complicated calculation")
573.         ...         return 1
574.         ...
575.         >>> Foo.bar
576.         Performing complicated calculation
577.         1
578.         >>> Foo.bar
579.         1
580. 
581.     If a subclass inherits a lazy `classproperty` the property is still
582.     re-evaluated for the subclass::
583. 
584.         >>> class FooSub(Foo):
585.         ...     pass
586.         ...
587.         >>> FooSub.bar
588.         Performing complicated calculation
589.         1
590.         >>> FooSub.bar
591.         1
592.     """
593. 
594.     def __new__(cls, fget=None, doc=None, lazy=False):
595.         if fget is None:
596.             # Being used as a decorator--return a wrapper that implements
597.             # decorator syntax
598.             def wrapper(func):
599.                 return cls(func, lazy=lazy)
600. 
601.             return wrapper
602. 
603.         return super().__new__(cls)
604. 
605.     def __init__(self, fget, doc=None, lazy=False):
606.         self._lazy = lazy
607.         if lazy:
608.             self._cache = {}
609.         fget = self._wrap_fget(fget)
610. 
611.         super().__init__(fget=fget, doc=doc)
612. 
613.         # There is a buglet in Python where self.__doc__ doesn't
614.         # get set properly on instances of property subclasses if
615.         # the doc argument was used rather than taking the docstring
616.         # from fget
617.         # Related Python issue: https://bugs.python.org/issue24766
618.         if doc is not None:
619.             self.__doc__ = doc
620. 
621.     def __get__(self, obj, objtype):
622.         if self._lazy and objtype in self._cache:
623.             return self._cache[objtype]
624. 
625.         # The base property.__get__ will just return self here;
626.         # instead we pass objtype through to the original wrapped
627.         # function (which takes the class as its sole argument)
628.         val = self.fget.__wrapped__(objtype)
629. 
630.         if self._lazy:
631.             self._cache[objtype] = val
632. 
633.         return val
634. 
635.     def getter(self, fget):
636.         return super().getter(self._wrap_fget(fget))
637. 
638.     def setter(self, fset):
639.         raise NotImplementedError(
640.             "classproperty can only be read-only; use a metaclass to "
641.             "implement modifiable class-level properties")
642. 
643.     def deleter(self, fdel):
644.         raise NotImplementedError(
645.             "classproperty can only be read-only; use a metaclass to "
646.             "implement modifiable class-level properties")
647. 
648.     @staticmethod
649.     def _wrap_fget(orig_fget):
650.         if isinstance(orig_fget, classmethod):
651.             orig_fget = orig_fget.__func__
652. 
653.         # Using stock functools.wraps instead of the fancier version
654.         # found later in this module, which is overkill for this purpose
655. 
656.         @functools.wraps(orig_fget)
657.         def fget(obj):
658.             return orig_fget(obj.__class__)
659. 
660.         return fget
661. 
662. 
663. class lazyproperty(property):
664.     """
665.     Works similarly to property(), but computes the value only once.
666. 
667.     This essentially memorizes the value of the property by storing the result
668.     of its computation in the ``__dict__`` of the object instance.  This is
669.     useful for computing the value of some property that should otherwise be
670.     invariant.  For example::
671. 
672.         >>> class LazyTest:
673.         ...     @lazyproperty
674.         ...     def complicated_property(self):
675.         ...         print('Computing the value for complicated_property...')
676.         ...         return 42
677.         ...
678.         >>> lt = LazyTest()
679.         >>> lt.complicated_property
680.         Computing the value for complicated_property...
681.         42
682.         >>> lt.complicated_property
683.         42
684. 
685.     As the example shows, the second time ``complicated_property`` is accessed,
686.     the ``print`` statement is not executed.  Only the return value from the
687.     first access off ``complicated_property`` is returned.
688. 
689.     By default, a setter and deleter are used which simply overwrite and
690.     delete, respectively, the value stored in ``__dict__``. Any user-specified
691.     setter or deleter is executed before executing these default actions.
692.     The one exception is that the default setter is not run if the user setter
693.     already sets the new value in ``__dict__`` and returns that value and the
694.     returned value is not ``None``.
695. 
696.     Adapted from the recipe at
697.     http://code.activestate.com/recipes/363602-lazy-property-evaluation
698.     """
699. 
700.     def __init__(self, fget, fset=None, fdel=None, doc=None):
701.         super().__init__(fget, fset, fdel, doc)
702.         self._key = self.fget.__name__
703. 
704.     def __get__(self, obj, owner=None):
705.         try:
706.             return obj.__dict__[self._key]
707.         except KeyError:
708.             val = self.fget(obj)
709.             obj.__dict__[self._key] = val
710.             return val
711.         except AttributeError:
712.             if obj is None:
713.                 return self
714.             raise
715. 
716.     def __set__(self, obj, val):
717.         obj_dict = obj.__dict__
718.         if self.fset:
719.             ret = self.fset(obj, val)
720.             if ret is not None and obj_dict.get(self._key) is ret:
721.                 # By returning the value set the setter signals that it took
722.                 # over setting the value in obj.__dict__; this mechanism allows
723.                 # it to override the input value
724.                 return
725.         obj_dict[self._key] = val
726. 
727.     def __delete__(self, obj):
728.         if self.fdel:
729.             self.fdel(obj)
730.         if self._key in obj.__dict__:
731.             del obj.__dict__[self._key]
732. 
733. 
734. class sharedmethod(classmethod):
735.     """
736.     This is a method decorator that allows both an instancemethod and a
737.     `classmethod` to share the same name.
738. 
739.     When using `sharedmethod` on a method defined in a class's body, it
740.     may be called on an instance, or on a class.  In the former case it
741.     behaves like a normal instance method (a reference to the instance is
742.     automatically passed as the first ``self`` argument of the method)::
743. 
744.         >>> class Example:
745.         ...     @sharedmethod
746.         ...     def identify(self, *args):
747.         ...         print('self was', self)
748.         ...         print('additional args were', args)
749.         ...
750.         >>> ex = Example()
751.         >>> ex.identify(1, 2)
752.         self was <astropy.utils.decorators.Example object at 0x...>
753.         additional args were (1, 2)
754. 
755.     In the latter case, when the `sharedmethod` is called directly from a
756.     class, it behaves like a `classmethod`::
757. 
758.         >>> Example.identify(3, 4)
759.         self was <class 'astropy.utils.decorators.Example'>
760.         additional args were (3, 4)
761. 
762.     This also supports a more advanced usage, where the `classmethod`
763.     implementation can be written separately.  If the class's *metaclass*
764.     has a method of the same name as the `sharedmethod`, the version on
765.     the metaclass is delegated to::
766. 
767.         >>> class ExampleMeta(type):
768.         ...     def identify(self):
769.         ...         print('this implements the {0}.identify '
770.         ...               'classmethod'.format(self.__name__))
771.         ...
772.         >>> class Example(metaclass=ExampleMeta):
773.         ...     @sharedmethod
774.         ...     def identify(self):
775.         ...         print('this implements the instancemethod')
776.         ...
777.         >>> Example().identify()
778.         this implements the instancemethod
779.         >>> Example.identify()
780.         this implements the Example.identify classmethod
781.     """
782. 
783.     def __get__(self, obj, objtype=None):
784.         if obj is None:
785.             mcls = type(objtype)
786.             clsmeth = getattr(mcls, self.__func__.__name__, None)
787.             if callable(clsmeth):
788.                 func = clsmeth
789.             else:
790.                 func = self.__func__
791. 
792.             return self._make_method(func, objtype)
793.         else:
794.             return self._make_method(self.__func__, obj)
795. 
796.     @staticmethod
797.     def _make_method(func, instance):
798.         return types.MethodType(func, instance)
799. 
800. 
801. def wraps(wrapped, assigned=functools.WRAPPER_ASSIGNMENTS,
802.           updated=functools.WRAPPER_UPDATES, exclude_args=()):
803.     """
804.     An alternative to `functools.wraps` which also preserves the original
805.     function's call signature by way of
806.     `~astropy.utils.codegen.make_function_with_signature`.
807. 
808.     This also adds an optional ``exclude_args`` argument.  If given it should
809.     be a sequence of argument names that should not be copied from the wrapped
810.     function (either positional or keyword arguments).
811. 
812.     The documentation for the original `functools.wraps` follows:
813. 
814.     """
815. 
816.     wrapped_args = _get_function_args(wrapped, exclude_args=exclude_args)
817. 
818.     def wrapper(func):
819.         if '__name__' in assigned:
820.             name = wrapped.__name__
821.         else:
822.             name = func.__name__
823. 
824.         func = make_function_with_signature(func, name=name, **wrapped_args)
825.         func = functools.update_wrapper(func, wrapped, assigned=assigned,
826.                                         updated=updated)
827.         return func
828. 
829.     return wrapper
830. 
831. 
832. if (isinstance(wraps.__doc__, str) and
833.         wraps.__doc__ is not None and functools.wraps.__doc__ is not None):
834.     wraps.__doc__ += functools.wraps.__doc__
835. 
836. 
837. def _get_function_args_internal(func):
838.     """
839.     Utility function for `wraps`.
840. 
841.     Reads the argspec for the given function and converts it to arguments
842.     for `make_function_with_signature`.
843.     """
844. 
845.     argspec = inspect.getfullargspec(func)
846. 
847.     if argspec.defaults:
848.         args = argspec.args[:-len(argspec.defaults)]
849.         kwargs = zip(argspec.args[len(args):], argspec.defaults)
850.     else:
851.         args = argspec.args
852.         kwargs = []
853. 
854.     if argspec.kwonlyargs:
855.         kwargs.extend((argname, argspec.kwonlydefaults[argname])
856.                       for argname in argspec.kwonlyargs)
857. 
858.     return {'args': args, 'kwargs': kwargs, 'varargs': argspec.varargs,
859.             'varkwargs': argspec.varkw}
860. 
861. 
862. def _get_function_args(func, exclude_args=()):
863.     all_args = _get_function_args_internal(func)
864. 
865.     if exclude_args:
866.         exclude_args = set(exclude_args)
867. 
868.         for arg_type in ('args', 'kwargs'):
869.             all_args[arg_type] = [arg for arg in all_args[arg_type]
870.                                   if arg not in exclude_args]
871. 
872.         for arg_type in ('varargs', 'varkwargs'):
873.             if all_args[arg_type] in exclude_args:
874.                 all_args[arg_type] = None
875. 
876.     return all_args
877. 
878. 
879. def format_doc(docstring, *args, **kwargs):
880.     """
881.     Replaces the docstring of the decorated object and then formats it.
882. 
883.     The formatting works like :meth:`str.format` and if the decorated object
884.     already has a docstring this docstring can be included in the new
885.     documentation if you use the ``{__doc__}`` placeholder.
886.     Its primary use is for reusing a *long* docstring in multiple functions
887.     when it is the same or only slightly different between them.
888. 
889.     Parameters
890.     ----------
891.     docstring : str or object or None
892.         The docstring that will replace the docstring of the decorated
893.         object. If it is an object like a function or class it will
894.         take the docstring of this object. If it is a string it will use the
895.         string itself. One special case is if the string is ``None`` then
896.         it will use the decorated functions docstring and formats it.
897. 
898.     args :
899.         passed to :meth:`str.format`.
900. 
901.     kwargs :
902.         passed to :meth:`str.format`. If the function has a (not empty)
903.         docstring the original docstring is added to the kwargs with the
904.         keyword ``'__doc__'``.
905. 
906.     Raises
907.     ------
908.     ValueError
909.         If the ``docstring`` (or interpreted docstring if it was ``None``
910.         or not a string) is empty.
911. 
912.     IndexError, KeyError
913.         If a placeholder in the (interpreted) ``docstring`` was not filled. see
914.         :meth:`str.format` for more information.
915. 
916.     Notes
917.     -----
918.     Using this decorator allows, for example Sphinx, to parse the
919.     correct docstring.
920. 
921.     Examples
922.     --------
923. 
924.     Replacing the current docstring is very easy::
925. 
926.         >>> from astropy.utils.decorators import format_doc
927.         >>> @format_doc('''Perform num1 + num2''')
928.         ... def add(num1, num2):
929.         ...     return num1+num2
930.         ...
931.         >>> help(add) # doctest: +SKIP
932.         Help on function add in module __main__:
933.         <BLANKLINE>
934.         add(num1, num2)
935.             Perform num1 + num2
936. 
937.     sometimes instead of replacing you only want to add to it::
938. 
939.         >>> doc = '''
940.         ...       {__doc__}
941.         ...       Parameters
942.         ...       ----------
943.         ...       num1, num2 : Numbers
944.         ...       Returns
945.         ...       -------
946.         ...       result: Number
947.         ...       '''
948.         >>> @format_doc(doc)
949.         ... def add(num1, num2):
950.         ...     '''Perform addition.'''
951.         ...     return num1+num2
952.         ...
953.         >>> help(add) # doctest: +SKIP
954.         Help on function add in module __main__:
955.         <BLANKLINE>
956.         add(num1, num2)
957.             Perform addition.
958.             Parameters
959.             ----------
960.             num1, num2 : Numbers
961.             Returns
962.             -------
963.             result : Number
964. 
965.     in case one might want to format it further::
966. 
967.         >>> doc = '''
968.         ...       Perform {0}.
969.         ...       Parameters
970.         ...       ----------
971.         ...       num1, num2 : Numbers
972.         ...       Returns
973.         ...       -------
974.         ...       result: Number
975.         ...           result of num1 {op} num2
976.         ...       {__doc__}
977.         ...       '''
978.         >>> @format_doc(doc, 'addition', op='+')
979.         ... def add(num1, num2):
980.         ...     return num1+num2
981.         ...
982.         >>> @format_doc(doc, 'subtraction', op='-')
983.         ... def subtract(num1, num2):
984.         ...     '''Notes: This one has additional notes.'''
985.         ...     return num1-num2
986.         ...
987.         >>> help(add) # doctest: +SKIP
988.         Help on function add in module __main__:
989.         <BLANKLINE>
990.         add(num1, num2)
991.             Perform addition.
992.             Parameters
993.             ----------
994.             num1, num2 : Numbers
995.             Returns
996.             -------
997.             result : Number
998.                 result of num1 + num2
999.         >>> help(subtract) # doctest: +SKIP
1000.         Help on function subtract in module __main__:
1001.         <BLANKLINE>

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-21 19:34:29,276 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="The user requested the full content of the file 'astropy/utils/decorators.py'. The provided context contains the entire file content, which is necessary to understand the decorators and their behavior as mentioned in the purpose.", relative_path='astropy/utils/decorators.py', start_line=1, end_line=1001)]
2025-12-21 19:34:29,279 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of astropy/utils/decorators.py.
2025-12-21 19:34:29,279 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-21 19:34:29,279 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-21 19:34:29,279 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 1 existing contexts
2025-12-21 19:34:29,279 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 2 total contexts (removed 0 duplicates)
2025-12-21 19:34:29,280 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
astropy
├── .circleci
|   └── config.yml
├── .rtd-environment.yml
├── .travis.yml
├── CHANGES.rst
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── LICENSE.rst
├── README.rst
├── ah_bootstrap.py
├── appveyor.yml
├── astropy
|   ├── __init__.py
|   ├── _erfa
|   |   ├── __init__.py
|   |   ├── erfa_generator.py
|   |   ├── setup_package.py
|   |   └── tests
|   |       ├── __init__.py
|   |       └── test_erfa.py
|   ├── config
|   |   ├── __init__.py
|   |   ├── affiliated.py
|   |   ├── configuration.py
|   |   ├── paths.py
|   |   ├── setup_package.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── data
|   |       └── test_configs.py
|   ├── conftest.py
|   ├── constants
|   |   ├── __init__.py
|   |   ├── astropyconst13.py
|   |   ├── astropyconst20.py
|   |   ├── cgs.py
|   |   ├── codata2010.py
|   |   ├── codata2014.py
|   |   ├── constant.py
|   |   ├── iau2012.py
|   |   ├── iau2015.py
|   |   ├── si.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_constant.py
|   |   |   ├── test_pickle.py
|   |   |   └── test_prior_version.py
|   |   └── utils.py
|   ├── convolution
|   |   ├── __init__.py
|   |   ├── convolve.py
|   |   ├── core.py
|   |   ├── kernels.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_convolve.py
|   |   |   ├── test_convolve_fft.py
|   |   |   ├── test_convolve_kernels.py
|   |   |   ├── test_convolve_models.py
|   |   |   ├── test_convolve_nddata.py
|   |   |   ├── test_convolve_speeds.py
|   |   |   ├── test_discretize.py
|   |   |   ├── test_kernel_class.py
|   |   |   └── test_pickle.py
|   |   └── utils.py
|   ├── coordinates
|   |   ├── __init__.py
|   |   ├── angle_lextab.py
|   |   ├── angle_parsetab.py
|   |   ├── angle_utilities.py
|   |   ├── angles.py
|   |   ├── attributes.py
|   |   ├── baseframe.py
|   |   ├── builtin_frames
|   |   |   ├── __init__.py
|   |   |   ├── altaz.py
|   |   |   ├── baseradec.py
|   |   |   ├── cirs.py
|   |   |   ├── cirs_observed_transforms.py
|   |   |   ├── ecliptic.py
|   |   |   ├── ecliptic_transforms.py
|   |   |   ├── fk4.py
|   |   |   ├── fk4_fk5_transforms.py
|   |   |   ├── fk5.py
|   |   |   ├── galactic.py
|   |   |   ├── galactic_transforms.py
|   |   |   ├── galactocentric.py
|   |   |   ├── gcrs.py
|   |   |   ├── hcrs.py
|   |   |   ├── icrs.py
|   |   |   ├── icrs_cirs_transforms.py
|   |   |   ├── icrs_fk5_transforms.py
|   |   |   ├── intermediate_rotation_transforms.py
|   |   |   ├── itrs.py
|   |   |   ├── lsr.py
|   |   |   ├── skyoffset.py
|   |   |   ├── supergalactic.py
|   |   |   ├── supergalactic_transforms.py
|   |   |   └── utils.py
|   |   ├── calculation.py
|   |   ├── data
|   |   ├── distances.py
|   |   ├── earth.py
|   |   ├── earth_orientation.py
|   |   ├── errors.py
|   |   ├── funcs.py
|   |   ├── matching.py
|   |   ├── matrix_utilities.py
|   |   ├── name_resolve.py
|   |   ├── orbital_elements.py
|   |   ├── representation.py
|   |   ├── setup_package.py
|   |   ├── sites.py
|   |   ├── sky_coordinate.py
|   |   ├── solar_system.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── accuracy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── generate_ref_ast.py
|   |   |   |   ├── test_altaz_icrs.py
|   |   |   |   ├── test_ecliptic.py
|   |   |   |   ├── test_fk4_no_e_fk4.py
|   |   |   |   ├── test_fk4_no_e_fk5.py
|   |   |   |   ├── test_galactic_fk4.py
|   |   |   |   └── test_icrs_fk5.py
|   |   |   ├── test_angles.py
|   |   |   ├── test_angular_separation.py
|   |   |   ├── test_api_ape5.py
|   |   |   ├── test_arrays.py
|   |   |   ├── test_atc_replacements.py
|   |   |   ├── test_celestial_transformations.py
|   |   |   ├── test_distance.py
|   |   |   ├── test_earth.py
|   |   |   ├── test_finite_difference_velocities.py
|   |   |   ├── test_formatting.py
|   |   |   ├── test_frames.py
|   |   |   ├── test_frames_with_velocity.py
|   |   |   ├── test_funcs.py
|   |   |   ├── test_iau_fullstack.py
|   |   |   ├── test_intermediate_transformations.py
|   |   |   ├── test_matching.py
|   |   |   ├── test_matrix_utilities.py
|   |   |   ├── test_name_resolve.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_regression.py
|   |   |   ├── test_representation.py
|   |   |   ├── test_representation_arithmetic.py
|   |   |   ├── test_representation_methods.py
|   |   |   ├── test_shape_manipulation.py
|   |   |   ├── test_sites.py
|   |   |   ├── test_sky_coord.py
|   |   |   ├── test_sky_coord_velocities.py
|   |   |   ├── test_skyoffset_transformations.py
|   |   |   ├── test_solar_system.py
|   |   |   ├── test_transformations.py
|   |   |   ├── test_unit_representation.py
|   |   |   ├── test_velocity_corrs.py
|   |   |   └── utils.py
|   |   └── transformations.py
|   ├── cosmology
|   |   ├── __init__.py
|   |   ├── core.py
|   |   ├── funcs.py
|   |   ├── parameters.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── test_cosmology.py
|   |       └── test_pickle.py
|   ├── extern
|   |   ├── README.rst
|   |   ├── __init__.py
|   |   ├── bundled
|   |   |   ├── __init__.py
|   |   |   └── six.py
|   |   ├── configobj
|   |   |   ├── __init__.py
|   |   |   ├── configobj.py
|   |   |   └── validate.py
|   |   ├── css
|   |   |   └── jquery.dataTables.css
|   |   ├── js
|   |   |   ├── jquery-3.1.1.js
|   |   |   ├── jquery-3.1.1.min.js
|   |   |   ├── jquery.dataTables.js
|   |   |   └── jquery.dataTables.min.js
|   |   ├── ply
|   |   |   ├── __init__.py
|   |   |   ├── cpp.py
|   |   |   ├── ctokens.py
|   |   |   ├── lex.py
|   |   |   ├── yacc.py
|   |   |   └── ygen.py
|   |   ├── setup_package.py
|   |   └── six.py
|   ├── io
|   |   ├── __init__.py
|   |   ├── ascii
|   |   |   ├── __init__.py
|   |   |   ├── basic.py
|   |   |   ├── cds.py
|   |   |   ├── connect.py
|   |   |   ├── core.py
|   |   |   ├── daophot.py
|   |   |   ├── ecsv.py
|   |   |   ├── fastbasic.py
|   |   |   ├── fixedwidth.py
|   |   |   ├── html.py
|   |   |   ├── ipac.py
|   |   |   ├── latex.py
|   |   |   ├── misc.py
|   |   |   ├── rst.py
|   |   |   ├── setup_package.py
|   |   |   ├── sextractor.py
|   |   |   ├── src
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── common.py
|   |   |   |   ├── t
|   |   |   |   ├── test_c_reader.py
|   |   |   |   ├── test_cds_header_from_readme.py
|   |   |   |   ├── test_compressed.py
|   |   |   |   ├── test_connect.py
|   |   |   |   ├── test_ecsv.py
|   |   |   |   ├── test_fixedwidth.py
|   |   |   |   ├── test_html.py
|   |   |   |   ├── test_ipac_definitions.py
|   |   |   |   ├── test_read.py
|   |   |   |   ├── test_rst.py
|   |   |   |   ├── test_types.py
|   |   |   |   └── test_write.py
|   |   |   └── ui.py
|   |   ├── fits
|   |   |   ├── __init__.py
|   |   |   ├── _numpy_hacks.py
|   |   |   ├── card.py
|   |   |   ├── column.py
|   |   |   ├── connect.py
|   |   |   ├── convenience.py
|   |   |   ├── diff.py
|   |   |   ├── file.py
|   |   |   ├── fitsrec.py
|   |   |   ├── fitstime.py
|   |   |   ├── hdu
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── compressed.py
|   |   |   |   ├── groups.py
|   |   |   |   ├── hdulist.py
|   |   |   |   ├── image.py
|   |   |   |   ├── nonstandard.py
|   |   |   |   ├── streaming.py
|   |   |   |   └── table.py
|   |   |   ├── header.py
|   |   |   ├── scripts
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fitscheck.py
|   |   |   |   ├── fitsdiff.py
|   |   |   |   ├── fitsheader.py
|   |   |   |   └── fitsinfo.py
|   |   |   ├── setup_package.py
|   |   |   ├── src
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── data
|   |   |   |   ├── test_checksum.py
|   |   |   |   ├── test_compression_failures.py
|   |   |   |   ├── test_connect.py
|   |   |   |   ├── test_convenience.py
|   |   |   |   ├── test_core.py
|   |   |   |   ├── test_diff.py
|   |   |   |   ├── test_division.py
|   |   |   |   ├── test_fitscheck.py
|   |   |   |   ├── test_fitsdiff.py
|   |   |   |   ├── test_fitsheader.py
|   |   |   |   ├── test_fitsinfo.py
|   |   |   |   ├── test_fitstime.py
|   |   |   |   ├── test_groups.py
|   |   |   |   ├── test_hdulist.py
|   |   |   |   ├── test_header.py
|   |   |   |   ├── test_image.py
|   |   |   |   ├── test_nonstandard.py
|   |   |   |   ├── test_structured.py
|   |   |   |   ├── test_table.py
|   |   |   |   ├── test_uint.py
|   |   |   |   └── test_util.py
|   |   |   ├── util.py
|   |   |   └── verify.py
|   |   ├── misc
|   |   |   ├── __init__.py
|   |   |   ├── asdf
|   |   |   |   ├── __init__.py
|   |   |   |   ├── extension.py
|   |   |   |   ├── schemas
|   |   |   |   ├── setup_package.py
|   |   |   |   ├── tags
|   |   |   |   └── types.py
|   |   |   ├── connect.py
|   |   |   ├── hdf5.py
|   |   |   ├── pickle_helpers.py
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── test_hdf5.py
|   |   |   |   ├── test_pickle_helpers.py
|   |   |   |   └── test_yaml.py
|   |   |   └── yaml.py
|   |   ├── registry.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   └── test_registry.py
|   |   └── votable
|   |       ├── __init__.py
|   |       ├── connect.py
|   |       ├── converters.py
|   |       ├── data
|   |       |   └── ucd1p-words.txt
|   |       ├── exceptions.py
|   |       ├── setup_package.py
|   |       ├── src
|   |       |   └── tablewriter.c
|   |       ├── table.py
|   |       ├── tests
|   |       |   ├── __init__.py
|   |       |   ├── converter_test.py
|   |       |   ├── data
|   |       |   ├── exception_test.py
|   |       |   ├── resource_test.py
|   |       |   ├── table_test.py
|   |       |   ├── tree_test.py
|   |       |   ├── ucd_test.py
|   |       |   ├── util_test.py
|   |       |   └── vo_test.py
|   |       ├── tree.py
|   |       ├── ucd.py
|   |       ├── util.py
|   |       ├── validator
|   |       |   ├── __init__.py
|   |       |   ├── html.py
|   |       |   ├── main.py
|   |       |   ├── result.py
|   |       |   └── urls
|   |       ├── volint.py
|   |       └── xmlutil.py
|   ├── logger.py
|   ├── modeling
|   |   ├── __init__.py
|   |   ├── blackbody.py
|   |   ├── core.py
|   |   ├── fitting.py
|   |   ├── functional_models.py
|   |   ├── mappings.py
|   |   ├── models.py
|   |   ├── optimizers.py
|   |   ├── parameters.py
|   |   ├── polynomial.py
|   |   ├── powerlaws.py
|   |   ├── projections.py
|   |   ├── rotations.py
|   |   ├── separable.py
|   |   ├── setup_package.py
|   |   ├── src
|   |   ├── statistic.py
|   |   ├── tabular.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   |   └── __init__.py
|   |   |   ├── example_models.py
|   |   |   ├── irafutil.py
|   |   |   ├── test_blackbody.py
|   |   |   ├── test_compound.py
|   |   |   ├── test_constraints.py
|   |   |   ├── test_core.py
|   |   |   ├── test_fitters.py
|   |   |   ├── test_functional_models.py
|   |   |   ├── test_input.py
|   |   |   ├── test_mappings.py
|   |   |   ├── test_model_sets.py
|   |   |   ├── test_models.py
|   |   |   ├── test_models_quantities.py
|   |   |   ├── test_parameters.py
|   |   |   ├── test_polynomial.py
|   |   |   ├── test_projections.py
|   |   |   ├── test_quantities_evaluation.py
|   |   |   ├── test_quantities_fitting.py
|   |   |   ├── test_quantities_model.py
|   |   |   ├── test_quantities_parameters.py
|   |   |   ├── test_quantities_rotations.py
|   |   |   ├── test_rotations.py
|   |   |   ├── test_separable.py
|   |   |   ├── test_utils.py
|   |   |   └── utils.py
|   |   └── utils.py
|   ├── nddata
|   |   ├── __init__.py
|   |   ├── ccddata.py
|   |   ├── compat.py
|   |   ├── decorators.py
|   |   ├── flag_collection.py
|   |   ├── mixins
|   |   |   ├── __init__.py
|   |   |   ├── ndarithmetic.py
|   |   |   ├── ndio.py
|   |   |   ├── ndslicing.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── test_ndarithmetic.py
|   |   |       ├── test_ndio.py
|   |   |       └── test_ndslicing.py
|   |   ├── nddata.py
|   |   ├── nddata_base.py
|   |   ├── nddata_withmixins.py
|   |   ├── nduncertainty.py
|   |   ├── setup_package.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   ├── test_ccddata.py
|   |   |   ├── test_compat.py
|   |   |   ├── test_decorators.py
|   |   |   ├── test_flag_collection.py
|   |   |   ├── test_nddata.py
|   |   |   ├── test_nddata_base.py
|   |   |   ├── test_nduncertainty.py
|   |   |   └── test_utils.py
|   |   └── utils.py
|   ├── samp
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── constants.py
|   |   ├── data
|   |   |   ├── clientaccesspolicy.xml
|   |   |   └── crossdomain.xml
|   |   ├── errors.py
|   |   ├── hub.py
|   |   ├── hub_proxy.py
|   |   ├── hub_script.py
|   |   ├── integrated_client.py
|   |   ├── lockfile_helpers.py
|   |   ├── setup_package.py
|   |   ├── standard_profile.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_client.py
|   |   |   ├── test_errors.py
|   |   |   ├── test_helpers.py
|   |   |   ├── test_hub.py
|   |   |   ├── test_hub_proxy.py
|   |   |   ├── test_hub_script.py
|   |   |   ├── test_standard_profile.py
|   |   |   ├── test_web_profile.py
|   |   |   └── web_profile_test_helpers.py
|   |   ├── utils.py
|   |   └── web_profile.py
|   ├── setup_package.py
|   ├── stats
|   |   ├── __init__.py
|   |   ├── bayesian_blocks.py
|   |   ├── biweight.py
|   |   ├── circstats.py
|   |   ├── funcs.py
|   |   ├── histogram.py
|   |   ├── info_theory.py
|   |   ├── jackknife.py
|   |   ├── lombscargle
|   |   |   ├── __init__.py
|   |   |   ├── _statistics.py
|   |   |   ├── core.py
|   |   |   ├── implementations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── chi2_impl.py
|   |   |   |   ├── fast_impl.py
|   |   |   |   ├── fastchi2_impl.py
|   |   |   |   ├── main.py
|   |   |   |   ├── mle.py
|   |   |   |   ├── scipy_impl.py
|   |   |   |   ├── slow_impl.py
|   |   |   |   ├── tests
|   |   |   |   └── utils.py
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── test_lombscargle.py
|   |   |   |   ├── test_statistics.py
|   |   |   |   └── test_utils.py
|   |   |   └── utils.py
|   |   ├── sigma_clipping.py
|   |   ├── spatial.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── test_bayesian_blocks.py
|   |       ├── test_biweight.py
|   |       ├── test_circstats.py
|   |       ├── test_funcs.py
|   |       ├── test_histogram.py
|   |       ├── test_info_theory.py
|   |       ├── test_jackknife.py
|   |       ├── test_sigma_clipping.py
|   |       └── test_spatial.py
|   ├── table
|   |   ├── __init__.py
|   |   ├── bst.py
|   |   ├── column.py
|   |   ├── groups.py
|   |   ├── index.py
|   |   ├── info.py
|   |   ├── jsviewer.py
|   |   ├── meta.py
|   |   ├── np_utils.py
|   |   ├── operations.py
|   |   ├── pandas.py
|   |   ├── pprint.py
|   |   ├── row.py
|   |   ├── scripts
|   |   |   ├── __init__.py
|   |   |   └── showtable.py
|   |   ├── serialize.py
|   |   ├── setup_package.py
|   |   ├── sorted_array.py
|   |   ├── table.py
|   |   ├── table_helpers.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── conftest.py
|   |       ├── test_array.py
|   |       ├── test_bst.py
|   |       ├── test_column.py
|   |       ├── test_groups.py
|   |       ├── test_index.py
|   |       ├── test_info.py
|   |       ├── test_init_table.py
|   |       ├── test_item_access.py
|   |       ├── test_jsviewer.py
|   |       ├── test_masked.py
|   |       ├── test_mixin.py
|   |       ├── test_np_utils.py
|   |       ├── test_operations.py
|   |       ├── test_pickle.py
|   |       ├── test_pprint.py
|   |       ├── test_row.py
|   |       ├── test_showtable.py
|   |       ├── test_subclass.py
|   |       └── test_table.py
|   ├── tests
|   |   ├── __init__.py
|   |   ├── command.py
|   |   ├── disable_internet.py
|   |   ├── helper.py
|   |   ├── image_tests.py
|   |   ├── plugins
|   |   |   ├── __init__.py
|   |   |   ├── config.py
|   |   |   └── display.py
|   |   ├── pytest_plugins.py
|   |   ├── runner.py
|   |   ├── setup_package.py
|   |   ├── test_logger.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── test_imports.py
|   |       ├── test_quantity_helpers.py
|   |       ├── test_run_tests.py
|   |       └── test_runner.py
|   ├── time
|   |   ├── __init__.py
|   |   ├── core.py
|   |   ├── formats.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_basic.py
|   |   |   ├── test_comparisons.py
|   |   |   ├── test_corrs.py
|   |   |   ├── test_delta.py
|   |   |   ├── test_guess.py
|   |   |   ├── test_mask.py
|   |   |   ├── test_methods.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_precision.py
|   |   |   ├── test_quantity_interaction.py
|   |   |   ├── test_sidereal.py
|   |   |   └── test_ut1.py
|   |   └── utils.py
|   ├── units
|   |   ├── __init__.py
|   |   ├── astrophys.py
|   |   ├── cds.py
|   |   ├── cgs.py
|   |   ├── core.py
|   |   ├── decorators.py
|   |   ├── deprecated.py
|   |   ├── equivalencies.py
|   |   ├── format
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── cds.py
|   |   |   ├── cds_lextab.py
|   |   |   ├── cds_parsetab.py
|   |   |   ├── console.py
|   |   |   ├── fits.py
|   |   |   ├── generic.py
|   |   |   ├── generic_lextab.py
|   |   |   ├── generic_parsetab.py
|   |   |   ├── latex.py
|   |   |   ├── ogip.py
|   |   |   ├── ogip_lextab.py
|   |   |   ├── ogip_parsetab.py
|   |   |   ├── unicode_format.py
|   |   |   ├── utils.py
|   |   |   └── vounit.py
|   |   ├── function
|   |   |   ├── __init__.py
|   |   |   ├── core.py
|   |   |   ├── logarithmic.py
|   |   |   ├── magnitude_zero_points.py
|   |   |   ├── mixin.py
|   |   |   └── units.py
|   |   ├── imperial.py
|   |   ├── physical.py
|   |   ├── quantity.py
|   |   ├── quantity_helper.py
|   |   ├── required_by_vounit.py
|   |   ├── si.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── py3_test_quantity_annotations.py
|   |   |   ├── test_deprecated.py
|   |   |   ├── test_equivalencies.py
|   |   |   ├── test_format.py
|   |   |   ├── test_logarithmic.py
|   |   |   ├── test_physical.py
|   |   |   ├── test_quantity.py
|   |   |   ├── test_quantity_array_methods.py
|   |   |   ├── test_quantity_decorator.py
|   |   |   ├── test_quantity_non_ufuncs.py
|   |   |   ├── test_quantity_ufuncs.py
|   |   |   └── test_units.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── argparse.py
|   |   ├── codegen.py
|   |   ├── collections.py
|   |   ├── compat
|   |   |   ├── __init__.py
|   |   |   ├── funcsigs.py
|   |   |   ├── futures
|   |   |   |   └── __init__.py
|   |   |   ├── misc.py
|   |   |   ├── numpy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── core
|   |   |   |   ├── lib
|   |   |   |   └── tests
|   |   |   └── numpycompat.py
|   |   ├── console.py
|   |   ├── data.py
|   |   ├── data_info.py
|   |   ├── decorators.py
|   |   ├── exceptions.py
|   |   ├── iers
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   ├── iers.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       └── test_iers.py
|   |   ├── introspection.py
|   |   ├── metadata.py
|   |   ├── misc.py
|   |   ├── setup_package.py
|   |   ├── src
|   |   ├── state.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   |   ├── .hidden_file.txt
|   |   |   |   ├── test_package
|   |   |   |   └── unicode.txt
|   |   |   ├── test_codegen.py
|   |   |   ├── test_collections.py
|   |   |   ├── test_console.py
|   |   |   ├── test_data.py
|   |   |   ├── test_data_info.py
|   |   |   ├── test_decorators.py
|   |   |   ├── test_introspection.py
|   |   |   ├── test_metadata.py
|   |   |   ├── test_misc.py
|   |   |   ├── test_progress_bar_func.py
|   |   |   ├── test_timer.py
|   |   |   └── test_xml.py
|   |   ├── timer.py
|   |   └── xml
|   |       ├── __init__.py
|   |       ├── check.py
|   |       ├── iterparser.py
|   |       ├── setup_package.py
|   |       ├── src
|   |       |   └── iterparse.c
|   |       ├── tests
|   |       |   ├── __init__.py
|   |       |   └── test_iterparse.py
|   |       ├── unescaper.py
|   |       ├── validate.py
|   |       └── writer.py
|   ├── visualization
|   |   ├── __init__.py
|   |   ├── hist.py
|   |   ├── interval.py
|   |   ├── lupton_rgb.py
|   |   ├── mpl_normalize.py
|   |   ├── mpl_style.py
|   |   ├── scripts
|   |   |   ├── __init__.py
|   |   |   ├── fits2bitmap.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       └── test_fits2bitmap.py
|   |   ├── stretch.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_histogram.py
|   |   |   ├── test_interval.py
|   |   |   ├── test_lupton_rgb.py
|   |   |   ├── test_norm.py
|   |   |   ├── test_stretch.py
|   |   |   └── test_units.py
|   |   ├── transform.py
|   |   ├── units.py
|   |   └── wcsaxes
|   |       ├── __init__.py
|   |       ├── axislabels.py
|   |       ├── coordinate_helpers.py
|   |       ├── coordinate_range.py
|   |       ├── coordinates_map.py
|   |       ├── core.py
|   |       ├── formatter_locator.py
|   |       ├── frame.py
|   |       ├── grid_paths.py
|   |       ├── patches.py
|   |       ├── tests
|   |       |   ├── __init__.py
|   |       |   ├── data
|   |       |   ├── datasets.py
|   |       |   ├── setup_package.py
|   |       |   ├── test_coordinate_helpers.py
|   |       |   ├── test_display_world_coordinates.py
|   |       |   ├── test_formatter_locator.py
|   |       |   ├── test_frame.py
|   |       |   ├── test_images.py
|   |       |   ├── test_misc.py
|   |       |   ├── test_transform_coord_meta.py
|   |       |   ├── test_transforms.py
|   |       |   └── test_utils.py
|   |       ├── ticklabels.py
|   |       ├── ticks.py
|   |       ├── transforms.py
|   |       └── utils.py
|   └── wcs
|       ├── __init__.py
|       ├── _docutil.py
|       ├── docstrings.py
|       ├── include
|       |   ├── astropy_wcs
|       |   └── wcslib
|       ├── setup_package.py
|       ├── src
|       |   ├── astropy_wcs.c
|       |   ├── astropy_wcs_api.c
|       |   ├── distortion.c
|       |   ├── distortion_wrap.c
|       |   ├── pipeline.c
|       |   ├── pyutil.c
|       |   ├── sip.c
|       |   ├── sip_wrap.c
|       |   ├── str_list_proxy.c
|       |   ├── unit_list_proxy.c
|       |   ├── util.c
|       |   ├── wcslib_tabprm_wrap.c
|       |   └── wcslib_wrap.c
|       ├── tests
|       |   ├── __init__.py
|       |   ├── data
|       |   |   ├── validate.5.0.txt
|       |   |   ├── validate.5.13.txt
|       |   |   └── validate.txt
|       |   ├── extension
|       |   |   ├── __init__.py
|       |   |   ├── setup.py
|       |   |   ├── test_extension.py
|       |   |   └── wcsapi_test.c
|       |   ├── maps
|       |   ├── spectra
|       |   ├── test_pickle.py
|       |   ├── test_profiling.py
|       |   ├── test_utils.py
|       |   ├── test_wcs.py
|       |   └── test_wcsprm.py
|       ├── utils.py
|       ├── wcs.py
|       └── wcslint.py
├── astropy_helpers
├── cextern
|   ├── README.rst
|   ├── cfitsio
|   |   ├── License.txt
|   |   ├── README.txt
|   |   ├── docs
|   |   |   └── changes.txt
|   |   ├── lib
|   |   |   ├── buffers.c
|   |   |   ├── cfileio.c
|   |   |   ├── checksum.c
|   |   |   ├── drvrfile.c
|   |   |   ├── drvrgsiftp.c
|   |   |   ├── drvrmem.c
|   |   |   ├── drvrnet.c
|   |   |   ├── drvrsmem.c
|   |   |   ├── editcol.c
|   |   |   ├── edithdu.c
|   |   |   ├── eval_f.c
|   |   |   ├── eval_l.c
|   |   |   ├── eval_y.c
|   |   |   ├── fits_hcompress.c
|   |   |   ├── fits_hdecompress.c
|   |   |   ├── fitscore.c
|   |   |   ├── getcol.c
|   |   |   ├── getcolb.c
|   |   |   ├── getcold.c
|   |   |   ├── getcole.c
|   |   |   ├── getcoli.c
|   |   |   ├── getcolj.c
|   |   |   ├── getcolk.c
|   |   |   ├── getcoll.c
|   |   |   ├── getcols.c
|   |   |   ├── getcolsb.c
|   |   |   ├── getcolui.c
|   |   |   ├── getcoluj.c
|   |   |   ├── getcoluk.c
|   |   |   ├── getkey.c
|   |   |   ├── group.c
|   |   |   ├── grparser.c
|   |   |   ├── histo.c
|   |   |   ├── imcompress.c
|   |   |   ├── iraffits.c
|   |   |   ├── modkey.c
|   |   |   ├── pliocomp.c
|   |   |   ├── putcol.c
|   |   |   ├── putcolb.c
|   |   |   ├── putcold.c
|   |   |   ├── putcole.c
|   |   |   ├── putcoli.c
|   |   |   ├── putcolj.c
|   |   |   ├── putcolk.c
|   |   |   ├── putcoll.c
|   |   |   ├── putcols.c
|   |   |   ├── putcolsb.c
|   |   |   ├── putcolu.c
|   |   |   ├── putcolui.c
|   |   |   ├── putcoluj.c
|   |   |   ├── putcoluk.c
|   |   |   ├── putkey.c
|   |   |   ├── quantize.c
|   |   |   ├── region.c
|   |   |   ├── ricecomp.c
|   |   |   ├── scalnull.c
|   |   |   ├── simplerng.c
|   |   |   ├── swapproc.c
|   |   |   ├── wcssub.c
|   |   |   └── wcsutil.c
|   |   └── zlib
|   |       ├── adler32.c
|   |       ├── crc32.c
|   |       ├── deflate.c
|   |       ├── infback.c
|   |       ├── inffast.c
|   |       ├── inflate.c
|   |       ├── inftrees.c
|   |       ├── trees.c
|   |       ├── uncompr.c
|   |       ├── zcompress.c
|   |       ├── zuncompress.c
|   |       └── zutil.c
|   ├── erfa
|   |   ├── README.rst
|   |   ├── a2af.c
|   |   ├── a2tf.c
|   |   ├── ab.c
|   |   ├── af2a.c
|   |   ├── anp.c
|   |   ├── anpm.c
|   |   ├── apcg.c
|   |   ├── apcg13.c
|   |   ├── apci.c
|   |   ├── apci13.c
|   |   ├── apco.c
|   |   ├── apco13.c
|   |   ├── apcs.c
|   |   ├── apcs13.c
|   |   ├── aper.c
|   |   ├── aper13.c
|   |   ├── apio.c
|   |   ├── apio13.c
|   |   ├── atci13.c
|   |   ├── atciq.c
|   |   ├── atciqn.c
|   |   ├── atciqz.c
|   |   ├── atco13.c
|   |   ├── atic13.c
|   |   ├── aticq.c
|   |   ├── aticqn.c
|   |   ├── atio13.c
|   |   ├── atioq.c
|   |   ├── atoc13.c
|   |   ├── atoi13.c
|   |   ├── atoiq.c
|   |   ├── bi00.c
|   |   ├── bp00.c
|   |   ├── bp06.c
|   |   ├── bpn2xy.c
|   |   ├── c2i00a.c
|   |   ├── c2i00b.c
|   |   ├── c2i06a.c
|   |   ├── c2ibpn.c
|   |   ├── c2ixy.c
|   |   ├── c2ixys.c
|   |   ├── c2s.c
|   |   ├── c2t00a.c
|   |   ├── c2t00b.c
|   |   ├── c2t06a.c
|   |   ├── c2tcio.c
|   |   ├── c2teqx.c
|   |   ├── c2tpe.c
|   |   ├── c2txy.c
|   |   ├── cal2jd.c
|   |   ├── cp.c
|   |   ├── cpv.c
|   |   ├── cr.c
|   |   ├── d2dtf.c
|   |   ├── d2tf.c
|   |   ├── dat.c
|   |   ├── dtdb.c
|   |   ├── dtf2d.c
|   |   ├── eceq06.c
|   |   ├── ecm06.c
|   |   ├── ee00.c
|   |   ├── ee00a.c
|   |   ├── ee00b.c
|   |   ├── ee06a.c
|   |   ├── eect00.c
|   |   ├── eform.c
|   |   ├── eo06a.c
|   |   ├── eors.c
|   |   ├── epb.c
|   |   ├── epb2jd.c
|   |   ├── epj.c
|   |   ├── epj2jd.c
|   |   ├── epv00.c
|   |   ├── eqec06.c
|   |   ├── eqeq94.c
|   |   ├── era00.c
|   |   ├── erfaversion.c
|   |   ├── fad03.c
|   |   ├── fae03.c
|   |   ├── faf03.c
|   |   ├── faju03.c
|   |   ├── fal03.c
|   |   ├── falp03.c
|   |   ├── fama03.c
|   |   ├── fame03.c
|   |   ├── fane03.c
|   |   ├── faom03.c
|   |   ├── fapa03.c
|   |   ├── fasa03.c
|   |   ├── faur03.c
|   |   ├── fave03.c
|   |   ├── fk52h.c
|   |   ├── fk5hip.c
|   |   ├── fk5hz.c
|   |   ├── fw2m.c
|   |   ├── fw2xy.c
|   |   ├── g2icrs.c
|   |   ├── gc2gd.c
|   |   ├── gc2gde.c
|   |   ├── gd2gc.c
|   |   ├── gd2gce.c
|   |   ├── gmst00.c
|   |   ├── gmst06.c
|   |   ├── gmst82.c
|   |   ├── gst00a.c
|   |   ├── gst00b.c
|   |   ├── gst06.c
|   |   ├── gst06a.c
|   |   ├── gst94.c
|   |   ├── h2fk5.c
|   |   ├── hfk5z.c
|   |   ├── icrs2g.c
|   |   ├── ir.c
|   |   ├── jd2cal.c
|   |   ├── jdcalf.c
|   |   ├── ld.c
|   |   ├── ldn.c
|   |   ├── ldsun.c
|   |   ├── lteceq.c
|   |   ├── ltecm.c
|   |   ├── lteqec.c
|   |   ├── ltp.c
|   |   ├── ltpb.c
|   |   ├── ltpecl.c
|   |   ├── ltpequ.c
|   |   ├── num00a.c
|   |   ├── num00b.c
|   |   ├── num06a.c
|   |   ├── numat.c
|   |   ├── nut00a.c
|   |   ├── nut00b.c
|   |   ├── nut06a.c
|   |   ├── nut80.c
|   |   ├── nutm80.c
|   |   ├── obl06.c
|   |   ├── obl80.c
|   |   ├── p06e.c
|   |   ├── p2pv.c
|   |   ├── p2s.c
|   |   ├── pap.c
|   |   ├── pas.c
|   |   ├── pb06.c
|   |   ├── pdp.c
|   |   ├── pfw06.c
|   |   ├── plan94.c
|   |   ├── pm.c
|   |   ├── pmat00.c
|   |   ├── pmat06.c
|   |   ├── pmat76.c
|   |   ├── pmp.c
|   |   ├── pmpx.c
|   |   ├── pmsafe.c
|   |   ├── pn.c
|   |   ├── pn00.c
|   |   ├── pn00a.c
|   |   ├── pn00b.c
|   |   ├── pn06.c
|   |   ├── pn06a.c
|   |   ├── pnm00a.c
|   |   ├── pnm00b.c
|   |   ├── pnm06a.c
|   |   ├── pnm80.c
|   |   ├── pom00.c
|   |   ├── ppp.c
|   |   ├── ppsp.c
|   |   ├── pr00.c
|   |   ├── prec76.c
|   |   ├── pv2p.c
|   |   ├── pv2s.c
|   |   ├── pvdpv.c
|   |   ├── pvm.c
|   |   ├── pvmpv.c
|   |   ├── pvppv.c
|   |   ├── pvstar.c
|   |   ├── pvtob.c
|   |   ├── pvu.c
|   |   ├── pvup.c
|   |   ├── pvxpv.c
|   |   ├── pxp.c
|   |   ├── refco.c
|   |   ├── rm2v.c
|   |   ├── rv2m.c
|   |   ├── rx.c
|   |   ├── rxp.c
|   |   ├── rxpv.c
|   |   ├── rxr.c
|   |   ├── ry.c
|   |   ├── rz.c
|   |   ├── s00.c
|   |   ├── s00a.c
|   |   ├── s00b.c
|   |   ├── s06.c
|   |   ├── s06a.c
|   |   ├── s2c.c
|   |   ├── s2p.c
|   |   ├── s2pv.c
|   |   ├── s2xpv.c
|   |   ├── sepp.c
|   |   ├── seps.c
|   |   ├── sp00.c
|   |   ├── starpm.c
|   |   ├── starpv.c
|   |   ├── sxp.c
|   |   ├── sxpv.c
|   |   ├── taitt.c
|   |   ├── taiut1.c
|   |   ├── taiutc.c
|   |   ├── tcbtdb.c
|   |   ├── tcgtt.c
|   |   ├── tdbtcb.c
|   |   ├── tdbtt.c
|   |   ├── tf2a.c
|   |   ├── tf2d.c
|   |   ├── tr.c
|   |   ├── trxp.c
|   |   ├── trxpv.c
|   |   ├── tttai.c
|   |   ├── tttcg.c
|   |   ├── tttdb.c
|   |   ├── ttut1.c
|   |   ├── ut1tai.c
|   |   ├── ut1tt.c
|   |   ├── ut1utc.c
|   |   ├── utctai.c
|   |   ├── utcut1.c
|   |   ├── xy06.c
|   |   ├── xys00a.c
|   |   ├── xys00b.c
|   |   ├── xys06a.c
|   |   ├── zp.c
|   |   ├── zpv.c
|   |   └── zr.c
|   ├── expat
|   |   ├── CMakeLists.txt
|   |   ├── amiga
|   |   |   ├── README.txt
|   |   |   ├── expat.xml
|   |   |   ├── expat_68k.c
|   |   |   ├── expat_68k_handler_stubs.c
|   |   |   ├── expat_lib.c
|   |   |   ├── expat_vectors.c
|   |   |   ├── include
|   |   |   |   ├── inline4
|   |   |   |   ├── interfaces
|   |   |   |   ├── libraries
|   |   |   |   └── proto
|   |   |   ├── launch.c
|   |   |   └── stdlib.c
|   |   ├── bcb5
|   |   |   └── README.txt
|   |   ├── conftools
|   |   |   ├── get-version.sh
|   |   |   └── ltmain.sh
|   |   ├── doc
|   |   |   ├── reference.html
|   |   |   └── style.css
|   |   ├── examples
|   |   |   ├── elements.c
|   |   |   └── outline.c
|   |   ├── lib
|   |   |   ├── xmlparse.c
|   |   |   ├── xmlrole.c
|   |   |   ├── xmltok.c
|   |   |   ├── xmltok_impl.c
|   |   |   └── xmltok_ns.c
|   |   ├── m4
|   |   ├── tests
|   |   |   ├── README.txt
|   |   |   ├── benchmark
|   |   |   |   ├── README.txt
|   |   |   |   └── benchmark.c
|   |   |   ├── chardata.c
|   |   |   ├── minicheck.c
|   |   |   ├── runtests.c
|   |   |   ├── runtestspp.cpp
|   |   |   └── xmltest.sh
|   |   ├── vms
|   |   ├── win32
|   |   |   ├── MANIFEST.txt
|   |   |   └── README.txt
|   |   └── xmlwf
|   |       ├── codepage.c
|   |       ├── ct.c
|   |       ├── readfilemap.c
|   |       ├── unixfilemap.c
|   |       ├── win32filemap.c
|   |       ├── xmlfile.c
|   |       ├── xmlmime.c
|   |       ├── xmlwf.c
|   |       └── xmlwin32url.cxx
|   ├── trim_cfitsio.sh
|   ├── trim_wcslib.sh
|   └── wcslib
|       ├── C
|       |   ├── cel.c
|       |   ├── dis.c
|       |   ├── flexed
|       |   |   ├── fitshdr.c
|       |   |   ├── wcsbth.c
|       |   |   ├── wcspih.c
|       |   |   ├── wcsulex.c
|       |   |   └── wcsutrn.c
|       |   ├── getwcstab.c
|       |   ├── lin.c
|       |   ├── log.c
|       |   ├── prj.c
|       |   ├── spc.c
|       |   ├── sph.c
|       |   ├── spx.c
|       |   ├── tab.c
|       |   ├── wcs.c
|       |   ├── wcserr.c
|       |   ├── wcsfix.c
|       |   ├── wcshdr.c
|       |   ├── wcsprintf.c
|       |   ├── wcstrig.c
|       |   ├── wcsunits.c
|       |   └── wcsutil.c
|       └── config
├── conftest.py
├── docs
|   ├── _pkgtemplate.rst
|   ├── _static
|   ├── changelog.rst
|   ├── conf.py
|   ├── config
|   |   ├── config_0_4_transition.rst
|   |   └── index.rst
|   ├── constants
|   |   └── index.rst
|   ├── convolution
|   |   ├── images
|   |   ├── index.rst
|   |   ├── kernels.rst
|   |   ├── non_normalized_kernels.rst
|   |   └── using.rst
|   ├── coordinates
|   |   ├── angles.rst
|   |   ├── apply_space_motion.rst
|   |   ├── definitions.rst
|   |   ├── formatting.rst
|   |   ├── frames.rst
|   |   ├── galactocentric.rst
|   |   ├── index.rst
|   |   ├── inplace.rst
|   |   ├── matchsep.rst
|   |   ├── references.txt
|   |   ├── remote_methods.rst
|   |   ├── representations.rst
|   |   ├── skycoord.rst
|   |   ├── solarsystem.rst
|   |   ├── transforming.rst
|   |   └── velocities.rst
|   ├── cosmology
|   |   └── index.rst
|   ├── credits.rst
|   ├── development
|   |   ├── astropy-package-template.rst
|   |   ├── building.rst
|   |   ├── ccython.rst
|   |   ├── codeguide.rst
|   |   ├── codeguide_emacs.rst
|   |   ├── docguide.rst
|   |   ├── docrules.rst
|   |   ├── releasing.rst
|   |   ├── scripts.rst
|   |   ├── testguide.rst
|   |   ├── vision.rst
|   |   └── workflow
|   |       ├── additional_git_topics.rst
|   |       ├── command_history.rst
|   |       ├── command_history.sh
|   |       ├── command_history_with_output.sh
|   |       ├── development_workflow.rst
|   |       ├── get_devel_version.rst
|   |       ├── git_edit_workflow_examples.rst
|   |       ├── git_install.rst
|   |       ├── git_resources.rst
|   |       ├── maintainer_workflow.rst
|   |       ├── patches.rst
|   |       ├── terminal_cast.rst
|   |       ├── virtual_pythons.rst
|   |       └── virtualenv_detail.rst
|   ├── getting_started.rst
|   ├── importing_astropy.rst
|   ├── index.rst
|   ├── install.rst
|   ├── io
|   |   ├── ascii
|   |   |   ├── base_classes.rst
|   |   |   ├── extension_classes.rst
|   |   |   ├── fast_ascii_io.rst
|   |   |   ├── fixed_width_gallery.rst
|   |   |   ├── index.rst
|   |   |   ├── read.rst
|   |   |   ├── references.txt
|   |   |   ├── toc.txt
|   |   |   └── write.rst
|   |   ├── fits
|   |   |   ├── api
|   |   |   |   ├── cards.rst
|   |   |   |   ├── diff.rst
|   |   |   |   ├── files.rst
|   |   |   |   ├── hdulists.rst
|   |   |   |   ├── hdus.rst
|   |   |   |   ├── headers.rst
|   |   |   |   ├── images.rst
|   |   |   |   ├── tables.rst
|   |   |   |   └── verification.rst
|   |   |   ├── appendix
|   |   |   |   ├── faq.rst
|   |   |   |   ├── header_transition.rst
|   |   |   |   └── history.rst
|   |   |   ├── index.rst
|   |   |   └── usage
|   |   |       ├── headers.rst
|   |   |       ├── image.rst
|   |   |       ├── misc.rst
|   |   |       ├── scripts.rst
|   |   |       ├── table.rst
|   |   |       ├── unfamiliar.rst
|   |   |       └── verification.rst
|   |   ├── misc.rst
|   |   ├── registry.rst
|   |   ├── unified.rst
|   |   └── votable
|   |       ├── api_exceptions.rst
|   |       ├── index.rst
|   |       └── references.txt
|   ├── known_issues.rst
|   ├── license.rst
|   ├── logging.rst
|   ├── modeling
|   |   ├── algorithms.rst
|   |   ├── bounding-boxes.rst
|   |   ├── compound-models.rst
|   |   ├── fitting.rst
|   |   ├── index.rst
|   |   ├── models.rst
|   |   ├── new.rst
|   |   ├── parameters.rst
|   |   └── units.rst
|   ├── nddata
|   |   ├── ccddata.rst
|   |   ├── decorator.rst
|   |   ├── index.rst
|   |   ├── mixins
|   |   |   ├── index.rst
|   |   |   ├── ndarithmetic.rst
|   |   |   ├── ndio.rst
|   |   |   └── ndslicing.rst
|   |   ├── nddata.rst
|   |   ├── subclassing.rst
|   |   └── utils.rst
|   ├── overview.rst
|   ├── samp
|   |   ├── advanced_embed_samp_hub.rst
|   |   ├── example_clients.rst
|   |   ├── example_hub.rst
|   |   ├── example_table_image.rst
|   |   ├── index.rst
|   |   └── references.txt
|   ├── stability.rst
|   ├── stats
|   |   ├── circ.rst
|   |   ├── index.rst
|   |   ├── lombscargle.rst
|   |   ├── ripley.rst
|   |   └── robust.rst
|   ├── table
|   |   ├── access_table.rst
|   |   ├── construct_table.rst
|   |   ├── implementation_details.rst
|   |   ├── index.rst
|   |   ├── indexing.rst
|   |   ├── io.rst
|   |   ├── masking.rst
|   |   ├── mixin_columns.rst
|   |   ├── modify_table.rst
|   |   ├── operations.rst
|   |   ├── pandas.rst
|   |   └── references.txt
|   ├── testhelpers.rst
|   ├── time
|   |   ├── index.rst
|   |   └── references.txt
|   ├── units
|   |   ├── combining_and_defining.rst
|   |   ├── conversion.rst
|   |   ├── decomposing_and_composing.rst
|   |   ├── equivalencies.rst
|   |   ├── format.rst
|   |   ├── index.rst
|   |   ├── logarithmic_units.rst
|   |   ├── quantity.rst
|   |   └── standard_units.rst
|   ├── utils
|   |   ├── iers.rst
|   |   ├── index.rst
|   |   └── numpy.rst
|   ├── visualization
|   |   ├── histogram.rst
|   |   ├── index.rst
|   |   ├── lupton_rgb.rst
|   |   ├── normalization.rst
|   |   └── wcsaxes
|   |       ├── controlling_axes.rst
|   |       ├── custom_frames.rst
|   |       ├── images_contours.rst
|   |       ├── index.rst
|   |       ├── initializing_axes.rst
|   |       ├── overlaying_coordinate_systems.rst
|   |       ├── overlays.rst
|   |       ├── slicing_datacubes.rst
|   |       └── ticks_labels_grid.rst
|   ├── warnings.rst
|   ├── wcs
|   |   ├── examples
|   |   |   ├── from_file.py
|   |   |   └── programmatic.py
|   |   ├── history.rst
|   |   ├── index.rst
|   |   ├── note_sip.rst
|   |   ├── references.rst
|   |   ├── references.txt
|   |   └── relax.rst
|   └── whatsnew
|       ├── 0.1.rst
|       ├── 0.2.rst
|       ├── 0.3.rst
|       ├── 0.4.rst
|       ├── 1.0.rst
|       ├── 1.1.rst
|       ├── 1.2.rst
|       ├── 1.3.rst
|       ├── 2.0.rst
|       ├── 3.0.rst
|       ├── 3.1.rst
|       └── index.rst
├── examples
|   ├── README.txt
|   ├── coordinates
|   |   ├── README.txt
|   |   ├── plot_galactocentric-frame.py
|   |   ├── plot_obs-planning.py
|   |   ├── plot_sgr-coordinate-frame.py
|   |   └── rv-to-gsr.py
|   ├── io
|   |   ├── README.txt
|   |   ├── create-mef.py
|   |   ├── fits-tables.py
|   |   ├── modify-fits-header.py
|   |   ├── plot_fits-image.py
|   |   ├── skip_create-large-fits.py
|   |   └── split-jpeg-to-fits.py
|   └── template
|       └── example-template.py
├── ez_setup.py
├── licenses
|   ├── AURA_LICENSE.rst
|   ├── CONFIGOBJ_LICENSE.rst
|   ├── DATATABLES_LICENSE.rst
|   ├── ERFA.rst
|   ├── EXPAT_LICENSE.rst
|   ├── JQUERY_LICENSE.rst
|   ├── NUMPY_LICENSE.rst
|   ├── PLY_LICENSE.rst
|   ├── PYFITS.rst
|   ├── README.rst
|   └── WCSLIB_LICENSE.rst
├── readthedocs.yml
├── setup.py
└── static
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: units.quantity_input decorator fails for constructors with type hinted return value -> None

Description: ### Summary
I am using the `units.quantity_input` decorator with typing hints for constructors, however when I add the correct return value for the constructor (`None`) then I get an exception, because `None` has no attribute `to`.

### Reproducer
The issue can be reproduced with the following file:
``` Python
import astropy.units as u


class PoC(object):

    @u.quantity_input
    def __init__(self, voltage: u.V) -> None:
        pass


if __name__ == '__main__':
    poc = PoC(1.*u.V)
```
which results in the following error:
```
$ python3 poc.py
Traceback (most recent call last):
  File "poc.py", line 12, in <module>
    poc = PoC(1.*u.V)
  File "/usr/lib64/python3.6/site-packages/astropy/utils/decorators.py", line 868, in __init__
    func = make_function_with_signature(func, name=name, **wrapped_args)
  File "/usr/lib64/python3.6/site-packages/astropy/units/decorators.py", line 225, in wrapper
    return return_.to(wrapped_signature.return_annotation)
AttributeError: 'NoneType' object has no attribute 'to'
```

This has been tested on Fedora 27 with python 3.6.3, astropy 2.0.2 and numpy 1.13.3 all from Fedora's repository.

### Workaround
The issue can be circumvented by not adding the return type typing hint. Unfortunately, then a static type checker cannot infer that this function returns nothing.

### Possible fix
Maybe the decorator could explicitly check whether None is returned and then omit the unit check.

Patch information:
diff --git a/astropy/units/decorators.py b/astropy/units/decorators.py
index 8bece5a850..fc185cb5e0 100644
--- a/astropy/units/decorators.py
+++ b/astropy/units/decorators.py
@@ -221,6 +221,9 @@ class QuantityInput:
             with add_enabled_equivalencies(self.equivalencies):
                 return_ = wrapped_function(*func_args, **func_kwargs)
             if wrapped_signature.return_annotation is not inspect.Signature.empty:
+                # If the return value is None, return it directly without trying to convert units
+                if return_ is None:
+                    return None
                 return return_.to(wrapped_signature.return_annotation)
             else:
                 return return_


Find all relevant source code context needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of astropy/units/decorators.py.
Extra Requirements: 
Purpose: This file is needed to understand the implementation of the `quantity_input` decorator and how it handles return value annotations, or fails to handle, `None` return types from decorated functions like `__init__`.

Previous refined query 2:
Essential Query: Please provide the full content of astropy/utils/decorators.py.
Extra Requirements: 
Purpose: This file is required to understand the full execution path that leads to the error, particularly how decorators on `__init__` methods are handled, as indicated by the traceback.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: astropy/units/decorators.py
Line number range: 1 - 231
Content:
1. # -*- coding: utf-8 -*-
2. # Licensed under a 3-clause BSD style license - see LICENSE.rst
3. 
4. __all__ = ['quantity_input']
5. 
6. import inspect
7. from ..utils.decorators import wraps
8. from ..utils.misc import isiterable
9. 
10. from .core import Unit, UnitsError, add_enabled_equivalencies
11. from .physical import _unit_physical_mapping
12. 
13. 
14. def _get_allowed_units(targets):
15.     """
16.     From a list of target units (either as strings or unit objects) and physical
17.     types, return a list of Unit objects.
18.     """
19. 
20.     allowed_units = []
21.     for target in targets:
22. 
23.         try:  # unit passed in as a string
24.             target_unit = Unit(target)
25. 
26.         except ValueError:
27. 
28.             try:  # See if the function writer specified a physical type
29.                 physical_type_id = _unit_physical_mapping[target]
30. 
31.             except KeyError:  # Function argument target is invalid
32.                 raise ValueError("Invalid unit or physical type '{0}'."
33.                                  .format(target))
34. 
35.             # get unit directly from physical type id
36.             target_unit = Unit._from_physical_type_id(physical_type_id)
37. 
38.         allowed_units.append(target_unit)
39. 
40.     return allowed_units
41. 
42. 
43. def _validate_arg_value(param_name, func_name, arg, targets, equivalencies):
44.     """
45.     Validates the object passed in to the wrapped function, ``arg``, with target
46.     unit or physical type, ``target``.
47.     """
48. 
49.     allowed_units = _get_allowed_units(targets)
50. 
51.     for allowed_unit in allowed_units:
52.         try:
53.             is_equivalent = arg.unit.is_equivalent(allowed_unit,
54.                                                    equivalencies=equivalencies)
55. 
56.             if is_equivalent:
57.                 break
58. 
59.         except AttributeError:  # Either there is no .unit or no .is_equivalent
60.             if hasattr(arg, "unit"):
61.                 error_msg = "a 'unit' attribute without an 'is_equivalent' method"
62.             else:
63.                 error_msg = "no 'unit' attribute"
64. 
65.             raise TypeError("Argument '{0}' to function '{1}' has {2}. "
66.                   "You may want to pass in an astropy Quantity instead."
67.                      .format(param_name, func_name, error_msg))
68. 
69.     else:
70.         if len(targets) > 1:
71.             raise UnitsError("Argument '{0}' to function '{1}' must be in units"
72.                              " convertible to one of: {2}."
73.                              .format(param_name, func_name,
74.                                      [str(targ) for targ in targets]))
75.         else:
76.             raise UnitsError("Argument '{0}' to function '{1}' must be in units"
77.                              " convertible to '{2}'."
78.                              .format(param_name, func_name,
79.                                      str(targets[0])))
80. 
81. 
82. class QuantityInput:
83. 
84.     @classmethod
85.     def as_decorator(cls, func=None, **kwargs):
86.         r"""
87.         A decorator for validating the units of arguments to functions.
88. 
89.         Unit specifications can be provided as keyword arguments to the decorator,
90.         or by using function annotation syntax. Arguments to the decorator
91.         take precedence over any function annotations present.
92. 
93.         A `~astropy.units.UnitsError` will be raised if the unit attribute of
94.         the argument is not equivalent to the unit specified to the decorator
95.         or in the annotation.
96.         If the argument has no unit attribute, i.e. it is not a Quantity object, a
97.         `ValueError` will be raised.
98. 
99.         Where an equivalency is specified in the decorator, the function will be
100.         executed with that equivalency in force.
101. 
102.         Notes
103.         -----
104. 
105.         The checking of arguments inside variable arguments to a function is not
106.         supported (i.e. \*arg or \**kwargs).
107. 
108.         Examples
109.         --------
110. 
111.         .. code-block:: python
112. 
113.             import astropy.units as u
114.             @u.quantity_input(myangle=u.arcsec)
115.             def myfunction(myangle):
116.                 return myangle**2
117. 
118. 
119.         .. code-block:: python
120. 
121.             import astropy.units as u
122.             @u.quantity_input
123.             def myfunction(myangle: u.arcsec):
124.                 return myangle**2
125. 
126.         Also you can specify a return value annotation, which will
127.         cause the function to always return a `~astropy.units.Quantity` in that
128.         unit.
129. 
130.         .. code-block:: python
131. 
132.             import astropy.units as u
133.             @u.quantity_input
134.             def myfunction(myangle: u.arcsec) -> u.deg**2:
135.                 return myangle**2
136. 
137.         Using equivalencies::
138. 
139.             import astropy.units as u
140.             @u.quantity_input(myenergy=u.eV, equivalencies=u.mass_energy())
141.             def myfunction(myenergy):
142.                 return myenergy**2
143. 
144.         """
145.         self = cls(**kwargs)
146.         if func is not None and not kwargs:
147.             return self(func)
148.         else:
149.             return self
150. 
151.     def __init__(self, func=None, **kwargs):
152.         self.equivalencies = kwargs.pop('equivalencies', [])
153.         self.decorator_kwargs = kwargs
154. 
155.     def __call__(self, wrapped_function):
156. 
157.         # Extract the function signature for the function we are wrapping.
158.         wrapped_signature = inspect.signature(wrapped_function)
159. 
160.         # Define a new function to return in place of the wrapped one
161.         @wraps(wrapped_function)
162.         def wrapper(*func_args, **func_kwargs):
163.             # Bind the arguments to our new function to the signature of the original.
164.             bound_args = wrapped_signature.bind(*func_args, **func_kwargs)
165. 
166.             # Iterate through the parameters of the original signature
167.             for param in wrapped_signature.parameters.values():
168.                 # We do not support variable arguments (*args, **kwargs)
169.                 if param.kind in (inspect.Parameter.VAR_KEYWORD,
170.                                   inspect.Parameter.VAR_POSITIONAL):
171.                     continue
172. 
173.                 # Catch the (never triggered) case where bind relied on a default value.
174.                 if param.name not in bound_args.arguments and param.default is not param.empty:
175.                     bound_args.arguments[param.name] = param.default
176. 
177.                 # Get the value of this parameter (argument to new function)
178.                 arg = bound_args.arguments[param.name]
179. 
180.                 # Get target unit or physical type, either from decorator kwargs
181.                 #   or annotations
182.                 if param.name in self.decorator_kwargs:
183.                     targets = self.decorator_kwargs[param.name]
184.                 else:
185.                     targets = param.annotation
186. 
187.                 # If the targets is empty, then no target units or physical
188.                 #   types were specified so we can continue to the next arg
189.                 if targets is inspect.Parameter.empty:
190.                     continue
191. 
192.                 # If the argument value is None, and the default value is None,
193.                 #   pass through the None even if there is a target unit
194.                 if arg is None and param.default is None:
195.                     continue
196. 
197.                 # Here, we check whether multiple target unit/physical type's
198.                 #   were specified in the decorator/annotation, or whether a
199.                 #   single string (unit or physical type) or a Unit object was
200.                 #   specified
201.                 if isinstance(targets, str) or not isiterable(targets):
202.                     valid_targets = [targets]
203. 
204.                 # Check for None in the supplied list of allowed units and, if
205.                 #   present and the passed value is also None, ignore.
206.                 elif None in targets:
207.                     if arg is None:
208.                         continue
209.                     else:
210.                         valid_targets = [t for t in targets if t is not None]
211. 
212.                 else:
213.                     valid_targets = targets
214. 
215.                 # Now we loop over the allowed units/physical types and validate
216.                 #   the value of the argument:
217.                 _validate_arg_value(param.name, wrapped_function.__name__,
218.                                     arg, valid_targets, self.equivalencies)
219. 
220.             # Call the original function with any equivalencies in force.
221.             with add_enabled_equivalencies(self.equivalencies):
222.                 return_ = wrapped_function(*func_args, **func_kwargs)
223.             if wrapped_signature.return_annotation is not inspect.Signature.empty:
224.                 return return_.to(wrapped_signature.return_annotation)
225.             else:
226.                 return return_
227. 
228.         return wrapper
229. 
230. 
231. quantity_input = QuantityInput.as_decorator


File: astropy/utils/decorators.py
Line number range: 1 - 1001
Content:
1. # -*- coding: utf-8 -*-
2. # Licensed under a 3-clause BSD style license - see LICENSE.rst
3. """Sundry function and class decorators."""
4. 
5. 
6. 
7. import functools
8. import inspect
9. import textwrap
10. import types
11. import warnings
12. from inspect import signature
13. 
14. from .codegen import make_function_with_signature
15. from .exceptions import (AstropyDeprecationWarning, AstropyUserWarning,
16.                          AstropyPendingDeprecationWarning)
17. 
18. 
19. __all__ = ['classproperty', 'deprecated', 'deprecated_attribute',
20.            'deprecated_renamed_argument', 'format_doc',
21.            'lazyproperty', 'sharedmethod', 'wraps']
22. 
23. 
24. def deprecated(since, message='', name='', alternative='', pending=False,
25.                obj_type=None):
26.     """
27.     Used to mark a function or class as deprecated.
28. 
29.     To mark an attribute as deprecated, use `deprecated_attribute`.
30. 
31.     Parameters
32.     ------------
33.     since : str
34.         The release at which this API became deprecated.  This is
35.         required.
36. 
37.     message : str, optional
38.         Override the default deprecation message.  The format
39.         specifier ``func`` may be used for the name of the function,
40.         and ``alternative`` may be used in the deprecation message
41.         to insert the name of an alternative to the deprecated
42.         function. ``obj_type`` may be used to insert a friendly name
43.         for the type of object being deprecated.
44. 
45.     name : str, optional
46.         The name of the deprecated function or class; if not provided
47.         the name is automatically determined from the passed in
48.         function or class, though this is useful in the case of
49.         renamed functions, where the new function is just assigned to
50.         the name of the deprecated function.  For example::
51. 
52.             def new_function():
53.                 ...
54.             oldFunction = new_function
55. 
56.     alternative : str, optional
57.         An alternative function or class name that the user may use in
58.         place of the deprecated object.  The deprecation warning will
59.         tell the user about this alternative if provided.
60. 
61.     pending : bool, optional
62.         If True, uses a AstropyPendingDeprecationWarning instead of a
63.         AstropyDeprecationWarning.
64. 
65.     obj_type : str, optional
66.         The type of this object, if the automatically determined one
67.         needs to be overridden.
68.     """
69. 
70.     method_types = (classmethod, staticmethod, types.MethodType)
71. 
72.     def deprecate_doc(old_doc, message):
73.         """
74.         Returns a given docstring with a deprecation message prepended
75.         to it.
76.         """
77.         if not old_doc:
78.             old_doc = ''
79.         old_doc = textwrap.dedent(old_doc).strip('\n')
80.         new_doc = (('\n.. deprecated:: {since}'
81.                     '\n    {message}\n\n'.format(
82.                     **{'since': since, 'message': message.strip()})) + old_doc)
83.         if not old_doc:
84.             # This is to prevent a spurious 'unexpected unindent' warning from
85.             # docutils when the original docstring was blank.
86.             new_doc += r'\ '
87.         return new_doc
88. 
89.     def get_function(func):
90.         """
91.         Given a function or classmethod (or other function wrapper type), get
92.         the function object.
93.         """
94.         if isinstance(func, method_types):
95.             func = func.__func__
96.         return func
97. 
98.     def deprecate_function(func, message):
99.         """
100.         Returns a wrapped function that displays an
101.         ``AstropyDeprecationWarning`` when it is called.
102.         """
103. 
104.         if isinstance(func, method_types):
105.             func_wrapper = type(func)
106.         else:
107.             func_wrapper = lambda f: f
108. 
109.         func = get_function(func)
110. 
111.         def deprecated_func(*args, **kwargs):
112.             if pending:
113.                 category = AstropyPendingDeprecationWarning
114.             else:
115.                 category = AstropyDeprecationWarning
116. 
117.             warnings.warn(message, category, stacklevel=2)
118. 
119.             return func(*args, **kwargs)
120. 
121.         # If this is an extension function, we can't call
122.         # functools.wraps on it, but we normally don't care.
123.         # This crazy way to get the type of a wrapper descriptor is
124.         # straight out of the Python 3.3 inspect module docs.
125.         if type(func) is not type(str.__dict__['__add__']):  # nopep8
126.             deprecated_func = functools.wraps(func)(deprecated_func)
127. 
128.         deprecated_func.__doc__ = deprecate_doc(
129.             deprecated_func.__doc__, message)
130. 
131.         return func_wrapper(deprecated_func)
132. 
133.     def deprecate_class(cls, message):
134.         """
135.         Update the docstring and wrap the ``__init__`` in-place (or ``__new__``
136.         if the class or any of the bases overrides ``__new__``) so it will give
137.         a deprecation warning when an instance is created.
138. 
139.         This won't work for extension classes because these can't be modified
140.         in-place and the alternatives don't work in the general case:
141. 
142.         - Using a new class that looks and behaves like the original doesn't
143.           work because the __new__ method of extension types usually makes sure
144.           that it's the same class or a subclass.
145.         - Subclassing the class and return the subclass can lead to problems
146.           with pickle and will look weird in the Sphinx docs.
147.         """
148.         cls.__doc__ = deprecate_doc(cls.__doc__, message)
149.         if cls.__new__ is object.__new__:
150.             cls.__init__ = deprecate_function(get_function(cls.__init__), message)
151.         else:
152.             cls.__new__ = deprecate_function(get_function(cls.__new__), message)
153.         return cls
154. 
155.     def deprecate(obj, message=message, name=name, alternative=alternative,
156.                   pending=pending):
157.         if obj_type is None:
158.             if isinstance(obj, type):
159.                 obj_type_name = 'class'
160.             elif inspect.isfunction(obj):
161.                 obj_type_name = 'function'
162.             elif inspect.ismethod(obj) or isinstance(obj, method_types):
163.                 obj_type_name = 'method'
164.             else:
165.                 obj_type_name = 'object'
166.         else:
167.             obj_type_name = obj_type
168. 
169.         if not name:
170.             name = get_function(obj).__name__
171. 
172.         altmessage = ''
173.         if not message or type(message) is type(deprecate):
174.             if pending:
175.                 message = ('The {func} {obj_type} will be deprecated in a '
176.                            'future version.')
177.             else:
178.                 message = ('The {func} {obj_type} is deprecated and may '
179.                            'be removed in a future version.')
180.             if alternative:
181.                 altmessage = '\n        Use {} instead.'.format(alternative)
182. 
183.         message = ((message.format(**{
184.             'func': name,
185.             'name': name,
186.             'alternative': alternative,
187.             'obj_type': obj_type_name})) +
188.             altmessage)
189. 
190.         if isinstance(obj, type):
191.             return deprecate_class(obj, message)
192.         else:
193.             return deprecate_function(obj, message)
194. 
195.     if type(message) is type(deprecate):
196.         return deprecate(message)
197. 
198.     return deprecate
199. 
200. 
201. def deprecated_attribute(name, since, message=None, alternative=None,
202.                          pending=False):
203.     """
204.     Used to mark a public attribute as deprecated.  This creates a
205.     property that will warn when the given attribute name is accessed.
206.     To prevent the warning (i.e. for internal code), use the private
207.     name for the attribute by prepending an underscore
208.     (i.e. ``self._name``).
209. 
210.     Parameters
211.     ----------
212.     name : str
213.         The name of the deprecated attribute.
214. 
215.     since : str
216.         The release at which this API became deprecated.  This is
217.         required.
218. 
219.     message : str, optional
220.         Override the default deprecation message.  The format
221.         specifier ``name`` may be used for the name of the attribute,
222.         and ``alternative`` may be used in the deprecation message
223.         to insert the name of an alternative to the deprecated
224.         function.
225. 
226.     alternative : str, optional
227.         An alternative attribute that the user may use in place of the
228.         deprecated attribute.  The deprecation warning will tell the
229.         user about this alternative if provided.
230. 
231.     pending : bool, optional
232.         If True, uses a AstropyPendingDeprecationWarning instead of a
233.         AstropyDeprecationWarning.
234. 
235.     Examples
236.     --------
237. 
238.     ::
239. 
240.         class MyClass:
241.             # Mark the old_name as deprecated
242.             old_name = misc.deprecated_attribute('old_name', '0.1')
243. 
244.             def method(self):
245.                 self._old_name = 42
246.     """
247.     private_name = '_' + name
248. 
249.     @deprecated(since, name=name, obj_type='attribute')
250.     def get(self):
251.         return getattr(self, private_name)
252. 
253.     @deprecated(since, name=name, obj_type='attribute')
254.     def set(self, val):
255.         setattr(self, private_name, val)
256. 
257.     @deprecated(since, name=name, obj_type='attribute')
258.     def delete(self):
259.         delattr(self, private_name)
260. 
261.     return property(get, set, delete)
262. 
263. 
264. def deprecated_renamed_argument(old_name, new_name, since,
265.                                 arg_in_kwargs=False, relax=False,
266.                                 pending=False):
267.     """Deprecate a _renamed_ function argument.
268. 
269.     The decorator assumes that the argument with the ``old_name`` was removed
270.     from the function signature and the ``new_name`` replaced it at the
271.     **same position** in the signature.  If the ``old_name`` argument is
272.     given when calling the decorated function the decorator will catch it and
273.     issue a deprecation warning and pass it on as ``new_name`` argument.
274. 
275.     Parameters
276.     ----------
277.     old_name : str or list/tuple thereof
278.         The old name of the argument.
279. 
280.     new_name : str or list/tuple thereof
281.         The new name of the argument.
282. 
283.     since : str or number or list/tuple thereof
284.         The release at which the old argument became deprecated.
285. 
286.     arg_in_kwargs : bool or list/tuple thereof, optional
287.         If the argument is not a named argument (for example it
288.         was meant to be consumed by ``**kwargs``) set this to
289.         ``True``.  Otherwise the decorator will throw an Exception
290.         if the ``new_name`` cannot be found in the signature of
291.         the decorated function.
292.         Default is ``False``.
293. 
294.     relax : bool or list/tuple thereof, optional
295.         If ``False`` a ``TypeError`` is raised if both ``new_name`` and
296.         ``old_name`` are given.  If ``True`` the value for ``new_name`` is used
297.         and a Warning is issued.
298.         Default is ``False``.
299. 
300.     pending : bool or list/tuple thereof, optional
301.         If ``True`` this will hide the deprecation warning and ignore the
302.         corresponding ``relax`` parameter value.
303.         Default is ``False``.
304. 
305.     Raises
306.     ------
307.     TypeError
308.         If the new argument name cannot be found in the function
309.         signature and arg_in_kwargs was False or if it is used to
310.         deprecate the name of the ``*args``-, ``**kwargs``-like arguments.
311.         At runtime such an Error is raised if both the new_name
312.         and old_name were specified when calling the function and
313.         "relax=False".
314. 
315.     Notes
316.     -----
317.     The decorator should be applied to a function where the **name**
318.     of an argument was changed but it applies the same logic.
319. 
320.     .. warning::
321.         If ``old_name`` is a list or tuple the ``new_name`` and ``since`` must
322.         also be a list or tuple with the same number of entries. ``relax`` and
323.         ``arg_in_kwarg`` can be a single bool (applied to all) or also a
324.         list/tuple with the same number of entries like ``new_name``, etc.
325. 
326.     Examples
327.     --------
328.     The deprecation warnings are not shown in the following examples.
329. 
330.     To deprecate a positional or keyword argument::
331. 
332.         >>> from astropy.utils.decorators import deprecated_renamed_argument
333.         >>> @deprecated_renamed_argument('sig', 'sigma', '1.0')
334.         ... def test(sigma):
335.         ...     return sigma
336. 
337.         >>> test(2)
338.         2
339.         >>> test(sigma=2)
340.         2
341.         >>> test(sig=2)
342.         2
343. 
344.     To deprecate an argument catched inside the ``**kwargs`` the
345.     ``arg_in_kwargs`` has to be set::
346. 
347.         >>> @deprecated_renamed_argument('sig', 'sigma', '1.0',
348.         ...                             arg_in_kwargs=True)
349.         ... def test(**kwargs):
350.         ...     return kwargs['sigma']
351. 
352.         >>> test(sigma=2)
353.         2
354.         >>> test(sig=2)
355.         2
356. 
357.     By default providing the new and old keyword will lead to an Exception. If
358.     a Warning is desired set the ``relax`` argument::
359. 
360.         >>> @deprecated_renamed_argument('sig', 'sigma', '1.0', relax=True)
361.         ... def test(sigma):
362.         ...     return sigma
363. 
364.         >>> test(sig=2)
365.         2
366. 
367.     It is also possible to replace multiple arguments. The ``old_name``,
368.     ``new_name`` and ``since`` have to be `tuple` or `list` and contain the
369.     same number of entries::
370. 
371.         >>> @deprecated_renamed_argument(['a', 'b'], ['alpha', 'beta'],
372.         ...                              ['1.0', 1.2])
373.         ... def test(alpha, beta):
374.         ...     return alpha, beta
375. 
376.         >>> test(a=2, b=3)
377.         (2, 3)
378. 
379.     In this case ``arg_in_kwargs`` and ``relax`` can be a single value (which
380.     is applied to all renamed arguments) or must also be a `tuple` or `list`
381.     with values for each of the arguments.
382.     """
383.     cls_iter = (list, tuple)
384.     if isinstance(old_name, cls_iter):
385.         n = len(old_name)
386.         # Assume that new_name and since are correct (tuple/list with the
387.         # appropriate length) in the spirit of the "consenting adults". But the
388.         # optional parameters may not be set, so if these are not iterables
389.         # wrap them.
390.         if not isinstance(arg_in_kwargs, cls_iter):
391.             arg_in_kwargs = [arg_in_kwargs] * n
392.         if not isinstance(relax, cls_iter):
393.             relax = [relax] * n
394.         if not isinstance(pending, cls_iter):
395.             pending = [pending] * n
396.     else:
397.         # To allow a uniform approach later on, wrap all arguments in lists.
398.         n = 1
399.         old_name = [old_name]
400.         new_name = [new_name]
401.         since = [since]
402.         arg_in_kwargs = [arg_in_kwargs]
403.         relax = [relax]
404.         pending = [pending]
405. 
406.     def decorator(function):
407.         # The named arguments of the function.
408.         arguments = signature(function).parameters
409.         keys = list(arguments.keys())
410.         position = [None] * n
411. 
412.         for i in range(n):
413.             # Determine the position of the argument.
414.             if new_name[i] in arguments:
415.                 param = arguments[new_name[i]]
416.                 # There are several possibilities now:
417. 
418.                 # 1.) Positional or keyword argument:
419.                 if param.kind == param.POSITIONAL_OR_KEYWORD:
420.                     position[i] = keys.index(new_name[i])
421. 
422.                 # 2.) Keyword only argument:
423.                 elif param.kind == param.KEYWORD_ONLY:
424.                     # These cannot be specified by position.
425.                     position[i] = None
426. 
427.                 # 3.) positional-only argument, varargs, varkwargs or some
428.                 #     unknown type:
429.                 else:
430.                     raise TypeError('cannot replace argument "{0}" of kind '
431.                                     '{1!r}.'.format(new_name[i], param.kind))
432. 
433.             # In case the argument is not found in the list of arguments
434.             # the only remaining possibility is that it should be catched
435.             # by some kind of **kwargs argument.
436.             # This case has to be explicitly specified, otherwise throw
437.             # an exception!
438.             elif arg_in_kwargs[i]:
439.                 position[i] = None
440.             else:
441.                 raise TypeError('"{}" was not specified in the function '
442.                                 'signature. If it was meant to be part of '
443.                                 '"**kwargs" then set "arg_in_kwargs" to "True"'
444.                                 '.'.format(new_name[i]))
445. 
446.         @functools.wraps(function)
447.         def wrapper(*args, **kwargs):
448.             for i in range(n):
449.                 # The only way to have oldkeyword inside the function is
450.                 # that it is passed as kwarg because the oldkeyword
451.                 # parameter was renamed to newkeyword.
452.                 if old_name[i] in kwargs:
453.                     value = kwargs.pop(old_name[i])
454.                     # Display the deprecation warning only when it's only
455.                     # pending.
456.                     if not pending[i]:
457.                         warnings.warn(
458.                             '"{0}" was deprecated in version {1} '
459.                             'and will be removed in a future version. '
460.                             'Use argument "{2}" instead.'
461.                             ''.format(old_name[i], since[i], new_name[i]),
462.                             AstropyDeprecationWarning, stacklevel=2)
463. 
464.                     # Check if the newkeyword was given as well.
465.                     newarg_in_args = (position[i] is not None and
466.                                       len(args) > position[i])
467.                     newarg_in_kwargs = new_name[i] in kwargs
468. 
469.                     if newarg_in_args or newarg_in_kwargs:
470.                         if not pending[i]:
471.                             # If both are given print a Warning if relax is
472.                             # True or raise an Exception is relax is False.
473.                             if relax[i]:
474.                                 warnings.warn(
475.                                     '"{0}" and "{1}" keywords were set. '
476.                                     'Using the value of "{1}".'
477.                                     ''.format(old_name[i], new_name[i]),
478.                                     AstropyUserWarning)
479.                             else:
480.                                 raise TypeError(
481.                                     'cannot specify both "{}" and "{}"'
482.                                     '.'.format(old_name[i], new_name[i]))
483.                     else:
484.                         # If the new argument isn't specified just pass the old
485.                         # one with the name of the new argument to the function
486.                         kwargs[new_name[i]] = value
487.             return function(*args, **kwargs)
488. 
489.         return wrapper
490.     return decorator
491. 
492. 
493. # TODO: This can still be made to work for setters by implementing an
494. # accompanying metaclass that supports it; we just don't need that right this
495. # second
496. class classproperty(property):
497.     """
498.     Similar to `property`, but allows class-level properties.  That is,
499.     a property whose getter is like a `classmethod`.
500. 
501.     The wrapped method may explicitly use the `classmethod` decorator (which
502.     must become before this decorator), or the `classmethod` may be omitted
503.     (it is implicit through use of this decorator).
504. 
505.     .. note::
506. 
507.         classproperty only works for *read-only* properties.  It does not
508.         currently allow writeable/deleteable properties, due to subtleties of how
509.         Python descriptors work.  In order to implement such properties on a class
510.         a metaclass for that class must be implemented.
511. 
512.     Parameters
513.     ----------
514.     fget : callable
515.         The function that computes the value of this property (in particular,
516.         the function when this is used as a decorator) a la `property`.
517. 
518.     doc : str, optional
519.         The docstring for the property--by default inherited from the getter
520.         function.
521. 
522.     lazy : bool, optional
523.         If True, caches the value returned by the first call to the getter
524.         function, so that it is only called once (used for lazy evaluation
525.         of an attribute).  This is analogous to `lazyproperty`.  The ``lazy``
526.         argument can also be used when `classproperty` is used as a decorator
527.         (see the third example below).  When used in the decorator syntax this
528.         *must* be passed in as a keyword argument.
529. 
530.     Examples
531.     --------
532. 
533.     ::
534. 
535.         >>> class Foo:
536.         ...     _bar_internal = 1
537.         ...     @classproperty
538.         ...     def bar(cls):
539.         ...         return cls._bar_internal + 1
540.         ...
541.         >>> Foo.bar
542.         2
543.         >>> foo_instance = Foo()
544.         >>> foo_instance.bar
545.         2
546.         >>> foo_instance._bar_internal = 2
547.         >>> foo_instance.bar  # Ignores instance attributes
548.         2
549. 
550.     As previously noted, a `classproperty` is limited to implementing
551.     read-only attributes::
552. 
553.         >>> class Foo:
554.         ...     _bar_internal = 1
555.         ...     @classproperty
556.         ...     def bar(cls):
557.         ...         return cls._bar_internal
558.         ...     @bar.setter
559.         ...     def bar(cls, value):
560.         ...         cls._bar_internal = value
561.         ...
562.         Traceback (most recent call last):
563.         ...
564.         NotImplementedError: classproperty can only be read-only; use a
565.         metaclass to implement modifiable class-level properties
566. 
567.     When the ``lazy`` option is used, the getter is only called once::
568. 
569.         >>> class Foo:
570.         ...     @classproperty(lazy=True)
571.         ...     def bar(cls):
572.         ...         print("Performing complicated calculation")
573.         ...         return 1
574.         ...
575.         >>> Foo.bar
576.         Performing complicated calculation
577.         1
578.         >>> Foo.bar
579.         1
580. 
581.     If a subclass inherits a lazy `classproperty` the property is still
582.     re-evaluated for the subclass::
583. 
584.         >>> class FooSub(Foo):
585.         ...     pass
586.         ...
587.         >>> FooSub.bar
588.         Performing complicated calculation
589.         1
590.         >>> FooSub.bar
591.         1
592.     """
593. 
594.     def __new__(cls, fget=None, doc=None, lazy=False):
595.         if fget is None:
596.             # Being used as a decorator--return a wrapper that implements
597.             # decorator syntax
598.             def wrapper(func):
599.                 return cls(func, lazy=lazy)
600. 
601.             return wrapper
602. 
603.         return super().__new__(cls)
604. 
605.     def __init__(self, fget, doc=None, lazy=False):
606.         self._lazy = lazy
607.         if lazy:
608.             self._cache = {}
609.         fget = self._wrap_fget(fget)
610. 
611.         super().__init__(fget=fget, doc=doc)
612. 
613.         # There is a buglet in Python where self.__doc__ doesn't
614.         # get set properly on instances of property subclasses if
615.         # the doc argument was used rather than taking the docstring
616.         # from fget
617.         # Related Python issue: https://bugs.python.org/issue24766
618.         if doc is not None:
619.             self.__doc__ = doc
620. 
621.     def __get__(self, obj, objtype):
622.         if self._lazy and objtype in self._cache:
623.             return self._cache[objtype]
624. 
625.         # The base property.__get__ will just return self here;
626.         # instead we pass objtype through to the original wrapped
627.         # function (which takes the class as its sole argument)
628.         val = self.fget.__wrapped__(objtype)
629. 
630.         if self._lazy:
631.             self._cache[objtype] = val
632. 
633.         return val
634. 
635.     def getter(self, fget):
636.         return super().getter(self._wrap_fget(fget))
637. 
638.     def setter(self, fset):
639.         raise NotImplementedError(
640.             "classproperty can only be read-only; use a metaclass to "
641.             "implement modifiable class-level properties")
642. 
643.     def deleter(self, fdel):
644.         raise NotImplementedError(
645.             "classproperty can only be read-only; use a metaclass to "
646.             "implement modifiable class-level properties")
647. 
648.     @staticmethod
649.     def _wrap_fget(orig_fget):
650.         if isinstance(orig_fget, classmethod):
651.             orig_fget = orig_fget.__func__
652. 
653.         # Using stock functools.wraps instead of the fancier version
654.         # found later in this module, which is overkill for this purpose
655. 
656.         @functools.wraps(orig_fget)
657.         def fget(obj):
658.             return orig_fget(obj.__class__)
659. 
660.         return fget
661. 
662. 
663. class lazyproperty(property):
664.     """
665.     Works similarly to property(), but computes the value only once.
666. 
667.     This essentially memorizes the value of the property by storing the result
668.     of its computation in the ``__dict__`` of the object instance.  This is
669.     useful for computing the value of some property that should otherwise be
670.     invariant.  For example::
671. 
672.         >>> class LazyTest:
673.         ...     @lazyproperty
674.         ...     def complicated_property(self):
675.         ...         print('Computing the value for complicated_property...')
676.         ...         return 42
677.         ...
678.         >>> lt = LazyTest()
679.         >>> lt.complicated_property
680.         Computing the value for complicated_property...
681.         42
682.         >>> lt.complicated_property
683.         42
684. 
685.     As the example shows, the second time ``complicated_property`` is accessed,
686.     the ``print`` statement is not executed.  Only the return value from the
687.     first access off ``complicated_property`` is returned.
688. 
689.     By default, a setter and deleter are used which simply overwrite and
690.     delete, respectively, the value stored in ``__dict__``. Any user-specified
691.     setter or deleter is executed before executing these default actions.
692.     The one exception is that the default setter is not run if the user setter
693.     already sets the new value in ``__dict__`` and returns that value and the
694.     returned value is not ``None``.
695. 
696.     Adapted from the recipe at
697.     http://code.activestate.com/recipes/363602-lazy-property-evaluation
698.     """
699. 
700.     def __init__(self, fget, fset=None, fdel=None, doc=None):
701.         super().__init__(fget, fset, fdel, doc)
702.         self._key = self.fget.__name__
703. 
704.     def __get__(self, obj, owner=None):
705.         try:
706.             return obj.__dict__[self._key]
707.         except KeyError:
708.             val = self.fget(obj)
709.             obj.__dict__[self._key] = val
710.             return val
711.         except AttributeError:
712.             if obj is None:
713.                 return self
714.             raise
715. 
716.     def __set__(self, obj, val):
717.         obj_dict = obj.__dict__
718.         if self.fset:
719.             ret = self.fset(obj, val)
720.             if ret is not None and obj_dict.get(self._key) is ret:
721.                 # By returning the value set the setter signals that it took
722.                 # over setting the value in obj.__dict__; this mechanism allows
723.                 # it to override the input value
724.                 return
725.         obj_dict[self._key] = val
726. 
727.     def __delete__(self, obj):
728.         if self.fdel:
729.             self.fdel(obj)
730.         if self._key in obj.__dict__:
731.             del obj.__dict__[self._key]
732. 
733. 
734. class sharedmethod(classmethod):
735.     """
736.     This is a method decorator that allows both an instancemethod and a
737.     `classmethod` to share the same name.
738. 
739.     When using `sharedmethod` on a method defined in a class's body, it
740.     may be called on an instance, or on a class.  In the former case it
741.     behaves like a normal instance method (a reference to the instance is
742.     automatically passed as the first ``self`` argument of the method)::
743. 
744.         >>> class Example:
745.         ...     @sharedmethod
746.         ...     def identify(self, *args):
747.         ...         print('self was', self)
748.         ...         print('additional args were', args)
749.         ...
750.         >>> ex = Example()
751.         >>> ex.identify(1, 2)
752.         self was <astropy.utils.decorators.Example object at 0x...>
753.         additional args were (1, 2)
754. 
755.     In the latter case, when the `sharedmethod` is called directly from a
756.     class, it behaves like a `classmethod`::
757. 
758.         >>> Example.identify(3, 4)
759.         self was <class 'astropy.utils.decorators.Example'>
760.         additional args were (3, 4)
761. 
762.     This also supports a more advanced usage, where the `classmethod`
763.     implementation can be written separately.  If the class's *metaclass*
764.     has a method of the same name as the `sharedmethod`, the version on
765.     the metaclass is delegated to::
766. 
767.         >>> class ExampleMeta(type):
768.         ...     def identify(self):
769.         ...         print('this implements the {0}.identify '
770.         ...               'classmethod'.format(self.__name__))
771.         ...
772.         >>> class Example(metaclass=ExampleMeta):
773.         ...     @sharedmethod
774.         ...     def identify(self):
775.         ...         print('this implements the instancemethod')
776.         ...
777.         >>> Example().identify()
778.         this implements the instancemethod
779.         >>> Example.identify()
780.         this implements the Example.identify classmethod
781.     """
782. 
783.     def __get__(self, obj, objtype=None):
784.         if obj is None:
785.             mcls = type(objtype)
786.             clsmeth = getattr(mcls, self.__func__.__name__, None)
787.             if callable(clsmeth):
788.                 func = clsmeth
789.             else:
790.                 func = self.__func__
791. 
792.             return self._make_method(func, objtype)
793.         else:
794.             return self._make_method(self.__func__, obj)
795. 
796.     @staticmethod
797.     def _make_method(func, instance):
798.         return types.MethodType(func, instance)
799. 
800. 
801. def wraps(wrapped, assigned=functools.WRAPPER_ASSIGNMENTS,
802.           updated=functools.WRAPPER_UPDATES, exclude_args=()):
803.     """
804.     An alternative to `functools.wraps` which also preserves the original
805.     function's call signature by way of
806.     `~astropy.utils.codegen.make_function_with_signature`.
807. 
808.     This also adds an optional ``exclude_args`` argument.  If given it should
809.     be a sequence of argument names that should not be copied from the wrapped
810.     function (either positional or keyword arguments).
811. 
812.     The documentation for the original `functools.wraps` follows:
813. 
814.     """
815. 
816.     wrapped_args = _get_function_args(wrapped, exclude_args=exclude_args)
817. 
818.     def wrapper(func):
819.         if '__name__' in assigned:
820.             name = wrapped.__name__
821.         else:
822.             name = func.__name__
823. 
824.         func = make_function_with_signature(func, name=name, **wrapped_args)
825.         func = functools.update_wrapper(func, wrapped, assigned=assigned,
826.                                         updated=updated)
827.         return func
828. 
829.     return wrapper
830. 
831. 
832. if (isinstance(wraps.__doc__, str) and
833.         wraps.__doc__ is not None and functools.wraps.__doc__ is not None):
834.     wraps.__doc__ += functools.wraps.__doc__
835. 
836. 
837. def _get_function_args_internal(func):
838.     """
839.     Utility function for `wraps`.
840. 
841.     Reads the argspec for the given function and converts it to arguments
842.     for `make_function_with_signature`.
843.     """
844. 
845.     argspec = inspect.getfullargspec(func)
846. 
847.     if argspec.defaults:
848.         args = argspec.args[:-len(argspec.defaults)]
849.         kwargs = zip(argspec.args[len(args):], argspec.defaults)
850.     else:
851.         args = argspec.args
852.         kwargs = []
853. 
854.     if argspec.kwonlyargs:
855.         kwargs.extend((argname, argspec.kwonlydefaults[argname])
856.                       for argname in argspec.kwonlyargs)
857. 
858.     return {'args': args, 'kwargs': kwargs, 'varargs': argspec.varargs,
859.             'varkwargs': argspec.varkw}
860. 
861. 
862. def _get_function_args(func, exclude_args=()):
863.     all_args = _get_function_args_internal(func)
864. 
865.     if exclude_args:
866.         exclude_args = set(exclude_args)
867. 
868.         for arg_type in ('args', 'kwargs'):
869.             all_args[arg_type] = [arg for arg in all_args[arg_type]
870.                                   if arg not in exclude_args]
871. 
872.         for arg_type in ('varargs', 'varkwargs'):
873.             if all_args[arg_type] in exclude_args:
874.                 all_args[arg_type] = None
875. 
876.     return all_args
877. 
878. 
879. def format_doc(docstring, *args, **kwargs):
880.     """
881.     Replaces the docstring of the decorated object and then formats it.
882. 
883.     The formatting works like :meth:`str.format` and if the decorated object
884.     already has a docstring this docstring can be included in the new
885.     documentation if you use the ``{__doc__}`` placeholder.
886.     Its primary use is for reusing a *long* docstring in multiple functions
887.     when it is the same or only slightly different between them.
888. 
889.     Parameters
890.     ----------
891.     docstring : str or object or None
892.         The docstring that will replace the docstring of the decorated
893.         object. If it is an object like a function or class it will
894.         take the docstring of this object. If it is a string it will use the
895.         string itself. One special case is if the string is ``None`` then
896.         it will use the decorated functions docstring and formats it.
897. 
898.     args :
899.         passed to :meth:`str.format`.
900. 
901.     kwargs :
902.         passed to :meth:`str.format`. If the function has a (not empty)
903.         docstring the original docstring is added to the kwargs with the
904.         keyword ``'__doc__'``.
905. 
906.     Raises
907.     ------
908.     ValueError
909.         If the ``docstring`` (or interpreted docstring if it was ``None``
910.         or not a string) is empty.
911. 
912.     IndexError, KeyError
913.         If a placeholder in the (interpreted) ``docstring`` was not filled. see
914.         :meth:`str.format` for more information.
915. 
916.     Notes
917.     -----
918.     Using this decorator allows, for example Sphinx, to parse the
919.     correct docstring.
920. 
921.     Examples
922.     --------
923. 
924.     Replacing the current docstring is very easy::
925. 
926.         >>> from astropy.utils.decorators import format_doc
927.         >>> @format_doc('''Perform num1 + num2''')
928.         ... def add(num1, num2):
929.         ...     return num1+num2
930.         ...
931.         >>> help(add) # doctest: +SKIP
932.         Help on function add in module __main__:
933.         <BLANKLINE>
934.         add(num1, num2)
935.             Perform num1 + num2
936. 
937.     sometimes instead of replacing you only want to add to it::
938. 
939.         >>> doc = '''
940.         ...       {__doc__}
941.         ...       Parameters
942.         ...       ----------
943.         ...       num1, num2 : Numbers
944.         ...       Returns
945.         ...       -------
946.         ...       result: Number
947.         ...       '''
948.         >>> @format_doc(doc)
949.         ... def add(num1, num2):
950.         ...     '''Perform addition.'''
951.         ...     return num1+num2
952.         ...
953.         >>> help(add) # doctest: +SKIP
954.         Help on function add in module __main__:
955.         <BLANKLINE>
956.         add(num1, num2)
957.             Perform addition.
958.             Parameters
959.             ----------
960.             num1, num2 : Numbers
961.             Returns
962.             -------
963.             result : Number
964. 
965.     in case one might want to format it further::
966. 
967.         >>> doc = '''
968.         ...       Perform {0}.
969.         ...       Parameters
970.         ...       ----------
971.         ...       num1, num2 : Numbers
972.         ...       Returns
973.         ...       -------
974.         ...       result: Number
975.         ...           result of num1 {op} num2
976.         ...       {__doc__}
977.         ...       '''
978.         >>> @format_doc(doc, 'addition', op='+')
979.         ... def add(num1, num2):
980.         ...     return num1+num2
981.         ...
982.         >>> @format_doc(doc, 'subtraction', op='-')
983.         ... def subtract(num1, num2):
984.         ...     '''Notes: This one has additional notes.'''
985.         ...     return num1-num2
986.         ...
987.         >>> help(add) # doctest: +SKIP
988.         Help on function add in module __main__:
989.         <BLANKLINE>
990.         add(num1, num2)
991.             Perform addition.
992.             Parameters
993.             ----------
994.             num1, num2 : Numbers
995.             Returns
996.             -------
997.             result : Number
998.                 result of num1 + num2
999.         >>> help(subtract) # doctest: +SKIP
1000.         Help on function subtract in module __main__:
1001.         <BLANKLINE>

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 19:35:20,369 - thread-126746061964992.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="I have analyzed the user's request, the provided code snippets, and the previous context. The user is reporting a crash when using the `@quantity_input` decorator on an `__init__` method with a `-> None` return type annotation. The traceback points to an `AttributeError` in `astropy/units/decorators.py` when trying to perform a unit conversion on a `None` value, which is the return value of `__init__`. I have the full content of `astropy/units/decorators.py` and `astropy/utils/decorators.py`. This is sufficient to understand the implementation of the decorator, locate the source of the error, and formulate a fix. The problem is well-contained within the `QuantityInput` class in `astropy/units/decorators.py`. No further context is necessary to address the issue." query='' extra_requirements='' purpose=''
2025-12-21 19:35:20,370 - thread-126746061964992.prometheus_context_collector - INFO - Successfully retrieved 2 context snippets
