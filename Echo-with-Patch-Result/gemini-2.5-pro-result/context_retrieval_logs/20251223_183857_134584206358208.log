2025-12-23 18:38:57,427 - thread-134584206358208.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: Query syntax error with condition and distinct combination

Description: Description
	
A Count annotation containing both a Case condition and a distinct=True param produces a query error on Django 2.2 (whatever the db backend). A space is missing at least (... COUNT(DISTINCTCASE WHEN ...).

Patch information:
diff --git a/django/db/models/aggregates.py b/django/db/models/aggregates.py
index ac0b62d0bf..ea88c54b0d 100644
--- a/django/db/models/aggregates.py
+++ b/django/db/models/aggregates.py
@@ -68,7 +68,7 @@ class Aggregate(Func):
         return []
 
     def as_sql(self, compiler, connection, **extra_context):
-        extra_context['distinct'] = 'DISTINCT' if self.distinct else ''
+        extra_context['distinct'] = 'DISTINCT ' if self.distinct else ''
         if self.filter:
             if connection.features.supports_aggregate_filter_clause:
                 filter_sql, filter_params = self.filter.as_sql(compiler, connection)


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-12-23 18:38:57,587 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── bin
|   |   └── django-admin.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── bin
|   |   |   |   └── compress.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   ├── options.py
|   |   |   |   └── widgets.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── ar
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── mn
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sv
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── templates
|   |   |   |   ├── sitemap.xml
|   |   |   |   └── sitemap_index.xml
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── memcached.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   └── __init__.py
|   |   |   ├── database.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── utils.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   ├── special.py
|   |   |   |   └── utils.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── topological_sort.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── autoreload.py
|   |   ├── baseconv.py
|   |   ├── cache.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── datetime_safe.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── lru_cache.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── six.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           ├── default_urlconf.html
|           ├── technical_404.html
|           ├── technical_500.html
|           └── technical_500.txt
├── docs
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   ├── genindex.html
|   |   |   ├── layout.html
|   |   |   ├── modindex.html
|   |   |   ├── search.html
|   |   |   └── static
|   |   |       ├── console-tabs.css
|   |   |       ├── default.css
|   |   |       ├── djangodocs.css
|   |   |       ├── fontawesome
|   |   |       ├── homepage.css
|   |   |       └── reset-fonts-grids.css
|   |   └── djangodocs-epub
|   |       ├── epub-cover.html
|   |       └── static
|   |           └── epub.css
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── auth-remote-user.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-tags.txt
|   |   ├── deployment
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── jython.txt
|   |   ├── legacy-databases.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.txt
|   |   ├── index.txt
|   |   └── security.txt
|   └── topics
|       ├── _images
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── RelatedObjectLookups.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   ├── jsi18n-mocks.test.js
|   |   └── timeparse.test.js
|   ├── gis
|   |   └── mapwidget.test.js
|   ├── qunit
|   |   ├── qunit.css
|   |   └── qunit.js
|   └── tests.html
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   └── commands
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       └── noargs_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── admin
    |   |   |   ├── admin_views
    |   |   |   └── base_site.html
    |   |   └── custom_filter_template.html
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_forms.py
    |   ├── test_multidb.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── default_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   └── with_last_login_attr.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   |   ├── auth_attrs_access.html
    |   |   |   ├── auth_attrs_messages.html
    |   |   |   ├── auth_attrs_no_access.html
    |   |   |   ├── auth_attrs_perm_in_perms.html
    |   |   |   ├── auth_attrs_perms.html
    |   |   |   ├── auth_attrs_test_access.html
    |   |   |   └── auth_attrs_user.html
    |   |   └── registration
    |   |       ├── html_password_reset_email.html
    |   |       ├── logged_out.html
    |   |       ├── login.html
    |   |       ├── password_change_form.html
    |   |       ├── password_reset_complete.html
    |   |       ├── password_reset_confirm.html
    |   |       ├── password_reset_done.html
    |   |       ├── password_reset_email.html
    |   |       ├── password_reset_form.html
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_remote_user.py
    |   ├── test_remote_user_deprecation.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── test_base.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_introspection.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   └── commands
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   └── tests.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   └── tests.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_error_handlers.py
    |       ├── beginning_with_slash.py
    |       ├── contains_tuple.py
    |       ├── good_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   └── ending_with_dollar.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── choices
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   |       ├── debug.html
    |   |       └── request_attrs.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_greatest.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_round.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   └── test_postgresql_psycopg2.py
    ├── decorators
    |   ├── __init__.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── fixture2.xml
    |   |   ├── fixture3.xml
    |   |   ├── fixture7.xml
    |   |   └── fixture9.xml
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   |   └── fixture2.xml
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── animal.xml
    |   |   ├── bad_fixture2.xml
    |   |   ├── nk-inheritance2.xml
    |   |   ├── non_natural_2.xml
    |   |   ├── pretty.xml
    |   |   └── sequence_extra_xml.xml
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   |   └── default.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   |       └── custom_widget.html
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   |       ├── article_form.html
    |   |       └── custom_widget.html
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   |       └── using.html
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   ├── about.html
    |   |   |   ├── apple_detail.html
    |   |   |   ├── artist_detail.html
    |   |   |   ├── artist_form.html
    |   |   |   ├── author_confirm_delete.html
    |   |   |   ├── author_detail.html
    |   |   |   ├── author_form.html
    |   |   |   ├── author_list.html
    |   |   |   ├── author_objects.html
    |   |   |   ├── author_view.html
    |   |   |   ├── book_archive.html
    |   |   |   ├── book_archive_day.html
    |   |   |   ├── book_archive_month.html
    |   |   |   ├── book_archive_week.html
    |   |   |   ├── book_archive_year.html
    |   |   |   ├── book_detail.html
    |   |   |   ├── book_list.html
    |   |   |   ├── confirm_delete.html
    |   |   |   ├── detail.html
    |   |   |   ├── form.html
    |   |   |   ├── list.html
    |   |   |   ├── page_template.html
    |   |   |   ├── robots.txt
    |   |   |   └── using.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   └── test_srs.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── admin.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── maps
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   |   └── test_handler.html
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   |   └── ignored.html
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   |   └── media_ignored.html
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   ├── javascript_ignored.js
    |   |   |   └── static_ignored.html
    |   |   └── templates
    |   |       ├── empty.html
    |   |       ├── subdir
    |   |       ├── test.html
    |   |       └── xxx_ignored.html
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── models.py
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   |   ├── 404.html
    |   |   |   └── dummy.html
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   |   └── percents.html
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_introspection.py
    |   ├── test_json.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests
    |   ├── __init__.py
    |   ├── test_data_upload_settings.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   ├── test_file_charset.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   |       └── using.html
    |   ├── templates
    |   |   └── shortcuts
    |   |       ├── render_test.html
    |   |       └── using.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── custom_sitemap.xml
    |   |   └── custom_sitemap_index.xml
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   ├── test_management.py
    |   ├── test_utils.py
    |   └── urls
    |       ├── __init__.py
    |       ├── empty.py
    |       ├── http.py
    |       ├── https.py
    |       └── index_only.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── absolute_root.css
    |   |   |   ├── cached
    |   |   |   ├── styles_root.css
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   |   └── faulty.css
    |   |   ├── loop
    |   |   |   ├── bar.css
    |   |   |   └── foo.css
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   |       ├── description.html
    |   |       ├── description_context.html
    |   |       ├── title.html
    |   |       └── title_context.html
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   |       └── hello.html
    |   ├── jinja2
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       ├── syntax_error.html
    |   |       └── syntax_error2.html
    |   ├── template_strings
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       └── syntax_error.html
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_loader
    |   |       ├── goodbye.html
    |   |       ├── hello.html
    |   |       └── request.html
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   |       └── using.html
    |   ├── other_templates
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   └── test_dirs.html
    |   ├── recursive_templates
    |   |   ├── fs
    |   |   |   ├── extend-missing.html
    |   |   |   ├── one.html
    |   |   |   ├── other-recursive.html
    |   |   |   ├── recursive.html
    |   |   |   ├── self.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── fs2
    |   |   |   └── recursive.html
    |   |   └── fs3
    |   |       └── recursive.html
    |   ├── relative_templates
    |   |   ├── dir1
    |   |   |   ├── dir2
    |   |   |   ├── looped.html
    |   |   |   ├── one.html
    |   |   |   ├── one1.html
    |   |   |   ├── one2.html
    |   |   |   ├── one3.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── error_extends.html
    |   |   ├── error_include.html
    |   |   ├── one.html
    |   |   ├── three.html
    |   |   └── two.html
    |   ├── syntax_tests
    |   |   ├── __init__.py
    |   |   ├── i18n
    |   |   |   ├── __init__.py
    |   |   |   ├── base.py
    |   |   |   ├── test_blocktrans.py
    |   |   |   ├── test_filters.py
    |   |   |   ├── test_get_available_languages.py
    |   |   |   ├── test_get_current_language.py
    |   |   |   ├── test_get_current_language_bidi.py
    |   |   |   ├── test_get_language_info.py
    |   |   |   ├── test_get_language_info_list.py
    |   |   |   ├── test_language.py
    |   |   |   ├── test_trans.py
    |   |   |   └── test_underscore_syntax.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_basic.py
    |   |   ├── test_builtins.py
    |   |   ├── test_cache.py
    |   |   ├── test_comment.py
    |   |   ├── test_cycle.py
    |   |   ├── test_exceptions.py
    |   |   ├── test_extends.py
    |   |   ├── test_filter_syntax.py
    |   |   ├── test_filter_tag.py
    |   |   ├── test_firstof.py
    |   |   ├── test_for.py
    |   |   ├── test_if.py
    |   |   ├── test_if_changed.py
    |   |   ├── test_if_equal.py
    |   |   ├── test_include.py
    |   |   ├── test_invalid_string.py
    |   |   ├── test_list_index.py
    |   |   ├── test_load.py
    |   |   ├── test_lorem.py
    |   |   ├── test_multiline.py
    |   |   ├── test_named_endblock.py
    |   |   ├── test_now.py
    |   |   ├── test_numpy.py
    |   |   ├── test_regroup.py
    |   |   ├── test_resetcycle.py
    |   |   ├── test_setup.py
    |   |   ├── test_simple_tag.py
    |   |   ├── test_spaceless.py
    |   |   ├── test_static.py
    |   |   ├── test_template_tag.py
    |   |   ├── test_url.py
    |   |   ├── test_verbatim.py
    |   |   ├── test_width_ratio.py
    |   |   └── test_with.py
    |   ├── templates
    |   |   ├── 27584_child.html
    |   |   ├── 27584_parent.html
    |   |   ├── 27956_child.html
    |   |   ├── 27956_parent.html
    |   |   ├── broken_base.html
    |   |   ├── first
    |   |   |   └── test.html
    |   |   ├── include_tpl.html
    |   |   ├── included_base.html
    |   |   ├── included_content.html
    |   |   ├── inclusion.html
    |   |   ├── inclusion_base.html
    |   |   ├── inclusion_extends1.html
    |   |   ├── inclusion_extends2.html
    |   |   ├── index.html
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   ├── recursive_include.html
    |   |   ├── response.html
    |   |   ├── second
    |   |   |   └── test.html
    |   |   ├── ssi include with spaces.html
    |   |   ├── ssi_include.html
    |   |   ├── template_tests
    |   |   |   └── using.html
    |   |   ├── test_context.html
    |   |   ├── test_context_stack.html
    |   |   ├── test_extends_error.html
    |   |   ├── test_incl_tag_use_l10n.html
    |   |   └── test_include_error.html
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   ├── bad_tag.py
    |   |   ├── custom.py
    |   |   ├── inclusion.py
    |   |   ├── subpackage
    |   |   |   ├── __init__.py
    |   |   |   └── echo.py
    |   |   ├── tag_27584.py
    |   |   └── testtags.py
    |   ├── test_base.py
    |   ├── test_callables.py
    |   ├── test_context.py
    |   ├── test_custom.py
    |   ├── test_engine.py
    |   ├── test_extends.py
    |   ├── test_extends_relative.py
    |   ├── test_library.py
    |   ├── test_loaders.py
    |   ├── test_logging.py
    |   ├── test_nodelist.py
    |   ├── test_origin.py
    |   ├── test_parser.py
    |   ├── test_response.py
    |   ├── test_smartif.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── utils.py
    |   └── views.py
    ├── templates
    |   ├── base.html
    |   ├── comments
    |   |   └── comment_notification_email.txt
    |   ├── custom_admin
    |   |   ├── add_form.html
    |   |   ├── app_index.html
    |   |   ├── change_form.html
    |   |   ├── change_list.html
    |   |   ├── delete_confirmation.html
    |   |   ├── delete_selected_confirmation.html
    |   |   ├── index.html
    |   |   ├── login.html
    |   |   ├── logout.html
    |   |   ├── object_history.html
    |   |   ├── password_change_done.html
    |   |   ├── password_change_form.html
    |   |   └── popup_response.html
    |   ├── extended.html
    |   ├── form_view.html
    |   ├── login.html
    |   └── views
    |       ├── article_archive_day.html
    |       ├── article_archive_month.html
    |       ├── article_confirm_delete.html
    |       ├── article_detail.html
    |       ├── article_form.html
    |       ├── article_list.html
    |       ├── datearticle_archive_month.html
    |       ├── urlarticle_detail.html
    |       └── urlarticle_form.html
    ├── test_client
    |   ├── __init__.py
    |   ├── auth_backends.py
    |   ├── test_conditional_content_removal.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── test_client_regress
    |   ├── __init__.py
    |   ├── auth_backends.py
    |   ├── bad_templates
    |   |   └── 404.html
    |   ├── context_processors.py
    |   ├── models.py
    |   ├── session.py
    |   ├── templates
    |   |   ├── request_context.html
    |   |   └── unicode.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── test_exceptions
    |   ├── __init__.py
    |   └── test_validation_error.py
    ├── test_runner
    |   ├── __init__.py
    |   ├── models.py
    |   ├── runner.py
    |   ├── test_debug_sql.py
    |   ├── test_discover_runner.py
    |   ├── test_parallel.py
    |   └── tests.py
    ├── test_runner_apps
    |   ├── __init__.py
    |   ├── databases
    |   |   ├── __init__.py
    |   |   └── tests.py
    |   ├── sample
    |   |   ├── __init__.py
    |   |   ├── doctests.py
    |   |   ├── empty.py
    |   |   ├── pattern_tests.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── tests.py
    |   |   └── tests_sample.py
    |   ├── simple
    |   |   ├── __init__.py
    |   |   └── tests.py
    |   └── tagged
    |       ├── __init__.py
    |       ├── tests.py
    |       └── tests_inheritance.py
    ├── test_sqlite.py
    ├── test_utils
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── templates
    |   |   └── template_used
    |   |       ├── alternative.html
    |   |       ├── base.html
    |   |       ├── extends.html
    |   |       └── include.html
    |   ├── test_deprecated_features.py
    |   ├── test_testcase.py
    |   ├── test_transactiontestcase.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── timezones
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── transaction_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── transactions
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── unmanaged_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── update_only_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── urlpatterns
    |   ├── __init__.py
    |   ├── converter_urls.py
    |   ├── converters.py
    |   ├── included_urls.py
    |   ├── more_urls.py
    |   ├── path_base64_urls.py
    |   ├── path_dynamic_urls.py
    |   ├── path_urls.py
    |   ├── test_resolvers.py
    |   ├── tests.py
    |   └── views.py
    ├── urlpatterns_reverse
    |   ├── __init__.py
    |   ├── erroneous_urls.py
    |   ├── extra_urls.py
    |   ├── included_app_urls.py
    |   ├── included_named_urls.py
    |   ├── included_named_urls2.py
    |   ├── included_namespace_urls.py
    |   ├── included_no_kwargs_urls.py
    |   ├── included_urls.py
    |   ├── included_urls2.py
    |   ├── method_view_urls.py
    |   ├── middleware.py
    |   ├── named_urls.py
    |   ├── named_urls_conflict.py
    |   ├── namespace_urls.py
    |   ├── nested_urls.py
    |   ├── no_urls.py
    |   ├── nonimported_module.py
    |   ├── reverse_lazy_urls.py
    |   ├── test_localeregexdescriptor.py
    |   ├── tests.py
    |   ├── translations
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── urlconf_inner.py
    |   ├── urlconf_outer.py
    |   ├── urls.py
    |   ├── urls_error_handlers.py
    |   ├── urls_error_handlers_callables.py
    |   ├── urls_without_handlers.py
    |   ├── utils.py
    |   ├── views.py
    |   └── views_broken.py
    ├── urls.py
    ├── user_commands
    |   ├── __init__.py
    |   ├── eggs
    |   ├── management
    |   |   └── commands
    |   |       ├── common_args.py
    |   |       ├── dance.py
    |   |       ├── hal.py
    |   |       ├── no_translations.py
    |   |       ├── required_option.py
    |   |       ├── reverse_url.py
    |   |       ├── set_option.py
    |   |       ├── subparser.py
    |   |       └── transaction.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── utils_tests
    |   ├── __init__.py
    |   ├── archives
    |   ├── eggs
    |   ├── files
    |   |   ├── strip_tags1.html
    |   |   └── strip_tags2.txt
    |   ├── models.py
    |   ├── test_archive.py
    |   ├── test_autoreload.py
    |   ├── test_baseconv.py
    |   ├── test_crypto.py
    |   ├── test_datastructures.py
    |   ├── test_dateformat.py
    |   ├── test_dateparse.py
    |   ├── test_datetime_safe.py
    |   ├── test_decorators.py
    |   ├── test_duration.py
    |   ├── test_encoding.py
    |   ├── test_feedgenerator.py
    |   ├── test_functional.py
    |   ├── test_hashable.py
    |   ├── test_html.py
    |   ├── test_http.py
    |   ├── test_inspect.py
    |   ├── test_ipv6.py
    |   ├── test_jslex.py
    |   ├── test_lazyobject.py
    |   ├── test_lorem_ipsum.py
    |   ├── test_module
    |   |   ├── __init__.py
    |   |   ├── another_bad_module.py
    |   |   ├── another_good_module.py
    |   |   ├── bad_module.py
    |   |   ├── child_module
    |   |   |   ├── __init__.py
    |   |   |   └── grandchild_module.py
    |   |   └── good_module.py
    |   ├── test_module_loading.py
    |   ├── test_no_submodule.py
    |   ├── test_numberformat.py
    |   ├── test_os_utils.py
    |   ├── test_regex_helper.py
    |   ├── test_safestring.py
    |   ├── test_simplelazyobject.py
    |   ├── test_termcolors.py
    |   ├── test_text.py
    |   ├── test_timesince.py
    |   ├── test_timezone.py
    |   └── test_tree.py
    ├── validation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_custom_messages.py
    |   ├── test_error_messages.py
    |   ├── test_picklable.py
    |   ├── test_unique.py
    |   ├── test_validators.py
    |   └── tests.py
    ├── validators
    |   ├── __init__.py
    |   ├── invalid_urls.txt
    |   ├── tests.py
    |   └── valid_urls.txt
    ├── version
    |   ├── __init__.py
    |   └── tests.py
    ├── view_tests
    |   ├── __init__.py
    |   ├── app0
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── en
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── fr
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── fr
    |   ├── app3
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── es_AR
    |   ├── app4
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── es_AR
    |   ├── app5
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── fr
    |   ├── default_urls.py
    |   ├── generic_urls.py
    |   ├── locale
    |   |   ├── de
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_GB
    |   |   |   └── LC_MESSAGES
    |   |   ├── es
    |   |   |   └── LC_MESSAGES
    |   |   ├── fr
    |   |   |   └── LC_MESSAGES
    |   |   ├── nl
    |   |   |   └── LC_MESSAGES
    |   |   ├── pt
    |   |   |   └── LC_MESSAGES
    |   |   └── ru
    |   |       └── LC_MESSAGES
    |   ├── media
    |   |   ├── %2F.txt
    |   |   ├── file.txt
    |   |   ├── long-line.txt
    |   |   └── subdir
    |   ├── models.py
    |   ├── regression_21530_urls.py
    |   ├── templates
    |   |   ├── debug
    |   |   |   ├── template_error.html
    |   |   |   └── template_exception.html
    |   |   ├── jsi18n-multi-catalogs.html
    |   |   └── jsi18n.html
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   └── debugtags.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_csrf.py
    |   |   ├── test_debug.py
    |   |   ├── test_defaults.py
    |   |   ├── test_i18n.py
    |   |   ├── test_json.py
    |   |   ├── test_specials.py
    |   |   └── test_static.py
    |   ├── urls.py
    |   └── views.py
    └── wsgi
        ├── __init__.py
        ├── tests.py
        ├── urls.py
        └── wsgi.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Query syntax error with condition and distinct combination

Description: Description
	
A Count annotation containing both a Case condition and a distinct=True param produces a query error on Django 2.2 (whatever the db backend). A space is missing at least (... COUNT(DISTINCTCASE WHEN ...).

Patch information:
diff --git a/django/db/models/aggregates.py b/django/db/models/aggregates.py
index ac0b62d0bf..ea88c54b0d 100644
--- a/django/db/models/aggregates.py
+++ b/django/db/models/aggregates.py
@@ -68,7 +68,7 @@ class Aggregate(Func):
         return []
 
     def as_sql(self, compiler, connection, **extra_context):
-        extra_context['distinct'] = 'DISTINCT' if self.distinct else ''
+        extra_context['distinct'] = 'DISTINCT ' if self.distinct else ''
         if self.filter:
             if connection.features.supports_aggregate_filter_clause:
                 filter_sql, filter_params = self.filter.as_sql(compiler, connection)


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-23 18:39:20,308 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="The user wants to find 3 relevant test cases for a bug related to Django's `Count` annotation with `distinct=True` and a conditional filter. To find these, I need to examine the tests that cover aggregations, conditional expressions, and especially the filtering of aggregates. The most relevant files for this purpose appear to be `tests/aggregation/test_filter_argument.py`, `tests/expressions_case/tests.py`, and `tests/aggregation/tests.py`." query='Please provide the full content of `tests/aggregation/test_filter_argument.py`, `tests/expressions_case/tests.py`, and `tests/aggregation/tests.py`.' extra_requirements='' purpose="I need to analyze the content of these files to identify three suitable test cases that match the user's criteria for demonstrating the bug and its fix."
2025-12-23 18:39:20,309 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `tests/aggregation/test_filter_argument.py`, `tests/expressions_case/tests.py`, and `tests/aggregation/tests.py`.
2025-12-23 18:39:20,309 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-23 18:39:20,310 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-23 18:39:20,310 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-23 18:39:20,310 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `tests/aggregation/test_filter_argument.py`, `tests/expressions_case/tests.py`, and `tests/aggregation/tests.py`.
Purpose: I need to analyze the content of these files to identify three suitable test cases that match the user's criteria for demonstrating the bug and its fix.
2025-12-23 18:39:23,469 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/aggregation/tests.py"}'}, '__gemini_function_call_thought_signatures__': {'728b46c7-251b-4f3a-9716-54c836349d57': 'Co4HAY89a1+ZoRrw6un4atwgvph6gC4iXWm2sZXm4bTQNMucfuy9Jba17j6z8BZLbKv5xkFxGxTgGv56L0WxcG7mExhV5dr4+3kdVH3GYfaOo7Gx50Jj4EC88Y5dnjepY7VxQdqdOoIv3USvqvNJggCQj+kntbTXAknFlUeR8OIdUV6N7Ya5DLXjkbPkyqAvGf3Y6tmPDT3dHV6b1Z6IejXLQXEx+LyO7ZyexRVn8ZRlYbI7flCoU5bFgLvbnGzNGPsnZ7RuLvqB9qA7W/Vifsvguq8jpTRDy/0PjGEmnqHNNn8gFwMrIsEAEbYze+bxWOgCNUQct+E2gCA6MezWsPZYnvzUAqFEeeqB7buDUpL5GrS8h3OIMIXEJN6xUrFkJpSA63Vj78hzcz76vj7A0qMXe5Os8M9okf14/0uXO9P+1wzHo6MByHaNV0H7daRDsPbE9y25BZ+Ddz9kTwvQ+0YozhlhCuTD0mX+GV+8nwRqg9BRZTz6CRyb8S2dMB3uqp6gIuIcXmR7pCuxm4OEgjISNQYZ0eLZzTSwq/aT4U/a4cG0w3BsA8qIbhwZ3xdyjFbrIgRcUxMdgWkFUeMszhrhscDRwArOQepYJDLnRsA6m3QPT6ATYSXQFVNzhNMMfOH44T/IZsckYWrObFX5XweddCz4Cb0wsjBC9zFQJXfBdYbQNdexv/UhrJeZrnEBOafDdWgc5BbdEiZ1cpsnA05lzuooFuWbZXc1oBD7zQumBgkgjYSPHCj84d9YJ32/eZ3FatmoSRjnmylpwDmqjvU7OLod8hb5PagqX434U02aMgnjYWF7VTPwGvRQSiWdt1YTTNGADoAyUn/kbynqzahtW41++QjioR4Qb5T4R9sI3eXtP2UV7yPeurNjzw/jDSA8slymh95yAzPRj6HST2/9rAF2piWFMtl1A/YMA17C3qQHdq0Crb3VhiOhvd6m748jznFUjIzHPiK/jiSTyY5i8dwa1/3Cp3QedZLOu59vL0c/XOeVXzFYB4kRbDfcVq6Q/4xIMTizfZLtVC+wlL8JoBGL3BKO5zyCxT5L6j6+k/3r/hwiLLQqsSiafYkiSv9lPEGHyxjeogn6wiZ6CIgyzr0wEqc92G/NSXOKO5vo1KAwjU4kZSadTZybn+6VELi5389YlzMt37noyMlpf/HiE68ipfZBENZuWWEgk1W4RIa4dw0azr+wttRnqcMzPA=='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2120, 'candidates_token_count': 69, 'total_token_count': 2435, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2120}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 69}], 'thoughts_token_count': 246, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.07139225282530853, 'model_name': 'gemini-2.5-pro'} id='run--25ad868e-b2e8-4f15-8e87-fc58ea17c9e4-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/aggregation/test_filter_argument.py'}, 'id': '728b46c7-251b-4f3a-9716-54c836349d57', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/expressions_case/tests.py'}, 'id': '99be0c74-b253-4e1a-bcee-24d03d3babaa', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/aggregation/tests.py'}, 'id': 'b7a820ed-1d11-4f7b-b19c-50901741039f', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2120, 'output_tokens': 69, 'total_tokens': 2435, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 246}}
2025-12-23 18:39:25,542 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have successfully retrieved the complete contents of the three requested test files: `tests/aggregation/test_filter_argument.py`, `tests/expressions_case/tests.py`, and `tests/aggregation/tests.py`. This information is now available for you to analyze and select the most appropriate test cases.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 20820, 'candidates_token_count': 65, 'total_token_count': 20938, 'cached_content_token_count': 1886, 'prompt_tokens_details': [{'modality': 1, 'token_count': 21066}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1886}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 65}], 'thoughts_token_count': 53}, 'finish_reason': 'STOP', 'avg_logprobs': -0.10913658142089844, 'model_name': 'gemini-2.5-pro'} id='run--35c08ff2-f277-4c7e-9677-ccd9711aaabb-0' usage_metadata={'input_tokens': 20820, 'output_tokens': 65, 'total_tokens': 20938, 'input_token_details': {'cache_read': 1886}, 'output_token_details': {'reasoning': 53}}
2025-12-23 18:39:25,544 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `tests/aggregation/test_filter_argument.py`, `tests/expressions_case/tests.py`, and `tests/aggregation/tests.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
I need to analyze the content of these files to identify three suitable test cases that match the user's criteria for demonstrating the bug and its fix.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/aggregation/test_filter_argument.py
Line number range: 1 - 89
Content:
1. import datetime
2. from decimal import Decimal
3. 
4. from django.db.models import Case, Count, F, Q, Sum, When
5. from django.test import TestCase
6. 
7. from .models import Author, Book, Publisher
8. 
9. 
10. class FilteredAggregateTests(TestCase):
11.     @classmethod
12.     def setUpTestData(cls):
13.         cls.a1 = Author.objects.create(name='test', age=40)
14.         cls.a2 = Author.objects.create(name='test2', age=60)
15.         cls.a3 = Author.objects.create(name='test3', age=100)
16.         cls.p1 = Publisher.objects.create(name='Apress', num_awards=3, duration=datetime.timedelta(days=1))
17.         cls.b1 = Book.objects.create(
18.             isbn='159059725', name='The Definitive Guide to Django: Web Development Done Right',
19.             pages=447, rating=4.5, price=Decimal('30.00'), contact=cls.a1, publisher=cls.p1,
20.             pubdate=datetime.date(2007, 12, 6),
21.         )
22.         cls.b2 = Book.objects.create(
23.             isbn='067232959', name='Sams Teach Yourself Django in 24 Hours',
24.             pages=528, rating=3.0, price=Decimal('23.09'), contact=cls.a2, publisher=cls.p1,
25.             pubdate=datetime.date(2008, 3, 3),
26.         )
27.         cls.b3 = Book.objects.create(
28.             isbn='159059996', name='Practical Django Projects',
29.             pages=600, rating=4.5, price=Decimal('29.69'), contact=cls.a3, publisher=cls.p1,
30.             pubdate=datetime.date(2008, 6, 23),
31.         )
32.         cls.a1.friends.add(cls.a2)
33.         cls.a1.friends.add(cls.a3)
34.         cls.b1.authors.add(cls.a1)
35.         cls.b1.authors.add(cls.a3)
36.         cls.b2.authors.add(cls.a2)
37.         cls.b3.authors.add(cls.a3)
38. 
39.     def test_filtered_aggregates(self):
40.         agg = Sum('age', filter=Q(name__startswith='test'))
41.         self.assertEqual(Author.objects.aggregate(age=agg)['age'], 200)
42. 
43.     def test_double_filtered_aggregates(self):
44.         agg = Sum('age', filter=Q(Q(name='test2') & ~Q(name='test')))
45.         self.assertEqual(Author.objects.aggregate(age=agg)['age'], 60)
46. 
47.     def test_excluded_aggregates(self):
48.         agg = Sum('age', filter=~Q(name='test2'))
49.         self.assertEqual(Author.objects.aggregate(age=agg)['age'], 140)
50. 
51.     def test_related_aggregates_m2m(self):
52.         agg = Sum('friends__age', filter=~Q(friends__name='test'))
53.         self.assertEqual(Author.objects.filter(name='test').aggregate(age=agg)['age'], 160)
54. 
55.     def test_related_aggregates_m2m_and_fk(self):
56.         q = Q(friends__book__publisher__name='Apress') & ~Q(friends__name='test3')
57.         agg = Sum('friends__book__pages', filter=q)
58.         self.assertEqual(Author.objects.filter(name='test').aggregate(pages=agg)['pages'], 528)
59. 
60.     def test_plain_annotate(self):
61.         agg = Sum('book__pages', filter=Q(book__rating__gt=3))
62.         qs = Author.objects.annotate(pages=agg).order_by('pk')
63.         self.assertSequenceEqual([a.pages for a in qs], [447, None, 1047])
64. 
65.     def test_filtered_aggregate_on_annotate(self):
66.         pages_annotate = Sum('book__pages', filter=Q(book__rating__gt=3))
67.         age_agg = Sum('age', filter=Q(total_pages__gte=400))
68.         aggregated = Author.objects.annotate(total_pages=pages_annotate).aggregate(summed_age=age_agg)
69.         self.assertEqual(aggregated, {'summed_age': 140})
70. 
71.     def test_case_aggregate(self):
72.         agg = Sum(
73.             Case(When(friends__age=40, then=F('friends__age'))),
74.             filter=Q(friends__name__startswith='test'),
75.         )
76.         self.assertEqual(Author.objects.aggregate(age=agg)['age'], 80)
77. 
78.     def test_sum_star_exception(self):
79.         msg = 'Star cannot be used with filter. Please specify a field.'
80.         with self.assertRaisesMessage(ValueError, msg):
81.             Count('*', filter=Q(age=40))
82. 
83.     def test_filtered_reused_subquery(self):
84.         qs = Author.objects.annotate(
85.             older_friends_count=Count('friends', filter=Q(friends__age__gt=F('age'))),
86.         ).filter(
87.             older_friends_count__gte=2,
88.         )
89.         self.assertEqual(qs.get(pk__in=qs.values('pk')), self.a1)


File: tests/aggregation/tests.py
Line number range: 1 - 500
Content:
1. import datetime
2. import re
3. from decimal import Decimal
4. 
5. from django.core.exceptions import FieldError
6. from django.db import connection
7. from django.db.models import (
8.     Avg, Count, DecimalField, DurationField, F, FloatField, Func, IntegerField,
9.     Max, Min, Sum, Value,
10. )
11. from django.test import TestCase
12. from django.test.utils import Approximate, CaptureQueriesContext
13. from django.utils import timezone
14. 
15. from .models import Author, Book, Publisher, Store
16. 
17. 
18. class AggregateTestCase(TestCase):
19. 
20.     @classmethod
21.     def setUpTestData(cls):
22.         cls.a1 = Author.objects.create(name='Adrian Holovaty', age=34)
23.         cls.a2 = Author.objects.create(name='Jacob Kaplan-Moss', age=35)
24.         cls.a3 = Author.objects.create(name='Brad Dayley', age=45)
25.         cls.a4 = Author.objects.create(name='James Bennett', age=29)
26.         cls.a5 = Author.objects.create(name='Jeffrey Forcier', age=37)
27.         cls.a6 = Author.objects.create(name='Paul Bissex', age=29)
28.         cls.a7 = Author.objects.create(name='Wesley J. Chun', age=25)
29.         cls.a8 = Author.objects.create(name='Peter Norvig', age=57)
30.         cls.a9 = Author.objects.create(name='Stuart Russell', age=46)
31.         cls.a1.friends.add(cls.a2, cls.a4)
32.         cls.a2.friends.add(cls.a1, cls.a7)
33.         cls.a4.friends.add(cls.a1)
34.         cls.a5.friends.add(cls.a6, cls.a7)
35.         cls.a6.friends.add(cls.a5, cls.a7)
36.         cls.a7.friends.add(cls.a2, cls.a5, cls.a6)
37.         cls.a8.friends.add(cls.a9)
38.         cls.a9.friends.add(cls.a8)
39. 
40.         cls.p1 = Publisher.objects.create(name='Apress', num_awards=3, duration=datetime.timedelta(days=1))
41.         cls.p2 = Publisher.objects.create(name='Sams', num_awards=1, duration=datetime.timedelta(days=2))
42.         cls.p3 = Publisher.objects.create(name='Prentice Hall', num_awards=7)
43.         cls.p4 = Publisher.objects.create(name='Morgan Kaufmann', num_awards=9)
44.         cls.p5 = Publisher.objects.create(name="Jonno's House of Books", num_awards=0)
45. 
46.         cls.b1 = Book.objects.create(
47.             isbn='159059725', name='The Definitive Guide to Django: Web Development Done Right',
48.             pages=447, rating=4.5, price=Decimal('30.00'), contact=cls.a1, publisher=cls.p1,
49.             pubdate=datetime.date(2007, 12, 6)
50.         )
51.         cls.b2 = Book.objects.create(
52.             isbn='067232959', name='Sams Teach Yourself Django in 24 Hours',
53.             pages=528, rating=3.0, price=Decimal('23.09'), contact=cls.a3, publisher=cls.p2,
54.             pubdate=datetime.date(2008, 3, 3)
55.         )
56.         cls.b3 = Book.objects.create(
57.             isbn='159059996', name='Practical Django Projects',
58.             pages=300, rating=4.0, price=Decimal('29.69'), contact=cls.a4, publisher=cls.p1,
59.             pubdate=datetime.date(2008, 6, 23)
60.         )
61.         cls.b4 = Book.objects.create(
62.             isbn='013235613', name='Python Web Development with Django',
63.             pages=350, rating=4.0, price=Decimal('29.69'), contact=cls.a5, publisher=cls.p3,
64.             pubdate=datetime.date(2008, 11, 3)
65.         )
66.         cls.b5 = Book.objects.create(
67.             isbn='013790395', name='Artificial Intelligence: A Modern Approach',
68.             pages=1132, rating=4.0, price=Decimal('82.80'), contact=cls.a8, publisher=cls.p3,
69.             pubdate=datetime.date(1995, 1, 15)
70.         )
71.         cls.b6 = Book.objects.create(
72.             isbn='155860191', name='Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp',
73.             pages=946, rating=5.0, price=Decimal('75.00'), contact=cls.a8, publisher=cls.p4,
74.             pubdate=datetime.date(1991, 10, 15)
75.         )
76.         cls.b1.authors.add(cls.a1, cls.a2)
77.         cls.b2.authors.add(cls.a3)
78.         cls.b3.authors.add(cls.a4)
79.         cls.b4.authors.add(cls.a5, cls.a6, cls.a7)
80.         cls.b5.authors.add(cls.a8, cls.a9)
81.         cls.b6.authors.add(cls.a8)
82. 
83.         s1 = Store.objects.create(
84.             name='Amazon.com',
85.             original_opening=datetime.datetime(1994, 4, 23, 9, 17, 42),
86.             friday_night_closing=datetime.time(23, 59, 59)
87.         )
88.         s2 = Store.objects.create(
89.             name='Books.com',
90.             original_opening=datetime.datetime(2001, 3, 15, 11, 23, 37),
91.             friday_night_closing=datetime.time(23, 59, 59)
92.         )
93.         s3 = Store.objects.create(
94.             name="Mamma and Pappa's Books",
95.             original_opening=datetime.datetime(1945, 4, 25, 16, 24, 14),
96.             friday_night_closing=datetime.time(21, 30)
97.         )
98.         s1.books.add(cls.b1, cls.b2, cls.b3, cls.b4, cls.b5, cls.b6)
99.         s2.books.add(cls.b1, cls.b3, cls.b5, cls.b6)
100.         s3.books.add(cls.b3, cls.b4, cls.b6)
101. 
102.     def test_empty_aggregate(self):
103.         self.assertEqual(Author.objects.all().aggregate(), {})
104. 
105.     def test_aggregate_in_order_by(self):
106.         msg = (
107.             'Using an aggregate in order_by() without also including it in '
108.             'annotate() is not allowed: Avg(F(book__rating)'
109.         )
110.         with self.assertRaisesMessage(FieldError, msg):
111.             Author.objects.values('age').order_by(Avg('book__rating'))
112. 
113.     def test_single_aggregate(self):
114.         vals = Author.objects.aggregate(Avg("age"))
115.         self.assertEqual(vals, {"age__avg": Approximate(37.4, places=1)})
116. 
117.     def test_multiple_aggregates(self):
118.         vals = Author.objects.aggregate(Sum("age"), Avg("age"))
119.         self.assertEqual(vals, {"age__sum": 337, "age__avg": Approximate(37.4, places=1)})
120. 
121.     def test_filter_aggregate(self):
122.         vals = Author.objects.filter(age__gt=29).aggregate(Sum("age"))
123.         self.assertEqual(vals, {'age__sum': 254})
124. 
125.     def test_related_aggregate(self):
126.         vals = Author.objects.aggregate(Avg("friends__age"))
127.         self.assertEqual(vals, {'friends__age__avg': Approximate(34.07, places=2)})
128. 
129.         vals = Book.objects.filter(rating__lt=4.5).aggregate(Avg("authors__age"))
130.         self.assertEqual(vals, {'authors__age__avg': Approximate(38.2857, places=2)})
131. 
132.         vals = Author.objects.all().filter(name__contains="a").aggregate(Avg("book__rating"))
133.         self.assertEqual(vals, {'book__rating__avg': 4.0})
134. 
135.         vals = Book.objects.aggregate(Sum("publisher__num_awards"))
136.         self.assertEqual(vals, {'publisher__num_awards__sum': 30})
137. 
138.         vals = Publisher.objects.aggregate(Sum("book__price"))
139.         self.assertEqual(vals, {'book__price__sum': Decimal('270.27')})
140. 
141.     def test_aggregate_multi_join(self):
142.         vals = Store.objects.aggregate(Max("books__authors__age"))
143.         self.assertEqual(vals, {'books__authors__age__max': 57})
144. 
145.         vals = Author.objects.aggregate(Min("book__publisher__num_awards"))
146.         self.assertEqual(vals, {'book__publisher__num_awards__min': 1})
147. 
148.     def test_aggregate_alias(self):
149.         vals = Store.objects.filter(name="Amazon.com").aggregate(amazon_mean=Avg("books__rating"))
150.         self.assertEqual(vals, {'amazon_mean': Approximate(4.08, places=2)})
151. 
152.     def test_annotate_basic(self):
153.         self.assertQuerysetEqual(
154.             Book.objects.annotate().order_by('pk'), [
155.                 "The Definitive Guide to Django: Web Development Done Right",
156.                 "Sams Teach Yourself Django in 24 Hours",
157.                 "Practical Django Projects",
158.                 "Python Web Development with Django",
159.                 "Artificial Intelligence: A Modern Approach",
160.                 "Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp"
161.             ],
162.             lambda b: b.name
163.         )
164. 
165.         books = Book.objects.annotate(mean_age=Avg("authors__age"))
166.         b = books.get(pk=self.b1.pk)
167.         self.assertEqual(
168.             b.name,
169.             'The Definitive Guide to Django: Web Development Done Right'
170.         )
171.         self.assertEqual(b.mean_age, 34.5)
172. 
173.     def test_annotate_defer(self):
174.         qs = Book.objects.annotate(
175.             page_sum=Sum("pages")).defer('name').filter(pk=self.b1.pk)
176. 
177.         rows = [
178.             (self.b1.id, "159059725", 447, "The Definitive Guide to Django: Web Development Done Right")
179.         ]
180.         self.assertQuerysetEqual(
181.             qs.order_by('pk'), rows,
182.             lambda r: (r.id, r.isbn, r.page_sum, r.name)
183.         )
184. 
185.     def test_annotate_defer_select_related(self):
186.         qs = Book.objects.select_related('contact').annotate(
187.             page_sum=Sum("pages")).defer('name').filter(pk=self.b1.pk)
188. 
189.         rows = [
190.             (self.b1.id, "159059725", 447, "Adrian Holovaty",
191.              "The Definitive Guide to Django: Web Development Done Right")
192.         ]
193.         self.assertQuerysetEqual(
194.             qs.order_by('pk'), rows,
195.             lambda r: (r.id, r.isbn, r.page_sum, r.contact.name, r.name)
196.         )
197. 
198.     def test_annotate_m2m(self):
199.         books = Book.objects.filter(rating__lt=4.5).annotate(Avg("authors__age")).order_by("name")
200.         self.assertQuerysetEqual(
201.             books, [
202.                 ('Artificial Intelligence: A Modern Approach', 51.5),
203.                 ('Practical Django Projects', 29.0),
204.                 ('Python Web Development with Django', Approximate(30.3, places=1)),
205.                 ('Sams Teach Yourself Django in 24 Hours', 45.0)
206.             ],
207.             lambda b: (b.name, b.authors__age__avg),
208.         )
209. 
210.         books = Book.objects.annotate(num_authors=Count("authors")).order_by("name")
211.         self.assertQuerysetEqual(
212.             books, [
213.                 ('Artificial Intelligence: A Modern Approach', 2),
214.                 ('Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp', 1),
215.                 ('Practical Django Projects', 1),
216.                 ('Python Web Development with Django', 3),
217.                 ('Sams Teach Yourself Django in 24 Hours', 1),
218.                 ('The Definitive Guide to Django: Web Development Done Right', 2)
219.             ],
220.             lambda b: (b.name, b.num_authors)
221.         )
222. 
223.     def test_backwards_m2m_annotate(self):
224.         authors = Author.objects.filter(name__contains="a").annotate(Avg("book__rating")).order_by("name")
225.         self.assertQuerysetEqual(
226.             authors, [
227.                 ('Adrian Holovaty', 4.5),
228.                 ('Brad Dayley', 3.0),
229.                 ('Jacob Kaplan-Moss', 4.5),
230.                 ('James Bennett', 4.0),
231.                 ('Paul Bissex', 4.0),
232.                 ('Stuart Russell', 4.0)
233.             ],
234.             lambda a: (a.name, a.book__rating__avg)
235.         )
236. 
237.         authors = Author.objects.annotate(num_books=Count("book")).order_by("name")
238.         self.assertQuerysetEqual(
239.             authors, [
240.                 ('Adrian Holovaty', 1),
241.                 ('Brad Dayley', 1),
242.                 ('Jacob Kaplan-Moss', 1),
243.                 ('James Bennett', 1),
244.                 ('Jeffrey Forcier', 1),
245.                 ('Paul Bissex', 1),
246.                 ('Peter Norvig', 2),
247.                 ('Stuart Russell', 1),
248.                 ('Wesley J. Chun', 1)
249.             ],
250.             lambda a: (a.name, a.num_books)
251.         )
252. 
253.     def test_reverse_fkey_annotate(self):
254.         books = Book.objects.annotate(Sum("publisher__num_awards")).order_by("name")
255.         self.assertQuerysetEqual(
256.             books, [
257.                 ('Artificial Intelligence: A Modern Approach', 7),
258.                 ('Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp', 9),
259.                 ('Practical Django Projects', 3),
260.                 ('Python Web Development with Django', 7),
261.                 ('Sams Teach Yourself Django in 24 Hours', 1),
262.                 ('The Definitive Guide to Django: Web Development Done Right', 3)
263.             ],
264.             lambda b: (b.name, b.publisher__num_awards__sum)
265.         )
266. 
267.         publishers = Publisher.objects.annotate(Sum("book__price")).order_by("name")
268.         self.assertQuerysetEqual(
269.             publishers, [
270.                 ('Apress', Decimal("59.69")),
271.                 ("Jonno's House of Books", None),
272.                 ('Morgan Kaufmann', Decimal("75.00")),
273.                 ('Prentice Hall', Decimal("112.49")),
274.                 ('Sams', Decimal("23.09"))
275.             ],
276.             lambda p: (p.name, p.book__price__sum)
277.         )
278. 
279.     def test_annotate_values(self):
280.         books = list(Book.objects.filter(pk=self.b1.pk).annotate(mean_age=Avg("authors__age")).values())
281.         self.assertEqual(
282.             books, [
283.                 {
284.                     "contact_id": self.a1.id,
285.                     "id": self.b1.id,
286.                     "isbn": "159059725",
287.                     "mean_age": 34.5,
288.                     "name": "The Definitive Guide to Django: Web Development Done Right",
289.                     "pages": 447,
290.                     "price": Approximate(Decimal("30")),
291.                     "pubdate": datetime.date(2007, 12, 6),
292.                     "publisher_id": self.p1.id,
293.                     "rating": 4.5,
294.                 }
295.             ]
296.         )
297. 
298.         books = (
299.             Book.objects
300.             .filter(pk=self.b1.pk)
301.             .annotate(mean_age=Avg('authors__age'))
302.             .values('pk', 'isbn', 'mean_age')
303.         )
304.         self.assertEqual(
305.             list(books), [
306.                 {
307.                     "pk": self.b1.pk,
308.                     "isbn": "159059725",
309.                     "mean_age": 34.5,
310.                 }
311.             ]
312.         )
313. 
314.         books = Book.objects.filter(pk=self.b1.pk).annotate(mean_age=Avg("authors__age")).values("name")
315.         self.assertEqual(
316.             list(books),
317.             [{'name': 'The Definitive Guide to Django: Web Development Done Right'}],
318.         )
319. 
320.         books = Book.objects.filter(pk=self.b1.pk).values().annotate(mean_age=Avg('authors__age'))
321.         self.assertEqual(
322.             list(books), [
323.                 {
324.                     "contact_id": self.a1.id,
325.                     "id": self.b1.id,
326.                     "isbn": "159059725",
327.                     "mean_age": 34.5,
328.                     "name": "The Definitive Guide to Django: Web Development Done Right",
329.                     "pages": 447,
330.                     "price": Approximate(Decimal("30")),
331.                     "pubdate": datetime.date(2007, 12, 6),
332.                     "publisher_id": self.p1.id,
333.                     "rating": 4.5,
334.                 }
335.             ]
336.         )
337. 
338.         books = (
339.             Book.objects
340.             .values("rating")
341.             .annotate(n_authors=Count("authors__id"), mean_age=Avg("authors__age"))
342.             .order_by("rating")
343.         )
344.         self.assertEqual(
345.             list(books), [
346.                 {
347.                     "rating": 3.0,
348.                     "n_authors": 1,
349.                     "mean_age": 45.0,
350.                 },
351.                 {
352.                     "rating": 4.0,
353.                     "n_authors": 6,
354.                     "mean_age": Approximate(37.16, places=1)
355.                 },
356.                 {
357.                     "rating": 4.5,
358.                     "n_authors": 2,
359.                     "mean_age": 34.5,
360.                 },
361.                 {
362.                     "rating": 5.0,
363.                     "n_authors": 1,
364.                     "mean_age": 57.0,
365.                 }
366.             ]
367.         )
368. 
369.         authors = Author.objects.annotate(Avg("friends__age")).order_by("name")
370.         self.assertQuerysetEqual(
371.             authors, [
372.                 ('Adrian Holovaty', 32.0),
373.                 ('Brad Dayley', None),
374.                 ('Jacob Kaplan-Moss', 29.5),
375.                 ('James Bennett', 34.0),
376.                 ('Jeffrey Forcier', 27.0),
377.                 ('Paul Bissex', 31.0),
378.                 ('Peter Norvig', 46.0),
379.                 ('Stuart Russell', 57.0),
380.                 ('Wesley J. Chun', Approximate(33.66, places=1))
381.             ],
382.             lambda a: (a.name, a.friends__age__avg)
383.         )
384. 
385.     def test_count(self):
386.         vals = Book.objects.aggregate(Count("rating"))
387.         self.assertEqual(vals, {"rating__count": 6})
388. 
389.         vals = Book.objects.aggregate(Count("rating", distinct=True))
390.         self.assertEqual(vals, {"rating__count": 4})
391. 
392.     def test_count_star(self):
393.         with self.assertNumQueries(1) as ctx:
394.             Book.objects.aggregate(n=Count("*"))
395.         sql = ctx.captured_queries[0]['sql']
396.         self.assertIn('SELECT COUNT(*) ', sql)
397. 
398.     def test_non_grouped_annotation_not_in_group_by(self):
399.         """
400.         An annotation not included in values() before an aggregate should be
401.         excluded from the group by clause.
402.         """
403.         qs = (
404.             Book.objects.annotate(xprice=F('price')).filter(rating=4.0).values('rating')
405.                 .annotate(count=Count('publisher_id', distinct=True)).values('count', 'rating').order_by('count')
406.         )
407.         self.assertEqual(list(qs), [{'rating': 4.0, 'count': 2}])
408. 
409.     def test_grouped_annotation_in_group_by(self):
410.         """
411.         An annotation included in values() before an aggregate should be
412.         included in the group by clause.
413.         """
414.         qs = (
415.             Book.objects.annotate(xprice=F('price')).filter(rating=4.0).values('rating', 'xprice')
416.                 .annotate(count=Count('publisher_id', distinct=True)).values('count', 'rating').order_by('count')
417.         )
418.         self.assertEqual(
419.             list(qs), [
420.                 {'rating': 4.0, 'count': 1},
421.                 {'rating': 4.0, 'count': 2},
422.             ]
423.         )
424. 
425.     def test_fkey_aggregate(self):
426.         explicit = list(Author.objects.annotate(Count('book__id')))
427.         implicit = list(Author.objects.annotate(Count('book')))
428.         self.assertEqual(explicit, implicit)
429. 
430.     def test_annotate_ordering(self):
431.         books = Book.objects.values('rating').annotate(oldest=Max('authors__age')).order_by('oldest', 'rating')
432.         self.assertEqual(
433.             list(books), [
434.                 {'rating': 4.5, 'oldest': 35},
435.                 {'rating': 3.0, 'oldest': 45},
436.                 {'rating': 4.0, 'oldest': 57},
437.                 {'rating': 5.0, 'oldest': 57},
438.             ]
439.         )
440. 
441.         books = Book.objects.values("rating").annotate(oldest=Max("authors__age")).order_by("-oldest", "-rating")
442.         self.assertEqual(
443.             list(books), [
444.                 {'rating': 5.0, 'oldest': 57},
445.                 {'rating': 4.0, 'oldest': 57},
446.                 {'rating': 3.0, 'oldest': 45},
447.                 {'rating': 4.5, 'oldest': 35},
448.             ]
449.         )
450. 
451.     def test_aggregate_annotation(self):
452.         vals = Book.objects.annotate(num_authors=Count("authors__id")).aggregate(Avg("num_authors"))
453.         self.assertEqual(vals, {"num_authors__avg": Approximate(1.66, places=1)})
454. 
455.     def test_avg_duration_field(self):
456.         # Explicit `output_field`.
457.         self.assertEqual(
458.             Publisher.objects.aggregate(Avg('duration', output_field=DurationField())),
459.             {'duration__avg': datetime.timedelta(days=1, hours=12)}
460.         )
461.         # Implicit `output_field`.
462.         self.assertEqual(
463.             Publisher.objects.aggregate(Avg('duration')),
464.             {'duration__avg': datetime.timedelta(days=1, hours=12)}
465.         )
466. 
467.     def test_sum_duration_field(self):
468.         self.assertEqual(
469.             Publisher.objects.aggregate(Sum('duration', output_field=DurationField())),
470.             {'duration__sum': datetime.timedelta(days=3)}
471.         )
472. 
473.     def test_sum_distinct_aggregate(self):
474.         """
475.         Sum on a distinct() QuerySet should aggregate only the distinct items.
476.         """
477.         authors = Author.objects.filter(book__in=[self.b5, self.b6])
478.         self.assertEqual(authors.count(), 3)
479. 
480.         distinct_authors = authors.distinct()
481.         self.assertEqual(distinct_authors.count(), 2)
482. 
483.         # Selected author ages are 57 and 46
484.         age_sum = distinct_authors.aggregate(Sum('age'))
485.         self.assertEqual(age_sum['age__sum'], 103)
486. 
487.     def test_filtering(self):
488.         p = Publisher.objects.create(name='Expensive Publisher', num_awards=0)
489.         Book.objects.create(
490.             name='ExpensiveBook1',
491.             pages=1,
492.             isbn='111',
493.             rating=3.5,
494.             price=Decimal("1000"),
495.             publisher=p,
496.             contact_id=self.a1.id,
497.             pubdate=datetime.date(2008, 12, 1)
498.         )
499.         Book.objects.create(
500.             name='ExpensiveBook2',


File: tests/expressions_case/tests.py
Line number range: 1 - 500
Content:
1. import unittest
2. from datetime import date, datetime, time, timedelta
3. from decimal import Decimal
4. from operator import attrgetter, itemgetter
5. from uuid import UUID
6. 
7. from django.core.exceptions import FieldError
8. from django.db import models
9. from django.db.models import F, Max, Min, Q, Sum, Value
10. from django.db.models.expressions import Case, When
11. from django.test import SimpleTestCase, TestCase
12. 
13. from .models import CaseTestModel, Client, FKCaseTestModel, O2OCaseTestModel
14. 
15. try:
16.     from PIL import Image
17. except ImportError:
18.     Image = None
19. 
20. 
21. class CaseExpressionTests(TestCase):
22.     @classmethod
23.     def setUpTestData(cls):
24.         o = CaseTestModel.objects.create(integer=1, integer2=1, string='1')
25.         O2OCaseTestModel.objects.create(o2o=o, integer=1)
26.         FKCaseTestModel.objects.create(fk=o, integer=1)
27. 
28.         o = CaseTestModel.objects.create(integer=2, integer2=3, string='2')
29.         O2OCaseTestModel.objects.create(o2o=o, integer=2)
30.         FKCaseTestModel.objects.create(fk=o, integer=2)
31.         FKCaseTestModel.objects.create(fk=o, integer=3)
32. 
33.         o = CaseTestModel.objects.create(integer=3, integer2=4, string='3')
34.         O2OCaseTestModel.objects.create(o2o=o, integer=3)
35.         FKCaseTestModel.objects.create(fk=o, integer=3)
36.         FKCaseTestModel.objects.create(fk=o, integer=4)
37. 
38.         o = CaseTestModel.objects.create(integer=2, integer2=2, string='2')
39.         O2OCaseTestModel.objects.create(o2o=o, integer=2)
40.         FKCaseTestModel.objects.create(fk=o, integer=2)
41.         FKCaseTestModel.objects.create(fk=o, integer=3)
42. 
43.         o = CaseTestModel.objects.create(integer=3, integer2=4, string='3')
44.         O2OCaseTestModel.objects.create(o2o=o, integer=3)
45.         FKCaseTestModel.objects.create(fk=o, integer=3)
46.         FKCaseTestModel.objects.create(fk=o, integer=4)
47. 
48.         o = CaseTestModel.objects.create(integer=3, integer2=3, string='3')
49.         O2OCaseTestModel.objects.create(o2o=o, integer=3)
50.         FKCaseTestModel.objects.create(fk=o, integer=3)
51.         FKCaseTestModel.objects.create(fk=o, integer=4)
52. 
53.         o = CaseTestModel.objects.create(integer=4, integer2=5, string='4')
54.         O2OCaseTestModel.objects.create(o2o=o, integer=1)
55.         FKCaseTestModel.objects.create(fk=o, integer=5)
56. 
57.         # GROUP BY on Oracle fails with TextField/BinaryField; see #24096.
58.         cls.non_lob_fields = [
59.             f.name for f in CaseTestModel._meta.get_fields()
60.             if not (f.is_relation and f.auto_created) and not isinstance(f, (models.BinaryField, models.TextField))
61.         ]
62. 
63.     def test_annotate(self):
64.         self.assertQuerysetEqual(
65.             CaseTestModel.objects.annotate(test=Case(
66.                 When(integer=1, then=Value('one')),
67.                 When(integer=2, then=Value('two')),
68.                 default=Value('other'),
69.                 output_field=models.CharField(),
70.             )).order_by('pk'),
71.             [(1, 'one'), (2, 'two'), (3, 'other'), (2, 'two'), (3, 'other'), (3, 'other'), (4, 'other')],
72.             transform=attrgetter('integer', 'test')
73.         )
74. 
75.     def test_annotate_without_default(self):
76.         self.assertQuerysetEqual(
77.             CaseTestModel.objects.annotate(test=Case(
78.                 When(integer=1, then=1),
79.                 When(integer=2, then=2),
80.                 output_field=models.IntegerField(),
81.             )).order_by('pk'),
82.             [(1, 1), (2, 2), (3, None), (2, 2), (3, None), (3, None), (4, None)],
83.             transform=attrgetter('integer', 'test')
84.         )
85. 
86.     def test_annotate_with_expression_as_value(self):
87.         self.assertQuerysetEqual(
88.             CaseTestModel.objects.annotate(f_test=Case(
89.                 When(integer=1, then=F('integer') + 1),
90.                 When(integer=2, then=F('integer') + 3),
91.                 default='integer',
92.             )).order_by('pk'),
93.             [(1, 2), (2, 5), (3, 3), (2, 5), (3, 3), (3, 3), (4, 4)],
94.             transform=attrgetter('integer', 'f_test')
95.         )
96. 
97.     def test_annotate_with_expression_as_condition(self):
98.         self.assertQuerysetEqual(
99.             CaseTestModel.objects.annotate(f_test=Case(
100.                 When(integer2=F('integer'), then=Value('equal')),
101.                 When(integer2=F('integer') + 1, then=Value('+1')),
102.                 output_field=models.CharField(),
103.             )).order_by('pk'),
104.             [(1, 'equal'), (2, '+1'), (3, '+1'), (2, 'equal'), (3, '+1'), (3, 'equal'), (4, '+1')],
105.             transform=attrgetter('integer', 'f_test')
106.         )
107. 
108.     def test_annotate_with_join_in_value(self):
109.         self.assertQuerysetEqual(
110.             CaseTestModel.objects.annotate(join_test=Case(
111.                 When(integer=1, then=F('o2o_rel__integer') + 1),
112.                 When(integer=2, then=F('o2o_rel__integer') + 3),
113.                 default='o2o_rel__integer',
114.             )).order_by('pk'),
115.             [(1, 2), (2, 5), (3, 3), (2, 5), (3, 3), (3, 3), (4, 1)],
116.             transform=attrgetter('integer', 'join_test')
117.         )
118. 
119.     def test_annotate_with_in_clause(self):
120.         fk_rels = FKCaseTestModel.objects.filter(integer__in=[5])
121.         self.assertQuerysetEqual(
122.             CaseTestModel.objects.only('pk', 'integer').annotate(in_test=Sum(Case(
123.                 When(fk_rel__in=fk_rels, then=F('fk_rel__integer')),
124.                 default=Value(0),
125.             ))).order_by('pk'),
126.             [(1, 0), (2, 0), (3, 0), (2, 0), (3, 0), (3, 0), (4, 5)],
127.             transform=attrgetter('integer', 'in_test')
128.         )
129. 
130.     def test_annotate_with_join_in_condition(self):
131.         self.assertQuerysetEqual(
132.             CaseTestModel.objects.annotate(join_test=Case(
133.                 When(integer2=F('o2o_rel__integer'), then=Value('equal')),
134.                 When(integer2=F('o2o_rel__integer') + 1, then=Value('+1')),
135.                 default=Value('other'),
136.                 output_field=models.CharField(),
137.             )).order_by('pk'),
138.             [(1, 'equal'), (2, '+1'), (3, '+1'), (2, 'equal'), (3, '+1'), (3, 'equal'), (4, 'other')],
139.             transform=attrgetter('integer', 'join_test')
140.         )
141. 
142.     def test_annotate_with_join_in_predicate(self):
143.         self.assertQuerysetEqual(
144.             CaseTestModel.objects.annotate(join_test=Case(
145.                 When(o2o_rel__integer=1, then=Value('one')),
146.                 When(o2o_rel__integer=2, then=Value('two')),
147.                 When(o2o_rel__integer=3, then=Value('three')),
148.                 default=Value('other'),
149.                 output_field=models.CharField(),
150.             )).order_by('pk'),
151.             [(1, 'one'), (2, 'two'), (3, 'three'), (2, 'two'), (3, 'three'), (3, 'three'), (4, 'one')],
152.             transform=attrgetter('integer', 'join_test')
153.         )
154. 
155.     def test_annotate_with_annotation_in_value(self):
156.         self.assertQuerysetEqual(
157.             CaseTestModel.objects.annotate(
158.                 f_plus_1=F('integer') + 1,
159.                 f_plus_3=F('integer') + 3,
160.             ).annotate(
161.                 f_test=Case(
162.                     When(integer=1, then='f_plus_1'),
163.                     When(integer=2, then='f_plus_3'),
164.                     default='integer',
165.                 ),
166.             ).order_by('pk'),
167.             [(1, 2), (2, 5), (3, 3), (2, 5), (3, 3), (3, 3), (4, 4)],
168.             transform=attrgetter('integer', 'f_test')
169.         )
170. 
171.     def test_annotate_with_annotation_in_condition(self):
172.         self.assertQuerysetEqual(
173.             CaseTestModel.objects.annotate(
174.                 f_plus_1=F('integer') + 1,
175.             ).annotate(
176.                 f_test=Case(
177.                     When(integer2=F('integer'), then=Value('equal')),
178.                     When(integer2=F('f_plus_1'), then=Value('+1')),
179.                     output_field=models.CharField(),
180.                 ),
181.             ).order_by('pk'),
182.             [(1, 'equal'), (2, '+1'), (3, '+1'), (2, 'equal'), (3, '+1'), (3, 'equal'), (4, '+1')],
183.             transform=attrgetter('integer', 'f_test')
184.         )
185. 
186.     def test_annotate_with_annotation_in_predicate(self):
187.         self.assertQuerysetEqual(
188.             CaseTestModel.objects.annotate(
189.                 f_minus_2=F('integer') - 2,
190.             ).annotate(
191.                 test=Case(
192.                     When(f_minus_2=-1, then=Value('negative one')),
193.                     When(f_minus_2=0, then=Value('zero')),
194.                     When(f_minus_2=1, then=Value('one')),
195.                     default=Value('other'),
196.                     output_field=models.CharField(),
197.                 ),
198.             ).order_by('pk'),
199.             [(1, 'negative one'), (2, 'zero'), (3, 'one'), (2, 'zero'), (3, 'one'), (3, 'one'), (4, 'other')],
200.             transform=attrgetter('integer', 'test')
201.         )
202. 
203.     def test_annotate_with_aggregation_in_value(self):
204.         self.assertQuerysetEqual(
205.             CaseTestModel.objects.values(*self.non_lob_fields).annotate(
206.                 min=Min('fk_rel__integer'),
207.                 max=Max('fk_rel__integer'),
208.             ).annotate(
209.                 test=Case(
210.                     When(integer=2, then='min'),
211.                     When(integer=3, then='max'),
212.                 ),
213.             ).order_by('pk'),
214.             [(1, None, 1, 1), (2, 2, 2, 3), (3, 4, 3, 4), (2, 2, 2, 3), (3, 4, 3, 4), (3, 4, 3, 4), (4, None, 5, 5)],
215.             transform=itemgetter('integer', 'test', 'min', 'max')
216.         )
217. 
218.     def test_annotate_with_aggregation_in_condition(self):
219.         self.assertQuerysetEqual(
220.             CaseTestModel.objects.values(*self.non_lob_fields).annotate(
221.                 min=Min('fk_rel__integer'),
222.                 max=Max('fk_rel__integer'),
223.             ).annotate(
224.                 test=Case(
225.                     When(integer2=F('min'), then=Value('min')),
226.                     When(integer2=F('max'), then=Value('max')),
227.                     output_field=models.CharField(),
228.                 ),
229.             ).order_by('pk'),
230.             [(1, 1, 'min'), (2, 3, 'max'), (3, 4, 'max'), (2, 2, 'min'), (3, 4, 'max'), (3, 3, 'min'), (4, 5, 'min')],
231.             transform=itemgetter('integer', 'integer2', 'test')
232.         )
233. 
234.     def test_annotate_with_aggregation_in_predicate(self):
235.         self.assertQuerysetEqual(
236.             CaseTestModel.objects.values(*self.non_lob_fields).annotate(
237.                 max=Max('fk_rel__integer'),
238.             ).annotate(
239.                 test=Case(
240.                     When(max=3, then=Value('max = 3')),
241.                     When(max=4, then=Value('max = 4')),
242.                     default=Value(''),
243.                     output_field=models.CharField(),
244.                 ),
245.             ).order_by('pk'),
246.             [(1, 1, ''), (2, 3, 'max = 3'), (3, 4, 'max = 4'), (2, 3, 'max = 3'),
247.              (3, 4, 'max = 4'), (3, 4, 'max = 4'), (4, 5, '')],
248.             transform=itemgetter('integer', 'max', 'test')
249.         )
250. 
251.     def test_annotate_exclude(self):
252.         self.assertQuerysetEqual(
253.             CaseTestModel.objects.annotate(test=Case(
254.                 When(integer=1, then=Value('one')),
255.                 When(integer=2, then=Value('two')),
256.                 default=Value('other'),
257.                 output_field=models.CharField(),
258.             )).exclude(test='other').order_by('pk'),
259.             [(1, 'one'), (2, 'two'), (2, 'two')],
260.             transform=attrgetter('integer', 'test')
261.         )
262. 
263.     def test_annotate_values_not_in_order_by(self):
264.         self.assertEqual(
265.             list(CaseTestModel.objects.annotate(test=Case(
266.                 When(integer=1, then=Value('one')),
267.                 When(integer=2, then=Value('two')),
268.                 When(integer=3, then=Value('three')),
269.                 default=Value('other'),
270.                 output_field=models.CharField(),
271.             )).order_by('test').values_list('integer', flat=True)),
272.             [1, 4, 3, 3, 3, 2, 2]
273.         )
274. 
275.     def test_annotate_with_empty_when(self):
276.         objects = CaseTestModel.objects.annotate(
277.             selected=Case(
278.                 When(pk__in=[], then=Value('selected')),
279.                 default=Value('not selected'), output_field=models.CharField()
280.             )
281.         )
282.         self.assertEqual(len(objects), CaseTestModel.objects.count())
283.         self.assertTrue(all(obj.selected == 'not selected' for obj in objects))
284. 
285.     def test_combined_expression(self):
286.         self.assertQuerysetEqual(
287.             CaseTestModel.objects.annotate(
288.                 test=Case(
289.                     When(integer=1, then=2),
290.                     When(integer=2, then=1),
291.                     default=3,
292.                     output_field=models.IntegerField(),
293.                 ) + 1,
294.             ).order_by('pk'),
295.             [(1, 3), (2, 2), (3, 4), (2, 2), (3, 4), (3, 4), (4, 4)],
296.             transform=attrgetter('integer', 'test')
297.         )
298. 
299.     def test_in_subquery(self):
300.         self.assertQuerysetEqual(
301.             CaseTestModel.objects.filter(
302.                 pk__in=CaseTestModel.objects.annotate(
303.                     test=Case(
304.                         When(integer=F('integer2'), then='pk'),
305.                         When(integer=4, then='pk'),
306.                         output_field=models.IntegerField(),
307.                     ),
308.                 ).values('test')).order_by('pk'),
309.             [(1, 1), (2, 2), (3, 3), (4, 5)],
310.             transform=attrgetter('integer', 'integer2')
311.         )
312. 
313.     def test_case_reuse(self):
314.         SOME_CASE = Case(
315.             When(pk=0, then=Value('0')),
316.             default=Value('1'),
317.             output_field=models.CharField(),
318.         )
319.         self.assertQuerysetEqual(
320.             CaseTestModel.objects.annotate(somecase=SOME_CASE).order_by('pk'),
321.             CaseTestModel.objects.annotate(somecase=SOME_CASE).order_by('pk').values_list('pk', 'somecase'),
322.             lambda x: (x.pk, x.somecase)
323.         )
324. 
325.     def test_aggregate(self):
326.         self.assertEqual(
327.             CaseTestModel.objects.aggregate(
328.                 one=models.Sum(Case(
329.                     When(integer=1, then=1),
330.                     output_field=models.IntegerField(),
331.                 )),
332.                 two=models.Sum(Case(
333.                     When(integer=2, then=1),
334.                     output_field=models.IntegerField(),
335.                 )),
336.                 three=models.Sum(Case(
337.                     When(integer=3, then=1),
338.                     output_field=models.IntegerField(),
339.                 )),
340.                 four=models.Sum(Case(
341.                     When(integer=4, then=1),
342.                     output_field=models.IntegerField(),
343.                 )),
344.             ),
345.             {'one': 1, 'two': 2, 'three': 3, 'four': 1}
346.         )
347. 
348.     def test_aggregate_with_expression_as_value(self):
349.         self.assertEqual(
350.             CaseTestModel.objects.aggregate(
351.                 one=models.Sum(Case(When(integer=1, then='integer'))),
352.                 two=models.Sum(Case(When(integer=2, then=F('integer') - 1))),
353.                 three=models.Sum(Case(When(integer=3, then=F('integer') + 1))),
354.             ),
355.             {'one': 1, 'two': 2, 'three': 12}
356.         )
357. 
358.     def test_aggregate_with_expression_as_condition(self):
359.         self.assertEqual(
360.             CaseTestModel.objects.aggregate(
361.                 equal=models.Sum(Case(
362.                     When(integer2=F('integer'), then=1),
363.                     output_field=models.IntegerField(),
364.                 )),
365.                 plus_one=models.Sum(Case(
366.                     When(integer2=F('integer') + 1, then=1),
367.                     output_field=models.IntegerField(),
368.                 )),
369.             ),
370.             {'equal': 3, 'plus_one': 4}
371.         )
372. 
373.     def test_filter(self):
374.         self.assertQuerysetEqual(
375.             CaseTestModel.objects.filter(integer2=Case(
376.                 When(integer=2, then=3),
377.                 When(integer=3, then=4),
378.                 default=1,
379.                 output_field=models.IntegerField(),
380.             )).order_by('pk'),
381.             [(1, 1), (2, 3), (3, 4), (3, 4)],
382.             transform=attrgetter('integer', 'integer2')
383.         )
384. 
385.     def test_filter_without_default(self):
386.         self.assertQuerysetEqual(
387.             CaseTestModel.objects.filter(integer2=Case(
388.                 When(integer=2, then=3),
389.                 When(integer=3, then=4),
390.                 output_field=models.IntegerField(),
391.             )).order_by('pk'),
392.             [(2, 3), (3, 4), (3, 4)],
393.             transform=attrgetter('integer', 'integer2')
394.         )
395. 
396.     def test_filter_with_expression_as_value(self):
397.         self.assertQuerysetEqual(
398.             CaseTestModel.objects.filter(integer2=Case(
399.                 When(integer=2, then=F('integer') + 1),
400.                 When(integer=3, then=F('integer')),
401.                 default='integer',
402.             )).order_by('pk'),
403.             [(1, 1), (2, 3), (3, 3)],
404.             transform=attrgetter('integer', 'integer2')
405.         )
406. 
407.     def test_filter_with_expression_as_condition(self):
408.         self.assertQuerysetEqual(
409.             CaseTestModel.objects.filter(string=Case(
410.                 When(integer2=F('integer'), then=Value('2')),
411.                 When(integer2=F('integer') + 1, then=Value('3')),
412.                 output_field=models.CharField(),
413.             )).order_by('pk'),
414.             [(3, 4, '3'), (2, 2, '2'), (3, 4, '3')],
415.             transform=attrgetter('integer', 'integer2', 'string')
416.         )
417. 
418.     def test_filter_with_join_in_value(self):
419.         self.assertQuerysetEqual(
420.             CaseTestModel.objects.filter(integer2=Case(
421.                 When(integer=2, then=F('o2o_rel__integer') + 1),
422.                 When(integer=3, then=F('o2o_rel__integer')),
423.                 default='o2o_rel__integer',
424.             )).order_by('pk'),
425.             [(1, 1), (2, 3), (3, 3)],
426.             transform=attrgetter('integer', 'integer2')
427.         )
428. 
429.     def test_filter_with_join_in_condition(self):
430.         self.assertQuerysetEqual(
431.             CaseTestModel.objects.filter(integer=Case(
432.                 When(integer2=F('o2o_rel__integer') + 1, then=2),
433.                 When(integer2=F('o2o_rel__integer'), then=3),
434.                 output_field=models.IntegerField(),
435.             )).order_by('pk'),
436.             [(2, 3), (3, 3)],
437.             transform=attrgetter('integer', 'integer2')
438.         )
439. 
440.     def test_filter_with_join_in_predicate(self):
441.         self.assertQuerysetEqual(
442.             CaseTestModel.objects.filter(integer2=Case(
443.                 When(o2o_rel__integer=1, then=1),
444.                 When(o2o_rel__integer=2, then=3),
445.                 When(o2o_rel__integer=3, then=4),
446.                 output_field=models.IntegerField(),
447.             )).order_by('pk'),
448.             [(1, 1), (2, 3), (3, 4), (3, 4)],
449.             transform=attrgetter('integer', 'integer2')
450.         )
451. 
452.     def test_filter_with_annotation_in_value(self):
453.         self.assertQuerysetEqual(
454.             CaseTestModel.objects.annotate(
455.                 f=F('integer'),
456.                 f_plus_1=F('integer') + 1,
457.             ).filter(
458.                 integer2=Case(
459.                     When(integer=2, then='f_plus_1'),
460.                     When(integer=3, then='f'),
461.                 ),
462.             ).order_by('pk'),
463.             [(2, 3), (3, 3)],
464.             transform=attrgetter('integer', 'integer2')
465.         )
466. 
467.     def test_filter_with_annotation_in_condition(self):
468.         self.assertQuerysetEqual(
469.             CaseTestModel.objects.annotate(
470.                 f_plus_1=F('integer') + 1,
471.             ).filter(
472.                 integer=Case(
473.                     When(integer2=F('integer'), then=2),
474.                     When(integer2=F('f_plus_1'), then=3),
475.                     output_field=models.IntegerField(),
476.                 ),
477.             ).order_by('pk'),
478.             [(3, 4), (2, 2), (3, 4)],
479.             transform=attrgetter('integer', 'integer2')
480.         )
481. 
482.     def test_filter_with_annotation_in_predicate(self):
483.         self.assertQuerysetEqual(
484.             CaseTestModel.objects.annotate(
485.                 f_plus_1=F('integer') + 1,
486.             ).filter(
487.                 integer2=Case(
488.                     When(f_plus_1=3, then=3),
489.                     When(f_plus_1=4, then=4),
490.                     default=1,
491.                     output_field=models.IntegerField(),
492.                 ),
493.             ).order_by('pk'),
494.             [(1, 1), (2, 3), (3, 4), (3, 4)],
495.             transform=attrgetter('integer', 'integer2')
496.         )
497. 
498.     def test_filter_with_aggregation_in_value(self):
499.         self.assertQuerysetEqual(
500.             CaseTestModel.objects.values(*self.non_lob_fields).annotate(

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-23 18:39:31,069 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='The user requested the full content of `tests/aggregation/test_filter_argument.py`.', relative_path='tests/aggregation/test_filter_argument.py', start_line=1, end_line=89), ContextOutput(reasoning='The user requested the full content of `tests/expressions_case/tests.py`.', relative_path='tests/expressions_case/tests.py', start_line=1, end_line=500), ContextOutput(reasoning='The user requested the full content of `tests/aggregation/tests.py`.', relative_path='tests/aggregation/tests.py', start_line=1, end_line=500)]
2025-12-23 18:39:31,075 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 3 contexts to memory for query: Please provide the full content of `tests/aggregation/test_filter_argument.py`, `tests/expressions_case/tests.py`, and `tests/aggregation/tests.py`.
2025-12-23 18:39:31,075 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-23 18:39:31,075 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-23 18:39:31,076 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 3 new contexts to 0 existing contexts
2025-12-23 18:39:31,076 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 3 total contexts (removed 0 duplicates)
2025-12-23 18:39:31,077 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── bin
|   |   └── django-admin.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── bin
|   |   |   |   └── compress.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   ├── options.py
|   |   |   |   └── widgets.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── ar
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── mn
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sv
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── templates
|   |   |   |   ├── sitemap.xml
|   |   |   |   └── sitemap_index.xml
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── memcached.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   └── __init__.py
|   |   |   ├── database.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── utils.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   ├── special.py
|   |   |   |   └── utils.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── topological_sort.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── autoreload.py
|   |   ├── baseconv.py
|   |   ├── cache.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── datetime_safe.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── lru_cache.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── six.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           ├── default_urlconf.html
|           ├── technical_404.html
|           ├── technical_500.html
|           └── technical_500.txt
├── docs
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   ├── genindex.html
|   |   |   ├── layout.html
|   |   |   ├── modindex.html
|   |   |   ├── search.html
|   |   |   └── static
|   |   |       ├── console-tabs.css
|   |   |       ├── default.css
|   |   |       ├── djangodocs.css
|   |   |       ├── fontawesome
|   |   |       ├── homepage.css
|   |   |       └── reset-fonts-grids.css
|   |   └── djangodocs-epub
|   |       ├── epub-cover.html
|   |       └── static
|   |           └── epub.css
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── auth-remote-user.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-tags.txt
|   |   ├── deployment
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── jython.txt
|   |   ├── legacy-databases.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.txt
|   |   ├── index.txt
|   |   └── security.txt
|   └── topics
|       ├── _images
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── RelatedObjectLookups.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   ├── jsi18n-mocks.test.js
|   |   └── timeparse.test.js
|   ├── gis
|   |   └── mapwidget.test.js
|   ├── qunit
|   |   ├── qunit.css
|   |   └── qunit.js
|   └── tests.html
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   └── commands
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       └── noargs_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── admin
    |   |   |   ├── admin_views
    |   |   |   └── base_site.html
    |   |   └── custom_filter_template.html
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_forms.py
    |   ├── test_multidb.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── default_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   └── with_last_login_attr.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   |   ├── auth_attrs_access.html
    |   |   |   ├── auth_attrs_messages.html
    |   |   |   ├── auth_attrs_no_access.html
    |   |   |   ├── auth_attrs_perm_in_perms.html
    |   |   |   ├── auth_attrs_perms.html
    |   |   |   ├── auth_attrs_test_access.html
    |   |   |   └── auth_attrs_user.html
    |   |   └── registration
    |   |       ├── html_password_reset_email.html
    |   |       ├── logged_out.html
    |   |       ├── login.html
    |   |       ├── password_change_form.html
    |   |       ├── password_reset_complete.html
    |   |       ├── password_reset_confirm.html
    |   |       ├── password_reset_done.html
    |   |       ├── password_reset_email.html
    |   |       ├── password_reset_form.html
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_remote_user.py
    |   ├── test_remote_user_deprecation.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── test_base.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_introspection.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   └── commands
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   └── tests.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   └── tests.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_error_handlers.py
    |       ├── beginning_with_slash.py
    |       ├── contains_tuple.py
    |       ├── good_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   └── ending_with_dollar.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── choices
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   |       ├── debug.html
    |   |       └── request_attrs.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_greatest.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_round.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   └── test_postgresql_psycopg2.py
    ├── decorators
    |   ├── __init__.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── fixture2.xml
    |   |   ├── fixture3.xml
    |   |   ├── fixture7.xml
    |   |   └── fixture9.xml
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   |   └── fixture2.xml
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── animal.xml
    |   |   ├── bad_fixture2.xml
    |   |   ├── nk-inheritance2.xml
    |   |   ├── non_natural_2.xml
    |   |   ├── pretty.xml
    |   |   └── sequence_extra_xml.xml
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   |   └── default.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   |       └── custom_widget.html
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   |       ├── article_form.html
    |   |       └── custom_widget.html
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   |       └── using.html
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   ├── about.html
    |   |   |   ├── apple_detail.html
    |   |   |   ├── artist_detail.html
    |   |   |   ├── artist_form.html
    |   |   |   ├── author_confirm_delete.html
    |   |   |   ├── author_detail.html
    |   |   |   ├── author_form.html
    |   |   |   ├── author_list.html
    |   |   |   ├── author_objects.html
    |   |   |   ├── author_view.html
    |   |   |   ├── book_archive.html
    |   |   |   ├── book_archive_day.html
    |   |   |   ├── book_archive_month.html
    |   |   |   ├── book_archive_week.html
    |   |   |   ├── book_archive_year.html
    |   |   |   ├── book_detail.html
    |   |   |   ├── book_list.html
    |   |   |   ├── confirm_delete.html
    |   |   |   ├── detail.html
    |   |   |   ├── form.html
    |   |   |   ├── list.html
    |   |   |   ├── page_template.html
    |   |   |   ├── robots.txt
    |   |   |   └── using.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   └── test_srs.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── admin.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── maps
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   |   └── test_handler.html
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   |   └── ignored.html
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   |   └── media_ignored.html
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   ├── javascript_ignored.js
    |   |   |   └── static_ignored.html
    |   |   └── templates
    |   |       ├── empty.html
    |   |       ├── subdir
    |   |       ├── test.html
    |   |       └── xxx_ignored.html
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── models.py
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   |   ├── 404.html
    |   |   |   └── dummy.html
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   |   └── percents.html
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_introspection.py
    |   ├── test_json.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests
    |   ├── __init__.py
    |   ├── test_data_upload_settings.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   ├── test_file_charset.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   |       └── using.html
    |   ├── templates
    |   |   └── shortcuts
    |   |       ├── render_test.html
    |   |       └── using.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── custom_sitemap.xml
    |   |   └── custom_sitemap_index.xml
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   ├── test_management.py
    |   ├── test_utils.py
    |   └── urls
    |       ├── __init__.py
    |       ├── empty.py
    |       ├── http.py
    |       ├── https.py
    |       └── index_only.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── absolute_root.css
    |   |   |   ├── cached
    |   |   |   ├── styles_root.css
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   |   └── faulty.css
    |   |   ├── loop
    |   |   |   ├── bar.css
    |   |   |   └── foo.css
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   |       ├── description.html
    |   |       ├── description_context.html
    |   |       ├── title.html
    |   |       └── title_context.html
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   |       └── hello.html
    |   ├── jinja2
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       ├── syntax_error.html
    |   |       └── syntax_error2.html
    |   ├── template_strings
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       └── syntax_error.html
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_loader
    |   |       ├── goodbye.html
    |   |       ├── hello.html
    |   |       └── request.html
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   |       └── using.html
    |   ├── other_templates
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   └── test_dirs.html
    |   ├── recursive_templates
    |   |   ├── fs
    |   |   |   ├── extend-missing.html
    |   |   |   ├── one.html
    |   |   |   ├── other-recursive.html
    |   |   |   ├── recursive.html
    |   |   |   ├── self.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── fs2
    |   |   |   └── recursive.html
    |   |   └── fs3
    |   |       └── recursive.html
    |   ├── relative_templates
    |   |   ├── dir1
    |   |   |   ├── dir2
    |   |   |   ├── looped.html
    |   |   |   ├── one.html
    |   |   |   ├── one1.html
    |   |   |   ├── one2.html
    |   |   |   ├── one3.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── error_extends.html
    |   |   ├── error_include.html
    |   |   ├── one.html
    |   |   ├── three.html
    |   |   └── two.html
    |   ├── syntax_tests
    |   |   ├── __init__.py
    |   |   ├── i18n
    |   |   |   ├── __init__.py
    |   |   |   ├── base.py
    |   |   |   ├── test_blocktrans.py
    |   |   |   ├── test_filters.py
    |   |   |   ├── test_get_available_languages.py
    |   |   |   ├── test_get_current_language.py
    |   |   |   ├── test_get_current_language_bidi.py
    |   |   |   ├── test_get_language_info.py
    |   |   |   ├── test_get_language_info_list.py
    |   |   |   ├── test_language.py
    |   |   |   ├── test_trans.py
    |   |   |   └── test_underscore_syntax.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_basic.py
    |   |   ├── test_builtins.py
    |   |   ├── test_cache.py
    |   |   ├── test_comment.py
    |   |   ├── test_cycle.py
    |   |   ├── test_exceptions.py
    |   |   ├── test_extends.py
    |   |   ├── test_filter_syntax.py
    |   |   ├── test_filter_tag.py
    |   |   ├── test_firstof.py
    |   |   ├── test_for.py
    |   |   ├── test_if.py
    |   |   ├── test_if_changed.py
    |   |   ├── test_if_equal.py
    |   |   ├── test_include.py
    |   |   ├── test_invalid_string.py
    |   |   ├── test_list_index.py
    |   |   ├── test_load.py
    |   |   ├── test_lorem.py
    |   |   ├── test_multiline.py
    |   |   ├── test_named_endblock.py
    |   |   ├── test_now.py
    |   |   ├── test_numpy.py
    |   |   ├── test_regroup.py
    |   |   ├── test_resetcycle.py
    |   |   ├── test_setup.py
    |   |   ├── test_simple_tag.py
    |   |   ├── test_spaceless.py
    |   |   ├── test_static.py
    |   |   ├── test_template_tag.py
    |   |   ├── test_url.py
    |   |   ├── test_verbatim.py
    |   |   ├── test_width_ratio.py
    |   |   └── test_with.py
    |   ├── templates
    |   |   ├── 27584_child.html
    |   |   ├── 27584_parent.html
    |   |   ├── 27956_child.html
    |   |   ├── 27956_parent.html
    |   |   ├── broken_base.html
    |   |   ├── first
    |   |   |   └── test.html
    |   |   ├── include_tpl.html
    |   |   ├── included_base.html
    |   |   ├── included_content.html
    |   |   ├── inclusion.html
    |   |   ├── inclusion_base.html
    |   |   ├── inclusion_extends1.html
    |   |   ├── inclusion_extends2.html
    |   |   ├── index.html
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   ├── recursive_include.html
    |   |   ├── response.html
    |   |   ├── second
    |   |   |   └── test.html
    |   |   ├── ssi include with spaces.html
    |   |   ├── ssi_include.html
    |   |   ├── template_tests
    |   |   |   └── using.html
    |   |   ├── test_context.html
    |   |   ├── test_context_stack.html
    |   |   ├── test_extends_error.html
    |   |   ├── test_incl_tag_use_l10n.html
    |   |   └── test_include_error.html
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   ├── bad_tag.py
    |   |   ├── custom.py
    |   |   ├── inclusion.py
    |   |   ├── subpackage
    |   |   |   ├── __init__.py
    |   |   |   └── echo.py
    |   |   ├── tag_27584.py
    |   |   └── testtags.py
    |   ├── test_base.py
    |   ├── test_callables.py
    |   ├── test_context.py
    |   ├── test_custom.py
    |   ├── test_engine.py
    |   ├── test_extends.py
    |   ├── test_extends_relative.py
    |   ├── test_library.py
    |   ├── test_loaders.py
    |   ├── test_logging.py
    |   ├── test_nodelist.py
    |   ├── test_origin.py
    |   ├── test_parser.py
    |   ├── test_response.py
    |   ├── test_smartif.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── utils.py
    |   └── views.py
    ├── templates
    |   ├── base.html
    |   ├── comments
    |   |   └── comment_notification_email.txt
    |   ├── custom_admin
    |   |   ├── add_form.html
    |   |   ├── app_index.html
    |   |   ├── change_form.html
    |   |   ├── change_list.html
    |   |   ├── delete_confirmation.html
    |   |   ├── delete_selected_confirmation.html
    |   |   ├── index.html
    |   |   ├── login.html
    |   |   ├── logout.html
    |   |   ├── object_history.html
    |   |   ├── password_change_done.html
    |   |   ├── password_change_form.html
    |   |   └── popup_response.html
    |   ├── extended.html
    |   ├── form_view.html
    |   ├── login.html
    |   └── views
    |       ├── article_archive_day.html
    |       ├── article_archive_month.html
    |       ├── article_confirm_delete.html
    |       ├── article_detail.html
    |       ├── article_form.html
    |       ├── article_list.html
    |       ├── datearticle_archive_month.html
    |       ├── urlarticle_detail.html
    |       └── urlarticle_form.html
    ├── test_client
    |   ├── __init__.py
    |   ├── auth_backends.py
    |   ├── test_conditional_content_removal.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── test_client_regress
    |   ├── __init__.py
    |   ├── auth_backends.py
    |   ├── bad_templates
    |   |   └── 404.html
    |   ├── context_processors.py
    |   ├── models.py
    |   ├── session.py
    |   ├── templates
    |   |   ├── request_context.html
    |   |   └── unicode.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── test_exceptions
    |   ├── __init__.py
    |   └── test_validation_error.py
    ├── test_runner
    |   ├── __init__.py
    |   ├── models.py
    |   ├── runner.py
    |   ├── test_debug_sql.py
    |   ├── test_discover_runner.py
    |   ├── test_parallel.py
    |   └── tests.py
    ├── test_runner_apps
    |   ├── __init__.py
    |   ├── databases
    |   |   ├── __init__.py
    |   |   └── tests.py
    |   ├── sample
    |   |   ├── __init__.py
    |   |   ├── doctests.py
    |   |   ├── empty.py
    |   |   ├── pattern_tests.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── tests.py
    |   |   └── tests_sample.py
    |   ├── simple
    |   |   ├── __init__.py
    |   |   └── tests.py
    |   └── tagged
    |       ├── __init__.py
    |       ├── tests.py
    |       └── tests_inheritance.py
    ├── test_sqlite.py
    ├── test_utils
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── templates
    |   |   └── template_used
    |   |       ├── alternative.html
    |   |       ├── base.html
    |   |       ├── extends.html
    |   |       └── include.html
    |   ├── test_deprecated_features.py
    |   ├── test_testcase.py
    |   ├── test_transactiontestcase.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── timezones
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── transaction_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── transactions
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── unmanaged_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── update_only_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── urlpatterns
    |   ├── __init__.py
    |   ├── converter_urls.py
    |   ├── converters.py
    |   ├── included_urls.py
    |   ├── more_urls.py
    |   ├── path_base64_urls.py
    |   ├── path_dynamic_urls.py
    |   ├── path_urls.py
    |   ├── test_resolvers.py
    |   ├── tests.py
    |   └── views.py
    ├── urlpatterns_reverse
    |   ├── __init__.py
    |   ├── erroneous_urls.py
    |   ├── extra_urls.py
    |   ├── included_app_urls.py
    |   ├── included_named_urls.py
    |   ├── included_named_urls2.py
    |   ├── included_namespace_urls.py
    |   ├── included_no_kwargs_urls.py
    |   ├── included_urls.py
    |   ├── included_urls2.py
    |   ├── method_view_urls.py
    |   ├── middleware.py
    |   ├── named_urls.py
    |   ├── named_urls_conflict.py
    |   ├── namespace_urls.py
    |   ├── nested_urls.py
    |   ├── no_urls.py
    |   ├── nonimported_module.py
    |   ├── reverse_lazy_urls.py
    |   ├── test_localeregexdescriptor.py
    |   ├── tests.py
    |   ├── translations
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── urlconf_inner.py
    |   ├── urlconf_outer.py
    |   ├── urls.py
    |   ├── urls_error_handlers.py
    |   ├── urls_error_handlers_callables.py
    |   ├── urls_without_handlers.py
    |   ├── utils.py
    |   ├── views.py
    |   └── views_broken.py
    ├── urls.py
    ├── user_commands
    |   ├── __init__.py
    |   ├── eggs
    |   ├── management
    |   |   └── commands
    |   |       ├── common_args.py
    |   |       ├── dance.py
    |   |       ├── hal.py
    |   |       ├── no_translations.py
    |   |       ├── required_option.py
    |   |       ├── reverse_url.py
    |   |       ├── set_option.py
    |   |       ├── subparser.py
    |   |       └── transaction.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── utils_tests
    |   ├── __init__.py
    |   ├── archives
    |   ├── eggs
    |   ├── files
    |   |   ├── strip_tags1.html
    |   |   └── strip_tags2.txt
    |   ├── models.py
    |   ├── test_archive.py
    |   ├── test_autoreload.py
    |   ├── test_baseconv.py
    |   ├── test_crypto.py
    |   ├── test_datastructures.py
    |   ├── test_dateformat.py
    |   ├── test_dateparse.py
    |   ├── test_datetime_safe.py
    |   ├── test_decorators.py
    |   ├── test_duration.py
    |   ├── test_encoding.py
    |   ├── test_feedgenerator.py
    |   ├── test_functional.py
    |   ├── test_hashable.py
    |   ├── test_html.py
    |   ├── test_http.py
    |   ├── test_inspect.py
    |   ├── test_ipv6.py
    |   ├── test_jslex.py
    |   ├── test_lazyobject.py
    |   ├── test_lorem_ipsum.py
    |   ├── test_module
    |   |   ├── __init__.py
    |   |   ├── another_bad_module.py
    |   |   ├── another_good_module.py
    |   |   ├── bad_module.py
    |   |   ├── child_module
    |   |   |   ├── __init__.py
    |   |   |   └── grandchild_module.py
    |   |   └── good_module.py
    |   ├── test_module_loading.py
    |   ├── test_no_submodule.py
    |   ├── test_numberformat.py
    |   ├── test_os_utils.py
    |   ├── test_regex_helper.py
    |   ├── test_safestring.py
    |   ├── test_simplelazyobject.py
    |   ├── test_termcolors.py
    |   ├── test_text.py
    |   ├── test_timesince.py
    |   ├── test_timezone.py
    |   └── test_tree.py
    ├── validation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_custom_messages.py
    |   ├── test_error_messages.py
    |   ├── test_picklable.py
    |   ├── test_unique.py
    |   ├── test_validators.py
    |   └── tests.py
    ├── validators
    |   ├── __init__.py
    |   ├── invalid_urls.txt
    |   ├── tests.py
    |   └── valid_urls.txt
    ├── version
    |   ├── __init__.py
    |   └── tests.py
    ├── view_tests
    |   ├── __init__.py
    |   ├── app0
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── en
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── fr
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── fr
    |   ├── app3
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── es_AR
    |   ├── app4
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── es_AR
    |   ├── app5
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── fr
    |   ├── default_urls.py
    |   ├── generic_urls.py
    |   ├── locale
    |   |   ├── de
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_GB
    |   |   |   └── LC_MESSAGES
    |   |   ├── es
    |   |   |   └── LC_MESSAGES
    |   |   ├── fr
    |   |   |   └── LC_MESSAGES
    |   |   ├── nl
    |   |   |   └── LC_MESSAGES
    |   |   ├── pt
    |   |   |   └── LC_MESSAGES
    |   |   └── ru
    |   |       └── LC_MESSAGES
    |   ├── media
    |   |   ├── %2F.txt
    |   |   ├── file.txt
    |   |   ├── long-line.txt
    |   |   └── subdir
    |   ├── models.py
    |   ├── regression_21530_urls.py
    |   ├── templates
    |   |   ├── debug
    |   |   |   ├── template_error.html
    |   |   |   └── template_exception.html
    |   |   ├── jsi18n-multi-catalogs.html
    |   |   └── jsi18n.html
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   └── debugtags.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_csrf.py
    |   |   ├── test_debug.py
    |   |   ├── test_defaults.py
    |   |   ├── test_i18n.py
    |   |   ├── test_json.py
    |   |   ├── test_specials.py
    |   |   └── test_static.py
    |   ├── urls.py
    |   └── views.py
    └── wsgi
        ├── __init__.py
        ├── tests.py
        ├── urls.py
        └── wsgi.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Query syntax error with condition and distinct combination

Description: Description
	
A Count annotation containing both a Case condition and a distinct=True param produces a query error on Django 2.2 (whatever the db backend). A space is missing at least (... COUNT(DISTINCTCASE WHEN ...).

Patch information:
diff --git a/django/db/models/aggregates.py b/django/db/models/aggregates.py
index ac0b62d0bf..ea88c54b0d 100644
--- a/django/db/models/aggregates.py
+++ b/django/db/models/aggregates.py
@@ -68,7 +68,7 @@ class Aggregate(Func):
         return []
 
     def as_sql(self, compiler, connection, **extra_context):
-        extra_context['distinct'] = 'DISTINCT' if self.distinct else ''
+        extra_context['distinct'] = 'DISTINCT ' if self.distinct else ''
         if self.filter:
             if connection.features.supports_aggregate_filter_clause:
                 filter_sql, filter_params = self.filter.as_sql(compiler, connection)


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `tests/aggregation/test_filter_argument.py`, `tests/expressions_case/tests.py`, and `tests/aggregation/tests.py`.
Extra Requirements: 
Purpose: I need to analyze the content of these files to identify three suitable test cases that match the user's criteria for demonstrating the bug and its fix.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: tests/aggregation/test_filter_argument.py
Line number range: 1 - 89
Content:
1. import datetime
2. from decimal import Decimal
3. 
4. from django.db.models import Case, Count, F, Q, Sum, When
5. from django.test import TestCase
6. 
7. from .models import Author, Book, Publisher
8. 
9. 
10. class FilteredAggregateTests(TestCase):
11.     @classmethod
12.     def setUpTestData(cls):
13.         cls.a1 = Author.objects.create(name='test', age=40)
14.         cls.a2 = Author.objects.create(name='test2', age=60)
15.         cls.a3 = Author.objects.create(name='test3', age=100)
16.         cls.p1 = Publisher.objects.create(name='Apress', num_awards=3, duration=datetime.timedelta(days=1))
17.         cls.b1 = Book.objects.create(
18.             isbn='159059725', name='The Definitive Guide to Django: Web Development Done Right',
19.             pages=447, rating=4.5, price=Decimal('30.00'), contact=cls.a1, publisher=cls.p1,
20.             pubdate=datetime.date(2007, 12, 6),
21.         )
22.         cls.b2 = Book.objects.create(
23.             isbn='067232959', name='Sams Teach Yourself Django in 24 Hours',
24.             pages=528, rating=3.0, price=Decimal('23.09'), contact=cls.a2, publisher=cls.p1,
25.             pubdate=datetime.date(2008, 3, 3),
26.         )
27.         cls.b3 = Book.objects.create(
28.             isbn='159059996', name='Practical Django Projects',
29.             pages=600, rating=4.5, price=Decimal('29.69'), contact=cls.a3, publisher=cls.p1,
30.             pubdate=datetime.date(2008, 6, 23),
31.         )
32.         cls.a1.friends.add(cls.a2)
33.         cls.a1.friends.add(cls.a3)
34.         cls.b1.authors.add(cls.a1)
35.         cls.b1.authors.add(cls.a3)
36.         cls.b2.authors.add(cls.a2)
37.         cls.b3.authors.add(cls.a3)
38. 
39.     def test_filtered_aggregates(self):
40.         agg = Sum('age', filter=Q(name__startswith='test'))
41.         self.assertEqual(Author.objects.aggregate(age=agg)['age'], 200)
42. 
43.     def test_double_filtered_aggregates(self):
44.         agg = Sum('age', filter=Q(Q(name='test2') & ~Q(name='test')))
45.         self.assertEqual(Author.objects.aggregate(age=agg)['age'], 60)
46. 
47.     def test_excluded_aggregates(self):
48.         agg = Sum('age', filter=~Q(name='test2'))
49.         self.assertEqual(Author.objects.aggregate(age=agg)['age'], 140)
50. 
51.     def test_related_aggregates_m2m(self):
52.         agg = Sum('friends__age', filter=~Q(friends__name='test'))
53.         self.assertEqual(Author.objects.filter(name='test').aggregate(age=agg)['age'], 160)
54. 
55.     def test_related_aggregates_m2m_and_fk(self):
56.         q = Q(friends__book__publisher__name='Apress') & ~Q(friends__name='test3')
57.         agg = Sum('friends__book__pages', filter=q)
58.         self.assertEqual(Author.objects.filter(name='test').aggregate(pages=agg)['pages'], 528)
59. 
60.     def test_plain_annotate(self):
61.         agg = Sum('book__pages', filter=Q(book__rating__gt=3))
62.         qs = Author.objects.annotate(pages=agg).order_by('pk')
63.         self.assertSequenceEqual([a.pages for a in qs], [447, None, 1047])
64. 
65.     def test_filtered_aggregate_on_annotate(self):
66.         pages_annotate = Sum('book__pages', filter=Q(book__rating__gt=3))
67.         age_agg = Sum('age', filter=Q(total_pages__gte=400))
68.         aggregated = Author.objects.annotate(total_pages=pages_annotate).aggregate(summed_age=age_agg)
69.         self.assertEqual(aggregated, {'summed_age': 140})
70. 
71.     def test_case_aggregate(self):
72.         agg = Sum(
73.             Case(When(friends__age=40, then=F('friends__age'))),
74.             filter=Q(friends__name__startswith='test'),
75.         )
76.         self.assertEqual(Author.objects.aggregate(age=agg)['age'], 80)
77. 
78.     def test_sum_star_exception(self):
79.         msg = 'Star cannot be used with filter. Please specify a field.'
80.         with self.assertRaisesMessage(ValueError, msg):
81.             Count('*', filter=Q(age=40))
82. 
83.     def test_filtered_reused_subquery(self):
84.         qs = Author.objects.annotate(
85.             older_friends_count=Count('friends', filter=Q(friends__age__gt=F('age'))),
86.         ).filter(
87.             older_friends_count__gte=2,
88.         )
89.         self.assertEqual(qs.get(pk__in=qs.values('pk')), self.a1)


File: tests/aggregation/tests.py
Line number range: 1 - 500
Content:
1. import datetime
2. import re
3. from decimal import Decimal
4. 
5. from django.core.exceptions import FieldError
6. from django.db import connection
7. from django.db.models import (
8.     Avg, Count, DecimalField, DurationField, F, FloatField, Func, IntegerField,
9.     Max, Min, Sum, Value,
10. )
11. from django.test import TestCase
12. from django.test.utils import Approximate, CaptureQueriesContext
13. from django.utils import timezone
14. 
15. from .models import Author, Book, Publisher, Store
16. 
17. 
18. class AggregateTestCase(TestCase):
19. 
20.     @classmethod
21.     def setUpTestData(cls):
22.         cls.a1 = Author.objects.create(name='Adrian Holovaty', age=34)
23.         cls.a2 = Author.objects.create(name='Jacob Kaplan-Moss', age=35)
24.         cls.a3 = Author.objects.create(name='Brad Dayley', age=45)
25.         cls.a4 = Author.objects.create(name='James Bennett', age=29)
26.         cls.a5 = Author.objects.create(name='Jeffrey Forcier', age=37)
27.         cls.a6 = Author.objects.create(name='Paul Bissex', age=29)
28.         cls.a7 = Author.objects.create(name='Wesley J. Chun', age=25)
29.         cls.a8 = Author.objects.create(name='Peter Norvig', age=57)
30.         cls.a9 = Author.objects.create(name='Stuart Russell', age=46)
31.         cls.a1.friends.add(cls.a2, cls.a4)
32.         cls.a2.friends.add(cls.a1, cls.a7)
33.         cls.a4.friends.add(cls.a1)
34.         cls.a5.friends.add(cls.a6, cls.a7)
35.         cls.a6.friends.add(cls.a5, cls.a7)
36.         cls.a7.friends.add(cls.a2, cls.a5, cls.a6)
37.         cls.a8.friends.add(cls.a9)
38.         cls.a9.friends.add(cls.a8)
39. 
40.         cls.p1 = Publisher.objects.create(name='Apress', num_awards=3, duration=datetime.timedelta(days=1))
41.         cls.p2 = Publisher.objects.create(name='Sams', num_awards=1, duration=datetime.timedelta(days=2))
42.         cls.p3 = Publisher.objects.create(name='Prentice Hall', num_awards=7)
43.         cls.p4 = Publisher.objects.create(name='Morgan Kaufmann', num_awards=9)
44.         cls.p5 = Publisher.objects.create(name="Jonno's House of Books", num_awards=0)
45. 
46.         cls.b1 = Book.objects.create(
47.             isbn='159059725', name='The Definitive Guide to Django: Web Development Done Right',
48.             pages=447, rating=4.5, price=Decimal('30.00'), contact=cls.a1, publisher=cls.p1,
49.             pubdate=datetime.date(2007, 12, 6)
50.         )
51.         cls.b2 = Book.objects.create(
52.             isbn='067232959', name='Sams Teach Yourself Django in 24 Hours',
53.             pages=528, rating=3.0, price=Decimal('23.09'), contact=cls.a3, publisher=cls.p2,
54.             pubdate=datetime.date(2008, 3, 3)
55.         )
56.         cls.b3 = Book.objects.create(
57.             isbn='159059996', name='Practical Django Projects',
58.             pages=300, rating=4.0, price=Decimal('29.69'), contact=cls.a4, publisher=cls.p1,
59.             pubdate=datetime.date(2008, 6, 23)
60.         )
61.         cls.b4 = Book.objects.create(
62.             isbn='013235613', name='Python Web Development with Django',
63.             pages=350, rating=4.0, price=Decimal('29.69'), contact=cls.a5, publisher=cls.p3,
64.             pubdate=datetime.date(2008, 11, 3)
65.         )
66.         cls.b5 = Book.objects.create(
67.             isbn='013790395', name='Artificial Intelligence: A Modern Approach',
68.             pages=1132, rating=4.0, price=Decimal('82.80'), contact=cls.a8, publisher=cls.p3,
69.             pubdate=datetime.date(1995, 1, 15)
70.         )
71.         cls.b6 = Book.objects.create(
72.             isbn='155860191', name='Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp',
73.             pages=946, rating=5.0, price=Decimal('75.00'), contact=cls.a8, publisher=cls.p4,
74.             pubdate=datetime.date(1991, 10, 15)
75.         )
76.         cls.b1.authors.add(cls.a1, cls.a2)
77.         cls.b2.authors.add(cls.a3)
78.         cls.b3.authors.add(cls.a4)
79.         cls.b4.authors.add(cls.a5, cls.a6, cls.a7)
80.         cls.b5.authors.add(cls.a8, cls.a9)
81.         cls.b6.authors.add(cls.a8)
82. 
83.         s1 = Store.objects.create(
84.             name='Amazon.com',
85.             original_opening=datetime.datetime(1994, 4, 23, 9, 17, 42),
86.             friday_night_closing=datetime.time(23, 59, 59)
87.         )
88.         s2 = Store.objects.create(
89.             name='Books.com',
90.             original_opening=datetime.datetime(2001, 3, 15, 11, 23, 37),
91.             friday_night_closing=datetime.time(23, 59, 59)
92.         )
93.         s3 = Store.objects.create(
94.             name="Mamma and Pappa's Books",
95.             original_opening=datetime.datetime(1945, 4, 25, 16, 24, 14),
96.             friday_night_closing=datetime.time(21, 30)
97.         )
98.         s1.books.add(cls.b1, cls.b2, cls.b3, cls.b4, cls.b5, cls.b6)
99.         s2.books.add(cls.b1, cls.b3, cls.b5, cls.b6)
100.         s3.books.add(cls.b3, cls.b4, cls.b6)
101. 
102.     def test_empty_aggregate(self):
103.         self.assertEqual(Author.objects.all().aggregate(), {})
104. 
105.     def test_aggregate_in_order_by(self):
106.         msg = (
107.             'Using an aggregate in order_by() without also including it in '
108.             'annotate() is not allowed: Avg(F(book__rating)'
109.         )
110.         with self.assertRaisesMessage(FieldError, msg):
111.             Author.objects.values('age').order_by(Avg('book__rating'))
112. 
113.     def test_single_aggregate(self):
114.         vals = Author.objects.aggregate(Avg("age"))
115.         self.assertEqual(vals, {"age__avg": Approximate(37.4, places=1)})
116. 
117.     def test_multiple_aggregates(self):
118.         vals = Author.objects.aggregate(Sum("age"), Avg("age"))
119.         self.assertEqual(vals, {"age__sum": 337, "age__avg": Approximate(37.4, places=1)})
120. 
121.     def test_filter_aggregate(self):
122.         vals = Author.objects.filter(age__gt=29).aggregate(Sum("age"))
123.         self.assertEqual(vals, {'age__sum': 254})
124. 
125.     def test_related_aggregate(self):
126.         vals = Author.objects.aggregate(Avg("friends__age"))
127.         self.assertEqual(vals, {'friends__age__avg': Approximate(34.07, places=2)})
128. 
129.         vals = Book.objects.filter(rating__lt=4.5).aggregate(Avg("authors__age"))
130.         self.assertEqual(vals, {'authors__age__avg': Approximate(38.2857, places=2)})
131. 
132.         vals = Author.objects.all().filter(name__contains="a").aggregate(Avg("book__rating"))
133.         self.assertEqual(vals, {'book__rating__avg': 4.0})
134. 
135.         vals = Book.objects.aggregate(Sum("publisher__num_awards"))
136.         self.assertEqual(vals, {'publisher__num_awards__sum': 30})
137. 
138.         vals = Publisher.objects.aggregate(Sum("book__price"))
139.         self.assertEqual(vals, {'book__price__sum': Decimal('270.27')})
140. 
141.     def test_aggregate_multi_join(self):
142.         vals = Store.objects.aggregate(Max("books__authors__age"))
143.         self.assertEqual(vals, {'books__authors__age__max': 57})
144. 
145.         vals = Author.objects.aggregate(Min("book__publisher__num_awards"))
146.         self.assertEqual(vals, {'book__publisher__num_awards__min': 1})
147. 
148.     def test_aggregate_alias(self):
149.         vals = Store.objects.filter(name="Amazon.com").aggregate(amazon_mean=Avg("books__rating"))
150.         self.assertEqual(vals, {'amazon_mean': Approximate(4.08, places=2)})
151. 
152.     def test_annotate_basic(self):
153.         self.assertQuerysetEqual(
154.             Book.objects.annotate().order_by('pk'), [
155.                 "The Definitive Guide to Django: Web Development Done Right",
156.                 "Sams Teach Yourself Django in 24 Hours",
157.                 "Practical Django Projects",
158.                 "Python Web Development with Django",
159.                 "Artificial Intelligence: A Modern Approach",
160.                 "Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp"
161.             ],
162.             lambda b: b.name
163.         )
164. 
165.         books = Book.objects.annotate(mean_age=Avg("authors__age"))
166.         b = books.get(pk=self.b1.pk)
167.         self.assertEqual(
168.             b.name,
169.             'The Definitive Guide to Django: Web Development Done Right'
170.         )
171.         self.assertEqual(b.mean_age, 34.5)
172. 
173.     def test_annotate_defer(self):
174.         qs = Book.objects.annotate(
175.             page_sum=Sum("pages")).defer('name').filter(pk=self.b1.pk)
176. 
177.         rows = [
178.             (self.b1.id, "159059725", 447, "The Definitive Guide to Django: Web Development Done Right")
179.         ]
180.         self.assertQuerysetEqual(
181.             qs.order_by('pk'), rows,
182.             lambda r: (r.id, r.isbn, r.page_sum, r.name)
183.         )
184. 
185.     def test_annotate_defer_select_related(self):
186.         qs = Book.objects.select_related('contact').annotate(
187.             page_sum=Sum("pages")).defer('name').filter(pk=self.b1.pk)
188. 
189.         rows = [
190.             (self.b1.id, "159059725", 447, "Adrian Holovaty",
191.              "The Definitive Guide to Django: Web Development Done Right")
192.         ]
193.         self.assertQuerysetEqual(
194.             qs.order_by('pk'), rows,
195.             lambda r: (r.id, r.isbn, r.page_sum, r.contact.name, r.name)
196.         )
197. 
198.     def test_annotate_m2m(self):
199.         books = Book.objects.filter(rating__lt=4.5).annotate(Avg("authors__age")).order_by("name")
200.         self.assertQuerysetEqual(
201.             books, [
202.                 ('Artificial Intelligence: A Modern Approach', 51.5),
203.                 ('Practical Django Projects', 29.0),
204.                 ('Python Web Development with Django', Approximate(30.3, places=1)),
205.                 ('Sams Teach Yourself Django in 24 Hours', 45.0)
206.             ],
207.             lambda b: (b.name, b.authors__age__avg),
208.         )
209. 
210.         books = Book.objects.annotate(num_authors=Count("authors")).order_by("name")
211.         self.assertQuerysetEqual(
212.             books, [
213.                 ('Artificial Intelligence: A Modern Approach', 2),
214.                 ('Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp', 1),
215.                 ('Practical Django Projects', 1),
216.                 ('Python Web Development with Django', 3),
217.                 ('Sams Teach Yourself Django in 24 Hours', 1),
218.                 ('The Definitive Guide to Django: Web Development Done Right', 2)
219.             ],
220.             lambda b: (b.name, b.num_authors)
221.         )
222. 
223.     def test_backwards_m2m_annotate(self):
224.         authors = Author.objects.filter(name__contains="a").annotate(Avg("book__rating")).order_by("name")
225.         self.assertQuerysetEqual(
226.             authors, [
227.                 ('Adrian Holovaty', 4.5),
228.                 ('Brad Dayley', 3.0),
229.                 ('Jacob Kaplan-Moss', 4.5),
230.                 ('James Bennett', 4.0),
231.                 ('Paul Bissex', 4.0),
232.                 ('Stuart Russell', 4.0)
233.             ],
234.             lambda a: (a.name, a.book__rating__avg)
235.         )
236. 
237.         authors = Author.objects.annotate(num_books=Count("book")).order_by("name")
238.         self.assertQuerysetEqual(
239.             authors, [
240.                 ('Adrian Holovaty', 1),
241.                 ('Brad Dayley', 1),
242.                 ('Jacob Kaplan-Moss', 1),
243.                 ('James Bennett', 1),
244.                 ('Jeffrey Forcier', 1),
245.                 ('Paul Bissex', 1),
246.                 ('Peter Norvig', 2),
247.                 ('Stuart Russell', 1),
248.                 ('Wesley J. Chun', 1)
249.             ],
250.             lambda a: (a.name, a.num_books)
251.         )
252. 
253.     def test_reverse_fkey_annotate(self):
254.         books = Book.objects.annotate(Sum("publisher__num_awards")).order_by("name")
255.         self.assertQuerysetEqual(
256.             books, [
257.                 ('Artificial Intelligence: A Modern Approach', 7),
258.                 ('Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp', 9),
259.                 ('Practical Django Projects', 3),
260.                 ('Python Web Development with Django', 7),
261.                 ('Sams Teach Yourself Django in 24 Hours', 1),
262.                 ('The Definitive Guide to Django: Web Development Done Right', 3)
263.             ],
264.             lambda b: (b.name, b.publisher__num_awards__sum)
265.         )
266. 
267.         publishers = Publisher.objects.annotate(Sum("book__price")).order_by("name")
268.         self.assertQuerysetEqual(
269.             publishers, [
270.                 ('Apress', Decimal("59.69")),
271.                 ("Jonno's House of Books", None),
272.                 ('Morgan Kaufmann', Decimal("75.00")),
273.                 ('Prentice Hall', Decimal("112.49")),
274.                 ('Sams', Decimal("23.09"))
275.             ],
276.             lambda p: (p.name, p.book__price__sum)
277.         )
278. 
279.     def test_annotate_values(self):
280.         books = list(Book.objects.filter(pk=self.b1.pk).annotate(mean_age=Avg("authors__age")).values())
281.         self.assertEqual(
282.             books, [
283.                 {
284.                     "contact_id": self.a1.id,
285.                     "id": self.b1.id,
286.                     "isbn": "159059725",
287.                     "mean_age": 34.5,
288.                     "name": "The Definitive Guide to Django: Web Development Done Right",
289.                     "pages": 447,
290.                     "price": Approximate(Decimal("30")),
291.                     "pubdate": datetime.date(2007, 12, 6),
292.                     "publisher_id": self.p1.id,
293.                     "rating": 4.5,
294.                 }
295.             ]
296.         )
297. 
298.         books = (
299.             Book.objects
300.             .filter(pk=self.b1.pk)
301.             .annotate(mean_age=Avg('authors__age'))
302.             .values('pk', 'isbn', 'mean_age')
303.         )
304.         self.assertEqual(
305.             list(books), [
306.                 {
307.                     "pk": self.b1.pk,
308.                     "isbn": "159059725",
309.                     "mean_age": 34.5,
310.                 }
311.             ]
312.         )
313. 
314.         books = Book.objects.filter(pk=self.b1.pk).annotate(mean_age=Avg("authors__age")).values("name")
315.         self.assertEqual(
316.             list(books),
317.             [{'name': 'The Definitive Guide to Django: Web Development Done Right'}],
318.         )
319. 
320.         books = Book.objects.filter(pk=self.b1.pk).values().annotate(mean_age=Avg('authors__age'))
321.         self.assertEqual(
322.             list(books), [
323.                 {
324.                     "contact_id": self.a1.id,
325.                     "id": self.b1.id,
326.                     "isbn": "159059725",
327.                     "mean_age": 34.5,
328.                     "name": "The Definitive Guide to Django: Web Development Done Right",
329.                     "pages": 447,
330.                     "price": Approximate(Decimal("30")),
331.                     "pubdate": datetime.date(2007, 12, 6),
332.                     "publisher_id": self.p1.id,
333.                     "rating": 4.5,
334.                 }
335.             ]
336.         )
337. 
338.         books = (
339.             Book.objects
340.             .values("rating")
341.             .annotate(n_authors=Count("authors__id"), mean_age=Avg("authors__age"))
342.             .order_by("rating")
343.         )
344.         self.assertEqual(
345.             list(books), [
346.                 {
347.                     "rating": 3.0,
348.                     "n_authors": 1,
349.                     "mean_age": 45.0,
350.                 },
351.                 {
352.                     "rating": 4.0,
353.                     "n_authors": 6,
354.                     "mean_age": Approximate(37.16, places=1)
355.                 },
356.                 {
357.                     "rating": 4.5,
358.                     "n_authors": 2,
359.                     "mean_age": 34.5,
360.                 },
361.                 {
362.                     "rating": 5.0,
363.                     "n_authors": 1,
364.                     "mean_age": 57.0,
365.                 }
366.             ]
367.         )
368. 
369.         authors = Author.objects.annotate(Avg("friends__age")).order_by("name")
370.         self.assertQuerysetEqual(
371.             authors, [
372.                 ('Adrian Holovaty', 32.0),
373.                 ('Brad Dayley', None),
374.                 ('Jacob Kaplan-Moss', 29.5),
375.                 ('James Bennett', 34.0),
376.                 ('Jeffrey Forcier', 27.0),
377.                 ('Paul Bissex', 31.0),
378.                 ('Peter Norvig', 46.0),
379.                 ('Stuart Russell', 57.0),
380.                 ('Wesley J. Chun', Approximate(33.66, places=1))
381.             ],
382.             lambda a: (a.name, a.friends__age__avg)
383.         )
384. 
385.     def test_count(self):
386.         vals = Book.objects.aggregate(Count("rating"))
387.         self.assertEqual(vals, {"rating__count": 6})
388. 
389.         vals = Book.objects.aggregate(Count("rating", distinct=True))
390.         self.assertEqual(vals, {"rating__count": 4})
391. 
392.     def test_count_star(self):
393.         with self.assertNumQueries(1) as ctx:
394.             Book.objects.aggregate(n=Count("*"))
395.         sql = ctx.captured_queries[0]['sql']
396.         self.assertIn('SELECT COUNT(*) ', sql)
397. 
398.     def test_non_grouped_annotation_not_in_group_by(self):
399.         """
400.         An annotation not included in values() before an aggregate should be
401.         excluded from the group by clause.
402.         """
403.         qs = (
404.             Book.objects.annotate(xprice=F('price')).filter(rating=4.0).values('rating')
405.                 .annotate(count=Count('publisher_id', distinct=True)).values('count', 'rating').order_by('count')
406.         )
407.         self.assertEqual(list(qs), [{'rating': 4.0, 'count': 2}])
408. 
409.     def test_grouped_annotation_in_group_by(self):
410.         """
411.         An annotation included in values() before an aggregate should be
412.         included in the group by clause.
413.         """
414.         qs = (
415.             Book.objects.annotate(xprice=F('price')).filter(rating=4.0).values('rating', 'xprice')
416.                 .annotate(count=Count('publisher_id', distinct=True)).values('count', 'rating').order_by('count')
417.         )
418.         self.assertEqual(
419.             list(qs), [
420.                 {'rating': 4.0, 'count': 1},
421.                 {'rating': 4.0, 'count': 2},
422.             ]
423.         )
424. 
425.     def test_fkey_aggregate(self):
426.         explicit = list(Author.objects.annotate(Count('book__id')))
427.         implicit = list(Author.objects.annotate(Count('book')))
428.         self.assertEqual(explicit, implicit)
429. 
430.     def test_annotate_ordering(self):
431.         books = Book.objects.values('rating').annotate(oldest=Max('authors__age')).order_by('oldest', 'rating')
432.         self.assertEqual(
433.             list(books), [
434.                 {'rating': 4.5, 'oldest': 35},
435.                 {'rating': 3.0, 'oldest': 45},
436.                 {'rating': 4.0, 'oldest': 57},
437.                 {'rating': 5.0, 'oldest': 57},
438.             ]
439.         )
440. 
441.         books = Book.objects.values("rating").annotate(oldest=Max("authors__age")).order_by("-oldest", "-rating")
442.         self.assertEqual(
443.             list(books), [
444.                 {'rating': 5.0, 'oldest': 57},
445.                 {'rating': 4.0, 'oldest': 57},
446.                 {'rating': 3.0, 'oldest': 45},
447.                 {'rating': 4.5, 'oldest': 35},
448.             ]
449.         )
450. 
451.     def test_aggregate_annotation(self):
452.         vals = Book.objects.annotate(num_authors=Count("authors__id")).aggregate(Avg("num_authors"))
453.         self.assertEqual(vals, {"num_authors__avg": Approximate(1.66, places=1)})
454. 
455.     def test_avg_duration_field(self):
456.         # Explicit `output_field`.
457.         self.assertEqual(
458.             Publisher.objects.aggregate(Avg('duration', output_field=DurationField())),
459.             {'duration__avg': datetime.timedelta(days=1, hours=12)}
460.         )
461.         # Implicit `output_field`.
462.         self.assertEqual(
463.             Publisher.objects.aggregate(Avg('duration')),
464.             {'duration__avg': datetime.timedelta(days=1, hours=12)}
465.         )
466. 
467.     def test_sum_duration_field(self):
468.         self.assertEqual(
469.             Publisher.objects.aggregate(Sum('duration', output_field=DurationField())),
470.             {'duration__sum': datetime.timedelta(days=3)}
471.         )
472. 
473.     def test_sum_distinct_aggregate(self):
474.         """
475.         Sum on a distinct() QuerySet should aggregate only the distinct items.
476.         """
477.         authors = Author.objects.filter(book__in=[self.b5, self.b6])
478.         self.assertEqual(authors.count(), 3)
479. 
480.         distinct_authors = authors.distinct()
481.         self.assertEqual(distinct_authors.count(), 2)
482. 
483.         # Selected author ages are 57 and 46
484.         age_sum = distinct_authors.aggregate(Sum('age'))
485.         self.assertEqual(age_sum['age__sum'], 103)
486. 
487.     def test_filtering(self):
488.         p = Publisher.objects.create(name='Expensive Publisher', num_awards=0)
489.         Book.objects.create(
490.             name='ExpensiveBook1',
491.             pages=1,
492.             isbn='111',
493.             rating=3.5,
494.             price=Decimal("1000"),
495.             publisher=p,
496.             contact_id=self.a1.id,
497.             pubdate=datetime.date(2008, 12, 1)
498.         )
499.         Book.objects.create(
500.             name='ExpensiveBook2',


File: tests/expressions_case/tests.py
Line number range: 1 - 500
Content:
1. import unittest
2. from datetime import date, datetime, time, timedelta
3. from decimal import Decimal
4. from operator import attrgetter, itemgetter
5. from uuid import UUID
6. 
7. from django.core.exceptions import FieldError
8. from django.db import models
9. from django.db.models import F, Max, Min, Q, Sum, Value
10. from django.db.models.expressions import Case, When
11. from django.test import SimpleTestCase, TestCase
12. 
13. from .models import CaseTestModel, Client, FKCaseTestModel, O2OCaseTestModel
14. 
15. try:
16.     from PIL import Image
17. except ImportError:
18.     Image = None
19. 
20. 
21. class CaseExpressionTests(TestCase):
22.     @classmethod
23.     def setUpTestData(cls):
24.         o = CaseTestModel.objects.create(integer=1, integer2=1, string='1')
25.         O2OCaseTestModel.objects.create(o2o=o, integer=1)
26.         FKCaseTestModel.objects.create(fk=o, integer=1)
27. 
28.         o = CaseTestModel.objects.create(integer=2, integer2=3, string='2')
29.         O2OCaseTestModel.objects.create(o2o=o, integer=2)
30.         FKCaseTestModel.objects.create(fk=o, integer=2)
31.         FKCaseTestModel.objects.create(fk=o, integer=3)
32. 
33.         o = CaseTestModel.objects.create(integer=3, integer2=4, string='3')
34.         O2OCaseTestModel.objects.create(o2o=o, integer=3)
35.         FKCaseTestModel.objects.create(fk=o, integer=3)
36.         FKCaseTestModel.objects.create(fk=o, integer=4)
37. 
38.         o = CaseTestModel.objects.create(integer=2, integer2=2, string='2')
39.         O2OCaseTestModel.objects.create(o2o=o, integer=2)
40.         FKCaseTestModel.objects.create(fk=o, integer=2)
41.         FKCaseTestModel.objects.create(fk=o, integer=3)
42. 
43.         o = CaseTestModel.objects.create(integer=3, integer2=4, string='3')
44.         O2OCaseTestModel.objects.create(o2o=o, integer=3)
45.         FKCaseTestModel.objects.create(fk=o, integer=3)
46.         FKCaseTestModel.objects.create(fk=o, integer=4)
47. 
48.         o = CaseTestModel.objects.create(integer=3, integer2=3, string='3')
49.         O2OCaseTestModel.objects.create(o2o=o, integer=3)
50.         FKCaseTestModel.objects.create(fk=o, integer=3)
51.         FKCaseTestModel.objects.create(fk=o, integer=4)
52. 
53.         o = CaseTestModel.objects.create(integer=4, integer2=5, string='4')
54.         O2OCaseTestModel.objects.create(o2o=o, integer=1)
55.         FKCaseTestModel.objects.create(fk=o, integer=5)
56. 
57.         # GROUP BY on Oracle fails with TextField/BinaryField; see #24096.
58.         cls.non_lob_fields = [
59.             f.name for f in CaseTestModel._meta.get_fields()
60.             if not (f.is_relation and f.auto_created) and not isinstance(f, (models.BinaryField, models.TextField))
61.         ]
62. 
63.     def test_annotate(self):
64.         self.assertQuerysetEqual(
65.             CaseTestModel.objects.annotate(test=Case(
66.                 When(integer=1, then=Value('one')),
67.                 When(integer=2, then=Value('two')),
68.                 default=Value('other'),
69.                 output_field=models.CharField(),
70.             )).order_by('pk'),
71.             [(1, 'one'), (2, 'two'), (3, 'other'), (2, 'two'), (3, 'other'), (3, 'other'), (4, 'other')],
72.             transform=attrgetter('integer', 'test')
73.         )
74. 
75.     def test_annotate_without_default(self):
76.         self.assertQuerysetEqual(
77.             CaseTestModel.objects.annotate(test=Case(
78.                 When(integer=1, then=1),
79.                 When(integer=2, then=2),
80.                 output_field=models.IntegerField(),
81.             )).order_by('pk'),
82.             [(1, 1), (2, 2), (3, None), (2, 2), (3, None), (3, None), (4, None)],
83.             transform=attrgetter('integer', 'test')
84.         )
85. 
86.     def test_annotate_with_expression_as_value(self):
87.         self.assertQuerysetEqual(
88.             CaseTestModel.objects.annotate(f_test=Case(
89.                 When(integer=1, then=F('integer') + 1),
90.                 When(integer=2, then=F('integer') + 3),
91.                 default='integer',
92.             )).order_by('pk'),
93.             [(1, 2), (2, 5), (3, 3), (2, 5), (3, 3), (3, 3), (4, 4)],
94.             transform=attrgetter('integer', 'f_test')
95.         )
96. 
97.     def test_annotate_with_expression_as_condition(self):
98.         self.assertQuerysetEqual(
99.             CaseTestModel.objects.annotate(f_test=Case(
100.                 When(integer2=F('integer'), then=Value('equal')),
101.                 When(integer2=F('integer') + 1, then=Value('+1')),
102.                 output_field=models.CharField(),
103.             )).order_by('pk'),
104.             [(1, 'equal'), (2, '+1'), (3, '+1'), (2, 'equal'), (3, '+1'), (3, 'equal'), (4, '+1')],
105.             transform=attrgetter('integer', 'f_test')
106.         )
107. 
108.     def test_annotate_with_join_in_value(self):
109.         self.assertQuerysetEqual(
110.             CaseTestModel.objects.annotate(join_test=Case(
111.                 When(integer=1, then=F('o2o_rel__integer') + 1),
112.                 When(integer=2, then=F('o2o_rel__integer') + 3),
113.                 default='o2o_rel__integer',
114.             )).order_by('pk'),
115.             [(1, 2), (2, 5), (3, 3), (2, 5), (3, 3), (3, 3), (4, 1)],
116.             transform=attrgetter('integer', 'join_test')
117.         )
118. 
119.     def test_annotate_with_in_clause(self):
120.         fk_rels = FKCaseTestModel.objects.filter(integer__in=[5])
121.         self.assertQuerysetEqual(
122.             CaseTestModel.objects.only('pk', 'integer').annotate(in_test=Sum(Case(
123.                 When(fk_rel__in=fk_rels, then=F('fk_rel__integer')),
124.                 default=Value(0),
125.             ))).order_by('pk'),
126.             [(1, 0), (2, 0), (3, 0), (2, 0), (3, 0), (3, 0), (4, 5)],
127.             transform=attrgetter('integer', 'in_test')
128.         )
129. 
130.     def test_annotate_with_join_in_condition(self):
131.         self.assertQuerysetEqual(
132.             CaseTestModel.objects.annotate(join_test=Case(
133.                 When(integer2=F('o2o_rel__integer'), then=Value('equal')),
134.                 When(integer2=F('o2o_rel__integer') + 1, then=Value('+1')),
135.                 default=Value('other'),
136.                 output_field=models.CharField(),
137.             )).order_by('pk'),
138.             [(1, 'equal'), (2, '+1'), (3, '+1'), (2, 'equal'), (3, '+1'), (3, 'equal'), (4, 'other')],
139.             transform=attrgetter('integer', 'join_test')
140.         )
141. 
142.     def test_annotate_with_join_in_predicate(self):
143.         self.assertQuerysetEqual(
144.             CaseTestModel.objects.annotate(join_test=Case(
145.                 When(o2o_rel__integer=1, then=Value('one')),
146.                 When(o2o_rel__integer=2, then=Value('two')),
147.                 When(o2o_rel__integer=3, then=Value('three')),
148.                 default=Value('other'),
149.                 output_field=models.CharField(),
150.             )).order_by('pk'),
151.             [(1, 'one'), (2, 'two'), (3, 'three'), (2, 'two'), (3, 'three'), (3, 'three'), (4, 'one')],
152.             transform=attrgetter('integer', 'join_test')
153.         )
154. 
155.     def test_annotate_with_annotation_in_value(self):
156.         self.assertQuerysetEqual(
157.             CaseTestModel.objects.annotate(
158.                 f_plus_1=F('integer') + 1,
159.                 f_plus_3=F('integer') + 3,
160.             ).annotate(
161.                 f_test=Case(
162.                     When(integer=1, then='f_plus_1'),
163.                     When(integer=2, then='f_plus_3'),
164.                     default='integer',
165.                 ),
166.             ).order_by('pk'),
167.             [(1, 2), (2, 5), (3, 3), (2, 5), (3, 3), (3, 3), (4, 4)],
168.             transform=attrgetter('integer', 'f_test')
169.         )
170. 
171.     def test_annotate_with_annotation_in_condition(self):
172.         self.assertQuerysetEqual(
173.             CaseTestModel.objects.annotate(
174.                 f_plus_1=F('integer') + 1,
175.             ).annotate(
176.                 f_test=Case(
177.                     When(integer2=F('integer'), then=Value('equal')),
178.                     When(integer2=F('f_plus_1'), then=Value('+1')),
179.                     output_field=models.CharField(),
180.                 ),
181.             ).order_by('pk'),
182.             [(1, 'equal'), (2, '+1'), (3, '+1'), (2, 'equal'), (3, '+1'), (3, 'equal'), (4, '+1')],
183.             transform=attrgetter('integer', 'f_test')
184.         )
185. 
186.     def test_annotate_with_annotation_in_predicate(self):
187.         self.assertQuerysetEqual(
188.             CaseTestModel.objects.annotate(
189.                 f_minus_2=F('integer') - 2,
190.             ).annotate(
191.                 test=Case(
192.                     When(f_minus_2=-1, then=Value('negative one')),
193.                     When(f_minus_2=0, then=Value('zero')),
194.                     When(f_minus_2=1, then=Value('one')),
195.                     default=Value('other'),
196.                     output_field=models.CharField(),
197.                 ),
198.             ).order_by('pk'),
199.             [(1, 'negative one'), (2, 'zero'), (3, 'one'), (2, 'zero'), (3, 'one'), (3, 'one'), (4, 'other')],
200.             transform=attrgetter('integer', 'test')
201.         )
202. 
203.     def test_annotate_with_aggregation_in_value(self):
204.         self.assertQuerysetEqual(
205.             CaseTestModel.objects.values(*self.non_lob_fields).annotate(
206.                 min=Min('fk_rel__integer'),
207.                 max=Max('fk_rel__integer'),
208.             ).annotate(
209.                 test=Case(
210.                     When(integer=2, then='min'),
211.                     When(integer=3, then='max'),
212.                 ),
213.             ).order_by('pk'),
214.             [(1, None, 1, 1), (2, 2, 2, 3), (3, 4, 3, 4), (2, 2, 2, 3), (3, 4, 3, 4), (3, 4, 3, 4), (4, None, 5, 5)],
215.             transform=itemgetter('integer', 'test', 'min', 'max')
216.         )
217. 
218.     def test_annotate_with_aggregation_in_condition(self):
219.         self.assertQuerysetEqual(
220.             CaseTestModel.objects.values(*self.non_lob_fields).annotate(
221.                 min=Min('fk_rel__integer'),
222.                 max=Max('fk_rel__integer'),
223.             ).annotate(
224.                 test=Case(
225.                     When(integer2=F('min'), then=Value('min')),
226.                     When(integer2=F('max'), then=Value('max')),
227.                     output_field=models.CharField(),
228.                 ),
229.             ).order_by('pk'),
230.             [(1, 1, 'min'), (2, 3, 'max'), (3, 4, 'max'), (2, 2, 'min'), (3, 4, 'max'), (3, 3, 'min'), (4, 5, 'min')],
231.             transform=itemgetter('integer', 'integer2', 'test')
232.         )
233. 
234.     def test_annotate_with_aggregation_in_predicate(self):
235.         self.assertQuerysetEqual(
236.             CaseTestModel.objects.values(*self.non_lob_fields).annotate(
237.                 max=Max('fk_rel__integer'),
238.             ).annotate(
239.                 test=Case(
240.                     When(max=3, then=Value('max = 3')),
241.                     When(max=4, then=Value('max = 4')),
242.                     default=Value(''),
243.                     output_field=models.CharField(),
244.                 ),
245.             ).order_by('pk'),
246.             [(1, 1, ''), (2, 3, 'max = 3'), (3, 4, 'max = 4'), (2, 3, 'max = 3'),
247.              (3, 4, 'max = 4'), (3, 4, 'max = 4'), (4, 5, '')],
248.             transform=itemgetter('integer', 'max', 'test')
249.         )
250. 
251.     def test_annotate_exclude(self):
252.         self.assertQuerysetEqual(
253.             CaseTestModel.objects.annotate(test=Case(
254.                 When(integer=1, then=Value('one')),
255.                 When(integer=2, then=Value('two')),
256.                 default=Value('other'),
257.                 output_field=models.CharField(),
258.             )).exclude(test='other').order_by('pk'),
259.             [(1, 'one'), (2, 'two'), (2, 'two')],
260.             transform=attrgetter('integer', 'test')
261.         )
262. 
263.     def test_annotate_values_not_in_order_by(self):
264.         self.assertEqual(
265.             list(CaseTestModel.objects.annotate(test=Case(
266.                 When(integer=1, then=Value('one')),
267.                 When(integer=2, then=Value('two')),
268.                 When(integer=3, then=Value('three')),
269.                 default=Value('other'),
270.                 output_field=models.CharField(),
271.             )).order_by('test').values_list('integer', flat=True)),
272.             [1, 4, 3, 3, 3, 2, 2]
273.         )
274. 
275.     def test_annotate_with_empty_when(self):
276.         objects = CaseTestModel.objects.annotate(
277.             selected=Case(
278.                 When(pk__in=[], then=Value('selected')),
279.                 default=Value('not selected'), output_field=models.CharField()
280.             )
281.         )
282.         self.assertEqual(len(objects), CaseTestModel.objects.count())
283.         self.assertTrue(all(obj.selected == 'not selected' for obj in objects))
284. 
285.     def test_combined_expression(self):
286.         self.assertQuerysetEqual(
287.             CaseTestModel.objects.annotate(
288.                 test=Case(
289.                     When(integer=1, then=2),
290.                     When(integer=2, then=1),
291.                     default=3,
292.                     output_field=models.IntegerField(),
293.                 ) + 1,
294.             ).order_by('pk'),
295.             [(1, 3), (2, 2), (3, 4), (2, 2), (3, 4), (3, 4), (4, 4)],
296.             transform=attrgetter('integer', 'test')
297.         )
298. 
299.     def test_in_subquery(self):
300.         self.assertQuerysetEqual(
301.             CaseTestModel.objects.filter(
302.                 pk__in=CaseTestModel.objects.annotate(
303.                     test=Case(
304.                         When(integer=F('integer2'), then='pk'),
305.                         When(integer=4, then='pk'),
306.                         output_field=models.IntegerField(),
307.                     ),
308.                 ).values('test')).order_by('pk'),
309.             [(1, 1), (2, 2), (3, 3), (4, 5)],
310.             transform=attrgetter('integer', 'integer2')
311.         )
312. 
313.     def test_case_reuse(self):
314.         SOME_CASE = Case(
315.             When(pk=0, then=Value('0')),
316.             default=Value('1'),
317.             output_field=models.CharField(),
318.         )
319.         self.assertQuerysetEqual(
320.             CaseTestModel.objects.annotate(somecase=SOME_CASE).order_by('pk'),
321.             CaseTestModel.objects.annotate(somecase=SOME_CASE).order_by('pk').values_list('pk', 'somecase'),
322.             lambda x: (x.pk, x.somecase)
323.         )
324. 
325.     def test_aggregate(self):
326.         self.assertEqual(
327.             CaseTestModel.objects.aggregate(
328.                 one=models.Sum(Case(
329.                     When(integer=1, then=1),
330.                     output_field=models.IntegerField(),
331.                 )),
332.                 two=models.Sum(Case(
333.                     When(integer=2, then=1),
334.                     output_field=models.IntegerField(),
335.                 )),
336.                 three=models.Sum(Case(
337.                     When(integer=3, then=1),
338.                     output_field=models.IntegerField(),
339.                 )),
340.                 four=models.Sum(Case(
341.                     When(integer=4, then=1),
342.                     output_field=models.IntegerField(),
343.                 )),
344.             ),
345.             {'one': 1, 'two': 2, 'three': 3, 'four': 1}
346.         )
347. 
348.     def test_aggregate_with_expression_as_value(self):
349.         self.assertEqual(
350.             CaseTestModel.objects.aggregate(
351.                 one=models.Sum(Case(When(integer=1, then='integer'))),
352.                 two=models.Sum(Case(When(integer=2, then=F('integer') - 1))),
353.                 three=models.Sum(Case(When(integer=3, then=F('integer') + 1))),
354.             ),
355.             {'one': 1, 'two': 2, 'three': 12}
356.         )
357. 
358.     def test_aggregate_with_expression_as_condition(self):
359.         self.assertEqual(
360.             CaseTestModel.objects.aggregate(
361.                 equal=models.Sum(Case(
362.                     When(integer2=F('integer'), then=1),
363.                     output_field=models.IntegerField(),
364.                 )),
365.                 plus_one=models.Sum(Case(
366.                     When(integer2=F('integer') + 1, then=1),
367.                     output_field=models.IntegerField(),
368.                 )),
369.             ),
370.             {'equal': 3, 'plus_one': 4}
371.         )
372. 
373.     def test_filter(self):
374.         self.assertQuerysetEqual(
375.             CaseTestModel.objects.filter(integer2=Case(
376.                 When(integer=2, then=3),
377.                 When(integer=3, then=4),
378.                 default=1,
379.                 output_field=models.IntegerField(),
380.             )).order_by('pk'),
381.             [(1, 1), (2, 3), (3, 4), (3, 4)],
382.             transform=attrgetter('integer', 'integer2')
383.         )
384. 
385.     def test_filter_without_default(self):
386.         self.assertQuerysetEqual(
387.             CaseTestModel.objects.filter(integer2=Case(
388.                 When(integer=2, then=3),
389.                 When(integer=3, then=4),
390.                 output_field=models.IntegerField(),
391.             )).order_by('pk'),
392.             [(2, 3), (3, 4), (3, 4)],
393.             transform=attrgetter('integer', 'integer2')
394.         )
395. 
396.     def test_filter_with_expression_as_value(self):
397.         self.assertQuerysetEqual(
398.             CaseTestModel.objects.filter(integer2=Case(
399.                 When(integer=2, then=F('integer') + 1),
400.                 When(integer=3, then=F('integer')),
401.                 default='integer',
402.             )).order_by('pk'),
403.             [(1, 1), (2, 3), (3, 3)],
404.             transform=attrgetter('integer', 'integer2')
405.         )
406. 
407.     def test_filter_with_expression_as_condition(self):
408.         self.assertQuerysetEqual(
409.             CaseTestModel.objects.filter(string=Case(
410.                 When(integer2=F('integer'), then=Value('2')),
411.                 When(integer2=F('integer') + 1, then=Value('3')),
412.                 output_field=models.CharField(),
413.             )).order_by('pk'),
414.             [(3, 4, '3'), (2, 2, '2'), (3, 4, '3')],
415.             transform=attrgetter('integer', 'integer2', 'string')
416.         )
417. 
418.     def test_filter_with_join_in_value(self):
419.         self.assertQuerysetEqual(
420.             CaseTestModel.objects.filter(integer2=Case(
421.                 When(integer=2, then=F('o2o_rel__integer') + 1),
422.                 When(integer=3, then=F('o2o_rel__integer')),
423.                 default='o2o_rel__integer',
424.             )).order_by('pk'),
425.             [(1, 1), (2, 3), (3, 3)],
426.             transform=attrgetter('integer', 'integer2')
427.         )
428. 
429.     def test_filter_with_join_in_condition(self):
430.         self.assertQuerysetEqual(
431.             CaseTestModel.objects.filter(integer=Case(
432.                 When(integer2=F('o2o_rel__integer') + 1, then=2),
433.                 When(integer2=F('o2o_rel__integer'), then=3),
434.                 output_field=models.IntegerField(),
435.             )).order_by('pk'),
436.             [(2, 3), (3, 3)],
437.             transform=attrgetter('integer', 'integer2')
438.         )
439. 
440.     def test_filter_with_join_in_predicate(self):
441.         self.assertQuerysetEqual(
442.             CaseTestModel.objects.filter(integer2=Case(
443.                 When(o2o_rel__integer=1, then=1),
444.                 When(o2o_rel__integer=2, then=3),
445.                 When(o2o_rel__integer=3, then=4),
446.                 output_field=models.IntegerField(),
447.             )).order_by('pk'),
448.             [(1, 1), (2, 3), (3, 4), (3, 4)],
449.             transform=attrgetter('integer', 'integer2')
450.         )
451. 
452.     def test_filter_with_annotation_in_value(self):
453.         self.assertQuerysetEqual(
454.             CaseTestModel.objects.annotate(
455.                 f=F('integer'),
456.                 f_plus_1=F('integer') + 1,
457.             ).filter(
458.                 integer2=Case(
459.                     When(integer=2, then='f_plus_1'),
460.                     When(integer=3, then='f'),
461.                 ),
462.             ).order_by('pk'),
463.             [(2, 3), (3, 3)],
464.             transform=attrgetter('integer', 'integer2')
465.         )
466. 
467.     def test_filter_with_annotation_in_condition(self):
468.         self.assertQuerysetEqual(
469.             CaseTestModel.objects.annotate(
470.                 f_plus_1=F('integer') + 1,
471.             ).filter(
472.                 integer=Case(
473.                     When(integer2=F('integer'), then=2),
474.                     When(integer2=F('f_plus_1'), then=3),
475.                     output_field=models.IntegerField(),
476.                 ),
477.             ).order_by('pk'),
478.             [(3, 4), (2, 2), (3, 4)],
479.             transform=attrgetter('integer', 'integer2')
480.         )
481. 
482.     def test_filter_with_annotation_in_predicate(self):
483.         self.assertQuerysetEqual(
484.             CaseTestModel.objects.annotate(
485.                 f_plus_1=F('integer') + 1,
486.             ).filter(
487.                 integer2=Case(
488.                     When(f_plus_1=3, then=3),
489.                     When(f_plus_1=4, then=4),
490.                     default=1,
491.                     output_field=models.IntegerField(),
492.                 ),
493.             ).order_by('pk'),
494.             [(1, 1), (2, 3), (3, 4), (3, 4)],
495.             transform=attrgetter('integer', 'integer2')
496.         )
497. 
498.     def test_filter_with_aggregation_in_value(self):
499.         self.assertQuerysetEqual(
500.             CaseTestModel.objects.values(*self.non_lob_fields).annotate(

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-23 18:40:19,710 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants test cases for a bug involving `Count`, `distinct=True`, and `Case` expressions. The current context contains tests for these features in isolation, but not in the combination that triggers the bug. To find the most relevant test cases, I need to examine regression tests and more complex expression tests. `tests/aggregation_regress/tests.py` is a likely candidate for a regression test for this bug, and `tests/expressions/tests.py` may contain more complex scenarios involving expressions in aggregations.' query='Please provide the full content of `tests/aggregation_regress/tests.py` and `tests/expressions/tests.py`.' extra_requirements='' purpose="I need to find test cases that combine `Count`, `distinct`, and `Case` to find the most relevant examples for the user's query, and these files are likely to contain such tests."
2025-12-23 18:40:19,711 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `tests/aggregation_regress/tests.py` and `tests/expressions/tests.py`.
2025-12-23 18:40:19,711 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-23 18:40:19,712 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-23 18:40:19,712 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-23 18:40:19,712 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `tests/aggregation_regress/tests.py` and `tests/expressions/tests.py`.
Purpose: I need to find test cases that combine `Count`, `distinct`, and `Case` to find the most relevant examples for the user's query, and these files are likely to contain such tests.
2025-12-23 18:40:22,525 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the contents of both `tests/aggregation_regress/tests.py` and `tests/expressions/tests.py` so you can examine them. I initiated two separate searches to pull the complete code from each file. This will allow you to analyze the test cases for combinations of `Count`, `distinct`, and `Case` as you requested.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/expressions/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2119, 'candidates_token_count': 120, 'total_token_count': 2348, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2119}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 120}], 'thoughts_token_count': 109, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.09542134602864584, 'model_name': 'gemini-2.5-pro'} id='run--cc5a4a41-3b25-42fa-adc0-03bd9c7ffc87-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/aggregation_regress/tests.py'}, 'id': '5840f852-5811-4bfe-bf78-dff5c2b268ac', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/expressions/tests.py'}, 'id': '4b7a8cba-0637-4ab1-8ef3-04d27aad181a', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2119, 'output_tokens': 120, 'total_tokens': 2348, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 109}}
2025-12-23 18:47:24,781 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have read the contents of `tests/aggregation_regress/tests.py` and `tests/expressions/tests.py`. I will now search for test cases that use `Count`, `distinct`, and `Case` together. I will start by searching for the use of `distinct=True` in the `tests/aggregation_regress/tests.py` file and then expand my search to the other file and keywords.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"relative_path": "tests/aggregation_regress/tests.py", "text": "distinct=True"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 19167, 'candidates_token_count': 126, 'total_token_count': 82206, 'cached_content_token_count': 1904, 'prompt_tokens_details': [{'modality': 1, 'token_count': 19167}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1904}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 126}], 'thoughts_token_count': 62913}, 'finish_reason': 'STOP', 'avg_logprobs': -2.3165191165984624, 'model_name': 'gemini-2.5-pro'} id='run--39e2c3ef-02ec-4af8-b5bd-7e68065556a9-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'relative_path': 'tests/aggregation_regress/tests.py', 'text': 'distinct=True'}, 'id': '67e01107-8f38-4bf0-b69f-7ab0e53a4a18', 'type': 'tool_call'}] usage_metadata={'input_tokens': 19167, 'output_tokens': 126, 'total_tokens': 82206, 'input_token_details': {'cache_read': 1904}, 'output_token_details': {'reasoning': 62913}}
2025-12-23 18:47:31,991 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have located a promising test class, `AggregationTests`, within `tests/aggregation_regress/tests.py` that utilizes `distinct=True`. My next step is to verify if this same class also incorporates the `Case` keyword, which would bring me closer to identifying a comprehensive test case that combines all the user's specified criteria." additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"relative_path": "tests/aggregation_regress/tests.py", "text": "Case"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 37909, 'candidates_token_count': 105, 'total_token_count': 38342, 'prompt_tokens_details': [{'modality': 1, 'token_count': 37909}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 105}], 'thoughts_token_count': 328, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.45695611862909224, 'model_name': 'gemini-2.5-pro'} id='run--46828a75-0788-4379-b233-7c272da13f84-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'relative_path': 'tests/aggregation_regress/tests.py', 'text': 'Case'}, 'id': '22ce08c6-fe9c-494e-a03d-c7eaa5c2cf59', 'type': 'tool_call'}] usage_metadata={'input_tokens': 37909, 'output_tokens': 105, 'total_tokens': 38342, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 328}}
2025-12-23 18:47:35,501 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I\'ve confirmed that the `AggregationTests` class in `tests/aggregation_regress/tests.py` utilizes both `distinct=True` and `Case`, making it a promising area for our search. To pinpoint the exact test method combining all three elements, I will now specifically look for the usage of "Count" within this class. This focused approach should lead me directly to the most relevant examples for the user\'s query.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"relative_path": "tests/aggregation_regress/tests.py", "text": "Count"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 57699, 'candidates_token_count': 124, 'total_token_count': 57923, 'cached_content_token_count': 36922, 'prompt_tokens_details': [{'modality': 1, 'token_count': 57699}], 'cache_tokens_details': [{'modality': 1, 'token_count': 36922}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 124}], 'thoughts_token_count': 100}, 'finish_reason': 'STOP', 'avg_logprobs': -0.15458027009041078, 'model_name': 'gemini-2.5-pro'} id='run--c9994911-90db-4af4-905a-e9d95952c782-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'relative_path': 'tests/aggregation_regress/tests.py', 'text': 'Count'}, 'id': '0d885065-ef9e-4116-b51a-f306ad6f027e', 'type': 'tool_call'}] usage_metadata={'input_tokens': 57699, 'output_tokens': 124, 'total_tokens': 57923, 'input_token_details': {'cache_read': 36922}, 'output_token_details': {'reasoning': 100}}
2025-12-23 18:47:59,747 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='After a thorough review of the provided files, I have identified several test cases in `tests/aggregation_regress/tests.py` that, while not combining all three of your specified keywords into a single test, are highly relevant to your goal. The `AggregationTests` class contains methods that demonstrate the use of `Count` and `Case` together, `distinct` and `Case` together, and `Count` and `distinct` together. These examples should provide you with the necessary patterns to construct the query you need.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/aggregation_regress/tests.py", "end_line": 708.0, "start_line": 699.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'citation_metadata': {'citations': [{'start_index': 3647, 'end_index': 4036, 'uri': 'https://github.com/django/django', 'license_': 'BSD-3-Clause', 'title': ''}, {'start_index': 4176, 'end_index': 4455, 'uri': 'https://github.com/django/django', 'license_': 'BSD-3-Clause', 'title': ''}, {'start_index': 4858, 'end_index': 5139, 'uri': 'https://github.com/Yoann-Vie/esgi-hearthstone', 'title': '', 'license_': ''}]}, 'usage_metadata': {'prompt_token_count': 77382, 'candidates_token_count': 198, 'total_token_count': 79690, 'prompt_tokens_details': [{'modality': 1, 'token_count': 77382}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 198}], 'thoughts_token_count': 2110, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.7032086150814788, 'model_name': 'gemini-2.5-pro'} id='run--e229199b-37b1-476e-9ad1-a28a409940d7-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/aggregation_regress/tests.py', 'end_line': 388.0, 'start_line': 380.0}, 'id': '091de6dd-6545-4016-817f-a60875e2b378', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'end_line': 415.0, 'relative_path': 'tests/aggregation_regress/tests.py', 'start_line': 407.0}, 'id': 'ecfcdab6-680e-4f79-b5de-4a9959878019', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/aggregation_regress/tests.py', 'end_line': 708.0, 'start_line': 699.0}, 'id': '1f7e9a5f-2a70-4c2a-9261-cb26e5272ebc', 'type': 'tool_call'}] usage_metadata={'input_tokens': 77382, 'output_tokens': 198, 'total_tokens': 79690, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 2110}}
2025-12-23 18:48:06,620 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='After analyzing the test files, I have identified several relevant examples in `tests/aggregation_regress/tests.py`. I did not find a single test case that combines all three of your keywords (`Count`, `distinct`, and `Case`). However, I have located separate tests that demonstrate the usage of `Count` with `Case`, `distinct` with `Case`, and `Count` with `distinct`, which should provide you with the necessary building blocks to construct your own query.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 78225, 'candidates_token_count': 99, 'total_token_count': 78627, 'prompt_tokens_details': [{'modality': 1, 'token_count': 78225}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 99}], 'thoughts_token_count': 303, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.5288131790931778, 'model_name': 'gemini-2.5-pro'} id='run--4d5bf0cb-3512-4fae-8ff9-be201abd738d-0' usage_metadata={'input_tokens': 78225, 'output_tokens': 99, 'total_tokens': 78627, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 303}}
2025-12-23 18:48:06,623 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `tests/aggregation_regress/tests.py` and `tests/expressions/tests.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
I need to find test cases that combine `Count`, `distinct`, and `Case` to find the most relevant examples for the user's query, and these files are likely to contain such tests.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/aggregation_regress/tests.py
Line number range: 1 - 500
Content:
1. import datetime
2. import pickle
3. from decimal import Decimal
4. from operator import attrgetter
5. from unittest import mock
6. 
7. from django.contrib.contenttypes.models import ContentType
8. from django.core.exceptions import FieldError
9. from django.db import connection
10. from django.db.models import (
11.     Avg, Case, Count, DecimalField, F, IntegerField, Max, Q, StdDev, Sum,
12.     Value, Variance, When,
13. )
14. from django.db.models.aggregates import Aggregate
15. from django.test import (
16.     TestCase, ignore_warnings, skipUnlessAnyDBFeature, skipUnlessDBFeature,
17. )
18. from django.test.utils import Approximate
19. from django.utils.deprecation import RemovedInDjango31Warning
20. 
21. from .models import (
22.     Alfa, Author, Book, Bravo, Charlie, Clues, Entries, HardbackBook, ItemTag,
23.     Publisher, SelfRefFK, Store, WithManualPK,
24. )
25. 
26. 
27. class AggregationTests(TestCase):
28. 
29.     @classmethod
30.     def setUpTestData(cls):
31.         cls.a1 = Author.objects.create(name='Adrian Holovaty', age=34)
32.         cls.a2 = Author.objects.create(name='Jacob Kaplan-Moss', age=35)
33.         cls.a3 = Author.objects.create(name='Brad Dayley', age=45)
34.         cls.a4 = Author.objects.create(name='James Bennett', age=29)
35.         cls.a5 = Author.objects.create(name='Jeffrey Forcier', age=37)
36.         cls.a6 = Author.objects.create(name='Paul Bissex', age=29)
37.         cls.a7 = Author.objects.create(name='Wesley J. Chun', age=25)
38.         cls.a8 = Author.objects.create(name='Peter Norvig', age=57)
39.         cls.a9 = Author.objects.create(name='Stuart Russell', age=46)
40.         cls.a1.friends.add(cls.a2, cls.a4)
41.         cls.a2.friends.add(cls.a1, cls.a7)
42.         cls.a4.friends.add(cls.a1)
43.         cls.a5.friends.add(cls.a6, cls.a7)
44.         cls.a6.friends.add(cls.a5, cls.a7)
45.         cls.a7.friends.add(cls.a2, cls.a5, cls.a6)
46.         cls.a8.friends.add(cls.a9)
47.         cls.a9.friends.add(cls.a8)
48. 
49.         cls.p1 = Publisher.objects.create(name='Apress', num_awards=3)
50.         cls.p2 = Publisher.objects.create(name='Sams', num_awards=1)
51.         cls.p3 = Publisher.objects.create(name='Prentice Hall', num_awards=7)
52.         cls.p4 = Publisher.objects.create(name='Morgan Kaufmann', num_awards=9)
53.         cls.p5 = Publisher.objects.create(name="Jonno's House of Books", num_awards=0)
54. 
55.         cls.b1 = Book.objects.create(
56.             isbn='159059725', name='The Definitive Guide to Django: Web Development Done Right',
57.             pages=447, rating=4.5, price=Decimal('30.00'), contact=cls.a1, publisher=cls.p1,
58.             pubdate=datetime.date(2007, 12, 6)
59.         )
60.         cls.b2 = Book.objects.create(
61.             isbn='067232959', name='Sams Teach Yourself Django in 24 Hours',
62.             pages=528, rating=3.0, price=Decimal('23.09'), contact=cls.a3, publisher=cls.p2,
63.             pubdate=datetime.date(2008, 3, 3)
64.         )
65.         cls.b3 = Book.objects.create(
66.             isbn='159059996', name='Practical Django Projects',
67.             pages=300, rating=4.0, price=Decimal('29.69'), contact=cls.a4, publisher=cls.p1,
68.             pubdate=datetime.date(2008, 6, 23)
69.         )
70.         cls.b4 = Book.objects.create(
71.             isbn='013235613', name='Python Web Development with Django',
72.             pages=350, rating=4.0, price=Decimal('29.69'), contact=cls.a5, publisher=cls.p3,
73.             pubdate=datetime.date(2008, 11, 3)
74.         )
75.         cls.b5 = HardbackBook.objects.create(
76.             isbn='013790395', name='Artificial Intelligence: A Modern Approach',
77.             pages=1132, rating=4.0, price=Decimal('82.80'), contact=cls.a8, publisher=cls.p3,
78.             pubdate=datetime.date(1995, 1, 15), weight=4.5)
79.         cls.b6 = HardbackBook.objects.create(
80.             isbn='155860191', name='Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp',
81.             pages=946, rating=5.0, price=Decimal('75.00'), contact=cls.a8, publisher=cls.p4,
82.             pubdate=datetime.date(1991, 10, 15), weight=3.7)
83.         cls.b1.authors.add(cls.a1, cls.a2)
84.         cls.b2.authors.add(cls.a3)
85.         cls.b3.authors.add(cls.a4)
86.         cls.b4.authors.add(cls.a5, cls.a6, cls.a7)
87.         cls.b5.authors.add(cls.a8, cls.a9)
88.         cls.b6.authors.add(cls.a8)
89. 
90.         s1 = Store.objects.create(
91.             name='Amazon.com',
92.             original_opening=datetime.datetime(1994, 4, 23, 9, 17, 42),
93.             friday_night_closing=datetime.time(23, 59, 59)
94.         )
95.         s2 = Store.objects.create(
96.             name='Books.com',
97.             original_opening=datetime.datetime(2001, 3, 15, 11, 23, 37),
98.             friday_night_closing=datetime.time(23, 59, 59)
99.         )
100.         s3 = Store.objects.create(
101.             name="Mamma and Pappa's Books",
102.             original_opening=datetime.datetime(1945, 4, 25, 16, 24, 14),
103.             friday_night_closing=datetime.time(21, 30)
104.         )
105.         s1.books.add(cls.b1, cls.b2, cls.b3, cls.b4, cls.b5, cls.b6)
106.         s2.books.add(cls.b1, cls.b3, cls.b5, cls.b6)
107.         s3.books.add(cls.b3, cls.b4, cls.b6)
108. 
109.     def assertObjectAttrs(self, obj, **kwargs):
110.         for attr, value in kwargs.items():
111.             self.assertEqual(getattr(obj, attr), value)
112. 
113.     @ignore_warnings(category=RemovedInDjango31Warning)
114.     def test_annotation_with_value(self):
115.         values = Book.objects.filter(
116.             name='Practical Django Projects',
117.         ).annotate(
118.             discount_price=F('price') * 2,
119.         ).values(
120.             'discount_price',
121.         ).annotate(sum_discount=Sum('discount_price'))
122.         self.assertSequenceEqual(
123.             values,
124.             [{'discount_price': Decimal('59.38'), 'sum_discount': Decimal('59.38')}]
125.         )
126. 
127.     def test_aggregates_in_where_clause(self):
128.         """
129.         Regression test for #12822: DatabaseError: aggregates not allowed in
130.         WHERE clause
131. 
132.         The subselect works and returns results equivalent to a
133.         query with the IDs listed.
134. 
135.         Before the corresponding fix for this bug, this test passed in 1.1 and
136.         failed in 1.2-beta (trunk).
137.         """
138.         qs = Book.objects.values('contact').annotate(Max('id'))
139.         qs = qs.order_by('contact').values_list('id__max', flat=True)
140.         # don't do anything with the queryset (qs) before including it as a
141.         # subquery
142.         books = Book.objects.order_by('id')
143.         qs1 = books.filter(id__in=qs)
144.         qs2 = books.filter(id__in=list(qs))
145.         self.assertEqual(list(qs1), list(qs2))
146. 
147.     def test_aggregates_in_where_clause_pre_eval(self):
148.         """
149.         Regression test for #12822: DatabaseError: aggregates not allowed in
150.         WHERE clause
151. 
152.         Same as the above test, but evaluates the queryset for the subquery
153.         before it's used as a subquery.
154. 
155.         Before the corresponding fix for this bug, this test failed in both
156.         1.1 and 1.2-beta (trunk).
157.         """
158.         qs = Book.objects.values('contact').annotate(Max('id'))
159.         qs = qs.order_by('contact').values_list('id__max', flat=True)
160.         # force the queryset (qs) for the subquery to be evaluated in its
161.         # current state
162.         list(qs)
163.         books = Book.objects.order_by('id')
164.         qs1 = books.filter(id__in=qs)
165.         qs2 = books.filter(id__in=list(qs))
166.         self.assertEqual(list(qs1), list(qs2))
167. 
168.     @skipUnlessDBFeature('supports_subqueries_in_group_by')
169.     def test_annotate_with_extra(self):
170.         """
171.         Regression test for #11916: Extra params + aggregation creates
172.         incorrect SQL.
173.         """
174.         # Oracle doesn't support subqueries in group by clause
175.         shortest_book_sql = """
176.         SELECT name
177.         FROM aggregation_regress_book b
178.         WHERE b.publisher_id = aggregation_regress_publisher.id
179.         ORDER BY b.pages
180.         LIMIT 1
181.         """
182.         # tests that this query does not raise a DatabaseError due to the full
183.         # subselect being (erroneously) added to the GROUP BY parameters
184.         qs = Publisher.objects.extra(select={
185.             'name_of_shortest_book': shortest_book_sql,
186.         }).annotate(total_books=Count('book'))
187.         # force execution of the query
188.         list(qs)
189. 
190.     def test_aggregate(self):
191.         # Ordering requests are ignored
192.         self.assertEqual(
193.             Author.objects.order_by("name").aggregate(Avg("age")),
194.             {"age__avg": Approximate(37.444, places=1)}
195.         )
196. 
197.         # Implicit ordering is also ignored
198.         self.assertEqual(
199.             Book.objects.aggregate(Sum("pages")),
200.             {"pages__sum": 3703},
201.         )
202. 
203.         # Baseline results
204.         self.assertEqual(
205.             Book.objects.aggregate(Sum('pages'), Avg('pages')),
206.             {'pages__sum': 3703, 'pages__avg': Approximate(617.166, places=2)}
207.         )
208. 
209.         # Empty values query doesn't affect grouping or results
210.         self.assertEqual(
211.             Book.objects.values().aggregate(Sum('pages'), Avg('pages')),
212.             {'pages__sum': 3703, 'pages__avg': Approximate(617.166, places=2)}
213.         )
214. 
215.         # Aggregate overrides extra selected column
216.         self.assertEqual(
217.             Book.objects.extra(select={'price_per_page': 'price / pages'}).aggregate(Sum('pages')),
218.             {'pages__sum': 3703}
219.         )
220. 
221.     @ignore_warnings(category=RemovedInDjango31Warning)
222.     def test_annotation(self):
223.         # Annotations get combined with extra select clauses
224.         obj = Book.objects.annotate(mean_auth_age=Avg("authors__age")).extra(
225.             select={"manufacture_cost": "price * .5"}).get(pk=self.b2.pk)
226.         self.assertObjectAttrs(
227.             obj,
228.             contact_id=self.a3.id,
229.             isbn='067232959',
230.             mean_auth_age=45.0,
231.             name='Sams Teach Yourself Django in 24 Hours',
232.             pages=528,
233.             price=Decimal("23.09"),
234.             pubdate=datetime.date(2008, 3, 3),
235.             publisher_id=self.p2.id,
236.             rating=3.0
237.         )
238.         # Different DB backends return different types for the extra select computation
239.         self.assertIn(obj.manufacture_cost, (11.545, Decimal('11.545')))
240. 
241.         # Order of the annotate/extra in the query doesn't matter
242.         obj = Book.objects.extra(select={'manufacture_cost': 'price * .5'}).annotate(
243.             mean_auth_age=Avg('authors__age')).get(pk=self.b2.pk)
244.         self.assertObjectAttrs(
245.             obj,
246.             contact_id=self.a3.id,
247.             isbn='067232959',
248.             mean_auth_age=45.0,
249.             name='Sams Teach Yourself Django in 24 Hours',
250.             pages=528,
251.             price=Decimal("23.09"),
252.             pubdate=datetime.date(2008, 3, 3),
253.             publisher_id=self.p2.id,
254.             rating=3.0
255.         )
256.         # Different DB backends return different types for the extra select computation
257.         self.assertIn(obj.manufacture_cost, (11.545, Decimal('11.545')))
258. 
259.         # Values queries can be combined with annotate and extra
260.         obj = Book.objects.annotate(mean_auth_age=Avg('authors__age')).extra(
261.             select={'manufacture_cost': 'price * .5'}).values().get(pk=self.b2.pk)
262.         manufacture_cost = obj['manufacture_cost']
263.         self.assertIn(manufacture_cost, (11.545, Decimal('11.545')))
264.         del obj['manufacture_cost']
265.         self.assertEqual(obj, {
266.             'id': self.b2.id,
267.             'contact_id': self.a3.id,
268.             'isbn': '067232959',
269.             'mean_auth_age': 45.0,
270.             'name': 'Sams Teach Yourself Django in 24 Hours',
271.             'pages': 528,
272.             'price': Decimal('23.09'),
273.             'pubdate': datetime.date(2008, 3, 3),
274.             'publisher_id': self.p2.id,
275.             'rating': 3.0,
276.         })
277. 
278.         # The order of the (empty) values, annotate and extra clauses doesn't
279.         # matter
280.         obj = Book.objects.values().annotate(mean_auth_age=Avg('authors__age')).extra(
281.             select={'manufacture_cost': 'price * .5'}).get(pk=self.b2.pk)
282.         manufacture_cost = obj['manufacture_cost']
283.         self.assertIn(manufacture_cost, (11.545, Decimal('11.545')))
284.         del obj['manufacture_cost']
285.         self.assertEqual(obj, {
286.             'id': self.b2.id,
287.             'contact_id': self.a3.id,
288.             'isbn': '067232959',
289.             'mean_auth_age': 45.0,
290.             'name': 'Sams Teach Yourself Django in 24 Hours',
291.             'pages': 528,
292.             'price': Decimal('23.09'),
293.             'pubdate': datetime.date(2008, 3, 3),
294.             'publisher_id': self.p2.id,
295.             'rating': 3.0
296.         })
297. 
298.         # If the annotation precedes the values clause, it won't be included
299.         # unless it is explicitly named
300.         obj = Book.objects.annotate(mean_auth_age=Avg('authors__age')).extra(
301.             select={'price_per_page': 'price / pages'}).values('name').get(pk=self.b1.pk)
302.         self.assertEqual(obj, {
303.             "name": 'The Definitive Guide to Django: Web Development Done Right',
304.         })
305. 
306.         obj = Book.objects.annotate(mean_auth_age=Avg('authors__age')).extra(
307.             select={'price_per_page': 'price / pages'}).values('name', 'mean_auth_age').get(pk=self.b1.pk)
308.         self.assertEqual(obj, {
309.             'mean_auth_age': 34.5,
310.             'name': 'The Definitive Guide to Django: Web Development Done Right',
311.         })
312. 
313.         # If an annotation isn't included in the values, it can still be used
314.         # in a filter
315.         with ignore_warnings(category=RemovedInDjango31Warning):
316.             qs = Book.objects.annotate(n_authors=Count('authors')).values('name').filter(n_authors__gt=2)
317.         self.assertSequenceEqual(
318.             qs, [
319.                 {"name": 'Python Web Development with Django'}
320.             ],
321.         )
322. 
323.         # The annotations are added to values output if values() precedes
324.         # annotate()
325.         obj = Book.objects.values('name').annotate(mean_auth_age=Avg('authors__age')).extra(
326.             select={'price_per_page': 'price / pages'}).get(pk=self.b1.pk)
327.         self.assertEqual(obj, {
328.             'mean_auth_age': 34.5,
329.             'name': 'The Definitive Guide to Django: Web Development Done Right',
330.         })
331. 
332.         # All of the objects are getting counted (allow_nulls) and that values
333.         # respects the amount of objects
334.         self.assertEqual(
335.             len(Author.objects.annotate(Avg('friends__age')).values()),
336.             9
337.         )
338. 
339.         # Consecutive calls to annotate accumulate in the query
340.         qs = (
341.             Book.objects
342.             .values('price')
343.             .annotate(oldest=Max('authors__age'))
344.             .order_by('oldest', 'price')
345.             .annotate(Max('publisher__num_awards'))
346.         )
347.         self.assertSequenceEqual(
348.             qs, [
349.                 {'price': Decimal("30"), 'oldest': 35, 'publisher__num_awards__max': 3},
350.                 {'price': Decimal("29.69"), 'oldest': 37, 'publisher__num_awards__max': 7},
351.                 {'price': Decimal("23.09"), 'oldest': 45, 'publisher__num_awards__max': 1},
352.                 {'price': Decimal("75"), 'oldest': 57, 'publisher__num_awards__max': 9},
353.                 {'price': Decimal("82.8"), 'oldest': 57, 'publisher__num_awards__max': 7}
354.             ],
355.         )
356. 
357.     def test_aggregate_annotation(self):
358.         # Aggregates can be composed over annotations.
359.         # The return type is derived from the composed aggregate
360.         vals = (
361.             Book.objects
362.             .all()
363.             .annotate(num_authors=Count('authors__id'))
364.             .aggregate(Max('pages'), Max('price'), Sum('num_authors'), Avg('num_authors'))
365.         )
366.         self.assertEqual(vals, {
367.             'num_authors__sum': 10,
368.             'num_authors__avg': Approximate(1.666, places=2),
369.             'pages__max': 1132,
370.             'price__max': Decimal("82.80")
371.         })
372. 
373.         # Regression for #15624 - Missing SELECT columns when using values, annotate
374.         # and aggregate in a single query
375.         self.assertEqual(
376.             Book.objects.annotate(c=Count('authors')).values('c').aggregate(Max('c')),
377.             {'c__max': 3}
378.         )
379. 
380.     def test_conditional_aggreate(self):
381.         # Conditional aggregation of a grouped queryset.
382.         self.assertEqual(
383.             Book.objects.annotate(c=Count('authors')).values('pk').aggregate(test=Sum(
384.                 Case(When(c__gt=1, then=1), output_field=IntegerField())
385.             ))['test'],
386.             3
387.         )
388. 
389.     def test_sliced_conditional_aggregate(self):
390.         self.assertEqual(
391.             Author.objects.all()[:5].aggregate(test=Sum(Case(
392.                 When(age__lte=35, then=1), output_field=IntegerField()
393.             )))['test'],
394.             3
395.         )
396. 
397.     def test_annotated_conditional_aggregate(self):
398.         annotated_qs = Book.objects.annotate(discount_price=F('price') * 0.75)
399.         self.assertAlmostEqual(
400.             annotated_qs.aggregate(test=Avg(Case(
401.                 When(pages__lt=400, then='discount_price'),
402.                 output_field=DecimalField()
403.             )))['test'],
404.             Decimal('22.27'), places=2
405.         )
406. 
407.     def test_distinct_conditional_aggregate(self):
408.         self.assertEqual(
409.             Book.objects.distinct().aggregate(test=Avg(Case(
410.                 When(price=Decimal('29.69'), then='pages'),
411.                 output_field=IntegerField()
412.             )))['test'],
413.             325
414.         )
415. 
416.     def test_conditional_aggregate_on_complex_condition(self):
417.         self.assertEqual(
418.             Book.objects.distinct().aggregate(test=Avg(Case(
419.                 When(Q(price__gte=Decimal('29')) & Q(price__lt=Decimal('30')), then='pages'),
420.                 output_field=IntegerField()
421.             )))['test'],
422.             325
423.         )
424. 
425.     def test_decimal_aggregate_annotation_filter(self):
426.         """
427.         Filtering on an aggregate annotation with Decimal values should work.
428.         Requires special handling on SQLite (#18247).
429.         """
430.         self.assertEqual(
431.             len(Author.objects.annotate(sum=Sum('book_contact_set__price')).filter(sum__gt=Decimal(40))),
432.             1
433.         )
434.         self.assertEqual(
435.             len(Author.objects.annotate(sum=Sum('book_contact_set__price')).filter(sum__lte=Decimal(40))),
436.             4
437.         )
438. 
439.     def test_field_error(self):
440.         # Bad field requests in aggregates are caught and reported
441.         msg = (
442.             "Cannot resolve keyword 'foo' into field. Choices are: authors, "
443.             "contact, contact_id, hardbackbook, id, isbn, name, pages, price, "
444.             "pubdate, publisher, publisher_id, rating, store, tags"
445.         )
446.         with self.assertRaisesMessage(FieldError, msg):
447.             Book.objects.all().aggregate(num_authors=Count('foo'))
448. 
449.         with self.assertRaisesMessage(FieldError, msg):
450.             Book.objects.all().annotate(num_authors=Count('foo'))
451. 
452.         msg = (
453.             "Cannot resolve keyword 'foo' into field. Choices are: authors, "
454.             "contact, contact_id, hardbackbook, id, isbn, name, num_authors, "
455.             "pages, price, pubdate, publisher, publisher_id, rating, store, tags"
456.         )
457.         with self.assertRaisesMessage(FieldError, msg):
458.             Book.objects.all().annotate(num_authors=Count('authors__id')).aggregate(Max('foo'))
459. 
460.     @ignore_warnings(category=RemovedInDjango31Warning)
461.     def test_more(self):
462.         # Old-style count aggregations can be mixed with new-style
463.         self.assertEqual(
464.             Book.objects.annotate(num_authors=Count('authors')).count(),
465.             6
466.         )
467. 
468.         # Non-ordinal, non-computed Aggregates over annotations correctly
469.         # inherit the annotation's internal type if the annotation is ordinal
470.         # or computed
471.         vals = Book.objects.annotate(num_authors=Count('authors')).aggregate(Max('num_authors'))
472.         self.assertEqual(
473.             vals,
474.             {'num_authors__max': 3}
475.         )
476. 
477.         vals = Publisher.objects.annotate(avg_price=Avg('book__price')).aggregate(Max('avg_price'))
478.         self.assertEqual(
479.             vals,
480.             {'avg_price__max': 75.0}
481.         )
482. 
483.         # Aliases are quoted to protected aliases that might be reserved names
484.         vals = Book.objects.aggregate(number=Max('pages'), select=Max('pages'))
485.         self.assertEqual(
486.             vals,
487.             {'number': 1132, 'select': 1132}
488.         )
489. 
490.         # Regression for #10064: select_related() plays nice with aggregates
491.         obj = Book.objects.select_related('publisher').annotate(
492.             num_authors=Count('authors')).values().get(isbn='013790395')
493.         self.assertEqual(obj, {
494.             'contact_id': self.a8.id,
495.             'id': self.b5.id,
496.             'isbn': '013790395',
497.             'name': 'Artificial Intelligence: A Modern Approach',
498.             'num_authors': 2,
499.             'pages': 1132,
500.             'price': Decimal("82.8"),


File: tests/aggregation_regress/tests.py
Line number range: 27 - 1508
Content:
class AggregationTests(TestCase):

    @classmethod
    def setUpTestData(cls):
        cls.a1 = Author.objects.create(name='Adrian Holovaty', age=34)
        cls.a2 = Author.objects.create(name='Jacob Kaplan-Moss', age=35)
        cls.a3 = Author.objects.create(name='Brad Dayley', age=45)
        cls.a4 = Author.objects.create(name='James Bennett', age=29)
        cls.a5 = Author.objects.create(name='Jeffrey Forcier', age=37)
        cls.a6 = Author.objects.create(name='Paul Bissex', age=29)
        cls.a7 = Author.objects.create(name='Wesley J. Chun', age=25)
        cls.a8 = Author.objects.create(name='Peter Norvig', age=57)
        cls.a9 = Author.objects.create(name='Stuart Russell', age=46)
        cls.a1.friends.add(cls.a2, cls.a4)
        cls.a2.friends.add(cls.a1, cls.a7)
        cls.a4.friends.add(cls.a1)
        cls.a5.friends.add(cls.a6, cls.a7)
        cls.a6.friends.add(cls.a5, cls.a7)
        cls.a7.friends.add(cls.a2, cls.a5, cls.a6)
        cls.a8.friends.add(cls.a9)
        cls.a9.friends.add(cls.a8)

        cls.p1 = Publisher.objects.create(name='Apress', num_awards=3)
        cls.p2 = Publisher.objects.create(name='Sams', num_awards=1)
        cls.p3 = Publisher.objects.create(name='Prentice Hall', num_awards=7)
        cls.p4 = Publisher.objects.create(name='Morgan Kaufmann', num_awards=9)
        cls.p5 = Publisher.objects.create(name="Jonno's House of Books", num_awards=0)

        cls.b1 = Book.objects.create(
            isbn='159059725', name='The Definitive Guide to Django: Web Development Done Right',
            pages=447, rating=4.5, price=Decimal('30.00'), contact=cls.a1, publisher=cls.p1,
            pubdate=datetime.date(2007, 12, 6)
        )
        cls.b2 = Book.objects.create(
            isbn='067232959', name='Sams Teach Yourself Django in 24 Hours',
            pages=528, rating=3.0, price=Decimal('23.09'), contact=cls.a3, publisher=cls.p2,
            pubdate=datetime.date(2008, 3, 3)
        )
        cls.b3 = Book.objects.create(
            isbn='159059996', name='Practical Django Projects',
            pages=300, rating=4.0, price=Decimal('29.69'), contact=cls.a4, publisher=cls.p1,
            pubdate=datetime.date(2008, 6, 23)
        )
        cls.b4 = Book.objects.create(
            isbn='013235613', name='Python Web Development with Django',
            pages=350, rating=4.0, price=Decimal('29.69'), contact=cls.a5, publisher=cls.p3,
            pubdate=datetime.date(2008, 11, 3)
        )
        cls.b5 = HardbackBook.objects.create(
            isbn='013790395', name='Artificial Intelligence: A Modern Approach',
            pages=1132, rating=4.0, price=Decimal('82.80'), contact=cls.a8, publisher=cls.p3,
            pubdate=datetime.date(1995, 1, 15), weight=4.5)
        cls.b6 = HardbackBook.objects.create(
            isbn='155860191', name='Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp',
            pages=946, rating=5.0, price=Decimal('75.00'), contact=cls.a8, publisher=cls.p4,
            pubdate=datetime.date(1991, 10, 15), weight=3.7)
        cls.b1.authors.add(cls.a1, cls.a2)
        cls.b2.authors.add(cls.a3)
        cls.b3.authors.add(cls.a4)
        cls.b4.authors.add(cls.a5, cls.a6, cls.a7)
        cls.b5.authors.add(cls.a8, cls.a9)
        cls.b6.authors.add(cls.a8)

        s1 = Store.objects.create(
            name='Amazon.com',
            original_opening=datetime.datetime(1994, 4, 23, 9, 17, 42),
            friday_night_closing=datetime.time(23, 59, 59)
        )
        s2 = Store.objects.create(
            name='Books.com',
            original_opening=datetime.datetime(2001, 3, 15, 11, 23, 37),
            friday_night_closing=datetime.time(23, 59, 59)
        )
        s3 = Store.objects.create(
            name="Mamma and Pappa's Books",
            original_opening=datetime.datetime(1945, 4, 25, 16, 24, 14),
            friday_night_closing=datetime.time(21, 30)
        )
        s1.books.add(cls.b1, cls.b2, cls.b3, cls.b4, cls.b5, cls.b6)
        s2.books.add(cls.b1, cls.b3, cls.b5, cls.b6)
        s3.books.add(cls.b3, cls.b4, cls.b6)

    def assertObjectAttrs(self, obj, **kwargs):
        for attr, value in kwargs.items():
            self.assertEqual(getattr(obj, attr), value)

    @ignore_warnings(category=RemovedInDjango31Warning)
    def test_annotation_with_value(self):
        values = Book.objects.filter(
            name='Practical Django Projects',
        ).annotate(
            discount_price=F('price') * 2,
        ).values(
            'discount_price',
        ).annotate(sum_discount=Sum('discount_price'))
        self.assertSequenceEqual(
            values,
            [{'discount_price': Decimal('59.38'), 'sum_discount': Decimal('59.38')}]
        )

    def test_aggregates_in_where_clause(self):
        """
        Regression test for #12822: DatabaseError: aggregates not allowed in
        WHERE clause

        The subselect works and returns results equivalent to a
        query with the IDs listed.

        Before the corresponding fix for this bug, this test passed in 1.1 and
        failed in 1.2-beta (trunk).
        """
        qs = Book.objects.values('contact').annotate(Max('id'))
        qs = qs.order_by('contact').values_list('id__max', flat=True)
        # don't do anything with the queryset (qs) before including it as a
        # subquery
        books = Book.objects.order_by('id')
        qs1 = books.filter(id__in=qs)
        qs2 = books.filter(id__in=list(qs))
        self.assertEqual(list(qs1), list(qs2))

    def test_aggregates_in_where_clause_pre_eval(self):
        """
        Regression test for #12822: DatabaseError: aggregates not allowed in
        WHERE clause

        Same as the above test, but evaluates the queryset for the subquery
        before it's used as a subquery.

        Before the corresponding fix for this bug, this test failed in both
        1.1 and 1.2-beta (trunk).
        """
        qs = Book.objects.values('contact').annotate(Max('id'))
        qs = qs.order_by('contact').values_list('id__max', flat=True)
        # force the queryset (qs) for the subquery to be evaluated in its
        # current state
        list(qs)
        books = Book.objects.order_by('id')
        qs1 = books.filter(id__in=qs)
        qs2 = books.filter(id__in=list(qs))
        self.assertEqual(list(qs1), list(qs2))

    @skipUnlessDBFeature('supports_subqueries_in_group_by')
    def test_annotate_with_extra(self):
        """
        Regression test for #11916: Extra params + aggregation creates
        incorrect SQL.
        """
        # Oracle doesn't support subqueries in group by clause
        shortest_book_sql = """
        SELECT name
        FROM aggregation_regress_book b
        WHERE b.publisher_id = aggregation_regress_publisher.id
        ORDER BY b.pages
        LIMIT 1
        """
        # tests that this query does not raise a DatabaseError due to the full
        # subselect being (erroneously) added to the GROUP BY parameters
        qs = Publisher.objects.extra(select={
            'name_of_shortest_book': shortest_book_sql,
        }).annotate(total_books=Count('book'))
        # force execution of the query
        list(qs)

    def test_aggregate(self):
        # Ordering requests are ignored
        self.assertEqual(
            Author.objects.order_by("name").aggregate(Avg("age")),
            {"age__avg": Approximate(37.444, places=1)}
        )

        # Implicit ordering is also ignored
        self.assertEqual(
            Book.objects.aggregate(Sum("pages")),
            {"pages__sum": 3703},
        )

        # Baseline results
        self.assertEqual(
            Book.objects.aggregate(Sum('pages'), Avg('pages')),
            {'pages__sum': 3703, 'pages__avg': Approximate(617.166, places=2)}
        )

        # Empty values query doesn't affect grouping or results
        self.assertEqual(
            Book.objects.values().aggregate(Sum('pages'), Avg('pages')),
            {'pages__sum': 3703, 'pages__avg': Approximate(617.166, places=2)}
        )

        # Aggregate overrides extra selected column
        self.assertEqual(
            Book.objects.extra(select={'price_per_page': 'price / pages'}).aggregate(Sum('pages')),
            {'pages__sum': 3703}
        )

    @ignore_warnings(category=RemovedInDjango31Warning)
    def test_annotation(self):
        # Annotations get combined with extra select clauses
        obj = Book.objects.annotate(mean_auth_age=Avg("authors__age")).extra(
            select={"manufacture_cost": "price * .5"}).get(pk=self.b2.pk)
        self.assertObjectAttrs(
            obj,
            contact_id=self.a3.id,
            isbn='067232959',
            mean_auth_age=45.0,
            name='Sams Teach Yourself Django in 24 Hours',
            pages=528,
            price=Decimal("23.09"),
            pubdate=datetime.date(2008, 3, 3),
            publisher_id=self.p2.id,
            rating=3.0
        )
        # Different DB backends return different types for the extra select computation
        self.assertIn(obj.manufacture_cost, (11.545, Decimal('11.545')))

        # Order of the annotate/extra in the query doesn't matter
        obj = Book.objects.extra(select={'manufacture_cost': 'price * .5'}).annotate(
            mean_auth_age=Avg('authors__age')).get(pk=self.b2.pk)
        self.assertObjectAttrs(
            obj,
            contact_id=self.a3.id,
            isbn='067232959',
            mean_auth_age=45.0,
            name='Sams Teach Yourself Django in 24 Hours',
            pages=528,
            price=Decimal("23.09"),
            pubdate=datetime.date(2008, 3, 3),
            publisher_id=self.p2.id,
            rating=3.0
        )
        # Different DB backends return different types for the extra select computation
        self.assertIn(obj.manufacture_cost, (11.545, Decimal('11.545')))

        # Values queries can be combined with annotate and extra
        obj = Book.objects.annotate(mean_auth_age=Avg('authors__age')).extra(
            select={'manufacture_cost': 'price * .5'}).values().get(pk=self.b2.pk)
        manufacture_cost = obj['manufacture_cost']
        self.assertIn(manufacture_cost, (11.545, Decimal('11.545')))
        del obj['manufacture_cost']
        self.assertEqual(obj, {
            'id': self.b2.id,
            'contact_id': self.a3.id,
            'isbn': '067232959',
            'mean_auth_age': 45.0,
            'name': 'Sams Teach Yourself Django in 24 Hours',
            'pages': 528,
            'price': Decimal('23.09'),
            'pubdate': datetime.date(2008, 3, 3),
            'publisher_id': self.p2.id,
            'rating': 3.0,
        })

        # The order of the (empty) values, annotate and extra clauses doesn't
        # matter
        obj = Book.objects.values().annotate(mean_auth_age=Avg('authors__age')).extra(
            select={'manufacture_cost': 'price * .5'}).get(pk=self.b2.pk)
        manufacture_cost = obj['manufacture_cost']
        self.assertIn(manufacture_cost, (11.545, Decimal('11.545')))
        del obj['manufacture_cost']
        self.assertEqual(obj, {
            'id': self.b2.id,
            'contact_id': self.a3.id,
            'isbn': '067232959',
            'mean_auth_age': 45.0,
            'name': 'Sams Teach Yourself Django in 24 Hours',
            'pages': 528,
            'price': Decimal('23.09'),
            'pubdate': datetime.date(2008, 3, 3),
            'publisher_id': self.p2.id,
            'rating': 3.0
        })

        # If the annotation precedes the values clause, it won't be included
        # unless it is explicitly named
        obj = Book.objects.annotate(mean_auth_age=Avg('authors__age')).extra(
            select={'price_per_page': 'price / pages'}).values('name').get(pk=self.b1.pk)
        self.assertEqual(obj, {
            "name": 'The Definitive Guide to Django: Web Development Done Right',
        })

        obj = Book.objects.annotate(mean_auth_age=Avg('authors__age')).extra(
            select={'price_per_page': 'price / pages'}).values('name', 'mean_auth_age').get(pk=self.b1.pk)
        self.assertEqual(obj, {
            'mean_auth_age': 34.5,
            'name': 'The Definitive Guide to Django: Web Development Done Right',
        })

        # If an annotation isn't included in the values, it can still be used
        # in a filter
        with ignore_warnings(category=RemovedInDjango31Warning):
            qs = Book.objects.annotate(n_authors=Count('authors')).values('name').filter(n_authors__gt=2)
        self.assertSequenceEqual(
            qs, [
                {"name": 'Python Web Development with Django'}
            ],
        )

        # The annotations are added to values output if values() precedes
        # annotate()
        obj = Book.objects.values('name').annotate(mean_auth_age=Avg('authors__age')).extra(
            select={'price_per_page': 'price / pages'}).get(pk=self.b1.pk)
        self.assertEqual(obj, {
            'mean_auth_age': 34.5,
            'name': 'The Definitive Guide to Django: Web Development Done Right',
        })

        # All of the objects are getting counted (allow_nulls) and that values
        # respects the amount of objects
        self.assertEqual(
            len(Author.objects.annotate(Avg('friends__age')).values()),
            9
        )

        # Consecutive calls to annotate accumulate in the query
        qs = (
            Book.objects
            .values('price')
            .annotate(oldest=Max('authors__age'))
            .order_by('oldest', 'price')
            .annotate(Max('publisher__num_awards'))
        )
        self.assertSequenceEqual(
            qs, [
                {'price': Decimal("30"), 'oldest': 35, 'publisher__num_awards__max': 3},
                {'price': Decimal("29.69"), 'oldest': 37, 'publisher__num_awards__max': 7},
                {'price': Decimal("23.09"), 'oldest': 45, 'publisher__num_awards__max': 1},
                {'price': Decimal("75"), 'oldest': 57, 'publisher__num_awards__max': 9},
                {'price': Decimal("82.8"), 'oldest': 57, 'publisher__num_awards__max': 7}
            ],
        )

    def test_aggregate_annotation(self):
        # Aggregates can be composed over annotations.
        # The return type is derived from the composed aggregate
        vals = (
            Book.objects
            .all()
            .annotate(num_authors=Count('authors__id'))
            .aggregate(Max('pages'), Max('price'), Sum('num_authors'), Avg('num_authors'))
        )
        self.assertEqual(vals, {
            'num_authors__sum': 10,
            'num_authors__avg': Approximate(1.666, places=2),
            'pages__max': 1132,
            'price__max': Decimal("82.80")
        })

        # Regression for #15624 - Missing SELECT columns when using values, annotate
        # and aggregate in a single query
        self.assertEqual(
            Book.objects.annotate(c=Count('authors')).values('c').aggregate(Max('c')),
            {'c__max': 3}
        )

    def test_conditional_aggreate(self):
        # Conditional aggregation of a grouped queryset.
        self.assertEqual(
            Book.objects.annotate(c=Count('authors')).values('pk').aggregate(test=Sum(
                Case(When(c__gt=1, then=1), output_field=IntegerField())
            ))['test'],
            3
        )

    def test_sliced_conditional_aggregate(self):
        self.assertEqual(
            Author.objects.all()[:5].aggregate(test=Sum(Case(
                When(age__lte=35, then=1), output_field=IntegerField()
            )))['test'],
            3
        )

    def test_annotated_conditional_aggregate(self):
        annotated_qs = Book.objects.annotate(discount_price=F('price') * 0.75)
        self.assertAlmostEqual(
            annotated_qs.aggregate(test=Avg(Case(
                When(pages__lt=400, then='discount_price'),
                output_field=DecimalField()
            )))['test'],
            Decimal('22.27'), places=2
        )

    def test_distinct_conditional_aggregate(self):
        self.assertEqual(
            Book.objects.distinct().aggregate(test=Avg(Case(
                When(price=Decimal('29.69'), then='pages'),
                output_field=IntegerField()
            )))['test'],
            325
        )

    def test_conditional_aggregate_on_complex_condition(self):
        self.assertEqual(
            Book.objects.distinct().aggregate(test=Avg(Case(
                When(Q(price__gte=Decimal('29')) & Q(price__lt=Decimal('30')), then='pages'),
                output_field=IntegerField()
            )))['test'],
            325
        )

    def test_decimal_aggregate_annotation_filter(self):
        """
        Filtering on an aggregate annotation with Decimal values should work.
        Requires special handling on SQLite (#18247).
        """
        self.assertEqual(
            len(Author.objects.annotate(sum=Sum('book_contact_set__price')).filter(sum__gt=Decimal(40))),
            1
        )
        self.assertEqual(
            len(Author.objects.annotate(sum=Sum('book_contact_set__price')).filter(sum__lte=Decimal(40))),
            4
        )

    def test_field_error(self):
        # Bad field requests in aggregates are caught and reported
        msg = (
            "Cannot resolve keyword 'foo' into field. Choices are: authors, "
            "contact, contact_id, hardbackbook, id, isbn, name, pages, price, "
            "pubdate, publisher, publisher_id, rating, store, tags"
        )
        with self.assertRaisesMessage(FieldError, msg):
            Book.objects.all().aggregate(num_authors=Count('foo'))

        with self.assertRaisesMessage(FieldError, msg):
            Book.objects.all().annotate(num_authors=Count('foo'))

        msg = (
            "Cannot resolve keyword 'foo' into field. Choices are: authors, "
            "contact, contact_id, hardbackbook, id, isbn, name, num_authors, "
            "pages, price, pubdate, publisher, publisher_id, rating, store, tags"
        )
        with self.assertRaisesMessage(FieldError, msg):
            Book.objects.all().annotate(num_authors=Count('authors__id')).aggregate(Max('foo'))

    @ignore_warnings(category=RemovedInDjango31Warning)
    def test_more(self):
        # Old-style count aggregations can be mixed with new-style
        self.assertEqual(
            Book.objects.annotate(num_authors=Count('authors')).count(),
            6
        )

        # Non-ordinal, non-computed Aggregates over annotations correctly
        # inherit the annotation's internal type if the annotation is ordinal
        # or computed
        vals = Book.objects.annotate(num_authors=Count('authors')).aggregate(Max('num_authors'))
        self.assertEqual(
            vals,
            {'num_authors__max': 3}
        )

        vals = Publisher.objects.annotate(avg_price=Avg('book__price')).aggregate(Max('avg_price'))
        self.assertEqual(
            vals,
            {'avg_price__max': 75.0}
        )

        # Aliases are quoted to protected aliases that might be reserved names
        vals = Book.objects.aggregate(number=Max('pages'), select=Max('pages'))
        self.assertEqual(
            vals,
            {'number': 1132, 'select': 1132}
        )

        # Regression for #10064: select_related() plays nice with aggregates
        obj = Book.objects.select_related('publisher').annotate(
            num_authors=Count('authors')).values().get(isbn='013790395')
        self.assertEqual(obj, {
            'contact_id': self.a8.id,
            'id': self.b5.id,
            'isbn': '013790395',
            'name': 'Artificial Intelligence: A Modern Approach',
            'num_authors': 2,
            'pages': 1132,
            'price': Decimal("82.8"),
            'pubdate': datetime.date(1995, 1, 15),
            'publisher_id': self.p3.id,
            'rating': 4.0,
        })

        # Regression for #10010: exclude on an aggregate field is correctly
        # negated
        self.assertEqual(
            len(Book.objects.annotate(num_authors=Count('authors'))),
            6
        )
        self.assertEqual(
            len(Book.objects.annotate(num_authors=Count('authors')).filter(num_authors__gt=2)),
            1
        )
        self.assertEqual(
            len(Book.objects.annotate(num_authors=Count('authors')).exclude(num_authors__gt=2)),
            5
        )

        self.assertEqual(
            len(
                Book.objects
                .annotate(num_authors=Count('authors'))
                .filter(num_authors__lt=3)
                .exclude(num_authors__lt=2)
            ),
            2
        )
        self.assertEqual(
            len(
                Book.objects
                .annotate(num_authors=Count('authors'))
                .exclude(num_authors__lt=2)
                .filter(num_authors__lt=3)
            ),
            2
        )

    def test_aggregate_fexpr(self):
        # Aggregates can be used with F() expressions
        # ... where the F() is pushed into the HAVING clause
        qs = (
            Publisher.objects
            .annotate(num_books=Count('book'))
            .filter(num_books__lt=F('num_awards') / 2)
            .order_by('name')
            .values('name', 'num_books', 'num_awards')
        )
        self.assertSequenceEqual(
            qs, [
                {'num_books': 1, 'name': 'Morgan Kaufmann', 'num_awards': 9},
                {'num_books': 2, 'name': 'Prentice Hall', 'num_awards': 7}
            ],
        )

        qs = (
            Publisher.objects
            .annotate(num_books=Count('book'))
            .exclude(num_books__lt=F('num_awards') / 2)
            .order_by('name')
            .values('name', 'num_books', 'num_awards')
        )
        self.assertSequenceEqual(
            qs, [
                {'num_books': 2, 'name': 'Apress', 'num_awards': 3},
                {'num_books': 0, 'name': "Jonno's House of Books", 'num_awards': 0},
                {'num_books': 1, 'name': 'Sams', 'num_awards': 1}
            ],
        )

        # ... and where the F() references an aggregate
        qs = (
            Publisher.objects
            .annotate(num_books=Count('book'))
            .filter(num_awards__gt=2 * F('num_books'))
            .order_by('name')
            .values('name', 'num_books', 'num_awards')
        )
        self.assertSequenceEqual(
            qs, [
                {'num_books': 1, 'name': 'Morgan Kaufmann', 'num_awards': 9},
                {'num_books': 2, 'name': 'Prentice Hall', 'num_awards': 7}
            ],
        )

        qs = (
            Publisher.objects
            .annotate(num_books=Count('book'))
            .exclude(num_books__lt=F('num_awards') / 2)
            .order_by('name')
            .values('name', 'num_books', 'num_awards')
        )
        self.assertSequenceEqual(
            qs, [
                {'num_books': 2, 'name': 'Apress', 'num_awards': 3},
                {'num_books': 0, 'name': "Jonno's House of Books", 'num_awards': 0},
                {'num_books': 1, 'name': 'Sams', 'num_awards': 1}
            ],
        )

    def test_db_col_table(self):
        # Tests on fields with non-default table and column names.
        qs = (
            Clues.objects
            .values('EntryID__Entry')
            .annotate(Appearances=Count('EntryID'), Distinct_Clues=Count('Clue', distinct=True))
        )
        self.assertQuerysetEqual(qs, [])

        qs = Entries.objects.annotate(clue_count=Count('clues__ID'))
        self.assertQuerysetEqual(qs, [])

    def test_boolean_conversion(self):
        # Aggregates mixed up ordering of columns for backend's convert_values
        # method. Refs #21126.
        e = Entries.objects.create(Entry='foo')
        c = Clues.objects.create(EntryID=e, Clue='bar')
        qs = Clues.objects.select_related('EntryID').annotate(Count('ID'))
        self.assertSequenceEqual(qs, [c])
        self.assertEqual(qs[0].EntryID, e)
        self.assertIs(qs[0].EntryID.Exclude, False)

    def test_empty(self):
        # Regression for #10089: Check handling of empty result sets with
        # aggregates
        self.assertEqual(
            Book.objects.filter(id__in=[]).count(),
            0
        )

        vals = (
            Book.objects
            .filter(id__in=[])
            .aggregate(
                num_authors=Count('authors'),
                avg_authors=Avg('authors'),
                max_authors=Max('authors'),
                max_price=Max('price'),
                max_rating=Max('rating'),
            )
        )
        self.assertEqual(
            vals,
            {'max_authors': None, 'max_rating': None, 'num_authors': 0, 'avg_authors': None, 'max_price': None}
        )

        qs = (
            Publisher.objects
            .filter(name="Jonno's House of Books")
            .annotate(
                num_authors=Count('book__authors'),
                avg_authors=Avg('book__authors'),
                max_authors=Max('book__authors'),
                max_price=Max('book__price'),
                max_rating=Max('book__rating'),
            ).values()
        )
        self.assertSequenceEqual(
            qs,
            [{
                'max_authors': None,
                'name': "Jonno's House of Books",
                'num_awards': 0,
                'max_price': None,
                'num_authors': 0,
                'max_rating': None,
                'id': self.p5.id,
                'avg_authors': None,
            }],
        )

    def test_more_more(self):
        # Regression for #10113 - Fields mentioned in order_by() must be
        # included in the GROUP BY. This only becomes a problem when the
        # order_by introduces a new join.
        self.assertQuerysetEqual(
            Book.objects.annotate(num_authors=Count('authors')).order_by('publisher__name', 'name'), [
                "Practical Django Projects",
                "The Definitive Guide to Django: Web Development Done Right",
                "Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp",
                "Artificial Intelligence: A Modern Approach",
                "Python Web Development with Django",
                "Sams Teach Yourself Django in 24 Hours",
            ],
            lambda b: b.name
        )

        # Regression for #10127 - Empty select_related() works with annotate
        qs = Book.objects.filter(rating__lt=4.5).select_related().annotate(Avg('authors__age')).order_by('name')
        self.assertQuerysetEqual(
            qs,
            [
                ('Artificial Intelligence: A Modern Approach', 51.5, 'Prentice Hall', 'Peter Norvig'),
                ('Practical Django Projects', 29.0, 'Apress', 'James Bennett'),
                (
                    'Python Web Development with Django',
                    Approximate(30.333, places=2),
                    'Prentice Hall',
                    'Jeffrey Forcier',
                ),
                ('Sams Teach Yourself Django in 24 Hours', 45.0, 'Sams', 'Brad Dayley')
            ],
            lambda b: (b.name, b.authors__age__avg, b.publisher.name, b.contact.name)
        )

        # Regression for #10132 - If the values() clause only mentioned extra
        # (select=) columns, those columns are used for grouping
        qs = Book.objects.extra(select={'pub': 'publisher_id'}).values('pub').annotate(Count('id')).order_by('pub')
        self.assertSequenceEqual(
            qs, [
                {'pub': self.b1.id, 'id__count': 2},
                {'pub': self.b2.id, 'id__count': 1},
                {'pub': self.b3.id, 'id__count': 2},
                {'pub': self.b4.id, 'id__count': 1}
            ],
        )

        qs = (
            Book.objects
            .extra(select={'pub': 'publisher_id', 'foo': 'pages'})
            .values('pub')
            .annotate(Count('id'))
            .order_by('pub')
        )
        self.assertSequenceEqual(
            qs, [
                {'pub': self.p1.id, 'id__count': 2},
                {'pub': self.p2.id, 'id__count': 1},
                {'pub': self.p3.id, 'id__count': 2},
                {'pub': self.p4.id, 'id__count': 1}
            ],
        )

        # Regression for #10182 - Queries with aggregate calls are correctly
        # realiased when used in a subquery
        ids = (
            Book.objects
            .filter(pages__gt=100)
            .annotate(n_authors=Count('authors'))
            .filter(n_authors__gt=2)
            .order_by('n_authors')
        )
        self.assertQuerysetEqual(
            Book.objects.filter(id__in=ids), [
                "Python Web Development with Django",
            ],
            lambda b: b.name
        )

        # Regression for #15709 - Ensure each group_by field only exists once
        # per query
        qstr = str(Book.objects.values('publisher').annotate(max_pages=Max('pages')).order_by().query)
        # There is just one GROUP BY clause (zero commas means at most one clause).
        self.assertEqual(qstr[qstr.index('GROUP BY'):].count(', '), 0)

    def test_duplicate_alias(self):
        # Regression for #11256 - duplicating a default alias raises ValueError.
        msg = (
            "The named annotation 'authors__age__avg' conflicts with "
            "the default name for another annotation."
        )
        with self.assertRaisesMessage(ValueError, msg):
            Book.objects.all().annotate(Avg('authors__age'), authors__age__avg=Avg('authors__age'))

    def test_field_name_conflict(self):
        # Regression for #11256 - providing an aggregate name
        # that conflicts with a field name on the model raises ValueError
        msg = "The annotation 'age' conflicts with a field on the model."
        with self.assertRaisesMessage(ValueError, msg):
            Author.objects.annotate(age=Avg('friends__age'))

    def test_m2m_name_conflict(self):
        # Regression for #11256 - providing an aggregate name
        # that conflicts with an m2m name on the model raises ValueError
        msg = "The annotation 'friends' conflicts with a field on the model."
        with self.assertRaisesMessage(ValueError, msg):
            Author.objects.annotate(friends=Count('friends'))

    def test_fk_attname_conflict(self):
        msg = "The annotation 'contact_id' conflicts with a field on the model."
        with self.assertRaisesMessage(ValueError, msg):
            Book.objects.annotate(contact_id=F('publisher_id'))

    def test_values_queryset_non_conflict(self):
        # Regression for #14707 -- If you're using a values query set, some potential conflicts are avoided.

        # age is a field on Author, so it shouldn't be allowed as an aggregate.
        # But age isn't included in values(), so it is.
        results = Author.objects.values('name').annotate(age=Count('book_contact_set')).order_by('name')
        self.assertEqual(len(results), 9)
        self.assertEqual(results[0]['name'], 'Adrian Holovaty')
        self.assertEqual(results[0]['age'], 1)

        # Same problem, but aggregating over m2m fields
        results = Author.objects.values('name').annotate(age=Avg('friends__age')).order_by('name')
        self.assertEqual(len(results), 9)
        self.assertEqual(results[0]['name'], 'Adrian Holovaty')
        self.assertEqual(results[0]['age'], 32.0)

        # Same problem, but colliding with an m2m field
        results = Author.objects.values('name').annotate(friends=Count('friends')).order_by('name')
        self.assertEqual(len(results), 9)
        self.assertEqual(results[0]['name'], 'Adrian Holovaty')
        self.assertEqual(results[0]['friends'], 2)

    def test_reverse_relation_name_conflict(self):
        # Regression for #11256 - providing an aggregate name
        # that conflicts with a reverse-related name on the model raises ValueError
        msg = "The annotation 'book_contact_set' conflicts with a field on the model."
        with self.assertRaisesMessage(ValueError, msg):
            Author.objects.annotate(book_contact_set=Avg('friends__age'))

    @ignore_warnings(category=RemovedInDjango31Warning)
    def test_pickle(self):
        # Regression for #10197 -- Queries with aggregates can be pickled.
        # First check that pickling is possible at all. No crash = success
        qs = Book.objects.annotate(num_authors=Count('authors'))
        pickle.dumps(qs)

        # Then check that the round trip works.
        query = qs.query.get_compiler(qs.db).as_sql()[0]
        qs2 = pickle.loads(pickle.dumps(qs))
        self.assertEqual(
            qs2.query.get_compiler(qs2.db).as_sql()[0],
            query,
        )

    def test_more_more_more(self):
        # Regression for #10199 - Aggregate calls clone the original query so
        # the original query can still be used
        books = Book.objects.all()
        books.aggregate(Avg("authors__age"))
        self.assertQuerysetEqual(
            books.all(), [
                'Artificial Intelligence: A Modern Approach',
                'Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp',
                'Practical Django Projects',
                'Python Web Development with Django',
                'Sams Teach Yourself Django in 24 Hours',
                'The Definitive Guide to Django: Web Development Done Right'
            ],
            lambda b: b.name
        )

        # Regression for #10248 - Annotations work with dates()
        qs = Book.objects.annotate(num_authors=Count('authors')).filter(num_authors=2).dates('pubdate', 'day')
        self.assertSequenceEqual(
            qs, [
                datetime.date(1995, 1, 15),
                datetime.date(2007, 12, 6),
            ],
        )

        # Regression for #10290 - extra selects with parameters can be used for
        # grouping.
        qs = (
            Book.objects
            .annotate(mean_auth_age=Avg('authors__age'))
            .extra(select={'sheets': '(pages + %s) / %s'}, select_params=[1, 2])
            .order_by('sheets')
            .values('sheets')
        )
        self.assertQuerysetEqual(
            qs, [
                150,
                175,
                224,
                264,
                473,
                566
            ],
            lambda b: int(b["sheets"])
        )

        # Regression for 10425 - annotations don't get in the way of a count()
        # clause
        self.assertEqual(
            Book.objects.values('publisher').annotate(Count('publisher')).count(),
            4
        )
        self.assertEqual(
            Book.objects.annotate(Count('publisher')).values('publisher').count(),
            6
        )

        # Note: intentionally no order_by(), that case needs tests, too.
        publishers = Publisher.objects.filter(id__in=[1, 2])
        self.assertEqual(
            sorted(p.name for p in publishers),
            [
                "Apress",
                "Sams"
            ]
        )

        publishers = publishers.annotate(n_books=Count("book"))
        sorted_publishers = sorted(publishers, key=lambda x: x.name)
        self.assertEqual(
            sorted_publishers[0].n_books,
            2
        )
        self.assertEqual(
            sorted_publishers[1].n_books,
            1
        )

        self.assertEqual(
            sorted(p.name for p in publishers),
            [
                "Apress",
                "Sams"
            ]
        )

        books = Book.objects.filter(publisher__in=publishers)
        self.assertQuerysetEqual(
            books, [
                "Practical Django Projects",
                "Sams Teach Yourself Django in 24 Hours",
                "The Definitive Guide to Django: Web Development Done Right",
            ],
            lambda b: b.name
        )
        self.assertEqual(
            sorted(p.name for p in publishers),
            [
                "Apress",
                "Sams"
            ]
        )

        # Regression for 10666 - inherited fields work with annotations and
        # aggregations
        self.assertEqual(
            HardbackBook.objects.aggregate(n_pages=Sum('book_ptr__pages')),
            {'n_pages': 2078}
        )

        self.assertEqual(
            HardbackBook.objects.aggregate(n_pages=Sum('pages')),
            {'n_pages': 2078},
        )

        qs = HardbackBook.objects.annotate(
            n_authors=Count('book_ptr__authors'),
        ).values('name', 'n_authors').order_by('name')
        self.assertSequenceEqual(
            qs,
            [
                {'n_authors': 2, 'name': 'Artificial Intelligence: A Modern Approach'},
                {
                    'n_authors': 1,
                    'name': 'Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp'
                }
            ],
        )

        qs = HardbackBook.objects.annotate(n_authors=Count('authors')).values('name', 'n_authors').order_by('name')
        self.assertSequenceEqual(
            qs,
            [
                {'n_authors': 2, 'name': 'Artificial Intelligence: A Modern Approach'},
                {
                    'n_authors': 1,
                    'name': 'Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp'
                }
            ],
        )

        # Regression for #10766 - Shouldn't be able to reference an aggregate
        # fields in an aggregate() call.
        msg = "Cannot compute Avg('mean_age'): 'mean_age' is an aggregate"
        with self.assertRaisesMessage(FieldError, msg):
            Book.objects.annotate(mean_age=Avg('authors__age')).annotate(Avg('mean_age'))

    def test_empty_filter_count(self):
        self.assertEqual(
            Author.objects.filter(id__in=[]).annotate(Count("friends")).count(),
            0
        )

    def test_empty_filter_aggregate(self):
        self.assertEqual(
            Author.objects.filter(id__in=[]).annotate(Count("friends")).aggregate(Count("pk")),
            {"pk__count": None}
        )

    def test_none_call_before_aggregate(self):
        # Regression for #11789
        self.assertEqual(
            Author.objects.none().aggregate(Avg('age')),
            {'age__avg': None}
        )

    def test_annotate_and_join(self):
        self.assertEqual(
            Author.objects.annotate(c=Count("friends__name")).exclude(friends__name="Joe").count(),
            Author.objects.count()
        )

    def test_f_expression_annotation(self):
        # Books with less than 200 pages per author.
        qs = Book.objects.values("name").annotate(
            n_authors=Count("authors")
        ).filter(
            pages__lt=F("n_authors") * 200
        ).values_list("pk")
        self.assertQuerysetEqual(
            Book.objects.filter(pk__in=qs), [
                "Python Web Development with Django"
            ],
            attrgetter("name")
        )

    def test_values_annotate_values(self):
        qs = Book.objects.values("name").annotate(
            n_authors=Count("authors")
        ).values_list("pk", flat=True).order_by('name')
        self.assertEqual(list(qs), list(Book.objects.values_list("pk", flat=True)))

    def test_having_group_by(self):
        # When a field occurs on the LHS of a HAVING clause that it
        # appears correctly in the GROUP BY clause
        qs = Book.objects.values_list("name").annotate(
            n_authors=Count("authors")
        ).filter(
            pages__gt=F("n_authors")
        ).values_list("name", flat=True).order_by('name')
        # Results should be the same, all Books have more pages than authors
        self.assertEqual(
            list(qs), list(Book.objects.values_list("name", flat=True))
        )

    def test_values_list_annotation_args_ordering(self):
        """
        Annotate *args ordering should be preserved in values_list results.
        **kwargs comes after *args.
        Regression test for #23659.
        """
        books = Book.objects.values_list("publisher__name").annotate(
            Count("id"), Avg("price"), Avg("authors__age"), avg_pgs=Avg("pages")
        ).order_by("-publisher__name")
        self.assertEqual(books[0], ('Sams', 1, Decimal('23.09'), 45.0, 528.0))

    def test_annotation_disjunction(self):
        qs = Book.objects.annotate(n_authors=Count("authors")).filter(
            Q(n_authors=2) | Q(name="Python Web Development with Django")
        ).order_by('name')
        self.assertQuerysetEqual(
            qs, [
                "Artificial Intelligence: A Modern Approach",
                "Python Web Development with Django",
                "The Definitive Guide to Django: Web Development Done Right",
            ],
            attrgetter("name")
        )

        qs = (
            Book.objects
            .annotate(n_authors=Count("authors"))
            .filter(
                Q(name="The Definitive Guide to Django: Web Development Done Right") |
                (Q(name="Artificial Intelligence: A Modern Approach") & Q(n_authors=3))
            )
        ).order_by('name')
        self.assertQuerysetEqual(
            qs,
            [
                "The Definitive Guide to Django: Web Development Done Right",
            ],
            attrgetter("name")
        )

        qs = Publisher.objects.annotate(
            rating_sum=Sum("book__rating"),
            book_count=Count("book")
        ).filter(
            Q(rating_sum__gt=5.5) | Q(rating_sum__isnull=True)
        ).order_by('pk')
        self.assertQuerysetEqual(
            qs, [
                "Apress",
                "Prentice Hall",
                "Jonno's House of Books",
            ],
            attrgetter("name")
        )

        qs = Publisher.objects.annotate(
            rating_sum=Sum("book__rating"),
            book_count=Count("book")
        ).filter(
            Q(rating_sum__gt=F("book_count")) | Q(rating_sum=None)
        ).order_by("num_awards")
        self.assertQuerysetEqual(
            qs, [
                "Jonno's House of Books",
                "Sams",
                "Apress",
                "Prentice Hall",
                "Morgan Kaufmann"
            ],
            attrgetter("name")
        )

    def test_quoting_aggregate_order_by(self):
        qs = Book.objects.filter(
            name="Python Web Development with Django"
        ).annotate(
            authorCount=Count("authors")
        ).order_by("authorCount")
        self.assertQuerysetEqual(
            qs, [
                ("Python Web Development with Django", 3),
            ],
            lambda b: (b.name, b.authorCount)
        )

    def test_stddev(self):
        self.assertEqual(
            Book.objects.aggregate(StdDev('pages')),
            {'pages__stddev': Approximate(311.46, 1)}
        )

        self.assertEqual(
            Book.objects.aggregate(StdDev('rating')),
            {'rating__stddev': Approximate(0.60, 1)}
        )

        self.assertEqual(
            Book.objects.aggregate(StdDev('price')),
            {'price__stddev': Approximate(Decimal('24.16'), 2)}
        )

        self.assertEqual(
            Book.objects.aggregate(StdDev('pages', sample=True)),
            {'pages__stddev': Approximate(341.19, 2)}
        )

        self.assertEqual(
            Book.objects.aggregate(StdDev('rating', sample=True)),
            {'rating__stddev': Approximate(0.66, 2)}
        )

        self.assertEqual(
            Book.objects.aggregate(StdDev('price', sample=True)),
            {'price__stddev': Approximate(Decimal('26.46'), 1)}
        )

        self.assertEqual(
            Book.objects.aggregate(Variance('pages')),
            {'pages__variance': Approximate(97010.80, 1)}
        )

        self.assertEqual(
            Book.objects.aggregate(Variance('rating')),
            {'rating__variance': Approximate(0.36, 1)}
        )

        self.assertEqual(
            Book.objects.aggregate(Variance('price')),
            {'price__variance': Approximate(Decimal('583.77'), 1)}
        )

        self.assertEqual(
            Book.objects.aggregate(Variance('pages', sample=True)),
            {'pages__variance': Approximate(116412.96, 1)}
        )

        self.assertEqual(
            Book.objects.aggregate(Variance('rating', sample=True)),
            {'rating__variance': Approximate(0.44, 2)}
        )

        self.assertEqual(
            Book.objects.aggregate(Variance('price', sample=True)),
            {'price__variance': Approximate(Decimal('700.53'), 2)}
        )

    def test_filtering_by_annotation_name(self):
        # Regression test for #14476

        # The name of the explicitly provided annotation name in this case
        # poses no problem
        qs = Author.objects.annotate(book_cnt=Count('book')).filter(book_cnt=2).order_by('name')
        self.assertQuerysetEqual(
            qs,
            ['Peter Norvig'],
            lambda b: b.name
        )
        # Neither in this case
        qs = Author.objects.annotate(book_count=Count('book')).filter(book_count=2).order_by('name')
        self.assertQuerysetEqual(
            qs,
            ['Peter Norvig'],
            lambda b: b.name
        )
        # This case used to fail because the ORM couldn't resolve the
        # automatically generated annotation name `book__count`
        qs = Author.objects.annotate(Count('book')).filter(book__count=2).order_by('name')
        self.assertQuerysetEqual(
            qs,
            ['Peter Norvig'],
            lambda b: b.name
        )
        # Referencing the auto-generated name in an aggregate() also works.
        self.assertEqual(
            Author.objects.annotate(Count('book')).aggregate(Max('book__count')),
            {'book__count__max': 2}
        )

    @ignore_warnings(category=RemovedInDjango31Warning)
    def test_annotate_joins(self):
        """
        The base table's join isn't promoted to LOUTER. This could
        cause the query generation to fail if there is an exclude() for fk-field
        in the query, too. Refs #19087.
        """
        qs = Book.objects.annotate(n=Count('pk'))
        self.assertIs(qs.query.alias_map['aggregation_regress_book'].join_type, None)
        # The query executes without problems.
        self.assertEqual(len(qs.exclude(publisher=-1)), 6)

    @skipUnlessAnyDBFeature('allows_group_by_pk', 'allows_group_by_selected_pks')
    def test_aggregate_duplicate_columns(self):
        # Regression test for #17144

        results = Author.objects.annotate(num_contacts=Count('book_contact_set'))

        # There should only be one GROUP BY clause, for the `id` column.
        # `name` and `age` should not be grouped on.
        _, _, group_by = results.query.get_compiler(using='default').pre_sql_setup()
        self.assertEqual(len(group_by), 1)
        self.assertIn('id', group_by[0][0])
        self.assertNotIn('name', group_by[0][0])
        self.assertNotIn('age', group_by[0][0])
        self.assertEqual(
            [(a.name, a.num_contacts) for a in results.order_by('name')],
            [
                ('Adrian Holovaty', 1),
                ('Brad Dayley', 1),
                ('Jacob Kaplan-Moss', 0),
                ('James Bennett', 1),
                ('Jeffrey Forcier', 1),
                ('Paul Bissex', 0),
                ('Peter Norvig', 2),
                ('Stuart Russell', 0),
                ('Wesley J. Chun', 0),
            ]
        )

    @skipUnlessAnyDBFeature('allows_group_by_pk', 'allows_group_by_selected_pks')
    def test_aggregate_duplicate_columns_only(self):
        # Works with only() too.
        results = Author.objects.only('id', 'name').annotate(num_contacts=Count('book_contact_set'))
        _, _, grouping = results.query.get_compiler(using='default').pre_sql_setup()
        self.assertEqual(len(grouping), 1)
        self.assertIn('id', grouping[0][0])
        self.assertNotIn('name', grouping[0][0])
        self.assertNotIn('age', grouping[0][0])
        self.assertEqual(
            [(a.name, a.num_contacts) for a in results.order_by('name')],
            [
                ('Adrian Holovaty', 1),
                ('Brad Dayley', 1),
                ('Jacob Kaplan-Moss', 0),
                ('James Bennett', 1),
                ('Jeffrey Forcier', 1),
                ('Paul Bissex', 0),
                ('Peter Norvig', 2),
                ('Stuart Russell', 0),
                ('Wesley J. Chun', 0),
            ]
        )

    @skipUnlessAnyDBFeature('allows_group_by_pk', 'allows_group_by_selected_pks')
    def test_aggregate_duplicate_columns_select_related(self):
        # And select_related()
        results = Book.objects.select_related('contact').annotate(
            num_authors=Count('authors'))
        _, _, grouping = results.query.get_compiler(using='default').pre_sql_setup()
        # In the case of `group_by_selected_pks` we also group by contact.id because of the select_related.
        self.assertEqual(len(grouping), 1 if connection.features.allows_group_by_pk else 2)
        self.assertIn('id', grouping[0][0])
        self.assertNotIn('name', grouping[0][0])
        self.assertNotIn('contact', grouping[0][0])
        self.assertEqual(
            [(b.name, b.num_authors) for b in results.order_by('name')],
            [
                ('Artificial Intelligence: A Modern Approach', 2),
                ('Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp', 1),
                ('Practical Django Projects', 1),
                ('Python Web Development with Django', 3),
                ('Sams Teach Yourself Django in 24 Hours', 1),
                ('The Definitive Guide to Django: Web Development Done Right', 2)
            ]
        )

    @skipUnlessDBFeature('allows_group_by_selected_pks')
    def test_aggregate_ummanaged_model_columns(self):
        """
        Unmanaged models are sometimes used to represent database views which
        may not allow grouping by selected primary key.
        """
        def assertQuerysetResults(queryset):
            self.assertEqual(
                [(b.name, b.num_authors) for b in queryset.order_by('name')],
                [
                    ('Artificial Intelligence: A Modern Approach', 2),
                    ('Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp', 1),
                    ('Practical Django Projects', 1),
                    ('Python Web Development with Django', 3),
                    ('Sams Teach Yourself Django in 24 Hours', 1),
                    ('The Definitive Guide to Django: Web Development Done Right', 2),
                ]
            )
        queryset = Book.objects.select_related('contact').annotate(num_authors=Count('authors'))
        # Unmanaged origin model.
        with mock.patch.object(Book._meta, 'managed', False):
            _, _, grouping = queryset.query.get_compiler(using='default').pre_sql_setup()
            self.assertEqual(len(grouping), len(Book._meta.fields) + 1)
            for index, field in enumerate(Book._meta.fields):
                self.assertIn(field.name, grouping[index][0])
            self.assertIn(Author._meta.pk.name, grouping[-1][0])
            assertQuerysetResults(queryset)
        # Unmanaged related model.
        with mock.patch.object(Author._meta, 'managed', False):
            _, _, grouping = queryset.query.get_compiler(using='default').pre_sql_setup()
            self.assertEqual(len(grouping), len(Author._meta.fields) + 1)
            self.assertIn(Book._meta.pk.name, grouping[0][0])
            for index, field in enumerate(Author._meta.fields):
                self.assertIn(field.name, grouping[index + 1][0])
            assertQuerysetResults(queryset)

    def test_reverse_join_trimming(self):
        qs = Author.objects.annotate(Count('book_contact_set__contact'))
        self.assertIn(' JOIN ', str(qs.query))

    def test_aggregation_with_generic_reverse_relation(self):
        """
        Regression test for #10870:  Aggregates with joins ignore extra
        filters provided by setup_joins

        tests aggregations with generic reverse relations
        """
        django_book = Book.objects.get(name='Practical Django Projects')
        ItemTag.objects.create(
            object_id=django_book.id, tag='intermediate',
            content_type=ContentType.objects.get_for_model(django_book),
        )
        ItemTag.objects.create(
            object_id=django_book.id, tag='django',
            content_type=ContentType.objects.get_for_model(django_book),
        )
        # Assign a tag to model with same PK as the book above. If the JOIN
        # used in aggregation doesn't have content type as part of the
        # condition the annotation will also count the 'hi mom' tag for b.
        wmpk = WithManualPK.objects.create(id=django_book.pk)
        ItemTag.objects.create(
            object_id=wmpk.id, tag='hi mom',
            content_type=ContentType.objects.get_for_model(wmpk),
        )
        ai_book = Book.objects.get(name__startswith='Paradigms of Artificial Intelligence')
        ItemTag.objects.create(
            object_id=ai_book.id, tag='intermediate',
            content_type=ContentType.objects.get_for_model(ai_book),
        )

        self.assertEqual(Book.objects.aggregate(Count('tags')), {'tags__count': 3})
        results = Book.objects.annotate(Count('tags')).order_by('-tags__count', 'name')
        self.assertEqual(
            [(b.name, b.tags__count) for b in results],
            [
                ('Practical Django Projects', 2),
                ('Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp', 1),
                ('Artificial Intelligence: A Modern Approach', 0),
                ('Python Web Development with Django', 0),
                ('Sams Teach Yourself Django in 24 Hours', 0),
                ('The Definitive Guide to Django: Web Development Done Right', 0)
            ]
        )

    def test_negated_aggregation(self):
        expected_results = Author.objects.exclude(
            pk__in=Author.objects.annotate(book_cnt=Count('book')).filter(book_cnt=2)
        ).order_by('name')
        expected_results = [a.name for a in expected_results]
        qs = Author.objects.annotate(book_cnt=Count('book')).exclude(
            Q(book_cnt=2), Q(book_cnt=2)).order_by('name')
        self.assertQuerysetEqual(
            qs,
            expected_results,
            lambda b: b.name
        )
        expected_results = Author.objects.exclude(
            pk__in=Author.objects.annotate(book_cnt=Count('book')).filter(book_cnt=2)
        ).order_by('name')
        expected_results = [a.name for a in expected_results]
        qs = Author.objects.annotate(book_cnt=Count('book')).exclude(Q(book_cnt=2) | Q(book_cnt=2)).order_by('name')
        self.assertQuerysetEqual(
            qs,
            expected_results,
            lambda b: b.name
        )

    def test_name_filters(self):
        qs = Author.objects.annotate(Count('book')).filter(
            Q(book__count__exact=2) | Q(name='Adrian Holovaty')
        ).order_by('name')
        self.assertQuerysetEqual(
            qs,
            ['Adrian Holovaty', 'Peter Norvig'],
            lambda b: b.name
        )

    def test_name_expressions(self):
        # Aggregates are spotted correctly from F objects.
        # Note that Adrian's age is 34 in the fixtures, and he has one book
        # so both conditions match one author.
        qs = Author.objects.annotate(Count('book')).filter(
            Q(name='Peter Norvig') | Q(age=F('book__count') + 33)
        ).order_by('name')
        self.assertQuerysetEqual(
            qs,
            ['Adrian Holovaty', 'Peter Norvig'],
            lambda b: b.name
        )

    def test_ticket_11293(self):
        q1 = Q(price__gt=50)
        q2 = Q(authors__count__gt=1)
        query = Book.objects.annotate(Count('authors')).filter(
            q1 | q2).order_by('pk')
        self.assertQuerysetEqual(
            query, [1, 4, 5, 6],
            lambda b: b.pk)

    def test_ticket_11293_q_immutable(self):
        """
        Splitting a q object to parts for where/having doesn't alter
        the original q-object.
        """
        q1 = Q(isbn='')
        q2 = Q(authors__count__gt=1)
        query = Book.objects.annotate(Count('authors'))
        query.filter(q1 | q2)
        self.assertEqual(len(q2.children), 1)

    @ignore_warnings(category=RemovedInDjango31Warning)
    def test_fobj_group_by(self):
        """
        An F() object referring to related column works correctly in group by.
        """
        qs = Book.objects.annotate(
            account=Count('authors')
        ).filter(
            account=F('publisher__num_awards')
        )
        self.assertQuerysetEqual(
            qs, ['Sams Teach Yourself Django in 24 Hours'],
            lambda b: b.name)

    def test_annotate_reserved_word(self):
        """
        Regression #18333 - Ensure annotated column name is properly quoted.
        """
        vals = Book.objects.annotate(select=Count('authors__id')).aggregate(Sum('select'), Avg('select'))
        self.assertEqual(vals, {
            'select__sum': 10,
            'select__avg': Approximate(1.666, places=2),
        })

    def test_annotate_on_relation(self):
        book = Book.objects.annotate(avg_price=Avg('price'), publisher_name=F('publisher__name')).get(pk=self.b1.pk)
        self.assertEqual(book.avg_price, 30.00)
        self.assertEqual(book.publisher_name, "Apress")

    def test_aggregate_on_relation(self):
        # A query with an existing annotation aggregation on a relation should
        # succeed.
        qs = Book.objects.annotate(avg_price=Avg('price')).aggregate(
            publisher_awards=Sum('publisher__num_awards')
        )
        self.assertEqual(qs['publisher_awards'], 30)

    def test_annotate_distinct_aggregate(self):
        # There are three books with rating of 4.0 and two of the books have
        # the same price. Hence, the distinct removes one rating of 4.0
        # from the results.
        vals1 = Book.objects.values('rating', 'price').distinct().aggregate(result=Sum('rating'))
        vals2 = Book.objects.aggregate(result=Sum('rating') - Value(4.0))
        self.assertEqual(vals1, vals2)

    def test_annotate_values_list_flat(self):
        """Find ages that are shared by at least two authors."""
        qs = Author.objects.values_list('age', flat=True).annotate(age_count=Count('age')).filter(age_count__gt=1)
        self.assertSequenceEqual(qs, [29])

    def test_allow_distinct(self):
        class MyAggregate(Aggregate):
            pass
        with self.assertRaisesMessage(TypeError, 'MyAggregate does not allow distinct'):
            MyAggregate('foo', distinct=True)

        class DistinctAggregate(Aggregate):
            allow_distinct = True
        DistinctAggregate('foo', distinct=True)


File: tests/aggregation_regress/tests.py
Line number range: 1511 - 1541
Content:
class JoinPromotionTests(TestCase):
    def test_ticket_21150(self):
        b = Bravo.objects.create()
        c = Charlie.objects.create(bravo=b)
        qs = Charlie.objects.select_related('alfa').annotate(Count('bravo__charlie'))
        self.assertSequenceEqual(qs, [c])
        self.assertIs(qs[0].alfa, None)
        a = Alfa.objects.create()
        c.alfa = a
        c.save()
        # Force re-evaluation
        qs = qs.all()
        self.assertSequenceEqual(qs, [c])
        self.assertEqual(qs[0].alfa, a)

    def test_existing_join_not_promoted(self):
        # No promotion for existing joins
        qs = Charlie.objects.filter(alfa__name__isnull=False).annotate(Count('alfa__name'))
        self.assertIn(' INNER JOIN ', str(qs.query))
        # Also, the existing join is unpromoted when doing filtering for already
        # promoted join.
        qs = Charlie.objects.annotate(Count('alfa__name')).filter(alfa__name__isnull=False)
        self.assertIn(' INNER JOIN ', str(qs.query))
        # But, as the join is nullable first use by annotate will be LOUTER
        qs = Charlie.objects.annotate(Count('alfa__name'))
        self.assertIn(' LEFT OUTER JOIN ', str(qs.query))

    @ignore_warnings(category=RemovedInDjango31Warning)
    def test_non_nullable_fk_not_promoted(self):
        qs = Book.objects.annotate(Count('contact__name'))
        self.assertIn(' INNER JOIN ', str(qs.query))


File: tests/aggregation_regress/tests.py
Line number range: 1544 - 1553
Content:
class SelfReferentialFKTests(TestCase):
    def test_ticket_24748(self):
        t1 = SelfRefFK.objects.create(name='t1')
        SelfRefFK.objects.create(name='t2', parent=t1)
        SelfRefFK.objects.create(name='t3', parent=t1)
        self.assertQuerysetEqual(
            SelfRefFK.objects.annotate(num_children=Count('children')).order_by('name'),
            [('t1', 2), ('t2', 0), ('t3', 0)],
            lambda x: (x.name, x.num_children)
        )


File: tests/expressions/tests.py
Line number range: 1 - 500
Content:
1. import datetime
2. import pickle
3. import unittest
4. import uuid
5. from copy import deepcopy
6. 
7. from django.core.exceptions import FieldError
8. from django.db import DatabaseError, connection, models
9. from django.db.models import CharField, Q, TimeField, UUIDField
10. from django.db.models.aggregates import (
11.     Avg, Count, Max, Min, StdDev, Sum, Variance,
12. )
13. from django.db.models.expressions import (
14.     Case, Col, Combinable, Exists, Expression, ExpressionList,
15.     ExpressionWrapper, F, Func, OrderBy, OuterRef, Random, RawSQL, Ref,
16.     Subquery, Value, When,
17. )
18. from django.db.models.functions import (
19.     Coalesce, Concat, Length, Lower, Substr, Upper,
20. )
21. from django.db.models.sql import constants
22. from django.db.models.sql.datastructures import Join
23. from django.test import SimpleTestCase, TestCase, skipUnlessDBFeature
24. from django.test.utils import Approximate
25. 
26. from .models import (
27.     UUID, UUIDPK, Company, Employee, Experiment, Number, RemoteEmployee,
28.     Result, SimulationRun, Time,
29. )
30. 
31. 
32. class BasicExpressionsTests(TestCase):
33.     @classmethod
34.     def setUpTestData(cls):
35.         cls.example_inc = Company.objects.create(
36.             name="Example Inc.", num_employees=2300, num_chairs=5,
37.             ceo=Employee.objects.create(firstname="Joe", lastname="Smith", salary=10)
38.         )
39.         cls.foobar_ltd = Company.objects.create(
40.             name="Foobar Ltd.", num_employees=3, num_chairs=4,
41.             ceo=Employee.objects.create(firstname="Frank", lastname="Meyer", salary=20)
42.         )
43.         cls.max = Employee.objects.create(firstname='Max', lastname='Mustermann', salary=30)
44.         cls.gmbh = Company.objects.create(name='Test GmbH', num_employees=32, num_chairs=1, ceo=cls.max)
45. 
46.     def setUp(self):
47.         self.company_query = Company.objects.values(
48.             "name", "num_employees", "num_chairs"
49.         ).order_by(
50.             "name", "num_employees", "num_chairs"
51.         )
52. 
53.     def test_annotate_values_aggregate(self):
54.         companies = Company.objects.annotate(
55.             salaries=F('ceo__salary'),
56.         ).values('num_employees', 'salaries').aggregate(
57.             result=Sum(
58.                 F('salaries') + F('num_employees'),
59.                 output_field=models.IntegerField()
60.             ),
61.         )
62.         self.assertEqual(companies['result'], 2395)
63. 
64.     def test_annotate_values_filter(self):
65.         companies = Company.objects.annotate(
66.             foo=RawSQL('%s', ['value']),
67.         ).filter(foo='value').order_by('name')
68.         self.assertQuerysetEqual(
69.             companies,
70.             ['<Company: Example Inc.>', '<Company: Foobar Ltd.>', '<Company: Test GmbH>'],
71.         )
72. 
73.     @unittest.skipIf(connection.vendor == 'oracle', "Oracle doesn't support using boolean type in SELECT")
74.     def test_filtering_on_annotate_that_uses_q(self):
75.         self.assertEqual(
76.             Company.objects.annotate(
77.                 num_employees_check=ExpressionWrapper(Q(num_employees__gt=3), output_field=models.BooleanField())
78.             ).filter(num_employees_check=True).count(),
79.             2,
80.         )
81. 
82.     def test_filter_inter_attribute(self):
83.         # We can filter on attribute relationships on same model obj, e.g.
84.         # find companies where the number of employees is greater
85.         # than the number of chairs.
86.         self.assertSequenceEqual(
87.             self.company_query.filter(num_employees__gt=F("num_chairs")), [
88.                 {
89.                     "num_chairs": 5,
90.                     "name": "Example Inc.",
91.                     "num_employees": 2300,
92.                 },
93.                 {
94.                     "num_chairs": 1,
95.                     "name": "Test GmbH",
96.                     "num_employees": 32
97.                 },
98.             ],
99.         )
100. 
101.     def test_update(self):
102.         # We can set one field to have the value of another field
103.         # Make sure we have enough chairs
104.         self.company_query.update(num_chairs=F("num_employees"))
105.         self.assertSequenceEqual(
106.             self.company_query, [
107.                 {
108.                     "num_chairs": 2300,
109.                     "name": "Example Inc.",
110.                     "num_employees": 2300
111.                 },
112.                 {
113.                     "num_chairs": 3,
114.                     "name": "Foobar Ltd.",
115.                     "num_employees": 3
116.                 },
117.                 {
118.                     "num_chairs": 32,
119.                     "name": "Test GmbH",
120.                     "num_employees": 32
121.                 }
122.             ],
123.         )
124. 
125.     def test_arithmetic(self):
126.         # We can perform arithmetic operations in expressions
127.         # Make sure we have 2 spare chairs
128.         self.company_query.update(num_chairs=F("num_employees") + 2)
129.         self.assertSequenceEqual(
130.             self.company_query, [
131.                 {
132.                     'num_chairs': 2302,
133.                     'name': 'Example Inc.',
134.                     'num_employees': 2300
135.                 },
136.                 {
137.                     'num_chairs': 5,
138.                     'name': 'Foobar Ltd.',
139.                     'num_employees': 3
140.                 },
141.                 {
142.                     'num_chairs': 34,
143.                     'name': 'Test GmbH',
144.                     'num_employees': 32
145.                 }
146.             ],
147.         )
148. 
149.     def test_order_of_operations(self):
150.         # Law of order of operations is followed
151.         self.company_query.update(num_chairs=F('num_employees') + 2 * F('num_employees'))
152.         self.assertSequenceEqual(
153.             self.company_query, [
154.                 {
155.                     'num_chairs': 6900,
156.                     'name': 'Example Inc.',
157.                     'num_employees': 2300
158.                 },
159.                 {
160.                     'num_chairs': 9,
161.                     'name': 'Foobar Ltd.',
162.                     'num_employees': 3
163.                 },
164.                 {
165.                     'num_chairs': 96,
166.                     'name': 'Test GmbH',
167.                     'num_employees': 32
168.                 }
169.             ],
170.         )
171. 
172.     def test_parenthesis_priority(self):
173.         # Law of order of operations can be overridden by parentheses
174.         self.company_query.update(num_chairs=(F('num_employees') + 2) * F('num_employees'))
175.         self.assertSequenceEqual(
176.             self.company_query, [
177.                 {
178.                     'num_chairs': 5294600,
179.                     'name': 'Example Inc.',
180.                     'num_employees': 2300
181.                 },
182.                 {
183.                     'num_chairs': 15,
184.                     'name': 'Foobar Ltd.',
185.                     'num_employees': 3
186.                 },
187.                 {
188.                     'num_chairs': 1088,
189.                     'name': 'Test GmbH',
190.                     'num_employees': 32
191.                 }
192.             ],
193.         )
194. 
195.     def test_update_with_fk(self):
196.         # ForeignKey can become updated with the value of another ForeignKey.
197.         self.assertEqual(Company.objects.update(point_of_contact=F('ceo')), 3)
198.         self.assertQuerysetEqual(
199.             Company.objects.all(),
200.             ['Joe Smith', 'Frank Meyer', 'Max Mustermann'],
201.             lambda c: str(c.point_of_contact),
202.             ordered=False
203.         )
204. 
205.     def test_update_with_none(self):
206.         Number.objects.create(integer=1, float=1.0)
207.         Number.objects.create(integer=2)
208.         Number.objects.filter(float__isnull=False).update(float=Value(None))
209.         self.assertQuerysetEqual(
210.             Number.objects.all(),
211.             [None, None],
212.             lambda n: n.float,
213.             ordered=False
214.         )
215. 
216.     def test_filter_with_join(self):
217.         # F Expressions can also span joins
218.         Company.objects.update(point_of_contact=F('ceo'))
219.         c = Company.objects.first()
220.         c.point_of_contact = Employee.objects.create(firstname="Guido", lastname="van Rossum")
221.         c.save()
222. 
223.         self.assertQuerysetEqual(
224.             Company.objects.filter(ceo__firstname=F('point_of_contact__firstname')),
225.             ['Foobar Ltd.', 'Test GmbH'],
226.             lambda c: c.name,
227.             ordered=False
228.         )
229. 
230.         Company.objects.exclude(
231.             ceo__firstname=F("point_of_contact__firstname")
232.         ).update(name="foo")
233.         self.assertEqual(
234.             Company.objects.exclude(
235.                 ceo__firstname=F('point_of_contact__firstname')
236.             ).get().name,
237.             "foo",
238.         )
239. 
240.         msg = "Joined field references are not permitted in this query"
241.         with self.assertRaisesMessage(FieldError, msg):
242.             Company.objects.exclude(
243.                 ceo__firstname=F('point_of_contact__firstname')
244.             ).update(name=F('point_of_contact__lastname'))
245. 
246.     def test_object_update(self):
247.         # F expressions can be used to update attributes on single objects
248.         self.gmbh.num_employees = F('num_employees') + 4
249.         self.gmbh.save()
250.         self.gmbh.refresh_from_db()
251.         self.assertEqual(self.gmbh.num_employees, 36)
252. 
253.     def test_new_object_save(self):
254.         # We should be able to use Funcs when inserting new data
255.         test_co = Company(name=Lower(Value('UPPER')), num_employees=32, num_chairs=1, ceo=self.max)
256.         test_co.save()
257.         test_co.refresh_from_db()
258.         self.assertEqual(test_co.name, "upper")
259. 
260.     def test_new_object_create(self):
261.         test_co = Company.objects.create(name=Lower(Value('UPPER')), num_employees=32, num_chairs=1, ceo=self.max)
262.         test_co.refresh_from_db()
263.         self.assertEqual(test_co.name, "upper")
264. 
265.     def test_object_create_with_aggregate(self):
266.         # Aggregates are not allowed when inserting new data
267.         with self.assertRaisesMessage(FieldError, 'Aggregate functions are not allowed in this query'):
268.             Company.objects.create(
269.                 name='Company', num_employees=Max(Value(1)), num_chairs=1,
270.                 ceo=Employee.objects.create(firstname="Just", lastname="Doit", salary=30),
271.             )
272. 
273.     def test_object_update_fk(self):
274.         # F expressions cannot be used to update attributes which are foreign
275.         # keys, or attributes which involve joins.
276.         test_gmbh = Company.objects.get(pk=self.gmbh.pk)
277.         msg = 'F(ceo)": "Company.point_of_contact" must be a "Employee" instance.'
278.         with self.assertRaisesMessage(ValueError, msg):
279.             test_gmbh.point_of_contact = F('ceo')
280. 
281.         test_gmbh.point_of_contact = self.gmbh.ceo
282.         test_gmbh.save()
283.         test_gmbh.name = F('ceo__last_name')
284.         msg = 'Joined field references are not permitted in this query'
285.         with self.assertRaisesMessage(FieldError, msg):
286.             test_gmbh.save()
287. 
288.     def test_update_inherited_field_value(self):
289.         msg = 'Joined field references are not permitted in this query'
290.         with self.assertRaisesMessage(FieldError, msg):
291.             RemoteEmployee.objects.update(adjusted_salary=F('salary') * 5)
292. 
293.     def test_object_update_unsaved_objects(self):
294.         # F expressions cannot be used to update attributes on objects which do
295.         # not yet exist in the database
296.         acme = Company(name='The Acme Widget Co.', num_employees=12, num_chairs=5, ceo=self.max)
297.         acme.num_employees = F("num_employees") + 16
298.         msg = (
299.             'Failed to insert expression "Col(expressions_company, '
300.             'expressions.Company.num_employees) + Value(16)" on '
301.             'expressions.Company.num_employees. F() expressions can only be '
302.             'used to update, not to insert.'
303.         )
304.         with self.assertRaisesMessage(ValueError, msg):
305.             acme.save()
306. 
307.         acme.num_employees = 12
308.         acme.name = Lower(F('name'))
309.         msg = (
310.             'Failed to insert expression "Lower(Col(expressions_company, '
311.             'expressions.Company.name))" on expressions.Company.name. F() '
312.             'expressions can only be used to update, not to insert.'
313.         )
314.         with self.assertRaisesMessage(ValueError, msg):
315.             acme.save()
316. 
317.     def test_ticket_11722_iexact_lookup(self):
318.         Employee.objects.create(firstname="John", lastname="Doe")
319.         Employee.objects.create(firstname="Test", lastname="test")
320. 
321.         queryset = Employee.objects.filter(firstname__iexact=F('lastname'))
322.         self.assertQuerysetEqual(queryset, ["<Employee: Test test>"])
323. 
324.     def test_ticket_16731_startswith_lookup(self):
325.         Employee.objects.create(firstname="John", lastname="Doe")
326.         e2 = Employee.objects.create(firstname="Jack", lastname="Jackson")
327.         e3 = Employee.objects.create(firstname="Jack", lastname="jackson")
328.         self.assertSequenceEqual(
329.             Employee.objects.filter(lastname__startswith=F('firstname')),
330.             [e2, e3] if connection.features.has_case_insensitive_like else [e2]
331.         )
332.         qs = Employee.objects.filter(lastname__istartswith=F('firstname')).order_by('pk')
333.         self.assertSequenceEqual(qs, [e2, e3])
334. 
335.     def test_ticket_18375_join_reuse(self):
336.         # Reverse multijoin F() references and the lookup target the same join.
337.         # Pre #18375 the F() join was generated first and the lookup couldn't
338.         # reuse that join.
339.         qs = Employee.objects.filter(company_ceo_set__num_chairs=F('company_ceo_set__num_employees'))
340.         self.assertEqual(str(qs.query).count('JOIN'), 1)
341. 
342.     def test_ticket_18375_kwarg_ordering(self):
343.         # The next query was dict-randomization dependent - if the "gte=1"
344.         # was seen first, then the F() will reuse the join generated by the
345.         # gte lookup, if F() was seen first, then it generated a join the
346.         # other lookups could not reuse.
347.         qs = Employee.objects.filter(
348.             company_ceo_set__num_chairs=F('company_ceo_set__num_employees'),
349.             company_ceo_set__num_chairs__gte=1,
350.         )
351.         self.assertEqual(str(qs.query).count('JOIN'), 1)
352. 
353.     def test_ticket_18375_kwarg_ordering_2(self):
354.         # Another similar case for F() than above. Now we have the same join
355.         # in two filter kwargs, one in the lhs lookup, one in F. Here pre
356.         # #18375 the amount of joins generated was random if dict
357.         # randomization was enabled, that is the generated query dependent
358.         # on which clause was seen first.
359.         qs = Employee.objects.filter(
360.             company_ceo_set__num_employees=F('pk'),
361.             pk=F('company_ceo_set__num_employees')
362.         )
363.         self.assertEqual(str(qs.query).count('JOIN'), 1)
364. 
365.     def test_ticket_18375_chained_filters(self):
366.         # F() expressions do not reuse joins from previous filter.
367.         qs = Employee.objects.filter(
368.             company_ceo_set__num_employees=F('pk')
369.         ).filter(
370.             company_ceo_set__num_employees=F('company_ceo_set__num_employees')
371.         )
372.         self.assertEqual(str(qs.query).count('JOIN'), 2)
373. 
374.     def test_order_by_exists(self):
375.         mary = Employee.objects.create(firstname='Mary', lastname='Mustermann', salary=20)
376.         mustermanns_by_seniority = Employee.objects.filter(lastname='Mustermann').order_by(
377.             # Order by whether the employee is the CEO of a company
378.             Exists(Company.objects.filter(ceo=OuterRef('pk'))).desc()
379.         )
380.         self.assertSequenceEqual(mustermanns_by_seniority, [self.max, mary])
381. 
382.     def test_outerref(self):
383.         inner = Company.objects.filter(point_of_contact=OuterRef('pk'))
384.         msg = (
385.             'This queryset contains a reference to an outer query and may only '
386.             'be used in a subquery.'
387.         )
388.         with self.assertRaisesMessage(ValueError, msg):
389.             inner.exists()
390. 
391.         outer = Employee.objects.annotate(is_point_of_contact=Exists(inner))
392.         self.assertIs(outer.exists(), True)
393. 
394.     def test_exist_single_field_output_field(self):
395.         queryset = Company.objects.values('pk')
396.         self.assertIsInstance(Exists(queryset).output_field, models.BooleanField)
397. 
398.     def test_subquery(self):
399.         Company.objects.filter(name='Example Inc.').update(
400.             point_of_contact=Employee.objects.get(firstname='Joe', lastname='Smith'),
401.             ceo=self.max,
402.         )
403.         Employee.objects.create(firstname='Bob', lastname='Brown', salary=40)
404.         qs = Employee.objects.annotate(
405.             is_point_of_contact=Exists(Company.objects.filter(point_of_contact=OuterRef('pk'))),
406.             is_not_point_of_contact=~Exists(Company.objects.filter(point_of_contact=OuterRef('pk'))),
407.             is_ceo_of_small_company=Exists(Company.objects.filter(num_employees__lt=200, ceo=OuterRef('pk'))),
408.             is_ceo_small_2=~~Exists(Company.objects.filter(num_employees__lt=200, ceo=OuterRef('pk'))),
409.             largest_company=Subquery(Company.objects.order_by('-num_employees').filter(
410.                 models.Q(ceo=OuterRef('pk')) | models.Q(point_of_contact=OuterRef('pk'))
411.             ).values('name')[:1], output_field=models.CharField())
412.         ).values(
413.             'firstname',
414.             'is_point_of_contact',
415.             'is_not_point_of_contact',
416.             'is_ceo_of_small_company',
417.             'is_ceo_small_2',
418.             'largest_company',
419.         ).order_by('firstname')
420. 
421.         results = list(qs)
422.         # Could use Coalesce(subq, Value('')) instead except for the bug in
423.         # cx_Oracle mentioned in #23843.
424.         bob = results[0]
425.         if bob['largest_company'] == '' and connection.features.interprets_empty_strings_as_nulls:
426.             bob['largest_company'] = None
427. 
428.         self.assertEqual(results, [
429.             {
430.                 'firstname': 'Bob',
431.                 'is_point_of_contact': False,
432.                 'is_not_point_of_contact': True,
433.                 'is_ceo_of_small_company': False,
434.                 'is_ceo_small_2': False,
435.                 'largest_company': None,
436.             },
437.             {
438.                 'firstname': 'Frank',
439.                 'is_point_of_contact': False,
440.                 'is_not_point_of_contact': True,
441.                 'is_ceo_of_small_company': True,
442.                 'is_ceo_small_2': True,
443.                 'largest_company': 'Foobar Ltd.',
444.             },
445.             {
446.                 'firstname': 'Joe',
447.                 'is_point_of_contact': True,
448.                 'is_not_point_of_contact': False,
449.                 'is_ceo_of_small_company': False,
450.                 'is_ceo_small_2': False,
451.                 'largest_company': 'Example Inc.',
452.             },
453.             {
454.                 'firstname': 'Max',
455.                 'is_point_of_contact': False,
456.                 'is_not_point_of_contact': True,
457.                 'is_ceo_of_small_company': True,
458.                 'is_ceo_small_2': True,
459.                 'largest_company': 'Example Inc.'
460.             }
461.         ])
462.         # A less elegant way to write the same query: this uses a LEFT OUTER
463.         # JOIN and an IS NULL, inside a WHERE NOT IN which is probably less
464.         # efficient than EXISTS.
465.         self.assertCountEqual(
466.             qs.filter(is_point_of_contact=True).values('pk'),
467.             Employee.objects.exclude(company_point_of_contact_set=None).values('pk')
468.         )
469. 
470.     def test_in_subquery(self):
471.         # This is a contrived test (and you really wouldn't write this query),
472.         # but it is a succinct way to test the __in=Subquery() construct.
473.         small_companies = Company.objects.filter(num_employees__lt=200).values('pk')
474.         subquery_test = Company.objects.filter(pk__in=Subquery(small_companies))
475.         self.assertCountEqual(subquery_test, [self.foobar_ltd, self.gmbh])
476.         subquery_test2 = Company.objects.filter(pk=Subquery(small_companies.filter(num_employees=3)))
477.         self.assertCountEqual(subquery_test2, [self.foobar_ltd])
478. 
479.     def test_uuid_pk_subquery(self):
480.         u = UUIDPK.objects.create()
481.         UUID.objects.create(uuid_fk=u)
482.         qs = UUIDPK.objects.filter(id__in=Subquery(UUID.objects.values('uuid_fk__id')))
483.         self.assertCountEqual(qs, [u])
484. 
485.     def test_nested_subquery(self):
486.         inner = Company.objects.filter(point_of_contact=OuterRef('pk'))
487.         outer = Employee.objects.annotate(is_point_of_contact=Exists(inner))
488.         contrived = Employee.objects.annotate(
489.             is_point_of_contact=Subquery(
490.                 outer.filter(pk=OuterRef('pk')).values('is_point_of_contact'),
491.                 output_field=models.BooleanField(),
492.             ),
493.         )
494.         self.assertCountEqual(contrived.values_list(), outer.values_list())
495. 
496.     def test_nested_subquery_outer_ref_2(self):
497.         first = Time.objects.create(time='09:00')
498.         second = Time.objects.create(time='17:00')
499.         third = Time.objects.create(time='21:00')
500.         SimulationRun.objects.bulk_create([

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-23 18:48:51,450 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='The user requested the full content of `tests/aggregation_regress/tests.py`. This context contains the beginning of the file, including imports and test data setup.', relative_path='tests/aggregation_regress/tests.py', start_line=1, end_line=500), ContextOutput(reasoning='The user requested the full content of `tests/aggregation_regress/tests.py`. This context contains the main body of the tests in the `AggregationTests` class.', relative_path='tests/aggregation_regress/tests.py', start_line=27, end_line=1508), ContextOutput(reasoning='The user requested the full content of `tests/aggregation_regress/tests.py`. This context contains the `JoinPromotionTests` class.', relative_path='tests/aggregation_regress/tests.py', start_line=1511, end_line=1541), ContextOutput(reasoning='The user requested the full content of `tests/aggregation_regress/tests.py`. This context contains the `SelfReferentialFKTests` class.', relative_path='tests/aggregation_regress/tests.py', start_line=1544, end_line=1553), ContextOutput(reasoning='The user requested the full content of `tests/expressions/tests.py`. This context contains the first 500 lines of the file.', relative_path='tests/expressions/tests.py', start_line=1, end_line=500)]
2025-12-23 18:48:51,454 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 5 contexts to memory for query: Please provide the full content of `tests/aggregation_regress/tests.py` and `tests/expressions/tests.py`.
2025-12-23 18:48:51,454 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-23 18:48:51,455 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-23 18:48:51,455 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 5 new contexts to 3 existing contexts
2025-12-23 18:48:51,455 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 8 total contexts (removed 0 duplicates)
2025-12-23 18:48:51,456 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── bin
|   |   └── django-admin.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── bin
|   |   |   |   └── compress.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   ├── options.py
|   |   |   |   └── widgets.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── ar
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── mn
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sv
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── templates
|   |   |   |   ├── sitemap.xml
|   |   |   |   └── sitemap_index.xml
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── memcached.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   └── __init__.py
|   |   |   ├── database.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── utils.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   ├── special.py
|   |   |   |   └── utils.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── topological_sort.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── autoreload.py
|   |   ├── baseconv.py
|   |   ├── cache.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── datetime_safe.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── lru_cache.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── six.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           ├── default_urlconf.html
|           ├── technical_404.html
|           ├── technical_500.html
|           └── technical_500.txt
├── docs
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   ├── genindex.html
|   |   |   ├── layout.html
|   |   |   ├── modindex.html
|   |   |   ├── search.html
|   |   |   └── static
|   |   |       ├── console-tabs.css
|   |   |       ├── default.css
|   |   |       ├── djangodocs.css
|   |   |       ├── fontawesome
|   |   |       ├── homepage.css
|   |   |       └── reset-fonts-grids.css
|   |   └── djangodocs-epub
|   |       ├── epub-cover.html
|   |       └── static
|   |           └── epub.css
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── auth-remote-user.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-tags.txt
|   |   ├── deployment
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── jython.txt
|   |   ├── legacy-databases.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.txt
|   |   ├── index.txt
|   |   └── security.txt
|   └── topics
|       ├── _images
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── RelatedObjectLookups.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   ├── jsi18n-mocks.test.js
|   |   └── timeparse.test.js
|   ├── gis
|   |   └── mapwidget.test.js
|   ├── qunit
|   |   ├── qunit.css
|   |   └── qunit.js
|   └── tests.html
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   └── commands
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       └── noargs_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── admin
    |   |   |   ├── admin_views
    |   |   |   └── base_site.html
    |   |   └── custom_filter_template.html
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_forms.py
    |   ├── test_multidb.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── default_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   └── with_last_login_attr.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   |   ├── auth_attrs_access.html
    |   |   |   ├── auth_attrs_messages.html
    |   |   |   ├── auth_attrs_no_access.html
    |   |   |   ├── auth_attrs_perm_in_perms.html
    |   |   |   ├── auth_attrs_perms.html
    |   |   |   ├── auth_attrs_test_access.html
    |   |   |   └── auth_attrs_user.html
    |   |   └── registration
    |   |       ├── html_password_reset_email.html
    |   |       ├── logged_out.html
    |   |       ├── login.html
    |   |       ├── password_change_form.html
    |   |       ├── password_reset_complete.html
    |   |       ├── password_reset_confirm.html
    |   |       ├── password_reset_done.html
    |   |       ├── password_reset_email.html
    |   |       ├── password_reset_form.html
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_remote_user.py
    |   ├── test_remote_user_deprecation.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── test_base.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_introspection.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   └── commands
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   └── tests.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   └── tests.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_error_handlers.py
    |       ├── beginning_with_slash.py
    |       ├── contains_tuple.py
    |       ├── good_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   └── ending_with_dollar.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── choices
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   |       ├── debug.html
    |   |       └── request_attrs.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_greatest.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_round.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   └── test_postgresql_psycopg2.py
    ├── decorators
    |   ├── __init__.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── fixture2.xml
    |   |   ├── fixture3.xml
    |   |   ├── fixture7.xml
    |   |   └── fixture9.xml
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   |   └── fixture2.xml
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── animal.xml
    |   |   ├── bad_fixture2.xml
    |   |   ├── nk-inheritance2.xml
    |   |   ├── non_natural_2.xml
    |   |   ├── pretty.xml
    |   |   └── sequence_extra_xml.xml
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   |   └── default.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   |       └── custom_widget.html
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   |       ├── article_form.html
    |   |       └── custom_widget.html
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   |       └── using.html
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   ├── about.html
    |   |   |   ├── apple_detail.html
    |   |   |   ├── artist_detail.html
    |   |   |   ├── artist_form.html
    |   |   |   ├── author_confirm_delete.html
    |   |   |   ├── author_detail.html
    |   |   |   ├── author_form.html
    |   |   |   ├── author_list.html
    |   |   |   ├── author_objects.html
    |   |   |   ├── author_view.html
    |   |   |   ├── book_archive.html
    |   |   |   ├── book_archive_day.html
    |   |   |   ├── book_archive_month.html
    |   |   |   ├── book_archive_week.html
    |   |   |   ├── book_archive_year.html
    |   |   |   ├── book_detail.html
    |   |   |   ├── book_list.html
    |   |   |   ├── confirm_delete.html
    |   |   |   ├── detail.html
    |   |   |   ├── form.html
    |   |   |   ├── list.html
    |   |   |   ├── page_template.html
    |   |   |   ├── robots.txt
    |   |   |   └── using.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   └── test_srs.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── admin.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── maps
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   |   └── test_handler.html
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   |   └── ignored.html
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   |   └── media_ignored.html
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   ├── javascript_ignored.js
    |   |   |   └── static_ignored.html
    |   |   └── templates
    |   |       ├── empty.html
    |   |       ├── subdir
    |   |       ├── test.html
    |   |       └── xxx_ignored.html
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── models.py
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   |   ├── 404.html
    |   |   |   └── dummy.html
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   |   └── percents.html
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_introspection.py
    |   ├── test_json.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests
    |   ├── __init__.py
    |   ├── test_data_upload_settings.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   ├── test_file_charset.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   |       └── using.html
    |   ├── templates
    |   |   └── shortcuts
    |   |       ├── render_test.html
    |   |       └── using.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── custom_sitemap.xml
    |   |   └── custom_sitemap_index.xml
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   ├── test_management.py
    |   ├── test_utils.py
    |   └── urls
    |       ├── __init__.py
    |       ├── empty.py
    |       ├── http.py
    |       ├── https.py
    |       └── index_only.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── absolute_root.css
    |   |   |   ├── cached
    |   |   |   ├── styles_root.css
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   |   └── faulty.css
    |   |   ├── loop
    |   |   |   ├── bar.css
    |   |   |   └── foo.css
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   |       ├── description.html
    |   |       ├── description_context.html
    |   |       ├── title.html
    |   |       └── title_context.html
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   |       └── hello.html
    |   ├── jinja2
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       ├── syntax_error.html
    |   |       └── syntax_error2.html
    |   ├── template_strings
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       └── syntax_error.html
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_loader
    |   |       ├── goodbye.html
    |   |       ├── hello.html
    |   |       └── request.html
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   |       └── using.html
    |   ├── other_templates
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   └── test_dirs.html
    |   ├── recursive_templates
    |   |   ├── fs
    |   |   |   ├── extend-missing.html
    |   |   |   ├── one.html
    |   |   |   ├── other-recursive.html
    |   |   |   ├── recursive.html
    |   |   |   ├── self.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── fs2
    |   |   |   └── recursive.html
    |   |   └── fs3
    |   |       └── recursive.html
    |   ├── relative_templates
    |   |   ├── dir1
    |   |   |   ├── dir2
    |   |   |   ├── looped.html
    |   |   |   ├── one.html
    |   |   |   ├── one1.html
    |   |   |   ├── one2.html
    |   |   |   ├── one3.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── error_extends.html
    |   |   ├── error_include.html
    |   |   ├── one.html
    |   |   ├── three.html
    |   |   └── two.html
    |   ├── syntax_tests
    |   |   ├── __init__.py
    |   |   ├── i18n
    |   |   |   ├── __init__.py
    |   |   |   ├── base.py
    |   |   |   ├── test_blocktrans.py
    |   |   |   ├── test_filters.py
    |   |   |   ├── test_get_available_languages.py
    |   |   |   ├── test_get_current_language.py
    |   |   |   ├── test_get_current_language_bidi.py
    |   |   |   ├── test_get_language_info.py
    |   |   |   ├── test_get_language_info_list.py
    |   |   |   ├── test_language.py
    |   |   |   ├── test_trans.py
    |   |   |   └── test_underscore_syntax.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_basic.py
    |   |   ├── test_builtins.py
    |   |   ├── test_cache.py
    |   |   ├── test_comment.py
    |   |   ├── test_cycle.py
    |   |   ├── test_exceptions.py
    |   |   ├── test_extends.py
    |   |   ├── test_filter_syntax.py
    |   |   ├── test_filter_tag.py
    |   |   ├── test_firstof.py
    |   |   ├── test_for.py
    |   |   ├── test_if.py
    |   |   ├── test_if_changed.py
    |   |   ├── test_if_equal.py
    |   |   ├── test_include.py
    |   |   ├── test_invalid_string.py
    |   |   ├── test_list_index.py
    |   |   ├── test_load.py
    |   |   ├── test_lorem.py
    |   |   ├── test_multiline.py
    |   |   ├── test_named_endblock.py
    |   |   ├── test_now.py
    |   |   ├── test_numpy.py
    |   |   ├── test_regroup.py
    |   |   ├── test_resetcycle.py
    |   |   ├── test_setup.py
    |   |   ├── test_simple_tag.py
    |   |   ├── test_spaceless.py
    |   |   ├── test_static.py
    |   |   ├── test_template_tag.py
    |   |   ├── test_url.py
    |   |   ├── test_verbatim.py
    |   |   ├── test_width_ratio.py
    |   |   └── test_with.py
    |   ├── templates
    |   |   ├── 27584_child.html
    |   |   ├── 27584_parent.html
    |   |   ├── 27956_child.html
    |   |   ├── 27956_parent.html
    |   |   ├── broken_base.html
    |   |   ├── first
    |   |   |   └── test.html
    |   |   ├── include_tpl.html
    |   |   ├── included_base.html
    |   |   ├── included_content.html
    |   |   ├── inclusion.html
    |   |   ├── inclusion_base.html
    |   |   ├── inclusion_extends1.html
    |   |   ├── inclusion_extends2.html
    |   |   ├── index.html
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   ├── recursive_include.html
    |   |   ├── response.html
    |   |   ├── second
    |   |   |   └── test.html
    |   |   ├── ssi include with spaces.html
    |   |   ├── ssi_include.html
    |   |   ├── template_tests
    |   |   |   └── using.html
    |   |   ├── test_context.html
    |   |   ├── test_context_stack.html
    |   |   ├── test_extends_error.html
    |   |   ├── test_incl_tag_use_l10n.html
    |   |   └── test_include_error.html
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   ├── bad_tag.py
    |   |   ├── custom.py
    |   |   ├── inclusion.py
    |   |   ├── subpackage
    |   |   |   ├── __init__.py
    |   |   |   └── echo.py
    |   |   ├── tag_27584.py
    |   |   └── testtags.py
    |   ├── test_base.py
    |   ├── test_callables.py
    |   ├── test_context.py
    |   ├── test_custom.py
    |   ├── test_engine.py
    |   ├── test_extends.py
    |   ├── test_extends_relative.py
    |   ├── test_library.py
    |   ├── test_loaders.py
    |   ├── test_logging.py
    |   ├── test_nodelist.py
    |   ├── test_origin.py
    |   ├── test_parser.py
    |   ├── test_response.py
    |   ├── test_smartif.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── utils.py
    |   └── views.py
    ├── templates
    |   ├── base.html
    |   ├── comments
    |   |   └── comment_notification_email.txt
    |   ├── custom_admin
    |   |   ├── add_form.html
    |   |   ├── app_index.html
    |   |   ├── change_form.html
    |   |   ├── change_list.html
    |   |   ├── delete_confirmation.html
    |   |   ├── delete_selected_confirmation.html
    |   |   ├── index.html
    |   |   ├── login.html
    |   |   ├── logout.html
    |   |   ├── object_history.html
    |   |   ├── password_change_done.html
    |   |   ├── password_change_form.html
    |   |   └── popup_response.html
    |   ├── extended.html
    |   ├── form_view.html
    |   ├── login.html
    |   └── views
    |       ├── article_archive_day.html
    |       ├── article_archive_month.html
    |       ├── article_confirm_delete.html
    |       ├── article_detail.html
    |       ├── article_form.html
    |       ├── article_list.html
    |       ├── datearticle_archive_month.html
    |       ├── urlarticle_detail.html
    |       └── urlarticle_form.html
    ├── test_client
    |   ├── __init__.py
    |   ├── auth_backends.py
    |   ├── test_conditional_content_removal.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── test_client_regress
    |   ├── __init__.py
    |   ├── auth_backends.py
    |   ├── bad_templates
    |   |   └── 404.html
    |   ├── context_processors.py
    |   ├── models.py
    |   ├── session.py
    |   ├── templates
    |   |   ├── request_context.html
    |   |   └── unicode.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── test_exceptions
    |   ├── __init__.py
    |   └── test_validation_error.py
    ├── test_runner
    |   ├── __init__.py
    |   ├── models.py
    |   ├── runner.py
    |   ├── test_debug_sql.py
    |   ├── test_discover_runner.py
    |   ├── test_parallel.py
    |   └── tests.py
    ├── test_runner_apps
    |   ├── __init__.py
    |   ├── databases
    |   |   ├── __init__.py
    |   |   └── tests.py
    |   ├── sample
    |   |   ├── __init__.py
    |   |   ├── doctests.py
    |   |   ├── empty.py
    |   |   ├── pattern_tests.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── tests.py
    |   |   └── tests_sample.py
    |   ├── simple
    |   |   ├── __init__.py
    |   |   └── tests.py
    |   └── tagged
    |       ├── __init__.py
    |       ├── tests.py
    |       └── tests_inheritance.py
    ├── test_sqlite.py
    ├── test_utils
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── templates
    |   |   └── template_used
    |   |       ├── alternative.html
    |   |       ├── base.html
    |   |       ├── extends.html
    |   |       └── include.html
    |   ├── test_deprecated_features.py
    |   ├── test_testcase.py
    |   ├── test_transactiontestcase.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── timezones
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── transaction_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── transactions
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── unmanaged_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── update_only_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── urlpatterns
    |   ├── __init__.py
    |   ├── converter_urls.py
    |   ├── converters.py
    |   ├── included_urls.py
    |   ├── more_urls.py
    |   ├── path_base64_urls.py
    |   ├── path_dynamic_urls.py
    |   ├── path_urls.py
    |   ├── test_resolvers.py
    |   ├── tests.py
    |   └── views.py
    ├── urlpatterns_reverse
    |   ├── __init__.py
    |   ├── erroneous_urls.py
    |   ├── extra_urls.py
    |   ├── included_app_urls.py
    |   ├── included_named_urls.py
    |   ├── included_named_urls2.py
    |   ├── included_namespace_urls.py
    |   ├── included_no_kwargs_urls.py
    |   ├── included_urls.py
    |   ├── included_urls2.py
    |   ├── method_view_urls.py
    |   ├── middleware.py
    |   ├── named_urls.py
    |   ├── named_urls_conflict.py
    |   ├── namespace_urls.py
    |   ├── nested_urls.py
    |   ├── no_urls.py
    |   ├── nonimported_module.py
    |   ├── reverse_lazy_urls.py
    |   ├── test_localeregexdescriptor.py
    |   ├── tests.py
    |   ├── translations
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── urlconf_inner.py
    |   ├── urlconf_outer.py
    |   ├── urls.py
    |   ├── urls_error_handlers.py
    |   ├── urls_error_handlers_callables.py
    |   ├── urls_without_handlers.py
    |   ├── utils.py
    |   ├── views.py
    |   └── views_broken.py
    ├── urls.py
    ├── user_commands
    |   ├── __init__.py
    |   ├── eggs
    |   ├── management
    |   |   └── commands
    |   |       ├── common_args.py
    |   |       ├── dance.py
    |   |       ├── hal.py
    |   |       ├── no_translations.py
    |   |       ├── required_option.py
    |   |       ├── reverse_url.py
    |   |       ├── set_option.py
    |   |       ├── subparser.py
    |   |       └── transaction.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── utils_tests
    |   ├── __init__.py
    |   ├── archives
    |   ├── eggs
    |   ├── files
    |   |   ├── strip_tags1.html
    |   |   └── strip_tags2.txt
    |   ├── models.py
    |   ├── test_archive.py
    |   ├── test_autoreload.py
    |   ├── test_baseconv.py
    |   ├── test_crypto.py
    |   ├── test_datastructures.py
    |   ├── test_dateformat.py
    |   ├── test_dateparse.py
    |   ├── test_datetime_safe.py
    |   ├── test_decorators.py
    |   ├── test_duration.py
    |   ├── test_encoding.py
    |   ├── test_feedgenerator.py
    |   ├── test_functional.py
    |   ├── test_hashable.py
    |   ├── test_html.py
    |   ├── test_http.py
    |   ├── test_inspect.py
    |   ├── test_ipv6.py
    |   ├── test_jslex.py
    |   ├── test_lazyobject.py
    |   ├── test_lorem_ipsum.py
    |   ├── test_module
    |   |   ├── __init__.py
    |   |   ├── another_bad_module.py
    |   |   ├── another_good_module.py
    |   |   ├── bad_module.py
    |   |   ├── child_module
    |   |   |   ├── __init__.py
    |   |   |   └── grandchild_module.py
    |   |   └── good_module.py
    |   ├── test_module_loading.py
    |   ├── test_no_submodule.py
    |   ├── test_numberformat.py
    |   ├── test_os_utils.py
    |   ├── test_regex_helper.py
    |   ├── test_safestring.py
    |   ├── test_simplelazyobject.py
    |   ├── test_termcolors.py
    |   ├── test_text.py
    |   ├── test_timesince.py
    |   ├── test_timezone.py
    |   └── test_tree.py
    ├── validation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_custom_messages.py
    |   ├── test_error_messages.py
    |   ├── test_picklable.py
    |   ├── test_unique.py
    |   ├── test_validators.py
    |   └── tests.py
    ├── validators
    |   ├── __init__.py
    |   ├── invalid_urls.txt
    |   ├── tests.py
    |   └── valid_urls.txt
    ├── version
    |   ├── __init__.py
    |   └── tests.py
    ├── view_tests
    |   ├── __init__.py
    |   ├── app0
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── en
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── fr
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── fr
    |   ├── app3
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── es_AR
    |   ├── app4
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── es_AR
    |   ├── app5
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── fr
    |   ├── default_urls.py
    |   ├── generic_urls.py
    |   ├── locale
    |   |   ├── de
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_GB
    |   |   |   └── LC_MESSAGES
    |   |   ├── es
    |   |   |   └── LC_MESSAGES
    |   |   ├── fr
    |   |   |   └── LC_MESSAGES
    |   |   ├── nl
    |   |   |   └── LC_MESSAGES
    |   |   ├── pt
    |   |   |   └── LC_MESSAGES
    |   |   └── ru
    |   |       └── LC_MESSAGES
    |   ├── media
    |   |   ├── %2F.txt
    |   |   ├── file.txt
    |   |   ├── long-line.txt
    |   |   └── subdir
    |   ├── models.py
    |   ├── regression_21530_urls.py
    |   ├── templates
    |   |   ├── debug
    |   |   |   ├── template_error.html
    |   |   |   └── template_exception.html
    |   |   ├── jsi18n-multi-catalogs.html
    |   |   └── jsi18n.html
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   └── debugtags.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_csrf.py
    |   |   ├── test_debug.py
    |   |   ├── test_defaults.py
    |   |   ├── test_i18n.py
    |   |   ├── test_json.py
    |   |   ├── test_specials.py
    |   |   └── test_static.py
    |   ├── urls.py
    |   └── views.py
    └── wsgi
        ├── __init__.py
        ├── tests.py
        ├── urls.py
        └── wsgi.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Query syntax error with condition and distinct combination

Description: Description
	
A Count annotation containing both a Case condition and a distinct=True param produces a query error on Django 2.2 (whatever the db backend). A space is missing at least (... COUNT(DISTINCTCASE WHEN ...).

Patch information:
diff --git a/django/db/models/aggregates.py b/django/db/models/aggregates.py
index ac0b62d0bf..ea88c54b0d 100644
--- a/django/db/models/aggregates.py
+++ b/django/db/models/aggregates.py
@@ -68,7 +68,7 @@ class Aggregate(Func):
         return []
 
     def as_sql(self, compiler, connection, **extra_context):
-        extra_context['distinct'] = 'DISTINCT' if self.distinct else ''
+        extra_context['distinct'] = 'DISTINCT ' if self.distinct else ''
         if self.filter:
             if connection.features.supports_aggregate_filter_clause:
                 filter_sql, filter_params = self.filter.as_sql(compiler, connection)


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `tests/aggregation/test_filter_argument.py`, `tests/expressions_case/tests.py`, and `tests/aggregation/tests.py`.
Extra Requirements: 
Purpose: I need to analyze the content of these files to identify three suitable test cases that match the user's criteria for demonstrating the bug and its fix.

Previous refined query 2:
Essential Query: Please provide the full content of `tests/aggregation_regress/tests.py` and `tests/expressions/tests.py`.
Extra Requirements: 
Purpose: I need to find test cases that combine `Count`, `distinct`, and `Case` to find the most relevant examples for the user's query, and these files are likely to contain such tests.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: tests/aggregation/test_filter_argument.py
Line number range: 1 - 89
Content:
1. import datetime
2. from decimal import Decimal
3. 
4. from django.db.models import Case, Count, F, Q, Sum, When
5. from django.test import TestCase
6. 
7. from .models import Author, Book, Publisher
8. 
9. 
10. class FilteredAggregateTests(TestCase):
11.     @classmethod
12.     def setUpTestData(cls):
13.         cls.a1 = Author.objects.create(name='test', age=40)
14.         cls.a2 = Author.objects.create(name='test2', age=60)
15.         cls.a3 = Author.objects.create(name='test3', age=100)
16.         cls.p1 = Publisher.objects.create(name='Apress', num_awards=3, duration=datetime.timedelta(days=1))
17.         cls.b1 = Book.objects.create(
18.             isbn='159059725', name='The Definitive Guide to Django: Web Development Done Right',
19.             pages=447, rating=4.5, price=Decimal('30.00'), contact=cls.a1, publisher=cls.p1,
20.             pubdate=datetime.date(2007, 12, 6),
21.         )
22.         cls.b2 = Book.objects.create(
23.             isbn='067232959', name='Sams Teach Yourself Django in 24 Hours',
24.             pages=528, rating=3.0, price=Decimal('23.09'), contact=cls.a2, publisher=cls.p1,
25.             pubdate=datetime.date(2008, 3, 3),
26.         )
27.         cls.b3 = Book.objects.create(
28.             isbn='159059996', name='Practical Django Projects',
29.             pages=600, rating=4.5, price=Decimal('29.69'), contact=cls.a3, publisher=cls.p1,
30.             pubdate=datetime.date(2008, 6, 23),
31.         )
32.         cls.a1.friends.add(cls.a2)
33.         cls.a1.friends.add(cls.a3)
34.         cls.b1.authors.add(cls.a1)
35.         cls.b1.authors.add(cls.a3)
36.         cls.b2.authors.add(cls.a2)
37.         cls.b3.authors.add(cls.a3)
38. 
39.     def test_filtered_aggregates(self):
40.         agg = Sum('age', filter=Q(name__startswith='test'))
41.         self.assertEqual(Author.objects.aggregate(age=agg)['age'], 200)
42. 
43.     def test_double_filtered_aggregates(self):
44.         agg = Sum('age', filter=Q(Q(name='test2') & ~Q(name='test')))
45.         self.assertEqual(Author.objects.aggregate(age=agg)['age'], 60)
46. 
47.     def test_excluded_aggregates(self):
48.         agg = Sum('age', filter=~Q(name='test2'))
49.         self.assertEqual(Author.objects.aggregate(age=agg)['age'], 140)
50. 
51.     def test_related_aggregates_m2m(self):
52.         agg = Sum('friends__age', filter=~Q(friends__name='test'))
53.         self.assertEqual(Author.objects.filter(name='test').aggregate(age=agg)['age'], 160)
54. 
55.     def test_related_aggregates_m2m_and_fk(self):
56.         q = Q(friends__book__publisher__name='Apress') & ~Q(friends__name='test3')
57.         agg = Sum('friends__book__pages', filter=q)
58.         self.assertEqual(Author.objects.filter(name='test').aggregate(pages=agg)['pages'], 528)
59. 
60.     def test_plain_annotate(self):
61.         agg = Sum('book__pages', filter=Q(book__rating__gt=3))
62.         qs = Author.objects.annotate(pages=agg).order_by('pk')
63.         self.assertSequenceEqual([a.pages for a in qs], [447, None, 1047])
64. 
65.     def test_filtered_aggregate_on_annotate(self):
66.         pages_annotate = Sum('book__pages', filter=Q(book__rating__gt=3))
67.         age_agg = Sum('age', filter=Q(total_pages__gte=400))
68.         aggregated = Author.objects.annotate(total_pages=pages_annotate).aggregate(summed_age=age_agg)
69.         self.assertEqual(aggregated, {'summed_age': 140})
70. 
71.     def test_case_aggregate(self):
72.         agg = Sum(
73.             Case(When(friends__age=40, then=F('friends__age'))),
74.             filter=Q(friends__name__startswith='test'),
75.         )
76.         self.assertEqual(Author.objects.aggregate(age=agg)['age'], 80)
77. 
78.     def test_sum_star_exception(self):
79.         msg = 'Star cannot be used with filter. Please specify a field.'
80.         with self.assertRaisesMessage(ValueError, msg):
81.             Count('*', filter=Q(age=40))
82. 
83.     def test_filtered_reused_subquery(self):
84.         qs = Author.objects.annotate(
85.             older_friends_count=Count('friends', filter=Q(friends__age__gt=F('age'))),
86.         ).filter(
87.             older_friends_count__gte=2,
88.         )
89.         self.assertEqual(qs.get(pk__in=qs.values('pk')), self.a1)


File: tests/aggregation/tests.py
Line number range: 1 - 500
Content:
1. import datetime
2. import re
3. from decimal import Decimal
4. 
5. from django.core.exceptions import FieldError
6. from django.db import connection
7. from django.db.models import (
8.     Avg, Count, DecimalField, DurationField, F, FloatField, Func, IntegerField,
9.     Max, Min, Sum, Value,
10. )
11. from django.test import TestCase
12. from django.test.utils import Approximate, CaptureQueriesContext
13. from django.utils import timezone
14. 
15. from .models import Author, Book, Publisher, Store
16. 
17. 
18. class AggregateTestCase(TestCase):
19. 
20.     @classmethod
21.     def setUpTestData(cls):
22.         cls.a1 = Author.objects.create(name='Adrian Holovaty', age=34)
23.         cls.a2 = Author.objects.create(name='Jacob Kaplan-Moss', age=35)
24.         cls.a3 = Author.objects.create(name='Brad Dayley', age=45)
25.         cls.a4 = Author.objects.create(name='James Bennett', age=29)
26.         cls.a5 = Author.objects.create(name='Jeffrey Forcier', age=37)
27.         cls.a6 = Author.objects.create(name='Paul Bissex', age=29)
28.         cls.a7 = Author.objects.create(name='Wesley J. Chun', age=25)
29.         cls.a8 = Author.objects.create(name='Peter Norvig', age=57)
30.         cls.a9 = Author.objects.create(name='Stuart Russell', age=46)
31.         cls.a1.friends.add(cls.a2, cls.a4)
32.         cls.a2.friends.add(cls.a1, cls.a7)
33.         cls.a4.friends.add(cls.a1)
34.         cls.a5.friends.add(cls.a6, cls.a7)
35.         cls.a6.friends.add(cls.a5, cls.a7)
36.         cls.a7.friends.add(cls.a2, cls.a5, cls.a6)
37.         cls.a8.friends.add(cls.a9)
38.         cls.a9.friends.add(cls.a8)
39. 
40.         cls.p1 = Publisher.objects.create(name='Apress', num_awards=3, duration=datetime.timedelta(days=1))
41.         cls.p2 = Publisher.objects.create(name='Sams', num_awards=1, duration=datetime.timedelta(days=2))
42.         cls.p3 = Publisher.objects.create(name='Prentice Hall', num_awards=7)
43.         cls.p4 = Publisher.objects.create(name='Morgan Kaufmann', num_awards=9)
44.         cls.p5 = Publisher.objects.create(name="Jonno's House of Books", num_awards=0)
45. 
46.         cls.b1 = Book.objects.create(
47.             isbn='159059725', name='The Definitive Guide to Django: Web Development Done Right',
48.             pages=447, rating=4.5, price=Decimal('30.00'), contact=cls.a1, publisher=cls.p1,
49.             pubdate=datetime.date(2007, 12, 6)
50.         )
51.         cls.b2 = Book.objects.create(
52.             isbn='067232959', name='Sams Teach Yourself Django in 24 Hours',
53.             pages=528, rating=3.0, price=Decimal('23.09'), contact=cls.a3, publisher=cls.p2,
54.             pubdate=datetime.date(2008, 3, 3)
55.         )
56.         cls.b3 = Book.objects.create(
57.             isbn='159059996', name='Practical Django Projects',
58.             pages=300, rating=4.0, price=Decimal('29.69'), contact=cls.a4, publisher=cls.p1,
59.             pubdate=datetime.date(2008, 6, 23)
60.         )
61.         cls.b4 = Book.objects.create(
62.             isbn='013235613', name='Python Web Development with Django',
63.             pages=350, rating=4.0, price=Decimal('29.69'), contact=cls.a5, publisher=cls.p3,
64.             pubdate=datetime.date(2008, 11, 3)
65.         )
66.         cls.b5 = Book.objects.create(
67.             isbn='013790395', name='Artificial Intelligence: A Modern Approach',
68.             pages=1132, rating=4.0, price=Decimal('82.80'), contact=cls.a8, publisher=cls.p3,
69.             pubdate=datetime.date(1995, 1, 15)
70.         )
71.         cls.b6 = Book.objects.create(
72.             isbn='155860191', name='Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp',
73.             pages=946, rating=5.0, price=Decimal('75.00'), contact=cls.a8, publisher=cls.p4,
74.             pubdate=datetime.date(1991, 10, 15)
75.         )
76.         cls.b1.authors.add(cls.a1, cls.a2)
77.         cls.b2.authors.add(cls.a3)
78.         cls.b3.authors.add(cls.a4)
79.         cls.b4.authors.add(cls.a5, cls.a6, cls.a7)
80.         cls.b5.authors.add(cls.a8, cls.a9)
81.         cls.b6.authors.add(cls.a8)
82. 
83.         s1 = Store.objects.create(
84.             name='Amazon.com',
85.             original_opening=datetime.datetime(1994, 4, 23, 9, 17, 42),
86.             friday_night_closing=datetime.time(23, 59, 59)
87.         )
88.         s2 = Store.objects.create(
89.             name='Books.com',
90.             original_opening=datetime.datetime(2001, 3, 15, 11, 23, 37),
91.             friday_night_closing=datetime.time(23, 59, 59)
92.         )
93.         s3 = Store.objects.create(
94.             name="Mamma and Pappa's Books",
95.             original_opening=datetime.datetime(1945, 4, 25, 16, 24, 14),
96.             friday_night_closing=datetime.time(21, 30)
97.         )
98.         s1.books.add(cls.b1, cls.b2, cls.b3, cls.b4, cls.b5, cls.b6)
99.         s2.books.add(cls.b1, cls.b3, cls.b5, cls.b6)
100.         s3.books.add(cls.b3, cls.b4, cls.b6)
101. 
102.     def test_empty_aggregate(self):
103.         self.assertEqual(Author.objects.all().aggregate(), {})
104. 
105.     def test_aggregate_in_order_by(self):
106.         msg = (
107.             'Using an aggregate in order_by() without also including it in '
108.             'annotate() is not allowed: Avg(F(book__rating)'
109.         )
110.         with self.assertRaisesMessage(FieldError, msg):
111.             Author.objects.values('age').order_by(Avg('book__rating'))
112. 
113.     def test_single_aggregate(self):
114.         vals = Author.objects.aggregate(Avg("age"))
115.         self.assertEqual(vals, {"age__avg": Approximate(37.4, places=1)})
116. 
117.     def test_multiple_aggregates(self):
118.         vals = Author.objects.aggregate(Sum("age"), Avg("age"))
119.         self.assertEqual(vals, {"age__sum": 337, "age__avg": Approximate(37.4, places=1)})
120. 
121.     def test_filter_aggregate(self):
122.         vals = Author.objects.filter(age__gt=29).aggregate(Sum("age"))
123.         self.assertEqual(vals, {'age__sum': 254})
124. 
125.     def test_related_aggregate(self):
126.         vals = Author.objects.aggregate(Avg("friends__age"))
127.         self.assertEqual(vals, {'friends__age__avg': Approximate(34.07, places=2)})
128. 
129.         vals = Book.objects.filter(rating__lt=4.5).aggregate(Avg("authors__age"))
130.         self.assertEqual(vals, {'authors__age__avg': Approximate(38.2857, places=2)})
131. 
132.         vals = Author.objects.all().filter(name__contains="a").aggregate(Avg("book__rating"))
133.         self.assertEqual(vals, {'book__rating__avg': 4.0})
134. 
135.         vals = Book.objects.aggregate(Sum("publisher__num_awards"))
136.         self.assertEqual(vals, {'publisher__num_awards__sum': 30})
137. 
138.         vals = Publisher.objects.aggregate(Sum("book__price"))
139.         self.assertEqual(vals, {'book__price__sum': Decimal('270.27')})
140. 
141.     def test_aggregate_multi_join(self):
142.         vals = Store.objects.aggregate(Max("books__authors__age"))
143.         self.assertEqual(vals, {'books__authors__age__max': 57})
144. 
145.         vals = Author.objects.aggregate(Min("book__publisher__num_awards"))
146.         self.assertEqual(vals, {'book__publisher__num_awards__min': 1})
147. 
148.     def test_aggregate_alias(self):
149.         vals = Store.objects.filter(name="Amazon.com").aggregate(amazon_mean=Avg("books__rating"))
150.         self.assertEqual(vals, {'amazon_mean': Approximate(4.08, places=2)})
151. 
152.     def test_annotate_basic(self):
153.         self.assertQuerysetEqual(
154.             Book.objects.annotate().order_by('pk'), [
155.                 "The Definitive Guide to Django: Web Development Done Right",
156.                 "Sams Teach Yourself Django in 24 Hours",
157.                 "Practical Django Projects",
158.                 "Python Web Development with Django",
159.                 "Artificial Intelligence: A Modern Approach",
160.                 "Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp"
161.             ],
162.             lambda b: b.name
163.         )
164. 
165.         books = Book.objects.annotate(mean_age=Avg("authors__age"))
166.         b = books.get(pk=self.b1.pk)
167.         self.assertEqual(
168.             b.name,
169.             'The Definitive Guide to Django: Web Development Done Right'
170.         )
171.         self.assertEqual(b.mean_age, 34.5)
172. 
173.     def test_annotate_defer(self):
174.         qs = Book.objects.annotate(
175.             page_sum=Sum("pages")).defer('name').filter(pk=self.b1.pk)
176. 
177.         rows = [
178.             (self.b1.id, "159059725", 447, "The Definitive Guide to Django: Web Development Done Right")
179.         ]
180.         self.assertQuerysetEqual(
181.             qs.order_by('pk'), rows,
182.             lambda r: (r.id, r.isbn, r.page_sum, r.name)
183.         )
184. 
185.     def test_annotate_defer_select_related(self):
186.         qs = Book.objects.select_related('contact').annotate(
187.             page_sum=Sum("pages")).defer('name').filter(pk=self.b1.pk)
188. 
189.         rows = [
190.             (self.b1.id, "159059725", 447, "Adrian Holovaty",
191.              "The Definitive Guide to Django: Web Development Done Right")
192.         ]
193.         self.assertQuerysetEqual(
194.             qs.order_by('pk'), rows,
195.             lambda r: (r.id, r.isbn, r.page_sum, r.contact.name, r.name)
196.         )
197. 
198.     def test_annotate_m2m(self):
199.         books = Book.objects.filter(rating__lt=4.5).annotate(Avg("authors__age")).order_by("name")
200.         self.assertQuerysetEqual(
201.             books, [
202.                 ('Artificial Intelligence: A Modern Approach', 51.5),
203.                 ('Practical Django Projects', 29.0),
204.                 ('Python Web Development with Django', Approximate(30.3, places=1)),
205.                 ('Sams Teach Yourself Django in 24 Hours', 45.0)
206.             ],
207.             lambda b: (b.name, b.authors__age__avg),
208.         )
209. 
210.         books = Book.objects.annotate(num_authors=Count("authors")).order_by("name")
211.         self.assertQuerysetEqual(
212.             books, [
213.                 ('Artificial Intelligence: A Modern Approach', 2),
214.                 ('Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp', 1),
215.                 ('Practical Django Projects', 1),
216.                 ('Python Web Development with Django', 3),
217.                 ('Sams Teach Yourself Django in 24 Hours', 1),
218.                 ('The Definitive Guide to Django: Web Development Done Right', 2)
219.             ],
220.             lambda b: (b.name, b.num_authors)
221.         )
222. 
223.     def test_backwards_m2m_annotate(self):
224.         authors = Author.objects.filter(name__contains="a").annotate(Avg("book__rating")).order_by("name")
225.         self.assertQuerysetEqual(
226.             authors, [
227.                 ('Adrian Holovaty', 4.5),
228.                 ('Brad Dayley', 3.0),
229.                 ('Jacob Kaplan-Moss', 4.5),
230.                 ('James Bennett', 4.0),
231.                 ('Paul Bissex', 4.0),
232.                 ('Stuart Russell', 4.0)
233.             ],
234.             lambda a: (a.name, a.book__rating__avg)
235.         )
236. 
237.         authors = Author.objects.annotate(num_books=Count("book")).order_by("name")
238.         self.assertQuerysetEqual(
239.             authors, [
240.                 ('Adrian Holovaty', 1),
241.                 ('Brad Dayley', 1),
242.                 ('Jacob Kaplan-Moss', 1),
243.                 ('James Bennett', 1),
244.                 ('Jeffrey Forcier', 1),
245.                 ('Paul Bissex', 1),
246.                 ('Peter Norvig', 2),
247.                 ('Stuart Russell', 1),
248.                 ('Wesley J. Chun', 1)
249.             ],
250.             lambda a: (a.name, a.num_books)
251.         )
252. 
253.     def test_reverse_fkey_annotate(self):
254.         books = Book.objects.annotate(Sum("publisher__num_awards")).order_by("name")
255.         self.assertQuerysetEqual(
256.             books, [
257.                 ('Artificial Intelligence: A Modern Approach', 7),
258.                 ('Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp', 9),
259.                 ('Practical Django Projects', 3),
260.                 ('Python Web Development with Django', 7),
261.                 ('Sams Teach Yourself Django in 24 Hours', 1),
262.                 ('The Definitive Guide to Django: Web Development Done Right', 3)
263.             ],
264.             lambda b: (b.name, b.publisher__num_awards__sum)
265.         )
266. 
267.         publishers = Publisher.objects.annotate(Sum("book__price")).order_by("name")
268.         self.assertQuerysetEqual(
269.             publishers, [
270.                 ('Apress', Decimal("59.69")),
271.                 ("Jonno's House of Books", None),
272.                 ('Morgan Kaufmann', Decimal("75.00")),
273.                 ('Prentice Hall', Decimal("112.49")),
274.                 ('Sams', Decimal("23.09"))
275.             ],
276.             lambda p: (p.name, p.book__price__sum)
277.         )
278. 
279.     def test_annotate_values(self):
280.         books = list(Book.objects.filter(pk=self.b1.pk).annotate(mean_age=Avg("authors__age")).values())
281.         self.assertEqual(
282.             books, [
283.                 {
284.                     "contact_id": self.a1.id,
285.                     "id": self.b1.id,
286.                     "isbn": "159059725",
287.                     "mean_age": 34.5,
288.                     "name": "The Definitive Guide to Django: Web Development Done Right",
289.                     "pages": 447,
290.                     "price": Approximate(Decimal("30")),
291.                     "pubdate": datetime.date(2007, 12, 6),
292.                     "publisher_id": self.p1.id,
293.                     "rating": 4.5,
294.                 }
295.             ]
296.         )
297. 
298.         books = (
299.             Book.objects
300.             .filter(pk=self.b1.pk)
301.             .annotate(mean_age=Avg('authors__age'))
302.             .values('pk', 'isbn', 'mean_age')
303.         )
304.         self.assertEqual(
305.             list(books), [
306.                 {
307.                     "pk": self.b1.pk,
308.                     "isbn": "159059725",
309.                     "mean_age": 34.5,
310.                 }
311.             ]
312.         )
313. 
314.         books = Book.objects.filter(pk=self.b1.pk).annotate(mean_age=Avg("authors__age")).values("name")
315.         self.assertEqual(
316.             list(books),
317.             [{'name': 'The Definitive Guide to Django: Web Development Done Right'}],
318.         )
319. 
320.         books = Book.objects.filter(pk=self.b1.pk).values().annotate(mean_age=Avg('authors__age'))
321.         self.assertEqual(
322.             list(books), [
323.                 {
324.                     "contact_id": self.a1.id,
325.                     "id": self.b1.id,
326.                     "isbn": "159059725",
327.                     "mean_age": 34.5,
328.                     "name": "The Definitive Guide to Django: Web Development Done Right",
329.                     "pages": 447,
330.                     "price": Approximate(Decimal("30")),
331.                     "pubdate": datetime.date(2007, 12, 6),
332.                     "publisher_id": self.p1.id,
333.                     "rating": 4.5,
334.                 }
335.             ]
336.         )
337. 
338.         books = (
339.             Book.objects
340.             .values("rating")
341.             .annotate(n_authors=Count("authors__id"), mean_age=Avg("authors__age"))
342.             .order_by("rating")
343.         )
344.         self.assertEqual(
345.             list(books), [
346.                 {
347.                     "rating": 3.0,
348.                     "n_authors": 1,
349.                     "mean_age": 45.0,
350.                 },
351.                 {
352.                     "rating": 4.0,
353.                     "n_authors": 6,
354.                     "mean_age": Approximate(37.16, places=1)
355.                 },
356.                 {
357.                     "rating": 4.5,
358.                     "n_authors": 2,
359.                     "mean_age": 34.5,
360.                 },
361.                 {
362.                     "rating": 5.0,
363.                     "n_authors": 1,
364.                     "mean_age": 57.0,
365.                 }
366.             ]
367.         )
368. 
369.         authors = Author.objects.annotate(Avg("friends__age")).order_by("name")
370.         self.assertQuerysetEqual(
371.             authors, [
372.                 ('Adrian Holovaty', 32.0),
373.                 ('Brad Dayley', None),
374.                 ('Jacob Kaplan-Moss', 29.5),
375.                 ('James Bennett', 34.0),
376.                 ('Jeffrey Forcier', 27.0),
377.                 ('Paul Bissex', 31.0),
378.                 ('Peter Norvig', 46.0),
379.                 ('Stuart Russell', 57.0),
380.                 ('Wesley J. Chun', Approximate(33.66, places=1))
381.             ],
382.             lambda a: (a.name, a.friends__age__avg)
383.         )
384. 
385.     def test_count(self):
386.         vals = Book.objects.aggregate(Count("rating"))
387.         self.assertEqual(vals, {"rating__count": 6})
388. 
389.         vals = Book.objects.aggregate(Count("rating", distinct=True))
390.         self.assertEqual(vals, {"rating__count": 4})
391. 
392.     def test_count_star(self):
393.         with self.assertNumQueries(1) as ctx:
394.             Book.objects.aggregate(n=Count("*"))
395.         sql = ctx.captured_queries[0]['sql']
396.         self.assertIn('SELECT COUNT(*) ', sql)
397. 
398.     def test_non_grouped_annotation_not_in_group_by(self):
399.         """
400.         An annotation not included in values() before an aggregate should be
401.         excluded from the group by clause.
402.         """
403.         qs = (
404.             Book.objects.annotate(xprice=F('price')).filter(rating=4.0).values('rating')
405.                 .annotate(count=Count('publisher_id', distinct=True)).values('count', 'rating').order_by('count')
406.         )
407.         self.assertEqual(list(qs), [{'rating': 4.0, 'count': 2}])
408. 
409.     def test_grouped_annotation_in_group_by(self):
410.         """
411.         An annotation included in values() before an aggregate should be
412.         included in the group by clause.
413.         """
414.         qs = (
415.             Book.objects.annotate(xprice=F('price')).filter(rating=4.0).values('rating', 'xprice')
416.                 .annotate(count=Count('publisher_id', distinct=True)).values('count', 'rating').order_by('count')
417.         )
418.         self.assertEqual(
419.             list(qs), [
420.                 {'rating': 4.0, 'count': 1},
421.                 {'rating': 4.0, 'count': 2},
422.             ]
423.         )
424. 
425.     def test_fkey_aggregate(self):
426.         explicit = list(Author.objects.annotate(Count('book__id')))
427.         implicit = list(Author.objects.annotate(Count('book')))
428.         self.assertEqual(explicit, implicit)
429. 
430.     def test_annotate_ordering(self):
431.         books = Book.objects.values('rating').annotate(oldest=Max('authors__age')).order_by('oldest', 'rating')
432.         self.assertEqual(
433.             list(books), [
434.                 {'rating': 4.5, 'oldest': 35},
435.                 {'rating': 3.0, 'oldest': 45},
436.                 {'rating': 4.0, 'oldest': 57},
437.                 {'rating': 5.0, 'oldest': 57},
438.             ]
439.         )
440. 
441.         books = Book.objects.values("rating").annotate(oldest=Max("authors__age")).order_by("-oldest", "-rating")
442.         self.assertEqual(
443.             list(books), [
444.                 {'rating': 5.0, 'oldest': 57},
445.                 {'rating': 4.0, 'oldest': 57},
446.                 {'rating': 3.0, 'oldest': 45},
447.                 {'rating': 4.5, 'oldest': 35},
448.             ]
449.         )
450. 
451.     def test_aggregate_annotation(self):
452.         vals = Book.objects.annotate(num_authors=Count("authors__id")).aggregate(Avg("num_authors"))
453.         self.assertEqual(vals, {"num_authors__avg": Approximate(1.66, places=1)})
454. 
455.     def test_avg_duration_field(self):
456.         # Explicit `output_field`.
457.         self.assertEqual(
458.             Publisher.objects.aggregate(Avg('duration', output_field=DurationField())),
459.             {'duration__avg': datetime.timedelta(days=1, hours=12)}
460.         )
461.         # Implicit `output_field`.
462.         self.assertEqual(
463.             Publisher.objects.aggregate(Avg('duration')),
464.             {'duration__avg': datetime.timedelta(days=1, hours=12)}
465.         )
466. 
467.     def test_sum_duration_field(self):
468.         self.assertEqual(
469.             Publisher.objects.aggregate(Sum('duration', output_field=DurationField())),
470.             {'duration__sum': datetime.timedelta(days=3)}
471.         )
472. 
473.     def test_sum_distinct_aggregate(self):
474.         """
475.         Sum on a distinct() QuerySet should aggregate only the distinct items.
476.         """
477.         authors = Author.objects.filter(book__in=[self.b5, self.b6])
478.         self.assertEqual(authors.count(), 3)
479. 
480.         distinct_authors = authors.distinct()
481.         self.assertEqual(distinct_authors.count(), 2)
482. 
483.         # Selected author ages are 57 and 46
484.         age_sum = distinct_authors.aggregate(Sum('age'))
485.         self.assertEqual(age_sum['age__sum'], 103)
486. 
487.     def test_filtering(self):
488.         p = Publisher.objects.create(name='Expensive Publisher', num_awards=0)
489.         Book.objects.create(
490.             name='ExpensiveBook1',
491.             pages=1,
492.             isbn='111',
493.             rating=3.5,
494.             price=Decimal("1000"),
495.             publisher=p,
496.             contact_id=self.a1.id,
497.             pubdate=datetime.date(2008, 12, 1)
498.         )
499.         Book.objects.create(
500.             name='ExpensiveBook2',


File: tests/aggregation_regress/tests.py
Line number range: 1 - 500
Content:
1. import datetime
2. import pickle
3. from decimal import Decimal
4. from operator import attrgetter
5. from unittest import mock
6. 
7. from django.contrib.contenttypes.models import ContentType
8. from django.core.exceptions import FieldError
9. from django.db import connection
10. from django.db.models import (
11.     Avg, Case, Count, DecimalField, F, IntegerField, Max, Q, StdDev, Sum,
12.     Value, Variance, When,
13. )
14. from django.db.models.aggregates import Aggregate
15. from django.test import (
16.     TestCase, ignore_warnings, skipUnlessAnyDBFeature, skipUnlessDBFeature,
17. )
18. from django.test.utils import Approximate
19. from django.utils.deprecation import RemovedInDjango31Warning
20. 
21. from .models import (
22.     Alfa, Author, Book, Bravo, Charlie, Clues, Entries, HardbackBook, ItemTag,
23.     Publisher, SelfRefFK, Store, WithManualPK,
24. )
25. 
26. 
27. class AggregationTests(TestCase):
28. 
29.     @classmethod
30.     def setUpTestData(cls):
31.         cls.a1 = Author.objects.create(name='Adrian Holovaty', age=34)
32.         cls.a2 = Author.objects.create(name='Jacob Kaplan-Moss', age=35)
33.         cls.a3 = Author.objects.create(name='Brad Dayley', age=45)
34.         cls.a4 = Author.objects.create(name='James Bennett', age=29)
35.         cls.a5 = Author.objects.create(name='Jeffrey Forcier', age=37)
36.         cls.a6 = Author.objects.create(name='Paul Bissex', age=29)
37.         cls.a7 = Author.objects.create(name='Wesley J. Chun', age=25)
38.         cls.a8 = Author.objects.create(name='Peter Norvig', age=57)
39.         cls.a9 = Author.objects.create(name='Stuart Russell', age=46)
40.         cls.a1.friends.add(cls.a2, cls.a4)
41.         cls.a2.friends.add(cls.a1, cls.a7)
42.         cls.a4.friends.add(cls.a1)
43.         cls.a5.friends.add(cls.a6, cls.a7)
44.         cls.a6.friends.add(cls.a5, cls.a7)
45.         cls.a7.friends.add(cls.a2, cls.a5, cls.a6)
46.         cls.a8.friends.add(cls.a9)
47.         cls.a9.friends.add(cls.a8)
48. 
49.         cls.p1 = Publisher.objects.create(name='Apress', num_awards=3)
50.         cls.p2 = Publisher.objects.create(name='Sams', num_awards=1)
51.         cls.p3 = Publisher.objects.create(name='Prentice Hall', num_awards=7)
52.         cls.p4 = Publisher.objects.create(name='Morgan Kaufmann', num_awards=9)
53.         cls.p5 = Publisher.objects.create(name="Jonno's House of Books", num_awards=0)
54. 
55.         cls.b1 = Book.objects.create(
56.             isbn='159059725', name='The Definitive Guide to Django: Web Development Done Right',
57.             pages=447, rating=4.5, price=Decimal('30.00'), contact=cls.a1, publisher=cls.p1,
58.             pubdate=datetime.date(2007, 12, 6)
59.         )
60.         cls.b2 = Book.objects.create(
61.             isbn='067232959', name='Sams Teach Yourself Django in 24 Hours',
62.             pages=528, rating=3.0, price=Decimal('23.09'), contact=cls.a3, publisher=cls.p2,
63.             pubdate=datetime.date(2008, 3, 3)
64.         )
65.         cls.b3 = Book.objects.create(
66.             isbn='159059996', name='Practical Django Projects',
67.             pages=300, rating=4.0, price=Decimal('29.69'), contact=cls.a4, publisher=cls.p1,
68.             pubdate=datetime.date(2008, 6, 23)
69.         )
70.         cls.b4 = Book.objects.create(
71.             isbn='013235613', name='Python Web Development with Django',
72.             pages=350, rating=4.0, price=Decimal('29.69'), contact=cls.a5, publisher=cls.p3,
73.             pubdate=datetime.date(2008, 11, 3)
74.         )
75.         cls.b5 = HardbackBook.objects.create(
76.             isbn='013790395', name='Artificial Intelligence: A Modern Approach',
77.             pages=1132, rating=4.0, price=Decimal('82.80'), contact=cls.a8, publisher=cls.p3,
78.             pubdate=datetime.date(1995, 1, 15), weight=4.5)
79.         cls.b6 = HardbackBook.objects.create(
80.             isbn='155860191', name='Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp',
81.             pages=946, rating=5.0, price=Decimal('75.00'), contact=cls.a8, publisher=cls.p4,
82.             pubdate=datetime.date(1991, 10, 15), weight=3.7)
83.         cls.b1.authors.add(cls.a1, cls.a2)
84.         cls.b2.authors.add(cls.a3)
85.         cls.b3.authors.add(cls.a4)
86.         cls.b4.authors.add(cls.a5, cls.a6, cls.a7)
87.         cls.b5.authors.add(cls.a8, cls.a9)
88.         cls.b6.authors.add(cls.a8)
89. 
90.         s1 = Store.objects.create(
91.             name='Amazon.com',
92.             original_opening=datetime.datetime(1994, 4, 23, 9, 17, 42),
93.             friday_night_closing=datetime.time(23, 59, 59)
94.         )
95.         s2 = Store.objects.create(
96.             name='Books.com',
97.             original_opening=datetime.datetime(2001, 3, 15, 11, 23, 37),
98.             friday_night_closing=datetime.time(23, 59, 59)
99.         )
100.         s3 = Store.objects.create(
101.             name="Mamma and Pappa's Books",
102.             original_opening=datetime.datetime(1945, 4, 25, 16, 24, 14),
103.             friday_night_closing=datetime.time(21, 30)
104.         )
105.         s1.books.add(cls.b1, cls.b2, cls.b3, cls.b4, cls.b5, cls.b6)
106.         s2.books.add(cls.b1, cls.b3, cls.b5, cls.b6)
107.         s3.books.add(cls.b3, cls.b4, cls.b6)
108. 
109.     def assertObjectAttrs(self, obj, **kwargs):
110.         for attr, value in kwargs.items():
111.             self.assertEqual(getattr(obj, attr), value)
112. 
113.     @ignore_warnings(category=RemovedInDjango31Warning)
114.     def test_annotation_with_value(self):
115.         values = Book.objects.filter(
116.             name='Practical Django Projects',
117.         ).annotate(
118.             discount_price=F('price') * 2,
119.         ).values(
120.             'discount_price',
121.         ).annotate(sum_discount=Sum('discount_price'))
122.         self.assertSequenceEqual(
123.             values,
124.             [{'discount_price': Decimal('59.38'), 'sum_discount': Decimal('59.38')}]
125.         )
126. 
127.     def test_aggregates_in_where_clause(self):
128.         """
129.         Regression test for #12822: DatabaseError: aggregates not allowed in
130.         WHERE clause
131. 
132.         The subselect works and returns results equivalent to a
133.         query with the IDs listed.
134. 
135.         Before the corresponding fix for this bug, this test passed in 1.1 and
136.         failed in 1.2-beta (trunk).
137.         """
138.         qs = Book.objects.values('contact').annotate(Max('id'))
139.         qs = qs.order_by('contact').values_list('id__max', flat=True)
140.         # don't do anything with the queryset (qs) before including it as a
141.         # subquery
142.         books = Book.objects.order_by('id')
143.         qs1 = books.filter(id__in=qs)
144.         qs2 = books.filter(id__in=list(qs))
145.         self.assertEqual(list(qs1), list(qs2))
146. 
147.     def test_aggregates_in_where_clause_pre_eval(self):
148.         """
149.         Regression test for #12822: DatabaseError: aggregates not allowed in
150.         WHERE clause
151. 
152.         Same as the above test, but evaluates the queryset for the subquery
153.         before it's used as a subquery.
154. 
155.         Before the corresponding fix for this bug, this test failed in both
156.         1.1 and 1.2-beta (trunk).
157.         """
158.         qs = Book.objects.values('contact').annotate(Max('id'))
159.         qs = qs.order_by('contact').values_list('id__max', flat=True)
160.         # force the queryset (qs) for the subquery to be evaluated in its
161.         # current state
162.         list(qs)
163.         books = Book.objects.order_by('id')
164.         qs1 = books.filter(id__in=qs)
165.         qs2 = books.filter(id__in=list(qs))
166.         self.assertEqual(list(qs1), list(qs2))
167. 
168.     @skipUnlessDBFeature('supports_subqueries_in_group_by')
169.     def test_annotate_with_extra(self):
170.         """
171.         Regression test for #11916: Extra params + aggregation creates
172.         incorrect SQL.
173.         """
174.         # Oracle doesn't support subqueries in group by clause
175.         shortest_book_sql = """
176.         SELECT name
177.         FROM aggregation_regress_book b
178.         WHERE b.publisher_id = aggregation_regress_publisher.id
179.         ORDER BY b.pages
180.         LIMIT 1
181.         """
182.         # tests that this query does not raise a DatabaseError due to the full
183.         # subselect being (erroneously) added to the GROUP BY parameters
184.         qs = Publisher.objects.extra(select={
185.             'name_of_shortest_book': shortest_book_sql,
186.         }).annotate(total_books=Count('book'))
187.         # force execution of the query
188.         list(qs)
189. 
190.     def test_aggregate(self):
191.         # Ordering requests are ignored
192.         self.assertEqual(
193.             Author.objects.order_by("name").aggregate(Avg("age")),
194.             {"age__avg": Approximate(37.444, places=1)}
195.         )
196. 
197.         # Implicit ordering is also ignored
198.         self.assertEqual(
199.             Book.objects.aggregate(Sum("pages")),
200.             {"pages__sum": 3703},
201.         )
202. 
203.         # Baseline results
204.         self.assertEqual(
205.             Book.objects.aggregate(Sum('pages'), Avg('pages')),
206.             {'pages__sum': 3703, 'pages__avg': Approximate(617.166, places=2)}
207.         )
208. 
209.         # Empty values query doesn't affect grouping or results
210.         self.assertEqual(
211.             Book.objects.values().aggregate(Sum('pages'), Avg('pages')),
212.             {'pages__sum': 3703, 'pages__avg': Approximate(617.166, places=2)}
213.         )
214. 
215.         # Aggregate overrides extra selected column
216.         self.assertEqual(
217.             Book.objects.extra(select={'price_per_page': 'price / pages'}).aggregate(Sum('pages')),
218.             {'pages__sum': 3703}
219.         )
220. 
221.     @ignore_warnings(category=RemovedInDjango31Warning)
222.     def test_annotation(self):
223.         # Annotations get combined with extra select clauses
224.         obj = Book.objects.annotate(mean_auth_age=Avg("authors__age")).extra(
225.             select={"manufacture_cost": "price * .5"}).get(pk=self.b2.pk)
226.         self.assertObjectAttrs(
227.             obj,
228.             contact_id=self.a3.id,
229.             isbn='067232959',
230.             mean_auth_age=45.0,
231.             name='Sams Teach Yourself Django in 24 Hours',
232.             pages=528,
233.             price=Decimal("23.09"),
234.             pubdate=datetime.date(2008, 3, 3),
235.             publisher_id=self.p2.id,
236.             rating=3.0
237.         )
238.         # Different DB backends return different types for the extra select computation
239.         self.assertIn(obj.manufacture_cost, (11.545, Decimal('11.545')))
240. 
241.         # Order of the annotate/extra in the query doesn't matter
242.         obj = Book.objects.extra(select={'manufacture_cost': 'price * .5'}).annotate(
243.             mean_auth_age=Avg('authors__age')).get(pk=self.b2.pk)
244.         self.assertObjectAttrs(
245.             obj,
246.             contact_id=self.a3.id,
247.             isbn='067232959',
248.             mean_auth_age=45.0,
249.             name='Sams Teach Yourself Django in 24 Hours',
250.             pages=528,
251.             price=Decimal("23.09"),
252.             pubdate=datetime.date(2008, 3, 3),
253.             publisher_id=self.p2.id,
254.             rating=3.0
255.         )
256.         # Different DB backends return different types for the extra select computation
257.         self.assertIn(obj.manufacture_cost, (11.545, Decimal('11.545')))
258. 
259.         # Values queries can be combined with annotate and extra
260.         obj = Book.objects.annotate(mean_auth_age=Avg('authors__age')).extra(
261.             select={'manufacture_cost': 'price * .5'}).values().get(pk=self.b2.pk)
262.         manufacture_cost = obj['manufacture_cost']
263.         self.assertIn(manufacture_cost, (11.545, Decimal('11.545')))
264.         del obj['manufacture_cost']
265.         self.assertEqual(obj, {
266.             'id': self.b2.id,
267.             'contact_id': self.a3.id,
268.             'isbn': '067232959',
269.             'mean_auth_age': 45.0,
270.             'name': 'Sams Teach Yourself Django in 24 Hours',
271.             'pages': 528,
272.             'price': Decimal('23.09'),
273.             'pubdate': datetime.date(2008, 3, 3),
274.             'publisher_id': self.p2.id,
275.             'rating': 3.0,
276.         })
277. 
278.         # The order of the (empty) values, annotate and extra clauses doesn't
279.         # matter
280.         obj = Book.objects.values().annotate(mean_auth_age=Avg('authors__age')).extra(
281.             select={'manufacture_cost': 'price * .5'}).get(pk=self.b2.pk)
282.         manufacture_cost = obj['manufacture_cost']
283.         self.assertIn(manufacture_cost, (11.545, Decimal('11.545')))
284.         del obj['manufacture_cost']
285.         self.assertEqual(obj, {
286.             'id': self.b2.id,
287.             'contact_id': self.a3.id,
288.             'isbn': '067232959',
289.             'mean_auth_age': 45.0,
290.             'name': 'Sams Teach Yourself Django in 24 Hours',
291.             'pages': 528,
292.             'price': Decimal('23.09'),
293.             'pubdate': datetime.date(2008, 3, 3),
294.             'publisher_id': self.p2.id,
295.             'rating': 3.0
296.         })
297. 
298.         # If the annotation precedes the values clause, it won't be included
299.         # unless it is explicitly named
300.         obj = Book.objects.annotate(mean_auth_age=Avg('authors__age')).extra(
301.             select={'price_per_page': 'price / pages'}).values('name').get(pk=self.b1.pk)
302.         self.assertEqual(obj, {
303.             "name": 'The Definitive Guide to Django: Web Development Done Right',
304.         })
305. 
306.         obj = Book.objects.annotate(mean_auth_age=Avg('authors__age')).extra(
307.             select={'price_per_page': 'price / pages'}).values('name', 'mean_auth_age').get(pk=self.b1.pk)
308.         self.assertEqual(obj, {
309.             'mean_auth_age': 34.5,
310.             'name': 'The Definitive Guide to Django: Web Development Done Right',
311.         })
312. 
313.         # If an annotation isn't included in the values, it can still be used
314.         # in a filter
315.         with ignore_warnings(category=RemovedInDjango31Warning):
316.             qs = Book.objects.annotate(n_authors=Count('authors')).values('name').filter(n_authors__gt=2)
317.         self.assertSequenceEqual(
318.             qs, [
319.                 {"name": 'Python Web Development with Django'}
320.             ],
321.         )
322. 
323.         # The annotations are added to values output if values() precedes
324.         # annotate()
325.         obj = Book.objects.values('name').annotate(mean_auth_age=Avg('authors__age')).extra(
326.             select={'price_per_page': 'price / pages'}).get(pk=self.b1.pk)
327.         self.assertEqual(obj, {
328.             'mean_auth_age': 34.5,
329.             'name': 'The Definitive Guide to Django: Web Development Done Right',
330.         })
331. 
332.         # All of the objects are getting counted (allow_nulls) and that values
333.         # respects the amount of objects
334.         self.assertEqual(
335.             len(Author.objects.annotate(Avg('friends__age')).values()),
336.             9
337.         )
338. 
339.         # Consecutive calls to annotate accumulate in the query
340.         qs = (
341.             Book.objects
342.             .values('price')
343.             .annotate(oldest=Max('authors__age'))
344.             .order_by('oldest', 'price')
345.             .annotate(Max('publisher__num_awards'))
346.         )
347.         self.assertSequenceEqual(
348.             qs, [
349.                 {'price': Decimal("30"), 'oldest': 35, 'publisher__num_awards__max': 3},
350.                 {'price': Decimal("29.69"), 'oldest': 37, 'publisher__num_awards__max': 7},
351.                 {'price': Decimal("23.09"), 'oldest': 45, 'publisher__num_awards__max': 1},
352.                 {'price': Decimal("75"), 'oldest': 57, 'publisher__num_awards__max': 9},
353.                 {'price': Decimal("82.8"), 'oldest': 57, 'publisher__num_awards__max': 7}
354.             ],
355.         )
356. 
357.     def test_aggregate_annotation(self):
358.         # Aggregates can be composed over annotations.
359.         # The return type is derived from the composed aggregate
360.         vals = (
361.             Book.objects
362.             .all()
363.             .annotate(num_authors=Count('authors__id'))
364.             .aggregate(Max('pages'), Max('price'), Sum('num_authors'), Avg('num_authors'))
365.         )
366.         self.assertEqual(vals, {
367.             'num_authors__sum': 10,
368.             'num_authors__avg': Approximate(1.666, places=2),
369.             'pages__max': 1132,
370.             'price__max': Decimal("82.80")
371.         })
372. 
373.         # Regression for #15624 - Missing SELECT columns when using values, annotate
374.         # and aggregate in a single query
375.         self.assertEqual(
376.             Book.objects.annotate(c=Count('authors')).values('c').aggregate(Max('c')),
377.             {'c__max': 3}
378.         )
379. 
380.     def test_conditional_aggreate(self):
381.         # Conditional aggregation of a grouped queryset.
382.         self.assertEqual(
383.             Book.objects.annotate(c=Count('authors')).values('pk').aggregate(test=Sum(
384.                 Case(When(c__gt=1, then=1), output_field=IntegerField())
385.             ))['test'],
386.             3
387.         )
388. 
389.     def test_sliced_conditional_aggregate(self):
390.         self.assertEqual(
391.             Author.objects.all()[:5].aggregate(test=Sum(Case(
392.                 When(age__lte=35, then=1), output_field=IntegerField()
393.             )))['test'],
394.             3
395.         )
396. 
397.     def test_annotated_conditional_aggregate(self):
398.         annotated_qs = Book.objects.annotate(discount_price=F('price') * 0.75)
399.         self.assertAlmostEqual(
400.             annotated_qs.aggregate(test=Avg(Case(
401.                 When(pages__lt=400, then='discount_price'),
402.                 output_field=DecimalField()
403.             )))['test'],
404.             Decimal('22.27'), places=2
405.         )
406. 
407.     def test_distinct_conditional_aggregate(self):
408.         self.assertEqual(
409.             Book.objects.distinct().aggregate(test=Avg(Case(
410.                 When(price=Decimal('29.69'), then='pages'),
411.                 output_field=IntegerField()
412.             )))['test'],
413.             325
414.         )
415. 
416.     def test_conditional_aggregate_on_complex_condition(self):
417.         self.assertEqual(
418.             Book.objects.distinct().aggregate(test=Avg(Case(
419.                 When(Q(price__gte=Decimal('29')) & Q(price__lt=Decimal('30')), then='pages'),
420.                 output_field=IntegerField()
421.             )))['test'],
422.             325
423.         )
424. 
425.     def test_decimal_aggregate_annotation_filter(self):
426.         """
427.         Filtering on an aggregate annotation with Decimal values should work.
428.         Requires special handling on SQLite (#18247).
429.         """
430.         self.assertEqual(
431.             len(Author.objects.annotate(sum=Sum('book_contact_set__price')).filter(sum__gt=Decimal(40))),
432.             1
433.         )
434.         self.assertEqual(
435.             len(Author.objects.annotate(sum=Sum('book_contact_set__price')).filter(sum__lte=Decimal(40))),
436.             4
437.         )
438. 
439.     def test_field_error(self):
440.         # Bad field requests in aggregates are caught and reported
441.         msg = (
442.             "Cannot resolve keyword 'foo' into field. Choices are: authors, "
443.             "contact, contact_id, hardbackbook, id, isbn, name, pages, price, "
444.             "pubdate, publisher, publisher_id, rating, store, tags"
445.         )
446.         with self.assertRaisesMessage(FieldError, msg):
447.             Book.objects.all().aggregate(num_authors=Count('foo'))
448. 
449.         with self.assertRaisesMessage(FieldError, msg):
450.             Book.objects.all().annotate(num_authors=Count('foo'))
451. 
452.         msg = (
453.             "Cannot resolve keyword 'foo' into field. Choices are: authors, "
454.             "contact, contact_id, hardbackbook, id, isbn, name, num_authors, "
455.             "pages, price, pubdate, publisher, publisher_id, rating, store, tags"
456.         )
457.         with self.assertRaisesMessage(FieldError, msg):
458.             Book.objects.all().annotate(num_authors=Count('authors__id')).aggregate(Max('foo'))
459. 
460.     @ignore_warnings(category=RemovedInDjango31Warning)
461.     def test_more(self):
462.         # Old-style count aggregations can be mixed with new-style
463.         self.assertEqual(
464.             Book.objects.annotate(num_authors=Count('authors')).count(),
465.             6
466.         )
467. 
468.         # Non-ordinal, non-computed Aggregates over annotations correctly
469.         # inherit the annotation's internal type if the annotation is ordinal
470.         # or computed
471.         vals = Book.objects.annotate(num_authors=Count('authors')).aggregate(Max('num_authors'))
472.         self.assertEqual(
473.             vals,
474.             {'num_authors__max': 3}
475.         )
476. 
477.         vals = Publisher.objects.annotate(avg_price=Avg('book__price')).aggregate(Max('avg_price'))
478.         self.assertEqual(
479.             vals,
480.             {'avg_price__max': 75.0}
481.         )
482. 
483.         # Aliases are quoted to protected aliases that might be reserved names
484.         vals = Book.objects.aggregate(number=Max('pages'), select=Max('pages'))
485.         self.assertEqual(
486.             vals,
487.             {'number': 1132, 'select': 1132}
488.         )
489. 
490.         # Regression for #10064: select_related() plays nice with aggregates
491.         obj = Book.objects.select_related('publisher').annotate(
492.             num_authors=Count('authors')).values().get(isbn='013790395')
493.         self.assertEqual(obj, {
494.             'contact_id': self.a8.id,
495.             'id': self.b5.id,
496.             'isbn': '013790395',
497.             'name': 'Artificial Intelligence: A Modern Approach',
498.             'num_authors': 2,
499.             'pages': 1132,
500.             'price': Decimal("82.8"),


File: tests/aggregation_regress/tests.py
Line number range: 27 - 1508
Content:
27. class AggregationTests(TestCase):
28. 
29.     @classmethod
30.     def setUpTestData(cls):
31.         cls.a1 = Author.objects.create(name='Adrian Holovaty', age=34)
32.         cls.a2 = Author.objects.create(name='Jacob Kaplan-Moss', age=35)
33.         cls.a3 = Author.objects.create(name='Brad Dayley', age=45)
34.         cls.a4 = Author.objects.create(name='James Bennett', age=29)
35.         cls.a5 = Author.objects.create(name='Jeffrey Forcier', age=37)
36.         cls.a6 = Author.objects.create(name='Paul Bissex', age=29)
37.         cls.a7 = Author.objects.create(name='Wesley J. Chun', age=25)
38.         cls.a8 = Author.objects.create(name='Peter Norvig', age=57)
39.         cls.a9 = Author.objects.create(name='Stuart Russell', age=46)
40.         cls.a1.friends.add(cls.a2, cls.a4)
41.         cls.a2.friends.add(cls.a1, cls.a7)
42.         cls.a4.friends.add(cls.a1)
43.         cls.a5.friends.add(cls.a6, cls.a7)
44.         cls.a6.friends.add(cls.a5, cls.a7)
45.         cls.a7.friends.add(cls.a2, cls.a5, cls.a6)
46.         cls.a8.friends.add(cls.a9)
47.         cls.a9.friends.add(cls.a8)
48. 
49.         cls.p1 = Publisher.objects.create(name='Apress', num_awards=3)
50.         cls.p2 = Publisher.objects.create(name='Sams', num_awards=1)
51.         cls.p3 = Publisher.objects.create(name='Prentice Hall', num_awards=7)
52.         cls.p4 = Publisher.objects.create(name='Morgan Kaufmann', num_awards=9)
53.         cls.p5 = Publisher.objects.create(name="Jonno's House of Books", num_awards=0)
54. 
55.         cls.b1 = Book.objects.create(
56.             isbn='159059725', name='The Definitive Guide to Django: Web Development Done Right',
57.             pages=447, rating=4.5, price=Decimal('30.00'), contact=cls.a1, publisher=cls.p1,
58.             pubdate=datetime.date(2007, 12, 6)
59.         )
60.         cls.b2 = Book.objects.create(
61.             isbn='067232959', name='Sams Teach Yourself Django in 24 Hours',
62.             pages=528, rating=3.0, price=Decimal('23.09'), contact=cls.a3, publisher=cls.p2,
63.             pubdate=datetime.date(2008, 3, 3)
64.         )
65.         cls.b3 = Book.objects.create(
66.             isbn='159059996', name='Practical Django Projects',
67.             pages=300, rating=4.0, price=Decimal('29.69'), contact=cls.a4, publisher=cls.p1,
68.             pubdate=datetime.date(2008, 6, 23)
69.         )
70.         cls.b4 = Book.objects.create(
71.             isbn='013235613', name='Python Web Development with Django',
72.             pages=350, rating=4.0, price=Decimal('29.69'), contact=cls.a5, publisher=cls.p3,
73.             pubdate=datetime.date(2008, 11, 3)
74.         )
75.         cls.b5 = HardbackBook.objects.create(
76.             isbn='013790395', name='Artificial Intelligence: A Modern Approach',
77.             pages=1132, rating=4.0, price=Decimal('82.80'), contact=cls.a8, publisher=cls.p3,
78.             pubdate=datetime.date(1995, 1, 15), weight=4.5)
79.         cls.b6 = HardbackBook.objects.create(
80.             isbn='155860191', name='Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp',
81.             pages=946, rating=5.0, price=Decimal('75.00'), contact=cls.a8, publisher=cls.p4,
82.             pubdate=datetime.date(1991, 10, 15), weight=3.7)
83.         cls.b1.authors.add(cls.a1, cls.a2)
84.         cls.b2.authors.add(cls.a3)
85.         cls.b3.authors.add(cls.a4)
86.         cls.b4.authors.add(cls.a5, cls.a6, cls.a7)
87.         cls.b5.authors.add(cls.a8, cls.a9)
88.         cls.b6.authors.add(cls.a8)
89. 
90.         s1 = Store.objects.create(
91.             name='Amazon.com',
92.             original_opening=datetime.datetime(1994, 4, 23, 9, 17, 42),
93.             friday_night_closing=datetime.time(23, 59, 59)
94.         )
95.         s2 = Store.objects.create(
96.             name='Books.com',
97.             original_opening=datetime.datetime(2001, 3, 15, 11, 23, 37),
98.             friday_night_closing=datetime.time(23, 59, 59)
99.         )
100.         s3 = Store.objects.create(
101.             name="Mamma and Pappa's Books",
102.             original_opening=datetime.datetime(1945, 4, 25, 16, 24, 14),
103.             friday_night_closing=datetime.time(21, 30)
104.         )
105.         s1.books.add(cls.b1, cls.b2, cls.b3, cls.b4, cls.b5, cls.b6)
106.         s2.books.add(cls.b1, cls.b3, cls.b5, cls.b6)
107.         s3.books.add(cls.b3, cls.b4, cls.b6)
108. 
109.     def assertObjectAttrs(self, obj, **kwargs):
110.         for attr, value in kwargs.items():
111.             self.assertEqual(getattr(obj, attr), value)
112. 
113.     @ignore_warnings(category=RemovedInDjango31Warning)
114.     def test_annotation_with_value(self):
115.         values = Book.objects.filter(
116.             name='Practical Django Projects',
117.         ).annotate(
118.             discount_price=F('price') * 2,
119.         ).values(
120.             'discount_price',
121.         ).annotate(sum_discount=Sum('discount_price'))
122.         self.assertSequenceEqual(
123.             values,
124.             [{'discount_price': Decimal('59.38'), 'sum_discount': Decimal('59.38')}]
125.         )
126. 
127.     def test_aggregates_in_where_clause(self):
128.         """
129.         Regression test for #12822: DatabaseError: aggregates not allowed in
130.         WHERE clause
131. 
132.         The subselect works and returns results equivalent to a
133.         query with the IDs listed.
134. 
135.         Before the corresponding fix for this bug, this test passed in 1.1 and
136.         failed in 1.2-beta (trunk).
137.         """
138.         qs = Book.objects.values('contact').annotate(Max('id'))
139.         qs = qs.order_by('contact').values_list('id__max', flat=True)
140.         # don't do anything with the queryset (qs) before including it as a
141.         # subquery
142.         books = Book.objects.order_by('id')
143.         qs1 = books.filter(id__in=qs)
144.         qs2 = books.filter(id__in=list(qs))
145.         self.assertEqual(list(qs1), list(qs2))
146. 
147.     def test_aggregates_in_where_clause_pre_eval(self):
148.         """
149.         Regression test for #12822: DatabaseError: aggregates not allowed in
150.         WHERE clause
151. 
152.         Same as the above test, but evaluates the queryset for the subquery
153.         before it's used as a subquery.
154. 
155.         Before the corresponding fix for this bug, this test failed in both
156.         1.1 and 1.2-beta (trunk).
157.         """
158.         qs = Book.objects.values('contact').annotate(Max('id'))
159.         qs = qs.order_by('contact').values_list('id__max', flat=True)
160.         # force the queryset (qs) for the subquery to be evaluated in its
161.         # current state
162.         list(qs)
163.         books = Book.objects.order_by('id')
164.         qs1 = books.filter(id__in=qs)
165.         qs2 = books.filter(id__in=list(qs))
166.         self.assertEqual(list(qs1), list(qs2))
167. 
168.     @skipUnlessDBFeature('supports_subqueries_in_group_by')
169.     def test_annotate_with_extra(self):
170.         """
171.         Regression test for #11916: Extra params + aggregation creates
172.         incorrect SQL.
173.         """
174.         # Oracle doesn't support subqueries in group by clause
175.         shortest_book_sql = """
176.         SELECT name
177.         FROM aggregation_regress_book b
178.         WHERE b.publisher_id = aggregation_regress_publisher.id
179.         ORDER BY b.pages
180.         LIMIT 1
181.         """
182.         # tests that this query does not raise a DatabaseError due to the full
183.         # subselect being (erroneously) added to the GROUP BY parameters
184.         qs = Publisher.objects.extra(select={
185.             'name_of_shortest_book': shortest_book_sql,
186.         }).annotate(total_books=Count('book'))
187.         # force execution of the query
188.         list(qs)
189. 
190.     def test_aggregate(self):
191.         # Ordering requests are ignored
192.         self.assertEqual(
193.             Author.objects.order_by("name").aggregate(Avg("age")),
194.             {"age__avg": Approximate(37.444, places=1)}
195.         )
196. 
197.         # Implicit ordering is also ignored
198.         self.assertEqual(
199.             Book.objects.aggregate(Sum("pages")),
200.             {"pages__sum": 3703},
201.         )
202. 
203.         # Baseline results
204.         self.assertEqual(
205.             Book.objects.aggregate(Sum('pages'), Avg('pages')),
206.             {'pages__sum': 3703, 'pages__avg': Approximate(617.166, places=2)}
207.         )
208. 
209.         # Empty values query doesn't affect grouping or results
210.         self.assertEqual(
211.             Book.objects.values().aggregate(Sum('pages'), Avg('pages')),
212.             {'pages__sum': 3703, 'pages__avg': Approximate(617.166, places=2)}
213.         )
214. 
215.         # Aggregate overrides extra selected column
216.         self.assertEqual(
217.             Book.objects.extra(select={'price_per_page': 'price / pages'}).aggregate(Sum('pages')),
218.             {'pages__sum': 3703}
219.         )
220. 
221.     @ignore_warnings(category=RemovedInDjango31Warning)
222.     def test_annotation(self):
223.         # Annotations get combined with extra select clauses
224.         obj = Book.objects.annotate(mean_auth_age=Avg("authors__age")).extra(
225.             select={"manufacture_cost": "price * .5"}).get(pk=self.b2.pk)
226.         self.assertObjectAttrs(
227.             obj,
228.             contact_id=self.a3.id,
229.             isbn='067232959',
230.             mean_auth_age=45.0,
231.             name='Sams Teach Yourself Django in 24 Hours',
232.             pages=528,
233.             price=Decimal("23.09"),
234.             pubdate=datetime.date(2008, 3, 3),
235.             publisher_id=self.p2.id,
236.             rating=3.0
237.         )
238.         # Different DB backends return different types for the extra select computation
239.         self.assertIn(obj.manufacture_cost, (11.545, Decimal('11.545')))
240. 
241.         # Order of the annotate/extra in the query doesn't matter
242.         obj = Book.objects.extra(select={'manufacture_cost': 'price * .5'}).annotate(
243.             mean_auth_age=Avg('authors__age')).get(pk=self.b2.pk)
244.         self.assertObjectAttrs(
245.             obj,
246.             contact_id=self.a3.id,
247.             isbn='067232959',
248.             mean_auth_age=45.0,
249.             name='Sams Teach Yourself Django in 24 Hours',
250.             pages=528,
251.             price=Decimal("23.09"),
252.             pubdate=datetime.date(2008, 3, 3),
253.             publisher_id=self.p2.id,
254.             rating=3.0
255.         )
256.         # Different DB backends return different types for the extra select computation
257.         self.assertIn(obj.manufacture_cost, (11.545, Decimal('11.545')))
258. 
259.         # Values queries can be combined with annotate and extra
260.         obj = Book.objects.annotate(mean_auth_age=Avg('authors__age')).extra(
261.             select={'manufacture_cost': 'price * .5'}).values().get(pk=self.b2.pk)
262.         manufacture_cost = obj['manufacture_cost']
263.         self.assertIn(manufacture_cost, (11.545, Decimal('11.545')))
264.         del obj['manufacture_cost']
265.         self.assertEqual(obj, {
266.             'id': self.b2.id,
267.             'contact_id': self.a3.id,
268.             'isbn': '067232959',
269.             'mean_auth_age': 45.0,
270.             'name': 'Sams Teach Yourself Django in 24 Hours',
271.             'pages': 528,
272.             'price': Decimal('23.09'),
273.             'pubdate': datetime.date(2008, 3, 3),
274.             'publisher_id': self.p2.id,
275.             'rating': 3.0,
276.         })
277. 
278.         # The order of the (empty) values, annotate and extra clauses doesn't
279.         # matter
280.         obj = Book.objects.values().annotate(mean_auth_age=Avg('authors__age')).extra(
281.             select={'manufacture_cost': 'price * .5'}).get(pk=self.b2.pk)
282.         manufacture_cost = obj['manufacture_cost']
283.         self.assertIn(manufacture_cost, (11.545, Decimal('11.545')))
284.         del obj['manufacture_cost']
285.         self.assertEqual(obj, {
286.             'id': self.b2.id,
287.             'contact_id': self.a3.id,
288.             'isbn': '067232959',
289.             'mean_auth_age': 45.0,
290.             'name': 'Sams Teach Yourself Django in 24 Hours',
291.             'pages': 528,
292.             'price': Decimal('23.09'),
293.             'pubdate': datetime.date(2008, 3, 3),
294.             'publisher_id': self.p2.id,
295.             'rating': 3.0
296.         })
297. 
298.         # If the annotation precedes the values clause, it won't be included
299.         # unless it is explicitly named
300.         obj = Book.objects.annotate(mean_auth_age=Avg('authors__age')).extra(
301.             select={'price_per_page': 'price / pages'}).values('name').get(pk=self.b1.pk)
302.         self.assertEqual(obj, {
303.             "name": 'The Definitive Guide to Django: Web Development Done Right',
304.         })
305. 
306.         obj = Book.objects.annotate(mean_auth_age=Avg('authors__age')).extra(
307.             select={'price_per_page': 'price / pages'}).values('name', 'mean_auth_age').get(pk=self.b1.pk)
308.         self.assertEqual(obj, {
309.             'mean_auth_age': 34.5,
310.             'name': 'The Definitive Guide to Django: Web Development Done Right',
311.         })
312. 
313.         # If an annotation isn't included in the values, it can still be used
314.         # in a filter
315.         with ignore_warnings(category=RemovedInDjango31Warning):
316.             qs = Book.objects.annotate(n_authors=Count('authors')).values('name').filter(n_authors__gt=2)
317.         self.assertSequenceEqual(
318.             qs, [
319.                 {"name": 'Python Web Development with Django'}
320.             ],
321.         )
322. 
323.         # The annotations are added to values output if values() precedes
324.         # annotate()
325.         obj = Book.objects.values('name').annotate(mean_auth_age=Avg('authors__age')).extra(
326.             select={'price_per_page': 'price / pages'}).get(pk=self.b1.pk)
327.         self.assertEqual(obj, {
328.             'mean_auth_age': 34.5,
329.             'name': 'The Definitive Guide to Django: Web Development Done Right',
330.         })
331. 
332.         # All of the objects are getting counted (allow_nulls) and that values
333.         # respects the amount of objects
334.         self.assertEqual(
335.             len(Author.objects.annotate(Avg('friends__age')).values()),
336.             9
337.         )
338. 
339.         # Consecutive calls to annotate accumulate in the query
340.         qs = (
341.             Book.objects
342.             .values('price')
343.             .annotate(oldest=Max('authors__age'))
344.             .order_by('oldest', 'price')
345.             .annotate(Max('publisher__num_awards'))
346.         )
347.         self.assertSequenceEqual(
348.             qs, [
349.                 {'price': Decimal("30"), 'oldest': 35, 'publisher__num_awards__max': 3},
350.                 {'price': Decimal("29.69"), 'oldest': 37, 'publisher__num_awards__max': 7},
351.                 {'price': Decimal("23.09"), 'oldest': 45, 'publisher__num_awards__max': 1},
352.                 {'price': Decimal("75"), 'oldest': 57, 'publisher__num_awards__max': 9},
353.                 {'price': Decimal("82.8"), 'oldest': 57, 'publisher__num_awards__max': 7}
354.             ],
355.         )
356. 
357.     def test_aggregate_annotation(self):
358.         # Aggregates can be composed over annotations.
359.         # The return type is derived from the composed aggregate
360.         vals = (
361.             Book.objects
362.             .all()
363.             .annotate(num_authors=Count('authors__id'))
364.             .aggregate(Max('pages'), Max('price'), Sum('num_authors'), Avg('num_authors'))
365.         )
366.         self.assertEqual(vals, {
367.             'num_authors__sum': 10,
368.             'num_authors__avg': Approximate(1.666, places=2),
369.             'pages__max': 1132,
370.             'price__max': Decimal("82.80")
371.         })
372. 
373.         # Regression for #15624 - Missing SELECT columns when using values, annotate
374.         # and aggregate in a single query
375.         self.assertEqual(
376.             Book.objects.annotate(c=Count('authors')).values('c').aggregate(Max('c')),
377.             {'c__max': 3}
378.         )
379. 
380.     def test_conditional_aggreate(self):
381.         # Conditional aggregation of a grouped queryset.
382.         self.assertEqual(
383.             Book.objects.annotate(c=Count('authors')).values('pk').aggregate(test=Sum(
384.                 Case(When(c__gt=1, then=1), output_field=IntegerField())
385.             ))['test'],
386.             3
387.         )
388. 
389.     def test_sliced_conditional_aggregate(self):
390.         self.assertEqual(
391.             Author.objects.all()[:5].aggregate(test=Sum(Case(
392.                 When(age__lte=35, then=1), output_field=IntegerField()
393.             )))['test'],
394.             3
395.         )
396. 
397.     def test_annotated_conditional_aggregate(self):
398.         annotated_qs = Book.objects.annotate(discount_price=F('price') * 0.75)
399.         self.assertAlmostEqual(
400.             annotated_qs.aggregate(test=Avg(Case(
401.                 When(pages__lt=400, then='discount_price'),
402.                 output_field=DecimalField()
403.             )))['test'],
404.             Decimal('22.27'), places=2
405.         )
406. 
407.     def test_distinct_conditional_aggregate(self):
408.         self.assertEqual(
409.             Book.objects.distinct().aggregate(test=Avg(Case(
410.                 When(price=Decimal('29.69'), then='pages'),
411.                 output_field=IntegerField()
412.             )))['test'],
413.             325
414.         )
415. 
416.     def test_conditional_aggregate_on_complex_condition(self):
417.         self.assertEqual(
418.             Book.objects.distinct().aggregate(test=Avg(Case(
419.                 When(Q(price__gte=Decimal('29')) & Q(price__lt=Decimal('30')), then='pages'),
420.                 output_field=IntegerField()
421.             )))['test'],
422.             325
423.         )
424. 
425.     def test_decimal_aggregate_annotation_filter(self):
426.         """
427.         Filtering on an aggregate annotation with Decimal values should work.
428.         Requires special handling on SQLite (#18247).
429.         """
430.         self.assertEqual(
431.             len(Author.objects.annotate(sum=Sum('book_contact_set__price')).filter(sum__gt=Decimal(40))),
432.             1
433.         )
434.         self.assertEqual(
435.             len(Author.objects.annotate(sum=Sum('book_contact_set__price')).filter(sum__lte=Decimal(40))),
436.             4
437.         )
438. 
439.     def test_field_error(self):
440.         # Bad field requests in aggregates are caught and reported
441.         msg = (
442.             "Cannot resolve keyword 'foo' into field. Choices are: authors, "
443.             "contact, contact_id, hardbackbook, id, isbn, name, pages, price, "
444.             "pubdate, publisher, publisher_id, rating, store, tags"
445.         )
446.         with self.assertRaisesMessage(FieldError, msg):
447.             Book.objects.all().aggregate(num_authors=Count('foo'))
448. 
449.         with self.assertRaisesMessage(FieldError, msg):
450.             Book.objects.all().annotate(num_authors=Count('foo'))
451. 
452.         msg = (
453.             "Cannot resolve keyword 'foo' into field. Choices are: authors, "
454.             "contact, contact_id, hardbackbook, id, isbn, name, num_authors, "
455.             "pages, price, pubdate, publisher, publisher_id, rating, store, tags"
456.         )
457.         with self.assertRaisesMessage(FieldError, msg):
458.             Book.objects.all().annotate(num_authors=Count('authors__id')).aggregate(Max('foo'))
459. 
460.     @ignore_warnings(category=RemovedInDjango31Warning)
461.     def test_more(self):
462.         # Old-style count aggregations can be mixed with new-style
463.         self.assertEqual(
464.             Book.objects.annotate(num_authors=Count('authors')).count(),
465.             6
466.         )
467. 
468.         # Non-ordinal, non-computed Aggregates over annotations correctly
469.         # inherit the annotation's internal type if the annotation is ordinal
470.         # or computed
471.         vals = Book.objects.annotate(num_authors=Count('authors')).aggregate(Max('num_authors'))
472.         self.assertEqual(
473.             vals,
474.             {'num_authors__max': 3}
475.         )
476. 
477.         vals = Publisher.objects.annotate(avg_price=Avg('book__price')).aggregate(Max('avg_price'))
478.         self.assertEqual(
479.             vals,
480.             {'avg_price__max': 75.0}
481.         )
482. 
483.         # Aliases are quoted to protected aliases that might be reserved names
484.         vals = Book.objects.aggregate(number=Max('pages'), select=Max('pages'))
485.         self.assertEqual(
486.             vals,
487.             {'number': 1132, 'select': 1132}
488.         )
489. 
490.         # Regression for #10064: select_related() plays nice with aggregates
491.         obj = Book.objects.select_related('publisher').annotate(
492.             num_authors=Count('authors')).values().get(isbn='013790395')
493.         self.assertEqual(obj, {
494.             'contact_id': self.a8.id,
495.             'id': self.b5.id,
496.             'isbn': '013790395',
497.             'name': 'Artificial Intelligence: A Modern Approach',
498.             'num_authors': 2,
499.             'pages': 1132,
500.             'price': Decimal("82.8"),
501.             'pubdate': datetime.date(1995, 1, 15),
502.             'publisher_id': self.p3.id,
503.             'rating': 4.0,
504.         })
505. 
506.         # Regression for #10010: exclude on an aggregate field is correctly
507.         # negated
508.         self.assertEqual(
509.             len(Book.objects.annotate(num_authors=Count('authors'))),
510.             6
511.         )
512.         self.assertEqual(
513.             len(Book.objects.annotate(num_authors=Count('authors')).filter(num_authors__gt=2)),
514.             1
515.         )
516.         self.assertEqual(
517.             len(Book.objects.annotate(num_authors=Count('authors')).exclude(num_authors__gt=2)),
518.             5
519.         )
520. 
521.         self.assertEqual(
522.             len(
523.                 Book.objects
524.                 .annotate(num_authors=Count('authors'))
525.                 .filter(num_authors__lt=3)
526.                 .exclude(num_authors__lt=2)
527.             ),
528.             2
529.         )
530.         self.assertEqual(
531.             len(
532.                 Book.objects
533.                 .annotate(num_authors=Count('authors'))
534.                 .exclude(num_authors__lt=2)
535.                 .filter(num_authors__lt=3)
536.             ),
537.             2
538.         )
539. 
540.     def test_aggregate_fexpr(self):
541.         # Aggregates can be used with F() expressions
542.         # ... where the F() is pushed into the HAVING clause
543.         qs = (
544.             Publisher.objects
545.             .annotate(num_books=Count('book'))
546.             .filter(num_books__lt=F('num_awards') / 2)
547.             .order_by('name')
548.             .values('name', 'num_books', 'num_awards')
549.         )
550.         self.assertSequenceEqual(
551.             qs, [
552.                 {'num_books': 1, 'name': 'Morgan Kaufmann', 'num_awards': 9},
553.                 {'num_books': 2, 'name': 'Prentice Hall', 'num_awards': 7}
554.             ],
555.         )
556. 
557.         qs = (
558.             Publisher.objects
559.             .annotate(num_books=Count('book'))
560.             .exclude(num_books__lt=F('num_awards') / 2)
561.             .order_by('name')
562.             .values('name', 'num_books', 'num_awards')
563.         )
564.         self.assertSequenceEqual(
565.             qs, [
566.                 {'num_books': 2, 'name': 'Apress', 'num_awards': 3},
567.                 {'num_books': 0, 'name': "Jonno's House of Books", 'num_awards': 0},
568.                 {'num_books': 1, 'name': 'Sams', 'num_awards': 1}
569.             ],
570.         )
571. 
572.         # ... and where the F() references an aggregate
573.         qs = (
574.             Publisher.objects
575.             .annotate(num_books=Count('book'))
576.             .filter(num_awards__gt=2 * F('num_books'))
577.             .order_by('name')
578.             .values('name', 'num_books', 'num_awards')
579.         )
580.         self.assertSequenceEqual(
581.             qs, [
582.                 {'num_books': 1, 'name': 'Morgan Kaufmann', 'num_awards': 9},
583.                 {'num_books': 2, 'name': 'Prentice Hall', 'num_awards': 7}
584.             ],
585.         )
586. 
587.         qs = (
588.             Publisher.objects
589.             .annotate(num_books=Count('book'))
590.             .exclude(num_books__lt=F('num_awards') / 2)
591.             .order_by('name')
592.             .values('name', 'num_books', 'num_awards')
593.         )
594.         self.assertSequenceEqual(
595.             qs, [
596.                 {'num_books': 2, 'name': 'Apress', 'num_awards': 3},
597.                 {'num_books': 0, 'name': "Jonno's House of Books", 'num_awards': 0},
598.                 {'num_books': 1, 'name': 'Sams', 'num_awards': 1}
599.             ],
600.         )
601. 
602.     def test_db_col_table(self):
603.         # Tests on fields with non-default table and column names.
604.         qs = (
605.             Clues.objects
606.             .values('EntryID__Entry')
607.             .annotate(Appearances=Count('EntryID'), Distinct_Clues=Count('Clue', distinct=True))
608.         )
609.         self.assertQuerysetEqual(qs, [])
610. 
611.         qs = Entries.objects.annotate(clue_count=Count('clues__ID'))
612.         self.assertQuerysetEqual(qs, [])
613. 
614.     def test_boolean_conversion(self):
615.         # Aggregates mixed up ordering of columns for backend's convert_values
616.         # method. Refs #21126.
617.         e = Entries.objects.create(Entry='foo')
618.         c = Clues.objects.create(EntryID=e, Clue='bar')
619.         qs = Clues.objects.select_related('EntryID').annotate(Count('ID'))
620.         self.assertSequenceEqual(qs, [c])
621.         self.assertEqual(qs[0].EntryID, e)
622.         self.assertIs(qs[0].EntryID.Exclude, False)
623. 
624.     def test_empty(self):
625.         # Regression for #10089: Check handling of empty result sets with
626.         # aggregates
627.         self.assertEqual(
628.             Book.objects.filter(id__in=[]).count(),
629.             0
630.         )
631. 
632.         vals = (
633.             Book.objects
634.             .filter(id__in=[])
635.             .aggregate(
636.                 num_authors=Count('authors'),
637.                 avg_authors=Avg('authors'),
638.                 max_authors=Max('authors'),
639.                 max_price=Max('price'),
640.                 max_rating=Max('rating'),
641.             )
642.         )
643.         self.assertEqual(
644.             vals,
645.             {'max_authors': None, 'max_rating': None, 'num_authors': 0, 'avg_authors': None, 'max_price': None}
646.         )
647. 
648.         qs = (
649.             Publisher.objects
650.             .filter(name="Jonno's House of Books")
651.             .annotate(
652.                 num_authors=Count('book__authors'),
653.                 avg_authors=Avg('book__authors'),
654.                 max_authors=Max('book__authors'),
655.                 max_price=Max('book__price'),
656.                 max_rating=Max('book__rating'),
657.             ).values()
658.         )
659.         self.assertSequenceEqual(
660.             qs,
661.             [{
662.                 'max_authors': None,
663.                 'name': "Jonno's House of Books",
664.                 'num_awards': 0,
665.                 'max_price': None,
666.                 'num_authors': 0,
667.                 'max_rating': None,
668.                 'id': self.p5.id,
669.                 'avg_authors': None,
670.             }],
671.         )
672. 
673.     def test_more_more(self):
674.         # Regression for #10113 - Fields mentioned in order_by() must be
675.         # included in the GROUP BY. This only becomes a problem when the
676.         # order_by introduces a new join.
677.         self.assertQuerysetEqual(
678.             Book.objects.annotate(num_authors=Count('authors')).order_by('publisher__name', 'name'), [
679.                 "Practical Django Projects",
680.                 "The Definitive Guide to Django: Web Development Done Right",
681.                 "Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp",
682.                 "Artificial Intelligence: A Modern Approach",
683.                 "Python Web Development with Django",
684.                 "Sams Teach Yourself Django in 24 Hours",
685.             ],
686.             lambda b: b.name
687.         )
688. 
689.         # Regression for #10127 - Empty select_related() works with annotate
690.         qs = Book.objects.filter(rating__lt=4.5).select_related().annotate(Avg('authors__age')).order_by('name')
691.         self.assertQuerysetEqual(
692.             qs,
693.             [
694.                 ('Artificial Intelligence: A Modern Approach', 51.5, 'Prentice Hall', 'Peter Norvig'),
695.                 ('Practical Django Projects', 29.0, 'Apress', 'James Bennett'),
696.                 (
697.                     'Python Web Development with Django',
698.                     Approximate(30.333, places=2),
699.                     'Prentice Hall',
700.                     'Jeffrey Forcier',
701.                 ),
702.                 ('Sams Teach Yourself Django in 24 Hours', 45.0, 'Sams', 'Brad Dayley')
703.             ],
704.             lambda b: (b.name, b.authors__age__avg, b.publisher.name, b.contact.name)
705.         )
706. 
707.         # Regression for #10132 - If the values() clause only mentioned extra
708.         # (select=) columns, those columns are used for grouping
709.         qs = Book.objects.extra(select={'pub': 'publisher_id'}).values('pub').annotate(Count('id')).order_by('pub')
710.         self.assertSequenceEqual(
711.             qs, [
712.                 {'pub': self.b1.id, 'id__count': 2},
713.                 {'pub': self.b2.id, 'id__count': 1},
714.                 {'pub': self.b3.id, 'id__count': 2},
715.                 {'pub': self.b4.id, 'id__count': 1}
716.             ],
717.         )
718. 
719.         qs = (
720.             Book.objects
721.             .extra(select={'pub': 'publisher_id', 'foo': 'pages'})
722.             .values('pub')
723.             .annotate(Count('id'))
724.             .order_by('pub')
725.         )
726.         self.assertSequenceEqual(
727.             qs, [
728.                 {'pub': self.p1.id, 'id__count': 2},
729.                 {'pub': self.p2.id, 'id__count': 1},
730.                 {'pub': self.p3.id, 'id__count': 2},
731.                 {'pub': self.p4.id, 'id__count': 1}
732.             ],
733.         )
734. 
735.         # Regression for #10182 - Queries with aggregate calls are correctly
736.         # realiased when used in a subquery
737.         ids = (
738.             Book.objects
739.             .filter(pages__gt=100)
740.             .annotate(n_authors=Count('authors'))
741.             .filter(n_authors__gt=2)
742.             .order_by('n_authors')
743.         )
744.         self.assertQuerysetEqual(
745.             Book.objects.filter(id__in=ids), [
746.                 "Python Web Development with Django",
747.             ],
748.             lambda b: b.name
749.         )
750. 
751.         # Regression for #15709 - Ensure each group_by field only exists once
752.         # per query
753.         qstr = str(Book.objects.values('publisher').annotate(max_pages=Max('pages')).order_by().query)
754.         # There is just one GROUP BY clause (zero commas means at most one clause).
755.         self.assertEqual(qstr[qstr.index('GROUP BY'):].count(', '), 0)
756. 
757.     def test_duplicate_alias(self):
758.         # Regression for #11256 - duplicating a default alias raises ValueError.
759.         msg = (
760.             "The named annotation 'authors__age__avg' conflicts with "
761.             "the default name for another annotation."
762.         )
763.         with self.assertRaisesMessage(ValueError, msg):
764.             Book.objects.all().annotate(Avg('authors__age'), authors__age__avg=Avg('authors__age'))
765. 
766.     def test_field_name_conflict(self):
767.         # Regression for #11256 - providing an aggregate name
768.         # that conflicts with a field name on the model raises ValueError
769.         msg = "The annotation 'age' conflicts with a field on the model."
770.         with self.assertRaisesMessage(ValueError, msg):
771.             Author.objects.annotate(age=Avg('friends__age'))
772. 
773.     def test_m2m_name_conflict(self):
774.         # Regression for #11256 - providing an aggregate name
775.         # that conflicts with an m2m name on the model raises ValueError
776.         msg = "The annotation 'friends' conflicts with a field on the model."
777.         with self.assertRaisesMessage(ValueError, msg):
778.             Author.objects.annotate(friends=Count('friends'))
779. 
780.     def test_fk_attname_conflict(self):
781.         msg = "The annotation 'contact_id' conflicts with a field on the model."
782.         with self.assertRaisesMessage(ValueError, msg):
783.             Book.objects.annotate(contact_id=F('publisher_id'))
784. 
785.     def test_values_queryset_non_conflict(self):
786.         # Regression for #14707 -- If you're using a values query set, some potential conflicts are avoided.
787. 
788.         # age is a field on Author, so it shouldn't be allowed as an aggregate.
789.         # But age isn't included in values(), so it is.
790.         results = Author.objects.values('name').annotate(age=Count('book_contact_set')).order_by('name')
791.         self.assertEqual(len(results), 9)
792.         self.assertEqual(results[0]['name'], 'Adrian Holovaty')
793.         self.assertEqual(results[0]['age'], 1)
794. 
795.         # Same problem, but aggregating over m2m fields
796.         results = Author.objects.values('name').annotate(age=Avg('friends__age')).order_by('name')
797.         self.assertEqual(len(results), 9)
798.         self.assertEqual(results[0]['name'], 'Adrian Holovaty')
799.         self.assertEqual(results[0]['age'], 32.0)
800. 
801.         # Same problem, but colliding with an m2m field
802.         results = Author.objects.values('name').annotate(friends=Count('friends')).order_by('name')
803.         self.assertEqual(len(results), 9)
804.         self.assertEqual(results[0]['name'], 'Adrian Holovaty')
805.         self.assertEqual(results[0]['friends'], 2)
806. 
807.     def test_reverse_relation_name_conflict(self):
808.         # Regression for #11256 - providing an aggregate name
809.         # that conflicts with a reverse-related name on the model raises ValueError
810.         msg = "The annotation 'book_contact_set' conflicts with a field on the model."
811.         with self.assertRaisesMessage(ValueError, msg):
812.             Author.objects.annotate(book_contact_set=Avg('friends__age'))
813. 
814.     @ignore_warnings(category=RemovedInDjango31Warning)
815.     def test_pickle(self):
816.         # Regression for #10197 -- Queries with aggregates can be pickled.
817.         # First check that pickling is possible at all. No crash = success
818.         qs = Book.objects.annotate(num_authors=Count('authors'))
819.         pickle.dumps(qs)
820. 
821.         # Then check that the round trip works.
822.         query = qs.query.get_compiler(qs.db).as_sql()[0]
823.         qs2 = pickle.loads(pickle.dumps(qs))
824.         self.assertEqual(
825.             qs2.query.get_compiler(qs2.db).as_sql()[0],
826.             query,
827.         )
828. 
829.     def test_more_more_more(self):
830.         # Regression for #10199 - Aggregate calls clone the original query so
831.         # the original query can still be used
832.         books = Book.objects.all()
833.         books.aggregate(Avg("authors__age"))
834.         self.assertQuerysetEqual(
835.             books.all(), [
836.                 'Artificial Intelligence: A Modern Approach',
837.                 'Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp',
838.                 'Practical Django Projects',
839.                 'Python Web Development with Django',
840.                 'Sams Teach Yourself Django in 24 Hours',
841.                 'The Definitive Guide to Django: Web Development Done Right'
842.             ],
843.             lambda b: b.name
844.         )
845. 
846.         # Regression for #10248 - Annotations work with dates()
847.         qs = Book.objects.annotate(num_authors=Count('authors')).filter(num_authors=2).dates('pubdate', 'day')
848.         self.assertSequenceEqual(
849.             qs, [
850.                 datetime.date(1995, 1, 15),
851.                 datetime.date(2007, 12, 6),
852.             ],
853.         )
854. 
855.         # Regression for #10290 - extra selects with parameters can be used for
856.         # grouping.
857.         qs = (
858.             Book.objects
859.             .annotate(mean_auth_age=Avg('authors__age'))
860.             .extra(select={'sheets': '(pages + %s) / %s'}, select_params=[1, 2])
861.             .order_by('sheets')
862.             .values('sheets')
863.         )
864.         self.assertQuerysetEqual(
865.             qs, [
866.                 150,
867.                 175,
868.                 224,
869.                 264,
870.                 473,
871.                 566
872.             ],
873.             lambda b: int(b["sheets"])
874.         )
875. 
876.         # Regression for 10425 - annotations don't get in the way of a count()
877.         # clause
878.         self.assertEqual(
879.             Book.objects.values('publisher').annotate(Count('publisher')).count(),
880.             4
881.         )
882.         self.assertEqual(
883.             Book.objects.annotate(Count('publisher')).values('publisher').count(),
884.             6
885.         )
886. 
887.         # Note: intentionally no order_by(), that case needs tests, too.
888.         publishers = Publisher.objects.filter(id__in=[1, 2])
889.         self.assertEqual(
890.             sorted(p.name for p in publishers),
891.             [
892.                 "Apress",
893.                 "Sams"
894.             ]
895.         )
896. 
897.         publishers = publishers.annotate(n_books=Count("book"))
898.         sorted_publishers = sorted(publishers, key=lambda x: x.name)
899.         self.assertEqual(
900.             sorted_publishers[0].n_books,
901.             2
902.         )
903.         self.assertEqual(
904.             sorted_publishers[1].n_books,
905.             1
906.         )
907. 
908.         self.assertEqual(
909.             sorted(p.name for p in publishers),
910.             [
911.                 "Apress",
912.                 "Sams"
913.             ]
914.         )
915. 
916.         books = Book.objects.filter(publisher__in=publishers)
917.         self.assertQuerysetEqual(
918.             books, [
919.                 "Practical Django Projects",
920.                 "Sams Teach Yourself Django in 24 Hours",
921.                 "The Definitive Guide to Django: Web Development Done Right",
922.             ],
923.             lambda b: b.name
924.         )
925.         self.assertEqual(
926.             sorted(p.name for p in publishers),
927.             [
928.                 "Apress",
929.                 "Sams"
930.             ]
931.         )
932. 
933.         # Regression for 10666 - inherited fields work with annotations and
934.         # aggregations
935.         self.assertEqual(
936.             HardbackBook.objects.aggregate(n_pages=Sum('book_ptr__pages')),
937.             {'n_pages': 2078}
938.         )
939. 
940.         self.assertEqual(
941.             HardbackBook.objects.aggregate(n_pages=Sum('pages')),
942.             {'n_pages': 2078},
943.         )
944. 
945.         qs = HardbackBook.objects.annotate(
946.             n_authors=Count('book_ptr__authors'),
947.         ).values('name', 'n_authors').order_by('name')
948.         self.assertSequenceEqual(
949.             qs,
950.             [
951.                 {'n_authors': 2, 'name': 'Artificial Intelligence: A Modern Approach'},
952.                 {
953.                     'n_authors': 1,
954.                     'name': 'Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp'
955.                 }
956.             ],
957.         )
958. 
959.         qs = HardbackBook.objects.annotate(n_authors=Count('authors')).values('name', 'n_authors').order_by('name')
960.         self.assertSequenceEqual(
961.             qs,
962.             [
963.                 {'n_authors': 2, 'name': 'Artificial Intelligence: A Modern Approach'},
964.                 {
965.                     'n_authors': 1,
966.                     'name': 'Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp'
967.                 }
968.             ],
969.         )
970. 
971.         # Regression for #10766 - Shouldn't be able to reference an aggregate
972.         # fields in an aggregate() call.
973.         msg = "Cannot compute Avg('mean_age'): 'mean_age' is an aggregate"
974.         with self.assertRaisesMessage(FieldError, msg):
975.             Book.objects.annotate(mean_age=Avg('authors__age')).annotate(Avg('mean_age'))
976. 
977.     def test_empty_filter_count(self):
978.         self.assertEqual(
979.             Author.objects.filter(id__in=[]).annotate(Count("friends")).count(),
980.             0
981.         )
982. 
983.     def test_empty_filter_aggregate(self):
984.         self.assertEqual(
985.             Author.objects.filter(id__in=[]).annotate(Count("friends")).aggregate(Count("pk")),
986.             {"pk__count": None}
987.         )
988. 
989.     def test_none_call_before_aggregate(self):
990.         # Regression for #11789
991.         self.assertEqual(
992.             Author.objects.none().aggregate(Avg('age')),
993.             {'age__avg': None}
994.         )
995. 
996.     def test_annotate_and_join(self):
997.         self.assertEqual(
998.             Author.objects.annotate(c=Count("friends__name")).exclude(friends__name="Joe").count(),
999.             Author.objects.count()
1000.         )
1001. 
1002.     def test_f_expression_annotation(self):
1003.         # Books with less than 200 pages per author.
1004.         qs = Book.objects.values("name").annotate(
1005.             n_authors=Count("authors")
1006.         ).filter(
1007.             pages__lt=F("n_authors") * 200
1008.         ).values_list("pk")
1009.         self.assertQuerysetEqual(
1010.             Book.objects.filter(pk__in=qs), [
1011.                 "Python Web Development with Django"
1012.             ],
1013.             attrgetter("name")
1014.         )
1015. 
1016.     def test_values_annotate_values(self):
1017.         qs = Book.objects.values("name").annotate(
1018.             n_authors=Count("authors")
1019.         ).values_list("pk", flat=True).order_by('name')
1020.         self.assertEqual(list(qs), list(Book.objects.values_list("pk", flat=True)))
1021. 
1022.     def test_having_group_by(self):
1023.         # When a field occurs on the LHS of a HAVING clause that it
1024.         # appears correctly in the GROUP BY clause
1025.         qs = Book.objects.values_list("name").annotate(
1026.             n_authors=Count("authors")
1027.         ).filter(
1028.             pages__gt=F("n_authors")
1029.         ).values_list("name", flat=True).order_by('name')
1030.         # Results should be the same, all Books have more pages than authors
1031.         self.assertEqual(
1032.             list(qs), list(Book.objects.values_list("name", flat=True))
1033.         )
1034. 
1035.     def test_values_list_annotation_args_ordering(self):
1036.         """
1037.         Annotate *args ordering should be preserved in values_list results.
1038.         **kwargs comes after *args.
1039.         Regression test for #23659.
1040.         """
1041.         books = Book.objects.values_list("publisher__name").annotate(
1042.             Count("id"), Avg("price"), Avg("authors__age"), avg_pgs=Avg("pages")
1043.         ).order_by("-publisher__name")
1044.         self.assertEqual(books[0], ('Sams', 1, Decimal('23.09'), 45.0, 528.0))
1045. 
1046.     def test_annotation_disjunction(self):
1047.         qs = Book.objects.annotate(n_authors=Count("authors")).filter(
1048.             Q(n_authors=2) | Q(name="Python Web Development with Django")
1049.         ).order_by('name')
1050.         self.assertQuerysetEqual(
1051.             qs, [
1052.                 "Artificial Intelligence: A Modern Approach",
1053.                 "Python Web Development with Django",
1054.                 "The Definitive Guide to Django: Web Development Done Right",
1055.             ],
1056.             attrgetter("name")
1057.         )
1058. 
1059.         qs = (
1060.             Book.objects
1061.             .annotate(n_authors=Count("authors"))
1062.             .filter(
1063.                 Q(name="The Definitive Guide to Django: Web Development Done Right") |
1064.                 (Q(name="Artificial Intelligence: A Modern Approach") & Q(n_authors=3))
1065.             )
1066.         ).order_by('name')
1067.         self.assertQuerysetEqual(
1068.             qs,
1069.             [
1070.                 "The Definitive Guide to Django: Web Development Done Right",
1071.             ],
1072.             attrgetter("name")
1073.         )
1074. 
1075.         qs = Publisher.objects.annotate(
1076.             rating_sum=Sum("book__rating"),
1077.             book_count=Count("book")
1078.         ).filter(
1079.             Q(rating_sum__gt=5.5) | Q(rating_sum__isnull=True)
1080.         ).order_by('pk')
1081.         self.assertQuerysetEqual(
1082.             qs, [
1083.                 "Apress",
1084.                 "Prentice Hall",
1085.                 "Jonno's House of Books",
1086.             ],
1087.             attrgetter("name")
1088.         )
1089. 
1090.         qs = Publisher.objects.annotate(
1091.             rating_sum=Sum("book__rating"),
1092.             book_count=Count("book")
1093.         ).filter(
1094.             Q(rating_sum__gt=F("book_count")) | Q(rating_sum=None)
1095.         ).order_by("num_awards")
1096.         self.assertQuerysetEqual(
1097.             qs, [
1098.                 "Jonno's House of Books",
1099.                 "Sams",
1100.                 "Apress",
1101.                 "Prentice Hall",
1102.                 "Morgan Kaufmann"
1103.             ],
1104.             attrgetter("name")
1105.         )
1106. 
1107.     def test_quoting_aggregate_order_by(self):
1108.         qs = Book.objects.filter(
1109.             name="Python Web Development with Django"
1110.         ).annotate(
1111.             authorCount=Count("authors")
1112.         ).order_by("authorCount")
1113.         self.assertQuerysetEqual(
1114.             qs, [
1115.                 ("Python Web Development with Django", 3),
1116.             ],
1117.             lambda b: (b.name, b.authorCount)
1118.         )
1119. 
1120.     def test_stddev(self):
1121.         self.assertEqual(
1122.             Book.objects.aggregate(StdDev('pages')),
1123.             {'pages__stddev': Approximate(311.46, 1)}
1124.         )
1125. 
1126.         self.assertEqual(
1127.             Book.objects.aggregate(StdDev('rating')),
1128.             {'rating__stddev': Approximate(0.60, 1)}
1129.         )
1130. 
1131.         self.assertEqual(
1132.             Book.objects.aggregate(StdDev('price')),
1133.             {'price__stddev': Approximate(Decimal('24.16'), 2)}
1134.         )
1135. 
1136.         self.assertEqual(
1137.             Book.objects.aggregate(StdDev('pages', sample=True)),
1138.             {'pages__stddev': Approximate(341.19, 2)}
1139.         )
1140. 
1141.         self.assertEqual(
1142.             Book.objects.aggregate(StdDev('rating', sample=True)),
1143.             {'rating__stddev': Approximate(0.66, 2)}
1144.         )
1145. 
1146.         self.assertEqual(
1147.             Book.objects.aggregate(StdDev('price', sample=True)),
1148.             {'price__stddev': Approximate(Decimal('26.46'), 1)}
1149.         )
1150. 
1151.         self.assertEqual(
1152.             Book.objects.aggregate(Variance('pages')),
1153.             {'pages__variance': Approximate(97010.80, 1)}
1154.         )
1155. 
1156.         self.assertEqual(
1157.             Book.objects.aggregate(Variance('rating')),
1158.             {'rating__variance': Approximate(0.36, 1)}
1159.         )
1160. 
1161.         self.assertEqual(
1162.             Book.objects.aggregate(Variance('price')),
1163.             {'price__variance': Approximate(Decimal('583.77'), 1)}
1164.         )
1165. 
1166.         self.assertEqual(
1167.             Book.objects.aggregate(Variance('pages', sample=True)),
1168.             {'pages__variance': Approximate(116412.96, 1)}
1169.         )
1170. 
1171.         self.assertEqual(
1172.             Book.objects.aggregate(Variance('rating', sample=True)),
1173.             {'rating__variance': Approximate(0.44, 2)}
1174.         )
1175. 
1176.         self.assertEqual(
1177.             Book.objects.aggregate(Variance('price', sample=True)),
1178.             {'price__variance': Approximate(Decimal('700.53'), 2)}
1179.         )
1180. 
1181.     def test_filtering_by_annotation_name(self):
1182.         # Regression test for #14476
1183. 
1184.         # The name of the explicitly provided annotation name in this case
1185.         # poses no problem
1186.         qs = Author.objects.annotate(book_cnt=Count('book')).filter(book_cnt=2).order_by('name')
1187.         self.assertQuerysetEqual(
1188.             qs,
1189.             ['Peter Norvig'],
1190.             lambda b: b.name
1191.         )
1192.         # Neither in this case
1193.         qs = Author.objects.annotate(book_count=Count('book')).filter(book_count=2).order_by('name')
1194.         self.assertQuerysetEqual(
1195.             qs,
1196.             ['Peter Norvig'],
1197.             lambda b: b.name
1198.         )
1199.         # This case used to fail because the ORM couldn't resolve the
1200.         # automatically generated annotation name `book__count`
1201.         qs = Author.objects.annotate(Count('book')).filter(book__count=2).order_by('name')
1202.         self.assertQuerysetEqual(
1203.             qs,
1204.             ['Peter Norvig'],
1205.             lambda b: b.name
1206.         )
1207.         # Referencing the auto-generated name in an aggregate() also works.
1208.         self.assertEqual(
1209.             Author.objects.annotate(Count('book')).aggregate(Max('book__count')),
1210.             {'book__count__max': 2}
1211.         )
1212. 
1213.     @ignore_warnings(category=RemovedInDjango31Warning)
1214.     def test_annotate_joins(self):
1215.         """
1216.         The base table's join isn't promoted to LOUTER. This could
1217.         cause the query generation to fail if there is an exclude() for fk-field
1218.         in the query, too. Refs #19087.
1219.         """
1220.         qs = Book.objects.annotate(n=Count('pk'))
1221.         self.assertIs(qs.query.alias_map['aggregation_regress_book'].join_type, None)
1222.         # The query executes without problems.
1223.         self.assertEqual(len(qs.exclude(publisher=-1)), 6)
1224. 
1225.     @skipUnlessAnyDBFeature('allows_group_by_pk', 'allows_group_by_selected_pks')
1226.     def test_aggregate_duplicate_columns(self):
1227.         # Regression test for #17144
1228. 
1229.         results = Author.objects.annotate(num_contacts=Count('book_contact_set'))
1230. 
1231.         # There should only be one GROUP BY clause, for the `id` column.
1232.         # `name` and `age` should not be grouped on.
1233.         _, _, group_by = results.query.get_compiler(using='default').pre_sql_setup()
1234.         self.assertEqual(len(group_by), 1)
1235.         self.assertIn('id', group_by[0][0])
1236.         self.assertNotIn('name', group_by[0][0])
1237.         self.assertNotIn('age', group_by[0][0])
1238.         self.assertEqual(
1239.             [(a.name, a.num_contacts) for a in results.order_by('name')],
1240.             [
1241.                 ('Adrian Holovaty', 1),
1242.                 ('Brad Dayley', 1),
1243.                 ('Jacob Kaplan-Moss', 0),
1244.                 ('James Bennett', 1),
1245.                 ('Jeffrey Forcier', 1),
1246.                 ('Paul Bissex', 0),
1247.                 ('Peter Norvig', 2),
1248.                 ('Stuart Russell', 0),
1249.                 ('Wesley J. Chun', 0),
1250.             ]
1251.         )
1252. 
1253.     @skipUnlessAnyDBFeature('allows_group_by_pk', 'allows_group_by_selected_pks')
1254.     def test_aggregate_duplicate_columns_only(self):
1255.         # Works with only() too.
1256.         results = Author.objects.only('id', 'name').annotate(num_contacts=Count('book_contact_set'))
1257.         _, _, grouping = results.query.get_compiler(using='default').pre_sql_setup()
1258.         self.assertEqual(len(grouping), 1)
1259.         self.assertIn('id', grouping[0][0])
1260.         self.assertNotIn('name', grouping[0][0])
1261.         self.assertNotIn('age', grouping[0][0])
1262.         self.assertEqual(
1263.             [(a.name, a.num_contacts) for a in results.order_by('name')],
1264.             [
1265.                 ('Adrian Holovaty', 1),
1266.                 ('Brad Dayley', 1),
1267.                 ('Jacob Kaplan-Moss', 0),
1268.                 ('James Bennett', 1),
1269.                 ('Jeffrey Forcier', 1),
1270.                 ('Paul Bissex', 0),
1271.                 ('Peter Norvig', 2),
1272.                 ('Stuart Russell', 0),
1273.                 ('Wesley J. Chun', 0),
1274.             ]
1275.         )
1276. 
1277.     @skipUnlessAnyDBFeature('allows_group_by_pk', 'allows_group_by_selected_pks')
1278.     def test_aggregate_duplicate_columns_select_related(self):
1279.         # And select_related()
1280.         results = Book.objects.select_related('contact').annotate(
1281.             num_authors=Count('authors'))
1282.         _, _, grouping = results.query.get_compiler(using='default').pre_sql_setup()
1283.         # In the case of `group_by_selected_pks` we also group by contact.id because of the select_related.
1284.         self.assertEqual(len(grouping), 1 if connection.features.allows_group_by_pk else 2)
1285.         self.assertIn('id', grouping[0][0])
1286.         self.assertNotIn('name', grouping[0][0])
1287.         self.assertNotIn('contact', grouping[0][0])
1288.         self.assertEqual(
1289.             [(b.name, b.num_authors) for b in results.order_by('name')],
1290.             [
1291.                 ('Artificial Intelligence: A Modern Approach', 2),
1292.                 ('Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp', 1),
1293.                 ('Practical Django Projects', 1),
1294.                 ('Python Web Development with Django', 3),
1295.                 ('Sams Teach Yourself Django in 24 Hours', 1),
1296.                 ('The Definitive Guide to Django: Web Development Done Right', 2)
1297.             ]
1298.         )
1299. 
1300.     @skipUnlessDBFeature('allows_group_by_selected_pks')
1301.     def test_aggregate_ummanaged_model_columns(self):
1302.         """
1303.         Unmanaged models are sometimes used to represent database views which
1304.         may not allow grouping by selected primary key.
1305.         """
1306.         def assertQuerysetResults(queryset):
1307.             self.assertEqual(
1308.                 [(b.name, b.num_authors) for b in queryset.order_by('name')],
1309.                 [
1310.                     ('Artificial Intelligence: A Modern Approach', 2),
1311.                     ('Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp', 1),
1312.                     ('Practical Django Projects', 1),
1313.                     ('Python Web Development with Django', 3),
1314.                     ('Sams Teach Yourself Django in 24 Hours', 1),
1315.                     ('The Definitive Guide to Django: Web Development Done Right', 2),
1316.                 ]
1317.             )
1318.         queryset = Book.objects.select_related('contact').annotate(num_authors=Count('authors'))
1319.         # Unmanaged origin model.
1320.         with mock.patch.object(Book._meta, 'managed', False):
1321.             _, _, grouping = queryset.query.get_compiler(using='default').pre_sql_setup()
1322.             self.assertEqual(len(grouping), len(Book._meta.fields) + 1)
1323.             for index, field in enumerate(Book._meta.fields):
1324.                 self.assertIn(field.name, grouping[index][0])
1325.             self.assertIn(Author._meta.pk.name, grouping[-1][0])
1326.             assertQuerysetResults(queryset)
1327.         # Unmanaged related model.
1328.         with mock.patch.object(Author._meta, 'managed', False):
1329.             _, _, grouping = queryset.query.get_compiler(using='default').pre_sql_setup()
1330.             self.assertEqual(len(grouping), len(Author._meta.fields) + 1)
1331.             self.assertIn(Book._meta.pk.name, grouping[0][0])
1332.             for index, field in enumerate(Author._meta.fields):
1333.                 self.assertIn(field.name, grouping[index + 1][0])
1334.             assertQuerysetResults(queryset)
1335. 
1336.     def test_reverse_join_trimming(self):
1337.         qs = Author.objects.annotate(Count('book_contact_set__contact'))
1338.         self.assertIn(' JOIN ', str(qs.query))
1339. 
1340.     def test_aggregation_with_generic_reverse_relation(self):
1341.         """
1342.         Regression test for #10870:  Aggregates with joins ignore extra
1343.         filters provided by setup_joins
1344. 
1345.         tests aggregations with generic reverse relations
1346.         """
1347.         django_book = Book.objects.get(name='Practical Django Projects')
1348.         ItemTag.objects.create(
1349.             object_id=django_book.id, tag='intermediate',
1350.             content_type=ContentType.objects.get_for_model(django_book),
1351.         )
1352.         ItemTag.objects.create(
1353.             object_id=django_book.id, tag='django',
1354.             content_type=ContentType.objects.get_for_model(django_book),
1355.         )
1356.         # Assign a tag to model with same PK as the book above. If the JOIN
1357.         # used in aggregation doesn't have content type as part of the
1358.         # condition the annotation will also count the 'hi mom' tag for b.
1359.         wmpk = WithManualPK.objects.create(id=django_book.pk)
1360.         ItemTag.objects.create(
1361.             object_id=wmpk.id, tag='hi mom',
1362.             content_type=ContentType.objects.get_for_model(wmpk),
1363.         )
1364.         ai_book = Book.objects.get(name__startswith='Paradigms of Artificial Intelligence')
1365.         ItemTag.objects.create(
1366.             object_id=ai_book.id, tag='intermediate',
1367.             content_type=ContentType.objects.get_for_model(ai_book),
1368.         )
1369. 
1370.         self.assertEqual(Book.objects.aggregate(Count('tags')), {'tags__count': 3})
1371.         results = Book.objects.annotate(Count('tags')).order_by('-tags__count', 'name')
1372.         self.assertEqual(
1373.             [(b.name, b.tags__count) for b in results],
1374.             [
1375.                 ('Practical Django Projects', 2),
1376.                 ('Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp', 1),
1377.                 ('Artificial Intelligence: A Modern Approach', 0),
1378.                 ('Python Web Development with Django', 0),
1379.                 ('Sams Teach Yourself Django in 24 Hours', 0),
1380.                 ('The Definitive Guide to Django: Web Development Done Right', 0)
1381.             ]
1382.         )
1383. 
1384.     def test_negated_aggregation(self):
1385.         expected_results = Author.objects.exclude(
1386.             pk__in=Author.objects.annotate(book_cnt=Count('book')).filter(book_cnt=2)
1387.         ).order_by('name')
1388.         expected_results = [a.name for a in expected_results]
1389.         qs = Author.objects.annotate(book_cnt=Count('book')).exclude(
1390.             Q(book_cnt=2), Q(book_cnt=2)).order_by('name')
1391.         self.assertQuerysetEqual(
1392.             qs,
1393.             expected_results,
1394.             lambda b: b.name
1395.         )
1396.         expected_results = Author.objects.exclude(
1397.             pk__in=Author.objects.annotate(book_cnt=Count('book')).filter(book_cnt=2)
1398.         ).order_by('name')
1399.         expected_results = [a.name for a in expected_results]
1400.         qs = Author.objects.annotate(book_cnt=Count('book')).exclude(Q(book_cnt=2) | Q(book_cnt=2)).order_by('name')
1401.         self.assertQuerysetEqual(
1402.             qs,
1403.             expected_results,
1404.             lambda b: b.name
1405.         )
1406. 
1407.     def test_name_filters(self):
1408.         qs = Author.objects.annotate(Count('book')).filter(
1409.             Q(book__count__exact=2) | Q(name='Adrian Holovaty')
1410.         ).order_by('name')
1411.         self.assertQuerysetEqual(
1412.             qs,
1413.             ['Adrian Holovaty', 'Peter Norvig'],
1414.             lambda b: b.name
1415.         )
1416. 
1417.     def test_name_expressions(self):
1418.         # Aggregates are spotted correctly from F objects.
1419.         # Note that Adrian's age is 34 in the fixtures, and he has one book
1420.         # so both conditions match one author.
1421.         qs = Author.objects.annotate(Count('book')).filter(
1422.             Q(name='Peter Norvig') | Q(age=F('book__count') + 33)
1423.         ).order_by('name')
1424.         self.assertQuerysetEqual(
1425.             qs,
1426.             ['Adrian Holovaty', 'Peter Norvig'],
1427.             lambda b: b.name
1428.         )
1429. 
1430.     def test_ticket_11293(self):
1431.         q1 = Q(price__gt=50)
1432.         q2 = Q(authors__count__gt=1)
1433.         query = Book.objects.annotate(Count('authors')).filter(
1434.             q1 | q2).order_by('pk')
1435.         self.assertQuerysetEqual(
1436.             query, [1, 4, 5, 6],
1437.             lambda b: b.pk)
1438. 
1439.     def test_ticket_11293_q_immutable(self):
1440.         """
1441.         Splitting a q object to parts for where/having doesn't alter
1442.         the original q-object.
1443.         """
1444.         q1 = Q(isbn='')
1445.         q2 = Q(authors__count__gt=1)
1446.         query = Book.objects.annotate(Count('authors'))
1447.         query.filter(q1 | q2)
1448.         self.assertEqual(len(q2.children), 1)
1449. 
1450.     @ignore_warnings(category=RemovedInDjango31Warning)
1451.     def test_fobj_group_by(self):
1452.         """
1453.         An F() object referring to related column works correctly in group by.
1454.         """
1455.         qs = Book.objects.annotate(
1456.             account=Count('authors')
1457.         ).filter(
1458.             account=F('publisher__num_awards')
1459.         )
1460.         self.assertQuerysetEqual(
1461.             qs, ['Sams Teach Yourself Django in 24 Hours'],
1462.             lambda b: b.name)
1463. 
1464.     def test_annotate_reserved_word(self):
1465.         """
1466.         Regression #18333 - Ensure annotated column name is properly quoted.
1467.         """
1468.         vals = Book.objects.annotate(select=Count('authors__id')).aggregate(Sum('select'), Avg('select'))
1469.         self.assertEqual(vals, {
1470.             'select__sum': 10,
1471.             'select__avg': Approximate(1.666, places=2),
1472.         })
1473. 
1474.     def test_annotate_on_relation(self):
1475.         book = Book.objects.annotate(avg_price=Avg('price'), publisher_name=F('publisher__name')).get(pk=self.b1.pk)
1476.         self.assertEqual(book.avg_price, 30.00)
1477.         self.assertEqual(book.publisher_name, "Apress")
1478. 
1479.     def test_aggregate_on_relation(self):
1480.         # A query with an existing annotation aggregation on a relation should
1481.         # succeed.
1482.         qs = Book.objects.annotate(avg_price=Avg('price')).aggregate(
1483.             publisher_awards=Sum('publisher__num_awards')
1484.         )
1485.         self.assertEqual(qs['publisher_awards'], 30)
1486. 
1487.     def test_annotate_distinct_aggregate(self):
1488.         # There are three books with rating of 4.0 and two of the books have
1489.         # the same price. Hence, the distinct removes one rating of 4.0
1490.         # from the results.
1491.         vals1 = Book.objects.values('rating', 'price').distinct().aggregate(result=Sum('rating'))
1492.         vals2 = Book.objects.aggregate(result=Sum('rating') - Value(4.0))
1493.         self.assertEqual(vals1, vals2)
1494. 
1495.     def test_annotate_values_list_flat(self):
1496.         """Find ages that are shared by at least two authors."""
1497.         qs = Author.objects.values_list('age', flat=True).annotate(age_count=Count('age')).filter(age_count__gt=1)
1498.         self.assertSequenceEqual(qs, [29])
1499. 
1500.     def test_allow_distinct(self):
1501.         class MyAggregate(Aggregate):
1502.             pass
1503.         with self.assertRaisesMessage(TypeError, 'MyAggregate does not allow distinct'):
1504.             MyAggregate('foo', distinct=True)
1505. 
1506.         class DistinctAggregate(Aggregate):
1507.             allow_distinct = True
1508.         DistinctAggregate('foo', distinct=True)


File: tests/aggregation_regress/tests.py
Line number range: 1511 - 1541
Content:
1511. class JoinPromotionTests(TestCase):
1512.     def test_ticket_21150(self):
1513.         b = Bravo.objects.create()
1514.         c = Charlie.objects.create(bravo=b)
1515.         qs = Charlie.objects.select_related('alfa').annotate(Count('bravo__charlie'))
1516.         self.assertSequenceEqual(qs, [c])
1517.         self.assertIs(qs[0].alfa, None)
1518.         a = Alfa.objects.create()
1519.         c.alfa = a
1520.         c.save()
1521.         # Force re-evaluation
1522.         qs = qs.all()
1523.         self.assertSequenceEqual(qs, [c])
1524.         self.assertEqual(qs[0].alfa, a)
1525. 
1526.     def test_existing_join_not_promoted(self):
1527.         # No promotion for existing joins
1528.         qs = Charlie.objects.filter(alfa__name__isnull=False).annotate(Count('alfa__name'))
1529.         self.assertIn(' INNER JOIN ', str(qs.query))
1530.         # Also, the existing join is unpromoted when doing filtering for already
1531.         # promoted join.
1532.         qs = Charlie.objects.annotate(Count('alfa__name')).filter(alfa__name__isnull=False)
1533.         self.assertIn(' INNER JOIN ', str(qs.query))
1534.         # But, as the join is nullable first use by annotate will be LOUTER
1535.         qs = Charlie.objects.annotate(Count('alfa__name'))
1536.         self.assertIn(' LEFT OUTER JOIN ', str(qs.query))
1537. 
1538.     @ignore_warnings(category=RemovedInDjango31Warning)
1539.     def test_non_nullable_fk_not_promoted(self):
1540.         qs = Book.objects.annotate(Count('contact__name'))
1541.         self.assertIn(' INNER JOIN ', str(qs.query))


File: tests/aggregation_regress/tests.py
Line number range: 1544 - 1553
Content:
1544. class SelfReferentialFKTests(TestCase):
1545.     def test_ticket_24748(self):
1546.         t1 = SelfRefFK.objects.create(name='t1')
1547.         SelfRefFK.objects.create(name='t2', parent=t1)
1548.         SelfRefFK.objects.create(name='t3', parent=t1)
1549.         self.assertQuerysetEqual(
1550.             SelfRefFK.objects.annotate(num_children=Count('children')).order_by('name'),
1551.             [('t1', 2), ('t2', 0), ('t3', 0)],
1552.             lambda x: (x.name, x.num_children)
1553.         )


File: tests/expressions/tests.py
Line number range: 1 - 500
Content:
1. import datetime
2. import pickle
3. import unittest
4. import uuid
5. from copy import deepcopy
6. 
7. from django.core.exceptions import FieldError
8. from django.db import DatabaseError, connection, models
9. from django.db.models import CharField, Q, TimeField, UUIDField
10. from django.db.models.aggregates import (
11.     Avg, Count, Max, Min, StdDev, Sum, Variance,
12. )
13. from django.db.models.expressions import (
14.     Case, Col, Combinable, Exists, Expression, ExpressionList,
15.     ExpressionWrapper, F, Func, OrderBy, OuterRef, Random, RawSQL, Ref,
16.     Subquery, Value, When,
17. )
18. from django.db.models.functions import (
19.     Coalesce, Concat, Length, Lower, Substr, Upper,
20. )
21. from django.db.models.sql import constants
22. from django.db.models.sql.datastructures import Join
23. from django.test import SimpleTestCase, TestCase, skipUnlessDBFeature
24. from django.test.utils import Approximate
25. 
26. from .models import (
27.     UUID, UUIDPK, Company, Employee, Experiment, Number, RemoteEmployee,
28.     Result, SimulationRun, Time,
29. )
30. 
31. 
32. class BasicExpressionsTests(TestCase):
33.     @classmethod
34.     def setUpTestData(cls):
35.         cls.example_inc = Company.objects.create(
36.             name="Example Inc.", num_employees=2300, num_chairs=5,
37.             ceo=Employee.objects.create(firstname="Joe", lastname="Smith", salary=10)
38.         )
39.         cls.foobar_ltd = Company.objects.create(
40.             name="Foobar Ltd.", num_employees=3, num_chairs=4,
41.             ceo=Employee.objects.create(firstname="Frank", lastname="Meyer", salary=20)
42.         )
43.         cls.max = Employee.objects.create(firstname='Max', lastname='Mustermann', salary=30)
44.         cls.gmbh = Company.objects.create(name='Test GmbH', num_employees=32, num_chairs=1, ceo=cls.max)
45. 
46.     def setUp(self):
47.         self.company_query = Company.objects.values(
48.             "name", "num_employees", "num_chairs"
49.         ).order_by(
50.             "name", "num_employees", "num_chairs"
51.         )
52. 
53.     def test_annotate_values_aggregate(self):
54.         companies = Company.objects.annotate(
55.             salaries=F('ceo__salary'),
56.         ).values('num_employees', 'salaries').aggregate(
57.             result=Sum(
58.                 F('salaries') + F('num_employees'),
59.                 output_field=models.IntegerField()
60.             ),
61.         )
62.         self.assertEqual(companies['result'], 2395)
63. 
64.     def test_annotate_values_filter(self):
65.         companies = Company.objects.annotate(
66.             foo=RawSQL('%s', ['value']),
67.         ).filter(foo='value').order_by('name')
68.         self.assertQuerysetEqual(
69.             companies,
70.             ['<Company: Example Inc.>', '<Company: Foobar Ltd.>', '<Company: Test GmbH>'],
71.         )
72. 
73.     @unittest.skipIf(connection.vendor == 'oracle', "Oracle doesn't support using boolean type in SELECT")
74.     def test_filtering_on_annotate_that_uses_q(self):
75.         self.assertEqual(
76.             Company.objects.annotate(
77.                 num_employees_check=ExpressionWrapper(Q(num_employees__gt=3), output_field=models.BooleanField())
78.             ).filter(num_employees_check=True).count(),
79.             2,
80.         )
81. 
82.     def test_filter_inter_attribute(self):
83.         # We can filter on attribute relationships on same model obj, e.g.
84.         # find companies where the number of employees is greater
85.         # than the number of chairs.
86.         self.assertSequenceEqual(
87.             self.company_query.filter(num_employees__gt=F("num_chairs")), [
88.                 {
89.                     "num_chairs": 5,
90.                     "name": "Example Inc.",
91.                     "num_employees": 2300,
92.                 },
93.                 {
94.                     "num_chairs": 1,
95.                     "name": "Test GmbH",
96.                     "num_employees": 32
97.                 },
98.             ],
99.         )
100. 
101.     def test_update(self):
102.         # We can set one field to have the value of another field
103.         # Make sure we have enough chairs
104.         self.company_query.update(num_chairs=F("num_employees"))
105.         self.assertSequenceEqual(
106.             self.company_query, [
107.                 {
108.                     "num_chairs": 2300,
109.                     "name": "Example Inc.",
110.                     "num_employees": 2300
111.                 },
112.                 {
113.                     "num_chairs": 3,
114.                     "name": "Foobar Ltd.",
115.                     "num_employees": 3
116.                 },
117.                 {
118.                     "num_chairs": 32,
119.                     "name": "Test GmbH",
120.                     "num_employees": 32
121.                 }
122.             ],
123.         )
124. 
125.     def test_arithmetic(self):
126.         # We can perform arithmetic operations in expressions
127.         # Make sure we have 2 spare chairs
128.         self.company_query.update(num_chairs=F("num_employees") + 2)
129.         self.assertSequenceEqual(
130.             self.company_query, [
131.                 {
132.                     'num_chairs': 2302,
133.                     'name': 'Example Inc.',
134.                     'num_employees': 2300
135.                 },
136.                 {
137.                     'num_chairs': 5,
138.                     'name': 'Foobar Ltd.',
139.                     'num_employees': 3
140.                 },
141.                 {
142.                     'num_chairs': 34,
143.                     'name': 'Test GmbH',
144.                     'num_employees': 32
145.                 }
146.             ],
147.         )
148. 
149.     def test_order_of_operations(self):
150.         # Law of order of operations is followed
151.         self.company_query.update(num_chairs=F('num_employees') + 2 * F('num_employees'))
152.         self.assertSequenceEqual(
153.             self.company_query, [
154.                 {
155.                     'num_chairs': 6900,
156.                     'name': 'Example Inc.',
157.                     'num_employees': 2300
158.                 },
159.                 {
160.                     'num_chairs': 9,
161.                     'name': 'Foobar Ltd.',
162.                     'num_employees': 3
163.                 },
164.                 {
165.                     'num_chairs': 96,
166.                     'name': 'Test GmbH',
167.                     'num_employees': 32
168.                 }
169.             ],
170.         )
171. 
172.     def test_parenthesis_priority(self):
173.         # Law of order of operations can be overridden by parentheses
174.         self.company_query.update(num_chairs=(F('num_employees') + 2) * F('num_employees'))
175.         self.assertSequenceEqual(
176.             self.company_query, [
177.                 {
178.                     'num_chairs': 5294600,
179.                     'name': 'Example Inc.',
180.                     'num_employees': 2300
181.                 },
182.                 {
183.                     'num_chairs': 15,
184.                     'name': 'Foobar Ltd.',
185.                     'num_employees': 3
186.                 },
187.                 {
188.                     'num_chairs': 1088,
189.                     'name': 'Test GmbH',
190.                     'num_employees': 32
191.                 }
192.             ],
193.         )
194. 
195.     def test_update_with_fk(self):
196.         # ForeignKey can become updated with the value of another ForeignKey.
197.         self.assertEqual(Company.objects.update(point_of_contact=F('ceo')), 3)
198.         self.assertQuerysetEqual(
199.             Company.objects.all(),
200.             ['Joe Smith', 'Frank Meyer', 'Max Mustermann'],
201.             lambda c: str(c.point_of_contact),
202.             ordered=False
203.         )
204. 
205.     def test_update_with_none(self):
206.         Number.objects.create(integer=1, float=1.0)
207.         Number.objects.create(integer=2)
208.         Number.objects.filter(float__isnull=False).update(float=Value(None))
209.         self.assertQuerysetEqual(
210.             Number.objects.all(),
211.             [None, None],
212.             lambda n: n.float,
213.             ordered=False
214.         )
215. 
216.     def test_filter_with_join(self):
217.         # F Expressions can also span joins
218.         Company.objects.update(point_of_contact=F('ceo'))
219.         c = Company.objects.first()
220.         c.point_of_contact = Employee.objects.create(firstname="Guido", lastname="van Rossum")
221.         c.save()
222. 
223.         self.assertQuerysetEqual(
224.             Company.objects.filter(ceo__firstname=F('point_of_contact__firstname')),
225.             ['Foobar Ltd.', 'Test GmbH'],
226.             lambda c: c.name,
227.             ordered=False
228.         )
229. 
230.         Company.objects.exclude(
231.             ceo__firstname=F("point_of_contact__firstname")
232.         ).update(name="foo")
233.         self.assertEqual(
234.             Company.objects.exclude(
235.                 ceo__firstname=F('point_of_contact__firstname')
236.             ).get().name,
237.             "foo",
238.         )
239. 
240.         msg = "Joined field references are not permitted in this query"
241.         with self.assertRaisesMessage(FieldError, msg):
242.             Company.objects.exclude(
243.                 ceo__firstname=F('point_of_contact__firstname')
244.             ).update(name=F('point_of_contact__lastname'))
245. 
246.     def test_object_update(self):
247.         # F expressions can be used to update attributes on single objects
248.         self.gmbh.num_employees = F('num_employees') + 4
249.         self.gmbh.save()
250.         self.gmbh.refresh_from_db()
251.         self.assertEqual(self.gmbh.num_employees, 36)
252. 
253.     def test_new_object_save(self):
254.         # We should be able to use Funcs when inserting new data
255.         test_co = Company(name=Lower(Value('UPPER')), num_employees=32, num_chairs=1, ceo=self.max)
256.         test_co.save()
257.         test_co.refresh_from_db()
258.         self.assertEqual(test_co.name, "upper")
259. 
260.     def test_new_object_create(self):
261.         test_co = Company.objects.create(name=Lower(Value('UPPER')), num_employees=32, num_chairs=1, ceo=self.max)
262.         test_co.refresh_from_db()
263.         self.assertEqual(test_co.name, "upper")
264. 
265.     def test_object_create_with_aggregate(self):
266.         # Aggregates are not allowed when inserting new data
267.         with self.assertRaisesMessage(FieldError, 'Aggregate functions are not allowed in this query'):
268.             Company.objects.create(
269.                 name='Company', num_employees=Max(Value(1)), num_chairs=1,
270.                 ceo=Employee.objects.create(firstname="Just", lastname="Doit", salary=30),
271.             )
272. 
273.     def test_object_update_fk(self):
274.         # F expressions cannot be used to update attributes which are foreign
275.         # keys, or attributes which involve joins.
276.         test_gmbh = Company.objects.get(pk=self.gmbh.pk)
277.         msg = 'F(ceo)": "Company.point_of_contact" must be a "Employee" instance.'
278.         with self.assertRaisesMessage(ValueError, msg):
279.             test_gmbh.point_of_contact = F('ceo')
280. 
281.         test_gmbh.point_of_contact = self.gmbh.ceo
282.         test_gmbh.save()
283.         test_gmbh.name = F('ceo__last_name')
284.         msg = 'Joined field references are not permitted in this query'
285.         with self.assertRaisesMessage(FieldError, msg):
286.             test_gmbh.save()
287. 
288.     def test_update_inherited_field_value(self):
289.         msg = 'Joined field references are not permitted in this query'
290.         with self.assertRaisesMessage(FieldError, msg):
291.             RemoteEmployee.objects.update(adjusted_salary=F('salary') * 5)
292. 
293.     def test_object_update_unsaved_objects(self):
294.         # F expressions cannot be used to update attributes on objects which do
295.         # not yet exist in the database
296.         acme = Company(name='The Acme Widget Co.', num_employees=12, num_chairs=5, ceo=self.max)
297.         acme.num_employees = F("num_employees") + 16
298.         msg = (
299.             'Failed to insert expression "Col(expressions_company, '
300.             'expressions.Company.num_employees) + Value(16)" on '
301.             'expressions.Company.num_employees. F() expressions can only be '
302.             'used to update, not to insert.'
303.         )
304.         with self.assertRaisesMessage(ValueError, msg):
305.             acme.save()
306. 
307.         acme.num_employees = 12
308.         acme.name = Lower(F('name'))
309.         msg = (
310.             'Failed to insert expression "Lower(Col(expressions_company, '
311.             'expressions.Company.name))" on expressions.Company.name. F() '
312.             'expressions can only be used to update, not to insert.'
313.         )
314.         with self.assertRaisesMessage(ValueError, msg):
315.             acme.save()
316. 
317.     def test_ticket_11722_iexact_lookup(self):
318.         Employee.objects.create(firstname="John", lastname="Doe")
319.         Employee.objects.create(firstname="Test", lastname="test")
320. 
321.         queryset = Employee.objects.filter(firstname__iexact=F('lastname'))
322.         self.assertQuerysetEqual(queryset, ["<Employee: Test test>"])
323. 
324.     def test_ticket_16731_startswith_lookup(self):
325.         Employee.objects.create(firstname="John", lastname="Doe")
326.         e2 = Employee.objects.create(firstname="Jack", lastname="Jackson")
327.         e3 = Employee.objects.create(firstname="Jack", lastname="jackson")
328.         self.assertSequenceEqual(
329.             Employee.objects.filter(lastname__startswith=F('firstname')),
330.             [e2, e3] if connection.features.has_case_insensitive_like else [e2]
331.         )
332.         qs = Employee.objects.filter(lastname__istartswith=F('firstname')).order_by('pk')
333.         self.assertSequenceEqual(qs, [e2, e3])
334. 
335.     def test_ticket_18375_join_reuse(self):
336.         # Reverse multijoin F() references and the lookup target the same join.
337.         # Pre #18375 the F() join was generated first and the lookup couldn't
338.         # reuse that join.
339.         qs = Employee.objects.filter(company_ceo_set__num_chairs=F('company_ceo_set__num_employees'))
340.         self.assertEqual(str(qs.query).count('JOIN'), 1)
341. 
342.     def test_ticket_18375_kwarg_ordering(self):
343.         # The next query was dict-randomization dependent - if the "gte=1"
344.         # was seen first, then the F() will reuse the join generated by the
345.         # gte lookup, if F() was seen first, then it generated a join the
346.         # other lookups could not reuse.
347.         qs = Employee.objects.filter(
348.             company_ceo_set__num_chairs=F('company_ceo_set__num_employees'),
349.             company_ceo_set__num_chairs__gte=1,
350.         )
351.         self.assertEqual(str(qs.query).count('JOIN'), 1)
352. 
353.     def test_ticket_18375_kwarg_ordering_2(self):
354.         # Another similar case for F() than above. Now we have the same join
355.         # in two filter kwargs, one in the lhs lookup, one in F. Here pre
356.         # #18375 the amount of joins generated was random if dict
357.         # randomization was enabled, that is the generated query dependent
358.         # on which clause was seen first.
359.         qs = Employee.objects.filter(
360.             company_ceo_set__num_employees=F('pk'),
361.             pk=F('company_ceo_set__num_employees')
362.         )
363.         self.assertEqual(str(qs.query).count('JOIN'), 1)
364. 
365.     def test_ticket_18375_chained_filters(self):
366.         # F() expressions do not reuse joins from previous filter.
367.         qs = Employee.objects.filter(
368.             company_ceo_set__num_employees=F('pk')
369.         ).filter(
370.             company_ceo_set__num_employees=F('company_ceo_set__num_employees')
371.         )
372.         self.assertEqual(str(qs.query).count('JOIN'), 2)
373. 
374.     def test_order_by_exists(self):
375.         mary = Employee.objects.create(firstname='Mary', lastname='Mustermann', salary=20)
376.         mustermanns_by_seniority = Employee.objects.filter(lastname='Mustermann').order_by(
377.             # Order by whether the employee is the CEO of a company
378.             Exists(Company.objects.filter(ceo=OuterRef('pk'))).desc()
379.         )
380.         self.assertSequenceEqual(mustermanns_by_seniority, [self.max, mary])
381. 
382.     def test_outerref(self):
383.         inner = Company.objects.filter(point_of_contact=OuterRef('pk'))
384.         msg = (
385.             'This queryset contains a reference to an outer query and may only '
386.             'be used in a subquery.'
387.         )
388.         with self.assertRaisesMessage(ValueError, msg):
389.             inner.exists()
390. 
391.         outer = Employee.objects.annotate(is_point_of_contact=Exists(inner))
392.         self.assertIs(outer.exists(), True)
393. 
394.     def test_exist_single_field_output_field(self):
395.         queryset = Company.objects.values('pk')
396.         self.assertIsInstance(Exists(queryset).output_field, models.BooleanField)
397. 
398.     def test_subquery(self):
399.         Company.objects.filter(name='Example Inc.').update(
400.             point_of_contact=Employee.objects.get(firstname='Joe', lastname='Smith'),
401.             ceo=self.max,
402.         )
403.         Employee.objects.create(firstname='Bob', lastname='Brown', salary=40)
404.         qs = Employee.objects.annotate(
405.             is_point_of_contact=Exists(Company.objects.filter(point_of_contact=OuterRef('pk'))),
406.             is_not_point_of_contact=~Exists(Company.objects.filter(point_of_contact=OuterRef('pk'))),
407.             is_ceo_of_small_company=Exists(Company.objects.filter(num_employees__lt=200, ceo=OuterRef('pk'))),
408.             is_ceo_small_2=~~Exists(Company.objects.filter(num_employees__lt=200, ceo=OuterRef('pk'))),
409.             largest_company=Subquery(Company.objects.order_by('-num_employees').filter(
410.                 models.Q(ceo=OuterRef('pk')) | models.Q(point_of_contact=OuterRef('pk'))
411.             ).values('name')[:1], output_field=models.CharField())
412.         ).values(
413.             'firstname',
414.             'is_point_of_contact',
415.             'is_not_point_of_contact',
416.             'is_ceo_of_small_company',
417.             'is_ceo_small_2',
418.             'largest_company',
419.         ).order_by('firstname')
420. 
421.         results = list(qs)
422.         # Could use Coalesce(subq, Value('')) instead except for the bug in
423.         # cx_Oracle mentioned in #23843.
424.         bob = results[0]
425.         if bob['largest_company'] == '' and connection.features.interprets_empty_strings_as_nulls:
426.             bob['largest_company'] = None
427. 
428.         self.assertEqual(results, [
429.             {
430.                 'firstname': 'Bob',
431.                 'is_point_of_contact': False,
432.                 'is_not_point_of_contact': True,
433.                 'is_ceo_of_small_company': False,
434.                 'is_ceo_small_2': False,
435.                 'largest_company': None,
436.             },
437.             {
438.                 'firstname': 'Frank',
439.                 'is_point_of_contact': False,
440.                 'is_not_point_of_contact': True,
441.                 'is_ceo_of_small_company': True,
442.                 'is_ceo_small_2': True,
443.                 'largest_company': 'Foobar Ltd.',
444.             },
445.             {
446.                 'firstname': 'Joe',
447.                 'is_point_of_contact': True,
448.                 'is_not_point_of_contact': False,
449.                 'is_ceo_of_small_company': False,
450.                 'is_ceo_small_2': False,
451.                 'largest_company': 'Example Inc.',
452.             },
453.             {
454.                 'firstname': 'Max',
455.                 'is_point_of_contact': False,
456.                 'is_not_point_of_contact': True,
457.                 'is_ceo_of_small_company': True,
458.                 'is_ceo_small_2': True,
459.                 'largest_company': 'Example Inc.'
460.             }
461.         ])
462.         # A less elegant way to write the same query: this uses a LEFT OUTER
463.         # JOIN and an IS NULL, inside a WHERE NOT IN which is probably less
464.         # efficient than EXISTS.
465.         self.assertCountEqual(
466.             qs.filter(is_point_of_contact=True).values('pk'),
467.             Employee.objects.exclude(company_point_of_contact_set=None).values('pk')
468.         )
469. 
470.     def test_in_subquery(self):
471.         # This is a contrived test (and you really wouldn't write this query),
472.         # but it is a succinct way to test the __in=Subquery() construct.
473.         small_companies = Company.objects.filter(num_employees__lt=200).values('pk')
474.         subquery_test = Company.objects.filter(pk__in=Subquery(small_companies))
475.         self.assertCountEqual(subquery_test, [self.foobar_ltd, self.gmbh])
476.         subquery_test2 = Company.objects.filter(pk=Subquery(small_companies.filter(num_employees=3)))
477.         self.assertCountEqual(subquery_test2, [self.foobar_ltd])
478. 
479.     def test_uuid_pk_subquery(self):
480.         u = UUIDPK.objects.create()
481.         UUID.objects.create(uuid_fk=u)
482.         qs = UUIDPK.objects.filter(id__in=Subquery(UUID.objects.values('uuid_fk__id')))
483.         self.assertCountEqual(qs, [u])
484. 
485.     def test_nested_subquery(self):
486.         inner = Company.objects.filter(point_of_contact=OuterRef('pk'))
487.         outer = Employee.objects.annotate(is_point_of_contact=Exists(inner))
488.         contrived = Employee.objects.annotate(
489.             is_point_of_contact=Subquery(
490.                 outer.filter(pk=OuterRef('pk')).values('is_point_of_contact'),
491.                 output_field=models.BooleanField(),
492.             ),
493.         )
494.         self.assertCountEqual(contrived.values_list(), outer.values_list())
495. 
496.     def test_nested_subquery_outer_ref_2(self):
497.         first = Time.objects.create(time='09:00')
498.         second = Time.objects.create(time='17:00')
499.         third = Time.objects.create(time='21:00')
500.         SimulationRun.objects.bulk_create([


File: tests/expressions_case/tests.py
Line number range: 1 - 500
Content:
1. import unittest
2. from datetime import date, datetime, time, timedelta
3. from decimal import Decimal
4. from operator import attrgetter, itemgetter
5. from uuid import UUID
6. 
7. from django.core.exceptions import FieldError
8. from django.db import models
9. from django.db.models import F, Max, Min, Q, Sum, Value
10. from django.db.models.expressions import Case, When
11. from django.test import SimpleTestCase, TestCase
12. 
13. from .models import CaseTestModel, Client, FKCaseTestModel, O2OCaseTestModel
14. 
15. try:
16.     from PIL import Image
17. except ImportError:
18.     Image = None
19. 
20. 
21. class CaseExpressionTests(TestCase):
22.     @classmethod
23.     def setUpTestData(cls):
24.         o = CaseTestModel.objects.create(integer=1, integer2=1, string='1')
25.         O2OCaseTestModel.objects.create(o2o=o, integer=1)
26.         FKCaseTestModel.objects.create(fk=o, integer=1)
27. 
28.         o = CaseTestModel.objects.create(integer=2, integer2=3, string='2')
29.         O2OCaseTestModel.objects.create(o2o=o, integer=2)
30.         FKCaseTestModel.objects.create(fk=o, integer=2)
31.         FKCaseTestModel.objects.create(fk=o, integer=3)
32. 
33.         o = CaseTestModel.objects.create(integer=3, integer2=4, string='3')
34.         O2OCaseTestModel.objects.create(o2o=o, integer=3)
35.         FKCaseTestModel.objects.create(fk=o, integer=3)
36.         FKCaseTestModel.objects.create(fk=o, integer=4)
37. 
38.         o = CaseTestModel.objects.create(integer=2, integer2=2, string='2')
39.         O2OCaseTestModel.objects.create(o2o=o, integer=2)
40.         FKCaseTestModel.objects.create(fk=o, integer=2)
41.         FKCaseTestModel.objects.create(fk=o, integer=3)
42. 
43.         o = CaseTestModel.objects.create(integer=3, integer2=4, string='3')
44.         O2OCaseTestModel.objects.create(o2o=o, integer=3)
45.         FKCaseTestModel.objects.create(fk=o, integer=3)
46.         FKCaseTestModel.objects.create(fk=o, integer=4)
47. 
48.         o = CaseTestModel.objects.create(integer=3, integer2=3, string='3')
49.         O2OCaseTestModel.objects.create(o2o=o, integer=3)
50.         FKCaseTestModel.objects.create(fk=o, integer=3)
51.         FKCaseTestModel.objects.create(fk=o, integer=4)
52. 
53.         o = CaseTestModel.objects.create(integer=4, integer2=5, string='4')
54.         O2OCaseTestModel.objects.create(o2o=o, integer=1)
55.         FKCaseTestModel.objects.create(fk=o, integer=5)
56. 
57.         # GROUP BY on Oracle fails with TextField/BinaryField; see #24096.
58.         cls.non_lob_fields = [
59.             f.name for f in CaseTestModel._meta.get_fields()
60.             if not (f.is_relation and f.auto_created) and not isinstance(f, (models.BinaryField, models.TextField))
61.         ]
62. 
63.     def test_annotate(self):
64.         self.assertQuerysetEqual(
65.             CaseTestModel.objects.annotate(test=Case(
66.                 When(integer=1, then=Value('one')),
67.                 When(integer=2, then=Value('two')),
68.                 default=Value('other'),
69.                 output_field=models.CharField(),
70.             )).order_by('pk'),
71.             [(1, 'one'), (2, 'two'), (3, 'other'), (2, 'two'), (3, 'other'), (3, 'other'), (4, 'other')],
72.             transform=attrgetter('integer', 'test')
73.         )
74. 
75.     def test_annotate_without_default(self):
76.         self.assertQuerysetEqual(
77.             CaseTestModel.objects.annotate(test=Case(
78.                 When(integer=1, then=1),
79.                 When(integer=2, then=2),
80.                 output_field=models.IntegerField(),
81.             )).order_by('pk'),
82.             [(1, 1), (2, 2), (3, None), (2, 2), (3, None), (3, None), (4, None)],
83.             transform=attrgetter('integer', 'test')
84.         )
85. 
86.     def test_annotate_with_expression_as_value(self):
87.         self.assertQuerysetEqual(
88.             CaseTestModel.objects.annotate(f_test=Case(
89.                 When(integer=1, then=F('integer') + 1),
90.                 When(integer=2, then=F('integer') + 3),
91.                 default='integer',
92.             )).order_by('pk'),
93.             [(1, 2), (2, 5), (3, 3), (2, 5), (3, 3), (3, 3), (4, 4)],
94.             transform=attrgetter('integer', 'f_test')
95.         )
96. 
97.     def test_annotate_with_expression_as_condition(self):
98.         self.assertQuerysetEqual(
99.             CaseTestModel.objects.annotate(f_test=Case(
100.                 When(integer2=F('integer'), then=Value('equal')),
101.                 When(integer2=F('integer') + 1, then=Value('+1')),
102.                 output_field=models.CharField(),
103.             )).order_by('pk'),
104.             [(1, 'equal'), (2, '+1'), (3, '+1'), (2, 'equal'), (3, '+1'), (3, 'equal'), (4, '+1')],
105.             transform=attrgetter('integer', 'f_test')
106.         )
107. 
108.     def test_annotate_with_join_in_value(self):
109.         self.assertQuerysetEqual(
110.             CaseTestModel.objects.annotate(join_test=Case(
111.                 When(integer=1, then=F('o2o_rel__integer') + 1),
112.                 When(integer=2, then=F('o2o_rel__integer') + 3),
113.                 default='o2o_rel__integer',
114.             )).order_by('pk'),
115.             [(1, 2), (2, 5), (3, 3), (2, 5), (3, 3), (3, 3), (4, 1)],
116.             transform=attrgetter('integer', 'join_test')
117.         )
118. 
119.     def test_annotate_with_in_clause(self):
120.         fk_rels = FKCaseTestModel.objects.filter(integer__in=[5])
121.         self.assertQuerysetEqual(
122.             CaseTestModel.objects.only('pk', 'integer').annotate(in_test=Sum(Case(
123.                 When(fk_rel__in=fk_rels, then=F('fk_rel__integer')),
124.                 default=Value(0),
125.             ))).order_by('pk'),
126.             [(1, 0), (2, 0), (3, 0), (2, 0), (3, 0), (3, 0), (4, 5)],
127.             transform=attrgetter('integer', 'in_test')
128.         )
129. 
130.     def test_annotate_with_join_in_condition(self):
131.         self.assertQuerysetEqual(
132.             CaseTestModel.objects.annotate(join_test=Case(
133.                 When(integer2=F('o2o_rel__integer'), then=Value('equal')),
134.                 When(integer2=F('o2o_rel__integer') + 1, then=Value('+1')),
135.                 default=Value('other'),
136.                 output_field=models.CharField(),
137.             )).order_by('pk'),
138.             [(1, 'equal'), (2, '+1'), (3, '+1'), (2, 'equal'), (3, '+1'), (3, 'equal'), (4, 'other')],
139.             transform=attrgetter('integer', 'join_test')
140.         )
141. 
142.     def test_annotate_with_join_in_predicate(self):
143.         self.assertQuerysetEqual(
144.             CaseTestModel.objects.annotate(join_test=Case(
145.                 When(o2o_rel__integer=1, then=Value('one')),
146.                 When(o2o_rel__integer=2, then=Value('two')),
147.                 When(o2o_rel__integer=3, then=Value('three')),
148.                 default=Value('other'),
149.                 output_field=models.CharField(),
150.             )).order_by('pk'),
151.             [(1, 'one'), (2, 'two'), (3, 'three'), (2, 'two'), (3, 'three'), (3, 'three'), (4, 'one')],
152.             transform=attrgetter('integer', 'join_test')
153.         )
154. 
155.     def test_annotate_with_annotation_in_value(self):
156.         self.assertQuerysetEqual(
157.             CaseTestModel.objects.annotate(
158.                 f_plus_1=F('integer') + 1,
159.                 f_plus_3=F('integer') + 3,
160.             ).annotate(
161.                 f_test=Case(
162.                     When(integer=1, then='f_plus_1'),
163.                     When(integer=2, then='f_plus_3'),
164.                     default='integer',
165.                 ),
166.             ).order_by('pk'),
167.             [(1, 2), (2, 5), (3, 3), (2, 5), (3, 3), (3, 3), (4, 4)],
168.             transform=attrgetter('integer', 'f_test')
169.         )
170. 
171.     def test_annotate_with_annotation_in_condition(self):
172.         self.assertQuerysetEqual(
173.             CaseTestModel.objects.annotate(
174.                 f_plus_1=F('integer') + 1,
175.             ).annotate(
176.                 f_test=Case(
177.                     When(integer2=F('integer'), then=Value('equal')),
178.                     When(integer2=F('f_plus_1'), then=Value('+1')),
179.                     output_field=models.CharField(),
180.                 ),
181.             ).order_by('pk'),
182.             [(1, 'equal'), (2, '+1'), (3, '+1'), (2, 'equal'), (3, '+1'), (3, 'equal'), (4, '+1')],
183.             transform=attrgetter('integer', 'f_test')
184.         )
185. 
186.     def test_annotate_with_annotation_in_predicate(self):
187.         self.assertQuerysetEqual(
188.             CaseTestModel.objects.annotate(
189.                 f_minus_2=F('integer') - 2,
190.             ).annotate(
191.                 test=Case(
192.                     When(f_minus_2=-1, then=Value('negative one')),
193.                     When(f_minus_2=0, then=Value('zero')),
194.                     When(f_minus_2=1, then=Value('one')),
195.                     default=Value('other'),
196.                     output_field=models.CharField(),
197.                 ),
198.             ).order_by('pk'),
199.             [(1, 'negative one'), (2, 'zero'), (3, 'one'), (2, 'zero'), (3, 'one'), (3, 'one'), (4, 'other')],
200.             transform=attrgetter('integer', 'test')
201.         )
202. 
203.     def test_annotate_with_aggregation_in_value(self):
204.         self.assertQuerysetEqual(
205.             CaseTestModel.objects.values(*self.non_lob_fields).annotate(
206.                 min=Min('fk_rel__integer'),
207.                 max=Max('fk_rel__integer'),
208.             ).annotate(
209.                 test=Case(
210.                     When(integer=2, then='min'),
211.                     When(integer=3, then='max'),
212.                 ),
213.             ).order_by('pk'),
214.             [(1, None, 1, 1), (2, 2, 2, 3), (3, 4, 3, 4), (2, 2, 2, 3), (3, 4, 3, 4), (3, 4, 3, 4), (4, None, 5, 5)],
215.             transform=itemgetter('integer', 'test', 'min', 'max')
216.         )
217. 
218.     def test_annotate_with_aggregation_in_condition(self):
219.         self.assertQuerysetEqual(
220.             CaseTestModel.objects.values(*self.non_lob_fields).annotate(
221.                 min=Min('fk_rel__integer'),
222.                 max=Max('fk_rel__integer'),
223.             ).annotate(
224.                 test=Case(
225.                     When(integer2=F('min'), then=Value('min')),
226.                     When(integer2=F('max'), then=Value('max')),
227.                     output_field=models.CharField(),
228.                 ),
229.             ).order_by('pk'),
230.             [(1, 1, 'min'), (2, 3, 'max'), (3, 4, 'max'), (2, 2, 'min'), (3, 4, 'max'), (3, 3, 'min'), (4, 5, 'min')],
231.             transform=itemgetter('integer', 'integer2', 'test')
232.         )
233. 
234.     def test_annotate_with_aggregation_in_predicate(self):
235.         self.assertQuerysetEqual(
236.             CaseTestModel.objects.values(*self.non_lob_fields).annotate(
237.                 max=Max('fk_rel__integer'),
238.             ).annotate(
239.                 test=Case(
240.                     When(max=3, then=Value('max = 3')),
241.                     When(max=4, then=Value('max = 4')),
242.                     default=Value(''),
243.                     output_field=models.CharField(),
244.                 ),
245.             ).order_by('pk'),
246.             [(1, 1, ''), (2, 3, 'max = 3'), (3, 4, 'max = 4'), (2, 3, 'max = 3'),
247.              (3, 4, 'max = 4'), (3, 4, 'max = 4'), (4, 5, '')],
248.             transform=itemgetter('integer', 'max', 'test')
249.         )
250. 
251.     def test_annotate_exclude(self):
252.         self.assertQuerysetEqual(
253.             CaseTestModel.objects.annotate(test=Case(
254.                 When(integer=1, then=Value('one')),
255.                 When(integer=2, then=Value('two')),
256.                 default=Value('other'),
257.                 output_field=models.CharField(),
258.             )).exclude(test='other').order_by('pk'),
259.             [(1, 'one'), (2, 'two'), (2, 'two')],
260.             transform=attrgetter('integer', 'test')
261.         )
262. 
263.     def test_annotate_values_not_in_order_by(self):
264.         self.assertEqual(
265.             list(CaseTestModel.objects.annotate(test=Case(
266.                 When(integer=1, then=Value('one')),
267.                 When(integer=2, then=Value('two')),
268.                 When(integer=3, then=Value('three')),
269.                 default=Value('other'),
270.                 output_field=models.CharField(),
271.             )).order_by('test').values_list('integer', flat=True)),
272.             [1, 4, 3, 3, 3, 2, 2]
273.         )
274. 
275.     def test_annotate_with_empty_when(self):
276.         objects = CaseTestModel.objects.annotate(
277.             selected=Case(
278.                 When(pk__in=[], then=Value('selected')),
279.                 default=Value('not selected'), output_field=models.CharField()
280.             )
281.         )
282.         self.assertEqual(len(objects), CaseTestModel.objects.count())
283.         self.assertTrue(all(obj.selected == 'not selected' for obj in objects))
284. 
285.     def test_combined_expression(self):
286.         self.assertQuerysetEqual(
287.             CaseTestModel.objects.annotate(
288.                 test=Case(
289.                     When(integer=1, then=2),
290.                     When(integer=2, then=1),
291.                     default=3,
292.                     output_field=models.IntegerField(),
293.                 ) + 1,
294.             ).order_by('pk'),
295.             [(1, 3), (2, 2), (3, 4), (2, 2), (3, 4), (3, 4), (4, 4)],
296.             transform=attrgetter('integer', 'test')
297.         )
298. 
299.     def test_in_subquery(self):
300.         self.assertQuerysetEqual(
301.             CaseTestModel.objects.filter(
302.                 pk__in=CaseTestModel.objects.annotate(
303.                     test=Case(
304.                         When(integer=F('integer2'), then='pk'),
305.                         When(integer=4, then='pk'),
306.                         output_field=models.IntegerField(),
307.                     ),
308.                 ).values('test')).order_by('pk'),
309.             [(1, 1), (2, 2), (3, 3), (4, 5)],
310.             transform=attrgetter('integer', 'integer2')
311.         )
312. 
313.     def test_case_reuse(self):
314.         SOME_CASE = Case(
315.             When(pk=0, then=Value('0')),
316.             default=Value('1'),
317.             output_field=models.CharField(),
318.         )
319.         self.assertQuerysetEqual(
320.             CaseTestModel.objects.annotate(somecase=SOME_CASE).order_by('pk'),
321.             CaseTestModel.objects.annotate(somecase=SOME_CASE).order_by('pk').values_list('pk', 'somecase'),
322.             lambda x: (x.pk, x.somecase)
323.         )
324. 
325.     def test_aggregate(self):
326.         self.assertEqual(
327.             CaseTestModel.objects.aggregate(
328.                 one=models.Sum(Case(
329.                     When(integer=1, then=1),
330.                     output_field=models.IntegerField(),
331.                 )),
332.                 two=models.Sum(Case(
333.                     When(integer=2, then=1),
334.                     output_field=models.IntegerField(),
335.                 )),
336.                 three=models.Sum(Case(
337.                     When(integer=3, then=1),
338.                     output_field=models.IntegerField(),
339.                 )),
340.                 four=models.Sum(Case(
341.                     When(integer=4, then=1),
342.                     output_field=models.IntegerField(),
343.                 )),
344.             ),
345.             {'one': 1, 'two': 2, 'three': 3, 'four': 1}
346.         )
347. 
348.     def test_aggregate_with_expression_as_value(self):
349.         self.assertEqual(
350.             CaseTestModel.objects.aggregate(
351.                 one=models.Sum(Case(When(integer=1, then='integer'))),
352.                 two=models.Sum(Case(When(integer=2, then=F('integer') - 1))),
353.                 three=models.Sum(Case(When(integer=3, then=F('integer') + 1))),
354.             ),
355.             {'one': 1, 'two': 2, 'three': 12}
356.         )
357. 
358.     def test_aggregate_with_expression_as_condition(self):
359.         self.assertEqual(
360.             CaseTestModel.objects.aggregate(
361.                 equal=models.Sum(Case(
362.                     When(integer2=F('integer'), then=1),
363.                     output_field=models.IntegerField(),
364.                 )),
365.                 plus_one=models.Sum(Case(
366.                     When(integer2=F('integer') + 1, then=1),
367.                     output_field=models.IntegerField(),
368.                 )),
369.             ),
370.             {'equal': 3, 'plus_one': 4}
371.         )
372. 
373.     def test_filter(self):
374.         self.assertQuerysetEqual(
375.             CaseTestModel.objects.filter(integer2=Case(
376.                 When(integer=2, then=3),
377.                 When(integer=3, then=4),
378.                 default=1,
379.                 output_field=models.IntegerField(),
380.             )).order_by('pk'),
381.             [(1, 1), (2, 3), (3, 4), (3, 4)],
382.             transform=attrgetter('integer', 'integer2')
383.         )
384. 
385.     def test_filter_without_default(self):
386.         self.assertQuerysetEqual(
387.             CaseTestModel.objects.filter(integer2=Case(
388.                 When(integer=2, then=3),
389.                 When(integer=3, then=4),
390.                 output_field=models.IntegerField(),
391.             )).order_by('pk'),
392.             [(2, 3), (3, 4), (3, 4)],
393.             transform=attrgetter('integer', 'integer2')
394.         )
395. 
396.     def test_filter_with_expression_as_value(self):
397.         self.assertQuerysetEqual(
398.             CaseTestModel.objects.filter(integer2=Case(
399.                 When(integer=2, then=F('integer') + 1),
400.                 When(integer=3, then=F('integer')),
401.                 default='integer',
402.             )).order_by('pk'),
403.             [(1, 1), (2, 3), (3, 3)],
404.             transform=attrgetter('integer', 'integer2')
405.         )
406. 
407.     def test_filter_with_expression_as_condition(self):
408.         self.assertQuerysetEqual(
409.             CaseTestModel.objects.filter(string=Case(
410.                 When(integer2=F('integer'), then=Value('2')),
411.                 When(integer2=F('integer') + 1, then=Value('3')),
412.                 output_field=models.CharField(),
413.             )).order_by('pk'),
414.             [(3, 4, '3'), (2, 2, '2'), (3, 4, '3')],
415.             transform=attrgetter('integer', 'integer2', 'string')
416.         )
417. 
418.     def test_filter_with_join_in_value(self):
419.         self.assertQuerysetEqual(
420.             CaseTestModel.objects.filter(integer2=Case(
421.                 When(integer=2, then=F('o2o_rel__integer') + 1),
422.                 When(integer=3, then=F('o2o_rel__integer')),
423.                 default='o2o_rel__integer',
424.             )).order_by('pk'),
425.             [(1, 1), (2, 3), (3, 3)],
426.             transform=attrgetter('integer', 'integer2')
427.         )
428. 
429.     def test_filter_with_join_in_condition(self):
430.         self.assertQuerysetEqual(
431.             CaseTestModel.objects.filter(integer=Case(
432.                 When(integer2=F('o2o_rel__integer') + 1, then=2),
433.                 When(integer2=F('o2o_rel__integer'), then=3),
434.                 output_field=models.IntegerField(),
435.             )).order_by('pk'),
436.             [(2, 3), (3, 3)],
437.             transform=attrgetter('integer', 'integer2')
438.         )
439. 
440.     def test_filter_with_join_in_predicate(self):
441.         self.assertQuerysetEqual(
442.             CaseTestModel.objects.filter(integer2=Case(
443.                 When(o2o_rel__integer=1, then=1),
444.                 When(o2o_rel__integer=2, then=3),
445.                 When(o2o_rel__integer=3, then=4),
446.                 output_field=models.IntegerField(),
447.             )).order_by('pk'),
448.             [(1, 1), (2, 3), (3, 4), (3, 4)],
449.             transform=attrgetter('integer', 'integer2')
450.         )
451. 
452.     def test_filter_with_annotation_in_value(self):
453.         self.assertQuerysetEqual(
454.             CaseTestModel.objects.annotate(
455.                 f=F('integer'),
456.                 f_plus_1=F('integer') + 1,
457.             ).filter(
458.                 integer2=Case(
459.                     When(integer=2, then='f_plus_1'),
460.                     When(integer=3, then='f'),
461.                 ),
462.             ).order_by('pk'),
463.             [(2, 3), (3, 3)],
464.             transform=attrgetter('integer', 'integer2')
465.         )
466. 
467.     def test_filter_with_annotation_in_condition(self):
468.         self.assertQuerysetEqual(
469.             CaseTestModel.objects.annotate(
470.                 f_plus_1=F('integer') + 1,
471.             ).filter(
472.                 integer=Case(
473.                     When(integer2=F('integer'), then=2),
474.                     When(integer2=F('f_plus_1'), then=3),
475.                     output_field=models.IntegerField(),
476.                 ),
477.             ).order_by('pk'),
478.             [(3, 4), (2, 2), (3, 4)],
479.             transform=attrgetter('integer', 'integer2')
480.         )
481. 
482.     def test_filter_with_annotation_in_predicate(self):
483.         self.assertQuerysetEqual(
484.             CaseTestModel.objects.annotate(
485.                 f_plus_1=F('integer') + 1,
486.             ).filter(
487.                 integer2=Case(
488.                     When(f_plus_1=3, then=3),
489.                     When(f_plus_1=4, then=4),
490.                     default=1,
491.                     output_field=models.IntegerField(),
492.                 ),
493.             ).order_by('pk'),
494.             [(1, 1), (2, 3), (3, 4), (3, 4)],
495.             transform=attrgetter('integer', 'integer2')
496.         )
497. 
498.     def test_filter_with_aggregation_in_value(self):
499.         self.assertQuerysetEqual(
500.             CaseTestModel.objects.values(*self.non_lob_fields).annotate(

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-23 18:49:54,112 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user is reporting a bug with a `Count` annotation involving `Case` and `distinct=True`. I have reviewed the provided test files (`tests/aggregation/test_filter_argument.py`, `tests/aggregation/tests.py`, `tests/aggregation_regress/tests.py`, `tests/expressions/tests.py`, `tests/expressions_case/tests.py`) and none of them contain a test case that combines all three elements (`Count`, `Case`, `distinct=True`). The bug is specifically about an annotation, so `tests/annotations/tests.py` is a highly relevant file that might contain a test case that reproduces the bug. I need to inspect this file to find a suitable test.' query='Please provide the full content of `tests/annotations/tests.py`.' extra_requirements='' purpose='I need to find a test case that uses `Count` with `distinct=True` on a `Case` expression to demonstrate the reported bug, and this file is a likely candidate to contain such a test.'
2025-12-23 18:49:54,113 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `tests/annotations/tests.py`.
2025-12-23 18:49:54,113 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-23 18:49:54,114 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-23 18:49:54,114 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-23 18:49:54,115 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `tests/annotations/tests.py`.
Purpose: I need to find a test case that uses `Count` with `distinct=True` on a `Case` expression to demonstrate the reported bug, and this file is a likely candidate to contain such a test.
2025-12-23 18:49:56,350 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I will read the full content of `tests/annotations/tests.py` to find a test case that uses `Count` with `distinct=True` on a `Case` expression, which will help demonstrate the bug.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/annotations/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2108, 'candidates_token_count': 67, 'total_token_count': 2277, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2108}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 67}], 'thoughts_token_count': 102, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.17859779187102817, 'model_name': 'gemini-2.5-pro'} id='run--85987e0d-d7b5-4498-a744-02658525f240-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/annotations/tests.py'}, 'id': 'bd42c394-38a6-4430-b000-1a822b55f347', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2108, 'output_tokens': 67, 'total_tokens': 2277, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 102}}
2025-12-23 18:49:58,702 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have read the first 500 lines of `tests/annotations/tests.py` to locate the specified test case. I will now read the remaining content of the file to find the test case that uses `Count` with `distinct=True` on a `Case` expression to demonstrate the bug.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/annotations/tests.py", "end_line": 1000.0, "start_line": 501.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 11187, 'candidates_token_count': 91, 'total_token_count': 11356, 'cached_content_token_count': 1869, 'prompt_tokens_details': [{'modality': 1, 'token_count': 11187}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1869}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 91}], 'thoughts_token_count': 78}, 'finish_reason': 'STOP', 'avg_logprobs': -0.11555946266258156, 'model_name': 'gemini-2.5-pro'} id='run--6836dcfb-0c40-4115-8a3b-d6738dc17d48-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/annotations/tests.py', 'end_line': 1000.0, 'start_line': 501.0}, 'id': '9fe02bc6-c9e1-4e35-9f91-2a4dcbe26140', 'type': 'tool_call'}] usage_metadata={'input_tokens': 11187, 'output_tokens': 91, 'total_tokens': 11356, 'input_token_details': {'cache_read': 1869}, 'output_token_details': {'reasoning': 78}}
2025-12-23 18:50:02,655 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have now reviewed the entire content of `tests/annotations/tests.py`. I will now analyze the code to find the specific test case that uses `Count` with `distinct=True` on a `Case` expression to demonstrate the bug. If the test case is not present, I will analyze the existing tests to determine the best place to add a new test case.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/annotations/tests.py", "end_line": 2000.0, "start_line": 1001.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 13021, 'candidates_token_count': 104, 'total_token_count': 13376, 'cached_content_token_count': 9388, 'prompt_tokens_details': [{'modality': 1, 'token_count': 13021}], 'cache_tokens_details': [{'modality': 1, 'token_count': 9388}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 104}], 'thoughts_token_count': 251}, 'finish_reason': 'STOP', 'avg_logprobs': -0.3089461326599121, 'model_name': 'gemini-2.5-pro'} id='run--a124fee0-5632-4d50-bf06-da9df396e219-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/annotations/tests.py', 'end_line': 2000.0, 'start_line': 1001.0}, 'id': '5afdc80c-df42-4912-834f-468dab5767bd', 'type': 'tool_call'}] usage_metadata={'input_tokens': 13021, 'output_tokens': 104, 'total_tokens': 13376, 'input_token_details': {'cache_read': 9388}, 'output_token_details': {'reasoning': 251}}
2025-12-23 18:50:13,475 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have read the entire content of `tests/annotations/tests.py` to find the test case you described. After a thorough review, I can confirm that there is no existing test case that uses `Count` with `distinct=True` on a `Case` expression. While the file contains various tests for annotations, none of them match the specific combination needed to demonstrate the reported bug.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'citation_metadata': {'citations': [{'start_index': 684, 'end_index': 1913, 'uri': 'https://github.com/django/django', 'title': '', 'license_': ''}]}, 'usage_metadata': {'prompt_token_count': 13209, 'candidates_token_count': 80, 'total_token_count': 14470, 'cached_content_token_count': 11235, 'prompt_tokens_details': [{'modality': 1, 'token_count': 13209}], 'cache_tokens_details': [{'modality': 1, 'token_count': 11235}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 80}], 'thoughts_token_count': 1181}, 'finish_reason': 'STOP', 'avg_logprobs': -1.6452964782714843, 'model_name': 'gemini-2.5-pro'} id='run--a9f6d36b-86d4-4338-ad4a-ef1227d714ff-0' usage_metadata={'input_tokens': 13209, 'output_tokens': 80, 'total_tokens': 14470, 'input_token_details': {'cache_read': 11235}, 'output_token_details': {'reasoning': 1181}}
2025-12-23 18:50:13,477 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `tests/annotations/tests.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
I need to find a test case that uses `Count` with `distinct=True` on a `Case` expression to demonstrate the reported bug, and this file is a likely candidate to contain such a test.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/annotations/tests.py
Line number range: 1 - 500
Content:
1. import datetime
2. from decimal import Decimal
3. 
4. from django.core.exceptions import FieldDoesNotExist, FieldError
5. from django.db.models import (
6.     BooleanField, CharField, Count, DateTimeField, ExpressionWrapper, F, Func,
7.     IntegerField, NullBooleanField, OuterRef, Q, Subquery, Sum, Value,
8. )
9. from django.db.models.expressions import RawSQL
10. from django.db.models.functions import Length, Lower
11. from django.test import TestCase, skipUnlessDBFeature
12. 
13. from .models import (
14.     Author, Book, Company, DepartmentStore, Employee, Publisher, Store, Ticket,
15. )
16. 
17. 
18. def cxOracle_py3_bug(func):
19.     """
20.     There's a bug in Django/cx_Oracle with respect to string handling under
21.     Python 3 (essentially, they treat Python 3 strings as Python 2 strings
22.     rather than unicode). This makes some tests here fail under Python 3, so
23.     we mark them as expected failures until someone fixes them in #23843.
24.     """
25.     from unittest import expectedFailure
26.     from django.db import connection
27.     return expectedFailure(func) if connection.vendor == 'oracle' else func
28. 
29. 
30. class NonAggregateAnnotationTestCase(TestCase):
31. 
32.     @classmethod
33.     def setUpTestData(cls):
34.         cls.a1 = Author.objects.create(name='Adrian Holovaty', age=34)
35.         cls.a2 = Author.objects.create(name='Jacob Kaplan-Moss', age=35)
36.         cls.a3 = Author.objects.create(name='Brad Dayley', age=45)
37.         cls.a4 = Author.objects.create(name='James Bennett', age=29)
38.         cls.a5 = Author.objects.create(name='Jeffrey Forcier', age=37)
39.         cls.a6 = Author.objects.create(name='Paul Bissex', age=29)
40.         cls.a7 = Author.objects.create(name='Wesley J. Chun', age=25)
41.         cls.a8 = Author.objects.create(name='Peter Norvig', age=57)
42.         cls.a9 = Author.objects.create(name='Stuart Russell', age=46)
43.         cls.a1.friends.add(cls.a2, cls.a4)
44.         cls.a2.friends.add(cls.a1, cls.a7)
45.         cls.a4.friends.add(cls.a1)
46.         cls.a5.friends.add(cls.a6, cls.a7)
47.         cls.a6.friends.add(cls.a5, cls.a7)
48.         cls.a7.friends.add(cls.a2, cls.a5, cls.a6)
49.         cls.a8.friends.add(cls.a9)
50.         cls.a9.friends.add(cls.a8)
51. 
52.         cls.p1 = Publisher.objects.create(name='Apress', num_awards=3)
53.         cls.p2 = Publisher.objects.create(name='Sams', num_awards=1)
54.         cls.p3 = Publisher.objects.create(name='Prentice Hall', num_awards=7)
55.         cls.p4 = Publisher.objects.create(name='Morgan Kaufmann', num_awards=9)
56.         cls.p5 = Publisher.objects.create(name="Jonno's House of Books", num_awards=0)
57. 
58.         cls.b1 = Book.objects.create(
59.             isbn='159059725', name='The Definitive Guide to Django: Web Development Done Right',
60.             pages=447, rating=4.5, price=Decimal('30.00'), contact=cls.a1, publisher=cls.p1,
61.             pubdate=datetime.date(2007, 12, 6)
62.         )
63.         cls.b2 = Book.objects.create(
64.             isbn='067232959', name='Sams Teach Yourself Django in 24 Hours',
65.             pages=528, rating=3.0, price=Decimal('23.09'), contact=cls.a3, publisher=cls.p2,
66.             pubdate=datetime.date(2008, 3, 3)
67.         )
68.         cls.b3 = Book.objects.create(
69.             isbn='159059996', name='Practical Django Projects',
70.             pages=300, rating=4.0, price=Decimal('29.69'), contact=cls.a4, publisher=cls.p1,
71.             pubdate=datetime.date(2008, 6, 23)
72.         )
73.         cls.b4 = Book.objects.create(
74.             isbn='013235613', name='Python Web Development with Django',
75.             pages=350, rating=4.0, price=Decimal('29.69'), contact=cls.a5, publisher=cls.p3,
76.             pubdate=datetime.date(2008, 11, 3)
77.         )
78.         cls.b5 = Book.objects.create(
79.             isbn='013790395', name='Artificial Intelligence: A Modern Approach',
80.             pages=1132, rating=4.0, price=Decimal('82.80'), contact=cls.a8, publisher=cls.p3,
81.             pubdate=datetime.date(1995, 1, 15)
82.         )
83.         cls.b6 = Book.objects.create(
84.             isbn='155860191', name='Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp',
85.             pages=946, rating=5.0, price=Decimal('75.00'), contact=cls.a8, publisher=cls.p4,
86.             pubdate=datetime.date(1991, 10, 15)
87.         )
88.         cls.b1.authors.add(cls.a1, cls.a2)
89.         cls.b2.authors.add(cls.a3)
90.         cls.b3.authors.add(cls.a4)
91.         cls.b4.authors.add(cls.a5, cls.a6, cls.a7)
92.         cls.b5.authors.add(cls.a8, cls.a9)
93.         cls.b6.authors.add(cls.a8)
94. 
95.         s1 = Store.objects.create(
96.             name='Amazon.com',
97.             original_opening=datetime.datetime(1994, 4, 23, 9, 17, 42),
98.             friday_night_closing=datetime.time(23, 59, 59)
99.         )
100.         s2 = Store.objects.create(
101.             name='Books.com',
102.             original_opening=datetime.datetime(2001, 3, 15, 11, 23, 37),
103.             friday_night_closing=datetime.time(23, 59, 59)
104.         )
105.         s3 = Store.objects.create(
106.             name="Mamma and Pappa's Books",
107.             original_opening=datetime.datetime(1945, 4, 25, 16, 24, 14),
108.             friday_night_closing=datetime.time(21, 30)
109.         )
110.         s1.books.add(cls.b1, cls.b2, cls.b3, cls.b4, cls.b5, cls.b6)
111.         s2.books.add(cls.b1, cls.b3, cls.b5, cls.b6)
112.         s3.books.add(cls.b3, cls.b4, cls.b6)
113. 
114.     def test_basic_annotation(self):
115.         books = Book.objects.annotate(
116.             is_book=Value(1, output_field=IntegerField()))
117.         for book in books:
118.             self.assertEqual(book.is_book, 1)
119. 
120.     def test_basic_f_annotation(self):
121.         books = Book.objects.annotate(another_rating=F('rating'))
122.         for book in books:
123.             self.assertEqual(book.another_rating, book.rating)
124. 
125.     def test_joined_annotation(self):
126.         books = Book.objects.select_related('publisher').annotate(
127.             num_awards=F('publisher__num_awards'))
128.         for book in books:
129.             self.assertEqual(book.num_awards, book.publisher.num_awards)
130. 
131.     def test_mixed_type_annotation_date_interval(self):
132.         active = datetime.datetime(2015, 3, 20, 14, 0, 0)
133.         duration = datetime.timedelta(hours=1)
134.         expires = datetime.datetime(2015, 3, 20, 14, 0, 0) + duration
135.         Ticket.objects.create(active_at=active, duration=duration)
136.         t = Ticket.objects.annotate(
137.             expires=ExpressionWrapper(F('active_at') + F('duration'), output_field=DateTimeField())
138.         ).first()
139.         self.assertEqual(t.expires, expires)
140. 
141.     def test_mixed_type_annotation_numbers(self):
142.         test = self.b1
143.         b = Book.objects.annotate(
144.             combined=ExpressionWrapper(F('pages') + F('rating'), output_field=IntegerField())
145.         ).get(isbn=test.isbn)
146.         combined = int(test.pages + test.rating)
147.         self.assertEqual(b.combined, combined)
148. 
149.     def test_empty_expression_annotation(self):
150.         books = Book.objects.annotate(
151.             selected=ExpressionWrapper(Q(pk__in=[]), output_field=BooleanField())
152.         )
153.         self.assertEqual(len(books), Book.objects.count())
154.         self.assertTrue(all(not book.selected for book in books))
155. 
156.         books = Book.objects.annotate(
157.             selected=ExpressionWrapper(Q(pk__in=Book.objects.none()), output_field=BooleanField())
158.         )
159.         self.assertEqual(len(books), Book.objects.count())
160.         self.assertTrue(all(not book.selected for book in books))
161. 
162.     def test_annotate_with_aggregation(self):
163.         books = Book.objects.annotate(
164.             is_book=Value(1, output_field=IntegerField()),
165.             rating_count=Count('rating'))
166.         for book in books:
167.             self.assertEqual(book.is_book, 1)
168.             self.assertEqual(book.rating_count, 1)
169. 
170.     def test_aggregate_over_annotation(self):
171.         agg = Author.objects.annotate(other_age=F('age')).aggregate(otherage_sum=Sum('other_age'))
172.         other_agg = Author.objects.aggregate(age_sum=Sum('age'))
173.         self.assertEqual(agg['otherage_sum'], other_agg['age_sum'])
174. 
175.     @skipUnlessDBFeature('can_distinct_on_fields')
176.     def test_distinct_on_with_annotation(self):
177.         store = Store.objects.create(
178.             name='test store',
179.             original_opening=datetime.datetime.now(),
180.             friday_night_closing=datetime.time(21, 00, 00),
181.         )
182.         names = [
183.             'Theodore Roosevelt',
184.             'Eleanor Roosevelt',
185.             'Franklin Roosevelt',
186.             'Ned Stark',
187.             'Catelyn Stark',
188.         ]
189.         for name in names:
190.             Employee.objects.create(
191.                 store=store,
192.                 first_name=name.split()[0],
193.                 last_name=name.split()[1],
194.                 age=30, salary=2000,
195.             )
196. 
197.         people = Employee.objects.annotate(
198.             name_lower=Lower('last_name'),
199.         ).distinct('name_lower')
200. 
201.         self.assertEqual({p.last_name for p in people}, {'Stark', 'Roosevelt'})
202.         self.assertEqual(len(people), 2)
203. 
204.         people2 = Employee.objects.annotate(
205.             test_alias=F('store__name'),
206.         ).distinct('test_alias')
207.         self.assertEqual(len(people2), 1)
208. 
209.         lengths = Employee.objects.annotate(
210.             name_len=Length('first_name'),
211.         ).distinct('name_len').values_list('name_len', flat=True)
212.         self.assertSequenceEqual(lengths, [3, 7, 8])
213. 
214.     def test_filter_annotation(self):
215.         books = Book.objects.annotate(
216.             is_book=Value(1, output_field=IntegerField())
217.         ).filter(is_book=1)
218.         for book in books:
219.             self.assertEqual(book.is_book, 1)
220. 
221.     def test_filter_annotation_with_f(self):
222.         books = Book.objects.annotate(
223.             other_rating=F('rating')
224.         ).filter(other_rating=3.5)
225.         for book in books:
226.             self.assertEqual(book.other_rating, 3.5)
227. 
228.     def test_filter_annotation_with_double_f(self):
229.         books = Book.objects.annotate(
230.             other_rating=F('rating')
231.         ).filter(other_rating=F('rating'))
232.         for book in books:
233.             self.assertEqual(book.other_rating, book.rating)
234. 
235.     def test_filter_agg_with_double_f(self):
236.         books = Book.objects.annotate(
237.             sum_rating=Sum('rating')
238.         ).filter(sum_rating=F('sum_rating'))
239.         for book in books:
240.             self.assertEqual(book.sum_rating, book.rating)
241. 
242.     def test_filter_wrong_annotation(self):
243.         with self.assertRaisesMessage(FieldError, "Cannot resolve keyword 'nope' into field."):
244.             list(Book.objects.annotate(
245.                 sum_rating=Sum('rating')
246.             ).filter(sum_rating=F('nope')))
247. 
248.     def test_decimal_annotation(self):
249.         salary = Decimal(10) ** -Employee._meta.get_field('salary').decimal_places
250.         Employee.objects.create(
251.             first_name='Max',
252.             last_name='Paine',
253.             store=Store.objects.first(),
254.             age=23,
255.             salary=salary,
256.         )
257.         self.assertEqual(
258.             Employee.objects.annotate(new_salary=F('salary') / 10).get().new_salary,
259.             salary / 10,
260.         )
261. 
262.     def test_filter_decimal_annotation(self):
263.         qs = Book.objects.annotate(new_price=F('price') + 1).filter(new_price=Decimal(31)).values_list('new_price')
264.         self.assertEqual(qs.get(), (Decimal(31),))
265. 
266.     def test_combined_annotation_commutative(self):
267.         book1 = Book.objects.annotate(adjusted_rating=F('rating') + 2).get(pk=self.b1.pk)
268.         book2 = Book.objects.annotate(adjusted_rating=2 + F('rating')).get(pk=self.b1.pk)
269.         self.assertEqual(book1.adjusted_rating, book2.adjusted_rating)
270.         book1 = Book.objects.annotate(adjusted_rating=F('rating') + None).get(pk=self.b1.pk)
271.         book2 = Book.objects.annotate(adjusted_rating=None + F('rating')).get(pk=self.b1.pk)
272.         self.assertEqual(book1.adjusted_rating, book2.adjusted_rating)
273. 
274.     def test_update_with_annotation(self):
275.         book_preupdate = Book.objects.get(pk=self.b2.pk)
276.         Book.objects.annotate(other_rating=F('rating') - 1).update(rating=F('other_rating'))
277.         book_postupdate = Book.objects.get(pk=self.b2.pk)
278.         self.assertEqual(book_preupdate.rating - 1, book_postupdate.rating)
279. 
280.     def test_annotation_with_m2m(self):
281.         books = Book.objects.annotate(author_age=F('authors__age')).filter(pk=self.b1.pk).order_by('author_age')
282.         self.assertEqual(books[0].author_age, 34)
283.         self.assertEqual(books[1].author_age, 35)
284. 
285.     def test_annotation_reverse_m2m(self):
286.         books = Book.objects.annotate(
287.             store_name=F('store__name'),
288.         ).filter(
289.             name='Practical Django Projects',
290.         ).order_by('store_name')
291. 
292.         self.assertQuerysetEqual(
293.             books, [
294.                 'Amazon.com',
295.                 'Books.com',
296.                 'Mamma and Pappa\'s Books'
297.             ],
298.             lambda b: b.store_name
299.         )
300. 
301.     def test_values_annotation(self):
302.         """
303.         Annotations can reference fields in a values clause,
304.         and contribute to an existing values clause.
305.         """
306.         # annotate references a field in values()
307.         qs = Book.objects.values('rating').annotate(other_rating=F('rating') - 1)
308.         book = qs.get(pk=self.b1.pk)
309.         self.assertEqual(book['rating'] - 1, book['other_rating'])
310. 
311.         # filter refs the annotated value
312.         book = qs.get(other_rating=4)
313.         self.assertEqual(book['other_rating'], 4)
314. 
315.         # can annotate an existing values with a new field
316.         book = qs.annotate(other_isbn=F('isbn')).get(other_rating=4)
317.         self.assertEqual(book['other_rating'], 4)
318.         self.assertEqual(book['other_isbn'], '155860191')
319. 
320.     def test_values_with_pk_annotation(self):
321.         # annotate references a field in values() with pk
322.         publishers = Publisher.objects.values('id', 'book__rating').annotate(total=Sum('book__rating'))
323.         for publisher in publishers.filter(pk=self.p1.pk):
324.             self.assertEqual(publisher['book__rating'], publisher['total'])
325. 
326.     @skipUnlessDBFeature('allows_group_by_pk')
327.     def test_rawsql_group_by_collapse(self):
328.         raw = RawSQL('SELECT MIN(id) FROM annotations_book', [])
329.         qs = Author.objects.values('id').annotate(
330.             min_book_id=raw,
331.             count_friends=Count('friends'),
332.         ).order_by()
333.         _, _, group_by = qs.query.get_compiler(using='default').pre_sql_setup()
334.         self.assertEqual(len(group_by), 1)
335.         self.assertNotEqual(raw, group_by[0])
336. 
337.     def test_defer_annotation(self):
338.         """
339.         Deferred attributes can be referenced by an annotation,
340.         but they are not themselves deferred, and cannot be deferred.
341.         """
342.         qs = Book.objects.defer('rating').annotate(other_rating=F('rating') - 1)
343. 
344.         with self.assertNumQueries(2):
345.             book = qs.get(other_rating=4)
346.             self.assertEqual(book.rating, 5)
347.             self.assertEqual(book.other_rating, 4)
348. 
349.         with self.assertRaisesMessage(FieldDoesNotExist, "Book has no field named 'other_rating'"):
350.             book = qs.defer('other_rating').get(other_rating=4)
351. 
352.     def test_mti_annotations(self):
353.         """
354.         Fields on an inherited model can be referenced by an
355.         annotated field.
356.         """
357.         d = DepartmentStore.objects.create(
358.             name='Angus & Robinson',
359.             original_opening=datetime.date(2014, 3, 8),
360.             friday_night_closing=datetime.time(21, 00, 00),
361.             chain='Westfield'
362.         )
363. 
364.         books = Book.objects.filter(rating__gt=4)
365.         for b in books:
366.             d.books.add(b)
367. 
368.         qs = DepartmentStore.objects.annotate(
369.             other_name=F('name'),
370.             other_chain=F('chain'),
371.             is_open=Value(True, BooleanField()),
372.             book_isbn=F('books__isbn')
373.         ).order_by('book_isbn').filter(chain='Westfield')
374. 
375.         self.assertQuerysetEqual(
376.             qs, [
377.                 ('Angus & Robinson', 'Westfield', True, '155860191'),
378.                 ('Angus & Robinson', 'Westfield', True, '159059725')
379.             ],
380.             lambda d: (d.other_name, d.other_chain, d.is_open, d.book_isbn)
381.         )
382. 
383.     def test_null_annotation(self):
384.         """
385.         Annotating None onto a model round-trips
386.         """
387.         book = Book.objects.annotate(no_value=Value(None, output_field=IntegerField())).first()
388.         self.assertIsNone(book.no_value)
389. 
390.     def test_order_by_annotation(self):
391.         authors = Author.objects.annotate(other_age=F('age')).order_by('other_age')
392.         self.assertQuerysetEqual(
393.             authors, [
394.                 25, 29, 29, 34, 35, 37, 45, 46, 57,
395.             ],
396.             lambda a: a.other_age
397.         )
398. 
399.     def test_order_by_aggregate(self):
400.         authors = Author.objects.values('age').annotate(age_count=Count('age')).order_by('age_count', 'age')
401.         self.assertQuerysetEqual(
402.             authors, [
403.                 (25, 1), (34, 1), (35, 1), (37, 1), (45, 1), (46, 1), (57, 1), (29, 2),
404.             ],
405.             lambda a: (a['age'], a['age_count'])
406.         )
407. 
408.     def test_annotate_exists(self):
409.         authors = Author.objects.annotate(c=Count('id')).filter(c__gt=1)
410.         self.assertFalse(authors.exists())
411. 
412.     def test_column_field_ordering(self):
413.         """
414.         Columns are aligned in the correct order for resolve_columns. This test
415.         will fail on MySQL if column ordering is out. Column fields should be
416.         aligned as:
417.         1. extra_select
418.         2. model_fields
419.         3. annotation_fields
420.         4. model_related_fields
421.         """
422.         store = Store.objects.first()
423.         Employee.objects.create(id=1, first_name='Max', manager=True, last_name='Paine',
424.                                 store=store, age=23, salary=Decimal(50000.00))
425.         Employee.objects.create(id=2, first_name='Buffy', manager=False, last_name='Summers',
426.                                 store=store, age=18, salary=Decimal(40000.00))
427. 
428.         qs = Employee.objects.extra(
429.             select={'random_value': '42'}
430.         ).select_related('store').annotate(
431.             annotated_value=Value(17, output_field=IntegerField())
432.         )
433. 
434.         rows = [
435.             (1, 'Max', True, 42, 'Paine', 23, Decimal(50000.00), store.name, 17),
436.             (2, 'Buffy', False, 42, 'Summers', 18, Decimal(40000.00), store.name, 17)
437.         ]
438. 
439.         self.assertQuerysetEqual(
440.             qs.order_by('id'), rows,
441.             lambda e: (
442.                 e.id, e.first_name, e.manager, e.random_value, e.last_name, e.age,
443.                 e.salary, e.store.name, e.annotated_value))
444. 
445.     def test_column_field_ordering_with_deferred(self):
446.         store = Store.objects.first()
447.         Employee.objects.create(id=1, first_name='Max', manager=True, last_name='Paine',
448.                                 store=store, age=23, salary=Decimal(50000.00))
449.         Employee.objects.create(id=2, first_name='Buffy', manager=False, last_name='Summers',
450.                                 store=store, age=18, salary=Decimal(40000.00))
451. 
452.         qs = Employee.objects.extra(
453.             select={'random_value': '42'}
454.         ).select_related('store').annotate(
455.             annotated_value=Value(17, output_field=IntegerField())
456.         )
457. 
458.         rows = [
459.             (1, 'Max', True, 42, 'Paine', 23, Decimal(50000.00), store.name, 17),
460.             (2, 'Buffy', False, 42, 'Summers', 18, Decimal(40000.00), store.name, 17)
461.         ]
462. 
463.         # and we respect deferred columns!
464.         self.assertQuerysetEqual(
465.             qs.defer('age').order_by('id'), rows,
466.             lambda e: (
467.                 e.id, e.first_name, e.manager, e.random_value, e.last_name, e.age,
468.                 e.salary, e.store.name, e.annotated_value))
469. 
470.     @cxOracle_py3_bug
471.     def test_custom_functions(self):
472.         Company(name='Apple', motto=None, ticker_name='APPL', description='Beautiful Devices').save()
473.         Company(name='Django Software Foundation', motto=None, ticker_name=None, description=None).save()
474.         Company(name='Google', motto='Do No Evil', ticker_name='GOOG', description='Internet Company').save()
475.         Company(name='Yahoo', motto=None, ticker_name=None, description='Internet Company').save()
476. 
477.         qs = Company.objects.annotate(
478.             tagline=Func(
479.                 F('motto'),
480.                 F('ticker_name'),
481.                 F('description'),
482.                 Value('No Tag'),
483.                 function='COALESCE'
484.             )
485.         ).order_by('name')
486. 
487.         self.assertQuerysetEqual(
488.             qs, [
489.                 ('Apple', 'APPL'),
490.                 ('Django Software Foundation', 'No Tag'),
491.                 ('Google', 'Do No Evil'),
492.                 ('Yahoo', 'Internet Company')
493.             ],
494.             lambda c: (c.name, c.tagline)
495.         )
496. 
497.     @cxOracle_py3_bug
498.     def test_custom_functions_can_ref_other_functions(self):
499.         Company(name='Apple', motto=None, ticker_name='APPL', description='Beautiful Devices').save()
500.         Company(name='Django Software Foundation', motto=None, ticker_name=None, description=None).save()


File: tests/annotations/tests.py
Line number range: 501 - 1000
Content:
501.         Company(name='Google', motto='Do No Evil', ticker_name='GOOG', description='Internet Company').save()
502.         Company(name='Yahoo', motto=None, ticker_name=None, description='Internet Company').save()
503. 
504.         class Lower(Func):
505.             function = 'LOWER'
506. 
507.         qs = Company.objects.annotate(
508.             tagline=Func(
509.                 F('motto'),
510.                 F('ticker_name'),
511.                 F('description'),
512.                 Value('No Tag'),
513.                 function='COALESCE',
514.             )
515.         ).annotate(
516.             tagline_lower=Lower(F('tagline'), output_field=CharField())
517.         ).order_by('name')
518. 
519.         # LOWER function supported by:
520.         # oracle, postgres, mysql, sqlite, sqlserver
521. 
522.         self.assertQuerysetEqual(
523.             qs, [
524.                 ('Apple', 'APPL'.lower()),
525.                 ('Django Software Foundation', 'No Tag'.lower()),
526.                 ('Google', 'Do No Evil'.lower()),
527.                 ('Yahoo', 'Internet Company'.lower())
528.             ],
529.             lambda c: (c.name, c.tagline_lower)
530.         )
531. 
532.     def test_boolean_value_annotation(self):
533.         books = Book.objects.annotate(
534.             is_book=Value(True, output_field=BooleanField()),
535.             is_pony=Value(False, output_field=BooleanField()),
536.             is_none=Value(None, output_field=BooleanField(null=True)),
537.             is_none_old=Value(None, output_field=NullBooleanField()),
538.         )
539.         self.assertGreater(len(books), 0)
540.         for book in books:
541.             self.assertIs(book.is_book, True)
542.             self.assertIs(book.is_pony, False)
543.             self.assertIsNone(book.is_none)
544.             self.assertIsNone(book.is_none_old)
545. 
546.     def test_annotation_in_f_grouped_by_annotation(self):
547.         qs = (
548.             Publisher.objects.annotate(multiplier=Value(3))
549.             # group by option => sum of value * multiplier
550.             .values('name')
551.             .annotate(multiplied_value_sum=Sum(F('multiplier') * F('num_awards')))
552.             .order_by()
553.         )
554.         self.assertCountEqual(
555.             qs, [
556.                 {'multiplied_value_sum': 9, 'name': 'Apress'},
557.                 {'multiplied_value_sum': 0, 'name': "Jonno's House of Books"},
558.                 {'multiplied_value_sum': 27, 'name': 'Morgan Kaufmann'},
559.                 {'multiplied_value_sum': 21, 'name': 'Prentice Hall'},
560.                 {'multiplied_value_sum': 3, 'name': 'Sams'},
561.             ]
562.         )
563. 
564.     def test_arguments_must_be_expressions(self):
565.         msg = 'QuerySet.annotate() received non-expression(s): %s.'
566.         with self.assertRaisesMessage(TypeError, msg % BooleanField()):
567.             Book.objects.annotate(BooleanField())
568.         with self.assertRaisesMessage(TypeError, msg % True):
569.             Book.objects.annotate(is_book=True)
570.         with self.assertRaisesMessage(TypeError, msg % ', '.join([str(BooleanField()), 'True'])):
571.             Book.objects.annotate(BooleanField(), Value(False), is_book=True)
572. 
573.     def test_chaining_annotation_filter_with_m2m(self):
574.         qs = Author.objects.filter(
575.             name='Adrian Holovaty',
576.             friends__age=35,
577.         ).annotate(
578.             jacob_name=F('friends__name'),
579.         ).filter(
580.             friends__age=29,
581.         ).annotate(
582.             james_name=F('friends__name'),
583.         ).values('jacob_name', 'james_name')
584.         self.assertCountEqual(
585.             qs,
586.             [{'jacob_name': 'Jacob Kaplan-Moss', 'james_name': 'James Bennett'}],
587.         )
588. 
589.     @skipUnlessDBFeature('supports_subqueries_in_group_by')
590.     def test_annotation_filter_with_subquery(self):
591.         long_books_qs = Book.objects.filter(
592.             publisher=OuterRef('pk'),
593.             pages__gt=400,
594.         ).values('publisher').annotate(count=Count('pk')).values('count')
595.         publisher_books_qs = Publisher.objects.annotate(
596.             total_books=Count('book'),
597.         ).filter(
598.             total_books=Subquery(long_books_qs, output_field=IntegerField()),
599.         ).values('name')
600.         self.assertCountEqual(publisher_books_qs, [{'name': 'Sams'}, {'name': 'Morgan Kaufmann'}])

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-23 18:50:20,235 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="The user requested the full content of the file `tests/annotations/tests.py`. This context contains the first part of the file's content, from line 1 to 500.", relative_path='tests/annotations/tests.py', start_line=1, end_line=500), ContextOutput(reasoning="The user requested the full content of the file `tests/annotations/tests.py`. This context contains the second part of the file's content, from line 501 to 1000.", relative_path='tests/annotations/tests.py', start_line=501, end_line=1000)]
2025-12-23 18:50:20,237 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 2 contexts to memory for query: Please provide the full content of `tests/annotations/tests.py`.
2025-12-23 18:50:20,237 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-23 18:50:20,237 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-23 18:50:20,238 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 2 new contexts to 8 existing contexts
2025-12-23 18:50:20,238 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 10 total contexts (removed 0 duplicates)
2025-12-23 18:50:20,239 - thread-134584206358208.prometheus_context_collector.lang_graph.nodes.context_refine_node - INFO - Reached max_refined_query_loop, not asking for more context
2025-12-23 18:50:20,239 - thread-134584206358208.prometheus_context_collector - INFO - Successfully retrieved 10 context snippets
