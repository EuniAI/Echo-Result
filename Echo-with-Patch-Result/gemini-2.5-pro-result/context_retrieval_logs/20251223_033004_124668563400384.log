2025-12-23 03:30:04,771 - thread-124668563400384.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: ForeignKey.validate() should validate using the base manager.

Description: Description
	
ForeignKey.validate() should validate using the base manager instead of the default manager.
Consider the models:
class ArticleManager(models.Manage):
	def get_queryset(self):
		qs = super().get_queryset()
		return qs.filter(archived=False)
class Article(models.Model):
	title = models.CharField(max_length=100)
	archived = models.BooleanField(default=False)
	# Don't include archived articles by default.
	objects = ArticleManager()
class FavoriteAricles(models.Model):
	article = models.ForeignKey(Article, on_delete=models.CASCADE)
In the example, now consider a form that allows users to pick a favorite article including archived articles.
class FavoriteAriclesForm(forms.ModelForm):
	class Meta:
		model = FavoriteArticle
		fields = '__all__'
	def __init__(self, *args, **kwargs):
		super().__init__(*args, **kwargs)
		# Use the base manager instead of the default manager to allow archived articles.
		self.fields['article'].queryset = Article._base_manager.all()
The above form will never validate as True when a user selects an archived article. This is because the ForeignKey validation always uses _default_manager instead of _base_manager. The user facing error message is "article instance with id 123 does not exist." (quite confusing to typical users). The code for this validation is here:
​https://github.com/django/django/blob/94f63b926fd32d7a7b6e2591ef72aa8f040f25cc/django/db/models/fields/related.py#L917-L919
The FavoriteAriclesForm is specifically designed to use a different manager, but the ForeignKey validation makes this difficult.
In this example scenario, it is not acceptable to change the model's default manager as the default should avoid archived articles in other typical scenarios.
Suggested solution: the ForeignKey validation should use the _base_manager instead which does not include the default filters.

Patch information:
diff --git a/django/db/models/fields/related.py b/django/db/models/fields/related.py
index d517d7269b..c2aea9c730 100644
--- a/django/db/models/fields/related.py
+++ b/django/db/models/fields/related.py
@@ -914,7 +914,7 @@ class ForeignKey(ForeignObject):
             return
 
         using = router.db_for_read(self.remote_field.model, instance=model_instance)
-        qs = self.remote_field.model._default_manager.using(using).filter(
+        qs = self.remote_field.model._base_manager.using(using).filter(
             **{self.remote_field.field_name: value}
         )
         qs = qs.complex_filter(self.get_limit_choices_to())


Find all relevant source code context needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

2025-12-23 03:30:04,868 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .github
|   ├── FUNDING.yml
|   └── SECURITY.md
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── bin
|   |   └── django-admin.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ar_DZ
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ky
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tg
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uz
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   ├── 0012_alter_user_first_name_max_length.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   ├── options.py
|   |   |   |   └── widgets.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── constraints.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── mn
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_redirect_new_path_help_text.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── templates
|   |   |   |   ├── sitemap.xml
|   |   |   |   └── sitemap_index.xml
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── asgi.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── memcached.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── async_checks.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   └── __init__.py
|   |   |   ├── database.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── asgi.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── __init__.py
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── jsonl.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   ├── special.py
|   |   |   |   └── utils.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── enums.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── json.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── asyncio.py
|   |   ├── autoreload.py
|   |   ├── baseconv.py
|   |   ├── cache.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── datetime_safe.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── topological_sort.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           ├── default_urlconf.html
|           ├── technical_404.html
|           ├── technical_500.html
|           └── technical_500.txt
├── docs
|   ├── README.rst
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   ├── genindex.html
|   |   |   ├── layout.html
|   |   |   ├── modindex.html
|   |   |   ├── search.html
|   |   |   └── static
|   |   |       ├── console-tabs.css
|   |   |       ├── default.css
|   |   |       ├── djangodocs.css
|   |   |       ├── fontawesome
|   |   |       ├── homepage.css
|   |   |       └── reset-fonts-grids.css
|   |   └── djangodocs-epub
|   |       ├── epub-cover.html
|   |       └── static
|   |           └── epub.css
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── _images
|   |   ├── auth-remote-user.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-backend.txt
|   |   ├── custom-template-tags.txt
|   |   ├── deployment
|   |   |   ├── asgi
|   |   |   |   ├── daphne.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── uvicorn.txt
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── legacy-databases.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── constraints.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── paginator.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.19.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.20.txt
|   |   ├── 1.11.21.txt
|   |   ├── 1.11.22.txt
|   |   ├── 1.11.23.txt
|   |   ├── 1.11.24.txt
|   |   ├── 1.11.25.txt
|   |   ├── 1.11.26.txt
|   |   ├── 1.11.27.txt
|   |   ├── 1.11.28.txt
|   |   ├── 1.11.29.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.11.txt
|   |   ├── 2.0.12.txt
|   |   ├── 2.0.13.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.10.txt
|   |   ├── 2.1.11.txt
|   |   ├── 2.1.12.txt
|   |   ├── 2.1.13.txt
|   |   ├── 2.1.14.txt
|   |   ├── 2.1.15.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.7.txt
|   |   ├── 2.1.8.txt
|   |   ├── 2.1.9.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.1.txt
|   |   ├── 2.2.10.txt
|   |   ├── 2.2.11.txt
|   |   ├── 2.2.12.txt
|   |   ├── 2.2.13.txt
|   |   ├── 2.2.14.txt
|   |   ├── 2.2.2.txt
|   |   ├── 2.2.3.txt
|   |   ├── 2.2.4.txt
|   |   ├── 2.2.5.txt
|   |   ├── 2.2.6.txt
|   |   ├── 2.2.7.txt
|   |   ├── 2.2.8.txt
|   |   ├── 2.2.9.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.1.txt
|   |   ├── 3.0.2.txt
|   |   ├── 3.0.3.txt
|   |   ├── 3.0.4.txt
|   |   ├── 3.0.5.txt
|   |   ├── 3.0.6.txt
|   |   ├── 3.0.7.txt
|   |   ├── 3.0.8.txt
|   |   ├── 3.0.txt
|   |   ├── 3.1.txt
|   |   ├── 3.2.txt
|   |   ├── index.txt
|   |   └── security.txt
|   └── topics
|       ├── async.txt
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   └── jsi18n-mocks.test.js
|   ├── gis
|   |   └── mapwidget.test.js
|   └── tests.html
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_dynamic_settings_manage.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       └── noargs_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── test_django_admin_py.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── admin
    |   |   |   ├── admin_views
    |   |   |   └── base_site.html
    |   |   └── custom_filter_template.html
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_forms.py
    |   ├── test_history_view.py
    |   ├── test_multidb.py
    |   ├── test_nav_sidebar.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── default_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   └── tests.py
    ├── asgi
    |   ├── __init__.py
    |   ├── project
    |   |   └── static
    |   |       └── file.txt
    |   ├── tests.py
    |   └── urls.py
    ├── async
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   ├── with_last_login_attr.py
    |   |   └── with_many_to_many.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   |   ├── auth_attrs_access.html
    |   |   |   ├── auth_attrs_messages.html
    |   |   |   ├── auth_attrs_no_access.html
    |   |   |   ├── auth_attrs_perm_in_perms.html
    |   |   |   ├── auth_attrs_perms.html
    |   |   |   ├── auth_attrs_test_access.html
    |   |   |   └── auth_attrs_user.html
    |   |   └── registration
    |   |       ├── html_password_reset_email.html
    |   |       ├── logged_out.html
    |   |       ├── login.html
    |   |       ├── password_change_form.html
    |   |       ├── password_reset_complete.html
    |   |       ├── password_reset_confirm.html
    |   |       ├── password_reset_done.html
    |   |       ├── password_reset_email.html
    |   |       ├── password_reset_form.html
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_password_reset_timeout_days.py
    |   ├── test_remote_user.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── test_base.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   └── tests.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_async_checks.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_error_handlers.py
    |       ├── bad_error_handlers_invalid_path.py
    |       ├── beginning_with_slash.py
    |       ├── contains_tuple.py
    |       ├── good_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   └── ending_with_dollar.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   |       ├── debug.html
    |   |       └── request_attrs.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_greatest.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_round.py
    |   |   ├── test_sign.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_md5.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_sha1.py
    |   |   ├── test_sha224.py
    |   |   ├── test_sha256.py
    |   |   ├── test_sha384.py
    |   |   ├── test_sha512.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   ├── test_postgresql.py
    |   ├── test_sqlite.py
    |   └── tests.py
    ├── decorators
    |   ├── __init__.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   ├── test_middleware_mixin.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── empty_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── test_commands.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_deprecation.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── fixture2.xml
    |   |   ├── fixture3.xml
    |   |   ├── fixture7.xml
    |   |   └── fixture9.xml
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── animal.xml
    |   |   ├── bad_fixture2.xml
    |   |   ├── nk-inheritance2.xml
    |   |   ├── non_natural_2.xml
    |   |   ├── pretty.xml
    |   |   └── sequence_extra_xml.xml
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── absolute_urls.py
    |   ├── no_slash_urls.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   |   └── default.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_jsonfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   |       └── custom_widget.html
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   |       ├── article_form.html
    |   |       └── custom_widget.html
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   |       └── using.html
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   ├── about.html
    |   |   |   ├── apple_detail.html
    |   |   |   ├── artist_detail.html
    |   |   |   ├── artist_form.html
    |   |   |   ├── author_confirm_delete.html
    |   |   |   ├── author_detail.html
    |   |   |   ├── author_form.html
    |   |   |   ├── author_list.html
    |   |   |   ├── author_objects.html
    |   |   |   ├── author_view.html
    |   |   |   ├── book_archive.html
    |   |   |   ├── book_archive_day.html
    |   |   |   ├── book_archive_month.html
    |   |   |   ├── book_archive_week.html
    |   |   |   ├── book_archive_year.html
    |   |   |   ├── book_detail.html
    |   |   |   ├── book_list.html
    |   |   |   ├── confirm_delete.html
    |   |   |   ├── detail.html
    |   |   |   ├── form.html
    |   |   |   ├── list.html
    |   |   |   ├── page_template.html
    |   |   |   ├── robots.txt
    |   |   |   └── using.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── has_nulls
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   ├── test_srs.py
    |   |   └── tests.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── admin.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_indexes.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_create_models.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── maps
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_rastermodels.py
    |   |   |   └── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   |   └── test_handler.html
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   |   └── ignored.html
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   |   └── media_ignored.html
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   ├── javascript_ignored.js
    |   |   |   └── static_ignored.html
    |   |   └── templates
    |   |       ├── empty.html
    |   |       ├── subdir
    |   |       ├── test.html
    |   |       └── xxx_ignored.html
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── loading
    |   |   ├── en
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_AU
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_CA
    |   |   |   └── LC_MESSAGES
    |   |   └── en_NZ
    |   |       └── LC_MESSAGES
    |   ├── loading_app
    |   |   ├── __init__.py
    |   |   ├── apps.py
    |   |   └── locale
    |   |       └── en
    |   ├── models.py
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   |   ├── 404.html
    |   |   |   └── dummy.html
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   |   └── percents.html
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   ├── tests.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_fake_initial_case_insensitive
    |   |   ├── fake_initial
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── initial
    |   |       ├── 0001_initial.py
    |   |       └── __init__.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_namespace_package
    |   |   └── 0001_initial.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_no_operations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   ├── 0005_fifth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_enums
    |   ├── __init__.py
    |   └── tests.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autofield.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_filepathfield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_jsonfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── integration_settings.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_constraints.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_integration.py
    |   ├── test_introspection.py
    |   ├── test_json_deprecation.py
    |   ├── test_operations.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_db_returning.py
    |   ├── test_deprecation.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests
    |   ├── __init__.py
    |   ├── test_accept_header.py
    |   ├── test_data_upload_settings.py
    |   ├── test_is_ajax_deprecations.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_jsonl.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   |       └── using.html
    |   ├── templates
    |   |   └── shortcuts
    |   |       ├── render_test.html
    |   |       └── using.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_deprecation.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── custom_sitemap.xml
    |   |   └── custom_sitemap_index.xml
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   ├── test_management.py
    |   ├── test_utils.py
    |   └── urls
    |       ├── __init__.py
    |       ├── empty.py
    |       ├── http.py
    |       ├── https.py
    |       └── index_only.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── absolute_root.css
    |   |   |   ├── cached
    |   |   |   ├── styles_root.css
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   |   └── faulty.css
    |   |   ├── loop
    |   |   |   ├── bar.css
    |   |   |   └── foo.css
    |   |   ├── pathlib
    |   |   |   └── pathlib.txt
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   |       ├── description.html
    |   |       ├── description_context.html
    |   |       ├── title.html
    |   |       └── title_context.html
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   |       └── hello.html
    |   ├── jinja2
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       ├── syntax_error.html
    |   |       ├── syntax_error2.html
    |   |       └── syntax_error_include.html
    |   ├── template_strings
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       └── syntax_error.html
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_loader
    |   |       ├── goodbye.html
    |   |       ├── hello.html
    |   |       └── request.html
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   |       └── using.html
    |   ├── other_templates
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   └── test_dirs.html
    |   ├── recursive_templates
    |   |   ├── fs
    |   |   |   ├── extend-missing.html
    |   |   |   ├── one.html
    |   |   |   ├── other-recursive.html
    |   |   |   ├── recursive.html
    |   |   |   ├── self.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── fs2
    |   |   |   └── recursive.html
    |   |   └── fs3
    |   |       └── recursive.html
    |   ├── relative_templates
    |   |   ├── dir1
    |   |   |   ├── dir2
    |   |   |   ├── looped.html
    |   |   |   ├── one.html
    |   |   |   ├── one1.html
    |   |   |   ├── one2.html
    |   |   |   ├── one3.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── error_extends.html
    |   |   ├── error_include.html
    |   |   ├── one.html
    |   |   ├── three.html
    |   |   └── two.html
    |   ├── syntax_tests
    |   |   ├── __init__.py
    |   |   ├── i18n
    |   |   |   ├── __init__.py
    |   |   |   ├── base.py
    |   |   |   ├── test_blocktranslate.py
    |   |   |   ├── test_filters.py
    |   |   |   ├── test_get_available_languages.py
    |   |   |   ├── test_get_current_language.py
    |   |   |   ├── test_get_current_language_bidi.py
    |   |   |   ├── test_get_language_info.py
    |   |   |   ├── test_get_language_info_list.py
    |   |   |   ├── test_language.py
    |   |   |   ├── test_translate.py
    |   |   |   └── test_underscore_syntax.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_basic.py
    |   |   ├── test_builtins.py
    |   |   ├── test_cache.py
    |   |   ├── test_comment.py
    |   |   ├── test_cycle.py
    |   |   ├── test_exceptions.py
    |   |   ├── test_extends.py
    |   |   ├── test_filter_syntax.py
    |   |   ├── test_filter_tag.py
    |   |   ├── test_firstof.py
    |   |   ├── test_for.py
    |   |   ├── test_if.py
    |   |   ├── test_if_changed.py
    |   |   ├── test_if_equal.py
    |   |   ├── test_include.py
    |   |   ├── test_invalid_string.py
    |   |   ├── test_list_index.py
    |   |   ├── test_load.py
    |   |   ├── test_lorem.py
    |   |   ├── test_multiline.py
    |   |   ├── test_named_endblock.py
    |   |   ├── test_now.py
    |   |   ├── test_numpy.py
    |   |   ├── test_regroup.py
    |   |   ├── test_resetcycle.py
    |   |   ├── test_setup.py
    |   |   ├── test_simple_tag.py
    |   |   ├── test_spaceless.py
    |   |   ├── test_static.py
    |   |   ├── test_template_tag.py
    |   |   ├── test_url.py
    |   |   ├── test_verbatim.py
    |   |   ├── test_width_ratio.py
    |   |   └── test_with.py
    |   ├── templates
    |   |   ├── 27584_child.html
    |   |   ├── 27584_parent.html
    |   |   ├── 27956_child.html
    |   |   ├── 27956_parent.html
    |   |   ├── broken_base.html
    |   |   ├── first
    |   |   |   └── test.html
    |   |   ├── include_tpl.html
    |   |   ├── included_base.html
    |   |   ├── included_content.html
    |   |   ├── inclusion.html
    |   |   ├── inclusion_base.html
    |   |   ├── inclusion_extends1.html
    |   |   ├── inclusion_extends2.html
    |   |   ├── index.html
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   ├── recursive_include.html
    |   |   ├── response.html
    |   |   ├── second
    |   |   |   └── test.html
    |   |   ├── ssi include with spaces.html
    |   |   ├── ssi_include.html
    |   |   ├── template_tests
    |   |   |   └── using.html
    |   |   ├── test_context.html
    |   |   ├── test_context_stack.html
    |   |   ├── test_extends_error.html
    |   |   ├── test_incl_tag_use_l10n.html
    |   |   └── test_include_error.html
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   ├── bad_tag.py
    |   |   ├── custom.py
    |   |   ├── inclusion.py
    |   |   ├── subpackage
    |   |   |   ├── __init__.py
    |   |   |   └── echo.py
    |   |   ├── tag_27584.py
    |   |   └── testtags.py
    |   ├── test_base.py
    |   ├── test_callables.py
    |   ├── test_context.py
    |   ├── test_custom.py
    |   ├── test_engine.py
    |   ├── test_extends.py
    |   ├── test_extends_relative.py
    |   ├── test_library.py
    |   ├── test_loaders.py
    |   ├── test_logging.py
    |   ├── test_nodelist.py
    |   ├── test_origin.py
    |   ├── test_parser.py
    |   ├── test_response.py
    |   ├── test_smartif.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── utils.py
    |   └── views.py
    ├── templates
    |   ├── base.html
    |   ├── comments
    |   |   └── comment_notification_email.txt
    |   ├── custom_admin
    |   |   ├── add_form.html
    |   |   ├── app_index.html
    |   |   ├── change_form.html
    |   |   ├── change_list.html
    |   |   ├── delete_confirmation.html
    |   |   ├── delete_selected_confirmation.html
    |   |   ├── index.html
    |   |   ├── login.html
    |   |   ├── logout.html
    |   |   ├── object_history.html
    |   |   ├── password_change_done.html
    |   |   ├── password_change_form.html
    |   |   └── popup_response.html
    |   ├── extended.html
    |   ├── form_view.html
    |   ├── login.html
    |   └── views
    |       ├── article_archive_day.html
    |       ├── article_archive_month.html
    |       ├── article_confirm_delete.html
    |       ├── article_detail.html
    |       ├── article_form.html
    |       ├── article_list.html
    |       ├── datearticle_archive_month.html
    |       ├── urlarticle_detail.html
    |       └── urlarticle_form.html
    ├── test_client
    |   ├── __init__.py
    |   ├── auth_backends.py
    |   ├── test_conditional_content_removal.py
    |   ├── test_fakepayload.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── test_client_regress
    |   ├── __init__.py
    |   ├── auth_backends.py
    |   ├── bad_templates
    |   |   └── 404.html
    |   ├── context_processors.py
    |   ├── models.py
    |   ├── session.py
    |   ├── templates
    |   |   ├── request_context.html
    |   |   └── unicode.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── test_exceptions
    |   ├── __init__.py
    |   └── test_validation_error.py
    ├── test_runner
    |   ├── __init__.py
    |   ├── models.py
    |   ├── runner.py
    |   ├── test_debug_sql.py
    |   ├── test_discover_runner.py
    |   ├── test_parallel.py
    |   └── tests.py
    ├── test_runner_apps
    |   ├── __init__.py
    |   ├── buffer
    |   |   └── tests_buffer.py
    |   ├── databases
    |   |   ├── __init__.py
    |   |   └── tests.py
    |   ├── sample
    |   |   ├── __init__.py
    |   |   ├── doctests.py
    |   |   ├── empty.py
    |   |   ├── pattern_tests.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── tests.py
    |   |   └── tests_sample.py
    |   ├── simple
    |   |   ├── __init__.py
    |   |   └── tests.py
    |   └── tagged
    |       ├── __init__.py
    |       ├── tests.py
    |       └── tests_inheritance.py
    ├── test_sqlite.py
    ├── test_utils
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── templates
    |   |   └── template_used
    |   |       ├── alternative.html
    |   |       ├── base.html
    |   |       ├── extends.html
    |   |       └── include.html
    |   ├── test_simpletestcase.py
    |   ├── test_testcase.py
    |   ├── test_transactiontestcase.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── timezones
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── transaction_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── transactions
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── unmanaged_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── update_only_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── urlpatterns
    |   ├── __init__.py
    |   ├── converter_urls.py
    |   ├── converters.py
    |   ├── included_urls.py
    |   ├── more_urls.py
    |   ├── path_base64_urls.py
    |   ├── path_dynamic_urls.py
    |   ├── path_same_name_urls.py
    |   ├── path_urls.py
    |   ├── test_resolvers.py
    |   ├── tests.py
    |   └── views.py
    ├── urlpatterns_reverse
    |   ├── __init__.py
    |   ├── erroneous_urls.py
    |   ├── extra_urls.py
    |   ├── included_app_urls.py
    |   ├── included_named_urls.py
    |   ├── included_named_urls2.py
    |   ├── included_namespace_urls.py
    |   ├── included_no_kwargs_urls.py
    |   ├── included_urls.py
    |   ├── included_urls2.py
    |   ├── method_view_urls.py
    |   ├── middleware.py
    |   ├── named_urls.py
    |   ├── named_urls_conflict.py
    |   ├── namespace_urls.py
    |   ├── nested_urls.py
    |   ├── no_urls.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: ForeignKey.validate() should validate using the base manager.

Description: Description
	
ForeignKey.validate() should validate using the base manager instead of the default manager.
Consider the models:
class ArticleManager(models.Manage):
	def get_queryset(self):
		qs = super().get_queryset()
		return qs.filter(archived=False)
class Article(models.Model):
	title = models.CharField(max_length=100)
	archived = models.BooleanField(default=False)
	# Don't include archived articles by default.
	objects = ArticleManager()
class FavoriteAricles(models.Model):
	article = models.ForeignKey(Article, on_delete=models.CASCADE)
In the example, now consider a form that allows users to pick a favorite article including archived articles.
class FavoriteAriclesForm(forms.ModelForm):
	class Meta:
		model = FavoriteArticle
		fields = '__all__'
	def __init__(self, *args, **kwargs):
		super().__init__(*args, **kwargs)
		# Use the base manager instead of the default manager to allow archived articles.
		self.fields['article'].queryset = Article._base_manager.all()
The above form will never validate as True when a user selects an archived article. This is because the ForeignKey validation always uses _default_manager instead of _base_manager. The user facing error message is "article instance with id 123 does not exist." (quite confusing to typical users). The code for this validation is here:
​https://github.com/django/django/blob/94f63b926fd32d7a7b6e2591ef72aa8f040f25cc/django/db/models/fields/related.py#L917-L919
The FavoriteAriclesForm is specifically designed to use a different manager, but the ForeignKey validation makes this difficult.
In this example scenario, it is not acceptable to change the model's default manager as the default should avoid archived articles in other typical scenarios.
Suggested solution: the ForeignKey validation should use the _base_manager instead which does not include the default filters.

Patch information:
diff --git a/django/db/models/fields/related.py b/django/db/models/fields/related.py
index d517d7269b..c2aea9c730 100644
--- a/django/db/models/fields/related.py
+++ b/django/db/models/fields/related.py
@@ -914,7 +914,7 @@ class ForeignKey(ForeignObject):
             return
 
         using = router.db_for_read(self.remote_field.model, instance=model_instance)
-        qs = self.remote_field.model._default_manager.using(using).filter(
+        qs = self.remote_field.model._base_manager.using(using).filter(
             **{self.remote_field.field_name: value}
         )
         qs = qs.complex_filter(self.get_limit_choices_to())


Find all relevant source code context needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-23 03:30:31,747 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="The user's request requires understanding the `ForeignKey.validate` method, and the distinction between a model's `_default_manager` and `_base_manager`. To do this, I need the code for `ForeignKey` from `django/db/models/fields/related.py`, the `Manager` classes from `django/db/models/manager.py`, and the `Model` base class from `django/db/models/base.py` where managers are handled." query='Please provide the full content of `django/db/models/fields/related.py`, `django/db/models/manager.py`, and `django/db/models/base.py`.' extra_requirements='' purpose='These files will provide the necessary context on `ForeignKey` validation and model managers to understand and verify the proposed fix.'
2025-12-23 03:30:31,748 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `django/db/models/fields/related.py`, `django/db/models/manager.py`, and `django/db/models/base.py`.
2025-12-23 03:30:31,748 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-23 03:30:31,749 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-23 03:30:31,749 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-23 03:30:31,749 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `django/db/models/fields/related.py`, `django/db/models/manager.py`, and `django/db/models/base.py`.
Purpose: These files will provide the necessary context on `ForeignKey` validation and model managers to understand and verify the proposed fix.
2025-12-23 03:30:35,108 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have started by reading the three files that you requested. These files will provide context on `ForeignKey` validation and model managers. I will now analyze them to understand the proposed fix.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "django/db/models/base.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2125, 'candidates_token_count': 108, 'total_token_count': 2381, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2125}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 108}], 'thoughts_token_count': 148, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.12200749361956562, 'model_name': 'gemini-2.5-pro'} id='run--c2a6ad47-bd64-4e3b-b08d-1b2f251559ee-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'django/db/models/fields/related.py'}, 'id': '20151725-a467-438e-b815-838ab99198b4', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'django/db/models/manager.py'}, 'id': '43ad2b15-5b8b-4366-b17a-e1ca15b0caf3', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'django/db/models/base.py'}, 'id': 'fd960d5b-e086-4285-9183-7e7e854c12c7', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2125, 'output_tokens': 108, 'total_tokens': 2381, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 148}}
2025-12-23 03:30:44,100 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have read the initial contents of `django/db/models/fields/related.py`, `django/db/models/manager.py`, and `django/db/models/base.py`. Since the initial read only provided the first 500 lines of each file, I will now read the remaining content of each file in 500-line chunks to ensure I have the complete context. This will allow me to fully analyze the `ForeignKey` validation and model manager logic to verify the proposed fix.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"end_line": 1001.0, "start_line": 501.0, "relative_path": "django/db/models/base.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 19667, 'candidates_token_count': 197, 'total_token_count': 20448, 'cached_content_token_count': 1909, 'prompt_tokens_details': [{'modality': 1, 'token_count': 19667}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1909}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 197}], 'thoughts_token_count': 584}, 'finish_reason': 'STOP', 'avg_logprobs': -0.36870516859335345, 'model_name': 'gemini-2.5-pro'} id='run--fdef45ed-24bd-427a-88e8-b5ae87018771-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'end_line': 1001.0, 'start_line': 501.0, 'relative_path': 'django/db/models/fields/related.py'}, 'id': '42127ed7-7cd7-47bc-a9d4-a3ae7eccc2b2', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'end_line': 705.0, 'start_line': 205.0, 'relative_path': 'django/db/models/manager.py'}, 'id': '535d5d98-4631-412d-8e78-304fe00c6c6f', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'end_line': 1001.0, 'start_line': 501.0, 'relative_path': 'django/db/models/base.py'}, 'id': '9669ce5a-1f98-4ecc-914c-ec0413e64bc8', 'type': 'tool_call'}] usage_metadata={'input_tokens': 19667, 'output_tokens': 197, 'total_tokens': 20448, 'input_token_details': {'cache_read': 1909}, 'output_token_details': {'reasoning': 584}}
2025-12-23 03:30:51,487 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have now read the full contents of `django/db/models/fields/related.py`, `django/db/models/manager.py`, and `django/db/models/base.py`. I will now proceed to analyze the code to understand the logic of `ForeignKey` validation and model managers to verify the proposed fix.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"end_line": 1502.0, "start_line": 1002.0, "relative_path": "django/db/models/base.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 35633, 'candidates_token_count': 130, 'total_token_count': 36314, 'prompt_tokens_details': [{'modality': 1, 'token_count': 35633}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 130}], 'thoughts_token_count': 551, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.32983040442833533, 'model_name': 'gemini-2.5-pro'} id='run--2545ac00-9883-4a44-bea5-b5fce8ea5c72-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'end_line': 1501.0, 'start_line': 1001.0, 'relative_path': 'django/db/models/fields/related.py'}, 'id': '7611985d-6757-457c-8d56-6ebd122d4a44', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'end_line': 1502.0, 'start_line': 1002.0, 'relative_path': 'django/db/models/base.py'}, 'id': '33aa996e-b975-4960-958c-b14a38e619b1', 'type': 'tool_call'}] usage_metadata={'input_tokens': 35633, 'output_tokens': 130, 'total_tokens': 36314, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 551}}
2025-12-23 03:30:56,195 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have finished reading the entirety of `django/db/models/fields/related.py`, `django/db/models/manager.py`, and `django/db/models/base.py`. This has provided me with the complete context of `ForeignKey` validation, model managers, and model base classes. I can now proceed with analyzing the code to address the user's query." additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 51569, 'candidates_token_count': 81, 'total_token_count': 51825, 'prompt_tokens_details': [{'modality': 1, 'token_count': 51569}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 81}], 'thoughts_token_count': 175, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.22780750415943288, 'model_name': 'gemini-2.5-pro'} id='run--c14b32c0-f235-497a-bbdd-1675481a6241-0' usage_metadata={'input_tokens': 51569, 'output_tokens': 81, 'total_tokens': 51825, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 175}}
2025-12-23 03:30:56,198 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `django/db/models/fields/related.py`, `django/db/models/manager.py`, and `django/db/models/base.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
These files will provide the necessary context on `ForeignKey` validation and model managers to understand and verify the proposed fix.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: django/db/models/base.py
Line number range: 1 - 500
Content:
1. import copy
2. import inspect
3. import warnings
4. from functools import partialmethod
5. from itertools import chain
6. 
7. import django
8. from django.apps import apps
9. from django.conf import settings
10. from django.core import checks
11. from django.core.exceptions import (
12.     NON_FIELD_ERRORS, FieldDoesNotExist, FieldError, MultipleObjectsReturned,
13.     ObjectDoesNotExist, ValidationError,
14. )
15. from django.db import (
16.     DEFAULT_DB_ALIAS, DJANGO_VERSION_PICKLE_KEY, DatabaseError, connection,
17.     connections, router, transaction,
18. )
19. from django.db.models import (
20.     NOT_PROVIDED, ExpressionWrapper, IntegerField, Max, Value,
21. )
22. from django.db.models.constants import LOOKUP_SEP
23. from django.db.models.constraints import CheckConstraint, UniqueConstraint
24. from django.db.models.deletion import CASCADE, Collector
25. from django.db.models.fields.related import (
26.     ForeignObjectRel, OneToOneField, lazy_related_operation, resolve_relation,
27. )
28. from django.db.models.functions import Coalesce
29. from django.db.models.manager import Manager
30. from django.db.models.options import Options
31. from django.db.models.query import Q
32. from django.db.models.signals import (
33.     class_prepared, post_init, post_save, pre_init, pre_save,
34. )
35. from django.db.models.utils import make_model_tuple
36. from django.utils.encoding import force_str
37. from django.utils.hashable import make_hashable
38. from django.utils.text import capfirst, get_text_list
39. from django.utils.translation import gettext_lazy as _
40. 
41. 
42. class Deferred:
43.     def __repr__(self):
44.         return '<Deferred field>'
45. 
46.     def __str__(self):
47.         return '<Deferred field>'
48. 
49. 
50. DEFERRED = Deferred()
51. 
52. 
53. def subclass_exception(name, bases, module, attached_to):
54.     """
55.     Create exception subclass. Used by ModelBase below.
56. 
57.     The exception is created in a way that allows it to be pickled, assuming
58.     that the returned exception class will be added as an attribute to the
59.     'attached_to' class.
60.     """
61.     return type(name, bases, {
62.         '__module__': module,
63.         '__qualname__': '%s.%s' % (attached_to.__qualname__, name),
64.     })
65. 
66. 
67. def _has_contribute_to_class(value):
68.     # Only call contribute_to_class() if it's bound.
69.     return not inspect.isclass(value) and hasattr(value, 'contribute_to_class')
70. 
71. 
72. class ModelBase(type):
73.     """Metaclass for all models."""
74.     def __new__(cls, name, bases, attrs, **kwargs):
75.         super_new = super().__new__
76. 
77.         # Also ensure initialization is only performed for subclasses of Model
78.         # (excluding Model class itself).
79.         parents = [b for b in bases if isinstance(b, ModelBase)]
80.         if not parents:
81.             return super_new(cls, name, bases, attrs)
82. 
83.         # Create the class.
84.         module = attrs.pop('__module__')
85.         new_attrs = {'__module__': module}
86.         classcell = attrs.pop('__classcell__', None)
87.         if classcell is not None:
88.             new_attrs['__classcell__'] = classcell
89.         attr_meta = attrs.pop('Meta', None)
90.         # Pass all attrs without a (Django-specific) contribute_to_class()
91.         # method to type.__new__() so that they're properly initialized
92.         # (i.e. __set_name__()).
93.         contributable_attrs = {}
94.         for obj_name, obj in attrs.items():
95.             if _has_contribute_to_class(obj):
96.                 contributable_attrs[obj_name] = obj
97.             else:
98.                 new_attrs[obj_name] = obj
99.         new_class = super_new(cls, name, bases, new_attrs, **kwargs)
100. 
101.         abstract = getattr(attr_meta, 'abstract', False)
102.         meta = attr_meta or getattr(new_class, 'Meta', None)
103.         base_meta = getattr(new_class, '_meta', None)
104. 
105.         app_label = None
106. 
107.         # Look for an application configuration to attach the model to.
108.         app_config = apps.get_containing_app_config(module)
109. 
110.         if getattr(meta, 'app_label', None) is None:
111.             if app_config is None:
112.                 if not abstract:
113.                     raise RuntimeError(
114.                         "Model class %s.%s doesn't declare an explicit "
115.                         "app_label and isn't in an application in "
116.                         "INSTALLED_APPS." % (module, name)
117.                     )
118. 
119.             else:
120.                 app_label = app_config.label
121. 
122.         new_class.add_to_class('_meta', Options(meta, app_label))
123.         if not abstract:
124.             new_class.add_to_class(
125.                 'DoesNotExist',
126.                 subclass_exception(
127.                     'DoesNotExist',
128.                     tuple(
129.                         x.DoesNotExist for x in parents if hasattr(x, '_meta') and not x._meta.abstract
130.                     ) or (ObjectDoesNotExist,),
131.                     module,
132.                     attached_to=new_class))
133.             new_class.add_to_class(
134.                 'MultipleObjectsReturned',
135.                 subclass_exception(
136.                     'MultipleObjectsReturned',
137.                     tuple(
138.                         x.MultipleObjectsReturned for x in parents if hasattr(x, '_meta') and not x._meta.abstract
139.                     ) or (MultipleObjectsReturned,),
140.                     module,
141.                     attached_to=new_class))
142.             if base_meta and not base_meta.abstract:
143.                 # Non-abstract child classes inherit some attributes from their
144.                 # non-abstract parent (unless an ABC comes before it in the
145.                 # method resolution order).
146.                 if not hasattr(meta, 'ordering'):
147.                     new_class._meta.ordering = base_meta.ordering
148.                 if not hasattr(meta, 'get_latest_by'):
149.                     new_class._meta.get_latest_by = base_meta.get_latest_by
150. 
151.         is_proxy = new_class._meta.proxy
152. 
153.         # If the model is a proxy, ensure that the base class
154.         # hasn't been swapped out.
155.         if is_proxy and base_meta and base_meta.swapped:
156.             raise TypeError("%s cannot proxy the swapped model '%s'." % (name, base_meta.swapped))
157. 
158.         # Add remaining attributes (those with a contribute_to_class() method)
159.         # to the class.
160.         for obj_name, obj in contributable_attrs.items():
161.             new_class.add_to_class(obj_name, obj)
162. 
163.         # All the fields of any type declared on this model
164.         new_fields = chain(
165.             new_class._meta.local_fields,
166.             new_class._meta.local_many_to_many,
167.             new_class._meta.private_fields
168.         )
169.         field_names = {f.name for f in new_fields}
170. 
171.         # Basic setup for proxy models.
172.         if is_proxy:
173.             base = None
174.             for parent in [kls for kls in parents if hasattr(kls, '_meta')]:
175.                 if parent._meta.abstract:
176.                     if parent._meta.fields:
177.                         raise TypeError(
178.                             "Abstract base class containing model fields not "
179.                             "permitted for proxy model '%s'." % name
180.                         )
181.                     else:
182.                         continue
183.                 if base is None:
184.                     base = parent
185.                 elif parent._meta.concrete_model is not base._meta.concrete_model:
186.                     raise TypeError("Proxy model '%s' has more than one non-abstract model base class." % name)
187.             if base is None:
188.                 raise TypeError("Proxy model '%s' has no non-abstract model base class." % name)
189.             new_class._meta.setup_proxy(base)
190.             new_class._meta.concrete_model = base._meta.concrete_model
191.         else:
192.             new_class._meta.concrete_model = new_class
193. 
194.         # Collect the parent links for multi-table inheritance.
195.         parent_links = {}
196.         for base in reversed([new_class] + parents):
197.             # Conceptually equivalent to `if base is Model`.
198.             if not hasattr(base, '_meta'):
199.                 continue
200.             # Skip concrete parent classes.
201.             if base != new_class and not base._meta.abstract:
202.                 continue
203.             # Locate OneToOneField instances.
204.             for field in base._meta.local_fields:
205.                 if isinstance(field, OneToOneField) and field.remote_field.parent_link:
206.                     related = resolve_relation(new_class, field.remote_field.model)
207.                     parent_links[make_model_tuple(related)] = field
208. 
209.         # Track fields inherited from base models.
210.         inherited_attributes = set()
211.         # Do the appropriate setup for any model parents.
212.         for base in new_class.mro():
213.             if base not in parents or not hasattr(base, '_meta'):
214.                 # Things without _meta aren't functional models, so they're
215.                 # uninteresting parents.
216.                 inherited_attributes.update(base.__dict__)
217.                 continue
218. 
219.             parent_fields = base._meta.local_fields + base._meta.local_many_to_many
220.             if not base._meta.abstract:
221.                 # Check for clashes between locally declared fields and those
222.                 # on the base classes.
223.                 for field in parent_fields:
224.                     if field.name in field_names:
225.                         raise FieldError(
226.                             'Local field %r in class %r clashes with field of '
227.                             'the same name from base class %r.' % (
228.                                 field.name,
229.                                 name,
230.                                 base.__name__,
231.                             )
232.                         )
233.                     else:
234.                         inherited_attributes.add(field.name)
235. 
236.                 # Concrete classes...
237.                 base = base._meta.concrete_model
238.                 base_key = make_model_tuple(base)
239.                 if base_key in parent_links:
240.                     field = parent_links[base_key]
241.                 elif not is_proxy:
242.                     attr_name = '%s_ptr' % base._meta.model_name
243.                     field = OneToOneField(
244.                         base,
245.                         on_delete=CASCADE,
246.                         name=attr_name,
247.                         auto_created=True,
248.                         parent_link=True,
249.                     )
250. 
251.                     if attr_name in field_names:
252.                         raise FieldError(
253.                             "Auto-generated field '%s' in class %r for "
254.                             "parent_link to base class %r clashes with "
255.                             "declared field of the same name." % (
256.                                 attr_name,
257.                                 name,
258.                                 base.__name__,
259.                             )
260.                         )
261. 
262.                     # Only add the ptr field if it's not already present;
263.                     # e.g. migrations will already have it specified
264.                     if not hasattr(new_class, attr_name):
265.                         new_class.add_to_class(attr_name, field)
266.                 else:
267.                     field = None
268.                 new_class._meta.parents[base] = field
269.             else:
270.                 base_parents = base._meta.parents.copy()
271. 
272.                 # Add fields from abstract base class if it wasn't overridden.
273.                 for field in parent_fields:
274.                     if (field.name not in field_names and
275.                             field.name not in new_class.__dict__ and
276.                             field.name not in inherited_attributes):
277.                         new_field = copy.deepcopy(field)
278.                         new_class.add_to_class(field.name, new_field)
279.                         # Replace parent links defined on this base by the new
280.                         # field. It will be appropriately resolved if required.
281.                         if field.one_to_one:
282.                             for parent, parent_link in base_parents.items():
283.                                 if field == parent_link:
284.                                     base_parents[parent] = new_field
285. 
286.                 # Pass any non-abstract parent classes onto child.
287.                 new_class._meta.parents.update(base_parents)
288. 
289.             # Inherit private fields (like GenericForeignKey) from the parent
290.             # class
291.             for field in base._meta.private_fields:
292.                 if field.name in field_names:
293.                     if not base._meta.abstract:
294.                         raise FieldError(
295.                             'Local field %r in class %r clashes with field of '
296.                             'the same name from base class %r.' % (
297.                                 field.name,
298.                                 name,
299.                                 base.__name__,
300.                             )
301.                         )
302.                 else:
303.                     field = copy.deepcopy(field)
304.                     if not base._meta.abstract:
305.                         field.mti_inherited = True
306.                     new_class.add_to_class(field.name, field)
307. 
308.         # Copy indexes so that index names are unique when models extend an
309.         # abstract model.
310.         new_class._meta.indexes = [copy.deepcopy(idx) for idx in new_class._meta.indexes]
311. 
312.         if abstract:
313.             # Abstract base models can't be instantiated and don't appear in
314.             # the list of models for an app. We do the final setup for them a
315.             # little differently from normal models.
316.             attr_meta.abstract = False
317.             new_class.Meta = attr_meta
318.             return new_class
319. 
320.         new_class._prepare()
321.         new_class._meta.apps.register_model(new_class._meta.app_label, new_class)
322.         return new_class
323. 
324.     def add_to_class(cls, name, value):
325.         if _has_contribute_to_class(value):
326.             value.contribute_to_class(cls, name)
327.         else:
328.             setattr(cls, name, value)
329. 
330.     def _prepare(cls):
331.         """Create some methods once self._meta has been populated."""
332.         opts = cls._meta
333.         opts._prepare(cls)
334. 
335.         if opts.order_with_respect_to:
336.             cls.get_next_in_order = partialmethod(cls._get_next_or_previous_in_order, is_next=True)
337.             cls.get_previous_in_order = partialmethod(cls._get_next_or_previous_in_order, is_next=False)
338. 
339.             # Defer creating accessors on the foreign class until it has been
340.             # created and registered. If remote_field is None, we're ordering
341.             # with respect to a GenericForeignKey and don't know what the
342.             # foreign class is - we'll add those accessors later in
343.             # contribute_to_class().
344.             if opts.order_with_respect_to.remote_field:
345.                 wrt = opts.order_with_respect_to
346.                 remote = wrt.remote_field.model
347.                 lazy_related_operation(make_foreign_order_accessors, cls, remote)
348. 
349.         # Give the class a docstring -- its definition.
350.         if cls.__doc__ is None:
351.             cls.__doc__ = "%s(%s)" % (cls.__name__, ", ".join(f.name for f in opts.fields))
352. 
353.         get_absolute_url_override = settings.ABSOLUTE_URL_OVERRIDES.get(opts.label_lower)
354.         if get_absolute_url_override:
355.             setattr(cls, 'get_absolute_url', get_absolute_url_override)
356. 
357.         if not opts.managers:
358.             if any(f.name == 'objects' for f in opts.fields):
359.                 raise ValueError(
360.                     "Model %s must specify a custom Manager, because it has a "
361.                     "field named 'objects'." % cls.__name__
362.                 )
363.             manager = Manager()
364.             manager.auto_created = True
365.             cls.add_to_class('objects', manager)
366. 
367.         # Set the name of _meta.indexes. This can't be done in
368.         # Options.contribute_to_class() because fields haven't been added to
369.         # the model at that point.
370.         for index in cls._meta.indexes:
371.             if not index.name:
372.                 index.set_name_with_model(cls)
373. 
374.         class_prepared.send(sender=cls)
375. 
376.     @property
377.     def _base_manager(cls):
378.         return cls._meta.base_manager
379. 
380.     @property
381.     def _default_manager(cls):
382.         return cls._meta.default_manager
383. 
384. 
385. class ModelStateFieldsCacheDescriptor:
386.     def __get__(self, instance, cls=None):
387.         if instance is None:
388.             return self
389.         res = instance.fields_cache = {}
390.         return res
391. 
392. 
393. class ModelState:
394.     """Store model instance state."""
395.     db = None
396.     # If true, uniqueness validation checks will consider this a new, unsaved
397.     # object. Necessary for correct validation of new instances of objects with
398.     # explicit (non-auto) PKs. This impacts validation only; it has no effect
399.     # on the actual save.
400.     adding = True
401.     fields_cache = ModelStateFieldsCacheDescriptor()
402. 
403. 
404. class Model(metaclass=ModelBase):
405. 
406.     def __init__(self, *args, **kwargs):
407.         # Alias some things as locals to avoid repeat global lookups
408.         cls = self.__class__
409.         opts = self._meta
410.         _setattr = setattr
411.         _DEFERRED = DEFERRED
412. 
413.         pre_init.send(sender=cls, args=args, kwargs=kwargs)
414. 
415.         # Set up the storage for instance state
416.         self._state = ModelState()
417. 
418.         # There is a rather weird disparity here; if kwargs, it's set, then args
419.         # overrides it. It should be one or the other; don't duplicate the work
420.         # The reason for the kwargs check is that standard iterator passes in by
421.         # args, and instantiation for iteration is 33% faster.
422.         if len(args) > len(opts.concrete_fields):
423.             # Daft, but matches old exception sans the err msg.
424.             raise IndexError("Number of args exceeds number of fields")
425. 
426.         if not kwargs:
427.             fields_iter = iter(opts.concrete_fields)
428.             # The ordering of the zip calls matter - zip throws StopIteration
429.             # when an iter throws it. So if the first iter throws it, the second
430.             # is *not* consumed. We rely on this, so don't change the order
431.             # without changing the logic.
432.             for val, field in zip(args, fields_iter):
433.                 if val is _DEFERRED:
434.                     continue
435.                 _setattr(self, field.attname, val)
436.         else:
437.             # Slower, kwargs-ready version.
438.             fields_iter = iter(opts.fields)
439.             for val, field in zip(args, fields_iter):
440.                 if val is _DEFERRED:
441.                     continue
442.                 _setattr(self, field.attname, val)
443.                 kwargs.pop(field.name, None)
444. 
445.         # Now we're left with the unprocessed fields that *must* come from
446.         # keywords, or default.
447. 
448.         for field in fields_iter:
449.             is_related_object = False
450.             # Virtual field
451.             if field.attname not in kwargs and field.column is None:
452.                 continue
453.             if kwargs:
454.                 if isinstance(field.remote_field, ForeignObjectRel):
455.                     try:
456.                         # Assume object instance was passed in.
457.                         rel_obj = kwargs.pop(field.name)
458.                         is_related_object = True
459.                     except KeyError:
460.                         try:
461.                             # Object instance wasn't passed in -- must be an ID.
462.                             val = kwargs.pop(field.attname)
463.                         except KeyError:
464.                             val = field.get_default()
465.                 else:
466.                     try:
467.                         val = kwargs.pop(field.attname)
468.                     except KeyError:
469.                         # This is done with an exception rather than the
470.                         # default argument on pop because we don't want
471.                         # get_default() to be evaluated, and then not used.
472.                         # Refs #12057.
473.                         val = field.get_default()
474.             else:
475.                 val = field.get_default()
476. 
477.             if is_related_object:
478.                 # If we are passed a related instance, set it using the
479.                 # field.name instead of field.attname (e.g. "user" instead of
480.                 # "user_id") so that the object gets properly cached (and type
481.                 # checked) by the RelatedObjectDescriptor.
482.                 if rel_obj is not _DEFERRED:
483.                     _setattr(self, field.name, rel_obj)
484.             else:
485.                 if val is not _DEFERRED:
486.                     _setattr(self, field.attname, val)
487. 
488.         if kwargs:
489.             property_names = opts._property_names
490.             for prop in tuple(kwargs):
491.                 try:
492.                     # Any remaining kwargs must correspond to properties or
493.                     # virtual fields.
494.                     if prop in property_names or opts.get_field(prop):
495.                         if kwargs[prop] is not _DEFERRED:
496.                             _setattr(self, prop, kwargs[prop])
497.                         del kwargs[prop]
498.                 except (AttributeError, FieldDoesNotExist):
499.                     pass
500.             for kwarg in kwargs:


File: django/db/models/base.py
Line number range: 501 - 1001
Content:
501.                 raise TypeError("%s() got an unexpected keyword argument '%s'" % (cls.__name__, kwarg))
502.         super().__init__()
503.         post_init.send(sender=cls, instance=self)
504. 
505.     @classmethod
506.     def from_db(cls, db, field_names, values):
507.         if len(values) != len(cls._meta.concrete_fields):
508.             values_iter = iter(values)
509.             values = [
510.                 next(values_iter) if f.attname in field_names else DEFERRED
511.                 for f in cls._meta.concrete_fields
512.             ]
513.         new = cls(*values)
514.         new._state.adding = False
515.         new._state.db = db
516.         return new
517. 
518.     def __repr__(self):
519.         return '<%s: %s>' % (self.__class__.__name__, self)
520. 
521.     def __str__(self):
522.         return '%s object (%s)' % (self.__class__.__name__, self.pk)
523. 
524.     def __eq__(self, other):
525.         if not isinstance(other, Model):
526.             return NotImplemented
527.         if self._meta.concrete_model != other._meta.concrete_model:
528.             return False
529.         my_pk = self.pk
530.         if my_pk is None:
531.             return self is other
532.         return my_pk == other.pk
533. 
534.     def __hash__(self):
535.         if self.pk is None:
536.             raise TypeError("Model instances without primary key value are unhashable")
537.         return hash(self.pk)
538. 
539.     def __reduce__(self):
540.         data = self.__getstate__()
541.         data[DJANGO_VERSION_PICKLE_KEY] = django.__version__
542.         class_id = self._meta.app_label, self._meta.object_name
543.         return model_unpickle, (class_id,), data
544. 
545.     def __getstate__(self):
546.         """Hook to allow choosing the attributes to pickle."""
547.         return self.__dict__
548. 
549.     def __setstate__(self, state):
550.         pickled_version = state.get(DJANGO_VERSION_PICKLE_KEY)
551.         if pickled_version:
552.             if pickled_version != django.__version__:
553.                 warnings.warn(
554.                     "Pickled model instance's Django version %s does not "
555.                     "match the current version %s."
556.                     % (pickled_version, django.__version__),
557.                     RuntimeWarning,
558.                     stacklevel=2,
559.                 )
560.         else:
561.             warnings.warn(
562.                 "Pickled model instance's Django version is not specified.",
563.                 RuntimeWarning,
564.                 stacklevel=2,
565.             )
566.         self.__dict__.update(state)
567. 
568.     def _get_pk_val(self, meta=None):
569.         meta = meta or self._meta
570.         return getattr(self, meta.pk.attname)
571. 
572.     def _set_pk_val(self, value):
573.         for parent_link in self._meta.parents.values():
574.             if parent_link and parent_link != self._meta.pk:
575.                 setattr(self, parent_link.target_field.attname, value)
576.         return setattr(self, self._meta.pk.attname, value)
577. 
578.     pk = property(_get_pk_val, _set_pk_val)
579. 
580.     def get_deferred_fields(self):
581.         """
582.         Return a set containing names of deferred fields for this instance.
583.         """
584.         return {
585.             f.attname for f in self._meta.concrete_fields
586.             if f.attname not in self.__dict__
587.         }
588. 
589.     def refresh_from_db(self, using=None, fields=None):
590.         """
591.         Reload field values from the database.
592. 
593.         By default, the reloading happens from the database this instance was
594.         loaded from, or by the read router if this instance wasn't loaded from
595.         any database. The using parameter will override the default.
596. 
597.         Fields can be used to specify which fields to reload. The fields
598.         should be an iterable of field attnames. If fields is None, then
599.         all non-deferred fields are reloaded.
600. 
601.         When accessing deferred fields of an instance, the deferred loading
602.         of the field will call this method.
603.         """
604.         if fields is None:
605.             self._prefetched_objects_cache = {}
606.         else:
607.             prefetched_objects_cache = getattr(self, '_prefetched_objects_cache', ())
608.             for field in fields:
609.                 if field in prefetched_objects_cache:
610.                     del prefetched_objects_cache[field]
611.                     fields.remove(field)
612.             if not fields:
613.                 return
614.             if any(LOOKUP_SEP in f for f in fields):
615.                 raise ValueError(
616.                     'Found "%s" in fields argument. Relations and transforms '
617.                     'are not allowed in fields.' % LOOKUP_SEP)
618. 
619.         hints = {'instance': self}
620.         db_instance_qs = self.__class__._base_manager.db_manager(using, hints=hints).filter(pk=self.pk)
621. 
622.         # Use provided fields, if not set then reload all non-deferred fields.
623.         deferred_fields = self.get_deferred_fields()
624.         if fields is not None:
625.             fields = list(fields)
626.             db_instance_qs = db_instance_qs.only(*fields)
627.         elif deferred_fields:
628.             fields = [f.attname for f in self._meta.concrete_fields
629.                       if f.attname not in deferred_fields]
630.             db_instance_qs = db_instance_qs.only(*fields)
631. 
632.         db_instance = db_instance_qs.get()
633.         non_loaded_fields = db_instance.get_deferred_fields()
634.         for field in self._meta.concrete_fields:
635.             if field.attname in non_loaded_fields:
636.                 # This field wasn't refreshed - skip ahead.
637.                 continue
638.             setattr(self, field.attname, getattr(db_instance, field.attname))
639.             # Clear cached foreign keys.
640.             if field.is_relation and field.is_cached(self):
641.                 field.delete_cached_value(self)
642. 
643.         # Clear cached relations.
644.         for field in self._meta.related_objects:
645.             if field.is_cached(self):
646.                 field.delete_cached_value(self)
647. 
648.         self._state.db = db_instance._state.db
649. 
650.     def serializable_value(self, field_name):
651.         """
652.         Return the value of the field name for this instance. If the field is
653.         a foreign key, return the id value instead of the object. If there's
654.         no Field object with this name on the model, return the model
655.         attribute's value.
656. 
657.         Used to serialize a field's value (in the serializer, or form output,
658.         for example). Normally, you would just access the attribute directly
659.         and not use this method.
660.         """
661.         try:
662.             field = self._meta.get_field(field_name)
663.         except FieldDoesNotExist:
664.             return getattr(self, field_name)
665.         return getattr(self, field.attname)
666. 
667.     def save(self, force_insert=False, force_update=False, using=None,
668.              update_fields=None):
669.         """
670.         Save the current instance. Override this in a subclass if you want to
671.         control the saving process.
672. 
673.         The 'force_insert' and 'force_update' parameters can be used to insist
674.         that the "save" must be an SQL insert or update (or equivalent for
675.         non-SQL backends), respectively. Normally, they should not be set.
676.         """
677.         # Ensure that a model instance without a PK hasn't been assigned to
678.         # a ForeignKey or OneToOneField on this model. If the field is
679.         # nullable, allowing the save() would result in silent data loss.
680.         for field in self._meta.concrete_fields:
681.             # If the related field isn't cached, then an instance hasn't
682.             # been assigned and there's no need to worry about this check.
683.             if field.is_relation and field.is_cached(self):
684.                 obj = getattr(self, field.name, None)
685.                 if not obj:
686.                     continue
687.                 # A pk may have been assigned manually to a model instance not
688.                 # saved to the database (or auto-generated in a case like
689.                 # UUIDField), but we allow the save to proceed and rely on the
690.                 # database to raise an IntegrityError if applicable. If
691.                 # constraints aren't supported by the database, there's the
692.                 # unavoidable risk of data corruption.
693.                 if obj.pk is None:
694.                     # Remove the object from a related instance cache.
695.                     if not field.remote_field.multiple:
696.                         field.remote_field.delete_cached_value(obj)
697.                     raise ValueError(
698.                         "save() prohibited to prevent data loss due to "
699.                         "unsaved related object '%s'." % field.name
700.                     )
701.                 elif getattr(self, field.attname) is None:
702.                     # Use pk from related object if it has been saved after
703.                     # an assignment.
704.                     setattr(self, field.attname, obj.pk)
705.                 # If the relationship's pk/to_field was changed, clear the
706.                 # cached relationship.
707.                 if getattr(obj, field.target_field.attname) != getattr(self, field.attname):
708.                     field.delete_cached_value(self)
709. 
710.         using = using or router.db_for_write(self.__class__, instance=self)
711.         if force_insert and (force_update or update_fields):
712.             raise ValueError("Cannot force both insert and updating in model saving.")
713. 
714.         deferred_fields = self.get_deferred_fields()
715.         if update_fields is not None:
716.             # If update_fields is empty, skip the save. We do also check for
717.             # no-op saves later on for inheritance cases. This bailout is
718.             # still needed for skipping signal sending.
719.             if not update_fields:
720.                 return
721. 
722.             update_fields = frozenset(update_fields)
723.             field_names = set()
724. 
725.             for field in self._meta.fields:
726.                 if not field.primary_key:
727.                     field_names.add(field.name)
728. 
729.                     if field.name != field.attname:
730.                         field_names.add(field.attname)
731. 
732.             non_model_fields = update_fields.difference(field_names)
733. 
734.             if non_model_fields:
735.                 raise ValueError("The following fields do not exist in this "
736.                                  "model or are m2m fields: %s"
737.                                  % ', '.join(non_model_fields))
738. 
739.         # If saving to the same database, and this model is deferred, then
740.         # automatically do an "update_fields" save on the loaded fields.
741.         elif not force_insert and deferred_fields and using == self._state.db:
742.             field_names = set()
743.             for field in self._meta.concrete_fields:
744.                 if not field.primary_key and not hasattr(field, 'through'):
745.                     field_names.add(field.attname)
746.             loaded_fields = field_names.difference(deferred_fields)
747.             if loaded_fields:
748.                 update_fields = frozenset(loaded_fields)
749. 
750.         self.save_base(using=using, force_insert=force_insert,
751.                        force_update=force_update, update_fields=update_fields)
752.     save.alters_data = True
753. 
754.     def save_base(self, raw=False, force_insert=False,
755.                   force_update=False, using=None, update_fields=None):
756.         """
757.         Handle the parts of saving which should be done only once per save,
758.         yet need to be done in raw saves, too. This includes some sanity
759.         checks and signal sending.
760. 
761.         The 'raw' argument is telling save_base not to save any parent
762.         models and not to do any changes to the values before save. This
763.         is used by fixture loading.
764.         """
765.         using = using or router.db_for_write(self.__class__, instance=self)
766.         assert not (force_insert and (force_update or update_fields))
767.         assert update_fields is None or update_fields
768.         cls = origin = self.__class__
769.         # Skip proxies, but keep the origin as the proxy model.
770.         if cls._meta.proxy:
771.             cls = cls._meta.concrete_model
772.         meta = cls._meta
773.         if not meta.auto_created:
774.             pre_save.send(
775.                 sender=origin, instance=self, raw=raw, using=using,
776.                 update_fields=update_fields,
777.             )
778.         # A transaction isn't needed if one query is issued.
779.         if meta.parents:
780.             context_manager = transaction.atomic(using=using, savepoint=False)
781.         else:
782.             context_manager = transaction.mark_for_rollback_on_error(using=using)
783.         with context_manager:
784.             parent_inserted = False
785.             if not raw:
786.                 parent_inserted = self._save_parents(cls, using, update_fields)
787.             updated = self._save_table(
788.                 raw, cls, force_insert or parent_inserted,
789.                 force_update, using, update_fields,
790.             )
791.         # Store the database on which the object was saved
792.         self._state.db = using
793.         # Once saved, this is no longer a to-be-added instance.
794.         self._state.adding = False
795. 
796.         # Signal that the save is complete
797.         if not meta.auto_created:
798.             post_save.send(
799.                 sender=origin, instance=self, created=(not updated),
800.                 update_fields=update_fields, raw=raw, using=using,
801.             )
802. 
803.     save_base.alters_data = True
804. 
805.     def _save_parents(self, cls, using, update_fields):
806.         """Save all the parents of cls using values from self."""
807.         meta = cls._meta
808.         inserted = False
809.         for parent, field in meta.parents.items():
810.             # Make sure the link fields are synced between parent and self.
811.             if (field and getattr(self, parent._meta.pk.attname) is None and
812.                     getattr(self, field.attname) is not None):
813.                 setattr(self, parent._meta.pk.attname, getattr(self, field.attname))
814.             parent_inserted = self._save_parents(cls=parent, using=using, update_fields=update_fields)
815.             updated = self._save_table(
816.                 cls=parent, using=using, update_fields=update_fields,
817.                 force_insert=parent_inserted,
818.             )
819.             if not updated:
820.                 inserted = True
821.             # Set the parent's PK value to self.
822.             if field:
823.                 setattr(self, field.attname, self._get_pk_val(parent._meta))
824.                 # Since we didn't have an instance of the parent handy set
825.                 # attname directly, bypassing the descriptor. Invalidate
826.                 # the related object cache, in case it's been accidentally
827.                 # populated. A fresh instance will be re-built from the
828.                 # database if necessary.
829.                 if field.is_cached(self):
830.                     field.delete_cached_value(self)
831.         return inserted
832. 
833.     def _save_table(self, raw=False, cls=None, force_insert=False,
834.                     force_update=False, using=None, update_fields=None):
835.         """
836.         Do the heavy-lifting involved in saving. Update or insert the data
837.         for a single table.
838.         """
839.         meta = cls._meta
840.         non_pks = [f for f in meta.local_concrete_fields if not f.primary_key]
841. 
842.         if update_fields:
843.             non_pks = [f for f in non_pks
844.                        if f.name in update_fields or f.attname in update_fields]
845. 
846.         pk_val = self._get_pk_val(meta)
847.         if pk_val is None:
848.             pk_val = meta.pk.get_pk_value_on_save(self)
849.             setattr(self, meta.pk.attname, pk_val)
850.         pk_set = pk_val is not None
851.         if not pk_set and (force_update or update_fields):
852.             raise ValueError("Cannot force an update in save() with no primary key.")
853.         updated = False
854.         # Skip an UPDATE when adding an instance and primary key has a default.
855.         if (
856.             not raw and
857.             not force_insert and
858.             self._state.adding and
859.             meta.pk.default and
860.             meta.pk.default is not NOT_PROVIDED
861.         ):
862.             force_insert = True
863.         # If possible, try an UPDATE. If that doesn't update anything, do an INSERT.
864.         if pk_set and not force_insert:
865.             base_qs = cls._base_manager.using(using)
866.             values = [(f, None, (getattr(self, f.attname) if raw else f.pre_save(self, False)))
867.                       for f in non_pks]
868.             forced_update = update_fields or force_update
869.             updated = self._do_update(base_qs, using, pk_val, values, update_fields,
870.                                       forced_update)
871.             if force_update and not updated:
872.                 raise DatabaseError("Forced update did not affect any rows.")
873.             if update_fields and not updated:
874.                 raise DatabaseError("Save with update_fields did not affect any rows.")
875.         if not updated:
876.             if meta.order_with_respect_to:
877.                 # If this is a model with an order_with_respect_to
878.                 # autopopulate the _order field
879.                 field = meta.order_with_respect_to
880.                 filter_args = field.get_filter_kwargs_for_object(self)
881.                 self._order = cls._base_manager.using(using).filter(**filter_args).aggregate(
882.                     _order__max=Coalesce(
883.                         ExpressionWrapper(Max('_order') + Value(1), output_field=IntegerField()),
884.                         Value(0),
885.                     ),
886.                 )['_order__max']
887.             fields = meta.local_concrete_fields
888.             if not pk_set:
889.                 fields = [f for f in fields if f is not meta.auto_field]
890. 
891.             returning_fields = meta.db_returning_fields
892.             results = self._do_insert(cls._base_manager, using, fields, returning_fields, raw)
893.             if results:
894.                 for value, field in zip(results[0], returning_fields):
895.                     setattr(self, field.attname, value)
896.         return updated
897. 
898.     def _do_update(self, base_qs, using, pk_val, values, update_fields, forced_update):
899.         """
900.         Try to update the model. Return True if the model was updated (if an
901.         update query was done and a matching row was found in the DB).
902.         """
903.         filtered = base_qs.filter(pk=pk_val)
904.         if not values:
905.             # We can end up here when saving a model in inheritance chain where
906.             # update_fields doesn't target any field in current model. In that
907.             # case we just say the update succeeded. Another case ending up here
908.             # is a model with just PK - in that case check that the PK still
909.             # exists.
910.             return update_fields is not None or filtered.exists()
911.         if self._meta.select_on_save and not forced_update:
912.             return (
913.                 filtered.exists() and
914.                 # It may happen that the object is deleted from the DB right after
915.                 # this check, causing the subsequent UPDATE to return zero matching
916.                 # rows. The same result can occur in some rare cases when the
917.                 # database returns zero despite the UPDATE being executed
918.                 # successfully (a row is matched and updated). In order to
919.                 # distinguish these two cases, the object's existence in the
920.                 # database is again checked for if the UPDATE query returns 0.
921.                 (filtered._update(values) > 0 or filtered.exists())
922.             )
923.         return filtered._update(values) > 0
924. 
925.     def _do_insert(self, manager, using, fields, returning_fields, raw):
926.         """
927.         Do an INSERT. If returning_fields is defined then this method should
928.         return the newly created data for the model.
929.         """
930.         return manager._insert(
931.             [self], fields=fields, returning_fields=returning_fields,
932.             using=using, raw=raw,
933.         )
934. 
935.     def delete(self, using=None, keep_parents=False):
936.         using = using or router.db_for_write(self.__class__, instance=self)
937.         assert self.pk is not None, (
938.             "%s object can't be deleted because its %s attribute is set to None." %
939.             (self._meta.object_name, self._meta.pk.attname)
940.         )
941. 
942.         collector = Collector(using=using)
943.         collector.collect([self], keep_parents=keep_parents)
944.         return collector.delete()
945. 
946.     delete.alters_data = True
947. 
948.     def _get_FIELD_display(self, field):
949.         value = getattr(self, field.attname)
950.         choices_dict = dict(make_hashable(field.flatchoices))
951.         # force_str() to coerce lazy strings.
952.         return force_str(choices_dict.get(make_hashable(value), value), strings_only=True)
953. 
954.     def _get_next_or_previous_by_FIELD(self, field, is_next, **kwargs):
955.         if not self.pk:
956.             raise ValueError("get_next/get_previous cannot be used on unsaved objects.")
957.         op = 'gt' if is_next else 'lt'
958.         order = '' if is_next else '-'
959.         param = getattr(self, field.attname)
960.         q = Q(**{'%s__%s' % (field.name, op): param})
961.         q = q | Q(**{field.name: param, 'pk__%s' % op: self.pk})
962.         qs = self.__class__._default_manager.using(self._state.db).filter(**kwargs).filter(q).order_by(
963.             '%s%s' % (order, field.name), '%spk' % order
964.         )
965.         try:
966.             return qs[0]
967.         except IndexError:
968.             raise self.DoesNotExist("%s matching query does not exist." % self.__class__._meta.object_name)
969. 
970.     def _get_next_or_previous_in_order(self, is_next):
971.         cachename = "__%s_order_cache" % is_next
972.         if not hasattr(self, cachename):
973.             op = 'gt' if is_next else 'lt'
974.             order = '_order' if is_next else '-_order'
975.             order_field = self._meta.order_with_respect_to
976.             filter_args = order_field.get_filter_kwargs_for_object(self)
977.             obj = self.__class__._default_manager.filter(**filter_args).filter(**{
978.                 '_order__%s' % op: self.__class__._default_manager.values('_order').filter(**{
979.                     self._meta.pk.name: self.pk
980.                 })
981.             }).order_by(order)[:1].get()
982.             setattr(self, cachename, obj)
983.         return getattr(self, cachename)
984. 
985.     def prepare_database_save(self, field):
986.         if self.pk is None:
987.             raise ValueError("Unsaved model instance %r cannot be used in an ORM query." % self)
988.         return getattr(self, field.remote_field.get_related_field().attname)
989. 
990.     def clean(self):
991.         """
992.         Hook for doing any extra model-wide validation after clean() has been
993.         called on every field by self.clean_fields. Any ValidationError raised
994.         by this method will not be associated with a particular field; it will
995.         have a special-case association with the field defined by NON_FIELD_ERRORS.
996.         """
997.         pass
998. 
999.     def validate_unique(self, exclude=None):
1000.         """
1001.         Check unique constraints on the model and raise ValidationError if any


File: django/db/models/base.py
Line number range: 1002 - 1502
Content:
1002.         failed.
1003.         """
1004.         unique_checks, date_checks = self._get_unique_checks(exclude=exclude)
1005. 
1006.         errors = self._perform_unique_checks(unique_checks)
1007.         date_errors = self._perform_date_checks(date_checks)
1008. 
1009.         for k, v in date_errors.items():
1010.             errors.setdefault(k, []).extend(v)
1011. 
1012.         if errors:
1013.             raise ValidationError(errors)
1014. 
1015.     def _get_unique_checks(self, exclude=None):
1016.         """
1017.         Return a list of checks to perform. Since validate_unique() could be
1018.         called from a ModelForm, some fields may have been excluded; we can't
1019.         perform a unique check on a model that is missing fields involved
1020.         in that check. Fields that did not validate should also be excluded,
1021.         but they need to be passed in via the exclude argument.
1022.         """
1023.         if exclude is None:
1024.             exclude = []
1025.         unique_checks = []
1026. 
1027.         unique_togethers = [(self.__class__, self._meta.unique_together)]
1028.         constraints = [(self.__class__, self._meta.total_unique_constraints)]
1029.         for parent_class in self._meta.get_parent_list():
1030.             if parent_class._meta.unique_together:
1031.                 unique_togethers.append((parent_class, parent_class._meta.unique_together))
1032.             if parent_class._meta.total_unique_constraints:
1033.                 constraints.append(
1034.                     (parent_class, parent_class._meta.total_unique_constraints)
1035.                 )
1036. 
1037.         for model_class, unique_together in unique_togethers:
1038.             for check in unique_together:
1039.                 if not any(name in exclude for name in check):
1040.                     # Add the check if the field isn't excluded.
1041.                     unique_checks.append((model_class, tuple(check)))
1042. 
1043.         for model_class, model_constraints in constraints:
1044.             for constraint in model_constraints:
1045.                 if not any(name in exclude for name in constraint.fields):
1046.                     unique_checks.append((model_class, constraint.fields))
1047. 
1048.         # These are checks for the unique_for_<date/year/month>.
1049.         date_checks = []
1050. 
1051.         # Gather a list of checks for fields declared as unique and add them to
1052.         # the list of checks.
1053. 
1054.         fields_with_class = [(self.__class__, self._meta.local_fields)]
1055.         for parent_class in self._meta.get_parent_list():
1056.             fields_with_class.append((parent_class, parent_class._meta.local_fields))
1057. 
1058.         for model_class, fields in fields_with_class:
1059.             for f in fields:
1060.                 name = f.name
1061.                 if name in exclude:
1062.                     continue
1063.                 if f.unique:
1064.                     unique_checks.append((model_class, (name,)))
1065.                 if f.unique_for_date and f.unique_for_date not in exclude:
1066.                     date_checks.append((model_class, 'date', name, f.unique_for_date))
1067.                 if f.unique_for_year and f.unique_for_year not in exclude:
1068.                     date_checks.append((model_class, 'year', name, f.unique_for_year))
1069.                 if f.unique_for_month and f.unique_for_month not in exclude:
1070.                     date_checks.append((model_class, 'month', name, f.unique_for_month))
1071.         return unique_checks, date_checks
1072. 
1073.     def _perform_unique_checks(self, unique_checks):
1074.         errors = {}
1075. 
1076.         for model_class, unique_check in unique_checks:
1077.             # Try to look up an existing object with the same values as this
1078.             # object's values for all the unique field.
1079. 
1080.             lookup_kwargs = {}
1081.             for field_name in unique_check:
1082.                 f = self._meta.get_field(field_name)
1083.                 lookup_value = getattr(self, f.attname)
1084.                 # TODO: Handle multiple backends with different feature flags.
1085.                 if (lookup_value is None or
1086.                         (lookup_value == '' and connection.features.interprets_empty_strings_as_nulls)):
1087.                     # no value, skip the lookup
1088.                     continue
1089.                 if f.primary_key and not self._state.adding:
1090.                     # no need to check for unique primary key when editing
1091.                     continue
1092.                 lookup_kwargs[str(field_name)] = lookup_value
1093. 
1094.             # some fields were skipped, no reason to do the check
1095.             if len(unique_check) != len(lookup_kwargs):
1096.                 continue
1097. 
1098.             qs = model_class._default_manager.filter(**lookup_kwargs)
1099. 
1100.             # Exclude the current object from the query if we are editing an
1101.             # instance (as opposed to creating a new one)
1102.             # Note that we need to use the pk as defined by model_class, not
1103.             # self.pk. These can be different fields because model inheritance
1104.             # allows single model to have effectively multiple primary keys.
1105.             # Refs #17615.
1106.             model_class_pk = self._get_pk_val(model_class._meta)
1107.             if not self._state.adding and model_class_pk is not None:
1108.                 qs = qs.exclude(pk=model_class_pk)
1109.             if qs.exists():
1110.                 if len(unique_check) == 1:
1111.                     key = unique_check[0]
1112.                 else:
1113.                     key = NON_FIELD_ERRORS
1114.                 errors.setdefault(key, []).append(self.unique_error_message(model_class, unique_check))
1115. 
1116.         return errors
1117. 
1118.     def _perform_date_checks(self, date_checks):
1119.         errors = {}
1120.         for model_class, lookup_type, field, unique_for in date_checks:
1121.             lookup_kwargs = {}
1122.             # there's a ticket to add a date lookup, we can remove this special
1123.             # case if that makes it's way in
1124.             date = getattr(self, unique_for)
1125.             if date is None:
1126.                 continue
1127.             if lookup_type == 'date':
1128.                 lookup_kwargs['%s__day' % unique_for] = date.day
1129.                 lookup_kwargs['%s__month' % unique_for] = date.month
1130.                 lookup_kwargs['%s__year' % unique_for] = date.year
1131.             else:
1132.                 lookup_kwargs['%s__%s' % (unique_for, lookup_type)] = getattr(date, lookup_type)
1133.             lookup_kwargs[field] = getattr(self, field)
1134. 
1135.             qs = model_class._default_manager.filter(**lookup_kwargs)
1136.             # Exclude the current object from the query if we are editing an
1137.             # instance (as opposed to creating a new one)
1138.             if not self._state.adding and self.pk is not None:
1139.                 qs = qs.exclude(pk=self.pk)
1140. 
1141.             if qs.exists():
1142.                 errors.setdefault(field, []).append(
1143.                     self.date_error_message(lookup_type, field, unique_for)
1144.                 )
1145.         return errors
1146. 
1147.     def date_error_message(self, lookup_type, field_name, unique_for):
1148.         opts = self._meta
1149.         field = opts.get_field(field_name)
1150.         return ValidationError(
1151.             message=field.error_messages['unique_for_date'],
1152.             code='unique_for_date',
1153.             params={
1154.                 'model': self,
1155.                 'model_name': capfirst(opts.verbose_name),
1156.                 'lookup_type': lookup_type,
1157.                 'field': field_name,
1158.                 'field_label': capfirst(field.verbose_name),
1159.                 'date_field': unique_for,
1160.                 'date_field_label': capfirst(opts.get_field(unique_for).verbose_name),
1161.             }
1162.         )
1163. 
1164.     def unique_error_message(self, model_class, unique_check):
1165.         opts = model_class._meta
1166. 
1167.         params = {
1168.             'model': self,
1169.             'model_class': model_class,
1170.             'model_name': capfirst(opts.verbose_name),
1171.             'unique_check': unique_check,
1172.         }
1173. 
1174.         # A unique field
1175.         if len(unique_check) == 1:
1176.             field = opts.get_field(unique_check[0])
1177.             params['field_label'] = capfirst(field.verbose_name)
1178.             return ValidationError(
1179.                 message=field.error_messages['unique'],
1180.                 code='unique',
1181.                 params=params,
1182.             )
1183. 
1184.         # unique_together
1185.         else:
1186.             field_labels = [capfirst(opts.get_field(f).verbose_name) for f in unique_check]
1187.             params['field_labels'] = get_text_list(field_labels, _('and'))
1188.             return ValidationError(
1189.                 message=_("%(model_name)s with this %(field_labels)s already exists."),
1190.                 code='unique_together',
1191.                 params=params,
1192.             )
1193. 
1194.     def full_clean(self, exclude=None, validate_unique=True):
1195.         """
1196.         Call clean_fields(), clean(), and validate_unique() on the model.
1197.         Raise a ValidationError for any errors that occur.
1198.         """
1199.         errors = {}
1200.         if exclude is None:
1201.             exclude = []
1202.         else:
1203.             exclude = list(exclude)
1204. 
1205.         try:
1206.             self.clean_fields(exclude=exclude)
1207.         except ValidationError as e:
1208.             errors = e.update_error_dict(errors)
1209. 
1210.         # Form.clean() is run even if other validation fails, so do the
1211.         # same with Model.clean() for consistency.
1212.         try:
1213.             self.clean()
1214.         except ValidationError as e:
1215.             errors = e.update_error_dict(errors)
1216. 
1217.         # Run unique checks, but only for fields that passed validation.
1218.         if validate_unique:
1219.             for name in errors:
1220.                 if name != NON_FIELD_ERRORS and name not in exclude:
1221.                     exclude.append(name)
1222.             try:
1223.                 self.validate_unique(exclude=exclude)
1224.             except ValidationError as e:
1225.                 errors = e.update_error_dict(errors)
1226. 
1227.         if errors:
1228.             raise ValidationError(errors)
1229. 
1230.     def clean_fields(self, exclude=None):
1231.         """
1232.         Clean all fields and raise a ValidationError containing a dict
1233.         of all validation errors if any occur.
1234.         """
1235.         if exclude is None:
1236.             exclude = []
1237. 
1238.         errors = {}
1239.         for f in self._meta.fields:
1240.             if f.name in exclude:
1241.                 continue
1242.             # Skip validation for empty fields with blank=True. The developer
1243.             # is responsible for making sure they have a valid value.
1244.             raw_value = getattr(self, f.attname)
1245.             if f.blank and raw_value in f.empty_values:
1246.                 continue
1247.             try:
1248.                 setattr(self, f.attname, f.clean(raw_value, self))
1249.             except ValidationError as e:
1250.                 errors[f.name] = e.error_list
1251. 
1252.         if errors:
1253.             raise ValidationError(errors)
1254. 
1255.     @classmethod
1256.     def check(cls, **kwargs):
1257.         errors = [*cls._check_swappable(), *cls._check_model(), *cls._check_managers(**kwargs)]
1258.         if not cls._meta.swapped:
1259.             databases = kwargs.get('databases') or []
1260.             errors += [
1261.                 *cls._check_fields(**kwargs),
1262.                 *cls._check_m2m_through_same_relationship(),
1263.                 *cls._check_long_column_names(databases),
1264.             ]
1265.             clash_errors = (
1266.                 *cls._check_id_field(),
1267.                 *cls._check_field_name_clashes(),
1268.                 *cls._check_model_name_db_lookup_clashes(),
1269.                 *cls._check_property_name_related_field_accessor_clashes(),
1270.                 *cls._check_single_primary_key(),
1271.             )
1272.             errors.extend(clash_errors)
1273.             # If there are field name clashes, hide consequent column name
1274.             # clashes.
1275.             if not clash_errors:
1276.                 errors.extend(cls._check_column_name_clashes())
1277.             errors += [
1278.                 *cls._check_index_together(),
1279.                 *cls._check_unique_together(),
1280.                 *cls._check_indexes(databases),
1281.                 *cls._check_ordering(),
1282.                 *cls._check_constraints(databases),
1283.             ]
1284. 
1285.         return errors
1286. 
1287.     @classmethod
1288.     def _check_swappable(cls):
1289.         """Check if the swapped model exists."""
1290.         errors = []
1291.         if cls._meta.swapped:
1292.             try:
1293.                 apps.get_model(cls._meta.swapped)
1294.             except ValueError:
1295.                 errors.append(
1296.                     checks.Error(
1297.                         "'%s' is not of the form 'app_label.app_name'." % cls._meta.swappable,
1298.                         id='models.E001',
1299.                     )
1300.                 )
1301.             except LookupError:
1302.                 app_label, model_name = cls._meta.swapped.split('.')
1303.                 errors.append(
1304.                     checks.Error(
1305.                         "'%s' references '%s.%s', which has not been "
1306.                         "installed, or is abstract." % (
1307.                             cls._meta.swappable, app_label, model_name
1308.                         ),
1309.                         id='models.E002',
1310.                     )
1311.                 )
1312.         return errors
1313. 
1314.     @classmethod
1315.     def _check_model(cls):
1316.         errors = []
1317.         if cls._meta.proxy:
1318.             if cls._meta.local_fields or cls._meta.local_many_to_many:
1319.                 errors.append(
1320.                     checks.Error(
1321.                         "Proxy model '%s' contains model fields." % cls.__name__,
1322.                         id='models.E017',
1323.                     )
1324.                 )
1325.         return errors
1326. 
1327.     @classmethod
1328.     def _check_managers(cls, **kwargs):
1329.         """Perform all manager checks."""
1330.         errors = []
1331.         for manager in cls._meta.managers:
1332.             errors.extend(manager.check(**kwargs))
1333.         return errors
1334. 
1335.     @classmethod
1336.     def _check_fields(cls, **kwargs):
1337.         """Perform all field checks."""
1338.         errors = []
1339.         for field in cls._meta.local_fields:
1340.             errors.extend(field.check(**kwargs))
1341.         for field in cls._meta.local_many_to_many:
1342.             errors.extend(field.check(from_model=cls, **kwargs))
1343.         return errors
1344. 
1345.     @classmethod
1346.     def _check_m2m_through_same_relationship(cls):
1347.         """ Check if no relationship model is used by more than one m2m field.
1348.         """
1349. 
1350.         errors = []
1351.         seen_intermediary_signatures = []
1352. 
1353.         fields = cls._meta.local_many_to_many
1354. 
1355.         # Skip when the target model wasn't found.
1356.         fields = (f for f in fields if isinstance(f.remote_field.model, ModelBase))
1357. 
1358.         # Skip when the relationship model wasn't found.
1359.         fields = (f for f in fields if isinstance(f.remote_field.through, ModelBase))
1360. 
1361.         for f in fields:
1362.             signature = (f.remote_field.model, cls, f.remote_field.through, f.remote_field.through_fields)
1363.             if signature in seen_intermediary_signatures:
1364.                 errors.append(
1365.                     checks.Error(
1366.                         "The model has two identical many-to-many relations "
1367.                         "through the intermediate model '%s'." %
1368.                         f.remote_field.through._meta.label,
1369.                         obj=cls,
1370.                         id='models.E003',
1371.                     )
1372.                 )
1373.             else:
1374.                 seen_intermediary_signatures.append(signature)
1375.         return errors
1376. 
1377.     @classmethod
1378.     def _check_id_field(cls):
1379.         """Check if `id` field is a primary key."""
1380.         fields = [f for f in cls._meta.local_fields if f.name == 'id' and f != cls._meta.pk]
1381.         # fields is empty or consists of the invalid "id" field
1382.         if fields and not fields[0].primary_key and cls._meta.pk.name == 'id':
1383.             return [
1384.                 checks.Error(
1385.                     "'id' can only be used as a field name if the field also "
1386.                     "sets 'primary_key=True'.",
1387.                     obj=cls,
1388.                     id='models.E004',
1389.                 )
1390.             ]
1391.         else:
1392.             return []
1393. 
1394.     @classmethod
1395.     def _check_field_name_clashes(cls):
1396.         """Forbid field shadowing in multi-table inheritance."""
1397.         errors = []
1398.         used_fields = {}  # name or attname -> field
1399. 
1400.         # Check that multi-inheritance doesn't cause field name shadowing.
1401.         for parent in cls._meta.get_parent_list():
1402.             for f in parent._meta.local_fields:
1403.                 clash = used_fields.get(f.name) or used_fields.get(f.attname) or None
1404.                 if clash:
1405.                     errors.append(
1406.                         checks.Error(
1407.                             "The field '%s' from parent model "
1408.                             "'%s' clashes with the field '%s' "
1409.                             "from parent model '%s'." % (
1410.                                 clash.name, clash.model._meta,
1411.                                 f.name, f.model._meta
1412.                             ),
1413.                             obj=cls,
1414.                             id='models.E005',
1415.                         )
1416.                     )
1417.                 used_fields[f.name] = f
1418.                 used_fields[f.attname] = f
1419. 
1420.         # Check that fields defined in the model don't clash with fields from
1421.         # parents, including auto-generated fields like multi-table inheritance
1422.         # child accessors.
1423.         for parent in cls._meta.get_parent_list():
1424.             for f in parent._meta.get_fields():
1425.                 if f not in used_fields:
1426.                     used_fields[f.name] = f
1427. 
1428.         for f in cls._meta.local_fields:
1429.             clash = used_fields.get(f.name) or used_fields.get(f.attname) or None
1430.             # Note that we may detect clash between user-defined non-unique
1431.             # field "id" and automatically added unique field "id", both
1432.             # defined at the same model. This special case is considered in
1433.             # _check_id_field and here we ignore it.
1434.             id_conflict = f.name == "id" and clash and clash.name == "id" and clash.model == cls
1435.             if clash and not id_conflict:
1436.                 errors.append(
1437.                     checks.Error(
1438.                         "The field '%s' clashes with the field '%s' "
1439.                         "from model '%s'." % (
1440.                             f.name, clash.name, clash.model._meta
1441.                         ),
1442.                         obj=f,
1443.                         id='models.E006',
1444.                     )
1445.                 )
1446.             used_fields[f.name] = f
1447.             used_fields[f.attname] = f
1448. 
1449.         return errors
1450. 
1451.     @classmethod
1452.     def _check_column_name_clashes(cls):
1453.         # Store a list of column names which have already been used by other fields.
1454.         used_column_names = []
1455.         errors = []
1456. 
1457.         for f in cls._meta.local_fields:
1458.             _, column_name = f.get_attname_column()
1459. 
1460.             # Ensure the column name is not already in use.
1461.             if column_name and column_name in used_column_names:
1462.                 errors.append(
1463.                     checks.Error(
1464.                         "Field '%s' has column name '%s' that is used by "
1465.                         "another field." % (f.name, column_name),
1466.                         hint="Specify a 'db_column' for the field.",
1467.                         obj=cls,
1468.                         id='models.E007'
1469.                     )
1470.                 )
1471.             else:
1472.                 used_column_names.append(column_name)
1473. 
1474.         return errors
1475. 
1476.     @classmethod
1477.     def _check_model_name_db_lookup_clashes(cls):
1478.         errors = []
1479.         model_name = cls.__name__
1480.         if model_name.startswith('_') or model_name.endswith('_'):
1481.             errors.append(
1482.                 checks.Error(
1483.                     "The model name '%s' cannot start or end with an underscore "
1484.                     "as it collides with the query lookup syntax." % model_name,
1485.                     obj=cls,
1486.                     id='models.E023'
1487.                 )
1488.             )
1489.         elif LOOKUP_SEP in model_name:
1490.             errors.append(
1491.                 checks.Error(
1492.                     "The model name '%s' cannot contain double underscores as "
1493.                     "it collides with the query lookup syntax." % model_name,
1494.                     obj=cls,
1495.                     id='models.E024'
1496.                 )
1497.             )
1498.         return errors
1499. 
1500.     @classmethod
1501.     def _check_property_name_related_field_accessor_clashes(cls):
1502.         errors = []


File: django/db/models/fields/related.py
Line number range: 1 - 500
Content:
1. import functools
2. import inspect
3. from functools import partial
4. 
5. from django import forms
6. from django.apps import apps
7. from django.conf import SettingsReference, settings
8. from django.core import checks, exceptions
9. from django.db import connection, router
10. from django.db.backends import utils
11. from django.db.models import Q
12. from django.db.models.constants import LOOKUP_SEP
13. from django.db.models.deletion import CASCADE, SET_DEFAULT, SET_NULL
14. from django.db.models.query_utils import PathInfo
15. from django.db.models.utils import make_model_tuple
16. from django.utils.functional import cached_property
17. from django.utils.translation import gettext_lazy as _
18. 
19. from . import Field
20. from .mixins import FieldCacheMixin
21. from .related_descriptors import (
22.     ForeignKeyDeferredAttribute, ForwardManyToOneDescriptor,
23.     ForwardOneToOneDescriptor, ManyToManyDescriptor,
24.     ReverseManyToOneDescriptor, ReverseOneToOneDescriptor,
25. )
26. from .related_lookups import (
27.     RelatedExact, RelatedGreaterThan, RelatedGreaterThanOrEqual, RelatedIn,
28.     RelatedIsNull, RelatedLessThan, RelatedLessThanOrEqual,
29. )
30. from .reverse_related import (
31.     ForeignObjectRel, ManyToManyRel, ManyToOneRel, OneToOneRel,
32. )
33. 
34. RECURSIVE_RELATIONSHIP_CONSTANT = 'self'
35. 
36. 
37. def resolve_relation(scope_model, relation):
38.     """
39.     Transform relation into a model or fully-qualified model string of the form
40.     "app_label.ModelName", relative to scope_model.
41. 
42.     The relation argument can be:
43.       * RECURSIVE_RELATIONSHIP_CONSTANT, i.e. the string "self", in which case
44.         the model argument will be returned.
45.       * A bare model name without an app_label, in which case scope_model's
46.         app_label will be prepended.
47.       * An "app_label.ModelName" string.
48.       * A model class, which will be returned unchanged.
49.     """
50.     # Check for recursive relations
51.     if relation == RECURSIVE_RELATIONSHIP_CONSTANT:
52.         relation = scope_model
53. 
54.     # Look for an "app.Model" relation
55.     if isinstance(relation, str):
56.         if "." not in relation:
57.             relation = "%s.%s" % (scope_model._meta.app_label, relation)
58. 
59.     return relation
60. 
61. 
62. def lazy_related_operation(function, model, *related_models, **kwargs):
63.     """
64.     Schedule `function` to be called once `model` and all `related_models`
65.     have been imported and registered with the app registry. `function` will
66.     be called with the newly-loaded model classes as its positional arguments,
67.     plus any optional keyword arguments.
68. 
69.     The `model` argument must be a model class. Each subsequent positional
70.     argument is another model, or a reference to another model - see
71.     `resolve_relation()` for the various forms these may take. Any relative
72.     references will be resolved relative to `model`.
73. 
74.     This is a convenience wrapper for `Apps.lazy_model_operation` - the app
75.     registry model used is the one found in `model._meta.apps`.
76.     """
77.     models = [model] + [resolve_relation(model, rel) for rel in related_models]
78.     model_keys = (make_model_tuple(m) for m in models)
79.     apps = model._meta.apps
80.     return apps.lazy_model_operation(partial(function, **kwargs), *model_keys)
81. 
82. 
83. class RelatedField(FieldCacheMixin, Field):
84.     """Base class that all relational fields inherit from."""
85. 
86.     # Field flags
87.     one_to_many = False
88.     one_to_one = False
89.     many_to_many = False
90.     many_to_one = False
91. 
92.     @cached_property
93.     def related_model(self):
94.         # Can't cache this property until all the models are loaded.
95.         apps.check_models_ready()
96.         return self.remote_field.model
97. 
98.     def check(self, **kwargs):
99.         return [
100.             *super().check(**kwargs),
101.             *self._check_related_name_is_valid(),
102.             *self._check_related_query_name_is_valid(),
103.             *self._check_relation_model_exists(),
104.             *self._check_referencing_to_swapped_model(),
105.             *self._check_clashes(),
106.         ]
107. 
108.     def _check_related_name_is_valid(self):
109.         import keyword
110.         related_name = self.remote_field.related_name
111.         if related_name is None:
112.             return []
113.         is_valid_id = not keyword.iskeyword(related_name) and related_name.isidentifier()
114.         if not (is_valid_id or related_name.endswith('+')):
115.             return [
116.                 checks.Error(
117.                     "The name '%s' is invalid related_name for field %s.%s" %
118.                     (self.remote_field.related_name, self.model._meta.object_name,
119.                      self.name),
120.                     hint="Related name must be a valid Python identifier or end with a '+'",
121.                     obj=self,
122.                     id='fields.E306',
123.                 )
124.             ]
125.         return []
126. 
127.     def _check_related_query_name_is_valid(self):
128.         if self.remote_field.is_hidden():
129.             return []
130.         rel_query_name = self.related_query_name()
131.         errors = []
132.         if rel_query_name.endswith('_'):
133.             errors.append(
134.                 checks.Error(
135.                     "Reverse query name '%s' must not end with an underscore."
136.                     % rel_query_name,
137.                     hint=("Add or change a related_name or related_query_name "
138.                           "argument for this field."),
139.                     obj=self,
140.                     id='fields.E308',
141.                 )
142.             )
143.         if LOOKUP_SEP in rel_query_name:
144.             errors.append(
145.                 checks.Error(
146.                     "Reverse query name '%s' must not contain '%s'."
147.                     % (rel_query_name, LOOKUP_SEP),
148.                     hint=("Add or change a related_name or related_query_name "
149.                           "argument for this field."),
150.                     obj=self,
151.                     id='fields.E309',
152.                 )
153.             )
154.         return errors
155. 
156.     def _check_relation_model_exists(self):
157.         rel_is_missing = self.remote_field.model not in self.opts.apps.get_models()
158.         rel_is_string = isinstance(self.remote_field.model, str)
159.         model_name = self.remote_field.model if rel_is_string else self.remote_field.model._meta.object_name
160.         if rel_is_missing and (rel_is_string or not self.remote_field.model._meta.swapped):
161.             return [
162.                 checks.Error(
163.                     "Field defines a relation with model '%s', which is either "
164.                     "not installed, or is abstract." % model_name,
165.                     obj=self,
166.                     id='fields.E300',
167.                 )
168.             ]
169.         return []
170. 
171.     def _check_referencing_to_swapped_model(self):
172.         if (self.remote_field.model not in self.opts.apps.get_models() and
173.                 not isinstance(self.remote_field.model, str) and
174.                 self.remote_field.model._meta.swapped):
175.             model = "%s.%s" % (
176.                 self.remote_field.model._meta.app_label,
177.                 self.remote_field.model._meta.object_name
178.             )
179.             return [
180.                 checks.Error(
181.                     "Field defines a relation with the model '%s', which has "
182.                     "been swapped out." % model,
183.                     hint="Update the relation to point at 'settings.%s'." % self.remote_field.model._meta.swappable,
184.                     obj=self,
185.                     id='fields.E301',
186.                 )
187.             ]
188.         return []
189. 
190.     def _check_clashes(self):
191.         """Check accessor and reverse query name clashes."""
192.         from django.db.models.base import ModelBase
193. 
194.         errors = []
195.         opts = self.model._meta
196. 
197.         # `f.remote_field.model` may be a string instead of a model. Skip if model name is
198.         # not resolved.
199.         if not isinstance(self.remote_field.model, ModelBase):
200.             return []
201. 
202.         # Consider that we are checking field `Model.foreign` and the models
203.         # are:
204.         #
205.         #     class Target(models.Model):
206.         #         model = models.IntegerField()
207.         #         model_set = models.IntegerField()
208.         #
209.         #     class Model(models.Model):
210.         #         foreign = models.ForeignKey(Target)
211.         #         m2m = models.ManyToManyField(Target)
212. 
213.         # rel_opts.object_name == "Target"
214.         rel_opts = self.remote_field.model._meta
215.         # If the field doesn't install a backward relation on the target model
216.         # (so `is_hidden` returns True), then there are no clashes to check
217.         # and we can skip these fields.
218.         rel_is_hidden = self.remote_field.is_hidden()
219.         rel_name = self.remote_field.get_accessor_name()  # i. e. "model_set"
220.         rel_query_name = self.related_query_name()  # i. e. "model"
221.         field_name = "%s.%s" % (opts.object_name, self.name)  # i. e. "Model.field"
222. 
223.         # Check clashes between accessor or reverse query name of `field`
224.         # and any other field name -- i.e. accessor for Model.foreign is
225.         # model_set and it clashes with Target.model_set.
226.         potential_clashes = rel_opts.fields + rel_opts.many_to_many
227.         for clash_field in potential_clashes:
228.             clash_name = "%s.%s" % (rel_opts.object_name, clash_field.name)  # i.e. "Target.model_set"
229.             if not rel_is_hidden and clash_field.name == rel_name:
230.                 errors.append(
231.                     checks.Error(
232.                         "Reverse accessor for '%s' clashes with field name '%s'." % (field_name, clash_name),
233.                         hint=("Rename field '%s', or add/change a related_name "
234.                               "argument to the definition for field '%s'.") % (clash_name, field_name),
235.                         obj=self,
236.                         id='fields.E302',
237.                     )
238.                 )
239. 
240.             if clash_field.name == rel_query_name:
241.                 errors.append(
242.                     checks.Error(
243.                         "Reverse query name for '%s' clashes with field name '%s'." % (field_name, clash_name),
244.                         hint=("Rename field '%s', or add/change a related_name "
245.                               "argument to the definition for field '%s'.") % (clash_name, field_name),
246.                         obj=self,
247.                         id='fields.E303',
248.                     )
249.                 )
250. 
251.         # Check clashes between accessors/reverse query names of `field` and
252.         # any other field accessor -- i. e. Model.foreign accessor clashes with
253.         # Model.m2m accessor.
254.         potential_clashes = (r for r in rel_opts.related_objects if r.field is not self)
255.         for clash_field in potential_clashes:
256.             clash_name = "%s.%s" % (  # i. e. "Model.m2m"
257.                 clash_field.related_model._meta.object_name,
258.                 clash_field.field.name)
259.             if not rel_is_hidden and clash_field.get_accessor_name() == rel_name:
260.                 errors.append(
261.                     checks.Error(
262.                         "Reverse accessor for '%s' clashes with reverse accessor for '%s'." % (field_name, clash_name),
263.                         hint=("Add or change a related_name argument "
264.                               "to the definition for '%s' or '%s'.") % (field_name, clash_name),
265.                         obj=self,
266.                         id='fields.E304',
267.                     )
268.                 )
269. 
270.             if clash_field.get_accessor_name() == rel_query_name:
271.                 errors.append(
272.                     checks.Error(
273.                         "Reverse query name for '%s' clashes with reverse query name for '%s'."
274.                         % (field_name, clash_name),
275.                         hint=("Add or change a related_name argument "
276.                               "to the definition for '%s' or '%s'.") % (field_name, clash_name),
277.                         obj=self,
278.                         id='fields.E305',
279.                     )
280.                 )
281. 
282.         return errors
283. 
284.     def db_type(self, connection):
285.         # By default related field will not have a column as it relates to
286.         # columns from another table.
287.         return None
288. 
289.     def contribute_to_class(self, cls, name, private_only=False, **kwargs):
290. 
291.         super().contribute_to_class(cls, name, private_only=private_only, **kwargs)
292. 
293.         self.opts = cls._meta
294. 
295.         if not cls._meta.abstract:
296.             if self.remote_field.related_name:
297.                 related_name = self.remote_field.related_name
298.             else:
299.                 related_name = self.opts.default_related_name
300.             if related_name:
301.                 related_name = related_name % {
302.                     'class': cls.__name__.lower(),
303.                     'model_name': cls._meta.model_name.lower(),
304.                     'app_label': cls._meta.app_label.lower()
305.                 }
306.                 self.remote_field.related_name = related_name
307. 
308.             if self.remote_field.related_query_name:
309.                 related_query_name = self.remote_field.related_query_name % {
310.                     'class': cls.__name__.lower(),
311.                     'app_label': cls._meta.app_label.lower(),
312.                 }
313.                 self.remote_field.related_query_name = related_query_name
314. 
315.             def resolve_related_class(model, related, field):
316.                 field.remote_field.model = related
317.                 field.do_related_class(related, model)
318.             lazy_related_operation(resolve_related_class, cls, self.remote_field.model, field=self)
319. 
320.     def deconstruct(self):
321.         name, path, args, kwargs = super().deconstruct()
322.         if self.remote_field.limit_choices_to:
323.             kwargs['limit_choices_to'] = self.remote_field.limit_choices_to
324.         if self.remote_field.related_name is not None:
325.             kwargs['related_name'] = self.remote_field.related_name
326.         if self.remote_field.related_query_name is not None:
327.             kwargs['related_query_name'] = self.remote_field.related_query_name
328.         return name, path, args, kwargs
329. 
330.     def get_forward_related_filter(self, obj):
331.         """
332.         Return the keyword arguments that when supplied to
333.         self.model.object.filter(), would select all instances related through
334.         this field to the remote obj. This is used to build the querysets
335.         returned by related descriptors. obj is an instance of
336.         self.related_field.model.
337.         """
338.         return {
339.             '%s__%s' % (self.name, rh_field.name): getattr(obj, rh_field.attname)
340.             for _, rh_field in self.related_fields
341.         }
342. 
343.     def get_reverse_related_filter(self, obj):
344.         """
345.         Complement to get_forward_related_filter(). Return the keyword
346.         arguments that when passed to self.related_field.model.object.filter()
347.         select all instances of self.related_field.model related through
348.         this field to obj. obj is an instance of self.model.
349.         """
350.         base_filter = {
351.             rh_field.attname: getattr(obj, lh_field.attname)
352.             for lh_field, rh_field in self.related_fields
353.         }
354.         descriptor_filter = self.get_extra_descriptor_filter(obj)
355.         base_q = Q(**base_filter)
356.         if isinstance(descriptor_filter, dict):
357.             return base_q & Q(**descriptor_filter)
358.         elif descriptor_filter:
359.             return base_q & descriptor_filter
360.         return base_q
361. 
362.     @property
363.     def swappable_setting(self):
364.         """
365.         Get the setting that this is powered from for swapping, or None
366.         if it's not swapped in / marked with swappable=False.
367.         """
368.         if self.swappable:
369.             # Work out string form of "to"
370.             if isinstance(self.remote_field.model, str):
371.                 to_string = self.remote_field.model
372.             else:
373.                 to_string = self.remote_field.model._meta.label
374.             return apps.get_swappable_settings_name(to_string)
375.         return None
376. 
377.     def set_attributes_from_rel(self):
378.         self.name = (
379.             self.name or
380.             (self.remote_field.model._meta.model_name + '_' + self.remote_field.model._meta.pk.name)
381.         )
382.         if self.verbose_name is None:
383.             self.verbose_name = self.remote_field.model._meta.verbose_name
384.         self.remote_field.set_field_name()
385. 
386.     def do_related_class(self, other, cls):
387.         self.set_attributes_from_rel()
388.         self.contribute_to_related_class(other, self.remote_field)
389. 
390.     def get_limit_choices_to(self):
391.         """
392.         Return ``limit_choices_to`` for this model field.
393. 
394.         If it is a callable, it will be invoked and the result will be
395.         returned.
396.         """
397.         if callable(self.remote_field.limit_choices_to):
398.             return self.remote_field.limit_choices_to()
399.         return self.remote_field.limit_choices_to
400. 
401.     def formfield(self, **kwargs):
402.         """
403.         Pass ``limit_choices_to`` to the field being constructed.
404. 
405.         Only passes it if there is a type that supports related fields.
406.         This is a similar strategy used to pass the ``queryset`` to the field
407.         being constructed.
408.         """
409.         defaults = {}
410.         if hasattr(self.remote_field, 'get_related_field'):
411.             # If this is a callable, do not invoke it here. Just pass
412.             # it in the defaults for when the form class will later be
413.             # instantiated.
414.             limit_choices_to = self.remote_field.limit_choices_to
415.             defaults.update({
416.                 'limit_choices_to': limit_choices_to,
417.             })
418.         defaults.update(kwargs)
419.         return super().formfield(**defaults)
420. 
421.     def related_query_name(self):
422.         """
423.         Define the name that can be used to identify this related object in a
424.         table-spanning query.
425.         """
426.         return self.remote_field.related_query_name or self.remote_field.related_name or self.opts.model_name
427. 
428.     @property
429.     def target_field(self):
430.         """
431.         When filtering against this relation, return the field on the remote
432.         model against which the filtering should happen.
433.         """
434.         target_fields = self.get_path_info()[-1].target_fields
435.         if len(target_fields) > 1:
436.             raise exceptions.FieldError(
437.                 "The relation has multiple target fields, but only single target field was asked for")
438.         return target_fields[0]
439. 
440.     def get_cache_name(self):
441.         return self.name
442. 
443. 
444. class ForeignObject(RelatedField):
445.     """
446.     Abstraction of the ForeignKey relation to support multi-column relations.
447.     """
448. 
449.     # Field flags
450.     many_to_many = False
451.     many_to_one = True
452.     one_to_many = False
453.     one_to_one = False
454. 
455.     requires_unique_target = True
456.     related_accessor_class = ReverseManyToOneDescriptor
457.     forward_related_accessor_class = ForwardManyToOneDescriptor
458.     rel_class = ForeignObjectRel
459. 
460.     def __init__(self, to, on_delete, from_fields, to_fields, rel=None, related_name=None,
461.                  related_query_name=None, limit_choices_to=None, parent_link=False,
462.                  swappable=True, **kwargs):
463. 
464.         if rel is None:
465.             rel = self.rel_class(
466.                 self, to,
467.                 related_name=related_name,
468.                 related_query_name=related_query_name,
469.                 limit_choices_to=limit_choices_to,
470.                 parent_link=parent_link,
471.                 on_delete=on_delete,
472.             )
473. 
474.         super().__init__(rel=rel, **kwargs)
475. 
476.         self.from_fields = from_fields
477.         self.to_fields = to_fields
478.         self.swappable = swappable
479. 
480.     def check(self, **kwargs):
481.         return [
482.             *super().check(**kwargs),
483.             *self._check_to_fields_exist(),
484.             *self._check_unique_target(),
485.         ]
486. 
487.     def _check_to_fields_exist(self):
488.         # Skip nonexistent models.
489.         if isinstance(self.remote_field.model, str):
490.             return []
491. 
492.         errors = []
493.         for to_field in self.to_fields:
494.             if to_field:
495.                 try:
496.                     self.remote_field.model._meta.get_field(to_field)
497.                 except exceptions.FieldDoesNotExist:
498.                     errors.append(
499.                         checks.Error(
500.                             "The to_field '%s' doesn't exist on the related "


File: django/db/models/fields/related.py
Line number range: 501 - 1001
Content:
501.                             "model '%s'."
502.                             % (to_field, self.remote_field.model._meta.label),
503.                             obj=self,
504.                             id='fields.E312',
505.                         )
506.                     )
507.         return errors
508. 
509.     def _check_unique_target(self):
510.         rel_is_string = isinstance(self.remote_field.model, str)
511.         if rel_is_string or not self.requires_unique_target:
512.             return []
513. 
514.         try:
515.             self.foreign_related_fields
516.         except exceptions.FieldDoesNotExist:
517.             return []
518. 
519.         if not self.foreign_related_fields:
520.             return []
521. 
522.         unique_foreign_fields = {
523.             frozenset([f.name])
524.             for f in self.remote_field.model._meta.get_fields()
525.             if getattr(f, 'unique', False)
526.         }
527.         unique_foreign_fields.update({
528.             frozenset(ut)
529.             for ut in self.remote_field.model._meta.unique_together
530.         })
531.         unique_foreign_fields.update({
532.             frozenset(uc.fields)
533.             for uc in self.remote_field.model._meta.total_unique_constraints
534.         })
535.         foreign_fields = {f.name for f in self.foreign_related_fields}
536.         has_unique_constraint = any(u <= foreign_fields for u in unique_foreign_fields)
537. 
538.         if not has_unique_constraint and len(self.foreign_related_fields) > 1:
539.             field_combination = ', '.join(
540.                 "'%s'" % rel_field.name for rel_field in self.foreign_related_fields
541.             )
542.             model_name = self.remote_field.model.__name__
543.             return [
544.                 checks.Error(
545.                     "No subset of the fields %s on model '%s' is unique."
546.                     % (field_combination, model_name),
547.                     hint=(
548.                         'Mark a single field as unique=True or add a set of '
549.                         'fields to a unique constraint (via unique_together '
550.                         'or a UniqueConstraint (without condition) in the '
551.                         'model Meta.constraints).'
552.                     ),
553.                     obj=self,
554.                     id='fields.E310',
555.                 )
556.             ]
557.         elif not has_unique_constraint:
558.             field_name = self.foreign_related_fields[0].name
559.             model_name = self.remote_field.model.__name__
560.             return [
561.                 checks.Error(
562.                     "'%s.%s' must be unique because it is referenced by "
563.                     "a foreign key." % (model_name, field_name),
564.                     hint=(
565.                         'Add unique=True to this field or add a '
566.                         'UniqueConstraint (without condition) in the model '
567.                         'Meta.constraints.'
568.                     ),
569.                     obj=self,
570.                     id='fields.E311',
571.                 )
572.             ]
573.         else:
574.             return []
575. 
576.     def deconstruct(self):
577.         name, path, args, kwargs = super().deconstruct()
578.         kwargs['on_delete'] = self.remote_field.on_delete
579.         kwargs['from_fields'] = self.from_fields
580.         kwargs['to_fields'] = self.to_fields
581. 
582.         if self.remote_field.parent_link:
583.             kwargs['parent_link'] = self.remote_field.parent_link
584.         if isinstance(self.remote_field.model, str):
585.             kwargs['to'] = self.remote_field.model.lower()
586.         else:
587.             kwargs['to'] = self.remote_field.model._meta.label_lower
588.         # If swappable is True, then see if we're actually pointing to the target
589.         # of a swap.
590.         swappable_setting = self.swappable_setting
591.         if swappable_setting is not None:
592.             # If it's already a settings reference, error
593.             if hasattr(kwargs['to'], "setting_name"):
594.                 if kwargs['to'].setting_name != swappable_setting:
595.                     raise ValueError(
596.                         "Cannot deconstruct a ForeignKey pointing to a model "
597.                         "that is swapped in place of more than one model (%s and %s)"
598.                         % (kwargs['to'].setting_name, swappable_setting)
599.                     )
600.             # Set it
601.             kwargs['to'] = SettingsReference(
602.                 kwargs['to'],
603.                 swappable_setting,
604.             )
605.         return name, path, args, kwargs
606. 
607.     def resolve_related_fields(self):
608.         if not self.from_fields or len(self.from_fields) != len(self.to_fields):
609.             raise ValueError('Foreign Object from and to fields must be the same non-zero length')
610.         if isinstance(self.remote_field.model, str):
611.             raise ValueError('Related model %r cannot be resolved' % self.remote_field.model)
612.         related_fields = []
613.         for index in range(len(self.from_fields)):
614.             from_field_name = self.from_fields[index]
615.             to_field_name = self.to_fields[index]
616.             from_field = (
617.                 self
618.                 if from_field_name == RECURSIVE_RELATIONSHIP_CONSTANT
619.                 else self.opts.get_field(from_field_name)
620.             )
621.             to_field = (self.remote_field.model._meta.pk if to_field_name is None
622.                         else self.remote_field.model._meta.get_field(to_field_name))
623.             related_fields.append((from_field, to_field))
624.         return related_fields
625. 
626.     @cached_property
627.     def related_fields(self):
628.         return self.resolve_related_fields()
629. 
630.     @cached_property
631.     def reverse_related_fields(self):
632.         return [(rhs_field, lhs_field) for lhs_field, rhs_field in self.related_fields]
633. 
634.     @cached_property
635.     def local_related_fields(self):
636.         return tuple(lhs_field for lhs_field, rhs_field in self.related_fields)
637. 
638.     @cached_property
639.     def foreign_related_fields(self):
640.         return tuple(rhs_field for lhs_field, rhs_field in self.related_fields if rhs_field)
641. 
642.     def get_local_related_value(self, instance):
643.         return self.get_instance_value_for_fields(instance, self.local_related_fields)
644. 
645.     def get_foreign_related_value(self, instance):
646.         return self.get_instance_value_for_fields(instance, self.foreign_related_fields)
647. 
648.     @staticmethod
649.     def get_instance_value_for_fields(instance, fields):
650.         ret = []
651.         opts = instance._meta
652.         for field in fields:
653.             # Gotcha: in some cases (like fixture loading) a model can have
654.             # different values in parent_ptr_id and parent's id. So, use
655.             # instance.pk (that is, parent_ptr_id) when asked for instance.id.
656.             if field.primary_key:
657.                 possible_parent_link = opts.get_ancestor_link(field.model)
658.                 if (not possible_parent_link or
659.                         possible_parent_link.primary_key or
660.                         possible_parent_link.model._meta.abstract):
661.                     ret.append(instance.pk)
662.                     continue
663.             ret.append(getattr(instance, field.attname))
664.         return tuple(ret)
665. 
666.     def get_attname_column(self):
667.         attname, column = super().get_attname_column()
668.         return attname, None
669. 
670.     def get_joining_columns(self, reverse_join=False):
671.         source = self.reverse_related_fields if reverse_join else self.related_fields
672.         return tuple((lhs_field.column, rhs_field.column) for lhs_field, rhs_field in source)
673. 
674.     def get_reverse_joining_columns(self):
675.         return self.get_joining_columns(reverse_join=True)
676. 
677.     def get_extra_descriptor_filter(self, instance):
678.         """
679.         Return an extra filter condition for related object fetching when
680.         user does 'instance.fieldname', that is the extra filter is used in
681.         the descriptor of the field.
682. 
683.         The filter should be either a dict usable in .filter(**kwargs) call or
684.         a Q-object. The condition will be ANDed together with the relation's
685.         joining columns.
686. 
687.         A parallel method is get_extra_restriction() which is used in
688.         JOIN and subquery conditions.
689.         """
690.         return {}
691. 
692.     def get_extra_restriction(self, where_class, alias, related_alias):
693.         """
694.         Return a pair condition used for joining and subquery pushdown. The
695.         condition is something that responds to as_sql(compiler, connection)
696.         method.
697. 
698.         Note that currently referring both the 'alias' and 'related_alias'
699.         will not work in some conditions, like subquery pushdown.
700. 
701.         A parallel method is get_extra_descriptor_filter() which is used in
702.         instance.fieldname related object fetching.
703.         """
704.         return None
705. 
706.     def get_path_info(self, filtered_relation=None):
707.         """Get path from this field to the related model."""
708.         opts = self.remote_field.model._meta
709.         from_opts = self.model._meta
710.         return [PathInfo(
711.             from_opts=from_opts,
712.             to_opts=opts,
713.             target_fields=self.foreign_related_fields,
714.             join_field=self,
715.             m2m=False,
716.             direct=True,
717.             filtered_relation=filtered_relation,
718.         )]
719. 
720.     def get_reverse_path_info(self, filtered_relation=None):
721.         """Get path from the related model to this field's model."""
722.         opts = self.model._meta
723.         from_opts = self.remote_field.model._meta
724.         return [PathInfo(
725.             from_opts=from_opts,
726.             to_opts=opts,
727.             target_fields=(opts.pk,),
728.             join_field=self.remote_field,
729.             m2m=not self.unique,
730.             direct=False,
731.             filtered_relation=filtered_relation,
732.         )]
733. 
734.     @classmethod
735.     @functools.lru_cache(maxsize=None)
736.     def get_lookups(cls):
737.         bases = inspect.getmro(cls)
738.         bases = bases[:bases.index(ForeignObject) + 1]
739.         class_lookups = [parent.__dict__.get('class_lookups', {}) for parent in bases]
740.         return cls.merge_dicts(class_lookups)
741. 
742.     def contribute_to_class(self, cls, name, private_only=False, **kwargs):
743.         super().contribute_to_class(cls, name, private_only=private_only, **kwargs)
744.         setattr(cls, self.name, self.forward_related_accessor_class(self))
745. 
746.     def contribute_to_related_class(self, cls, related):
747.         # Internal FK's - i.e., those with a related name ending with '+' -
748.         # and swapped models don't get a related descriptor.
749.         if not self.remote_field.is_hidden() and not related.related_model._meta.swapped:
750.             setattr(cls._meta.concrete_model, related.get_accessor_name(), self.related_accessor_class(related))
751.             # While 'limit_choices_to' might be a callable, simply pass
752.             # it along for later - this is too early because it's still
753.             # model load time.
754.             if self.remote_field.limit_choices_to:
755.                 cls._meta.related_fkey_lookups.append(self.remote_field.limit_choices_to)
756. 
757. 
758. ForeignObject.register_lookup(RelatedIn)
759. ForeignObject.register_lookup(RelatedExact)
760. ForeignObject.register_lookup(RelatedLessThan)
761. ForeignObject.register_lookup(RelatedGreaterThan)
762. ForeignObject.register_lookup(RelatedGreaterThanOrEqual)
763. ForeignObject.register_lookup(RelatedLessThanOrEqual)
764. ForeignObject.register_lookup(RelatedIsNull)
765. 
766. 
767. class ForeignKey(ForeignObject):
768.     """
769.     Provide a many-to-one relation by adding a column to the local model
770.     to hold the remote value.
771. 
772.     By default ForeignKey will target the pk of the remote model but this
773.     behavior can be changed by using the ``to_field`` argument.
774.     """
775.     descriptor_class = ForeignKeyDeferredAttribute
776.     # Field flags
777.     many_to_many = False
778.     many_to_one = True
779.     one_to_many = False
780.     one_to_one = False
781. 
782.     rel_class = ManyToOneRel
783. 
784.     empty_strings_allowed = False
785.     default_error_messages = {
786.         'invalid': _('%(model)s instance with %(field)s %(value)r does not exist.')
787.     }
788.     description = _("Foreign Key (type determined by related field)")
789. 
790.     def __init__(self, to, on_delete, related_name=None, related_query_name=None,
791.                  limit_choices_to=None, parent_link=False, to_field=None,
792.                  db_constraint=True, **kwargs):
793.         try:
794.             to._meta.model_name
795.         except AttributeError:
796.             assert isinstance(to, str), (
797.                 "%s(%r) is invalid. First parameter to ForeignKey must be "
798.                 "either a model, a model name, or the string %r" % (
799.                     self.__class__.__name__, to,
800.                     RECURSIVE_RELATIONSHIP_CONSTANT,
801.                 )
802.             )
803.         else:
804.             # For backwards compatibility purposes, we need to *try* and set
805.             # the to_field during FK construction. It won't be guaranteed to
806.             # be correct until contribute_to_class is called. Refs #12190.
807.             to_field = to_field or (to._meta.pk and to._meta.pk.name)
808.         if not callable(on_delete):
809.             raise TypeError('on_delete must be callable.')
810. 
811.         kwargs['rel'] = self.rel_class(
812.             self, to, to_field,
813.             related_name=related_name,
814.             related_query_name=related_query_name,
815.             limit_choices_to=limit_choices_to,
816.             parent_link=parent_link,
817.             on_delete=on_delete,
818.         )
819.         kwargs.setdefault('db_index', True)
820. 
821.         super().__init__(
822.             to,
823.             on_delete,
824.             from_fields=[RECURSIVE_RELATIONSHIP_CONSTANT],
825.             to_fields=[to_field],
826.             **kwargs,
827.         )
828.         self.db_constraint = db_constraint
829. 
830.     def check(self, **kwargs):
831.         return [
832.             *super().check(**kwargs),
833.             *self._check_on_delete(),
834.             *self._check_unique(),
835.         ]
836. 
837.     def _check_on_delete(self):
838.         on_delete = getattr(self.remote_field, 'on_delete', None)
839.         if on_delete == SET_NULL and not self.null:
840.             return [
841.                 checks.Error(
842.                     'Field specifies on_delete=SET_NULL, but cannot be null.',
843.                     hint='Set null=True argument on the field, or change the on_delete rule.',
844.                     obj=self,
845.                     id='fields.E320',
846.                 )
847.             ]
848.         elif on_delete == SET_DEFAULT and not self.has_default():
849.             return [
850.                 checks.Error(
851.                     'Field specifies on_delete=SET_DEFAULT, but has no default value.',
852.                     hint='Set a default value, or change the on_delete rule.',
853.                     obj=self,
854.                     id='fields.E321',
855.                 )
856.             ]
857.         else:
858.             return []
859. 
860.     def _check_unique(self, **kwargs):
861.         return [
862.             checks.Warning(
863.                 'Setting unique=True on a ForeignKey has the same effect as using a OneToOneField.',
864.                 hint='ForeignKey(unique=True) is usually better served by a OneToOneField.',
865.                 obj=self,
866.                 id='fields.W342',
867.             )
868.         ] if self.unique else []
869. 
870.     def deconstruct(self):
871.         name, path, args, kwargs = super().deconstruct()
872.         del kwargs['to_fields']
873.         del kwargs['from_fields']
874.         # Handle the simpler arguments
875.         if self.db_index:
876.             del kwargs['db_index']
877.         else:
878.             kwargs['db_index'] = False
879.         if self.db_constraint is not True:
880.             kwargs['db_constraint'] = self.db_constraint
881.         # Rel needs more work.
882.         to_meta = getattr(self.remote_field.model, "_meta", None)
883.         if self.remote_field.field_name and (
884.                 not to_meta or (to_meta.pk and self.remote_field.field_name != to_meta.pk.name)):
885.             kwargs['to_field'] = self.remote_field.field_name
886.         return name, path, args, kwargs
887. 
888.     def to_python(self, value):
889.         return self.target_field.to_python(value)
890. 
891.     @property
892.     def target_field(self):
893.         return self.foreign_related_fields[0]
894. 
895.     def get_reverse_path_info(self, filtered_relation=None):
896.         """Get path from the related model to this field's model."""
897.         opts = self.model._meta
898.         from_opts = self.remote_field.model._meta
899.         return [PathInfo(
900.             from_opts=from_opts,
901.             to_opts=opts,
902.             target_fields=(opts.pk,),
903.             join_field=self.remote_field,
904.             m2m=not self.unique,
905.             direct=False,
906.             filtered_relation=filtered_relation,
907.         )]
908. 
909.     def validate(self, value, model_instance):
910.         if self.remote_field.parent_link:
911.             return
912.         super().validate(value, model_instance)
913.         if value is None:
914.             return
915. 
916.         using = router.db_for_read(self.remote_field.model, instance=model_instance)
917.         qs = self.remote_field.model._default_manager.using(using).filter(
918.             **{self.remote_field.field_name: value}
919.         )
920.         qs = qs.complex_filter(self.get_limit_choices_to())
921.         if not qs.exists():
922.             raise exceptions.ValidationError(
923.                 self.error_messages['invalid'],
924.                 code='invalid',
925.                 params={
926.                     'model': self.remote_field.model._meta.verbose_name, 'pk': value,
927.                     'field': self.remote_field.field_name, 'value': value,
928.                 },  # 'pk' is included for backwards compatibility
929.             )
930. 
931.     def resolve_related_fields(self):
932.         related_fields = super().resolve_related_fields()
933.         for from_field, to_field in related_fields:
934.             if to_field and to_field.model != self.remote_field.model._meta.concrete_model:
935.                 raise exceptions.FieldError(
936.                     "'%s.%s' refers to field '%s' which is not local to model "
937.                     "'%s'." % (
938.                         self.model._meta.label,
939.                         self.name,
940.                         to_field.name,
941.                         self.remote_field.model._meta.concrete_model._meta.label,
942.                     )
943.                 )
944.         return related_fields
945. 
946.     def get_attname(self):
947.         return '%s_id' % self.name
948. 
949.     def get_attname_column(self):
950.         attname = self.get_attname()
951.         column = self.db_column or attname
952.         return attname, column
953. 
954.     def get_default(self):
955.         """Return the to_field if the default value is an object."""
956.         field_default = super().get_default()
957.         if isinstance(field_default, self.remote_field.model):
958.             return getattr(field_default, self.target_field.attname)
959.         return field_default
960. 
961.     def get_db_prep_save(self, value, connection):
962.         if value is None or (value == '' and
963.                              (not self.target_field.empty_strings_allowed or
964.                               connection.features.interprets_empty_strings_as_nulls)):
965.             return None
966.         else:
967.             return self.target_field.get_db_prep_save(value, connection=connection)
968. 
969.     def get_db_prep_value(self, value, connection, prepared=False):
970.         return self.target_field.get_db_prep_value(value, connection, prepared)
971. 
972.     def get_prep_value(self, value):
973.         return self.target_field.get_prep_value(value)
974. 
975.     def contribute_to_related_class(self, cls, related):
976.         super().contribute_to_related_class(cls, related)
977.         if self.remote_field.field_name is None:
978.             self.remote_field.field_name = cls._meta.pk.name
979. 
980.     def formfield(self, *, using=None, **kwargs):
981.         if isinstance(self.remote_field.model, str):
982.             raise ValueError("Cannot create form field for %r yet, because "
983.                              "its related model %r has not been loaded yet" %
984.                              (self.name, self.remote_field.model))
985.         return super().formfield(**{
986.             'form_class': forms.ModelChoiceField,
987.             'queryset': self.remote_field.model._default_manager.using(using),
988.             'to_field_name': self.remote_field.field_name,
989.             **kwargs,
990.             'blank': self.blank,
991.         })
992. 
993.     def db_check(self, connection):
994.         return []
995. 
996.     def db_type(self, connection):
997.         return self.target_field.rel_db_type(connection=connection)
998. 
999.     def db_parameters(self, connection):
1000.         return {"type": self.db_type(connection), "check": self.db_check(connection)}


File: django/db/models/fields/related.py
Line number range: 1001 - 1501
Content:
1001. 
1002.     def convert_empty_strings(self, value, expression, connection):
1003.         if (not value) and isinstance(value, str):
1004.             return None
1005.         return value
1006. 
1007.     def get_db_converters(self, connection):
1008.         converters = super().get_db_converters(connection)
1009.         if connection.features.interprets_empty_strings_as_nulls:
1010.             converters += [self.convert_empty_strings]
1011.         return converters
1012. 
1013.     def get_col(self, alias, output_field=None):
1014.         if output_field is None:
1015.             output_field = self.target_field
1016.             while isinstance(output_field, ForeignKey):
1017.                 output_field = output_field.target_field
1018.                 if output_field is self:
1019.                     raise ValueError('Cannot resolve output_field.')
1020.         return super().get_col(alias, output_field)
1021. 
1022. 
1023. class OneToOneField(ForeignKey):
1024.     """
1025.     A OneToOneField is essentially the same as a ForeignKey, with the exception
1026.     that it always carries a "unique" constraint with it and the reverse
1027.     relation always returns the object pointed to (since there will only ever
1028.     be one), rather than returning a list.
1029.     """
1030. 
1031.     # Field flags
1032.     many_to_many = False
1033.     many_to_one = False
1034.     one_to_many = False
1035.     one_to_one = True
1036. 
1037.     related_accessor_class = ReverseOneToOneDescriptor
1038.     forward_related_accessor_class = ForwardOneToOneDescriptor
1039.     rel_class = OneToOneRel
1040. 
1041.     description = _("One-to-one relationship")
1042. 
1043.     def __init__(self, to, on_delete, to_field=None, **kwargs):
1044.         kwargs['unique'] = True
1045.         super().__init__(to, on_delete, to_field=to_field, **kwargs)
1046. 
1047.     def deconstruct(self):
1048.         name, path, args, kwargs = super().deconstruct()
1049.         if "unique" in kwargs:
1050.             del kwargs['unique']
1051.         return name, path, args, kwargs
1052. 
1053.     def formfield(self, **kwargs):
1054.         if self.remote_field.parent_link:
1055.             return None
1056.         return super().formfield(**kwargs)
1057. 
1058.     def save_form_data(self, instance, data):
1059.         if isinstance(data, self.remote_field.model):
1060.             setattr(instance, self.name, data)
1061.         else:
1062.             setattr(instance, self.attname, data)
1063.             # Remote field object must be cleared otherwise Model.save()
1064.             # will reassign attname using the related object pk.
1065.             if data is None:
1066.                 setattr(instance, self.name, data)
1067. 
1068.     def _check_unique(self, **kwargs):
1069.         # Override ForeignKey since check isn't applicable here.
1070.         return []
1071. 
1072. 
1073. def create_many_to_many_intermediary_model(field, klass):
1074.     from django.db import models
1075. 
1076.     def set_managed(model, related, through):
1077.         through._meta.managed = model._meta.managed or related._meta.managed
1078. 
1079.     to_model = resolve_relation(klass, field.remote_field.model)
1080.     name = '%s_%s' % (klass._meta.object_name, field.name)
1081.     lazy_related_operation(set_managed, klass, to_model, name)
1082. 
1083.     to = make_model_tuple(to_model)[1]
1084.     from_ = klass._meta.model_name
1085.     if to == from_:
1086.         to = 'to_%s' % to
1087.         from_ = 'from_%s' % from_
1088. 
1089.     meta = type('Meta', (), {
1090.         'db_table': field._get_m2m_db_table(klass._meta),
1091.         'auto_created': klass,
1092.         'app_label': klass._meta.app_label,
1093.         'db_tablespace': klass._meta.db_tablespace,
1094.         'unique_together': (from_, to),
1095.         'verbose_name': _('%(from)s-%(to)s relationship') % {'from': from_, 'to': to},
1096.         'verbose_name_plural': _('%(from)s-%(to)s relationships') % {'from': from_, 'to': to},
1097.         'apps': field.model._meta.apps,
1098.     })
1099.     # Construct and return the new class.
1100.     return type(name, (models.Model,), {
1101.         'Meta': meta,
1102.         '__module__': klass.__module__,
1103.         from_: models.ForeignKey(
1104.             klass,
1105.             related_name='%s+' % name,
1106.             db_tablespace=field.db_tablespace,
1107.             db_constraint=field.remote_field.db_constraint,
1108.             on_delete=CASCADE,
1109.         ),
1110.         to: models.ForeignKey(
1111.             to_model,
1112.             related_name='%s+' % name,
1113.             db_tablespace=field.db_tablespace,
1114.             db_constraint=field.remote_field.db_constraint,
1115.             on_delete=CASCADE,
1116.         )
1117.     })
1118. 
1119. 
1120. class ManyToManyField(RelatedField):
1121.     """
1122.     Provide a many-to-many relation by using an intermediary model that
1123.     holds two ForeignKey fields pointed at the two sides of the relation.
1124. 
1125.     Unless a ``through`` model was provided, ManyToManyField will use the
1126.     create_many_to_many_intermediary_model factory to automatically generate
1127.     the intermediary model.
1128.     """
1129. 
1130.     # Field flags
1131.     many_to_many = True
1132.     many_to_one = False
1133.     one_to_many = False
1134.     one_to_one = False
1135. 
1136.     rel_class = ManyToManyRel
1137. 
1138.     description = _("Many-to-many relationship")
1139. 
1140.     def __init__(self, to, related_name=None, related_query_name=None,
1141.                  limit_choices_to=None, symmetrical=None, through=None,
1142.                  through_fields=None, db_constraint=True, db_table=None,
1143.                  swappable=True, **kwargs):
1144.         try:
1145.             to._meta
1146.         except AttributeError:
1147.             assert isinstance(to, str), (
1148.                 "%s(%r) is invalid. First parameter to ManyToManyField must be "
1149.                 "either a model, a model name, or the string %r" %
1150.                 (self.__class__.__name__, to, RECURSIVE_RELATIONSHIP_CONSTANT)
1151.             )
1152. 
1153.         if symmetrical is None:
1154.             symmetrical = (to == RECURSIVE_RELATIONSHIP_CONSTANT)
1155. 
1156.         if through is not None:
1157.             assert db_table is None, (
1158.                 "Cannot specify a db_table if an intermediary model is used."
1159.             )
1160. 
1161.         kwargs['rel'] = self.rel_class(
1162.             self, to,
1163.             related_name=related_name,
1164.             related_query_name=related_query_name,
1165.             limit_choices_to=limit_choices_to,
1166.             symmetrical=symmetrical,
1167.             through=through,
1168.             through_fields=through_fields,
1169.             db_constraint=db_constraint,
1170.         )
1171.         self.has_null_arg = 'null' in kwargs
1172. 
1173.         super().__init__(**kwargs)
1174. 
1175.         self.db_table = db_table
1176.         self.swappable = swappable
1177. 
1178.     def check(self, **kwargs):
1179.         return [
1180.             *super().check(**kwargs),
1181.             *self._check_unique(**kwargs),
1182.             *self._check_relationship_model(**kwargs),
1183.             *self._check_ignored_options(**kwargs),
1184.             *self._check_table_uniqueness(**kwargs),
1185.         ]
1186. 
1187.     def _check_unique(self, **kwargs):
1188.         if self.unique:
1189.             return [
1190.                 checks.Error(
1191.                     'ManyToManyFields cannot be unique.',
1192.                     obj=self,
1193.                     id='fields.E330',
1194.                 )
1195.             ]
1196.         return []
1197. 
1198.     def _check_ignored_options(self, **kwargs):
1199.         warnings = []
1200. 
1201.         if self.has_null_arg:
1202.             warnings.append(
1203.                 checks.Warning(
1204.                     'null has no effect on ManyToManyField.',
1205.                     obj=self,
1206.                     id='fields.W340',
1207.                 )
1208.             )
1209. 
1210.         if self._validators:
1211.             warnings.append(
1212.                 checks.Warning(
1213.                     'ManyToManyField does not support validators.',
1214.                     obj=self,
1215.                     id='fields.W341',
1216.                 )
1217.             )
1218.         if (self.remote_field.limit_choices_to and self.remote_field.through and
1219.                 not self.remote_field.through._meta.auto_created):
1220.             warnings.append(
1221.                 checks.Warning(
1222.                     'limit_choices_to has no effect on ManyToManyField '
1223.                     'with a through model.',
1224.                     obj=self,
1225.                     id='fields.W343',
1226.                 )
1227.             )
1228. 
1229.         return warnings
1230. 
1231.     def _check_relationship_model(self, from_model=None, **kwargs):
1232.         if hasattr(self.remote_field.through, '_meta'):
1233.             qualified_model_name = "%s.%s" % (
1234.                 self.remote_field.through._meta.app_label, self.remote_field.through.__name__)
1235.         else:
1236.             qualified_model_name = self.remote_field.through
1237. 
1238.         errors = []
1239. 
1240.         if self.remote_field.through not in self.opts.apps.get_models(include_auto_created=True):
1241.             # The relationship model is not installed.
1242.             errors.append(
1243.                 checks.Error(
1244.                     "Field specifies a many-to-many relation through model "
1245.                     "'%s', which has not been installed." % qualified_model_name,
1246.                     obj=self,
1247.                     id='fields.E331',
1248.                 )
1249.             )
1250. 
1251.         else:
1252.             assert from_model is not None, (
1253.                 "ManyToManyField with intermediate "
1254.                 "tables cannot be checked if you don't pass the model "
1255.                 "where the field is attached to."
1256.             )
1257.             # Set some useful local variables
1258.             to_model = resolve_relation(from_model, self.remote_field.model)
1259.             from_model_name = from_model._meta.object_name
1260.             if isinstance(to_model, str):
1261.                 to_model_name = to_model
1262.             else:
1263.                 to_model_name = to_model._meta.object_name
1264.             relationship_model_name = self.remote_field.through._meta.object_name
1265.             self_referential = from_model == to_model
1266.             # Count foreign keys in intermediate model
1267.             if self_referential:
1268.                 seen_self = sum(
1269.                     from_model == getattr(field.remote_field, 'model', None)
1270.                     for field in self.remote_field.through._meta.fields
1271.                 )
1272. 
1273.                 if seen_self > 2 and not self.remote_field.through_fields:
1274.                     errors.append(
1275.                         checks.Error(
1276.                             "The model is used as an intermediate model by "
1277.                             "'%s', but it has more than two foreign keys "
1278.                             "to '%s', which is ambiguous. You must specify "
1279.                             "which two foreign keys Django should use via the "
1280.                             "through_fields keyword argument." % (self, from_model_name),
1281.                             hint="Use through_fields to specify which two foreign keys Django should use.",
1282.                             obj=self.remote_field.through,
1283.                             id='fields.E333',
1284.                         )
1285.                     )
1286. 
1287.             else:
1288.                 # Count foreign keys in relationship model
1289.                 seen_from = sum(
1290.                     from_model == getattr(field.remote_field, 'model', None)
1291.                     for field in self.remote_field.through._meta.fields
1292.                 )
1293.                 seen_to = sum(
1294.                     to_model == getattr(field.remote_field, 'model', None)
1295.                     for field in self.remote_field.through._meta.fields
1296.                 )
1297. 
1298.                 if seen_from > 1 and not self.remote_field.through_fields:
1299.                     errors.append(
1300.                         checks.Error(
1301.                             ("The model is used as an intermediate model by "
1302.                              "'%s', but it has more than one foreign key "
1303.                              "from '%s', which is ambiguous. You must specify "
1304.                              "which foreign key Django should use via the "
1305.                              "through_fields keyword argument.") % (self, from_model_name),
1306.                             hint=(
1307.                                 'If you want to create a recursive relationship, '
1308.                                 'use ManyToManyField("%s", through="%s").'
1309.                             ) % (
1310.                                 RECURSIVE_RELATIONSHIP_CONSTANT,
1311.                                 relationship_model_name,
1312.                             ),
1313.                             obj=self,
1314.                             id='fields.E334',
1315.                         )
1316.                     )
1317. 
1318.                 if seen_to > 1 and not self.remote_field.through_fields:
1319.                     errors.append(
1320.                         checks.Error(
1321.                             "The model is used as an intermediate model by "
1322.                             "'%s', but it has more than one foreign key "
1323.                             "to '%s', which is ambiguous. You must specify "
1324.                             "which foreign key Django should use via the "
1325.                             "through_fields keyword argument." % (self, to_model_name),
1326.                             hint=(
1327.                                 'If you want to create a recursive relationship, '
1328.                                 'use ManyToManyField("%s", through="%s").'
1329.                             ) % (
1330.                                 RECURSIVE_RELATIONSHIP_CONSTANT,
1331.                                 relationship_model_name,
1332.                             ),
1333.                             obj=self,
1334.                             id='fields.E335',
1335.                         )
1336.                     )
1337. 
1338.                 if seen_from == 0 or seen_to == 0:
1339.                     errors.append(
1340.                         checks.Error(
1341.                             "The model is used as an intermediate model by "
1342.                             "'%s', but it does not have a foreign key to '%s' or '%s'." % (
1343.                                 self, from_model_name, to_model_name
1344.                             ),
1345.                             obj=self.remote_field.through,
1346.                             id='fields.E336',
1347.                         )
1348.                     )
1349. 
1350.         # Validate `through_fields`.
1351.         if self.remote_field.through_fields is not None:
1352.             # Validate that we're given an iterable of at least two items
1353.             # and that none of them is "falsy".
1354.             if not (len(self.remote_field.through_fields) >= 2 and
1355.                     self.remote_field.through_fields[0] and self.remote_field.through_fields[1]):
1356.                 errors.append(
1357.                     checks.Error(
1358.                         "Field specifies 'through_fields' but does not provide "
1359.                         "the names of the two link fields that should be used "
1360.                         "for the relation through model '%s'." % qualified_model_name,
1361.                         hint="Make sure you specify 'through_fields' as through_fields=('field1', 'field2')",
1362.                         obj=self,
1363.                         id='fields.E337',
1364.                     )
1365.                 )
1366. 
1367.             # Validate the given through fields -- they should be actual
1368.             # fields on the through model, and also be foreign keys to the
1369.             # expected models.
1370.             else:
1371.                 assert from_model is not None, (
1372.                     "ManyToManyField with intermediate "
1373.                     "tables cannot be checked if you don't pass the model "
1374.                     "where the field is attached to."
1375.                 )
1376. 
1377.                 source, through, target = from_model, self.remote_field.through, self.remote_field.model
1378.                 source_field_name, target_field_name = self.remote_field.through_fields[:2]
1379. 
1380.                 for field_name, related_model in ((source_field_name, source),
1381.                                                   (target_field_name, target)):
1382. 
1383.                     possible_field_names = []
1384.                     for f in through._meta.fields:
1385.                         if hasattr(f, 'remote_field') and getattr(f.remote_field, 'model', None) == related_model:
1386.                             possible_field_names.append(f.name)
1387.                     if possible_field_names:
1388.                         hint = "Did you mean one of the following foreign keys to '%s': %s?" % (
1389.                             related_model._meta.object_name,
1390.                             ', '.join(possible_field_names),
1391.                         )
1392.                     else:
1393.                         hint = None
1394. 
1395.                     try:
1396.                         field = through._meta.get_field(field_name)
1397.                     except exceptions.FieldDoesNotExist:
1398.                         errors.append(
1399.                             checks.Error(
1400.                                 "The intermediary model '%s' has no field '%s'."
1401.                                 % (qualified_model_name, field_name),
1402.                                 hint=hint,
1403.                                 obj=self,
1404.                                 id='fields.E338',
1405.                             )
1406.                         )
1407.                     else:
1408.                         if not (hasattr(field, 'remote_field') and
1409.                                 getattr(field.remote_field, 'model', None) == related_model):
1410.                             errors.append(
1411.                                 checks.Error(
1412.                                     "'%s.%s' is not a foreign key to '%s'." % (
1413.                                         through._meta.object_name, field_name,
1414.                                         related_model._meta.object_name,
1415.                                     ),
1416.                                     hint=hint,
1417.                                     obj=self,
1418.                                     id='fields.E339',
1419.                                 )
1420.                             )
1421. 
1422.         return errors
1423. 
1424.     def _check_table_uniqueness(self, **kwargs):
1425.         if isinstance(self.remote_field.through, str) or not self.remote_field.through._meta.managed:
1426.             return []
1427.         registered_tables = {
1428.             model._meta.db_table: model
1429.             for model in self.opts.apps.get_models(include_auto_created=True)
1430.             if model != self.remote_field.through and model._meta.managed
1431.         }
1432.         m2m_db_table = self.m2m_db_table()
1433.         model = registered_tables.get(m2m_db_table)
1434.         # The second condition allows multiple m2m relations on a model if
1435.         # some point to a through model that proxies another through model.
1436.         if model and model._meta.concrete_model != self.remote_field.through._meta.concrete_model:
1437.             if model._meta.auto_created:
1438.                 def _get_field_name(model):
1439.                     for field in model._meta.auto_created._meta.many_to_many:
1440.                         if field.remote_field.through is model:
1441.                             return field.name
1442.                 opts = model._meta.auto_created._meta
1443.                 clashing_obj = '%s.%s' % (opts.label, _get_field_name(model))
1444.             else:
1445.                 clashing_obj = model._meta.label
1446.             if settings.DATABASE_ROUTERS:
1447.                 error_class, error_id = checks.Warning, 'fields.W344'
1448.                 error_hint = (
1449.                     'You have configured settings.DATABASE_ROUTERS. Verify '
1450.                     'that the table of %r is correctly routed to a separate '
1451.                     'database.' % clashing_obj
1452.                 )
1453.             else:
1454.                 error_class, error_id = checks.Error, 'fields.E340'
1455.                 error_hint = None
1456.             return [
1457.                 error_class(
1458.                     "The field's intermediary table '%s' clashes with the "
1459.                     "table name of '%s'." % (m2m_db_table, clashing_obj),
1460.                     obj=self,
1461.                     hint=error_hint,
1462.                     id=error_id,
1463.                 )
1464.             ]
1465.         return []
1466. 
1467.     def deconstruct(self):
1468.         name, path, args, kwargs = super().deconstruct()
1469.         # Handle the simpler arguments.
1470.         if self.db_table is not None:
1471.             kwargs['db_table'] = self.db_table
1472.         if self.remote_field.db_constraint is not True:
1473.             kwargs['db_constraint'] = self.remote_field.db_constraint
1474.         # Rel needs more work.
1475.         if isinstance(self.remote_field.model, str):
1476.             kwargs['to'] = self.remote_field.model
1477.         else:
1478.             kwargs['to'] = "%s.%s" % (
1479.                 self.remote_field.model._meta.app_label,
1480.                 self.remote_field.model._meta.object_name,
1481.             )
1482.         if getattr(self.remote_field, 'through', None) is not None:
1483.             if isinstance(self.remote_field.through, str):
1484.                 kwargs['through'] = self.remote_field.through
1485.             elif not self.remote_field.through._meta.auto_created:
1486.                 kwargs['through'] = "%s.%s" % (
1487.                     self.remote_field.through._meta.app_label,
1488.                     self.remote_field.through._meta.object_name,
1489.                 )
1490.         # If swappable is True, then see if we're actually pointing to the target
1491.         # of a swap.
1492.         swappable_setting = self.swappable_setting
1493.         if swappable_setting is not None:
1494.             # If it's already a settings reference, error.
1495.             if hasattr(kwargs['to'], "setting_name"):
1496.                 if kwargs['to'].setting_name != swappable_setting:
1497.                     raise ValueError(
1498.                         "Cannot deconstruct a ManyToManyField pointing to a "
1499.                         "model that is swapped in place of more than one model "
1500.                         "(%s and %s)" % (kwargs['to'].setting_name, swappable_setting)
1501.                     )


File: django/db/models/manager.py
Line number range: 1 - 204
Content:
1. import copy
2. import inspect
3. from importlib import import_module
4. 
5. from django.db import router
6. from django.db.models.query import QuerySet
7. 
8. 
9. class BaseManager:
10.     # To retain order, track each time a Manager instance is created.
11.     creation_counter = 0
12. 
13.     # Set to True for the 'objects' managers that are automatically created.
14.     auto_created = False
15. 
16.     #: If set to True the manager will be serialized into migrations and will
17.     #: thus be available in e.g. RunPython operations.
18.     use_in_migrations = False
19. 
20.     def __new__(cls, *args, **kwargs):
21.         # Capture the arguments to make returning them trivial.
22.         obj = super().__new__(cls)
23.         obj._constructor_args = (args, kwargs)
24.         return obj
25. 
26.     def __init__(self):
27.         super().__init__()
28.         self._set_creation_counter()
29.         self.model = None
30.         self.name = None
31.         self._db = None
32.         self._hints = {}
33. 
34.     def __str__(self):
35.         """Return "app_label.model_label.manager_name"."""
36.         return '%s.%s' % (self.model._meta.label, self.name)
37. 
38.     def __class_getitem__(cls, *args, **kwargs):
39.         return cls
40. 
41.     def deconstruct(self):
42.         """
43.         Return a 5-tuple of the form (as_manager (True), manager_class,
44.         queryset_class, args, kwargs).
45. 
46.         Raise a ValueError if the manager is dynamically generated.
47.         """
48.         qs_class = self._queryset_class
49.         if getattr(self, '_built_with_as_manager', False):
50.             # using MyQuerySet.as_manager()
51.             return (
52.                 True,  # as_manager
53.                 None,  # manager_class
54.                 '%s.%s' % (qs_class.__module__, qs_class.__name__),  # qs_class
55.                 None,  # args
56.                 None,  # kwargs
57.             )
58.         else:
59.             module_name = self.__module__
60.             name = self.__class__.__name__
61.             # Make sure it's actually there and not an inner class
62.             module = import_module(module_name)
63.             if not hasattr(module, name):
64.                 raise ValueError(
65.                     "Could not find manager %s in %s.\n"
66.                     "Please note that you need to inherit from managers you "
67.                     "dynamically generated with 'from_queryset()'."
68.                     % (name, module_name)
69.                 )
70.             return (
71.                 False,  # as_manager
72.                 '%s.%s' % (module_name, name),  # manager_class
73.                 None,  # qs_class
74.                 self._constructor_args[0],  # args
75.                 self._constructor_args[1],  # kwargs
76.             )
77. 
78.     def check(self, **kwargs):
79.         return []
80. 
81.     @classmethod
82.     def _get_queryset_methods(cls, queryset_class):
83.         def create_method(name, method):
84.             def manager_method(self, *args, **kwargs):
85.                 return getattr(self.get_queryset(), name)(*args, **kwargs)
86.             manager_method.__name__ = method.__name__
87.             manager_method.__doc__ = method.__doc__
88.             return manager_method
89. 
90.         new_methods = {}
91.         for name, method in inspect.getmembers(queryset_class, predicate=inspect.isfunction):
92.             # Only copy missing methods.
93.             if hasattr(cls, name):
94.                 continue
95.             # Only copy public methods or methods with the attribute `queryset_only=False`.
96.             queryset_only = getattr(method, 'queryset_only', None)
97.             if queryset_only or (queryset_only is None and name.startswith('_')):
98.                 continue
99.             # Copy the method onto the manager.
100.             new_methods[name] = create_method(name, method)
101.         return new_methods
102. 
103.     @classmethod
104.     def from_queryset(cls, queryset_class, class_name=None):
105.         if class_name is None:
106.             class_name = '%sFrom%s' % (cls.__name__, queryset_class.__name__)
107.         return type(class_name, (cls,), {
108.             '_queryset_class': queryset_class,
109.             **cls._get_queryset_methods(queryset_class),
110.         })
111. 
112.     def contribute_to_class(self, model, name):
113.         self.name = self.name or name
114.         self.model = model
115. 
116.         setattr(model, name, ManagerDescriptor(self))
117. 
118.         model._meta.add_manager(self)
119. 
120.     def _set_creation_counter(self):
121.         """
122.         Set the creation counter value for this instance and increment the
123.         class-level copy.
124.         """
125.         self.creation_counter = BaseManager.creation_counter
126.         BaseManager.creation_counter += 1
127. 
128.     def db_manager(self, using=None, hints=None):
129.         obj = copy.copy(self)
130.         obj._db = using or self._db
131.         obj._hints = hints or self._hints
132.         return obj
133. 
134.     @property
135.     def db(self):
136.         return self._db or router.db_for_read(self.model, **self._hints)
137. 
138.     #######################
139.     # PROXIES TO QUERYSET #
140.     #######################
141. 
142.     def get_queryset(self):
143.         """
144.         Return a new QuerySet object. Subclasses can override this method to
145.         customize the behavior of the Manager.
146.         """
147.         return self._queryset_class(model=self.model, using=self._db, hints=self._hints)
148. 
149.     def all(self):
150.         # We can't proxy this method through the `QuerySet` like we do for the
151.         # rest of the `QuerySet` methods. This is because `QuerySet.all()`
152.         # works by creating a "copy" of the current queryset and in making said
153.         # copy, all the cached `prefetch_related` lookups are lost. See the
154.         # implementation of `RelatedManager.get_queryset()` for a better
155.         # understanding of how this comes into play.
156.         return self.get_queryset()
157. 
158.     def __eq__(self, other):
159.         return (
160.             isinstance(other, self.__class__) and
161.             self._constructor_args == other._constructor_args
162.         )
163. 
164.     def __hash__(self):
165.         return id(self)
166. 
167. 
168. class Manager(BaseManager.from_queryset(QuerySet)):
169.     pass
170. 
171. 
172. class ManagerDescriptor:
173. 
174.     def __init__(self, manager):
175.         self.manager = manager
176. 
177.     def __get__(self, instance, cls=None):
178.         if instance is not None:
179.             raise AttributeError("Manager isn't accessible via %s instances" % cls.__name__)
180. 
181.         if cls._meta.abstract:
182.             raise AttributeError("Manager isn't available; %s is abstract" % (
183.                 cls._meta.object_name,
184.             ))
185. 
186.         if cls._meta.swapped:
187.             raise AttributeError(
188.                 "Manager isn't available; '%s.%s' has been swapped for '%s'" % (
189.                     cls._meta.app_label,
190.                     cls._meta.object_name,
191.                     cls._meta.swapped,
192.                 )
193.             )
194. 
195.         return cls._meta.managers_map[self.manager.name]
196. 
197. 
198. class EmptyManager(Manager):
199.     def __init__(self, model):
200.         super().__init__()
201.         self.model = model
202. 
203.     def get_queryset(self):
204.         return super().get_queryset().none()

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-23 03:31:03,854 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='The user requested the full content of `django/db/models/base.py`. This context represents the entire file as provided.', relative_path='django/db/models/base.py', start_line=1, end_line=1502), ContextOutput(reasoning='The user requested the full content of `django/db/models/fields/related.py`. This context represents the entire file as provided.', relative_path='django/db/models/fields/related.py', start_line=1, end_line=1501), ContextOutput(reasoning='The user requested the full content of `django/db/models/manager.py`. This context represents the entire file as provided.', relative_path='django/db/models/manager.py', start_line=1, end_line=204)]
2025-12-23 03:31:03,859 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 3 contexts to memory for query: Please provide the full content of `django/db/models/fields/related.py`, `django/db/models/manager.py`, and `django/db/models/base.py`.
2025-12-23 03:31:03,859 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-23 03:31:03,859 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-23 03:31:03,860 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 3 new contexts to 0 existing contexts
2025-12-23 03:31:03,860 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 3 total contexts (removed 0 duplicates)
2025-12-23 03:31:03,861 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .github
|   ├── FUNDING.yml
|   └── SECURITY.md
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── bin
|   |   └── django-admin.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ar_DZ
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ky
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tg
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uz
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   ├── 0012_alter_user_first_name_max_length.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   ├── options.py
|   |   |   |   └── widgets.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── constraints.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── mn
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_redirect_new_path_help_text.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── templates
|   |   |   |   ├── sitemap.xml
|   |   |   |   └── sitemap_index.xml
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── asgi.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── memcached.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── async_checks.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   └── __init__.py
|   |   |   ├── database.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── asgi.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── __init__.py
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── jsonl.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   ├── special.py
|   |   |   |   └── utils.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── enums.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── json.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── asyncio.py
|   |   ├── autoreload.py
|   |   ├── baseconv.py
|   |   ├── cache.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── datetime_safe.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── topological_sort.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           ├── default_urlconf.html
|           ├── technical_404.html
|           ├── technical_500.html
|           └── technical_500.txt
├── docs
|   ├── README.rst
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   ├── genindex.html
|   |   |   ├── layout.html
|   |   |   ├── modindex.html
|   |   |   ├── search.html
|   |   |   └── static
|   |   |       ├── console-tabs.css
|   |   |       ├── default.css
|   |   |       ├── djangodocs.css
|   |   |       ├── fontawesome
|   |   |       ├── homepage.css
|   |   |       └── reset-fonts-grids.css
|   |   └── djangodocs-epub
|   |       ├── epub-cover.html
|   |       └── static
|   |           └── epub.css
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── _images
|   |   ├── auth-remote-user.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-backend.txt
|   |   ├── custom-template-tags.txt
|   |   ├── deployment
|   |   |   ├── asgi
|   |   |   |   ├── daphne.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── uvicorn.txt
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── legacy-databases.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── constraints.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── paginator.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.19.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.20.txt
|   |   ├── 1.11.21.txt
|   |   ├── 1.11.22.txt
|   |   ├── 1.11.23.txt
|   |   ├── 1.11.24.txt
|   |   ├── 1.11.25.txt
|   |   ├── 1.11.26.txt
|   |   ├── 1.11.27.txt
|   |   ├── 1.11.28.txt
|   |   ├── 1.11.29.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.11.txt
|   |   ├── 2.0.12.txt
|   |   ├── 2.0.13.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.10.txt
|   |   ├── 2.1.11.txt
|   |   ├── 2.1.12.txt
|   |   ├── 2.1.13.txt
|   |   ├── 2.1.14.txt
|   |   ├── 2.1.15.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.7.txt
|   |   ├── 2.1.8.txt
|   |   ├── 2.1.9.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.1.txt
|   |   ├── 2.2.10.txt
|   |   ├── 2.2.11.txt
|   |   ├── 2.2.12.txt
|   |   ├── 2.2.13.txt
|   |   ├── 2.2.14.txt
|   |   ├── 2.2.2.txt
|   |   ├── 2.2.3.txt
|   |   ├── 2.2.4.txt
|   |   ├── 2.2.5.txt
|   |   ├── 2.2.6.txt
|   |   ├── 2.2.7.txt
|   |   ├── 2.2.8.txt
|   |   ├── 2.2.9.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.1.txt
|   |   ├── 3.0.2.txt
|   |   ├── 3.0.3.txt
|   |   ├── 3.0.4.txt
|   |   ├── 3.0.5.txt
|   |   ├── 3.0.6.txt
|   |   ├── 3.0.7.txt
|   |   ├── 3.0.8.txt
|   |   ├── 3.0.txt
|   |   ├── 3.1.txt
|   |   ├── 3.2.txt
|   |   ├── index.txt
|   |   └── security.txt
|   └── topics
|       ├── async.txt
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   └── jsi18n-mocks.test.js
|   ├── gis
|   |   └── mapwidget.test.js
|   └── tests.html
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_dynamic_settings_manage.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       └── noargs_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── test_django_admin_py.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── admin
    |   |   |   ├── admin_views
    |   |   |   └── base_site.html
    |   |   └── custom_filter_template.html
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_forms.py
    |   ├── test_history_view.py
    |   ├── test_multidb.py
    |   ├── test_nav_sidebar.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── default_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   └── tests.py
    ├── asgi
    |   ├── __init__.py
    |   ├── project
    |   |   └── static
    |   |       └── file.txt
    |   ├── tests.py
    |   └── urls.py
    ├── async
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   ├── with_last_login_attr.py
    |   |   └── with_many_to_many.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   |   ├── auth_attrs_access.html
    |   |   |   ├── auth_attrs_messages.html
    |   |   |   ├── auth_attrs_no_access.html
    |   |   |   ├── auth_attrs_perm_in_perms.html
    |   |   |   ├── auth_attrs_perms.html
    |   |   |   ├── auth_attrs_test_access.html
    |   |   |   └── auth_attrs_user.html
    |   |   └── registration
    |   |       ├── html_password_reset_email.html
    |   |       ├── logged_out.html
    |   |       ├── login.html
    |   |       ├── password_change_form.html
    |   |       ├── password_reset_complete.html
    |   |       ├── password_reset_confirm.html
    |   |       ├── password_reset_done.html
    |   |       ├── password_reset_email.html
    |   |       ├── password_reset_form.html
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_password_reset_timeout_days.py
    |   ├── test_remote_user.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── test_base.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   └── tests.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_async_checks.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_error_handlers.py
    |       ├── bad_error_handlers_invalid_path.py
    |       ├── beginning_with_slash.py
    |       ├── contains_tuple.py
    |       ├── good_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   └── ending_with_dollar.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   |       ├── debug.html
    |   |       └── request_attrs.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_greatest.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_round.py
    |   |   ├── test_sign.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_md5.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_sha1.py
    |   |   ├── test_sha224.py
    |   |   ├── test_sha256.py
    |   |   ├── test_sha384.py
    |   |   ├── test_sha512.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   ├── test_postgresql.py
    |   ├── test_sqlite.py
    |   └── tests.py
    ├── decorators
    |   ├── __init__.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   ├── test_middleware_mixin.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── empty_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── test_commands.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_deprecation.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── fixture2.xml
    |   |   ├── fixture3.xml
    |   |   ├── fixture7.xml
    |   |   └── fixture9.xml
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── animal.xml
    |   |   ├── bad_fixture2.xml
    |   |   ├── nk-inheritance2.xml
    |   |   ├── non_natural_2.xml
    |   |   ├── pretty.xml
    |   |   └── sequence_extra_xml.xml
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── absolute_urls.py
    |   ├── no_slash_urls.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   |   └── default.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_jsonfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   |       └── custom_widget.html
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   |       ├── article_form.html
    |   |       └── custom_widget.html
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   |       └── using.html
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   ├── about.html
    |   |   |   ├── apple_detail.html
    |   |   |   ├── artist_detail.html
    |   |   |   ├── artist_form.html
    |   |   |   ├── author_confirm_delete.html
    |   |   |   ├── author_detail.html
    |   |   |   ├── author_form.html
    |   |   |   ├── author_list.html
    |   |   |   ├── author_objects.html
    |   |   |   ├── author_view.html
    |   |   |   ├── book_archive.html
    |   |   |   ├── book_archive_day.html
    |   |   |   ├── book_archive_month.html
    |   |   |   ├── book_archive_week.html
    |   |   |   ├── book_archive_year.html
    |   |   |   ├── book_detail.html
    |   |   |   ├── book_list.html
    |   |   |   ├── confirm_delete.html
    |   |   |   ├── detail.html
    |   |   |   ├── form.html
    |   |   |   ├── list.html
    |   |   |   ├── page_template.html
    |   |   |   ├── robots.txt
    |   |   |   └── using.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── has_nulls
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   ├── test_srs.py
    |   |   └── tests.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── admin.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_indexes.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_create_models.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── maps
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_rastermodels.py
    |   |   |   └── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   |   └── test_handler.html
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   |   └── ignored.html
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   |   └── media_ignored.html
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   ├── javascript_ignored.js
    |   |   |   └── static_ignored.html
    |   |   └── templates
    |   |       ├── empty.html
    |   |       ├── subdir
    |   |       ├── test.html
    |   |       └── xxx_ignored.html
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── loading
    |   |   ├── en
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_AU
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_CA
    |   |   |   └── LC_MESSAGES
    |   |   └── en_NZ
    |   |       └── LC_MESSAGES
    |   ├── loading_app
    |   |   ├── __init__.py
    |   |   ├── apps.py
    |   |   └── locale
    |   |       └── en
    |   ├── models.py
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   |   ├── 404.html
    |   |   |   └── dummy.html
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   |   └── percents.html
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   ├── tests.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_fake_initial_case_insensitive
    |   |   ├── fake_initial
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── initial
    |   |       ├── 0001_initial.py
    |   |       └── __init__.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_namespace_package
    |   |   └── 0001_initial.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_no_operations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   ├── 0005_fifth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_enums
    |   ├── __init__.py
    |   └── tests.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autofield.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_filepathfield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_jsonfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── integration_settings.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_constraints.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_integration.py
    |   ├── test_introspection.py
    |   ├── test_json_deprecation.py
    |   ├── test_operations.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_db_returning.py
    |   ├── test_deprecation.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests
    |   ├── __init__.py
    |   ├── test_accept_header.py
    |   ├── test_data_upload_settings.py
    |   ├── test_is_ajax_deprecations.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_jsonl.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   |       └── using.html
    |   ├── templates
    |   |   └── shortcuts
    |   |       ├── render_test.html
    |   |       └── using.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_deprecation.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── custom_sitemap.xml
    |   |   └── custom_sitemap_index.xml
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   ├── test_management.py
    |   ├── test_utils.py
    |   └── urls
    |       ├── __init__.py
    |       ├── empty.py
    |       ├── http.py
    |       ├── https.py
    |       └── index_only.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── absolute_root.css
    |   |   |   ├── cached
    |   |   |   ├── styles_root.css
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   |   └── faulty.css
    |   |   ├── loop
    |   |   |   ├── bar.css
    |   |   |   └── foo.css
    |   |   ├── pathlib
    |   |   |   └── pathlib.txt
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   |       ├── description.html
    |   |       ├── description_context.html
    |   |       ├── title.html
    |   |       └── title_context.html
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   |       └── hello.html
    |   ├── jinja2
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       ├── syntax_error.html
    |   |       ├── syntax_error2.html
    |   |       └── syntax_error_include.html
    |   ├── template_strings
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       └── syntax_error.html
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_loader
    |   |       ├── goodbye.html
    |   |       ├── hello.html
    |   |       └── request.html
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   |       └── using.html
    |   ├── other_templates
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   └── test_dirs.html
    |   ├── recursive_templates
    |   |   ├── fs
    |   |   |   ├── extend-missing.html
    |   |   |   ├── one.html
    |   |   |   ├── other-recursive.html
    |   |   |   ├── recursive.html
    |   |   |   ├── self.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── fs2
    |   |   |   └── recursive.html
    |   |   └── fs3
    |   |       └── recursive.html
    |   ├── relative_templates
    |   |   ├── dir1
    |   |   |   ├── dir2
    |   |   |   ├── looped.html
    |   |   |   ├── one.html
    |   |   |   ├── one1.html
    |   |   |   ├── one2.html
    |   |   |   ├── one3.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── error_extends.html
    |   |   ├── error_include.html
    |   |   ├── one.html
    |   |   ├── three.html
    |   |   └── two.html
    |   ├── syntax_tests
    |   |   ├── __init__.py
    |   |   ├── i18n
    |   |   |   ├── __init__.py
    |   |   |   ├── base.py
    |   |   |   ├── test_blocktranslate.py
    |   |   |   ├── test_filters.py
    |   |   |   ├── test_get_available_languages.py
    |   |   |   ├── test_get_current_language.py
    |   |   |   ├── test_get_current_language_bidi.py
    |   |   |   ├── test_get_language_info.py
    |   |   |   ├── test_get_language_info_list.py
    |   |   |   ├── test_language.py
    |   |   |   ├── test_translate.py
    |   |   |   └── test_underscore_syntax.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_basic.py
    |   |   ├── test_builtins.py
    |   |   ├── test_cache.py
    |   |   ├── test_comment.py
    |   |   ├── test_cycle.py
    |   |   ├── test_exceptions.py
    |   |   ├── test_extends.py
    |   |   ├── test_filter_syntax.py
    |   |   ├── test_filter_tag.py
    |   |   ├── test_firstof.py
    |   |   ├── test_for.py
    |   |   ├── test_if.py
    |   |   ├── test_if_changed.py
    |   |   ├── test_if_equal.py
    |   |   ├── test_include.py
    |   |   ├── test_invalid_string.py
    |   |   ├── test_list_index.py
    |   |   ├── test_load.py
    |   |   ├── test_lorem.py
    |   |   ├── test_multiline.py
    |   |   ├── test_named_endblock.py
    |   |   ├── test_now.py
    |   |   ├── test_numpy.py
    |   |   ├── test_regroup.py
    |   |   ├── test_resetcycle.py
    |   |   ├── test_setup.py
    |   |   ├── test_simple_tag.py
    |   |   ├── test_spaceless.py
    |   |   ├── test_static.py
    |   |   ├── test_template_tag.py
    |   |   ├── test_url.py
    |   |   ├── test_verbatim.py
    |   |   ├── test_width_ratio.py
    |   |   └── test_with.py
    |   ├── templates
    |   |   ├── 27584_child.html
    |   |   ├── 27584_parent.html
    |   |   ├── 27956_child.html
    |   |   ├── 27956_parent.html
    |   |   ├── broken_base.html
    |   |   ├── first
    |   |   |   └── test.html
    |   |   ├── include_tpl.html
    |   |   ├── included_base.html
    |   |   ├── included_content.html
    |   |   ├── inclusion.html
    |   |   ├── inclusion_base.html
    |   |   ├── inclusion_extends1.html
    |   |   ├── inclusion_extends2.html
    |   |   ├── index.html
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   ├── recursive_include.html
    |   |   ├── response.html
    |   |   ├── second
    |   |   |   └── test.html
    |   |   ├── ssi include with spaces.html
    |   |   ├── ssi_include.html
    |   |   ├── template_tests
    |   |   |   └── using.html
    |   |   ├── test_context.html
    |   |   ├── test_context_stack.html
    |   |   ├── test_extends_error.html
    |   |   ├── test_incl_tag_use_l10n.html
    |   |   └── test_include_error.html
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   ├── bad_tag.py
    |   |   ├── custom.py
    |   |   ├── inclusion.py
    |   |   ├── subpackage
    |   |   |   ├── __init__.py
    |   |   |   └── echo.py
    |   |   ├── tag_27584.py
    |   |   └── testtags.py
    |   ├── test_base.py
    |   ├── test_callables.py
    |   ├── test_context.py
    |   ├── test_custom.py
    |   ├── test_engine.py
    |   ├── test_extends.py
    |   ├── test_extends_relative.py
    |   ├── test_library.py
    |   ├── test_loaders.py
    |   ├── test_logging.py
    |   ├── test_nodelist.py
    |   ├── test_origin.py
    |   ├── test_parser.py
    |   ├── test_response.py
    |   ├── test_smartif.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── utils.py
    |   └── views.py
    ├── templates
    |   ├── base.html
    |   ├── comments
    |   |   └── comment_notification_email.txt
    |   ├── custom_admin
    |   |   ├── add_form.html
    |   |   ├── app_index.html
    |   |   ├── change_form.html
    |   |   ├── change_list.html
    |   |   ├── delete_confirmation.html
    |   |   ├── delete_selected_confirmation.html
    |   |   ├── index.html
    |   |   ├── login.html
    |   |   ├── logout.html
    |   |   ├── object_history.html
    |   |   ├── password_change_done.html
    |   |   ├── password_change_form.html
    |   |   └── popup_response.html
    |   ├── extended.html
    |   ├── form_view.html
    |   ├── login.html
    |   └── views
    |       ├── article_archive_day.html
    |       ├── article_archive_month.html
    |       ├── article_confirm_delete.html
    |       ├── article_detail.html
    |       ├── article_form.html
    |       ├── article_list.html
    |       ├── datearticle_archive_month.html
    |       ├── urlarticle_detail.html
    |       └── urlarticle_form.html
    ├── test_client
    |   ├── __init__.py
    |   ├── auth_backends.py
    |   ├── test_conditional_content_removal.py
    |   ├── test_fakepayload.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── test_client_regress
    |   ├── __init__.py
    |   ├── auth_backends.py
    |   ├── bad_templates
    |   |   └── 404.html
    |   ├── context_processors.py
    |   ├── models.py
    |   ├── session.py
    |   ├── templates
    |   |   ├── request_context.html
    |   |   └── unicode.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── test_exceptions
    |   ├── __init__.py
    |   └── test_validation_error.py
    ├── test_runner
    |   ├── __init__.py
    |   ├── models.py
    |   ├── runner.py
    |   ├── test_debug_sql.py
    |   ├── test_discover_runner.py
    |   ├── test_parallel.py
    |   └── tests.py
    ├── test_runner_apps
    |   ├── __init__.py
    |   ├── buffer
    |   |   └── tests_buffer.py
    |   ├── databases
    |   |   ├── __init__.py
    |   |   └── tests.py
    |   ├── sample
    |   |   ├── __init__.py
    |   |   ├── doctests.py
    |   |   ├── empty.py
    |   |   ├── pattern_tests.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── tests.py
    |   |   └── tests_sample.py
    |   ├── simple
    |   |   ├── __init__.py
    |   |   └── tests.py
    |   └── tagged
    |       ├── __init__.py
    |       ├── tests.py
    |       └── tests_inheritance.py
    ├── test_sqlite.py
    ├── test_utils
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── templates
    |   |   └── template_used
    |   |       ├── alternative.html
    |   |       ├── base.html
    |   |       ├── extends.html
    |   |       └── include.html
    |   ├── test_simpletestcase.py
    |   ├── test_testcase.py
    |   ├── test_transactiontestcase.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── timezones
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── transaction_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── transactions
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── unmanaged_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── update_only_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── urlpatterns
    |   ├── __init__.py
    |   ├── converter_urls.py
    |   ├── converters.py
    |   ├── included_urls.py
    |   ├── more_urls.py
    |   ├── path_base64_urls.py
    |   ├── path_dynamic_urls.py
    |   ├── path_same_name_urls.py
    |   ├── path_urls.py
    |   ├── test_resolvers.py
    |   ├── tests.py
    |   └── views.py
    ├── urlpatterns_reverse
    |   ├── __init__.py
    |   ├── erroneous_urls.py
    |   ├── extra_urls.py
    |   ├── included_app_urls.py
    |   ├── included_named_urls.py
    |   ├── included_named_urls2.py
    |   ├── included_namespace_urls.py
    |   ├── included_no_kwargs_urls.py
    |   ├── included_urls.py
    |   ├── included_urls2.py
    |   ├── method_view_urls.py
    |   ├── middleware.py
    |   ├── named_urls.py
    |   ├── named_urls_conflict.py
    |   ├── namespace_urls.py
    |   ├── nested_urls.py
    |   ├── no_urls.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: ForeignKey.validate() should validate using the base manager.

Description: Description
	
ForeignKey.validate() should validate using the base manager instead of the default manager.
Consider the models:
class ArticleManager(models.Manage):
	def get_queryset(self):
		qs = super().get_queryset()
		return qs.filter(archived=False)
class Article(models.Model):
	title = models.CharField(max_length=100)
	archived = models.BooleanField(default=False)
	# Don't include archived articles by default.
	objects = ArticleManager()
class FavoriteAricles(models.Model):
	article = models.ForeignKey(Article, on_delete=models.CASCADE)
In the example, now consider a form that allows users to pick a favorite article including archived articles.
class FavoriteAriclesForm(forms.ModelForm):
	class Meta:
		model = FavoriteArticle
		fields = '__all__'
	def __init__(self, *args, **kwargs):
		super().__init__(*args, **kwargs)
		# Use the base manager instead of the default manager to allow archived articles.
		self.fields['article'].queryset = Article._base_manager.all()
The above form will never validate as True when a user selects an archived article. This is because the ForeignKey validation always uses _default_manager instead of _base_manager. The user facing error message is "article instance with id 123 does not exist." (quite confusing to typical users). The code for this validation is here:
​https://github.com/django/django/blob/94f63b926fd32d7a7b6e2591ef72aa8f040f25cc/django/db/models/fields/related.py#L917-L919
The FavoriteAriclesForm is specifically designed to use a different manager, but the ForeignKey validation makes this difficult.
In this example scenario, it is not acceptable to change the model's default manager as the default should avoid archived articles in other typical scenarios.
Suggested solution: the ForeignKey validation should use the _base_manager instead which does not include the default filters.

Patch information:
diff --git a/django/db/models/fields/related.py b/django/db/models/fields/related.py
index d517d7269b..c2aea9c730 100644
--- a/django/db/models/fields/related.py
+++ b/django/db/models/fields/related.py
@@ -914,7 +914,7 @@ class ForeignKey(ForeignObject):
             return
 
         using = router.db_for_read(self.remote_field.model, instance=model_instance)
-        qs = self.remote_field.model._default_manager.using(using).filter(
+        qs = self.remote_field.model._base_manager.using(using).filter(
             **{self.remote_field.field_name: value}
         )
         qs = qs.complex_filter(self.get_limit_choices_to())


Find all relevant source code context needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `django/db/models/fields/related.py`, `django/db/models/manager.py`, and `django/db/models/base.py`.
Extra Requirements: 
Purpose: These files will provide the necessary context on `ForeignKey` validation and model managers to understand and verify the proposed fix.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: django/db/models/base.py
Line number range: 1 - 1502
Content:
1. import copy
2. import inspect
3. import warnings
4. from functools import partialmethod
5. from itertools import chain
6. 
7. import django
8. from django.apps import apps
9. from django.conf import settings
10. from django.core import checks
11. from django.core.exceptions import (
12.     NON_FIELD_ERRORS, FieldDoesNotExist, FieldError, MultipleObjectsReturned,
13.     ObjectDoesNotExist, ValidationError,
14. )
15. from django.db import (
16.     DEFAULT_DB_ALIAS, DJANGO_VERSION_PICKLE_KEY, DatabaseError, connection,
17.     connections, router, transaction,
18. )
19. from django.db.models import (
20.     NOT_PROVIDED, ExpressionWrapper, IntegerField, Max, Value,
21. )
22. from django.db.models.constants import LOOKUP_SEP
23. from django.db.models.constraints import CheckConstraint, UniqueConstraint
24. from django.db.models.deletion import CASCADE, Collector
25. from django.db.models.fields.related import (
26.     ForeignObjectRel, OneToOneField, lazy_related_operation, resolve_relation,
27. )
28. from django.db.models.functions import Coalesce
29. from django.db.models.manager import Manager
30. from django.db.models.options import Options
31. from django.db.models.query import Q
32. from django.db.models.signals import (
33.     class_prepared, post_init, post_save, pre_init, pre_save,
34. )
35. from django.db.models.utils import make_model_tuple
36. from django.utils.encoding import force_str
37. from django.utils.hashable import make_hashable
38. from django.utils.text import capfirst, get_text_list
39. from django.utils.translation import gettext_lazy as _
40. 
41. 
42. class Deferred:
43.     def __repr__(self):
44.         return '<Deferred field>'
45. 
46.     def __str__(self):
47.         return '<Deferred field>'
48. 
49. 
50. DEFERRED = Deferred()
51. 
52. 
53. def subclass_exception(name, bases, module, attached_to):
54.     """
55.     Create exception subclass. Used by ModelBase below.
56. 
57.     The exception is created in a way that allows it to be pickled, assuming
58.     that the returned exception class will be added as an attribute to the
59.     'attached_to' class.
60.     """
61.     return type(name, bases, {
62.         '__module__': module,
63.         '__qualname__': '%s.%s' % (attached_to.__qualname__, name),
64.     })
65. 
66. 
67. def _has_contribute_to_class(value):
68.     # Only call contribute_to_class() if it's bound.
69.     return not inspect.isclass(value) and hasattr(value, 'contribute_to_class')
70. 
71. 
72. class ModelBase(type):
73.     """Metaclass for all models."""
74.     def __new__(cls, name, bases, attrs, **kwargs):
75.         super_new = super().__new__
76. 
77.         # Also ensure initialization is only performed for subclasses of Model
78.         # (excluding Model class itself).
79.         parents = [b for b in bases if isinstance(b, ModelBase)]
80.         if not parents:
81.             return super_new(cls, name, bases, attrs)
82. 
83.         # Create the class.
84.         module = attrs.pop('__module__')
85.         new_attrs = {'__module__': module}
86.         classcell = attrs.pop('__classcell__', None)
87.         if classcell is not None:
88.             new_attrs['__classcell__'] = classcell
89.         attr_meta = attrs.pop('Meta', None)
90.         # Pass all attrs without a (Django-specific) contribute_to_class()
91.         # method to type.__new__() so that they're properly initialized
92.         # (i.e. __set_name__()).
93.         contributable_attrs = {}
94.         for obj_name, obj in attrs.items():
95.             if _has_contribute_to_class(obj):
96.                 contributable_attrs[obj_name] = obj
97.             else:
98.                 new_attrs[obj_name] = obj
99.         new_class = super_new(cls, name, bases, new_attrs, **kwargs)
100. 
101.         abstract = getattr(attr_meta, 'abstract', False)
102.         meta = attr_meta or getattr(new_class, 'Meta', None)
103.         base_meta = getattr(new_class, '_meta', None)
104. 
105.         app_label = None
106. 
107.         # Look for an application configuration to attach the model to.
108.         app_config = apps.get_containing_app_config(module)
109. 
110.         if getattr(meta, 'app_label', None) is None:
111.             if app_config is None:
112.                 if not abstract:
113.                     raise RuntimeError(
114.                         "Model class %s.%s doesn't declare an explicit "
115.                         "app_label and isn't in an application in "
116.                         "INSTALLED_APPS." % (module, name)
117.                     )
118. 
119.             else:
120.                 app_label = app_config.label
121. 
122.         new_class.add_to_class('_meta', Options(meta, app_label))
123.         if not abstract:
124.             new_class.add_to_class(
125.                 'DoesNotExist',
126.                 subclass_exception(
127.                     'DoesNotExist',
128.                     tuple(
129.                         x.DoesNotExist for x in parents if hasattr(x, '_meta') and not x._meta.abstract
130.                     ) or (ObjectDoesNotExist,),
131.                     module,
132.                     attached_to=new_class))
133.             new_class.add_to_class(
134.                 'MultipleObjectsReturned',
135.                 subclass_exception(
136.                     'MultipleObjectsReturned',
137.                     tuple(
138.                         x.MultipleObjectsReturned for x in parents if hasattr(x, '_meta') and not x._meta.abstract
139.                     ) or (MultipleObjectsReturned,),
140.                     module,
141.                     attached_to=new_class))
142.             if base_meta and not base_meta.abstract:
143.                 # Non-abstract child classes inherit some attributes from their
144.                 # non-abstract parent (unless an ABC comes before it in the
145.                 # method resolution order).
146.                 if not hasattr(meta, 'ordering'):
147.                     new_class._meta.ordering = base_meta.ordering
148.                 if not hasattr(meta, 'get_latest_by'):
149.                     new_class._meta.get_latest_by = base_meta.get_latest_by
150. 
151.         is_proxy = new_class._meta.proxy
152. 
153.         # If the model is a proxy, ensure that the base class
154.         # hasn't been swapped out.
155.         if is_proxy and base_meta and base_meta.swapped:
156.             raise TypeError("%s cannot proxy the swapped model '%s'." % (name, base_meta.swapped))
157. 
158.         # Add remaining attributes (those with a contribute_to_class() method)
159.         # to the class.
160.         for obj_name, obj in contributable_attrs.items():
161.             new_class.add_to_class(obj_name, obj)
162. 
163.         # All the fields of any type declared on this model
164.         new_fields = chain(
165.             new_class._meta.local_fields,
166.             new_class._meta.local_many_to_many,
167.             new_class._meta.private_fields
168.         )
169.         field_names = {f.name for f in new_fields}
170. 
171.         # Basic setup for proxy models.
172.         if is_proxy:
173.             base = None
174.             for parent in [kls for kls in parents if hasattr(kls, '_meta')]:
175.                 if parent._meta.abstract:
176.                     if parent._meta.fields:
177.                         raise TypeError(
178.                             "Abstract base class containing model fields not "
179.                             "permitted for proxy model '%s'." % name
180.                         )
181.                     else:
182.                         continue
183.                 if base is None:
184.                     base = parent
185.                 elif parent._meta.concrete_model is not base._meta.concrete_model:
186.                     raise TypeError("Proxy model '%s' has more than one non-abstract model base class." % name)
187.             if base is None:
188.                 raise TypeError("Proxy model '%s' has no non-abstract model base class." % name)
189.             new_class._meta.setup_proxy(base)
190.             new_class._meta.concrete_model = base._meta.concrete_model
191.         else:
192.             new_class._meta.concrete_model = new_class
193. 
194.         # Collect the parent links for multi-table inheritance.
195.         parent_links = {}
196.         for base in reversed([new_class] + parents):
197.             # Conceptually equivalent to `if base is Model`.
198.             if not hasattr(base, '_meta'):
199.                 continue
200.             # Skip concrete parent classes.
201.             if base != new_class and not base._meta.abstract:
202.                 continue
203.             # Locate OneToOneField instances.
204.             for field in base._meta.local_fields:
205.                 if isinstance(field, OneToOneField) and field.remote_field.parent_link:
206.                     related = resolve_relation(new_class, field.remote_field.model)
207.                     parent_links[make_model_tuple(related)] = field
208. 
209.         # Track fields inherited from base models.
210.         inherited_attributes = set()
211.         # Do the appropriate setup for any model parents.
212.         for base in new_class.mro():
213.             if base not in parents or not hasattr(base, '_meta'):
214.                 # Things without _meta aren't functional models, so they're
215.                 # uninteresting parents.
216.                 inherited_attributes.update(base.__dict__)
217.                 continue
218. 
219.             parent_fields = base._meta.local_fields + base._meta.local_many_to_many
220.             if not base._meta.abstract:
221.                 # Check for clashes between locally declared fields and those
222.                 # on the base classes.
223.                 for field in parent_fields:
224.                     if field.name in field_names:
225.                         raise FieldError(
226.                             'Local field %r in class %r clashes with field of '
227.                             'the same name from base class %r.' % (
228.                                 field.name,
229.                                 name,
230.                                 base.__name__,
231.                             )
232.                         )
233.                     else:
234.                         inherited_attributes.add(field.name)
235. 
236.                 # Concrete classes...
237.                 base = base._meta.concrete_model
238.                 base_key = make_model_tuple(base)
239.                 if base_key in parent_links:
240.                     field = parent_links[base_key]
241.                 elif not is_proxy:
242.                     attr_name = '%s_ptr' % base._meta.model_name
243.                     field = OneToOneField(
244.                         base,
245.                         on_delete=CASCADE,
246.                         name=attr_name,
247.                         auto_created=True,
248.                         parent_link=True,
249.                     )
250. 
251.                     if attr_name in field_names:
252.                         raise FieldError(
253.                             "Auto-generated field '%s' in class %r for "
254.                             "parent_link to base class %r clashes with "
255.                             "declared field of the same name." % (
256.                                 attr_name,
257.                                 name,
258.                                 base.__name__,
259.                             )
260.                         )
261. 
262.                     # Only add the ptr field if it's not already present;
263.                     # e.g. migrations will already have it specified
264.                     if not hasattr(new_class, attr_name):
265.                         new_class.add_to_class(attr_name, field)
266.                 else:
267.                     field = None
268.                 new_class._meta.parents[base] = field
269.             else:
270.                 base_parents = base._meta.parents.copy()
271. 
272.                 # Add fields from abstract base class if it wasn't overridden.
273.                 for field in parent_fields:
274.                     if (field.name not in field_names and
275.                             field.name not in new_class.__dict__ and
276.                             field.name not in inherited_attributes):
277.                         new_field = copy.deepcopy(field)
278.                         new_class.add_to_class(field.name, new_field)
279.                         # Replace parent links defined on this base by the new
280.                         # field. It will be appropriately resolved if required.
281.                         if field.one_to_one:
282.                             for parent, parent_link in base_parents.items():
283.                                 if field == parent_link:
284.                                     base_parents[parent] = new_field
285. 
286.                 # Pass any non-abstract parent classes onto child.
287.                 new_class._meta.parents.update(base_parents)
288. 
289.             # Inherit private fields (like GenericForeignKey) from the parent
290.             # class
291.             for field in base._meta.private_fields:
292.                 if field.name in field_names:
293.                     if not base._meta.abstract:
294.                         raise FieldError(
295.                             'Local field %r in class %r clashes with field of '
296.                             'the same name from base class %r.' % (
297.                                 field.name,
298.                                 name,
299.                                 base.__name__,
300.                             )
301.                         )
302.                 else:
303.                     field = copy.deepcopy(field)
304.                     if not base._meta.abstract:
305.                         field.mti_inherited = True
306.                     new_class.add_to_class(field.name, field)
307. 
308.         # Copy indexes so that index names are unique when models extend an
309.         # abstract model.
310.         new_class._meta.indexes = [copy.deepcopy(idx) for idx in new_class._meta.indexes]
311. 
312.         if abstract:
313.             # Abstract base models can't be instantiated and don't appear in
314.             # the list of models for an app. We do the final setup for them a
315.             # little differently from normal models.
316.             attr_meta.abstract = False
317.             new_class.Meta = attr_meta
318.             return new_class
319. 
320.         new_class._prepare()
321.         new_class._meta.apps.register_model(new_class._meta.app_label, new_class)
322.         return new_class
323. 
324.     def add_to_class(cls, name, value):
325.         if _has_contribute_to_class(value):
326.             value.contribute_to_class(cls, name)
327.         else:
328.             setattr(cls, name, value)
329. 
330.     def _prepare(cls):
331.         """Create some methods once self._meta has been populated."""
332.         opts = cls._meta
333.         opts._prepare(cls)
334. 
335.         if opts.order_with_respect_to:
336.             cls.get_next_in_order = partialmethod(cls._get_next_or_previous_in_order, is_next=True)
337.             cls.get_previous_in_order = partialmethod(cls._get_next_or_previous_in_order, is_next=False)
338. 
339.             # Defer creating accessors on the foreign class until it has been
340.             # created and registered. If remote_field is None, we're ordering
341.             # with respect to a GenericForeignKey and don't know what the
342.             # foreign class is - we'll add those accessors later in
343.             # contribute_to_class().
344.             if opts.order_with_respect_to.remote_field:
345.                 wrt = opts.order_with_respect_to
346.                 remote = wrt.remote_field.model
347.                 lazy_related_operation(make_foreign_order_accessors, cls, remote)
348. 
349.         # Give the class a docstring -- its definition.
350.         if cls.__doc__ is None:
351.             cls.__doc__ = "%s(%s)" % (cls.__name__, ", ".join(f.name for f in opts.fields))
352. 
353.         get_absolute_url_override = settings.ABSOLUTE_URL_OVERRIDES.get(opts.label_lower)
354.         if get_absolute_url_override:
355.             setattr(cls, 'get_absolute_url', get_absolute_url_override)
356. 
357.         if not opts.managers:
358.             if any(f.name == 'objects' for f in opts.fields):
359.                 raise ValueError(
360.                     "Model %s must specify a custom Manager, because it has a "
361.                     "field named 'objects'." % cls.__name__
362.                 )
363.             manager = Manager()
364.             manager.auto_created = True
365.             cls.add_to_class('objects', manager)
366. 
367.         # Set the name of _meta.indexes. This can't be done in
368.         # Options.contribute_to_class() because fields haven't been added to
369.         # the model at that point.
370.         for index in cls._meta.indexes:
371.             if not index.name:
372.                 index.set_name_with_model(cls)
373. 
374.         class_prepared.send(sender=cls)
375. 
376.     @property
377.     def _base_manager(cls):
378.         return cls._meta.base_manager
379. 
380.     @property
381.     def _default_manager(cls):
382.         return cls._meta.default_manager
383. 
384. 
385. class ModelStateFieldsCacheDescriptor:
386.     def __get__(self, instance, cls=None):
387.         if instance is None:
388.             return self
389.         res = instance.fields_cache = {}
390.         return res
391. 
392. 
393. class ModelState:
394.     """Store model instance state."""
395.     db = None
396.     # If true, uniqueness validation checks will consider this a new, unsaved
397.     # object. Necessary for correct validation of new instances of objects with
398.     # explicit (non-auto) PKs. This impacts validation only; it has no effect
399.     # on the actual save.
400.     adding = True
401.     fields_cache = ModelStateFieldsCacheDescriptor()
402. 
403. 
404. class Model(metaclass=ModelBase):
405. 
406.     def __init__(self, *args, **kwargs):
407.         # Alias some things as locals to avoid repeat global lookups
408.         cls = self.__class__
409.         opts = self._meta
410.         _setattr = setattr
411.         _DEFERRED = DEFERRED
412. 
413.         pre_init.send(sender=cls, args=args, kwargs=kwargs)
414. 
415.         # Set up the storage for instance state
416.         self._state = ModelState()
417. 
418.         # There is a rather weird disparity here; if kwargs, it's set, then args
419.         # overrides it. It should be one or the other; don't duplicate the work
420.         # The reason for the kwargs check is that standard iterator passes in by
421.         # args, and instantiation for iteration is 33% faster.
422.         if len(args) > len(opts.concrete_fields):
423.             # Daft, but matches old exception sans the err msg.
424.             raise IndexError("Number of args exceeds number of fields")
425. 
426.         if not kwargs:
427.             fields_iter = iter(opts.concrete_fields)
428.             # The ordering of the zip calls matter - zip throws StopIteration
429.             # when an iter throws it. So if the first iter throws it, the second
430.             # is *not* consumed. We rely on this, so don't change the order
431.             # without changing the logic.
432.             for val, field in zip(args, fields_iter):
433.                 if val is _DEFERRED:
434.                     continue
435.                 _setattr(self, field.attname, val)
436.         else:
437.             # Slower, kwargs-ready version.
438.             fields_iter = iter(opts.fields)
439.             for val, field in zip(args, fields_iter):
440.                 if val is _DEFERRED:
441.                     continue
442.                 _setattr(self, field.attname, val)
443.                 kwargs.pop(field.name, None)
444. 
445.         # Now we're left with the unprocessed fields that *must* come from
446.         # keywords, or default.
447. 
448.         for field in fields_iter:
449.             is_related_object = False
450.             # Virtual field
451.             if field.attname not in kwargs and field.column is None:
452.                 continue
453.             if kwargs:
454.                 if isinstance(field.remote_field, ForeignObjectRel):
455.                     try:
456.                         # Assume object instance was passed in.
457.                         rel_obj = kwargs.pop(field.name)
458.                         is_related_object = True
459.                     except KeyError:
460.                         try:
461.                             # Object instance wasn't passed in -- must be an ID.
462.                             val = kwargs.pop(field.attname)
463.                         except KeyError:
464.                             val = field.get_default()
465.                 else:
466.                     try:
467.                         val = kwargs.pop(field.attname)
468.                     except KeyError:
469.                         # This is done with an exception rather than the
470.                         # default argument on pop because we don't want
471.                         # get_default() to be evaluated, and then not used.
472.                         # Refs #12057.
473.                         val = field.get_default()
474.             else:
475.                 val = field.get_default()
476. 
477.             if is_related_object:
478.                 # If we are passed a related instance, set it using the
479.                 # field.name instead of field.attname (e.g. "user" instead of
480.                 # "user_id") so that the object gets properly cached (and type
481.                 # checked) by the RelatedObjectDescriptor.
482.                 if rel_obj is not _DEFERRED:
483.                     _setattr(self, field.name, rel_obj)
484.             else:
485.                 if val is not _DEFERRED:
486.                     _setattr(self, field.attname, val)
487. 
488.         if kwargs:
489.             property_names = opts._property_names
490.             for prop in tuple(kwargs):
491.                 try:
492.                     # Any remaining kwargs must correspond to properties or
493.                     # virtual fields.
494.                     if prop in property_names or opts.get_field(prop):
495.                         if kwargs[prop] is not _DEFERRED:
496.                             _setattr(self, prop, kwargs[prop])
497.                         del kwargs[prop]
498.                 except (AttributeError, FieldDoesNotExist):
499.                     pass
500.             for kwarg in kwargs:
501.                 raise TypeError("%s() got an unexpected keyword argument '%s'" % (cls.__name__, kwarg))
502.         super().__init__()
503.         post_init.send(sender=cls, instance=self)
504. 
505.     @classmethod
506.     def from_db(cls, db, field_names, values):
507.         if len(values) != len(cls._meta.concrete_fields):
508.             values_iter = iter(values)
509.             values = [
510.                 next(values_iter) if f.attname in field_names else DEFERRED
511.                 for f in cls._meta.concrete_fields
512.             ]
513.         new = cls(*values)
514.         new._state.adding = False
515.         new._state.db = db
516.         return new
517. 
518.     def __repr__(self):
519.         return '<%s: %s>' % (self.__class__.__name__, self)
520. 
521.     def __str__(self):
522.         return '%s object (%s)' % (self.__class__.__name__, self.pk)
523. 
524.     def __eq__(self, other):
525.         if not isinstance(other, Model):
526.             return NotImplemented
527.         if self._meta.concrete_model != other._meta.concrete_model:
528.             return False
529.         my_pk = self.pk
530.         if my_pk is None:
531.             return self is other
532.         return my_pk == other.pk
533. 
534.     def __hash__(self):
535.         if self.pk is None:
536.             raise TypeError("Model instances without primary key value are unhashable")
537.         return hash(self.pk)
538. 
539.     def __reduce__(self):
540.         data = self.__getstate__()
541.         data[DJANGO_VERSION_PICKLE_KEY] = django.__version__
542.         class_id = self._meta.app_label, self._meta.object_name
543.         return model_unpickle, (class_id,), data
544. 
545.     def __getstate__(self):
546.         """Hook to allow choosing the attributes to pickle."""
547.         return self.__dict__
548. 
549.     def __setstate__(self, state):
550.         pickled_version = state.get(DJANGO_VERSION_PICKLE_KEY)
551.         if pickled_version:
552.             if pickled_version != django.__version__:
553.                 warnings.warn(
554.                     "Pickled model instance's Django version %s does not "
555.                     "match the current version %s."
556.                     % (pickled_version, django.__version__),
557.                     RuntimeWarning,
558.                     stacklevel=2,
559.                 )
560.         else:
561.             warnings.warn(
562.                 "Pickled model instance's Django version is not specified.",
563.                 RuntimeWarning,
564.                 stacklevel=2,
565.             )
566.         self.__dict__.update(state)
567. 
568.     def _get_pk_val(self, meta=None):
569.         meta = meta or self._meta
570.         return getattr(self, meta.pk.attname)
571. 
572.     def _set_pk_val(self, value):
573.         for parent_link in self._meta.parents.values():
574.             if parent_link and parent_link != self._meta.pk:
575.                 setattr(self, parent_link.target_field.attname, value)
576.         return setattr(self, self._meta.pk.attname, value)
577. 
578.     pk = property(_get_pk_val, _set_pk_val)
579. 
580.     def get_deferred_fields(self):
581.         """
582.         Return a set containing names of deferred fields for this instance.
583.         """
584.         return {
585.             f.attname for f in self._meta.concrete_fields
586.             if f.attname not in self.__dict__
587.         }
588. 
589.     def refresh_from_db(self, using=None, fields=None):
590.         """
591.         Reload field values from the database.
592. 
593.         By default, the reloading happens from the database this instance was
594.         loaded from, or by the read router if this instance wasn't loaded from
595.         any database. The using parameter will override the default.
596. 
597.         Fields can be used to specify which fields to reload. The fields
598.         should be an iterable of field attnames. If fields is None, then
599.         all non-deferred fields are reloaded.
600. 
601.         When accessing deferred fields of an instance, the deferred loading
602.         of the field will call this method.
603.         """
604.         if fields is None:
605.             self._prefetched_objects_cache = {}
606.         else:
607.             prefetched_objects_cache = getattr(self, '_prefetched_objects_cache', ())
608.             for field in fields:
609.                 if field in prefetched_objects_cache:
610.                     del prefetched_objects_cache[field]
611.                     fields.remove(field)
612.             if not fields:
613.                 return
614.             if any(LOOKUP_SEP in f for f in fields):
615.                 raise ValueError(
616.                     'Found "%s" in fields argument. Relations and transforms '
617.                     'are not allowed in fields.' % LOOKUP_SEP)
618. 
619.         hints = {'instance': self}
620.         db_instance_qs = self.__class__._base_manager.db_manager(using, hints=hints).filter(pk=self.pk)
621. 
622.         # Use provided fields, if not set then reload all non-deferred fields.
623.         deferred_fields = self.get_deferred_fields()
624.         if fields is not None:
625.             fields = list(fields)
626.             db_instance_qs = db_instance_qs.only(*fields)
627.         elif deferred_fields:
628.             fields = [f.attname for f in self._meta.concrete_fields
629.                       if f.attname not in deferred_fields]
630.             db_instance_qs = db_instance_qs.only(*fields)
631. 
632.         db_instance = db_instance_qs.get()
633.         non_loaded_fields = db_instance.get_deferred_fields()
634.         for field in self._meta.concrete_fields:
635.             if field.attname in non_loaded_fields:
636.                 # This field wasn't refreshed - skip ahead.
637.                 continue
638.             setattr(self, field.attname, getattr(db_instance, field.attname))
639.             # Clear cached foreign keys.
640.             if field.is_relation and field.is_cached(self):
641.                 field.delete_cached_value(self)
642. 
643.         # Clear cached relations.
644.         for field in self._meta.related_objects:
645.             if field.is_cached(self):
646.                 field.delete_cached_value(self)
647. 
648.         self._state.db = db_instance._state.db
649. 
650.     def serializable_value(self, field_name):
651.         """
652.         Return the value of the field name for this instance. If the field is
653.         a foreign key, return the id value instead of the object. If there's
654.         no Field object with this name on the model, return the model
655.         attribute's value.
656. 
657.         Used to serialize a field's value (in the serializer, or form output,
658.         for example). Normally, you would just access the attribute directly
659.         and not use this method.
660.         """
661.         try:
662.             field = self._meta.get_field(field_name)
663.         except FieldDoesNotExist:
664.             return getattr(self, field_name)
665.         return getattr(self, field.attname)
666. 
667.     def save(self, force_insert=False, force_update=False, using=None,
668.              update_fields=None):
669.         """
670.         Save the current instance. Override this in a subclass if you want to
671.         control the saving process.
672. 
673.         The 'force_insert' and 'force_update' parameters can be used to insist
674.         that the "save" must be an SQL insert or update (or equivalent for
675.         non-SQL backends), respectively. Normally, they should not be set.
676.         """
677.         # Ensure that a model instance without a PK hasn't been assigned to
678.         # a ForeignKey or OneToOneField on this model. If the field is
679.         # nullable, allowing the save() would result in silent data loss.
680.         for field in self._meta.concrete_fields:
681.             # If the related field isn't cached, then an instance hasn't
682.             # been assigned and there's no need to worry about this check.
683.             if field.is_relation and field.is_cached(self):
684.                 obj = getattr(self, field.name, None)
685.                 if not obj:
686.                     continue
687.                 # A pk may have been assigned manually to a model instance not
688.                 # saved to the database (or auto-generated in a case like
689.                 # UUIDField), but we allow the save to proceed and rely on the
690.                 # database to raise an IntegrityError if applicable. If
691.                 # constraints aren't supported by the database, there's the
692.                 # unavoidable risk of data corruption.
693.                 if obj.pk is None:
694.                     # Remove the object from a related instance cache.
695.                     if not field.remote_field.multiple:
696.                         field.remote_field.delete_cached_value(obj)
697.                     raise ValueError(
698.                         "save() prohibited to prevent data loss due to "
699.                         "unsaved related object '%s'." % field.name
700.                     )
701.                 elif getattr(self, field.attname) is None:
702.                     # Use pk from related object if it has been saved after
703.                     # an assignment.
704.                     setattr(self, field.attname, obj.pk)
705.                 # If the relationship's pk/to_field was changed, clear the
706.                 # cached relationship.
707.                 if getattr(obj, field.target_field.attname) != getattr(self, field.attname):
708.                     field.delete_cached_value(self)
709. 
710.         using = using or router.db_for_write(self.__class__, instance=self)
711.         if force_insert and (force_update or update_fields):
712.             raise ValueError("Cannot force both insert and updating in model saving.")
713. 
714.         deferred_fields = self.get_deferred_fields()
715.         if update_fields is not None:
716.             # If update_fields is empty, skip the save. We do also check for
717.             # no-op saves later on for inheritance cases. This bailout is
718.             # still needed for skipping signal sending.
719.             if not update_fields:
720.                 return
721. 
722.             update_fields = frozenset(update_fields)
723.             field_names = set()
724. 
725.             for field in self._meta.fields:
726.                 if not field.primary_key:
727.                     field_names.add(field.name)
728. 
729.                     if field.name != field.attname:
730.                         field_names.add(field.attname)
731. 
732.             non_model_fields = update_fields.difference(field_names)
733. 
734.             if non_model_fields:
735.                 raise ValueError("The following fields do not exist in this "
736.                                  "model or are m2m fields: %s"
737.                                  % ', '.join(non_model_fields))
738. 
739.         # If saving to the same database, and this model is deferred, then
740.         # automatically do an "update_fields" save on the loaded fields.
741.         elif not force_insert and deferred_fields and using == self._state.db:
742.             field_names = set()
743.             for field in self._meta.concrete_fields:
744.                 if not field.primary_key and not hasattr(field, 'through'):
745.                     field_names.add(field.attname)
746.             loaded_fields = field_names.difference(deferred_fields)
747.             if loaded_fields:
748.                 update_fields = frozenset(loaded_fields)
749. 
750.         self.save_base(using=using, force_insert=force_insert,
751.                        force_update=force_update, update_fields=update_fields)
752.     save.alters_data = True
753. 
754.     def save_base(self, raw=False, force_insert=False,
755.                   force_update=False, using=None, update_fields=None):
756.         """
757.         Handle the parts of saving which should be done only once per save,
758.         yet need to be done in raw saves, too. This includes some sanity
759.         checks and signal sending.
760. 
761.         The 'raw' argument is telling save_base not to save any parent
762.         models and not to do any changes to the values before save. This
763.         is used by fixture loading.
764.         """
765.         using = using or router.db_for_write(self.__class__, instance=self)
766.         assert not (force_insert and (force_update or update_fields))
767.         assert update_fields is None or update_fields
768.         cls = origin = self.__class__
769.         # Skip proxies, but keep the origin as the proxy model.
770.         if cls._meta.proxy:
771.             cls = cls._meta.concrete_model
772.         meta = cls._meta
773.         if not meta.auto_created:
774.             pre_save.send(
775.                 sender=origin, instance=self, raw=raw, using=using,
776.                 update_fields=update_fields,
777.             )
778.         # A transaction isn't needed if one query is issued.
779.         if meta.parents:
780.             context_manager = transaction.atomic(using=using, savepoint=False)
781.         else:
782.             context_manager = transaction.mark_for_rollback_on_error(using=using)
783.         with context_manager:
784.             parent_inserted = False
785.             if not raw:
786.                 parent_inserted = self._save_parents(cls, using, update_fields)
787.             updated = self._save_table(
788.                 raw, cls, force_insert or parent_inserted,
789.                 force_update, using, update_fields,
790.             )
791.         # Store the database on which the object was saved
792.         self._state.db = using
793.         # Once saved, this is no longer a to-be-added instance.
794.         self._state.adding = False
795. 
796.         # Signal that the save is complete
797.         if not meta.auto_created:
798.             post_save.send(
799.                 sender=origin, instance=self, created=(not updated),
800.                 update_fields=update_fields, raw=raw, using=using,
801.             )
802. 
803.     save_base.alters_data = True
804. 
805.     def _save_parents(self, cls, using, update_fields):
806.         """Save all the parents of cls using values from self."""
807.         meta = cls._meta
808.         inserted = False
809.         for parent, field in meta.parents.items():
810.             # Make sure the link fields are synced between parent and self.
811.             if (field and getattr(self, parent._meta.pk.attname) is None and
812.                     getattr(self, field.attname) is not None):
813.                 setattr(self, parent._meta.pk.attname, getattr(self, field.attname))
814.             parent_inserted = self._save_parents(cls=parent, using=using, update_fields=update_fields)
815.             updated = self._save_table(
816.                 cls=parent, using=using, update_fields=update_fields,
817.                 force_insert=parent_inserted,
818.             )
819.             if not updated:
820.                 inserted = True
821.             # Set the parent's PK value to self.
822.             if field:
823.                 setattr(self, field.attname, self._get_pk_val(parent._meta))
824.                 # Since we didn't have an instance of the parent handy set
825.                 # attname directly, bypassing the descriptor. Invalidate
826.                 # the related object cache, in case it's been accidentally
827.                 # populated. A fresh instance will be re-built from the
828.                 # database if necessary.
829.                 if field.is_cached(self):
830.                     field.delete_cached_value(self)
831.         return inserted
832. 
833.     def _save_table(self, raw=False, cls=None, force_insert=False,
834.                     force_update=False, using=None, update_fields=None):
835.         """
836.         Do the heavy-lifting involved in saving. Update or insert the data
837.         for a single table.
838.         """
839.         meta = cls._meta
840.         non_pks = [f for f in meta.local_concrete_fields if not f.primary_key]
841. 
842.         if update_fields:
843.             non_pks = [f for f in non_pks
844.                        if f.name in update_fields or f.attname in update_fields]
845. 
846.         pk_val = self._get_pk_val(meta)
847.         if pk_val is None:
848.             pk_val = meta.pk.get_pk_value_on_save(self)
849.             setattr(self, meta.pk.attname, pk_val)
850.         pk_set = pk_val is not None
851.         if not pk_set and (force_update or update_fields):
852.             raise ValueError("Cannot force an update in save() with no primary key.")
853.         updated = False
854.         # Skip an UPDATE when adding an instance and primary key has a default.
855.         if (
856.             not raw and
857.             not force_insert and
858.             self._state.adding and
859.             meta.pk.default and
860.             meta.pk.default is not NOT_PROVIDED
861.         ):
862.             force_insert = True
863.         # If possible, try an UPDATE. If that doesn't update anything, do an INSERT.
864.         if pk_set and not force_insert:
865.             base_qs = cls._base_manager.using(using)
866.             values = [(f, None, (getattr(self, f.attname) if raw else f.pre_save(self, False)))
867.                       for f in non_pks]
868.             forced_update = update_fields or force_update
869.             updated = self._do_update(base_qs, using, pk_val, values, update_fields,
870.                                       forced_update)
871.             if force_update and not updated:
872.                 raise DatabaseError("Forced update did not affect any rows.")
873.             if update_fields and not updated:
874.                 raise DatabaseError("Save with update_fields did not affect any rows.")
875.         if not updated:
876.             if meta.order_with_respect_to:
877.                 # If this is a model with an order_with_respect_to
878.                 # autopopulate the _order field
879.                 field = meta.order_with_respect_to
880.                 filter_args = field.get_filter_kwargs_for_object(self)
881.                 self._order = cls._base_manager.using(using).filter(**filter_args).aggregate(
882.                     _order__max=Coalesce(
883.                         ExpressionWrapper(Max('_order') + Value(1), output_field=IntegerField()),
884.                         Value(0),
885.                     ),
886.                 )['_order__max']
887.             fields = meta.local_concrete_fields
888.             if not pk_set:
889.                 fields = [f for f in fields if f is not meta.auto_field]
890. 
891.             returning_fields = meta.db_returning_fields
892.             results = self._do_insert(cls._base_manager, using, fields, returning_fields, raw)
893.             if results:
894.                 for value, field in zip(results[0], returning_fields):
895.                     setattr(self, field.attname, value)
896.         return updated
897. 
898.     def _do_update(self, base_qs, using, pk_val, values, update_fields, forced_update):
899.         """
900.         Try to update the model. Return True if the model was updated (if an
901.         update query was done and a matching row was found in the DB).
902.         """
903.         filtered = base_qs.filter(pk=pk_val)
904.         if not values:
905.             # We can end up here when saving a model in inheritance chain where
906.             # update_fields doesn't target any field in current model. In that
907.             # case we just say the update succeeded. Another case ending up here
908.             # is a model with just PK - in that case check that the PK still
909.             # exists.
910.             return update_fields is not None or filtered.exists()
911.         if self._meta.select_on_save and not forced_update:
912.             return (
913.                 filtered.exists() and
914.                 # It may happen that the object is deleted from the DB right after
915.                 # this check, causing the subsequent UPDATE to return zero matching
916.                 # rows. The same result can occur in some rare cases when the
917.                 # database returns zero despite the UPDATE being executed
918.                 # successfully (a row is matched and updated). In order to
919.                 # distinguish these two cases, the object's existence in the
920.                 # database is again checked for if the UPDATE query returns 0.
921.                 (filtered._update(values) > 0 or filtered.exists())
922.             )
923.         return filtered._update(values) > 0
924. 
925.     def _do_insert(self, manager, using, fields, returning_fields, raw):
926.         """
927.         Do an INSERT. If returning_fields is defined then this method should
928.         return the newly created data for the model.
929.         """
930.         return manager._insert(
931.             [self], fields=fields, returning_fields=returning_fields,
932.             using=using, raw=raw,
933.         )
934. 
935.     def delete(self, using=None, keep_parents=False):
936.         using = using or router.db_for_write(self.__class__, instance=self)
937.         assert self.pk is not None, (
938.             "%s object can't be deleted because its %s attribute is set to None." %
939.             (self._meta.object_name, self._meta.pk.attname)
940.         )
941. 
942.         collector = Collector(using=using)
943.         collector.collect([self], keep_parents=keep_parents)
944.         return collector.delete()
945. 
946.     delete.alters_data = True
947. 
948.     def _get_FIELD_display(self, field):
949.         value = getattr(self, field.attname)
950.         choices_dict = dict(make_hashable(field.flatchoices))
951.         # force_str() to coerce lazy strings.
952.         return force_str(choices_dict.get(make_hashable(value), value), strings_only=True)
953. 
954.     def _get_next_or_previous_by_FIELD(self, field, is_next, **kwargs):
955.         if not self.pk:
956.             raise ValueError("get_next/get_previous cannot be used on unsaved objects.")
957.         op = 'gt' if is_next else 'lt'
958.         order = '' if is_next else '-'
959.         param = getattr(self, field.attname)
960.         q = Q(**{'%s__%s' % (field.name, op): param})
961.         q = q | Q(**{field.name: param, 'pk__%s' % op: self.pk})
962.         qs = self.__class__._default_manager.using(self._state.db).filter(**kwargs).filter(q).order_by(
963.             '%s%s' % (order, field.name), '%spk' % order
964.         )
965.         try:
966.             return qs[0]
967.         except IndexError:
968.             raise self.DoesNotExist("%s matching query does not exist." % self.__class__._meta.object_name)
969. 
970.     def _get_next_or_previous_in_order(self, is_next):
971.         cachename = "__%s_order_cache" % is_next
972.         if not hasattr(self, cachename):
973.             op = 'gt' if is_next else 'lt'
974.             order = '_order' if is_next else '-_order'
975.             order_field = self._meta.order_with_respect_to
976.             filter_args = order_field.get_filter_kwargs_for_object(self)
977.             obj = self.__class__._default_manager.filter(**filter_args).filter(**{
978.                 '_order__%s' % op: self.__class__._default_manager.values('_order').filter(**{
979.                     self._meta.pk.name: self.pk
980.                 })
981.             }).order_by(order)[:1].get()
982.             setattr(self, cachename, obj)
983.         return getattr(self, cachename)
984. 
985.     def prepare_database_save(self, field):
986.         if self.pk is None:
987.             raise ValueError("Unsaved model instance %r cannot be used in an ORM query." % self)
988.         return getattr(self, field.remote_field.get_related_field().attname)
989. 
990.     def clean(self):
991.         """
992.         Hook for doing any extra model-wide validation after clean() has been
993.         called on every field by self.clean_fields. Any ValidationError raised
994.         by this method will not be associated with a particular field; it will
995.         have a special-case association with the field defined by NON_FIELD_ERRORS.
996.         """
997.         pass
998. 
999.     def validate_unique(self, exclude=None):
1000.         """
1001.         Check unique constraints on the model and raise ValidationError if any
1002.         failed.
1003.         """
1004.         unique_checks, date_checks = self._get_unique_checks(exclude=exclude)
1005. 
1006.         errors = self._perform_unique_checks(unique_checks)
1007.         date_errors = self._perform_date_checks(date_checks)
1008. 
1009.         for k, v in date_errors.items():
1010.             errors.setdefault(k, []).extend(v)
1011. 
1012.         if errors:
1013.             raise ValidationError(errors)
1014. 
1015.     def _get_unique_checks(self, exclude=None):
1016.         """
1017.         Return a list of checks to perform. Since validate_unique() could be
1018.         called from a ModelForm, some fields may have been excluded; we can't
1019.         perform a unique check on a model that is missing fields involved
1020.         in that check. Fields that did not validate should also be excluded,
1021.         but they need to be passed in via the exclude argument.
1022.         """
1023.         if exclude is None:
1024.             exclude = []
1025.         unique_checks = []
1026. 
1027.         unique_togethers = [(self.__class__, self._meta.unique_together)]
1028.         constraints = [(self.__class__, self._meta.total_unique_constraints)]
1029.         for parent_class in self._meta.get_parent_list():
1030.             if parent_class._meta.unique_together:
1031.                 unique_togethers.append((parent_class, parent_class._meta.unique_together))
1032.             if parent_class._meta.total_unique_constraints:
1033.                 constraints.append(
1034.                     (parent_class, parent_class._meta.total_unique_constraints)
1035.                 )
1036. 
1037.         for model_class, unique_together in unique_togethers:
1038.             for check in unique_together:
1039.                 if not any(name in exclude for name in check):
1040.                     # Add the check if the field isn't excluded.
1041.                     unique_checks.append((model_class, tuple(check)))
1042. 
1043.         for model_class, model_constraints in constraints:
1044.             for constraint in model_constraints:
1045.                 if not any(name in exclude for name in constraint.fields):
1046.                     unique_checks.append((model_class, constraint.fields))
1047. 
1048.         # These are checks for the unique_for_<date/year/month>.
1049.         date_checks = []
1050. 
1051.         # Gather a list of checks for fields declared as unique and add them to
1052.         # the list of checks.
1053. 
1054.         fields_with_class = [(self.__class__, self._meta.local_fields)]
1055.         for parent_class in self._meta.get_parent_list():
1056.             fields_with_class.append((parent_class, parent_class._meta.local_fields))
1057. 
1058.         for model_class, fields in fields_with_class:
1059.             for f in fields:
1060.                 name = f.name
1061.                 if name in exclude:
1062.                     continue
1063.                 if f.unique:
1064.                     unique_checks.append((model_class, (name,)))
1065.                 if f.unique_for_date and f.unique_for_date not in exclude:
1066.                     date_checks.append((model_class, 'date', name, f.unique_for_date))
1067.                 if f.unique_for_year and f.unique_for_year not in exclude:
1068.                     date_checks.append((model_class, 'year', name, f.unique_for_year))
1069.                 if f.unique_for_month and f.unique_for_month not in exclude:
1070.                     date_checks.append((model_class, 'month', name, f.unique_for_month))
1071.         return unique_checks, date_checks
1072. 
1073.     def _perform_unique_checks(self, unique_checks):
1074.         errors = {}
1075. 
1076.         for model_class, unique_check in unique_checks:
1077.             # Try to look up an existing object with the same values as this
1078.             # object's values for all the unique field.
1079. 
1080.             lookup_kwargs = {}
1081.             for field_name in unique_check:
1082.                 f = self._meta.get_field(field_name)
1083.                 lookup_value = getattr(self, f.attname)
1084.                 # TODO: Handle multiple backends with different feature flags.
1085.                 if (lookup_value is None or
1086.                         (lookup_value == '' and connection.features.interprets_empty_strings_as_nulls)):
1087.                     # no value, skip the lookup
1088.                     continue
1089.                 if f.primary_key and not self._state.adding:
1090.                     # no need to check for unique primary key when editing
1091.                     continue
1092.                 lookup_kwargs[str(field_name)] = lookup_value
1093. 
1094.             # some fields were skipped, no reason to do the check
1095.             if len(unique_check) != len(lookup_kwargs):
1096.                 continue
1097. 
1098.             qs = model_class._default_manager.filter(**lookup_kwargs)
1099. 
1100.             # Exclude the current object from the query if we are editing an
1101.             # instance (as opposed to creating a new one)
1102.             # Note that we need to use the pk as defined by model_class, not
1103.             # self.pk. These can be different fields because model inheritance
1104.             # allows single model to have effectively multiple primary keys.
1105.             # Refs #17615.
1106.             model_class_pk = self._get_pk_val(model_class._meta)
1107.             if not self._state.adding and model_class_pk is not None:
1108.                 qs = qs.exclude(pk=model_class_pk)
1109.             if qs.exists():
1110.                 if len(unique_check) == 1:
1111.                     key = unique_check[0]
1112.                 else:
1113.                     key = NON_FIELD_ERRORS
1114.                 errors.setdefault(key, []).append(self.unique_error_message(model_class, unique_check))
1115. 
1116.         return errors
1117. 
1118.     def _perform_date_checks(self, date_checks):
1119.         errors = {}
1120.         for model_class, lookup_type, field, unique_for in date_checks:
1121.             lookup_kwargs = {}
1122.             # there's a ticket to add a date lookup, we can remove this special
1123.             # case if that makes it's way in
1124.             date = getattr(self, unique_for)
1125.             if date is None:
1126.                 continue
1127.             if lookup_type == 'date':
1128.                 lookup_kwargs['%s__day' % unique_for] = date.day
1129.                 lookup_kwargs['%s__month' % unique_for] = date.month
1130.                 lookup_kwargs['%s__year' % unique_for] = date.year
1131.             else:
1132.                 lookup_kwargs['%s__%s' % (unique_for, lookup_type)] = getattr(date, lookup_type)
1133.             lookup_kwargs[field] = getattr(self, field)
1134. 
1135.             qs = model_class._default_manager.filter(**lookup_kwargs)
1136.             # Exclude the current object from the query if we are editing an
1137.             # instance (as opposed to creating a new one)
1138.             if not self._state.adding and self.pk is not None:
1139.                 qs = qs.exclude(pk=self.pk)
1140. 
1141.             if qs.exists():
1142.                 errors.setdefault(field, []).append(
1143.                     self.date_error_message(lookup_type, field, unique_for)
1144.                 )
1145.         return errors
1146. 
1147.     def date_error_message(self, lookup_type, field_name, unique_for):
1148.         opts = self._meta
1149.         field = opts.get_field(field_name)
1150.         return ValidationError(
1151.             message=field.error_messages['unique_for_date'],
1152.             code='unique_for_date',
1153.             params={
1154.                 'model': self,
1155.                 'model_name': capfirst(opts.verbose_name),
1156.                 'lookup_type': lookup_type,
1157.                 'field': field_name,
1158.                 'field_label': capfirst(field.verbose_name),
1159.                 'date_field': unique_for,
1160.                 'date_field_label': capfirst(opts.get_field(unique_for).verbose_name),
1161.             }
1162.         )
1163. 
1164.     def unique_error_message(self, model_class, unique_check):
1165.         opts = model_class._meta
1166. 
1167.         params = {
1168.             'model': self,
1169.             'model_class': model_class,
1170.             'model_name': capfirst(opts.verbose_name),
1171.             'unique_check': unique_check,
1172.         }
1173. 
1174.         # A unique field
1175.         if len(unique_check) == 1:
1176.             field = opts.get_field(unique_check[0])
1177.             params['field_label'] = capfirst(field.verbose_name)
1178.             return ValidationError(
1179.                 message=field.error_messages['unique'],
1180.                 code='unique',
1181.                 params=params,
1182.             )
1183. 
1184.         # unique_together
1185.         else:
1186.             field_labels = [capfirst(opts.get_field(f).verbose_name) for f in unique_check]
1187.             params['field_labels'] = get_text_list(field_labels, _('and'))
1188.             return ValidationError(
1189.                 message=_("%(model_name)s with this %(field_labels)s already exists."),
1190.                 code='unique_together',
1191.                 params=params,
1192.             )
1193. 
1194.     def full_clean(self, exclude=None, validate_unique=True):
1195.         """
1196.         Call clean_fields(), clean(), and validate_unique() on the model.
1197.         Raise a ValidationError for any errors that occur.
1198.         """
1199.         errors = {}
1200.         if exclude is None:
1201.             exclude = []
1202.         else:
1203.             exclude = list(exclude)
1204. 
1205.         try:
1206.             self.clean_fields(exclude=exclude)
1207.         except ValidationError as e:
1208.             errors = e.update_error_dict(errors)
1209. 
1210.         # Form.clean() is run even if other validation fails, so do the
1211.         # same with Model.clean() for consistency.
1212.         try:
1213.             self.clean()
1214.         except ValidationError as e:
1215.             errors = e.update_error_dict(errors)
1216. 
1217.         # Run unique checks, but only for fields that passed validation.
1218.         if validate_unique:
1219.             for name in errors:
1220.                 if name != NON_FIELD_ERRORS and name not in exclude:
1221.                     exclude.append(name)
1222.             try:
1223.                 self.validate_unique(exclude=exclude)
1224.             except ValidationError as e:
1225.                 errors = e.update_error_dict(errors)
1226. 
1227.         if errors:
1228.             raise ValidationError(errors)
1229. 
1230.     def clean_fields(self, exclude=None):
1231.         """
1232.         Clean all fields and raise a ValidationError containing a dict
1233.         of all validation errors if any occur.
1234.         """
1235.         if exclude is None:
1236.             exclude = []
1237. 
1238.         errors = {}
1239.         for f in self._meta.fields:
1240.             if f.name in exclude:
1241.                 continue
1242.             # Skip validation for empty fields with blank=True. The developer
1243.             # is responsible for making sure they have a valid value.
1244.             raw_value = getattr(self, f.attname)
1245.             if f.blank and raw_value in f.empty_values:
1246.                 continue
1247.             try:
1248.                 setattr(self, f.attname, f.clean(raw_value, self))
1249.             except ValidationError as e:
1250.                 errors[f.name] = e.error_list
1251. 
1252.         if errors:
1253.             raise ValidationError(errors)
1254. 
1255.     @classmethod
1256.     def check(cls, **kwargs):
1257.         errors = [*cls._check_swappable(), *cls._check_model(), *cls._check_managers(**kwargs)]
1258.         if not cls._meta.swapped:
1259.             databases = kwargs.get('databases') or []
1260.             errors += [
1261.                 *cls._check_fields(**kwargs),
1262.                 *cls._check_m2m_through_same_relationship(),
1263.                 *cls._check_long_column_names(databases),
1264.             ]
1265.             clash_errors = (
1266.                 *cls._check_id_field(),
1267.                 *cls._check_field_name_clashes(),
1268.                 *cls._check_model_name_db_lookup_clashes(),
1269.                 *cls._check_property_name_related_field_accessor_clashes(),
1270.                 *cls._check_single_primary_key(),
1271.             )
1272.             errors.extend(clash_errors)
1273.             # If there are field name clashes, hide consequent column name
1274.             # clashes.
1275.             if not clash_errors:
1276.                 errors.extend(cls._check_column_name_clashes())
1277.             errors += [
1278.                 *cls._check_index_together(),
1279.                 *cls._check_unique_together(),
1280.                 *cls._check_indexes(databases),
1281.                 *cls._check_ordering(),
1282.                 *cls._check_constraints(databases),
1283.             ]
1284. 
1285.         return errors
1286. 
1287.     @classmethod
1288.     def _check_swappable(cls):
1289.         """Check if the swapped model exists."""
1290.         errors = []
1291.         if cls._meta.swapped:
1292.             try:
1293.                 apps.get_model(cls._meta.swapped)
1294.             except ValueError:
1295.                 errors.append(
1296.                     checks.Error(
1297.                         "'%s' is not of the form 'app_label.app_name'." % cls._meta.swappable,
1298.                         id='models.E001',
1299.                     )
1300.                 )
1301.             except LookupError:
1302.                 app_label, model_name = cls._meta.swapped.split('.')
1303.                 errors.append(
1304.                     checks.Error(
1305.                         "'%s' references '%s.%s', which has not been "
1306.                         "installed, or is abstract." % (
1307.                             cls._meta.swappable, app_label, model_name
1308.                         ),
1309.                         id='models.E002',
1310.                     )
1311.                 )
1312.         return errors
1313. 
1314.     @classmethod
1315.     def _check_model(cls):
1316.         errors = []
1317.         if cls._meta.proxy:
1318.             if cls._meta.local_fields or cls._meta.local_many_to_many:
1319.                 errors.append(
1320.                     checks.Error(
1321.                         "Proxy model '%s' contains model fields." % cls.__name__,
1322.                         id='models.E017',
1323.                     )
1324.                 )
1325.         return errors
1326. 
1327.     @classmethod
1328.     def _check_managers(cls, **kwargs):
1329.         """Perform all manager checks."""
1330.         errors = []
1331.         for manager in cls._meta.managers:
1332.             errors.extend(manager.check(**kwargs))
1333.         return errors
1334. 
1335.     @classmethod
1336.     def _check_fields(cls, **kwargs):
1337.         """Perform all field checks."""
1338.         errors = []
1339.         for field in cls._meta.local_fields:
1340.             errors.extend(field.check(**kwargs))
1341.         for field in cls._meta.local_many_to_many:
1342.             errors.extend(field.check(from_model=cls, **kwargs))
1343.         return errors
1344. 
1345.     @classmethod
1346.     def _check_m2m_through_same_relationship(cls):
1347.         """ Check if no relationship model is used by more than one m2m field.
1348.         """
1349. 
1350.         errors = []
1351.         seen_intermediary_signatures = []
1352. 
1353.         fields = cls._meta.local_many_to_many
1354. 
1355.         # Skip when the target model wasn't found.
1356.         fields = (f for f in fields if isinstance(f.remote_field.model, ModelBase))
1357. 
1358.         # Skip when the relationship model wasn't found.
1359.         fields = (f for f in fields if isinstance(f.remote_field.through, ModelBase))
1360. 
1361.         for f in fields:
1362.             signature = (f.remote_field.model, cls, f.remote_field.through, f.remote_field.through_fields)
1363.             if signature in seen_intermediary_signatures:
1364.                 errors.append(
1365.                     checks.Error(
1366.                         "The model has two identical many-to-many relations "
1367.                         "through the intermediate model '%s'." %
1368.                         f.remote_field.through._meta.label,
1369.                         obj=cls,
1370.                         id='models.E003',
1371.                     )
1372.                 )
1373.             else:
1374.                 seen_intermediary_signatures.append(signature)
1375.         return errors
1376. 
1377.     @classmethod
1378.     def _check_id_field(cls):
1379.         """Check if `id` field is a primary key."""
1380.         fields = [f for f in cls._meta.local_fields if f.name == 'id' and f != cls._meta.pk]
1381.         # fields is empty or consists of the invalid "id" field
1382.         if fields and not fields[0].primary_key and cls._meta.pk.name == 'id':
1383.             return [
1384.                 checks.Error(
1385.                     "'id' can only be used as a field name if the field also "
1386.                     "sets 'primary_key=True'.",
1387.                     obj=cls,
1388.                     id='models.E004',
1389.                 )
1390.             ]
1391.         else:
1392.             return []
1393. 
1394.     @classmethod
1395.     def _check_field_name_clashes(cls):
1396.         """Forbid field shadowing in multi-table inheritance."""
1397.         errors = []
1398.         used_fields = {}  # name or attname -> field
1399. 
1400.         # Check that multi-inheritance doesn't cause field name shadowing.
1401.         for parent in cls._meta.get_parent_list():
1402.             for f in parent._meta.local_fields:
1403.                 clash = used_fields.get(f.name) or used_fields.get(f.attname) or None
1404.                 if clash:
1405.                     errors.append(
1406.                         checks.Error(
1407.                             "The field '%s' from parent model "
1408.                             "'%s' clashes with the field '%s' "
1409.                             "from parent model '%s'." % (
1410.                                 clash.name, clash.model._meta,
1411.                                 f.name, f.model._meta
1412.                             ),
1413.                             obj=cls,
1414.                             id='models.E005',
1415.                         )
1416.                     )
1417.                 used_fields[f.name] = f
1418.                 used_fields[f.attname] = f
1419. 
1420.         # Check that fields defined in the model don't clash with fields from
1421.         # parents, including auto-generated fields like multi-table inheritance
1422.         # child accessors.
1423.         for parent in cls._meta.get_parent_list():
1424.             for f in parent._meta.get_fields():
1425.                 if f not in used_fields:
1426.                     used_fields[f.name] = f
1427. 
1428.         for f in cls._meta.local_fields:
1429.             clash = used_fields.get(f.name) or used_fields.get(f.attname) or None
1430.             # Note that we may detect clash between user-defined non-unique
1431.             # field "id" and automatically added unique field "id", both
1432.             # defined at the same model. This special case is considered in
1433.             # _check_id_field and here we ignore it.
1434.             id_conflict = f.name == "id" and clash and clash.name == "id" and clash.model == cls
1435.             if clash and not id_conflict:
1436.                 errors.append(
1437.                     checks.Error(
1438.                         "The field '%s' clashes with the field '%s' "
1439.                         "from model '%s'." % (
1440.                             f.name, clash.name, clash.model._meta
1441.                         ),
1442.                         obj=f,
1443.                         id='models.E006',
1444.                     )
1445.                 )
1446.             used_fields[f.name] = f
1447.             used_fields[f.attname] = f
1448. 
1449.         return errors
1450. 
1451.     @classmethod
1452.     def _check_column_name_clashes(cls):
1453.         # Store a list of column names which have already been used by other fields.
1454.         used_column_names = []
1455.         errors = []
1456. 
1457.         for f in cls._meta.local_fields:
1458.             _, column_name = f.get_attname_column()
1459. 
1460.             # Ensure the column name is not already in use.
1461.             if column_name and column_name in used_column_names:
1462.                 errors.append(
1463.                     checks.Error(
1464.                         "Field '%s' has column name '%s' that is used by "
1465.                         "another field." % (f.name, column_name),
1466.                         hint="Specify a 'db_column' for the field.",
1467.                         obj=cls,
1468.                         id='models.E007'
1469.                     )
1470.                 )
1471.             else:
1472.                 used_column_names.append(column_name)
1473. 
1474.         return errors
1475. 
1476.     @classmethod
1477.     def _check_model_name_db_lookup_clashes(cls):
1478.         errors = []
1479.         model_name = cls.__name__
1480.         if model_name.startswith('_') or model_name.endswith('_'):
1481.             errors.append(
1482.                 checks.Error(
1483.                     "The model name '%s' cannot start or end with an underscore "
1484.                     "as it collides with the query lookup syntax." % model_name,
1485.                     obj=cls,
1486.                     id='models.E023'
1487.                 )
1488.             )
1489.         elif LOOKUP_SEP in model_name:
1490.             errors.append(
1491.                 checks.Error(
1492.                     "The model name '%s' cannot contain double underscores as "
1493.                     "it collides with the query lookup syntax." % model_name,
1494.                     obj=cls,
1495.                     id='models.E024'
1496.                 )
1497.             )
1498.         return errors
1499. 
1500.     @classmethod
1501.     def _check_property_name_related_field_accessor_clashes(cls):
1502.         errors = []


File: django/db/models/fields/related.py
Line number range: 1 - 1501
Content:
1. import functools
2. import inspect
3. from functools import partial
4. 
5. from django import forms
6. from django.apps import apps
7. from django.conf import SettingsReference, settings
8. from django.core import checks, exceptions
9. from django.db import connection, router
10. from django.db.backends import utils
11. from django.db.models import Q
12. from django.db.models.constants import LOOKUP_SEP
13. from django.db.models.deletion import CASCADE, SET_DEFAULT, SET_NULL
14. from django.db.models.query_utils import PathInfo
15. from django.db.models.utils import make_model_tuple
16. from django.utils.functional import cached_property
17. from django.utils.translation import gettext_lazy as _
18. 
19. from . import Field
20. from .mixins import FieldCacheMixin
21. from .related_descriptors import (
22.     ForeignKeyDeferredAttribute, ForwardManyToOneDescriptor,
23.     ForwardOneToOneDescriptor, ManyToManyDescriptor,
24.     ReverseManyToOneDescriptor, ReverseOneToOneDescriptor,
25. )
26. from .related_lookups import (
27.     RelatedExact, RelatedGreaterThan, RelatedGreaterThanOrEqual, RelatedIn,
28.     RelatedIsNull, RelatedLessThan, RelatedLessThanOrEqual,
29. )
30. from .reverse_related import (
31.     ForeignObjectRel, ManyToManyRel, ManyToOneRel, OneToOneRel,
32. )
33. 
34. RECURSIVE_RELATIONSHIP_CONSTANT = 'self'
35. 
36. 
37. def resolve_relation(scope_model, relation):
38.     """
39.     Transform relation into a model or fully-qualified model string of the form
40.     "app_label.ModelName", relative to scope_model.
41. 
42.     The relation argument can be:
43.       * RECURSIVE_RELATIONSHIP_CONSTANT, i.e. the string "self", in which case
44.         the model argument will be returned.
45.       * A bare model name without an app_label, in which case scope_model's
46.         app_label will be prepended.
47.       * An "app_label.ModelName" string.
48.       * A model class, which will be returned unchanged.
49.     """
50.     # Check for recursive relations
51.     if relation == RECURSIVE_RELATIONSHIP_CONSTANT:
52.         relation = scope_model
53. 
54.     # Look for an "app.Model" relation
55.     if isinstance(relation, str):
56.         if "." not in relation:
57.             relation = "%s.%s" % (scope_model._meta.app_label, relation)
58. 
59.     return relation
60. 
61. 
62. def lazy_related_operation(function, model, *related_models, **kwargs):
63.     """
64.     Schedule `function` to be called once `model` and all `related_models`
65.     have been imported and registered with the app registry. `function` will
66.     be called with the newly-loaded model classes as its positional arguments,
67.     plus any optional keyword arguments.
68. 
69.     The `model` argument must be a model class. Each subsequent positional
70.     argument is another model, or a reference to another model - see
71.     `resolve_relation()` for the various forms these may take. Any relative
72.     references will be resolved relative to `model`.
73. 
74.     This is a convenience wrapper for `Apps.lazy_model_operation` - the app
75.     registry model used is the one found in `model._meta.apps`.
76.     """
77.     models = [model] + [resolve_relation(model, rel) for rel in related_models]
78.     model_keys = (make_model_tuple(m) for m in models)
79.     apps = model._meta.apps
80.     return apps.lazy_model_operation(partial(function, **kwargs), *model_keys)
81. 
82. 
83. class RelatedField(FieldCacheMixin, Field):
84.     """Base class that all relational fields inherit from."""
85. 
86.     # Field flags
87.     one_to_many = False
88.     one_to_one = False
89.     many_to_many = False
90.     many_to_one = False
91. 
92.     @cached_property
93.     def related_model(self):
94.         # Can't cache this property until all the models are loaded.
95.         apps.check_models_ready()
96.         return self.remote_field.model
97. 
98.     def check(self, **kwargs):
99.         return [
100.             *super().check(**kwargs),
101.             *self._check_related_name_is_valid(),
102.             *self._check_related_query_name_is_valid(),
103.             *self._check_relation_model_exists(),
104.             *self._check_referencing_to_swapped_model(),
105.             *self._check_clashes(),
106.         ]
107. 
108.     def _check_related_name_is_valid(self):
109.         import keyword
110.         related_name = self.remote_field.related_name
111.         if related_name is None:
112.             return []
113.         is_valid_id = not keyword.iskeyword(related_name) and related_name.isidentifier()
114.         if not (is_valid_id or related_name.endswith('+')):
115.             return [
116.                 checks.Error(
117.                     "The name '%s' is invalid related_name for field %s.%s" %
118.                     (self.remote_field.related_name, self.model._meta.object_name,
119.                      self.name),
120.                     hint="Related name must be a valid Python identifier or end with a '+'",
121.                     obj=self,
122.                     id='fields.E306',
123.                 )
124.             ]
125.         return []
126. 
127.     def _check_related_query_name_is_valid(self):
128.         if self.remote_field.is_hidden():
129.             return []
130.         rel_query_name = self.related_query_name()
131.         errors = []
132.         if rel_query_name.endswith('_'):
133.             errors.append(
134.                 checks.Error(
135.                     "Reverse query name '%s' must not end with an underscore."
136.                     % rel_query_name,
137.                     hint=("Add or change a related_name or related_query_name "
138.                           "argument for this field."),
139.                     obj=self,
140.                     id='fields.E308',
141.                 )
142.             )
143.         if LOOKUP_SEP in rel_query_name:
144.             errors.append(
145.                 checks.Error(
146.                     "Reverse query name '%s' must not contain '%s'."
147.                     % (rel_query_name, LOOKUP_SEP),
148.                     hint=("Add or change a related_name or related_query_name "
149.                           "argument for this field."),
150.                     obj=self,
151.                     id='fields.E309',
152.                 )
153.             )
154.         return errors
155. 
156.     def _check_relation_model_exists(self):
157.         rel_is_missing = self.remote_field.model not in self.opts.apps.get_models()
158.         rel_is_string = isinstance(self.remote_field.model, str)
159.         model_name = self.remote_field.model if rel_is_string else self.remote_field.model._meta.object_name
160.         if rel_is_missing and (rel_is_string or not self.remote_field.model._meta.swapped):
161.             return [
162.                 checks.Error(
163.                     "Field defines a relation with model '%s', which is either "
164.                     "not installed, or is abstract." % model_name,
165.                     obj=self,
166.                     id='fields.E300',
167.                 )
168.             ]
169.         return []
170. 
171.     def _check_referencing_to_swapped_model(self):
172.         if (self.remote_field.model not in self.opts.apps.get_models() and
173.                 not isinstance(self.remote_field.model, str) and
174.                 self.remote_field.model._meta.swapped):
175.             model = "%s.%s" % (
176.                 self.remote_field.model._meta.app_label,
177.                 self.remote_field.model._meta.object_name
178.             )
179.             return [
180.                 checks.Error(
181.                     "Field defines a relation with the model '%s', which has "
182.                     "been swapped out." % model,
183.                     hint="Update the relation to point at 'settings.%s'." % self.remote_field.model._meta.swappable,
184.                     obj=self,
185.                     id='fields.E301',
186.                 )
187.             ]
188.         return []
189. 
190.     def _check_clashes(self):
191.         """Check accessor and reverse query name clashes."""
192.         from django.db.models.base import ModelBase
193. 
194.         errors = []
195.         opts = self.model._meta
196. 
197.         # `f.remote_field.model` may be a string instead of a model. Skip if model name is
198.         # not resolved.
199.         if not isinstance(self.remote_field.model, ModelBase):
200.             return []
201. 
202.         # Consider that we are checking field `Model.foreign` and the models
203.         # are:
204.         #
205.         #     class Target(models.Model):
206.         #         model = models.IntegerField()
207.         #         model_set = models.IntegerField()
208.         #
209.         #     class Model(models.Model):
210.         #         foreign = models.ForeignKey(Target)
211.         #         m2m = models.ManyToManyField(Target)
212. 
213.         # rel_opts.object_name == "Target"
214.         rel_opts = self.remote_field.model._meta
215.         # If the field doesn't install a backward relation on the target model
216.         # (so `is_hidden` returns True), then there are no clashes to check
217.         # and we can skip these fields.
218.         rel_is_hidden = self.remote_field.is_hidden()
219.         rel_name = self.remote_field.get_accessor_name()  # i. e. "model_set"
220.         rel_query_name = self.related_query_name()  # i. e. "model"
221.         field_name = "%s.%s" % (opts.object_name, self.name)  # i. e. "Model.field"
222. 
223.         # Check clashes between accessor or reverse query name of `field`
224.         # and any other field name -- i.e. accessor for Model.foreign is
225.         # model_set and it clashes with Target.model_set.
226.         potential_clashes = rel_opts.fields + rel_opts.many_to_many
227.         for clash_field in potential_clashes:
228.             clash_name = "%s.%s" % (rel_opts.object_name, clash_field.name)  # i.e. "Target.model_set"
229.             if not rel_is_hidden and clash_field.name == rel_name:
230.                 errors.append(
231.                     checks.Error(
232.                         "Reverse accessor for '%s' clashes with field name '%s'." % (field_name, clash_name),
233.                         hint=("Rename field '%s', or add/change a related_name "
234.                               "argument to the definition for field '%s'.") % (clash_name, field_name),
235.                         obj=self,
236.                         id='fields.E302',
237.                     )
238.                 )
239. 
240.             if clash_field.name == rel_query_name:
241.                 errors.append(
242.                     checks.Error(
243.                         "Reverse query name for '%s' clashes with field name '%s'." % (field_name, clash_name),
244.                         hint=("Rename field '%s', or add/change a related_name "
245.                               "argument to the definition for field '%s'.") % (clash_name, field_name),
246.                         obj=self,
247.                         id='fields.E303',
248.                     )
249.                 )
250. 
251.         # Check clashes between accessors/reverse query names of `field` and
252.         # any other field accessor -- i. e. Model.foreign accessor clashes with
253.         # Model.m2m accessor.
254.         potential_clashes = (r for r in rel_opts.related_objects if r.field is not self)
255.         for clash_field in potential_clashes:
256.             clash_name = "%s.%s" % (  # i. e. "Model.m2m"
257.                 clash_field.related_model._meta.object_name,
258.                 clash_field.field.name)
259.             if not rel_is_hidden and clash_field.get_accessor_name() == rel_name:
260.                 errors.append(
261.                     checks.Error(
262.                         "Reverse accessor for '%s' clashes with reverse accessor for '%s'." % (field_name, clash_name),
263.                         hint=("Add or change a related_name argument "
264.                               "to the definition for '%s' or '%s'.") % (field_name, clash_name),
265.                         obj=self,
266.                         id='fields.E304',
267.                     )
268.                 )
269. 
270.             if clash_field.get_accessor_name() == rel_query_name:
271.                 errors.append(
272.                     checks.Error(
273.                         "Reverse query name for '%s' clashes with reverse query name for '%s'."
274.                         % (field_name, clash_name),
275.                         hint=("Add or change a related_name argument "
276.                               "to the definition for '%s' or '%s'.") % (field_name, clash_name),
277.                         obj=self,
278.                         id='fields.E305',
279.                     )
280.                 )
281. 
282.         return errors
283. 
284.     def db_type(self, connection):
285.         # By default related field will not have a column as it relates to
286.         # columns from another table.
287.         return None
288. 
289.     def contribute_to_class(self, cls, name, private_only=False, **kwargs):
290. 
291.         super().contribute_to_class(cls, name, private_only=private_only, **kwargs)
292. 
293.         self.opts = cls._meta
294. 
295.         if not cls._meta.abstract:
296.             if self.remote_field.related_name:
297.                 related_name = self.remote_field.related_name
298.             else:
299.                 related_name = self.opts.default_related_name
300.             if related_name:
301.                 related_name = related_name % {
302.                     'class': cls.__name__.lower(),
303.                     'model_name': cls._meta.model_name.lower(),
304.                     'app_label': cls._meta.app_label.lower()
305.                 }
306.                 self.remote_field.related_name = related_name
307. 
308.             if self.remote_field.related_query_name:
309.                 related_query_name = self.remote_field.related_query_name % {
310.                     'class': cls.__name__.lower(),
311.                     'app_label': cls._meta.app_label.lower(),
312.                 }
313.                 self.remote_field.related_query_name = related_query_name
314. 
315.             def resolve_related_class(model, related, field):
316.                 field.remote_field.model = related
317.                 field.do_related_class(related, model)
318.             lazy_related_operation(resolve_related_class, cls, self.remote_field.model, field=self)
319. 
320.     def deconstruct(self):
321.         name, path, args, kwargs = super().deconstruct()
322.         if self.remote_field.limit_choices_to:
323.             kwargs['limit_choices_to'] = self.remote_field.limit_choices_to
324.         if self.remote_field.related_name is not None:
325.             kwargs['related_name'] = self.remote_field.related_name
326.         if self.remote_field.related_query_name is not None:
327.             kwargs['related_query_name'] = self.remote_field.related_query_name
328.         return name, path, args, kwargs
329. 
330.     def get_forward_related_filter(self, obj):
331.         """
332.         Return the keyword arguments that when supplied to
333.         self.model.object.filter(), would select all instances related through
334.         this field to the remote obj. This is used to build the querysets
335.         returned by related descriptors. obj is an instance of
336.         self.related_field.model.
337.         """
338.         return {
339.             '%s__%s' % (self.name, rh_field.name): getattr(obj, rh_field.attname)
340.             for _, rh_field in self.related_fields
341.         }
342. 
343.     def get_reverse_related_filter(self, obj):
344.         """
345.         Complement to get_forward_related_filter(). Return the keyword
346.         arguments that when passed to self.related_field.model.object.filter()
347.         select all instances of self.related_field.model related through
348.         this field to obj. obj is an instance of self.model.
349.         """
350.         base_filter = {
351.             rh_field.attname: getattr(obj, lh_field.attname)
352.             for lh_field, rh_field in self.related_fields
353.         }
354.         descriptor_filter = self.get_extra_descriptor_filter(obj)
355.         base_q = Q(**base_filter)
356.         if isinstance(descriptor_filter, dict):
357.             return base_q & Q(**descriptor_filter)
358.         elif descriptor_filter:
359.             return base_q & descriptor_filter
360.         return base_q
361. 
362.     @property
363.     def swappable_setting(self):
364.         """
365.         Get the setting that this is powered from for swapping, or None
366.         if it's not swapped in / marked with swappable=False.
367.         """
368.         if self.swappable:
369.             # Work out string form of "to"
370.             if isinstance(self.remote_field.model, str):
371.                 to_string = self.remote_field.model
372.             else:
373.                 to_string = self.remote_field.model._meta.label
374.             return apps.get_swappable_settings_name(to_string)
375.         return None
376. 
377.     def set_attributes_from_rel(self):
378.         self.name = (
379.             self.name or
380.             (self.remote_field.model._meta.model_name + '_' + self.remote_field.model._meta.pk.name)
381.         )
382.         if self.verbose_name is None:
383.             self.verbose_name = self.remote_field.model._meta.verbose_name
384.         self.remote_field.set_field_name()
385. 
386.     def do_related_class(self, other, cls):
387.         self.set_attributes_from_rel()
388.         self.contribute_to_related_class(other, self.remote_field)
389. 
390.     def get_limit_choices_to(self):
391.         """
392.         Return ``limit_choices_to`` for this model field.
393. 
394.         If it is a callable, it will be invoked and the result will be
395.         returned.
396.         """
397.         if callable(self.remote_field.limit_choices_to):
398.             return self.remote_field.limit_choices_to()
399.         return self.remote_field.limit_choices_to
400. 
401.     def formfield(self, **kwargs):
402.         """
403.         Pass ``limit_choices_to`` to the field being constructed.
404. 
405.         Only passes it if there is a type that supports related fields.
406.         This is a similar strategy used to pass the ``queryset`` to the field
407.         being constructed.
408.         """
409.         defaults = {}
410.         if hasattr(self.remote_field, 'get_related_field'):
411.             # If this is a callable, do not invoke it here. Just pass
412.             # it in the defaults for when the form class will later be
413.             # instantiated.
414.             limit_choices_to = self.remote_field.limit_choices_to
415.             defaults.update({
416.                 'limit_choices_to': limit_choices_to,
417.             })
418.         defaults.update(kwargs)
419.         return super().formfield(**defaults)
420. 
421.     def related_query_name(self):
422.         """
423.         Define the name that can be used to identify this related object in a
424.         table-spanning query.
425.         """
426.         return self.remote_field.related_query_name or self.remote_field.related_name or self.opts.model_name
427. 
428.     @property
429.     def target_field(self):
430.         """
431.         When filtering against this relation, return the field on the remote
432.         model against which the filtering should happen.
433.         """
434.         target_fields = self.get_path_info()[-1].target_fields
435.         if len(target_fields) > 1:
436.             raise exceptions.FieldError(
437.                 "The relation has multiple target fields, but only single target field was asked for")
438.         return target_fields[0]
439. 
440.     def get_cache_name(self):
441.         return self.name
442. 
443. 
444. class ForeignObject(RelatedField):
445.     """
446.     Abstraction of the ForeignKey relation to support multi-column relations.
447.     """
448. 
449.     # Field flags
450.     many_to_many = False
451.     many_to_one = True
452.     one_to_many = False
453.     one_to_one = False
454. 
455.     requires_unique_target = True
456.     related_accessor_class = ReverseManyToOneDescriptor
457.     forward_related_accessor_class = ForwardManyToOneDescriptor
458.     rel_class = ForeignObjectRel
459. 
460.     def __init__(self, to, on_delete, from_fields, to_fields, rel=None, related_name=None,
461.                  related_query_name=None, limit_choices_to=None, parent_link=False,
462.                  swappable=True, **kwargs):
463. 
464.         if rel is None:
465.             rel = self.rel_class(
466.                 self, to,
467.                 related_name=related_name,
468.                 related_query_name=related_query_name,
469.                 limit_choices_to=limit_choices_to,
470.                 parent_link=parent_link,
471.                 on_delete=on_delete,
472.             )
473. 
474.         super().__init__(rel=rel, **kwargs)
475. 
476.         self.from_fields = from_fields
477.         self.to_fields = to_fields
478.         self.swappable = swappable
479. 
480.     def check(self, **kwargs):
481.         return [
482.             *super().check(**kwargs),
483.             *self._check_to_fields_exist(),
484.             *self._check_unique_target(),
485.         ]
486. 
487.     def _check_to_fields_exist(self):
488.         # Skip nonexistent models.
489.         if isinstance(self.remote_field.model, str):
490.             return []
491. 
492.         errors = []
493.         for to_field in self.to_fields:
494.             if to_field:
495.                 try:
496.                     self.remote_field.model._meta.get_field(to_field)
497.                 except exceptions.FieldDoesNotExist:
498.                     errors.append(
499.                         checks.Error(
500.                             "The to_field '%s' doesn't exist on the related "
501.                             "model '%s'."
502.                             % (to_field, self.remote_field.model._meta.label),
503.                             obj=self,
504.                             id='fields.E312',
505.                         )
506.                     )
507.         return errors
508. 
509.     def _check_unique_target(self):
510.         rel_is_string = isinstance(self.remote_field.model, str)
511.         if rel_is_string or not self.requires_unique_target:
512.             return []
513. 
514.         try:
515.             self.foreign_related_fields
516.         except exceptions.FieldDoesNotExist:
517.             return []
518. 
519.         if not self.foreign_related_fields:
520.             return []
521. 
522.         unique_foreign_fields = {
523.             frozenset([f.name])
524.             for f in self.remote_field.model._meta.get_fields()
525.             if getattr(f, 'unique', False)
526.         }
527.         unique_foreign_fields.update({
528.             frozenset(ut)
529.             for ut in self.remote_field.model._meta.unique_together
530.         })
531.         unique_foreign_fields.update({
532.             frozenset(uc.fields)
533.             for uc in self.remote_field.model._meta.total_unique_constraints
534.         })
535.         foreign_fields = {f.name for f in self.foreign_related_fields}
536.         has_unique_constraint = any(u <= foreign_fields for u in unique_foreign_fields)
537. 
538.         if not has_unique_constraint and len(self.foreign_related_fields) > 1:
539.             field_combination = ', '.join(
540.                 "'%s'" % rel_field.name for rel_field in self.foreign_related_fields
541.             )
542.             model_name = self.remote_field.model.__name__
543.             return [
544.                 checks.Error(
545.                     "No subset of the fields %s on model '%s' is unique."
546.                     % (field_combination, model_name),
547.                     hint=(
548.                         'Mark a single field as unique=True or add a set of '
549.                         'fields to a unique constraint (via unique_together '
550.                         'or a UniqueConstraint (without condition) in the '
551.                         'model Meta.constraints).'
552.                     ),
553.                     obj=self,
554.                     id='fields.E310',
555.                 )
556.             ]
557.         elif not has_unique_constraint:
558.             field_name = self.foreign_related_fields[0].name
559.             model_name = self.remote_field.model.__name__
560.             return [
561.                 checks.Error(
562.                     "'%s.%s' must be unique because it is referenced by "
563.                     "a foreign key." % (model_name, field_name),
564.                     hint=(
565.                         'Add unique=True to this field or add a '
566.                         'UniqueConstraint (without condition) in the model '
567.                         'Meta.constraints.'
568.                     ),
569.                     obj=self,
570.                     id='fields.E311',
571.                 )
572.             ]
573.         else:
574.             return []
575. 
576.     def deconstruct(self):
577.         name, path, args, kwargs = super().deconstruct()
578.         kwargs['on_delete'] = self.remote_field.on_delete
579.         kwargs['from_fields'] = self.from_fields
580.         kwargs['to_fields'] = self.to_fields
581. 
582.         if self.remote_field.parent_link:
583.             kwargs['parent_link'] = self.remote_field.parent_link
584.         if isinstance(self.remote_field.model, str):
585.             kwargs['to'] = self.remote_field.model.lower()
586.         else:
587.             kwargs['to'] = self.remote_field.model._meta.label_lower
588.         # If swappable is True, then see if we're actually pointing to the target
589.         # of a swap.
590.         swappable_setting = self.swappable_setting
591.         if swappable_setting is not None:
592.             # If it's already a settings reference, error
593.             if hasattr(kwargs['to'], "setting_name"):
594.                 if kwargs['to'].setting_name != swappable_setting:
595.                     raise ValueError(
596.                         "Cannot deconstruct a ForeignKey pointing to a model "
597.                         "that is swapped in place of more than one model (%s and %s)"
598.                         % (kwargs['to'].setting_name, swappable_setting)
599.                     )
600.             # Set it
601.             kwargs['to'] = SettingsReference(
602.                 kwargs['to'],
603.                 swappable_setting,
604.             )
605.         return name, path, args, kwargs
606. 
607.     def resolve_related_fields(self):
608.         if not self.from_fields or len(self.from_fields) != len(self.to_fields):
609.             raise ValueError('Foreign Object from and to fields must be the same non-zero length')
610.         if isinstance(self.remote_field.model, str):
611.             raise ValueError('Related model %r cannot be resolved' % self.remote_field.model)
612.         related_fields = []
613.         for index in range(len(self.from_fields)):
614.             from_field_name = self.from_fields[index]
615.             to_field_name = self.to_fields[index]
616.             from_field = (
617.                 self
618.                 if from_field_name == RECURSIVE_RELATIONSHIP_CONSTANT
619.                 else self.opts.get_field(from_field_name)
620.             )
621.             to_field = (self.remote_field.model._meta.pk if to_field_name is None
622.                         else self.remote_field.model._meta.get_field(to_field_name))
623.             related_fields.append((from_field, to_field))
624.         return related_fields
625. 
626.     @cached_property
627.     def related_fields(self):
628.         return self.resolve_related_fields()
629. 
630.     @cached_property
631.     def reverse_related_fields(self):
632.         return [(rhs_field, lhs_field) for lhs_field, rhs_field in self.related_fields]
633. 
634.     @cached_property
635.     def local_related_fields(self):
636.         return tuple(lhs_field for lhs_field, rhs_field in self.related_fields)
637. 
638.     @cached_property
639.     def foreign_related_fields(self):
640.         return tuple(rhs_field for lhs_field, rhs_field in self.related_fields if rhs_field)
641. 
642.     def get_local_related_value(self, instance):
643.         return self.get_instance_value_for_fields(instance, self.local_related_fields)
644. 
645.     def get_foreign_related_value(self, instance):
646.         return self.get_instance_value_for_fields(instance, self.foreign_related_fields)
647. 
648.     @staticmethod
649.     def get_instance_value_for_fields(instance, fields):
650.         ret = []
651.         opts = instance._meta
652.         for field in fields:
653.             # Gotcha: in some cases (like fixture loading) a model can have
654.             # different values in parent_ptr_id and parent's id. So, use
655.             # instance.pk (that is, parent_ptr_id) when asked for instance.id.
656.             if field.primary_key:
657.                 possible_parent_link = opts.get_ancestor_link(field.model)
658.                 if (not possible_parent_link or
659.                         possible_parent_link.primary_key or
660.                         possible_parent_link.model._meta.abstract):
661.                     ret.append(instance.pk)
662.                     continue
663.             ret.append(getattr(instance, field.attname))
664.         return tuple(ret)
665. 
666.     def get_attname_column(self):
667.         attname, column = super().get_attname_column()
668.         return attname, None
669. 
670.     def get_joining_columns(self, reverse_join=False):
671.         source = self.reverse_related_fields if reverse_join else self.related_fields
672.         return tuple((lhs_field.column, rhs_field.column) for lhs_field, rhs_field in source)
673. 
674.     def get_reverse_joining_columns(self):
675.         return self.get_joining_columns(reverse_join=True)
676. 
677.     def get_extra_descriptor_filter(self, instance):
678.         """
679.         Return an extra filter condition for related object fetching when
680.         user does 'instance.fieldname', that is the extra filter is used in
681.         the descriptor of the field.
682. 
683.         The filter should be either a dict usable in .filter(**kwargs) call or
684.         a Q-object. The condition will be ANDed together with the relation's
685.         joining columns.
686. 
687.         A parallel method is get_extra_restriction() which is used in
688.         JOIN and subquery conditions.
689.         """
690.         return {}
691. 
692.     def get_extra_restriction(self, where_class, alias, related_alias):
693.         """
694.         Return a pair condition used for joining and subquery pushdown. The
695.         condition is something that responds to as_sql(compiler, connection)
696.         method.
697. 
698.         Note that currently referring both the 'alias' and 'related_alias'
699.         will not work in some conditions, like subquery pushdown.
700. 
701.         A parallel method is get_extra_descriptor_filter() which is used in
702.         instance.fieldname related object fetching.
703.         """
704.         return None
705. 
706.     def get_path_info(self, filtered_relation=None):
707.         """Get path from this field to the related model."""
708.         opts = self.remote_field.model._meta
709.         from_opts = self.model._meta
710.         return [PathInfo(
711.             from_opts=from_opts,
712.             to_opts=opts,
713.             target_fields=self.foreign_related_fields,
714.             join_field=self,
715.             m2m=False,
716.             direct=True,
717.             filtered_relation=filtered_relation,
718.         )]
719. 
720.     def get_reverse_path_info(self, filtered_relation=None):
721.         """Get path from the related model to this field's model."""
722.         opts = self.model._meta
723.         from_opts = self.remote_field.model._meta
724.         return [PathInfo(
725.             from_opts=from_opts,
726.             to_opts=opts,
727.             target_fields=(opts.pk,),
728.             join_field=self.remote_field,
729.             m2m=not self.unique,
730.             direct=False,
731.             filtered_relation=filtered_relation,
732.         )]
733. 
734.     @classmethod
735.     @functools.lru_cache(maxsize=None)
736.     def get_lookups(cls):
737.         bases = inspect.getmro(cls)
738.         bases = bases[:bases.index(ForeignObject) + 1]
739.         class_lookups = [parent.__dict__.get('class_lookups', {}) for parent in bases]
740.         return cls.merge_dicts(class_lookups)
741. 
742.     def contribute_to_class(self, cls, name, private_only=False, **kwargs):
743.         super().contribute_to_class(cls, name, private_only=private_only, **kwargs)
744.         setattr(cls, self.name, self.forward_related_accessor_class(self))
745. 
746.     def contribute_to_related_class(self, cls, related):
747.         # Internal FK's - i.e., those with a related name ending with '+' -
748.         # and swapped models don't get a related descriptor.
749.         if not self.remote_field.is_hidden() and not related.related_model._meta.swapped:
750.             setattr(cls._meta.concrete_model, related.get_accessor_name(), self.related_accessor_class(related))
751.             # While 'limit_choices_to' might be a callable, simply pass
752.             # it along for later - this is too early because it's still
753.             # model load time.
754.             if self.remote_field.limit_choices_to:
755.                 cls._meta.related_fkey_lookups.append(self.remote_field.limit_choices_to)
756. 
757. 
758. ForeignObject.register_lookup(RelatedIn)
759. ForeignObject.register_lookup(RelatedExact)
760. ForeignObject.register_lookup(RelatedLessThan)
761. ForeignObject.register_lookup(RelatedGreaterThan)
762. ForeignObject.register_lookup(RelatedGreaterThanOrEqual)
763. ForeignObject.register_lookup(RelatedLessThanOrEqual)
764. ForeignObject.register_lookup(RelatedIsNull)
765. 
766. 
767. class ForeignKey(ForeignObject):
768.     """
769.     Provide a many-to-one relation by adding a column to the local model
770.     to hold the remote value.
771. 
772.     By default ForeignKey will target the pk of the remote model but this
773.     behavior can be changed by using the ``to_field`` argument.
774.     """
775.     descriptor_class = ForeignKeyDeferredAttribute
776.     # Field flags
777.     many_to_many = False
778.     many_to_one = True
779.     one_to_many = False
780.     one_to_one = False
781. 
782.     rel_class = ManyToOneRel
783. 
784.     empty_strings_allowed = False
785.     default_error_messages = {
786.         'invalid': _('%(model)s instance with %(field)s %(value)r does not exist.')
787.     }
788.     description = _("Foreign Key (type determined by related field)")
789. 
790.     def __init__(self, to, on_delete, related_name=None, related_query_name=None,
791.                  limit_choices_to=None, parent_link=False, to_field=None,
792.                  db_constraint=True, **kwargs):
793.         try:
794.             to._meta.model_name
795.         except AttributeError:
796.             assert isinstance(to, str), (
797.                 "%s(%r) is invalid. First parameter to ForeignKey must be "
798.                 "either a model, a model name, or the string %r" % (
799.                     self.__class__.__name__, to,
800.                     RECURSIVE_RELATIONSHIP_CONSTANT,
801.                 )
802.             )
803.         else:
804.             # For backwards compatibility purposes, we need to *try* and set
805.             # the to_field during FK construction. It won't be guaranteed to
806.             # be correct until contribute_to_class is called. Refs #12190.
807.             to_field = to_field or (to._meta.pk and to._meta.pk.name)
808.         if not callable(on_delete):
809.             raise TypeError('on_delete must be callable.')
810. 
811.         kwargs['rel'] = self.rel_class(
812.             self, to, to_field,
813.             related_name=related_name,
814.             related_query_name=related_query_name,
815.             limit_choices_to=limit_choices_to,
816.             parent_link=parent_link,
817.             on_delete=on_delete,
818.         )
819.         kwargs.setdefault('db_index', True)
820. 
821.         super().__init__(
822.             to,
823.             on_delete,
824.             from_fields=[RECURSIVE_RELATIONSHIP_CONSTANT],
825.             to_fields=[to_field],
826.             **kwargs,
827.         )
828.         self.db_constraint = db_constraint
829. 
830.     def check(self, **kwargs):
831.         return [
832.             *super().check(**kwargs),
833.             *self._check_on_delete(),
834.             *self._check_unique(),
835.         ]
836. 
837.     def _check_on_delete(self):
838.         on_delete = getattr(self.remote_field, 'on_delete', None)
839.         if on_delete == SET_NULL and not self.null:
840.             return [
841.                 checks.Error(
842.                     'Field specifies on_delete=SET_NULL, but cannot be null.',
843.                     hint='Set null=True argument on the field, or change the on_delete rule.',
844.                     obj=self,
845.                     id='fields.E320',
846.                 )
847.             ]
848.         elif on_delete == SET_DEFAULT and not self.has_default():
849.             return [
850.                 checks.Error(
851.                     'Field specifies on_delete=SET_DEFAULT, but has no default value.',
852.                     hint='Set a default value, or change the on_delete rule.',
853.                     obj=self,
854.                     id='fields.E321',
855.                 )
856.             ]
857.         else:
858.             return []
859. 
860.     def _check_unique(self, **kwargs):
861.         return [
862.             checks.Warning(
863.                 'Setting unique=True on a ForeignKey has the same effect as using a OneToOneField.',
864.                 hint='ForeignKey(unique=True) is usually better served by a OneToOneField.',
865.                 obj=self,
866.                 id='fields.W342',
867.             )
868.         ] if self.unique else []
869. 
870.     def deconstruct(self):
871.         name, path, args, kwargs = super().deconstruct()
872.         del kwargs['to_fields']
873.         del kwargs['from_fields']
874.         # Handle the simpler arguments
875.         if self.db_index:
876.             del kwargs['db_index']
877.         else:
878.             kwargs['db_index'] = False
879.         if self.db_constraint is not True:
880.             kwargs['db_constraint'] = self.db_constraint
881.         # Rel needs more work.
882.         to_meta = getattr(self.remote_field.model, "_meta", None)
883.         if self.remote_field.field_name and (
884.                 not to_meta or (to_meta.pk and self.remote_field.field_name != to_meta.pk.name)):
885.             kwargs['to_field'] = self.remote_field.field_name
886.         return name, path, args, kwargs
887. 
888.     def to_python(self, value):
889.         return self.target_field.to_python(value)
890. 
891.     @property
892.     def target_field(self):
893.         return self.foreign_related_fields[0]
894. 
895.     def get_reverse_path_info(self, filtered_relation=None):
896.         """Get path from the related model to this field's model."""
897.         opts = self.model._meta
898.         from_opts = self.remote_field.model._meta
899.         return [PathInfo(
900.             from_opts=from_opts,
901.             to_opts=opts,
902.             target_fields=(opts.pk,),
903.             join_field=self.remote_field,
904.             m2m=not self.unique,
905.             direct=False,
906.             filtered_relation=filtered_relation,
907.         )]
908. 
909.     def validate(self, value, model_instance):
910.         if self.remote_field.parent_link:
911.             return
912.         super().validate(value, model_instance)
913.         if value is None:
914.             return
915. 
916.         using = router.db_for_read(self.remote_field.model, instance=model_instance)
917.         qs = self.remote_field.model._default_manager.using(using).filter(
918.             **{self.remote_field.field_name: value}
919.         )
920.         qs = qs.complex_filter(self.get_limit_choices_to())
921.         if not qs.exists():
922.             raise exceptions.ValidationError(
923.                 self.error_messages['invalid'],
924.                 code='invalid',
925.                 params={
926.                     'model': self.remote_field.model._meta.verbose_name, 'pk': value,
927.                     'field': self.remote_field.field_name, 'value': value,
928.                 },  # 'pk' is included for backwards compatibility
929.             )
930. 
931.     def resolve_related_fields(self):
932.         related_fields = super().resolve_related_fields()
933.         for from_field, to_field in related_fields:
934.             if to_field and to_field.model != self.remote_field.model._meta.concrete_model:
935.                 raise exceptions.FieldError(
936.                     "'%s.%s' refers to field '%s' which is not local to model "
937.                     "'%s'." % (
938.                         self.model._meta.label,
939.                         self.name,
940.                         to_field.name,
941.                         self.remote_field.model._meta.concrete_model._meta.label,
942.                     )
943.                 )
944.         return related_fields
945. 
946.     def get_attname(self):
947.         return '%s_id' % self.name
948. 
949.     def get_attname_column(self):
950.         attname = self.get_attname()
951.         column = self.db_column or attname
952.         return attname, column
953. 
954.     def get_default(self):
955.         """Return the to_field if the default value is an object."""
956.         field_default = super().get_default()
957.         if isinstance(field_default, self.remote_field.model):
958.             return getattr(field_default, self.target_field.attname)
959.         return field_default
960. 
961.     def get_db_prep_save(self, value, connection):
962.         if value is None or (value == '' and
963.                              (not self.target_field.empty_strings_allowed or
964.                               connection.features.interprets_empty_strings_as_nulls)):
965.             return None
966.         else:
967.             return self.target_field.get_db_prep_save(value, connection=connection)
968. 
969.     def get_db_prep_value(self, value, connection, prepared=False):
970.         return self.target_field.get_db_prep_value(value, connection, prepared)
971. 
972.     def get_prep_value(self, value):
973.         return self.target_field.get_prep_value(value)
974. 
975.     def contribute_to_related_class(self, cls, related):
976.         super().contribute_to_related_class(cls, related)
977.         if self.remote_field.field_name is None:
978.             self.remote_field.field_name = cls._meta.pk.name
979. 
980.     def formfield(self, *, using=None, **kwargs):
981.         if isinstance(self.remote_field.model, str):
982.             raise ValueError("Cannot create form field for %r yet, because "
983.                              "its related model %r has not been loaded yet" %
984.                              (self.name, self.remote_field.model))
985.         return super().formfield(**{
986.             'form_class': forms.ModelChoiceField,
987.             'queryset': self.remote_field.model._default_manager.using(using),
988.             'to_field_name': self.remote_field.field_name,
989.             **kwargs,
990.             'blank': self.blank,
991.         })
992. 
993.     def db_check(self, connection):
994.         return []
995. 
996.     def db_type(self, connection):
997.         return self.target_field.rel_db_type(connection=connection)
998. 
999.     def db_parameters(self, connection):
1000.         return {"type": self.db_type(connection), "check": self.db_check(connection)}
1001. 
1002.     def convert_empty_strings(self, value, expression, connection):
1003.         if (not value) and isinstance(value, str):
1004.             return None
1005.         return value
1006. 
1007.     def get_db_converters(self, connection):
1008.         converters = super().get_db_converters(connection)
1009.         if connection.features.interprets_empty_strings_as_nulls:
1010.             converters += [self.convert_empty_strings]
1011.         return converters
1012. 
1013.     def get_col(self, alias, output_field=None):
1014.         if output_field is None:
1015.             output_field = self.target_field
1016.             while isinstance(output_field, ForeignKey):
1017.                 output_field = output_field.target_field
1018.                 if output_field is self:
1019.                     raise ValueError('Cannot resolve output_field.')
1020.         return super().get_col(alias, output_field)
1021. 
1022. 
1023. class OneToOneField(ForeignKey):
1024.     """
1025.     A OneToOneField is essentially the same as a ForeignKey, with the exception
1026.     that it always carries a "unique" constraint with it and the reverse
1027.     relation always returns the object pointed to (since there will only ever
1028.     be one), rather than returning a list.
1029.     """
1030. 
1031.     # Field flags
1032.     many_to_many = False
1033.     many_to_one = False
1034.     one_to_many = False
1035.     one_to_one = True
1036. 
1037.     related_accessor_class = ReverseOneToOneDescriptor
1038.     forward_related_accessor_class = ForwardOneToOneDescriptor
1039.     rel_class = OneToOneRel
1040. 
1041.     description = _("One-to-one relationship")
1042. 
1043.     def __init__(self, to, on_delete, to_field=None, **kwargs):
1044.         kwargs['unique'] = True
1045.         super().__init__(to, on_delete, to_field=to_field, **kwargs)
1046. 
1047.     def deconstruct(self):
1048.         name, path, args, kwargs = super().deconstruct()
1049.         if "unique" in kwargs:
1050.             del kwargs['unique']
1051.         return name, path, args, kwargs
1052. 
1053.     def formfield(self, **kwargs):
1054.         if self.remote_field.parent_link:
1055.             return None
1056.         return super().formfield(**kwargs)
1057. 
1058.     def save_form_data(self, instance, data):
1059.         if isinstance(data, self.remote_field.model):
1060.             setattr(instance, self.name, data)
1061.         else:
1062.             setattr(instance, self.attname, data)
1063.             # Remote field object must be cleared otherwise Model.save()
1064.             # will reassign attname using the related object pk.
1065.             if data is None:
1066.                 setattr(instance, self.name, data)
1067. 
1068.     def _check_unique(self, **kwargs):
1069.         # Override ForeignKey since check isn't applicable here.
1070.         return []
1071. 
1072. 
1073. def create_many_to_many_intermediary_model(field, klass):
1074.     from django.db import models
1075. 
1076.     def set_managed(model, related, through):
1077.         through._meta.managed = model._meta.managed or related._meta.managed
1078. 
1079.     to_model = resolve_relation(klass, field.remote_field.model)
1080.     name = '%s_%s' % (klass._meta.object_name, field.name)
1081.     lazy_related_operation(set_managed, klass, to_model, name)
1082. 
1083.     to = make_model_tuple(to_model)[1]
1084.     from_ = klass._meta.model_name
1085.     if to == from_:
1086.         to = 'to_%s' % to
1087.         from_ = 'from_%s' % from_
1088. 
1089.     meta = type('Meta', (), {
1090.         'db_table': field._get_m2m_db_table(klass._meta),
1091.         'auto_created': klass,
1092.         'app_label': klass._meta.app_label,
1093.         'db_tablespace': klass._meta.db_tablespace,
1094.         'unique_together': (from_, to),
1095.         'verbose_name': _('%(from)s-%(to)s relationship') % {'from': from_, 'to': to},
1096.         'verbose_name_plural': _('%(from)s-%(to)s relationships') % {'from': from_, 'to': to},
1097.         'apps': field.model._meta.apps,
1098.     })
1099.     # Construct and return the new class.
1100.     return type(name, (models.Model,), {
1101.         'Meta': meta,
1102.         '__module__': klass.__module__,
1103.         from_: models.ForeignKey(
1104.             klass,
1105.             related_name='%s+' % name,
1106.             db_tablespace=field.db_tablespace,
1107.             db_constraint=field.remote_field.db_constraint,
1108.             on_delete=CASCADE,
1109.         ),
1110.         to: models.ForeignKey(
1111.             to_model,
1112.             related_name='%s+' % name,
1113.             db_tablespace=field.db_tablespace,
1114.             db_constraint=field.remote_field.db_constraint,
1115.             on_delete=CASCADE,
1116.         )
1117.     })
1118. 
1119. 
1120. class ManyToManyField(RelatedField):
1121.     """
1122.     Provide a many-to-many relation by using an intermediary model that
1123.     holds two ForeignKey fields pointed at the two sides of the relation.
1124. 
1125.     Unless a ``through`` model was provided, ManyToManyField will use the
1126.     create_many_to_many_intermediary_model factory to automatically generate
1127.     the intermediary model.
1128.     """
1129. 
1130.     # Field flags
1131.     many_to_many = True
1132.     many_to_one = False
1133.     one_to_many = False
1134.     one_to_one = False
1135. 
1136.     rel_class = ManyToManyRel
1137. 
1138.     description = _("Many-to-many relationship")
1139. 
1140.     def __init__(self, to, related_name=None, related_query_name=None,
1141.                  limit_choices_to=None, symmetrical=None, through=None,
1142.                  through_fields=None, db_constraint=True, db_table=None,
1143.                  swappable=True, **kwargs):
1144.         try:
1145.             to._meta
1146.         except AttributeError:
1147.             assert isinstance(to, str), (
1148.                 "%s(%r) is invalid. First parameter to ManyToManyField must be "
1149.                 "either a model, a model name, or the string %r" %
1150.                 (self.__class__.__name__, to, RECURSIVE_RELATIONSHIP_CONSTANT)
1151.             )
1152. 
1153.         if symmetrical is None:
1154.             symmetrical = (to == RECURSIVE_RELATIONSHIP_CONSTANT)
1155. 
1156.         if through is not None:
1157.             assert db_table is None, (
1158.                 "Cannot specify a db_table if an intermediary model is used."
1159.             )
1160. 
1161.         kwargs['rel'] = self.rel_class(
1162.             self, to,
1163.             related_name=related_name,
1164.             related_query_name=related_query_name,
1165.             limit_choices_to=limit_choices_to,
1166.             symmetrical=symmetrical,
1167.             through=through,
1168.             through_fields=through_fields,
1169.             db_constraint=db_constraint,
1170.         )
1171.         self.has_null_arg = 'null' in kwargs
1172. 
1173.         super().__init__(**kwargs)
1174. 
1175.         self.db_table = db_table
1176.         self.swappable = swappable
1177. 
1178.     def check(self, **kwargs):
1179.         return [
1180.             *super().check(**kwargs),
1181.             *self._check_unique(**kwargs),
1182.             *self._check_relationship_model(**kwargs),
1183.             *self._check_ignored_options(**kwargs),
1184.             *self._check_table_uniqueness(**kwargs),
1185.         ]
1186. 
1187.     def _check_unique(self, **kwargs):
1188.         if self.unique:
1189.             return [
1190.                 checks.Error(
1191.                     'ManyToManyFields cannot be unique.',
1192.                     obj=self,
1193.                     id='fields.E330',
1194.                 )
1195.             ]
1196.         return []
1197. 
1198.     def _check_ignored_options(self, **kwargs):
1199.         warnings = []
1200. 
1201.         if self.has_null_arg:
1202.             warnings.append(
1203.                 checks.Warning(
1204.                     'null has no effect on ManyToManyField.',
1205.                     obj=self,
1206.                     id='fields.W340',
1207.                 )
1208.             )
1209. 
1210.         if self._validators:
1211.             warnings.append(
1212.                 checks.Warning(
1213.                     'ManyToManyField does not support validators.',
1214.                     obj=self,
1215.                     id='fields.W341',
1216.                 )
1217.             )
1218.         if (self.remote_field.limit_choices_to and self.remote_field.through and
1219.                 not self.remote_field.through._meta.auto_created):
1220.             warnings.append(
1221.                 checks.Warning(
1222.                     'limit_choices_to has no effect on ManyToManyField '
1223.                     'with a through model.',
1224.                     obj=self,
1225.                     id='fields.W343',
1226.                 )
1227.             )
1228. 
1229.         return warnings
1230. 
1231.     def _check_relationship_model(self, from_model=None, **kwargs):
1232.         if hasattr(self.remote_field.through, '_meta'):
1233.             qualified_model_name = "%s.%s" % (
1234.                 self.remote_field.through._meta.app_label, self.remote_field.through.__name__)
1235.         else:
1236.             qualified_model_name = self.remote_field.through
1237. 
1238.         errors = []
1239. 
1240.         if self.remote_field.through not in self.opts.apps.get_models(include_auto_created=True):
1241.             # The relationship model is not installed.
1242.             errors.append(
1243.                 checks.Error(
1244.                     "Field specifies a many-to-many relation through model "
1245.                     "'%s', which has not been installed." % qualified_model_name,
1246.                     obj=self,
1247.                     id='fields.E331',
1248.                 )
1249.             )
1250. 
1251.         else:
1252.             assert from_model is not None, (
1253.                 "ManyToManyField with intermediate "
1254.                 "tables cannot be checked if you don't pass the model "
1255.                 "where the field is attached to."
1256.             )
1257.             # Set some useful local variables
1258.             to_model = resolve_relation(from_model, self.remote_field.model)
1259.             from_model_name = from_model._meta.object_name
1260.             if isinstance(to_model, str):
1261.                 to_model_name = to_model
1262.             else:
1263.                 to_model_name = to_model._meta.object_name
1264.             relationship_model_name = self.remote_field.through._meta.object_name
1265.             self_referential = from_model == to_model
1266.             # Count foreign keys in intermediate model
1267.             if self_referential:
1268.                 seen_self = sum(
1269.                     from_model == getattr(field.remote_field, 'model', None)
1270.                     for field in self.remote_field.through._meta.fields
1271.                 )
1272. 
1273.                 if seen_self > 2 and not self.remote_field.through_fields:
1274.                     errors.append(
1275.                         checks.Error(
1276.                             "The model is used as an intermediate model by "
1277.                             "'%s', but it has more than two foreign keys "
1278.                             "to '%s', which is ambiguous. You must specify "
1279.                             "which two foreign keys Django should use via the "
1280.                             "through_fields keyword argument." % (self, from_model_name),
1281.                             hint="Use through_fields to specify which two foreign keys Django should use.",
1282.                             obj=self.remote_field.through,
1283.                             id='fields.E333',
1284.                         )
1285.                     )
1286. 
1287.             else:
1288.                 # Count foreign keys in relationship model
1289.                 seen_from = sum(
1290.                     from_model == getattr(field.remote_field, 'model', None)
1291.                     for field in self.remote_field.through._meta.fields
1292.                 )
1293.                 seen_to = sum(
1294.                     to_model == getattr(field.remote_field, 'model', None)
1295.                     for field in self.remote_field.through._meta.fields
1296.                 )
1297. 
1298.                 if seen_from > 1 and not self.remote_field.through_fields:
1299.                     errors.append(
1300.                         checks.Error(
1301.                             ("The model is used as an intermediate model by "
1302.                              "'%s', but it has more than one foreign key "
1303.                              "from '%s', which is ambiguous. You must specify "
1304.                              "which foreign key Django should use via the "
1305.                              "through_fields keyword argument.") % (self, from_model_name),
1306.                             hint=(
1307.                                 'If you want to create a recursive relationship, '
1308.                                 'use ManyToManyField("%s", through="%s").'
1309.                             ) % (
1310.                                 RECURSIVE_RELATIONSHIP_CONSTANT,
1311.                                 relationship_model_name,
1312.                             ),
1313.                             obj=self,
1314.                             id='fields.E334',
1315.                         )
1316.                     )
1317. 
1318.                 if seen_to > 1 and not self.remote_field.through_fields:
1319.                     errors.append(
1320.                         checks.Error(
1321.                             "The model is used as an intermediate model by "
1322.                             "'%s', but it has more than one foreign key "
1323.                             "to '%s', which is ambiguous. You must specify "
1324.                             "which foreign key Django should use via the "
1325.                             "through_fields keyword argument." % (self, to_model_name),
1326.                             hint=(
1327.                                 'If you want to create a recursive relationship, '
1328.                                 'use ManyToManyField("%s", through="%s").'
1329.                             ) % (
1330.                                 RECURSIVE_RELATIONSHIP_CONSTANT,
1331.                                 relationship_model_name,
1332.                             ),
1333.                             obj=self,
1334.                             id='fields.E335',
1335.                         )
1336.                     )
1337. 
1338.                 if seen_from == 0 or seen_to == 0:
1339.                     errors.append(
1340.                         checks.Error(
1341.                             "The model is used as an intermediate model by "
1342.                             "'%s', but it does not have a foreign key to '%s' or '%s'." % (
1343.                                 self, from_model_name, to_model_name
1344.                             ),
1345.                             obj=self.remote_field.through,
1346.                             id='fields.E336',
1347.                         )
1348.                     )
1349. 
1350.         # Validate `through_fields`.
1351.         if self.remote_field.through_fields is not None:
1352.             # Validate that we're given an iterable of at least two items
1353.             # and that none of them is "falsy".
1354.             if not (len(self.remote_field.through_fields) >= 2 and
1355.                     self.remote_field.through_fields[0] and self.remote_field.through_fields[1]):
1356.                 errors.append(
1357.                     checks.Error(
1358.                         "Field specifies 'through_fields' but does not provide "
1359.                         "the names of the two link fields that should be used "
1360.                         "for the relation through model '%s'." % qualified_model_name,
1361.                         hint="Make sure you specify 'through_fields' as through_fields=('field1', 'field2')",
1362.                         obj=self,
1363.                         id='fields.E337',
1364.                     )
1365.                 )
1366. 
1367.             # Validate the given through fields -- they should be actual
1368.             # fields on the through model, and also be foreign keys to the
1369.             # expected models.
1370.             else:
1371.                 assert from_model is not None, (
1372.                     "ManyToManyField with intermediate "
1373.                     "tables cannot be checked if you don't pass the model "
1374.                     "where the field is attached to."
1375.                 )
1376. 
1377.                 source, through, target = from_model, self.remote_field.through, self.remote_field.model
1378.                 source_field_name, target_field_name = self.remote_field.through_fields[:2]
1379. 
1380.                 for field_name, related_model in ((source_field_name, source),
1381.                                                   (target_field_name, target)):
1382. 
1383.                     possible_field_names = []
1384.                     for f in through._meta.fields:
1385.                         if hasattr(f, 'remote_field') and getattr(f.remote_field, 'model', None) == related_model:
1386.                             possible_field_names.append(f.name)
1387.                     if possible_field_names:
1388.                         hint = "Did you mean one of the following foreign keys to '%s': %s?" % (
1389.                             related_model._meta.object_name,
1390.                             ', '.join(possible_field_names),
1391.                         )
1392.                     else:
1393.                         hint = None
1394. 
1395.                     try:
1396.                         field = through._meta.get_field(field_name)
1397.                     except exceptions.FieldDoesNotExist:
1398.                         errors.append(
1399.                             checks.Error(
1400.                                 "The intermediary model '%s' has no field '%s'."
1401.                                 % (qualified_model_name, field_name),
1402.                                 hint=hint,
1403.                                 obj=self,
1404.                                 id='fields.E338',
1405.                             )
1406.                         )
1407.                     else:
1408.                         if not (hasattr(field, 'remote_field') and
1409.                                 getattr(field.remote_field, 'model', None) == related_model):
1410.                             errors.append(
1411.                                 checks.Error(
1412.                                     "'%s.%s' is not a foreign key to '%s'." % (
1413.                                         through._meta.object_name, field_name,
1414.                                         related_model._meta.object_name,
1415.                                     ),
1416.                                     hint=hint,
1417.                                     obj=self,
1418.                                     id='fields.E339',
1419.                                 )
1420.                             )
1421. 
1422.         return errors
1423. 
1424.     def _check_table_uniqueness(self, **kwargs):
1425.         if isinstance(self.remote_field.through, str) or not self.remote_field.through._meta.managed:
1426.             return []
1427.         registered_tables = {
1428.             model._meta.db_table: model
1429.             for model in self.opts.apps.get_models(include_auto_created=True)
1430.             if model != self.remote_field.through and model._meta.managed
1431.         }
1432.         m2m_db_table = self.m2m_db_table()
1433.         model = registered_tables.get(m2m_db_table)
1434.         # The second condition allows multiple m2m relations on a model if
1435.         # some point to a through model that proxies another through model.
1436.         if model and model._meta.concrete_model != self.remote_field.through._meta.concrete_model:
1437.             if model._meta.auto_created:
1438.                 def _get_field_name(model):
1439.                     for field in model._meta.auto_created._meta.many_to_many:
1440.                         if field.remote_field.through is model:
1441.                             return field.name
1442.                 opts = model._meta.auto_created._meta
1443.                 clashing_obj = '%s.%s' % (opts.label, _get_field_name(model))
1444.             else:
1445.                 clashing_obj = model._meta.label
1446.             if settings.DATABASE_ROUTERS:
1447.                 error_class, error_id = checks.Warning, 'fields.W344'
1448.                 error_hint = (
1449.                     'You have configured settings.DATABASE_ROUTERS. Verify '
1450.                     'that the table of %r is correctly routed to a separate '
1451.                     'database.' % clashing_obj
1452.                 )
1453.             else:
1454.                 error_class, error_id = checks.Error, 'fields.E340'
1455.                 error_hint = None
1456.             return [
1457.                 error_class(
1458.                     "The field's intermediary table '%s' clashes with the "
1459.                     "table name of '%s'." % (m2m_db_table, clashing_obj),
1460.                     obj=self,
1461.                     hint=error_hint,
1462.                     id=error_id,
1463.                 )
1464.             ]
1465.         return []
1466. 
1467.     def deconstruct(self):
1468.         name, path, args, kwargs = super().deconstruct()
1469.         # Handle the simpler arguments.
1470.         if self.db_table is not None:
1471.             kwargs['db_table'] = self.db_table
1472.         if self.remote_field.db_constraint is not True:
1473.             kwargs['db_constraint'] = self.remote_field.db_constraint
1474.         # Rel needs more work.
1475.         if isinstance(self.remote_field.model, str):
1476.             kwargs['to'] = self.remote_field.model
1477.         else:
1478.             kwargs['to'] = "%s.%s" % (
1479.                 self.remote_field.model._meta.app_label,
1480.                 self.remote_field.model._meta.object_name,
1481.             )
1482.         if getattr(self.remote_field, 'through', None) is not None:
1483.             if isinstance(self.remote_field.through, str):
1484.                 kwargs['through'] = self.remote_field.through
1485.             elif not self.remote_field.through._meta.auto_created:
1486.                 kwargs['through'] = "%s.%s" % (
1487.                     self.remote_field.through._meta.app_label,
1488.                     self.remote_field.through._meta.object_name,
1489.                 )
1490.         # If swappable is True, then see if we're actually pointing to the target
1491.         # of a swap.
1492.         swappable_setting = self.swappable_setting
1493.         if swappable_setting is not None:
1494.             # If it's already a settings reference, error.
1495.             if hasattr(kwargs['to'], "setting_name"):
1496.                 if kwargs['to'].setting_name != swappable_setting:
1497.                     raise ValueError(
1498.                         "Cannot deconstruct a ManyToManyField pointing to a "
1499.                         "model that is swapped in place of more than one model "
1500.                         "(%s and %s)" % (kwargs['to'].setting_name, swappable_setting)
1501.                     )


File: django/db/models/manager.py
Line number range: 1 - 204
Content:
1. import copy
2. import inspect
3. from importlib import import_module
4. 
5. from django.db import router
6. from django.db.models.query import QuerySet
7. 
8. 
9. class BaseManager:
10.     # To retain order, track each time a Manager instance is created.
11.     creation_counter = 0
12. 
13.     # Set to True for the 'objects' managers that are automatically created.
14.     auto_created = False
15. 
16.     #: If set to True the manager will be serialized into migrations and will
17.     #: thus be available in e.g. RunPython operations.
18.     use_in_migrations = False
19. 
20.     def __new__(cls, *args, **kwargs):
21.         # Capture the arguments to make returning them trivial.
22.         obj = super().__new__(cls)
23.         obj._constructor_args = (args, kwargs)
24.         return obj
25. 
26.     def __init__(self):
27.         super().__init__()
28.         self._set_creation_counter()
29.         self.model = None
30.         self.name = None
31.         self._db = None
32.         self._hints = {}
33. 
34.     def __str__(self):
35.         """Return "app_label.model_label.manager_name"."""
36.         return '%s.%s' % (self.model._meta.label, self.name)
37. 
38.     def __class_getitem__(cls, *args, **kwargs):
39.         return cls
40. 
41.     def deconstruct(self):
42.         """
43.         Return a 5-tuple of the form (as_manager (True), manager_class,
44.         queryset_class, args, kwargs).
45. 
46.         Raise a ValueError if the manager is dynamically generated.
47.         """
48.         qs_class = self._queryset_class
49.         if getattr(self, '_built_with_as_manager', False):
50.             # using MyQuerySet.as_manager()
51.             return (
52.                 True,  # as_manager
53.                 None,  # manager_class
54.                 '%s.%s' % (qs_class.__module__, qs_class.__name__),  # qs_class
55.                 None,  # args
56.                 None,  # kwargs
57.             )
58.         else:
59.             module_name = self.__module__
60.             name = self.__class__.__name__
61.             # Make sure it's actually there and not an inner class
62.             module = import_module(module_name)
63.             if not hasattr(module, name):
64.                 raise ValueError(
65.                     "Could not find manager %s in %s.\n"
66.                     "Please note that you need to inherit from managers you "
67.                     "dynamically generated with 'from_queryset()'."
68.                     % (name, module_name)
69.                 )
70.             return (
71.                 False,  # as_manager
72.                 '%s.%s' % (module_name, name),  # manager_class
73.                 None,  # qs_class
74.                 self._constructor_args[0],  # args
75.                 self._constructor_args[1],  # kwargs
76.             )
77. 
78.     def check(self, **kwargs):
79.         return []
80. 
81.     @classmethod
82.     def _get_queryset_methods(cls, queryset_class):
83.         def create_method(name, method):
84.             def manager_method(self, *args, **kwargs):
85.                 return getattr(self.get_queryset(), name)(*args, **kwargs)
86.             manager_method.__name__ = method.__name__
87.             manager_method.__doc__ = method.__doc__
88.             return manager_method
89. 
90.         new_methods = {}
91.         for name, method in inspect.getmembers(queryset_class, predicate=inspect.isfunction):
92.             # Only copy missing methods.
93.             if hasattr(cls, name):
94.                 continue
95.             # Only copy public methods or methods with the attribute `queryset_only=False`.
96.             queryset_only = getattr(method, 'queryset_only', None)
97.             if queryset_only or (queryset_only is None and name.startswith('_')):
98.                 continue
99.             # Copy the method onto the manager.
100.             new_methods[name] = create_method(name, method)
101.         return new_methods
102. 
103.     @classmethod
104.     def from_queryset(cls, queryset_class, class_name=None):
105.         if class_name is None:
106.             class_name = '%sFrom%s' % (cls.__name__, queryset_class.__name__)
107.         return type(class_name, (cls,), {
108.             '_queryset_class': queryset_class,
109.             **cls._get_queryset_methods(queryset_class),
110.         })
111. 
112.     def contribute_to_class(self, model, name):
113.         self.name = self.name or name
114.         self.model = model
115. 
116.         setattr(model, name, ManagerDescriptor(self))
117. 
118.         model._meta.add_manager(self)
119. 
120.     def _set_creation_counter(self):
121.         """
122.         Set the creation counter value for this instance and increment the
123.         class-level copy.
124.         """
125.         self.creation_counter = BaseManager.creation_counter
126.         BaseManager.creation_counter += 1
127. 
128.     def db_manager(self, using=None, hints=None):
129.         obj = copy.copy(self)
130.         obj._db = using or self._db
131.         obj._hints = hints or self._hints
132.         return obj
133. 
134.     @property
135.     def db(self):
136.         return self._db or router.db_for_read(self.model, **self._hints)
137. 
138.     #######################
139.     # PROXIES TO QUERYSET #
140.     #######################
141. 
142.     def get_queryset(self):
143.         """
144.         Return a new QuerySet object. Subclasses can override this method to
145.         customize the behavior of the Manager.
146.         """
147.         return self._queryset_class(model=self.model, using=self._db, hints=self._hints)
148. 
149.     def all(self):
150.         # We can't proxy this method through the `QuerySet` like we do for the
151.         # rest of the `QuerySet` methods. This is because `QuerySet.all()`
152.         # works by creating a "copy" of the current queryset and in making said
153.         # copy, all the cached `prefetch_related` lookups are lost. See the
154.         # implementation of `RelatedManager.get_queryset()` for a better
155.         # understanding of how this comes into play.
156.         return self.get_queryset()
157. 
158.     def __eq__(self, other):
159.         return (
160.             isinstance(other, self.__class__) and
161.             self._constructor_args == other._constructor_args
162.         )
163. 
164.     def __hash__(self):
165.         return id(self)
166. 
167. 
168. class Manager(BaseManager.from_queryset(QuerySet)):
169.     pass
170. 
171. 
172. class ManagerDescriptor:
173. 
174.     def __init__(self, manager):
175.         self.manager = manager
176. 
177.     def __get__(self, instance, cls=None):
178.         if instance is not None:
179.             raise AttributeError("Manager isn't accessible via %s instances" % cls.__name__)
180. 
181.         if cls._meta.abstract:
182.             raise AttributeError("Manager isn't available; %s is abstract" % (
183.                 cls._meta.object_name,
184.             ))
185. 
186.         if cls._meta.swapped:
187.             raise AttributeError(
188.                 "Manager isn't available; '%s.%s' has been swapped for '%s'" % (
189.                     cls._meta.app_label,
190.                     cls._meta.object_name,
191.                     cls._meta.swapped,
192.                 )
193.             )
194. 
195.         return cls._meta.managers_map[self.manager.name]
196. 
197. 
198. class EmptyManager(Manager):
199.     def __init__(self, model):
200.         super().__init__()
201.         self.model = model
202. 
203.     def get_queryset(self):
204.         return super().get_queryset().none()

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-23 03:31:25,929 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="The user wants to fix an issue where `ForeignKey.validate()` uses `_default_manager` instead of `_base_manager`. The provided context shows that these managers are accessed through the model's `_meta` attribute, which is an instance of the `Options` class. To fully understand the difference between these managers and the implications of the proposed change, I need to see the implementation of the `Options` class, which is responsible for managing them. The file containing the `Options` class, `django/db/models/options.py`, is missing from the current context." query='Please provide the full content of `django/db/models/options.py`.' extra_requirements='' purpose="This file is needed to understand how `_base_manager` and `_default_manager` are defined and set on a model's `_meta` options, which is crucial for validating the proposed fix."
2025-12-23 03:31:25,930 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `django/db/models/options.py`.
2025-12-23 03:31:25,930 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-23 03:31:25,930 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-23 03:31:25,931 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-23 03:31:25,931 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `django/db/models/options.py`.
Purpose: This file is needed to understand how `_base_manager` and `_default_manager` are defined and set on a model's `_meta` options, which is crucial for validating the proposed fix.
2025-12-23 03:31:28,611 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have retrieved the entire content of `django/db/models/options.py`. This will allow me to examine the definitions of `_base_manager` and `_default_manager` and their roles in the model's `_meta` options. This information is key to developing and validating the proposed solution." additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "django/db/models/options.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2121, 'candidates_token_count': 89, 'total_token_count': 2330, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2121}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 89}], 'thoughts_token_count': 120, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.09939446610011411, 'model_name': 'gemini-2.5-pro'} id='run--10402675-99b6-4b27-a38a-f7688dc68052-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'django/db/models/options.py'}, 'id': '9f99d4e5-42f1-4170-ab69-a11c10378309', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2121, 'output_tokens': 89, 'total_tokens': 2330, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 120}}
2025-12-23 03:31:32,027 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have now reviewed the first 500 lines of `django/db/models/options.py`, which includes the initial definitions of the `Options` class and its methods. To get the full picture of how managers are handled, I will now retrieve the rest of the file's content. This will ensure a complete understanding of the manager-related logic." additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"end_line": 1000.0, "start_line": 501.0, "relative_path": "django/db/models/options.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 9648, 'candidates_token_count': 104, 'total_token_count': 9836, 'cached_content_token_count': 1837, 'prompt_tokens_details': [{'modality': 1, 'token_count': 9648}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1837}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 104}], 'thoughts_token_count': 84}, 'finish_reason': 'STOP', 'avg_logprobs': -0.10245908223665677, 'model_name': 'gemini-2.5-pro'} id='run--0ac5ff07-502a-4901-9667-79193e5d34bd-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'end_line': 1000.0, 'start_line': 501.0, 'relative_path': 'django/db/models/options.py'}, 'id': '44c249b4-1e5a-44e4-a08b-da903963d512', 'type': 'tool_call'}] usage_metadata={'input_tokens': 9648, 'output_tokens': 104, 'total_tokens': 9836, 'input_token_details': {'cache_read': 1837}, 'output_token_details': {'reasoning': 84}}
2025-12-23 03:31:40,510 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have now finished retrieving the entire content of `django/db/models/options.py`. This complete view is essential for me to analyze the implementation details of `_base_manager` and `_default_manager`. I will now proceed with a thorough review of this file to understand how these managers are defined and set, which will inform the validation of the proposed fix.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'citation_metadata': {'citations': [{'start_index': 625, 'end_index': 1044, 'uri': 'https://github.com/JersonVnzl/Python', 'license_': 'BSD-3-Clause', 'title': ''}, {'start_index': 835, 'end_index': 1490, 'uri': 'https://github.com/katrid/orun', 'title': '', 'license_': ''}, {'start_index': 1558, 'end_index': 1889, 'uri': 'https://github.com/katrid/orun', 'title': '', 'license_': ''}, {'start_index': 1876, 'end_index': 2423, 'uri': 'https://github.com/katrid/orun', 'title': '', 'license_': ''}]}, 'usage_metadata': {'prompt_token_count': 15233, 'candidates_token_count': 77, 'total_token_count': 16033, 'cached_content_token_count': 9450, 'prompt_tokens_details': [{'modality': 1, 'token_count': 15233}], 'cache_tokens_details': [{'modality': 1, 'token_count': 9450}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 77}], 'thoughts_token_count': 723}, 'finish_reason': 'STOP', 'avg_logprobs': -0.6165668438007306, 'model_name': 'gemini-2.5-pro'} id='run--657d0e0a-ebb5-4d39-ba2f-cddf16d0003a-0' usage_metadata={'input_tokens': 15233, 'output_tokens': 77, 'total_tokens': 16033, 'input_token_details': {'cache_read': 9450}, 'output_token_details': {'reasoning': 723}}
2025-12-23 03:31:40,512 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `django/db/models/options.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
This file is needed to understand how `_base_manager` and `_default_manager` are defined and set on a model's `_meta` options, which is crucial for validating the proposed fix.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: django/db/models/options.py
Line number range: 1 - 500
Content:
1. import bisect
2. import copy
3. import inspect
4. from collections import defaultdict
5. 
6. from django.apps import apps
7. from django.conf import settings
8. from django.core.exceptions import FieldDoesNotExist
9. from django.db import connections
10. from django.db.models import AutoField, Manager, OrderWrt, UniqueConstraint
11. from django.db.models.query_utils import PathInfo
12. from django.utils.datastructures import ImmutableList, OrderedSet
13. from django.utils.functional import cached_property
14. from django.utils.text import camel_case_to_spaces, format_lazy
15. from django.utils.translation import override
16. 
17. PROXY_PARENTS = object()
18. 
19. EMPTY_RELATION_TREE = ()
20. 
21. IMMUTABLE_WARNING = (
22.     "The return type of '%s' should never be mutated. If you want to manipulate this list "
23.     "for your own use, make a copy first."
24. )
25. 
26. DEFAULT_NAMES = (
27.     'verbose_name', 'verbose_name_plural', 'db_table', 'ordering',
28.     'unique_together', 'permissions', 'get_latest_by', 'order_with_respect_to',
29.     'app_label', 'db_tablespace', 'abstract', 'managed', 'proxy', 'swappable',
30.     'auto_created', 'index_together', 'apps', 'default_permissions',
31.     'select_on_save', 'default_related_name', 'required_db_features',
32.     'required_db_vendor', 'base_manager_name', 'default_manager_name',
33.     'indexes', 'constraints',
34. )
35. 
36. 
37. def normalize_together(option_together):
38.     """
39.     option_together can be either a tuple of tuples, or a single
40.     tuple of two strings. Normalize it to a tuple of tuples, so that
41.     calling code can uniformly expect that.
42.     """
43.     try:
44.         if not option_together:
45.             return ()
46.         if not isinstance(option_together, (tuple, list)):
47.             raise TypeError
48.         first_element = option_together[0]
49.         if not isinstance(first_element, (tuple, list)):
50.             option_together = (option_together,)
51.         # Normalize everything to tuples
52.         return tuple(tuple(ot) for ot in option_together)
53.     except TypeError:
54.         # If the value of option_together isn't valid, return it
55.         # verbatim; this will be picked up by the check framework later.
56.         return option_together
57. 
58. 
59. def make_immutable_fields_list(name, data):
60.     return ImmutableList(data, warning=IMMUTABLE_WARNING % name)
61. 
62. 
63. class Options:
64.     FORWARD_PROPERTIES = {
65.         'fields', 'many_to_many', 'concrete_fields', 'local_concrete_fields',
66.         '_forward_fields_map', 'managers', 'managers_map', 'base_manager',
67.         'default_manager',
68.     }
69.     REVERSE_PROPERTIES = {'related_objects', 'fields_map', '_relation_tree'}
70. 
71.     default_apps = apps
72. 
73.     def __init__(self, meta, app_label=None):
74.         self._get_fields_cache = {}
75.         self.local_fields = []
76.         self.local_many_to_many = []
77.         self.private_fields = []
78.         self.local_managers = []
79.         self.base_manager_name = None
80.         self.default_manager_name = None
81.         self.model_name = None
82.         self.verbose_name = None
83.         self.verbose_name_plural = None
84.         self.db_table = ''
85.         self.ordering = []
86.         self._ordering_clash = False
87.         self.indexes = []
88.         self.constraints = []
89.         self.unique_together = []
90.         self.index_together = []
91.         self.select_on_save = False
92.         self.default_permissions = ('add', 'change', 'delete', 'view')
93.         self.permissions = []
94.         self.object_name = None
95.         self.app_label = app_label
96.         self.get_latest_by = None
97.         self.order_with_respect_to = None
98.         self.db_tablespace = settings.DEFAULT_TABLESPACE
99.         self.required_db_features = []
100.         self.required_db_vendor = None
101.         self.meta = meta
102.         self.pk = None
103.         self.auto_field = None
104.         self.abstract = False
105.         self.managed = True
106.         self.proxy = False
107.         # For any class that is a proxy (including automatically created
108.         # classes for deferred object loading), proxy_for_model tells us
109.         # which class this model is proxying. Note that proxy_for_model
110.         # can create a chain of proxy models. For non-proxy models, the
111.         # variable is always None.
112.         self.proxy_for_model = None
113.         # For any non-abstract class, the concrete class is the model
114.         # in the end of the proxy_for_model chain. In particular, for
115.         # concrete models, the concrete_model is always the class itself.
116.         self.concrete_model = None
117.         self.swappable = None
118.         self.parents = {}
119.         self.auto_created = False
120. 
121.         # List of all lookups defined in ForeignKey 'limit_choices_to' options
122.         # from *other* models. Needed for some admin checks. Internal use only.
123.         self.related_fkey_lookups = []
124. 
125.         # A custom app registry to use, if you're making a separate model set.
126.         self.apps = self.default_apps
127. 
128.         self.default_related_name = None
129. 
130.     @property
131.     def label(self):
132.         return '%s.%s' % (self.app_label, self.object_name)
133. 
134.     @property
135.     def label_lower(self):
136.         return '%s.%s' % (self.app_label, self.model_name)
137. 
138.     @property
139.     def app_config(self):
140.         # Don't go through get_app_config to avoid triggering imports.
141.         return self.apps.app_configs.get(self.app_label)
142. 
143.     @property
144.     def installed(self):
145.         return self.app_config is not None
146. 
147.     def contribute_to_class(self, cls, name):
148.         from django.db import connection
149.         from django.db.backends.utils import truncate_name
150. 
151.         cls._meta = self
152.         self.model = cls
153.         # First, construct the default values for these options.
154.         self.object_name = cls.__name__
155.         self.model_name = self.object_name.lower()
156.         self.verbose_name = camel_case_to_spaces(self.object_name)
157. 
158.         # Store the original user-defined values for each option,
159.         # for use when serializing the model definition
160.         self.original_attrs = {}
161. 
162.         # Next, apply any overridden values from 'class Meta'.
163.         if self.meta:
164.             meta_attrs = self.meta.__dict__.copy()
165.             for name in self.meta.__dict__:
166.                 # Ignore any private attributes that Django doesn't care about.
167.                 # NOTE: We can't modify a dictionary's contents while looping
168.                 # over it, so we loop over the *original* dictionary instead.
169.                 if name.startswith('_'):
170.                     del meta_attrs[name]
171.             for attr_name in DEFAULT_NAMES:
172.                 if attr_name in meta_attrs:
173.                     setattr(self, attr_name, meta_attrs.pop(attr_name))
174.                     self.original_attrs[attr_name] = getattr(self, attr_name)
175.                 elif hasattr(self.meta, attr_name):
176.                     setattr(self, attr_name, getattr(self.meta, attr_name))
177.                     self.original_attrs[attr_name] = getattr(self, attr_name)
178. 
179.             self.unique_together = normalize_together(self.unique_together)
180.             self.index_together = normalize_together(self.index_together)
181.             # App label/class name interpolation for names of constraints and
182.             # indexes.
183.             if not getattr(cls._meta, 'abstract', False):
184.                 for attr_name in {'constraints', 'indexes'}:
185.                     objs = getattr(self, attr_name, [])
186.                     setattr(self, attr_name, self._format_names_with_class(cls, objs))
187. 
188.             # verbose_name_plural is a special case because it uses a 's'
189.             # by default.
190.             if self.verbose_name_plural is None:
191.                 self.verbose_name_plural = format_lazy('{}s', self.verbose_name)
192. 
193.             # order_with_respect_and ordering are mutually exclusive.
194.             self._ordering_clash = bool(self.ordering and self.order_with_respect_to)
195. 
196.             # Any leftover attributes must be invalid.
197.             if meta_attrs != {}:
198.                 raise TypeError("'class Meta' got invalid attribute(s): %s" % ','.join(meta_attrs))
199.         else:
200.             self.verbose_name_plural = format_lazy('{}s', self.verbose_name)
201.         del self.meta
202. 
203.         # If the db_table wasn't provided, use the app_label + model_name.
204.         if not self.db_table:
205.             self.db_table = "%s_%s" % (self.app_label, self.model_name)
206.             self.db_table = truncate_name(self.db_table, connection.ops.max_name_length())
207. 
208.     def _format_names_with_class(self, cls, objs):
209.         """App label/class name interpolation for object names."""
210.         new_objs = []
211.         for obj in objs:
212.             obj = obj.clone()
213.             obj.name = obj.name % {
214.                 'app_label': cls._meta.app_label.lower(),
215.                 'class': cls.__name__.lower(),
216.             }
217.             new_objs.append(obj)
218.         return new_objs
219. 
220.     def _prepare(self, model):
221.         if self.order_with_respect_to:
222.             # The app registry will not be ready at this point, so we cannot
223.             # use get_field().
224.             query = self.order_with_respect_to
225.             try:
226.                 self.order_with_respect_to = next(
227.                     f for f in self._get_fields(reverse=False)
228.                     if f.name == query or f.attname == query
229.                 )
230.             except StopIteration:
231.                 raise FieldDoesNotExist("%s has no field named '%s'" % (self.object_name, query))
232. 
233.             self.ordering = ('_order',)
234.             if not any(isinstance(field, OrderWrt) for field in model._meta.local_fields):
235.                 model.add_to_class('_order', OrderWrt())
236.         else:
237.             self.order_with_respect_to = None
238. 
239.         if self.pk is None:
240.             if self.parents:
241.                 # Promote the first parent link in lieu of adding yet another
242.                 # field.
243.                 field = next(iter(self.parents.values()))
244.                 # Look for a local field with the same name as the
245.                 # first parent link. If a local field has already been
246.                 # created, use it instead of promoting the parent
247.                 already_created = [fld for fld in self.local_fields if fld.name == field.name]
248.                 if already_created:
249.                     field = already_created[0]
250.                 field.primary_key = True
251.                 self.setup_pk(field)
252.             else:
253.                 auto = AutoField(verbose_name='ID', primary_key=True, auto_created=True)
254.                 model.add_to_class('id', auto)
255. 
256.     def add_manager(self, manager):
257.         self.local_managers.append(manager)
258.         self._expire_cache()
259. 
260.     def add_field(self, field, private=False):
261.         # Insert the given field in the order in which it was created, using
262.         # the "creation_counter" attribute of the field.
263.         # Move many-to-many related fields from self.fields into
264.         # self.many_to_many.
265.         if private:
266.             self.private_fields.append(field)
267.         elif field.is_relation and field.many_to_many:
268.             bisect.insort(self.local_many_to_many, field)
269.         else:
270.             bisect.insort(self.local_fields, field)
271.             self.setup_pk(field)
272. 
273.         # If the field being added is a relation to another known field,
274.         # expire the cache on this field and the forward cache on the field
275.         # being referenced, because there will be new relationships in the
276.         # cache. Otherwise, expire the cache of references *to* this field.
277.         # The mechanism for getting at the related model is slightly odd -
278.         # ideally, we'd just ask for field.related_model. However, related_model
279.         # is a cached property, and all the models haven't been loaded yet, so
280.         # we need to make sure we don't cache a string reference.
281.         if field.is_relation and hasattr(field.remote_field, 'model') and field.remote_field.model:
282.             try:
283.                 field.remote_field.model._meta._expire_cache(forward=False)
284.             except AttributeError:
285.                 pass
286.             self._expire_cache()
287.         else:
288.             self._expire_cache(reverse=False)
289. 
290.     def setup_pk(self, field):
291.         if not self.pk and field.primary_key:
292.             self.pk = field
293.             field.serialize = False
294. 
295.     def setup_proxy(self, target):
296.         """
297.         Do the internal setup so that the current model is a proxy for
298.         "target".
299.         """
300.         self.pk = target._meta.pk
301.         self.proxy_for_model = target
302.         self.db_table = target._meta.db_table
303. 
304.     def __repr__(self):
305.         return '<Options for %s>' % self.object_name
306. 
307.     def __str__(self):
308.         return self.label_lower
309. 
310.     def can_migrate(self, connection):
311.         """
312.         Return True if the model can/should be migrated on the `connection`.
313.         `connection` can be either a real connection or a connection alias.
314.         """
315.         if self.proxy or self.swapped or not self.managed:
316.             return False
317.         if isinstance(connection, str):
318.             connection = connections[connection]
319.         if self.required_db_vendor:
320.             return self.required_db_vendor == connection.vendor
321.         if self.required_db_features:
322.             return all(getattr(connection.features, feat, False)
323.                        for feat in self.required_db_features)
324.         return True
325. 
326.     @property
327.     def verbose_name_raw(self):
328.         """Return the untranslated verbose name."""
329.         with override(None):
330.             return str(self.verbose_name)
331. 
332.     @property
333.     def swapped(self):
334.         """
335.         Has this model been swapped out for another? If so, return the model
336.         name of the replacement; otherwise, return None.
337. 
338.         For historical reasons, model name lookups using get_model() are
339.         case insensitive, so we make sure we are case insensitive here.
340.         """
341.         if self.swappable:
342.             swapped_for = getattr(settings, self.swappable, None)
343.             if swapped_for:
344.                 try:
345.                     swapped_label, swapped_object = swapped_for.split('.')
346.                 except ValueError:
347.                     # setting not in the format app_label.model_name
348.                     # raising ImproperlyConfigured here causes problems with
349.                     # test cleanup code - instead it is raised in get_user_model
350.                     # or as part of validation.
351.                     return swapped_for
352. 
353.                 if '%s.%s' % (swapped_label, swapped_object.lower()) != self.label_lower:
354.                     return swapped_for
355.         return None
356. 
357.     @cached_property
358.     def managers(self):
359.         managers = []
360.         seen_managers = set()
361.         bases = (b for b in self.model.mro() if hasattr(b, '_meta'))
362.         for depth, base in enumerate(bases):
363.             for manager in base._meta.local_managers:
364.                 if manager.name in seen_managers:
365.                     continue
366. 
367.                 manager = copy.copy(manager)
368.                 manager.model = self.model
369.                 seen_managers.add(manager.name)
370.                 managers.append((depth, manager.creation_counter, manager))
371. 
372.         return make_immutable_fields_list(
373.             "managers",
374.             (m[2] for m in sorted(managers)),
375.         )
376. 
377.     @cached_property
378.     def managers_map(self):
379.         return {manager.name: manager for manager in self.managers}
380. 
381.     @cached_property
382.     def base_manager(self):
383.         base_manager_name = self.base_manager_name
384.         if not base_manager_name:
385.             # Get the first parent's base_manager_name if there's one.
386.             for parent in self.model.mro()[1:]:
387.                 if hasattr(parent, '_meta'):
388.                     if parent._base_manager.name != '_base_manager':
389.                         base_manager_name = parent._base_manager.name
390.                     break
391. 
392.         if base_manager_name:
393.             try:
394.                 return self.managers_map[base_manager_name]
395.             except KeyError:
396.                 raise ValueError(
397.                     "%s has no manager named %r" % (
398.                         self.object_name,
399.                         base_manager_name,
400.                     )
401.                 )
402. 
403.         manager = Manager()
404.         manager.name = '_base_manager'
405.         manager.model = self.model
406.         manager.auto_created = True
407.         return manager
408. 
409.     @cached_property
410.     def default_manager(self):
411.         default_manager_name = self.default_manager_name
412.         if not default_manager_name and not self.local_managers:
413.             # Get the first parent's default_manager_name if there's one.
414.             for parent in self.model.mro()[1:]:
415.                 if hasattr(parent, '_meta'):
416.                     default_manager_name = parent._meta.default_manager_name
417.                     break
418. 
419.         if default_manager_name:
420.             try:
421.                 return self.managers_map[default_manager_name]
422.             except KeyError:
423.                 raise ValueError(
424.                     "%s has no manager named %r" % (
425.                         self.object_name,
426.                         default_manager_name,
427.                     )
428.                 )
429. 
430.         if self.managers:
431.             return self.managers[0]
432. 
433.     @cached_property
434.     def fields(self):
435.         """
436.         Return a list of all forward fields on the model and its parents,
437.         excluding ManyToManyFields.
438. 
439.         Private API intended only to be used by Django itself; get_fields()
440.         combined with filtering of field properties is the public API for
441.         obtaining this field list.
442.         """
443.         # For legacy reasons, the fields property should only contain forward
444.         # fields that are not private or with a m2m cardinality. Therefore we
445.         # pass these three filters as filters to the generator.
446.         # The third lambda is a longwinded way of checking f.related_model - we don't
447.         # use that property directly because related_model is a cached property,
448.         # and all the models may not have been loaded yet; we don't want to cache
449.         # the string reference to the related_model.
450.         def is_not_an_m2m_field(f):
451.             return not (f.is_relation and f.many_to_many)
452. 
453.         def is_not_a_generic_relation(f):
454.             return not (f.is_relation and f.one_to_many)
455. 
456.         def is_not_a_generic_foreign_key(f):
457.             return not (
458.                 f.is_relation and f.many_to_one and not (hasattr(f.remote_field, 'model') and f.remote_field.model)
459.             )
460. 
461.         return make_immutable_fields_list(
462.             "fields",
463.             (f for f in self._get_fields(reverse=False)
464.              if is_not_an_m2m_field(f) and is_not_a_generic_relation(f) and is_not_a_generic_foreign_key(f))
465.         )
466. 
467.     @cached_property
468.     def concrete_fields(self):
469.         """
470.         Return a list of all concrete fields on the model and its parents.
471. 
472.         Private API intended only to be used by Django itself; get_fields()
473.         combined with filtering of field properties is the public API for
474.         obtaining this field list.
475.         """
476.         return make_immutable_fields_list(
477.             "concrete_fields", (f for f in self.fields if f.concrete)
478.         )
479. 
480.     @cached_property
481.     def local_concrete_fields(self):
482.         """
483.         Return a list of all concrete fields on the model.
484. 
485.         Private API intended only to be used by Django itself; get_fields()
486.         combined with filtering of field properties is the public API for
487.         obtaining this field list.
488.         """
489.         return make_immutable_fields_list(
490.             "local_concrete_fields", (f for f in self.local_fields if f.concrete)
491.         )
492. 
493.     @cached_property
494.     def many_to_many(self):
495.         """
496.         Return a list of all many to many fields on the model and its parents.
497. 
498.         Private API intended only to be used by Django itself; get_fields()
499.         combined with filtering of field properties is the public API for
500.         obtaining this list.


File: django/db/models/options.py
Line number range: 501 - 1000
Content:
501.         """
502.         return make_immutable_fields_list(
503.             "many_to_many",
504.             (f for f in self._get_fields(reverse=False) if f.is_relation and f.many_to_many)
505.         )
506. 
507.     @cached_property
508.     def related_objects(self):
509.         """
510.         Return all related objects pointing to the current model. The related
511.         objects can come from a one-to-one, one-to-many, or many-to-many field
512.         relation type.
513. 
514.         Private API intended only to be used by Django itself; get_fields()
515.         combined with filtering of field properties is the public API for
516.         obtaining this field list.
517.         """
518.         all_related_fields = self._get_fields(forward=False, reverse=True, include_hidden=True)
519.         return make_immutable_fields_list(
520.             "related_objects",
521.             (obj for obj in all_related_fields if not obj.hidden or obj.field.many_to_many)
522.         )
523. 
524.     @cached_property
525.     def _forward_fields_map(self):
526.         res = {}
527.         fields = self._get_fields(reverse=False)
528.         for field in fields:
529.             res[field.name] = field
530.             # Due to the way Django's internals work, get_field() should also
531.             # be able to fetch a field by attname. In the case of a concrete
532.             # field with relation, includes the *_id name too
533.             try:
534.                 res[field.attname] = field
535.             except AttributeError:
536.                 pass
537.         return res
538. 
539.     @cached_property
540.     def fields_map(self):
541.         res = {}
542.         fields = self._get_fields(forward=False, include_hidden=True)
543.         for field in fields:
544.             res[field.name] = field
545.             # Due to the way Django's internals work, get_field() should also
546.             # be able to fetch a field by attname. In the case of a concrete
547.             # field with relation, includes the *_id name too
548.             try:
549.                 res[field.attname] = field
550.             except AttributeError:
551.                 pass
552.         return res
553. 
554.     def get_field(self, field_name):
555.         """
556.         Return a field instance given the name of a forward or reverse field.
557.         """
558.         try:
559.             # In order to avoid premature loading of the relation tree
560.             # (expensive) we prefer checking if the field is a forward field.
561.             return self._forward_fields_map[field_name]
562.         except KeyError:
563.             # If the app registry is not ready, reverse fields are
564.             # unavailable, therefore we throw a FieldDoesNotExist exception.
565.             if not self.apps.models_ready:
566.                 raise FieldDoesNotExist(
567.                     "%s has no field named '%s'. The app cache isn't ready yet, "
568.                     "so if this is an auto-created related field, it won't "
569.                     "be available yet." % (self.object_name, field_name)
570.                 )
571. 
572.         try:
573.             # Retrieve field instance by name from cached or just-computed
574.             # field map.
575.             return self.fields_map[field_name]
576.         except KeyError:
577.             raise FieldDoesNotExist("%s has no field named '%s'" % (self.object_name, field_name))
578. 
579.     def get_base_chain(self, model):
580.         """
581.         Return a list of parent classes leading to `model` (ordered from
582.         closest to most distant ancestor). This has to handle the case where
583.         `model` is a grandparent or even more distant relation.
584.         """
585.         if not self.parents:
586.             return []
587.         if model in self.parents:
588.             return [model]
589.         for parent in self.parents:
590.             res = parent._meta.get_base_chain(model)
591.             if res:
592.                 res.insert(0, parent)
593.                 return res
594.         return []
595. 
596.     def get_parent_list(self):
597.         """
598.         Return all the ancestors of this model as a list ordered by MRO.
599.         Useful for determining if something is an ancestor, regardless of lineage.
600.         """
601.         result = OrderedSet(self.parents)
602.         for parent in self.parents:
603.             for ancestor in parent._meta.get_parent_list():
604.                 result.add(ancestor)
605.         return list(result)
606. 
607.     def get_ancestor_link(self, ancestor):
608.         """
609.         Return the field on the current model which points to the given
610.         "ancestor". This is possible an indirect link (a pointer to a parent
611.         model, which points, eventually, to the ancestor). Used when
612.         constructing table joins for model inheritance.
613. 
614.         Return None if the model isn't an ancestor of this one.
615.         """
616.         if ancestor in self.parents:
617.             return self.parents[ancestor]
618.         for parent in self.parents:
619.             # Tries to get a link field from the immediate parent
620.             parent_link = parent._meta.get_ancestor_link(ancestor)
621.             if parent_link:
622.                 # In case of a proxied model, the first link
623.                 # of the chain to the ancestor is that parent
624.                 # links
625.                 return self.parents[parent] or parent_link
626. 
627.     def get_path_to_parent(self, parent):
628.         """
629.         Return a list of PathInfos containing the path from the current
630.         model to the parent model, or an empty list if parent is not a
631.         parent of the current model.
632.         """
633.         if self.model is parent:
634.             return []
635.         # Skip the chain of proxy to the concrete proxied model.
636.         proxied_model = self.concrete_model
637.         path = []
638.         opts = self
639.         for int_model in self.get_base_chain(parent):
640.             if int_model is proxied_model:
641.                 opts = int_model._meta
642.             else:
643.                 final_field = opts.parents[int_model]
644.                 targets = (final_field.remote_field.get_related_field(),)
645.                 opts = int_model._meta
646.                 path.append(PathInfo(
647.                     from_opts=final_field.model._meta,
648.                     to_opts=opts,
649.                     target_fields=targets,
650.                     join_field=final_field,
651.                     m2m=False,
652.                     direct=True,
653.                     filtered_relation=None,
654.                 ))
655.         return path
656. 
657.     def get_path_from_parent(self, parent):
658.         """
659.         Return a list of PathInfos containing the path from the parent
660.         model to the current model, or an empty list if parent is not a
661.         parent of the current model.
662.         """
663.         if self.model is parent:
664.             return []
665.         model = self.concrete_model
666.         # Get a reversed base chain including both the current and parent
667.         # models.
668.         chain = model._meta.get_base_chain(parent)
669.         chain.reverse()
670.         chain.append(model)
671.         # Construct a list of the PathInfos between models in chain.
672.         path = []
673.         for i, ancestor in enumerate(chain[:-1]):
674.             child = chain[i + 1]
675.             link = child._meta.get_ancestor_link(ancestor)
676.             path.extend(link.get_reverse_path_info())
677.         return path
678. 
679.     def _populate_directed_relation_graph(self):
680.         """
681.         This method is used by each model to find its reverse objects. As this
682.         method is very expensive and is accessed frequently (it looks up every
683.         field in a model, in every app), it is computed on first access and then
684.         is set as a property on every model.
685.         """
686.         related_objects_graph = defaultdict(list)
687. 
688.         all_models = self.apps.get_models(include_auto_created=True)
689.         for model in all_models:
690.             opts = model._meta
691.             # Abstract model's fields are copied to child models, hence we will
692.             # see the fields from the child models.
693.             if opts.abstract:
694.                 continue
695.             fields_with_relations = (
696.                 f for f in opts._get_fields(reverse=False, include_parents=False)
697.                 if f.is_relation and f.related_model is not None
698.             )
699.             for f in fields_with_relations:
700.                 if not isinstance(f.remote_field.model, str):
701.                     remote_label = f.remote_field.model._meta.concrete_model._meta.label
702.                     related_objects_graph[remote_label].append(f)
703. 
704.         for model in all_models:
705.             # Set the relation_tree using the internal __dict__. In this way
706.             # we avoid calling the cached property. In attribute lookup,
707.             # __dict__ takes precedence over a data descriptor (such as
708.             # @cached_property). This means that the _meta._relation_tree is
709.             # only called if related_objects is not in __dict__.
710.             related_objects = related_objects_graph[model._meta.concrete_model._meta.label]
711.             model._meta.__dict__['_relation_tree'] = related_objects
712.         # It seems it is possible that self is not in all_models, so guard
713.         # against that with default for get().
714.         return self.__dict__.get('_relation_tree', EMPTY_RELATION_TREE)
715. 
716.     @cached_property
717.     def _relation_tree(self):
718.         return self._populate_directed_relation_graph()
719. 
720.     def _expire_cache(self, forward=True, reverse=True):
721.         # This method is usually called by apps.cache_clear(), when the
722.         # registry is finalized, or when a new field is added.
723.         if forward:
724.             for cache_key in self.FORWARD_PROPERTIES:
725.                 if cache_key in self.__dict__:
726.                     delattr(self, cache_key)
727.         if reverse and not self.abstract:
728.             for cache_key in self.REVERSE_PROPERTIES:
729.                 if cache_key in self.__dict__:
730.                     delattr(self, cache_key)
731.         self._get_fields_cache = {}
732. 
733.     def get_fields(self, include_parents=True, include_hidden=False):
734.         """
735.         Return a list of fields associated to the model. By default, include
736.         forward and reverse fields, fields derived from inheritance, but not
737.         hidden fields. The returned fields can be changed using the parameters:
738. 
739.         - include_parents: include fields derived from inheritance
740.         - include_hidden:  include fields that have a related_name that
741.                            starts with a "+"
742.         """
743.         if include_parents is False:
744.             include_parents = PROXY_PARENTS
745.         return self._get_fields(include_parents=include_parents, include_hidden=include_hidden)
746. 
747.     def _get_fields(self, forward=True, reverse=True, include_parents=True, include_hidden=False,
748.                     seen_models=None):
749.         """
750.         Internal helper function to return fields of the model.
751.         * If forward=True, then fields defined on this model are returned.
752.         * If reverse=True, then relations pointing to this model are returned.
753.         * If include_hidden=True, then fields with is_hidden=True are returned.
754.         * The include_parents argument toggles if fields from parent models
755.           should be included. It has three values: True, False, and
756.           PROXY_PARENTS. When set to PROXY_PARENTS, the call will return all
757.           fields defined for the current model or any of its parents in the
758.           parent chain to the model's concrete model.
759.         """
760.         if include_parents not in (True, False, PROXY_PARENTS):
761.             raise TypeError("Invalid argument for include_parents: %s" % (include_parents,))
762.         # This helper function is used to allow recursion in ``get_fields()``
763.         # implementation and to provide a fast way for Django's internals to
764.         # access specific subsets of fields.
765. 
766.         # We must keep track of which models we have already seen. Otherwise we
767.         # could include the same field multiple times from different models.
768.         topmost_call = seen_models is None
769.         if topmost_call:
770.             seen_models = set()
771.         seen_models.add(self.model)
772. 
773.         # Creates a cache key composed of all arguments
774.         cache_key = (forward, reverse, include_parents, include_hidden, topmost_call)
775. 
776.         try:
777.             # In order to avoid list manipulation. Always return a shallow copy
778.             # of the results.
779.             return self._get_fields_cache[cache_key]
780.         except KeyError:
781.             pass
782. 
783.         fields = []
784.         # Recursively call _get_fields() on each parent, with the same
785.         # options provided in this call.
786.         if include_parents is not False:
787.             for parent in self.parents:
788.                 # In diamond inheritance it is possible that we see the same
789.                 # model from two different routes. In that case, avoid adding
790.                 # fields from the same parent again.
791.                 if parent in seen_models:
792.                     continue
793.                 if (parent._meta.concrete_model != self.concrete_model and
794.                         include_parents == PROXY_PARENTS):
795.                     continue
796.                 for obj in parent._meta._get_fields(
797.                         forward=forward, reverse=reverse, include_parents=include_parents,
798.                         include_hidden=include_hidden, seen_models=seen_models):
799.                     if not getattr(obj, 'parent_link', False) or obj.model == self.concrete_model:
800.                         fields.append(obj)
801.         if reverse and not self.proxy:
802.             # Tree is computed once and cached until the app cache is expired.
803.             # It is composed of a list of fields pointing to the current model
804.             # from other models.
805.             all_fields = self._relation_tree
806.             for field in all_fields:
807.                 # If hidden fields should be included or the relation is not
808.                 # intentionally hidden, add to the fields dict.
809.                 if include_hidden or not field.remote_field.hidden:
810.                     fields.append(field.remote_field)
811. 
812.         if forward:
813.             fields += self.local_fields
814.             fields += self.local_many_to_many
815.             # Private fields are recopied to each child model, and they get a
816.             # different model as field.model in each child. Hence we have to
817.             # add the private fields separately from the topmost call. If we
818.             # did this recursively similar to local_fields, we would get field
819.             # instances with field.model != self.model.
820.             if topmost_call:
821.                 fields += self.private_fields
822. 
823.         # In order to avoid list manipulation. Always
824.         # return a shallow copy of the results
825.         fields = make_immutable_fields_list("get_fields()", fields)
826. 
827.         # Store result into cache for later access
828.         self._get_fields_cache[cache_key] = fields
829.         return fields
830. 
831.     @cached_property
832.     def total_unique_constraints(self):
833.         """
834.         Return a list of total unique constraints. Useful for determining set
835.         of fields guaranteed to be unique for all rows.
836.         """
837.         return [
838.             constraint
839.             for constraint in self.constraints
840.             if isinstance(constraint, UniqueConstraint) and constraint.condition is None
841.         ]
842. 
843.     @cached_property
844.     def _property_names(self):
845.         """Return a set of the names of the properties defined on the model."""
846.         names = []
847.         for name in dir(self.model):
848.             attr = inspect.getattr_static(self.model, name)
849.             if isinstance(attr, property):
850.                 names.append(name)
851.         return frozenset(names)
852. 
853.     @cached_property
854.     def db_returning_fields(self):
855.         """
856.         Private API intended only to be used by Django itself.
857.         Fields to be returned after a database insert.
858.         """
859.         return [
860.             field for field in self._get_fields(forward=True, reverse=False, include_parents=PROXY_PARENTS)
861.             if getattr(field, 'db_returning', False)
862.         ]

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-23 03:31:45,897 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="The user has requested the full content of the file `django/db/models/options.py`. The provided context contains the entire file content from line 1 to 862, which directly fulfills the user's request.", relative_path='django/db/models/options.py', start_line=1, end_line=862)]
2025-12-23 03:31:45,899 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of `django/db/models/options.py`.
2025-12-23 03:31:45,899 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-23 03:31:45,899 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-23 03:31:45,900 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 3 existing contexts
2025-12-23 03:31:45,900 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 4 total contexts (removed 0 duplicates)
2025-12-23 03:31:45,901 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .github
|   ├── FUNDING.yml
|   └── SECURITY.md
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── bin
|   |   └── django-admin.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ar_DZ
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ky
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tg
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uz
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   ├── 0012_alter_user_first_name_max_length.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   ├── options.py
|   |   |   |   └── widgets.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── constraints.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── mn
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_redirect_new_path_help_text.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── templates
|   |   |   |   ├── sitemap.xml
|   |   |   |   └── sitemap_index.xml
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── asgi.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── memcached.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── async_checks.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   └── __init__.py
|   |   |   ├── database.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── asgi.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── __init__.py
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── jsonl.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   ├── special.py
|   |   |   |   └── utils.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── enums.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── json.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── asyncio.py
|   |   ├── autoreload.py
|   |   ├── baseconv.py
|   |   ├── cache.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── datetime_safe.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── topological_sort.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           ├── default_urlconf.html
|           ├── technical_404.html
|           ├── technical_500.html
|           └── technical_500.txt
├── docs
|   ├── README.rst
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   ├── genindex.html
|   |   |   ├── layout.html
|   |   |   ├── modindex.html
|   |   |   ├── search.html
|   |   |   └── static
|   |   |       ├── console-tabs.css
|   |   |       ├── default.css
|   |   |       ├── djangodocs.css
|   |   |       ├── fontawesome
|   |   |       ├── homepage.css
|   |   |       └── reset-fonts-grids.css
|   |   └── djangodocs-epub
|   |       ├── epub-cover.html
|   |       └── static
|   |           └── epub.css
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── _images
|   |   ├── auth-remote-user.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-backend.txt
|   |   ├── custom-template-tags.txt
|   |   ├── deployment
|   |   |   ├── asgi
|   |   |   |   ├── daphne.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── uvicorn.txt
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── legacy-databases.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── constraints.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── paginator.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.19.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.20.txt
|   |   ├── 1.11.21.txt
|   |   ├── 1.11.22.txt
|   |   ├── 1.11.23.txt
|   |   ├── 1.11.24.txt
|   |   ├── 1.11.25.txt
|   |   ├── 1.11.26.txt
|   |   ├── 1.11.27.txt
|   |   ├── 1.11.28.txt
|   |   ├── 1.11.29.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.11.txt
|   |   ├── 2.0.12.txt
|   |   ├── 2.0.13.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.10.txt
|   |   ├── 2.1.11.txt
|   |   ├── 2.1.12.txt
|   |   ├── 2.1.13.txt
|   |   ├── 2.1.14.txt
|   |   ├── 2.1.15.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.7.txt
|   |   ├── 2.1.8.txt
|   |   ├── 2.1.9.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.1.txt
|   |   ├── 2.2.10.txt
|   |   ├── 2.2.11.txt
|   |   ├── 2.2.12.txt
|   |   ├── 2.2.13.txt
|   |   ├── 2.2.14.txt
|   |   ├── 2.2.2.txt
|   |   ├── 2.2.3.txt
|   |   ├── 2.2.4.txt
|   |   ├── 2.2.5.txt
|   |   ├── 2.2.6.txt
|   |   ├── 2.2.7.txt
|   |   ├── 2.2.8.txt
|   |   ├── 2.2.9.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.1.txt
|   |   ├── 3.0.2.txt
|   |   ├── 3.0.3.txt
|   |   ├── 3.0.4.txt
|   |   ├── 3.0.5.txt
|   |   ├── 3.0.6.txt
|   |   ├── 3.0.7.txt
|   |   ├── 3.0.8.txt
|   |   ├── 3.0.txt
|   |   ├── 3.1.txt
|   |   ├── 3.2.txt
|   |   ├── index.txt
|   |   └── security.txt
|   └── topics
|       ├── async.txt
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   └── jsi18n-mocks.test.js
|   ├── gis
|   |   └── mapwidget.test.js
|   └── tests.html
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_dynamic_settings_manage.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       └── noargs_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── test_django_admin_py.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── admin
    |   |   |   ├── admin_views
    |   |   |   └── base_site.html
    |   |   └── custom_filter_template.html
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_forms.py
    |   ├── test_history_view.py
    |   ├── test_multidb.py
    |   ├── test_nav_sidebar.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── default_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   └── tests.py
    ├── asgi
    |   ├── __init__.py
    |   ├── project
    |   |   └── static
    |   |       └── file.txt
    |   ├── tests.py
    |   └── urls.py
    ├── async
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   ├── with_last_login_attr.py
    |   |   └── with_many_to_many.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   |   ├── auth_attrs_access.html
    |   |   |   ├── auth_attrs_messages.html
    |   |   |   ├── auth_attrs_no_access.html
    |   |   |   ├── auth_attrs_perm_in_perms.html
    |   |   |   ├── auth_attrs_perms.html
    |   |   |   ├── auth_attrs_test_access.html
    |   |   |   └── auth_attrs_user.html
    |   |   └── registration
    |   |       ├── html_password_reset_email.html
    |   |       ├── logged_out.html
    |   |       ├── login.html
    |   |       ├── password_change_form.html
    |   |       ├── password_reset_complete.html
    |   |       ├── password_reset_confirm.html
    |   |       ├── password_reset_done.html
    |   |       ├── password_reset_email.html
    |   |       ├── password_reset_form.html
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_password_reset_timeout_days.py
    |   ├── test_remote_user.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── test_base.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   └── tests.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_async_checks.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_error_handlers.py
    |       ├── bad_error_handlers_invalid_path.py
    |       ├── beginning_with_slash.py
    |       ├── contains_tuple.py
    |       ├── good_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   └── ending_with_dollar.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   |       ├── debug.html
    |   |       └── request_attrs.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_greatest.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_round.py
    |   |   ├── test_sign.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_md5.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_sha1.py
    |   |   ├── test_sha224.py
    |   |   ├── test_sha256.py
    |   |   ├── test_sha384.py
    |   |   ├── test_sha512.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   ├── test_postgresql.py
    |   ├── test_sqlite.py
    |   └── tests.py
    ├── decorators
    |   ├── __init__.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   ├── test_middleware_mixin.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── empty_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── test_commands.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_deprecation.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── fixture2.xml
    |   |   ├── fixture3.xml
    |   |   ├── fixture7.xml
    |   |   └── fixture9.xml
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── animal.xml
    |   |   ├── bad_fixture2.xml
    |   |   ├── nk-inheritance2.xml
    |   |   ├── non_natural_2.xml
    |   |   ├── pretty.xml
    |   |   └── sequence_extra_xml.xml
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── absolute_urls.py
    |   ├── no_slash_urls.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   |   └── default.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_jsonfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   |       └── custom_widget.html
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   |       ├── article_form.html
    |   |       └── custom_widget.html
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   |       └── using.html
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   ├── about.html
    |   |   |   ├── apple_detail.html
    |   |   |   ├── artist_detail.html
    |   |   |   ├── artist_form.html
    |   |   |   ├── author_confirm_delete.html
    |   |   |   ├── author_detail.html
    |   |   |   ├── author_form.html
    |   |   |   ├── author_list.html
    |   |   |   ├── author_objects.html
    |   |   |   ├── author_view.html
    |   |   |   ├── book_archive.html
    |   |   |   ├── book_archive_day.html
    |   |   |   ├── book_archive_month.html
    |   |   |   ├── book_archive_week.html
    |   |   |   ├── book_archive_year.html
    |   |   |   ├── book_detail.html
    |   |   |   ├── book_list.html
    |   |   |   ├── confirm_delete.html
    |   |   |   ├── detail.html
    |   |   |   ├── form.html
    |   |   |   ├── list.html
    |   |   |   ├── page_template.html
    |   |   |   ├── robots.txt
    |   |   |   └── using.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── has_nulls
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   ├── test_srs.py
    |   |   └── tests.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── admin.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_indexes.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_create_models.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── maps
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_rastermodels.py
    |   |   |   └── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   |   └── test_handler.html
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   |   └── ignored.html
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   |   └── media_ignored.html
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   ├── javascript_ignored.js
    |   |   |   └── static_ignored.html
    |   |   └── templates
    |   |       ├── empty.html
    |   |       ├── subdir
    |   |       ├── test.html
    |   |       └── xxx_ignored.html
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── loading
    |   |   ├── en
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_AU
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_CA
    |   |   |   └── LC_MESSAGES
    |   |   └── en_NZ
    |   |       └── LC_MESSAGES
    |   ├── loading_app
    |   |   ├── __init__.py
    |   |   ├── apps.py
    |   |   └── locale
    |   |       └── en
    |   ├── models.py
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   |   ├── 404.html
    |   |   |   └── dummy.html
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   |   └── percents.html
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   ├── tests.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_fake_initial_case_insensitive
    |   |   ├── fake_initial
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── initial
    |   |       ├── 0001_initial.py
    |   |       └── __init__.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_namespace_package
    |   |   └── 0001_initial.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_no_operations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   ├── 0005_fifth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_enums
    |   ├── __init__.py
    |   └── tests.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autofield.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_filepathfield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_jsonfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── integration_settings.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_constraints.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_integration.py
    |   ├── test_introspection.py
    |   ├── test_json_deprecation.py
    |   ├── test_operations.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_db_returning.py
    |   ├── test_deprecation.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests
    |   ├── __init__.py
    |   ├── test_accept_header.py
    |   ├── test_data_upload_settings.py
    |   ├── test_is_ajax_deprecations.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_jsonl.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   |       └── using.html
    |   ├── templates
    |   |   └── shortcuts
    |   |       ├── render_test.html
    |   |       └── using.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_deprecation.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── custom_sitemap.xml
    |   |   └── custom_sitemap_index.xml
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   ├── test_management.py
    |   ├── test_utils.py
    |   └── urls
    |       ├── __init__.py
    |       ├── empty.py
    |       ├── http.py
    |       ├── https.py
    |       └── index_only.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── absolute_root.css
    |   |   |   ├── cached
    |   |   |   ├── styles_root.css
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   |   └── faulty.css
    |   |   ├── loop
    |   |   |   ├── bar.css
    |   |   |   └── foo.css
    |   |   ├── pathlib
    |   |   |   └── pathlib.txt
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   |       ├── description.html
    |   |       ├── description_context.html
    |   |       ├── title.html
    |   |       └── title_context.html
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   |       └── hello.html
    |   ├── jinja2
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       ├── syntax_error.html
    |   |       ├── syntax_error2.html
    |   |       └── syntax_error_include.html
    |   ├── template_strings
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       └── syntax_error.html
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_loader
    |   |       ├── goodbye.html
    |   |       ├── hello.html
    |   |       └── request.html
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   |       └── using.html
    |   ├── other_templates
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   └── test_dirs.html
    |   ├── recursive_templates
    |   |   ├── fs
    |   |   |   ├── extend-missing.html
    |   |   |   ├── one.html
    |   |   |   ├── other-recursive.html
    |   |   |   ├── recursive.html
    |   |   |   ├── self.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── fs2
    |   |   |   └── recursive.html
    |   |   └── fs3
    |   |       └── recursive.html
    |   ├── relative_templates
    |   |   ├── dir1
    |   |   |   ├── dir2
    |   |   |   ├── looped.html
    |   |   |   ├── one.html
    |   |   |   ├── one1.html
    |   |   |   ├── one2.html
    |   |   |   ├── one3.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── error_extends.html
    |   |   ├── error_include.html
    |   |   ├── one.html
    |   |   ├── three.html
    |   |   └── two.html
    |   ├── syntax_tests
    |   |   ├── __init__.py
    |   |   ├── i18n
    |   |   |   ├── __init__.py
    |   |   |   ├── base.py
    |   |   |   ├── test_blocktranslate.py
    |   |   |   ├── test_filters.py
    |   |   |   ├── test_get_available_languages.py
    |   |   |   ├── test_get_current_language.py
    |   |   |   ├── test_get_current_language_bidi.py
    |   |   |   ├── test_get_language_info.py
    |   |   |   ├── test_get_language_info_list.py
    |   |   |   ├── test_language.py
    |   |   |   ├── test_translate.py
    |   |   |   └── test_underscore_syntax.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_basic.py
    |   |   ├── test_builtins.py
    |   |   ├── test_cache.py
    |   |   ├── test_comment.py
    |   |   ├── test_cycle.py
    |   |   ├── test_exceptions.py
    |   |   ├── test_extends.py
    |   |   ├── test_filter_syntax.py
    |   |   ├── test_filter_tag.py
    |   |   ├── test_firstof.py
    |   |   ├── test_for.py
    |   |   ├── test_if.py
    |   |   ├── test_if_changed.py
    |   |   ├── test_if_equal.py
    |   |   ├── test_include.py
    |   |   ├── test_invalid_string.py
    |   |   ├── test_list_index.py
    |   |   ├── test_load.py
    |   |   ├── test_lorem.py
    |   |   ├── test_multiline.py
    |   |   ├── test_named_endblock.py
    |   |   ├── test_now.py
    |   |   ├── test_numpy.py
    |   |   ├── test_regroup.py
    |   |   ├── test_resetcycle.py
    |   |   ├── test_setup.py
    |   |   ├── test_simple_tag.py
    |   |   ├── test_spaceless.py
    |   |   ├── test_static.py
    |   |   ├── test_template_tag.py
    |   |   ├── test_url.py
    |   |   ├── test_verbatim.py
    |   |   ├── test_width_ratio.py
    |   |   └── test_with.py
    |   ├── templates
    |   |   ├── 27584_child.html
    |   |   ├── 27584_parent.html
    |   |   ├── 27956_child.html
    |   |   ├── 27956_parent.html
    |   |   ├── broken_base.html
    |   |   ├── first
    |   |   |   └── test.html
    |   |   ├── include_tpl.html
    |   |   ├── included_base.html
    |   |   ├── included_content.html
    |   |   ├── inclusion.html
    |   |   ├── inclusion_base.html
    |   |   ├── inclusion_extends1.html
    |   |   ├── inclusion_extends2.html
    |   |   ├── index.html
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   ├── recursive_include.html
    |   |   ├── response.html
    |   |   ├── second
    |   |   |   └── test.html
    |   |   ├── ssi include with spaces.html
    |   |   ├── ssi_include.html
    |   |   ├── template_tests
    |   |   |   └── using.html
    |   |   ├── test_context.html
    |   |   ├── test_context_stack.html
    |   |   ├── test_extends_error.html
    |   |   ├── test_incl_tag_use_l10n.html
    |   |   └── test_include_error.html
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   ├── bad_tag.py
    |   |   ├── custom.py
    |   |   ├── inclusion.py
    |   |   ├── subpackage
    |   |   |   ├── __init__.py
    |   |   |   └── echo.py
    |   |   ├── tag_27584.py
    |   |   └── testtags.py
    |   ├── test_base.py
    |   ├── test_callables.py
    |   ├── test_context.py
    |   ├── test_custom.py
    |   ├── test_engine.py
    |   ├── test_extends.py
    |   ├── test_extends_relative.py
    |   ├── test_library.py
    |   ├── test_loaders.py
    |   ├── test_logging.py
    |   ├── test_nodelist.py
    |   ├── test_origin.py
    |   ├── test_parser.py
    |   ├── test_response.py
    |   ├── test_smartif.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── utils.py
    |   └── views.py
    ├── templates
    |   ├── base.html
    |   ├── comments
    |   |   └── comment_notification_email.txt
    |   ├── custom_admin
    |   |   ├── add_form.html
    |   |   ├── app_index.html
    |   |   ├── change_form.html
    |   |   ├── change_list.html
    |   |   ├── delete_confirmation.html
    |   |   ├── delete_selected_confirmation.html
    |   |   ├── index.html
    |   |   ├── login.html
    |   |   ├── logout.html
    |   |   ├── object_history.html
    |   |   ├── password_change_done.html
    |   |   ├── password_change_form.html
    |   |   └── popup_response.html
    |   ├── extended.html
    |   ├── form_view.html
    |   ├── login.html
    |   └── views
    |       ├── article_archive_day.html
    |       ├── article_archive_month.html
    |       ├── article_confirm_delete.html
    |       ├── article_detail.html
    |       ├── article_form.html
    |       ├── article_list.html
    |       ├── datearticle_archive_month.html
    |       ├── urlarticle_detail.html
    |       └── urlarticle_form.html
    ├── test_client
    |   ├── __init__.py
    |   ├── auth_backends.py
    |   ├── test_conditional_content_removal.py
    |   ├── test_fakepayload.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── test_client_regress
    |   ├── __init__.py
    |   ├── auth_backends.py
    |   ├── bad_templates
    |   |   └── 404.html
    |   ├── context_processors.py
    |   ├── models.py
    |   ├── session.py
    |   ├── templates
    |   |   ├── request_context.html
    |   |   └── unicode.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── test_exceptions
    |   ├── __init__.py
    |   └── test_validation_error.py
    ├── test_runner
    |   ├── __init__.py
    |   ├── models.py
    |   ├── runner.py
    |   ├── test_debug_sql.py
    |   ├── test_discover_runner.py
    |   ├── test_parallel.py
    |   └── tests.py
    ├── test_runner_apps
    |   ├── __init__.py
    |   ├── buffer
    |   |   └── tests_buffer.py
    |   ├── databases
    |   |   ├── __init__.py
    |   |   └── tests.py
    |   ├── sample
    |   |   ├── __init__.py
    |   |   ├── doctests.py
    |   |   ├── empty.py
    |   |   ├── pattern_tests.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── tests.py
    |   |   └── tests_sample.py
    |   ├── simple
    |   |   ├── __init__.py
    |   |   └── tests.py
    |   └── tagged
    |       ├── __init__.py
    |       ├── tests.py
    |       └── tests_inheritance.py
    ├── test_sqlite.py
    ├── test_utils
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── templates
    |   |   └── template_used
    |   |       ├── alternative.html
    |   |       ├── base.html
    |   |       ├── extends.html
    |   |       └── include.html
    |   ├── test_simpletestcase.py
    |   ├── test_testcase.py
    |   ├── test_transactiontestcase.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── timezones
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── transaction_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── transactions
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── unmanaged_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── update_only_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── urlpatterns
    |   ├── __init__.py
    |   ├── converter_urls.py
    |   ├── converters.py
    |   ├── included_urls.py
    |   ├── more_urls.py
    |   ├── path_base64_urls.py
    |   ├── path_dynamic_urls.py
    |   ├── path_same_name_urls.py
    |   ├── path_urls.py
    |   ├── test_resolvers.py
    |   ├── tests.py
    |   └── views.py
    ├── urlpatterns_reverse
    |   ├── __init__.py
    |   ├── erroneous_urls.py
    |   ├── extra_urls.py
    |   ├── included_app_urls.py
    |   ├── included_named_urls.py
    |   ├── included_named_urls2.py
    |   ├── included_namespace_urls.py
    |   ├── included_no_kwargs_urls.py
    |   ├── included_urls.py
    |   ├── included_urls2.py
    |   ├── method_view_urls.py
    |   ├── middleware.py
    |   ├── named_urls.py
    |   ├── named_urls_conflict.py
    |   ├── namespace_urls.py
    |   ├── nested_urls.py
    |   ├── no_urls.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: ForeignKey.validate() should validate using the base manager.

Description: Description
	
ForeignKey.validate() should validate using the base manager instead of the default manager.
Consider the models:
class ArticleManager(models.Manage):
	def get_queryset(self):
		qs = super().get_queryset()
		return qs.filter(archived=False)
class Article(models.Model):
	title = models.CharField(max_length=100)
	archived = models.BooleanField(default=False)
	# Don't include archived articles by default.
	objects = ArticleManager()
class FavoriteAricles(models.Model):
	article = models.ForeignKey(Article, on_delete=models.CASCADE)
In the example, now consider a form that allows users to pick a favorite article including archived articles.
class FavoriteAriclesForm(forms.ModelForm):
	class Meta:
		model = FavoriteArticle
		fields = '__all__'
	def __init__(self, *args, **kwargs):
		super().__init__(*args, **kwargs)
		# Use the base manager instead of the default manager to allow archived articles.
		self.fields['article'].queryset = Article._base_manager.all()
The above form will never validate as True when a user selects an archived article. This is because the ForeignKey validation always uses _default_manager instead of _base_manager. The user facing error message is "article instance with id 123 does not exist." (quite confusing to typical users). The code for this validation is here:
​https://github.com/django/django/blob/94f63b926fd32d7a7b6e2591ef72aa8f040f25cc/django/db/models/fields/related.py#L917-L919
The FavoriteAriclesForm is specifically designed to use a different manager, but the ForeignKey validation makes this difficult.
In this example scenario, it is not acceptable to change the model's default manager as the default should avoid archived articles in other typical scenarios.
Suggested solution: the ForeignKey validation should use the _base_manager instead which does not include the default filters.

Patch information:
diff --git a/django/db/models/fields/related.py b/django/db/models/fields/related.py
index d517d7269b..c2aea9c730 100644
--- a/django/db/models/fields/related.py
+++ b/django/db/models/fields/related.py
@@ -914,7 +914,7 @@ class ForeignKey(ForeignObject):
             return
 
         using = router.db_for_read(self.remote_field.model, instance=model_instance)
-        qs = self.remote_field.model._default_manager.using(using).filter(
+        qs = self.remote_field.model._base_manager.using(using).filter(
             **{self.remote_field.field_name: value}
         )
         qs = qs.complex_filter(self.get_limit_choices_to())


Find all relevant source code context needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `django/db/models/fields/related.py`, `django/db/models/manager.py`, and `django/db/models/base.py`.
Extra Requirements: 
Purpose: These files will provide the necessary context on `ForeignKey` validation and model managers to understand and verify the proposed fix.

Previous refined query 2:
Essential Query: Please provide the full content of `django/db/models/options.py`.
Extra Requirements: 
Purpose: This file is needed to understand how `_base_manager` and `_default_manager` are defined and set on a model's `_meta` options, which is crucial for validating the proposed fix.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: django/db/models/base.py
Line number range: 1 - 1502
Content:
1. import copy
2. import inspect
3. import warnings
4. from functools import partialmethod
5. from itertools import chain
6. 
7. import django
8. from django.apps import apps
9. from django.conf import settings
10. from django.core import checks
11. from django.core.exceptions import (
12.     NON_FIELD_ERRORS, FieldDoesNotExist, FieldError, MultipleObjectsReturned,
13.     ObjectDoesNotExist, ValidationError,
14. )
15. from django.db import (
16.     DEFAULT_DB_ALIAS, DJANGO_VERSION_PICKLE_KEY, DatabaseError, connection,
17.     connections, router, transaction,
18. )
19. from django.db.models import (
20.     NOT_PROVIDED, ExpressionWrapper, IntegerField, Max, Value,
21. )
22. from django.db.models.constants import LOOKUP_SEP
23. from django.db.models.constraints import CheckConstraint, UniqueConstraint
24. from django.db.models.deletion import CASCADE, Collector
25. from django.db.models.fields.related import (
26.     ForeignObjectRel, OneToOneField, lazy_related_operation, resolve_relation,
27. )
28. from django.db.models.functions import Coalesce
29. from django.db.models.manager import Manager
30. from django.db.models.options import Options
31. from django.db.models.query import Q
32. from django.db.models.signals import (
33.     class_prepared, post_init, post_save, pre_init, pre_save,
34. )
35. from django.db.models.utils import make_model_tuple
36. from django.utils.encoding import force_str
37. from django.utils.hashable import make_hashable
38. from django.utils.text import capfirst, get_text_list
39. from django.utils.translation import gettext_lazy as _
40. 
41. 
42. class Deferred:
43.     def __repr__(self):
44.         return '<Deferred field>'
45. 
46.     def __str__(self):
47.         return '<Deferred field>'
48. 
49. 
50. DEFERRED = Deferred()
51. 
52. 
53. def subclass_exception(name, bases, module, attached_to):
54.     """
55.     Create exception subclass. Used by ModelBase below.
56. 
57.     The exception is created in a way that allows it to be pickled, assuming
58.     that the returned exception class will be added as an attribute to the
59.     'attached_to' class.
60.     """
61.     return type(name, bases, {
62.         '__module__': module,
63.         '__qualname__': '%s.%s' % (attached_to.__qualname__, name),
64.     })
65. 
66. 
67. def _has_contribute_to_class(value):
68.     # Only call contribute_to_class() if it's bound.
69.     return not inspect.isclass(value) and hasattr(value, 'contribute_to_class')
70. 
71. 
72. class ModelBase(type):
73.     """Metaclass for all models."""
74.     def __new__(cls, name, bases, attrs, **kwargs):
75.         super_new = super().__new__
76. 
77.         # Also ensure initialization is only performed for subclasses of Model
78.         # (excluding Model class itself).
79.         parents = [b for b in bases if isinstance(b, ModelBase)]
80.         if not parents:
81.             return super_new(cls, name, bases, attrs)
82. 
83.         # Create the class.
84.         module = attrs.pop('__module__')
85.         new_attrs = {'__module__': module}
86.         classcell = attrs.pop('__classcell__', None)
87.         if classcell is not None:
88.             new_attrs['__classcell__'] = classcell
89.         attr_meta = attrs.pop('Meta', None)
90.         # Pass all attrs without a (Django-specific) contribute_to_class()
91.         # method to type.__new__() so that they're properly initialized
92.         # (i.e. __set_name__()).
93.         contributable_attrs = {}
94.         for obj_name, obj in attrs.items():
95.             if _has_contribute_to_class(obj):
96.                 contributable_attrs[obj_name] = obj
97.             else:
98.                 new_attrs[obj_name] = obj
99.         new_class = super_new(cls, name, bases, new_attrs, **kwargs)
100. 
101.         abstract = getattr(attr_meta, 'abstract', False)
102.         meta = attr_meta or getattr(new_class, 'Meta', None)
103.         base_meta = getattr(new_class, '_meta', None)
104. 
105.         app_label = None
106. 
107.         # Look for an application configuration to attach the model to.
108.         app_config = apps.get_containing_app_config(module)
109. 
110.         if getattr(meta, 'app_label', None) is None:
111.             if app_config is None:
112.                 if not abstract:
113.                     raise RuntimeError(
114.                         "Model class %s.%s doesn't declare an explicit "
115.                         "app_label and isn't in an application in "
116.                         "INSTALLED_APPS." % (module, name)
117.                     )
118. 
119.             else:
120.                 app_label = app_config.label
121. 
122.         new_class.add_to_class('_meta', Options(meta, app_label))
123.         if not abstract:
124.             new_class.add_to_class(
125.                 'DoesNotExist',
126.                 subclass_exception(
127.                     'DoesNotExist',
128.                     tuple(
129.                         x.DoesNotExist for x in parents if hasattr(x, '_meta') and not x._meta.abstract
130.                     ) or (ObjectDoesNotExist,),
131.                     module,
132.                     attached_to=new_class))
133.             new_class.add_to_class(
134.                 'MultipleObjectsReturned',
135.                 subclass_exception(
136.                     'MultipleObjectsReturned',
137.                     tuple(
138.                         x.MultipleObjectsReturned for x in parents if hasattr(x, '_meta') and not x._meta.abstract
139.                     ) or (MultipleObjectsReturned,),
140.                     module,
141.                     attached_to=new_class))
142.             if base_meta and not base_meta.abstract:
143.                 # Non-abstract child classes inherit some attributes from their
144.                 # non-abstract parent (unless an ABC comes before it in the
145.                 # method resolution order).
146.                 if not hasattr(meta, 'ordering'):
147.                     new_class._meta.ordering = base_meta.ordering
148.                 if not hasattr(meta, 'get_latest_by'):
149.                     new_class._meta.get_latest_by = base_meta.get_latest_by
150. 
151.         is_proxy = new_class._meta.proxy
152. 
153.         # If the model is a proxy, ensure that the base class
154.         # hasn't been swapped out.
155.         if is_proxy and base_meta and base_meta.swapped:
156.             raise TypeError("%s cannot proxy the swapped model '%s'." % (name, base_meta.swapped))
157. 
158.         # Add remaining attributes (those with a contribute_to_class() method)
159.         # to the class.
160.         for obj_name, obj in contributable_attrs.items():
161.             new_class.add_to_class(obj_name, obj)
162. 
163.         # All the fields of any type declared on this model
164.         new_fields = chain(
165.             new_class._meta.local_fields,
166.             new_class._meta.local_many_to_many,
167.             new_class._meta.private_fields
168.         )
169.         field_names = {f.name for f in new_fields}
170. 
171.         # Basic setup for proxy models.
172.         if is_proxy:
173.             base = None
174.             for parent in [kls for kls in parents if hasattr(kls, '_meta')]:
175.                 if parent._meta.abstract:
176.                     if parent._meta.fields:
177.                         raise TypeError(
178.                             "Abstract base class containing model fields not "
179.                             "permitted for proxy model '%s'." % name
180.                         )
181.                     else:
182.                         continue
183.                 if base is None:
184.                     base = parent
185.                 elif parent._meta.concrete_model is not base._meta.concrete_model:
186.                     raise TypeError("Proxy model '%s' has more than one non-abstract model base class." % name)
187.             if base is None:
188.                 raise TypeError("Proxy model '%s' has no non-abstract model base class." % name)
189.             new_class._meta.setup_proxy(base)
190.             new_class._meta.concrete_model = base._meta.concrete_model
191.         else:
192.             new_class._meta.concrete_model = new_class
193. 
194.         # Collect the parent links for multi-table inheritance.
195.         parent_links = {}
196.         for base in reversed([new_class] + parents):
197.             # Conceptually equivalent to `if base is Model`.
198.             if not hasattr(base, '_meta'):
199.                 continue
200.             # Skip concrete parent classes.
201.             if base != new_class and not base._meta.abstract:
202.                 continue
203.             # Locate OneToOneField instances.
204.             for field in base._meta.local_fields:
205.                 if isinstance(field, OneToOneField) and field.remote_field.parent_link:
206.                     related = resolve_relation(new_class, field.remote_field.model)
207.                     parent_links[make_model_tuple(related)] = field
208. 
209.         # Track fields inherited from base models.
210.         inherited_attributes = set()
211.         # Do the appropriate setup for any model parents.
212.         for base in new_class.mro():
213.             if base not in parents or not hasattr(base, '_meta'):
214.                 # Things without _meta aren't functional models, so they're
215.                 # uninteresting parents.
216.                 inherited_attributes.update(base.__dict__)
217.                 continue
218. 
219.             parent_fields = base._meta.local_fields + base._meta.local_many_to_many
220.             if not base._meta.abstract:
221.                 # Check for clashes between locally declared fields and those
222.                 # on the base classes.
223.                 for field in parent_fields:
224.                     if field.name in field_names:
225.                         raise FieldError(
226.                             'Local field %r in class %r clashes with field of '
227.                             'the same name from base class %r.' % (
228.                                 field.name,
229.                                 name,
230.                                 base.__name__,
231.                             )
232.                         )
233.                     else:
234.                         inherited_attributes.add(field.name)
235. 
236.                 # Concrete classes...
237.                 base = base._meta.concrete_model
238.                 base_key = make_model_tuple(base)
239.                 if base_key in parent_links:
240.                     field = parent_links[base_key]
241.                 elif not is_proxy:
242.                     attr_name = '%s_ptr' % base._meta.model_name
243.                     field = OneToOneField(
244.                         base,
245.                         on_delete=CASCADE,
246.                         name=attr_name,
247.                         auto_created=True,
248.                         parent_link=True,
249.                     )
250. 
251.                     if attr_name in field_names:
252.                         raise FieldError(
253.                             "Auto-generated field '%s' in class %r for "
254.                             "parent_link to base class %r clashes with "
255.                             "declared field of the same name." % (
256.                                 attr_name,
257.                                 name,
258.                                 base.__name__,
259.                             )
260.                         )
261. 
262.                     # Only add the ptr field if it's not already present;
263.                     # e.g. migrations will already have it specified
264.                     if not hasattr(new_class, attr_name):
265.                         new_class.add_to_class(attr_name, field)
266.                 else:
267.                     field = None
268.                 new_class._meta.parents[base] = field
269.             else:
270.                 base_parents = base._meta.parents.copy()
271. 
272.                 # Add fields from abstract base class if it wasn't overridden.
273.                 for field in parent_fields:
274.                     if (field.name not in field_names and
275.                             field.name not in new_class.__dict__ and
276.                             field.name not in inherited_attributes):
277.                         new_field = copy.deepcopy(field)
278.                         new_class.add_to_class(field.name, new_field)
279.                         # Replace parent links defined on this base by the new
280.                         # field. It will be appropriately resolved if required.
281.                         if field.one_to_one:
282.                             for parent, parent_link in base_parents.items():
283.                                 if field == parent_link:
284.                                     base_parents[parent] = new_field
285. 
286.                 # Pass any non-abstract parent classes onto child.
287.                 new_class._meta.parents.update(base_parents)
288. 
289.             # Inherit private fields (like GenericForeignKey) from the parent
290.             # class
291.             for field in base._meta.private_fields:
292.                 if field.name in field_names:
293.                     if not base._meta.abstract:
294.                         raise FieldError(
295.                             'Local field %r in class %r clashes with field of '
296.                             'the same name from base class %r.' % (
297.                                 field.name,
298.                                 name,
299.                                 base.__name__,
300.                             )
301.                         )
302.                 else:
303.                     field = copy.deepcopy(field)
304.                     if not base._meta.abstract:
305.                         field.mti_inherited = True
306.                     new_class.add_to_class(field.name, field)
307. 
308.         # Copy indexes so that index names are unique when models extend an
309.         # abstract model.
310.         new_class._meta.indexes = [copy.deepcopy(idx) for idx in new_class._meta.indexes]
311. 
312.         if abstract:
313.             # Abstract base models can't be instantiated and don't appear in
314.             # the list of models for an app. We do the final setup for them a
315.             # little differently from normal models.
316.             attr_meta.abstract = False
317.             new_class.Meta = attr_meta
318.             return new_class
319. 
320.         new_class._prepare()
321.         new_class._meta.apps.register_model(new_class._meta.app_label, new_class)
322.         return new_class
323. 
324.     def add_to_class(cls, name, value):
325.         if _has_contribute_to_class(value):
326.             value.contribute_to_class(cls, name)
327.         else:
328.             setattr(cls, name, value)
329. 
330.     def _prepare(cls):
331.         """Create some methods once self._meta has been populated."""
332.         opts = cls._meta
333.         opts._prepare(cls)
334. 
335.         if opts.order_with_respect_to:
336.             cls.get_next_in_order = partialmethod(cls._get_next_or_previous_in_order, is_next=True)
337.             cls.get_previous_in_order = partialmethod(cls._get_next_or_previous_in_order, is_next=False)
338. 
339.             # Defer creating accessors on the foreign class until it has been
340.             # created and registered. If remote_field is None, we're ordering
341.             # with respect to a GenericForeignKey and don't know what the
342.             # foreign class is - we'll add those accessors later in
343.             # contribute_to_class().
344.             if opts.order_with_respect_to.remote_field:
345.                 wrt = opts.order_with_respect_to
346.                 remote = wrt.remote_field.model
347.                 lazy_related_operation(make_foreign_order_accessors, cls, remote)
348. 
349.         # Give the class a docstring -- its definition.
350.         if cls.__doc__ is None:
351.             cls.__doc__ = "%s(%s)" % (cls.__name__, ", ".join(f.name for f in opts.fields))
352. 
353.         get_absolute_url_override = settings.ABSOLUTE_URL_OVERRIDES.get(opts.label_lower)
354.         if get_absolute_url_override:
355.             setattr(cls, 'get_absolute_url', get_absolute_url_override)
356. 
357.         if not opts.managers:
358.             if any(f.name == 'objects' for f in opts.fields):
359.                 raise ValueError(
360.                     "Model %s must specify a custom Manager, because it has a "
361.                     "field named 'objects'." % cls.__name__
362.                 )
363.             manager = Manager()
364.             manager.auto_created = True
365.             cls.add_to_class('objects', manager)
366. 
367.         # Set the name of _meta.indexes. This can't be done in
368.         # Options.contribute_to_class() because fields haven't been added to
369.         # the model at that point.
370.         for index in cls._meta.indexes:
371.             if not index.name:
372.                 index.set_name_with_model(cls)
373. 
374.         class_prepared.send(sender=cls)
375. 
376.     @property
377.     def _base_manager(cls):
378.         return cls._meta.base_manager
379. 
380.     @property
381.     def _default_manager(cls):
382.         return cls._meta.default_manager
383. 
384. 
385. class ModelStateFieldsCacheDescriptor:
386.     def __get__(self, instance, cls=None):
387.         if instance is None:
388.             return self
389.         res = instance.fields_cache = {}
390.         return res
391. 
392. 
393. class ModelState:
394.     """Store model instance state."""
395.     db = None
396.     # If true, uniqueness validation checks will consider this a new, unsaved
397.     # object. Necessary for correct validation of new instances of objects with
398.     # explicit (non-auto) PKs. This impacts validation only; it has no effect
399.     # on the actual save.
400.     adding = True
401.     fields_cache = ModelStateFieldsCacheDescriptor()
402. 
403. 
404. class Model(metaclass=ModelBase):
405. 
406.     def __init__(self, *args, **kwargs):
407.         # Alias some things as locals to avoid repeat global lookups
408.         cls = self.__class__
409.         opts = self._meta
410.         _setattr = setattr
411.         _DEFERRED = DEFERRED
412. 
413.         pre_init.send(sender=cls, args=args, kwargs=kwargs)
414. 
415.         # Set up the storage for instance state
416.         self._state = ModelState()
417. 
418.         # There is a rather weird disparity here; if kwargs, it's set, then args
419.         # overrides it. It should be one or the other; don't duplicate the work
420.         # The reason for the kwargs check is that standard iterator passes in by
421.         # args, and instantiation for iteration is 33% faster.
422.         if len(args) > len(opts.concrete_fields):
423.             # Daft, but matches old exception sans the err msg.
424.             raise IndexError("Number of args exceeds number of fields")
425. 
426.         if not kwargs:
427.             fields_iter = iter(opts.concrete_fields)
428.             # The ordering of the zip calls matter - zip throws StopIteration
429.             # when an iter throws it. So if the first iter throws it, the second
430.             # is *not* consumed. We rely on this, so don't change the order
431.             # without changing the logic.
432.             for val, field in zip(args, fields_iter):
433.                 if val is _DEFERRED:
434.                     continue
435.                 _setattr(self, field.attname, val)
436.         else:
437.             # Slower, kwargs-ready version.
438.             fields_iter = iter(opts.fields)
439.             for val, field in zip(args, fields_iter):
440.                 if val is _DEFERRED:
441.                     continue
442.                 _setattr(self, field.attname, val)
443.                 kwargs.pop(field.name, None)
444. 
445.         # Now we're left with the unprocessed fields that *must* come from
446.         # keywords, or default.
447. 
448.         for field in fields_iter:
449.             is_related_object = False
450.             # Virtual field
451.             if field.attname not in kwargs and field.column is None:
452.                 continue
453.             if kwargs:
454.                 if isinstance(field.remote_field, ForeignObjectRel):
455.                     try:
456.                         # Assume object instance was passed in.
457.                         rel_obj = kwargs.pop(field.name)
458.                         is_related_object = True
459.                     except KeyError:
460.                         try:
461.                             # Object instance wasn't passed in -- must be an ID.
462.                             val = kwargs.pop(field.attname)
463.                         except KeyError:
464.                             val = field.get_default()
465.                 else:
466.                     try:
467.                         val = kwargs.pop(field.attname)
468.                     except KeyError:
469.                         # This is done with an exception rather than the
470.                         # default argument on pop because we don't want
471.                         # get_default() to be evaluated, and then not used.
472.                         # Refs #12057.
473.                         val = field.get_default()
474.             else:
475.                 val = field.get_default()
476. 
477.             if is_related_object:
478.                 # If we are passed a related instance, set it using the
479.                 # field.name instead of field.attname (e.g. "user" instead of
480.                 # "user_id") so that the object gets properly cached (and type
481.                 # checked) by the RelatedObjectDescriptor.
482.                 if rel_obj is not _DEFERRED:
483.                     _setattr(self, field.name, rel_obj)
484.             else:
485.                 if val is not _DEFERRED:
486.                     _setattr(self, field.attname, val)
487. 
488.         if kwargs:
489.             property_names = opts._property_names
490.             for prop in tuple(kwargs):
491.                 try:
492.                     # Any remaining kwargs must correspond to properties or
493.                     # virtual fields.
494.                     if prop in property_names or opts.get_field(prop):
495.                         if kwargs[prop] is not _DEFERRED:
496.                             _setattr(self, prop, kwargs[prop])
497.                         del kwargs[prop]
498.                 except (AttributeError, FieldDoesNotExist):
499.                     pass
500.             for kwarg in kwargs:
501.                 raise TypeError("%s() got an unexpected keyword argument '%s'" % (cls.__name__, kwarg))
502.         super().__init__()
503.         post_init.send(sender=cls, instance=self)
504. 
505.     @classmethod
506.     def from_db(cls, db, field_names, values):
507.         if len(values) != len(cls._meta.concrete_fields):
508.             values_iter = iter(values)
509.             values = [
510.                 next(values_iter) if f.attname in field_names else DEFERRED
511.                 for f in cls._meta.concrete_fields
512.             ]
513.         new = cls(*values)
514.         new._state.adding = False
515.         new._state.db = db
516.         return new
517. 
518.     def __repr__(self):
519.         return '<%s: %s>' % (self.__class__.__name__, self)
520. 
521.     def __str__(self):
522.         return '%s object (%s)' % (self.__class__.__name__, self.pk)
523. 
524.     def __eq__(self, other):
525.         if not isinstance(other, Model):
526.             return NotImplemented
527.         if self._meta.concrete_model != other._meta.concrete_model:
528.             return False
529.         my_pk = self.pk
530.         if my_pk is None:
531.             return self is other
532.         return my_pk == other.pk
533. 
534.     def __hash__(self):
535.         if self.pk is None:
536.             raise TypeError("Model instances without primary key value are unhashable")
537.         return hash(self.pk)
538. 
539.     def __reduce__(self):
540.         data = self.__getstate__()
541.         data[DJANGO_VERSION_PICKLE_KEY] = django.__version__
542.         class_id = self._meta.app_label, self._meta.object_name
543.         return model_unpickle, (class_id,), data
544. 
545.     def __getstate__(self):
546.         """Hook to allow choosing the attributes to pickle."""
547.         return self.__dict__
548. 
549.     def __setstate__(self, state):
550.         pickled_version = state.get(DJANGO_VERSION_PICKLE_KEY)
551.         if pickled_version:
552.             if pickled_version != django.__version__:
553.                 warnings.warn(
554.                     "Pickled model instance's Django version %s does not "
555.                     "match the current version %s."
556.                     % (pickled_version, django.__version__),
557.                     RuntimeWarning,
558.                     stacklevel=2,
559.                 )
560.         else:
561.             warnings.warn(
562.                 "Pickled model instance's Django version is not specified.",
563.                 RuntimeWarning,
564.                 stacklevel=2,
565.             )
566.         self.__dict__.update(state)
567. 
568.     def _get_pk_val(self, meta=None):
569.         meta = meta or self._meta
570.         return getattr(self, meta.pk.attname)
571. 
572.     def _set_pk_val(self, value):
573.         for parent_link in self._meta.parents.values():
574.             if parent_link and parent_link != self._meta.pk:
575.                 setattr(self, parent_link.target_field.attname, value)
576.         return setattr(self, self._meta.pk.attname, value)
577. 
578.     pk = property(_get_pk_val, _set_pk_val)
579. 
580.     def get_deferred_fields(self):
581.         """
582.         Return a set containing names of deferred fields for this instance.
583.         """
584.         return {
585.             f.attname for f in self._meta.concrete_fields
586.             if f.attname not in self.__dict__
587.         }
588. 
589.     def refresh_from_db(self, using=None, fields=None):
590.         """
591.         Reload field values from the database.
592. 
593.         By default, the reloading happens from the database this instance was
594.         loaded from, or by the read router if this instance wasn't loaded from
595.         any database. The using parameter will override the default.
596. 
597.         Fields can be used to specify which fields to reload. The fields
598.         should be an iterable of field attnames. If fields is None, then
599.         all non-deferred fields are reloaded.
600. 
601.         When accessing deferred fields of an instance, the deferred loading
602.         of the field will call this method.
603.         """
604.         if fields is None:
605.             self._prefetched_objects_cache = {}
606.         else:
607.             prefetched_objects_cache = getattr(self, '_prefetched_objects_cache', ())
608.             for field in fields:
609.                 if field in prefetched_objects_cache:
610.                     del prefetched_objects_cache[field]
611.                     fields.remove(field)
612.             if not fields:
613.                 return
614.             if any(LOOKUP_SEP in f for f in fields):
615.                 raise ValueError(
616.                     'Found "%s" in fields argument. Relations and transforms '
617.                     'are not allowed in fields.' % LOOKUP_SEP)
618. 
619.         hints = {'instance': self}
620.         db_instance_qs = self.__class__._base_manager.db_manager(using, hints=hints).filter(pk=self.pk)
621. 
622.         # Use provided fields, if not set then reload all non-deferred fields.
623.         deferred_fields = self.get_deferred_fields()
624.         if fields is not None:
625.             fields = list(fields)
626.             db_instance_qs = db_instance_qs.only(*fields)
627.         elif deferred_fields:
628.             fields = [f.attname for f in self._meta.concrete_fields
629.                       if f.attname not in deferred_fields]
630.             db_instance_qs = db_instance_qs.only(*fields)
631. 
632.         db_instance = db_instance_qs.get()
633.         non_loaded_fields = db_instance.get_deferred_fields()
634.         for field in self._meta.concrete_fields:
635.             if field.attname in non_loaded_fields:
636.                 # This field wasn't refreshed - skip ahead.
637.                 continue
638.             setattr(self, field.attname, getattr(db_instance, field.attname))
639.             # Clear cached foreign keys.
640.             if field.is_relation and field.is_cached(self):
641.                 field.delete_cached_value(self)
642. 
643.         # Clear cached relations.
644.         for field in self._meta.related_objects:
645.             if field.is_cached(self):
646.                 field.delete_cached_value(self)
647. 
648.         self._state.db = db_instance._state.db
649. 
650.     def serializable_value(self, field_name):
651.         """
652.         Return the value of the field name for this instance. If the field is
653.         a foreign key, return the id value instead of the object. If there's
654.         no Field object with this name on the model, return the model
655.         attribute's value.
656. 
657.         Used to serialize a field's value (in the serializer, or form output,
658.         for example). Normally, you would just access the attribute directly
659.         and not use this method.
660.         """
661.         try:
662.             field = self._meta.get_field(field_name)
663.         except FieldDoesNotExist:
664.             return getattr(self, field_name)
665.         return getattr(self, field.attname)
666. 
667.     def save(self, force_insert=False, force_update=False, using=None,
668.              update_fields=None):
669.         """
670.         Save the current instance. Override this in a subclass if you want to
671.         control the saving process.
672. 
673.         The 'force_insert' and 'force_update' parameters can be used to insist
674.         that the "save" must be an SQL insert or update (or equivalent for
675.         non-SQL backends), respectively. Normally, they should not be set.
676.         """
677.         # Ensure that a model instance without a PK hasn't been assigned to
678.         # a ForeignKey or OneToOneField on this model. If the field is
679.         # nullable, allowing the save() would result in silent data loss.
680.         for field in self._meta.concrete_fields:
681.             # If the related field isn't cached, then an instance hasn't
682.             # been assigned and there's no need to worry about this check.
683.             if field.is_relation and field.is_cached(self):
684.                 obj = getattr(self, field.name, None)
685.                 if not obj:
686.                     continue
687.                 # A pk may have been assigned manually to a model instance not
688.                 # saved to the database (or auto-generated in a case like
689.                 # UUIDField), but we allow the save to proceed and rely on the
690.                 # database to raise an IntegrityError if applicable. If
691.                 # constraints aren't supported by the database, there's the
692.                 # unavoidable risk of data corruption.
693.                 if obj.pk is None:
694.                     # Remove the object from a related instance cache.
695.                     if not field.remote_field.multiple:
696.                         field.remote_field.delete_cached_value(obj)
697.                     raise ValueError(
698.                         "save() prohibited to prevent data loss due to "
699.                         "unsaved related object '%s'." % field.name
700.                     )
701.                 elif getattr(self, field.attname) is None:
702.                     # Use pk from related object if it has been saved after
703.                     # an assignment.
704.                     setattr(self, field.attname, obj.pk)
705.                 # If the relationship's pk/to_field was changed, clear the
706.                 # cached relationship.
707.                 if getattr(obj, field.target_field.attname) != getattr(self, field.attname):
708.                     field.delete_cached_value(self)
709. 
710.         using = using or router.db_for_write(self.__class__, instance=self)
711.         if force_insert and (force_update or update_fields):
712.             raise ValueError("Cannot force both insert and updating in model saving.")
713. 
714.         deferred_fields = self.get_deferred_fields()
715.         if update_fields is not None:
716.             # If update_fields is empty, skip the save. We do also check for
717.             # no-op saves later on for inheritance cases. This bailout is
718.             # still needed for skipping signal sending.
719.             if not update_fields:
720.                 return
721. 
722.             update_fields = frozenset(update_fields)
723.             field_names = set()
724. 
725.             for field in self._meta.fields:
726.                 if not field.primary_key:
727.                     field_names.add(field.name)
728. 
729.                     if field.name != field.attname:
730.                         field_names.add(field.attname)
731. 
732.             non_model_fields = update_fields.difference(field_names)
733. 
734.             if non_model_fields:
735.                 raise ValueError("The following fields do not exist in this "
736.                                  "model or are m2m fields: %s"
737.                                  % ', '.join(non_model_fields))
738. 
739.         # If saving to the same database, and this model is deferred, then
740.         # automatically do an "update_fields" save on the loaded fields.
741.         elif not force_insert and deferred_fields and using == self._state.db:
742.             field_names = set()
743.             for field in self._meta.concrete_fields:
744.                 if not field.primary_key and not hasattr(field, 'through'):
745.                     field_names.add(field.attname)
746.             loaded_fields = field_names.difference(deferred_fields)
747.             if loaded_fields:
748.                 update_fields = frozenset(loaded_fields)
749. 
750.         self.save_base(using=using, force_insert=force_insert,
751.                        force_update=force_update, update_fields=update_fields)
752.     save.alters_data = True
753. 
754.     def save_base(self, raw=False, force_insert=False,
755.                   force_update=False, using=None, update_fields=None):
756.         """
757.         Handle the parts of saving which should be done only once per save,
758.         yet need to be done in raw saves, too. This includes some sanity
759.         checks and signal sending.
760. 
761.         The 'raw' argument is telling save_base not to save any parent
762.         models and not to do any changes to the values before save. This
763.         is used by fixture loading.
764.         """
765.         using = using or router.db_for_write(self.__class__, instance=self)
766.         assert not (force_insert and (force_update or update_fields))
767.         assert update_fields is None or update_fields
768.         cls = origin = self.__class__
769.         # Skip proxies, but keep the origin as the proxy model.
770.         if cls._meta.proxy:
771.             cls = cls._meta.concrete_model
772.         meta = cls._meta
773.         if not meta.auto_created:
774.             pre_save.send(
775.                 sender=origin, instance=self, raw=raw, using=using,
776.                 update_fields=update_fields,
777.             )
778.         # A transaction isn't needed if one query is issued.
779.         if meta.parents:
780.             context_manager = transaction.atomic(using=using, savepoint=False)
781.         else:
782.             context_manager = transaction.mark_for_rollback_on_error(using=using)
783.         with context_manager:
784.             parent_inserted = False
785.             if not raw:
786.                 parent_inserted = self._save_parents(cls, using, update_fields)
787.             updated = self._save_table(
788.                 raw, cls, force_insert or parent_inserted,
789.                 force_update, using, update_fields,
790.             )
791.         # Store the database on which the object was saved
792.         self._state.db = using
793.         # Once saved, this is no longer a to-be-added instance.
794.         self._state.adding = False
795. 
796.         # Signal that the save is complete
797.         if not meta.auto_created:
798.             post_save.send(
799.                 sender=origin, instance=self, created=(not updated),
800.                 update_fields=update_fields, raw=raw, using=using,
801.             )
802. 
803.     save_base.alters_data = True
804. 
805.     def _save_parents(self, cls, using, update_fields):
806.         """Save all the parents of cls using values from self."""
807.         meta = cls._meta
808.         inserted = False
809.         for parent, field in meta.parents.items():
810.             # Make sure the link fields are synced between parent and self.
811.             if (field and getattr(self, parent._meta.pk.attname) is None and
812.                     getattr(self, field.attname) is not None):
813.                 setattr(self, parent._meta.pk.attname, getattr(self, field.attname))
814.             parent_inserted = self._save_parents(cls=parent, using=using, update_fields=update_fields)
815.             updated = self._save_table(
816.                 cls=parent, using=using, update_fields=update_fields,
817.                 force_insert=parent_inserted,
818.             )
819.             if not updated:
820.                 inserted = True
821.             # Set the parent's PK value to self.
822.             if field:
823.                 setattr(self, field.attname, self._get_pk_val(parent._meta))
824.                 # Since we didn't have an instance of the parent handy set
825.                 # attname directly, bypassing the descriptor. Invalidate
826.                 # the related object cache, in case it's been accidentally
827.                 # populated. A fresh instance will be re-built from the
828.                 # database if necessary.
829.                 if field.is_cached(self):
830.                     field.delete_cached_value(self)
831.         return inserted
832. 
833.     def _save_table(self, raw=False, cls=None, force_insert=False,
834.                     force_update=False, using=None, update_fields=None):
835.         """
836.         Do the heavy-lifting involved in saving. Update or insert the data
837.         for a single table.
838.         """
839.         meta = cls._meta
840.         non_pks = [f for f in meta.local_concrete_fields if not f.primary_key]
841. 
842.         if update_fields:
843.             non_pks = [f for f in non_pks
844.                        if f.name in update_fields or f.attname in update_fields]
845. 
846.         pk_val = self._get_pk_val(meta)
847.         if pk_val is None:
848.             pk_val = meta.pk.get_pk_value_on_save(self)
849.             setattr(self, meta.pk.attname, pk_val)
850.         pk_set = pk_val is not None
851.         if not pk_set and (force_update or update_fields):
852.             raise ValueError("Cannot force an update in save() with no primary key.")
853.         updated = False
854.         # Skip an UPDATE when adding an instance and primary key has a default.
855.         if (
856.             not raw and
857.             not force_insert and
858.             self._state.adding and
859.             meta.pk.default and
860.             meta.pk.default is not NOT_PROVIDED
861.         ):
862.             force_insert = True
863.         # If possible, try an UPDATE. If that doesn't update anything, do an INSERT.
864.         if pk_set and not force_insert:
865.             base_qs = cls._base_manager.using(using)
866.             values = [(f, None, (getattr(self, f.attname) if raw else f.pre_save(self, False)))
867.                       for f in non_pks]
868.             forced_update = update_fields or force_update
869.             updated = self._do_update(base_qs, using, pk_val, values, update_fields,
870.                                       forced_update)
871.             if force_update and not updated:
872.                 raise DatabaseError("Forced update did not affect any rows.")
873.             if update_fields and not updated:
874.                 raise DatabaseError("Save with update_fields did not affect any rows.")
875.         if not updated:
876.             if meta.order_with_respect_to:
877.                 # If this is a model with an order_with_respect_to
878.                 # autopopulate the _order field
879.                 field = meta.order_with_respect_to
880.                 filter_args = field.get_filter_kwargs_for_object(self)
881.                 self._order = cls._base_manager.using(using).filter(**filter_args).aggregate(
882.                     _order__max=Coalesce(
883.                         ExpressionWrapper(Max('_order') + Value(1), output_field=IntegerField()),
884.                         Value(0),
885.                     ),
886.                 )['_order__max']
887.             fields = meta.local_concrete_fields
888.             if not pk_set:
889.                 fields = [f for f in fields if f is not meta.auto_field]
890. 
891.             returning_fields = meta.db_returning_fields
892.             results = self._do_insert(cls._base_manager, using, fields, returning_fields, raw)
893.             if results:
894.                 for value, field in zip(results[0], returning_fields):
895.                     setattr(self, field.attname, value)
896.         return updated
897. 
898.     def _do_update(self, base_qs, using, pk_val, values, update_fields, forced_update):
899.         """
900.         Try to update the model. Return True if the model was updated (if an
901.         update query was done and a matching row was found in the DB).
902.         """
903.         filtered = base_qs.filter(pk=pk_val)
904.         if not values:
905.             # We can end up here when saving a model in inheritance chain where
906.             # update_fields doesn't target any field in current model. In that
907.             # case we just say the update succeeded. Another case ending up here
908.             # is a model with just PK - in that case check that the PK still
909.             # exists.
910.             return update_fields is not None or filtered.exists()
911.         if self._meta.select_on_save and not forced_update:
912.             return (
913.                 filtered.exists() and
914.                 # It may happen that the object is deleted from the DB right after
915.                 # this check, causing the subsequent UPDATE to return zero matching
916.                 # rows. The same result can occur in some rare cases when the
917.                 # database returns zero despite the UPDATE being executed
918.                 # successfully (a row is matched and updated). In order to
919.                 # distinguish these two cases, the object's existence in the
920.                 # database is again checked for if the UPDATE query returns 0.
921.                 (filtered._update(values) > 0 or filtered.exists())
922.             )
923.         return filtered._update(values) > 0
924. 
925.     def _do_insert(self, manager, using, fields, returning_fields, raw):
926.         """
927.         Do an INSERT. If returning_fields is defined then this method should
928.         return the newly created data for the model.
929.         """
930.         return manager._insert(
931.             [self], fields=fields, returning_fields=returning_fields,
932.             using=using, raw=raw,
933.         )
934. 
935.     def delete(self, using=None, keep_parents=False):
936.         using = using or router.db_for_write(self.__class__, instance=self)
937.         assert self.pk is not None, (
938.             "%s object can't be deleted because its %s attribute is set to None." %
939.             (self._meta.object_name, self._meta.pk.attname)
940.         )
941. 
942.         collector = Collector(using=using)
943.         collector.collect([self], keep_parents=keep_parents)
944.         return collector.delete()
945. 
946.     delete.alters_data = True
947. 
948.     def _get_FIELD_display(self, field):
949.         value = getattr(self, field.attname)
950.         choices_dict = dict(make_hashable(field.flatchoices))
951.         # force_str() to coerce lazy strings.
952.         return force_str(choices_dict.get(make_hashable(value), value), strings_only=True)
953. 
954.     def _get_next_or_previous_by_FIELD(self, field, is_next, **kwargs):
955.         if not self.pk:
956.             raise ValueError("get_next/get_previous cannot be used on unsaved objects.")
957.         op = 'gt' if is_next else 'lt'
958.         order = '' if is_next else '-'
959.         param = getattr(self, field.attname)
960.         q = Q(**{'%s__%s' % (field.name, op): param})
961.         q = q | Q(**{field.name: param, 'pk__%s' % op: self.pk})
962.         qs = self.__class__._default_manager.using(self._state.db).filter(**kwargs).filter(q).order_by(
963.             '%s%s' % (order, field.name), '%spk' % order
964.         )
965.         try:
966.             return qs[0]
967.         except IndexError:
968.             raise self.DoesNotExist("%s matching query does not exist." % self.__class__._meta.object_name)
969. 
970.     def _get_next_or_previous_in_order(self, is_next):
971.         cachename = "__%s_order_cache" % is_next
972.         if not hasattr(self, cachename):
973.             op = 'gt' if is_next else 'lt'
974.             order = '_order' if is_next else '-_order'
975.             order_field = self._meta.order_with_respect_to
976.             filter_args = order_field.get_filter_kwargs_for_object(self)
977.             obj = self.__class__._default_manager.filter(**filter_args).filter(**{
978.                 '_order__%s' % op: self.__class__._default_manager.values('_order').filter(**{
979.                     self._meta.pk.name: self.pk
980.                 })
981.             }).order_by(order)[:1].get()
982.             setattr(self, cachename, obj)
983.         return getattr(self, cachename)
984. 
985.     def prepare_database_save(self, field):
986.         if self.pk is None:
987.             raise ValueError("Unsaved model instance %r cannot be used in an ORM query." % self)
988.         return getattr(self, field.remote_field.get_related_field().attname)
989. 
990.     def clean(self):
991.         """
992.         Hook for doing any extra model-wide validation after clean() has been
993.         called on every field by self.clean_fields. Any ValidationError raised
994.         by this method will not be associated with a particular field; it will
995.         have a special-case association with the field defined by NON_FIELD_ERRORS.
996.         """
997.         pass
998. 
999.     def validate_unique(self, exclude=None):
1000.         """
1001.         Check unique constraints on the model and raise ValidationError if any
1002.         failed.
1003.         """
1004.         unique_checks, date_checks = self._get_unique_checks(exclude=exclude)
1005. 
1006.         errors = self._perform_unique_checks(unique_checks)
1007.         date_errors = self._perform_date_checks(date_checks)
1008. 
1009.         for k, v in date_errors.items():
1010.             errors.setdefault(k, []).extend(v)
1011. 
1012.         if errors:
1013.             raise ValidationError(errors)
1014. 
1015.     def _get_unique_checks(self, exclude=None):
1016.         """
1017.         Return a list of checks to perform. Since validate_unique() could be
1018.         called from a ModelForm, some fields may have been excluded; we can't
1019.         perform a unique check on a model that is missing fields involved
1020.         in that check. Fields that did not validate should also be excluded,
1021.         but they need to be passed in via the exclude argument.
1022.         """
1023.         if exclude is None:
1024.             exclude = []
1025.         unique_checks = []
1026. 
1027.         unique_togethers = [(self.__class__, self._meta.unique_together)]
1028.         constraints = [(self.__class__, self._meta.total_unique_constraints)]
1029.         for parent_class in self._meta.get_parent_list():
1030.             if parent_class._meta.unique_together:
1031.                 unique_togethers.append((parent_class, parent_class._meta.unique_together))
1032.             if parent_class._meta.total_unique_constraints:
1033.                 constraints.append(
1034.                     (parent_class, parent_class._meta.total_unique_constraints)
1035.                 )
1036. 
1037.         for model_class, unique_together in unique_togethers:
1038.             for check in unique_together:
1039.                 if not any(name in exclude for name in check):
1040.                     # Add the check if the field isn't excluded.
1041.                     unique_checks.append((model_class, tuple(check)))
1042. 
1043.         for model_class, model_constraints in constraints:
1044.             for constraint in model_constraints:
1045.                 if not any(name in exclude for name in constraint.fields):
1046.                     unique_checks.append((model_class, constraint.fields))
1047. 
1048.         # These are checks for the unique_for_<date/year/month>.
1049.         date_checks = []
1050. 
1051.         # Gather a list of checks for fields declared as unique and add them to
1052.         # the list of checks.
1053. 
1054.         fields_with_class = [(self.__class__, self._meta.local_fields)]
1055.         for parent_class in self._meta.get_parent_list():
1056.             fields_with_class.append((parent_class, parent_class._meta.local_fields))
1057. 
1058.         for model_class, fields in fields_with_class:
1059.             for f in fields:
1060.                 name = f.name
1061.                 if name in exclude:
1062.                     continue
1063.                 if f.unique:
1064.                     unique_checks.append((model_class, (name,)))
1065.                 if f.unique_for_date and f.unique_for_date not in exclude:
1066.                     date_checks.append((model_class, 'date', name, f.unique_for_date))
1067.                 if f.unique_for_year and f.unique_for_year not in exclude:
1068.                     date_checks.append((model_class, 'year', name, f.unique_for_year))
1069.                 if f.unique_for_month and f.unique_for_month not in exclude:
1070.                     date_checks.append((model_class, 'month', name, f.unique_for_month))
1071.         return unique_checks, date_checks
1072. 
1073.     def _perform_unique_checks(self, unique_checks):
1074.         errors = {}
1075. 
1076.         for model_class, unique_check in unique_checks:
1077.             # Try to look up an existing object with the same values as this
1078.             # object's values for all the unique field.
1079. 
1080.             lookup_kwargs = {}
1081.             for field_name in unique_check:
1082.                 f = self._meta.get_field(field_name)
1083.                 lookup_value = getattr(self, f.attname)
1084.                 # TODO: Handle multiple backends with different feature flags.
1085.                 if (lookup_value is None or
1086.                         (lookup_value == '' and connection.features.interprets_empty_strings_as_nulls)):
1087.                     # no value, skip the lookup
1088.                     continue
1089.                 if f.primary_key and not self._state.adding:
1090.                     # no need to check for unique primary key when editing
1091.                     continue
1092.                 lookup_kwargs[str(field_name)] = lookup_value
1093. 
1094.             # some fields were skipped, no reason to do the check
1095.             if len(unique_check) != len(lookup_kwargs):
1096.                 continue
1097. 
1098.             qs = model_class._default_manager.filter(**lookup_kwargs)
1099. 
1100.             # Exclude the current object from the query if we are editing an
1101.             # instance (as opposed to creating a new one)
1102.             # Note that we need to use the pk as defined by model_class, not
1103.             # self.pk. These can be different fields because model inheritance
1104.             # allows single model to have effectively multiple primary keys.
1105.             # Refs #17615.
1106.             model_class_pk = self._get_pk_val(model_class._meta)
1107.             if not self._state.adding and model_class_pk is not None:
1108.                 qs = qs.exclude(pk=model_class_pk)
1109.             if qs.exists():
1110.                 if len(unique_check) == 1:
1111.                     key = unique_check[0]
1112.                 else:
1113.                     key = NON_FIELD_ERRORS
1114.                 errors.setdefault(key, []).append(self.unique_error_message(model_class, unique_check))
1115. 
1116.         return errors
1117. 
1118.     def _perform_date_checks(self, date_checks):
1119.         errors = {}
1120.         for model_class, lookup_type, field, unique_for in date_checks:
1121.             lookup_kwargs = {}
1122.             # there's a ticket to add a date lookup, we can remove this special
1123.             # case if that makes it's way in
1124.             date = getattr(self, unique_for)
1125.             if date is None:
1126.                 continue
1127.             if lookup_type == 'date':
1128.                 lookup_kwargs['%s__day' % unique_for] = date.day
1129.                 lookup_kwargs['%s__month' % unique_for] = date.month
1130.                 lookup_kwargs['%s__year' % unique_for] = date.year
1131.             else:
1132.                 lookup_kwargs['%s__%s' % (unique_for, lookup_type)] = getattr(date, lookup_type)
1133.             lookup_kwargs[field] = getattr(self, field)
1134. 
1135.             qs = model_class._default_manager.filter(**lookup_kwargs)
1136.             # Exclude the current object from the query if we are editing an
1137.             # instance (as opposed to creating a new one)
1138.             if not self._state.adding and self.pk is not None:
1139.                 qs = qs.exclude(pk=self.pk)
1140. 
1141.             if qs.exists():
1142.                 errors.setdefault(field, []).append(
1143.                     self.date_error_message(lookup_type, field, unique_for)
1144.                 )
1145.         return errors
1146. 
1147.     def date_error_message(self, lookup_type, field_name, unique_for):
1148.         opts = self._meta
1149.         field = opts.get_field(field_name)
1150.         return ValidationError(
1151.             message=field.error_messages['unique_for_date'],
1152.             code='unique_for_date',
1153.             params={
1154.                 'model': self,
1155.                 'model_name': capfirst(opts.verbose_name),
1156.                 'lookup_type': lookup_type,
1157.                 'field': field_name,
1158.                 'field_label': capfirst(field.verbose_name),
1159.                 'date_field': unique_for,
1160.                 'date_field_label': capfirst(opts.get_field(unique_for).verbose_name),
1161.             }
1162.         )
1163. 
1164.     def unique_error_message(self, model_class, unique_check):
1165.         opts = model_class._meta
1166. 
1167.         params = {
1168.             'model': self,
1169.             'model_class': model_class,
1170.             'model_name': capfirst(opts.verbose_name),
1171.             'unique_check': unique_check,
1172.         }
1173. 
1174.         # A unique field
1175.         if len(unique_check) == 1:
1176.             field = opts.get_field(unique_check[0])
1177.             params['field_label'] = capfirst(field.verbose_name)
1178.             return ValidationError(
1179.                 message=field.error_messages['unique'],
1180.                 code='unique',
1181.                 params=params,
1182.             )
1183. 
1184.         # unique_together
1185.         else:
1186.             field_labels = [capfirst(opts.get_field(f).verbose_name) for f in unique_check]
1187.             params['field_labels'] = get_text_list(field_labels, _('and'))
1188.             return ValidationError(
1189.                 message=_("%(model_name)s with this %(field_labels)s already exists."),
1190.                 code='unique_together',
1191.                 params=params,
1192.             )
1193. 
1194.     def full_clean(self, exclude=None, validate_unique=True):
1195.         """
1196.         Call clean_fields(), clean(), and validate_unique() on the model.
1197.         Raise a ValidationError for any errors that occur.
1198.         """
1199.         errors = {}
1200.         if exclude is None:
1201.             exclude = []
1202.         else:
1203.             exclude = list(exclude)
1204. 
1205.         try:
1206.             self.clean_fields(exclude=exclude)
1207.         except ValidationError as e:
1208.             errors = e.update_error_dict(errors)
1209. 
1210.         # Form.clean() is run even if other validation fails, so do the
1211.         # same with Model.clean() for consistency.
1212.         try:
1213.             self.clean()
1214.         except ValidationError as e:
1215.             errors = e.update_error_dict(errors)
1216. 
1217.         # Run unique checks, but only for fields that passed validation.
1218.         if validate_unique:
1219.             for name in errors:
1220.                 if name != NON_FIELD_ERRORS and name not in exclude:
1221.                     exclude.append(name)
1222.             try:
1223.                 self.validate_unique(exclude=exclude)
1224.             except ValidationError as e:
1225.                 errors = e.update_error_dict(errors)
1226. 
1227.         if errors:
1228.             raise ValidationError(errors)
1229. 
1230.     def clean_fields(self, exclude=None):
1231.         """
1232.         Clean all fields and raise a ValidationError containing a dict
1233.         of all validation errors if any occur.
1234.         """
1235.         if exclude is None:
1236.             exclude = []
1237. 
1238.         errors = {}
1239.         for f in self._meta.fields:
1240.             if f.name in exclude:
1241.                 continue
1242.             # Skip validation for empty fields with blank=True. The developer
1243.             # is responsible for making sure they have a valid value.
1244.             raw_value = getattr(self, f.attname)
1245.             if f.blank and raw_value in f.empty_values:
1246.                 continue
1247.             try:
1248.                 setattr(self, f.attname, f.clean(raw_value, self))
1249.             except ValidationError as e:
1250.                 errors[f.name] = e.error_list
1251. 
1252.         if errors:
1253.             raise ValidationError(errors)
1254. 
1255.     @classmethod
1256.     def check(cls, **kwargs):
1257.         errors = [*cls._check_swappable(), *cls._check_model(), *cls._check_managers(**kwargs)]
1258.         if not cls._meta.swapped:
1259.             databases = kwargs.get('databases') or []
1260.             errors += [
1261.                 *cls._check_fields(**kwargs),
1262.                 *cls._check_m2m_through_same_relationship(),
1263.                 *cls._check_long_column_names(databases),
1264.             ]
1265.             clash_errors = (
1266.                 *cls._check_id_field(),
1267.                 *cls._check_field_name_clashes(),
1268.                 *cls._check_model_name_db_lookup_clashes(),
1269.                 *cls._check_property_name_related_field_accessor_clashes(),
1270.                 *cls._check_single_primary_key(),
1271.             )
1272.             errors.extend(clash_errors)
1273.             # If there are field name clashes, hide consequent column name
1274.             # clashes.
1275.             if not clash_errors:
1276.                 errors.extend(cls._check_column_name_clashes())
1277.             errors += [
1278.                 *cls._check_index_together(),
1279.                 *cls._check_unique_together(),
1280.                 *cls._check_indexes(databases),
1281.                 *cls._check_ordering(),
1282.                 *cls._check_constraints(databases),
1283.             ]
1284. 
1285.         return errors
1286. 
1287.     @classmethod
1288.     def _check_swappable(cls):
1289.         """Check if the swapped model exists."""
1290.         errors = []
1291.         if cls._meta.swapped:
1292.             try:
1293.                 apps.get_model(cls._meta.swapped)
1294.             except ValueError:
1295.                 errors.append(
1296.                     checks.Error(
1297.                         "'%s' is not of the form 'app_label.app_name'." % cls._meta.swappable,
1298.                         id='models.E001',
1299.                     )
1300.                 )
1301.             except LookupError:
1302.                 app_label, model_name = cls._meta.swapped.split('.')
1303.                 errors.append(
1304.                     checks.Error(
1305.                         "'%s' references '%s.%s', which has not been "
1306.                         "installed, or is abstract." % (
1307.                             cls._meta.swappable, app_label, model_name
1308.                         ),
1309.                         id='models.E002',
1310.                     )
1311.                 )
1312.         return errors
1313. 
1314.     @classmethod
1315.     def _check_model(cls):
1316.         errors = []
1317.         if cls._meta.proxy:
1318.             if cls._meta.local_fields or cls._meta.local_many_to_many:
1319.                 errors.append(
1320.                     checks.Error(
1321.                         "Proxy model '%s' contains model fields." % cls.__name__,
1322.                         id='models.E017',
1323.                     )
1324.                 )
1325.         return errors
1326. 
1327.     @classmethod
1328.     def _check_managers(cls, **kwargs):
1329.         """Perform all manager checks."""
1330.         errors = []
1331.         for manager in cls._meta.managers:
1332.             errors.extend(manager.check(**kwargs))
1333.         return errors
1334. 
1335.     @classmethod
1336.     def _check_fields(cls, **kwargs):
1337.         """Perform all field checks."""
1338.         errors = []
1339.         for field in cls._meta.local_fields:
1340.             errors.extend(field.check(**kwargs))
1341.         for field in cls._meta.local_many_to_many:
1342.             errors.extend(field.check(from_model=cls, **kwargs))
1343.         return errors
1344. 
1345.     @classmethod
1346.     def _check_m2m_through_same_relationship(cls):
1347.         """ Check if no relationship model is used by more than one m2m field.
1348.         """
1349. 
1350.         errors = []
1351.         seen_intermediary_signatures = []
1352. 
1353.         fields = cls._meta.local_many_to_many
1354. 
1355.         # Skip when the target model wasn't found.
1356.         fields = (f for f in fields if isinstance(f.remote_field.model, ModelBase))
1357. 
1358.         # Skip when the relationship model wasn't found.
1359.         fields = (f for f in fields if isinstance(f.remote_field.through, ModelBase))
1360. 
1361.         for f in fields:
1362.             signature = (f.remote_field.model, cls, f.remote_field.through, f.remote_field.through_fields)
1363.             if signature in seen_intermediary_signatures:
1364.                 errors.append(
1365.                     checks.Error(
1366.                         "The model has two identical many-to-many relations "
1367.                         "through the intermediate model '%s'." %
1368.                         f.remote_field.through._meta.label,
1369.                         obj=cls,
1370.                         id='models.E003',
1371.                     )
1372.                 )
1373.             else:
1374.                 seen_intermediary_signatures.append(signature)
1375.         return errors
1376. 
1377.     @classmethod
1378.     def _check_id_field(cls):
1379.         """Check if `id` field is a primary key."""
1380.         fields = [f for f in cls._meta.local_fields if f.name == 'id' and f != cls._meta.pk]
1381.         # fields is empty or consists of the invalid "id" field
1382.         if fields and not fields[0].primary_key and cls._meta.pk.name == 'id':
1383.             return [
1384.                 checks.Error(
1385.                     "'id' can only be used as a field name if the field also "
1386.                     "sets 'primary_key=True'.",
1387.                     obj=cls,
1388.                     id='models.E004',
1389.                 )
1390.             ]
1391.         else:
1392.             return []
1393. 
1394.     @classmethod
1395.     def _check_field_name_clashes(cls):
1396.         """Forbid field shadowing in multi-table inheritance."""
1397.         errors = []
1398.         used_fields = {}  # name or attname -> field
1399. 
1400.         # Check that multi-inheritance doesn't cause field name shadowing.
1401.         for parent in cls._meta.get_parent_list():
1402.             for f in parent._meta.local_fields:
1403.                 clash = used_fields.get(f.name) or used_fields.get(f.attname) or None
1404.                 if clash:
1405.                     errors.append(
1406.                         checks.Error(
1407.                             "The field '%s' from parent model "
1408.                             "'%s' clashes with the field '%s' "
1409.                             "from parent model '%s'." % (
1410.                                 clash.name, clash.model._meta,
1411.                                 f.name, f.model._meta
1412.                             ),
1413.                             obj=cls,
1414.                             id='models.E005',
1415.                         )
1416.                     )
1417.                 used_fields[f.name] = f
1418.                 used_fields[f.attname] = f
1419. 
1420.         # Check that fields defined in the model don't clash with fields from
1421.         # parents, including auto-generated fields like multi-table inheritance
1422.         # child accessors.
1423.         for parent in cls._meta.get_parent_list():
1424.             for f in parent._meta.get_fields():
1425.                 if f not in used_fields:
1426.                     used_fields[f.name] = f
1427. 
1428.         for f in cls._meta.local_fields:
1429.             clash = used_fields.get(f.name) or used_fields.get(f.attname) or None
1430.             # Note that we may detect clash between user-defined non-unique
1431.             # field "id" and automatically added unique field "id", both
1432.             # defined at the same model. This special case is considered in
1433.             # _check_id_field and here we ignore it.
1434.             id_conflict = f.name == "id" and clash and clash.name == "id" and clash.model == cls
1435.             if clash and not id_conflict:
1436.                 errors.append(
1437.                     checks.Error(
1438.                         "The field '%s' clashes with the field '%s' "
1439.                         "from model '%s'." % (
1440.                             f.name, clash.name, clash.model._meta
1441.                         ),
1442.                         obj=f,
1443.                         id='models.E006',
1444.                     )
1445.                 )
1446.             used_fields[f.name] = f
1447.             used_fields[f.attname] = f
1448. 
1449.         return errors
1450. 
1451.     @classmethod
1452.     def _check_column_name_clashes(cls):
1453.         # Store a list of column names which have already been used by other fields.
1454.         used_column_names = []
1455.         errors = []
1456. 
1457.         for f in cls._meta.local_fields:
1458.             _, column_name = f.get_attname_column()
1459. 
1460.             # Ensure the column name is not already in use.
1461.             if column_name and column_name in used_column_names:
1462.                 errors.append(
1463.                     checks.Error(
1464.                         "Field '%s' has column name '%s' that is used by "
1465.                         "another field." % (f.name, column_name),
1466.                         hint="Specify a 'db_column' for the field.",
1467.                         obj=cls,
1468.                         id='models.E007'
1469.                     )
1470.                 )
1471.             else:
1472.                 used_column_names.append(column_name)
1473. 
1474.         return errors
1475. 
1476.     @classmethod
1477.     def _check_model_name_db_lookup_clashes(cls):
1478.         errors = []
1479.         model_name = cls.__name__
1480.         if model_name.startswith('_') or model_name.endswith('_'):
1481.             errors.append(
1482.                 checks.Error(
1483.                     "The model name '%s' cannot start or end with an underscore "
1484.                     "as it collides with the query lookup syntax." % model_name,
1485.                     obj=cls,
1486.                     id='models.E023'
1487.                 )
1488.             )
1489.         elif LOOKUP_SEP in model_name:
1490.             errors.append(
1491.                 checks.Error(
1492.                     "The model name '%s' cannot contain double underscores as "
1493.                     "it collides with the query lookup syntax." % model_name,
1494.                     obj=cls,
1495.                     id='models.E024'
1496.                 )
1497.             )
1498.         return errors
1499. 
1500.     @classmethod
1501.     def _check_property_name_related_field_accessor_clashes(cls):
1502.         errors = []


File: django/db/models/fields/related.py
Line number range: 1 - 1501
Content:
1. import functools
2. import inspect
3. from functools import partial
4. 
5. from django import forms
6. from django.apps import apps
7. from django.conf import SettingsReference, settings
8. from django.core import checks, exceptions
9. from django.db import connection, router
10. from django.db.backends import utils
11. from django.db.models import Q
12. from django.db.models.constants import LOOKUP_SEP
13. from django.db.models.deletion import CASCADE, SET_DEFAULT, SET_NULL
14. from django.db.models.query_utils import PathInfo
15. from django.db.models.utils import make_model_tuple
16. from django.utils.functional import cached_property
17. from django.utils.translation import gettext_lazy as _
18. 
19. from . import Field
20. from .mixins import FieldCacheMixin
21. from .related_descriptors import (
22.     ForeignKeyDeferredAttribute, ForwardManyToOneDescriptor,
23.     ForwardOneToOneDescriptor, ManyToManyDescriptor,
24.     ReverseManyToOneDescriptor, ReverseOneToOneDescriptor,
25. )
26. from .related_lookups import (
27.     RelatedExact, RelatedGreaterThan, RelatedGreaterThanOrEqual, RelatedIn,
28.     RelatedIsNull, RelatedLessThan, RelatedLessThanOrEqual,
29. )
30. from .reverse_related import (
31.     ForeignObjectRel, ManyToManyRel, ManyToOneRel, OneToOneRel,
32. )
33. 
34. RECURSIVE_RELATIONSHIP_CONSTANT = 'self'
35. 
36. 
37. def resolve_relation(scope_model, relation):
38.     """
39.     Transform relation into a model or fully-qualified model string of the form
40.     "app_label.ModelName", relative to scope_model.
41. 
42.     The relation argument can be:
43.       * RECURSIVE_RELATIONSHIP_CONSTANT, i.e. the string "self", in which case
44.         the model argument will be returned.
45.       * A bare model name without an app_label, in which case scope_model's
46.         app_label will be prepended.
47.       * An "app_label.ModelName" string.
48.       * A model class, which will be returned unchanged.
49.     """
50.     # Check for recursive relations
51.     if relation == RECURSIVE_RELATIONSHIP_CONSTANT:
52.         relation = scope_model
53. 
54.     # Look for an "app.Model" relation
55.     if isinstance(relation, str):
56.         if "." not in relation:
57.             relation = "%s.%s" % (scope_model._meta.app_label, relation)
58. 
59.     return relation
60. 
61. 
62. def lazy_related_operation(function, model, *related_models, **kwargs):
63.     """
64.     Schedule `function` to be called once `model` and all `related_models`
65.     have been imported and registered with the app registry. `function` will
66.     be called with the newly-loaded model classes as its positional arguments,
67.     plus any optional keyword arguments.
68. 
69.     The `model` argument must be a model class. Each subsequent positional
70.     argument is another model, or a reference to another model - see
71.     `resolve_relation()` for the various forms these may take. Any relative
72.     references will be resolved relative to `model`.
73. 
74.     This is a convenience wrapper for `Apps.lazy_model_operation` - the app
75.     registry model used is the one found in `model._meta.apps`.
76.     """
77.     models = [model] + [resolve_relation(model, rel) for rel in related_models]
78.     model_keys = (make_model_tuple(m) for m in models)
79.     apps = model._meta.apps
80.     return apps.lazy_model_operation(partial(function, **kwargs), *model_keys)
81. 
82. 
83. class RelatedField(FieldCacheMixin, Field):
84.     """Base class that all relational fields inherit from."""
85. 
86.     # Field flags
87.     one_to_many = False
88.     one_to_one = False
89.     many_to_many = False
90.     many_to_one = False
91. 
92.     @cached_property
93.     def related_model(self):
94.         # Can't cache this property until all the models are loaded.
95.         apps.check_models_ready()
96.         return self.remote_field.model
97. 
98.     def check(self, **kwargs):
99.         return [
100.             *super().check(**kwargs),
101.             *self._check_related_name_is_valid(),
102.             *self._check_related_query_name_is_valid(),
103.             *self._check_relation_model_exists(),
104.             *self._check_referencing_to_swapped_model(),
105.             *self._check_clashes(),
106.         ]
107. 
108.     def _check_related_name_is_valid(self):
109.         import keyword
110.         related_name = self.remote_field.related_name
111.         if related_name is None:
112.             return []
113.         is_valid_id = not keyword.iskeyword(related_name) and related_name.isidentifier()
114.         if not (is_valid_id or related_name.endswith('+')):
115.             return [
116.                 checks.Error(
117.                     "The name '%s' is invalid related_name for field %s.%s" %
118.                     (self.remote_field.related_name, self.model._meta.object_name,
119.                      self.name),
120.                     hint="Related name must be a valid Python identifier or end with a '+'",
121.                     obj=self,
122.                     id='fields.E306',
123.                 )
124.             ]
125.         return []
126. 
127.     def _check_related_query_name_is_valid(self):
128.         if self.remote_field.is_hidden():
129.             return []
130.         rel_query_name = self.related_query_name()
131.         errors = []
132.         if rel_query_name.endswith('_'):
133.             errors.append(
134.                 checks.Error(
135.                     "Reverse query name '%s' must not end with an underscore."
136.                     % rel_query_name,
137.                     hint=("Add or change a related_name or related_query_name "
138.                           "argument for this field."),
139.                     obj=self,
140.                     id='fields.E308',
141.                 )
142.             )
143.         if LOOKUP_SEP in rel_query_name:
144.             errors.append(
145.                 checks.Error(
146.                     "Reverse query name '%s' must not contain '%s'."
147.                     % (rel_query_name, LOOKUP_SEP),
148.                     hint=("Add or change a related_name or related_query_name "
149.                           "argument for this field."),
150.                     obj=self,
151.                     id='fields.E309',
152.                 )
153.             )
154.         return errors
155. 
156.     def _check_relation_model_exists(self):
157.         rel_is_missing = self.remote_field.model not in self.opts.apps.get_models()
158.         rel_is_string = isinstance(self.remote_field.model, str)
159.         model_name = self.remote_field.model if rel_is_string else self.remote_field.model._meta.object_name
160.         if rel_is_missing and (rel_is_string or not self.remote_field.model._meta.swapped):
161.             return [
162.                 checks.Error(
163.                     "Field defines a relation with model '%s', which is either "
164.                     "not installed, or is abstract." % model_name,
165.                     obj=self,
166.                     id='fields.E300',
167.                 )
168.             ]
169.         return []
170. 
171.     def _check_referencing_to_swapped_model(self):
172.         if (self.remote_field.model not in self.opts.apps.get_models() and
173.                 not isinstance(self.remote_field.model, str) and
174.                 self.remote_field.model._meta.swapped):
175.             model = "%s.%s" % (
176.                 self.remote_field.model._meta.app_label,
177.                 self.remote_field.model._meta.object_name
178.             )
179.             return [
180.                 checks.Error(
181.                     "Field defines a relation with the model '%s', which has "
182.                     "been swapped out." % model,
183.                     hint="Update the relation to point at 'settings.%s'." % self.remote_field.model._meta.swappable,
184.                     obj=self,
185.                     id='fields.E301',
186.                 )
187.             ]
188.         return []
189. 
190.     def _check_clashes(self):
191.         """Check accessor and reverse query name clashes."""
192.         from django.db.models.base import ModelBase
193. 
194.         errors = []
195.         opts = self.model._meta
196. 
197.         # `f.remote_field.model` may be a string instead of a model. Skip if model name is
198.         # not resolved.
199.         if not isinstance(self.remote_field.model, ModelBase):
200.             return []
201. 
202.         # Consider that we are checking field `Model.foreign` and the models
203.         # are:
204.         #
205.         #     class Target(models.Model):
206.         #         model = models.IntegerField()
207.         #         model_set = models.IntegerField()
208.         #
209.         #     class Model(models.Model):
210.         #         foreign = models.ForeignKey(Target)
211.         #         m2m = models.ManyToManyField(Target)
212. 
213.         # rel_opts.object_name == "Target"
214.         rel_opts = self.remote_field.model._meta
215.         # If the field doesn't install a backward relation on the target model
216.         # (so `is_hidden` returns True), then there are no clashes to check
217.         # and we can skip these fields.
218.         rel_is_hidden = self.remote_field.is_hidden()
219.         rel_name = self.remote_field.get_accessor_name()  # i. e. "model_set"
220.         rel_query_name = self.related_query_name()  # i. e. "model"
221.         field_name = "%s.%s" % (opts.object_name, self.name)  # i. e. "Model.field"
222. 
223.         # Check clashes between accessor or reverse query name of `field`
224.         # and any other field name -- i.e. accessor for Model.foreign is
225.         # model_set and it clashes with Target.model_set.
226.         potential_clashes = rel_opts.fields + rel_opts.many_to_many
227.         for clash_field in potential_clashes:
228.             clash_name = "%s.%s" % (rel_opts.object_name, clash_field.name)  # i.e. "Target.model_set"
229.             if not rel_is_hidden and clash_field.name == rel_name:
230.                 errors.append(
231.                     checks.Error(
232.                         "Reverse accessor for '%s' clashes with field name '%s'." % (field_name, clash_name),
233.                         hint=("Rename field '%s', or add/change a related_name "
234.                               "argument to the definition for field '%s'.") % (clash_name, field_name),
235.                         obj=self,
236.                         id='fields.E302',
237.                     )
238.                 )
239. 
240.             if clash_field.name == rel_query_name:
241.                 errors.append(
242.                     checks.Error(
243.                         "Reverse query name for '%s' clashes with field name '%s'." % (field_name, clash_name),
244.                         hint=("Rename field '%s', or add/change a related_name "
245.                               "argument to the definition for field '%s'.") % (clash_name, field_name),
246.                         obj=self,
247.                         id='fields.E303',
248.                     )
249.                 )
250. 
251.         # Check clashes between accessors/reverse query names of `field` and
252.         # any other field accessor -- i. e. Model.foreign accessor clashes with
253.         # Model.m2m accessor.
254.         potential_clashes = (r for r in rel_opts.related_objects if r.field is not self)
255.         for clash_field in potential_clashes:
256.             clash_name = "%s.%s" % (  # i. e. "Model.m2m"
257.                 clash_field.related_model._meta.object_name,
258.                 clash_field.field.name)
259.             if not rel_is_hidden and clash_field.get_accessor_name() == rel_name:
260.                 errors.append(
261.                     checks.Error(
262.                         "Reverse accessor for '%s' clashes with reverse accessor for '%s'." % (field_name, clash_name),
263.                         hint=("Add or change a related_name argument "
264.                               "to the definition for '%s' or '%s'.") % (field_name, clash_name),
265.                         obj=self,
266.                         id='fields.E304',
267.                     )
268.                 )
269. 
270.             if clash_field.get_accessor_name() == rel_query_name:
271.                 errors.append(
272.                     checks.Error(
273.                         "Reverse query name for '%s' clashes with reverse query name for '%s'."
274.                         % (field_name, clash_name),
275.                         hint=("Add or change a related_name argument "
276.                               "to the definition for '%s' or '%s'.") % (field_name, clash_name),
277.                         obj=self,
278.                         id='fields.E305',
279.                     )
280.                 )
281. 
282.         return errors
283. 
284.     def db_type(self, connection):
285.         # By default related field will not have a column as it relates to
286.         # columns from another table.
287.         return None
288. 
289.     def contribute_to_class(self, cls, name, private_only=False, **kwargs):
290. 
291.         super().contribute_to_class(cls, name, private_only=private_only, **kwargs)
292. 
293.         self.opts = cls._meta
294. 
295.         if not cls._meta.abstract:
296.             if self.remote_field.related_name:
297.                 related_name = self.remote_field.related_name
298.             else:
299.                 related_name = self.opts.default_related_name
300.             if related_name:
301.                 related_name = related_name % {
302.                     'class': cls.__name__.lower(),
303.                     'model_name': cls._meta.model_name.lower(),
304.                     'app_label': cls._meta.app_label.lower()
305.                 }
306.                 self.remote_field.related_name = related_name
307. 
308.             if self.remote_field.related_query_name:
309.                 related_query_name = self.remote_field.related_query_name % {
310.                     'class': cls.__name__.lower(),
311.                     'app_label': cls._meta.app_label.lower(),
312.                 }
313.                 self.remote_field.related_query_name = related_query_name
314. 
315.             def resolve_related_class(model, related, field):
316.                 field.remote_field.model = related
317.                 field.do_related_class(related, model)
318.             lazy_related_operation(resolve_related_class, cls, self.remote_field.model, field=self)
319. 
320.     def deconstruct(self):
321.         name, path, args, kwargs = super().deconstruct()
322.         if self.remote_field.limit_choices_to:
323.             kwargs['limit_choices_to'] = self.remote_field.limit_choices_to
324.         if self.remote_field.related_name is not None:
325.             kwargs['related_name'] = self.remote_field.related_name
326.         if self.remote_field.related_query_name is not None:
327.             kwargs['related_query_name'] = self.remote_field.related_query_name
328.         return name, path, args, kwargs
329. 
330.     def get_forward_related_filter(self, obj):
331.         """
332.         Return the keyword arguments that when supplied to
333.         self.model.object.filter(), would select all instances related through
334.         this field to the remote obj. This is used to build the querysets
335.         returned by related descriptors. obj is an instance of
336.         self.related_field.model.
337.         """
338.         return {
339.             '%s__%s' % (self.name, rh_field.name): getattr(obj, rh_field.attname)
340.             for _, rh_field in self.related_fields
341.         }
342. 
343.     def get_reverse_related_filter(self, obj):
344.         """
345.         Complement to get_forward_related_filter(). Return the keyword
346.         arguments that when passed to self.related_field.model.object.filter()
347.         select all instances of self.related_field.model related through
348.         this field to obj. obj is an instance of self.model.
349.         """
350.         base_filter = {
351.             rh_field.attname: getattr(obj, lh_field.attname)
352.             for lh_field, rh_field in self.related_fields
353.         }
354.         descriptor_filter = self.get_extra_descriptor_filter(obj)
355.         base_q = Q(**base_filter)
356.         if isinstance(descriptor_filter, dict):
357.             return base_q & Q(**descriptor_filter)
358.         elif descriptor_filter:
359.             return base_q & descriptor_filter
360.         return base_q
361. 
362.     @property
363.     def swappable_setting(self):
364.         """
365.         Get the setting that this is powered from for swapping, or None
366.         if it's not swapped in / marked with swappable=False.
367.         """
368.         if self.swappable:
369.             # Work out string form of "to"
370.             if isinstance(self.remote_field.model, str):
371.                 to_string = self.remote_field.model
372.             else:
373.                 to_string = self.remote_field.model._meta.label
374.             return apps.get_swappable_settings_name(to_string)
375.         return None
376. 
377.     def set_attributes_from_rel(self):
378.         self.name = (
379.             self.name or
380.             (self.remote_field.model._meta.model_name + '_' + self.remote_field.model._meta.pk.name)
381.         )
382.         if self.verbose_name is None:
383.             self.verbose_name = self.remote_field.model._meta.verbose_name
384.         self.remote_field.set_field_name()
385. 
386.     def do_related_class(self, other, cls):
387.         self.set_attributes_from_rel()
388.         self.contribute_to_related_class(other, self.remote_field)
389. 
390.     def get_limit_choices_to(self):
391.         """
392.         Return ``limit_choices_to`` for this model field.
393. 
394.         If it is a callable, it will be invoked and the result will be
395.         returned.
396.         """
397.         if callable(self.remote_field.limit_choices_to):
398.             return self.remote_field.limit_choices_to()
399.         return self.remote_field.limit_choices_to
400. 
401.     def formfield(self, **kwargs):
402.         """
403.         Pass ``limit_choices_to`` to the field being constructed.
404. 
405.         Only passes it if there is a type that supports related fields.
406.         This is a similar strategy used to pass the ``queryset`` to the field
407.         being constructed.
408.         """
409.         defaults = {}
410.         if hasattr(self.remote_field, 'get_related_field'):
411.             # If this is a callable, do not invoke it here. Just pass
412.             # it in the defaults for when the form class will later be
413.             # instantiated.
414.             limit_choices_to = self.remote_field.limit_choices_to
415.             defaults.update({
416.                 'limit_choices_to': limit_choices_to,
417.             })
418.         defaults.update(kwargs)
419.         return super().formfield(**defaults)
420. 
421.     def related_query_name(self):
422.         """
423.         Define the name that can be used to identify this related object in a
424.         table-spanning query.
425.         """
426.         return self.remote_field.related_query_name or self.remote_field.related_name or self.opts.model_name
427. 
428.     @property
429.     def target_field(self):
430.         """
431.         When filtering against this relation, return the field on the remote
432.         model against which the filtering should happen.
433.         """
434.         target_fields = self.get_path_info()[-1].target_fields
435.         if len(target_fields) > 1:
436.             raise exceptions.FieldError(
437.                 "The relation has multiple target fields, but only single target field was asked for")
438.         return target_fields[0]
439. 
440.     def get_cache_name(self):
441.         return self.name
442. 
443. 
444. class ForeignObject(RelatedField):
445.     """
446.     Abstraction of the ForeignKey relation to support multi-column relations.
447.     """
448. 
449.     # Field flags
450.     many_to_many = False
451.     many_to_one = True
452.     one_to_many = False
453.     one_to_one = False
454. 
455.     requires_unique_target = True
456.     related_accessor_class = ReverseManyToOneDescriptor
457.     forward_related_accessor_class = ForwardManyToOneDescriptor
458.     rel_class = ForeignObjectRel
459. 
460.     def __init__(self, to, on_delete, from_fields, to_fields, rel=None, related_name=None,
461.                  related_query_name=None, limit_choices_to=None, parent_link=False,
462.                  swappable=True, **kwargs):
463. 
464.         if rel is None:
465.             rel = self.rel_class(
466.                 self, to,
467.                 related_name=related_name,
468.                 related_query_name=related_query_name,
469.                 limit_choices_to=limit_choices_to,
470.                 parent_link=parent_link,
471.                 on_delete=on_delete,
472.             )
473. 
474.         super().__init__(rel=rel, **kwargs)
475. 
476.         self.from_fields = from_fields
477.         self.to_fields = to_fields
478.         self.swappable = swappable
479. 
480.     def check(self, **kwargs):
481.         return [
482.             *super().check(**kwargs),
483.             *self._check_to_fields_exist(),
484.             *self._check_unique_target(),
485.         ]
486. 
487.     def _check_to_fields_exist(self):
488.         # Skip nonexistent models.
489.         if isinstance(self.remote_field.model, str):
490.             return []
491. 
492.         errors = []
493.         for to_field in self.to_fields:
494.             if to_field:
495.                 try:
496.                     self.remote_field.model._meta.get_field(to_field)
497.                 except exceptions.FieldDoesNotExist:
498.                     errors.append(
499.                         checks.Error(
500.                             "The to_field '%s' doesn't exist on the related "
501.                             "model '%s'."
502.                             % (to_field, self.remote_field.model._meta.label),
503.                             obj=self,
504.                             id='fields.E312',
505.                         )
506.                     )
507.         return errors
508. 
509.     def _check_unique_target(self):
510.         rel_is_string = isinstance(self.remote_field.model, str)
511.         if rel_is_string or not self.requires_unique_target:
512.             return []
513. 
514.         try:
515.             self.foreign_related_fields
516.         except exceptions.FieldDoesNotExist:
517.             return []
518. 
519.         if not self.foreign_related_fields:
520.             return []
521. 
522.         unique_foreign_fields = {
523.             frozenset([f.name])
524.             for f in self.remote_field.model._meta.get_fields()
525.             if getattr(f, 'unique', False)
526.         }
527.         unique_foreign_fields.update({
528.             frozenset(ut)
529.             for ut in self.remote_field.model._meta.unique_together
530.         })
531.         unique_foreign_fields.update({
532.             frozenset(uc.fields)
533.             for uc in self.remote_field.model._meta.total_unique_constraints
534.         })
535.         foreign_fields = {f.name for f in self.foreign_related_fields}
536.         has_unique_constraint = any(u <= foreign_fields for u in unique_foreign_fields)
537. 
538.         if not has_unique_constraint and len(self.foreign_related_fields) > 1:
539.             field_combination = ', '.join(
540.                 "'%s'" % rel_field.name for rel_field in self.foreign_related_fields
541.             )
542.             model_name = self.remote_field.model.__name__
543.             return [
544.                 checks.Error(
545.                     "No subset of the fields %s on model '%s' is unique."
546.                     % (field_combination, model_name),
547.                     hint=(
548.                         'Mark a single field as unique=True or add a set of '
549.                         'fields to a unique constraint (via unique_together '
550.                         'or a UniqueConstraint (without condition) in the '
551.                         'model Meta.constraints).'
552.                     ),
553.                     obj=self,
554.                     id='fields.E310',
555.                 )
556.             ]
557.         elif not has_unique_constraint:
558.             field_name = self.foreign_related_fields[0].name
559.             model_name = self.remote_field.model.__name__
560.             return [
561.                 checks.Error(
562.                     "'%s.%s' must be unique because it is referenced by "
563.                     "a foreign key." % (model_name, field_name),
564.                     hint=(
565.                         'Add unique=True to this field or add a '
566.                         'UniqueConstraint (without condition) in the model '
567.                         'Meta.constraints.'
568.                     ),
569.                     obj=self,
570.                     id='fields.E311',
571.                 )
572.             ]
573.         else:
574.             return []
575. 
576.     def deconstruct(self):
577.         name, path, args, kwargs = super().deconstruct()
578.         kwargs['on_delete'] = self.remote_field.on_delete
579.         kwargs['from_fields'] = self.from_fields
580.         kwargs['to_fields'] = self.to_fields
581. 
582.         if self.remote_field.parent_link:
583.             kwargs['parent_link'] = self.remote_field.parent_link
584.         if isinstance(self.remote_field.model, str):
585.             kwargs['to'] = self.remote_field.model.lower()
586.         else:
587.             kwargs['to'] = self.remote_field.model._meta.label_lower
588.         # If swappable is True, then see if we're actually pointing to the target
589.         # of a swap.
590.         swappable_setting = self.swappable_setting
591.         if swappable_setting is not None:
592.             # If it's already a settings reference, error
593.             if hasattr(kwargs['to'], "setting_name"):
594.                 if kwargs['to'].setting_name != swappable_setting:
595.                     raise ValueError(
596.                         "Cannot deconstruct a ForeignKey pointing to a model "
597.                         "that is swapped in place of more than one model (%s and %s)"
598.                         % (kwargs['to'].setting_name, swappable_setting)
599.                     )
600.             # Set it
601.             kwargs['to'] = SettingsReference(
602.                 kwargs['to'],
603.                 swappable_setting,
604.             )
605.         return name, path, args, kwargs
606. 
607.     def resolve_related_fields(self):
608.         if not self.from_fields or len(self.from_fields) != len(self.to_fields):
609.             raise ValueError('Foreign Object from and to fields must be the same non-zero length')
610.         if isinstance(self.remote_field.model, str):
611.             raise ValueError('Related model %r cannot be resolved' % self.remote_field.model)
612.         related_fields = []
613.         for index in range(len(self.from_fields)):
614.             from_field_name = self.from_fields[index]
615.             to_field_name = self.to_fields[index]
616.             from_field = (
617.                 self
618.                 if from_field_name == RECURSIVE_RELATIONSHIP_CONSTANT
619.                 else self.opts.get_field(from_field_name)
620.             )
621.             to_field = (self.remote_field.model._meta.pk if to_field_name is None
622.                         else self.remote_field.model._meta.get_field(to_field_name))
623.             related_fields.append((from_field, to_field))
624.         return related_fields
625. 
626.     @cached_property
627.     def related_fields(self):
628.         return self.resolve_related_fields()
629. 
630.     @cached_property
631.     def reverse_related_fields(self):
632.         return [(rhs_field, lhs_field) for lhs_field, rhs_field in self.related_fields]
633. 
634.     @cached_property
635.     def local_related_fields(self):
636.         return tuple(lhs_field for lhs_field, rhs_field in self.related_fields)
637. 
638.     @cached_property
639.     def foreign_related_fields(self):
640.         return tuple(rhs_field for lhs_field, rhs_field in self.related_fields if rhs_field)
641. 
642.     def get_local_related_value(self, instance):
643.         return self.get_instance_value_for_fields(instance, self.local_related_fields)
644. 
645.     def get_foreign_related_value(self, instance):
646.         return self.get_instance_value_for_fields(instance, self.foreign_related_fields)
647. 
648.     @staticmethod
649.     def get_instance_value_for_fields(instance, fields):
650.         ret = []
651.         opts = instance._meta
652.         for field in fields:
653.             # Gotcha: in some cases (like fixture loading) a model can have
654.             # different values in parent_ptr_id and parent's id. So, use
655.             # instance.pk (that is, parent_ptr_id) when asked for instance.id.
656.             if field.primary_key:
657.                 possible_parent_link = opts.get_ancestor_link(field.model)
658.                 if (not possible_parent_link or
659.                         possible_parent_link.primary_key or
660.                         possible_parent_link.model._meta.abstract):
661.                     ret.append(instance.pk)
662.                     continue
663.             ret.append(getattr(instance, field.attname))
664.         return tuple(ret)
665. 
666.     def get_attname_column(self):
667.         attname, column = super().get_attname_column()
668.         return attname, None
669. 
670.     def get_joining_columns(self, reverse_join=False):
671.         source = self.reverse_related_fields if reverse_join else self.related_fields
672.         return tuple((lhs_field.column, rhs_field.column) for lhs_field, rhs_field in source)
673. 
674.     def get_reverse_joining_columns(self):
675.         return self.get_joining_columns(reverse_join=True)
676. 
677.     def get_extra_descriptor_filter(self, instance):
678.         """
679.         Return an extra filter condition for related object fetching when
680.         user does 'instance.fieldname', that is the extra filter is used in
681.         the descriptor of the field.
682. 
683.         The filter should be either a dict usable in .filter(**kwargs) call or
684.         a Q-object. The condition will be ANDed together with the relation's
685.         joining columns.
686. 
687.         A parallel method is get_extra_restriction() which is used in
688.         JOIN and subquery conditions.
689.         """
690.         return {}
691. 
692.     def get_extra_restriction(self, where_class, alias, related_alias):
693.         """
694.         Return a pair condition used for joining and subquery pushdown. The
695.         condition is something that responds to as_sql(compiler, connection)
696.         method.
697. 
698.         Note that currently referring both the 'alias' and 'related_alias'
699.         will not work in some conditions, like subquery pushdown.
700. 
701.         A parallel method is get_extra_descriptor_filter() which is used in
702.         instance.fieldname related object fetching.
703.         """
704.         return None
705. 
706.     def get_path_info(self, filtered_relation=None):
707.         """Get path from this field to the related model."""
708.         opts = self.remote_field.model._meta
709.         from_opts = self.model._meta
710.         return [PathInfo(
711.             from_opts=from_opts,
712.             to_opts=opts,
713.             target_fields=self.foreign_related_fields,
714.             join_field=self,
715.             m2m=False,
716.             direct=True,
717.             filtered_relation=filtered_relation,
718.         )]
719. 
720.     def get_reverse_path_info(self, filtered_relation=None):
721.         """Get path from the related model to this field's model."""
722.         opts = self.model._meta
723.         from_opts = self.remote_field.model._meta
724.         return [PathInfo(
725.             from_opts=from_opts,
726.             to_opts=opts,
727.             target_fields=(opts.pk,),
728.             join_field=self.remote_field,
729.             m2m=not self.unique,
730.             direct=False,
731.             filtered_relation=filtered_relation,
732.         )]
733. 
734.     @classmethod
735.     @functools.lru_cache(maxsize=None)
736.     def get_lookups(cls):
737.         bases = inspect.getmro(cls)
738.         bases = bases[:bases.index(ForeignObject) + 1]
739.         class_lookups = [parent.__dict__.get('class_lookups', {}) for parent in bases]
740.         return cls.merge_dicts(class_lookups)
741. 
742.     def contribute_to_class(self, cls, name, private_only=False, **kwargs):
743.         super().contribute_to_class(cls, name, private_only=private_only, **kwargs)
744.         setattr(cls, self.name, self.forward_related_accessor_class(self))
745. 
746.     def contribute_to_related_class(self, cls, related):
747.         # Internal FK's - i.e., those with a related name ending with '+' -
748.         # and swapped models don't get a related descriptor.
749.         if not self.remote_field.is_hidden() and not related.related_model._meta.swapped:
750.             setattr(cls._meta.concrete_model, related.get_accessor_name(), self.related_accessor_class(related))
751.             # While 'limit_choices_to' might be a callable, simply pass
752.             # it along for later - this is too early because it's still
753.             # model load time.
754.             if self.remote_field.limit_choices_to:
755.                 cls._meta.related_fkey_lookups.append(self.remote_field.limit_choices_to)
756. 
757. 
758. ForeignObject.register_lookup(RelatedIn)
759. ForeignObject.register_lookup(RelatedExact)
760. ForeignObject.register_lookup(RelatedLessThan)
761. ForeignObject.register_lookup(RelatedGreaterThan)
762. ForeignObject.register_lookup(RelatedGreaterThanOrEqual)
763. ForeignObject.register_lookup(RelatedLessThanOrEqual)
764. ForeignObject.register_lookup(RelatedIsNull)
765. 
766. 
767. class ForeignKey(ForeignObject):
768.     """
769.     Provide a many-to-one relation by adding a column to the local model
770.     to hold the remote value.
771. 
772.     By default ForeignKey will target the pk of the remote model but this
773.     behavior can be changed by using the ``to_field`` argument.
774.     """
775.     descriptor_class = ForeignKeyDeferredAttribute
776.     # Field flags
777.     many_to_many = False
778.     many_to_one = True
779.     one_to_many = False
780.     one_to_one = False
781. 
782.     rel_class = ManyToOneRel
783. 
784.     empty_strings_allowed = False
785.     default_error_messages = {
786.         'invalid': _('%(model)s instance with %(field)s %(value)r does not exist.')
787.     }
788.     description = _("Foreign Key (type determined by related field)")
789. 
790.     def __init__(self, to, on_delete, related_name=None, related_query_name=None,
791.                  limit_choices_to=None, parent_link=False, to_field=None,
792.                  db_constraint=True, **kwargs):
793.         try:
794.             to._meta.model_name
795.         except AttributeError:
796.             assert isinstance(to, str), (
797.                 "%s(%r) is invalid. First parameter to ForeignKey must be "
798.                 "either a model, a model name, or the string %r" % (
799.                     self.__class__.__name__, to,
800.                     RECURSIVE_RELATIONSHIP_CONSTANT,
801.                 )
802.             )
803.         else:
804.             # For backwards compatibility purposes, we need to *try* and set
805.             # the to_field during FK construction. It won't be guaranteed to
806.             # be correct until contribute_to_class is called. Refs #12190.
807.             to_field = to_field or (to._meta.pk and to._meta.pk.name)
808.         if not callable(on_delete):
809.             raise TypeError('on_delete must be callable.')
810. 
811.         kwargs['rel'] = self.rel_class(
812.             self, to, to_field,
813.             related_name=related_name,
814.             related_query_name=related_query_name,
815.             limit_choices_to=limit_choices_to,
816.             parent_link=parent_link,
817.             on_delete=on_delete,
818.         )
819.         kwargs.setdefault('db_index', True)
820. 
821.         super().__init__(
822.             to,
823.             on_delete,
824.             from_fields=[RECURSIVE_RELATIONSHIP_CONSTANT],
825.             to_fields=[to_field],
826.             **kwargs,
827.         )
828.         self.db_constraint = db_constraint
829. 
830.     def check(self, **kwargs):
831.         return [
832.             *super().check(**kwargs),
833.             *self._check_on_delete(),
834.             *self._check_unique(),
835.         ]
836. 
837.     def _check_on_delete(self):
838.         on_delete = getattr(self.remote_field, 'on_delete', None)
839.         if on_delete == SET_NULL and not self.null:
840.             return [
841.                 checks.Error(
842.                     'Field specifies on_delete=SET_NULL, but cannot be null.',
843.                     hint='Set null=True argument on the field, or change the on_delete rule.',
844.                     obj=self,
845.                     id='fields.E320',
846.                 )
847.             ]
848.         elif on_delete == SET_DEFAULT and not self.has_default():
849.             return [
850.                 checks.Error(
851.                     'Field specifies on_delete=SET_DEFAULT, but has no default value.',
852.                     hint='Set a default value, or change the on_delete rule.',
853.                     obj=self,
854.                     id='fields.E321',
855.                 )
856.             ]
857.         else:
858.             return []
859. 
860.     def _check_unique(self, **kwargs):
861.         return [
862.             checks.Warning(
863.                 'Setting unique=True on a ForeignKey has the same effect as using a OneToOneField.',
864.                 hint='ForeignKey(unique=True) is usually better served by a OneToOneField.',
865.                 obj=self,
866.                 id='fields.W342',
867.             )
868.         ] if self.unique else []
869. 
870.     def deconstruct(self):
871.         name, path, args, kwargs = super().deconstruct()
872.         del kwargs['to_fields']
873.         del kwargs['from_fields']
874.         # Handle the simpler arguments
875.         if self.db_index:
876.             del kwargs['db_index']
877.         else:
878.             kwargs['db_index'] = False
879.         if self.db_constraint is not True:
880.             kwargs['db_constraint'] = self.db_constraint
881.         # Rel needs more work.
882.         to_meta = getattr(self.remote_field.model, "_meta", None)
883.         if self.remote_field.field_name and (
884.                 not to_meta or (to_meta.pk and self.remote_field.field_name != to_meta.pk.name)):
885.             kwargs['to_field'] = self.remote_field.field_name
886.         return name, path, args, kwargs
887. 
888.     def to_python(self, value):
889.         return self.target_field.to_python(value)
890. 
891.     @property
892.     def target_field(self):
893.         return self.foreign_related_fields[0]
894. 
895.     def get_reverse_path_info(self, filtered_relation=None):
896.         """Get path from the related model to this field's model."""
897.         opts = self.model._meta
898.         from_opts = self.remote_field.model._meta
899.         return [PathInfo(
900.             from_opts=from_opts,
901.             to_opts=opts,
902.             target_fields=(opts.pk,),
903.             join_field=self.remote_field,
904.             m2m=not self.unique,
905.             direct=False,
906.             filtered_relation=filtered_relation,
907.         )]
908. 
909.     def validate(self, value, model_instance):
910.         if self.remote_field.parent_link:
911.             return
912.         super().validate(value, model_instance)
913.         if value is None:
914.             return
915. 
916.         using = router.db_for_read(self.remote_field.model, instance=model_instance)
917.         qs = self.remote_field.model._default_manager.using(using).filter(
918.             **{self.remote_field.field_name: value}
919.         )
920.         qs = qs.complex_filter(self.get_limit_choices_to())
921.         if not qs.exists():
922.             raise exceptions.ValidationError(
923.                 self.error_messages['invalid'],
924.                 code='invalid',
925.                 params={
926.                     'model': self.remote_field.model._meta.verbose_name, 'pk': value,
927.                     'field': self.remote_field.field_name, 'value': value,
928.                 },  # 'pk' is included for backwards compatibility
929.             )
930. 
931.     def resolve_related_fields(self):
932.         related_fields = super().resolve_related_fields()
933.         for from_field, to_field in related_fields:
934.             if to_field and to_field.model != self.remote_field.model._meta.concrete_model:
935.                 raise exceptions.FieldError(
936.                     "'%s.%s' refers to field '%s' which is not local to model "
937.                     "'%s'." % (
938.                         self.model._meta.label,
939.                         self.name,
940.                         to_field.name,
941.                         self.remote_field.model._meta.concrete_model._meta.label,
942.                     )
943.                 )
944.         return related_fields
945. 
946.     def get_attname(self):
947.         return '%s_id' % self.name
948. 
949.     def get_attname_column(self):
950.         attname = self.get_attname()
951.         column = self.db_column or attname
952.         return attname, column
953. 
954.     def get_default(self):
955.         """Return the to_field if the default value is an object."""
956.         field_default = super().get_default()
957.         if isinstance(field_default, self.remote_field.model):
958.             return getattr(field_default, self.target_field.attname)
959.         return field_default
960. 
961.     def get_db_prep_save(self, value, connection):
962.         if value is None or (value == '' and
963.                              (not self.target_field.empty_strings_allowed or
964.                               connection.features.interprets_empty_strings_as_nulls)):
965.             return None
966.         else:
967.             return self.target_field.get_db_prep_save(value, connection=connection)
968. 
969.     def get_db_prep_value(self, value, connection, prepared=False):
970.         return self.target_field.get_db_prep_value(value, connection, prepared)
971. 
972.     def get_prep_value(self, value):
973.         return self.target_field.get_prep_value(value)
974. 
975.     def contribute_to_related_class(self, cls, related):
976.         super().contribute_to_related_class(cls, related)
977.         if self.remote_field.field_name is None:
978.             self.remote_field.field_name = cls._meta.pk.name
979. 
980.     def formfield(self, *, using=None, **kwargs):
981.         if isinstance(self.remote_field.model, str):
982.             raise ValueError("Cannot create form field for %r yet, because "
983.                              "its related model %r has not been loaded yet" %
984.                              (self.name, self.remote_field.model))
985.         return super().formfield(**{
986.             'form_class': forms.ModelChoiceField,
987.             'queryset': self.remote_field.model._default_manager.using(using),
988.             'to_field_name': self.remote_field.field_name,
989.             **kwargs,
990.             'blank': self.blank,
991.         })
992. 
993.     def db_check(self, connection):
994.         return []
995. 
996.     def db_type(self, connection):
997.         return self.target_field.rel_db_type(connection=connection)
998. 
999.     def db_parameters(self, connection):
1000.         return {"type": self.db_type(connection), "check": self.db_check(connection)}
1001. 
1002.     def convert_empty_strings(self, value, expression, connection):
1003.         if (not value) and isinstance(value, str):
1004.             return None
1005.         return value
1006. 
1007.     def get_db_converters(self, connection):
1008.         converters = super().get_db_converters(connection)
1009.         if connection.features.interprets_empty_strings_as_nulls:
1010.             converters += [self.convert_empty_strings]
1011.         return converters
1012. 
1013.     def get_col(self, alias, output_field=None):
1014.         if output_field is None:
1015.             output_field = self.target_field
1016.             while isinstance(output_field, ForeignKey):
1017.                 output_field = output_field.target_field
1018.                 if output_field is self:
1019.                     raise ValueError('Cannot resolve output_field.')
1020.         return super().get_col(alias, output_field)
1021. 
1022. 
1023. class OneToOneField(ForeignKey):
1024.     """
1025.     A OneToOneField is essentially the same as a ForeignKey, with the exception
1026.     that it always carries a "unique" constraint with it and the reverse
1027.     relation always returns the object pointed to (since there will only ever
1028.     be one), rather than returning a list.
1029.     """
1030. 
1031.     # Field flags
1032.     many_to_many = False
1033.     many_to_one = False
1034.     one_to_many = False
1035.     one_to_one = True
1036. 
1037.     related_accessor_class = ReverseOneToOneDescriptor
1038.     forward_related_accessor_class = ForwardOneToOneDescriptor
1039.     rel_class = OneToOneRel
1040. 
1041.     description = _("One-to-one relationship")
1042. 
1043.     def __init__(self, to, on_delete, to_field=None, **kwargs):
1044.         kwargs['unique'] = True
1045.         super().__init__(to, on_delete, to_field=to_field, **kwargs)
1046. 
1047.     def deconstruct(self):
1048.         name, path, args, kwargs = super().deconstruct()
1049.         if "unique" in kwargs:
1050.             del kwargs['unique']
1051.         return name, path, args, kwargs
1052. 
1053.     def formfield(self, **kwargs):
1054.         if self.remote_field.parent_link:
1055.             return None
1056.         return super().formfield(**kwargs)
1057. 
1058.     def save_form_data(self, instance, data):
1059.         if isinstance(data, self.remote_field.model):
1060.             setattr(instance, self.name, data)
1061.         else:
1062.             setattr(instance, self.attname, data)
1063.             # Remote field object must be cleared otherwise Model.save()
1064.             # will reassign attname using the related object pk.
1065.             if data is None:
1066.                 setattr(instance, self.name, data)
1067. 
1068.     def _check_unique(self, **kwargs):
1069.         # Override ForeignKey since check isn't applicable here.
1070.         return []
1071. 
1072. 
1073. def create_many_to_many_intermediary_model(field, klass):
1074.     from django.db import models
1075. 
1076.     def set_managed(model, related, through):
1077.         through._meta.managed = model._meta.managed or related._meta.managed
1078. 
1079.     to_model = resolve_relation(klass, field.remote_field.model)
1080.     name = '%s_%s' % (klass._meta.object_name, field.name)
1081.     lazy_related_operation(set_managed, klass, to_model, name)
1082. 
1083.     to = make_model_tuple(to_model)[1]
1084.     from_ = klass._meta.model_name
1085.     if to == from_:
1086.         to = 'to_%s' % to
1087.         from_ = 'from_%s' % from_
1088. 
1089.     meta = type('Meta', (), {
1090.         'db_table': field._get_m2m_db_table(klass._meta),
1091.         'auto_created': klass,
1092.         'app_label': klass._meta.app_label,
1093.         'db_tablespace': klass._meta.db_tablespace,
1094.         'unique_together': (from_, to),
1095.         'verbose_name': _('%(from)s-%(to)s relationship') % {'from': from_, 'to': to},
1096.         'verbose_name_plural': _('%(from)s-%(to)s relationships') % {'from': from_, 'to': to},
1097.         'apps': field.model._meta.apps,
1098.     })
1099.     # Construct and return the new class.
1100.     return type(name, (models.Model,), {
1101.         'Meta': meta,
1102.         '__module__': klass.__module__,
1103.         from_: models.ForeignKey(
1104.             klass,
1105.             related_name='%s+' % name,
1106.             db_tablespace=field.db_tablespace,
1107.             db_constraint=field.remote_field.db_constraint,
1108.             on_delete=CASCADE,
1109.         ),
1110.         to: models.ForeignKey(
1111.             to_model,
1112.             related_name='%s+' % name,
1113.             db_tablespace=field.db_tablespace,
1114.             db_constraint=field.remote_field.db_constraint,
1115.             on_delete=CASCADE,
1116.         )
1117.     })
1118. 
1119. 
1120. class ManyToManyField(RelatedField):
1121.     """
1122.     Provide a many-to-many relation by using an intermediary model that
1123.     holds two ForeignKey fields pointed at the two sides of the relation.
1124. 
1125.     Unless a ``through`` model was provided, ManyToManyField will use the
1126.     create_many_to_many_intermediary_model factory to automatically generate
1127.     the intermediary model.
1128.     """
1129. 
1130.     # Field flags
1131.     many_to_many = True
1132.     many_to_one = False
1133.     one_to_many = False
1134.     one_to_one = False
1135. 
1136.     rel_class = ManyToManyRel
1137. 
1138.     description = _("Many-to-many relationship")
1139. 
1140.     def __init__(self, to, related_name=None, related_query_name=None,
1141.                  limit_choices_to=None, symmetrical=None, through=None,
1142.                  through_fields=None, db_constraint=True, db_table=None,
1143.                  swappable=True, **kwargs):
1144.         try:
1145.             to._meta
1146.         except AttributeError:
1147.             assert isinstance(to, str), (
1148.                 "%s(%r) is invalid. First parameter to ManyToManyField must be "
1149.                 "either a model, a model name, or the string %r" %
1150.                 (self.__class__.__name__, to, RECURSIVE_RELATIONSHIP_CONSTANT)
1151.             )
1152. 
1153.         if symmetrical is None:
1154.             symmetrical = (to == RECURSIVE_RELATIONSHIP_CONSTANT)
1155. 
1156.         if through is not None:
1157.             assert db_table is None, (
1158.                 "Cannot specify a db_table if an intermediary model is used."
1159.             )
1160. 
1161.         kwargs['rel'] = self.rel_class(
1162.             self, to,
1163.             related_name=related_name,
1164.             related_query_name=related_query_name,
1165.             limit_choices_to=limit_choices_to,
1166.             symmetrical=symmetrical,
1167.             through=through,
1168.             through_fields=through_fields,
1169.             db_constraint=db_constraint,
1170.         )
1171.         self.has_null_arg = 'null' in kwargs
1172. 
1173.         super().__init__(**kwargs)
1174. 
1175.         self.db_table = db_table
1176.         self.swappable = swappable
1177. 
1178.     def check(self, **kwargs):
1179.         return [
1180.             *super().check(**kwargs),
1181.             *self._check_unique(**kwargs),
1182.             *self._check_relationship_model(**kwargs),
1183.             *self._check_ignored_options(**kwargs),
1184.             *self._check_table_uniqueness(**kwargs),
1185.         ]
1186. 
1187.     def _check_unique(self, **kwargs):
1188.         if self.unique:
1189.             return [
1190.                 checks.Error(
1191.                     'ManyToManyFields cannot be unique.',
1192.                     obj=self,
1193.                     id='fields.E330',
1194.                 )
1195.             ]
1196.         return []
1197. 
1198.     def _check_ignored_options(self, **kwargs):
1199.         warnings = []
1200. 
1201.         if self.has_null_arg:
1202.             warnings.append(
1203.                 checks.Warning(
1204.                     'null has no effect on ManyToManyField.',
1205.                     obj=self,
1206.                     id='fields.W340',
1207.                 )
1208.             )
1209. 
1210.         if self._validators:
1211.             warnings.append(
1212.                 checks.Warning(
1213.                     'ManyToManyField does not support validators.',
1214.                     obj=self,
1215.                     id='fields.W341',
1216.                 )
1217.             )
1218.         if (self.remote_field.limit_choices_to and self.remote_field.through and
1219.                 not self.remote_field.through._meta.auto_created):
1220.             warnings.append(
1221.                 checks.Warning(
1222.                     'limit_choices_to has no effect on ManyToManyField '
1223.                     'with a through model.',
1224.                     obj=self,
1225.                     id='fields.W343',
1226.                 )
1227.             )
1228. 
1229.         return warnings
1230. 
1231.     def _check_relationship_model(self, from_model=None, **kwargs):
1232.         if hasattr(self.remote_field.through, '_meta'):
1233.             qualified_model_name = "%s.%s" % (
1234.                 self.remote_field.through._meta.app_label, self.remote_field.through.__name__)
1235.         else:
1236.             qualified_model_name = self.remote_field.through
1237. 
1238.         errors = []
1239. 
1240.         if self.remote_field.through not in self.opts.apps.get_models(include_auto_created=True):
1241.             # The relationship model is not installed.
1242.             errors.append(
1243.                 checks.Error(
1244.                     "Field specifies a many-to-many relation through model "
1245.                     "'%s', which has not been installed." % qualified_model_name,
1246.                     obj=self,
1247.                     id='fields.E331',
1248.                 )
1249.             )
1250. 
1251.         else:
1252.             assert from_model is not None, (
1253.                 "ManyToManyField with intermediate "
1254.                 "tables cannot be checked if you don't pass the model "
1255.                 "where the field is attached to."
1256.             )
1257.             # Set some useful local variables
1258.             to_model = resolve_relation(from_model, self.remote_field.model)
1259.             from_model_name = from_model._meta.object_name
1260.             if isinstance(to_model, str):
1261.                 to_model_name = to_model
1262.             else:
1263.                 to_model_name = to_model._meta.object_name
1264.             relationship_model_name = self.remote_field.through._meta.object_name
1265.             self_referential = from_model == to_model
1266.             # Count foreign keys in intermediate model
1267.             if self_referential:
1268.                 seen_self = sum(
1269.                     from_model == getattr(field.remote_field, 'model', None)
1270.                     for field in self.remote_field.through._meta.fields
1271.                 )
1272. 
1273.                 if seen_self > 2 and not self.remote_field.through_fields:
1274.                     errors.append(
1275.                         checks.Error(
1276.                             "The model is used as an intermediate model by "
1277.                             "'%s', but it has more than two foreign keys "
1278.                             "to '%s', which is ambiguous. You must specify "
1279.                             "which two foreign keys Django should use via the "
1280.                             "through_fields keyword argument." % (self, from_model_name),
1281.                             hint="Use through_fields to specify which two foreign keys Django should use.",
1282.                             obj=self.remote_field.through,
1283.                             id='fields.E333',
1284.                         )
1285.                     )
1286. 
1287.             else:
1288.                 # Count foreign keys in relationship model
1289.                 seen_from = sum(
1290.                     from_model == getattr(field.remote_field, 'model', None)
1291.                     for field in self.remote_field.through._meta.fields
1292.                 )
1293.                 seen_to = sum(
1294.                     to_model == getattr(field.remote_field, 'model', None)
1295.                     for field in self.remote_field.through._meta.fields
1296.                 )
1297. 
1298.                 if seen_from > 1 and not self.remote_field.through_fields:
1299.                     errors.append(
1300.                         checks.Error(
1301.                             ("The model is used as an intermediate model by "
1302.                              "'%s', but it has more than one foreign key "
1303.                              "from '%s', which is ambiguous. You must specify "
1304.                              "which foreign key Django should use via the "
1305.                              "through_fields keyword argument.") % (self, from_model_name),
1306.                             hint=(
1307.                                 'If you want to create a recursive relationship, '
1308.                                 'use ManyToManyField("%s", through="%s").'
1309.                             ) % (
1310.                                 RECURSIVE_RELATIONSHIP_CONSTANT,
1311.                                 relationship_model_name,
1312.                             ),
1313.                             obj=self,
1314.                             id='fields.E334',
1315.                         )
1316.                     )
1317. 
1318.                 if seen_to > 1 and not self.remote_field.through_fields:
1319.                     errors.append(
1320.                         checks.Error(
1321.                             "The model is used as an intermediate model by "
1322.                             "'%s', but it has more than one foreign key "
1323.                             "to '%s', which is ambiguous. You must specify "
1324.                             "which foreign key Django should use via the "
1325.                             "through_fields keyword argument." % (self, to_model_name),
1326.                             hint=(
1327.                                 'If you want to create a recursive relationship, '
1328.                                 'use ManyToManyField("%s", through="%s").'
1329.                             ) % (
1330.                                 RECURSIVE_RELATIONSHIP_CONSTANT,
1331.                                 relationship_model_name,
1332.                             ),
1333.                             obj=self,
1334.                             id='fields.E335',
1335.                         )
1336.                     )
1337. 
1338.                 if seen_from == 0 or seen_to == 0:
1339.                     errors.append(
1340.                         checks.Error(
1341.                             "The model is used as an intermediate model by "
1342.                             "'%s', but it does not have a foreign key to '%s' or '%s'." % (
1343.                                 self, from_model_name, to_model_name
1344.                             ),
1345.                             obj=self.remote_field.through,
1346.                             id='fields.E336',
1347.                         )
1348.                     )
1349. 
1350.         # Validate `through_fields`.
1351.         if self.remote_field.through_fields is not None:
1352.             # Validate that we're given an iterable of at least two items
1353.             # and that none of them is "falsy".
1354.             if not (len(self.remote_field.through_fields) >= 2 and
1355.                     self.remote_field.through_fields[0] and self.remote_field.through_fields[1]):
1356.                 errors.append(
1357.                     checks.Error(
1358.                         "Field specifies 'through_fields' but does not provide "
1359.                         "the names of the two link fields that should be used "
1360.                         "for the relation through model '%s'." % qualified_model_name,
1361.                         hint="Make sure you specify 'through_fields' as through_fields=('field1', 'field2')",
1362.                         obj=self,
1363.                         id='fields.E337',
1364.                     )
1365.                 )
1366. 
1367.             # Validate the given through fields -- they should be actual
1368.             # fields on the through model, and also be foreign keys to the
1369.             # expected models.
1370.             else:
1371.                 assert from_model is not None, (
1372.                     "ManyToManyField with intermediate "
1373.                     "tables cannot be checked if you don't pass the model "
1374.                     "where the field is attached to."
1375.                 )
1376. 
1377.                 source, through, target = from_model, self.remote_field.through, self.remote_field.model
1378.                 source_field_name, target_field_name = self.remote_field.through_fields[:2]
1379. 
1380.                 for field_name, related_model in ((source_field_name, source),
1381.                                                   (target_field_name, target)):
1382. 
1383.                     possible_field_names = []
1384.                     for f in through._meta.fields:
1385.                         if hasattr(f, 'remote_field') and getattr(f.remote_field, 'model', None) == related_model:
1386.                             possible_field_names.append(f.name)
1387.                     if possible_field_names:
1388.                         hint = "Did you mean one of the following foreign keys to '%s': %s?" % (
1389.                             related_model._meta.object_name,
1390.                             ', '.join(possible_field_names),
1391.                         )
1392.                     else:
1393.                         hint = None
1394. 
1395.                     try:
1396.                         field = through._meta.get_field(field_name)
1397.                     except exceptions.FieldDoesNotExist:
1398.                         errors.append(
1399.                             checks.Error(
1400.                                 "The intermediary model '%s' has no field '%s'."
1401.                                 % (qualified_model_name, field_name),
1402.                                 hint=hint,
1403.                                 obj=self,
1404.                                 id='fields.E338',
1405.                             )
1406.                         )
1407.                     else:
1408.                         if not (hasattr(field, 'remote_field') and
1409.                                 getattr(field.remote_field, 'model', None) == related_model):
1410.                             errors.append(
1411.                                 checks.Error(
1412.                                     "'%s.%s' is not a foreign key to '%s'." % (
1413.                                         through._meta.object_name, field_name,
1414.                                         related_model._meta.object_name,
1415.                                     ),
1416.                                     hint=hint,
1417.                                     obj=self,
1418.                                     id='fields.E339',
1419.                                 )
1420.                             )
1421. 
1422.         return errors
1423. 
1424.     def _check_table_uniqueness(self, **kwargs):
1425.         if isinstance(self.remote_field.through, str) or not self.remote_field.through._meta.managed:
1426.             return []
1427.         registered_tables = {
1428.             model._meta.db_table: model
1429.             for model in self.opts.apps.get_models(include_auto_created=True)
1430.             if model != self.remote_field.through and model._meta.managed
1431.         }
1432.         m2m_db_table = self.m2m_db_table()
1433.         model = registered_tables.get(m2m_db_table)
1434.         # The second condition allows multiple m2m relations on a model if
1435.         # some point to a through model that proxies another through model.
1436.         if model and model._meta.concrete_model != self.remote_field.through._meta.concrete_model:
1437.             if model._meta.auto_created:
1438.                 def _get_field_name(model):
1439.                     for field in model._meta.auto_created._meta.many_to_many:
1440.                         if field.remote_field.through is model:
1441.                             return field.name
1442.                 opts = model._meta.auto_created._meta
1443.                 clashing_obj = '%s.%s' % (opts.label, _get_field_name(model))
1444.             else:
1445.                 clashing_obj = model._meta.label
1446.             if settings.DATABASE_ROUTERS:
1447.                 error_class, error_id = checks.Warning, 'fields.W344'
1448.                 error_hint = (
1449.                     'You have configured settings.DATABASE_ROUTERS. Verify '
1450.                     'that the table of %r is correctly routed to a separate '
1451.                     'database.' % clashing_obj
1452.                 )
1453.             else:
1454.                 error_class, error_id = checks.Error, 'fields.E340'
1455.                 error_hint = None
1456.             return [
1457.                 error_class(
1458.                     "The field's intermediary table '%s' clashes with the "
1459.                     "table name of '%s'." % (m2m_db_table, clashing_obj),
1460.                     obj=self,
1461.                     hint=error_hint,
1462.                     id=error_id,
1463.                 )
1464.             ]
1465.         return []
1466. 
1467.     def deconstruct(self):
1468.         name, path, args, kwargs = super().deconstruct()
1469.         # Handle the simpler arguments.
1470.         if self.db_table is not None:
1471.             kwargs['db_table'] = self.db_table
1472.         if self.remote_field.db_constraint is not True:
1473.             kwargs['db_constraint'] = self.remote_field.db_constraint
1474.         # Rel needs more work.
1475.         if isinstance(self.remote_field.model, str):
1476.             kwargs['to'] = self.remote_field.model
1477.         else:
1478.             kwargs['to'] = "%s.%s" % (
1479.                 self.remote_field.model._meta.app_label,
1480.                 self.remote_field.model._meta.object_name,
1481.             )
1482.         if getattr(self.remote_field, 'through', None) is not None:
1483.             if isinstance(self.remote_field.through, str):
1484.                 kwargs['through'] = self.remote_field.through
1485.             elif not self.remote_field.through._meta.auto_created:
1486.                 kwargs['through'] = "%s.%s" % (
1487.                     self.remote_field.through._meta.app_label,
1488.                     self.remote_field.through._meta.object_name,
1489.                 )
1490.         # If swappable is True, then see if we're actually pointing to the target
1491.         # of a swap.
1492.         swappable_setting = self.swappable_setting
1493.         if swappable_setting is not None:
1494.             # If it's already a settings reference, error.
1495.             if hasattr(kwargs['to'], "setting_name"):
1496.                 if kwargs['to'].setting_name != swappable_setting:
1497.                     raise ValueError(
1498.                         "Cannot deconstruct a ManyToManyField pointing to a "
1499.                         "model that is swapped in place of more than one model "
1500.                         "(%s and %s)" % (kwargs['to'].setting_name, swappable_setting)
1501.                     )


File: django/db/models/manager.py
Line number range: 1 - 204
Content:
1. import copy
2. import inspect
3. from importlib import import_module
4. 
5. from django.db import router
6. from django.db.models.query import QuerySet
7. 
8. 
9. class BaseManager:
10.     # To retain order, track each time a Manager instance is created.
11.     creation_counter = 0
12. 
13.     # Set to True for the 'objects' managers that are automatically created.
14.     auto_created = False
15. 
16.     #: If set to True the manager will be serialized into migrations and will
17.     #: thus be available in e.g. RunPython operations.
18.     use_in_migrations = False
19. 
20.     def __new__(cls, *args, **kwargs):
21.         # Capture the arguments to make returning them trivial.
22.         obj = super().__new__(cls)
23.         obj._constructor_args = (args, kwargs)
24.         return obj
25. 
26.     def __init__(self):
27.         super().__init__()
28.         self._set_creation_counter()
29.         self.model = None
30.         self.name = None
31.         self._db = None
32.         self._hints = {}
33. 
34.     def __str__(self):
35.         """Return "app_label.model_label.manager_name"."""
36.         return '%s.%s' % (self.model._meta.label, self.name)
37. 
38.     def __class_getitem__(cls, *args, **kwargs):
39.         return cls
40. 
41.     def deconstruct(self):
42.         """
43.         Return a 5-tuple of the form (as_manager (True), manager_class,
44.         queryset_class, args, kwargs).
45. 
46.         Raise a ValueError if the manager is dynamically generated.
47.         """
48.         qs_class = self._queryset_class
49.         if getattr(self, '_built_with_as_manager', False):
50.             # using MyQuerySet.as_manager()
51.             return (
52.                 True,  # as_manager
53.                 None,  # manager_class
54.                 '%s.%s' % (qs_class.__module__, qs_class.__name__),  # qs_class
55.                 None,  # args
56.                 None,  # kwargs
57.             )
58.         else:
59.             module_name = self.__module__
60.             name = self.__class__.__name__
61.             # Make sure it's actually there and not an inner class
62.             module = import_module(module_name)
63.             if not hasattr(module, name):
64.                 raise ValueError(
65.                     "Could not find manager %s in %s.\n"
66.                     "Please note that you need to inherit from managers you "
67.                     "dynamically generated with 'from_queryset()'."
68.                     % (name, module_name)
69.                 )
70.             return (
71.                 False,  # as_manager
72.                 '%s.%s' % (module_name, name),  # manager_class
73.                 None,  # qs_class
74.                 self._constructor_args[0],  # args
75.                 self._constructor_args[1],  # kwargs
76.             )
77. 
78.     def check(self, **kwargs):
79.         return []
80. 
81.     @classmethod
82.     def _get_queryset_methods(cls, queryset_class):
83.         def create_method(name, method):
84.             def manager_method(self, *args, **kwargs):
85.                 return getattr(self.get_queryset(), name)(*args, **kwargs)
86.             manager_method.__name__ = method.__name__
87.             manager_method.__doc__ = method.__doc__
88.             return manager_method
89. 
90.         new_methods = {}
91.         for name, method in inspect.getmembers(queryset_class, predicate=inspect.isfunction):
92.             # Only copy missing methods.
93.             if hasattr(cls, name):
94.                 continue
95.             # Only copy public methods or methods with the attribute `queryset_only=False`.
96.             queryset_only = getattr(method, 'queryset_only', None)
97.             if queryset_only or (queryset_only is None and name.startswith('_')):
98.                 continue
99.             # Copy the method onto the manager.
100.             new_methods[name] = create_method(name, method)
101.         return new_methods
102. 
103.     @classmethod
104.     def from_queryset(cls, queryset_class, class_name=None):
105.         if class_name is None:
106.             class_name = '%sFrom%s' % (cls.__name__, queryset_class.__name__)
107.         return type(class_name, (cls,), {
108.             '_queryset_class': queryset_class,
109.             **cls._get_queryset_methods(queryset_class),
110.         })
111. 
112.     def contribute_to_class(self, model, name):
113.         self.name = self.name or name
114.         self.model = model
115. 
116.         setattr(model, name, ManagerDescriptor(self))
117. 
118.         model._meta.add_manager(self)
119. 
120.     def _set_creation_counter(self):
121.         """
122.         Set the creation counter value for this instance and increment the
123.         class-level copy.
124.         """
125.         self.creation_counter = BaseManager.creation_counter
126.         BaseManager.creation_counter += 1
127. 
128.     def db_manager(self, using=None, hints=None):
129.         obj = copy.copy(self)
130.         obj._db = using or self._db
131.         obj._hints = hints or self._hints
132.         return obj
133. 
134.     @property
135.     def db(self):
136.         return self._db or router.db_for_read(self.model, **self._hints)
137. 
138.     #######################
139.     # PROXIES TO QUERYSET #
140.     #######################
141. 
142.     def get_queryset(self):
143.         """
144.         Return a new QuerySet object. Subclasses can override this method to
145.         customize the behavior of the Manager.
146.         """
147.         return self._queryset_class(model=self.model, using=self._db, hints=self._hints)
148. 
149.     def all(self):
150.         # We can't proxy this method through the `QuerySet` like we do for the
151.         # rest of the `QuerySet` methods. This is because `QuerySet.all()`
152.         # works by creating a "copy" of the current queryset and in making said
153.         # copy, all the cached `prefetch_related` lookups are lost. See the
154.         # implementation of `RelatedManager.get_queryset()` for a better
155.         # understanding of how this comes into play.
156.         return self.get_queryset()
157. 
158.     def __eq__(self, other):
159.         return (
160.             isinstance(other, self.__class__) and
161.             self._constructor_args == other._constructor_args
162.         )
163. 
164.     def __hash__(self):
165.         return id(self)
166. 
167. 
168. class Manager(BaseManager.from_queryset(QuerySet)):
169.     pass
170. 
171. 
172. class ManagerDescriptor:
173. 
174.     def __init__(self, manager):
175.         self.manager = manager
176. 
177.     def __get__(self, instance, cls=None):
178.         if instance is not None:
179.             raise AttributeError("Manager isn't accessible via %s instances" % cls.__name__)
180. 
181.         if cls._meta.abstract:
182.             raise AttributeError("Manager isn't available; %s is abstract" % (
183.                 cls._meta.object_name,
184.             ))
185. 
186.         if cls._meta.swapped:
187.             raise AttributeError(
188.                 "Manager isn't available; '%s.%s' has been swapped for '%s'" % (
189.                     cls._meta.app_label,
190.                     cls._meta.object_name,
191.                     cls._meta.swapped,
192.                 )
193.             )
194. 
195.         return cls._meta.managers_map[self.manager.name]
196. 
197. 
198. class EmptyManager(Manager):
199.     def __init__(self, model):
200.         super().__init__()
201.         self.model = model
202. 
203.     def get_queryset(self):
204.         return super().get_queryset().none()


File: django/db/models/options.py
Line number range: 1 - 862
Content:
1. import bisect
2. import copy
3. import inspect
4. from collections import defaultdict
5. 
6. from django.apps import apps
7. from django.conf import settings
8. from django.core.exceptions import FieldDoesNotExist
9. from django.db import connections
10. from django.db.models import AutoField, Manager, OrderWrt, UniqueConstraint
11. from django.db.models.query_utils import PathInfo
12. from django.utils.datastructures import ImmutableList, OrderedSet
13. from django.utils.functional import cached_property
14. from django.utils.text import camel_case_to_spaces, format_lazy
15. from django.utils.translation import override
16. 
17. PROXY_PARENTS = object()
18. 
19. EMPTY_RELATION_TREE = ()
20. 
21. IMMUTABLE_WARNING = (
22.     "The return type of '%s' should never be mutated. If you want to manipulate this list "
23.     "for your own use, make a copy first."
24. )
25. 
26. DEFAULT_NAMES = (
27.     'verbose_name', 'verbose_name_plural', 'db_table', 'ordering',
28.     'unique_together', 'permissions', 'get_latest_by', 'order_with_respect_to',
29.     'app_label', 'db_tablespace', 'abstract', 'managed', 'proxy', 'swappable',
30.     'auto_created', 'index_together', 'apps', 'default_permissions',
31.     'select_on_save', 'default_related_name', 'required_db_features',
32.     'required_db_vendor', 'base_manager_name', 'default_manager_name',
33.     'indexes', 'constraints',
34. )
35. 
36. 
37. def normalize_together(option_together):
38.     """
39.     option_together can be either a tuple of tuples, or a single
40.     tuple of two strings. Normalize it to a tuple of tuples, so that
41.     calling code can uniformly expect that.
42.     """
43.     try:
44.         if not option_together:
45.             return ()
46.         if not isinstance(option_together, (tuple, list)):
47.             raise TypeError
48.         first_element = option_together[0]
49.         if not isinstance(first_element, (tuple, list)):
50.             option_together = (option_together,)
51.         # Normalize everything to tuples
52.         return tuple(tuple(ot) for ot in option_together)
53.     except TypeError:
54.         # If the value of option_together isn't valid, return it
55.         # verbatim; this will be picked up by the check framework later.
56.         return option_together
57. 
58. 
59. def make_immutable_fields_list(name, data):
60.     return ImmutableList(data, warning=IMMUTABLE_WARNING % name)
61. 
62. 
63. class Options:
64.     FORWARD_PROPERTIES = {
65.         'fields', 'many_to_many', 'concrete_fields', 'local_concrete_fields',
66.         '_forward_fields_map', 'managers', 'managers_map', 'base_manager',
67.         'default_manager',
68.     }
69.     REVERSE_PROPERTIES = {'related_objects', 'fields_map', '_relation_tree'}
70. 
71.     default_apps = apps
72. 
73.     def __init__(self, meta, app_label=None):
74.         self._get_fields_cache = {}
75.         self.local_fields = []
76.         self.local_many_to_many = []
77.         self.private_fields = []
78.         self.local_managers = []
79.         self.base_manager_name = None
80.         self.default_manager_name = None
81.         self.model_name = None
82.         self.verbose_name = None
83.         self.verbose_name_plural = None
84.         self.db_table = ''
85.         self.ordering = []
86.         self._ordering_clash = False
87.         self.indexes = []
88.         self.constraints = []
89.         self.unique_together = []
90.         self.index_together = []
91.         self.select_on_save = False
92.         self.default_permissions = ('add', 'change', 'delete', 'view')
93.         self.permissions = []
94.         self.object_name = None
95.         self.app_label = app_label
96.         self.get_latest_by = None
97.         self.order_with_respect_to = None
98.         self.db_tablespace = settings.DEFAULT_TABLESPACE
99.         self.required_db_features = []
100.         self.required_db_vendor = None
101.         self.meta = meta
102.         self.pk = None
103.         self.auto_field = None
104.         self.abstract = False
105.         self.managed = True
106.         self.proxy = False
107.         # For any class that is a proxy (including automatically created
108.         # classes for deferred object loading), proxy_for_model tells us
109.         # which class this model is proxying. Note that proxy_for_model
110.         # can create a chain of proxy models. For non-proxy models, the
111.         # variable is always None.
112.         self.proxy_for_model = None
113.         # For any non-abstract class, the concrete class is the model
114.         # in the end of the proxy_for_model chain. In particular, for
115.         # concrete models, the concrete_model is always the class itself.
116.         self.concrete_model = None
117.         self.swappable = None
118.         self.parents = {}
119.         self.auto_created = False
120. 
121.         # List of all lookups defined in ForeignKey 'limit_choices_to' options
122.         # from *other* models. Needed for some admin checks. Internal use only.
123.         self.related_fkey_lookups = []
124. 
125.         # A custom app registry to use, if you're making a separate model set.
126.         self.apps = self.default_apps
127. 
128.         self.default_related_name = None
129. 
130.     @property
131.     def label(self):
132.         return '%s.%s' % (self.app_label, self.object_name)
133. 
134.     @property
135.     def label_lower(self):
136.         return '%s.%s' % (self.app_label, self.model_name)
137. 
138.     @property
139.     def app_config(self):
140.         # Don't go through get_app_config to avoid triggering imports.
141.         return self.apps.app_configs.get(self.app_label)
142. 
143.     @property
144.     def installed(self):
145.         return self.app_config is not None
146. 
147.     def contribute_to_class(self, cls, name):
148.         from django.db import connection
149.         from django.db.backends.utils import truncate_name
150. 
151.         cls._meta = self
152.         self.model = cls
153.         # First, construct the default values for these options.
154.         self.object_name = cls.__name__
155.         self.model_name = self.object_name.lower()
156.         self.verbose_name = camel_case_to_spaces(self.object_name)
157. 
158.         # Store the original user-defined values for each option,
159.         # for use when serializing the model definition
160.         self.original_attrs = {}
161. 
162.         # Next, apply any overridden values from 'class Meta'.
163.         if self.meta:
164.             meta_attrs = self.meta.__dict__.copy()
165.             for name in self.meta.__dict__:
166.                 # Ignore any private attributes that Django doesn't care about.
167.                 # NOTE: We can't modify a dictionary's contents while looping
168.                 # over it, so we loop over the *original* dictionary instead.
169.                 if name.startswith('_'):
170.                     del meta_attrs[name]
171.             for attr_name in DEFAULT_NAMES:
172.                 if attr_name in meta_attrs:
173.                     setattr(self, attr_name, meta_attrs.pop(attr_name))
174.                     self.original_attrs[attr_name] = getattr(self, attr_name)
175.                 elif hasattr(self.meta, attr_name):
176.                     setattr(self, attr_name, getattr(self.meta, attr_name))
177.                     self.original_attrs[attr_name] = getattr(self, attr_name)
178. 
179.             self.unique_together = normalize_together(self.unique_together)
180.             self.index_together = normalize_together(self.index_together)
181.             # App label/class name interpolation for names of constraints and
182.             # indexes.
183.             if not getattr(cls._meta, 'abstract', False):
184.                 for attr_name in {'constraints', 'indexes'}:
185.                     objs = getattr(self, attr_name, [])
186.                     setattr(self, attr_name, self._format_names_with_class(cls, objs))
187. 
188.             # verbose_name_plural is a special case because it uses a 's'
189.             # by default.
190.             if self.verbose_name_plural is None:
191.                 self.verbose_name_plural = format_lazy('{}s', self.verbose_name)
192. 
193.             # order_with_respect_and ordering are mutually exclusive.
194.             self._ordering_clash = bool(self.ordering and self.order_with_respect_to)
195. 
196.             # Any leftover attributes must be invalid.
197.             if meta_attrs != {}:
198.                 raise TypeError("'class Meta' got invalid attribute(s): %s" % ','.join(meta_attrs))
199.         else:
200.             self.verbose_name_plural = format_lazy('{}s', self.verbose_name)
201.         del self.meta
202. 
203.         # If the db_table wasn't provided, use the app_label + model_name.
204.         if not self.db_table:
205.             self.db_table = "%s_%s" % (self.app_label, self.model_name)
206.             self.db_table = truncate_name(self.db_table, connection.ops.max_name_length())
207. 
208.     def _format_names_with_class(self, cls, objs):
209.         """App label/class name interpolation for object names."""
210.         new_objs = []
211.         for obj in objs:
212.             obj = obj.clone()
213.             obj.name = obj.name % {
214.                 'app_label': cls._meta.app_label.lower(),
215.                 'class': cls.__name__.lower(),
216.             }
217.             new_objs.append(obj)
218.         return new_objs
219. 
220.     def _prepare(self, model):
221.         if self.order_with_respect_to:
222.             # The app registry will not be ready at this point, so we cannot
223.             # use get_field().
224.             query = self.order_with_respect_to
225.             try:
226.                 self.order_with_respect_to = next(
227.                     f for f in self._get_fields(reverse=False)
228.                     if f.name == query or f.attname == query
229.                 )
230.             except StopIteration:
231.                 raise FieldDoesNotExist("%s has no field named '%s'" % (self.object_name, query))
232. 
233.             self.ordering = ('_order',)
234.             if not any(isinstance(field, OrderWrt) for field in model._meta.local_fields):
235.                 model.add_to_class('_order', OrderWrt())
236.         else:
237.             self.order_with_respect_to = None
238. 
239.         if self.pk is None:
240.             if self.parents:
241.                 # Promote the first parent link in lieu of adding yet another
242.                 # field.
243.                 field = next(iter(self.parents.values()))
244.                 # Look for a local field with the same name as the
245.                 # first parent link. If a local field has already been
246.                 # created, use it instead of promoting the parent
247.                 already_created = [fld for fld in self.local_fields if fld.name == field.name]
248.                 if already_created:
249.                     field = already_created[0]
250.                 field.primary_key = True
251.                 self.setup_pk(field)
252.             else:
253.                 auto = AutoField(verbose_name='ID', primary_key=True, auto_created=True)
254.                 model.add_to_class('id', auto)
255. 
256.     def add_manager(self, manager):
257.         self.local_managers.append(manager)
258.         self._expire_cache()
259. 
260.     def add_field(self, field, private=False):
261.         # Insert the given field in the order in which it was created, using
262.         # the "creation_counter" attribute of the field.
263.         # Move many-to-many related fields from self.fields into
264.         # self.many_to_many.
265.         if private:
266.             self.private_fields.append(field)
267.         elif field.is_relation and field.many_to_many:
268.             bisect.insort(self.local_many_to_many, field)
269.         else:
270.             bisect.insort(self.local_fields, field)
271.             self.setup_pk(field)
272. 
273.         # If the field being added is a relation to another known field,
274.         # expire the cache on this field and the forward cache on the field
275.         # being referenced, because there will be new relationships in the
276.         # cache. Otherwise, expire the cache of references *to* this field.
277.         # The mechanism for getting at the related model is slightly odd -
278.         # ideally, we'd just ask for field.related_model. However, related_model
279.         # is a cached property, and all the models haven't been loaded yet, so
280.         # we need to make sure we don't cache a string reference.
281.         if field.is_relation and hasattr(field.remote_field, 'model') and field.remote_field.model:
282.             try:
283.                 field.remote_field.model._meta._expire_cache(forward=False)
284.             except AttributeError:
285.                 pass
286.             self._expire_cache()
287.         else:
288.             self._expire_cache(reverse=False)
289. 
290.     def setup_pk(self, field):
291.         if not self.pk and field.primary_key:
292.             self.pk = field
293.             field.serialize = False
294. 
295.     def setup_proxy(self, target):
296.         """
297.         Do the internal setup so that the current model is a proxy for
298.         "target".
299.         """
300.         self.pk = target._meta.pk
301.         self.proxy_for_model = target
302.         self.db_table = target._meta.db_table
303. 
304.     def __repr__(self):
305.         return '<Options for %s>' % self.object_name
306. 
307.     def __str__(self):
308.         return self.label_lower
309. 
310.     def can_migrate(self, connection):
311.         """
312.         Return True if the model can/should be migrated on the `connection`.
313.         `connection` can be either a real connection or a connection alias.
314.         """
315.         if self.proxy or self.swapped or not self.managed:
316.             return False
317.         if isinstance(connection, str):
318.             connection = connections[connection]
319.         if self.required_db_vendor:
320.             return self.required_db_vendor == connection.vendor
321.         if self.required_db_features:
322.             return all(getattr(connection.features, feat, False)
323.                        for feat in self.required_db_features)
324.         return True
325. 
326.     @property
327.     def verbose_name_raw(self):
328.         """Return the untranslated verbose name."""
329.         with override(None):
330.             return str(self.verbose_name)
331. 
332.     @property
333.     def swapped(self):
334.         """
335.         Has this model been swapped out for another? If so, return the model
336.         name of the replacement; otherwise, return None.
337. 
338.         For historical reasons, model name lookups using get_model() are
339.         case insensitive, so we make sure we are case insensitive here.
340.         """
341.         if self.swappable:
342.             swapped_for = getattr(settings, self.swappable, None)
343.             if swapped_for:
344.                 try:
345.                     swapped_label, swapped_object = swapped_for.split('.')
346.                 except ValueError:
347.                     # setting not in the format app_label.model_name
348.                     # raising ImproperlyConfigured here causes problems with
349.                     # test cleanup code - instead it is raised in get_user_model
350.                     # or as part of validation.
351.                     return swapped_for
352. 
353.                 if '%s.%s' % (swapped_label, swapped_object.lower()) != self.label_lower:
354.                     return swapped_for
355.         return None
356. 
357.     @cached_property
358.     def managers(self):
359.         managers = []
360.         seen_managers = set()
361.         bases = (b for b in self.model.mro() if hasattr(b, '_meta'))
362.         for depth, base in enumerate(bases):
363.             for manager in base._meta.local_managers:
364.                 if manager.name in seen_managers:
365.                     continue
366. 
367.                 manager = copy.copy(manager)
368.                 manager.model = self.model
369.                 seen_managers.add(manager.name)
370.                 managers.append((depth, manager.creation_counter, manager))
371. 
372.         return make_immutable_fields_list(
373.             "managers",
374.             (m[2] for m in sorted(managers)),
375.         )
376. 
377.     @cached_property
378.     def managers_map(self):
379.         return {manager.name: manager for manager in self.managers}
380. 
381.     @cached_property
382.     def base_manager(self):
383.         base_manager_name = self.base_manager_name
384.         if not base_manager_name:
385.             # Get the first parent's base_manager_name if there's one.
386.             for parent in self.model.mro()[1:]:
387.                 if hasattr(parent, '_meta'):
388.                     if parent._base_manager.name != '_base_manager':
389.                         base_manager_name = parent._base_manager.name
390.                     break
391. 
392.         if base_manager_name:
393.             try:
394.                 return self.managers_map[base_manager_name]
395.             except KeyError:
396.                 raise ValueError(
397.                     "%s has no manager named %r" % (
398.                         self.object_name,
399.                         base_manager_name,
400.                     )
401.                 )
402. 
403.         manager = Manager()
404.         manager.name = '_base_manager'
405.         manager.model = self.model
406.         manager.auto_created = True
407.         return manager
408. 
409.     @cached_property
410.     def default_manager(self):
411.         default_manager_name = self.default_manager_name
412.         if not default_manager_name and not self.local_managers:
413.             # Get the first parent's default_manager_name if there's one.
414.             for parent in self.model.mro()[1:]:
415.                 if hasattr(parent, '_meta'):
416.                     default_manager_name = parent._meta.default_manager_name
417.                     break
418. 
419.         if default_manager_name:
420.             try:
421.                 return self.managers_map[default_manager_name]
422.             except KeyError:
423.                 raise ValueError(
424.                     "%s has no manager named %r" % (
425.                         self.object_name,
426.                         default_manager_name,
427.                     )
428.                 )
429. 
430.         if self.managers:
431.             return self.managers[0]
432. 
433.     @cached_property
434.     def fields(self):
435.         """
436.         Return a list of all forward fields on the model and its parents,
437.         excluding ManyToManyFields.
438. 
439.         Private API intended only to be used by Django itself; get_fields()
440.         combined with filtering of field properties is the public API for
441.         obtaining this field list.
442.         """
443.         # For legacy reasons, the fields property should only contain forward
444.         # fields that are not private or with a m2m cardinality. Therefore we
445.         # pass these three filters as filters to the generator.
446.         # The third lambda is a longwinded way of checking f.related_model - we don't
447.         # use that property directly because related_model is a cached property,
448.         # and all the models may not have been loaded yet; we don't want to cache
449.         # the string reference to the related_model.
450.         def is_not_an_m2m_field(f):
451.             return not (f.is_relation and f.many_to_many)
452. 
453.         def is_not_a_generic_relation(f):
454.             return not (f.is_relation and f.one_to_many)
455. 
456.         def is_not_a_generic_foreign_key(f):
457.             return not (
458.                 f.is_relation and f.many_to_one and not (hasattr(f.remote_field, 'model') and f.remote_field.model)
459.             )
460. 
461.         return make_immutable_fields_list(
462.             "fields",
463.             (f for f in self._get_fields(reverse=False)
464.              if is_not_an_m2m_field(f) and is_not_a_generic_relation(f) and is_not_a_generic_foreign_key(f))
465.         )
466. 
467.     @cached_property
468.     def concrete_fields(self):
469.         """
470.         Return a list of all concrete fields on the model and its parents.
471. 
472.         Private API intended only to be used by Django itself; get_fields()
473.         combined with filtering of field properties is the public API for
474.         obtaining this field list.
475.         """
476.         return make_immutable_fields_list(
477.             "concrete_fields", (f for f in self.fields if f.concrete)
478.         )
479. 
480.     @cached_property
481.     def local_concrete_fields(self):
482.         """
483.         Return a list of all concrete fields on the model.
484. 
485.         Private API intended only to be used by Django itself; get_fields()
486.         combined with filtering of field properties is the public API for
487.         obtaining this field list.
488.         """
489.         return make_immutable_fields_list(
490.             "local_concrete_fields", (f for f in self.local_fields if f.concrete)
491.         )
492. 
493.     @cached_property
494.     def many_to_many(self):
495.         """
496.         Return a list of all many to many fields on the model and its parents.
497. 
498.         Private API intended only to be used by Django itself; get_fields()
499.         combined with filtering of field properties is the public API for
500.         obtaining this list.
501.         """
502.         return make_immutable_fields_list(
503.             "many_to_many",
504.             (f for f in self._get_fields(reverse=False) if f.is_relation and f.many_to_many)
505.         )
506. 
507.     @cached_property
508.     def related_objects(self):
509.         """
510.         Return all related objects pointing to the current model. The related
511.         objects can come from a one-to-one, one-to-many, or many-to-many field
512.         relation type.
513. 
514.         Private API intended only to be used by Django itself; get_fields()
515.         combined with filtering of field properties is the public API for
516.         obtaining this field list.
517.         """
518.         all_related_fields = self._get_fields(forward=False, reverse=True, include_hidden=True)
519.         return make_immutable_fields_list(
520.             "related_objects",
521.             (obj for obj in all_related_fields if not obj.hidden or obj.field.many_to_many)
522.         )
523. 
524.     @cached_property
525.     def _forward_fields_map(self):
526.         res = {}
527.         fields = self._get_fields(reverse=False)
528.         for field in fields:
529.             res[field.name] = field
530.             # Due to the way Django's internals work, get_field() should also
531.             # be able to fetch a field by attname. In the case of a concrete
532.             # field with relation, includes the *_id name too
533.             try:
534.                 res[field.attname] = field
535.             except AttributeError:
536.                 pass
537.         return res
538. 
539.     @cached_property
540.     def fields_map(self):
541.         res = {}
542.         fields = self._get_fields(forward=False, include_hidden=True)
543.         for field in fields:
544.             res[field.name] = field
545.             # Due to the way Django's internals work, get_field() should also
546.             # be able to fetch a field by attname. In the case of a concrete
547.             # field with relation, includes the *_id name too
548.             try:
549.                 res[field.attname] = field
550.             except AttributeError:
551.                 pass
552.         return res
553. 
554.     def get_field(self, field_name):
555.         """
556.         Return a field instance given the name of a forward or reverse field.
557.         """
558.         try:
559.             # In order to avoid premature loading of the relation tree
560.             # (expensive) we prefer checking if the field is a forward field.
561.             return self._forward_fields_map[field_name]
562.         except KeyError:
563.             # If the app registry is not ready, reverse fields are
564.             # unavailable, therefore we throw a FieldDoesNotExist exception.
565.             if not self.apps.models_ready:
566.                 raise FieldDoesNotExist(
567.                     "%s has no field named '%s'. The app cache isn't ready yet, "
568.                     "so if this is an auto-created related field, it won't "
569.                     "be available yet." % (self.object_name, field_name)
570.                 )
571. 
572.         try:
573.             # Retrieve field instance by name from cached or just-computed
574.             # field map.
575.             return self.fields_map[field_name]
576.         except KeyError:
577.             raise FieldDoesNotExist("%s has no field named '%s'" % (self.object_name, field_name))
578. 
579.     def get_base_chain(self, model):
580.         """
581.         Return a list of parent classes leading to `model` (ordered from
582.         closest to most distant ancestor). This has to handle the case where
583.         `model` is a grandparent or even more distant relation.
584.         """
585.         if not self.parents:
586.             return []
587.         if model in self.parents:
588.             return [model]
589.         for parent in self.parents:
590.             res = parent._meta.get_base_chain(model)
591.             if res:
592.                 res.insert(0, parent)
593.                 return res
594.         return []
595. 
596.     def get_parent_list(self):
597.         """
598.         Return all the ancestors of this model as a list ordered by MRO.
599.         Useful for determining if something is an ancestor, regardless of lineage.
600.         """
601.         result = OrderedSet(self.parents)
602.         for parent in self.parents:
603.             for ancestor in parent._meta.get_parent_list():
604.                 result.add(ancestor)
605.         return list(result)
606. 
607.     def get_ancestor_link(self, ancestor):
608.         """
609.         Return the field on the current model which points to the given
610.         "ancestor". This is possible an indirect link (a pointer to a parent
611.         model, which points, eventually, to the ancestor). Used when
612.         constructing table joins for model inheritance.
613. 
614.         Return None if the model isn't an ancestor of this one.
615.         """
616.         if ancestor in self.parents:
617.             return self.parents[ancestor]
618.         for parent in self.parents:
619.             # Tries to get a link field from the immediate parent
620.             parent_link = parent._meta.get_ancestor_link(ancestor)
621.             if parent_link:
622.                 # In case of a proxied model, the first link
623.                 # of the chain to the ancestor is that parent
624.                 # links
625.                 return self.parents[parent] or parent_link
626. 
627.     def get_path_to_parent(self, parent):
628.         """
629.         Return a list of PathInfos containing the path from the current
630.         model to the parent model, or an empty list if parent is not a
631.         parent of the current model.
632.         """
633.         if self.model is parent:
634.             return []
635.         # Skip the chain of proxy to the concrete proxied model.
636.         proxied_model = self.concrete_model
637.         path = []
638.         opts = self
639.         for int_model in self.get_base_chain(parent):
640.             if int_model is proxied_model:
641.                 opts = int_model._meta
642.             else:
643.                 final_field = opts.parents[int_model]
644.                 targets = (final_field.remote_field.get_related_field(),)
645.                 opts = int_model._meta
646.                 path.append(PathInfo(
647.                     from_opts=final_field.model._meta,
648.                     to_opts=opts,
649.                     target_fields=targets,
650.                     join_field=final_field,
651.                     m2m=False,
652.                     direct=True,
653.                     filtered_relation=None,
654.                 ))
655.         return path
656. 
657.     def get_path_from_parent(self, parent):
658.         """
659.         Return a list of PathInfos containing the path from the parent
660.         model to the current model, or an empty list if parent is not a
661.         parent of the current model.
662.         """
663.         if self.model is parent:
664.             return []
665.         model = self.concrete_model
666.         # Get a reversed base chain including both the current and parent
667.         # models.
668.         chain = model._meta.get_base_chain(parent)
669.         chain.reverse()
670.         chain.append(model)
671.         # Construct a list of the PathInfos between models in chain.
672.         path = []
673.         for i, ancestor in enumerate(chain[:-1]):
674.             child = chain[i + 1]
675.             link = child._meta.get_ancestor_link(ancestor)
676.             path.extend(link.get_reverse_path_info())
677.         return path
678. 
679.     def _populate_directed_relation_graph(self):
680.         """
681.         This method is used by each model to find its reverse objects. As this
682.         method is very expensive and is accessed frequently (it looks up every
683.         field in a model, in every app), it is computed on first access and then
684.         is set as a property on every model.
685.         """
686.         related_objects_graph = defaultdict(list)
687. 
688.         all_models = self.apps.get_models(include_auto_created=True)
689.         for model in all_models:
690.             opts = model._meta
691.             # Abstract model's fields are copied to child models, hence we will
692.             # see the fields from the child models.
693.             if opts.abstract:
694.                 continue
695.             fields_with_relations = (
696.                 f for f in opts._get_fields(reverse=False, include_parents=False)
697.                 if f.is_relation and f.related_model is not None
698.             )
699.             for f in fields_with_relations:
700.                 if not isinstance(f.remote_field.model, str):
701.                     remote_label = f.remote_field.model._meta.concrete_model._meta.label
702.                     related_objects_graph[remote_label].append(f)
703. 
704.         for model in all_models:
705.             # Set the relation_tree using the internal __dict__. In this way
706.             # we avoid calling the cached property. In attribute lookup,
707.             # __dict__ takes precedence over a data descriptor (such as
708.             # @cached_property). This means that the _meta._relation_tree is
709.             # only called if related_objects is not in __dict__.
710.             related_objects = related_objects_graph[model._meta.concrete_model._meta.label]
711.             model._meta.__dict__['_relation_tree'] = related_objects
712.         # It seems it is possible that self is not in all_models, so guard
713.         # against that with default for get().
714.         return self.__dict__.get('_relation_tree', EMPTY_RELATION_TREE)
715. 
716.     @cached_property
717.     def _relation_tree(self):
718.         return self._populate_directed_relation_graph()
719. 
720.     def _expire_cache(self, forward=True, reverse=True):
721.         # This method is usually called by apps.cache_clear(), when the
722.         # registry is finalized, or when a new field is added.
723.         if forward:
724.             for cache_key in self.FORWARD_PROPERTIES:
725.                 if cache_key in self.__dict__:
726.                     delattr(self, cache_key)
727.         if reverse and not self.abstract:
728.             for cache_key in self.REVERSE_PROPERTIES:
729.                 if cache_key in self.__dict__:
730.                     delattr(self, cache_key)
731.         self._get_fields_cache = {}
732. 
733.     def get_fields(self, include_parents=True, include_hidden=False):
734.         """
735.         Return a list of fields associated to the model. By default, include
736.         forward and reverse fields, fields derived from inheritance, but not
737.         hidden fields. The returned fields can be changed using the parameters:
738. 
739.         - include_parents: include fields derived from inheritance
740.         - include_hidden:  include fields that have a related_name that
741.                            starts with a "+"
742.         """
743.         if include_parents is False:
744.             include_parents = PROXY_PARENTS
745.         return self._get_fields(include_parents=include_parents, include_hidden=include_hidden)
746. 
747.     def _get_fields(self, forward=True, reverse=True, include_parents=True, include_hidden=False,
748.                     seen_models=None):
749.         """
750.         Internal helper function to return fields of the model.
751.         * If forward=True, then fields defined on this model are returned.
752.         * If reverse=True, then relations pointing to this model are returned.
753.         * If include_hidden=True, then fields with is_hidden=True are returned.
754.         * The include_parents argument toggles if fields from parent models
755.           should be included. It has three values: True, False, and
756.           PROXY_PARENTS. When set to PROXY_PARENTS, the call will return all
757.           fields defined for the current model or any of its parents in the
758.           parent chain to the model's concrete model.
759.         """
760.         if include_parents not in (True, False, PROXY_PARENTS):
761.             raise TypeError("Invalid argument for include_parents: %s" % (include_parents,))
762.         # This helper function is used to allow recursion in ``get_fields()``
763.         # implementation and to provide a fast way for Django's internals to
764.         # access specific subsets of fields.
765. 
766.         # We must keep track of which models we have already seen. Otherwise we
767.         # could include the same field multiple times from different models.
768.         topmost_call = seen_models is None
769.         if topmost_call:
770.             seen_models = set()
771.         seen_models.add(self.model)
772. 
773.         # Creates a cache key composed of all arguments
774.         cache_key = (forward, reverse, include_parents, include_hidden, topmost_call)
775. 
776.         try:
777.             # In order to avoid list manipulation. Always return a shallow copy
778.             # of the results.
779.             return self._get_fields_cache[cache_key]
780.         except KeyError:
781.             pass
782. 
783.         fields = []
784.         # Recursively call _get_fields() on each parent, with the same
785.         # options provided in this call.
786.         if include_parents is not False:
787.             for parent in self.parents:
788.                 # In diamond inheritance it is possible that we see the same
789.                 # model from two different routes. In that case, avoid adding
790.                 # fields from the same parent again.
791.                 if parent in seen_models:
792.                     continue
793.                 if (parent._meta.concrete_model != self.concrete_model and
794.                         include_parents == PROXY_PARENTS):
795.                     continue
796.                 for obj in parent._meta._get_fields(
797.                         forward=forward, reverse=reverse, include_parents=include_parents,
798.                         include_hidden=include_hidden, seen_models=seen_models):
799.                     if not getattr(obj, 'parent_link', False) or obj.model == self.concrete_model:
800.                         fields.append(obj)
801.         if reverse and not self.proxy:
802.             # Tree is computed once and cached until the app cache is expired.
803.             # It is composed of a list of fields pointing to the current model
804.             # from other models.
805.             all_fields = self._relation_tree
806.             for field in all_fields:
807.                 # If hidden fields should be included or the relation is not
808.                 # intentionally hidden, add to the fields dict.
809.                 if include_hidden or not field.remote_field.hidden:
810.                     fields.append(field.remote_field)
811. 
812.         if forward:
813.             fields += self.local_fields
814.             fields += self.local_many_to_many
815.             # Private fields are recopied to each child model, and they get a
816.             # different model as field.model in each child. Hence we have to
817.             # add the private fields separately from the topmost call. If we
818.             # did this recursively similar to local_fields, we would get field
819.             # instances with field.model != self.model.
820.             if topmost_call:
821.                 fields += self.private_fields
822. 
823.         # In order to avoid list manipulation. Always
824.         # return a shallow copy of the results
825.         fields = make_immutable_fields_list("get_fields()", fields)
826. 
827.         # Store result into cache for later access
828.         self._get_fields_cache[cache_key] = fields
829.         return fields
830. 
831.     @cached_property
832.     def total_unique_constraints(self):
833.         """
834.         Return a list of total unique constraints. Useful for determining set
835.         of fields guaranteed to be unique for all rows.
836.         """
837.         return [
838.             constraint
839.             for constraint in self.constraints
840.             if isinstance(constraint, UniqueConstraint) and constraint.condition is None
841.         ]
842. 
843.     @cached_property
844.     def _property_names(self):
845.         """Return a set of the names of the properties defined on the model."""
846.         names = []
847.         for name in dir(self.model):
848.             attr = inspect.getattr_static(self.model, name)
849.             if isinstance(attr, property):
850.                 names.append(name)
851.         return frozenset(names)
852. 
853.     @cached_property
854.     def db_returning_fields(self):
855.         """
856.         Private API intended only to be used by Django itself.
857.         Fields to be returned after a database insert.
858.         """
859.         return [
860.             field for field in self._get_fields(forward=True, reverse=False, include_parents=PROXY_PARENTS)
861.             if getattr(field, 'db_returning', False)
862.         ]

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-23 03:32:44,337 - thread-124668563400384.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to fix an issue where `ForeignKey.validate()` uses `_default_manager` instead of `_base_manager`. The provided context already includes `django/db/models/fields/related.py` (which contains `ForeignKey.validate`), and `django/db/models/base.py`, `django/db/models/manager.py`, and `django/db/models/options.py` which define how `_default_manager` and `_base_manager` work. This is sufficient to understand the problem, the proposed solution, and its implications. The core issue is about which manager to use for validation, and the provided files fully cover the definition, role, and usage of these managers.' query='' extra_requirements='' purpose=''
2025-12-23 03:32:44,340 - thread-124668563400384.prometheus_context_collector - INFO - Successfully retrieved 4 context snippets
