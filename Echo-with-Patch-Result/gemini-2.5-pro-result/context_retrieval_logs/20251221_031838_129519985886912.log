2025-12-21 03:18:38,613 - thread-129519985886912.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: [Bug]: Windows correction is not correct in `mlab._spectral_helper`

Description: ### Bug summary

Windows correction is not correct in `mlab._spectral_helper`:
https://github.com/matplotlib/matplotlib/blob/3418bada1c1f44da1f73916c5603e3ae79fe58c1/lib/matplotlib/mlab.py#L423-L430

The `np.abs` is not needed, and give wrong result for window with negative value, such as `flattop`.
For reference, the implementation of scipy can be found here :
https://github.com/scipy/scipy/blob/d9f75db82fdffef06187c9d8d2f0f5b36c7a791b/scipy/signal/_spectral_py.py#L1854-L1859

### Code for reproduction

```python
import numpy as np
from scipy import signal
window = signal.windows.flattop(512)
print(np.abs(window).sum()**2-window.sum()**2)
```


### Actual outcome

4372.942556173262

### Expected outcome

0

### Additional information

_No response_

### Operating system

_No response_

### Matplotlib Version

latest

### Matplotlib Backend

_No response_

### Python version

_No response_

### Jupyter version

_No response_

### Installation

None

Patch information:
diff --git a/lib/matplotlib/mlab.py b/lib/matplotlib/mlab.py
index 3552904c3d..efa2f84cae 100644
--- a/lib/matplotlib/mlab.py
+++ b/lib/matplotlib/mlab.py
@@ -395,12 +395,12 @@ def _spectral_helper(x, y=None, NFFT=None, Fs=None, detrend_func=None,
     elif mode == 'psd':
         result = np.conj(result) * result
     elif mode == 'magnitude':
-        result = np.abs(result) / np.abs(window).sum()
+        result = np.abs(result) / window.sum()
     elif mode == 'angle' or mode == 'phase':
         # we unwrap the phase later to handle the onesided vs. twosided case
         result = np.angle(result)
     elif mode == 'complex':
-        result /= np.abs(window).sum()
+        result /= window.sum()
 
     if mode == 'psd':
 
@@ -424,10 +424,10 @@ def _spectral_helper(x, y=None, NFFT=None, Fs=None, detrend_func=None,
             result /= Fs
             # Scale the spectrum by the norm of the window to compensate for
             # windowing loss; see Bendat & Piersol Sec 11.5.2.
-            result /= (np.abs(window)**2).sum()
+            result /= (window**2).sum()
         else:
             # In this case, preserve power in the segment, not amplitude
-            result /= np.abs(window).sum()**2
+            result /= window.sum()**2
 
     t = np.arange(NFFT/2, len(x) - NFFT/2 + 1, NFFT - noverlap)/Fs
 


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-12-21 03:18:38,682 - thread-129519985886912.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
matplotlib
├── .appveyor.yml
├── .circleci
|   ├── config.yml
|   ├── deploy-docs.sh
|   └── fetch_doc_logs.py
├── .git_archival.txt
├── .github
|   ├── CONTRIBUTING.md
|   ├── FUNDING.yml
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.yml
|   |   ├── config.yml
|   |   ├── documentation.yml
|   |   ├── feature_request.yml
|   |   └── maintenance.yml
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── codecov.yml
|   ├── dependabot.yml
|   └── workflows
|       ├── cibuildsdist.yml
|       ├── cibuildwheel.yml
|       ├── circleci.yml
|       ├── clean_pr.yml
|       ├── codeql-analysis.yml
|       ├── conflictcheck.yml
|       ├── cygwin.yml
|       ├── nightlies.yml
|       ├── pr_welcome.yml
|       ├── reviewdog.yml
|       └── tests.yml
├── .lgtm.yml
├── .meeseeksdev.yml
├── .pre-commit-config.yaml
├── CODE_OF_CONDUCT.md
├── INSTALL.rst
├── LICENSE
├── README.md
├── SECURITY.md
├── azure-pipelines.yml
├── ci
|   ├── check_version_number.py
|   ├── check_wheel_licenses.py
|   └── codespell-ignore-words.txt
├── doc
|   ├── README.txt
|   ├── _static
|   |   ├── fa
|   |   ├── markers
|   |   ├── mpl.css
|   |   └── zenodo_cache
|   ├── _templates
|   |   ├── autofunctions.rst
|   |   ├── automodule.rst
|   |   ├── autosummary.rst
|   |   ├── autosummary_class_only.rst
|   |   ├── cheatsheet_sidebar.html
|   |   ├── donate_sidebar.html
|   |   ├── function.rst
|   |   ├── pagesource.html
|   |   ├── search.html
|   |   ├── sidebar_announcement.html
|   |   └── sidebar_versions.html
|   ├── api
|   |   ├── _api_api.rst
|   |   ├── _enums_api.rst
|   |   ├── afm_api.rst
|   |   ├── animation_api.rst
|   |   ├── artist_api.rst
|   |   ├── axes_api.rst
|   |   ├── axis_api.rst
|   |   ├── backend_agg_api.rst
|   |   ├── backend_bases_api.rst
|   |   ├── backend_cairo_api.rst
|   |   ├── backend_gtk3_api.rst
|   |   ├── backend_gtk4_api.rst
|   |   ├── backend_managers_api.rst
|   |   ├── backend_mixed_api.rst
|   |   ├── backend_nbagg_api.rst
|   |   ├── backend_pdf_api.rst
|   |   ├── backend_pgf_api.rst
|   |   ├── backend_ps_api.rst
|   |   ├── backend_qt_api.rst
|   |   ├── backend_svg_api.rst
|   |   ├── backend_template_api.rst
|   |   ├── backend_tk_api.rst
|   |   ├── backend_tools_api.rst
|   |   ├── backend_webagg_api.rst
|   |   ├── backend_wx_api.rst
|   |   ├── bezier_api.rst
|   |   ├── category_api.rst
|   |   ├── cbook_api.rst
|   |   ├── cm_api.rst
|   |   ├── collections_api.rst
|   |   ├── colorbar_api.rst
|   |   ├── colors_api.rst
|   |   ├── container_api.rst
|   |   ├── contour_api.rst
|   |   ├── dates_api.rst
|   |   ├── docstring_api.rst
|   |   ├── dviread.rst
|   |   ├── figure_api.rst
|   |   ├── font_manager_api.rst
|   |   ├── ft2font.rst
|   |   ├── gridspec_api.rst
|   |   ├── hatch_api.rst
|   |   ├── image_api.rst
|   |   ├── index.rst
|   |   ├── index_backend_api.rst
|   |   ├── layout_engine_api.rst
|   |   ├── legend_api.rst
|   |   ├── legend_handler_api.rst
|   |   ├── lines_api.rst
|   |   ├── markers_api.rst
|   |   ├── mathtext_api.rst
|   |   ├── matplotlib_configuration_api.rst
|   |   ├── mlab_api.rst
|   |   ├── next_api_changes
|   |   |   ├── README.rst
|   |   |   ├── behavior
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 23573-AL.rst
|   |   |   |   ├── 23579-AL.rst
|   |   |   |   ├── 23710-ES.rst
|   |   |   |   ├── 24062-tb.rst
|   |   |   |   ├── 24131-OG.rst
|   |   |   |   ├── 24132-GL.rst
|   |   |   |   ├── 24189-JB.rst
|   |   |   |   ├── 24570-GL.rst
|   |   |   |   ├── 24655-AK.rst
|   |   |   |   ├── 24829-AL.rst
|   |   |   |   ├── 24870-AL.rst
|   |   |   |   ├── 24889-AL.rst
|   |   |   |   ├── 24912-AL.rst
|   |   |   |   ├── 25061-DS.rst
|   |   |   |   └── 9598-AFV.rst
|   |   |   ├── deprecations
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 19763-ES.rst
|   |   |   |   ├── 22314-AL.rst
|   |   |   |   ├── 23449-SS.rst
|   |   |   |   ├── 23720-RS.rst
|   |   |   |   ├── 23735-ES.rst
|   |   |   |   ├── 23824-OG.rst
|   |   |   |   ├── 24000-TH.rst
|   |   |   |   ├── 24013-TH.rst
|   |   |   |   ├── 24071-OG.rst
|   |   |   |   ├── 24088-JMK.rst
|   |   |   |   ├── 24131-OG.rst
|   |   |   |   ├── 24140-AL.rst
|   |   |   |   ├── 24144-AL.rst
|   |   |   |   ├── 24198-AL.rst
|   |   |   |   ├── 24208-AL.rst
|   |   |   |   ├── 24220-AL.rst
|   |   |   |   ├── 24221-AL.rst
|   |   |   |   ├── 24224-OG.rst
|   |   |   |   ├── 24240-OG.rst
|   |   |   |   ├── 24254-OG.rst
|   |   |   |   ├── 24305-AL.rst
|   |   |   |   ├── 24455-AL.rst
|   |   |   |   ├── 24465-AL.rst
|   |   |   |   ├── 24474_CM.rst
|   |   |   |   ├── 24538-OG.rst
|   |   |   |   ├── 24577-AL.rst
|   |   |   |   ├── 24664-OG.rst
|   |   |   |   ├── 24688-OG.rst
|   |   |   |   ├── 24730-TH.rst
|   |   |   |   ├── 24806-KS.rst
|   |   |   |   ├── 24846-ES.rst
|   |   |   |   ├── 24864-AL.rst
|   |   |   |   ├── 24904-AL.rst
|   |   |   |   ├── 24913-AL.rst
|   |   |   |   ├── 24985-OG.rst
|   |   |   |   └── 24990-OG.rst
|   |   |   ├── development
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 23683-AL.rst
|   |   |   |   ├── 24257-AL.rst
|   |   |   |   ├── 24710-AL.rst
|   |   |   |   ├── 24724-ES.rst
|   |   |   |   ├── 24887-OG.rst
|   |   |   |   ├── 24893-KS.rst
|   |   |   |   └── 24919-KS.rst
|   |   |   └── removals
|   |   |       ├── 00001-ABC.rst
|   |   |       ├── 21661-TAC.rst
|   |   |       ├── 24125-OG.rst
|   |   |       ├── 24128-OG.rst
|   |   |       ├── 24129-OG.rst
|   |   |       ├── 24251-OG.rst
|   |   |       ├── 24253-OG.rst
|   |   |       ├── 24254-OG.rst
|   |   |       ├── 24257-AL.rst
|   |   |       ├── 24355-OG.rst
|   |   |       ├── 24356-OG.rst
|   |   |       ├── 24624-AL.rst
|   |   |       ├── 24923-ES.rst
|   |   |       ├── 24948-ES.rst
|   |   |       ├── 24965-ES.rst
|   |   |       └── 24XXX-OG.rst
|   |   ├── next_api_changes.rst
|   |   ├── offsetbox_api.rst
|   |   ├── patches_api.rst
|   |   ├── path_api.rst
|   |   ├── patheffects_api.rst
|   |   ├── prev_api_changes
|   |   |   ├── api_changes_0.40.rst
|   |   |   ├── api_changes_0.42.rst
|   |   |   ├── api_changes_0.50.rst
|   |   |   ├── api_changes_0.54.3.rst
|   |   |   ├── api_changes_0.54.rst
|   |   |   ├── api_changes_0.60.rst
|   |   |   ├── api_changes_0.61.rst
|   |   |   ├── api_changes_0.63.rst
|   |   |   ├── api_changes_0.65.1.rst
|   |   |   ├── api_changes_0.65.rst
|   |   |   ├── api_changes_0.70.rst
|   |   |   ├── api_changes_0.71.rst
|   |   |   ├── api_changes_0.72.rst
|   |   |   ├── api_changes_0.73.rst
|   |   |   ├── api_changes_0.80.rst
|   |   |   ├── api_changes_0.81.rst
|   |   |   ├── api_changes_0.82.rst
|   |   |   ├── api_changes_0.83.rst
|   |   |   ├── api_changes_0.84.rst
|   |   |   ├── api_changes_0.85.rst
|   |   |   ├── api_changes_0.86.rst
|   |   |   ├── api_changes_0.87.7.rst
|   |   |   ├── api_changes_0.90.0.rst
|   |   |   ├── api_changes_0.90.1.rst
|   |   |   ├── api_changes_0.91.0.rst
|   |   |   ├── api_changes_0.91.2.rst
|   |   |   ├── api_changes_0.98.0.rst
|   |   |   ├── api_changes_0.98.1.rst
|   |   |   ├── api_changes_0.98.x.rst
|   |   |   ├── api_changes_0.99.rst
|   |   |   ├── api_changes_0.99.x.rst
|   |   |   ├── api_changes_1.1.x.rst
|   |   |   ├── api_changes_1.2.x.rst
|   |   |   ├── api_changes_1.3.x.rst
|   |   |   ├── api_changes_1.4.x.rst
|   |   |   ├── api_changes_1.5.0.rst
|   |   |   ├── api_changes_1.5.2.rst
|   |   |   ├── api_changes_1.5.3.rst
|   |   |   ├── api_changes_2.0.0.rst
|   |   |   ├── api_changes_2.0.1.rst
|   |   |   ├── api_changes_2.1.0.rst
|   |   |   ├── api_changes_2.1.1.rst
|   |   |   ├── api_changes_2.1.2.rst
|   |   |   ├── api_changes_2.2.0.rst
|   |   |   ├── api_changes_3.0.0.rst
|   |   |   ├── api_changes_3.0.1.rst
|   |   |   ├── api_changes_3.1.0.rst
|   |   |   ├── api_changes_3.1.1.rst
|   |   |   ├── api_changes_3.2.0
|   |   |   |   ├── behavior.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.2.0.rst
|   |   |   ├── api_changes_3.3.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.3.0.rst
|   |   |   ├── api_changes_3.3.1.rst
|   |   |   ├── api_changes_3.4.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.4.0.rst
|   |   |   ├── api_changes_3.4.2.rst
|   |   |   ├── api_changes_3.5.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.5.0.rst
|   |   |   ├── api_changes_3.5.2.rst
|   |   |   ├── api_changes_3.5.3.rst
|   |   |   ├── api_changes_3.6.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   └── api_changes_3.6.0.rst
|   |   ├── projections
|   |   |   ├── geo.rst
|   |   |   └── polar.rst
|   |   ├── projections_api.rst
|   |   ├── pyplot_summary.rst
|   |   ├── quiver_api.rst
|   |   ├── rcsetup_api.rst
|   |   ├── sankey_api.rst
|   |   ├── scale_api.rst
|   |   ├── sphinxext_mathmpl_api.rst
|   |   ├── sphinxext_plot_directive_api.rst
|   |   ├── spines_api.rst
|   |   ├── style_api.rst
|   |   ├── table_api.rst
|   |   ├── testing_api.rst
|   |   ├── texmanager_api.rst
|   |   ├── text_api.rst
|   |   ├── ticker_api.rst
|   |   ├── tight_bbox_api.rst
|   |   ├── tight_layout_api.rst
|   |   ├── toolkits
|   |   |   ├── axes_grid1.rst
|   |   |   ├── axisartist.rst
|   |   |   ├── mplot3d
|   |   |   |   ├── axes3d.rst
|   |   |   |   ├── faq.rst
|   |   |   |   └── view_angles.rst
|   |   |   └── mplot3d.rst
|   |   ├── transformations.rst
|   |   ├── tri_api.rst
|   |   ├── type1font.rst
|   |   ├── units_api.rst
|   |   └── widgets_api.rst
|   ├── conf.py
|   ├── devel
|   |   ├── MEP
|   |   |   ├── MEP08.rst
|   |   |   ├── MEP09.rst
|   |   |   ├── MEP10.rst
|   |   |   ├── MEP11.rst
|   |   |   ├── MEP12.rst
|   |   |   ├── MEP13.rst
|   |   |   ├── MEP14.rst
|   |   |   ├── MEP15.rst
|   |   |   ├── MEP19.rst
|   |   |   ├── MEP21.rst
|   |   |   ├── MEP22.rst
|   |   |   ├── MEP23.rst
|   |   |   ├── MEP24.rst
|   |   |   ├── MEP25.rst
|   |   |   ├── MEP26.rst
|   |   |   ├── MEP27.rst
|   |   |   ├── MEP28.rst
|   |   |   ├── MEP29.rst
|   |   |   ├── README.rst
|   |   |   ├── index.rst
|   |   |   └── template.rst
|   |   ├── README.txt
|   |   ├── coding_guide.rst
|   |   ├── color_changes.rst
|   |   ├── contributing.rst
|   |   ├── dependencies.rst
|   |   ├── development_setup.rst
|   |   ├── development_workflow.rst
|   |   ├── documenting_mpl.rst
|   |   ├── index.rst
|   |   ├── license.rst
|   |   ├── maintainer_workflow.rst
|   |   ├── min_dep_policy.rst
|   |   ├── release_guide.rst
|   |   ├── style_guide.rst
|   |   ├── testing.rst
|   |   └── triage.rst
|   ├── index.rst
|   ├── sphinxext
|   |   ├── __init__.py
|   |   ├── custom_roles.py
|   |   ├── gallery_order.py
|   |   ├── github.py
|   |   ├── math_symbol_table.py
|   |   ├── missing_references.py
|   |   ├── mock_gui_toolkits.py
|   |   ├── redirect_from.py
|   |   └── skip_deprecated.py
|   ├── thirdpartypackages
|   |   └── index.rst
|   └── users
|       ├── explain
|       |   ├── api_interfaces.rst
|       |   ├── backends.rst
|       |   ├── event_handling.rst
|       |   ├── figures.rst
|       |   ├── fonts.rst
|       |   ├── index.rst
|       |   ├── interactive.rst
|       |   ├── interactive_guide.rst
|       |   ├── performance.rst
|       |   └── writing_a_backend_pyplot_interface.rst
|       ├── faq
|       |   ├── environment_variables_faq.rst
|       |   ├── howto_faq.rst
|       |   ├── index.rst
|       |   └── troubleshooting_faq.rst
|       ├── generate_credits.py
|       ├── getting_started
|       |   └── index.rst
|       ├── github_stats.rst
|       ├── index.rst
|       ├── installing
|       |   └── index.rst
|       ├── next_whats_new
|       |   ├── 3d_pane_color_rcparams.rst
|       |   ├── 3d_plot_aspects_adjustable_keyword.rst
|       |   ├── 3d_plot_pan_zoom.rst
|       |   ├── README.rst
|       |   ├── bar_label_formatting.rst
|       |   ├── colorbar_has_location_argument.rst
|       |   ├── documentation.rst
|       |   ├── ellipse_annotation.rst
|       |   ├── figure_hooks.rst
|       |   ├── imshow_extent_units.rst
|       |   ├── legend-figure-outside.rst
|       |   ├── per_subplot_mosaic.rst
|       |   ├── pie_hatch.rst
|       |   ├── polar_errorbar_caps.rst
|       |   ├── reverse_legend.rst
|       |   ├── rgba_pcolormesh.rst
|       |   ├── savefig_bbox_layout.rst
|       |   ├── shade_poly3dcollection.rst
|       |   ├── show_source_links_directive_option.rst
|       |   ├── styles_from_packages.rst
|       |   ├── view_current_axis_format.rst
|       |   ├── widget_blitting.rst
|       |   └── widget_button_styling.rst
|       ├── next_whats_new.rst
|       ├── prev_whats_new
|       |   ├── changelog.rst
|       |   ├── dflt_style_changes.rst
|       |   ├── github_stats_3.0.0.rst
|       |   ├── github_stats_3.0.1.rst
|       |   ├── github_stats_3.0.2.rst
|       |   ├── github_stats_3.0.3.rst
|       |   ├── github_stats_3.1.0.rst
|       |   ├── github_stats_3.1.1.rst
|       |   ├── github_stats_3.1.2.rst
|       |   ├── github_stats_3.1.3.rst
|       |   ├── github_stats_3.2.0.rst
|       |   ├── github_stats_3.2.1.rst
|       |   ├── github_stats_3.2.2.rst
|       |   ├── github_stats_3.3.0.rst
|       |   ├── github_stats_3.3.1.rst
|       |   ├── github_stats_3.3.2.rst
|       |   ├── github_stats_3.3.3.rst
|       |   ├── github_stats_3.3.4.rst
|       |   ├── github_stats_3.4.0.rst
|       |   ├── github_stats_3.4.1.rst
|       |   ├── github_stats_3.4.2.rst
|       |   ├── github_stats_3.4.3.rst
|       |   ├── github_stats_3.5.0.rst
|       |   ├── github_stats_3.5.1.rst
|       |   ├── github_stats_3.5.2.rst
|       |   ├── github_stats_3.5.3.rst
|       |   ├── whats_new_0.98.4.rst
|       |   ├── whats_new_0.99.rst
|       |   ├── whats_new_1.0.rst
|       |   ├── whats_new_1.1.rst
|       |   ├── whats_new_1.2.2.rst
|       |   ├── whats_new_1.2.rst
|       |   ├── whats_new_1.3.rst
|       |   ├── whats_new_1.4.rst
|       |   ├── whats_new_1.5.rst
|       |   ├── whats_new_2.0.0.rst
|       |   ├── whats_new_2.1.0.rst
|       |   ├── whats_new_2.2.rst
|       |   ├── whats_new_3.0.rst
|       |   ├── whats_new_3.1.0.rst
|       |   ├── whats_new_3.2.0.rst
|       |   ├── whats_new_3.3.0.rst
|       |   ├── whats_new_3.4.0.rst
|       |   ├── whats_new_3.5.0.rst
|       |   ├── whats_new_3.5.2.rst
|       |   └── whats_new_3.6.0.rst
|       ├── project
|       |   ├── citing.rst
|       |   ├── credits.rst
|       |   ├── history.rst
|       |   ├── index.rst
|       |   ├── license.rst
|       |   └── mission.rst
|       ├── release_notes.rst
|       ├── release_notes_next.rst
|       └── resources
|           └── index.rst
├── environment.yml
├── examples
|   ├── README.txt
|   ├── animation
|   |   ├── README.txt
|   |   ├── animate_decay.py
|   |   ├── animated_histogram.py
|   |   ├── animation_demo.py
|   |   ├── bayes_update.py
|   |   ├── double_pendulum.py
|   |   ├── dynamic_image.py
|   |   ├── frame_grabbing_sgskip.py
|   |   ├── multiple_axes.py
|   |   ├── pause_resume.py
|   |   ├── rain.py
|   |   ├── random_walk.py
|   |   ├── simple_anim.py
|   |   ├── simple_scatter.py
|   |   ├── strip_chart.py
|   |   └── unchained.py
|   ├── axes_grid1
|   |   ├── README.txt
|   |   ├── demo_anchored_direction_arrows.py
|   |   ├── demo_axes_divider.py
|   |   ├── demo_axes_grid.py
|   |   ├── demo_axes_grid2.py
|   |   ├── demo_axes_hbox_divider.py
|   |   ├── demo_axes_rgb.py
|   |   ├── demo_colorbar_of_inset_axes.py
|   |   ├── demo_colorbar_with_axes_divider.py
|   |   ├── demo_colorbar_with_inset_locator.py
|   |   ├── demo_edge_colorbar.py
|   |   ├── demo_fixed_size_axes.py
|   |   ├── demo_imagegrid_aspect.py
|   |   ├── inset_locator_demo.py
|   |   ├── inset_locator_demo2.py
|   |   ├── make_room_for_ylabel_using_axesgrid.py
|   |   ├── parasite_simple.py
|   |   ├── parasite_simple2.py
|   |   ├── scatter_hist_locatable_axes.py
|   |   ├── simple_anchored_artists.py
|   |   ├── simple_axes_divider1.py
|   |   ├── simple_axes_divider3.py
|   |   ├── simple_axesgrid.py
|   |   ├── simple_axesgrid2.py
|   |   ├── simple_axisline4.py
|   |   └── simple_colorbar.py
|   ├── axisartist
|   |   ├── README.txt
|   |   ├── axis_direction.py
|   |   ├── demo_axis_direction.py
|   |   ├── demo_axisline_style.py
|   |   ├── demo_curvelinear_grid.py
|   |   ├── demo_curvelinear_grid2.py
|   |   ├── demo_floating_axes.py
|   |   ├── demo_floating_axis.py
|   |   ├── demo_parasite_axes.py
|   |   ├── demo_parasite_axes2.py
|   |   ├── demo_ticklabel_alignment.py
|   |   ├── demo_ticklabel_direction.py
|   |   ├── simple_axis_direction01.py
|   |   ├── simple_axis_direction03.py
|   |   ├── simple_axis_pad.py
|   |   ├── simple_axisartist1.py
|   |   ├── simple_axisline.py
|   |   └── simple_axisline3.py
|   ├── color
|   |   ├── README.txt
|   |   ├── color_by_yvalue.py
|   |   ├── color_cycle_default.py
|   |   ├── color_demo.py
|   |   ├── colorbar_basics.py
|   |   ├── colormap_reference.py
|   |   ├── custom_cmap.py
|   |   └── named_colors.py
|   ├── event_handling
|   |   ├── README.txt
|   |   ├── close_event.py
|   |   ├── coords_demo.py
|   |   ├── cursor_demo.py
|   |   ├── data_browser.py
|   |   ├── figure_axes_enter_leave.py
|   |   ├── ginput_manual_clabel_sgskip.py
|   |   ├── image_slices_viewer.py
|   |   ├── keypress_demo.py
|   |   ├── lasso_demo.py
|   |   ├── legend_picking.py
|   |   ├── looking_glass.py
|   |   ├── path_editor.py
|   |   ├── pick_event_demo.py
|   |   ├── pick_event_demo2.py
|   |   ├── poly_editor.py
|   |   ├── pong_sgskip.py
|   |   ├── resample.py
|   |   ├── timers.py
|   |   ├── trifinder_event_demo.py
|   |   ├── viewlims.py
|   |   └── zoom_window.py
|   ├── images_contours_and_fields
|   |   ├── README.txt
|   |   ├── affine_image.py
|   |   ├── barb_demo.py
|   |   ├── barcode_demo.py
|   |   ├── colormap_interactive_adjustment.py
|   |   ├── colormap_normalizations.py
|   |   ├── colormap_normalizations_symlognorm.py
|   |   ├── contour_corner_mask.py
|   |   ├── contour_demo.py
|   |   ├── contour_image.py
|   |   ├── contour_label_demo.py
|   |   ├── contourf_demo.py
|   |   ├── contourf_hatching.py
|   |   ├── contourf_log.py
|   |   ├── contours_in_optimization_demo.py
|   |   ├── demo_bboximage.py
|   |   ├── figimage_demo.py
|   |   ├── image_annotated_heatmap.py
|   |   ├── image_antialiasing.py
|   |   ├── image_clip_path.py
|   |   ├── image_demo.py
|   |   ├── image_masked.py
|   |   ├── image_nonuniform.py
|   |   ├── image_transparency_blend.py
|   |   ├── image_zcoord.py
|   |   ├── interpolation_methods.py
|   |   ├── irregulardatagrid.py
|   |   ├── layer_images.py
|   |   ├── matshow.py
|   |   ├── multi_image.py
|   |   ├── pcolor_demo.py
|   |   ├── pcolormesh_grids.py
|   |   ├── pcolormesh_levels.py
|   |   ├── plot_streamplot.py
|   |   ├── quadmesh_demo.py
|   |   ├── quiver_demo.py
|   |   ├── quiver_simple_demo.py
|   |   ├── shading_example.py
|   |   ├── specgram_demo.py
|   |   ├── spy_demos.py
|   |   ├── tricontour_demo.py
|   |   ├── tricontour_smooth_delaunay.py
|   |   ├── tricontour_smooth_user.py
|   |   ├── trigradient_demo.py
|   |   ├── triinterp_demo.py
|   |   ├── tripcolor_demo.py
|   |   ├── triplot_demo.py
|   |   └── watermark_image.py
|   ├── lines_bars_and_markers
|   |   ├── README.txt
|   |   ├── bar_colors.py
|   |   ├── bar_label_demo.py
|   |   ├── bar_stacked.py
|   |   ├── barchart.py
|   |   ├── barh.py
|   |   ├── broken_barh.py
|   |   ├── capstyle.py
|   |   ├── categorical_variables.py
|   |   ├── cohere.py
|   |   ├── csd_demo.py
|   |   ├── curve_error_band.py
|   |   ├── errorbar_limits_simple.py
|   |   ├── errorbar_subsample.py
|   |   ├── eventcollection_demo.py
|   |   ├── eventplot_demo.py
|   |   ├── fill.py
|   |   ├── fill_between_alpha.py
|   |   ├── fill_between_demo.py
|   |   ├── fill_betweenx_demo.py
|   |   ├── filled_step.py
|   |   ├── gradient_bar.py
|   |   ├── hat_graph.py
|   |   ├── horizontal_barchart_distribution.py
|   |   ├── joinstyle.py
|   |   ├── line_demo_dash_control.py
|   |   ├── lines_with_ticks_demo.py
|   |   ├── linestyles.py
|   |   ├── marker_reference.py
|   |   ├── markevery_demo.py
|   |   ├── masked_demo.py
|   |   ├── multicolored_line.py
|   |   ├── multivariate_marker_plot.py
|   |   ├── psd_demo.py
|   |   ├── scatter_custom_symbol.py
|   |   ├── scatter_demo2.py
|   |   ├── scatter_hist.py
|   |   ├── scatter_masked.py
|   |   ├── scatter_star_poly.py
|   |   ├── scatter_with_legend.py
|   |   ├── simple_plot.py
|   |   ├── span_regions.py
|   |   ├── spectrum_demo.py
|   |   ├── stackplot_demo.py
|   |   ├── stairs_demo.py
|   |   ├── stem_plot.py
|   |   ├── step_demo.py
|   |   ├── timeline.py
|   |   ├── vline_hline_demo.py
|   |   └── xcorr_acorr_demo.py
|   ├── misc
|   |   ├── README.txt
|   |   ├── anchored_artists.py
|   |   ├── bbox_intersect.py
|   |   ├── contour_manual.py
|   |   ├── coords_report.py
|   |   ├── custom_projection.py
|   |   ├── customize_rc.py
|   |   ├── demo_agg_filter.py
|   |   ├── demo_ribbon_box.py
|   |   ├── fig_x.py
|   |   ├── fill_spiral.py
|   |   ├── findobj_demo.py
|   |   ├── font_indexing.py
|   |   ├── ftface_props.py
|   |   ├── histogram_path.py
|   |   ├── hyperlinks_sgskip.py
|   |   ├── image_thumbnail_sgskip.py
|   |   ├── keyword_plotting.py
|   |   ├── logos2.py
|   |   ├── multipage_pdf.py
|   |   ├── multiprocess_sgskip.py
|   |   ├── packed_bubbles.py
|   |   ├── patheffect_demo.py
|   |   ├── print_stdout_sgskip.py
|   |   ├── rasterization_demo.py
|   |   ├── set_and_get.py
|   |   ├── svg_filter_line.py
|   |   ├── svg_filter_pie.py
|   |   ├── table_demo.py
|   |   ├── tickedstroke_demo.py
|   |   ├── transoffset.py
|   |   └── zorder_demo.py
|   ├── mplot3d
|   |   ├── 2dcollections3d.py
|   |   ├── 3d_bars.py
|   |   ├── README.txt
|   |   ├── bars3d.py
|   |   ├── box3d.py
|   |   ├── contour3d.py
|   |   ├── contour3d_2.py
|   |   ├── contour3d_3.py
|   |   ├── contourf3d.py
|   |   ├── contourf3d_2.py
|   |   ├── custom_shaded_3d_surface.py
|   |   ├── errorbar3d.py
|   |   ├── hist3d.py
|   |   ├── lines3d.py
|   |   ├── lorenz_attractor.py
|   |   ├── mixed_subplots.py
|   |   ├── offset.py
|   |   ├── pathpatch3d.py
|   |   ├── polys3d.py
|   |   ├── projections.py
|   |   ├── quiver3d.py
|   |   ├── rotate_axes3d_sgskip.py
|   |   ├── scatter3d.py
|   |   ├── stem3d_demo.py
|   |   ├── subplot3d.py
|   |   ├── surface3d.py
|   |   ├── surface3d_2.py
|   |   ├── surface3d_3.py
|   |   ├── surface3d_radial.py
|   |   ├── text3d.py
|   |   ├── tricontour3d.py
|   |   ├── tricontourf3d.py
|   |   ├── trisurf3d.py
|   |   ├── trisurf3d_2.py
|   |   ├── view_planes_3d.py
|   |   ├── voxels.py
|   |   ├── voxels_numpy_logo.py
|   |   ├── voxels_rgb.py
|   |   ├── voxels_torus.py
|   |   ├── wire3d.py
|   |   ├── wire3d_animation_sgskip.py
|   |   └── wire3d_zero_stride.py
|   ├── pie_and_polar_charts
|   |   ├── README.txt
|   |   ├── bar_of_pie.py
|   |   ├── nested_pie.py
|   |   ├── pie_and_donut_labels.py
|   |   ├── pie_demo2.py
|   |   ├── pie_features.py
|   |   ├── polar_bar.py
|   |   ├── polar_demo.py
|   |   ├── polar_error_caps.py
|   |   ├── polar_legend.py
|   |   └── polar_scatter.py
|   ├── pyplots
|   |   ├── README.txt
|   |   ├── axline.py
|   |   ├── pyplot_simple.py
|   |   ├── pyplot_text.py
|   |   ├── pyplot_three.py
|   |   └── pyplot_two_subplots.py
|   ├── scales
|   |   ├── README.txt
|   |   ├── asinh_demo.py
|   |   ├── aspect_loglog.py
|   |   ├── custom_scale.py
|   |   ├── log_bar.py
|   |   ├── log_demo.py
|   |   ├── logit_demo.py
|   |   ├── power_norm.py
|   |   ├── scales.py
|   |   ├── semilogx_demo.py
|   |   └── symlog_demo.py
|   ├── shapes_and_collections
|   |   ├── README.txt
|   |   ├── arrow_guide.py
|   |   ├── artist_reference.py
|   |   ├── collections.py
|   |   ├── compound_path.py
|   |   ├── dolphin.py
|   |   ├── donut.py
|   |   ├── ellipse_collection.py
|   |   ├── ellipse_demo.py
|   |   ├── fancybox_demo.py
|   |   ├── hatch_demo.py
|   |   ├── hatch_style_reference.py
|   |   ├── line_collection.py
|   |   ├── patch_collection.py
|   |   ├── path_patch.py
|   |   ├── quad_bezier.py
|   |   └── scatter.py
|   ├── showcase
|   |   ├── README.txt
|   |   ├── anatomy.py
|   |   ├── firefox.py
|   |   ├── integral.py
|   |   ├── mandelbrot.py
|   |   ├── stock_prices.py
|   |   └── xkcd.py
|   ├── specialty_plots
|   |   ├── README.txt
|   |   ├── advanced_hillshading.py
|   |   ├── anscombe.py
|   |   ├── hinton_demo.py
|   |   ├── leftventricle_bullseye.py
|   |   ├── mri_demo.py
|   |   ├── mri_with_eeg.py
|   |   ├── radar_chart.py
|   |   ├── sankey_basics.py
|   |   ├── sankey_links.py
|   |   ├── sankey_rankine.py
|   |   ├── skewt.py
|   |   └── topographic_hillshading.py
|   ├── spines
|   |   ├── README.txt
|   |   ├── centered_spines_with_arrows.py
|   |   ├── multiple_yaxis_with_spines.py
|   |   ├── spine_placement_demo.py
|   |   ├── spines.py
|   |   └── spines_dropped.py
|   ├── statistics
|   |   ├── README.txt
|   |   ├── barchart_demo.py
|   |   ├── boxplot.py
|   |   ├── boxplot_color.py
|   |   ├── boxplot_demo.py
|   |   ├── boxplot_vs_violin.py
|   |   ├── bxp.py
|   |   ├── confidence_ellipse.py
|   |   ├── customized_violin.py
|   |   ├── errorbar.py
|   |   ├── errorbar_features.py
|   |   ├── errorbar_limits.py
|   |   ├── errorbars_and_boxes.py
|   |   ├── hexbin_demo.py
|   |   ├── hist.py
|   |   ├── histogram_cumulative.py
|   |   ├── histogram_features.py
|   |   ├── histogram_histtypes.py
|   |   ├── histogram_multihist.py
|   |   ├── multiple_histograms_side_by_side.py
|   |   ├── time_series_histogram.py
|   |   └── violinplot.py
|   ├── style_sheets
|   |   ├── README.txt
|   |   ├── bmh.py
|   |   ├── dark_background.py
|   |   ├── fivethirtyeight.py
|   |   ├── ggplot.py
|   |   ├── grayscale.py
|   |   ├── plot_solarizedlight2.py
|   |   └── style_sheets_reference.py
|   ├── subplots_axes_and_figures
|   |   ├── README.txt
|   |   ├── align_labels_demo.py
|   |   ├── auto_subplots_adjust.py
|   |   ├── axes_box_aspect.py
|   |   ├── axes_demo.py
|   |   ├── axes_margins.py
|   |   ├── axes_props.py
|   |   ├── axes_zoom_effect.py
|   |   ├── axhspan_demo.py
|   |   ├── axis_equal_demo.py
|   |   ├── axis_labels_demo.py
|   |   ├── broken_axis.py
|   |   ├── colorbar_placement.py
|   |   ├── custom_figure_class.py
|   |   ├── demo_constrained_layout.py
|   |   ├── demo_tight_layout.py
|   |   ├── fahrenheit_celsius_scales.py
|   |   ├── figure_size_units.py
|   |   ├── figure_title.py
|   |   ├── ganged_plots.py
|   |   ├── geo_demo.py
|   |   ├── gridspec_and_subplots.py
|   |   ├── gridspec_multicolumn.py
|   |   ├── gridspec_nested.py
|   |   ├── invert_axes.py
|   |   ├── mosaic.py
|   |   ├── multiple_figs_demo.py
|   |   ├── secondary_axis.py
|   |   ├── share_axis_lims_views.py
|   |   ├── shared_axis_demo.py
|   |   ├── subfigures.py
|   |   ├── subplot.py
|   |   ├── subplots_adjust.py
|   |   ├── subplots_demo.py
|   |   ├── two_scales.py
|   |   └── zoom_inset_axes.py
|   ├── text_labels_and_annotations
|   |   ├── README.txt
|   |   ├── accented_text.py
|   |   ├── align_ylabels.py
|   |   ├── angle_annotation.py
|   |   ├── angles_on_bracket_arrows.py
|   |   ├── annotate_transform.py
|   |   ├── annotation_basic.py
|   |   ├── annotation_demo.py
|   |   ├── annotation_polar.py
|   |   ├── arrow_demo.py
|   |   ├── autowrap.py
|   |   ├── custom_legends.py
|   |   ├── date.py
|   |   ├── demo_annotation_box.py
|   |   ├── demo_text_path.py
|   |   ├── demo_text_rotation_mode.py
|   |   ├── dfrac_demo.py
|   |   ├── engineering_formatter.py
|   |   ├── fancyarrow_demo.py
|   |   ├── fancytextbox_demo.py
|   |   ├── figlegend_demo.py
|   |   ├── font_family_rc.py
|   |   ├── font_file.py
|   |   ├── font_table.py
|   |   ├── fonts_demo.py
|   |   ├── fonts_demo_kw.py
|   |   ├── label_subplots.py
|   |   ├── legend.py
|   |   ├── legend_demo.py
|   |   ├── line_with_text.py
|   |   ├── mathtext_asarray.py
|   |   ├── mathtext_demo.py
|   |   ├── mathtext_examples.py
|   |   ├── mathtext_fontfamily_example.py
|   |   ├── multiline.py
|   |   ├── placing_text_boxes.py
|   |   ├── rainbow_text.py
|   |   ├── stix_fonts_demo.py
|   |   ├── tex_demo.py
|   |   ├── text_alignment.py
|   |   ├── text_commands.py
|   |   ├── text_fontdict.py
|   |   ├── text_rotation_relative_to_line.py
|   |   ├── titles_demo.py
|   |   ├── unicode_minus.py
|   |   ├── usetex_baseline_test.py
|   |   ├── usetex_fonteffects.py
|   |   └── watermark_text.py
|   ├── ticks
|   |   ├── README.txt
|   |   ├── auto_ticks.py
|   |   ├── centered_ticklabels.py
|   |   ├── colorbar_tick_labelling_demo.py
|   |   ├── custom_ticker1.py
|   |   ├── date_concise_formatter.py
|   |   ├── date_demo_convert.py
|   |   ├── date_demo_rrule.py
|   |   ├── date_formatters_locators.py
|   |   ├── date_index_formatter.py
|   |   ├── date_precision_and_epochs.py
|   |   ├── dollar_ticks.py
|   |   ├── fig_axes_customize_simple.py
|   |   ├── major_minor_demo.py
|   |   ├── scalarformatter.py
|   |   ├── tick-formatters.py
|   |   ├── tick-locators.py
|   |   ├── tick_label_right.py
|   |   ├── tick_labels_from_values.py
|   |   ├── tick_xlabel_top.py
|   |   ├── ticklabels_rotation.py
|   |   └── ticks_too_many.py
|   ├── units
|   |   ├── README.txt
|   |   ├── annotate_with_units.py
|   |   ├── artist_tests.py
|   |   ├── bar_demo2.py
|   |   ├── bar_unit_demo.py
|   |   ├── basic_units.py
|   |   ├── ellipse_with_units.py
|   |   ├── evans_test.py
|   |   ├── radian_demo.py
|   |   ├── units_sample.py
|   |   └── units_scatter.py
|   ├── user_interfaces
|   |   ├── README.txt
|   |   ├── canvasagg.py
|   |   ├── embedding_in_gtk3_panzoom_sgskip.py
|   |   ├── embedding_in_gtk3_sgskip.py
|   |   ├── embedding_in_gtk4_panzoom_sgskip.py
|   |   ├── embedding_in_gtk4_sgskip.py
|   |   ├── embedding_in_qt_sgskip.py
|   |   ├── embedding_in_tk_sgskip.py
|   |   ├── embedding_in_wx2_sgskip.py
|   |   ├── embedding_in_wx3_sgskip.py
|   |   ├── embedding_in_wx4_sgskip.py
|   |   ├── embedding_in_wx5_sgskip.py
|   |   ├── embedding_webagg_sgskip.py
|   |   ├── fourier_demo_wx_sgskip.py
|   |   ├── gtk3_spreadsheet_sgskip.py
|   |   ├── gtk4_spreadsheet_sgskip.py
|   |   ├── images
|   |   ├── mathtext_wx_sgskip.py
|   |   ├── mpl_with_glade3_sgskip.py
|   |   ├── mplcvd.py
|   |   ├── pylab_with_gtk3_sgskip.py
|   |   ├── pylab_with_gtk4_sgskip.py
|   |   ├── svg_histogram_sgskip.py
|   |   ├── svg_tooltip_sgskip.py
|   |   ├── toolmanager_sgskip.py
|   |   ├── web_application_server_sgskip.py
|   |   └── wxcursor_demo_sgskip.py
|   ├── userdemo
|   |   ├── README.txt
|   |   ├── anchored_box04.py
|   |   ├── annotate_explain.py
|   |   ├── annotate_simple01.py
|   |   ├── annotate_simple02.py
|   |   ├── annotate_simple03.py
|   |   ├── annotate_simple04.py
|   |   ├── annotate_simple_coord01.py
|   |   ├── annotate_simple_coord02.py
|   |   ├── annotate_simple_coord03.py
|   |   ├── annotate_text_arrow.py
|   |   ├── connect_simple01.py
|   |   ├── connectionstyle_demo.py
|   |   ├── custom_boxstyle01.py
|   |   ├── demo_gridspec01.py
|   |   ├── demo_gridspec03.py
|   |   ├── demo_gridspec06.py
|   |   ├── pgf_fonts.py
|   |   ├── pgf_preamble_sgskip.py
|   |   ├── pgf_texsystem.py
|   |   ├── simple_annotate01.py
|   |   ├── simple_legend01.py
|   |   └── simple_legend02.py
|   └── widgets
|       ├── README.txt
|       ├── annotated_cursor.py
|       ├── buttons.py
|       ├── check_buttons.py
|       ├── cursor.py
|       ├── lasso_selector_demo_sgskip.py
|       ├── menu.py
|       ├── mouse_cursor.py
|       ├── multicursor.py
|       ├── polygon_selector_demo.py
|       ├── polygon_selector_simple.py
|       ├── radio_buttons.py
|       ├── range_slider.py
|       ├── rectangle_selector.py
|       ├── slider_demo.py
|       ├── slider_snap_demo.py
|       ├── span_selector.py
|       └── textbox.py
├── extern
|   ├── agg24-svn
|   |   ├── include
|   |   |   ├── ctrl
|   |   |   ├── platform
|   |   |   |   ├── mac
|   |   |   |   └── win32
|   |   |   └── util
|   |   └── src
|   |       ├── agg_arc.cpp
|   |       ├── agg_arrowhead.cpp
|   |       ├── agg_bezier_arc.cpp
|   |       ├── agg_bspline.cpp
|   |       ├── agg_color_rgba.cpp
|   |       ├── agg_curves.cpp
|   |       ├── agg_embedded_raster_fonts.cpp
|   |       ├── agg_gsv_text.cpp
|   |       ├── agg_image_filters.cpp
|   |       ├── agg_line_aa_basics.cpp
|   |       ├── agg_line_profile_aa.cpp
|   |       ├── agg_rounded_rect.cpp
|   |       ├── agg_sqrt_tables.cpp
|   |       ├── agg_trans_affine.cpp
|   |       ├── agg_trans_double_path.cpp
|   |       ├── agg_trans_single_path.cpp
|   |       ├── agg_trans_warp_magnifier.cpp
|   |       ├── agg_vcgen_bspline.cpp
|   |       ├── agg_vcgen_contour.cpp
|   |       ├── agg_vcgen_dash.cpp
|   |       ├── agg_vcgen_markers_term.cpp
|   |       ├── agg_vcgen_smooth_poly1.cpp
|   |       ├── agg_vcgen_stroke.cpp
|   |       ├── agg_vpgen_clip_polygon.cpp
|   |       ├── agg_vpgen_clip_polyline.cpp
|   |       ├── agg_vpgen_segmentator.cpp
|   |       ├── ctrl
|   |       |   ├── agg_bezier_ctrl.cpp
|   |       |   ├── agg_cbox_ctrl.cpp
|   |       |   ├── agg_gamma_ctrl.cpp
|   |       |   ├── agg_gamma_spline.cpp
|   |       |   ├── agg_polygon_ctrl.cpp
|   |       |   ├── agg_rbox_ctrl.cpp
|   |       |   ├── agg_scale_ctrl.cpp
|   |       |   ├── agg_slider_ctrl.cpp
|   |       |   └── agg_spline_ctrl.cpp
|   |       └── platform
|   |           ├── AmigaOS
|   |           ├── BeOS
|   |           ├── X11
|   |           ├── mac
|   |           ├── sdl
|   |           └── win32
|   └── ttconv
|       ├── pprdrv_tt.cpp
|       ├── pprdrv_tt2.cpp
|       └── ttutil.cpp
├── lib
|   ├── matplotlib
|   |   ├── __init__.py
|   |   ├── _afm.py
|   |   ├── _animation_data.py
|   |   ├── _api
|   |   |   ├── __init__.py
|   |   |   └── deprecation.py
|   |   ├── _blocking_input.py
|   |   ├── _cm.py
|   |   ├── _cm_listed.py
|   |   ├── _color_data.py
|   |   ├── _constrained_layout.py
|   |   ├── _docstring.py
|   |   ├── _enums.py
|   |   ├── _fontconfig_pattern.py
|   |   ├── _internal_utils.py
|   |   ├── _layoutgrid.py
|   |   ├── _mathtext.py
|   |   ├── _mathtext_data.py
|   |   ├── _pylab_helpers.py
|   |   ├── _text_helpers.py
|   |   ├── _tight_bbox.py
|   |   ├── _tight_layout.py
|   |   ├── _type1font.py
|   |   ├── animation.py
|   |   ├── artist.py
|   |   ├── axes
|   |   |   ├── __init__.py
|   |   |   ├── _axes.py
|   |   |   ├── _base.py
|   |   |   └── _secondary_axes.py
|   |   ├── axis.py
|   |   ├── backend_bases.py
|   |   ├── backend_managers.py
|   |   ├── backend_tools.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── _backend_gtk.py
|   |   |   ├── _backend_pdf_ps.py
|   |   |   ├── _backend_tk.py
|   |   |   ├── backend_agg.py
|   |   |   ├── backend_cairo.py
|   |   |   ├── backend_gtk3.py
|   |   |   ├── backend_gtk3agg.py
|   |   |   ├── backend_gtk3cairo.py
|   |   |   ├── backend_gtk4.py
|   |   |   ├── backend_gtk4agg.py
|   |   |   ├── backend_gtk4cairo.py
|   |   |   ├── backend_macosx.py
|   |   |   ├── backend_mixed.py
|   |   |   ├── backend_nbagg.py
|   |   |   ├── backend_pdf.py
|   |   |   ├── backend_pgf.py
|   |   |   ├── backend_ps.py
|   |   |   ├── backend_qt.py
|   |   |   ├── backend_qt5.py
|   |   |   ├── backend_qt5agg.py
|   |   |   ├── backend_qt5cairo.py
|   |   |   ├── backend_qtagg.py
|   |   |   ├── backend_qtcairo.py
|   |   |   ├── backend_svg.py
|   |   |   ├── backend_template.py
|   |   |   ├── backend_tkagg.py
|   |   |   ├── backend_tkcairo.py
|   |   |   ├── backend_webagg.py
|   |   |   ├── backend_webagg_core.py
|   |   |   ├── backend_wx.py
|   |   |   ├── backend_wxagg.py
|   |   |   ├── backend_wxcairo.py
|   |   |   ├── qt_compat.py
|   |   |   ├── qt_editor
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _formlayout.py
|   |   |   |   └── figureoptions.py
|   |   |   └── web_backend
|   |   |       ├── .eslintrc.js
|   |   |       ├── all_figures.html
|   |   |       ├── css
|   |   |       ├── ipython_inline_figure.html
|   |   |       ├── js
|   |   |       └── single_figure.html
|   |   ├── bezier.py
|   |   ├── category.py
|   |   ├── cbook.py
|   |   ├── cm.py
|   |   ├── collections.py
|   |   ├── colorbar.py
|   |   ├── colors.py
|   |   ├── container.py
|   |   ├── contour.py
|   |   ├── dates.py
|   |   ├── dviread.py
|   |   ├── figure.py
|   |   ├── font_manager.py
|   |   ├── gridspec.py
|   |   ├── hatch.py
|   |   ├── image.py
|   |   ├── layout_engine.py
|   |   ├── legend.py
|   |   ├── legend_handler.py
|   |   ├── lines.py
|   |   ├── markers.py
|   |   ├── mathtext.py
|   |   ├── mlab.py
|   |   ├── mpl-data
|   |   |   ├── fonts
|   |   |   |   ├── afm
|   |   |   |   ├── pdfcorefonts
|   |   |   |   └── ttf
|   |   |   ├── images
|   |   |   ├── plot_directive
|   |   |   |   └── plot_directive.css
|   |   |   ├── sample_data
|   |   |   |   ├── README.txt
|   |   |   |   └── axes_grid
|   |   |   └── stylelib
|   |   ├── offsetbox.py
|   |   ├── patches.py
|   |   ├── path.py
|   |   ├── patheffects.py
|   |   ├── projections
|   |   |   ├── __init__.py
|   |   |   ├── geo.py
|   |   |   └── polar.py
|   |   ├── pylab.py
|   |   ├── pyplot.py
|   |   ├── quiver.py
|   |   ├── rcsetup.py
|   |   ├── sankey.py
|   |   ├── scale.py
|   |   ├── sphinxext
|   |   |   ├── __init__.py
|   |   |   ├── mathmpl.py
|   |   |   └── plot_directive.py
|   |   ├── spines.py
|   |   ├── stackplot.py
|   |   ├── streamplot.py
|   |   ├── style
|   |   |   ├── __init__.py
|   |   |   └── core.py
|   |   ├── table.py
|   |   ├── testing
|   |   |   ├── __init__.py
|   |   |   ├── _markers.py
|   |   |   ├── compare.py
|   |   |   ├── conftest.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── jpl_units
|   |   |   |   ├── Duration.py
|   |   |   |   ├── Epoch.py
|   |   |   |   ├── EpochConverter.py
|   |   |   |   ├── StrConverter.py
|   |   |   |   ├── UnitDbl.py
|   |   |   |   ├── UnitDblConverter.py
|   |   |   |   ├── UnitDblFormatter.py
|   |   |   |   └── __init__.py
|   |   |   └── widgets.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── baseline_images
|   |   |   |   ├── dviread
|   |   |   |   ├── pngsuite
|   |   |   |   ├── test_agg
|   |   |   |   ├── test_agg_filter
|   |   |   |   ├── test_arrow_patches
|   |   |   |   ├── test_artist
|   |   |   |   ├── test_axes
|   |   |   |   ├── test_backend_pdf
|   |   |   |   ├── test_backend_pgf
|   |   |   |   ├── test_backend_ps
|   |   |   |   ├── test_backend_svg
|   |   |   |   ├── test_bbox_tight
|   |   |   |   ├── test_collections
|   |   |   |   ├── test_colorbar
|   |   |   |   ├── test_colors
|   |   |   |   ├── test_compare_images
|   |   |   |   ├── test_constrainedlayout
|   |   |   |   ├── test_contour
|   |   |   |   ├── test_dates
|   |   |   |   ├── test_figure
|   |   |   |   ├── test_image
|   |   |   |   ├── test_legend
|   |   |   |   ├── test_lines
|   |   |   |   ├── test_mathtext
|   |   |   |   ├── test_offsetbox
|   |   |   |   ├── test_patches
|   |   |   |   ├── test_path
|   |   |   |   ├── test_patheffects
|   |   |   |   ├── test_png
|   |   |   |   ├── test_polar
|   |   |   |   ├── test_quiver
|   |   |   |   ├── test_scale
|   |   |   |   ├── test_simplification
|   |   |   |   ├── test_skew
|   |   |   |   ├── test_spines
|   |   |   |   ├── test_streamplot
|   |   |   |   ├── test_subplots
|   |   |   |   ├── test_table
|   |   |   |   ├── test_text
|   |   |   |   ├── test_tightlayout
|   |   |   |   ├── test_transforms
|   |   |   |   ├── test_triangulation
|   |   |   |   ├── test_ttconv
|   |   |   |   ├── test_units
|   |   |   |   ├── test_usetex
|   |   |   |   └── test_widgets
|   |   |   ├── conftest.py
|   |   |   ├── test_afm.py
|   |   |   ├── test_agg.py
|   |   |   ├── test_agg_filter.py
|   |   |   ├── test_animation.py
|   |   |   ├── test_api.py
|   |   |   ├── test_arrow_patches.py
|   |   |   ├── test_artist.py
|   |   |   ├── test_axes.py
|   |   |   ├── test_backend_bases.py
|   |   |   ├── test_backend_cairo.py
|   |   |   ├── test_backend_gtk3.py
|   |   |   ├── test_backend_macosx.py
|   |   |   ├── test_backend_nbagg.py
|   |   |   ├── test_backend_pdf.py
|   |   |   ├── test_backend_pgf.py
|   |   |   ├── test_backend_ps.py
|   |   |   ├── test_backend_qt.py
|   |   |   ├── test_backend_svg.py
|   |   |   ├── test_backend_template.py
|   |   |   ├── test_backend_tk.py
|   |   |   ├── test_backend_tools.py
|   |   |   ├── test_backend_webagg.py
|   |   |   ├── test_backends_interactive.py
|   |   |   ├── test_basic.py
|   |   |   ├── test_bbox_tight.py
|   |   |   ├── test_category.py
|   |   |   ├── test_cbook.py
|   |   |   ├── test_collections.py
|   |   |   ├── test_colorbar.py
|   |   |   ├── test_colors.py
|   |   |   ├── test_compare_images.py
|   |   |   ├── test_constrainedlayout.py
|   |   |   ├── test_container.py
|   |   |   ├── test_contour.py
|   |   |   ├── test_cycles.py
|   |   |   ├── test_dates.py
|   |   |   ├── test_determinism.py
|   |   |   ├── test_doc.py
|   |   |   ├── test_dviread.py
|   |   |   ├── test_figure.py
|   |   |   ├── test_font_manager.py
|   |   |   ├── test_fontconfig_pattern.py
|   |   |   ├── test_ft2font.py
|   |   |   ├── test_getattr.py
|   |   |   ├── test_gridspec.py
|   |   |   ├── test_image.py
|   |   |   ├── test_legend.py
|   |   |   ├── test_lines.py
|   |   |   ├── test_marker.py
|   |   |   ├── test_mathtext.py
|   |   |   ├── test_matplotlib.py
|   |   |   ├── test_mlab.py
|   |   |   ├── test_offsetbox.py
|   |   |   ├── test_patches.py
|   |   |   ├── test_path.py
|   |   |   ├── test_patheffects.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_png.py
|   |   |   ├── test_polar.py
|   |   |   ├── test_preprocess_data.py
|   |   |   ├── test_pyplot.py
|   |   |   ├── test_quiver.py
|   |   |   ├── test_rcparams.py
|   |   |   ├── test_sankey.py
|   |   |   ├── test_scale.py
|   |   |   ├── test_simplification.py
|   |   |   ├── test_skew.py
|   |   |   ├── test_sphinxext.py
|   |   |   ├── test_spines.py
|   |   |   ├── test_streamplot.py
|   |   |   ├── test_style.py
|   |   |   ├── test_subplots.py
|   |   |   ├── test_table.py
|   |   |   ├── test_testing.py
|   |   |   ├── test_texmanager.py
|   |   |   ├── test_text.py
|   |   |   ├── test_textpath.py
|   |   |   ├── test_ticker.py
|   |   |   ├── test_tightlayout.py
|   |   |   ├── test_transforms.py
|   |   |   ├── test_triangulation.py
|   |   |   ├── test_ttconv.py
|   |   |   ├── test_type1font.py
|   |   |   ├── test_units.py
|   |   |   ├── test_usetex.py
|   |   |   ├── test_widgets.py
|   |   |   └── tinypages
|   |   |       ├── README.md
|   |   |       ├── _static
|   |   |       ├── conf.py
|   |   |       ├── included_plot_21.rst
|   |   |       ├── index.rst
|   |   |       ├── range4.py
|   |   |       ├── range6.py
|   |   |       └── some_plots.rst
|   |   ├── texmanager.py
|   |   ├── text.py
|   |   ├── textpath.py
|   |   ├── ticker.py
|   |   ├── transforms.py
|   |   ├── tri
|   |   |   ├── __init__.py
|   |   |   ├── _triangulation.py
|   |   |   ├── _tricontour.py
|   |   |   ├── _trifinder.py
|   |   |   ├── _triinterpolate.py
|   |   |   ├── _tripcolor.py
|   |   |   ├── _triplot.py
|   |   |   ├── _trirefine.py
|   |   |   ├── _tritools.py
|   |   |   ├── triangulation.py
|   |   |   ├── tricontour.py
|   |   |   ├── trifinder.py
|   |   |   ├── triinterpolate.py
|   |   |   ├── tripcolor.py
|   |   |   ├── triplot.py
|   |   |   ├── trirefine.py
|   |   |   └── tritools.py
|   |   ├── units.py
|   |   └── widgets.py
|   ├── mpl_toolkits
|   |   ├── __init__.py
|   |   ├── axes_grid1
|   |   |   ├── __init__.py
|   |   |   ├── anchored_artists.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axes_size.py
|   |   |   ├── inset_locator.py
|   |   |   ├── mpl_axes.py
|   |   |   ├── parasite_axes.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── baseline_images
|   |   |       ├── conftest.py
|   |   |       └── test_axes_grid1.py
|   |   ├── axisartist
|   |   |   ├── __init__.py
|   |   |   ├── angle_helper.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axis_artist.py
|   |   |   ├── axisline_style.py
|   |   |   ├── axislines.py
|   |   |   ├── floating_axes.py
|   |   |   ├── grid_finder.py
|   |   |   ├── grid_helper_curvelinear.py
|   |   |   ├── parasite_axes.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── baseline_images
|   |   |       ├── conftest.py
|   |   |       ├── test_angle_helper.py
|   |   |       ├── test_axis_artist.py
|   |   |       ├── test_axislines.py
|   |   |       ├── test_floating_axes.py
|   |   |       ├── test_grid_finder.py
|   |   |       └── test_grid_helper_curvelinear.py
|   |   └── mplot3d
|   |       ├── __init__.py
|   |       ├── art3d.py
|   |       ├── axes3d.py
|   |       ├── axis3d.py
|   |       ├── proj3d.py
|   |       └── tests
|   |           ├── __init__.py
|   |           ├── baseline_images
|   |           ├── conftest.py
|   |           ├── test_art3d.py
|   |           ├── test_axes3d.py
|   |           └── test_legend3d.py
|   └── pylab.py
├── plot_types
|   ├── 3D
|   |   ├── README.rst
|   |   ├── scatter3d_simple.py
|   |   ├── surface3d_simple.py
|   |   ├── trisurf3d_simple.py
|   |   ├── voxels_simple.py
|   |   └── wire3d_simple.py
|   ├── README.rst
|   ├── arrays
|   |   ├── README.rst
|   |   ├── barbs.py
|   |   ├── contour.py
|   |   ├── contourf.py
|   |   ├── imshow.py
|   |   ├── pcolormesh.py
|   |   ├── quiver.py
|   |   └── streamplot.py
|   ├── basic
|   |   ├── README.rst
|   |   ├── bar.py
|   |   ├── fill_between.py
|   |   ├── plot.py
|   |   ├── scatter_plot.py
|   |   ├── stackplot.py
|   |   ├── stem.py
|   |   └── step.py
|   ├── stats
|   |   ├── README.rst
|   |   ├── boxplot_plot.py
|   |   ├── errorbar_plot.py
|   |   ├── eventplot.py
|   |   ├── hexbin.py
|   |   ├── hist2d.py
|   |   ├── hist_plot.py
|   |   ├── pie.py
|   |   └── violin.py
|   └── unstructured
|       ├── README.rst
|       ├── tricontour.py
|       ├── tricontourf.py
|       ├── tripcolor.py
|       └── triplot.py
├── requirements
|   ├── dev
|   |   └── dev-requirements.txt
|   ├── doc
|   |   └── doc-requirements.txt
|   └── testing
|       ├── all.txt
|       ├── extra.txt
|       ├── flake8.txt
|       └── minver.txt
├── setup.py
├── setupext.py
├── src
|   ├── _backend_agg.cpp
|   ├── _backend_agg_wrapper.cpp
|   ├── _c_internal_utils.c
|   ├── _image_wrapper.cpp
|   ├── _path_wrapper.cpp
|   ├── _qhull_wrapper.cpp
|   ├── _tkagg.cpp
|   ├── _ttconv.cpp
|   ├── checkdep_freetype2.c
|   ├── doc
|   ├── ft2font.cpp
|   ├── ft2font_wrapper.cpp
|   ├── py_converters.cpp
|   └── tri
|       ├── _tri.cpp
|       └── _tri_wrapper.cpp
├── tools
|   ├── README.txt
|   ├── boilerplate.py
|   ├── cache_zenodo_svg.py
|   ├── create_DejaVuDisplay.sh
|   ├── embed_js.py
|   ├── gh_api.py
|   ├── github_stats.py
|   ├── make_icons.py
|   ├── memleak.py
|   ├── run_examples.py
|   ├── subset.py
|   ├── triage_tests.py
|   └── visualize_tests.py
└── tutorials
    ├── README.txt
    ├── advanced
    |   ├── README.txt
    |   ├── blitting.py
    |   ├── path_tutorial.py
    |   ├── patheffects_guide.py
    |   └── transforms_tutorial.py
    ├── colors
    |   ├── README.txt
    |   ├── colorbar_only.py
    |   ├── colormap-manipulation.py
    |   ├── colormapnorms.py
    |   ├── colormaps.py
    |   └── colors.py
    ├── intermediate
    |   ├── README.txt
    |   ├── arranging_axes.py
    |   ├── artists.py
    |   ├── autoscale.py
    |   ├── color_cycle.py
    |   ├── constrainedlayout_guide.py
    |   ├── imshow_extent.py
    |   ├── legend_guide.py
    |   └── tight_layout_guide.py
    ├── introductory
    |   ├── README.txt
    |   ├── animation_tutorial.py
    |   ├── customizing.py
    |   ├── images.py
    |   ├── lifecycle.py
    |   ├── pyplot.py
    |   └── quick_start.py
    ├── provisional
    |   └── README.txt
    ├── text
    |   ├── README.txt
    |   ├── annotations.py
    |   ├── mathtext.py
    |   ├── pgf.py
    |   ├── text_intro.py
    |   ├── text_props.py
    |   └── usetex.py
    └── toolkits
        ├── README.txt
        ├── axes_grid.py
        ├── axisartist.py
        └── mplot3d.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: [Bug]: Windows correction is not correct in `mlab._spectral_helper`

Description: ### Bug summary

Windows correction is not correct in `mlab._spectral_helper`:
https://github.com/matplotlib/matplotlib/blob/3418bada1c1f44da1f73916c5603e3ae79fe58c1/lib/matplotlib/mlab.py#L423-L430

The `np.abs` is not needed, and give wrong result for window with negative value, such as `flattop`.
For reference, the implementation of scipy can be found here :
https://github.com/scipy/scipy/blob/d9f75db82fdffef06187c9d8d2f0f5b36c7a791b/scipy/signal/_spectral_py.py#L1854-L1859

### Code for reproduction

```python
import numpy as np
from scipy import signal
window = signal.windows.flattop(512)
print(np.abs(window).sum()**2-window.sum()**2)
```


### Actual outcome

4372.942556173262

### Expected outcome

0

### Additional information

_No response_

### Operating system

_No response_

### Matplotlib Version

latest

### Matplotlib Backend

_No response_

### Python version

_No response_

### Jupyter version

_No response_

### Installation

None

Patch information:
diff --git a/lib/matplotlib/mlab.py b/lib/matplotlib/mlab.py
index 3552904c3d..efa2f84cae 100644
--- a/lib/matplotlib/mlab.py
+++ b/lib/matplotlib/mlab.py
@@ -395,12 +395,12 @@ def _spectral_helper(x, y=None, NFFT=None, Fs=None, detrend_func=None,
     elif mode == 'psd':
         result = np.conj(result) * result
     elif mode == 'magnitude':
-        result = np.abs(result) / np.abs(window).sum()
+        result = np.abs(result) / window.sum()
     elif mode == 'angle' or mode == 'phase':
         # we unwrap the phase later to handle the onesided vs. twosided case
         result = np.angle(result)
     elif mode == 'complex':
-        result /= np.abs(window).sum()
+        result /= window.sum()
 
     if mode == 'psd':
 
@@ -424,10 +424,10 @@ def _spectral_helper(x, y=None, NFFT=None, Fs=None, detrend_func=None,
             result /= Fs
             # Scale the spectrum by the norm of the window to compensate for
             # windowing loss; see Bendat & Piersol Sec 11.5.2.
-            result /= (np.abs(window)**2).sum()
+            result /= (window**2).sum()
         else:
             # In this case, preserve power in the segment, not amplitude
-            result /= np.abs(window).sum()**2
+            result /= window.sum()**2
 
     t = np.arange(NFFT/2, len(x) - NFFT/2 + 1, NFFT - noverlap)/Fs
 


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 03:19:12,632 - thread-129519985886912.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find relevant test cases for a bug in `mlab._spectral_helper`. The bug is related to incorrect window correction in spectral analysis functions. The most relevant tests for this functionality are expected to be in `lib/matplotlib/tests/test_mlab.py`. The current context is empty, so I need to retrieve this file to analyze its contents and identify suitable test cases.' query='Please provide the full content of lib/matplotlib/tests/test_mlab.py' extra_requirements='' purpose='I need to analyze the tests in this file to find 3 test cases that are relevant to the spectral analysis functionality and window correction bug described in the user query.'
2025-12-21 03:19:12,633 - thread-129519985886912.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of lib/matplotlib/tests/test_mlab.py
2025-12-21 03:19:12,634 - thread-129519985886912.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-21 03:19:12,634 - thread-129519985886912.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-21 03:19:12,635 - thread-129519985886912.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-21 03:19:12,635 - thread-129519985886912.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of lib/matplotlib/tests/test_mlab.py
Purpose: I need to analyze the tests in this file to find 3 test cases that are relevant to the spectral analysis functionality and window correction bug described in the user query.
2025-12-21 03:19:15,562 - thread-129519985886912.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_mlab.py"}'}, '__gemini_function_call_thought_signatures__': {'d8242a33-9d13-4291-a1c8-d02cdf212aa4': 'Cv4GAY89a1/8bEgPIkAFbE1HZJRl6x7dPUvNdpYdFS96Y49XVoHUbncdD23GbmnlQ5fJss0md+WmQiMJLZaANkslcwfYz73DYWaVsf5aaKjkA5TUob0LmnCZDvqyCVTGGLL1Z+2i2c7m38qYJo6MH+X4lN+wZVIN0JOvdzG8JNR1IGhWnas0+q1ykNBuUM5Tg8rR0YD3DwqXoK9JHzbh2mrZEztfByVJJ9UJMbrZbv3Ppm4OhEUoZHPo+DMwNV1vGSQ+z5gv9jy3SwrkQ83d8HWAh3X524v+gfCHPS36URta0slh+YLnLJMGnF881ewK4KG2HRLfHqfLXVWrqpofiN2bDEMluF/giZcko8UwKWxKF/ETQCNxgTHwNqqVN51Sv7R0ZS0uVeumagYg9Cv/cGcl3X4vIyDdV/LoWeY+nUsp/SVcBWCC93cTq32yR6XnNJxDWzt+VBmjk66XE+7luzV8FkYQb1q1vmJ+Ld2dkJB/5o493P84RC9x6e7qw7nwxsybOKz5eIUAlGtkq/+n+sGM+gZwZfA3XxaqItWAldHeHKiaRAOICB0axzMaq9PDgy49zUi4tvN4n4/szYNRhr26olUP6Y2nvj2lyl1zcSw7rMLBwsT7qdFj3/IvDdija0HkvFkXMHKB0ctPs33veRi6Wg0RyoOGCmCW3kR2HOkGiOqXkTdpI5uz3ov195s+R/C/kQBYe3PoxkH6qTWyB9M+jKHHUNwlooZ4kg7KDKEhkVlQluf3nmpv1GTWMZD4hEqphCbLdlI49n3czlhfIxSv0UEoFLxpPhQb43L0vgIug62j4wrKSp8puJwRq4Sqib37iiTUcxUAzEsk3Q4cdG00qdyXzqufeLbyFO49N2uDQKJ4s+OTEGn+1il77DxRbHMBBFAI61e4K+2vpNUZpEQWygyimMTpbR6pHg2jhWmb5sOms4zDhrci3K3GbloRkm6LtQE02RTM/kUDkV0zp2nvRcz98ZSACC90oVeSh/vVWH0RLSWTmaCGHch1ycGaZd2afMwirwPxC2vEoFLocQGOuAezSM9XX2xZvC19TBM/bPa/Ftu8OJZXP/DdZTJSnqQ+OcYA+vb/eQoMwNbz7tQ+NeWBi7pr7M0e/Y+4cIAqfb0SuvrikdPXJvumMDwiNxbigTIEPnV2/AZN5y8Ax32tnPVl+q3LHu+oyfT4OKXL'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2139, 'candidates_token_count': 26, 'total_token_count': 2384, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2139}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 26}], 'thoughts_token_count': 219, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.40987194501436675, 'model_name': 'gemini-2.5-pro'} id='run--6b229dae-4e9e-45b0-9301-f2992139d06d-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'lib/matplotlib/tests/test_mlab.py'}, 'id': 'd8242a33-9d13-4291-a1c8-d02cdf212aa4', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2139, 'output_tokens': 26, 'total_tokens': 2384, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 219}}
2025-12-21 03:19:18,233 - thread-129519985886912.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_mlab.py", "end_line": 1000.0, "start_line": 501.0}'}, '__gemini_function_call_thought_signatures__': {'de74b6e6-bcdd-4211-8e03-6b2cca210705': 'CtsDAY89a19+ATMdY83k9qrOlDHL4qyFI4sfzOEkbi8CV3wmA+zZOBEbNn4biPMmwwybFY5yZvokb9UhbG8PZobABLACeCZoGdGOHkhUy5n4/R/lQKbcgevDgiv5kb32ByUNHrxfURZlzIcNkchmkfiU5iPgvqndi2i8UPPsURQva1Joinv7GhkEOKcrA2c0tYQfiY7DaLcIrJYC7PgebiRlqV3g7b3xVmDFu/REmrGSK800XHUIoyYANKmhv5yjEyo3qtbhWPptA4XHLJFwsMWZdQMAzdYFrofPVaO8WXc9fdgXS/0eLaXkU7cWxMzSenNNfp88MS1RDSMW91NjOxU7tMTFZ9QImxuOfsYDnFG/ZYsS9yWYimArpASro64fdOSJE0GnIibuF5LgDQ8vJlEd4F8thQbZU3U/Fbcj9R1MXa19QvuE7WGa41c0FOql5sjLPK+3ymD6mhj0R7kgcmN19WnHE0ehlFn9b8My3T6PJx1EEGkQ4cdBJMVwDvdSFNAl/XDYNlr49Y3IpPs3zYKc2fu83cox+GUYyC6wB7WrF5LV0JKMxITDgMY2SSrCXe7ijfuoo2tSEBbmC09RR5c+odjToZ4nuhu41jfxWl9U0W+ePQC7RpH1fI7NDA=='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 10888, 'candidates_token_count': 32, 'total_token_count': 11066, 'cached_content_token_count': 1876, 'prompt_tokens_details': [{'modality': 1, 'token_count': 11107}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1876}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 32}], 'thoughts_token_count': 146}, 'finish_reason': 'STOP', 'avg_logprobs': -0.35778379440307617, 'model_name': 'gemini-2.5-pro'} id='run--e241b129-ab99-463a-8e3d-1e9227214ab0-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'lib/matplotlib/tests/test_mlab.py', 'end_line': 1000.0, 'start_line': 501.0}, 'id': 'de74b6e6-bcdd-4211-8e03-6b2cca210705', 'type': 'tool_call'}] usage_metadata={'input_tokens': 10888, 'output_tokens': 32, 'total_tokens': 11066, 'input_token_details': {'cache_read': 1876}, 'output_token_details': {'reasoning': 146}}
2025-12-21 03:19:21,289 - thread-129519985886912.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_mlab.py", "end_line": 2000.0, "start_line": 1001.0}'}, '__gemini_function_call_thought_signatures__': {'10f56844-57e6-45d1-955d-b0e32d57d223': 'CpkEAY89a1//ezRmcp6EWfoQHdeUXN9HNnzp2bSXzw0V+530K45kqE+M4lomfDruYIuUgPdpVSWgkMtWo2BjxeP9WFVjnZALtpXMVY6SxkGBASY47VAGszhB3RQBTsJaWgVFS7CunNBKQK6B/ahVKPxhKOI5g7LIwUGRnF61+Xl5EKgzhYXtYc1V0dcd/2CFO6lfEBOJzvLWh3eVbgGO54ddaOkrtQtYPsSS9j5hR9QM+Ry6RMeYo1FY9oWSWstuwh4CMIgyrYxH1q/NAbVhU5LGQX3PvC6iu3evFuYaBQxpyj+lNp0Mv0kzfWiZg1o+c0uTkCHOi1XdszMIp8lD8caN5dgtDTkcQGGrljLFbC3/vCqpPMz4ImEXVuPKGSX+DbA/6xKYK6wS+ij1Z2qK+SkxGd3doUczdngLteEXbcYZR+PrIHYfix7sdylOsWWwlIrHPAbXVa2c835HTJsAl/ZWt+aCNPvn5DPGhCNa8PlDK5TJYNTWXFHo66l9qie8tqAnjgsMzZRpAO0hC6o7IplY0w1ahqNvZ2svHwZWMM81I5jJrwe7BrQ54HtsmryJtzXPCl/3NhgXFYA0lWgYFOws9Ns/h/KHHuxB6q5nVgjF6mRlKcSTtmlO+v8QbuL4otQyeTKFFS50rDEuPpVk+DT8HybbcWrrDRZSJHMSFoyHbUb+kmLcbNgAvhkgVvFWvyblJ79Z1T1y+jAp'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 19943, 'candidates_token_count': 32, 'total_token_count': 20148, 'cached_content_token_count': 9646, 'prompt_tokens_details': [{'modality': 1, 'token_count': 20308}], 'cache_tokens_details': [{'modality': 1, 'token_count': 9646}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 32}], 'thoughts_token_count': 173}, 'finish_reason': 'STOP', 'avg_logprobs': -0.06125905364751816, 'model_name': 'gemini-2.5-pro'} id='run--389bc5d1-d7ad-485e-bc74-900982a3f043-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'lib/matplotlib/tests/test_mlab.py', 'end_line': 2000.0, 'start_line': 1001.0}, 'id': '10f56844-57e6-45d1-955d-b0e32d57d223', 'type': 'tool_call'}] usage_metadata={'input_tokens': 19943, 'output_tokens': 32, 'total_tokens': 20148, 'input_token_details': {'cache_read': 9646}, 'output_token_details': {'reasoning': 173}}
2025-12-21 03:19:26,010 - thread-129519985886912.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have successfully retrieved the entire content of the file `lib/matplotlib/tests/test_mlab.py` for you. Initially, I read the first 500 lines, and then I fetched the rest of the file in two subsequent chunks to ensure you have the complete code. You can now proceed with your analysis of the test cases related to spectral analysis and window correction.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 21625, 'candidates_token_count': 79, 'total_token_count': 22038, 'cached_content_token_count': 19317, 'prompt_tokens_details': [{'modality': 1, 'token_count': 22163}], 'cache_tokens_details': [{'modality': 1, 'token_count': 19317}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 79}], 'thoughts_token_count': 334}, 'finish_reason': 'STOP', 'avg_logprobs': -0.6350836452049545, 'model_name': 'gemini-2.5-pro'} id='run--c5166801-4284-4743-b5c9-9835acda922e-0' usage_metadata={'input_tokens': 21625, 'output_tokens': 79, 'total_tokens': 22038, 'input_token_details': {'cache_read': 19317}, 'output_token_details': {'reasoning': 334}}
2025-12-21 03:19:26,012 - thread-129519985886912.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of lib/matplotlib/tests/test_mlab.py
--- END QUERY ---



--- BEGIN PURPOSE ---
I need to analyze the tests in this file to find 3 test cases that are relevant to the spectral analysis functionality and window correction bug described in the user query.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: lib/matplotlib/tests/test_mlab.py
Line number range: 1 - 500
Content:
1. from numpy.testing import (assert_allclose, assert_almost_equal,
2.                            assert_array_equal, assert_array_almost_equal_nulp)
3. import numpy as np
4. import pytest
5. 
6. from matplotlib import mlab, _api
7. 
8. 
9. class TestStride:
10.     def get_base(self, x):
11.         y = x
12.         while y.base is not None:
13.             y = y.base
14.         return y
15. 
16.     @pytest.fixture(autouse=True)
17.     def stride_is_deprecated(self):
18.         with _api.suppress_matplotlib_deprecation_warning():
19.             yield
20. 
21.     def calc_window_target(self, x, NFFT, noverlap=0, axis=0):
22.         """
23.         This is an adaptation of the original window extraction algorithm.
24.         This is here to test to make sure the new implementation has the same
25.         result.
26.         """
27.         step = NFFT - noverlap
28.         ind = np.arange(0, len(x) - NFFT + 1, step)
29.         n = len(ind)
30.         result = np.zeros((NFFT, n))
31. 
32.         # do the ffts of the slices
33.         for i in range(n):
34.             result[:, i] = x[ind[i]:ind[i]+NFFT]
35.         if axis == 1:
36.             result = result.T
37.         return result
38. 
39.     @pytest.mark.parametrize('shape', [(), (10, 1)], ids=['0D', '2D'])
40.     def test_stride_windows_invalid_input_shape(self, shape):
41.         x = np.arange(np.prod(shape)).reshape(shape)
42.         with pytest.raises(ValueError):
43.             mlab.stride_windows(x, 5)
44. 
45.     @pytest.mark.parametrize('n, noverlap',
46.                              [(0, None), (11, None), (2, 2), (2, 3)],
47.                              ids=['n less than 1', 'n greater than input',
48.                                   'noverlap greater than n',
49.                                   'noverlap equal to n'])
50.     def test_stride_windows_invalid_params(self, n, noverlap):
51.         x = np.arange(10)
52.         with pytest.raises(ValueError):
53.             mlab.stride_windows(x, n, noverlap)
54. 
55.     @pytest.mark.parametrize('axis', [0, 1], ids=['axis0', 'axis1'])
56.     @pytest.mark.parametrize('n, noverlap',
57.                              [(1, 0), (5, 0), (15, 2), (13, -3)],
58.                              ids=['n1-noverlap0', 'n5-noverlap0',
59.                                   'n15-noverlap2', 'n13-noverlapn3'])
60.     def test_stride_windows(self, n, noverlap, axis):
61.         x = np.arange(100)
62.         y = mlab.stride_windows(x, n, noverlap=noverlap, axis=axis)
63. 
64.         expected_shape = [0, 0]
65.         expected_shape[axis] = n
66.         expected_shape[1 - axis] = 100 // (n - noverlap)
67.         yt = self.calc_window_target(x, n, noverlap=noverlap, axis=axis)
68. 
69.         assert yt.shape == y.shape
70.         assert_array_equal(yt, y)
71.         assert tuple(expected_shape) == y.shape
72.         assert self.get_base(y) is x
73. 
74.     @pytest.mark.parametrize('axis', [0, 1], ids=['axis0', 'axis1'])
75.     def test_stride_windows_n32_noverlap0_unflatten(self, axis):
76.         n = 32
77.         x = np.arange(n)[np.newaxis]
78.         x1 = np.tile(x, (21, 1))
79.         x2 = x1.flatten()
80.         y = mlab.stride_windows(x2, n, axis=axis)
81. 
82.         if axis == 0:
83.             x1 = x1.T
84.         assert y.shape == x1.shape
85.         assert_array_equal(y, x1)
86. 
87. 
88. def test_window():
89.     np.random.seed(0)
90.     n = 1000
91.     rand = np.random.standard_normal(n) + 100
92.     ones = np.ones(n)
93.     assert_array_equal(mlab.window_none(ones), ones)
94.     assert_array_equal(mlab.window_none(rand), rand)
95.     assert_array_equal(np.hanning(len(rand)) * rand, mlab.window_hanning(rand))
96.     assert_array_equal(np.hanning(len(ones)), mlab.window_hanning(ones))
97. 
98. 
99. class TestDetrend:
100.     def setup_method(self):
101.         np.random.seed(0)
102.         n = 1000
103.         x = np.linspace(0., 100, n)
104. 
105.         self.sig_zeros = np.zeros(n)
106. 
107.         self.sig_off = self.sig_zeros + 100.
108.         self.sig_slope = np.linspace(-10., 90., n)
109.         self.sig_slope_mean = x - x.mean()
110. 
111.         self.sig_base = (
112.             np.random.standard_normal(n) + np.sin(x*2*np.pi/(n/100)))
113.         self.sig_base -= self.sig_base.mean()
114. 
115.     def allclose(self, *args):
116.         assert_allclose(*args, atol=1e-8)
117. 
118.     def test_detrend_none(self):
119.         assert mlab.detrend_none(0.) == 0.
120.         assert mlab.detrend_none(0., axis=1) == 0.
121.         assert mlab.detrend(0., key="none") == 0.
122.         assert mlab.detrend(0., key=mlab.detrend_none) == 0.
123.         for sig in [
124.                 5.5, self.sig_off, self.sig_slope, self.sig_base,
125.                 (self.sig_base + self.sig_slope + self.sig_off).tolist(),
126.                 np.vstack([self.sig_base,  # 2D case.
127.                            self.sig_base + self.sig_off,
128.                            self.sig_base + self.sig_slope,
129.                            self.sig_base + self.sig_off + self.sig_slope]),
130.                 np.vstack([self.sig_base,  # 2D transposed case.
131.                            self.sig_base + self.sig_off,
132.                            self.sig_base + self.sig_slope,
133.                            self.sig_base + self.sig_off + self.sig_slope]).T,
134.         ]:
135.             if isinstance(sig, np.ndarray):
136.                 assert_array_equal(mlab.detrend_none(sig), sig)
137.             else:
138.                 assert mlab.detrend_none(sig) == sig
139. 
140.     def test_detrend_mean(self):
141.         for sig in [0., 5.5]:  # 0D.
142.             assert mlab.detrend_mean(sig) == 0.
143.             assert mlab.detrend(sig, key="mean") == 0.
144.             assert mlab.detrend(sig, key=mlab.detrend_mean) == 0.
145.         # 1D.
146.         self.allclose(mlab.detrend_mean(self.sig_zeros), self.sig_zeros)
147.         self.allclose(mlab.detrend_mean(self.sig_base), self.sig_base)
148.         self.allclose(mlab.detrend_mean(self.sig_base + self.sig_off),
149.                       self.sig_base)
150.         self.allclose(mlab.detrend_mean(self.sig_base + self.sig_slope),
151.                       self.sig_base + self.sig_slope_mean)
152.         self.allclose(
153.             mlab.detrend_mean(self.sig_base + self.sig_slope + self.sig_off),
154.             self.sig_base + self.sig_slope_mean)
155. 
156.     def test_detrend_mean_1d_base_slope_off_list_andor_axis0(self):
157.         input = self.sig_base + self.sig_slope + self.sig_off
158.         target = self.sig_base + self.sig_slope_mean
159.         self.allclose(mlab.detrend_mean(input, axis=0), target)
160.         self.allclose(mlab.detrend_mean(input.tolist()), target)
161.         self.allclose(mlab.detrend_mean(input.tolist(), axis=0), target)
162. 
163.     def test_detrend_mean_2d(self):
164.         input = np.vstack([self.sig_off,
165.                            self.sig_base + self.sig_off])
166.         target = np.vstack([self.sig_zeros,
167.                             self.sig_base])
168.         self.allclose(mlab.detrend_mean(input), target)
169.         self.allclose(mlab.detrend_mean(input, axis=None), target)
170.         self.allclose(mlab.detrend_mean(input.T, axis=None).T, target)
171.         self.allclose(mlab.detrend(input), target)
172.         self.allclose(mlab.detrend(input, axis=None), target)
173.         self.allclose(
174.             mlab.detrend(input.T, key="constant", axis=None), target.T)
175. 
176.         input = np.vstack([self.sig_base,
177.                            self.sig_base + self.sig_off,
178.                            self.sig_base + self.sig_slope,
179.                            self.sig_base + self.sig_off + self.sig_slope])
180.         target = np.vstack([self.sig_base,
181.                             self.sig_base,
182.                             self.sig_base + self.sig_slope_mean,
183.                             self.sig_base + self.sig_slope_mean])
184.         self.allclose(mlab.detrend_mean(input.T, axis=0), target.T)
185.         self.allclose(mlab.detrend_mean(input, axis=1), target)
186.         self.allclose(mlab.detrend_mean(input, axis=-1), target)
187.         self.allclose(mlab.detrend(input, key="default", axis=1), target)
188.         self.allclose(mlab.detrend(input.T, key="mean", axis=0), target.T)
189.         self.allclose(
190.             mlab.detrend(input.T, key=mlab.detrend_mean, axis=0), target.T)
191. 
192.     def test_detrend_ValueError(self):
193.         for signal, kwargs in [
194.                 (self.sig_slope[np.newaxis], {"key": "spam"}),
195.                 (self.sig_slope[np.newaxis], {"key": 5}),
196.                 (5.5, {"axis": 0}),
197.                 (self.sig_slope, {"axis": 1}),
198.                 (self.sig_slope[np.newaxis], {"axis": 2}),
199.         ]:
200.             with pytest.raises(ValueError):
201.                 mlab.detrend(signal, **kwargs)
202. 
203.     def test_detrend_mean_ValueError(self):
204.         for signal, kwargs in [
205.                 (5.5, {"axis": 0}),
206.                 (self.sig_slope, {"axis": 1}),
207.                 (self.sig_slope[np.newaxis], {"axis": 2}),
208.         ]:
209.             with pytest.raises(ValueError):
210.                 mlab.detrend_mean(signal, **kwargs)
211. 
212.     def test_detrend_linear(self):
213.         # 0D.
214.         assert mlab.detrend_linear(0.) == 0.
215.         assert mlab.detrend_linear(5.5) == 0.
216.         assert mlab.detrend(5.5, key="linear") == 0.
217.         assert mlab.detrend(5.5, key=mlab.detrend_linear) == 0.
218.         for sig in [  # 1D.
219.                 self.sig_off,
220.                 self.sig_slope,
221.                 self.sig_slope + self.sig_off,
222.         ]:
223.             self.allclose(mlab.detrend_linear(sig), self.sig_zeros)
224. 
225.     def test_detrend_str_linear_1d(self):
226.         input = self.sig_slope + self.sig_off
227.         target = self.sig_zeros
228.         self.allclose(mlab.detrend(input, key="linear"), target)
229.         self.allclose(mlab.detrend(input, key=mlab.detrend_linear), target)
230.         self.allclose(mlab.detrend_linear(input.tolist()), target)
231. 
232.     def test_detrend_linear_2d(self):
233.         input = np.vstack([self.sig_off,
234.                            self.sig_slope,
235.                            self.sig_slope + self.sig_off])
236.         target = np.vstack([self.sig_zeros,
237.                             self.sig_zeros,
238.                             self.sig_zeros])
239.         self.allclose(
240.             mlab.detrend(input.T, key="linear", axis=0), target.T)
241.         self.allclose(
242.             mlab.detrend(input.T, key=mlab.detrend_linear, axis=0), target.T)
243.         self.allclose(
244.             mlab.detrend(input, key="linear", axis=1), target)
245.         self.allclose(
246.             mlab.detrend(input, key=mlab.detrend_linear, axis=1), target)
247. 
248.         with pytest.raises(ValueError):
249.             mlab.detrend_linear(self.sig_slope[np.newaxis])
250. 
251. 
252. @pytest.mark.parametrize('iscomplex', [False, True],
253.                          ids=['real', 'complex'], scope='class')
254. @pytest.mark.parametrize('sides', ['onesided', 'twosided', 'default'],
255.                          scope='class')
256. @pytest.mark.parametrize(
257.     'fstims,len_x,NFFT_density,nover_density,pad_to_density,pad_to_spectrum',
258.     [
259.         ([], None, -1, -1, -1, -1),
260.         ([4], None, -1, -1, -1, -1),
261.         ([4, 5, 10], None, -1, -1, -1, -1),
262.         ([], None, None, -1, -1, None),
263.         ([], None, -1, -1, None, None),
264.         ([], None, None, -1, None, None),
265.         ([], 1024, 512, -1, -1, 128),
266.         ([], 256, -1, -1, 33, 257),
267.         ([], 255, 33, -1, -1, None),
268.         ([], 256, 128, -1, 256, 256),
269.         ([], None, -1, 32, -1, -1),
270.     ],
271.     ids=[
272.         'nosig',
273.         'Fs4',
274.         'FsAll',
275.         'nosig_noNFFT',
276.         'nosig_nopad_to',
277.         'nosig_noNFFT_no_pad_to',
278.         'nosig_trim',
279.         'nosig_odd',
280.         'nosig_oddlen',
281.         'nosig_stretch',
282.         'nosig_overlap',
283.     ],
284.     scope='class')
285. class TestSpectral:
286.     @pytest.fixture(scope='class', autouse=True)
287.     def stim(self, request, fstims, iscomplex, sides, len_x, NFFT_density,
288.              nover_density, pad_to_density, pad_to_spectrum):
289.         Fs = 100.
290. 
291.         x = np.arange(0, 10, 1 / Fs)
292.         if len_x is not None:
293.             x = x[:len_x]
294. 
295.         # get the stimulus frequencies, defaulting to None
296.         fstims = [Fs / fstim for fstim in fstims]
297. 
298.         # get the constants, default to calculated values
299.         if NFFT_density is None:
300.             NFFT_density_real = 256
301.         elif NFFT_density < 0:
302.             NFFT_density_real = NFFT_density = 100
303.         else:
304.             NFFT_density_real = NFFT_density
305. 
306.         if nover_density is None:
307.             nover_density_real = 0
308.         elif nover_density < 0:
309.             nover_density_real = nover_density = NFFT_density_real // 2
310.         else:
311.             nover_density_real = nover_density
312. 
313.         if pad_to_density is None:
314.             pad_to_density_real = NFFT_density_real
315.         elif pad_to_density < 0:
316.             pad_to_density = int(2**np.ceil(np.log2(NFFT_density_real)))
317.             pad_to_density_real = pad_to_density
318.         else:
319.             pad_to_density_real = pad_to_density
320. 
321.         if pad_to_spectrum is None:
322.             pad_to_spectrum_real = len(x)
323.         elif pad_to_spectrum < 0:
324.             pad_to_spectrum_real = pad_to_spectrum = len(x)
325.         else:
326.             pad_to_spectrum_real = pad_to_spectrum
327. 
328.         if pad_to_spectrum is None:
329.             NFFT_spectrum_real = NFFT_spectrum = pad_to_spectrum_real
330.         else:
331.             NFFT_spectrum_real = NFFT_spectrum = len(x)
332.         nover_spectrum = 0
333. 
334.         NFFT_specgram = NFFT_density
335.         nover_specgram = nover_density
336.         pad_to_specgram = pad_to_density
337.         NFFT_specgram_real = NFFT_density_real
338.         nover_specgram_real = nover_density_real
339. 
340.         if sides == 'onesided' or (sides == 'default' and not iscomplex):
341.             # frequencies for specgram, psd, and csd
342.             # need to handle even and odd differently
343.             if pad_to_density_real % 2:
344.                 freqs_density = np.linspace(0, Fs / 2,
345.                                             num=pad_to_density_real,
346.                                             endpoint=False)[::2]
347.             else:
348.                 freqs_density = np.linspace(0, Fs / 2,
349.                                             num=pad_to_density_real // 2 + 1)
350. 
351.             # frequencies for complex, magnitude, angle, and phase spectrums
352.             # need to handle even and odd differently
353.             if pad_to_spectrum_real % 2:
354.                 freqs_spectrum = np.linspace(0, Fs / 2,
355.                                              num=pad_to_spectrum_real,
356.                                              endpoint=False)[::2]
357.             else:
358.                 freqs_spectrum = np.linspace(0, Fs / 2,
359.                                              num=pad_to_spectrum_real // 2 + 1)
360.         else:
361.             # frequencies for specgram, psd, and csd
362.             # need to handle even and odd differently
363.             if pad_to_density_real % 2:
364.                 freqs_density = np.linspace(-Fs / 2, Fs / 2,
365.                                             num=2 * pad_to_density_real,
366.                                             endpoint=False)[1::2]
367.             else:
368.                 freqs_density = np.linspace(-Fs / 2, Fs / 2,
369.                                             num=pad_to_density_real,
370.                                             endpoint=False)
371. 
372.             # frequencies for complex, magnitude, angle, and phase spectrums
373.             # need to handle even and odd differently
374.             if pad_to_spectrum_real % 2:
375.                 freqs_spectrum = np.linspace(-Fs / 2, Fs / 2,
376.                                              num=2 * pad_to_spectrum_real,
377.                                              endpoint=False)[1::2]
378.             else:
379.                 freqs_spectrum = np.linspace(-Fs / 2, Fs / 2,
380.                                              num=pad_to_spectrum_real,
381.                                              endpoint=False)
382. 
383.         freqs_specgram = freqs_density
384.         # time points for specgram
385.         t_start = NFFT_specgram_real // 2
386.         t_stop = len(x) - NFFT_specgram_real // 2 + 1
387.         t_step = NFFT_specgram_real - nover_specgram_real
388.         t_specgram = x[t_start:t_stop:t_step]
389.         if NFFT_specgram_real % 2:
390.             t_specgram += 1 / Fs / 2
391.         if len(t_specgram) == 0:
392.             t_specgram = np.array([NFFT_specgram_real / (2 * Fs)])
393.         t_spectrum = np.array([NFFT_spectrum_real / (2 * Fs)])
394.         t_density = t_specgram
395. 
396.         y = np.zeros_like(x)
397.         for i, fstim in enumerate(fstims):
398.             y += np.sin(fstim * x * np.pi * 2) * 10**i
399. 
400.         if iscomplex:
401.             y = y.astype('complex')
402. 
403.         # Interestingly, the instance on which this fixture is called is not
404.         # the same as the one on which a test is run. So we need to modify the
405.         # class itself when using a class-scoped fixture.
406.         cls = request.cls
407. 
408.         cls.Fs = Fs
409.         cls.sides = sides
410.         cls.fstims = fstims
411. 
412.         cls.NFFT_density = NFFT_density
413.         cls.nover_density = nover_density
414.         cls.pad_to_density = pad_to_density
415. 
416.         cls.NFFT_spectrum = NFFT_spectrum
417.         cls.nover_spectrum = nover_spectrum
418.         cls.pad_to_spectrum = pad_to_spectrum
419. 
420.         cls.NFFT_specgram = NFFT_specgram
421.         cls.nover_specgram = nover_specgram
422.         cls.pad_to_specgram = pad_to_specgram
423. 
424.         cls.t_specgram = t_specgram
425.         cls.t_density = t_density
426.         cls.t_spectrum = t_spectrum
427.         cls.y = y
428. 
429.         cls.freqs_density = freqs_density
430.         cls.freqs_spectrum = freqs_spectrum
431.         cls.freqs_specgram = freqs_specgram
432. 
433.         cls.NFFT_density_real = NFFT_density_real
434. 
435.     def check_freqs(self, vals, targfreqs, resfreqs, fstims):
436.         assert resfreqs.argmin() == 0
437.         assert resfreqs.argmax() == len(resfreqs)-1
438.         assert_allclose(resfreqs, targfreqs, atol=1e-06)
439.         for fstim in fstims:
440.             i = np.abs(resfreqs - fstim).argmin()
441.             assert vals[i] > vals[i+2]
442.             assert vals[i] > vals[i-2]
443. 
444.     def check_maxfreq(self, spec, fsp, fstims):
445.         # skip the test if there are no frequencies
446.         if len(fstims) == 0:
447.             return
448. 
449.         # if twosided, do the test for each side
450.         if fsp.min() < 0:
451.             fspa = np.abs(fsp)
452.             zeroind = fspa.argmin()
453.             self.check_maxfreq(spec[:zeroind], fspa[:zeroind], fstims)
454.             self.check_maxfreq(spec[zeroind:], fspa[zeroind:], fstims)
455.             return
456. 
457.         fstimst = fstims[:]
458.         spect = spec.copy()
459. 
460.         # go through each peak and make sure it is correctly the maximum peak
461.         while fstimst:
462.             maxind = spect.argmax()
463.             maxfreq = fsp[maxind]
464.             assert_almost_equal(maxfreq, fstimst[-1])
465.             del fstimst[-1]
466.             spect[maxind-5:maxind+5] = 0
467. 
468.     def test_spectral_helper_raises(self):
469.         # We don't use parametrize here to handle ``y = self.y``.
470.         for kwargs in [  # Various error conditions:
471.             {"y": self.y+1, "mode": "complex"},  # Modes requiring ``x is y``.
472.             {"y": self.y+1, "mode": "magnitude"},
473.             {"y": self.y+1, "mode": "angle"},
474.             {"y": self.y+1, "mode": "phase"},
475.             {"mode": "spam"},  # Bad mode.
476.             {"y": self.y, "sides": "eggs"},  # Bad sides.
477.             {"y": self.y, "NFFT": 10, "noverlap": 20},  # noverlap > NFFT.
478.             {"NFFT": 10, "noverlap": 10},  # noverlap == NFFT.
479.             {"y": self.y, "NFFT": 10,
480.              "window": np.ones(9)},  # len(win) != NFFT.
481.         ]:
482.             with pytest.raises(ValueError):
483.                 mlab._spectral_helper(x=self.y, **kwargs)
484. 
485.     @pytest.mark.parametrize('mode', ['default', 'psd'])
486.     def test_single_spectrum_helper_unsupported_modes(self, mode):
487.         with pytest.raises(ValueError):
488.             mlab._single_spectrum_helper(x=self.y, mode=mode)
489. 
490.     @pytest.mark.parametrize("mode, case", [
491.         ("psd", "density"),
492.         ("magnitude", "specgram"),
493.         ("magnitude", "spectrum"),
494.     ])
495.     def test_spectral_helper_psd(self, mode, case):
496.         freqs = getattr(self, f"freqs_{case}")
497.         spec, fsp, t = mlab._spectral_helper(
498.             x=self.y, y=self.y,
499.             NFFT=getattr(self, f"NFFT_{case}"),
500.             Fs=self.Fs,


File: lib/matplotlib/tests/test_mlab.py
Line number range: 501 - 1000
Content:
501.             noverlap=getattr(self, f"nover_{case}"),
502.             pad_to=getattr(self, f"pad_to_{case}"),
503.             sides=self.sides,
504.             mode=mode)
505. 
506.         assert_allclose(fsp, freqs, atol=1e-06)
507.         assert_allclose(t, getattr(self, f"t_{case}"), atol=1e-06)
508.         assert spec.shape[0] == freqs.shape[0]
509.         assert spec.shape[1] == getattr(self, f"t_{case}").shape[0]
510. 
511.     def test_csd(self):
512.         freqs = self.freqs_density
513.         spec, fsp = mlab.csd(x=self.y, y=self.y+1,
514.                              NFFT=self.NFFT_density,
515.                              Fs=self.Fs,
516.                              noverlap=self.nover_density,
517.                              pad_to=self.pad_to_density,
518.                              sides=self.sides)
519.         assert_allclose(fsp, freqs, atol=1e-06)
520.         assert spec.shape == freqs.shape
521. 
522.     def test_csd_padding(self):
523.         """Test zero padding of csd()."""
524.         if self.NFFT_density is None:  # for derived classes
525.             return
526.         sargs = dict(x=self.y, y=self.y+1, Fs=self.Fs, window=mlab.window_none,
527.                      sides=self.sides)
528. 
529.         spec0, _ = mlab.csd(NFFT=self.NFFT_density, **sargs)
530.         spec1, _ = mlab.csd(NFFT=self.NFFT_density*2, **sargs)
531.         assert_almost_equal(np.sum(np.conjugate(spec0)*spec0).real,
532.                             np.sum(np.conjugate(spec1/2)*spec1/2).real)
533. 
534.     def test_psd(self):
535.         freqs = self.freqs_density
536.         spec, fsp = mlab.psd(x=self.y,
537.                              NFFT=self.NFFT_density,
538.                              Fs=self.Fs,
539.                              noverlap=self.nover_density,
540.                              pad_to=self.pad_to_density,
541.                              sides=self.sides)
542.         assert spec.shape == freqs.shape
543.         self.check_freqs(spec, freqs, fsp, self.fstims)
544. 
545.     @pytest.mark.parametrize(
546.         'make_data, detrend',
547.         [(np.zeros, mlab.detrend_mean), (np.zeros, 'mean'),
548.          (np.arange, mlab.detrend_linear), (np.arange, 'linear')])
549.     def test_psd_detrend(self, make_data, detrend):
550.         if self.NFFT_density is None:
551.             return
552.         ydata = make_data(self.NFFT_density)
553.         ydata1 = ydata+5
554.         ydata2 = ydata+3.3
555.         ydata = np.vstack([ydata1, ydata2])
556.         ydata = np.tile(ydata, (20, 1))
557.         ydatab = ydata.T.flatten()
558.         ydata = ydata.flatten()
559.         ycontrol = np.zeros_like(ydata)
560.         spec_g, fsp_g = mlab.psd(x=ydata,
561.                                  NFFT=self.NFFT_density,
562.                                  Fs=self.Fs,
563.                                  noverlap=0,
564.                                  sides=self.sides,
565.                                  detrend=detrend)
566.         spec_b, fsp_b = mlab.psd(x=ydatab,
567.                                  NFFT=self.NFFT_density,
568.                                  Fs=self.Fs,
569.                                  noverlap=0,
570.                                  sides=self.sides,
571.                                  detrend=detrend)
572.         spec_c, fsp_c = mlab.psd(x=ycontrol,
573.                                  NFFT=self.NFFT_density,
574.                                  Fs=self.Fs,
575.                                  noverlap=0,
576.                                  sides=self.sides)
577.         assert_array_equal(fsp_g, fsp_c)
578.         assert_array_equal(fsp_b, fsp_c)
579.         assert_allclose(spec_g, spec_c, atol=1e-08)
580.         # these should not be almost equal
581.         with pytest.raises(AssertionError):
582.             assert_allclose(spec_b, spec_c, atol=1e-08)
583. 
584.     def test_psd_window_hanning(self):
585.         if self.NFFT_density is None:
586.             return
587.         ydata = np.arange(self.NFFT_density)
588.         ydata1 = ydata+5
589.         ydata2 = ydata+3.3
590.         windowVals = mlab.window_hanning(np.ones_like(ydata1))
591.         ycontrol1 = ydata1 * windowVals
592.         ycontrol2 = mlab.window_hanning(ydata2)
593.         ydata = np.vstack([ydata1, ydata2])
594.         ycontrol = np.vstack([ycontrol1, ycontrol2])
595.         ydata = np.tile(ydata, (20, 1))
596.         ycontrol = np.tile(ycontrol, (20, 1))
597.         ydatab = ydata.T.flatten()
598.         ydataf = ydata.flatten()
599.         ycontrol = ycontrol.flatten()
600.         spec_g, fsp_g = mlab.psd(x=ydataf,
601.                                  NFFT=self.NFFT_density,
602.                                  Fs=self.Fs,
603.                                  noverlap=0,
604.                                  sides=self.sides,
605.                                  window=mlab.window_hanning)
606.         spec_b, fsp_b = mlab.psd(x=ydatab,
607.                                  NFFT=self.NFFT_density,
608.                                  Fs=self.Fs,
609.                                  noverlap=0,
610.                                  sides=self.sides,
611.                                  window=mlab.window_hanning)
612.         spec_c, fsp_c = mlab.psd(x=ycontrol,
613.                                  NFFT=self.NFFT_density,
614.                                  Fs=self.Fs,
615.                                  noverlap=0,
616.                                  sides=self.sides,
617.                                  window=mlab.window_none)
618.         spec_c *= len(ycontrol1)/(np.abs(windowVals)**2).sum()
619.         assert_array_equal(fsp_g, fsp_c)
620.         assert_array_equal(fsp_b, fsp_c)
621.         assert_allclose(spec_g, spec_c, atol=1e-08)
622.         # these should not be almost equal
623.         with pytest.raises(AssertionError):
624.             assert_allclose(spec_b, spec_c, atol=1e-08)
625. 
626.     def test_psd_window_hanning_detrend_linear(self):
627.         if self.NFFT_density is None:
628.             return
629.         ydata = np.arange(self.NFFT_density)
630.         ycontrol = np.zeros(self.NFFT_density)
631.         ydata1 = ydata+5
632.         ydata2 = ydata+3.3
633.         ycontrol1 = ycontrol
634.         ycontrol2 = ycontrol
635.         windowVals = mlab.window_hanning(np.ones_like(ycontrol1))
636.         ycontrol1 = ycontrol1 * windowVals
637.         ycontrol2 = mlab.window_hanning(ycontrol2)
638.         ydata = np.vstack([ydata1, ydata2])
639.         ycontrol = np.vstack([ycontrol1, ycontrol2])
640.         ydata = np.tile(ydata, (20, 1))
641.         ycontrol = np.tile(ycontrol, (20, 1))
642.         ydatab = ydata.T.flatten()
643.         ydataf = ydata.flatten()
644.         ycontrol = ycontrol.flatten()
645.         spec_g, fsp_g = mlab.psd(x=ydataf,
646.                                  NFFT=self.NFFT_density,
647.                                  Fs=self.Fs,
648.                                  noverlap=0,
649.                                  sides=self.sides,
650.                                  detrend=mlab.detrend_linear,
651.                                  window=mlab.window_hanning)
652.         spec_b, fsp_b = mlab.psd(x=ydatab,
653.                                  NFFT=self.NFFT_density,
654.                                  Fs=self.Fs,
655.                                  noverlap=0,
656.                                  sides=self.sides,
657.                                  detrend=mlab.detrend_linear,
658.                                  window=mlab.window_hanning)
659.         spec_c, fsp_c = mlab.psd(x=ycontrol,
660.                                  NFFT=self.NFFT_density,
661.                                  Fs=self.Fs,
662.                                  noverlap=0,
663.                                  sides=self.sides,
664.                                  window=mlab.window_none)
665.         spec_c *= len(ycontrol1)/(np.abs(windowVals)**2).sum()
666.         assert_array_equal(fsp_g, fsp_c)
667.         assert_array_equal(fsp_b, fsp_c)
668.         assert_allclose(spec_g, spec_c, atol=1e-08)
669.         # these should not be almost equal
670.         with pytest.raises(AssertionError):
671.             assert_allclose(spec_b, spec_c, atol=1e-08)
672. 
673.     def test_psd_windowarray(self):
674.         freqs = self.freqs_density
675.         spec, fsp = mlab.psd(x=self.y,
676.                              NFFT=self.NFFT_density,
677.                              Fs=self.Fs,
678.                              noverlap=self.nover_density,
679.                              pad_to=self.pad_to_density,
680.                              sides=self.sides,
681.                              window=np.ones(self.NFFT_density_real))
682.         assert_allclose(fsp, freqs, atol=1e-06)
683.         assert spec.shape == freqs.shape
684. 
685.     def test_psd_windowarray_scale_by_freq(self):
686.         win = mlab.window_hanning(np.ones(self.NFFT_density_real))
687. 
688.         spec, fsp = mlab.psd(x=self.y,
689.                              NFFT=self.NFFT_density,
690.                              Fs=self.Fs,
691.                              noverlap=self.nover_density,
692.                              pad_to=self.pad_to_density,
693.                              sides=self.sides,
694.                              window=mlab.window_hanning)
695.         spec_s, fsp_s = mlab.psd(x=self.y,
696.                                  NFFT=self.NFFT_density,
697.                                  Fs=self.Fs,
698.                                  noverlap=self.nover_density,
699.                                  pad_to=self.pad_to_density,
700.                                  sides=self.sides,
701.                                  window=mlab.window_hanning,
702.                                  scale_by_freq=True)
703.         spec_n, fsp_n = mlab.psd(x=self.y,
704.                                  NFFT=self.NFFT_density,
705.                                  Fs=self.Fs,
706.                                  noverlap=self.nover_density,
707.                                  pad_to=self.pad_to_density,
708.                                  sides=self.sides,
709.                                  window=mlab.window_hanning,
710.                                  scale_by_freq=False)
711.         assert_array_equal(fsp, fsp_s)
712.         assert_array_equal(fsp, fsp_n)
713.         assert_array_equal(spec, spec_s)
714.         assert_allclose(spec_s*(win**2).sum(),
715.                         spec_n/self.Fs*win.sum()**2,
716.                         atol=1e-08)
717. 
718.     @pytest.mark.parametrize(
719.         "kind", ["complex", "magnitude", "angle", "phase"])
720.     def test_spectrum(self, kind):
721.         freqs = self.freqs_spectrum
722.         spec, fsp = getattr(mlab, f"{kind}_spectrum")(
723.             x=self.y,
724.             Fs=self.Fs, sides=self.sides, pad_to=self.pad_to_spectrum)
725.         assert_allclose(fsp, freqs, atol=1e-06)
726.         assert spec.shape == freqs.shape
727.         if kind == "magnitude":
728.             self.check_maxfreq(spec, fsp, self.fstims)
729.             self.check_freqs(spec, freqs, fsp, self.fstims)
730. 
731.     @pytest.mark.parametrize(
732.         'kwargs',
733.         [{}, {'mode': 'default'}, {'mode': 'psd'}, {'mode': 'magnitude'},
734.          {'mode': 'complex'}, {'mode': 'angle'}, {'mode': 'phase'}])
735.     def test_specgram(self, kwargs):
736.         freqs = self.freqs_specgram
737.         spec, fsp, t = mlab.specgram(x=self.y,
738.                                      NFFT=self.NFFT_specgram,
739.                                      Fs=self.Fs,
740.                                      noverlap=self.nover_specgram,
741.                                      pad_to=self.pad_to_specgram,
742.                                      sides=self.sides,
743.                                      **kwargs)
744.         if kwargs.get('mode') == 'complex':
745.             spec = np.abs(spec)
746.         specm = np.mean(spec, axis=1)
747. 
748.         assert_allclose(fsp, freqs, atol=1e-06)
749.         assert_allclose(t, self.t_specgram, atol=1e-06)
750. 
751.         assert spec.shape[0] == freqs.shape[0]
752.         assert spec.shape[1] == self.t_specgram.shape[0]
753. 
754.         if kwargs.get('mode') not in ['complex', 'angle', 'phase']:
755.             # using a single freq, so all time slices should be about the same
756.             if np.abs(spec.max()) != 0:
757.                 assert_allclose(
758.                     np.diff(spec, axis=1).max() / np.abs(spec.max()), 0,
759.                     atol=1e-02)
760.         if kwargs.get('mode') not in ['angle', 'phase']:
761.             self.check_freqs(specm, freqs, fsp, self.fstims)
762. 
763.     def test_specgram_warn_only1seg(self):
764.         """Warning should be raised if len(x) <= NFFT."""
765.         with pytest.warns(UserWarning, match="Only one segment is calculated"):
766.             mlab.specgram(x=self.y, NFFT=len(self.y), Fs=self.Fs)
767. 
768.     def test_psd_csd_equal(self):
769.         Pxx, freqsxx = mlab.psd(x=self.y,
770.                                 NFFT=self.NFFT_density,
771.                                 Fs=self.Fs,
772.                                 noverlap=self.nover_density,
773.                                 pad_to=self.pad_to_density,
774.                                 sides=self.sides)
775.         Pxy, freqsxy = mlab.csd(x=self.y, y=self.y,
776.                                 NFFT=self.NFFT_density,
777.                                 Fs=self.Fs,
778.                                 noverlap=self.nover_density,
779.                                 pad_to=self.pad_to_density,
780.                                 sides=self.sides)
781.         assert_array_almost_equal_nulp(Pxx, Pxy)
782.         assert_array_equal(freqsxx, freqsxy)
783. 
784.     @pytest.mark.parametrize("mode", ["default", "psd"])
785.     def test_specgram_auto_default_psd_equal(self, mode):
786.         """
787.         Test that mlab.specgram without mode and with mode 'default' and 'psd'
788.         are all the same.
789.         """
790.         speca, freqspeca, ta = mlab.specgram(x=self.y,
791.                                              NFFT=self.NFFT_specgram,
792.                                              Fs=self.Fs,
793.                                              noverlap=self.nover_specgram,
794.                                              pad_to=self.pad_to_specgram,
795.                                              sides=self.sides)
796.         specb, freqspecb, tb = mlab.specgram(x=self.y,
797.                                              NFFT=self.NFFT_specgram,
798.                                              Fs=self.Fs,
799.                                              noverlap=self.nover_specgram,
800.                                              pad_to=self.pad_to_specgram,
801.                                              sides=self.sides,
802.                                              mode=mode)
803.         assert_array_equal(speca, specb)
804.         assert_array_equal(freqspeca, freqspecb)
805.         assert_array_equal(ta, tb)
806. 
807.     @pytest.mark.parametrize(
808.         "mode, conv", [
809.             ("magnitude", np.abs),
810.             ("angle", np.angle),
811.             ("phase", lambda x: np.unwrap(np.angle(x), axis=0))
812.         ])
813.     def test_specgram_complex_equivalent(self, mode, conv):
814.         specc, freqspecc, tc = mlab.specgram(x=self.y,
815.                                              NFFT=self.NFFT_specgram,
816.                                              Fs=self.Fs,
817.                                              noverlap=self.nover_specgram,
818.                                              pad_to=self.pad_to_specgram,
819.                                              sides=self.sides,
820.                                              mode='complex')
821.         specm, freqspecm, tm = mlab.specgram(x=self.y,
822.                                              NFFT=self.NFFT_specgram,
823.                                              Fs=self.Fs,
824.                                              noverlap=self.nover_specgram,
825.                                              pad_to=self.pad_to_specgram,
826.                                              sides=self.sides,
827.                                              mode=mode)
828. 
829.         assert_array_equal(freqspecc, freqspecm)
830.         assert_array_equal(tc, tm)
831.         assert_allclose(conv(specc), specm, atol=1e-06)
832. 
833.     def test_psd_windowarray_equal(self):
834.         win = mlab.window_hanning(np.ones(self.NFFT_density_real))
835.         speca, fspa = mlab.psd(x=self.y,
836.                                NFFT=self.NFFT_density,
837.                                Fs=self.Fs,
838.                                noverlap=self.nover_density,
839.                                pad_to=self.pad_to_density,
840.                                sides=self.sides,
841.                                window=win)
842.         specb, fspb = mlab.psd(x=self.y,
843.                                NFFT=self.NFFT_density,
844.                                Fs=self.Fs,
845.                                noverlap=self.nover_density,
846.                                pad_to=self.pad_to_density,
847.                                sides=self.sides)
848.         assert_array_equal(fspa, fspb)
849.         assert_allclose(speca, specb, atol=1e-08)
850. 
851. 
852. # extra test for cohere...
853. def test_cohere():
854.     N = 1024
855.     np.random.seed(19680801)
856.     x = np.random.randn(N)
857.     # phase offset
858.     y = np.roll(x, 20)
859.     # high-freq roll-off
860.     y = np.convolve(y, np.ones(20) / 20., mode='same')
861.     cohsq, f = mlab.cohere(x, y, NFFT=256, Fs=2, noverlap=128)
862.     assert_allclose(np.mean(cohsq), 0.837, atol=1.e-3)
863.     assert np.isreal(np.mean(cohsq))
864. 
865. 
866. # *****************************************************************
867. # These Tests were taken from SCIPY with some minor modifications
868. # this can be retrieved from:
869. # https://github.com/scipy/scipy/blob/master/scipy/stats/tests/test_kdeoth.py
870. # *****************************************************************
871. 
872. class TestGaussianKDE:
873. 
874.     def test_kde_integer_input(self):
875.         """Regression test for #1181."""
876.         x1 = np.arange(5)
877.         kde = mlab.GaussianKDE(x1)
878.         y_expected = [0.13480721, 0.18222869, 0.19514935, 0.18222869,
879.                       0.13480721]
880.         np.testing.assert_array_almost_equal(kde(x1), y_expected, decimal=6)
881. 
882.     def test_gaussian_kde_covariance_caching(self):
883.         x1 = np.array([-7, -5, 1, 4, 5], dtype=float)
884.         xs = np.linspace(-10, 10, num=5)
885.         # These expected values are from scipy 0.10, before some changes to
886.         # gaussian_kde. They were not compared with any external reference.
887.         y_expected = [0.02463386, 0.04689208, 0.05395444, 0.05337754,
888.                       0.01664475]
889. 
890.         # set it to the default bandwidth.
891.         kde2 = mlab.GaussianKDE(x1, 'scott')
892.         y2 = kde2(xs)
893. 
894.         np.testing.assert_array_almost_equal(y_expected, y2, decimal=7)
895. 
896.     def test_kde_bandwidth_method(self):
897. 
898.         np.random.seed(8765678)
899.         n_basesample = 50
900.         xn = np.random.randn(n_basesample)
901. 
902.         # Default
903.         gkde = mlab.GaussianKDE(xn)
904.         # Supply a callable
905.         gkde2 = mlab.GaussianKDE(xn, 'scott')
906.         # Supply a scalar
907.         gkde3 = mlab.GaussianKDE(xn, bw_method=gkde.factor)
908. 
909.         xs = np.linspace(-7, 7, 51)
910.         kdepdf = gkde.evaluate(xs)
911.         kdepdf2 = gkde2.evaluate(xs)
912.         assert kdepdf.all() == kdepdf2.all()
913.         kdepdf3 = gkde3.evaluate(xs)
914.         assert kdepdf.all() == kdepdf3.all()
915. 
916. 
917. class TestGaussianKDECustom:
918.     def test_no_data(self):
919.         """Pass no data into the GaussianKDE class."""
920.         with pytest.raises(ValueError):
921.             mlab.GaussianKDE([])
922. 
923.     def test_single_dataset_element(self):
924.         """Pass a single dataset element into the GaussianKDE class."""
925.         with pytest.raises(ValueError):
926.             mlab.GaussianKDE([42])
927. 
928.     def test_silverman_multidim_dataset(self):
929.         """Test silverman's for a multi-dimensional array."""
930.         x1 = np.array([[1, 2, 3], [4, 5, 6], [7, 8, 9]])
931.         with pytest.raises(np.linalg.LinAlgError):
932.             mlab.GaussianKDE(x1, "silverman")
933. 
934.     def test_silverman_singledim_dataset(self):
935.         """Test silverman's output for a single dimension list."""
936.         x1 = np.array([-7, -5, 1, 4, 5])
937.         mygauss = mlab.GaussianKDE(x1, "silverman")
938.         y_expected = 0.76770389927475502
939.         assert_almost_equal(mygauss.covariance_factor(), y_expected, 7)
940. 
941.     def test_scott_multidim_dataset(self):
942.         """Test scott's output for a multi-dimensional array."""
943.         x1 = np.array([[1, 2, 3], [4, 5, 6], [7, 8, 9]])
944.         with pytest.raises(np.linalg.LinAlgError):
945.             mlab.GaussianKDE(x1, "scott")
946. 
947.     def test_scott_singledim_dataset(self):
948.         """Test scott's output a single-dimensional array."""
949.         x1 = np.array([-7, -5, 1, 4, 5])
950.         mygauss = mlab.GaussianKDE(x1, "scott")
951.         y_expected = 0.72477966367769553
952.         assert_almost_equal(mygauss.covariance_factor(), y_expected, 7)
953. 
954.     def test_scalar_empty_dataset(self):
955.         """Test the scalar's cov factor for an empty array."""
956.         with pytest.raises(ValueError):
957.             mlab.GaussianKDE([], bw_method=5)
958. 
959.     def test_scalar_covariance_dataset(self):
960.         """Test a scalar's cov factor."""
961.         np.random.seed(8765678)
962.         n_basesample = 50
963.         multidim_data = [np.random.randn(n_basesample) for i in range(5)]
964. 
965.         kde = mlab.GaussianKDE(multidim_data, bw_method=0.5)
966.         assert kde.covariance_factor() == 0.5
967. 
968.     def test_callable_covariance_dataset(self):
969.         """Test the callable's cov factor for a multi-dimensional array."""
970.         np.random.seed(8765678)
971.         n_basesample = 50
972.         multidim_data = [np.random.randn(n_basesample) for i in range(5)]
973. 
974.         def callable_fun(x):
975.             return 0.55
976.         kde = mlab.GaussianKDE(multidim_data, bw_method=callable_fun)
977.         assert kde.covariance_factor() == 0.55
978. 
979.     def test_callable_singledim_dataset(self):
980.         """Test the callable's cov factor for a single-dimensional array."""
981.         np.random.seed(8765678)
982.         n_basesample = 50
983.         multidim_data = np.random.randn(n_basesample)
984. 
985.         kde = mlab.GaussianKDE(multidim_data, bw_method='silverman')
986.         y_expected = 0.48438841363348911
987.         assert_almost_equal(kde.covariance_factor(), y_expected, 7)
988. 
989.     def test_wrong_bw_method(self):
990.         """Test the error message that should be called when bw is invalid."""
991.         np.random.seed(8765678)
992.         n_basesample = 50
993.         data = np.random.randn(n_basesample)
994.         with pytest.raises(ValueError):
995.             mlab.GaussianKDE(data, bw_method="invalid")
996. 
997. 
998. class TestGaussianKDEEvaluate:
999. 
1000.     def test_evaluate_diff_dim(self):


File: lib/matplotlib/tests/test_mlab.py
Line number range: 1001 - 2000
Content:
1001.         """
1002.         Test the evaluate method when the dim's of dataset and points have
1003.         different dimensions.
1004.         """
1005.         x1 = np.arange(3, 10, 2)
1006.         kde = mlab.GaussianKDE(x1)
1007.         x2 = np.arange(3, 12, 2)
1008.         y_expected = [
1009.             0.08797252, 0.11774109, 0.11774109, 0.08797252, 0.0370153
1010.         ]
1011.         y = kde.evaluate(x2)
1012.         np.testing.assert_array_almost_equal(y, y_expected, 7)
1013. 
1014.     def test_evaluate_inv_dim(self):
1015.         """
1016.         Invert the dimensions; i.e., for a dataset of dimension 1 [3, 2, 4],
1017.         the points should have a dimension of 3 [[3], [2], [4]].
1018.         """
1019.         np.random.seed(8765678)
1020.         n_basesample = 50
1021.         multidim_data = np.random.randn(n_basesample)
1022.         kde = mlab.GaussianKDE(multidim_data)
1023.         x2 = [[1], [2], [3]]
1024.         with pytest.raises(ValueError):
1025.             kde.evaluate(x2)
1026. 
1027.     def test_evaluate_dim_and_num(self):
1028.         """Tests if evaluated against a one by one array"""
1029.         x1 = np.arange(3, 10, 2)
1030.         x2 = np.array([3])
1031.         kde = mlab.GaussianKDE(x1)
1032.         y_expected = [0.08797252]
1033.         y = kde.evaluate(x2)
1034.         np.testing.assert_array_almost_equal(y, y_expected, 7)
1035. 
1036.     def test_evaluate_point_dim_not_one(self):
1037.         x1 = np.arange(3, 10, 2)
1038.         x2 = [np.arange(3, 10, 2), np.arange(3, 10, 2)]
1039.         kde = mlab.GaussianKDE(x1)
1040.         with pytest.raises(ValueError):
1041.             kde.evaluate(x2)
1042. 
1043.     def test_evaluate_equal_dim_and_num_lt(self):
1044.         x1 = np.arange(3, 10, 2)
1045.         x2 = np.arange(3, 8, 2)
1046.         kde = mlab.GaussianKDE(x1)
1047.         y_expected = [0.08797252, 0.11774109, 0.11774109]
1048.         y = kde.evaluate(x2)
1049.         np.testing.assert_array_almost_equal(y, y_expected, 7)
1050. 
1051. 
1052. def test_psd_onesided_norm():
1053.     u = np.array([0, 1, 2, 3, 1, 2, 1])
1054.     dt = 1.0
1055.     Su = np.abs(np.fft.fft(u) * dt)**2 / (dt * u.size)
1056.     P, f = mlab.psd(u, NFFT=u.size, Fs=1/dt, window=mlab.window_none,
1057.                     detrend=mlab.detrend_none, noverlap=0, pad_to=None,
1058.                     scale_by_freq=None,
1059.                     sides='onesided')
1060.     Su_1side = np.append([Su[0]], Su[1:4] + Su[4:][::-1])
1061.     assert_allclose(P, Su_1side, atol=1e-06)
1062. 
1063. 
1064. def test_psd_oversampling():
1065.     """Test the case len(x) < NFFT for psd()."""
1066.     u = np.array([0, 1, 2, 3, 1, 2, 1])
1067.     dt = 1.0
1068.     Su = np.abs(np.fft.fft(u) * dt)**2 / (dt * u.size)
1069.     P, f = mlab.psd(u, NFFT=u.size*2, Fs=1/dt, window=mlab.window_none,
1070.                     detrend=mlab.detrend_none, noverlap=0, pad_to=None,
1071.                     scale_by_freq=None,
1072.                     sides='onesided')
1073.     Su_1side = np.append([Su[0]], Su[1:4] + Su[4:][::-1])
1074.     assert_almost_equal(np.sum(P), np.sum(Su_1side))  # same energy

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-21 03:19:31,072 - thread-129519985886912.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="The user requested the full content of the file 'lib/matplotlib/tests/test_mlab.py'. This context block includes the entire file content from line 1 to 1074 as provided.", relative_path='lib/matplotlib/tests/test_mlab.py', start_line=1, end_line=1074)]
2025-12-21 03:19:31,074 - thread-129519985886912.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of lib/matplotlib/tests/test_mlab.py
2025-12-21 03:19:31,075 - thread-129519985886912.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-21 03:19:31,075 - thread-129519985886912.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-21 03:19:31,075 - thread-129519985886912.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 0 existing contexts
2025-12-21 03:19:31,075 - thread-129519985886912.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 1 total contexts (removed 0 duplicates)
2025-12-21 03:19:31,076 - thread-129519985886912.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
matplotlib
├── .appveyor.yml
├── .circleci
|   ├── config.yml
|   ├── deploy-docs.sh
|   └── fetch_doc_logs.py
├── .git_archival.txt
├── .github
|   ├── CONTRIBUTING.md
|   ├── FUNDING.yml
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.yml
|   |   ├── config.yml
|   |   ├── documentation.yml
|   |   ├── feature_request.yml
|   |   └── maintenance.yml
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── codecov.yml
|   ├── dependabot.yml
|   └── workflows
|       ├── cibuildsdist.yml
|       ├── cibuildwheel.yml
|       ├── circleci.yml
|       ├── clean_pr.yml
|       ├── codeql-analysis.yml
|       ├── conflictcheck.yml
|       ├── cygwin.yml
|       ├── nightlies.yml
|       ├── pr_welcome.yml
|       ├── reviewdog.yml
|       └── tests.yml
├── .lgtm.yml
├── .meeseeksdev.yml
├── .pre-commit-config.yaml
├── CODE_OF_CONDUCT.md
├── INSTALL.rst
├── LICENSE
├── README.md
├── SECURITY.md
├── azure-pipelines.yml
├── ci
|   ├── check_version_number.py
|   ├── check_wheel_licenses.py
|   └── codespell-ignore-words.txt
├── doc
|   ├── README.txt
|   ├── _static
|   |   ├── fa
|   |   ├── markers
|   |   ├── mpl.css
|   |   └── zenodo_cache
|   ├── _templates
|   |   ├── autofunctions.rst
|   |   ├── automodule.rst
|   |   ├── autosummary.rst
|   |   ├── autosummary_class_only.rst
|   |   ├── cheatsheet_sidebar.html
|   |   ├── donate_sidebar.html
|   |   ├── function.rst
|   |   ├── pagesource.html
|   |   ├── search.html
|   |   ├── sidebar_announcement.html
|   |   └── sidebar_versions.html
|   ├── api
|   |   ├── _api_api.rst
|   |   ├── _enums_api.rst
|   |   ├── afm_api.rst
|   |   ├── animation_api.rst
|   |   ├── artist_api.rst
|   |   ├── axes_api.rst
|   |   ├── axis_api.rst
|   |   ├── backend_agg_api.rst
|   |   ├── backend_bases_api.rst
|   |   ├── backend_cairo_api.rst
|   |   ├── backend_gtk3_api.rst
|   |   ├── backend_gtk4_api.rst
|   |   ├── backend_managers_api.rst
|   |   ├── backend_mixed_api.rst
|   |   ├── backend_nbagg_api.rst
|   |   ├── backend_pdf_api.rst
|   |   ├── backend_pgf_api.rst
|   |   ├── backend_ps_api.rst
|   |   ├── backend_qt_api.rst
|   |   ├── backend_svg_api.rst
|   |   ├── backend_template_api.rst
|   |   ├── backend_tk_api.rst
|   |   ├── backend_tools_api.rst
|   |   ├── backend_webagg_api.rst
|   |   ├── backend_wx_api.rst
|   |   ├── bezier_api.rst
|   |   ├── category_api.rst
|   |   ├── cbook_api.rst
|   |   ├── cm_api.rst
|   |   ├── collections_api.rst
|   |   ├── colorbar_api.rst
|   |   ├── colors_api.rst
|   |   ├── container_api.rst
|   |   ├── contour_api.rst
|   |   ├── dates_api.rst
|   |   ├── docstring_api.rst
|   |   ├── dviread.rst
|   |   ├── figure_api.rst
|   |   ├── font_manager_api.rst
|   |   ├── ft2font.rst
|   |   ├── gridspec_api.rst
|   |   ├── hatch_api.rst
|   |   ├── image_api.rst
|   |   ├── index.rst
|   |   ├── index_backend_api.rst
|   |   ├── layout_engine_api.rst
|   |   ├── legend_api.rst
|   |   ├── legend_handler_api.rst
|   |   ├── lines_api.rst
|   |   ├── markers_api.rst
|   |   ├── mathtext_api.rst
|   |   ├── matplotlib_configuration_api.rst
|   |   ├── mlab_api.rst
|   |   ├── next_api_changes
|   |   |   ├── README.rst
|   |   |   ├── behavior
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 23573-AL.rst
|   |   |   |   ├── 23579-AL.rst
|   |   |   |   ├── 23710-ES.rst
|   |   |   |   ├── 24062-tb.rst
|   |   |   |   ├── 24131-OG.rst
|   |   |   |   ├── 24132-GL.rst
|   |   |   |   ├── 24189-JB.rst
|   |   |   |   ├── 24570-GL.rst
|   |   |   |   ├── 24655-AK.rst
|   |   |   |   ├── 24829-AL.rst
|   |   |   |   ├── 24870-AL.rst
|   |   |   |   ├── 24889-AL.rst
|   |   |   |   ├── 24912-AL.rst
|   |   |   |   ├── 25061-DS.rst
|   |   |   |   └── 9598-AFV.rst
|   |   |   ├── deprecations
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 19763-ES.rst
|   |   |   |   ├── 22314-AL.rst
|   |   |   |   ├── 23449-SS.rst
|   |   |   |   ├── 23720-RS.rst
|   |   |   |   ├── 23735-ES.rst
|   |   |   |   ├── 23824-OG.rst
|   |   |   |   ├── 24000-TH.rst
|   |   |   |   ├── 24013-TH.rst
|   |   |   |   ├── 24071-OG.rst
|   |   |   |   ├── 24088-JMK.rst
|   |   |   |   ├── 24131-OG.rst
|   |   |   |   ├── 24140-AL.rst
|   |   |   |   ├── 24144-AL.rst
|   |   |   |   ├── 24198-AL.rst
|   |   |   |   ├── 24208-AL.rst
|   |   |   |   ├── 24220-AL.rst
|   |   |   |   ├── 24221-AL.rst
|   |   |   |   ├── 24224-OG.rst
|   |   |   |   ├── 24240-OG.rst
|   |   |   |   ├── 24254-OG.rst
|   |   |   |   ├── 24305-AL.rst
|   |   |   |   ├── 24455-AL.rst
|   |   |   |   ├── 24465-AL.rst
|   |   |   |   ├── 24474_CM.rst
|   |   |   |   ├── 24538-OG.rst
|   |   |   |   ├── 24577-AL.rst
|   |   |   |   ├── 24664-OG.rst
|   |   |   |   ├── 24688-OG.rst
|   |   |   |   ├── 24730-TH.rst
|   |   |   |   ├── 24806-KS.rst
|   |   |   |   ├── 24846-ES.rst
|   |   |   |   ├── 24864-AL.rst
|   |   |   |   ├── 24904-AL.rst
|   |   |   |   ├── 24913-AL.rst
|   |   |   |   ├── 24985-OG.rst
|   |   |   |   └── 24990-OG.rst
|   |   |   ├── development
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 23683-AL.rst
|   |   |   |   ├── 24257-AL.rst
|   |   |   |   ├── 24710-AL.rst
|   |   |   |   ├── 24724-ES.rst
|   |   |   |   ├── 24887-OG.rst
|   |   |   |   ├── 24893-KS.rst
|   |   |   |   └── 24919-KS.rst
|   |   |   └── removals
|   |   |       ├── 00001-ABC.rst
|   |   |       ├── 21661-TAC.rst
|   |   |       ├── 24125-OG.rst
|   |   |       ├── 24128-OG.rst
|   |   |       ├── 24129-OG.rst
|   |   |       ├── 24251-OG.rst
|   |   |       ├── 24253-OG.rst
|   |   |       ├── 24254-OG.rst
|   |   |       ├── 24257-AL.rst
|   |   |       ├── 24355-OG.rst
|   |   |       ├── 24356-OG.rst
|   |   |       ├── 24624-AL.rst
|   |   |       ├── 24923-ES.rst
|   |   |       ├── 24948-ES.rst
|   |   |       ├── 24965-ES.rst
|   |   |       └── 24XXX-OG.rst
|   |   ├── next_api_changes.rst
|   |   ├── offsetbox_api.rst
|   |   ├── patches_api.rst
|   |   ├── path_api.rst
|   |   ├── patheffects_api.rst
|   |   ├── prev_api_changes
|   |   |   ├── api_changes_0.40.rst
|   |   |   ├── api_changes_0.42.rst
|   |   |   ├── api_changes_0.50.rst
|   |   |   ├── api_changes_0.54.3.rst
|   |   |   ├── api_changes_0.54.rst
|   |   |   ├── api_changes_0.60.rst
|   |   |   ├── api_changes_0.61.rst
|   |   |   ├── api_changes_0.63.rst
|   |   |   ├── api_changes_0.65.1.rst
|   |   |   ├── api_changes_0.65.rst
|   |   |   ├── api_changes_0.70.rst
|   |   |   ├── api_changes_0.71.rst
|   |   |   ├── api_changes_0.72.rst
|   |   |   ├── api_changes_0.73.rst
|   |   |   ├── api_changes_0.80.rst
|   |   |   ├── api_changes_0.81.rst
|   |   |   ├── api_changes_0.82.rst
|   |   |   ├── api_changes_0.83.rst
|   |   |   ├── api_changes_0.84.rst
|   |   |   ├── api_changes_0.85.rst
|   |   |   ├── api_changes_0.86.rst
|   |   |   ├── api_changes_0.87.7.rst
|   |   |   ├── api_changes_0.90.0.rst
|   |   |   ├── api_changes_0.90.1.rst
|   |   |   ├── api_changes_0.91.0.rst
|   |   |   ├── api_changes_0.91.2.rst
|   |   |   ├── api_changes_0.98.0.rst
|   |   |   ├── api_changes_0.98.1.rst
|   |   |   ├── api_changes_0.98.x.rst
|   |   |   ├── api_changes_0.99.rst
|   |   |   ├── api_changes_0.99.x.rst
|   |   |   ├── api_changes_1.1.x.rst
|   |   |   ├── api_changes_1.2.x.rst
|   |   |   ├── api_changes_1.3.x.rst
|   |   |   ├── api_changes_1.4.x.rst
|   |   |   ├── api_changes_1.5.0.rst
|   |   |   ├── api_changes_1.5.2.rst
|   |   |   ├── api_changes_1.5.3.rst
|   |   |   ├── api_changes_2.0.0.rst
|   |   |   ├── api_changes_2.0.1.rst
|   |   |   ├── api_changes_2.1.0.rst
|   |   |   ├── api_changes_2.1.1.rst
|   |   |   ├── api_changes_2.1.2.rst
|   |   |   ├── api_changes_2.2.0.rst
|   |   |   ├── api_changes_3.0.0.rst
|   |   |   ├── api_changes_3.0.1.rst
|   |   |   ├── api_changes_3.1.0.rst
|   |   |   ├── api_changes_3.1.1.rst
|   |   |   ├── api_changes_3.2.0
|   |   |   |   ├── behavior.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.2.0.rst
|   |   |   ├── api_changes_3.3.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.3.0.rst
|   |   |   ├── api_changes_3.3.1.rst
|   |   |   ├── api_changes_3.4.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.4.0.rst
|   |   |   ├── api_changes_3.4.2.rst
|   |   |   ├── api_changes_3.5.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.5.0.rst
|   |   |   ├── api_changes_3.5.2.rst
|   |   |   ├── api_changes_3.5.3.rst
|   |   |   ├── api_changes_3.6.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   └── api_changes_3.6.0.rst
|   |   ├── projections
|   |   |   ├── geo.rst
|   |   |   └── polar.rst
|   |   ├── projections_api.rst
|   |   ├── pyplot_summary.rst
|   |   ├── quiver_api.rst
|   |   ├── rcsetup_api.rst
|   |   ├── sankey_api.rst
|   |   ├── scale_api.rst
|   |   ├── sphinxext_mathmpl_api.rst
|   |   ├── sphinxext_plot_directive_api.rst
|   |   ├── spines_api.rst
|   |   ├── style_api.rst
|   |   ├── table_api.rst
|   |   ├── testing_api.rst
|   |   ├── texmanager_api.rst
|   |   ├── text_api.rst
|   |   ├── ticker_api.rst
|   |   ├── tight_bbox_api.rst
|   |   ├── tight_layout_api.rst
|   |   ├── toolkits
|   |   |   ├── axes_grid1.rst
|   |   |   ├── axisartist.rst
|   |   |   ├── mplot3d
|   |   |   |   ├── axes3d.rst
|   |   |   |   ├── faq.rst
|   |   |   |   └── view_angles.rst
|   |   |   └── mplot3d.rst
|   |   ├── transformations.rst
|   |   ├── tri_api.rst
|   |   ├── type1font.rst
|   |   ├── units_api.rst
|   |   └── widgets_api.rst
|   ├── conf.py
|   ├── devel
|   |   ├── MEP
|   |   |   ├── MEP08.rst
|   |   |   ├── MEP09.rst
|   |   |   ├── MEP10.rst
|   |   |   ├── MEP11.rst
|   |   |   ├── MEP12.rst
|   |   |   ├── MEP13.rst
|   |   |   ├── MEP14.rst
|   |   |   ├── MEP15.rst
|   |   |   ├── MEP19.rst
|   |   |   ├── MEP21.rst
|   |   |   ├── MEP22.rst
|   |   |   ├── MEP23.rst
|   |   |   ├── MEP24.rst
|   |   |   ├── MEP25.rst
|   |   |   ├── MEP26.rst
|   |   |   ├── MEP27.rst
|   |   |   ├── MEP28.rst
|   |   |   ├── MEP29.rst
|   |   |   ├── README.rst
|   |   |   ├── index.rst
|   |   |   └── template.rst
|   |   ├── README.txt
|   |   ├── coding_guide.rst
|   |   ├── color_changes.rst
|   |   ├── contributing.rst
|   |   ├── dependencies.rst
|   |   ├── development_setup.rst
|   |   ├── development_workflow.rst
|   |   ├── documenting_mpl.rst
|   |   ├── index.rst
|   |   ├── license.rst
|   |   ├── maintainer_workflow.rst
|   |   ├── min_dep_policy.rst
|   |   ├── release_guide.rst
|   |   ├── style_guide.rst
|   |   ├── testing.rst
|   |   └── triage.rst
|   ├── index.rst
|   ├── sphinxext
|   |   ├── __init__.py
|   |   ├── custom_roles.py
|   |   ├── gallery_order.py
|   |   ├── github.py
|   |   ├── math_symbol_table.py
|   |   ├── missing_references.py
|   |   ├── mock_gui_toolkits.py
|   |   ├── redirect_from.py
|   |   └── skip_deprecated.py
|   ├── thirdpartypackages
|   |   └── index.rst
|   └── users
|       ├── explain
|       |   ├── api_interfaces.rst
|       |   ├── backends.rst
|       |   ├── event_handling.rst
|       |   ├── figures.rst
|       |   ├── fonts.rst
|       |   ├── index.rst
|       |   ├── interactive.rst
|       |   ├── interactive_guide.rst
|       |   ├── performance.rst
|       |   └── writing_a_backend_pyplot_interface.rst
|       ├── faq
|       |   ├── environment_variables_faq.rst
|       |   ├── howto_faq.rst
|       |   ├── index.rst
|       |   └── troubleshooting_faq.rst
|       ├── generate_credits.py
|       ├── getting_started
|       |   └── index.rst
|       ├── github_stats.rst
|       ├── index.rst
|       ├── installing
|       |   └── index.rst
|       ├── next_whats_new
|       |   ├── 3d_pane_color_rcparams.rst
|       |   ├── 3d_plot_aspects_adjustable_keyword.rst
|       |   ├── 3d_plot_pan_zoom.rst
|       |   ├── README.rst
|       |   ├── bar_label_formatting.rst
|       |   ├── colorbar_has_location_argument.rst
|       |   ├── documentation.rst
|       |   ├── ellipse_annotation.rst
|       |   ├── figure_hooks.rst
|       |   ├── imshow_extent_units.rst
|       |   ├── legend-figure-outside.rst
|       |   ├── per_subplot_mosaic.rst
|       |   ├── pie_hatch.rst
|       |   ├── polar_errorbar_caps.rst
|       |   ├── reverse_legend.rst
|       |   ├── rgba_pcolormesh.rst
|       |   ├── savefig_bbox_layout.rst
|       |   ├── shade_poly3dcollection.rst
|       |   ├── show_source_links_directive_option.rst
|       |   ├── styles_from_packages.rst
|       |   ├── view_current_axis_format.rst
|       |   ├── widget_blitting.rst
|       |   └── widget_button_styling.rst
|       ├── next_whats_new.rst
|       ├── prev_whats_new
|       |   ├── changelog.rst
|       |   ├── dflt_style_changes.rst
|       |   ├── github_stats_3.0.0.rst
|       |   ├── github_stats_3.0.1.rst
|       |   ├── github_stats_3.0.2.rst
|       |   ├── github_stats_3.0.3.rst
|       |   ├── github_stats_3.1.0.rst
|       |   ├── github_stats_3.1.1.rst
|       |   ├── github_stats_3.1.2.rst
|       |   ├── github_stats_3.1.3.rst
|       |   ├── github_stats_3.2.0.rst
|       |   ├── github_stats_3.2.1.rst
|       |   ├── github_stats_3.2.2.rst
|       |   ├── github_stats_3.3.0.rst
|       |   ├── github_stats_3.3.1.rst
|       |   ├── github_stats_3.3.2.rst
|       |   ├── github_stats_3.3.3.rst
|       |   ├── github_stats_3.3.4.rst
|       |   ├── github_stats_3.4.0.rst
|       |   ├── github_stats_3.4.1.rst
|       |   ├── github_stats_3.4.2.rst
|       |   ├── github_stats_3.4.3.rst
|       |   ├── github_stats_3.5.0.rst
|       |   ├── github_stats_3.5.1.rst
|       |   ├── github_stats_3.5.2.rst
|       |   ├── github_stats_3.5.3.rst
|       |   ├── whats_new_0.98.4.rst
|       |   ├── whats_new_0.99.rst
|       |   ├── whats_new_1.0.rst
|       |   ├── whats_new_1.1.rst
|       |   ├── whats_new_1.2.2.rst
|       |   ├── whats_new_1.2.rst
|       |   ├── whats_new_1.3.rst
|       |   ├── whats_new_1.4.rst
|       |   ├── whats_new_1.5.rst
|       |   ├── whats_new_2.0.0.rst
|       |   ├── whats_new_2.1.0.rst
|       |   ├── whats_new_2.2.rst
|       |   ├── whats_new_3.0.rst
|       |   ├── whats_new_3.1.0.rst
|       |   ├── whats_new_3.2.0.rst
|       |   ├── whats_new_3.3.0.rst
|       |   ├── whats_new_3.4.0.rst
|       |   ├── whats_new_3.5.0.rst
|       |   ├── whats_new_3.5.2.rst
|       |   └── whats_new_3.6.0.rst
|       ├── project
|       |   ├── citing.rst
|       |   ├── credits.rst
|       |   ├── history.rst
|       |   ├── index.rst
|       |   ├── license.rst
|       |   └── mission.rst
|       ├── release_notes.rst
|       ├── release_notes_next.rst
|       └── resources
|           └── index.rst
├── environment.yml
├── examples
|   ├── README.txt
|   ├── animation
|   |   ├── README.txt
|   |   ├── animate_decay.py
|   |   ├── animated_histogram.py
|   |   ├── animation_demo.py
|   |   ├── bayes_update.py
|   |   ├── double_pendulum.py
|   |   ├── dynamic_image.py
|   |   ├── frame_grabbing_sgskip.py
|   |   ├── multiple_axes.py
|   |   ├── pause_resume.py
|   |   ├── rain.py
|   |   ├── random_walk.py
|   |   ├── simple_anim.py
|   |   ├── simple_scatter.py
|   |   ├── strip_chart.py
|   |   └── unchained.py
|   ├── axes_grid1
|   |   ├── README.txt
|   |   ├── demo_anchored_direction_arrows.py
|   |   ├── demo_axes_divider.py
|   |   ├── demo_axes_grid.py
|   |   ├── demo_axes_grid2.py
|   |   ├── demo_axes_hbox_divider.py
|   |   ├── demo_axes_rgb.py
|   |   ├── demo_colorbar_of_inset_axes.py
|   |   ├── demo_colorbar_with_axes_divider.py
|   |   ├── demo_colorbar_with_inset_locator.py
|   |   ├── demo_edge_colorbar.py
|   |   ├── demo_fixed_size_axes.py
|   |   ├── demo_imagegrid_aspect.py
|   |   ├── inset_locator_demo.py
|   |   ├── inset_locator_demo2.py
|   |   ├── make_room_for_ylabel_using_axesgrid.py
|   |   ├── parasite_simple.py
|   |   ├── parasite_simple2.py
|   |   ├── scatter_hist_locatable_axes.py
|   |   ├── simple_anchored_artists.py
|   |   ├── simple_axes_divider1.py
|   |   ├── simple_axes_divider3.py
|   |   ├── simple_axesgrid.py
|   |   ├── simple_axesgrid2.py
|   |   ├── simple_axisline4.py
|   |   └── simple_colorbar.py
|   ├── axisartist
|   |   ├── README.txt
|   |   ├── axis_direction.py
|   |   ├── demo_axis_direction.py
|   |   ├── demo_axisline_style.py
|   |   ├── demo_curvelinear_grid.py
|   |   ├── demo_curvelinear_grid2.py
|   |   ├── demo_floating_axes.py
|   |   ├── demo_floating_axis.py
|   |   ├── demo_parasite_axes.py
|   |   ├── demo_parasite_axes2.py
|   |   ├── demo_ticklabel_alignment.py
|   |   ├── demo_ticklabel_direction.py
|   |   ├── simple_axis_direction01.py
|   |   ├── simple_axis_direction03.py
|   |   ├── simple_axis_pad.py
|   |   ├── simple_axisartist1.py
|   |   ├── simple_axisline.py
|   |   └── simple_axisline3.py
|   ├── color
|   |   ├── README.txt
|   |   ├── color_by_yvalue.py
|   |   ├── color_cycle_default.py
|   |   ├── color_demo.py
|   |   ├── colorbar_basics.py
|   |   ├── colormap_reference.py
|   |   ├── custom_cmap.py
|   |   └── named_colors.py
|   ├── event_handling
|   |   ├── README.txt
|   |   ├── close_event.py
|   |   ├── coords_demo.py
|   |   ├── cursor_demo.py
|   |   ├── data_browser.py
|   |   ├── figure_axes_enter_leave.py
|   |   ├── ginput_manual_clabel_sgskip.py
|   |   ├── image_slices_viewer.py
|   |   ├── keypress_demo.py
|   |   ├── lasso_demo.py
|   |   ├── legend_picking.py
|   |   ├── looking_glass.py
|   |   ├── path_editor.py
|   |   ├── pick_event_demo.py
|   |   ├── pick_event_demo2.py
|   |   ├── poly_editor.py
|   |   ├── pong_sgskip.py
|   |   ├── resample.py
|   |   ├── timers.py
|   |   ├── trifinder_event_demo.py
|   |   ├── viewlims.py
|   |   └── zoom_window.py
|   ├── images_contours_and_fields
|   |   ├── README.txt
|   |   ├── affine_image.py
|   |   ├── barb_demo.py
|   |   ├── barcode_demo.py
|   |   ├── colormap_interactive_adjustment.py
|   |   ├── colormap_normalizations.py
|   |   ├── colormap_normalizations_symlognorm.py
|   |   ├── contour_corner_mask.py
|   |   ├── contour_demo.py
|   |   ├── contour_image.py
|   |   ├── contour_label_demo.py
|   |   ├── contourf_demo.py
|   |   ├── contourf_hatching.py
|   |   ├── contourf_log.py
|   |   ├── contours_in_optimization_demo.py
|   |   ├── demo_bboximage.py
|   |   ├── figimage_demo.py
|   |   ├── image_annotated_heatmap.py
|   |   ├── image_antialiasing.py
|   |   ├── image_clip_path.py
|   |   ├── image_demo.py
|   |   ├── image_masked.py
|   |   ├── image_nonuniform.py
|   |   ├── image_transparency_blend.py
|   |   ├── image_zcoord.py
|   |   ├── interpolation_methods.py
|   |   ├── irregulardatagrid.py
|   |   ├── layer_images.py
|   |   ├── matshow.py
|   |   ├── multi_image.py
|   |   ├── pcolor_demo.py
|   |   ├── pcolormesh_grids.py
|   |   ├── pcolormesh_levels.py
|   |   ├── plot_streamplot.py
|   |   ├── quadmesh_demo.py
|   |   ├── quiver_demo.py
|   |   ├── quiver_simple_demo.py
|   |   ├── shading_example.py
|   |   ├── specgram_demo.py
|   |   ├── spy_demos.py
|   |   ├── tricontour_demo.py
|   |   ├── tricontour_smooth_delaunay.py
|   |   ├── tricontour_smooth_user.py
|   |   ├── trigradient_demo.py
|   |   ├── triinterp_demo.py
|   |   ├── tripcolor_demo.py
|   |   ├── triplot_demo.py
|   |   └── watermark_image.py
|   ├── lines_bars_and_markers
|   |   ├── README.txt
|   |   ├── bar_colors.py
|   |   ├── bar_label_demo.py
|   |   ├── bar_stacked.py
|   |   ├── barchart.py
|   |   ├── barh.py
|   |   ├── broken_barh.py
|   |   ├── capstyle.py
|   |   ├── categorical_variables.py
|   |   ├── cohere.py
|   |   ├── csd_demo.py
|   |   ├── curve_error_band.py
|   |   ├── errorbar_limits_simple.py
|   |   ├── errorbar_subsample.py
|   |   ├── eventcollection_demo.py
|   |   ├── eventplot_demo.py
|   |   ├── fill.py
|   |   ├── fill_between_alpha.py
|   |   ├── fill_between_demo.py
|   |   ├── fill_betweenx_demo.py
|   |   ├── filled_step.py
|   |   ├── gradient_bar.py
|   |   ├── hat_graph.py
|   |   ├── horizontal_barchart_distribution.py
|   |   ├── joinstyle.py
|   |   ├── line_demo_dash_control.py
|   |   ├── lines_with_ticks_demo.py
|   |   ├── linestyles.py
|   |   ├── marker_reference.py
|   |   ├── markevery_demo.py
|   |   ├── masked_demo.py
|   |   ├── multicolored_line.py
|   |   ├── multivariate_marker_plot.py
|   |   ├── psd_demo.py
|   |   ├── scatter_custom_symbol.py
|   |   ├── scatter_demo2.py
|   |   ├── scatter_hist.py
|   |   ├── scatter_masked.py
|   |   ├── scatter_star_poly.py
|   |   ├── scatter_with_legend.py
|   |   ├── simple_plot.py
|   |   ├── span_regions.py
|   |   ├── spectrum_demo.py
|   |   ├── stackplot_demo.py
|   |   ├── stairs_demo.py
|   |   ├── stem_plot.py
|   |   ├── step_demo.py
|   |   ├── timeline.py
|   |   ├── vline_hline_demo.py
|   |   └── xcorr_acorr_demo.py
|   ├── misc
|   |   ├── README.txt
|   |   ├── anchored_artists.py
|   |   ├── bbox_intersect.py
|   |   ├── contour_manual.py
|   |   ├── coords_report.py
|   |   ├── custom_projection.py
|   |   ├── customize_rc.py
|   |   ├── demo_agg_filter.py
|   |   ├── demo_ribbon_box.py
|   |   ├── fig_x.py
|   |   ├── fill_spiral.py
|   |   ├── findobj_demo.py
|   |   ├── font_indexing.py
|   |   ├── ftface_props.py
|   |   ├── histogram_path.py
|   |   ├── hyperlinks_sgskip.py
|   |   ├── image_thumbnail_sgskip.py
|   |   ├── keyword_plotting.py
|   |   ├── logos2.py
|   |   ├── multipage_pdf.py
|   |   ├── multiprocess_sgskip.py
|   |   ├── packed_bubbles.py
|   |   ├── patheffect_demo.py
|   |   ├── print_stdout_sgskip.py
|   |   ├── rasterization_demo.py
|   |   ├── set_and_get.py
|   |   ├── svg_filter_line.py
|   |   ├── svg_filter_pie.py
|   |   ├── table_demo.py
|   |   ├── tickedstroke_demo.py
|   |   ├── transoffset.py
|   |   └── zorder_demo.py
|   ├── mplot3d
|   |   ├── 2dcollections3d.py
|   |   ├── 3d_bars.py
|   |   ├── README.txt
|   |   ├── bars3d.py
|   |   ├── box3d.py
|   |   ├── contour3d.py
|   |   ├── contour3d_2.py
|   |   ├── contour3d_3.py
|   |   ├── contourf3d.py
|   |   ├── contourf3d_2.py
|   |   ├── custom_shaded_3d_surface.py
|   |   ├── errorbar3d.py
|   |   ├── hist3d.py
|   |   ├── lines3d.py
|   |   ├── lorenz_attractor.py
|   |   ├── mixed_subplots.py
|   |   ├── offset.py
|   |   ├── pathpatch3d.py
|   |   ├── polys3d.py
|   |   ├── projections.py
|   |   ├── quiver3d.py
|   |   ├── rotate_axes3d_sgskip.py
|   |   ├── scatter3d.py
|   |   ├── stem3d_demo.py
|   |   ├── subplot3d.py
|   |   ├── surface3d.py
|   |   ├── surface3d_2.py
|   |   ├── surface3d_3.py
|   |   ├── surface3d_radial.py
|   |   ├── text3d.py
|   |   ├── tricontour3d.py
|   |   ├── tricontourf3d.py
|   |   ├── trisurf3d.py
|   |   ├── trisurf3d_2.py
|   |   ├── view_planes_3d.py
|   |   ├── voxels.py
|   |   ├── voxels_numpy_logo.py
|   |   ├── voxels_rgb.py
|   |   ├── voxels_torus.py
|   |   ├── wire3d.py
|   |   ├── wire3d_animation_sgskip.py
|   |   └── wire3d_zero_stride.py
|   ├── pie_and_polar_charts
|   |   ├── README.txt
|   |   ├── bar_of_pie.py
|   |   ├── nested_pie.py
|   |   ├── pie_and_donut_labels.py
|   |   ├── pie_demo2.py
|   |   ├── pie_features.py
|   |   ├── polar_bar.py
|   |   ├── polar_demo.py
|   |   ├── polar_error_caps.py
|   |   ├── polar_legend.py
|   |   └── polar_scatter.py
|   ├── pyplots
|   |   ├── README.txt
|   |   ├── axline.py
|   |   ├── pyplot_simple.py
|   |   ├── pyplot_text.py
|   |   ├── pyplot_three.py
|   |   └── pyplot_two_subplots.py
|   ├── scales
|   |   ├── README.txt
|   |   ├── asinh_demo.py
|   |   ├── aspect_loglog.py
|   |   ├── custom_scale.py
|   |   ├── log_bar.py
|   |   ├── log_demo.py
|   |   ├── logit_demo.py
|   |   ├── power_norm.py
|   |   ├── scales.py
|   |   ├── semilogx_demo.py
|   |   └── symlog_demo.py
|   ├── shapes_and_collections
|   |   ├── README.txt
|   |   ├── arrow_guide.py
|   |   ├── artist_reference.py
|   |   ├── collections.py
|   |   ├── compound_path.py
|   |   ├── dolphin.py
|   |   ├── donut.py
|   |   ├── ellipse_collection.py
|   |   ├── ellipse_demo.py
|   |   ├── fancybox_demo.py
|   |   ├── hatch_demo.py
|   |   ├── hatch_style_reference.py
|   |   ├── line_collection.py
|   |   ├── patch_collection.py
|   |   ├── path_patch.py
|   |   ├── quad_bezier.py
|   |   └── scatter.py
|   ├── showcase
|   |   ├── README.txt
|   |   ├── anatomy.py
|   |   ├── firefox.py
|   |   ├── integral.py
|   |   ├── mandelbrot.py
|   |   ├── stock_prices.py
|   |   └── xkcd.py
|   ├── specialty_plots
|   |   ├── README.txt
|   |   ├── advanced_hillshading.py
|   |   ├── anscombe.py
|   |   ├── hinton_demo.py
|   |   ├── leftventricle_bullseye.py
|   |   ├── mri_demo.py
|   |   ├── mri_with_eeg.py
|   |   ├── radar_chart.py
|   |   ├── sankey_basics.py
|   |   ├── sankey_links.py
|   |   ├── sankey_rankine.py
|   |   ├── skewt.py
|   |   └── topographic_hillshading.py
|   ├── spines
|   |   ├── README.txt
|   |   ├── centered_spines_with_arrows.py
|   |   ├── multiple_yaxis_with_spines.py
|   |   ├── spine_placement_demo.py
|   |   ├── spines.py
|   |   └── spines_dropped.py
|   ├── statistics
|   |   ├── README.txt
|   |   ├── barchart_demo.py
|   |   ├── boxplot.py
|   |   ├── boxplot_color.py
|   |   ├── boxplot_demo.py
|   |   ├── boxplot_vs_violin.py
|   |   ├── bxp.py
|   |   ├── confidence_ellipse.py
|   |   ├── customized_violin.py
|   |   ├── errorbar.py
|   |   ├── errorbar_features.py
|   |   ├── errorbar_limits.py
|   |   ├── errorbars_and_boxes.py
|   |   ├── hexbin_demo.py
|   |   ├── hist.py
|   |   ├── histogram_cumulative.py
|   |   ├── histogram_features.py
|   |   ├── histogram_histtypes.py
|   |   ├── histogram_multihist.py
|   |   ├── multiple_histograms_side_by_side.py
|   |   ├── time_series_histogram.py
|   |   └── violinplot.py
|   ├── style_sheets
|   |   ├── README.txt
|   |   ├── bmh.py
|   |   ├── dark_background.py
|   |   ├── fivethirtyeight.py
|   |   ├── ggplot.py
|   |   ├── grayscale.py
|   |   ├── plot_solarizedlight2.py
|   |   └── style_sheets_reference.py
|   ├── subplots_axes_and_figures
|   |   ├── README.txt
|   |   ├── align_labels_demo.py
|   |   ├── auto_subplots_adjust.py
|   |   ├── axes_box_aspect.py
|   |   ├── axes_demo.py
|   |   ├── axes_margins.py
|   |   ├── axes_props.py
|   |   ├── axes_zoom_effect.py
|   |   ├── axhspan_demo.py
|   |   ├── axis_equal_demo.py
|   |   ├── axis_labels_demo.py
|   |   ├── broken_axis.py
|   |   ├── colorbar_placement.py
|   |   ├── custom_figure_class.py
|   |   ├── demo_constrained_layout.py
|   |   ├── demo_tight_layout.py
|   |   ├── fahrenheit_celsius_scales.py
|   |   ├── figure_size_units.py
|   |   ├── figure_title.py
|   |   ├── ganged_plots.py
|   |   ├── geo_demo.py
|   |   ├── gridspec_and_subplots.py
|   |   ├── gridspec_multicolumn.py
|   |   ├── gridspec_nested.py
|   |   ├── invert_axes.py
|   |   ├── mosaic.py
|   |   ├── multiple_figs_demo.py
|   |   ├── secondary_axis.py
|   |   ├── share_axis_lims_views.py
|   |   ├── shared_axis_demo.py
|   |   ├── subfigures.py
|   |   ├── subplot.py
|   |   ├── subplots_adjust.py
|   |   ├── subplots_demo.py
|   |   ├── two_scales.py
|   |   └── zoom_inset_axes.py
|   ├── text_labels_and_annotations
|   |   ├── README.txt
|   |   ├── accented_text.py
|   |   ├── align_ylabels.py
|   |   ├── angle_annotation.py
|   |   ├── angles_on_bracket_arrows.py
|   |   ├── annotate_transform.py
|   |   ├── annotation_basic.py
|   |   ├── annotation_demo.py
|   |   ├── annotation_polar.py
|   |   ├── arrow_demo.py
|   |   ├── autowrap.py
|   |   ├── custom_legends.py
|   |   ├── date.py
|   |   ├── demo_annotation_box.py
|   |   ├── demo_text_path.py
|   |   ├── demo_text_rotation_mode.py
|   |   ├── dfrac_demo.py
|   |   ├── engineering_formatter.py
|   |   ├── fancyarrow_demo.py
|   |   ├── fancytextbox_demo.py
|   |   ├── figlegend_demo.py
|   |   ├── font_family_rc.py
|   |   ├── font_file.py
|   |   ├── font_table.py
|   |   ├── fonts_demo.py
|   |   ├── fonts_demo_kw.py
|   |   ├── label_subplots.py
|   |   ├── legend.py
|   |   ├── legend_demo.py
|   |   ├── line_with_text.py
|   |   ├── mathtext_asarray.py
|   |   ├── mathtext_demo.py
|   |   ├── mathtext_examples.py
|   |   ├── mathtext_fontfamily_example.py
|   |   ├── multiline.py
|   |   ├── placing_text_boxes.py
|   |   ├── rainbow_text.py
|   |   ├── stix_fonts_demo.py
|   |   ├── tex_demo.py
|   |   ├── text_alignment.py
|   |   ├── text_commands.py
|   |   ├── text_fontdict.py
|   |   ├── text_rotation_relative_to_line.py
|   |   ├── titles_demo.py
|   |   ├── unicode_minus.py
|   |   ├── usetex_baseline_test.py
|   |   ├── usetex_fonteffects.py
|   |   └── watermark_text.py
|   ├── ticks
|   |   ├── README.txt
|   |   ├── auto_ticks.py
|   |   ├── centered_ticklabels.py
|   |   ├── colorbar_tick_labelling_demo.py
|   |   ├── custom_ticker1.py
|   |   ├── date_concise_formatter.py
|   |   ├── date_demo_convert.py
|   |   ├── date_demo_rrule.py
|   |   ├── date_formatters_locators.py
|   |   ├── date_index_formatter.py
|   |   ├── date_precision_and_epochs.py
|   |   ├── dollar_ticks.py
|   |   ├── fig_axes_customize_simple.py
|   |   ├── major_minor_demo.py
|   |   ├── scalarformatter.py
|   |   ├── tick-formatters.py
|   |   ├── tick-locators.py
|   |   ├── tick_label_right.py
|   |   ├── tick_labels_from_values.py
|   |   ├── tick_xlabel_top.py
|   |   ├── ticklabels_rotation.py
|   |   └── ticks_too_many.py
|   ├── units
|   |   ├── README.txt
|   |   ├── annotate_with_units.py
|   |   ├── artist_tests.py
|   |   ├── bar_demo2.py
|   |   ├── bar_unit_demo.py
|   |   ├── basic_units.py
|   |   ├── ellipse_with_units.py
|   |   ├── evans_test.py
|   |   ├── radian_demo.py
|   |   ├── units_sample.py
|   |   └── units_scatter.py
|   ├── user_interfaces
|   |   ├── README.txt
|   |   ├── canvasagg.py
|   |   ├── embedding_in_gtk3_panzoom_sgskip.py
|   |   ├── embedding_in_gtk3_sgskip.py
|   |   ├── embedding_in_gtk4_panzoom_sgskip.py
|   |   ├── embedding_in_gtk4_sgskip.py
|   |   ├── embedding_in_qt_sgskip.py
|   |   ├── embedding_in_tk_sgskip.py
|   |   ├── embedding_in_wx2_sgskip.py
|   |   ├── embedding_in_wx3_sgskip.py
|   |   ├── embedding_in_wx4_sgskip.py
|   |   ├── embedding_in_wx5_sgskip.py
|   |   ├── embedding_webagg_sgskip.py
|   |   ├── fourier_demo_wx_sgskip.py
|   |   ├── gtk3_spreadsheet_sgskip.py
|   |   ├── gtk4_spreadsheet_sgskip.py
|   |   ├── images
|   |   ├── mathtext_wx_sgskip.py
|   |   ├── mpl_with_glade3_sgskip.py
|   |   ├── mplcvd.py
|   |   ├── pylab_with_gtk3_sgskip.py
|   |   ├── pylab_with_gtk4_sgskip.py
|   |   ├── svg_histogram_sgskip.py
|   |   ├── svg_tooltip_sgskip.py
|   |   ├── toolmanager_sgskip.py
|   |   ├── web_application_server_sgskip.py
|   |   └── wxcursor_demo_sgskip.py
|   ├── userdemo
|   |   ├── README.txt
|   |   ├── anchored_box04.py
|   |   ├── annotate_explain.py
|   |   ├── annotate_simple01.py
|   |   ├── annotate_simple02.py
|   |   ├── annotate_simple03.py
|   |   ├── annotate_simple04.py
|   |   ├── annotate_simple_coord01.py
|   |   ├── annotate_simple_coord02.py
|   |   ├── annotate_simple_coord03.py
|   |   ├── annotate_text_arrow.py
|   |   ├── connect_simple01.py
|   |   ├── connectionstyle_demo.py
|   |   ├── custom_boxstyle01.py
|   |   ├── demo_gridspec01.py
|   |   ├── demo_gridspec03.py
|   |   ├── demo_gridspec06.py
|   |   ├── pgf_fonts.py
|   |   ├── pgf_preamble_sgskip.py
|   |   ├── pgf_texsystem.py
|   |   ├── simple_annotate01.py
|   |   ├── simple_legend01.py
|   |   └── simple_legend02.py
|   └── widgets
|       ├── README.txt
|       ├── annotated_cursor.py
|       ├── buttons.py
|       ├── check_buttons.py
|       ├── cursor.py
|       ├── lasso_selector_demo_sgskip.py
|       ├── menu.py
|       ├── mouse_cursor.py
|       ├── multicursor.py
|       ├── polygon_selector_demo.py
|       ├── polygon_selector_simple.py
|       ├── radio_buttons.py
|       ├── range_slider.py
|       ├── rectangle_selector.py
|       ├── slider_demo.py
|       ├── slider_snap_demo.py
|       ├── span_selector.py
|       └── textbox.py
├── extern
|   ├── agg24-svn
|   |   ├── include
|   |   |   ├── ctrl
|   |   |   ├── platform
|   |   |   |   ├── mac
|   |   |   |   └── win32
|   |   |   └── util
|   |   └── src
|   |       ├── agg_arc.cpp
|   |       ├── agg_arrowhead.cpp
|   |       ├── agg_bezier_arc.cpp
|   |       ├── agg_bspline.cpp
|   |       ├── agg_color_rgba.cpp
|   |       ├── agg_curves.cpp
|   |       ├── agg_embedded_raster_fonts.cpp
|   |       ├── agg_gsv_text.cpp
|   |       ├── agg_image_filters.cpp
|   |       ├── agg_line_aa_basics.cpp
|   |       ├── agg_line_profile_aa.cpp
|   |       ├── agg_rounded_rect.cpp
|   |       ├── agg_sqrt_tables.cpp
|   |       ├── agg_trans_affine.cpp
|   |       ├── agg_trans_double_path.cpp
|   |       ├── agg_trans_single_path.cpp
|   |       ├── agg_trans_warp_magnifier.cpp
|   |       ├── agg_vcgen_bspline.cpp
|   |       ├── agg_vcgen_contour.cpp
|   |       ├── agg_vcgen_dash.cpp
|   |       ├── agg_vcgen_markers_term.cpp
|   |       ├── agg_vcgen_smooth_poly1.cpp
|   |       ├── agg_vcgen_stroke.cpp
|   |       ├── agg_vpgen_clip_polygon.cpp
|   |       ├── agg_vpgen_clip_polyline.cpp
|   |       ├── agg_vpgen_segmentator.cpp
|   |       ├── ctrl
|   |       |   ├── agg_bezier_ctrl.cpp
|   |       |   ├── agg_cbox_ctrl.cpp
|   |       |   ├── agg_gamma_ctrl.cpp
|   |       |   ├── agg_gamma_spline.cpp
|   |       |   ├── agg_polygon_ctrl.cpp
|   |       |   ├── agg_rbox_ctrl.cpp
|   |       |   ├── agg_scale_ctrl.cpp
|   |       |   ├── agg_slider_ctrl.cpp
|   |       |   └── agg_spline_ctrl.cpp
|   |       └── platform
|   |           ├── AmigaOS
|   |           ├── BeOS
|   |           ├── X11
|   |           ├── mac
|   |           ├── sdl
|   |           └── win32
|   └── ttconv
|       ├── pprdrv_tt.cpp
|       ├── pprdrv_tt2.cpp
|       └── ttutil.cpp
├── lib
|   ├── matplotlib
|   |   ├── __init__.py
|   |   ├── _afm.py
|   |   ├── _animation_data.py
|   |   ├── _api
|   |   |   ├── __init__.py
|   |   |   └── deprecation.py
|   |   ├── _blocking_input.py
|   |   ├── _cm.py
|   |   ├── _cm_listed.py
|   |   ├── _color_data.py
|   |   ├── _constrained_layout.py
|   |   ├── _docstring.py
|   |   ├── _enums.py
|   |   ├── _fontconfig_pattern.py
|   |   ├── _internal_utils.py
|   |   ├── _layoutgrid.py
|   |   ├── _mathtext.py
|   |   ├── _mathtext_data.py
|   |   ├── _pylab_helpers.py
|   |   ├── _text_helpers.py
|   |   ├── _tight_bbox.py
|   |   ├── _tight_layout.py
|   |   ├── _type1font.py
|   |   ├── animation.py
|   |   ├── artist.py
|   |   ├── axes
|   |   |   ├── __init__.py
|   |   |   ├── _axes.py
|   |   |   ├── _base.py
|   |   |   └── _secondary_axes.py
|   |   ├── axis.py
|   |   ├── backend_bases.py
|   |   ├── backend_managers.py
|   |   ├── backend_tools.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── _backend_gtk.py
|   |   |   ├── _backend_pdf_ps.py
|   |   |   ├── _backend_tk.py
|   |   |   ├── backend_agg.py
|   |   |   ├── backend_cairo.py
|   |   |   ├── backend_gtk3.py
|   |   |   ├── backend_gtk3agg.py
|   |   |   ├── backend_gtk3cairo.py
|   |   |   ├── backend_gtk4.py
|   |   |   ├── backend_gtk4agg.py
|   |   |   ├── backend_gtk4cairo.py
|   |   |   ├── backend_macosx.py
|   |   |   ├── backend_mixed.py
|   |   |   ├── backend_nbagg.py
|   |   |   ├── backend_pdf.py
|   |   |   ├── backend_pgf.py
|   |   |   ├── backend_ps.py
|   |   |   ├── backend_qt.py
|   |   |   ├── backend_qt5.py
|   |   |   ├── backend_qt5agg.py
|   |   |   ├── backend_qt5cairo.py
|   |   |   ├── backend_qtagg.py
|   |   |   ├── backend_qtcairo.py
|   |   |   ├── backend_svg.py
|   |   |   ├── backend_template.py
|   |   |   ├── backend_tkagg.py
|   |   |   ├── backend_tkcairo.py
|   |   |   ├── backend_webagg.py
|   |   |   ├── backend_webagg_core.py
|   |   |   ├── backend_wx.py
|   |   |   ├── backend_wxagg.py
|   |   |   ├── backend_wxcairo.py
|   |   |   ├── qt_compat.py
|   |   |   ├── qt_editor
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _formlayout.py
|   |   |   |   └── figureoptions.py
|   |   |   └── web_backend
|   |   |       ├── .eslintrc.js
|   |   |       ├── all_figures.html
|   |   |       ├── css
|   |   |       ├── ipython_inline_figure.html
|   |   |       ├── js
|   |   |       └── single_figure.html
|   |   ├── bezier.py
|   |   ├── category.py
|   |   ├── cbook.py
|   |   ├── cm.py
|   |   ├── collections.py
|   |   ├── colorbar.py
|   |   ├── colors.py
|   |   ├── container.py
|   |   ├── contour.py
|   |   ├── dates.py
|   |   ├── dviread.py
|   |   ├── figure.py
|   |   ├── font_manager.py
|   |   ├── gridspec.py
|   |   ├── hatch.py
|   |   ├── image.py
|   |   ├── layout_engine.py
|   |   ├── legend.py
|   |   ├── legend_handler.py
|   |   ├── lines.py
|   |   ├── markers.py
|   |   ├── mathtext.py
|   |   ├── mlab.py
|   |   ├── mpl-data
|   |   |   ├── fonts
|   |   |   |   ├── afm
|   |   |   |   ├── pdfcorefonts
|   |   |   |   └── ttf
|   |   |   ├── images
|   |   |   ├── plot_directive
|   |   |   |   └── plot_directive.css
|   |   |   ├── sample_data
|   |   |   |   ├── README.txt
|   |   |   |   └── axes_grid
|   |   |   └── stylelib
|   |   ├── offsetbox.py
|   |   ├── patches.py
|   |   ├── path.py
|   |   ├── patheffects.py
|   |   ├── projections
|   |   |   ├── __init__.py
|   |   |   ├── geo.py
|   |   |   └── polar.py
|   |   ├── pylab.py
|   |   ├── pyplot.py
|   |   ├── quiver.py
|   |   ├── rcsetup.py
|   |   ├── sankey.py
|   |   ├── scale.py
|   |   ├── sphinxext
|   |   |   ├── __init__.py
|   |   |   ├── mathmpl.py
|   |   |   └── plot_directive.py
|   |   ├── spines.py
|   |   ├── stackplot.py
|   |   ├── streamplot.py
|   |   ├── style
|   |   |   ├── __init__.py
|   |   |   └── core.py
|   |   ├── table.py
|   |   ├── testing
|   |   |   ├── __init__.py
|   |   |   ├── _markers.py
|   |   |   ├── compare.py
|   |   |   ├── conftest.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── jpl_units
|   |   |   |   ├── Duration.py
|   |   |   |   ├── Epoch.py
|   |   |   |   ├── EpochConverter.py
|   |   |   |   ├── StrConverter.py
|   |   |   |   ├── UnitDbl.py
|   |   |   |   ├── UnitDblConverter.py
|   |   |   |   ├── UnitDblFormatter.py
|   |   |   |   └── __init__.py
|   |   |   └── widgets.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── baseline_images
|   |   |   |   ├── dviread
|   |   |   |   ├── pngsuite
|   |   |   |   ├── test_agg
|   |   |   |   ├── test_agg_filter
|   |   |   |   ├── test_arrow_patches
|   |   |   |   ├── test_artist
|   |   |   |   ├── test_axes
|   |   |   |   ├── test_backend_pdf
|   |   |   |   ├── test_backend_pgf
|   |   |   |   ├── test_backend_ps
|   |   |   |   ├── test_backend_svg
|   |   |   |   ├── test_bbox_tight
|   |   |   |   ├── test_collections
|   |   |   |   ├── test_colorbar
|   |   |   |   ├── test_colors
|   |   |   |   ├── test_compare_images
|   |   |   |   ├── test_constrainedlayout
|   |   |   |   ├── test_contour
|   |   |   |   ├── test_dates
|   |   |   |   ├── test_figure
|   |   |   |   ├── test_image
|   |   |   |   ├── test_legend
|   |   |   |   ├── test_lines
|   |   |   |   ├── test_mathtext
|   |   |   |   ├── test_offsetbox
|   |   |   |   ├── test_patches
|   |   |   |   ├── test_path
|   |   |   |   ├── test_patheffects
|   |   |   |   ├── test_png
|   |   |   |   ├── test_polar
|   |   |   |   ├── test_quiver
|   |   |   |   ├── test_scale
|   |   |   |   ├── test_simplification
|   |   |   |   ├── test_skew
|   |   |   |   ├── test_spines
|   |   |   |   ├── test_streamplot
|   |   |   |   ├── test_subplots
|   |   |   |   ├── test_table
|   |   |   |   ├── test_text
|   |   |   |   ├── test_tightlayout
|   |   |   |   ├── test_transforms
|   |   |   |   ├── test_triangulation
|   |   |   |   ├── test_ttconv
|   |   |   |   ├── test_units
|   |   |   |   ├── test_usetex
|   |   |   |   └── test_widgets
|   |   |   ├── conftest.py
|   |   |   ├── test_afm.py
|   |   |   ├── test_agg.py
|   |   |   ├── test_agg_filter.py
|   |   |   ├── test_animation.py
|   |   |   ├── test_api.py
|   |   |   ├── test_arrow_patches.py
|   |   |   ├── test_artist.py
|   |   |   ├── test_axes.py
|   |   |   ├── test_backend_bases.py
|   |   |   ├── test_backend_cairo.py
|   |   |   ├── test_backend_gtk3.py
|   |   |   ├── test_backend_macosx.py
|   |   |   ├── test_backend_nbagg.py
|   |   |   ├── test_backend_pdf.py
|   |   |   ├── test_backend_pgf.py
|   |   |   ├── test_backend_ps.py
|   |   |   ├── test_backend_qt.py
|   |   |   ├── test_backend_svg.py
|   |   |   ├── test_backend_template.py
|   |   |   ├── test_backend_tk.py
|   |   |   ├── test_backend_tools.py
|   |   |   ├── test_backend_webagg.py
|   |   |   ├── test_backends_interactive.py
|   |   |   ├── test_basic.py
|   |   |   ├── test_bbox_tight.py
|   |   |   ├── test_category.py
|   |   |   ├── test_cbook.py
|   |   |   ├── test_collections.py
|   |   |   ├── test_colorbar.py
|   |   |   ├── test_colors.py
|   |   |   ├── test_compare_images.py
|   |   |   ├── test_constrainedlayout.py
|   |   |   ├── test_container.py
|   |   |   ├── test_contour.py
|   |   |   ├── test_cycles.py
|   |   |   ├── test_dates.py
|   |   |   ├── test_determinism.py
|   |   |   ├── test_doc.py
|   |   |   ├── test_dviread.py
|   |   |   ├── test_figure.py
|   |   |   ├── test_font_manager.py
|   |   |   ├── test_fontconfig_pattern.py
|   |   |   ├── test_ft2font.py
|   |   |   ├── test_getattr.py
|   |   |   ├── test_gridspec.py
|   |   |   ├── test_image.py
|   |   |   ├── test_legend.py
|   |   |   ├── test_lines.py
|   |   |   ├── test_marker.py
|   |   |   ├── test_mathtext.py
|   |   |   ├── test_matplotlib.py
|   |   |   ├── test_mlab.py
|   |   |   ├── test_offsetbox.py
|   |   |   ├── test_patches.py
|   |   |   ├── test_path.py
|   |   |   ├── test_patheffects.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_png.py
|   |   |   ├── test_polar.py
|   |   |   ├── test_preprocess_data.py
|   |   |   ├── test_pyplot.py
|   |   |   ├── test_quiver.py
|   |   |   ├── test_rcparams.py
|   |   |   ├── test_sankey.py
|   |   |   ├── test_scale.py
|   |   |   ├── test_simplification.py
|   |   |   ├── test_skew.py
|   |   |   ├── test_sphinxext.py
|   |   |   ├── test_spines.py
|   |   |   ├── test_streamplot.py
|   |   |   ├── test_style.py
|   |   |   ├── test_subplots.py
|   |   |   ├── test_table.py
|   |   |   ├── test_testing.py
|   |   |   ├── test_texmanager.py
|   |   |   ├── test_text.py
|   |   |   ├── test_textpath.py
|   |   |   ├── test_ticker.py
|   |   |   ├── test_tightlayout.py
|   |   |   ├── test_transforms.py
|   |   |   ├── test_triangulation.py
|   |   |   ├── test_ttconv.py
|   |   |   ├── test_type1font.py
|   |   |   ├── test_units.py
|   |   |   ├── test_usetex.py
|   |   |   ├── test_widgets.py
|   |   |   └── tinypages
|   |   |       ├── README.md
|   |   |       ├── _static
|   |   |       ├── conf.py
|   |   |       ├── included_plot_21.rst
|   |   |       ├── index.rst
|   |   |       ├── range4.py
|   |   |       ├── range6.py
|   |   |       └── some_plots.rst
|   |   ├── texmanager.py
|   |   ├── text.py
|   |   ├── textpath.py
|   |   ├── ticker.py
|   |   ├── transforms.py
|   |   ├── tri
|   |   |   ├── __init__.py
|   |   |   ├── _triangulation.py
|   |   |   ├── _tricontour.py
|   |   |   ├── _trifinder.py
|   |   |   ├── _triinterpolate.py
|   |   |   ├── _tripcolor.py
|   |   |   ├── _triplot.py
|   |   |   ├── _trirefine.py
|   |   |   ├── _tritools.py
|   |   |   ├── triangulation.py
|   |   |   ├── tricontour.py
|   |   |   ├── trifinder.py
|   |   |   ├── triinterpolate.py
|   |   |   ├── tripcolor.py
|   |   |   ├── triplot.py
|   |   |   ├── trirefine.py
|   |   |   └── tritools.py
|   |   ├── units.py
|   |   └── widgets.py
|   ├── mpl_toolkits
|   |   ├── __init__.py
|   |   ├── axes_grid1
|   |   |   ├── __init__.py
|   |   |   ├── anchored_artists.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axes_size.py
|   |   |   ├── inset_locator.py
|   |   |   ├── mpl_axes.py
|   |   |   ├── parasite_axes.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── baseline_images
|   |   |       ├── conftest.py
|   |   |       └── test_axes_grid1.py
|   |   ├── axisartist
|   |   |   ├── __init__.py
|   |   |   ├── angle_helper.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axis_artist.py
|   |   |   ├── axisline_style.py
|   |   |   ├── axislines.py
|   |   |   ├── floating_axes.py
|   |   |   ├── grid_finder.py
|   |   |   ├── grid_helper_curvelinear.py
|   |   |   ├── parasite_axes.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── baseline_images
|   |   |       ├── conftest.py
|   |   |       ├── test_angle_helper.py
|   |   |       ├── test_axis_artist.py
|   |   |       ├── test_axislines.py
|   |   |       ├── test_floating_axes.py
|   |   |       ├── test_grid_finder.py
|   |   |       └── test_grid_helper_curvelinear.py
|   |   └── mplot3d
|   |       ├── __init__.py
|   |       ├── art3d.py
|   |       ├── axes3d.py
|   |       ├── axis3d.py
|   |       ├── proj3d.py
|   |       └── tests
|   |           ├── __init__.py
|   |           ├── baseline_images
|   |           ├── conftest.py
|   |           ├── test_art3d.py
|   |           ├── test_axes3d.py
|   |           └── test_legend3d.py
|   └── pylab.py
├── plot_types
|   ├── 3D
|   |   ├── README.rst
|   |   ├── scatter3d_simple.py
|   |   ├── surface3d_simple.py
|   |   ├── trisurf3d_simple.py
|   |   ├── voxels_simple.py
|   |   └── wire3d_simple.py
|   ├── README.rst
|   ├── arrays
|   |   ├── README.rst
|   |   ├── barbs.py
|   |   ├── contour.py
|   |   ├── contourf.py
|   |   ├── imshow.py
|   |   ├── pcolormesh.py
|   |   ├── quiver.py
|   |   └── streamplot.py
|   ├── basic
|   |   ├── README.rst
|   |   ├── bar.py
|   |   ├── fill_between.py
|   |   ├── plot.py
|   |   ├── scatter_plot.py
|   |   ├── stackplot.py
|   |   ├── stem.py
|   |   └── step.py
|   ├── stats
|   |   ├── README.rst
|   |   ├── boxplot_plot.py
|   |   ├── errorbar_plot.py
|   |   ├── eventplot.py
|   |   ├── hexbin.py
|   |   ├── hist2d.py
|   |   ├── hist_plot.py
|   |   ├── pie.py
|   |   └── violin.py
|   └── unstructured
|       ├── README.rst
|       ├── tricontour.py
|       ├── tricontourf.py
|       ├── tripcolor.py
|       └── triplot.py
├── requirements
|   ├── dev
|   |   └── dev-requirements.txt
|   ├── doc
|   |   └── doc-requirements.txt
|   └── testing
|       ├── all.txt
|       ├── extra.txt
|       ├── flake8.txt
|       └── minver.txt
├── setup.py
├── setupext.py
├── src
|   ├── _backend_agg.cpp
|   ├── _backend_agg_wrapper.cpp
|   ├── _c_internal_utils.c
|   ├── _image_wrapper.cpp
|   ├── _path_wrapper.cpp
|   ├── _qhull_wrapper.cpp
|   ├── _tkagg.cpp
|   ├── _ttconv.cpp
|   ├── checkdep_freetype2.c
|   ├── doc
|   ├── ft2font.cpp
|   ├── ft2font_wrapper.cpp
|   ├── py_converters.cpp
|   └── tri
|       ├── _tri.cpp
|       └── _tri_wrapper.cpp
├── tools
|   ├── README.txt
|   ├── boilerplate.py
|   ├── cache_zenodo_svg.py
|   ├── create_DejaVuDisplay.sh
|   ├── embed_js.py
|   ├── gh_api.py
|   ├── github_stats.py
|   ├── make_icons.py
|   ├── memleak.py
|   ├── run_examples.py
|   ├── subset.py
|   ├── triage_tests.py
|   └── visualize_tests.py
└── tutorials
    ├── README.txt
    ├── advanced
    |   ├── README.txt
    |   ├── blitting.py
    |   ├── path_tutorial.py
    |   ├── patheffects_guide.py
    |   └── transforms_tutorial.py
    ├── colors
    |   ├── README.txt
    |   ├── colorbar_only.py
    |   ├── colormap-manipulation.py
    |   ├── colormapnorms.py
    |   ├── colormaps.py
    |   └── colors.py
    ├── intermediate
    |   ├── README.txt
    |   ├── arranging_axes.py
    |   ├── artists.py
    |   ├── autoscale.py
    |   ├── color_cycle.py
    |   ├── constrainedlayout_guide.py
    |   ├── imshow_extent.py
    |   ├── legend_guide.py
    |   └── tight_layout_guide.py
    ├── introductory
    |   ├── README.txt
    |   ├── animation_tutorial.py
    |   ├── customizing.py
    |   ├── images.py
    |   ├── lifecycle.py
    |   ├── pyplot.py
    |   └── quick_start.py
    ├── provisional
    |   └── README.txt
    ├── text
    |   ├── README.txt
    |   ├── annotations.py
    |   ├── mathtext.py
    |   ├── pgf.py
    |   ├── text_intro.py
    |   ├── text_props.py
    |   └── usetex.py
    └── toolkits
        ├── README.txt
        ├── axes_grid.py
        ├── axisartist.py
        └── mplot3d.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: [Bug]: Windows correction is not correct in `mlab._spectral_helper`

Description: ### Bug summary

Windows correction is not correct in `mlab._spectral_helper`:
https://github.com/matplotlib/matplotlib/blob/3418bada1c1f44da1f73916c5603e3ae79fe58c1/lib/matplotlib/mlab.py#L423-L430

The `np.abs` is not needed, and give wrong result for window with negative value, such as `flattop`.
For reference, the implementation of scipy can be found here :
https://github.com/scipy/scipy/blob/d9f75db82fdffef06187c9d8d2f0f5b36c7a791b/scipy/signal/_spectral_py.py#L1854-L1859

### Code for reproduction

```python
import numpy as np
from scipy import signal
window = signal.windows.flattop(512)
print(np.abs(window).sum()**2-window.sum()**2)
```


### Actual outcome

4372.942556173262

### Expected outcome

0

### Additional information

_No response_

### Operating system

_No response_

### Matplotlib Version

latest

### Matplotlib Backend

_No response_

### Python version

_No response_

### Jupyter version

_No response_

### Installation

None

Patch information:
diff --git a/lib/matplotlib/mlab.py b/lib/matplotlib/mlab.py
index 3552904c3d..efa2f84cae 100644
--- a/lib/matplotlib/mlab.py
+++ b/lib/matplotlib/mlab.py
@@ -395,12 +395,12 @@ def _spectral_helper(x, y=None, NFFT=None, Fs=None, detrend_func=None,
     elif mode == 'psd':
         result = np.conj(result) * result
     elif mode == 'magnitude':
-        result = np.abs(result) / np.abs(window).sum()
+        result = np.abs(result) / window.sum()
     elif mode == 'angle' or mode == 'phase':
         # we unwrap the phase later to handle the onesided vs. twosided case
         result = np.angle(result)
     elif mode == 'complex':
-        result /= np.abs(window).sum()
+        result /= window.sum()
 
     if mode == 'psd':
 
@@ -424,10 +424,10 @@ def _spectral_helper(x, y=None, NFFT=None, Fs=None, detrend_func=None,
             result /= Fs
             # Scale the spectrum by the norm of the window to compensate for
             # windowing loss; see Bendat & Piersol Sec 11.5.2.
-            result /= (np.abs(window)**2).sum()
+            result /= (window**2).sum()
         else:
             # In this case, preserve power in the segment, not amplitude
-            result /= np.abs(window).sum()**2
+            result /= window.sum()**2
 
     t = np.arange(NFFT/2, len(x) - NFFT/2 + 1, NFFT - noverlap)/Fs
 


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of lib/matplotlib/tests/test_mlab.py
Extra Requirements: 
Purpose: I need to analyze the tests in this file to find 3 test cases that are relevant to the spectral analysis functionality and window correction bug described in the user query.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: lib/matplotlib/tests/test_mlab.py
Line number range: 1 - 1074
Content:
1. from numpy.testing import (assert_allclose, assert_almost_equal,
2.                            assert_array_equal, assert_array_almost_equal_nulp)
3. import numpy as np
4. import pytest
5. 
6. from matplotlib import mlab, _api
7. 
8. 
9. class TestStride:
10.     def get_base(self, x):
11.         y = x
12.         while y.base is not None:
13.             y = y.base
14.         return y
15. 
16.     @pytest.fixture(autouse=True)
17.     def stride_is_deprecated(self):
18.         with _api.suppress_matplotlib_deprecation_warning():
19.             yield
20. 
21.     def calc_window_target(self, x, NFFT, noverlap=0, axis=0):
22.         """
23.         This is an adaptation of the original window extraction algorithm.
24.         This is here to test to make sure the new implementation has the same
25.         result.
26.         """
27.         step = NFFT - noverlap
28.         ind = np.arange(0, len(x) - NFFT + 1, step)
29.         n = len(ind)
30.         result = np.zeros((NFFT, n))
31. 
32.         # do the ffts of the slices
33.         for i in range(n):
34.             result[:, i] = x[ind[i]:ind[i]+NFFT]
35.         if axis == 1:
36.             result = result.T
37.         return result
38. 
39.     @pytest.mark.parametrize('shape', [(), (10, 1)], ids=['0D', '2D'])
40.     def test_stride_windows_invalid_input_shape(self, shape):
41.         x = np.arange(np.prod(shape)).reshape(shape)
42.         with pytest.raises(ValueError):
43.             mlab.stride_windows(x, 5)
44. 
45.     @pytest.mark.parametrize('n, noverlap',
46.                              [(0, None), (11, None), (2, 2), (2, 3)],
47.                              ids=['n less than 1', 'n greater than input',
48.                                   'noverlap greater than n',
49.                                   'noverlap equal to n'])
50.     def test_stride_windows_invalid_params(self, n, noverlap):
51.         x = np.arange(10)
52.         with pytest.raises(ValueError):
53.             mlab.stride_windows(x, n, noverlap)
54. 
55.     @pytest.mark.parametrize('axis', [0, 1], ids=['axis0', 'axis1'])
56.     @pytest.mark.parametrize('n, noverlap',
57.                              [(1, 0), (5, 0), (15, 2), (13, -3)],
58.                              ids=['n1-noverlap0', 'n5-noverlap0',
59.                                   'n15-noverlap2', 'n13-noverlapn3'])
60.     def test_stride_windows(self, n, noverlap, axis):
61.         x = np.arange(100)
62.         y = mlab.stride_windows(x, n, noverlap=noverlap, axis=axis)
63. 
64.         expected_shape = [0, 0]
65.         expected_shape[axis] = n
66.         expected_shape[1 - axis] = 100 // (n - noverlap)
67.         yt = self.calc_window_target(x, n, noverlap=noverlap, axis=axis)
68. 
69.         assert yt.shape == y.shape
70.         assert_array_equal(yt, y)
71.         assert tuple(expected_shape) == y.shape
72.         assert self.get_base(y) is x
73. 
74.     @pytest.mark.parametrize('axis', [0, 1], ids=['axis0', 'axis1'])
75.     def test_stride_windows_n32_noverlap0_unflatten(self, axis):
76.         n = 32
77.         x = np.arange(n)[np.newaxis]
78.         x1 = np.tile(x, (21, 1))
79.         x2 = x1.flatten()
80.         y = mlab.stride_windows(x2, n, axis=axis)
81. 
82.         if axis == 0:
83.             x1 = x1.T
84.         assert y.shape == x1.shape
85.         assert_array_equal(y, x1)
86. 
87. 
88. def test_window():
89.     np.random.seed(0)
90.     n = 1000
91.     rand = np.random.standard_normal(n) + 100
92.     ones = np.ones(n)
93.     assert_array_equal(mlab.window_none(ones), ones)
94.     assert_array_equal(mlab.window_none(rand), rand)
95.     assert_array_equal(np.hanning(len(rand)) * rand, mlab.window_hanning(rand))
96.     assert_array_equal(np.hanning(len(ones)), mlab.window_hanning(ones))
97. 
98. 
99. class TestDetrend:
100.     def setup_method(self):
101.         np.random.seed(0)
102.         n = 1000
103.         x = np.linspace(0., 100, n)
104. 
105.         self.sig_zeros = np.zeros(n)
106. 
107.         self.sig_off = self.sig_zeros + 100.
108.         self.sig_slope = np.linspace(-10., 90., n)
109.         self.sig_slope_mean = x - x.mean()
110. 
111.         self.sig_base = (
112.             np.random.standard_normal(n) + np.sin(x*2*np.pi/(n/100)))
113.         self.sig_base -= self.sig_base.mean()
114. 
115.     def allclose(self, *args):
116.         assert_allclose(*args, atol=1e-8)
117. 
118.     def test_detrend_none(self):
119.         assert mlab.detrend_none(0.) == 0.
120.         assert mlab.detrend_none(0., axis=1) == 0.
121.         assert mlab.detrend(0., key="none") == 0.
122.         assert mlab.detrend(0., key=mlab.detrend_none) == 0.
123.         for sig in [
124.                 5.5, self.sig_off, self.sig_slope, self.sig_base,
125.                 (self.sig_base + self.sig_slope + self.sig_off).tolist(),
126.                 np.vstack([self.sig_base,  # 2D case.
127.                            self.sig_base + self.sig_off,
128.                            self.sig_base + self.sig_slope,
129.                            self.sig_base + self.sig_off + self.sig_slope]),
130.                 np.vstack([self.sig_base,  # 2D transposed case.
131.                            self.sig_base + self.sig_off,
132.                            self.sig_base + self.sig_slope,
133.                            self.sig_base + self.sig_off + self.sig_slope]).T,
134.         ]:
135.             if isinstance(sig, np.ndarray):
136.                 assert_array_equal(mlab.detrend_none(sig), sig)
137.             else:
138.                 assert mlab.detrend_none(sig) == sig
139. 
140.     def test_detrend_mean(self):
141.         for sig in [0., 5.5]:  # 0D.
142.             assert mlab.detrend_mean(sig) == 0.
143.             assert mlab.detrend(sig, key="mean") == 0.
144.             assert mlab.detrend(sig, key=mlab.detrend_mean) == 0.
145.         # 1D.
146.         self.allclose(mlab.detrend_mean(self.sig_zeros), self.sig_zeros)
147.         self.allclose(mlab.detrend_mean(self.sig_base), self.sig_base)
148.         self.allclose(mlab.detrend_mean(self.sig_base + self.sig_off),
149.                       self.sig_base)
150.         self.allclose(mlab.detrend_mean(self.sig_base + self.sig_slope),
151.                       self.sig_base + self.sig_slope_mean)
152.         self.allclose(
153.             mlab.detrend_mean(self.sig_base + self.sig_slope + self.sig_off),
154.             self.sig_base + self.sig_slope_mean)
155. 
156.     def test_detrend_mean_1d_base_slope_off_list_andor_axis0(self):
157.         input = self.sig_base + self.sig_slope + self.sig_off
158.         target = self.sig_base + self.sig_slope_mean
159.         self.allclose(mlab.detrend_mean(input, axis=0), target)
160.         self.allclose(mlab.detrend_mean(input.tolist()), target)
161.         self.allclose(mlab.detrend_mean(input.tolist(), axis=0), target)
162. 
163.     def test_detrend_mean_2d(self):
164.         input = np.vstack([self.sig_off,
165.                            self.sig_base + self.sig_off])
166.         target = np.vstack([self.sig_zeros,
167.                             self.sig_base])
168.         self.allclose(mlab.detrend_mean(input), target)
169.         self.allclose(mlab.detrend_mean(input, axis=None), target)
170.         self.allclose(mlab.detrend_mean(input.T, axis=None).T, target)
171.         self.allclose(mlab.detrend(input), target)
172.         self.allclose(mlab.detrend(input, axis=None), target)
173.         self.allclose(
174.             mlab.detrend(input.T, key="constant", axis=None), target.T)
175. 
176.         input = np.vstack([self.sig_base,
177.                            self.sig_base + self.sig_off,
178.                            self.sig_base + self.sig_slope,
179.                            self.sig_base + self.sig_off + self.sig_slope])
180.         target = np.vstack([self.sig_base,
181.                             self.sig_base,
182.                             self.sig_base + self.sig_slope_mean,
183.                             self.sig_base + self.sig_slope_mean])
184.         self.allclose(mlab.detrend_mean(input.T, axis=0), target.T)
185.         self.allclose(mlab.detrend_mean(input, axis=1), target)
186.         self.allclose(mlab.detrend_mean(input, axis=-1), target)
187.         self.allclose(mlab.detrend(input, key="default", axis=1), target)
188.         self.allclose(mlab.detrend(input.T, key="mean", axis=0), target.T)
189.         self.allclose(
190.             mlab.detrend(input.T, key=mlab.detrend_mean, axis=0), target.T)
191. 
192.     def test_detrend_ValueError(self):
193.         for signal, kwargs in [
194.                 (self.sig_slope[np.newaxis], {"key": "spam"}),
195.                 (self.sig_slope[np.newaxis], {"key": 5}),
196.                 (5.5, {"axis": 0}),
197.                 (self.sig_slope, {"axis": 1}),
198.                 (self.sig_slope[np.newaxis], {"axis": 2}),
199.         ]:
200.             with pytest.raises(ValueError):
201.                 mlab.detrend(signal, **kwargs)
202. 
203.     def test_detrend_mean_ValueError(self):
204.         for signal, kwargs in [
205.                 (5.5, {"axis": 0}),
206.                 (self.sig_slope, {"axis": 1}),
207.                 (self.sig_slope[np.newaxis], {"axis": 2}),
208.         ]:
209.             with pytest.raises(ValueError):
210.                 mlab.detrend_mean(signal, **kwargs)
211. 
212.     def test_detrend_linear(self):
213.         # 0D.
214.         assert mlab.detrend_linear(0.) == 0.
215.         assert mlab.detrend_linear(5.5) == 0.
216.         assert mlab.detrend(5.5, key="linear") == 0.
217.         assert mlab.detrend(5.5, key=mlab.detrend_linear) == 0.
218.         for sig in [  # 1D.
219.                 self.sig_off,
220.                 self.sig_slope,
221.                 self.sig_slope + self.sig_off,
222.         ]:
223.             self.allclose(mlab.detrend_linear(sig), self.sig_zeros)
224. 
225.     def test_detrend_str_linear_1d(self):
226.         input = self.sig_slope + self.sig_off
227.         target = self.sig_zeros
228.         self.allclose(mlab.detrend(input, key="linear"), target)
229.         self.allclose(mlab.detrend(input, key=mlab.detrend_linear), target)
230.         self.allclose(mlab.detrend_linear(input.tolist()), target)
231. 
232.     def test_detrend_linear_2d(self):
233.         input = np.vstack([self.sig_off,
234.                            self.sig_slope,
235.                            self.sig_slope + self.sig_off])
236.         target = np.vstack([self.sig_zeros,
237.                             self.sig_zeros,
238.                             self.sig_zeros])
239.         self.allclose(
240.             mlab.detrend(input.T, key="linear", axis=0), target.T)
241.         self.allclose(
242.             mlab.detrend(input.T, key=mlab.detrend_linear, axis=0), target.T)
243.         self.allclose(
244.             mlab.detrend(input, key="linear", axis=1), target)
245.         self.allclose(
246.             mlab.detrend(input, key=mlab.detrend_linear, axis=1), target)
247. 
248.         with pytest.raises(ValueError):
249.             mlab.detrend_linear(self.sig_slope[np.newaxis])
250. 
251. 
252. @pytest.mark.parametrize('iscomplex', [False, True],
253.                          ids=['real', 'complex'], scope='class')
254. @pytest.mark.parametrize('sides', ['onesided', 'twosided', 'default'],
255.                          scope='class')
256. @pytest.mark.parametrize(
257.     'fstims,len_x,NFFT_density,nover_density,pad_to_density,pad_to_spectrum',
258.     [
259.         ([], None, -1, -1, -1, -1),
260.         ([4], None, -1, -1, -1, -1),
261.         ([4, 5, 10], None, -1, -1, -1, -1),
262.         ([], None, None, -1, -1, None),
263.         ([], None, -1, -1, None, None),
264.         ([], None, None, -1, None, None),
265.         ([], 1024, 512, -1, -1, 128),
266.         ([], 256, -1, -1, 33, 257),
267.         ([], 255, 33, -1, -1, None),
268.         ([], 256, 128, -1, 256, 256),
269.         ([], None, -1, 32, -1, -1),
270.     ],
271.     ids=[
272.         'nosig',
273.         'Fs4',
274.         'FsAll',
275.         'nosig_noNFFT',
276.         'nosig_nopad_to',
277.         'nosig_noNFFT_no_pad_to',
278.         'nosig_trim',
279.         'nosig_odd',
280.         'nosig_oddlen',
281.         'nosig_stretch',
282.         'nosig_overlap',
283.     ],
284.     scope='class')
285. class TestSpectral:
286.     @pytest.fixture(scope='class', autouse=True)
287.     def stim(self, request, fstims, iscomplex, sides, len_x, NFFT_density,
288.              nover_density, pad_to_density, pad_to_spectrum):
289.         Fs = 100.
290. 
291.         x = np.arange(0, 10, 1 / Fs)
292.         if len_x is not None:
293.             x = x[:len_x]
294. 
295.         # get the stimulus frequencies, defaulting to None
296.         fstims = [Fs / fstim for fstim in fstims]
297. 
298.         # get the constants, default to calculated values
299.         if NFFT_density is None:
300.             NFFT_density_real = 256
301.         elif NFFT_density < 0:
302.             NFFT_density_real = NFFT_density = 100
303.         else:
304.             NFFT_density_real = NFFT_density
305. 
306.         if nover_density is None:
307.             nover_density_real = 0
308.         elif nover_density < 0:
309.             nover_density_real = nover_density = NFFT_density_real // 2
310.         else:
311.             nover_density_real = nover_density
312. 
313.         if pad_to_density is None:
314.             pad_to_density_real = NFFT_density_real
315.         elif pad_to_density < 0:
316.             pad_to_density = int(2**np.ceil(np.log2(NFFT_density_real)))
317.             pad_to_density_real = pad_to_density
318.         else:
319.             pad_to_density_real = pad_to_density
320. 
321.         if pad_to_spectrum is None:
322.             pad_to_spectrum_real = len(x)
323.         elif pad_to_spectrum < 0:
324.             pad_to_spectrum_real = pad_to_spectrum = len(x)
325.         else:
326.             pad_to_spectrum_real = pad_to_spectrum
327. 
328.         if pad_to_spectrum is None:
329.             NFFT_spectrum_real = NFFT_spectrum = pad_to_spectrum_real
330.         else:
331.             NFFT_spectrum_real = NFFT_spectrum = len(x)
332.         nover_spectrum = 0
333. 
334.         NFFT_specgram = NFFT_density
335.         nover_specgram = nover_density
336.         pad_to_specgram = pad_to_density
337.         NFFT_specgram_real = NFFT_density_real
338.         nover_specgram_real = nover_density_real
339. 
340.         if sides == 'onesided' or (sides == 'default' and not iscomplex):
341.             # frequencies for specgram, psd, and csd
342.             # need to handle even and odd differently
343.             if pad_to_density_real % 2:
344.                 freqs_density = np.linspace(0, Fs / 2,
345.                                             num=pad_to_density_real,
346.                                             endpoint=False)[::2]
347.             else:
348.                 freqs_density = np.linspace(0, Fs / 2,
349.                                             num=pad_to_density_real // 2 + 1)
350. 
351.             # frequencies for complex, magnitude, angle, and phase spectrums
352.             # need to handle even and odd differently
353.             if pad_to_spectrum_real % 2:
354.                 freqs_spectrum = np.linspace(0, Fs / 2,
355.                                              num=pad_to_spectrum_real,
356.                                              endpoint=False)[::2]
357.             else:
358.                 freqs_spectrum = np.linspace(0, Fs / 2,
359.                                              num=pad_to_spectrum_real // 2 + 1)
360.         else:
361.             # frequencies for specgram, psd, and csd
362.             # need to handle even and odd differently
363.             if pad_to_density_real % 2:
364.                 freqs_density = np.linspace(-Fs / 2, Fs / 2,
365.                                             num=2 * pad_to_density_real,
366.                                             endpoint=False)[1::2]
367.             else:
368.                 freqs_density = np.linspace(-Fs / 2, Fs / 2,
369.                                             num=pad_to_density_real,
370.                                             endpoint=False)
371. 
372.             # frequencies for complex, magnitude, angle, and phase spectrums
373.             # need to handle even and odd differently
374.             if pad_to_spectrum_real % 2:
375.                 freqs_spectrum = np.linspace(-Fs / 2, Fs / 2,
376.                                              num=2 * pad_to_spectrum_real,
377.                                              endpoint=False)[1::2]
378.             else:
379.                 freqs_spectrum = np.linspace(-Fs / 2, Fs / 2,
380.                                              num=pad_to_spectrum_real,
381.                                              endpoint=False)
382. 
383.         freqs_specgram = freqs_density
384.         # time points for specgram
385.         t_start = NFFT_specgram_real // 2
386.         t_stop = len(x) - NFFT_specgram_real // 2 + 1
387.         t_step = NFFT_specgram_real - nover_specgram_real
388.         t_specgram = x[t_start:t_stop:t_step]
389.         if NFFT_specgram_real % 2:
390.             t_specgram += 1 / Fs / 2
391.         if len(t_specgram) == 0:
392.             t_specgram = np.array([NFFT_specgram_real / (2 * Fs)])
393.         t_spectrum = np.array([NFFT_spectrum_real / (2 * Fs)])
394.         t_density = t_specgram
395. 
396.         y = np.zeros_like(x)
397.         for i, fstim in enumerate(fstims):
398.             y += np.sin(fstim * x * np.pi * 2) * 10**i
399. 
400.         if iscomplex:
401.             y = y.astype('complex')
402. 
403.         # Interestingly, the instance on which this fixture is called is not
404.         # the same as the one on which a test is run. So we need to modify the
405.         # class itself when using a class-scoped fixture.
406.         cls = request.cls
407. 
408.         cls.Fs = Fs
409.         cls.sides = sides
410.         cls.fstims = fstims
411. 
412.         cls.NFFT_density = NFFT_density
413.         cls.nover_density = nover_density
414.         cls.pad_to_density = pad_to_density
415. 
416.         cls.NFFT_spectrum = NFFT_spectrum
417.         cls.nover_spectrum = nover_spectrum
418.         cls.pad_to_spectrum = pad_to_spectrum
419. 
420.         cls.NFFT_specgram = NFFT_specgram
421.         cls.nover_specgram = nover_specgram
422.         cls.pad_to_specgram = pad_to_specgram
423. 
424.         cls.t_specgram = t_specgram
425.         cls.t_density = t_density
426.         cls.t_spectrum = t_spectrum
427.         cls.y = y
428. 
429.         cls.freqs_density = freqs_density
430.         cls.freqs_spectrum = freqs_spectrum
431.         cls.freqs_specgram = freqs_specgram
432. 
433.         cls.NFFT_density_real = NFFT_density_real
434. 
435.     def check_freqs(self, vals, targfreqs, resfreqs, fstims):
436.         assert resfreqs.argmin() == 0
437.         assert resfreqs.argmax() == len(resfreqs)-1
438.         assert_allclose(resfreqs, targfreqs, atol=1e-06)
439.         for fstim in fstims:
440.             i = np.abs(resfreqs - fstim).argmin()
441.             assert vals[i] > vals[i+2]
442.             assert vals[i] > vals[i-2]
443. 
444.     def check_maxfreq(self, spec, fsp, fstims):
445.         # skip the test if there are no frequencies
446.         if len(fstims) == 0:
447.             return
448. 
449.         # if twosided, do the test for each side
450.         if fsp.min() < 0:
451.             fspa = np.abs(fsp)
452.             zeroind = fspa.argmin()
453.             self.check_maxfreq(spec[:zeroind], fspa[:zeroind], fstims)
454.             self.check_maxfreq(spec[zeroind:], fspa[zeroind:], fstims)
455.             return
456. 
457.         fstimst = fstims[:]
458.         spect = spec.copy()
459. 
460.         # go through each peak and make sure it is correctly the maximum peak
461.         while fstimst:
462.             maxind = spect.argmax()
463.             maxfreq = fsp[maxind]
464.             assert_almost_equal(maxfreq, fstimst[-1])
465.             del fstimst[-1]
466.             spect[maxind-5:maxind+5] = 0
467. 
468.     def test_spectral_helper_raises(self):
469.         # We don't use parametrize here to handle ``y = self.y``.
470.         for kwargs in [  # Various error conditions:
471.             {"y": self.y+1, "mode": "complex"},  # Modes requiring ``x is y``.
472.             {"y": self.y+1, "mode": "magnitude"},
473.             {"y": self.y+1, "mode": "angle"},
474.             {"y": self.y+1, "mode": "phase"},
475.             {"mode": "spam"},  # Bad mode.
476.             {"y": self.y, "sides": "eggs"},  # Bad sides.
477.             {"y": self.y, "NFFT": 10, "noverlap": 20},  # noverlap > NFFT.
478.             {"NFFT": 10, "noverlap": 10},  # noverlap == NFFT.
479.             {"y": self.y, "NFFT": 10,
480.              "window": np.ones(9)},  # len(win) != NFFT.
481.         ]:
482.             with pytest.raises(ValueError):
483.                 mlab._spectral_helper(x=self.y, **kwargs)
484. 
485.     @pytest.mark.parametrize('mode', ['default', 'psd'])
486.     def test_single_spectrum_helper_unsupported_modes(self, mode):
487.         with pytest.raises(ValueError):
488.             mlab._single_spectrum_helper(x=self.y, mode=mode)
489. 
490.     @pytest.mark.parametrize("mode, case", [
491.         ("psd", "density"),
492.         ("magnitude", "specgram"),
493.         ("magnitude", "spectrum"),
494.     ])
495.     def test_spectral_helper_psd(self, mode, case):
496.         freqs = getattr(self, f"freqs_{case}")
497.         spec, fsp, t = mlab._spectral_helper(
498.             x=self.y, y=self.y,
499.             NFFT=getattr(self, f"NFFT_{case}"),
500.             Fs=self.Fs,
501.             noverlap=getattr(self, f"nover_{case}"),
502.             pad_to=getattr(self, f"pad_to_{case}"),
503.             sides=self.sides,
504.             mode=mode)
505. 
506.         assert_allclose(fsp, freqs, atol=1e-06)
507.         assert_allclose(t, getattr(self, f"t_{case}"), atol=1e-06)
508.         assert spec.shape[0] == freqs.shape[0]
509.         assert spec.shape[1] == getattr(self, f"t_{case}").shape[0]
510. 
511.     def test_csd(self):
512.         freqs = self.freqs_density
513.         spec, fsp = mlab.csd(x=self.y, y=self.y+1,
514.                              NFFT=self.NFFT_density,
515.                              Fs=self.Fs,
516.                              noverlap=self.nover_density,
517.                              pad_to=self.pad_to_density,
518.                              sides=self.sides)
519.         assert_allclose(fsp, freqs, atol=1e-06)
520.         assert spec.shape == freqs.shape
521. 
522.     def test_csd_padding(self):
523.         """Test zero padding of csd()."""
524.         if self.NFFT_density is None:  # for derived classes
525.             return
526.         sargs = dict(x=self.y, y=self.y+1, Fs=self.Fs, window=mlab.window_none,
527.                      sides=self.sides)
528. 
529.         spec0, _ = mlab.csd(NFFT=self.NFFT_density, **sargs)
530.         spec1, _ = mlab.csd(NFFT=self.NFFT_density*2, **sargs)
531.         assert_almost_equal(np.sum(np.conjugate(spec0)*spec0).real,
532.                             np.sum(np.conjugate(spec1/2)*spec1/2).real)
533. 
534.     def test_psd(self):
535.         freqs = self.freqs_density
536.         spec, fsp = mlab.psd(x=self.y,
537.                              NFFT=self.NFFT_density,
538.                              Fs=self.Fs,
539.                              noverlap=self.nover_density,
540.                              pad_to=self.pad_to_density,
541.                              sides=self.sides)
542.         assert spec.shape == freqs.shape
543.         self.check_freqs(spec, freqs, fsp, self.fstims)
544. 
545.     @pytest.mark.parametrize(
546.         'make_data, detrend',
547.         [(np.zeros, mlab.detrend_mean), (np.zeros, 'mean'),
548.          (np.arange, mlab.detrend_linear), (np.arange, 'linear')])
549.     def test_psd_detrend(self, make_data, detrend):
550.         if self.NFFT_density is None:
551.             return
552.         ydata = make_data(self.NFFT_density)
553.         ydata1 = ydata+5
554.         ydata2 = ydata+3.3
555.         ydata = np.vstack([ydata1, ydata2])
556.         ydata = np.tile(ydata, (20, 1))
557.         ydatab = ydata.T.flatten()
558.         ydata = ydata.flatten()
559.         ycontrol = np.zeros_like(ydata)
560.         spec_g, fsp_g = mlab.psd(x=ydata,
561.                                  NFFT=self.NFFT_density,
562.                                  Fs=self.Fs,
563.                                  noverlap=0,
564.                                  sides=self.sides,
565.                                  detrend=detrend)
566.         spec_b, fsp_b = mlab.psd(x=ydatab,
567.                                  NFFT=self.NFFT_density,
568.                                  Fs=self.Fs,
569.                                  noverlap=0,
570.                                  sides=self.sides,
571.                                  detrend=detrend)
572.         spec_c, fsp_c = mlab.psd(x=ycontrol,
573.                                  NFFT=self.NFFT_density,
574.                                  Fs=self.Fs,
575.                                  noverlap=0,
576.                                  sides=self.sides)
577.         assert_array_equal(fsp_g, fsp_c)
578.         assert_array_equal(fsp_b, fsp_c)
579.         assert_allclose(spec_g, spec_c, atol=1e-08)
580.         # these should not be almost equal
581.         with pytest.raises(AssertionError):
582.             assert_allclose(spec_b, spec_c, atol=1e-08)
583. 
584.     def test_psd_window_hanning(self):
585.         if self.NFFT_density is None:
586.             return
587.         ydata = np.arange(self.NFFT_density)
588.         ydata1 = ydata+5
589.         ydata2 = ydata+3.3
590.         windowVals = mlab.window_hanning(np.ones_like(ydata1))
591.         ycontrol1 = ydata1 * windowVals
592.         ycontrol2 = mlab.window_hanning(ydata2)
593.         ydata = np.vstack([ydata1, ydata2])
594.         ycontrol = np.vstack([ycontrol1, ycontrol2])
595.         ydata = np.tile(ydata, (20, 1))
596.         ycontrol = np.tile(ycontrol, (20, 1))
597.         ydatab = ydata.T.flatten()
598.         ydataf = ydata.flatten()
599.         ycontrol = ycontrol.flatten()
600.         spec_g, fsp_g = mlab.psd(x=ydataf,
601.                                  NFFT=self.NFFT_density,
602.                                  Fs=self.Fs,
603.                                  noverlap=0,
604.                                  sides=self.sides,
605.                                  window=mlab.window_hanning)
606.         spec_b, fsp_b = mlab.psd(x=ydatab,
607.                                  NFFT=self.NFFT_density,
608.                                  Fs=self.Fs,
609.                                  noverlap=0,
610.                                  sides=self.sides,
611.                                  window=mlab.window_hanning)
612.         spec_c, fsp_c = mlab.psd(x=ycontrol,
613.                                  NFFT=self.NFFT_density,
614.                                  Fs=self.Fs,
615.                                  noverlap=0,
616.                                  sides=self.sides,
617.                                  window=mlab.window_none)
618.         spec_c *= len(ycontrol1)/(np.abs(windowVals)**2).sum()
619.         assert_array_equal(fsp_g, fsp_c)
620.         assert_array_equal(fsp_b, fsp_c)
621.         assert_allclose(spec_g, spec_c, atol=1e-08)
622.         # these should not be almost equal
623.         with pytest.raises(AssertionError):
624.             assert_allclose(spec_b, spec_c, atol=1e-08)
625. 
626.     def test_psd_window_hanning_detrend_linear(self):
627.         if self.NFFT_density is None:
628.             return
629.         ydata = np.arange(self.NFFT_density)
630.         ycontrol = np.zeros(self.NFFT_density)
631.         ydata1 = ydata+5
632.         ydata2 = ydata+3.3
633.         ycontrol1 = ycontrol
634.         ycontrol2 = ycontrol
635.         windowVals = mlab.window_hanning(np.ones_like(ycontrol1))
636.         ycontrol1 = ycontrol1 * windowVals
637.         ycontrol2 = mlab.window_hanning(ycontrol2)
638.         ydata = np.vstack([ydata1, ydata2])
639.         ycontrol = np.vstack([ycontrol1, ycontrol2])
640.         ydata = np.tile(ydata, (20, 1))
641.         ycontrol = np.tile(ycontrol, (20, 1))
642.         ydatab = ydata.T.flatten()
643.         ydataf = ydata.flatten()
644.         ycontrol = ycontrol.flatten()
645.         spec_g, fsp_g = mlab.psd(x=ydataf,
646.                                  NFFT=self.NFFT_density,
647.                                  Fs=self.Fs,
648.                                  noverlap=0,
649.                                  sides=self.sides,
650.                                  detrend=mlab.detrend_linear,
651.                                  window=mlab.window_hanning)
652.         spec_b, fsp_b = mlab.psd(x=ydatab,
653.                                  NFFT=self.NFFT_density,
654.                                  Fs=self.Fs,
655.                                  noverlap=0,
656.                                  sides=self.sides,
657.                                  detrend=mlab.detrend_linear,
658.                                  window=mlab.window_hanning)
659.         spec_c, fsp_c = mlab.psd(x=ycontrol,
660.                                  NFFT=self.NFFT_density,
661.                                  Fs=self.Fs,
662.                                  noverlap=0,
663.                                  sides=self.sides,
664.                                  window=mlab.window_none)
665.         spec_c *= len(ycontrol1)/(np.abs(windowVals)**2).sum()
666.         assert_array_equal(fsp_g, fsp_c)
667.         assert_array_equal(fsp_b, fsp_c)
668.         assert_allclose(spec_g, spec_c, atol=1e-08)
669.         # these should not be almost equal
670.         with pytest.raises(AssertionError):
671.             assert_allclose(spec_b, spec_c, atol=1e-08)
672. 
673.     def test_psd_windowarray(self):
674.         freqs = self.freqs_density
675.         spec, fsp = mlab.psd(x=self.y,
676.                              NFFT=self.NFFT_density,
677.                              Fs=self.Fs,
678.                              noverlap=self.nover_density,
679.                              pad_to=self.pad_to_density,
680.                              sides=self.sides,
681.                              window=np.ones(self.NFFT_density_real))
682.         assert_allclose(fsp, freqs, atol=1e-06)
683.         assert spec.shape == freqs.shape
684. 
685.     def test_psd_windowarray_scale_by_freq(self):
686.         win = mlab.window_hanning(np.ones(self.NFFT_density_real))
687. 
688.         spec, fsp = mlab.psd(x=self.y,
689.                              NFFT=self.NFFT_density,
690.                              Fs=self.Fs,
691.                              noverlap=self.nover_density,
692.                              pad_to=self.pad_to_density,
693.                              sides=self.sides,
694.                              window=mlab.window_hanning)
695.         spec_s, fsp_s = mlab.psd(x=self.y,
696.                                  NFFT=self.NFFT_density,
697.                                  Fs=self.Fs,
698.                                  noverlap=self.nover_density,
699.                                  pad_to=self.pad_to_density,
700.                                  sides=self.sides,
701.                                  window=mlab.window_hanning,
702.                                  scale_by_freq=True)
703.         spec_n, fsp_n = mlab.psd(x=self.y,
704.                                  NFFT=self.NFFT_density,
705.                                  Fs=self.Fs,
706.                                  noverlap=self.nover_density,
707.                                  pad_to=self.pad_to_density,
708.                                  sides=self.sides,
709.                                  window=mlab.window_hanning,
710.                                  scale_by_freq=False)
711.         assert_array_equal(fsp, fsp_s)
712.         assert_array_equal(fsp, fsp_n)
713.         assert_array_equal(spec, spec_s)
714.         assert_allclose(spec_s*(win**2).sum(),
715.                         spec_n/self.Fs*win.sum()**2,
716.                         atol=1e-08)
717. 
718.     @pytest.mark.parametrize(
719.         "kind", ["complex", "magnitude", "angle", "phase"])
720.     def test_spectrum(self, kind):
721.         freqs = self.freqs_spectrum
722.         spec, fsp = getattr(mlab, f"{kind}_spectrum")(
723.             x=self.y,
724.             Fs=self.Fs, sides=self.sides, pad_to=self.pad_to_spectrum)
725.         assert_allclose(fsp, freqs, atol=1e-06)
726.         assert spec.shape == freqs.shape
727.         if kind == "magnitude":
728.             self.check_maxfreq(spec, fsp, self.fstims)
729.             self.check_freqs(spec, freqs, fsp, self.fstims)
730. 
731.     @pytest.mark.parametrize(
732.         'kwargs',
733.         [{}, {'mode': 'default'}, {'mode': 'psd'}, {'mode': 'magnitude'},
734.          {'mode': 'complex'}, {'mode': 'angle'}, {'mode': 'phase'}])
735.     def test_specgram(self, kwargs):
736.         freqs = self.freqs_specgram
737.         spec, fsp, t = mlab.specgram(x=self.y,
738.                                      NFFT=self.NFFT_specgram,
739.                                      Fs=self.Fs,
740.                                      noverlap=self.nover_specgram,
741.                                      pad_to=self.pad_to_specgram,
742.                                      sides=self.sides,
743.                                      **kwargs)
744.         if kwargs.get('mode') == 'complex':
745.             spec = np.abs(spec)
746.         specm = np.mean(spec, axis=1)
747. 
748.         assert_allclose(fsp, freqs, atol=1e-06)
749.         assert_allclose(t, self.t_specgram, atol=1e-06)
750. 
751.         assert spec.shape[0] == freqs.shape[0]
752.         assert spec.shape[1] == self.t_specgram.shape[0]
753. 
754.         if kwargs.get('mode') not in ['complex', 'angle', 'phase']:
755.             # using a single freq, so all time slices should be about the same
756.             if np.abs(spec.max()) != 0:
757.                 assert_allclose(
758.                     np.diff(spec, axis=1).max() / np.abs(spec.max()), 0,
759.                     atol=1e-02)
760.         if kwargs.get('mode') not in ['angle', 'phase']:
761.             self.check_freqs(specm, freqs, fsp, self.fstims)
762. 
763.     def test_specgram_warn_only1seg(self):
764.         """Warning should be raised if len(x) <= NFFT."""
765.         with pytest.warns(UserWarning, match="Only one segment is calculated"):
766.             mlab.specgram(x=self.y, NFFT=len(self.y), Fs=self.Fs)
767. 
768.     def test_psd_csd_equal(self):
769.         Pxx, freqsxx = mlab.psd(x=self.y,
770.                                 NFFT=self.NFFT_density,
771.                                 Fs=self.Fs,
772.                                 noverlap=self.nover_density,
773.                                 pad_to=self.pad_to_density,
774.                                 sides=self.sides)
775.         Pxy, freqsxy = mlab.csd(x=self.y, y=self.y,
776.                                 NFFT=self.NFFT_density,
777.                                 Fs=self.Fs,
778.                                 noverlap=self.nover_density,
779.                                 pad_to=self.pad_to_density,
780.                                 sides=self.sides)
781.         assert_array_almost_equal_nulp(Pxx, Pxy)
782.         assert_array_equal(freqsxx, freqsxy)
783. 
784.     @pytest.mark.parametrize("mode", ["default", "psd"])
785.     def test_specgram_auto_default_psd_equal(self, mode):
786.         """
787.         Test that mlab.specgram without mode and with mode 'default' and 'psd'
788.         are all the same.
789.         """
790.         speca, freqspeca, ta = mlab.specgram(x=self.y,
791.                                              NFFT=self.NFFT_specgram,
792.                                              Fs=self.Fs,
793.                                              noverlap=self.nover_specgram,
794.                                              pad_to=self.pad_to_specgram,
795.                                              sides=self.sides)
796.         specb, freqspecb, tb = mlab.specgram(x=self.y,
797.                                              NFFT=self.NFFT_specgram,
798.                                              Fs=self.Fs,
799.                                              noverlap=self.nover_specgram,
800.                                              pad_to=self.pad_to_specgram,
801.                                              sides=self.sides,
802.                                              mode=mode)
803.         assert_array_equal(speca, specb)
804.         assert_array_equal(freqspeca, freqspecb)
805.         assert_array_equal(ta, tb)
806. 
807.     @pytest.mark.parametrize(
808.         "mode, conv", [
809.             ("magnitude", np.abs),
810.             ("angle", np.angle),
811.             ("phase", lambda x: np.unwrap(np.angle(x), axis=0))
812.         ])
813.     def test_specgram_complex_equivalent(self, mode, conv):
814.         specc, freqspecc, tc = mlab.specgram(x=self.y,
815.                                              NFFT=self.NFFT_specgram,
816.                                              Fs=self.Fs,
817.                                              noverlap=self.nover_specgram,
818.                                              pad_to=self.pad_to_specgram,
819.                                              sides=self.sides,
820.                                              mode='complex')
821.         specm, freqspecm, tm = mlab.specgram(x=self.y,
822.                                              NFFT=self.NFFT_specgram,
823.                                              Fs=self.Fs,
824.                                              noverlap=self.nover_specgram,
825.                                              pad_to=self.pad_to_specgram,
826.                                              sides=self.sides,
827.                                              mode=mode)
828. 
829.         assert_array_equal(freqspecc, freqspecm)
830.         assert_array_equal(tc, tm)
831.         assert_allclose(conv(specc), specm, atol=1e-06)
832. 
833.     def test_psd_windowarray_equal(self):
834.         win = mlab.window_hanning(np.ones(self.NFFT_density_real))
835.         speca, fspa = mlab.psd(x=self.y,
836.                                NFFT=self.NFFT_density,
837.                                Fs=self.Fs,
838.                                noverlap=self.nover_density,
839.                                pad_to=self.pad_to_density,
840.                                sides=self.sides,
841.                                window=win)
842.         specb, fspb = mlab.psd(x=self.y,
843.                                NFFT=self.NFFT_density,
844.                                Fs=self.Fs,
845.                                noverlap=self.nover_density,
846.                                pad_to=self.pad_to_density,
847.                                sides=self.sides)
848.         assert_array_equal(fspa, fspb)
849.         assert_allclose(speca, specb, atol=1e-08)
850. 
851. 
852. # extra test for cohere...
853. def test_cohere():
854.     N = 1024
855.     np.random.seed(19680801)
856.     x = np.random.randn(N)
857.     # phase offset
858.     y = np.roll(x, 20)
859.     # high-freq roll-off
860.     y = np.convolve(y, np.ones(20) / 20., mode='same')
861.     cohsq, f = mlab.cohere(x, y, NFFT=256, Fs=2, noverlap=128)
862.     assert_allclose(np.mean(cohsq), 0.837, atol=1.e-3)
863.     assert np.isreal(np.mean(cohsq))
864. 
865. 
866. # *****************************************************************
867. # These Tests were taken from SCIPY with some minor modifications
868. # this can be retrieved from:
869. # https://github.com/scipy/scipy/blob/master/scipy/stats/tests/test_kdeoth.py
870. # *****************************************************************
871. 
872. class TestGaussianKDE:
873. 
874.     def test_kde_integer_input(self):
875.         """Regression test for #1181."""
876.         x1 = np.arange(5)
877.         kde = mlab.GaussianKDE(x1)
878.         y_expected = [0.13480721, 0.18222869, 0.19514935, 0.18222869,
879.                       0.13480721]
880.         np.testing.assert_array_almost_equal(kde(x1), y_expected, decimal=6)
881. 
882.     def test_gaussian_kde_covariance_caching(self):
883.         x1 = np.array([-7, -5, 1, 4, 5], dtype=float)
884.         xs = np.linspace(-10, 10, num=5)
885.         # These expected values are from scipy 0.10, before some changes to
886.         # gaussian_kde. They were not compared with any external reference.
887.         y_expected = [0.02463386, 0.04689208, 0.05395444, 0.05337754,
888.                       0.01664475]
889. 
890.         # set it to the default bandwidth.
891.         kde2 = mlab.GaussianKDE(x1, 'scott')
892.         y2 = kde2(xs)
893. 
894.         np.testing.assert_array_almost_equal(y_expected, y2, decimal=7)
895. 
896.     def test_kde_bandwidth_method(self):
897. 
898.         np.random.seed(8765678)
899.         n_basesample = 50
900.         xn = np.random.randn(n_basesample)
901. 
902.         # Default
903.         gkde = mlab.GaussianKDE(xn)
904.         # Supply a callable
905.         gkde2 = mlab.GaussianKDE(xn, 'scott')
906.         # Supply a scalar
907.         gkde3 = mlab.GaussianKDE(xn, bw_method=gkde.factor)
908. 
909.         xs = np.linspace(-7, 7, 51)
910.         kdepdf = gkde.evaluate(xs)
911.         kdepdf2 = gkde2.evaluate(xs)
912.         assert kdepdf.all() == kdepdf2.all()
913.         kdepdf3 = gkde3.evaluate(xs)
914.         assert kdepdf.all() == kdepdf3.all()
915. 
916. 
917. class TestGaussianKDECustom:
918.     def test_no_data(self):
919.         """Pass no data into the GaussianKDE class."""
920.         with pytest.raises(ValueError):
921.             mlab.GaussianKDE([])
922. 
923.     def test_single_dataset_element(self):
924.         """Pass a single dataset element into the GaussianKDE class."""
925.         with pytest.raises(ValueError):
926.             mlab.GaussianKDE([42])
927. 
928.     def test_silverman_multidim_dataset(self):
929.         """Test silverman's for a multi-dimensional array."""
930.         x1 = np.array([[1, 2, 3], [4, 5, 6], [7, 8, 9]])
931.         with pytest.raises(np.linalg.LinAlgError):
932.             mlab.GaussianKDE(x1, "silverman")
933. 
934.     def test_silverman_singledim_dataset(self):
935.         """Test silverman's output for a single dimension list."""
936.         x1 = np.array([-7, -5, 1, 4, 5])
937.         mygauss = mlab.GaussianKDE(x1, "silverman")
938.         y_expected = 0.76770389927475502
939.         assert_almost_equal(mygauss.covariance_factor(), y_expected, 7)
940. 
941.     def test_scott_multidim_dataset(self):
942.         """Test scott's output for a multi-dimensional array."""
943.         x1 = np.array([[1, 2, 3], [4, 5, 6], [7, 8, 9]])
944.         with pytest.raises(np.linalg.LinAlgError):
945.             mlab.GaussianKDE(x1, "scott")
946. 
947.     def test_scott_singledim_dataset(self):
948.         """Test scott's output a single-dimensional array."""
949.         x1 = np.array([-7, -5, 1, 4, 5])
950.         mygauss = mlab.GaussianKDE(x1, "scott")
951.         y_expected = 0.72477966367769553
952.         assert_almost_equal(mygauss.covariance_factor(), y_expected, 7)
953. 
954.     def test_scalar_empty_dataset(self):
955.         """Test the scalar's cov factor for an empty array."""
956.         with pytest.raises(ValueError):
957.             mlab.GaussianKDE([], bw_method=5)
958. 
959.     def test_scalar_covariance_dataset(self):
960.         """Test a scalar's cov factor."""
961.         np.random.seed(8765678)
962.         n_basesample = 50
963.         multidim_data = [np.random.randn(n_basesample) for i in range(5)]
964. 
965.         kde = mlab.GaussianKDE(multidim_data, bw_method=0.5)
966.         assert kde.covariance_factor() == 0.5
967. 
968.     def test_callable_covariance_dataset(self):
969.         """Test the callable's cov factor for a multi-dimensional array."""
970.         np.random.seed(8765678)
971.         n_basesample = 50
972.         multidim_data = [np.random.randn(n_basesample) for i in range(5)]
973. 
974.         def callable_fun(x):
975.             return 0.55
976.         kde = mlab.GaussianKDE(multidim_data, bw_method=callable_fun)
977.         assert kde.covariance_factor() == 0.55
978. 
979.     def test_callable_singledim_dataset(self):
980.         """Test the callable's cov factor for a single-dimensional array."""
981.         np.random.seed(8765678)
982.         n_basesample = 50
983.         multidim_data = np.random.randn(n_basesample)
984. 
985.         kde = mlab.GaussianKDE(multidim_data, bw_method='silverman')
986.         y_expected = 0.48438841363348911
987.         assert_almost_equal(kde.covariance_factor(), y_expected, 7)
988. 
989.     def test_wrong_bw_method(self):
990.         """Test the error message that should be called when bw is invalid."""
991.         np.random.seed(8765678)
992.         n_basesample = 50
993.         data = np.random.randn(n_basesample)
994.         with pytest.raises(ValueError):
995.             mlab.GaussianKDE(data, bw_method="invalid")
996. 
997. 
998. class TestGaussianKDEEvaluate:
999. 
1000.     def test_evaluate_diff_dim(self):
1001.         """
1002.         Test the evaluate method when the dim's of dataset and points have
1003.         different dimensions.
1004.         """
1005.         x1 = np.arange(3, 10, 2)
1006.         kde = mlab.GaussianKDE(x1)
1007.         x2 = np.arange(3, 12, 2)
1008.         y_expected = [
1009.             0.08797252, 0.11774109, 0.11774109, 0.08797252, 0.0370153
1010.         ]
1011.         y = kde.evaluate(x2)
1012.         np.testing.assert_array_almost_equal(y, y_expected, 7)
1013. 
1014.     def test_evaluate_inv_dim(self):
1015.         """
1016.         Invert the dimensions; i.e., for a dataset of dimension 1 [3, 2, 4],
1017.         the points should have a dimension of 3 [[3], [2], [4]].
1018.         """
1019.         np.random.seed(8765678)
1020.         n_basesample = 50
1021.         multidim_data = np.random.randn(n_basesample)
1022.         kde = mlab.GaussianKDE(multidim_data)
1023.         x2 = [[1], [2], [3]]
1024.         with pytest.raises(ValueError):
1025.             kde.evaluate(x2)
1026. 
1027.     def test_evaluate_dim_and_num(self):
1028.         """Tests if evaluated against a one by one array"""
1029.         x1 = np.arange(3, 10, 2)
1030.         x2 = np.array([3])
1031.         kde = mlab.GaussianKDE(x1)
1032.         y_expected = [0.08797252]
1033.         y = kde.evaluate(x2)
1034.         np.testing.assert_array_almost_equal(y, y_expected, 7)
1035. 
1036.     def test_evaluate_point_dim_not_one(self):
1037.         x1 = np.arange(3, 10, 2)
1038.         x2 = [np.arange(3, 10, 2), np.arange(3, 10, 2)]
1039.         kde = mlab.GaussianKDE(x1)
1040.         with pytest.raises(ValueError):
1041.             kde.evaluate(x2)
1042. 
1043.     def test_evaluate_equal_dim_and_num_lt(self):
1044.         x1 = np.arange(3, 10, 2)
1045.         x2 = np.arange(3, 8, 2)
1046.         kde = mlab.GaussianKDE(x1)
1047.         y_expected = [0.08797252, 0.11774109, 0.11774109]
1048.         y = kde.evaluate(x2)
1049.         np.testing.assert_array_almost_equal(y, y_expected, 7)
1050. 
1051. 
1052. def test_psd_onesided_norm():
1053.     u = np.array([0, 1, 2, 3, 1, 2, 1])
1054.     dt = 1.0
1055.     Su = np.abs(np.fft.fft(u) * dt)**2 / (dt * u.size)
1056.     P, f = mlab.psd(u, NFFT=u.size, Fs=1/dt, window=mlab.window_none,
1057.                     detrend=mlab.detrend_none, noverlap=0, pad_to=None,
1058.                     scale_by_freq=None,
1059.                     sides='onesided')
1060.     Su_1side = np.append([Su[0]], Su[1:4] + Su[4:][::-1])
1061.     assert_allclose(P, Su_1side, atol=1e-06)
1062. 
1063. 
1064. def test_psd_oversampling():
1065.     """Test the case len(x) < NFFT for psd()."""
1066.     u = np.array([0, 1, 2, 3, 1, 2, 1])
1067.     dt = 1.0
1068.     Su = np.abs(np.fft.fft(u) * dt)**2 / (dt * u.size)
1069.     P, f = mlab.psd(u, NFFT=u.size*2, Fs=1/dt, window=mlab.window_none,
1070.                     detrend=mlab.detrend_none, noverlap=0, pad_to=None,
1071.                     scale_by_freq=None,
1072.                     sides='onesided')
1073.     Su_1side = np.append([Su[0]], Su[1:4] + Su[4:][::-1])
1074.     assert_almost_equal(np.sum(P), np.sum(Su_1side))  # same energy

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 03:20:29,919 - thread-129519985886912.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The provided context, which includes the full content of `lib/matplotlib/tests/test_mlab.py`, is sufficient to identify and extract three relevant test cases. The file contains tests for spectral analysis functions in `mlab`, which are directly related to the bug report. I can find self-contained tests and also reconstruct tests from the parameterized test class `TestSpectral` to provide complete, self-contained examples as requested. Therefore, no additional context is needed.' query='' extra_requirements='' purpose=''
2025-12-21 03:20:29,920 - thread-129519985886912.prometheus_context_collector - INFO - Successfully retrieved 1 context snippets
